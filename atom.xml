<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Amy and Booboo</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.toberoot.com/"/>
  <updated>2020-03-22T14:23:51.136Z</updated>
  <id>http://www.toberoot.com/</id>
  
  <author>
    <name>BoobooWei</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hello World</title>
    <link href="http://www.toberoot.com/2020/03/22/booboo_others/hello-world/"/>
    <id>http://www.toberoot.com/2020/03/22/booboo_others/hello-world/</id>
    <published>2020-03-22T14:23:51.136Z</published>
    <updated>2020-03-22T14:23:51.136Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯å¹¿è§’" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="Hexo" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/Hexo/"/>
    
    
      <category term="hexo" scheme="http://www.toberoot.com/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>å›½åº†å‰å­¦æ´—æ‰‹</title>
    <link href="http://www.toberoot.com/2018/09/30/amy_life/%E5%9B%BD%E5%BA%86%E5%89%8D%E5%AD%A6%E6%B4%97%E6%89%8B/"/>
    <id>http://www.toberoot.com/2018/09/30/amy_life/%E5%9B%BD%E5%BA%86%E5%89%8D%E5%AD%A6%E6%B4%97%E6%89%8B/</id>
    <published>2018-09-30T10:43:53.000Z</published>
    <updated>2020-03-22T08:31:38.472Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©äººå°‘ï¼Œæˆ‘ä»¬åå°æœˆäº®ï¼Œç„¶åç»™ä»–ä»¬æ¯äººç”¨äº†å…æ´—æ´—æ‰‹æ¶²ï¼Œæ´—å°æ‰‹ï¼Œå›½åº†èŠ‚å‡ºå»ä¸è¦å¿˜è®°å¸¦å“¦</p><a id="more"></a><p align="center"><embed src='http://player.youku.com/player.php/sid/XMzg0Mzk0NDI5Ng==/v.swf' allowFullScreen='true' quality='high' width='480' height='400' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'></embed></p><p><img src="%E5%9B%BD%E5%BA%86%E5%89%8D%E5%AD%A6%E6%B4%97%E6%89%8B/01.jpg" alt=""></p><p>å›å›è€å¸ˆ:<br>ä»–ä»¬è®©æˆ‘å‘ç»™ä½ ä»¬ğŸ˜‚</p><p>å°æ…ˆçš„æ™šæ‰˜ç­åˆ¶ä½œäº”æ˜Ÿçº¢æ——</p><p align="center"><embed src='http://player.youku.com/player.php/sid/XMzg0Mzk0OTg4MA==/v.swf' allowFullScreen='true' quality='high' width='480' height='400' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'></embed></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©äººå°‘ï¼Œæˆ‘ä»¬åå°æœˆäº®ï¼Œç„¶åç»™ä»–ä»¬æ¯äººç”¨äº†å…æ´—æ´—æ‰‹æ¶²ï¼Œæ´—å°æ‰‹ï¼Œå›½åº†èŠ‚å‡ºå»ä¸è¦å¿˜è®°å¸¦å“¦&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¾€æ˜”è¿½å¿†" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/"/>
    
      <category term="å°äºŒç­" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/%E5%B0%8F%E4%BA%8C%E7%8F%AD/"/>
    
    
      <category term="å®å®æˆé•¿" scheme="http://www.toberoot.com/tags/%E5%AE%9D%E5%AE%9D%E6%88%90%E9%95%BF/"/>
    
  </entry>
  
  <entry>
    <title>å®å®ä»¬ä¸Šç­å•¦</title>
    <link href="http://www.toberoot.com/2018/09/29/amy_life/%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/"/>
    <id>http://www.toberoot.com/2018/09/29/amy_life/%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/</id>
    <published>2018-09-29T10:43:41.000Z</published>
    <updated>2020-03-22T08:31:38.457Z</updated>
    
    <content type="html"><![CDATA[<p>å›å›è€å¸ˆ:<br>æœ€è¿‘æˆ‘ä»¬å­©å­çš„è§’è‰²æ¸¸æˆæ…¢æ…¢è¿›å…¥çŠ¶æ€äº†ï¼Œä½†ä¹Ÿæœ‰å‡ ä¸ªå­©å­æ²‰è¿·äºç§¯æœ¨æ¸¸æˆæ— æ³•è‡ªæ‹”ï¼Œæˆ‘ä»¬å¸Œæœ›å®¶é•¿ä»¬åœ¨å®¶é‡Œä¹Ÿå¯ä»¥å’Œå­©å­ä»¬ä¸€èµ·ç©è§’è‰²æ‰®æ¼”æ¸¸æˆï¼Œå’Œå­©å­å¤šäº’åŠ¨ï¼Œä¹Ÿå¯ä»¥æ‹“å®½æ€è·¯ï¼Œå¯ä»¥åšç°å®ç”Ÿæ´»ä¸­ä¸èƒ½åšçš„ï¼Œæ¯”å¦‚ä»™å¥³å•Šï¼Œå…¬ä¸»å•Šï¼Œå°å£«å…µç­‰ç­‰</p><a id="more"></a><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/01.jpg" alt=""></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/02.jpg" alt="02"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/03.jpg" alt="03"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/04.jpg" alt="04"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/05.jpg" alt="05"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/06.jpg" alt="06"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/07.jpg" alt="07"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/08.jpg" alt="08"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/09.jpg" alt="09"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/10.jpg" alt="10"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/11.jpg" alt="11"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/12.jpg" alt="12"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/13.jpg" alt="13"></p><p>å›å›è€å¸ˆ:<br>ä»Šå¤©æˆ‘ä»¬è¿˜è®¤è¯†äº†äº”æ˜Ÿçº¢æ——ï¼ŒçŸ¥é“è‡ªå·±æ˜¯ä¸€ä¸ªä¸­å›½äººï¼Œæˆ‘å‘Šè¯‰ä»–ä»¬è¿‡å‡ å¤©è¦ç»™ç¥–å›½å¦ˆå¦ˆè¿‡ç”Ÿæ—¥äº†ï¼Œè¦ä¼‘æ¯ä¸ƒå¤©ï¼Œæœ‰å­©å­è¿˜åé©³è¯´ä¸è¡Œï¼Œä¼‘æ¯ä¸‰å¤©å°±å¤Ÿäº†ï¼Œå“ˆå“ˆæˆ‘è¿˜å‘Šè¯‰ä»–ä»¬ç¥–å›½å¦ˆå¦ˆä¼šè¯·ä»–ä»¬åƒç”Ÿæ—¥è›‹ç³•çš„</p><p>åˆé¤å‰è¿˜é¢å¤–å­¦äº†ä¸€é¦–æ­Œï¼Œé€ç»™æˆ‘ä»¬çš„ç¥–å›½å¦ˆå¦ˆ</p><p><a href="https://music.163.com/#/song?id=498555737&market=baiduqk" target="_blank" rel="noopener">å„¿æ­Œ-ç¥–å›½ç¥–å›½æˆ‘çˆ±ä½ </a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å›å›è€å¸ˆ:&lt;br&gt;æœ€è¿‘æˆ‘ä»¬å­©å­çš„è§’è‰²æ¸¸æˆæ…¢æ…¢è¿›å…¥çŠ¶æ€äº†ï¼Œä½†ä¹Ÿæœ‰å‡ ä¸ªå­©å­æ²‰è¿·äºç§¯æœ¨æ¸¸æˆæ— æ³•è‡ªæ‹”ï¼Œæˆ‘ä»¬å¸Œæœ›å®¶é•¿ä»¬åœ¨å®¶é‡Œä¹Ÿå¯ä»¥å’Œå­©å­ä»¬ä¸€èµ·ç©è§’è‰²æ‰®æ¼”æ¸¸æˆï¼Œå’Œå­©å­å¤šäº’åŠ¨ï¼Œä¹Ÿå¯ä»¥æ‹“å®½æ€è·¯ï¼Œå¯ä»¥åšç°å®ç”Ÿæ´»ä¸­ä¸èƒ½åšçš„ï¼Œæ¯”å¦‚ä»™å¥³å•Šï¼Œå…¬ä¸»å•Šï¼Œå°å£«å…µç­‰ç­‰&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¾€æ˜”è¿½å¿†" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/"/>
    
      <category term="å°äºŒç­" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/%E5%B0%8F%E4%BA%8C%E7%8F%AD/"/>
    
    
      <category term="å®å®æˆé•¿" scheme="http://www.toberoot.com/tags/%E5%AE%9D%E5%AE%9D%E6%88%90%E9%95%BF/"/>
    
  </entry>
  
  <entry>
    <title>æœˆé¥¼çƒ˜åŸ¹å’Œå°å°æ¬è¿å·¥</title>
    <link href="http://www.toberoot.com/2018/09/21/amy_life/%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/"/>
    <id>http://www.toberoot.com/2018/09/21/amy_life/%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/</id>
    <published>2018-09-21T12:25:51.000Z</published>
    <updated>2020-03-22T08:31:38.460Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸­ç§‹èŠ‚å¿«åˆ°äº†ï¼Œè€å¸ˆå¸¦å®å®ä»¬ä¸€èµ·åšäº†æœˆé¥¼ï¼Œæ‹¿å»çƒ¤äº†ï¼Œå®å®ä»¬è¿˜å¸®è€å¸ˆä¸€èµ·æ¬æ¡Œå­ï¼Œè™½ç„¶ç»“å±€å·®å¼ºäººæ„ï¼Œä½†æ˜¯å­©å­ä»¬éƒ½å¾ˆå¼€å¿ƒå‘¢ï¼</p><a id="more"></a><p align="center"><embed src='http://player.youku.com/player.php/sid/XMzg0Mzk0NDg5Ng==/v.swf' allowFullScreen='true' quality='high' width='480' height='400' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'></embed></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/01.jpg" alt=""></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/02.jpg" alt="02"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/03.jpg" alt="03"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/04.jpg" alt="04"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/05.jpg" alt="05"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/06.jpg" alt="06"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/07.jpg" alt="07"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/08.jpg" alt="08"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/09.jpg" alt="09"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/20.jpg" alt="20"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/00.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸­ç§‹èŠ‚å¿«åˆ°äº†ï¼Œè€å¸ˆå¸¦å®å®ä»¬ä¸€èµ·åšäº†æœˆé¥¼ï¼Œæ‹¿å»çƒ¤äº†ï¼Œå®å®ä»¬è¿˜å¸®è€å¸ˆä¸€èµ·æ¬æ¡Œå­ï¼Œè™½ç„¶ç»“å±€å·®å¼ºäººæ„ï¼Œä½†æ˜¯å­©å­ä»¬éƒ½å¾ˆå¼€å¿ƒå‘¢ï¼&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¾€æ˜”è¿½å¿†" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/"/>
    
      <category term="å°äºŒç­" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/%E5%B0%8F%E4%BA%8C%E7%8F%AD/"/>
    
    
      <category term="å®å®æˆé•¿" scheme="http://www.toberoot.com/tags/%E5%AE%9D%E5%AE%9D%E6%88%90%E9%95%BF/"/>
    
  </entry>
  
  <entry>
    <title>å®å®ä»¬å¼€å§‹æ¼±å£äº†</title>
    <link href="http://www.toberoot.com/2018/09/20/amy_life/%E5%AE%9D%E5%AE%9D%E4%BB%AC%E5%BC%80%E5%A7%8B%E6%BC%B1%E5%8F%A3%E4%BA%86/"/>
    <id>http://www.toberoot.com/2018/09/20/amy_life/%E5%AE%9D%E5%AE%9D%E4%BB%AC%E5%BC%80%E5%A7%8B%E6%BC%B1%E5%8F%A3%E4%BA%86/</id>
    <published>2018-09-20T12:08:51.000Z</published>
    <updated>2020-03-22T08:31:38.469Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦ï¼šä»Šå¤©å¼€å§‹æˆ‘ä»¬è®©å®å®ä»¬å¼€å§‹æ¼±å£äº†ï¼Œæ‰€ä»¥å›å®¶ä¹Ÿè¦ç»§ç»­ä¿æŒè¿™ä¸ªå¥½ä¹ æƒ¯å“¦ï½</p><a id="more"></a><p>å›å›è€å¸ˆè¯­å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å„ä½äº²ä»¬ï¼Œé€šè¿‡æ˜¨å¤©çš„å®¶é•¿ä¼šï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å®¶é•¿å›å»çš„åŠªåŠ›ï¼Œä»Šå¤©åˆé¥­æ˜æ˜¾è¿›æ­¥çš„å®å®æœ‰ï¼š@å¼ ç‘¾å®‰å¦ˆå¦ˆâ€…@æ“æ¢“æ¡å¦ˆå¦ˆâ€…@ä½†é¢å®¸å¦ˆå¦ˆâ€…@ä½•æ™Ÿç¿å¦ˆå¦ˆâ€…@å¼ æ¬è§…å¦ˆå¦ˆâ€…@ä¸¥é­æ…ˆå¦ˆå¦ˆâ€…@ç‹æ™Ÿå®å¦ˆå¦ˆâ€…ï¼Œå…¶ä»–å®å®ä»¬ç»§ç»­åŠ æ²¹å“¦ï½</span><br><span class="line"></span><br><span class="line">åƒé¥­æˆ‘ä»¬æ˜¯å’Œå­©å­ä»¬è¯´ï¼šå°æ±½è½¦è£…è£…æ»¡ï¼Œè½¬å¼¯é€åˆ°å±±æ´é‡Œï¼Œæ»‘æ»‘æ¢¯æ»‘åˆ°è‚šå­é‡Œï¼Œå› ä¸ºå¾ˆå¤šå®å®å‹ºå­ä¸å¯¹ç€å˜´å·´ï¼Œæ‰€ä»¥é¥­å®å®æ‰åœ¨æ¡Œå­ä¸Šéƒ½å“­äº†ã€‚</span><br><span class="line"></span><br><span class="line">å¦å¤–ï¼Œä»Šå¤©æˆ‘ä»¬ç»ƒä¹ äº†å®å®ä»¬æ’é˜Ÿèµ°æ¥¼æ¢¯ï¼Œå¤§å¤šæ•°å·²ç»åƒæ¨¡åƒæ ·çš„äº†ï¼Œä¸Šä¸‹æ¥¼æ¢¯é å³èµ°äº†ï¼Œä»Šå¤©çš„è¿åŠ¨é‡æœ‰ç‚¹å¤§ï¼Œæ‰€ä»¥ä¼°è®¡å®è´ä»¬ä»Šæ™šåˆè¦æ—©æ—©ç¡è§‰äº†.</span><br></pre></td></tr></table></figure><p>ä»Šå¤©å¼€å§‹æˆ‘ä»¬è®©å®å®ä»¬å¼€å§‹æ¼±å£äº†ï¼Œæ‰€ä»¥å›å®¶ä¹Ÿè¦ç»§ç»­ä¿æŒè¿™ä¸ªå¥½ä¹ æƒ¯å“¦ï½</p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E5%BC%80%E5%A7%8B%E6%BC%B1%E5%8F%A3%E4%BA%86/01.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦ï¼šä»Šå¤©å¼€å§‹æˆ‘ä»¬è®©å®å®ä»¬å¼€å§‹æ¼±å£äº†ï¼Œæ‰€ä»¥å›å®¶ä¹Ÿè¦ç»§ç»­ä¿æŒè¿™ä¸ªå¥½ä¹ æƒ¯å“¦ï½&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¾€æ˜”è¿½å¿†" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/"/>
    
      <category term="å°äºŒç­" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/%E5%B0%8F%E4%BA%8C%E7%8F%AD/"/>
    
    
      <category term="å®å®æˆé•¿" scheme="http://www.toberoot.com/tags/%E5%AE%9D%E5%AE%9D%E6%88%90%E9%95%BF/"/>
    
  </entry>
  
  <entry>
    <title>å®¶é•¿ä¼š</title>
    <link href="http://www.toberoot.com/2018/09/19/amy_life/%E5%AE%B6%E9%95%BF%E4%BC%9A/"/>
    <id>http://www.toberoot.com/2018/09/19/amy_life/%E5%AE%B6%E9%95%BF%E4%BC%9A/</id>
    <published>2018-09-19T11:40:55.000Z</published>
    <updated>2020-03-22T08:31:38.466Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦ï¼šå¹¼å„¿å›­å¼€å­¦ç¬¬10å¤©ï¼Œå®å®ä»¬é€æ¸ç¨³å®šï¼Œèå…¥è¿™ä¸ªå¤§å®¶åº­ï¼Œä»Šå¤©è€å¸ˆå’Œæˆ‘ä»¬åˆ†äº«å®å®ä»¬çš„å¹¼å„¿å›­æ—¥å¸¸ç”Ÿæ´»ï¼Œä»¥åŠæˆ‘ä»¬å¯¹æˆ‘ä»¬å®¶é•¿çš„ä¸€äº›å»ºè®®ï¼Œéå¸¸åœ°ç”¨å¿ƒã€‚</p><a id="more"></a><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/001.jpg" alt=""></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/002.jpg" alt="002"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/003.jpg" alt="003"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/004.jpg" alt="004"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/005.jpg" alt="005"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/006.jpg" alt="006"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/007.jpg" alt="007"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/008.jpg" alt="008"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/010.jpg" alt="010"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/011.jpg" alt="011"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/012.jpg" alt="012"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/013.jpg" alt="013"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/014.jpg" alt="014"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/015.jpg" alt="015"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/016.jpg" alt="016"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/017.jpg" alt="017"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/018.jpg" alt="018"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/019.jpg" alt="019"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/020.jpg" alt="020"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/021.jpg" alt="021"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/022.jpg" alt="022"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/023.jpg" alt="023"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/024.jpg" alt="024"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/025.jpg" alt="025"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/026.jpg" alt="026"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/027.jpg" alt="027"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/028.jpg" alt="028"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/029.jpg" alt="029"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/030.jpg" alt="030"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦ï¼šå¹¼å„¿å›­å¼€å­¦ç¬¬10å¤©ï¼Œå®å®ä»¬é€æ¸ç¨³å®šï¼Œèå…¥è¿™ä¸ªå¤§å®¶åº­ï¼Œä»Šå¤©è€å¸ˆå’Œæˆ‘ä»¬åˆ†äº«å®å®ä»¬çš„å¹¼å„¿å›­æ—¥å¸¸ç”Ÿæ´»ï¼Œä»¥åŠæˆ‘ä»¬å¯¹æˆ‘ä»¬å®¶é•¿çš„ä¸€äº›å»ºè®®ï¼Œéå¸¸åœ°ç”¨å¿ƒã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¾€æ˜”è¿½å¿†" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/"/>
    
      <category term="å°äºŒç­" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/%E5%B0%8F%E4%BA%8C%E7%8F%AD/"/>
    
    
      <category term="å®å®æˆé•¿" scheme="http://www.toberoot.com/tags/%E5%AE%9D%E5%AE%9D%E6%88%90%E9%95%BF/"/>
    
  </entry>
  
  <entry>
    <title>å‘æœˆäº®è¯´æ™šå®‰</title>
    <link href="http://www.toberoot.com/2018/09/10/amy_life/%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/"/>
    <id>http://www.toberoot.com/2018/09/10/amy_life/%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/</id>
    <published>2018-09-10T11:26:39.000Z</published>
    <updated>2020-03-22T08:31:38.463Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦ï¼šä»Šå¤©ä¸­åˆè®²äº†ä¸€ä¸ªå…³äºã€Œæ™šå®‰ï¼Œæœˆäº®ã€çš„ç¡å‰æ•…äº‹ï¼Œæœ€åçŒ«å¤´é¹°å¯¹æœˆäº®è¯´äº†æ™šå®‰ï¼Œå¤§å®¶ä»Šå¤©ç¡å‰è¿˜å¯ä»¥å’Œå®å®è¯´å“¦ï¼Œå†åŠ ä¸€äº›å…¶ä»–çš„åŠ¨ç‰©å®å®</p><a id="more"></a><p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/01.jpg" alt=""></p><p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/02.jpg" alt="02"></p><p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/03.jpg" alt="03"></p><p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/04.jpg" alt="04"></p><p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/05.jpg" alt="05"></p><p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/06.jpg" alt="06"></p><p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/07.jpg" alt="07"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦ï¼šä»Šå¤©ä¸­åˆè®²äº†ä¸€ä¸ªå…³äºã€Œæ™šå®‰ï¼Œæœˆäº®ã€çš„ç¡å‰æ•…äº‹ï¼Œæœ€åçŒ«å¤´é¹°å¯¹æœˆäº®è¯´äº†æ™šå®‰ï¼Œå¤§å®¶ä»Šå¤©ç¡å‰è¿˜å¯ä»¥å’Œå®å®è¯´å“¦ï¼Œå†åŠ ä¸€äº›å…¶ä»–çš„åŠ¨ç‰©å®å®&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¾€æ˜”è¿½å¿†" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/"/>
    
      <category term="å°äºŒç­" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/%E5%B0%8F%E4%BA%8C%E7%8F%AD/"/>
    
    
      <category term="å®å®æˆé•¿" scheme="http://www.toberoot.com/tags/%E5%AE%9D%E5%AE%9D%E6%88%90%E9%95%BF/"/>
    
  </entry>
  
  <entry>
    <title>çªç ´é˜¿é‡Œé™åˆ¶å®ç°&quot;RDS For MySQL 5.7åˆ°è‡ªå»ºMySQLä¸»ä»&quot;</title>
    <link href="http://www.toberoot.com/2018/08/22/booboo_others/rds-for-mysql-5-7%E5%88%B0%E8%87%AA%E5%BB%BAMySQL%E4%B8%BB%E4%BB%8E%E4%B9%8B%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3user%E8%A1%A8%E5%AE%9E%E7%8E%B0%E4%BB%8E%E5%BA%93%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E6%9B%B4%E6%94%B9%E5%8A%9F%E8%83%BD/"/>
    <id>http://www.toberoot.com/2018/08/22/booboo_others/rds-for-mysql-5-7%E5%88%B0%E8%87%AA%E5%BB%BAMySQL%E4%B8%BB%E4%BB%8E%E4%B9%8B%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3user%E8%A1%A8%E5%AE%9E%E7%8E%B0%E4%BB%8E%E5%BA%93%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E6%9B%B4%E6%94%B9%E5%8A%9F%E8%83%BD/</id>
    <published>2018-08-22T10:41:15.000Z</published>
    <updated>2020-03-22T08:32:42.581Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: é˜¿é‡Œäº‘çš„RDS For MySQL 5.7 åˆ°çº¿ä¸‹IDCæœºæˆ¿çš„ä¸»ä»æ­å»ºç›¸ä¿¡çœ‹å®˜æ–¹æ–‡æ¡£å°±å¯ä»¥å®Œæˆï¼Œä½†æ˜¯æ­å»ºä¹‹åå´å‘ç°æ— æ³•åœ¨æœ¬åœ°è¿›è¡Œè®¤è¯æƒé™çš„ç®¡ç†ï¼Œè¿™æ˜¯ä¸ºä½•ï¼Ÿè€Œé˜¿é‡Œå®˜æ–¹æ¨èä½¿ç”¨DTSåŒæ­¥å·¥å…·å»å®ç°ï¼Œè¿™ä¸ªè´¹ç”¨ç€å®ä¸å°‘ï¼Œåˆæ˜¯å¦èƒ½å¤Ÿç ´è§£å‘¢ï¼Ÿæœ¬æ–‡è¯¦è§£å¦‚ä½•æš´åŠ›ç ´è§£userè¡¨å®ç°ä»åº“ç”¨æˆ·æƒé™æ›´æ”¹åŠŸèƒ½</p><a id="more"></a><h1 id="æ•…äº‹èƒŒæ™¯"><a href="#æ•…äº‹èƒŒæ™¯" class="headerlink" title="æ•…äº‹èƒŒæ™¯"></a>æ•…äº‹èƒŒæ™¯</h1><h2 id="æ•°æ®åº“æ˜ç»†"><a href="#æ•°æ®åº“æ˜ç»†" class="headerlink" title="æ•°æ®åº“æ˜ç»†"></a>æ•°æ®åº“æ˜ç»†</h2><p>è¯´åœ¨å‰é¢ï¼š</p><ul><li>äº‘ä¸Šæ•°æ®åº“ï¼š RDS For MySQL 5.7.20 æ™®é€šç”¨æˆ·æƒé™</li><li>IDCæ•°æ®åº“: MySQL 5.7.20 </li></ul><h2 id="æ•…äº‹æƒ…èŠ‚"><a href="#æ•…äº‹æƒ…èŠ‚" class="headerlink" title="æ•…äº‹æƒ…èŠ‚"></a>æ•…äº‹æƒ…èŠ‚</h2><p>ç°éœ€è¦æ­å»ºRDS For MySQL åˆ°çº¿ä¸‹IDCæœºæˆ¿çš„ä¸»ä»ï¼Œé—®é¢˜å¦‚ä¸‹ï¼š</p><h3 id="åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥"><a href="#åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥" class="headerlink" title="åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥"></a>åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥</h3><h4 id="æ•…éšœåŸå› "><a href="#æ•…éšœåŸå› " class="headerlink" title="æ•…éšœåŸå› "></a>æ•…éšœåŸå› </h4><ul><li>RDS For MySQL 5.7.20 åˆ°è‡ªå»ºMySQL 5.7.20ä¸»ä»åŒæ­¥å¼‚å¸¸çš„åŸå› ä¸ºRDSä¸MySQLå®˜æ–¹ç‰ˆæœ¬ä½¿ç”¨çš„ç³»ç»Ÿåº“ä¸åŒ</li><li>è‡ªå»ºMySQL 5.7.20 æ— æ³•åŒæ­¥ä¸»åº“RDSçš„ç³»ç»Ÿè¡¨</li><li>è‡ªå»ºMySQL 5.7.20 æ¢å¤RDSçš„å…¨å¤‡ä»½æ•°æ®åæ— æ³•æ‰§è¡Œæˆæƒè¯­å¥,æŠ¥é”™å¦‚ä¸‹ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1785 (HY000): Statement violates GTID consistency: Updates to non-transactional tables can only be done in either autocommitted statements or single-statement transactions, and never in the same statement as updates to transactional tables.</span><br></pre></td></tr></table></figure><ul><li>è‡ªå»ºMySQL 5.7.20 æ¢å¤RDSçš„å…¨å¤‡ä»½æ•°æ®åæ— æ³•å¯¹ç³»ç»Ÿè¡¨æ‰§è¡Œæ›´æ–°æ“ä½œï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1064 (42000): Unknown trigger has an error in its body: 'Unknown system variable 'maintain_user_list''</span><br></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h4><ul><li>è·³è¿‡ç³»ç»Ÿè¡¨çš„åŒæ­¥</li></ul><hr><h3 id="ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥"><a href="#ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥" class="headerlink" title="ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥"></a>ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥</h3><p>RDS For MySQL 5.7.20 åˆ°è‡ªå»ºMySQL 5.7.20 æ­å»ºä¸»ä»åŒæ­¥æ¶æ„:</p><ul><li>é…ç½®ä»åº“ä¸åŒæ­¥RDSä¸»åº“çš„ç³»ç»Ÿè¡¨</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># skip rep</span><br><span class="line">replicate_wild_ignore_table&#x3D;mysql.%</span><br><span class="line">replicate_wild_ignore_table&#x3D;sys.%</span><br><span class="line">replicate_wild_ignore_table&#x3D;information_schema.%</span><br></pre></td></tr></table></figure><ul><li><strong>éç³»ç»Ÿåº“æ•°æ®åŒæ­¥æ­£å¸¸</strong></li><li>ä»åº“æ— æ³•æ‰§è¡Œgrantå‘½ä»¤ï¼Œå³æ— æ³•æ·»åŠ æˆæƒä¿¡æ¯</li><li>ä»åº“æ— æ³•å¯¹ç³»ç»Ÿè¡¨mysql.userè¡¨æ‰§è¡Œinsertæ“ä½œ</li><li>ä»åº“æ— æ³•å¯¹ç³»ç»Ÿè¡¨mysql.userè¡¨æ‰§è¡Œupdatæ“ä½œ</li></ul><p>æŠ¥é”™å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1064 (42000): Unknown trigger has an error in its body: 'Unknown system variable 'maintain_user_list''</span><br></pre></td></tr></table></figure><h4 id="å¤±è´¥åŸå› "><a href="#å¤±è´¥åŸå› " class="headerlink" title="å¤±è´¥åŸå› "></a>å¤±è´¥åŸå› </h4><p><strong>é˜¿é‡Œå·¥å•ç­”å¤</strong>ï¼šRDS ç›®å‰å·²ç»ä¸æ”¯æŒ MYISAM å¼•æ“åˆ›å»ºäº†ã€‚æ‰€ä»¥å¦‚æœæ˜¯é€šè¿‡è‡ªå»ºçš„replication åŒæ­¥ å°±ä¼šæœ‰è¿™ä¸ªé—®é¢˜çš„ï¼ŒRDS ç»Ÿä¸€INNOB å¼•æ“ã€‚<br>å¦‚æœéœ€æ±‚æ˜¯ä»RDS åˆ°è‡ªå»ºæ•°æ®åº“çš„åŒæ­¥å…³ç³»ï¼Œå»ºè®®æ‚¨ä½¿ç”¨DTS åšä¸šåŠ¡æ•°æ®çš„åŒæ­¥ã€‚</p><h4 id="æ¢ç´¢è§£å†³æ–¹æ³•"><a href="#æ¢ç´¢è§£å†³æ–¹æ³•" class="headerlink" title="æ¢ç´¢è§£å†³æ–¹æ³•"></a>æ¢ç´¢è§£å†³æ–¹æ³•</h4><h5 id="ä»åº“å°è¯•ä½¿ç”¨MySQL8-0-11"><a href="#ä»åº“å°è¯•ä½¿ç”¨MySQL8-0-11" class="headerlink" title="ä»åº“å°è¯•ä½¿ç”¨MySQL8.0.11"></a>ä»åº“å°è¯•ä½¿ç”¨<code>MySQL8.0.11</code></h5><p>RDS For MySQL 5.7çš„å¤‡ä»½æ–‡ä»¶ åˆ°çº¿ä¸‹è‡ªå»ºMYSQL 8.0.11 æ— æ³•æ¢å¤æ•°æ®ã€‚å› æ­¤è¯¥æ–¹æ³•ä¸å¯è¡Œã€‚</p><h5 id="å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼"><a href="#å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼" class="headerlink" title="å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼"></a>å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼</h5><ol><li>ä¸´æ—¶åœæ­¢slaveåŒæ­¥</li><li>ä¿®æ”¹é…ç½®å…³é—­gtidæ¨¡å¼</li><li>é‡å¯æœåŠ¡</li></ol><p>å¯¹ç³»ç»Ÿè¡¨mysql.useræµ‹è¯•æ˜ç»†ï¼š</p><table><thead><tr><th>No.</th><th>æµ‹è¯•é¡¹ç›®</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>1</td><td>æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œgrantå‘½ä»¤</td><td>Ã—</td></tr><tr><td>2</td><td>æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œupdateå‘½ä»¤</td><td>Ã—</td></tr><tr><td>3</td><td>æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œinsertå‘½ä»¤</td><td>Ã—</td></tr></tbody></table><p>è¯¥æ–¹æ³•åŒæ ·æ— æ³•è§£å†³ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æƒé™ç›¸å…³çš„ä¸€äº›è¡¨ï¼š</span></span><br><span class="line">SCHEMA_PRIVILEGESï¼šæä¾›äº†æ•°æ®åº“çš„ç›¸å…³æƒé™ï¼Œè¿™ä¸ªè¡¨æ˜¯å†…å­˜è¡¨æ˜¯ä»mysql.dbä¸­æ‹‰å»å‡ºæ¥çš„ã€‚</span><br><span class="line">TABLE_PRIVILEGES:æä¾›çš„æ˜¯è¡¨æƒé™ç›¸å…³ä¿¡æ¯ï¼Œä¿¡æ¯æ˜¯ä» mysql.tables_priv è¡¨ä¸­åŠ è½½çš„</span><br><span class="line">COLUMN_PRIVILEGES ï¼šè¿™ä¸ªè¡¨å¯ä»¥æ¸…æ¥šå°±èƒ½çœ‹åˆ°è¡¨æˆæƒçš„ç”¨æˆ·çš„å¯¹è±¡ï¼Œé‚£å¼ è¡¨é‚£ä¸ªåº“ä»¥åŠæˆäºˆçš„æ˜¯ä»€ä¹ˆæƒé™ï¼Œå¦‚æœæˆæƒçš„æ—¶å€™åŠ ä¸Šwith grant optionçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å¾—åˆ°PRIVILEGE_TYPEè¿™ä¸ªå€¼å¿…é¡»æ˜¯YESã€‚</span><br><span class="line">USER_PRIVILEGES:æä¾›çš„æ˜¯è¡¨æƒé™ç›¸å…³ä¿¡æ¯ï¼Œä¿¡æ¯æ˜¯ä» mysql.user è¡¨ä¸­åŠ è½½çš„</span><br><span class="line">é€šè¿‡è¡¨æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ™°çœ‹å¾—åˆ°MySQLæˆæƒçš„å±‚æ¬¡ï¼ŒSCHEMAï¼ŒTABLEï¼ŒCOLUMNçº§åˆ«ï¼Œå½“ç„¶è¿™äº›éƒ½æ˜¯åŸºäºç”¨æˆ·æ¥æˆäºˆçš„</span><br></pre></td></tr></table></figure><p>ä»æ•°æ®åº“ç”¨æˆ·æƒé™ç®¡ç†çš„åŸç†å¯ä»¥äº†è§£åˆ°ç®¡ç†ç”¨æˆ·çš„æ˜¯<code>user</code>è¡¨ï¼Œå¦‚æœè¦æ›´ç»†è‡´çš„æƒé™è¿˜éœ€è¦<code>db</code>è¡¨å’Œ<code>tables_priv</code>è¡¨ã€‚<em>ï¼ˆæœ¬æ–‡åªä»userè¡¨ç€æ‰‹ï¼‰</em></p><h3 id="æ­¥éª¤æ¦‚è§ˆ"><a href="#æ­¥éª¤æ¦‚è§ˆ" class="headerlink" title="æ­¥éª¤æ¦‚è§ˆ"></a>æ­¥éª¤æ¦‚è§ˆ</h3><ol><li>åˆ›å»ºæ–°çš„user_1è¡¨</li><li>å¯¹user_1è¡¨æ·»åŠ æ–°çš„ç”¨æˆ·</li><li>åœæœåŠ¡</li><li>å°†user_1æ›¿æ¢userè¡¨</li><li>å¯åŠ¨è¯¥æœåŠ¡</li><li>å¯ä»¥é€šè¿‡updateã€insertã€deleteæ“ä½œuserè¡¨æ¥æ·»åŠ æƒé™ï¼ˆgrantæ— æ³•æ“ä½œï¼‰</li></ol><h3 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">root@MySQL-01 10:35:  [mysql]&gt; create table user_1 like user;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; select * from user_1;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; show table status like user;</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'user' at line 1</span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; show table status like 'user_1';</span><br><span class="line">+--------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| Name   | Engine | Version | Row_format | Rows | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time         | Check_time | Collation | Checksum | Create_options | Comment                     |</span><br><span class="line">+--------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| user_1 | MyISAM |      10 | Dynamic    |    0 |              0 |           0 | 281474976710655 |         1024 |         0 |           NULL | 2019-01-04 10:36:00 | 2019-01-04 10:36:00 | NULL       | utf8_bin  |     NULL |                | Users and global privileges |</span><br><span class="line">+--------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; show table status like 'user';</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+---------------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| Name | Engine | Version | Row_format | Rows | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time         | Check_time          | Collation | Checksum | Create_options | Comment                     |</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+---------------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| user | MyISAM |      10 | Dynamic    |    3 |             53 |         160 | 281474976710655 |         2048 |         0 |           NULL | 2015-05-22 15:24:42 | 2019-01-04 09:27:49 | 2015-05-22 15:33:22 | utf8_bin  |     NULL |                | Users and global privileges |</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+---------------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; insert into user_1 select * from user;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; select * from user_1;</span><br><span class="line">+-----------+------+----------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+--------+-----------------------+</span><br><span class="line">| Host      | User | Password | Select_priv | Insert_priv | Update_priv | Delete_priv | Create_priv | Drop_priv | Reload_priv | Shutdown_priv | Process_priv | File_priv | Grant_priv | References_priv | Index_priv | Alter_priv | Show_db_priv | Super_priv | Create_tmp_table_priv | Lock_tables_priv | Execute_priv | Repl_slave_priv | Repl_client_priv | Create_view_priv | Show_view_priv | Create_routine_priv | Alter_routine_priv | Create_user_priv | Event_priv | Trigger_priv | Create_tablespace_priv | ssl_type | ssl_cipher | x509_issuer | x509_subject | max_questions | max_updates | max_connections | max_user_connections | plugin | authentication_string |</span><br><span class="line">+-----------+------+----------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+--------+-----------------------+</span><br><span class="line">| localhost | root |          | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          |            |             |              |             0 |           0 |               0 |                    0 |        |                       |</span><br><span class="line">| 127.0.0.1 | root |          | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          |            |             |              |             0 |           0 |               0 |                    0 |        |                       |</span><br><span class="line">| ::1       | root |          | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          |            |             |              |             0 |           0 |               0 |                    0 |        |                       |</span><br><span class="line">+-----------+------+----------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+--------+-----------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; select user,host,authentication_string from user_1;</span><br><span class="line">+------+-----------+-----------------------+</span><br><span class="line">| user | host      | authentication_string |</span><br><span class="line">+------+-----------+-----------------------+</span><br><span class="line">| root | localhost |                       |</span><br><span class="line">| root | 127.0.0.1 |                       |</span><br><span class="line">| root | ::1       |                       |</span><br><span class="line">+------+-----------+-----------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; update user_1 set authentication_string=password('(Uploo00king)') where user='root';</span><br><span class="line">Query OK, 3 rows affected, 1 warning (0.01 sec)</span><br><span class="line">Rows matched: 3  Changed: 3  Warnings: 1</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:37:  [mysql]&gt; select user,host,authentication_string from user_1;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:37:  [mysql]&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@sh_02 data]# /etc/init.d/mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@sh_02 mysql]# ll user_1*</span><br><span class="line">-rw-r-----. 1 mysql mysql 10630 Jan  4 10:36 user_1.frm</span><br><span class="line">-rw-r-----. 1 mysql mysql   328 Jan  4 10:37 user_1.MYD</span><br><span class="line">-rw-r-----. 1 mysql mysql  2048 Jan  4 10:37 user_1.MYI</span><br><span class="line">[root@sh_02 mysql]# mv user_1.frm user.frm</span><br><span class="line">[root@sh_02 mysql]# mv user_1.MYD user.MYD</span><br><span class="line">[root@sh_02 mysql]# mv user_1.MYI user.MYI</span><br><span class="line">[root@sh_02 mysql]# ll user*</span><br><span class="line">-rw-r-----. 1 mysql mysql 10630 Jan  4 10:36 user.frm</span><br><span class="line">-rw-r-----. 1 mysql mysql   328 Jan  4 10:37 user.MYD</span><br><span class="line">-rw-r-----. 1 mysql mysql  2048 Jan  4 10:37 user.MYI</span><br><span class="line">-rw-rw----. 1 mysql mysql  3989 Aug 14 09:14 user_view.frm</span><br><span class="line">[root@sh_02 mysql]# /etc/init.d/mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@sh_02 mysql]# mysql -uroot -p'(Uploo00king)'</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 6</span><br><span class="line">Server version: 5.7.20-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:39:  [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| db1                |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:39:  [(none)]&gt; use mysql</span><br><span class="line">Database changed</span><br><span class="line">root@MySQL-01 10:39:  [mysql]&gt; select user,host from mysql.user;</span><br><span class="line">+------+-----------+</span><br><span class="line">| user | host      |</span><br><span class="line">+------+-----------+</span><br><span class="line">| root | 127.0.0.1 |</span><br><span class="line">| root | ::1       |</span><br><span class="line">| root | localhost |</span><br><span class="line">+------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:39:  [mysql]&gt; grant all on *.* to booboo@'%' identified by '(Uploo00king)';</span><br><span class="line">ERROR 1785 (HY000): Statement violates GTID consistency: Updates to non-transactional tables can only be done in either autocommitted statements or single-statement transactions, and never in the same statement as updates to transactional tables.</span><br><span class="line"></span><br><span class="line">root@MySQL-01 11:39:  [mysql]&gt; update mysql.user_1 set user='aliyun_root' where host='127.0.0.1';</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">root@MySQL-01 11:40:  [mysql]&gt; select user,host from mysql.user_1;</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| user        | host      |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| aliyun_root | 127.0.0.1 |</span><br><span class="line">| root        | ::1       |</span><br><span class="line">| root        | localhost |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">aliyun_root@MySQL-01 11:51:  [mysql]&gt; insert into mysql.user values ('%','jowing', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('Joowing@2017'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">aliyun_root@MySQL-01 11:51:  [mysql]&gt; select user,host from  mysql.user;</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| user        | host      |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| jowing      | %         |</span><br><span class="line">| aliyun_root | 127.0.0.1 |</span><br><span class="line">| root        | ::1       |</span><br><span class="line">| root        | localhost |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿäº§ç¯å¢ƒ"><a href="#ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒ"></a>ç”Ÿäº§ç¯å¢ƒ</h3><h4 id="ç”¨æˆ·æƒé™"><a href="#ç”¨æˆ·æƒé™" class="headerlink" title="ç”¨æˆ·æƒé™"></a>ç”¨æˆ·æƒé™</h4><p>ç›®æ ‡ï¼šIDCæœºæˆ¿ä»åº“æ”¯æŒé€šè¿‡insertã€updateã€deleteå‘½ä»¤æ¥ä¿®æ”¹ç”¨æˆ·æƒé™ï¼Œæƒé™æ¯”è¾ƒç®€å•ï¼Œåˆ†ä¸ºåªè¯»å’Œå†™ã€‚</p><p>éœ€è¦è®¾ç½®ä»¥ä¸‹æƒé™ï¼šæƒé™ä½œç”¨äºæ‰€æœ‰çš„åº“å¤šæœ‰çš„è¡¨</p><table><thead><tr><th align="left">ç”¨æˆ·å</th><th align="left">å¯†ç </th><th align="left">æƒé™</th></tr></thead><tbody><tr><td align="left">root</td><td align="left">123</td><td align="left">è¯»å†™</td></tr><tr><td align="left">joowingbuz</td><td align="left">123</td><td align="left">åªè¯»</td></tr><tr><td align="left">ottersync</td><td align="left">123</td><td align="left">åªè¯»</td></tr><tr><td align="left">syncdw</td><td align="left">123</td><td align="left">åªè¯»</td></tr><tr><td align="left">datasis</td><td align="left">123</td><td align="left">åªè¯»</td></tr><tr><td align="left">joowingv</td><td align="left">123</td><td align="left">åªè¯»</td></tr><tr><td align="left">datadev</td><td align="left">123</td><td align="left">åªè¯»</td></tr><tr><td align="left">readonly</td><td align="left">123</td><td align="left">åªè¯»</td></tr></tbody></table><h4 id="æ­¥éª¤æ¦‚è§ˆ-1"><a href="#æ­¥éª¤æ¦‚è§ˆ-1" class="headerlink" title="æ­¥éª¤æ¦‚è§ˆ"></a>æ­¥éª¤æ¦‚è§ˆ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. ç™»é™†æ•°æ®åº“åæ“ä½œå¦‚ä¸‹ï¼š</span></span><br><span class="line">use mysql;</span><br><span class="line">create table user_1 like user;</span><br><span class="line">insert into user_1 select * from user;</span><br><span class="line">delete from mysql.user_1 where user='root';</span><br><span class="line">insert into mysql.user_1 values ('%','root', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','joowingbuz', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','ottersync', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','syncdw', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','datasis', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','joowingv', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','datadev', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','readonly', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. é€€å‡ºæ•°æ®åº“å¹¶åœæ­¢æœåŠ¡</span></span><br><span class="line">/data/mysql/support-files/mysql.server stop</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. å°†user_1è¡¨çš„ç‰©ç†æ–‡ä»¶è¦†ç›–userè¡¨</span></span><br><span class="line">cd /data/xtrabackup_data/mysql/</span><br><span class="line">mv user.frm user.ibd user.MYD user.MYI user.TRG /tmp</span><br><span class="line">mv user_1.frm user.frm</span><br><span class="line">mv user_1.MYI user.MYI</span><br><span class="line">mv user_1.MYD user.MYD</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. å¯åŠ¨æ•°æ®åº“</span></span><br><span class="line">/data/mysql/support-files/mysql.server start</span><br></pre></td></tr></table></figure><h4 id="æ“ä½œæ˜ç»†"><a href="#æ“ä½œæ˜ç»†" class="headerlink" title="æ“ä½œæ˜ç»†"></a>æ“ä½œæ˜ç»†</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line">root@MySQL-01 15:42:  [(none)]&gt; use mysql</span><br><span class="line">Database changed</span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; create table user_1 like user;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; insert into user_1 select * from user;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; select user,host,authentication_string from mysql.user;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; select user,host,authentication_string from mysql.user_1;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; desc mysql.user_1;</span><br><span class="line">+------------------------+-----------------------------------+------+-----+---------+-------+</span><br><span class="line">| Field                  | Type                              | Null | Key | Default | Extra |</span><br><span class="line">+------------------------+-----------------------------------+------+-----+---------+-------+</span><br><span class="line">| Host                   | char(60)                          | NO   | PRI |         |       |</span><br><span class="line">| User                   | char(16)                          | NO   | PRI |         |       |</span><br><span class="line">| Password               | char(41)                          | NO   |     |         |       |</span><br><span class="line">| Select_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Insert_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Update_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Delete_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Drop_priv              | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Reload_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Shutdown_priv          | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Process_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| File_priv              | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Grant_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| References_priv        | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Index_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Alter_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Show_db_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Super_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_tmp_table_priv  | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Lock_tables_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Execute_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Repl_slave_priv        | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Repl_client_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_view_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Show_view_priv         | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_routine_priv    | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Alter_routine_priv     | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_user_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Event_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Trigger_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_tablespace_priv | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| ssl_type               | enum('','ANY','X509','SPECIFIED') | NO   |     |         |       |</span><br><span class="line">| ssl_cipher             | blob                              | NO   |     | NULL    |       |</span><br><span class="line">| x509_issuer            | blob                              | NO   |     | NULL    |       |</span><br><span class="line">| x509_subject           | blob                              | NO   |     | NULL    |       |</span><br><span class="line">| max_questions          | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| max_updates            | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| max_connections        | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| max_user_connections   | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| plugin                 | char(64)                          | YES  |     |         |       |</span><br><span class="line">| authentication_string  | text                              | YES  |     | NULL    |       |</span><br><span class="line">+------------------------+-----------------------------------+------+-----+---------+-------+</span><br><span class="line">42 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:47:  [mysql]&gt; delete from mysql.user_1 where user='root';</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:51:  [mysql]&gt; insert into mysql.user_1 values ('%','root', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','joowingbuz', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','ottersync', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','syncdw', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','datasis', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','joowingv', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','datadev', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','readonly', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; select user,host,authentication_string from mysql.user;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; select user,host,authentication_string from mysql.user_1;</span><br><span class="line">+------------+------+-------------------------------------------+</span><br><span class="line">| user       | host | authentication_string                     |</span><br><span class="line">+------------+------+-------------------------------------------+</span><br><span class="line">| ottersync  | %    | *9443FA914A2D69FE8832F8294E7422CC1B02A492 |</span><br><span class="line">| joowingbuz | %    | *DFFDA1CA6135E355EF468AB13A465BB5D4FE2B11 |</span><br><span class="line">| root       | %    | *89BE852E4EECFD217F0C5463FB30AD25BD0751E0 |</span><br><span class="line">| syncdw     | %    | *3DD7B4B4F6EE968FF3452B607BDEE6294B6A425A |</span><br><span class="line">| datasis    | %    | *011D511C71990F832C531A0F9CFB34CF7BB4E485 |</span><br><span class="line">| joowingv   | %    | *56B364074270DF7F6D670A6B4F5A4AD13322397A |</span><br><span class="line">| datadev    | %    | *D3D73E0F6BFC3159B024EF31484B6F9CC2963C5B |</span><br><span class="line">| readonly   | %    | *E2BA196C0C7F409990FDB3FAB5F9C7CE95F7C449 |</span><br><span class="line">+------------+------+-------------------------------------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@joowing-server-06:~# /data/mysql/support-files/mysql.server stop</span><br><span class="line">Shutting down MySQL</span><br><span class="line">...... * </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@joowing-server-06:~# cd /data/xtrabackup_data/</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data# cd mysql</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# ll user*</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ  14 15:42 user_1.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   744 8æœˆ  14 15:52 user_1.MYD</span><br><span class="line">-rw-r----- 1 mysql mysql  2048 8æœˆ  14 15:53 user_1.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ   9 20:14 user.frm</span><br><span class="line">-rw-r----- 1 mysql mysql 98304 8æœˆ   9 20:14 user.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql   328 8æœˆ   9 20:14 user.MYD</span><br><span class="line">-rw-r--r-- 1 mysql mysql  2048 8æœˆ   9 20:14 user.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql  3569 8æœˆ   9 20:14 user.TRG</span><br><span class="line">-rw-r----- 1 mysql mysql  3982 8æœˆ   9 20:14 user_view.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user.frm user.ibd user.MYD user.MYI user.TRG /data</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# ll user*</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ  14 15:42 user_1.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   744 8æœˆ  14 15:52 user_1.MYD</span><br><span class="line">-rw-r----- 1 mysql mysql  2048 8æœˆ  14 15:53 user_1.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql  3982 8æœˆ   9 20:14 user_view.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user_1.frm user.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user_1.MYI user.MYI</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user_1.MYD user.MYD</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# ll user*</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ  14 15:42 user.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   744 8æœˆ  14 15:52 user.MYD</span><br><span class="line">-rw-r----- 1 mysql mysql  2048 8æœˆ  14 15:53 user.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql  3982 8æœˆ   9 20:14 user_view.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# /data/mysql/support-files/mysql.server start</span><br><span class="line">Starting MySQL</span><br><span class="line">...... * </span><br><span class="line"></span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mysql -uroot -p'123'</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 5</span><br><span class="line">Server version: 5.7.20-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:55:  [(none)]&gt; show slave status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: rm-uf6f05k2rg95s23bp.mysql.rds.aliyuncs.com</span><br><span class="line">                  Master_User: idc_slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.001641</span><br><span class="line">          Read_Master_Log_Pos: 447207506</span><br><span class="line">               Relay_Log_File: joowing-server-06-relay-bin.000225</span><br><span class="line">                Relay_Log_Pos: 35529076</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.001641</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: mysql.%,sys.%,information_schema.%</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 447207506</span><br><span class="line">              Relay_Log_Space: 35529295</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 1095052097</span><br><span class="line">                  Master_UUID: b3e1de69-5daa-11e8-bed2-7cd30ab8a9fc</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: b3e1de69-5daa-11e8-bed2-7cd30ab8a9fc:97478646-97483368</span><br><span class="line">            Executed_Gtid_Set: b3e1de69-5daa-11e8-bed2-7cd30ab8a9fc:1-97483368,</span><br><span class="line">c39ecf19-5daa-11e8-aa9c-7cd30ac4764a:1-178658794,</span><br><span class="line">c69289d7-9bc9-11e8-b922-44a842431b62:1-12</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: </span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> éªŒè¯åªè¯»è´¦å·</span></span><br><span class="line">mysql -uroot-p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -ujoowingbuz -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -uottersync -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -usyncdw -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -udatasis -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -ujoowingv -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -udatadev -p'123' -e "create database dbzyadmin;"</span><br><span class="line">mysql -ureadonly -p'123'  -e "create database dbzyadmin;"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åªè¯»è´¦å·æ— æ³•æ‰§è¡Œå†™æ“ä½œï¼ŒéªŒè¯æˆåŠŸ</span></span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">ERROR 1044 (42000) at line 1: Access denied for user 'readonly'@'%' to database 'dbzyadmin'</span><br></pre></td></tr></table></figure><h4 id="åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—"><a href="#åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—" class="headerlink" title="åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—"></a>åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—</h4><blockquote><p>åç»­æ–°å¢ç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·ã€æ›´æ”¹å¯†ç å‘½ä»¤å¦‚ä¸‹ï¼š</p></blockquote><h5 id="æ–°å¢è¯»å†™ç”¨æˆ·"><a href="#æ–°å¢è¯»å†™ç”¨æˆ·" class="headerlink" title="æ–°å¢è¯»å†™ç”¨æˆ·"></a>æ–°å¢è¯»å†™ç”¨æˆ·</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into mysql.user_1 values ('%','ã€ç”¨æˆ·åã€‘', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('ã€å¯†ç ã€‘'));</span><br></pre></td></tr></table></figure><h5 id="æ–°å¢åªè¯»ç”¨æˆ·"><a href="#æ–°å¢åªè¯»ç”¨æˆ·" class="headerlink" title="æ–°å¢åªè¯»ç”¨æˆ·"></a>æ–°å¢åªè¯»ç”¨æˆ·</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into mysql.user_1 values ('%','ã€ç”¨æˆ·åã€‘', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('ã€å¯†ç ã€‘'));</span><br></pre></td></tr></table></figure><h5 id="åˆ é™¤ç”¨æˆ·å‘½ä»¤"><a href="#åˆ é™¤ç”¨æˆ·å‘½ä»¤" class="headerlink" title="åˆ é™¤ç”¨æˆ·å‘½ä»¤"></a>åˆ é™¤ç”¨æˆ·å‘½ä»¤</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from mysql.user where user='ã€ç”¨æˆ·åã€‘';</span><br></pre></td></tr></table></figure><h5 id="ä¿®æ”¹å¯†ç "><a href="#ä¿®æ”¹å¯†ç " class="headerlink" title="ä¿®æ”¹å¯†ç "></a>ä¿®æ”¹å¯†ç </h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update mysql.user set authentication_string=password('ã€å¯†ç ã€‘') where user='ã€ç”¨æˆ·åã€‘';</span><br></pre></td></tr></table></figure><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>RDSç›®å‰ä½¿ç”¨MySQLç‰ˆæœ¬å’Œå®˜æ–¹åœ¨ç³»ç»Ÿåº“ä¸Šå·®å¼‚è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œè‹¥éœ€è¦æ­å»ºRDSåˆ°çº¿ä¸‹è‡ªå»ºMySQL5.7çš„ä¸»ä»æ—¶ï¼Œå¯ä»¥é€šè¿‡æ­¤æ³•å»å®ç°ã€‚</p><p>æœ¬æ–‡ä¸­å¯¹userè¡¨çš„ç ´è§£ï¼ŒåŒæ ·é€‚é€‚ç”¨äº<code>mysql.db</code> ã€<code>mysql.tables_priv</code>è¡¨ï¼Œéƒ½ç ´è§£åˆ™å¯ä»¥å°†æƒé™ä»ç”¨æˆ·æ‹“å±•åˆ°åº“è¡¨åˆ—ã€‚è¯»è€…å¯è‡ªè¡Œå®éªŒæµ‹è¯•ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦: é˜¿é‡Œäº‘çš„RDS For MySQL 5.7 åˆ°çº¿ä¸‹IDCæœºæˆ¿çš„ä¸»ä»æ­å»ºç›¸ä¿¡çœ‹å®˜æ–¹æ–‡æ¡£å°±å¯ä»¥å®Œæˆï¼Œä½†æ˜¯æ­å»ºä¹‹åå´å‘ç°æ— æ³•åœ¨æœ¬åœ°è¿›è¡Œè®¤è¯æƒé™çš„ç®¡ç†ï¼Œè¿™æ˜¯ä¸ºä½•ï¼Ÿè€Œé˜¿é‡Œå®˜æ–¹æ¨èä½¿ç”¨DTSåŒæ­¥å·¥å…·å»å®ç°ï¼Œè¿™ä¸ªè´¹ç”¨ç€å®ä¸å°‘ï¼Œåˆæ˜¯å¦èƒ½å¤Ÿç ´è§£å‘¢ï¼Ÿæœ¬æ–‡è¯¦è§£å¦‚ä½•æš´åŠ›ç ´è§£userè¡¨å®ç°ä»åº“ç”¨æˆ·æƒé™æ›´æ”¹åŠŸèƒ½&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯å¹¿è§’" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="RDS" scheme="http://www.toberoot.com/tags/RDS/"/>
    
      <category term="ä¸»ä»åŒæ­¥" scheme="http://www.toberoot.com/tags/%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨splitå·¥å…·è§£å†³ä¸€æ¬¡MongoDBæ—¥å¿—å¼‚å¸¸é—®é¢˜</title>
    <link href="http://www.toberoot.com/2018/08/03/booboo_others/%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/"/>
    <id>http://www.toberoot.com/2018/08/03/booboo_others/%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/</id>
    <published>2018-08-03T12:25:24.000Z</published>
    <updated>2020-03-22T08:32:42.584Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦ï¼š </p><ul><li>æŸå¤©æ™šä¸Šåˆšåˆ°å®¶ä¸ä¹…ï¼Œå°±æ¥åˆ°æ­å·åŒäº‹çš„ç”µè¯ï¼Œå®¢æˆ·MongoDBé›†ç¾¤ä¸­çš„æŸä¸ªåˆ†ç‰‡èŠ‚ç‚¹CPUé£™é«˜ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯æ…¢æŸ¥è¯¢ï¼Œç°åœ¨éœ€è¦æ‹‰å–CPUé£™é«˜æ—¶é—´æ®µçš„æ…¢æŸ¥è¯¢ã€‚å¿ƒæƒ³æ‹‰å–æ…¢æŸ¥è¯¢åº”è¯¥å¾ˆå¿«ï¼Œä¸å°±æ˜¯ä¸ªç³»ç»Ÿæ—¥å¿—å—ï¼Ÿè€Œä¸”è¿˜åšäº†æ—¥å¿—åˆ‡å‰²ä¸€å¤©ä¸€ä¸ªï¼ŒæŒ‰é“ç†å¾ˆå¿«æå®šçš„ï¼Œè°çŸ¥å½“å¤©æ™šä¸Šæäº†æ¥è¿‘ä¸‰ä¸ªå°æ—¶ä¹Ÿæ²¡æå®šã€‚ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</li><li>è¿›å…¥åˆ°æ—¥å¿—ç›®å½•ä¸€çœ‹ï¼Œç›®å‰ä¿ç•™è¿‘7å¤©çš„æ—¥å¿—ï¼Œæ¯å¤©çš„æ—¥å¿—é‡åœ¨23G~24Gï¼Œæˆ‘å½“æ—¶å°±æƒ³è¿™ä¸ªå®¢æˆ·æ•°æ®é‡è¿™ä¹ˆå¤§ï¼åç»­å‘ç°æ—¥å¿—æ ¼å¼æœ¬è¯¥ä¸ºæ™®é€šæ–‡æœ¬æ–‡ä»¶ç¡®å˜æˆäº†å›¾ç‰‡æ ¼å¼ï¼Œç©¶ç«Ÿä¸ºä½•ä¼šæ–‡ä»¶æ ¼å¼ä¼šè½¬å˜ï¼Ÿèƒ½å¦ä»å›¾ç‰‡æ ¼å¼ä¸­æ‹‰å–æŒ‡å®šæ—¶é—´æ®µçš„æ—¥å¿—å‘¢ï¼Ÿ</li><li>ç¬¬äºŒå¤©åˆ°å…¬å¸ï¼Œç”±äºå®¢æˆ·ç¯å¢ƒæˆ‘ä»¬ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥æ‰‹ï¼Œå› æ­¤å’±ä»¬æŠ€æœ¯ä¸“å®¶å›¢é˜Ÿæäº†ä¸€ä¸ª3äººçš„â€ä¸“å®¶ä¼šè¯Šâ€ï¼Œç»è¿‡äº†ä¸€ç•ªæŠ˜è…¾æ€»ç®—æŠŠåŸå› æ‰¾åˆ°äº†ï¼Œå…·ä½“è¿‡ç¨‹è¯·çœ‹ä¸‹æ–‡ï¼</li></ul><a id="more"></a><h2 id="æ•…äº‹èƒŒæ™¯"><a href="#æ•…äº‹èƒŒæ™¯" class="headerlink" title="æ•…äº‹èƒŒæ™¯"></a>æ•…äº‹èƒŒæ™¯</h2><h3 id="æ•°æ®åº“æ˜ç»†"><a href="#æ•°æ®åº“æ˜ç»†" class="headerlink" title="æ•°æ®åº“æ˜ç»†"></a>æ•°æ®åº“æ˜ç»†</h3><p>è¯´åœ¨å‰é¢ï¼š</p><ul><li>æ•°æ®åº“ï¼šMongoDBé›†ç¾¤ 4ä¸ªåˆ†ç‰‡èŠ‚ç‚¹</li><li>åˆ†ç‰‡èŠ‚ç‚¹è§„æ ¼ï¼š16æ ¸ / 32G CentOS 7.4 64ä½</li><li>æ•°æ®ç›®å½•æ‰€åœ¨ç£ç›˜: 300G   49G  252G  17% /data</li></ul><h3 id="æ•…äº‹æƒ…èŠ‚"><a href="#æ•…äº‹æƒ…èŠ‚" class="headerlink" title="æ•…äº‹æƒ…èŠ‚"></a>æ•…äº‹æƒ…èŠ‚</h3><ul><li>æŸå¤©æ™šä¸Šåˆšåˆ°å®¶ä¸ä¹…ï¼Œå°±æ¥åˆ°æ­å·åŒäº‹çš„ç”µè¯ï¼Œå®¢æˆ·MongoDBé›†ç¾¤ä¸­çš„æŸä¸ªåˆ†ç‰‡èŠ‚ç‚¹CPUé£™é«˜ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯æ…¢æŸ¥è¯¢ï¼Œç°åœ¨éœ€è¦æ‹‰å–CPUé£™é«˜æ—¶é—´æ®µçš„æ…¢æŸ¥è¯¢ã€‚å¿ƒæƒ³æ‹‰å–æ…¢æŸ¥è¯¢åº”è¯¥å¾ˆå¿«ï¼Œä¸å°±æ˜¯ä¸ªç³»ç»Ÿæ—¥å¿—å—ï¼Ÿè€Œä¸”è¿˜åšäº†æ—¥å¿—åˆ‡å‰²ä¸€å¤©ä¸€ä¸ªï¼ŒæŒ‰é“ç†å¾ˆå¿«æå®šçš„ï¼Œè°çŸ¥å½“å¤©æ™šä¸Šæäº†æ¥è¿‘ä¸‰ä¸ªå°æ—¶ä¹Ÿæ²¡æå®šã€‚ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</li><li>è¿›å…¥åˆ°æ—¥å¿—ç›®å½•ä¸€çœ‹ï¼Œç›®å‰ä¿ç•™è¿‘7å¤©çš„æ—¥å¿—ï¼Œæ¯å¤©çš„æ—¥å¿—é‡åœ¨23G~24Gï¼Œæˆ‘å½“æ—¶å°±æƒ³è¿™ä¸ªå®¢æˆ·æ•°æ®é‡è¿™ä¹ˆå¤§ï¼åç»­å‘ç°æ—¥å¿—æ ¼å¼æœ¬è¯¥ä¸ºæ™®é€šæ–‡æœ¬æ–‡ä»¶ç¡®å˜æˆäº†å›¾ç‰‡æ ¼å¼ï¼Œç©¶ç«Ÿä¸ºä½•ä¼šæ–‡ä»¶æ ¼å¼ä¼šè½¬å˜ï¼Ÿèƒ½å¦ä»å›¾ç‰‡æ ¼å¼ä¸­æ‹‰å–æŒ‡å®šæ—¶é—´æ®µçš„æ—¥å¿—å‘¢ï¼Ÿ</li><li>ç¬¬äºŒå¤©åˆ°å…¬å¸ï¼Œç”±äºå®¢æˆ·ç¯å¢ƒæˆ‘ä»¬ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥å—ï¼Œå› æ­¤å’±ä»¬æŠ€æœ¯ä¸“å®¶å›¢é˜Ÿæäº†ä¸€ä¸ª3äººçš„â€ä¸“å®¶ä¼šè¯Šâ€ï¼Œç»è¿‡äº†ä¸€ç•ªæŠ˜è…¾æ€»ç®—æŠŠåŸå› æ‰¾åˆ°äº†ï¼Œå…·ä½“è¿‡ç¨‹è¯·çœ‹ä¸‹æ–‡ï¼</li></ul><h2 id="å¤ç°ä¸å‰–æ"><a href="#å¤ç°ä¸å‰–æ" class="headerlink" title="å¤ç°ä¸å‰–æ"></a>å¤ç°ä¸å‰–æ</h2><h3 id="æ‹‰å–æ—¥å¿—å¼‚å¸¸"><a href="#æ‹‰å–æ—¥å¿—å¼‚å¸¸" class="headerlink" title="æ‹‰å–æ—¥å¿—å¼‚å¸¸"></a>æ‹‰å–æ—¥å¿—å¼‚å¸¸</h3><p><strong>ä½¿ç”¨mlogfilterè¿‡æ»¤æ–‡ä»¶æ—¶æŠ¥é”™è¯´æ–‡ä»¶émongodbçš„æ—¥å¿—æ–‡ä»¶</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@sh_01 booboo]# mlogfilter shard.log.2018-08-01 --from 2018-08-01T15:00:00.000+0800 --to "+1h" --slow 1000 &gt; /alidata/booboo/tf.1</span><br><span class="line">æŠ¥é”™:émongodbæ—¥å¿—æ ¼å¼</span><br></pre></td></tr></table></figure><p>å›åˆ°å®¢æˆ·æœåŠ¡å™¨æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ ¼å¼ï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@MONGO-SHARD-18 logs]# file *</span><br><span class="line">shard.log:            PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-25: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-26: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-27: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-28: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-29: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-30: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-31: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-01: PCX ver. 2.5 image data</span><br></pre></td></tr></table></figure><p>mongodbçš„æ—¥å¿—æ­£å¸¸åº”è¯¥ä¸ºï¼š<code>ASCII text, with very long lines</code>ï¼Œä½†æ˜¯ç°åœ¨å´å˜æˆäº†<code>PCX ver. 2.5 image data</code>ã€‚éœ€è¦å¼„æ¸…æ¥šåŸå› ã€‚</p><h3 id="æ—¥å¿—å¼‚å¸¸åˆ†æ"><a href="#æ—¥å¿—å¼‚å¸¸åˆ†æ" class="headerlink" title="æ—¥å¿—å¼‚å¸¸åˆ†æ"></a>æ—¥å¿—å¼‚å¸¸åˆ†æ</h3><ul><li>ä¸ºä»€ä¹ˆå®¢æˆ·æ¯å¤©çš„æ—¥å¿—é‡è¾¾åˆ°22ä¸ªGï¼Œå¹¶ä¸”æ¯å¤©çš„æ—¥å¿—é‡éƒ½æ˜¯å¤§äºç­‰äºå‰ä¸€å¤©ï¼Ÿå¾ˆæ˜¾ç„¶ï¼Œæ—¥å¿—æˆªæ–­æœ‰é—®é¢˜ã€‚</li><li>è¿™ä¸ªæ˜¯è¿‘7å¤©çš„æ—¥å¿—ï¼Œè€Œæ—¥å¿—æ ¼å¼å˜æˆäº†PCXå›¾ç‰‡æ ¼å¼æ˜¯ä¸ºä½•ï¼Ÿ</li><li>æ€€ç–‘æ¯æ¬¡æ—¥å¿—è½®è¯¢æ—¶éƒ½æ²¡æœ‰çœŸæ­£æˆªæ–­æ—¥å¿—ï¼</li></ul><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/01.png" alt=""></p><h3 id="åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†"><a href="#åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†" class="headerlink" title="åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†"></a>åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†</h3><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/03.png" alt=""></p><p>æ€€ç–‘ä¸<code>echo &gt;</code>æœ‰å…³ï¼Œè¿›è¡ŒéªŒè¯ã€‚</p><h3 id="éªŒè¯echo-gt-ä¸PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´"><a href="#éªŒè¯echo-gt-ä¸PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´" class="headerlink" title="éªŒè¯echo &gt;ä¸PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´"></a>éªŒè¯<code>echo &gt;</code>ä¸<code>PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´</code></h3><ol><li>å»ºä¸€ä¸ªç©ºæ–‡æ¡£<code>log</code>ï¼›æ‰§è¡Œ<code>echo &gt; log</code>ï¼›é€šè¿‡<code>cat -A log</code>æŸ¥çœ‹æ–‡ä»¶ä¸­æ’å…¥äº†ä¸€ä¸ªç¬¦å·å³æ¢è¡Œç¬¦<code>\n</code></li><li>é€šè¿‡<code>hexdump -c log</code> æŸ¥çœ‹æµ‹è¯•æ–‡ä»¶å¤´éƒ¨æ˜¾ç¤ºä¸ºASCIIå­—ç¬¦ <code>\n</code></li><li>é€šè¿‡<code>hexdump -d log</code> æŸ¥çœ‹æµ‹è¯•æ–‡ä»¶å¤´éƒ¨æ˜¾ç¤ºä¸º16è¿›åˆ¶<code>00010</code> å³<code>0a</code></li><li>é€šè¿‡<code>vim</code> ç”¨16è¿›åˆ¶æŸ¥çœ‹æ–‡æ¡£<code>log</code>å¯ä»¥çœ‹åˆ°logçš„æ–‡ä»¶å¤´éƒ¨ä¸º<code>0a</code>ï¼Œæ­£æ˜¯PCXå›¾ç‰‡çš„å¤´éƒ¨</li><li>ç”Ÿäº§ç¯å¢ƒæŸ¥çœ‹å®¢æˆ·æœ‰é—®é¢˜çš„mongodbç³»ç»Ÿæ—¥å¿—æ–‡ä»¶æ ¼å¼ä¸º<code>PCX</code>å›¾ç‰‡æ ¼å¼</li><li>é€šè¿‡<code>hexdump -c log</code> æ˜¾ç¤ºä¸ºASCIIå­—ç¬¦ï¼Œç”Ÿäº§æ—¥å¿—æ–‡ä»¶å¤´éƒ¨ä¸æµ‹è¯•çš„logä¸€è‡´ï¼Œéƒ½æ˜¯<code>\n</code></li><li>é€šè¿‡<code>hexdump -d log</code>æ˜¾ç¤ºä¸º16è¿›åˆ¶ï¼Œç”Ÿäº§æ—¥å¿—æ–‡ä»¶å¤´éƒ¨ä¸æµ‹è¯•çš„logä¸€è‡´<code>00010</code> å³ <code>0a</code></li></ol><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/02.png" alt=""></p><p><strong>åˆ°æ­¤éªŒè¯æˆåŠŸ:é€šè¿‡<code>echo &gt; log</code>çš„æ–¹å¼ä¼šå¾€æ–‡ä»¶å¤´éƒ¨æ–°å¢â€™0aâ€™</strong></p><hr><h3 id="å¤ç°MongoDBæ—¥å¿—ä»ASCII-textè½¬å˜ä¸ºPCX-æ ¼å¼"><a href="#å¤ç°MongoDBæ—¥å¿—ä»ASCII-textè½¬å˜ä¸ºPCX-æ ¼å¼" class="headerlink" title="å¤ç°MongoDBæ—¥å¿—ä»ASCII textè½¬å˜ä¸ºPCX æ ¼å¼"></a>å¤ç°MongoDBæ—¥å¿—ä»ASCII textè½¬å˜ä¸ºPCX æ ¼å¼</h3><p>åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¤ç°æ—¥å¿—ä»<code>ASCII text</code>å˜æˆ<code>PCX ver. 2.5 image data</code></p><ol><li>é€šè¿‡mongoç™»é™†æ•°æ®åº“æ‰§è¡Œå¤§é‡çš„æ’å…¥æ“ä½œ</li><li>é€šè¿‡echo &gt; mongod27017.log  å‘½ä»¤å°è¯•æ¸…ç©ºmongod27017.log</li><li>æŸ¥çœ‹æˆªæ–­åçš„æ—¥å¿—æ–‡ä»¶æ ¼å¼ï¼Œå˜æˆäº†very short file (no magic)</li><li>ç­‰æ–‡æ¡£æ’å…¥å®Œæ¯•</li><li>é€šè¿‡<code>tail -f</code> æŸ¥çœ‹æ—¥å¿—æ˜ç»†ï¼Œçœ‹åˆ°ç¡®å®æœ‰æ—¥å¿—å†™å…¥</li><li>æŸ¥çœ‹æ—¥å¿—æ ¼å¼ï¼Œå‘ç°å˜æˆäº†<code>PCX ver. 2.5 image data</code></li></ol><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/05.png" alt=""></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">[root@sh_01 ~]# mongo</span><br><span class="line">MongoDB shell version: 3.2.16</span><br><span class="line">connecting to: test</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.auth(<span class="string">'test_dev'</span>,<span class="string">'uplooking'</span>)</span></span><br><span class="line">1</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.t1.find()</span></span><br><span class="line">&#123; "_id" : ObjectId("5b5ebb6796b8b74a73ee30f6"), "a" : 1, "b" : 2 &#125;</span><br><span class="line">&#123; "_id" : ObjectId("5b5ebb6996b8b74a73ee30f7"), "a" : 1, "b" : 1 &#125;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="keyword">for</span> (i=1;i&lt;200000;i++)&#123;</span></span><br><span class="line">... db.t1.insert(&#123;id:i&#125;)&#125;</span><br><span class="line">WriteResult(&#123; "nInserted" : 1 &#125;)</span><br><span class="line"></span><br><span class="line">[root@sh_01 ~]# cd /alidata/mongodb/logs</span><br><span class="line">[root@sh_01 log]# ll</span><br><span class="line">-rw-r--r-- 1 root root 2182 Aug  3 10:28 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3100 Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line"></span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# ll</span><br><span class="line">total 12</span><br><span class="line">-rw-r--r-- 1 root root    1 Aug  3 10:29 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3100 Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     very short file (no magic)</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line"></span><br><span class="line">[root@sh_01 log]# tail -f mongod27017.log</span><br><span class="line"></span><br><span class="line">2018-08-03T10:30:21.936+0800 I NETWORK  [initandlisten] connection accepted from 127.0.0.1:43720 #2 (2 connections now open)</span><br><span class="line"></span><br><span class="line">[root@sh_01 log]# ll -h</span><br><span class="line">total 12K</span><br><span class="line">-rw-r--r-- 1 root root 2.8K Aug  3 10:30 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3.1K Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1.5K Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     PCX ver. 2.5 image data</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸€è¾¹ä¸æ–­äº§ç”Ÿæ—¥å¿—ï¼Œä¸€è¾¹å¤šæ¬¡æ‰§è¡Œ<span class="built_in">echo</span>&gt; </span></span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     PCX ver. 2.5 image data</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     very short file (no magic)</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# ll -h</span><br><span class="line">total 16K</span><br><span class="line">-rw-r--r-- 1 root root    1 Aug  3 11:28 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3.1K Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1.5K Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">-rw-r--r-- 1 root root 2.9K Aug  3 11:05 mongod27017.log.2018-08-03T03-09-08</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     very short file (no magic)</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     PCX ver. 2.5 image data</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# hexdump -c mongod27017.log</span><br><span class="line">0000000  \n  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">0000010  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">*</span><br><span class="line">0000850  \0  \0  \0  \0  \0  \0  \0   2   0   1   8   -   0   8   -   0</span><br><span class="line">0000860   3   T   1   1   :   2   9   :   0   6   .   7   2   9   +   0</span><br><span class="line">0000870   8   0   0       I       A   C   C   E   S   S               [</span><br><span class="line">0000880   c   o   n   n   3   ]       U   n   a   u   t   h   o   r   i</span><br><span class="line">0000890   z   e   d   :       n   o   t       a   u   t   h   o   r   i</span><br><span class="line">00008a0   z   e   d       o   n       t   e   s   t       t   o       e</span><br><span class="line">00008b0   x   e   c   u   t   e       c   o   m   m   a   n   d       &#123;</span><br><span class="line">00008c0       f   i   n   d   :       "   t   1   "   ,       f   i   l</span><br><span class="line">00008d0   t   e   r   :       &#123;   &#125;       &#125;  \n</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¤ç°äº†å®¢æˆ·çš„æƒ…å†µï¼š</p><ol><li><p>ç¬¬ä¸€æ¬¡<code>echo &gt; log</code>ï¼Œæ–‡ä»¶å¤´éƒ¨æ–°å¢<code>\n</code></p></li><li><p>å¤šæ¬¡<code>echo &gt; log</code>,æ–‡ä»¶å¤´éƒ¨å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0000000  \n  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">0000010  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">*</span><br></pre></td></tr></table></figure></li></ol><p>ç¡®å®æ˜¯mongodbæ—¥å¿—è½®è¯¢å‡ºäº†é—®é¢˜ï¼š</p><ol><li><code>echo &gt; log</code>ä¼šå¾€æ–‡ä»¶å¤´éƒ¨æ’å…¥<code>\n</code>å³16è¿›åˆ¶çš„<code>0a</code></li><li>åœ¨æ•°æ®åº“æ­£å¸¸è¿è¡Œä¸­ï¼Œå¯¹logæ–‡ä»¶æ˜¯åŠ äº†é”çš„ï¼Œå¼ºåˆ¶æ‰§è¡Œ<code>echo &gt; log</code>æ˜¯æ— æ³•è¿›è¡Œè¦†ç›–çš„ï¼Œä¼šå°†æ‰€æœ‰çš„æ•°æ®å…¨éƒ¨ç½®ä¸º<code>0</code></li><li>å¼ºåˆ¶è¦†ç›–åï¼Œæ–‡ä»¶å¤´éƒ¨å˜æˆäº†æ— æ•°çš„ç©ºç™½</li></ol><h3 id="å¾…è§£å†³é—®é¢˜"><a href="#å¾…è§£å†³é—®é¢˜" class="headerlink" title="å¾…è§£å†³é—®é¢˜"></a>å¾…è§£å†³é—®é¢˜</h3><ul><li>MongoDBæ—¥å¿—è½®è¯¢æ–¹æ³•è°ƒæ•´ä¸º<strong>kill -SIGUSER1 [mongodpid]</strong></li><li>ä¿®å¤ç›®å‰å·²ç»å˜ä¸ºå›¾ç‰‡æ ¼å¼çš„æ—¥å¿—ï¼Œå¹¶æ‹‰å–15ç‚¹åˆ°16ç‚¹çš„æ—¥å¿—</li></ul><h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><h3 id="MongoDBæ—¥å¿—è½®è¯¢"><a href="#MongoDBæ—¥å¿—è½®è¯¢" class="headerlink" title="MongoDBæ—¥å¿—è½®è¯¢"></a>MongoDBæ—¥å¿—è½®è¯¢</h3><h4 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@sh_01 log]# pidof mongod</span><br><span class="line">1828</span><br><span class="line">[root@sh_01 log]# kill -SIGUSER1 1828</span><br><span class="line">-bash: kill: SIGUSER1: invalid signal specification</span><br><span class="line">[root@sh_01 log]# kill -SIGUSR1 1828</span><br><span class="line">[root@sh_01 log]# ll</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  3 11:09 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3100 Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">-rw-r--r-- 1 root root 2942 Aug  3 11:05 mongod27017.log.2018-08-03T03-09-08</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br></pre></td></tr></table></figure><h4 id="ç”Ÿäº§ç¯å¢ƒ"><a href="#ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒ"></a>ç”Ÿäº§ç¯å¢ƒ</h4><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/04.png" alt=""></p><p>ä¿®æ”¹æ—¥å¿—è½®è¯¢è„šæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@MONGO-SHARD-18 logs]# cat /etc/init.d/mongo_logspit.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2018/08/02 Apple</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Rotate the MongoDB logs to prevent a single logfile from consuming too much disk space.</span></span><br><span class="line"></span><br><span class="line">cmd=mongod</span><br><span class="line">mongodpath=/opt/mongodb/bin</span><br><span class="line">pidarray=`pidof $&#123;mongodpath&#125;/$cmd`</span><br><span class="line">LOGPATH_SHARD=/data/mongodb/shard1/logs</span><br><span class="line"></span><br><span class="line">for pid in $pidarray;do</span><br><span class="line">if [ $pid ]</span><br><span class="line">then</span><br><span class="line">    kill -SIGUSR1 $pid</span><br><span class="line">fi</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash">clear logfile more than 7 days</span></span><br><span class="line">cd $LOGPATH_SHARD</span><br><span class="line">find ./ -xdev -mtime +7 -name "shard.log.*" -exec rm -f &#123;&#125;  \;</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰çš„åˆ†ç‰‡éƒ½å»æ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -SIGUSR1 pidof mongod</span><br></pre></td></tr></table></figure><p>åˆ†ç‰‡15æ“ä½œå¦‚ä¸‹ï¼šå…¶ä»–åˆ†ç‰‡åŒæ ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[zyadmin@MONGO-SHARD-15 ~]$ sudo -i</span><br><span class="line">[root@MONGO-SHARD-15 ~]# cd /data/mongodb/shard1/logs/</span><br><span class="line">[root@MONGO-SHARD-15 logs]# ll -h</span><br><span class="line">total 1.7G</span><br><span class="line">-rw-r--r-- 1 root root 20G Aug  2 15:27 shard.log</span><br><span class="line">-rw-r--r-- 1 root root 19G Jul 25 23:50 shard.log.2018-07-25</span><br><span class="line">-rw-r--r-- 1 root root 19G Jul 26 23:50 shard.log.2018-07-26</span><br><span class="line">-rw-r--r-- 1 root root 19G Jul 27 23:50 shard.log.2018-07-27</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 28 23:50 shard.log.2018-07-28</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 29 23:50 shard.log.2018-07-29</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 30 23:50 shard.log.2018-07-30</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 31 23:50 shard.log.2018-07-31</span><br><span class="line">-rw-r--r-- 1 root root 20G Aug  1 23:50 shard.log.2018-08-01</span><br><span class="line">[root@MONGO-SHARD-15 logs]# file *</span><br><span class="line">shard.log:            PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-25: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-26: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-27: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-28: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-29: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-30: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-31: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-01: PCX ver. 2.5 image data</span><br><span class="line">[root@MONGO-SHARD-15 logs]# kill -SIGUSR1 `pidof mongod`</span><br><span class="line">[root@MONGO-SHARD-15 logs]# file *</span><br><span class="line">shard.log:                     ASCII text, with very long lines</span><br><span class="line">shard.log.2018-07-25:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-26:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-27:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-28:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-29:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-30:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-31:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-01:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-02T07-27-29: PCX ver. 2.5 image data</span><br><span class="line">[root@MONGO-SHARD-15 logs]# ll -h</span><br><span class="line">total 1.7G</span><br><span class="line">-rw-r--r-- 1 root root 2.0K Aug  2 15:27 shard.log</span><br><span class="line">-rw-r--r-- 1 root root  19G Jul 25 23:50 shard.log.2018-07-25</span><br><span class="line">-rw-r--r-- 1 root root  19G Jul 26 23:50 shard.log.2018-07-26</span><br><span class="line">-rw-r--r-- 1 root root  19G Jul 27 23:50 shard.log.2018-07-27</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 28 23:50 shard.log.2018-07-28</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 29 23:50 shard.log.2018-07-29</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 30 23:50 shard.log.2018-07-30</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 31 23:50 shard.log.2018-07-31</span><br><span class="line">-rw-r--r-- 1 root root  20G Aug  1 23:50 shard.log.2018-08-01</span><br><span class="line">-rw-r--r-- 1 root root  20G Aug  2 15:27 shard.log.2018-08-02T07-27-29</span><br></pre></td></tr></table></figure><h3 id="ä¿®å¤å¼‚å¸¸æ—¥å¿—"><a href="#ä¿®å¤å¼‚å¸¸æ—¥å¿—" class="headerlink" title="ä¿®å¤å¼‚å¸¸æ—¥å¿—"></a>ä¿®å¤å¼‚å¸¸æ—¥å¿—</h3><h4 id="ä¿®å¤æ€è·¯"><a href="#ä¿®å¤æ€è·¯" class="headerlink" title="ä¿®å¤æ€è·¯"></a>ä¿®å¤æ€è·¯</h4><p>å¼„æ¸…æ¥šæ—¥å¿—å˜æ›´çš„åŸå› ä»¥åŠå¤ç°è¿‡ç¨‹åï¼Œä¸éš¾å‘ç°ï¼Œæ—¥å¿—å› ä¸ºå¤´éƒ¨å˜åŒ–ä»è€Œå¯¼è‡´æ–‡ä»¶æ ¼å¼å˜æ›´ã€‚å› æ­¤æ¨æµ‹å¼‚å¸¸æ—¥å¿—çš„ç»„æˆå¦‚ä¸‹ï¼š</p><ol><li>å¤´éƒ¨ä¸º<code>0a</code></li><li>ä¸­é—´å…¨éƒ¨éƒ½æ˜¯<code>0</code></li><li>æœ€åæ˜¯æ­£å¸¸çš„å­—ç¬¦ä¸²è®°å½•ç€mongodbçš„æ—¥å¿—ä¿¡æ¯ï¼Œç±»ä¼¼äº<code>2018-08-03T10:30:21.936+0800 I NETWORK  [initandlisten] connection accepted from 127.0.0.1:43720 #2 (2 connections now open)</code>ç”±æ—¥å¿—å’Œæ—¥å¿—æ˜ç»†ç»„æˆ</li></ol><p>å› æ­¤ä¿®å¤çš„æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>23Gçš„æ—¥å¿—ï¼Œé¦–å…ˆæŒ‰ç…§å¤§å°6Gåšåˆ‡åˆ†<code>split -b 6G log</code>ï¼Œåˆ‡åˆ†æˆ4ä¸ªæ–‡ä»¶</li><li>æŸ¥çœ‹åˆ‡åˆ†åçš„æ—¥å¿—æ ¼å¼ï¼Œå¦‚æœæœ€åä¸€ä¸ªæ—¥å¿—ä¸º<code>ASCII text</code>åˆ™ä¸å†åˆ‡åˆ†å¦åˆ™ï¼Œå°†æœ€åä¸€ä¸ªæ—¥å¿—ç»§ç»­åˆ‡åˆ†</li><li>å¾ªç¯ä¸Šä¸€æ­¥ï¼Œç›´åˆ°æœ€åä¸€ä¸ªæ–‡ä»¶åˆ‡åˆ†å‡ºæ¥æ²¡æœ‰<code>ASCII text</code>ä¸ºæ­¢</li></ul><h4 id="æ“ä½œæ˜ç»†"><a href="#æ“ä½œæ˜ç»†" class="headerlink" title="æ“ä½œæ˜ç»†"></a>æ“ä½œæ˜ç»†</h4><blockquote><p>æ—¥å¿—è½®è¯¢çš„éƒ¨ç½²è·ç¦»ç°åœ¨å¤§æ¦‚4ä¸ªæœˆ</p></blockquote><ol><li><p>ç¬¬ä¸€æ¬¡å°†23Gçš„æ–‡ä»¶ä»¥6Gåˆ‡åˆ†æˆ4ä¸ªæ–‡ä»¶ï¼šxaa\xab\xac\xadï¼ŒæŸ¥çœ‹4ä¸ªæ–‡ä»¶çš„å±æ€§ä¸º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xaa:               PCX ver. 2.5 image data</span><br><span class="line">xab:               PCX ver. 2.5 image data</span><br><span class="line">xac:               PCX ver. 2.5 image data</span><br><span class="line">xad:                PCX ver. 2.5 image data</span><br></pre></td></tr></table></figure></li><li><p>é‡å‘½åxadä¸ºx1ç¬¬äºŒæ¬¡åˆ‡åˆ†x1 5Gï¼ŒæŒ‰ç…§1Gåˆ‡åˆ†æˆ5ä»½ï¼ŒæŸ¥çœ‹æ–‡ä»¶å±æ€§</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xaa:               PCX ver. 2.5 image data</span><br><span class="line">xab:               PCX ver. 2.5 image data</span><br><span class="line">xac:               PCX ver. 2.5 image data</span><br><span class="line">xad:                PCX ver. 2.5 image data</span><br><span class="line">xae:                ASCII text, with very long lines</span><br></pre></td></tr></table></figure></li><li><p>é‡åxad ä¸º x2 æŒ‰ç…§15Mçš„å¤§å°åˆ‡åˆ†ï¼ŒæŸ¥çœ‹æ–‡ä»¶çš„å±æ€§å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">xaa:      PCX ver. 2.5 image data</span><br><span class="line">æ­¤å¤„çœç•¥ã€‚ã€‚ã€‚</span><br><span class="line">xdo:               PCX ver. 2.5 image data</span><br><span class="line">xdp:               ASCII text, with very long lines</span><br><span class="line">xdq:               ASCII text, with very long lines</span><br><span class="line">xdr:               ASCII text, with very long lines</span><br><span class="line">xds:               ASCII text, with very long lines</span><br><span class="line">xdt:               ASCII text, with very long lines</span><br><span class="line">xdu:               ASCII text, with very long lines</span><br><span class="line">xdv:               UTF-8 Unicode text, with very long lines</span><br><span class="line">xdw:               ASCII text, with very long lines</span><br><span class="line">xdx:               ASCII text, with very long lines</span><br><span class="line">xdy:               ASCII text, with very long lines</span><br></pre></td></tr></table></figure></li><li><p>åˆ‡åˆ†åæ–‡ä»¶ç±»å‹ä¸º<code>ASCII text</code>çš„æ–‡ä»¶ä¸­æ‰¾åˆ°15ç‚¹~16ç‚¹çš„æ–‡æ¡£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@sh_01 mongolog_20180801]# head -n 2 xdv</span><br><span class="line">re: "x86_64", version: "Kernel 3.10.0-693.2.2.el7.x86_64" &#125; &#125;</span><br><span class="line">2018-08-01T16:13:44.958+0800 I ACCESS   [conn4972925] Successfully authenticated as principal __system on local</span><br><span class="line">[root@sh_01 mongolog_20180801]# head -n 2 xdu</span><br><span class="line">38422 #4967772 (445 connections now open)</span><br><span class="line">2018-08-01T14:00:10.575+0800 I NETWORK  [thread1] connection accepted from 172.16.0.44:38430 #4967773 (446 connections now open)</span><br></pre></td></tr></table></figure></li></ol><ul><li><code>xdv</code> çš„å¤´éƒ¨æ˜¯<code>2018-08-01T16:13:44.958+0800</code>,å› æ­¤å¯ä»¥ç¡®å®š15~16çš„æ—¥å¿—åœ¨xduä¸­</li><li><code>xdu</code>è®°å½•çš„æ—¥å¿—æ—¶é—´æ®µä¸º<code>2018-08-01T14:00:10.575+0800</code>~<code>2018-08-01T16:13:44.958+0800</code></li><li>é‡å‘½å<code>xdu</code>ä¸º<code>mongolog.18.14_16</code></li></ul><h3 id="åˆ†ææ—¥å¿—"><a href="#åˆ†ææ—¥å¿—" class="headerlink" title="åˆ†ææ—¥å¿—"></a>åˆ†ææ—¥å¿—</h3><h4 id="åˆ†æå‘½ä»¤"><a href="#åˆ†æå‘½ä»¤" class="headerlink" title="åˆ†æå‘½ä»¤"></a>åˆ†æå‘½ä»¤</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è·å–08æœˆ01å·ä¸‹åˆ3ç‚¹å¼€å§‹åˆ°4ç‚¹æ‰§è¡Œæ—¶é—´è¶…è¿‡5ç§’çš„æŸ¥è¯¢</span></span><br><span class="line">mlogfilter mongolog.18.14_16 --from 2018-08-01T15 --to "+1h" --slow 5000 &gt; slowlog.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–08æœˆ01å·ä¸‹åˆ3ç‚¹å¼€å§‹åˆ°4ç‚¹è¯­å¥çš„æ‰§è¡Œæ¬¡æ•°ã€ç”¨æ—¶ç­‰ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line">mloginfo slowlog.txt  --queries &gt; an_slowlog.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡mplotqueriesè¿›è¡Œæ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾ç»˜åˆ¶ï¼Œä¸”åªè¿”å›å‰10ä¸ª</span></span><br><span class="line">mplotqueries slowlog.txt --output-file 01.png --logscale --group-limit 10</span><br></pre></td></tr></table></figure><h4 id="æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾"><a href="#æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾" class="headerlink" title="æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾"></a>æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@sh_01 booboo]# mplotqueries slowlog.txt --output-file 01.png --logscale --group-limit 10</span><br><span class="line">                                                                                          </span><br><span class="line">SCATTER plot</span><br><span class="line">   id   #points  group</span><br><span class="line">    1       692  order.order</span><br><span class="line">    2       615  omdmain.item_region_erp</span><br><span class="line">    3         1  omdmain.customer</span><br><span class="line">()</span><br></pre></td></tr></table></figure><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/10.png" alt=""></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜"><a href="#mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜" class="headerlink" title="mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜"></a>mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜</h3><ol><li><code>echo &gt; log</code>ä¼šå¾€æ–‡ä»¶å¤´éƒ¨æ’å…¥<code>\n</code>å³16è¿›åˆ¶çš„<code>0a</code></li><li>åœ¨æ•°æ®åº“æ­£å¸¸è¿è¡Œä¸­ï¼Œå¯¹logæ–‡ä»¶æ˜¯åŠ äº†é”çš„ï¼Œå¼ºåˆ¶æ‰§è¡Œ<code>echo &gt; log</code>æ˜¯æ— æ³•è¿›è¡Œè¦†ç›–çš„ï¼Œä¼šå°†æ‰€æœ‰çš„æ•°æ®å…¨éƒ¨ç½®ä¸º<code>0</code></li><li>å¼ºåˆ¶è¦†ç›–åï¼Œæ–‡ä»¶å¤´éƒ¨å˜æˆäº†æ— æ•°çš„ç©ºç™½</li></ol><h3 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h3><ul><li>MongoDBæ—¥å¿—è½®è¯¢æ–¹æ³•è°ƒæ•´ä¸º<strong>kill -SIGUSER1 [mongodpid]</strong></li><li>ä¿®å¤ç›®å‰å·²ç»å˜ä¸ºå›¾ç‰‡æ ¼å¼çš„æ—¥å¿—ï¼Œå¹¶æ‹‰å–15ç‚¹åˆ°16ç‚¹çš„æ—¥å¿—</li></ul><p>è¯¥caseèŠ±äº†ä¸€æ•´å¤©ï¼Œä»æ€€ç–‘è¢«æ”»å‡»åˆ°ç¡®è®¤æ˜¯æ—¥å¿—è½®è¯¢å¼•èµ·æ–‡ä»¶æ ¼å¼å˜æ›´æ˜¯ä¸€ä¸ªå…³é”®è½¬æŠ˜ç‚¹ï¼›</p><p>å¦å¤–PCXæ ¼å¼æ˜¯ç¬¬ä¸€æ¬¡ç¢°åˆ°ï¼Œç–‘æƒ‘äº†åŠå¤©~æœ€åæ˜¯@åŸ¹å°§å‘ç°äº†<code>echo</code>çš„ç«¯å€ªï¼Œ@è¡¾è¢­@å¤§å®å»éªŒè¯æœ€ç»ˆç¡®è®¤äº†é—®é¢˜çš„æ ¹æºã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦ï¼š &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŸå¤©æ™šä¸Šåˆšåˆ°å®¶ä¸ä¹…ï¼Œå°±æ¥åˆ°æ­å·åŒäº‹çš„ç”µè¯ï¼Œå®¢æˆ·MongoDBé›†ç¾¤ä¸­çš„æŸä¸ªåˆ†ç‰‡èŠ‚ç‚¹CPUé£™é«˜ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯æ…¢æŸ¥è¯¢ï¼Œç°åœ¨éœ€è¦æ‹‰å–CPUé£™é«˜æ—¶é—´æ®µçš„æ…¢æŸ¥è¯¢ã€‚å¿ƒæƒ³æ‹‰å–æ…¢æŸ¥è¯¢åº”è¯¥å¾ˆå¿«ï¼Œä¸å°±æ˜¯ä¸ªç³»ç»Ÿæ—¥å¿—å—ï¼Ÿè€Œä¸”è¿˜åšäº†æ—¥å¿—åˆ‡å‰²ä¸€å¤©ä¸€ä¸ªï¼ŒæŒ‰é“ç†å¾ˆå¿«æå®šçš„ï¼Œè°çŸ¥å½“å¤©æ™šä¸Šæäº†æ¥è¿‘ä¸‰ä¸ªå°æ—¶ä¹Ÿæ²¡æå®šã€‚ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ&lt;/li&gt;
&lt;li&gt;è¿›å…¥åˆ°æ—¥å¿—ç›®å½•ä¸€çœ‹ï¼Œç›®å‰ä¿ç•™è¿‘7å¤©çš„æ—¥å¿—ï¼Œæ¯å¤©çš„æ—¥å¿—é‡åœ¨23G~24Gï¼Œæˆ‘å½“æ—¶å°±æƒ³è¿™ä¸ªå®¢æˆ·æ•°æ®é‡è¿™ä¹ˆå¤§ï¼åç»­å‘ç°æ—¥å¿—æ ¼å¼æœ¬è¯¥ä¸ºæ™®é€šæ–‡æœ¬æ–‡ä»¶ç¡®å˜æˆäº†å›¾ç‰‡æ ¼å¼ï¼Œç©¶ç«Ÿä¸ºä½•ä¼šæ–‡ä»¶æ ¼å¼ä¼šè½¬å˜ï¼Ÿèƒ½å¦ä»å›¾ç‰‡æ ¼å¼ä¸­æ‹‰å–æŒ‡å®šæ—¶é—´æ®µçš„æ—¥å¿—å‘¢ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒå¤©åˆ°å…¬å¸ï¼Œç”±äºå®¢æˆ·ç¯å¢ƒæˆ‘ä»¬ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥æ‰‹ï¼Œå› æ­¤å’±ä»¬æŠ€æœ¯ä¸“å®¶å›¢é˜Ÿæäº†ä¸€ä¸ª3äººçš„â€ä¸“å®¶ä¼šè¯Šâ€ï¼Œç»è¿‡äº†ä¸€ç•ªæŠ˜è…¾æ€»ç®—æŠŠåŸå› æ‰¾åˆ°äº†ï¼Œå…·ä½“è¿‡ç¨‹è¯·çœ‹ä¸‹æ–‡ï¼&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯å¹¿è§’" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MongoDB" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MongoDB/"/>
    
    
      <category term="æ•°æ®æ•‘æ´" scheme="http://www.toberoot.com/tags/%E6%95%B0%E6%8D%AE%E6%95%91%E6%8F%B4/"/>
    
  </entry>
  
  <entry>
    <title>Oracleæ•°æ®åº“SQLä¼˜åŒ–_ç´¢å¼•ç¼ºå¤±</title>
    <link href="http://www.toberoot.com/2018/05/29/booboo_others/oracle%E6%95%B0%E6%8D%AE%E5%BA%93SQL%E4%BC%98%E5%8C%96-%E7%B4%A2%E5%BC%95%E7%BC%BA%E5%A4%B1/"/>
    <id>http://www.toberoot.com/2018/05/29/booboo_others/oracle%E6%95%B0%E6%8D%AE%E5%BA%93SQL%E4%BC%98%E5%8C%96-%E7%B4%A2%E5%BC%95%E7%BC%BA%E5%A4%B1/</id>
    <published>2018-05-28T18:09:32.000Z</published>
    <updated>2020-03-22T08:32:42.573Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦ï¼šOracleæ•°æ®åº“åšäº†è¿ç§»ï¼Œä»åŸæ¥çš„DGè¿ç§»åˆ°æ–°åº“RACï¼Œå°ç‰ˆæœ¬ä¸åŒï¼›è€åº“ä¸­ç›¸åŒçš„SQLæ‰§è¡Œåªéœ€è¦11ç§’ï¼Œè€Œæ–°åº“éœ€è¦360ç§’ç”šè‡³800å¤šç§’ï¼Œå¦‚ä½•è¿›è¡Œå¤æ‚æŸ¥è¯¢çš„SQLä¼˜åŒ–ï¼Œæœ¬æ–‡æä¾›é€šç”¨çš„ä¸€ä¸ªæ€è·¯ã€‚</p><a id="more"></a><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>oracleæ•°æ®åº“åšäº†è¿ç§»ï¼Œä»åŸæ¥çš„DGè¿ç§»åˆ°æ–°åº“RACï¼Œå°ç‰ˆæœ¬ä¸åŒï¼›</p><p>è€åº“ä¸­ç›¸åŒçš„SQLæ‰§è¡Œåªéœ€è¦11ç§’ï¼Œè€Œæ–°åº“éœ€è¦360ç§’ç”šè‡³800å¤šç§’ã€‚</p><table><thead><tr><th>åº“</th><th>åŸæŸ¥è¯¢æ—¶é—´</th><th>ä¼˜åŒ–åçš„æŸ¥è¯¢æ—¶é—´</th></tr></thead><tbody><tr><td>è€åº“</td><td>11ç§’</td><td>1.4ç§’ ç¼“å­˜å 0.4ç§’</td></tr><tr><td>æ–°åº“RAC</td><td>360ç§’</td><td>1.4ç§’ ç¼“å­˜å0.4ç§’æ’æŸ¥æ€è·¯</td></tr></tbody></table><h2 id="å¾…ä¼˜åŒ–SQL"><a href="#å¾…ä¼˜åŒ–SQL" class="headerlink" title="å¾…ä¼˜åŒ–SQL"></a>å¾…ä¼˜åŒ–SQL</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">prj.PROVINCE_AD_NAME,</span><br><span class="line">prj.CITY_AD_NAME,</span><br><span class="line">prj.AD_NAME,</span><br><span class="line">prj.CHANNEL_SYS_CAT,</span><br><span class="line">prj.EXCUTE_EL,</span><br><span class="line">prj.PRJ_CODE AS PRJ_CODE,</span><br><span class="line">prj.PRJ_NAME AS PRJ_NAME,</span><br><span class="line">prj.POS_CODE AS POS_CODE,</span><br><span class="line">prj.POS_NAME AS POS_NAME,</span><br><span class="line">prj.CUST_CHANNEL_CODE,</span><br><span class="line">prj.CUST_CHANNEL_NAME,</span><br><span class="line">prj.EMP_CODE AS EMP_CODE,</span><br><span class="line">prj.NAME AS EMP_NAME,</span><br><span class="line">prj.ATT_DATE AS APPLY_DATE,</span><br><span class="line">prj.EMP_PK AS EMP_PK,</span><br><span class="line">prj.ATT_START_TIME AS START_TIME,</span><br><span class="line">prj.ATT_END_TIME AS END_TIME,</span><br><span class="line">prj.ATT_ISWORK AS ISWORK,</span><br><span class="line">prj.ATT_UNWORK AS ATTTYPE,</span><br><span class="line">prj.START_XPOS AS ON_WORK_POSITION_LON,</span><br><span class="line">prj.START_YPOS AS ON_WORK_POSITION_LAT,</span><br><span class="line">prj.START_ISEXCEP AS ON_WORK_POSITION_STAUS,</span><br><span class="line">prj.END_XPOS AS OFF_WORK_POSITION_LAT,</span><br><span class="line">prj.END_YPOS AS OFF_WORK_POSITION_LON,</span><br><span class="line">prj.END_ISEXCEP AS OFF_WORK_POSITION_STAUS,</span><br><span class="line">ifcl1Staus.COMPARE_TYPE AS FACE_ATT_TYPE,</span><br><span class="line">ifcl1.STATUS AS FACE_ATT_STATUS,</span><br><span class="line">NVL( ifaceCount.faceCount, 0 ) AS FACE_ATT_COUNT,</span><br><span class="line">NVL( levLeave.LEAVECount, 0 ) AS LEAVE_WORK_COUNT,</span><br><span class="line">NVL( levRtn.RETURNCount, 0 ) AS RETURN_WORK_COUNT,</span><br><span class="line">wq.STATUS AS PRJ_QUESTION_TYPE,</span><br><span class="line">iface2.FACE_ATT_IMG AS FACE_ATT_IMG,</span><br><span class="line">prj.SA_TYPE</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">dpsi.ID AS ID,</span><br><span class="line">P.ID AS PRJ_ID,</span><br><span class="line">mad.AD_CODE,</span><br><span class="line">mad.PROVINCE_AD_NAME,</span><br><span class="line">mad.CITY_AD_NAME,</span><br><span class="line">mad.AD_NAME,</span><br><span class="line">mpk.POS_KIND_CODE,</span><br><span class="line">mpk.POS_KIND_NAME,</span><br><span class="line">P.CODE AS PRJ_CODE,</span><br><span class="line">P.NAME AS PRJ_NAME,</span><br><span class="line">P.START_DATE,</span><br><span class="line">p.END_DATE,</span><br><span class="line">dpsi.CUST_CHANNEL,</span><br><span class="line">dpsi.CUST_SYS,</span><br><span class="line">dpsi.CUST_CHANNEL_CODE,</span><br><span class="line">dpsi.CUST_CHANNEL_NAME,</span><br><span class="line">dcs.CHANNEL_SYS_CAT,</span><br><span class="line">dcs.CHANNEL_CAT_CODE,</span><br><span class="line">dcs.CHANNEL_AD_CODE,</span><br><span class="line">dcs.CHANNEL_PROVINCE_AD_CODE,</span><br><span class="line">dcs.CHANNEL_CITY_AD_CODE,</span><br><span class="line">dcs.ID AS POS_ID,</span><br><span class="line">dcs.CHANNEL_CODE AS POS_CODE,</span><br><span class="line">dcs.CHANNEL_NAME AS POS_NAME,</span><br><span class="line">dcs.LONGITUDE AS LONGITUDE,</span><br><span class="line">dcs.LATITUDE AS LATITUDE,</span><br><span class="line">dss.id AS SALES_ID,</span><br><span class="line">TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' ) AS sc_schedule_date,</span><br><span class="line">wor.SW_BEGIN_TIME AS SALES_WORK_START,</span><br><span class="line">wor.SW_END_TIME AS SALES_WORK_END,</span><br><span class="line">dss.SALES_EAT_START,</span><br><span class="line">dss.SALES_EAT_END,</span><br><span class="line">memp.EMP_PK,</span><br><span class="line">memp.EMP_CODE,</span><br><span class="line">dss.SALES_NAME AS NAME,</span><br><span class="line">dss.SALES_PHONE AS TEL,</span><br><span class="line">dss.SALES_CARD_ID AS ID_CARD,</span><br><span class="line">spp.PRJ_ATT_CHECK_TYPE,</span><br><span class="line">spp.ALLOW_LEAVE_TIME,</span><br><span class="line">e1.EMP_CODE AS EXCUTE_CODE,</span><br><span class="line">e1.emp_name AS EXCUTE_EL,</span><br><span class="line">e2.EMP_CODE AS CITY_CODE,</span><br><span class="line">e2.emp_name AS CITY_EL,</span><br><span class="line">e3.EMP_CODE AS AREA_CODE,</span><br><span class="line">e3.EMP_NAME AS AREA_NAME,</span><br><span class="line">dpsi.SCHEDULE_TYPE,</span><br><span class="line">sac.ATT_START_TIME,</span><br><span class="line">sac.ATT_END_TIME,</span><br><span class="line">sac.ATT_ISWORK,</span><br><span class="line">sac.ATT_UNWORK,</span><br><span class="line">sac.START_XPOS,</span><br><span class="line">sac.START_YPOS,</span><br><span class="line">DECODE( sac.START_ISEXCEP, 0, 2201, 1, 2202, 2, 2203, 3, 2204, 4, 2205, 2206 ) AS START_ISEXCEP,</span><br><span class="line">sac.END_XPOS,</span><br><span class="line">sac.END_YPOS,</span><br><span class="line">sac.END_ISEXCEP,</span><br><span class="line">sac.ATT_SCH_PK,</span><br><span class="line">sac.ATT_DATE,</span><br><span class="line">CASE</span><br><span class="line">WHEN sac.ATT_START_TIME IS NOT NULL</span><br><span class="line">AND sac.ATT_END_TIME IS NOT NULL THEN '1'</span><br><span class="line">WHEN sac.ATT_START_TIME IS NOT NULL</span><br><span class="line">OR sac.ATT_END_TIME IS NOT NULL THEN '2'</span><br><span class="line">ELSE '2'</span><br><span class="line">END AS SA_TYPE</span><br><span class="line">FROM</span><br><span class="line">DM_PROJECT_SELLIN_INFO dpsi</span><br><span class="line">LEFT JOIN MD_EMP e1 ON</span><br><span class="line">dpsi.EMP_CODE = e1.EMP_CODE</span><br><span class="line">LEFT JOIN MD_EMP e2 ON</span><br><span class="line">dpsi.CITY_EMP_CODE = e2.EMP_CODE</span><br><span class="line">LEFT JOIN MD_EMP e3 ON</span><br><span class="line">dpsi.AREA_MANAGER_CODE = e3.EMP_CODE,</span><br><span class="line">DM_PROJECT P,</span><br><span class="line">DM_PROJECT_SELLIN_SALES dss,</span><br><span class="line">DM_CHANNEL_SYNC dcs,</span><br><span class="line">MD_EMP memp,</span><br><span class="line">SP_PRJ_PARM spp,</span><br><span class="line">Md_Admin_Div mad,</span><br><span class="line">MD_POS_KIND mpk,</span><br><span class="line">dm_sales_schedule_calendar cal,</span><br><span class="line">dm_sales_schedule_work wor,</span><br><span class="line">SP_ATT_SCH sac</span><br><span class="line">WHERE</span><br><span class="line">dpsi.PROJECT_ID = P.ID</span><br><span class="line">AND dss.id = cal.sales_id</span><br><span class="line">AND cal.schedule_work_id = wor.id</span><br><span class="line">AND dcs.CHANNEL_CAT_CODE = mpk.POS_KIND_CODE</span><br><span class="line">AND dss.PROJECT_SELLIN_INFO_ID = dpsi.ID</span><br><span class="line">AND dss.DELETE_FLAG = '0'</span><br><span class="line">AND dpsi.CHANNEL_SYNC_ID = dcs.ID</span><br><span class="line">AND LOWER( memp.EMP_S_CODE )= LOWER( dss.SALES_CARD_ID )</span><br><span class="line">AND P.IS_DELETE IS NULL</span><br><span class="line">AND memp.IS_DEL = '0'</span><br><span class="line">AND spp.PRJ_CODE = P.CODE</span><br><span class="line">AND mad.AD_ID = dcs.CHANNEL_ADMIN_DIV_ID</span><br><span class="line">AND mad.IS_DEL = '0'</span><br><span class="line">AND memp.EMP_TYPE = '1001'</span><br><span class="line">AND TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' )&gt;='2018-04-01'</span><br><span class="line">AND TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' )&lt;='2018-04-30'</span><br><span class="line">AND sac.PRJ_CODE = p.CODE</span><br><span class="line">AND sac.POS_CODE = dcs.CHANNEL_CODE</span><br><span class="line">AND sac.EMP_PK = memp.EMP_PK</span><br><span class="line">AND sac.ATT_DATE = TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' )</span><br><span class="line">AND TO_CHAR( sac.CRT_DATE, 'yyyy-mm-dd' )&gt;='2018-04-01'</span><br><span class="line">AND TO_CHAR( sac.CRT_DATE, 'yyyy-mm-dd' )&lt;='2018-04-30'</span><br><span class="line">) prj,</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">ifcl.EMP_PK,</span><br><span class="line">ifcl.COMPARE_DATE,</span><br><span class="line">ifcl.STATUS</span><br><span class="line">FROM</span><br><span class="line">IPG_FACE_COMPARE_LOG ifcl</span><br><span class="line">WHERE</span><br><span class="line">ifcl.HANDLE_TYPE = 0</span><br><span class="line">AND ifcl.DELETE_FLAG = '0'</span><br><span class="line">AND ifcl.COMPARE_TYPE IN(</span><br><span class="line">'1',</span><br><span class="line">'3',</span><br><span class="line">'5'</span><br><span class="line">)</span><br><span class="line">AND ifcl.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">AND ifcl.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">GROUP BY</span><br><span class="line">ifcl.EMP_PK,</span><br><span class="line">ifcl.COMPARE_DATE,</span><br><span class="line">ifcl.STATUS</span><br><span class="line">HAVING</span><br><span class="line">AVG( STATUS )&lt; 1</span><br><span class="line">) ifcl1,</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">*</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">EMP_PK,</span><br><span class="line">COMPARE_DATE,</span><br><span class="line">COMPARE_TYPE,</span><br><span class="line">ROW_NUMBER() OVER(</span><br><span class="line">PARTITION BY EMP_PK,</span><br><span class="line">COMPARE_DATE</span><br><span class="line">ORDER BY</span><br><span class="line">CREATED DESC</span><br><span class="line">) rn</span><br><span class="line">FROM</span><br><span class="line">IPG_FACE_COMPARE_LOG</span><br><span class="line">WHERE</span><br><span class="line">COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">AND COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">AND COMPARE_TYPE IN(</span><br><span class="line">'1',</span><br><span class="line">'3',</span><br><span class="line">'5'</span><br><span class="line">)</span><br><span class="line">) t</span><br><span class="line">WHERE</span><br><span class="line">t.rn &lt;= 1</span><br><span class="line">) ifcl1Staus,</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">SP_LEV_RPT.ATT_SCH_PK,</span><br><span class="line">COUNT(*) AS LEAVECount</span><br><span class="line">FROM</span><br><span class="line">SP_LEV_RPT</span><br><span class="line">WHERE</span><br><span class="line">SP_LEV_RPT.START_TIME IS NOT NULL</span><br><span class="line">GROUP BY</span><br><span class="line">SP_LEV_RPT.ATT_SCH_PK</span><br><span class="line">) levLeave,</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">SP_LEV_RPT.ATT_SCH_PK,</span><br><span class="line">COUNT(*) AS RETURNCount</span><br><span class="line">FROM</span><br><span class="line">SP_LEV_RPT</span><br><span class="line">WHERE</span><br><span class="line">SP_LEV_RPT.END_TIME IS NOT NULL</span><br><span class="line">GROUP BY</span><br><span class="line">SP_LEV_RPT.ATT_SCH_PK</span><br><span class="line">) levRtn,</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">WX_QUESTION.PRJ_ID,</span><br><span class="line">DM_PROJECT.CODE,</span><br><span class="line">'Y' AS STATUS</span><br><span class="line">FROM</span><br><span class="line">WX_QUESTION,</span><br><span class="line">DM_PROJECT</span><br><span class="line">WHERE</span><br><span class="line">DM_PROJECT.ID = WX_QUESTION.PRJ_ID</span><br><span class="line">AND WX_QUESTION.IS_DEL = '0'</span><br><span class="line">AND WX_QUESTION.STATUS = '0'</span><br><span class="line">GROUP BY</span><br><span class="line">WX_QUESTION.PRJ_ID,</span><br><span class="line">DM_PROJECT.CODE</span><br><span class="line">) wq,</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">ifcl.EMP_PK,</span><br><span class="line">ifcl.COMPARE_DATE,</span><br><span class="line">COUNT(*) AS faceCount</span><br><span class="line">FROM</span><br><span class="line">IPG_FACE_COMPARE_LOG ifcl</span><br><span class="line">WHERE</span><br><span class="line">ifcl.HANDLE_TYPE = 0</span><br><span class="line">AND ifcl.COMPARE_TYPE IN(</span><br><span class="line">'1',</span><br><span class="line">'3',</span><br><span class="line">'5'</span><br><span class="line">)</span><br><span class="line">AND ifcl.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">AND ifcl.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">GROUP BY</span><br><span class="line">ifcl.EMP_PK,</span><br><span class="line">ifcl.COMPARE_DATE</span><br><span class="line">) ifaceCount,</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">iface.EMP_PK,</span><br><span class="line">iface.COMPARE_DATE,</span><br><span class="line">wm_concat(</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">NVL( TRIM( T.PAR_VALUE ), TRIM( T.OLD_PAR_VALUE ))</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">PAR_VALUE</span><br><span class="line">FROM</span><br><span class="line">MD_SYS_PARM</span><br><span class="line">WHERE</span><br><span class="line">PAR_CODE = 'OLD_PIC_PATH'</span><br><span class="line">) AS OLD_PAR_VALUE,</span><br><span class="line">PAR_VALUE</span><br><span class="line">FROM</span><br><span class="line">MD_SYS_PARM</span><br><span class="line">WHERE</span><br><span class="line">PAR_CODE = 'ATT_COS_PATH'</span><br><span class="line">) T</span><br><span class="line">)|| REPLACE( SUBSTR( iface.COMPARE_MSG, INSTR( iface.COMPARE_MSG, 'compare', 1, 1 )), ']', '' )</span><br><span class="line">) AS FACE_ATT_IMG</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">ifa.EMP_PK,</span><br><span class="line">ifa.COMPARE_DATE,</span><br><span class="line">ifa.COMPARE_MSG,</span><br><span class="line">RANK() OVER(</span><br><span class="line">PARTITION BY ifa.EMP_PK,</span><br><span class="line">ifa.COMPARE_DATE</span><br><span class="line">ORDER BY</span><br><span class="line">ifa.created DESC</span><br><span class="line">) rankno</span><br><span class="line">FROM</span><br><span class="line">IPG_FACE_COMPARE_LOG ifa</span><br><span class="line">WHERE</span><br><span class="line">ifa.HANDLE_TYPE = 0</span><br><span class="line">AND ifa.COMPARE_TYPE IN(</span><br><span class="line">'1',</span><br><span class="line">'3',</span><br><span class="line">'5'</span><br><span class="line">)</span><br><span class="line">AND INSTR( ifa.COMPARE_MSG, 'compare' )&gt; 0</span><br><span class="line">AND ifa.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">AND ifa.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">) iface</span><br><span class="line">WHERE</span><br><span class="line">iface.rankno &lt;= 3</span><br><span class="line">GROUP BY</span><br><span class="line">iface.EMP_PK,</span><br><span class="line">iface.COMPARE_DATE</span><br><span class="line">) iface2</span><br><span class="line">WHERE</span><br><span class="line">prj.PRJ_NAME ='(2013)è¡Œæ”¿é¡¹ç›®'</span><br><span class="line">AND prj.ATT_DATE &gt;='2018-04-01'</span><br><span class="line">AND prj.ATT_DATE &lt;='2018-04-30'</span><br><span class="line">AND prj.EMP_PK = ifcl1.EMP_PK(+)</span><br><span class="line">AND TO_CHAR( TO_DATE( prj.ATT_DATE, 'yyyy-mm-dd' ), 'yyyymmdd' )= ifcl1.COMPARE_DATE(+)</span><br><span class="line">AND prj.EMP_PK = ifcl1Staus.EMP_PK(+)</span><br><span class="line">AND TO_CHAR( TO_DATE( prj.ATT_DATE, 'yyyy-mm-dd' ), 'yyyymmdd' )= ifcl1Staus.COMPARE_DATE(+)</span><br><span class="line">AND prj.ATT_SCH_PK = levLeave.ATT_SCH_PK(+)</span><br><span class="line">AND prj.ATT_SCH_PK = levRtn.ATT_SCH_PK(+)</span><br><span class="line">AND prj.PRJ_CODE = wq.CODE(+)</span><br><span class="line">AND prj.EMP_PK = ifaceCount.EMP_PK(+)</span><br><span class="line">AND TO_CHAR( TO_DATE( prj.ATT_DATE, 'yyyy-mm-dd' ), 'yyyymmdd' )= ifaceCount.COMPARE_DATE(+)</span><br><span class="line">AND prj.EMP_PK = iface2.EMP_PK(+)</span><br><span class="line">AND TO_CHAR( TO_DATE( prj.sc_schedule_date, 'yyyy-mm-dd' ), 'yyyymmdd' )= iface2.COMPARE_DATE(+)</span><br><span class="line">ORDER BY</span><br><span class="line">APPLY_DATE DESC,</span><br><span class="line">ATTTYPE DESC</span><br></pre></td></tr></table></figure><h2 id="SQLä¼˜åŒ–æ€è·¯"><a href="#SQLä¼˜åŒ–æ€è·¯" class="headerlink" title="SQLä¼˜åŒ–æ€è·¯"></a>SQLä¼˜åŒ–æ€è·¯</h2><p>SQLè¯­å¥è¾ƒå¤æ‚ï¼Œ8ä¸ªå­æŸ¥è¯¢çš„left outer joinï¼Œæ¯ä¸ªå­æŸ¥è¯¢ä¸­åˆæœ‰è¿æ¥ã€‚æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li>ä»å¤–å¾€å†…æ‹†åˆ†å­æŸ¥è¯¢</li><li>è€æ—§å¯¹æ¯”å­æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’å’Œæ‰§è¡Œæ•ˆç‡</li><li>å­æŸ¥è¯¢è¿æ¥ä»1åˆ°2åˆ°3ä¸€ç›´åˆ°8ä¸ªè”æŸ¥å¯¹æ¯”ï¼Œå¯»æ‰¾ç“¶é¢ˆ</li></ol><h3 id="æ‹†åˆ†å­æŸ¥è¯¢"><a href="#æ‹†åˆ†å­æŸ¥è¯¢" class="headerlink" title="æ‹†åˆ†å­æŸ¥è¯¢"></a>æ‹†åˆ†å­æŸ¥è¯¢</h3><table><thead><tr><th>å­æŸ¥è¯¢</th><th>è€åº“ ï¼ˆç§’ï¼‰</th><th>æ–°åº“ï¼ˆç§’ï¼‰</th></tr></thead><tbody><tr><td>prj</td><td>1.182</td><td>0.318</td></tr><tr><td>ifcl1</td><td>14.229</td><td>13.168</td></tr><tr><td>ifclStatus</td><td>15.739</td><td>16.769</td></tr><tr><td>levLeave</td><td>10.147</td><td>9.813</td></tr><tr><td>levRtn</td><td>9.148</td><td>8.3</td></tr><tr><td>wq</td><td>0.141</td><td>0.165</td></tr><tr><td>ifcl1Count</td><td>3.498</td><td>1.966</td></tr><tr><td>iface2</td><td>49.255</td><td>50.897</td></tr></tbody></table><h3 id="å¯»æ‰¾ç“¶é¢ˆ"><a href="#å¯»æ‰¾ç“¶é¢ˆ" class="headerlink" title="å¯»æ‰¾ç“¶é¢ˆ"></a>å¯»æ‰¾ç“¶é¢ˆ</h3><table><thead><tr><th>è¿æ¥</th><th>è€åº“ï¼ˆç§’ï¼‰</th><th>æ–°åº“ï¼ˆç§’ï¼‰</th></tr></thead><tbody><tr><td>prj+ifcl1</td><td>1.522</td><td>1.129</td></tr><tr><td>+ifclStatus</td><td>2.343</td><td>1.957</td></tr><tr><td>+levLeave</td><td>2.525</td><td>1.955</td></tr><tr><td>+levRtn</td><td>2.658</td><td>1.653</td></tr><tr><td>+wq</td><td>2.561</td><td>1.999</td></tr><tr><td>+ifcl1Count</td><td>3.498</td><td>1.966</td></tr><tr><td>+iface2</td><td>11.124</td><td>383</td></tr></tbody></table><p>å‘ç°ç“¶é¢ˆå‡ºç°åœ¨<code>iface2</code></p><h2 id="ä¼˜åŒ–iface2"><a href="#ä¼˜åŒ–iface2" class="headerlink" title="ä¼˜åŒ–iface2"></a>ä¼˜åŒ–iface2</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">iface.EMP_PK,</span><br><span class="line">iface.COMPARE_DATE,</span><br><span class="line">wm_concat(</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">NVL( TRIM( T.PAR_VALUE ), TRIM( T.OLD_PAR_VALUE ))</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">PAR_VALUE</span><br><span class="line">FROM</span><br><span class="line">MD_SYS_PARM</span><br><span class="line">WHERE</span><br><span class="line">PAR_CODE = 'OLD_PIC_PATH'</span><br><span class="line">) AS OLD_PAR_VALUE,</span><br><span class="line">PAR_VALUE</span><br><span class="line">FROM</span><br><span class="line">MD_SYS_PARM</span><br><span class="line">WHERE</span><br><span class="line">PAR_CODE = 'ATT_COS_PATH'</span><br><span class="line">) T</span><br><span class="line">)|| REPLACE( SUBSTR( iface.COMPARE_MSG, INSTR( iface.COMPARE_MSG, 'compare', 1, 1 )), ']', '' )</span><br><span class="line">) AS FACE_ATT_IMG</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">ifa.EMP_PK,</span><br><span class="line">ifa.COMPARE_DATE,</span><br><span class="line">ifa.COMPARE_MSG,</span><br><span class="line">RANK() OVER(</span><br><span class="line">PARTITION BY ifa.EMP_PK,</span><br><span class="line">ifa.COMPARE_DATE</span><br><span class="line">ORDER BY</span><br><span class="line">ifa.created DESC</span><br><span class="line">) rankno</span><br><span class="line">FROM</span><br><span class="line">IPG_FACE_COMPARE_LOG ifa</span><br><span class="line">WHERE</span><br><span class="line">ifa.HANDLE_TYPE = 0</span><br><span class="line">AND ifa.COMPARE_TYPE IN(</span><br><span class="line">'1',</span><br><span class="line">'3',</span><br><span class="line">'5'</span><br><span class="line">)</span><br><span class="line">AND INSTR( ifa.COMPARE_MSG, 'compare' )&gt; 0</span><br><span class="line">AND ifa.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">AND ifa.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">) iface</span><br><span class="line">WHERE</span><br><span class="line">iface.rankno &lt;= 3</span><br><span class="line">GROUP BY</span><br><span class="line">iface.EMP_PK,</span><br><span class="line">iface.COMPARE_DATE</span><br></pre></td></tr></table></figure><p><code>IPG_FACE_COMPARE_LOG</code>è¡¨ä¸­<code>COMPARE_DATEåˆ—</code>éœ€è¦æ–°å¢ç´¢å¼•ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>oracleå°ç‰ˆæœ¬ä¸åŒå¼•èµ·ä¼˜åŒ–å™¨æ— æ³•è·å–ç›¸åŒçš„æ‰§è¡Œè®¡åˆ’</li><li>ç´¢å¼•ç¼ºå¤±æ˜¯æœ¬æ¬¡çš„æ…¢æŸ¥è¯¢çš„ä¸»è¦åŸå› </li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦ï¼šOracleæ•°æ®åº“åšäº†è¿ç§»ï¼Œä»åŸæ¥çš„DGè¿ç§»åˆ°æ–°åº“RACï¼Œå°ç‰ˆæœ¬ä¸åŒï¼›è€åº“ä¸­ç›¸åŒçš„SQLæ‰§è¡Œåªéœ€è¦11ç§’ï¼Œè€Œæ–°åº“éœ€è¦360ç§’ç”šè‡³800å¤šç§’ï¼Œå¦‚ä½•è¿›è¡Œå¤æ‚æŸ¥è¯¢çš„SQLä¼˜åŒ–ï¼Œæœ¬æ–‡æä¾›é€šç”¨çš„ä¸€ä¸ªæ€è·¯ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯å¹¿è§’" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="Oracle" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/Oracle/"/>
    
    
      <category term="SQLä¼˜åŒ–" scheme="http://www.toberoot.com/tags/SQL%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>MySQLä¸€æ¬¡æƒŠå¿ƒåŠ¨é­„åœ°æ•°æ®å¼ºåˆ¶æ¢å¤</title>
    <link href="http://www.toberoot.com/2018/05/17/booboo_others/MySQL%E4%B8%80%E6%AC%A1%E6%83%8A%E5%BF%83%E5%8A%A8%E9%AD%84%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%BC%BA%E5%88%B6%E6%81%A2%E5%A4%8D/"/>
    <id>http://www.toberoot.com/2018/05/17/booboo_others/MySQL%E4%B8%80%E6%AC%A1%E6%83%8A%E5%BF%83%E5%8A%A8%E9%AD%84%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%BC%BA%E5%88%B6%E6%81%A2%E5%A4%8D/</id>
    <published>2018-05-16T19:58:02.000Z</published>
    <updated>2020-03-22T08:32:42.588Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦ï¼šCashæ¢å¤çš„æ­£ç¡®æ–¹å¼æ˜¯ï¼š<strong>å¤‡ä»½æ–‡ä»¶ï¼ˆé€»è¾‘æˆ–ç‰©ç†ï¼‰+ binlog</strong>è¿›è¡Œæ¢å¤ï¼›ç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¿ç»´äººå‘˜éƒ½çŸ¥é“æ€ä¹ˆè¿›è¡Œæ­£ç¡®çš„å¤‡ä»½ï¼Œç”šè‡³è¿é€»è¾‘å¤‡ä»½å’Œç‰©ç†å¤‡ä»½çš„åŒºåˆ«æ˜¯ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Ÿæ›´ä¸çŸ¥é“å¤‡ä»½è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘æ•°æ®çš„ä¸€è‡´æ€§ä¸æœåŠ¡å¯ç”¨æ€§çš„é—®é¢˜ï¼Ÿæˆ–è€…è¿å¤‡ä»½å·¥å…·éƒ½ä¸ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥å½“ä½ é—®ï¼šæœ‰å¤‡ä»½å—ï¼Ÿå›ç­”ï¼šæ²¡æœ‰æˆ–è€…æ— æ•ˆ</p><p>åœ¨æœ¬æ¬¡æ¡ˆä¾‹ä¸­ï¼ŒæŸå®¢æˆ·æ•°æ®åº“å› å­˜å‚¨ç©ºé—´ä¸å¤Ÿå¯¼è‡´æ•°æ®åº“æœåŠ¡å®•æ‰ï¼Œè€Œå®¢æˆ·åœ¨æ•°æ®åº“å®•æœºåï¼Œåªæ‹·è´äº†å•ä¸ª<code>cy</code>åº“æ‰€å±çš„ç›®å½•è¿›è¡Œäº†æ–‡ä»¶å±‚é¢çš„å¤‡ä»½ï¼Œå°±å°†å…¶ä»–æ–‡ä»¶å…¨éƒ¨æ¸…ç©ºï¼Œå½“ä»–æƒ³é‡æ–°å¯åŠ¨æ•°æ®åº“æ—¶å‘ç°æ•°æ®åº“æœåŠ¡å¯åŠ¨ã€‚MySQLä½¿ç”¨5.7.17ç‰ˆæœ¬ï¼Œä½¿ç”¨innodbå­˜å‚¨å¼•æ“ï¼Œå¼€å¯äº†ç‹¬ç«‹è¡¨ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´å½“å‰çš„æ•‘å‘½ç¨»è‰æ˜¯ï¼šæ¯ä¸ªè¡¨çš„<code>.frm</code>å’Œ<code>.ibd</code>æ–‡ä»¶ã€‚</p><a id="more"></a><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>Cashæ¢å¤çš„æ­£ç¡®æ–¹å¼æ˜¯ï¼š<strong>å¤‡ä»½æ–‡ä»¶ï¼ˆé€»è¾‘æˆ–ç‰©ç†ï¼‰+ binlog</strong>è¿›è¡Œæ¢å¤ï¼›ç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¿ç»´äººå‘˜éƒ½çŸ¥é“æ€ä¹ˆè¿›è¡Œæ­£ç¡®çš„å¤‡ä»½ï¼Œç”šè‡³è¿é€»è¾‘å¤‡ä»½å’Œç‰©ç†å¤‡ä»½çš„åŒºåˆ«æ˜¯ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Ÿæ›´ä¸çŸ¥é“å¤‡ä»½è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘æ•°æ®çš„ä¸€è‡´æ€§ä¸æœåŠ¡å¯ç”¨æ€§çš„é—®é¢˜ï¼Ÿæˆ–è€…è¿å¤‡ä»½å·¥å…·éƒ½ä¸ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥å½“ä½ é—®ï¼šæœ‰å¤‡ä»½å—ï¼Ÿå›ç­”ï¼šæ²¡æœ‰æˆ–è€…æ— æ•ˆ</p><p>åœ¨æœ¬æ¬¡æ¡ˆä¾‹ä¸­ï¼ŒæŸå®¢æˆ·åªå¯¹å•ä¸ª<code>cy</code>åº“æ‰€å±çš„ç›®å½•è¿›è¡Œäº†æ–‡ä»¶å±‚é¢çš„å¤‡ä»½ï¼ŒMySQLä½¿ç”¨5.7.17ç‰ˆæœ¬ï¼Œä½¿ç”¨innodbå­˜å‚¨å¼•æ“ï¼Œå¼€å¯äº†ç‹¬ç«‹è¡¨ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´å½“å‰çš„æ•‘å‘½ç¨»è‰æ˜¯ï¼šæ¯ä¸ªè¡¨çš„<code>.frm</code>å’Œ<code>.ibd</code>æ–‡ä»¶ã€‚</p><h2 id="å¼ºåˆ¶è¿˜åŸæ­¥éª¤"><a href="#å¼ºåˆ¶è¿˜åŸæ­¥éª¤" class="headerlink" title="å¼ºåˆ¶è¿˜åŸæ­¥éª¤"></a>å¼ºåˆ¶è¿˜åŸæ­¥éª¤</h2><table><thead><tr><th>æ­¥éª¤</th><th>æè¿°</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>1</td><td><strong>åˆ›å»ºåŒç‰ˆæœ¬çš„MySQLæœåŠ¡å®ä¾‹ä¸€æš</strong></td><td></td></tr><tr><td>2</td><td><strong>è·å–è¡¨çš„åˆ—æ•°</strong></td><td>å¦‚æœæœ‰ddlå¤‡ä»½ç›´æ¥å¯¼å…¥ï¼Œå¯æƒœéƒ½æ˜¯æ²¡æœ‰çš„ï¼Œå“­ã€‚ã€‚ã€‚</td></tr><tr><td>2.1</td><td>åˆ›å»ºåŒåè¡¨ï¼Œç»“æ„æ— æ‰€è°“</td><td>æ•°æ®åº“çš„ä¸–ç•Œä¹Ÿéœ€è¦èº«ä»½è¯ï¼Œå…ˆé€ ä¸ªäººæ‹¿ä¸Šèº«ä»½è¯ï¼Œè‡³äºäººé•¿å¾—å•¥æ ·å‡ æ¡èƒ³è†Šéƒ½æ— æ‰€è°“ï¼Œåå­—æœ€é‡è¦</td></tr><tr><td>2.2</td><td>åœæœåŠ¡ï¼›ä½¿ç”¨å¤‡ä»½çš„frmæ–‡ä»¶è¦†ç›–å½“å‰çš„frm</td><td>å·æ¢æ¢æŸ±</td></tr><tr><td>2.3</td><td>é…ç½®æ–‡ä»¶æ·»åŠ å¼ºåˆ¶æ¢å¤innodbçš„å‚æ•°ï¼›å¯åŠ¨æœåŠ¡</td><td>è’™è”½å¥¹çš„åŒçœ¼</td></tr><tr><td>2.4</td><td>æŸ¥çœ‹è¡¨ç»“æ„</td><td>æ•°æ®åº“ä¼šæ‹¿ç€èº«ä»½è¯å’Œé¢å‰çš„äººï¼ˆfrmæ–‡ä»¶ï¼‰åšå¯¹æ¯”</td></tr><tr><td>2.5</td><td>æŸ¥çœ‹é”™è¯¯æ—¥å¿—ä¸­å…³äºè¯¥è¡¨çš„æŠ¥é”™</td><td>æ•°æ®åº“å‘ç°èº«ä»½è¯ä¸Šçš„äººåªæœ‰1æ¡èƒ³è†Šï¼Œè€Œè¢«æ£€æŸ¥çš„äººæœ‰10æ¡èƒ³è†Šï¼Œæ˜æ˜¾å¯¹ä¸ä¸Šå•Š</td></tr><tr><td>2.6</td><td>æˆåŠŸè·å–è¡¨çš„çœŸå®åˆ—æ•°ï¼›åˆ é™¤è¿™äº›è¡¨</td><td>é€šè¿‡è­¦å‘Šå¯ä»¥çŸ¥é“åº”è¯¥é€ ä¸€ä¸ªæœ‰10æ¡èƒ³è†Šçš„äºº</td></tr><tr><td>3</td><td><strong>è·å–è¡¨çš„ç»“æ„</strong></td><td></td></tr><tr><td>3.1</td><td>åˆ›å»ºåŒåè¡¨ï¼Œåˆ—æ•°ä¸€è‡´ï¼Œåˆ—åæ— æ‰€è°“</td><td>è¿™ä¸€æ¬¡é€ äººçš„æ—¶å€™ï¼Œé€ ä¸€ä¸ªæœ‰10æ¡èƒ³è†Šçš„ï¼Œæ¯æ¡èƒ³è†Šçš„åå­—æ— æ‰€è°“ï¼Œå…³é”®æ˜¯èº«ä»½è¯ä¸Šé¢çš„äººåå’Œ10æ¡èƒ³è†Š</td></tr><tr><td>3.2</td><td>åœæœåŠ¡ï¼›ä½¿ç”¨å¤‡ä»½çš„frmæ–‡ä»¶è¦†ç›–å½“å‰çš„frm</td><td>å·æ¢æ¢æŸ±</td></tr><tr><td>3.3</td><td>é…ç½®æ–‡ä»¶æ·»åŠ å¼ºåˆ¶æ¢å¤innodbçš„å‚æ•°ï¼›å¯åŠ¨æœåŠ¡</td><td>è’™è”½å¥¹çš„åŒçœ¼</td></tr><tr><td>3.4</td><td>æŸ¥çœ‹è¡¨ç»“æ„</td><td>æ•°æ®åº“ä¼šæ‹¿ç€æ–°çš„èº«ä»½è¯å’Œé¢å‰çš„äººï¼ˆfrmæ–‡ä»¶ï¼‰åšå¯¹æ¯”</td></tr><tr><td>3.5</td><td>æˆåŠŸè·å–è¡¨ç»“æ„</td><td>æ•°æ®åº“å‘ç°èº«ä»½è¯ä¸Šä¿¡æ¯å’Œè¢«æ£€æŸ¥çš„äººä¿¡æ¯ä¸€è‡´ï¼Œåå­—ï¼Œèƒ³è†Šçš„æ•°é‡ï¼Œå¯¹ä¸Šäº†å°±è®¤å¯å•¦ï¼ï¼ˆæ•°æ®åº“åªæ£€æŸ¥è¡¨åå’Œåˆ—çš„ä¸ªæ•°ï¼‰</td></tr><tr><td>4</td><td><strong>å¼ºåˆ¶æ¢å¤è¡¨æ•°æ®</strong></td><td></td></tr><tr><td>4.1</td><td>ä¸¢å¼ƒå½“å‰è¡¨çš„æ•°æ®</td><td>æŠŠè¿™ä¸ªäººçš„äº”è„å…­è…‘éƒ½æŒ–å‡ºæ¥</td></tr><tr><td>4.2</td><td>å°†å¤‡ä»½çš„ibdæ”¾åˆ°å¯¹åº”è·¯å¾„</td><td>å°†ä¹‹å‰å¤‡ä»½çš„åƒäº†è‚‰çš„äº”è„å…­è…‘æ”¾è¿›å»</td></tr><tr><td>4.3</td><td>å¯¼å…¥æ–°çš„æ•°æ®ï¼Œå¦‚æœæ•°æ®åº“åŠ è½½æˆåŠŸåˆ™å¯ä»¥çœ‹åˆ°æ•°æ®ï¼›å¦åˆ™åŠ è½½å¤±è´¥ã€‚</td><td>è·Ÿå¤§è„‘æ±‡æŠ¥ä¸€ä¸‹æ–°çš„äº”è„å…­è…‘å·²ç»å°±ä½å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼›å¦‚æœä½¿ç”¨å¾—æ²¡é—®é¢˜å°±æˆåŠŸï¼›å¦‚æœå™¨å®˜å·²ç»æŸåé‚£ä¹ˆæ‰‹æœ¯å¤±è´¥ã€‚</td></tr></tbody></table><h2 id="è¯¦ç»†è¿‡ç¨‹"><a href="#è¯¦ç»†è¿‡ç¨‹" class="headerlink" title="è¯¦ç»†è¿‡ç¨‹"></a>è¯¦ç»†è¿‡ç¨‹</h2><h3 id="æ•°æ®é‡"><a href="#æ•°æ®é‡" class="headerlink" title="æ•°æ®é‡"></a>æ•°æ®é‡</h3><table><thead><tr><th>æ˜ç»†</th><th>å¤§å°</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>ç‰©ç†æ–‡ä»¶</td><td>174M</td><td></td></tr><tr><td>æ•°æ®åº“</td><td>1ä¸ª</td><td>cy</td></tr><tr><td>è¡¨</td><td>57å¼ </td><td></td></tr></tbody></table><h3 id="æ¢å¤ç»“æœ"><a href="#æ¢å¤ç»“æœ" class="headerlink" title="æ¢å¤ç»“æœ"></a>æ¢å¤ç»“æœ</h3><blockquote><p>åœ¨å®¢æˆ·æœåŠ¡å™¨ä¸Šé¢ç»“æœå¦‚ä¸‹ï¼š</p></blockquote><table><thead><tr><th>æ˜ç»†</th><th>æˆåŠŸ</th><th>å¤±è´¥</th><th>æ¢å¤ç‡</th></tr></thead><tbody><tr><td>è¡¨ç»“æ„</td><td>58</td><td>0</td><td>100%</td></tr><tr><td>è¡¨æ•°æ®</td><td>56</td><td>2</td><td>96%</td></tr></tbody></table><blockquote><p>åœ¨æˆ‘çš„æœåŠ¡å™¨ä¸Šé¢ç»“æœå¦‚ä¸‹ï¼š</p></blockquote><table><thead><tr><th>æ˜ç»†</th><th>æˆåŠŸ</th><th>å¤±è´¥</th><th>æ¢å¤ç‡</th></tr></thead><tbody><tr><td>è¡¨ç»“æ„</td><td>58</td><td>0</td><td>100%</td></tr><tr><td>è¡¨æ•°æ®</td><td>58</td><td>0</td><td>100%</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br></pre></td><td class="code"><pre><span class="line">[root@toberoot mysql]# /alidata/mysql/bin/mysqld --initialize-insecure --datadir=/alidata/mysql/data/  --user=mysql</span><br><span class="line">[root@toberoot mysql]# service mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot mysql]# mysql -V</span><br><span class="line">mysql  Ver 14.14 Distrib 5.7.17, for linux-glibc2.5 (x86_64) using  EditLine wrapper</span><br><span class="line"></span><br><span class="line">[root@toberoot mysql]# cd ~/home/cy02/</span><br><span class="line">[root@toberoot cy02]# ll</span><br><span class="line">total 178140</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9022 Aug 14  2017 base_dict.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Mar 14 15:00 base_dict.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8822 Mar  2 11:14 biz_advise.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 14 14:39 biz_advise.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8850 Mar  2 11:14 biz_bank.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Mar  2 11:14 biz_bank.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9580 Mar  2 11:14 biz.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9286 Mar  2 11:14 biz_gift.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Apr 24 14:08 biz_gift.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8890 Mar  2 11:14 biz_gprs_bind.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8745 Mar  2 11:14 biz_gprs_bind_his.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   180224 May 15 09:40 biz_gprs_bind_his.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql   180224 May 15 09:42 biz_gprs_bind.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 14:33 biz.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8845 Aug 14  2017 biz_msg_template.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 biz_msg_template.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8881 Aug 14  2017 biz_take_bank.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 13 19:26 biz_take_bank.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9411 Nov 24 13:22 biz_take.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   196608 May 15 15:22 biz_take.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8862 Aug 14  2017 biz_take_wwlt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 15:22 biz_take_wwlt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8854 Aug 14  2017 biz_take_wx.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 11:52 biz_take_wx.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8925 Aug 14  2017 biz_vip.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Mar 16 09:31 biz_vip.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8852 Aug 14  2017 biz_wlt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 18:30 biz_wlt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8926 Aug 14  2017 biz_wx_focus.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 10 16:24 biz_wx_focus.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9339 Nov 24 13:25 biz_wx.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 10 16:24 biz_wx.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8874 Aug 14  2017 biz_wx_walt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 biz_wx_walt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8776 Aug 14  2017 cfg_area.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   311296 Aug 14  2017 cfg_area.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8721 Aug 14  2017 cfg_id_gen.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 18:41 cfg_id_gen.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql       61 Aug 14  2017 db.opt</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9053 Aug 14  2017 gprs_model.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   212992 May 15 18:47 gprs_model.ibd</span><br><span class="line">-r--r--r-- 1 mysql mysql 79691776 May 16 14:04 ibdata1</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8801 Dec 19 15:00 mbr_coin_chged.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  2097152 May 15 17:27 mbr_coin_chged.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8766 Dec 19 14:53 mbr_coin.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 19:12 mbr_coin.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9155 May 14 11:55 mbr.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   212992 May 15 20:58 mbr.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8876 Aug 14  2017 mbr_oauth.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   475136 May 15 19:37 mbr_oauth.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9011 Aug 14  2017 mbr_pay.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 mbr_pay.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8740 Aug 14  2017 mbr_prizen.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 mbr_prizen.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9147 Dec 19 14:56 mbr_recharge.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   294912 May 15 19:11 mbr_recharge.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8801 Aug 14  2017 mbr_wallet_chged.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9437184 May 15 17:27 mbr_wallet_chged.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8845 Aug 14  2017 mbr_wallet.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   262144 May 15 19:12 mbr_wallet.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql    10100 Dec 19 15:47 ord.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql 31457280 May 15 18:41 ord.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8940 Aug 14  2017 ord_item.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 ord_item.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8917 Aug 14  2017 ord_pay_ali.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 ord_pay_ali.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8924 Dec 19 15:55 ord_pay_coin.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   475136 May 15 17:27 ord_pay_coin.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8926 Aug 14  2017 ord_pay_return.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 ord_pay_return.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8966 Dec 20 16:50 ord_pay_wlt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9437184 May 15 17:27 ord_pay_wlt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9036 Aug 14  2017 ord_pay_wx.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql 32505856 May 15 18:41 ord_pay_wx.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9098 Aug 14  2017 prod_base_args.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_base_args.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8790 Aug 14  2017 prod_bug_rpt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_bug_rpt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8887 Aug 14  2017 prod_cmd.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_cmd.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8984 Aug 14  2017 prod_cmd_invoke.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_cmd_invoke.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9058 Aug 14  2017 prod_coin_rpt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9437184 May 15 14:24 prod_coin_rpt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8798 Aug 14  2017 prod_coin_rpt_log.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 14:24 prod_coin_rpt_log.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9834 Dec 13 14:12 prod.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8835 Aug 14  2017 prod_gprs_bind.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8793 Aug 14  2017 prod_gprs_bind_his.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   196608 May 15 09:42 prod_gprs_bind_his.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_gprs_bind.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql   425984 May 15 09:42 prod.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8851 Aug 14  2017 prod_instl_imgs.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_instl_imgs.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9388 Dec 13 14:13 prod_instl_pos.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   147456 May 15 16:25 prod_instl_pos.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9384 Dec 13 14:14 prod_instl_pos_model.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   131072 May 15 16:24 prod_instl_pos_model.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8892 Aug 14  2017 prod_mod_attr.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_mod_attr.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8873 Aug 14  2017 prod_mod_attr_val.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_mod_attr_val.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9642 Dec 13 14:11 prod_model.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 11 11:58 prod_model.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8815 Aug 14  2017 prod_mod_sku.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_mod_sku.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9050 Aug 14  2017 prod_onl_log.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   163840 May 15 18:42 prod_onl_log.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9143 Aug 14  2017 prod_sp_args.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_sp_args.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8876 Aug 14  2017 prod_sp_arg_vals.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_sp_arg_vals.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9190 Dec 13 14:14 sys_acct.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 14 11:16 sys_acct.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8776 Aug 14  2017 sys_acct_res.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   229376 May 11 11:52 sys_acct_res.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9106 Aug 14  2017 sys_res.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 sys_res.ibd</span><br><span class="line"><span class="meta">#</span><span class="bash">è·å–å¾…æ¢å¤è¡¨å</span></span><br><span class="line">[root@toberoot cy02]# ll *.frm |awk '&#123;print $9&#125;'|awk -F '.' '&#123;print $1&#125;' &gt; /alidata/cy_table.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> pythonè„šæœ¬è‡ªåŠ¨ç”Ÿæˆå»ºè¡¨è¯­å¥</span></span><br><span class="line">[root@toberoot alidata]# cat py_createtable01.py </span><br><span class="line"><span class="meta">#</span><span class="bash">-*- coding : utf8 -*-</span></span><br><span class="line"></span><br><span class="line">def create_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "create table &#123;&#125; (id int);".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    create_table_test('/alidata/cy_table.txt','/alidata/cy_sql1.sql')</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# python /alidata/py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql1.sql </span><br><span class="line">create table base_dict</span><br><span class="line"> (id int);create table biz_advise</span><br><span class="line"> (id int);create table biz_bank</span><br><span class="line"> (id int);create table biz</span><br><span class="line"> (id int);create table biz_gift</span><br><span class="line"> (id int);create table biz_gprs_bind</span><br><span class="line"> (id int);create table biz_gprs_bind_his</span><br><span class="line"> (id int);create table biz_msg_template</span><br><span class="line"> (id int);create table biz_take_bank</span><br><span class="line"> (id int);create table biz_take</span><br><span class="line">çœç•¥ã€‚ã€‚ã€‚</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å…¥æµ‹è¯•è¡¨ç»“æ„</span></span><br><span class="line">[root@toberoot alidata]# mysql -e "show databases"</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">[root@toberoot alidata]# mysql -e "create database cy;"</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; /alidata/cy_sql1.sql </span><br><span class="line">[root@toberoot alidata]# mysql -e "desc cy.sys_res"</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| Field | Type    | Null | Key | Default | Extra |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| id    | int(11) | YES  |     | NULL    |       |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¼€å§‹è·å–è¡¨ç»“æ„ä¸­åˆ—çš„ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# service mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@toberoot alidata]# yes|cp ~/home/cy02/*.frm /alidata/mysql/data/cy/</span><br><span class="line">cp: overwrite â€˜/alidata/mysql/data/cy/base_dict.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_advise.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_bank.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_gift.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_gprs_bind.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_gprs_bind_his.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_msg_template.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take_bank.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take_wwlt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take_wx.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_vip.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wlt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wx_focus.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wx.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wx_walt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/cfg_area.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/cfg_id_gen.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/gprs_model.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_coin_chged.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_coin.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_oauth.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_pay.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_prizen.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_recharge.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_wallet_chged.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_wallet.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_item.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_ali.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_coin.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_return.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_wlt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_wx.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_base_args.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_bug_rpt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_cmd.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_cmd_invoke.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_coin_rpt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_coin_rpt_log.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_gprs_bind.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_gprs_bind_his.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_instl_imgs.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_instl_pos.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_instl_pos_model.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_mod_attr.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_mod_attr_val.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_model.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_mod_sku.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_onl_log.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_sp_args.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_sp_arg_vals.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/sys_acct.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/sys_acct_res.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/sys_res.frmâ€™? [root@toberoot alidata]# </span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# cat py_createtable01.py </span><br><span class="line"><span class="meta">#</span><span class="bash">-*- coding : utf8 -*-</span></span><br><span class="line"></span><br><span class="line">def create_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "create table &#123;&#125; (id int);".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line">   </span><br><span class="line">def desc_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "desc &#123;&#125;;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close()</span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    #create_table_test('/alidata/cy_table.txt','/alidata/cy_sql1.sql')</span><br><span class="line">    desc_table_test('/alidata/cy_table.txt','/alidata/cy_sql2.sql')</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# python py_createtable01.py</span><br><span class="line">[root@toberoot alidata]# head cy_sql2.sql </span><br><span class="line">desc base_dict</span><br><span class="line">;desc biz_advise</span><br><span class="line">;desc biz_bank</span><br><span class="line">;desc biz</span><br><span class="line">;desc biz_gift</span><br><span class="line">;desc biz_gprs_bind</span><br><span class="line">;desc biz_gprs_bind_his</span><br><span class="line">;desc biz_msg_template</span><br><span class="line">;desc biz_take_bank</span><br><span class="line">;desc biz_take</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆªå–åŒ…å«åˆ—åçš„æŠ¥é”™</span></span><br><span class="line">[root@toberoot alidata]# grep contains  mysql/dataerror.log &gt; cy_error1.log</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠ¥é”™æ ¼å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">2018-05-17T07:58:32.926555Z 3 [Warning] InnoDB: Table cy/base_dict contains 1 user defined columns in InnoDB, but 11 columns in MySQL. Please check INFORMATION_SCHEMA.INNODB_SYS_COLUMNS and http://dev.mysql.com/doc/refman/5.7/en/innodb-troubleshooting.html for how to resolve the issue.</span><br><span class="line">2018-05-17T07:59:03.555492Z 4 [Warning] InnoDB: Table cy/biz_advise contains 1 user defined columns in InnoDB, but 7 columns in MySQL. Please check INFORMATION_SCHEMA.INNODB_SYS_COLUMNS and http://dev.mysql.com/doc/refman/5.7/en/innodb-troubleshooting.html for how to resolve the issue.</span><br><span class="line">2018-05-17T07:59:03.556045Z 4 [Warning] InnoDB: Table cy/biz_bank contains 1 user defined columns in InnoDB, but 7 columns in MySQL. Please check INFORMATION_SCHEMA.INNODB_SYS_COLUMNS and http://dev.mysql.com/doc/refman/5.7/en/innodb-troubleshooting.html for how to resolve the issue.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†è¡¨åå’Œåˆ—æ•°å­˜æ”¾è‡³æ–‡ä»¶ä¸­</span></span><br><span class="line">[root@toberoot alidata]# awk '&#123;print $6,$15&#125;' cy_error1.log | awk -F '/' '&#123;print $2&#125;' &gt; cy_table_col.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ ¹æ®ä»¥ä¸Šè¡¨åå’Œåˆ—æ•°ç”Ÿæˆæ–°çš„æµ‹è¯•è¡¨</span></span><br><span class="line">def create_table_col(table_col_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_col_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    # b_list = ['t1 10','t2 20']</span><br><span class="line">    str_list = []</span><br><span class="line">    for table_col_str in b_list:</span><br><span class="line">        table_col_list = table_col_str.split()</span><br><span class="line">table = table_col_list[0]</span><br><span class="line">col = int(table_col_list[1])</span><br><span class="line">        string = "create table &#123;&#125; (".format(table)</span><br><span class="line">        str_list.append(string)</span><br><span class="line">for i in range(1,col+1):</span><br><span class="line">            if i!=col:</span><br><span class="line">                string = 'id&#123;&#125; int,'.format(i)</span><br><span class="line">    else:</span><br><span class="line">                string = 'id&#123;&#125; int);'.format(i)</span><br><span class="line">            str_list.append(string)</span><br><span class="line">    for line in str_list:</span><br><span class="line">        a_file.write(line)</span><br><span class="line">    a_file.close()</span><br><span class="line"></span><br><span class="line">create_table_col('/alidata/cy_table_col.txt','/alidata/cy_sql3.sql')</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤è¿™äº›æµ‹è¯•è¡¨</span></span><br><span class="line">[root@toberoot alidata]# vim py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# python py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# ll</span><br><span class="line">total 60</span><br><span class="line">-rw-r--r--  1 root  root  16729 May 17 16:00 cy_error1.log</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 15:12 cy_sql1.sql</span><br><span class="line">-rw-r--r--  1 root  root   1047 May 17 15:56 cy_sql2.sql</span><br><span class="line">-rw-r--r--  1 root  root   6353 May 17 16:15 cy_sql3.sql</span><br><span class="line">-rw-r--r--  1 root  root   1395 May 17 16:17 cy_sql4.sql</span><br><span class="line">-rw-r--r--  1 root  root    837 May 17 16:03 cy_table_col.txt</span><br><span class="line">-rw-r--r--  1 root  root    699 May 17 15:56 cy_table.txt</span><br><span class="line">drwxr-xr-x  3 root  root   4096 May 17 12:12 install</span><br><span class="line">drwxr-xr-x 11 mysql mysql  4096 May 17 15:44 mysql</span><br><span class="line">-rw-r--r--  1 root  root   1798 May 17 16:17 py_createtable01.py</span><br><span class="line"><span class="meta">#</span><span class="bash">pythonä»£ç å¦‚ä¸‹ï¼š</span></span><br><span class="line">def drop_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "drop table &#123;&#125;;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close()</span><br><span class="line"></span><br><span class="line">drop_table_test('/alidata/cy_table.txt','/alidata/cy_sql4.sql')</span><br><span class="line">    </span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql4.sql </span><br><span class="line">drop table base_dict</span><br><span class="line">;drop table biz_advise</span><br><span class="line">;drop table biz_bank</span><br><span class="line">;drop table biz</span><br><span class="line">;drop table biz_gift</span><br><span class="line">;drop table biz_gprs_bind</span><br><span class="line">;drop table biz_gprs_bind_his</span><br><span class="line">;drop table biz_msg_template</span><br><span class="line">;drop table biz_take_bank</span><br><span class="line">;drop table biz_take</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ é™¤æ•°æ®åº“çš„æ—¶å€™ç›´æ¥å¡æ­»äº†ï¼ŒåŸå› æœªçŸ¥ã€‚ä¹Ÿæ²¡æœ‰æŠ¥é”™ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash">æ¸…æ•°æ®å¯åŠ¨æœåŠ¡</span></span><br><span class="line"></span><br><span class="line">ln: failed to create symbolic link â€˜/usr/local/mysql/bin/mysqldâ€™: File exists</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot ~]# mysql -e 'create database cy'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¼€å§‹å°è¯•è·å–è¡¨çš„ç»“æ„</span></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql3.sql</span><br><span class="line">[root@toberoot alidata]# service mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@toberoot alidata]# cp ~/home/cy02/*.frm /alidata/mysql/data/cy/ -p</span><br><span class="line">cp: overwrite â€˜/alidata/mysql/data/cy/base_dict.frmâ€™? ^C</span><br><span class="line">[root@toberoot alidata]# yes | cp ~/home/cy02/*.frm /alidata/mysql/data/cy/ -p</span><br><span class="line">[root@toberoot alidata]# ll /alidata/mysql/data/cy/sys_res*</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9106 Aug 14  2017 /alidata/mysql/data/cy/sys_res.frm</span><br><span class="line">-rw-r----- 1 mysql mysql 98304 May 17 16:44 /alidata/mysql/data/cy/sys_res.ibd</span><br><span class="line"><span class="meta">#</span><span class="bash"> é…ç½®æ–‡ä»¶</span></span><br><span class="line">[mysqld]</span><br><span class="line">innodb_force_recovery=6</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# service mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¡¨ç»“æ„æˆåŠŸè·å–</span></span><br><span class="line">[root@toberoot alidata]# mysql cy -e 'desc sys_res'</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type         | Null | Key | Default | Extra |</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">| ID     | varchar(64)  | NO   | PRI | NULL    |       |</span><br><span class="line">| NAME   | varchar(32)  | NO   |     | NULL    |       |</span><br><span class="line">| CODE   | varchar(128) | NO   |     | NULL    |       |</span><br><span class="line">| URI    | varchar(128) | NO   |     | NULL    |       |</span><br><span class="line">| LOGO   | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| TYPE   | int(11)      | NO   |     | NULL    |       |</span><br><span class="line">| PCODE  | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| SORT   | int(11)      | YES  |     | 0       |       |</span><br><span class="line">| STATE  | int(11)      | NO   |     | NULL    |       |</span><br><span class="line">| ADMIN  | int(11)      | YES  |     | 0       |       |</span><br><span class="line">| REMARK | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| CRTIME | datetime     | NO   |     | NULL    |       |</span><br><span class="line">| UPTIME | datetime     | NO   |     | NULL    |       |</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">root@MySQL-01 16:49:  [(none)]&gt; select table_name,table_schema from information_schema.tables where table_schema='cy';</span><br><span class="line">+----------------------+--------------+</span><br><span class="line">| table_name           | table_schema |</span><br><span class="line">+----------------------+--------------+</span><br><span class="line">| base_dict            | cy           |</span><br><span class="line">| biz                  | cy           |</span><br><span class="line">| biz_advise           | cy           |</span><br><span class="line">| biz_bank             | cy           |</span><br><span class="line">| biz_gift             | cy           |</span><br><span class="line">| biz_gprs_bind        | cy           |</span><br><span class="line">| biz_gprs_bind_his    | cy           |</span><br><span class="line">| biz_msg_template     | cy           |</span><br><span class="line">| biz_take             | cy           |</span><br><span class="line">| biz_take_bank        | cy           |</span><br><span class="line">| biz_take_wwlt        | cy           |</span><br><span class="line">| biz_take_wx          | cy           |</span><br><span class="line">| biz_vip              | cy           |</span><br><span class="line">| biz_wlt              | cy           |</span><br><span class="line">| biz_wx               | cy           |</span><br><span class="line">| biz_wx_focus         | cy           |</span><br><span class="line">| biz_wx_walt          | cy           |</span><br><span class="line">| cfg_area             | cy           |</span><br><span class="line">| cfg_id_gen           | cy           |</span><br><span class="line">| gprs_model           | cy           |</span><br><span class="line">| mbr                  | cy           |</span><br><span class="line">| mbr_coin             | cy           |</span><br><span class="line">| mbr_coin_chged       | cy           |</span><br><span class="line">| mbr_oauth            | cy           |</span><br><span class="line">| mbr_pay              | cy           |</span><br><span class="line">| mbr_prizen           | cy           |</span><br><span class="line">| mbr_recharge         | cy           |</span><br><span class="line">| mbr_wallet           | cy           |</span><br><span class="line">| mbr_wallet_chged     | cy           |</span><br><span class="line">| ord                  | cy           |</span><br><span class="line">| ord_item             | cy           |</span><br><span class="line">| ord_pay_ali          | cy           |</span><br><span class="line">| ord_pay_coin         | cy           |</span><br><span class="line">| ord_pay_return       | cy           |</span><br><span class="line">| ord_pay_wlt          | cy           |</span><br><span class="line">| ord_pay_wx           | cy           |</span><br><span class="line">| prod                 | cy           |</span><br><span class="line">| prod_base_args       | cy           |</span><br><span class="line">| prod_bug_rpt         | cy           |</span><br><span class="line">| prod_cmd             | cy           |</span><br><span class="line">| prod_cmd_invoke      | cy           |</span><br><span class="line">| prod_coin_rpt        | cy           |</span><br><span class="line">| prod_coin_rpt_log    | cy           |</span><br><span class="line">| prod_gprs_bind       | cy           |</span><br><span class="line">| prod_gprs_bind_his   | cy           |</span><br><span class="line">| prod_instl_imgs      | cy           |</span><br><span class="line">| prod_instl_pos       | cy           |</span><br><span class="line">| prod_instl_pos_model | cy           |</span><br><span class="line">| prod_mod_attr        | cy           |</span><br><span class="line">| prod_mod_attr_val    | cy           |</span><br><span class="line">| prod_mod_sku         | cy           |</span><br><span class="line">| prod_model           | cy           |</span><br><span class="line">| prod_onl_log         | cy           |</span><br><span class="line">| prod_sp_arg_vals     | cy           |</span><br><span class="line">| prod_sp_args         | cy           |</span><br><span class="line">| sys_acct             | cy           |</span><br><span class="line">| sys_acct_res         | cy           |</span><br><span class="line">| sys_res              | cy           |</span><br><span class="line">+----------------------+--------------+</span><br><span class="line">58 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 58å¼ è¡¨dumpå¤‡ä»½å‡ºæ¥</span></span><br><span class="line">[root@toberoot alidata]# mysqldump -B cy -d &gt; /alidata/new_yc_ddl.sql</span><br><span class="line">[root@toberoot alidata]# tail -n 30 /alidata/new_yc_ddl.sql </span><br><span class="line">/*!40101 SET @saved_cs_client     = @@character_set_client */;</span><br><span class="line">/*!40101 SET character_set_client = utf8 */;</span><br><span class="line">CREATE TABLE `sys_res` (</span><br><span class="line">  `ID` varchar(64) NOT NULL COMMENT 'ID',</span><br><span class="line">  `NAME` varchar(32) NOT NULL COMMENT 'èœå•åç§°',</span><br><span class="line">  `CODE` varchar(128) NOT NULL COMMENT 'èœå•ç¼–ç ',</span><br><span class="line">  `URI` varchar(128) NOT NULL COMMENT 'URI',</span><br><span class="line">  `LOGO` varchar(64) DEFAULT NULL COMMENT 'å›¾æ ‡',</span><br><span class="line">  `TYPE` int(11) NOT NULL COMMENT '@èœå•ç±»å‹ï¼ˆ1èœå•ï¼›2æŒ‰é’®ï¼‰',</span><br><span class="line">  `PCODE` varchar(64) DEFAULT NULL COMMENT 'çˆ¶èœå•',</span><br><span class="line">  `SORT` int(11) DEFAULT '0' COMMENT 'æ’åº',</span><br><span class="line">  `STATE` int(11) NOT NULL COMMENT '@@çŠ¶æ€ï¼ˆ0 æ— æ•ˆï¼›1 æ­£å¸¸ï¼‰',</span><br><span class="line">  `ADMIN` int(11) DEFAULT '0' COMMENT 'æ˜¯å¦ç®¡ç†å‘˜èœå•ï¼ˆé»˜è®¤0å¦ï¼‰',</span><br><span class="line">  `REMARK` varchar(64) DEFAULT NULL COMMENT 'å¤‡æ³¨',</span><br><span class="line">  `CRTIME` datetime NOT NULL COMMENT 'CRTIME',</span><br><span class="line">  `UPTIME` datetime NOT NULL COMMENT 'UPTIME',</span><br><span class="line">  PRIMARY KEY (`ID`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='æƒé™_ç³»ç»Ÿèµ„æº';</span><br><span class="line">/*!40101 SET character_set_client = @saved_cs_client */;</span><br><span class="line">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;</span><br><span class="line"></span><br><span class="line">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;</span><br><span class="line">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;</span><br><span class="line">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;</span><br><span class="line">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;</span><br><span class="line">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;</span><br><span class="line">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;</span><br><span class="line">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;</span><br><span class="line"></span><br><span class="line">-- Dump completed on 2018-05-17 16:52:28</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> discardå’Œimportå‘½ä»¤</span></span><br><span class="line">def discard_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "alter table &#123;&#125; discard tablespace;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def import_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "alter table &#123;&#125; import tablespace;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">discard_table_test('/alidata/cy_table.txt','/alidata/cy_sql5.sql')</span><br><span class="line">import_table_test('/alidata/cy_table.txt','/alidata/cy_sql6.sql')</span><br><span class="line">   </span><br><span class="line"><span class="meta">#</span><span class="bash"> ç”Ÿæˆsql</span></span><br><span class="line">[root@toberoot alidata]# python py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# ll</span><br><span class="line">total 124</span><br><span class="line">-rw-r--r--  1 root  root  16729 May 17 16:00 cy_error1.log</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 15:12 cy_sql1.sql</span><br><span class="line">-rw-r--r--  1 root  root   1047 May 17 15:56 cy_sql2.sql</span><br><span class="line">-rw-r--r--  1 root  root   6353 May 17 16:15 cy_sql3.sql</span><br><span class="line">-rw-r--r--  1 root  root   1395 May 17 16:17 cy_sql4.sql</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 16:55 cy_sql5.sql</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 16:55 cy_sql6.sql</span><br><span class="line">-rw-r--r--  1 root  root    837 May 17 16:03 cy_table_col.txt</span><br><span class="line">-rw-r--r--  1 root  root    699 May 17 15:56 cy_table.txt</span><br><span class="line">drwxr-xr-x  3 root  root   4096 May 17 16:41 install</span><br><span class="line">drwxr-xr-x 11 mysql mysql  4096 May 17 16:47 mysql</span><br><span class="line">-rw-r--r--  1 root  root  57068 May 17 16:52 new_yc_ddl.sql</span><br><span class="line">-rw-r--r--  1 root  root   2489 May 17 16:55 py_createtable01.py</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql5.sql </span><br><span class="line">alter table base_dict</span><br><span class="line"> discard tablespace;alter table biz_advise</span><br><span class="line"> discard tablespace;alter table biz_bank</span><br><span class="line"> discard tablespace;alter table biz</span><br><span class="line"> discard tablespace;alter table biz_gift</span><br><span class="line"> discard tablespace;alter table biz_gprs_bind</span><br><span class="line"> discard tablespace;alter table biz_gprs_bind_his</span><br><span class="line"> discard tablespace;alter table biz_msg_template</span><br><span class="line"> discard tablespace;alter table biz_take_bank</span><br><span class="line"> discard tablespace;alter table biz_take</span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql6.sql </span><br><span class="line">alter table base_dict</span><br><span class="line"> import tablespace;alter table biz_advise</span><br><span class="line"> import tablespace;alter table biz_bank</span><br><span class="line"> import tablespace;alter table biz</span><br><span class="line"> import tablespace;alter table biz_gift</span><br><span class="line"> import tablespace;alter table biz_gprs_bind</span><br><span class="line"> import tablespace;alter table biz_gprs_bind_his</span><br><span class="line"> import tablespace;alter table biz_msg_template</span><br><span class="line"> import tablespace;alter table biz_take_bank</span><br><span class="line"> import tablespace;alter table biz_take</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql</span><br><span class="line">ERROR 1036 (HY000) at line 1: Table 'base_dict' is read only</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# service mysqld restart</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# cp /root/home/cy02/*.ibd /alidata/mysql/data/cy/ -rp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line">ERROR 2013 (HY000) at line 1: Lost connection to MySQL server during query</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# service mysqld restart</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line">ERROR 1036 (HY000) at line 1: Table 'base_dict' is read only</span><br><span class="line">[root@toberoot alidata]# service mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@toberoot alidata]# rm -rf /alidata/mysql/data/*</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# service mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot alidata]# mysql &lt; new_yc_ddl.sql </span><br><span class="line">[root@toberoot alidata]# mysql -e 'use cy;select * from sys_res'</span><br><span class="line"></span><br><span class="line">å¼€å¯å¼ºåˆ¶æ¢å¤å‚æ•°</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql</span><br><span class="line">cy_sql1.sql  cy_sql2.sql  cy_sql3.sql  cy_sql4.sql  cy_sql5.sql  cy_sql6.sql  </span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql </span><br><span class="line">[root@toberoot alidata]# cp /root/home/cy02/*.ibd /alidata/mysql/data/cy/ -rp</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å…¨å¤‡ä»½æ•°æ®</span></span><br><span class="line">[root@toberoot alidata]# mysqldump -B cy &gt; new_cy_all.sql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å¤‡ä»½çš„æ•°æ®é‡</span></span><br><span class="line">-rw-r--r--  1 root  root   26M May 17 17:13 new_cy_all.sql</span><br></pre></td></tr></table></figure><h2 id="æŠ¥é”™æ±‡æ€»"><a href="#æŠ¥é”™æ±‡æ€»" class="headerlink" title="æŠ¥é”™æ±‡æ€»"></a>æŠ¥é”™æ±‡æ€»</h2><h3 id="ERROR-1036-ï¼ˆHY00ï¼‰"><a href="#ERROR-1036-ï¼ˆHY00ï¼‰" class="headerlink" title="ERROR 1036 ï¼ˆHY00ï¼‰"></a>ERROR 1036 ï¼ˆHY00ï¼‰</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql</span><br><span class="line">ERROR 1036 (HY000) at line 1: Table 'base_dict' is read only</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•ï¼š</p><ol><li>æ£€æŸ¥æ˜¯å¦é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨innodb_force_recoveryå‚æ•°</li><li>å¦‚æœå­˜åœ¨å»é™¤æˆ–æ³¨é‡Šæ‰ï¼Œé‡å¯æœåŠ¡å³å¯</li><li>è¿˜ä¸è¡Œå°±æ¸…ç©ºæ•°æ®åº“å¯¼å…¥ç»“æ„åå†ç»§ç»­</li></ol><h3 id="ERROR-2013-HY000"><a href="#ERROR-2013-HY000" class="headerlink" title="ERROR 2013 (HY000)"></a>ERROR 2013 (HY000)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line">ERROR 2013 (HY000) at line 1: Lost connection to MySQL server during query</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•ï¼š</p><ol><li><p>sqlè„šæœ¬ä¸­æ‰§è¡Œimport tablespaceçš„æ“ä½œéœ€è¦å¼€å¯recoveryçš„å‚æ•°</p></li><li><p>é‡å¯æœåŠ¡ </p><p>åœ¨å®¢æˆ·æœåŠ¡ä¸Šï¼Œæ‰§è¡Œä»¥ä¸Šæ“ä½œè¿˜æ˜¯æŠ¥é”™æ— æ³•è¿æ¥ï¼Œå°è¯•å¤šæ¬¡éƒ½ä¸è¡Œã€‚</p></li></ol><p><img src="MySQL%E4%B8%80%E6%AC%A1%E6%83%8A%E5%BF%83%E5%8A%A8%E9%AD%84%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%BC%BA%E5%88%B6%E6%81%A2%E5%A4%8D/04.jpg" alt=""></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ¬¡caseçš„æ•™è®­å°±æ˜¯ï¼Œå¤‡ä»½ï¼ä¸€å®šè¦æœ‰å‘¨æœŸæ€§çš„æœ‰æ•ˆå¤‡ä»½ï¼</p><p>æ¬ºéª—MySQLè¿›ç¨‹è’™æ··è¿‡å…³åªèƒ½æ˜¯æ²¡åŠæ³•çš„åŠæ³•ï¼Œè€Œä¸”ä¸èƒ½ä¿è¯æˆåŠŸç‡ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -*- coding : utf8 -*-</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> py_createtable01.py</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> authï¼š booboowei</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class mysql_tools():</span><br><span class="line">    def __init__(self, in_file):</span><br><span class="line">        self.b_list = open(in_file).readlines()</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">    def create_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "create table &#123;&#125; (id int);".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def desc_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "desc &#123;&#125;;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def create_table_col(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        str_list = []</span><br><span class="line">        for table_col_str in self.b_list:</span><br><span class="line">            table_col_list = table_col_str.split()</span><br><span class="line">            table = table_col_list[0]</span><br><span class="line">            col = int(table_col_list[1])</span><br><span class="line">            string = "create table &#123;&#125; (".format(table)</span><br><span class="line">            str_list.append(string)</span><br><span class="line">            for i in range(1, col + 1):</span><br><span class="line">                if i != col:</span><br><span class="line">                    string = 'id&#123;&#125; int,'.format(i)</span><br><span class="line">                else:</span><br><span class="line">                    string = 'id&#123;&#125; int);'.format(i)</span><br><span class="line">                str_list.append(string)</span><br><span class="line">        for line in str_list:</span><br><span class="line">            a_file.write(line)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def drop_table_test(self,  sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "drop table &#123;&#125;;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def discard_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "alter table &#123;&#125; discard tablespace;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def import_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "alter table &#123;&#125; import tablespace;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').create_table_test('/alidata/cy_sql1.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').desc_table_test('/alidata/cy_sql2.sql')</span><br><span class="line">    # æ ¹æ®ä»¥ä¸Šè¡¨åå’Œåˆ—æ•°ç”Ÿæˆæ–°çš„æµ‹è¯•è¡¨</span><br><span class="line">    mysql_tools('/alidata/cy_table_col.txt').create_table_col('/alidata/cy_sql3.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').drop_table_test('/alidata/cy_sql4.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').discard_table_test('/alidata/cy_sql5.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').import_table_test('/alidata/cy_sql6.sql')</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦ï¼šCashæ¢å¤çš„æ­£ç¡®æ–¹å¼æ˜¯ï¼š&lt;strong&gt;å¤‡ä»½æ–‡ä»¶ï¼ˆé€»è¾‘æˆ–ç‰©ç†ï¼‰+ binlog&lt;/strong&gt;è¿›è¡Œæ¢å¤ï¼›ç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¿ç»´äººå‘˜éƒ½çŸ¥é“æ€ä¹ˆè¿›è¡Œæ­£ç¡®çš„å¤‡ä»½ï¼Œç”šè‡³è¿é€»è¾‘å¤‡ä»½å’Œç‰©ç†å¤‡ä»½çš„åŒºåˆ«æ˜¯ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Ÿæ›´ä¸çŸ¥é“å¤‡ä»½è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘æ•°æ®çš„ä¸€è‡´æ€§ä¸æœåŠ¡å¯ç”¨æ€§çš„é—®é¢˜ï¼Ÿæˆ–è€…è¿å¤‡ä»½å·¥å…·éƒ½ä¸ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥å½“ä½ é—®ï¼šæœ‰å¤‡ä»½å—ï¼Ÿå›ç­”ï¼šæ²¡æœ‰æˆ–è€…æ— æ•ˆ&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬æ¬¡æ¡ˆä¾‹ä¸­ï¼ŒæŸå®¢æˆ·æ•°æ®åº“å› å­˜å‚¨ç©ºé—´ä¸å¤Ÿå¯¼è‡´æ•°æ®åº“æœåŠ¡å®•æ‰ï¼Œè€Œå®¢æˆ·åœ¨æ•°æ®åº“å®•æœºåï¼Œåªæ‹·è´äº†å•ä¸ª&lt;code&gt;cy&lt;/code&gt;åº“æ‰€å±çš„ç›®å½•è¿›è¡Œäº†æ–‡ä»¶å±‚é¢çš„å¤‡ä»½ï¼Œå°±å°†å…¶ä»–æ–‡ä»¶å…¨éƒ¨æ¸…ç©ºï¼Œå½“ä»–æƒ³é‡æ–°å¯åŠ¨æ•°æ®åº“æ—¶å‘ç°æ•°æ®åº“æœåŠ¡å¯åŠ¨ã€‚MySQLä½¿ç”¨5.7.17ç‰ˆæœ¬ï¼Œä½¿ç”¨innodbå­˜å‚¨å¼•æ“ï¼Œå¼€å¯äº†ç‹¬ç«‹è¡¨ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´å½“å‰çš„æ•‘å‘½ç¨»è‰æ˜¯ï¼šæ¯ä¸ªè¡¨çš„&lt;code&gt;.frm&lt;/code&gt;å’Œ&lt;code&gt;.ibd&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯å¹¿è§’" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="æ•°æ®æ•‘æ´" scheme="http://www.toberoot.com/tags/%E6%95%B0%E6%8D%AE%E6%95%91%E6%8F%B4/"/>
    
  </entry>
  
  <entry>
    <title>MySQLçš„å…ƒé”MDLå‘ç”Ÿåœºæ™¯å’Œè§£å†³æ–¹æ³•æ€»ç»“</title>
    <link href="http://www.toberoot.com/2017/08/19/booboo_others/MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/"/>
    <id>http://www.toberoot.com/2017/08/19/booboo_others/MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/</id>
    <published>2017-08-18T20:06:27.000Z</published>
    <updated>2020-03-22T08:32:42.577Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦ï¼šMetaData Lockå³å…ƒæ•°æ®é”ï¼Œåœ¨æ•°æ®åº“ä¸­å…ƒæ•°æ®å³æ•°æ®å­—å…¸ä¿¡æ¯åŒ…æ‹¬db,table,function,procedure,trigger,eventç­‰ã€‚metadata lockä¸»è¦ä¸ºäº†ä¿è¯å…ƒæ•°æ®çš„ä¸€è‡´æ€§,ç”¨äºå¤„ç†ä¸åŒçº¿ç¨‹æ“ä½œåŒä¸€æ•°æ®å¯¹è±¡çš„åŒæ­¥ä¸äº’æ–¥é—®é¢˜ã€‚</p><p>ä»Šå¤©æœ‰å®¢æˆ·(MySQL 5.6)é‡åˆ°è¯¥é—®é¢˜ï¼Œæœ€å…³é”®çš„æ˜¯å±äºç¬¬ä¸‰ç§æƒ…å†µï¼Œgoogleä¸Šæ ¹æœ¬æ‰¾ä¸åˆ°ç±»ä¼¼çš„æ•…éšœæ¡ˆä¾‹ï¼Œå”¯ä¸€ä¸€ä¸ªéå¸¸æ¥è¿‘çš„æ•…éšœæ¡ˆä¾‹ä¸­æ•°æ®åº“ç‰ˆæœ¬å´ä¸åŒï¼ˆå…·ä½“çœ‹ä¸‹æ–‡æ…¢æ…¢èŠï¼‰ï¼Œå“ï¼Œå›°éš¾é‡é‡å•Šï¼Œæœ€ç»ˆè¿˜æ˜¯è§£å†³äº†å“ˆã€‚</p><p>alter tableçš„è¯­å¥æ˜¯å¾ˆå±é™©çš„ï¼Œåœ¨æ“ä½œä¹‹å‰æœ€å¥½ç¡®è®¤å¯¹è¦æ“ä½œçš„è¡¨æ²¡æœ‰ä»»ä½•è¿›è¡Œä¸­çš„æ“ä½œã€æ²¡æœ‰æœªæäº¤äº‹åŠ¡ã€ä¹Ÿæ²¡æœ‰æ˜¾å¼äº‹åŠ¡ä¸­çš„æŠ¥é”™è¯­å¥ã€‚å¦‚æœæœ‰alter tableçš„ç»´æŠ¤ä»»åŠ¡ï¼Œåœ¨æ— äººç›‘ç®¡çš„æ—¶å€™è¿è¡Œï¼Œæœ€å¥½é€šè¿‡lock_wait_timeoutè®¾ç½®å¥½è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´çš„metedataé”ç­‰å¾…ã€‚</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯metadata-lockï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯metadata-lockï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯metadata lockï¼Ÿ"></a>ä»€ä¹ˆæ˜¯metadata lockï¼Ÿ</h2><p>MetaData Lockå³å…ƒæ•°æ®é”ï¼Œåœ¨æ•°æ®åº“ä¸­å…ƒæ•°æ®å³æ•°æ®å­—å…¸ä¿¡æ¯åŒ…æ‹¬db,table,function,procedure,trigger,eventç­‰ã€‚metadata lockä¸»è¦ä¸ºäº†ä¿è¯å…ƒæ•°æ®çš„ä¸€è‡´æ€§,ç”¨äºå¤„ç†ä¸åŒçº¿ç¨‹æ“ä½œåŒä¸€æ•°æ®å¯¹è±¡çš„åŒæ­¥ä¸äº’æ–¥é—®é¢˜ã€‚</p><h3 id="MetaData-Lockçš„å‰ä¸–ä»Šç”Ÿ"><a href="#MetaData-Lockçš„å‰ä¸–ä»Šç”Ÿ" class="headerlink" title="MetaData Lockçš„å‰ä¸–ä»Šç”Ÿ"></a><strong>MetaData Lockçš„å‰ä¸–ä»Šç”Ÿ</strong></h3><p>MDLé”æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªæœ‰åçš„<a href="https://bugs.mysql.com/bug.php?id=989" target="_blank" rel="noopener">bug#989</a>ï¼Œæ‰€ä»¥åœ¨5.5.3ç‰ˆæœ¬å¼•å…¥äº†MDLé”ã€‚å…¶å®5.5ä¹Ÿæœ‰ç±»ä¼¼ä¿æŠ¤å…ƒæ•°æ®çš„æœºåˆ¶ï¼Œåªæ˜¯æ²¡æœ‰æ˜ç¡®æå‡ºMDLæ¦‚å¿µè€Œå·²ã€‚ä½†æ˜¯5.5ä¹‹å‰ç‰ˆæœ¬(æ¯”å¦‚5.1)ä¸5.5ä¹‹åç‰ˆæœ¬åœ¨ä¿æŠ¤å…ƒæ•°æ®è¿™å—æœ‰ä¸€ä¸ªæ˜¾è‘—çš„ä¸åŒç‚¹æ˜¯ï¼Œ5.1å¯¹äºå…ƒæ•°æ®çš„ä¿æŠ¤æ˜¯è¯­å¥çº§åˆ«çš„ï¼Œ5.5å¯¹äºmetadataçš„ä¿æŠ¤æ˜¯äº‹åŠ¡çº§åˆ«çš„ã€‚æ‰€è°“è¯­å¥çº§åˆ«ï¼Œå³è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œæ— è®ºäº‹åŠ¡æ˜¯å¦æäº¤æˆ–å›æ»šï¼Œå…¶è¡¨ç»“æ„å¯ä»¥è¢«å…¶ä»–ä¼šè¯æ›´æ–°ï¼›è€Œäº‹åŠ¡çº§åˆ«åˆ™æ˜¯åœ¨äº‹åŠ¡ç»“æŸåæ‰é‡Šæ”¾MDLã€‚å¼•å…¥MDLé”ä¸»è¦æ˜¯ä¸ºäº†<strong>è§£å†³ä¸¤ä¸ªé—®é¢˜</strong>ï¼š</p><ul><li>äº‹åŠ¡éš”ç¦»é—®é¢˜ï¼šæ¯”å¦‚åœ¨å¯é‡å¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¼šè¯Aåœ¨2æ¬¡æŸ¥è¯¢æœŸé—´ï¼Œä¼šè¯Bå¯¹è¡¨ç»“æ„åšäº†ä¿®æ”¹ï¼Œä¸¤æ¬¡æŸ¥è¯¢ç»“æœå°±ä¼šä¸ä¸€è‡´ï¼Œæ— æ³•æ»¡è¶³å¯é‡å¤è¯»çš„è¦æ±‚ã€‚</li><li>æ•°æ®å¤åˆ¶é—®é¢˜ï¼šæ¯”å¦‚ä¼šè¯Aæ‰§è¡Œäº†å¤šæ¡æ›´æ–°è¯­å¥æœŸé—´ï¼Œå¦å¤–ä¸€ä¸ªä¼šè¯Båšäº†è¡¨ç»“æ„å˜æ›´å¹¶ä¸”å…ˆæäº¤ï¼Œå°±ä¼šå¯¼è‡´slaveåœ¨é‡åšæ—¶ï¼Œå…ˆé‡åšalterï¼Œå†é‡åšupdateæ—¶å°±ä¼šå‡ºç°å¤åˆ¶é”™è¯¯çš„ç°è±¡ã€‚ä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„<a href="https://bugs.mysql.com/bug.php?id=989" target="_blank" rel="noopener">bug#989</a>ã€‚</li></ul><hr><h3 id="DDLæ“ä½œä¸MetaData-Lock"><a href="#DDLæ“ä½œä¸MetaData-Lock" class="headerlink" title="DDLæ“ä½œä¸MetaData Lock"></a>DDLæ“ä½œä¸MetaData Lock</h3><ul><li>metadata lock æœºåˆ¶æ˜¯ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§å­˜åœ¨çš„ï¼Œåœ¨æœ‰äº‹åŠ¡çš„æ“ä½œæ—¶å€™ï¼Œéœ€è¦é¦–å…ˆè·å¾—metadata lock ,ç„¶åæ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ï¼Œåˆæ¥äº†ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè¦ddlæ“ä½œåŒä¸€ä¸ªè¡¨ï¼Œå°±ä¼šå‡ºç° metadata lockã€‚</li><li>è‡ªåŠ¨æäº¤æ¨¡å¼ä¸‹ï¼Œå•è¯­å¥å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰§è¡Œå®Œäº†ï¼Œäº‹åŠ¡ä¹Ÿå°±ç»“æŸäº†ã€‚</li><li>preparestatement  ä¼šè·å¾— metalockï¼Œä¸€æ—¦prepare å®Œæ¯•ï¼Œ metalock å°±é‡Šæ”¾äº†ã€‚</li><li>online DDLåº”è¯¥æ˜¯æŒ‡åœ¨alter tableè¿›è¡Œçš„æ—¶å€™ï¼Œ æ’å…¥/ä¿®æ”¹/åˆ é™¤æ•°æ®çš„sqlè¯­å¥ä¸ä¼šWaiting for table metadata lockã€‚ä¸€æ—¦alter table TableAçš„æ“ä½œåœæ»åœ¨Waiting for table metadata lockçš„çŠ¶æ€ï¼Œåç»­å¯¹TableAçš„ä»»ä½•æ“ä½œï¼ˆåŒ…æ‹¬è¯»ï¼‰éƒ½æ— æ³•è¿›è¡Œï¼Œä¹Ÿä¼šåœ¨Opening tablesçš„é˜¶æ®µè¿›å…¥Waiting for table metadata lockçš„é˜Ÿåˆ—ã€‚</li></ul><h2 id="Alter-table-ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯"><a href="#Alter-table-ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯" class="headerlink" title="Alter table ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯"></a>Alter table ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯</h2><h3 id="åœºæ™¯1"><a href="#åœºæ™¯1" class="headerlink" title="åœºæ™¯1"></a>åœºæ™¯1</h3><ul><li>ä¼šè¯Aå¯¹boobooè¡¨æ‰§è¡Œè¯»æ“ä½œ<code>select *,sleep(60) from booboo;</code>ï¼Œæ­£åœ¨è¿›è¡Œæœªæäº¤äº‹åŠ¡</li><li>ä¼šè¯Bå¯¹boobooè¡¨æ‰§è¡Œåœ¨çº¿DDLæ“ä½œ<code>alter table booboo add q4 int default 0;</code></li><li>ä¼šè¯Cå¯¹boobooè¡¨æ‰§è¡Œéšå¼è¯»æ“ä½œ<code>select *,sleep(60) from booboo;</code>,è¿›è¡Œç­‰å¾…</li><li>ä¼šè¯Då¯¹boobooè¡¨æ‰§è¡Œæ˜¾ç¤ºè¯»æ“ä½œ<code>begin;select * from booboo;</code>ä¹Ÿä¼šè¿›è¡Œç­‰å¾…</li><li>é€šè¿‡<code>show processlist</code>å¯ä»¥çœ‹åˆ°ä¼šè¯Aï¼ˆå¯¹boobooè¡¨ä¸Šæ­£åœ¨è¿›è¡Œçš„æ“ä½œï¼‰ï¼Œæ­¤æ—¶ä¼šè¯Bï¼ˆalter tableè¯­å¥ï¼‰æ— æ³•è·å–åˆ°metadata ç‹¬å é”ï¼Œä¼šè¿›è¡Œç­‰å¾…ï¼Œä¼šè¯Cå’Œä¼šè¯Déƒ½ä¼šè¿›è¡Œç­‰å¾…ï¼Œä¸”èƒ½ä»processlistè¡¨ä¸­çœ‹åˆ°å¯¹boobooè¡¨çš„æ“ä½œ</li><li>ä¼šè¯Aæäº¤äº‹åŠ¡åæˆ–killä¹‹åï¼Œä¼šè¯Cäº‹åŠ¡ç»“æŸï¼Œä¼šè¯D<code>select</code>è¯­å¥æ‰§è¡ŒæˆåŠŸï¼Œäº‹åŠ¡æäº¤åˆ™ä¼šè¯Bå¯æ‰§è¡Œï¼Œå¦åˆ™è¿›å…¥åœºæ™¯2</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;</span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |  167 | Waiting for table metadata lock | alter table booboo add q4 int default 0 |</span><br><span class="line">|  7 | root | localhost | uplooking | Query   |  155 | Waiting for table metadata lock | select * from booboo                    |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">|  9 | root | localhost | uplooking | Query   |  181 | User sleep                      | select *,sleep(60) from booboo          |</span><br><span class="line">| 10 | root | localhost | uplooking | Query   |    7 | Waiting for table metadata lock | select * from booboo                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> id=9çš„çº¿ç¨‹ä¸ºä¼šè¯A è™½ç„¶æ˜¯éšå¼äº‹åŠ¡ï¼Œä½†æ˜¯æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œæ‰€ä»¥ä¸ºæœªæäº¤çš„äº‹åŠ¡</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> id=6çš„çº¿ç¨‹ä¸ºä¼šè¯B åœ¨ä¼šè¯Aæœ‰äº‹åŠ¡æœªæäº¤çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡ŒAlteræ“ä½œ,äº‰æŠ¢metadata lock</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> id=7çš„çº¿ç¨‹ä¸ºä¼šè¯C éšå¼æŸ¥è¯¢äº‹åŠ¡ä¹Ÿä¼šè¿›å…¥ç­‰å¾…</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> id=10çš„çº¿ç¨‹ä¸ºä¼šè¯D æ˜¾ç¤ºæŸ¥è¯¢äº‹åŠ¡åŒæ ·è¿›å…¥ç­‰å¾…</span></span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹metadatalock</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ç¬¬ä¸€ç§æƒ…å†µï¼Œåˆ™å®šä½åˆ°é•¿æ—¶é—´æœªæäº¤çš„äº‹åŠ¡killå³å¯</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥è¯¢ information_schema.innodb_trx çœ‹åˆ°æœ‰é•¿æ—¶é—´æœªå®Œæˆçš„äº‹åŠ¡ï¼Œ ä½¿ç”¨ <span class="built_in">kill</span> å‘½ä»¤ç»ˆæ­¢è¯¥æŸ¥è¯¢ã€‚</span></span><br><span class="line"></span><br><span class="line">select concat('kill ',i.trx_mysql_thread_id,';') from information_schema.innodb_trx i,</span><br><span class="line">  (select </span><br><span class="line">         id, time</span><br><span class="line">     from</span><br><span class="line">         information_schema.processlist</span><br><span class="line">     where</span><br><span class="line">         time = (select </span><br><span class="line">                 max(time)</span><br><span class="line">             from</span><br><span class="line">                 information_schema.processlist</span><br><span class="line">             where</span><br><span class="line">                 state = 'Waiting for table metadata lock'</span><br><span class="line">                     and substring(info, 1, 5) in ('alter' , 'optim', 'repai', 'lock ', 'drop ', 'creat'))) p</span><br><span class="line">  where timestampdiff(second, i.trx_started, now()) &gt; p.time</span><br><span class="line">  and i.trx_mysql_thread_id  not in (connection_id(),p.id);</span><br></pre></td></tr></table></figure><h3 id="åœºæ™¯2"><a href="#åœºæ™¯2" class="headerlink" title="åœºæ™¯2"></a>åœºæ™¯2</h3><ul><li>é€šè¿‡<code>show processlist</code>çœ‹ä¸åˆ°boobooä¸Šæœ‰ä»»ä½•æ“ä½œï¼Œä½†å®é™…ä¸Šå­˜åœ¨æœ‰æœªæäº¤çš„äº‹åŠ¡ï¼Œå¯ä»¥åœ¨<code>information_schema.innodb_trx</code>ä¸­æŸ¥çœ‹åˆ°ã€‚åœ¨äº‹åŠ¡æ²¡æœ‰å®Œæˆä¹‹å‰ï¼Œboobooçš„é”ä¸ä¼šé‡Šæ”¾ï¼Œalter tableåŒæ ·è·å–ä¸åˆ°metadataçš„ç‹¬å é”</li><li>ä¼šè¯Dæäº¤äº‹åŠ¡æˆ–å›æ»šæˆ–killï¼Œåˆ™ä¼šè¯Bä¸­çš„Alterå¯ç»§ç»­æ‰§è¡Œ</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœ¨åœºæ™¯1çš„åŸºç¡€ä¸Šï¼Œå°†ä¼šè¯Açš„äº‹åŠ¡å®Œæˆæˆ–è€…<span class="built_in">kill</span>æ‰ï¼Œä¼šè¯Cæ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯ä¼šè¯Bå’Œä¼šè¯Dç»§ç»­è¿›å…¥metadataé”çš„ç­‰å¾…ã€‚åŸå› æ˜¯ä¼šè¯Dè™½ç„¶selectå¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯äº‹åŠ¡æ²¡æœ‰æäº¤ï¼Œåˆ™è¡¨ä¸Šçš„metadataé”è¿˜å­˜åœ¨ï¼Œå¯¼è‡´ä¼šè¯Bçš„ddlæ“ä½œæ— æ³•æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¼šè¯Bå’Œä¼šè¯Dï¼Œæƒ…å†µ1ï¼šçŸ¥é“æœ‰æœªå®Œæˆçš„äº‹åŠ¡Dï¼Œåˆ™ç»“æŸä¼šè¯Dçš„äº‹åŠ¡ï¼Œä¼šè¯Bæ­£å¸¸æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¼šè¯Bå’Œä¼šè¯Dï¼Œæƒ…å†µ2ï¼šä¸çŸ¥é“æœ‰æœªç»“æŸçš„äº‹åŠ¡Dï¼Œå¦‚ä½•æ’é”™å‘¢ï¼Ÿ</span></span><br><span class="line">=================================</span><br><span class="line"></span><br><span class="line">-- è¯·æ ¹æ®å…·ä½“çš„æƒ…æ™¯ä¿®æ”¹æŸ¥è¯¢è¯­å¥</span><br><span class="line">-- å¦‚æœå¯¼è‡´é˜»å¡çš„è¯­å¥çš„ç”¨æˆ·ä¸å½“å‰ç”¨æˆ·ä¸åŒï¼Œè¯·ä½¿ç”¨å¯¼è‡´é˜»å¡çš„è¯­å¥çš„ç”¨æˆ·ç™»å½•æ¥ç»ˆæ­¢ä¼šè¯</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># åœºæ™¯2çš„æƒ…å†µï¼Œæ˜¯åœ¨åœºæ™¯1çš„åŸºç¡€ä¸Šï¼Œè¿˜æ˜¯æœ‰metadatalocké”ï¼ˆ*ä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒä¸ä¼šåœæœåŠ¡ï¼Œå› æ­¤ä¸åœçš„æœ‰æ–°çš„queryå‘é€è¿‡æ¥ï¼Œå°±ä¼šå‡ºç°åœºæ™¯2*ï¼‰ï¼Œåˆ™æ‰‹åŠ¨ç»§ç»­killæ‰é•¿äº‹åŠ¡å³å¯ï¼Œæ³¨æ„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰å¯èƒ½ddlæ“ä½œéœ€è¦ä¿ç•™ï¼ˆ*ä¾‹å¦‚MDLé”å‡ºç°åœ¨ä¸»ä»åŒæ­¥çš„ä»ä¸­ï¼Œä»åº“éœ€è¦å»æ‰§è¡Œä¸»å‘é€çš„è¡¨å˜æ›´ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥å…ˆå°†ä¸»ä»åœæ‰ï¼Œæ‰‹åŠ¨æ‰§è¡Œalteræ“ä½œï¼Œéƒ½å¯ä»¥*ï¼‰ä»¥ä¸‹æ–¹æ³•æ˜¯åœ¨åœæ­¢å¯¹ä»åº“çš„è¯»æ“ä½œåï¼Œå°†éddlçš„è¿æ¥killæ‰</span></span></span><br><span class="line"></span><br><span class="line">select id,State,command from information_schema.processlist where State="Waiting for table metadata lock";</span><br><span class="line">select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx  where trx_mysql_thread_id=id;</span><br><span class="line">show processlist;</span><br><span class="line">select  concat('kill ',trx_mysql_thread_id,';') from information_schema.processlist,information_schema.innodb_trx  where trx_mysql_thread_id=id and State!="Waiting for table metadata lock";</span><br><span class="line"></span><br><span class="line">===============================</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;                                                                                                             </span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |  275 | Waiting for table metadata lock | alter table booboo add q6 int default 0 |</span><br><span class="line">|  7 | root | localhost | uplooking | Sleep   |  269 |                                 | NULL                                    |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">| 10 | root | localhost | uplooking | Sleep   |  249 |                                 | NULL                                    |</span><br><span class="line">| 12 | root | localhost | uplooking | Sleep   |  191 |                                 | NULL                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å½“å‰è¿›ç¨‹å‘ç°é™¤äº†Alterä¹‹å¤–æ²¡æœ‰å¯¹boobooè¡¨çš„æ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx <span class="built_in">where</span> trx_mysql_thread_id=id;</span></span><br><span class="line">+----------+---------------------+---------------------+----+------+-----------+---------+---------------------------------+-----------+-----------------------------------------+</span><br><span class="line">| timediff | sysdate()           | trx_started         | id | USER | DB        | COMMAND | STATE                           | trx_state | trx_query                               |</span><br><span class="line">+----------+---------------------+---------------------+----+------+-----------+---------+---------------------------------+-----------+-----------------------------------------+</span><br><span class="line">| 00:05:38 | 2017-08-18 20:21:07 | 2017-08-18 20:15:29 |  6 | root | uplooking | Query   | Waiting for table metadata lock | RUNNING   | alter table booboo add q6 int default 0 |</span><br><span class="line">| 00:05:38 | 2017-08-18 20:21:07 | 2017-08-18 20:15:29 | 10 | root | uplooking | Sleep   |                                 | RUNNING   | NULL                                    |</span><br><span class="line">+----------+---------------------+---------------------+----+------+-----------+---------+---------------------------------+-----------+-----------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹innodb_trxè¡¨å¯ä»¥çœ‹åˆ°é™¤äº†alterä¹‹å¤–æœ‰æœªå®Œæˆçš„äº‹åŠ¡ï¼Œä½†æ˜¯çœ‹ä¸åˆ°å…·ä½“queryï¼Œå¾—åˆ°çº¿ç¨‹idä¸º10</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°±å¯ä»¥<span class="built_in">kill</span> 10æ¥ç»“æŸäº‹åŠ¡</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¹‹åAlteræ­£å¸¸æ“ä½œ</span></span><br></pre></td></tr></table></figure><h3 id="åœºæ™¯3"><a href="#åœºæ™¯3" class="headerlink" title="åœºæ™¯3"></a>åœºæ™¯3</h3><blockquote><p>ä¸åœºæ™¯2å¯¹æ¯”çš„ç°è±¡ä¸åŒäºï¼š</p><ul><li>åœºæ™¯2ï¼šæœªå®Œæˆäº‹åŠ¡ä¸­å­˜åœ¨æœªå®Œæˆäº‹åŠ¡</li><li>åœºæ™¯3ï¼šæœªå®Œæˆäº‹åŠ¡ä¸­ä¸å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼šç¡®è®¤æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šï¼Œæ‰¾åˆ°è¯¥äº‹åŠ¡çš„session_idç„¶åæ€æ­»</li></ul></blockquote><ul><li>é€šè¿‡<code>show processlist</code>çœ‹ä¸åˆ°<code>booboo</code>è¡¨æœ‰ä»»ä½•æ“ä½œï¼Œåœ¨<code>information_schema.innodb_trx</code>ä¸­ä¹Ÿæ²¡æœ‰ä»»ä½•è¿›è¡Œä¸­çš„äº‹åŠ¡ã€‚</li><li>è¿™å¾ˆå¯èƒ½æ˜¯å› ä¸ºåœ¨ä¸€ä¸ªæ˜¾å¼çš„äº‹åŠ¡ä¸­ï¼Œå¯¹<code>booboo</code>è¡¨è¿›è¡Œäº†ä¸€ä¸ªå¤±è´¥çš„æ“ä½œï¼ˆæ¯”å¦‚æŸ¥è¯¢äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å­—æ®µï¼‰ï¼Œè¿™æ—¶äº‹åŠ¡æ²¡æœ‰å¼€å§‹ï¼Œä½†æ˜¯å¤±è´¥è¯­å¥è·å–åˆ°çš„é”ä¾ç„¶æœ‰æ•ˆã€‚ä»<code>performance_schema.events_statements_current</code>è¡¨ä¸­å¯ä»¥æŸ¥åˆ°å¤±è´¥çš„è¯­å¥</li><li>ä¹Ÿå°±æ˜¯è¯´é™¤äº†è¯­æ³•é”™è¯¯ï¼Œå…¶ä»–é”™è¯¯è¯­å¥è·å–åˆ°çš„é”åœ¨è¿™ä¸ªäº‹åŠ¡æäº¤æˆ–å›æ»šä¹‹å‰ï¼Œä»ç„¶ä¸ä¼šé‡Šæ”¾æ‰ã€‚<code>because the failed statement is written to the binary log and the locks protect log consistency</code>ä½†æ˜¯è§£é‡Šè¿™ä¸€è¡Œä¸ºçš„åŸå› å¾ˆéš¾ç†è§£ï¼Œå› ä¸ºé”™è¯¯çš„è¯­å¥æ ¹æœ¬ä¸ä¼šè¢«è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—</li><li>è§£å†³æ–¹æ³•ï¼šç¡®è®¤æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šï¼Œæ‰¾åˆ°è¯¥äº‹åŠ¡çš„sessionidç„¶åæ€æ­»ï¼ˆéš¾ç‚¹ï¼‰</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœºæ™¯3çš„å‡ºç°å’Œå‰ä¸¤ç§ä¸åŒ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹çº¿ç¨‹æƒ…å†µï¼Œçœ‹åˆ°alteræ“ä½œmetadataé”ï¼Œè¿˜æœ‰å…¶ä»–çš„selectæ“ä½œæœ‰metadataé”</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ç¬¬ä¸€ååº”å°±æ˜¯æœ‰å¯èƒ½æ˜¯åœºæ™¯1ï¼Œäºæ˜¯killæ‰æ‰§è¡Œselectçš„çº¿ç¨‹ï¼Œå†æ¬¡æŸ¥çœ‹çº¿ç¨‹æƒ…å†µï¼Œå°±åªå‰©ä¸‹æ‰§è¡Œalterçº¿ç¨‹äº†</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ¥ä¸‹æ¥æŸ¥çœ‹æœªå®Œæˆçš„äº‹åŠ¡ï¼Œå¦‚æœæ˜¯åœºæ™¯1ï¼Œåœ¨killæ‰å†²çªçš„çº¿ç¨‹ååº”è¯¥å‡ºç°ä¸¤ç§æƒ…å†µï¼ˆA.alteræ“ä½œæ­£å¸¸æ‰§è¡ŒB.çº¿ç¨‹ä¸­åªæœ‰alteræ“ä½œä¸ºwaiting metadata lockçŠ¶æ€ï¼›æœªå®Œæˆäº‹åŠ¡ä¸­å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼‰</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ä½†æ˜¯å´å‘ç°å’ŒBæƒ…å†µæœ‰æ‰€ä¸åŒçš„æ˜¯ï¼šæœªå®Œæˆäº‹åŠ¡ä¸­ä¸å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼Œæ€»ç»“ç¬¬ä¸‰ç§æƒ…å†µ(C.çº¿ç¨‹ä¸­åªæœ‰alteræ“ä½œä¸ºwaiting metadata lockçŠ¶æ€ï¼›æœªå®Œæˆäº‹åŠ¡ä¸­ä¸å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼‰</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡æœç´¢èµ„æ–™å®šä½åˆ°æ˜¯åœºæ™¯3ï¼Œä½†èµ„æ–™ä¸­æ²¡æœ‰è¯´æ€ä¹ˆè§£å†³é—®é¢˜ï¼Œåˆä¸èƒ½é‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼Œåªæœ‰ä¸€ä¸ªèµ„æ–™é‡Œæåˆ°äº†æ–¹æ³•ï¼ˆç¡®è®¤æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šï¼Œæ‰¾åˆ°è¯¥äº‹åŠ¡çš„sessionidç„¶åæ€æ­»ï¼Œå…³é”®å°±æ˜¯å¦‚ä½•æ‰¾åˆ°sessionidå‘¢ï¼Ÿperformance_schema.events_statements_currentä¸­çš„thread_idä¸ºçº¿ç¨‹idå¹¶ä¸æ˜¯sessionidæˆ–è€…è¯´ä¼šè¯idã€è¿æ¥idï¼Œå¦‚ä½•é€šè¿‡thread_idæ‰¾åˆ°session_idæˆä¸ºäº†éš¾ç‚¹ï¼Ÿ5.7ä¸­æœ‰ä¸ªsessionè¡¨å¯ä»¥ç›´æ¥æŸ¥åˆ°ï¼Œè€Œ5.6ä¸­å¿…é¡»é€šè¿‡ä¸‰è¡¨æ‰èƒ½æŸ¥åˆ°ï¼Œåˆ†åˆ«ä¸ºperformance_schema.events_statements_current,performance_schema.threads,information_schema.processlistè¡¨ã€‚ï¼‰</span></span><br><span class="line">=====================================================================================</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">kill</span>æ‰é™¤äº†å†™æ“ä½œä»¥å¤–çš„query</span></span><br><span class="line">select concat('kill ',id) from information_schema.processlist where State="Waiting for table metadata lock" and substring(info, 1, 5) not in ('alter' , 'optim', 'repai', 'lock ', 'drop ', 'creat');</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯»æ‰¾æœªæäº¤æˆ–æœªå›æ»šçš„é”™è¯¯äº‹åŠ¡ï¼Œå¹¶<span class="built_in">kill</span>å³å¯</span></span><br><span class="line">select t.processlist_id,t.processlist_time,e.sql_text from performance_schema.threads t,performance_schema.events_statements_current e where t.thread_id=e.thread_id and e.SQL_TEXT like '%t1%';</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¡ˆä¾‹ä¸­å‡è®¾æ˜¯åœ¨t1è¡¨ä¸Šæœ‰MDLé”ï¼Œåˆ™ï¼Œe.sql_text è¿‘ä¼¼åŒ¹é…t1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ¬æ–¹æ³•5.5 5.6 5.7 éƒ½é€šç”¨ã€‚</span></span><br><span class="line">=============================================================================</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ­¥ï¼šæ¨¡æ‹Ÿç¬¬ä¸‰ç§æƒ…å†µï¼Œä¼šè¯11æ‰§è¡Œä¸€ä¸ªæ˜¾ç¤ºäº‹åŠ¡ï¼Œä¸”queryå‡ºç°åˆ—é”™è¯¯ï¼Œt1è¡¨ä¸­ä¸å­˜åœ¨xxåˆ—ï¼Œä¸æäº¤ã€‚</p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93%5Cmdl01.png" alt=""></p><p>ç¬¬äºŒæ­¥ï¼šä¼šè¯14ä¸­æ‰§è¡Œalteræ“ä½œ</p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl02.png" alt="mdl02"></p><p>ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œä¸€æ¡query</p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl03.png" alt="mdl03"></p><p>ç¬¬å››æ­¥ï¼šä¼šè¯15æ‰§è¡Œä¸€ä¸ªæ˜¾ç¤ºäº‹åŠ¡ï¼ŒæŸ¥è¯¢t1è¡¨</p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl04.png" alt="mdl04"></p><p>ç¬¬äº”æ­¥ï¼šæŸ¥çœ‹å½“å‰çš„processlistæƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°åªè¦æ˜¯å¯¹t1è¡¨çš„æ“ä½œéƒ½å‡ºç°äº†MDLé”ç­‰å¾…ï¼›å°è¯•é€šè¿‡ç¬¬ä¸€ç§æƒ…å†µçš„è§£å†³æ–¹æ³•æ‰¾å‡ºé˜»å¡çš„äº‹åŠ¡ä¼šè¯è¿›è¡Œkillï¼Œå‘ç°ä¸å­˜åœ¨é˜»å¡ä¼šè¯ï¼›æŸ¥çœ‹å½“å‰æœªæäº¤çš„äº‹åŠ¡å‘ç°è¿”å›ç©ºï¼›é€šè¿‡è¿‡æ»¤processlistä¸­è¿›è¡ŒMDLé”ç­‰å¾…ä¸”ä¸æ˜¯alterçš„ä¼šè¯idï¼Œè¿›è¡Œkillã€‚</p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl06.png" alt="mdl06"></p><p>ç¬¬å…­æ­¥ï¼šåªkill 12ï¼Œ15ï¼Œç•™ä¸‹æ‰§è¡Œalterçš„ä¼šè¯14ï¼›æœ‰äººä¼šæƒ³ä¸ºä»€ä¹ˆéƒ½killæ‰å‘¢ï¼Ÿå› ä¸ºå³ä½¿ç°åœ¨killæ‰äº†ï¼Œt1è¡¨çš„MDLé”ä¹Ÿä¸ä¼šé‡Šæ”¾æ‰ï¼Œè¿˜ä¸å¦‚ç•™ä¸‹ä¼šè¯14çš„ddlæ“ä½œï¼Œç­‰å½»åº•è§£å†³äº†ï¼Œè‡ªç„¶å°±èƒ½æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚å…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„åˆ†æã€‚</p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl07.png" alt="mdl07"></p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl08.png" alt="mdl08"></p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl09.png" alt="mdl09"></p><p>ç¬¬ä¸ƒæ­¥ï¼šç»™å¤§å®¶åšä¸ªæµ‹è¯•ï¼Œå³ä½¿å°†ä¼šè¯14çš„alteråŠ¨ä½œkillæ‰ï¼š</p><ul><li>processlistä¸­çœ‹ä¸åˆ°ä»»ä½•ç­‰å¾…MDLé”çš„ä¼šè¯ï¼›</li><li>sys.schema_table_lock_waitsä¸­ä¹Ÿä¸å­˜åœ¨è¡¨é”ï¼ˆ5.7æ‰æœ‰sysåº“ï¼‰ï¼›</li><li>performance_schema.metadata_locksä¸­ä¹Ÿä¸å­˜åœ¨ä»»ä½•é”è®°å½•ï¼›</li><li>ä¼šè¯16æƒ³å†å»æ‰§è¡Œalteræ“ä½œï¼Œåˆå¼€å§‹äº†MDLé”ç­‰å¾…ã€‚</li></ul><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl10.png" alt="mdl10"></p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl11.png" alt="mdl11"></p><p>ç¬¬å…«æ­¥ï¼šæ­¤æ—¶å°±ä¸€å®šå¯ä»¥ç¡®å®šå½“å‰å±äºã€<strong>æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šå¯¼è‡´çš„MDLé”</strong>ã€‘çš„æƒ…å†µäº†ã€‚æˆ‘ä»¬æ‰¾å‡ºè¿™ä¸ªé”™è¯¯äº‹åŠ¡ï¼Œè¿›è¡Œkill</p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl12.png" alt="mdl12"></p><p>ç¬¬ä¹æ­¥ï¼škillæ‰ä¼šè¯11åï¼ŒæˆåŠŸå°†MDLé”é‡Šæ”¾ã€‚</p><blockquote><p>æœ‰äººåˆä¼šé—®å’¯ï¼šä¸ºä»€ä¹ˆä¸å°†æ•°æ®åº“é‡å¯ï¼Ÿ</p><p>å›ç­”ï¼š</p><p>å¦‚æœè¯´â€”â€”</p><ol><li><p>ä¸šåŠ¡å…è®¸é‡å¯</p></li><li><p>ä¸æƒ³æ‰¾åˆ°é—®é¢˜çš„æ ¹æº</p><p>é‚£ä¹ˆé‡å¯å§</p></li></ol><p>å¦‚æœè¯´â€”â€” </p><ol><li><p>æ•°æ®åº“ä¸Šé¢å¤šä¸ªåº“ï¼Œå…³è”å¤šä¸ªä¸šåŠ¡ï¼Œä¸èƒ½é‡å¯</p></li><li><p>æƒ³æ‰¾åˆ°é—®é¢˜çš„æ ¹æºï¼Œé˜²æ­¢ä¸‹æ¬¡å†æ¬¡å‡ºç°ç±»ä¼¼çš„é—®é¢˜</p><p>é‚£ä¹ˆä½ æ‡‚çš„</p></li></ol><p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¸ç›´æ¥killæ‰€æœ‰ä¼šè¯å‘¢ï¼ŸåŒæ ·å¦‚æœä½ è¦æ‰¾å‡ºé—®é¢˜çš„æ ¹æºé‚£ä¹ˆå°±æ’æŸ¥ï¼Œä¸æƒ³é—®ä¸ºä»€ä¹ˆå°±ç›´æ¥killå§ï¼Œæœ«å°¾æœ‰killçš„è„šæœ¬</p></blockquote><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl13.png" alt="mdl13"></p><p>ä¸€æ­¥æ­¥åˆ†æå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;                                                                                                                                                                   </span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |   17 | Waiting for table metadata lock | alter table booboo add q9 int default 0 |</span><br><span class="line">|  7 | root | localhost | uplooking | Query   |   11 | Waiting for table metadata lock | select * from booboo                    |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">| 14 | root | localhost | uplooking | Query   |    5 | Waiting for table metadata lock | select * from booboo where id=3         |</span><br><span class="line">| 15 | root | localhost | uplooking | Sleep   |   28 |                                 | NULL                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx <span class="built_in">where</span> trx_mysql_thread_id=id;</span></span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">kill</span> 7 ;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">kill</span> 14;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;                                                                                                                                                                   </span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |   86 | Waiting for table metadata lock | alter table booboo add q9 int default 0 |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">| 15 | root | localhost | uplooking | Sleep   |   97 |                                 | NULL                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx <span class="built_in">where</span> trx_mysql_thread_id=id;</span></span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœç¬¦åˆæƒ…å†µCï¼Œéœ€è¦å»æŸ¥çœ‹performance_schema.events_statements_currentè¡¨ä¸­æ˜¯å¦æœ‰å¯¹boobooçš„é”™è¯¯è¯­å¥ï¼ˆè¿™é‡Œçš„é”™è¯¯è¯­å¥æ˜¯éè¯­æ³•é”™è¯¯çš„ï¼Œä¾‹å¦‚selectä¸­å†™äº†ä¸å­˜åœ¨çš„åˆ—ç­‰æƒ…å†µï¼‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»ä¸‹é¢çš„æŸ¥è¯¢ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œç¡®å®å­˜åœ¨ä¸€ä¸ªé”™è¯¯è¯­å¥äº‹ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡è¯¥é”™è¯¯è¯­å¥äº‹ä»¶çš„THREAD_IDï¼Œåˆ°performance_schema.threadsè¡¨æŸ¥åˆ°è¯¥çº¿ç¨‹å¯¹åº”çš„PROCESSLIST_IDï¼Œè€ŒPROCESSLIST_IDè¿›ç¨‹idç­‰äºprocesslistä¸­çš„id</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from performance_schema.events_statements_current <span class="built_in">where</span> SQL_TEXT like <span class="string">'%booboo%'</span>\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">              THREAD_ID: 31</span><br><span class="line">               EVENT_ID: 16</span><br><span class="line">           END_EVENT_ID: NULL</span><br><span class="line">             EVENT_NAME: statement/sql/alter_table</span><br><span class="line">                 SOURCE: socket_connection.cc:101</span><br><span class="line">            TIMER_START: 3292336129737000</span><br><span class="line">              TIMER_END: 3521408438190000</span><br><span class="line">             TIMER_WAIT: 229072308453000</span><br><span class="line">              LOCK_TIME: 0</span><br><span class="line">               SQL_TEXT: alter table booboo add q9 int default 0</span><br><span class="line">                 DIGEST: NULL</span><br><span class="line">            DIGEST_TEXT: NULL</span><br><span class="line">         CURRENT_SCHEMA: uplooking</span><br><span class="line">            OBJECT_TYPE: NULL</span><br><span class="line">          OBJECT_SCHEMA: NULL</span><br><span class="line">            OBJECT_NAME: NULL</span><br><span class="line">  OBJECT_INSTANCE_BEGIN: NULL</span><br><span class="line">            MYSQL_ERRNO: 0</span><br><span class="line">      RETURNED_SQLSTATE: NULL</span><br><span class="line">           MESSAGE_TEXT: NULL</span><br><span class="line">                 ERRORS: 0</span><br><span class="line">               WARNINGS: 0</span><br><span class="line">          ROWS_AFFECTED: 0</span><br><span class="line">              ROWS_SENT: 0</span><br><span class="line">          ROWS_EXAMINED: 0</span><br><span class="line">CREATED_TMP_DISK_TABLES: 0</span><br><span class="line">     CREATED_TMP_TABLES: 0</span><br><span class="line">       SELECT_FULL_JOIN: 0</span><br><span class="line"> SELECT_FULL_RANGE_JOIN: 0</span><br><span class="line">           SELECT_RANGE: 0</span><br><span class="line">     SELECT_RANGE_CHECK: 0</span><br><span class="line">            SELECT_SCAN: 0</span><br><span class="line">      SORT_MERGE_PASSES: 0</span><br><span class="line">             SORT_RANGE: 0</span><br><span class="line">              SORT_ROWS: 0</span><br><span class="line">              SORT_SCAN: 0</span><br><span class="line">          NO_INDEX_USED: 0</span><br><span class="line">     NO_GOOD_INDEX_USED: 0</span><br><span class="line">       NESTING_EVENT_ID: NULL</span><br><span class="line">     NESTING_EVENT_TYPE: NULL</span><br><span class="line">    NESTING_EVENT_LEVEL: 0</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">              THREAD_ID: 33</span><br><span class="line">               EVENT_ID: 74</span><br><span class="line">           END_EVENT_ID: NULL</span><br><span class="line">             EVENT_NAME: statement/sql/select</span><br><span class="line">                 SOURCE: socket_connection.cc:101</span><br><span class="line">            TIMER_START: 3521408132304000</span><br><span class="line">              TIMER_END: 3521408462141000</span><br><span class="line">             TIMER_WAIT: 329837000</span><br><span class="line">              LOCK_TIME: 184000000</span><br><span class="line">               SQL_TEXT: select * from performance_schema.events_statements_current where SQL_TEXT like '%booboo%'</span><br><span class="line">                 DIGEST: NULL</span><br><span class="line">            DIGEST_TEXT: NULL</span><br><span class="line">         CURRENT_SCHEMA: uplooking</span><br><span class="line">            OBJECT_TYPE: NULL</span><br><span class="line">          OBJECT_SCHEMA: NULL</span><br><span class="line">            OBJECT_NAME: NULL</span><br><span class="line">  OBJECT_INSTANCE_BEGIN: NULL</span><br><span class="line">            MYSQL_ERRNO: 0</span><br><span class="line">      RETURNED_SQLSTATE: NULL</span><br><span class="line">           MESSAGE_TEXT: NULL</span><br><span class="line">                 ERRORS: 0</span><br><span class="line">               WARNINGS: 0</span><br><span class="line">          ROWS_AFFECTED: 0</span><br><span class="line">              ROWS_SENT: 1</span><br><span class="line">          ROWS_EXAMINED: 0</span><br><span class="line">CREATED_TMP_DISK_TABLES: 0</span><br><span class="line">     CREATED_TMP_TABLES: 0</span><br><span class="line">       SELECT_FULL_JOIN: 0</span><br><span class="line"> SELECT_FULL_RANGE_JOIN: 0</span><br><span class="line">           SELECT_RANGE: 0</span><br><span class="line">     SELECT_RANGE_CHECK: 0</span><br><span class="line">            SELECT_SCAN: 1</span><br><span class="line">      SORT_MERGE_PASSES: 0</span><br><span class="line">             SORT_RANGE: 0</span><br><span class="line">              SORT_ROWS: 0</span><br><span class="line">              SORT_SCAN: 0</span><br><span class="line">          NO_INDEX_USED: 1</span><br><span class="line">     NO_GOOD_INDEX_USED: 0</span><br><span class="line">       NESTING_EVENT_ID: NULL</span><br><span class="line">     NESTING_EVENT_TYPE: NULL</span><br><span class="line">    NESTING_EVENT_LEVEL: 0</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">              THREAD_ID: 40</span><br><span class="line">               EVENT_ID: 8</span><br><span class="line">           END_EVENT_ID: 8</span><br><span class="line">             EVENT_NAME: statement/sql/select</span><br><span class="line">                 SOURCE: socket_connection.cc:101</span><br><span class="line">            TIMER_START: 3280938133699000</span><br><span class="line">              TIMER_END: 3280938258470000</span><br><span class="line">             TIMER_WAIT: 124771000</span><br><span class="line">              LOCK_TIME: 0</span><br><span class="line">               SQL_TEXT: select abc from booboo</span><br><span class="line">                 DIGEST: 871dd43dfdfb143e81439bbe7bf7b57e</span><br><span class="line">            DIGEST_TEXT: SELECT `abc` FROM `booboo` </span><br><span class="line">         CURRENT_SCHEMA: uplooking</span><br><span class="line">            OBJECT_TYPE: NULL</span><br><span class="line">          OBJECT_SCHEMA: NULL</span><br><span class="line">            OBJECT_NAME: NULL</span><br><span class="line">  OBJECT_INSTANCE_BEGIN: NULL</span><br><span class="line">            MYSQL_ERRNO: 1054</span><br><span class="line">      RETURNED_SQLSTATE: 42S22</span><br><span class="line">           MESSAGE_TEXT: Unknown column 'abc' in 'field list'</span><br><span class="line">                 ERRORS: 1</span><br><span class="line">               WARNINGS: 0</span><br><span class="line">          ROWS_AFFECTED: 0</span><br><span class="line">              ROWS_SENT: 0</span><br><span class="line">          ROWS_EXAMINED: 0</span><br><span class="line">CREATED_TMP_DISK_TABLES: 0</span><br><span class="line">     CREATED_TMP_TABLES: 0</span><br><span class="line">       SELECT_FULL_JOIN: 0</span><br><span class="line"> SELECT_FULL_RANGE_JOIN: 0</span><br><span class="line">           SELECT_RANGE: 0</span><br><span class="line">     SELECT_RANGE_CHECK: 0</span><br><span class="line">            SELECT_SCAN: 0</span><br><span class="line">      SORT_MERGE_PASSES: 0</span><br><span class="line">             SORT_RANGE: 0</span><br><span class="line">              SORT_ROWS: 0</span><br><span class="line">              SORT_SCAN: 0</span><br><span class="line">          NO_INDEX_USED: 0</span><br><span class="line">     NO_GOOD_INDEX_USED: 0</span><br><span class="line">       NESTING_EVENT_ID: NULL</span><br><span class="line">     NESTING_EVENT_TYPE: NULL</span><br><span class="line">    NESTING_EVENT_LEVEL: 0</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: </span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select THREAD_ID,DIGEST_TEXT from performance_schema.events_statements_current <span class="built_in">where</span> DIGEST_TEXT=<span class="string">"SELECT `abc` FROM `booboo`"</span>;</span></span><br><span class="line">+-----------+-----------------------------+</span><br><span class="line">| THREAD_ID | DIGEST_TEXT                 |</span><br><span class="line">+-----------+-----------------------------+</span><br><span class="line">|        40 | SELECT `abc` FROM `booboo`  |</span><br><span class="line">+-----------+-----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from performance_schema.threads <span class="built_in">where</span> thread_id=40\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">          THREAD_ID: 40</span><br><span class="line">               NAME: thread/sql/one_connection</span><br><span class="line">               TYPE: FOREGROUND</span><br><span class="line">     PROCESSLIST_ID: 15</span><br><span class="line">   PROCESSLIST_USER: root</span><br><span class="line">   PROCESSLIST_HOST: localhost</span><br><span class="line">     PROCESSLIST_DB: uplooking</span><br><span class="line">PROCESSLIST_COMMAND: Sleep</span><br><span class="line">   PROCESSLIST_TIME: 402</span><br><span class="line">  PROCESSLIST_STATE: NULL</span><br><span class="line">   PROCESSLIST_INFO: NULL</span><br><span class="line">   PARENT_THREAD_ID: NULL</span><br><span class="line">               ROLE: NULL</span><br><span class="line">       INSTRUMENTED: YES</span><br><span class="line">            HISTORY: YES</span><br><span class="line">    CONNECTION_TYPE: Socket</span><br><span class="line">       THREAD_OS_ID: 22758</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select PROCESSLIST_ID from performance_schema.threads <span class="built_in">where</span> thread_id=40;</span></span><br><span class="line">+----------------+</span><br><span class="line">| PROCESSLIST_ID |</span><br><span class="line">+----------------+</span><br><span class="line">|             15 |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from information_schema.processlist <span class="built_in">where</span> id=(select PROCESSLIST_ID from performance_schema.threads <span class="built_in">where</span> thread_id=40);</span></span><br><span class="line">+----+------+-----------+-----------+---------+------+-------+------+</span><br><span class="line">| ID | USER | HOST      | DB        | COMMAND | TIME | STATE | INFO |</span><br><span class="line">+----+------+-----------+-----------+---------+------+-------+------+</span><br><span class="line">| 15 | root | localhost | uplooking | Sleep   |  466 |       | NULL |</span><br><span class="line">+----+------+-----------+-----------+---------+------+-------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">kill</span> 15;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¼šè¯B</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> alter table booboo add q9 int default 0;</span></span><br><span class="line">Query OK, 0 rows affected (9 min 54.35 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure><h2 id="å°çŸ¥è¯†ç‚¹æ€»ç»“"><a href="#å°çŸ¥è¯†ç‚¹æ€»ç»“" class="headerlink" title="å°çŸ¥è¯†ç‚¹æ€»ç»“"></a>å°çŸ¥è¯†ç‚¹æ€»ç»“</h2><h3 id="ä¸‰å¼ è¡¨çš„å…³ç³»"><a href="#ä¸‰å¼ è¡¨çš„å…³ç³»" class="headerlink" title="ä¸‰å¼ è¡¨çš„å…³ç³»"></a>ä¸‰å¼ è¡¨çš„å…³ç³»</h3><blockquote><p>MySQL 5.6</p></blockquote><ol><li><code>performance_schema</code>åº“ä¸­ï¼Œ<code>events_statements_current</code>è¡¨ä¸­<code>theard_id</code>ä¸<code>threads</code>è¡¨ä¸­çš„<code>thread_id</code>ç›¸åŒ</li><li><code>performance_schema</code>åº“ä¸­ï¼Œthreadsè¡¨ä¸­ï¼Œthread_idå’Œprocesslist_idä¸ºå¯¹åº”å…³ç³»ï¼Œ<code>thread_id</code>è¡¨ç¤ºä¸€ä¸ªç‹¬ç‰¹çš„çº¿ç¨‹æ ‡è¯†ç¬¦;<code>processlist_id</code>æ˜¯<code>show processlist</code>æ˜¾ç¤ºçš„<code>id</code>å€¼ï¼Œè¿æ¥æ ‡è¯†ç¬¦ï¼›è€Œå¯¹äºåå°çº¿ç¨‹(ä¸ç”¨æˆ·è¿æ¥ä¸ç›¸å…³çš„çº¿ç¨‹)ï¼Œ<code>PROCESSLIST_ID</code>ä¸ºç©ºï¼Œæ­¤å€¼ä¸æ˜¯å”¯ä¸€çš„ã€‚</li><li><code>information_schema</code>åº“ä¸­,<code>PROCESSLIST</code>è¡¨æ˜¯ä¸€ä¸ªéæ ‡å‡†è¡¨ã€‚<code>id</code>è¿æ¥æ ‡è¯†ç¬¦ï¼Œå¹¶ç”±CONNECTION_ID()å‡½æ•°è¿”å›ã€‚</li></ol><table><thead><tr><th>performance_schema</th><th>performance_schema</th><th>performance_schema</th><th>information_schema</th></tr></thead><tbody><tr><td>events_statements_current</td><td>threads</td><td>threads</td><td>processlist</td></tr><tr><td>THREAD_ID</td><td>THREAD_ID</td><td>PROCESSLIST_ID</td><td>ID</td></tr></tbody></table><h3 id="æˆ‘çš„ç†è§£"><a href="#æˆ‘çš„ç†è§£" class="headerlink" title="æˆ‘çš„ç†è§£"></a>æˆ‘çš„ç†è§£</h3><ol><li>çº¿ç¨‹è¡¨ä¸­ä¿å­˜äº†æ‰€æœ‰çº¿ç¨‹çš„ä¿¡æ¯ï¼Œæœ‰å‰å°çš„æœ‰åå°è¿è¡Œçš„ï¼›</li><li>å¦‚æœæ˜¯ç”±è¿æ¥äº§ç”Ÿçš„çº¿ç¨‹ï¼Œä¸€èˆ¬éƒ½æ˜¯å‰å°çº¿ç¨‹ï¼Œä¼šåˆ†é…ä¸€ä¸ªprocesslist_idï¼Œå¯ä»¥åœ¨information_schema.processlistä¸­çœ‹åˆ°</li></ol><h3 id="èµ„æ–™å‚è€ƒ"><a href="#èµ„æ–™å‚è€ƒ" class="headerlink" title="èµ„æ–™å‚è€ƒ"></a>èµ„æ–™å‚è€ƒ</h3><p><a href="https://dev.mysql.com/doc/refman/5.7/en/threads-table.html" target="_blank" rel="noopener">å®˜ç½‘å…³äºthreadsè¡¨çš„è¯´æ˜</a></p><p><a href="https://dev.mysql.com/doc/refman/5.7/en/show-processlist.html" target="_blank" rel="noopener">å®˜æ–¹å…³äºprocesslistè¡¨çš„è¯´æ˜</a></p><p><a href="http://www.voidcn.com/article/p-hjsjvnlz-bog.html" target="_blank" rel="noopener">MySQL5.7 MetaData Lock æ¡ˆä¾‹åˆ†äº«</a></p><h3 id="ä¸åŒç‰ˆæœ¬"><a href="#ä¸åŒç‰ˆæœ¬" class="headerlink" title="ä¸åŒç‰ˆæœ¬"></a>ä¸åŒç‰ˆæœ¬</h3><blockquote><p>MySQL 5.7</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">select * from performance_schema.events_statements_current\G</span><br><span class="line">select * from sys.x$session\G</span><br><span class="line">select * from sys.x$processlist\G</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from x$session\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                thd_id: 3904</span><br><span class="line">               conn_id: 3879</span><br><span class="line">                  user: root@localhost</span><br><span class="line">                    db: sys</span><br><span class="line">               command: Query</span><br><span class="line">                 state: Sending data</span><br><span class="line">                  time: 0</span><br><span class="line">     current_statement: select * from x$session</span><br><span class="line">     statement_latency: 1564453000</span><br><span class="line">              progress: NULL</span><br><span class="line">          lock_latency: 847000000</span><br><span class="line">         rows_examined: 0</span><br><span class="line">             rows_sent: 0</span><br><span class="line">         rows_affected: 0</span><br><span class="line">            tmp_tables: 4</span><br><span class="line">       tmp_disk_tables: 1</span><br><span class="line">             full_scan: YES</span><br><span class="line">        last_statement: NULL</span><br><span class="line">last_statement_latency: NULL</span><br><span class="line">        current_memory: 0</span><br><span class="line">             last_wait: NULL</span><br><span class="line">     last_wait_latency: NULL</span><br><span class="line">                source: NULL</span><br><span class="line">           trx_latency: NULL</span><br><span class="line">             trx_state: NULL</span><br><span class="line">        trx_autocommit: NULL</span><br><span class="line">                   pid: 12880</span><br><span class="line">          program_name: mysql</span><br><span class="line">1 row in set (0.05 sec)</span><br><span class="line">mysql&gt; select * from  x$processlist limit 1\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                thd_id: 1</span><br><span class="line">               conn_id: NULL</span><br><span class="line">                  user: sql&#x2F;main</span><br><span class="line">                    db: NULL</span><br><span class="line">               command: NULL</span><br><span class="line">                 state: NULL</span><br><span class="line">                  time: 230927</span><br><span class="line">     current_statement: NULL</span><br><span class="line">     statement_latency: NULL</span><br><span class="line">              progress: NULL</span><br><span class="line">          lock_latency: NULL</span><br><span class="line">         rows_examined: NULL</span><br><span class="line">             rows_sent: NULL</span><br><span class="line">         rows_affected: NULL</span><br><span class="line">            tmp_tables: NULL</span><br><span class="line">       tmp_disk_tables: NULL</span><br><span class="line">             full_scan: NO</span><br><span class="line">        last_statement: NULL</span><br><span class="line">last_statement_latency: NULL</span><br><span class="line">        current_memory: 0</span><br><span class="line">             last_wait: NULL</span><br><span class="line">     last_wait_latency: NULL</span><br><span class="line">                source: NULL</span><br><span class="line">           trx_latency: NULL</span><br><span class="line">             trx_state: NULL</span><br><span class="line">        trx_autocommit: NULL</span><br><span class="line">                   pid: NULL</span><br><span class="line">          program_name: NULL</span><br><span class="line">1 row in set (0.06 sec)</span><br><span class="line">mysql&gt; select * from information_schema.processlist;</span><br><span class="line">+------+------+-----------+------+---------+------+-----------+----------------------------------------------+</span><br><span class="line">| ID   | USER | HOST      | DB   | COMMAND | TIME | STATE     | INFO                                         |</span><br><span class="line">+------+------+-----------+------+---------+------+-----------+----------------------------------------------+</span><br><span class="line">| 3879 | root | localhost | sys  | Query   |    0 | executing | select * from information_schema.processlist |</span><br><span class="line">+------+------+-----------+------+---------+------+-----------+----------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="MDLæ•…éšœè‡ªæ„ˆ"><a href="#MDLæ•…éšœè‡ªæ„ˆ" class="headerlink" title="MDLæ•…éšœè‡ªæ„ˆ"></a>MDLæ•…éšœè‡ªæ„ˆ</h2><h3 id="killæ‰€æœ‰ä¼šè¯"><a href="#killæ‰€æœ‰ä¼šè¯" class="headerlink" title="killæ‰€æœ‰ä¼šè¯"></a>killæ‰€æœ‰ä¼šè¯</h3><blockquote><p>ä¸æƒ³çŸ¥é“æ•…éšœåŸå› ï¼Œåªæƒ³å¿«é€Ÿè§£å†³æ•…éšœ</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">kill</span>æ‰ æ‰€æœ‰ä¼šè¯</span></span><br><span class="line">user=xxx</span><br><span class="line">password=xxx</span><br><span class="line">host=xxxx.mysql.rds.aliyuncs.com</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">mysql -u$user -p$password -h$host  -P$port -e "select  concat('KILL ',id,';') from information_schema.processlist;" &gt; tmpfile</span><br><span class="line"></span><br><span class="line">awk '&#123;if (NR != 1) print $0 &#125;' tmpfile | mysql -u$user -p$password -h$host  -P$port</span><br></pre></td></tr></table></figure><h3 id="MDLæ•…éšœæ’æŸ¥å’Œè§£å†³"><a href="#MDLæ•…éšœæ’æŸ¥å’Œè§£å†³" class="headerlink" title="MDLæ•…éšœæ’æŸ¥å’Œè§£å†³"></a>MDLæ•…éšœæ’æŸ¥å’Œè§£å†³</h3><p><a href="https://github.com/BoobooWei/DevOps-Database-Troubleshooting/blob/master/fault_self_healing_metadatalock.py" target="_blank" rel="noopener">MDLæ•…éšœè‡ªæ„ˆè„šæœ¬GitHubåœ°å€</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦ï¼šMetaData Lockå³å…ƒæ•°æ®é”ï¼Œåœ¨æ•°æ®åº“ä¸­å…ƒæ•°æ®å³æ•°æ®å­—å…¸ä¿¡æ¯åŒ…æ‹¬db,table,function,procedure,trigger,eventç­‰ã€‚metadata lockä¸»è¦ä¸ºäº†ä¿è¯å…ƒæ•°æ®çš„ä¸€è‡´æ€§,ç”¨äºå¤„ç†ä¸åŒçº¿ç¨‹æ“ä½œåŒä¸€æ•°æ®å¯¹è±¡çš„åŒæ­¥ä¸äº’æ–¥é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¤©æœ‰å®¢æˆ·(MySQL 5.6)é‡åˆ°è¯¥é—®é¢˜ï¼Œæœ€å…³é”®çš„æ˜¯å±äºç¬¬ä¸‰ç§æƒ…å†µï¼Œgoogleä¸Šæ ¹æœ¬æ‰¾ä¸åˆ°ç±»ä¼¼çš„æ•…éšœæ¡ˆä¾‹ï¼Œå”¯ä¸€ä¸€ä¸ªéå¸¸æ¥è¿‘çš„æ•…éšœæ¡ˆä¾‹ä¸­æ•°æ®åº“ç‰ˆæœ¬å´ä¸åŒï¼ˆå…·ä½“çœ‹ä¸‹æ–‡æ…¢æ…¢èŠï¼‰ï¼Œå“ï¼Œå›°éš¾é‡é‡å•Šï¼Œæœ€ç»ˆè¿˜æ˜¯è§£å†³äº†å“ˆã€‚&lt;/p&gt;
&lt;p&gt;alter tableçš„è¯­å¥æ˜¯å¾ˆå±é™©çš„ï¼Œåœ¨æ“ä½œä¹‹å‰æœ€å¥½ç¡®è®¤å¯¹è¦æ“ä½œçš„è¡¨æ²¡æœ‰ä»»ä½•è¿›è¡Œä¸­çš„æ“ä½œã€æ²¡æœ‰æœªæäº¤äº‹åŠ¡ã€ä¹Ÿæ²¡æœ‰æ˜¾å¼äº‹åŠ¡ä¸­çš„æŠ¥é”™è¯­å¥ã€‚å¦‚æœæœ‰alter tableçš„ç»´æŠ¤ä»»åŠ¡ï¼Œåœ¨æ— äººç›‘ç®¡çš„æ—¶å€™è¿è¡Œï¼Œæœ€å¥½é€šè¿‡lock_wait_timeoutè®¾ç½®å¥½è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´çš„metedataé”ç­‰å¾…ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯å¹¿è§’" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="é”æ•…éšœ" scheme="http://www.toberoot.com/tags/%E9%94%81%E6%95%85%E9%9A%9C/"/>
    
  </entry>
  
  <entry>
    <title>LINUX åŸºç¡€æœåŠ¡è¯¾ç¨‹ç¯å¢ƒä½¿ç”¨è¯´æ˜</title>
    <link href="http://www.toberoot.com/2016/12/23/booboo_easy_service/00_linux_classroom_env/"/>
    <id>http://www.toberoot.com/2016/12/23/booboo_easy_service/00_linux_classroom_env/</id>
    <published>2016-12-22T21:06:27.000Z</published>
    <updated>2020-03-24T05:02:31.699Z</updated>
    
    <content type="html"><![CDATA[<p>UP100 è¯¾ç¨‹åŸºäºRHEL6.5ã€RHEL7.0ã€ubuntu1604ã€WindowsXPå’ŒWindows2012R2ç³»ç»Ÿ</p><p>éœ€è¦å¼€å¯è™šæ‹Ÿæœºå¯ä»¥ç›´æ¥åŒå‡»å›¾æ ‡ï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶å°†ä»è®²å¸ˆæœºä¸‹è½½æ˜ åƒæ–‡ä»¶ï¼Œå¯èƒ½ä¼šæ¯”è¾ƒæ…¢ã€‚</p><p>æ§åˆ¶è™šæ‹Ÿæœºå¯ä»¥ä½¿ç”¨kioskç”¨æˆ·ï¼Œæ‰§è¡Œrht-vmctlå‘½ä»¤ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹å‘½ä»¤ä½¿ç”¨ã€‚</p><h3 id="æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹"><a href="#æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹" class="headerlink" title="æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹"></a>æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹</h3><p><strong>f0~fN</strong>ä¸ºæ•™å®¤ç‰©ç†æœºï¼Œå…¶åŸŸåä¸º<code>foundationN.ilt.example.com</code> ,å¯ç®€å†™ä¸º<code>fN</code>ã€‚å…¶IPä¸º<code>172.25.N.250</code>ï¼Œ<code>f0</code>ç‰¹æ®Šä¸º<code>172.25.254.250</code>ã€‚</p><p><code>classroom</code>è™šæ‹Ÿæœºä¸ºæ‰€æœ‰ç‰©ç†æœºå’Œè™šæ‹Ÿæœºçš„é»˜è®¤ç½‘å…³ï¼Œé…ç½®äº†å¤šä¸ªç½‘å¡è®¾ç½®äº†æ‰€æœ‰<code>172.25.N.254</code>çš„åœ°å€ï¼Œä¿è¯è™šæ‹Ÿæœºã€ç‰©ç†æœºå’Œå„ä¸ªå­¦ç”Ÿæœºä¹‹é—´çš„è·¯ç”±ã€‚é…ç½®äº†<code>DHCP</code>ã€<code>DNS</code>å’Œ<code>HTTP</code>æœåŠ¡ï¼Œå…¶åŸŸåä¸º<code>classroom.example.com</code>å¯ç®€å†™ä¸º<code>classroom</code>ã€‚</p><p>rhel6è™šæ‹Ÿæœºå‡å®‰è£…RHEL6.5ç³»ç»Ÿï¼Œrhel7è™šæ‹Ÿæœºå‡å®‰è£…RHEL7.0ç³»ç»Ÿï¼Œubuntu1604è™šæ‹Ÿæœºå‡å®‰è£…Ubuntu1604ç³»ç»Ÿï¼Œå‡å®‰è£…å›¾å½¢åŒ–ç•Œé¢å¹¶é…ç½®runlevel 5å¯åŠ¨ï¼Œrootå¯†ç ä¸ºuplooking ï¼Œé…ç½®äº†åŸºç¡€çš„YUMæºæŒ‡å‘classroomï¼Œ rhel6ã€rhel7ã€ubuntu1604ã€winxpå’Œwin2012r2è™šæ‹Ÿæœºå‡é…ç½®äº†1å—è™šæ‹Ÿæœºç½‘å¡ï¼Œeth0æ¥å…¥ç‰©ç†æœºbr0ç½‘æ¡¥ï¼ŒåŠ¨æ€è·å¾—ipåœ°å€:</p><table><thead><tr><th align="left">hostname</th><th align="left">ipaddr</th></tr></thead><tbody><tr><td align="left">rhel7</td><td align="left">172.25.N.10</td></tr><tr><td align="left">rhel6</td><td align="left">172.25.N.11</td></tr><tr><td align="left">winxp</td><td align="left">172.25.N.12</td></tr><tr><td align="left">ubuntu</td><td align="left">172.25.N.14</td></tr><tr><td align="left">win2012r2</td><td align="left">172.25.N.15</td></tr></tbody></table><p>rhel6ã€rhel7ã€ubuntu1604è™šæ‹Ÿæœºå‡é…ç½®ä¸¤å—è™šæ‹Ÿç¡¬ç›˜vdaå’Œvdbï¼Œä»¥æ–¹ä¾¿æˆè¯¾æ¼”ç¤ºã€‚é™¤winxpå’Œwin2012r2ä¹‹å¤–å…¶å®ƒè™šæ‹Ÿæœºå‡é…ç½®2GBè¿è¡Œå†…å­˜ï¼Œwinxpé…ç½®1GBè¿è¡Œå†…å­˜ï¼Œwin2012r2é…ç½®4GBè¿è¡Œå†…å­˜ã€‚</p><p>winxpè™šæ‹Ÿæœºä¸»æœºä¸Šå®‰è£…äº†å¦‚ä¸‹è½¯ä»¶ï¼š</p><ul><li>Cisco Packet Tracer</li><li>Putty</li><li>Winscp</li><li>Xshell</li><li>Wireshark</li><li>Navicat for Mysql</li><li>Microsoft Visio 2010</li><li>7-zip</li></ul><p>å·²åœ¨classroomä¸Šå®ŒæˆDNSé…ç½®ï¼Œæ­£å‘å’Œæ–¹å‘åŸŸååŠé‚®ä»¶ä»£ç†åŸŸåå’Œè™šæ‹ŸæœºåŸŸåè®¾ç½®å¦‚ä¸‹ï¼š</p><p>rhel7ä¸»æœºï¼š172.25.N.10</p><ul><li>rhel7-fN.example.com</li><li>dN.example.com</li><li>imapN.example.com</li><li>smtpN.example.com (MX)</li></ul><p>rhel6ä¸»æœºï¼š 172.25.N.11</p><ul><li>rhel6-fN.example.com</li><li>sN.example.com</li><li>wwwN.example.com</li><li>webapp-fN.example.com</li></ul><p>winxpä¸»æœºï¼š 172.25.N.12</p><ul><li>winxp-fN.example.com</li><li>install ä¸»æœºï¼š172.25.N.13</li><li>install-fN.example.com</li><li>ubuntuä¸»æœºï¼š172.25.N.14</li><li>ubuntu-fN.example.com</li></ul><p>win2012r2ä¸»æœºï¼š172.25.N.15</p><ul><li>win2012r2-fN.example.com</li></ul><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>rhel6.5 SElinuxæœ‰bugï¼Œå…‰ç›˜ä¸­é»˜è®¤æ²¡æœ‰selinuxç›¸å…³manpageï¼Œçœ‹manpageéœ€è¦å®‰è£…selinux-policy-docåŒ…ï¼Œä½†è¿™ä¸ªåŒ…éœ€è¦ä»RHNä¸‹è½½ã€‚</p><h3 id="ç½‘ç»œæ‹“æ‰‘å›¾"><a href="#ç½‘ç»œæ‹“æ‰‘å›¾" class="headerlink" title="ç½‘ç»œæ‹“æ‰‘å›¾"></a>ç½‘ç»œæ‹“æ‰‘å›¾</h3><p><img src="pic/01-up100.png" alt="up100"></p><hr><h2 id="åŸºç¡€æœåŠ¡ç®€ä»‹"><a href="#åŸºç¡€æœåŠ¡ç®€ä»‹" class="headerlink" title="åŸºç¡€æœåŠ¡ç®€ä»‹"></a>åŸºç¡€æœåŠ¡ç®€ä»‹</h2><p>æœ¬ç« å°†è®²è§£ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>RHEL6 ä¸­Linuxç³»ç»ŸæœåŠ¡çš„åŸºç¡€çŸ¥è¯†ã€System Vä¸Xinetdçš„æ¦‚å¿µï¼Œä»¥åŠé€šè¿‡ servcie å‘½ä»¤æ¥å¯åŠ¨æŸä¸€æœåŠ¡ï¼Œé€šè¿‡ chkconfig å‘½ä»¤æ¥è®¾ç½®æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨</li><li>RHEL7 ä¸­ å·²ç»æ›¿æ¢æ‰ System V initï¼Œå¹¶æ­£å¼é‡‡ç”¨å…¨æ–°çš„åˆå§‹åŒ–è¿›ç¨‹ Systemdï¼Œä»¥åŠé€šè¿‡systemctl å‘½ä»¤æ¥å¯åŠ¨æŸä¸€æœåŠ¡å’Œè®¾ç½®è¯¥æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨</li></ul><blockquote><p>é‡ç‚¹ç®€ä»‹rhel6ï¼Œrhel7åªåšå‘½ä»¤çš„ä»‹ç»ï¼Œå…·ä½“å†…å®¹è¯·å‚è€ƒã€Šsystemdè¯´æ˜ã€‹</p></blockquote><h3 id="ç³»ç»ŸæœåŠ¡çš„åŸºæœ¬æ¦‚å¿µ"><a href="#ç³»ç»ŸæœåŠ¡çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ç³»ç»ŸæœåŠ¡çš„åŸºæœ¬æ¦‚å¿µ"></a>ç³»ç»ŸæœåŠ¡çš„åŸºæœ¬æ¦‚å¿µ</h3><p>æœåŠ¡ï¼Œå…¶å®å°±æ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿåå°çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œä¸ºè®¡ç®—æœºç³»ç»Ÿæˆ–ç”¨æˆ·æä¾›æŸé¡¹ç‰¹å®šçš„æœåŠ¡ã€‚</p><p>åœ¨æˆ‘ä»¬çš„windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œå…¶åœ¨åå°ä¹Ÿè¿è¡Œäº†è®¸è®¸å¤šå¤šçš„æœåŠ¡ã€‚ä¾‹å¦‚æˆ‘ä»¬è£…çš„æ€æ¯’è½¯ä»¶ï¼Œå…¶åœ¨åå°è¿è¡Œäº†è®¸å¤šæˆ‘ä»¬çœ‹ä¸è§çš„æœåŠ¡ç¨‹åºï¼Œé€šè¿‡è¿™äº›æœåŠ¡æ¥ä¸ºç”¨æˆ·æˆ–è€…è®¡ç®—æœºç³»ç»Ÿæ¥æé«˜ç‰¹å®šçš„åŠŸèƒ½ã€‚</p><p>æœåŠ¡é€šå¸¸æ˜¯ä¸ä¸­æ–­è¿è¡Œçš„ï¼Œéšæ—¶å‡†å¤‡æ¥å—è¯·æ±‚ï¼Œä»è€Œæä¾›æŸé¡¹æœåŠ¡ã€‚ä¾‹å¦‚æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„ç½‘é¡µæœåŠ¡ï¼Œå…¶å°±æ˜¯ç”±ä¸€ä¸ªè¿è¡Œåœ¨æ‰€è®¿é—®ç½‘ç«™çš„æœåŠ¡å™¨ä¸Šçš„httpdæœåŠ¡æä¾›çš„æœåŠ¡ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨æµè§ˆå™¨è¾“å…¥éœ€è¦è®¿é—®ç½‘ç«™çš„åŸŸåï¼ŒæœåŠ¡å™¨ç«¯çš„httpdæœåŠ¡å°±ä¼šéšæ—¶çš„æ¥æ”¶æˆ‘ä»¬å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œå¹¶å“åº”å›ç»™æˆ‘ä»¬çš„ç”¨æˆ·ã€‚</p><p>æˆ‘ä»¬Linuxç³»ç»Ÿç»å¤§å¤šæ•°æœåŠ¡éƒ½æ˜¯ç½‘ç»œæœåŠ¡ï¼Œä¾‹å¦‚é‚®ä»¶æœåŠ¡ã€FTPæœåŠ¡ã€httpdæœåŠ¡ç­‰ç­‰ï¼Œç½‘ç»œæœåŠ¡å¯ä»¥ä½¿ä¸ºå…¶ä»–ç”¨æˆ·ã€å…¶ä»–è®¡ç®—æœºæä¾›ç‰¹å®šçš„æœåŠ¡ã€‚</p><h3 id="services-å’Œ-daemons"><a href="#services-å’Œ-daemons" class="headerlink" title="services å’Œ daemons"></a>services å’Œ daemons</h3><table><thead><tr><th align="left">æœåŠ¡å</th><th align="left">å®ˆæŠ¤è¿›ç¨‹å</th></tr></thead><tbody><tr><td align="left">rsyslog</td><td align="left">rsyslogd</td></tr><tr><td align="left">atd</td><td align="left">atd</td></tr><tr><td align="left">crond</td><td align="left">crond</td></tr></tbody></table><p><strong>æœåŠ¡çš„åˆ†ç±»</strong> æœåŠ¡åé€šå¸¸æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªè¿™ä¸ªåŸºäºç¨‹åºçš„æœåŠ¡åç§°ï¼Œæˆ‘ä»¬æŠŠå®ƒå«åšserviceï¼Œæ¯”å¦‚è¯´ftpæœåŠ¡ï¼ŒsambaæœåŠ¡ç­‰ç­‰ã€‚<br>è¿˜æœ‰ä¸€ä¸ªæ˜¯åŸºäºè¿›ç¨‹çš„æœåŠ¡åç§°ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠå®ƒå«åšdaemonï¼Œå®ˆæŠ¤è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨pså‘½ä»¤æ—¶å€™çœ‹åˆ°çš„åç§°ï¼Œæ¯”å¦‚httpdï¼Œæ¯”å¦‚namedä¹‹ç±»çš„ç­‰ç­‰ï¼Œä¸€èˆ¬æœåŠ¡çš„è¿›ç¨‹åéƒ½æ˜¯ç¨‹åºåç§°ååŠ ä¸Šä¸€ä¸ªdï¼Œå½“ç„¶ä¹Ÿæœ‰ä¸å°‘çš„ç‰¹ä¾‹ã€‚ä¹‹åæˆ‘ä»¬éƒ½ä¼šä¸€ä¸€å»è¯´è¿™äº›æœåŠ¡ã€‚</p><h3 id="åŸºäº-daemon-åˆ†ç±»"><a href="#åŸºäº-daemon-åˆ†ç±»" class="headerlink" title="åŸºäº daemon åˆ†ç±»"></a>åŸºäº daemon åˆ†ç±»</h3><p>é‚£ä¹ˆæ ¹æ®daemonï¼Œä¹Ÿå°±æ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæœåŠ¡åˆ†æˆä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ç‹¬ç«‹å¯åŠ¨çš„æœåŠ¡ï¼Œå«åšstand alone daemonï¼Œæˆ‘ä»¬ä¹‹åå­¦çš„æœåŠ¡åŸºæœ¬ä¸Šéƒ½æ˜¯ç‹¬ç«‹å¯åŠ¨çš„æœåŠ¡ã€‚å¦å¤–ä¸€ç§å«åšsuper daemonã€‚æˆ‘ä»¬åˆ†å¼€æ¥æ¥è¯´ä¸€ä¸‹è¿™ä¸¤ç§æœåŠ¡çš„ç‰¹å¾ã€‚</p><ul><li>1&gt; stand alone daemon ç‹¬ç«‹å¯åŠ¨æœåŠ¡</li><li>2&gt; super daemon è¶…çº§æœåŠ¡ xinted</li></ul><h4 id="System-V"><a href="#System-V" class="headerlink" title="System V"></a>System V</h4><p>æ€»çš„æ¥è¯´ï¼ŒLinuxç³»ç»Ÿé€šå¸¸ä½œä¸ºæœåŠ¡å™¨ç«¯çš„æ“ä½œç³»ç»Ÿæ¥ç”¨çš„ï¼Œæ‰€ä»¥Linuxç³»ç»Ÿæä¾›äº†è®¸è®¸å¤šçš„çš„æœåŠ¡ï¼Œæœ‰äº›æœåŠ¡éœ€è¦æˆ‘ä»¬è‡ªå·±æ¥è¿›è¡Œé…ç½®ï¼Œè¿™äº›æœåŠ¡çš„ç›®çš„å°±æ˜¯ä¸ºäº†ç»™æˆ‘ä»¬çš„è®¡ç®—æœºã€ç”¨æˆ·æä¾›æŸé¡¹ç‰¹å®šçš„åŠŸèƒ½ã€‚é‚£ä¹ˆå¯¹äºå„ç§ä¸åŒçš„æœåŠ¡ï¼ŒLinuxç³»ç»Ÿæ˜¯æ€ä¹ˆæ ·æ¥ç»Ÿä¸€è¿›è¡Œç®¡ç†çš„å‘¢ï¼Ÿ</p><p>åœ¨Linuxæ“ä½œç³»ç»Ÿä¸­ï¼ŒLinuxå¯¹äºæœåŠ¡çš„ç®¡ç†ä½“ç³»æ˜¯æ²¿ç”¨äº†System Vçš„æœåŠ¡ç®¡ç†ä½“ç³»ï¼ŒSystem VåŸæ¥æ˜¯æ—©æœŸAT&amp;Tçš„ä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚</p><p>å¯¹äºLinuxç³»ç»Ÿï¼ŒSystem Væä¾›äº†è¿è¡Œçº§åˆ«çš„æ¦‚å¿µï¼Œè¿˜è®°å¾—ä¹‹å‰ä¸€ç›´æåˆ°è¿‡çš„Linuxçš„å¯åŠ¨è¿è¡Œçº§åˆ«å—ï¼Ÿæ²¡é”™ï¼ŒSystem Vä¸€å…±æä¾›äº†7ç§è¿è¡Œçº§åˆ«</p><p>0   å…³æœº</p><p>1   å•ç”¨æˆ·æ¨¡å¼</p><p>2   ä¸å¸¦ç½‘ç»œçš„å¤šç”¨æˆ·æ¨¡å¼</p><p>3   å¸¦ç½‘ç»œçš„å¤šç”¨æˆ·æ¨¡å¼ï¼Œçº¯æ–‡æœ¬ç•Œé¢</p><p>4   æœªä½¿ç”¨</p><p>5   å¸¦ç½‘ç»œçš„å¤šç”¨æˆ·æ¨¡å¼ï¼Œå›¾å½¢ç•Œé¢</p><p>6   é‡å¯</p><p>å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œé€šå¸¸ä½¿ç”¨çš„æ˜¯çº§åˆ«3å’Œçº§åˆ«5ï¼Œæ¯ä¸ªçº§åˆ«ä¸‹éƒ½æœ‰å¯¹åº”çš„å¯åŠ¨ã€ä¸å¯åŠ¨çš„æœåŠ¡ï¼Œæ¯”å¦‚å•ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½æ˜¯ä¸å¯åŠ¨ï¼Œè¿™äº›éƒ½æ˜¯é€šè¿‡System Vè¿™ä¸ªæœåŠ¡ç®¡ç†ä½“ç³»æ¥å†³å®šçš„</p><p>System Vå®šä¹‰äº†initä¸ºç³»ç»Ÿå¯åŠ¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹PID=1ï¼Œè¿™ä¸ªè¿›ç¨‹çš„ç›®çš„å°±æ˜¯å»æŸ¥çœ‹ /etc/inittab ä¸­çš„ç³»ç»Ÿå¯åŠ¨çº§åˆ«ä»è€Œæ¥å¯åŠ¨å¯¹åº”çš„æœåŠ¡</p><p>å¯¹äºä¸åŒçš„æœåŠ¡ï¼Œå› ä¸ºå…¶æä¾›è¯¥æœåŠ¡çš„å‚å®¶ä¸åŒï¼Œæ‰€ä»¥è¿™äº›çš„æœåŠ¡çš„å¯åŠ¨ã€å…³é—­æœºåˆ¶é€šå¸¸ä¸åŒï¼Œåœ¨Linuxç³»ç»Ÿä¸­ï¼Œä¸ºäº†æ–¹ä¾¿çš„ç®¡ç†è¿™äº›æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡çš„å¯åŠ¨ã€ç»“æŸã€é‡å¯ç­‰æ“ä½œéƒ½ç”±ä¸€ä¸ªSystem Vè„šæœ¬æ¥è¿›è¡Œæ§åˆ¶ï¼Œæ‹¥æœ‰å›ºå®šçš„æ ¼å¼ã€‚</p><p>å¯¹äºLinuxç³»ç»Ÿä¸Šçš„æœåŠ¡ï¼Œè¿™äº›æœåŠ¡çš„System Vè„šæœ¬æ–‡ä»¶éƒ½æ˜¯å­˜æ”¾åœ¨ /etc/rc.d/init.d è¿™ä¸ªç›®å½•ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# cd /etc/rc.d/init.d/</span><br><span class="line">[root@rhel6 ~]# ls</span><br><span class="line">abrt-ccpp         firstboot     messagebus      quota_nld    snmptrapd</span><br><span class="line">abrtd             functions     mysqld          rdisc        spice-vdagentd</span><br><span class="line">abrt-oops         haldaemon     netconsole      restorecond  sshd</span><br><span class="line">acpid             halt          netfs           rngd         sssd</span><br><span class="line">atd               htcacheclean  network         rpcbind      sysstat</span><br><span class="line">auditd            httpd         NetworkManager  rpcgssd      udev-post</span><br><span class="line">autofs            ip6tables     nfs             rpcidmapd    vboxadd</span><br><span class="line">blk-availability  iptables      nfslock         rpcsvcgssd   vboxadd-service</span><br><span class="line">bluetooth         irqbalance    ntpd            rsyslog      vboxadd-x11</span><br><span class="line">certmonger        kdump         ntpdate         sandbox      vncserver</span><br><span class="line">cpuspeed          killall       oddjobd         saslauthd    wdaemon</span><br><span class="line">crond             lvm2-lvmetad  portreserve     single       winbind</span><br><span class="line">cups              lvm2-monitor  postfix         smartd       wpa_supplicant</span><br><span class="line">dnsmasq           mdmonitor     psacct          snmpd        ypbind</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œå­˜åœ¨äº†è®¸å¤šçº¯æ–‡æœ¬æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶éƒ½æ˜¯ç³»ç»Ÿæ¯ä¸€ä¸ªæœåŠ¡çš„System Vçš„è„šæœ¬æ–‡ä»¶ï¼Œå¯¹äºè¯¥è„šæœ¬æ–‡ä»¶ï¼Œæˆ‘ä»¬è¦å¯åŠ¨ä»€ä¹ˆæœåŠ¡ï¼Œéƒ½æ˜¯é€šè¿‡è¿™äº›è„šæœ¬æ–‡ä»¶æ¥å¯åŠ¨çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç¼–å†™System Vè„šæœ¬æ–‡ä»¶æ¥æ‰‹å·¥åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„ç”±System Væ¥æ§åˆ¶çš„æœåŠ¡ã€‚</p><p>å¯¹äºLinuxçš„æ‰€æœ‰çš„è¿™äº›æœåŠ¡ï¼Œæˆ‘ä»¬é€šè¿‡ service è¿™ä¸ªå‘½ä»¤æ¥è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†</p><p>å‘½ä»¤ service å¯ä»¥è°ƒç”¨æŒ‡å®šæœåŠ¡çš„System Vè„šæœ¬ï¼Œå¹¶æ‰§è¡ŒæŒ‡å®šçš„åŠ¨ä½œ</p><p><code>service æœåŠ¡å [start | stop | restart | status]</code></p><p>å¯¹äºLinuxç³»ç»Ÿçš„è¿™äº›æœåŠ¡ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ service è¿™ä¸ªå‘½ä»¤å»è°ƒç”¨è¯¥æœåŠ¡å¯¹åº”çš„System Vè„šæœ¬ï¼Œå¹¶æ‰§è¡Œå…¶æŒ‡å®šçš„åŠ¨ä½œ</p><p>åˆšæ‰æˆ‘ä»¬ä¹Ÿè¯´åˆ°äº†ï¼ŒSystem Vå®šä¹‰äº†è¿è¡Œçº§åˆ«çš„æ¦‚å¿µï¼Œæ¯ä¸ªè¿è¡Œçº§åˆ«å¯¹åº”æœ‰å¯åŠ¨ã€ä¸å¯åŠ¨çš„æœåŠ¡ï¼Œåœ¨ <code>/etc/rc.d</code> è¿™ä¸ªç›®å½•ä¸‹ï¼Œé™¤äº†æˆ‘ä»¬åˆšæ‰çš„ init.d è¿™ä¸ªç›®å½•ï¼Œæˆ‘ä»¬è¿˜å‘ç°è¿˜æœ‰å…¶å®ƒçš„ä¸€äº›ç›®å½•ï¼Œè¯¸å¦‚ rc0.dã€rc1.dç­‰è¿™äº›ç›®å½•å°±åˆ†åˆ«å¯¹åº”äº†ç³»ç»Ÿçš„7ä¸­å¯åŠ¨çº§åˆ«ï¼Œæ¯ä¸ªç›®å½•é‡Œé¢éƒ½å­˜æ”¾äº†è®¸å¤šçš„<br>æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”ç€ä¸€ä¸ªç‰¹å®šçš„æœåŠ¡ï¼Œå¹¶æ ‡å¿—æœ‰æ˜¯å¦å¼€æœºå¯åŠ¨ä»¥åŠå¯åŠ¨é¡ºåºã€‚</p><p>æˆ‘ä»¬å‘ç°ï¼Œåœ¨è¿™äº›ç›®å½•é‡Œé¢ï¼Œå­˜æ”¾çš„éƒ½æ˜¯é“¾æ¥æ–‡ä»¶ï¼Œä¸è¿‡è¿™æ¯ä¸€ä¸ªé“¾æ¥æ–‡ä»¶çš„åå­—éƒ½æœ‰ç€ä¸¥æ ¼çš„è§„å®šã€‚æ¯ä¸€ä¸ªé“¾æ¥æ–‡ä»¶éƒ½ç”±3éƒ¨åˆ†ç»„æˆ</p><p><code>K15httpd -&gt; ../init.d/httpdã€€ã€€ã€€ã€€S55sshd -&gt; ../init.d/sshd</code></p><ul><li>â‘ ç¬¬ä¸€ä¸ªéƒ¨åˆ†æ˜¯ç¬¬ä¸€ä¸ªå­—æ¯Kæˆ–è€…Sï¼Œè¡¨ç¤ºè¯¥æœåŠ¡æ˜¯ä¸æ˜¯æ˜¯ä¸æ˜¯å¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼ŒKè¡¨ç¤ºå¼€æœºä¸å¯åŠ¨ï¼ŒSè¡¨ç¤ºå¼€æœºå°±å¯åŠ¨</li><li>â‘¡ç¬¬äºŒä¸ªéƒ¨åˆ†æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¿™ä¸ªæ•°å­—ä»£è¡¨çš„æ˜¯è¯¥æœåŠ¡çš„å¯åŠ¨é¡ºåºï¼ŒæœåŠ¡å¯åŠ¨çš„é¡ºåºéå¸¸çš„é‡è¦ï¼Œä¾‹å¦‚æˆ‘ä»¬çš„ç½‘ç»œæœåŠ¡éœ€è¦åœ¨é‚®ä»¶æœåŠ¡ä¹‹å‰å¯åŠ¨</li><li>â‘¢ç¬¬ä¸‰ä¸ªéƒ¨åˆ†å°±æ˜¯å¯¹åº”æœåŠ¡çš„åå­—ï¼Œè¯¥é“¾æ¥æ–‡ä»¶å…¶å®éƒ½æ˜¯æŒ‡å‘çš„æ˜¯ init.d è¿™ä¸ªç›®å½•ä¸‹çš„System Vè„šæœ¬æ–‡ä»¶</li></ul><p>æˆ‘ä»¬å¦‚æœå¸Œæœ›æŸæœåŠ¡å¼€æœºå°±å¯åŠ¨ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ rc5.d ç›®å½•ä¸‹çš„é“¾æ¥æ–‡ä»¶ï¼Œä¸è¿‡è¿™æ ·åšå¾ˆéº»çƒ¦ï¼ŒLinuxç³»ç»Ÿæä¾›äº†ä¸€ä¸ª <code>chkconfig</code> å‘½ä»¤å¯ä»¥æ¥è®¾ç½®æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨</p><p>æˆ‘ä»¬é€šè¿‡ <code>chkconfig --list</code> å‘½ä»¤æ¥æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„å¼€æœºå¯åŠ¨æƒ…å†µ</p><p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦è®¾ç½® network æœåŠ¡å¼€å¯è‡ªåŠ¨å¯åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>chkconfig httpd on</code> å‘½ä»¤å³å¯</p><p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦è®¾ç½® network æœåŠ¡å¼€å¯ä¸å¯åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>chkconfig httpd off</code> å‘½ä»¤å³å¯</p><h4 id="xinetd"><a href="#xinetd" class="headerlink" title="xinetd"></a>xinetd</h4><p>å…¶å®å¯¹äºä¸Šé¢é€šè¿‡ System Væ¥ç®¡ç†çš„ä¸€äº›æœåŠ¡éƒ½å±äºLinuxç³»ç»Ÿçš„å¸¸é©»è¿è¡Œçš„æœåŠ¡ï¼Œå…¶å®åœ¨Linuxç³»ç»Ÿä¸­è¿˜æœ‰è®¸å¤šä¸å¸¸é©»çš„ä¸€äº›æœåŠ¡ï¼Œä¾‹å¦‚ telnetã€rsyncæœåŠ¡ï¼Œè¿™äº›æœåŠ¡åˆ™æ˜¯é€šè¿‡ xinetd è¿™ä¸ªæœåŠ¡æ¥è¿›è¡Œç®¡ç†çš„ã€‚</p><p>xinetd æ§åˆ¶çš„å°±æ˜¯é‚£äº›ä¸å¸¸é©»çš„æœåŠ¡ï¼ŒåŠŸèƒ½è¾ƒä¸ºç®€å•çš„æœåŠ¡</p><p>xinetdå…¶å®è‡ªå·±æœ¬èº«å°±æ˜¯ä½œä¸ºä¸€ä¸ªç³»ç»Ÿçš„å¸¸é©»çš„æœåŠ¡è¿è¡Œåœ¨åå°ï¼Œè€Œxinetdæ‰€æ§åˆ¶çš„æœåŠ¡åœ¨æ²¡æœ‰è¿æ¥è¯·æ±‚çš„æ—¶å€™æ˜¯ä¸è¿è¡Œçš„ï¼Œæ‰€æœ‰xinetdæ§åˆ¶çš„æœåŠ¡çš„è¿æ¥è¯·æ±‚éƒ½ä¼šæäº¤ç»™xinetdæ¥è¿›è¡Œä»£ç†</p><p>xinetdåœ¨æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚åï¼Œä¼šæ ¹æ®è¯·æ±‚çš„åè®®åŠæœåŠ¡å¯åŠ¨ç›¸åº”çš„æœåŠ¡è¿›ç¨‹ï¼Œè¿›ç¨‹å¤„ç†å®Œåè¯·æ±‚å°±ä¼šç»“æŸ</p><p>xinetdæœ¬èº«å°±æ˜¯ä¸€ä¸ªç³»ç»ŸæœåŠ¡ï¼Œé€šè¿‡ System Væ¥å¯¹å…¶è¿›è¡Œç®¡ç†ï¼Œåœ¨CentOS6/RHEL6ä¸­ï¼ŒxinetdæœåŠ¡é»˜è®¤æ˜¯æ²¡æœ‰å®‰è£…çš„ï¼Œæˆ‘ä»¬è‹¥è¦ä½¿ç”¨è¯¥æœåŠ¡ï¼Œé¦–å…ˆéœ€è¦å®‰è£…å®ƒ<code>yum install xinetd</code></p><p>åœ¨æˆ‘ä»¬å®‰è£…å¥½æˆ‘ä»¬çš„<code>xinetd</code>æœåŠ¡ä»¥åï¼Œæˆ‘ä»¬è¿™æ—¶å†é€šè¿‡ <code>chkconfig --list</code> å‘½ä»¤æ¥æŸ¥çœ‹æ‰€æœ‰çš„æœåŠ¡å¯åŠ¨è®¾ç½®</p><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨å®‰è£…äº†xinetdæœåŠ¡ä»¥åï¼Œå…¶ä¸‹é¢å‡ºç°äº†ä¸€äº›å…¶ä»–çš„æœåŠ¡é€‰é¡¹ï¼Œä¾‹å¦‚<code>rsync</code>ï¼Œ<code>chargen-dgram</code>ç­‰è¿™äº›æœåŠ¡ï¼Œè¿™äº›æœåŠ¡éƒ½æ˜¯ç³»ç»Ÿçš„ä¸€äº›ä¸å¸¸é©»æœåŠ¡ï¼Œéƒ½æ˜¯é€šè¿‡xinetdè¿™ä¸ªæœåŠ¡æ¥å¯¹å…¶è¿›è¡Œç®¡ç†çš„</p><p><code>xinetd</code>æœåŠ¡çš„é…ç½®æ–‡ä»¶æ˜¯ <code>/etc/xinetd.conf</code></p><h3 id="ç«¯å£å·"><a href="#ç«¯å£å·" class="headerlink" title="ç«¯å£å·"></a>ç«¯å£å·</h3><ul><li>æŸ¥çœ‹ <code>netstat -luntp</code></li><li>è½¯ä»¶å    <code>net-tools</code></li></ul><h3 id="åŸºç¡€æœåŠ¡æ€»ç»“"><a href="#åŸºç¡€æœåŠ¡æ€»ç»“" class="headerlink" title="åŸºç¡€æœåŠ¡æ€»ç»“"></a>åŸºç¡€æœåŠ¡æ€»ç»“</h3><p><strong>RHEL 6</strong></p><p>æœåŠ¡çš„å¯åŠ¨ åœæ­¢ é‡å¯ çŠ¶æ€    <code>service æœåŠ¡å [start | stop | restart | status]</code></p><p>æœåŠ¡å¼€æœºå¯åŠ¨çŠ¶æ€        <code>chkconfig --list</code></p><p>è®¾ç½®æœåŠ¡å¼€æœºå¯åŠ¨        <code>chkconfig æœåŠ¡å on</code></p><p>è®¾ç½®æœåŠ¡å¼€æœºä¸å¯åŠ¨        <code>chkconfig æœåŠ¡å off</code></p><p><strong>RHEL 7</strong></p><p>æœåŠ¡çš„å¯åŠ¨ åœæ­¢ é‡å¯ çŠ¶æ€    <code>systemctl [start | stop | restart | status] æœåŠ¡å</code></p><p>è®¾ç½®æœåŠ¡å¼€æœºå¯åŠ¨        <code>systemctl enable æœåŠ¡å</code></p><p>è®¾ç½®æœåŠ¡å¼€æœºä¸å¯åŠ¨        <code>systemctl disable æœåŠ¡å</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;UP100 è¯¾ç¨‹åŸºäºRHEL6.5ã€RHEL7.0ã€ubuntu1604ã€WindowsXPå’ŒWindows2012R2ç³»ç»Ÿ&lt;/p&gt;
&lt;p&gt;éœ€è¦å¼€å¯è™šæ‹Ÿæœºå¯ä»¥ç›´æ¥åŒå‡»å›¾æ ‡ï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶å°†ä»è®²å¸ˆæœºä¸‹è½½æ˜ åƒæ–‡ä»¶ï¼Œå¯èƒ½ä¼šæ¯”è¾ƒæ…¢ã€‚&lt;/p&gt;
&lt;p&gt;æ§åˆ¶è™šæ‹Ÿæœºå¯ä»¥ä½¿ç”¨kioskç”¨æˆ·ï¼Œæ‰§
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/Linux%E7%AE%80%E6%98%93%E6%9C%8D%E5%8A%A1%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="LinuxåŸºç¡€æœåŠ¡" scheme="http://www.toberoot.com/tags/Linux%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>FTPæ–‡ä»¶å…±äº«æœåŠ¡</title>
    <link href="http://www.toberoot.com/2016/12/23/booboo_easy_service/02_ftp/"/>
    <id>http://www.toberoot.com/2016/12/23/booboo_easy_service/02_ftp/</id>
    <published>2016-12-22T21:06:27.000Z</published>
    <updated>2020-03-24T05:02:31.715Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¯¾ç¨‹è¦æ±‚</p></blockquote><ol><li>è®¾ç½®vsftpdæœåŠ¡åŒ¿åç”¨æˆ·èƒ½å¤Ÿå¯¹/var/ftp/pub/ç›®å½•æœ‰ä¸Šä¼ ä¸‹è½½çš„æƒé™ã€‚</li><li>ç³»ç»Ÿç”¨æˆ·èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œä¸Šä¼ ä¸‹è½½åˆ é™¤</li><li>é™¤äº†ç³»ç»Ÿç”¨æˆ·studentæœ‰chrootçš„æƒé™ï¼Œå…¶ä»–ç³»ç»Ÿç”¨æˆ·æ²¡æœ‰chrootçš„æƒé™</li></ol><h3 id="FTPæœåŠ¡"><a href="#FTPæœåŠ¡" class="headerlink" title="FTPæœåŠ¡"></a>FTPæœåŠ¡</h3><p>FTP æ˜¯File Transfer Protocolï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰çš„è‹±æ–‡ç®€ç§°ï¼Œè€Œä¸­æ–‡ç®€ç§°ä¸ºâ€œæ–‡ä¼ åè®®â€ã€‚ç”¨äº<br>Internetä¸Šçš„æ§åˆ¶æ–‡ä»¶çš„åŒå‘ä¼ è¾“ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ˆApplicationï¼‰ã€‚åŸºäºä¸åŒçš„æ“ä½œç³»ç»Ÿæœ‰<br>ä¸åŒçš„FTPåº”ç”¨ç¨‹åºï¼Œè€Œæ‰€æœ‰è¿™äº›åº”ç”¨ç¨‹åºéƒ½éµå®ˆåŒä¸€ç§åè®®ä»¥ä¼ è¾“æ–‡ä»¶ã€‚åœ¨FTPçš„ä½¿ç”¨å½“ä¸­ï¼Œç”¨æˆ·ç»å¸¸é‡åˆ°ä¸¤<br>ä¸ªæ¦‚å¿µï¼šâ€ä¸‹è½½â€ï¼ˆDownloadï¼‰å’Œâ€ä¸Šä¼ â€ï¼ˆUploadï¼‰ã€‚â€ä¸‹è½½â€æ–‡ä»¶å°±æ˜¯ä»è¿œç¨‹ä¸»æœºæ‹·è´æ–‡ä»¶è‡³è‡ªå·±çš„è®¡ç®—æœº<br>ä¸Šï¼›â€ä¸Šä¼ â€æ–‡ä»¶å°±æ˜¯å°†æ–‡ä»¶ä»è‡ªå·±çš„è®¡ç®—æœºä¸­æ‹·è´è‡³è¿œç¨‹ä¸»æœºä¸Šã€‚ç”¨Internetè¯­è¨€æ¥è¯´ï¼Œç”¨æˆ·å¯é€šè¿‡å®¢æˆ·æœºç¨‹<br>åºå‘ï¼ˆä»ï¼‰è¿œç¨‹ä¸»æœºä¸Šä¼ ï¼ˆä¸‹è½½ï¼‰æ–‡ä»¶ã€‚</p><h3 id="FTPåŸç†"><a href="#FTPåŸç†" class="headerlink" title="FTPåŸç†"></a>FTPåŸç†</h3><p>FTPåªé€šè¿‡TCPè¿æ¥,æ²¡æœ‰ç”¨äºFTPçš„UDPç»„ä»¶ã€‚</p><p>FTPä¸åŒäºå…¶ä»–æœåŠ¡çš„æ˜¯å®ƒä½¿ç”¨äº†ä¸¤ä¸ªç«¯å£, ä¸€ä¸ªæ•°æ®ç«¯å£å’Œä¸€ä¸ªå‘½ä»¤ç«¯å£(æˆ–ç§°ä¸ºæ§åˆ¶ç«¯å£)ã€‚</p><p>é€šå¸¸21ç«¯å£æ˜¯å‘½ä»¤ç«¯å£ï¼Œ20ç«¯å£æ˜¯æ•°æ®ç«¯å£ã€‚å½“æ··å…¥ä¸»åŠ¨/è¢«åŠ¨æ¨¡å¼çš„æ¦‚å¿µæ—¶ï¼Œæ•°æ®ç«¯å£å°±æœ‰å¯èƒ½ä¸æ˜¯20äº†ã€‚</p><p><strong>å·¥ä½œæ¨¡å¼</strong> FTPæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š</p><ul><li>Standard (PORTæ–¹å¼ï¼Œä¸»åŠ¨æ–¹å¼)</li><li>Passive (PASVï¼Œè¢«åŠ¨æ–¹å¼)ã€‚</li></ul><p><strong>Portæ¨¡å¼</strong></p><p>ä¸»åŠ¨æ¨¡å¼ä¸‹ï¼ŒFTPå®¢æˆ·ç«¯ä»ä»»æ„çš„éç‰¹æ®Šçš„ç«¯å£ï¼ˆN &gt; 1023ï¼‰è¿å…¥åˆ°FTPæœåŠ¡å™¨çš„å‘½ä»¤ç«¯å£â€“21ç«¯å£ã€‚ç„¶åå®¢æˆ·ç«¯åœ¨N+1ï¼ˆN+1 &gt;= 1024ï¼‰ç«¯å£ç›‘å¬ï¼Œå¹¶ä¸”é€šè¿‡N+1ï¼ˆN+1 &gt;= 1024ï¼‰ç«¯å£å‘é€å‘½ä»¤ç»™FTPæœåŠ¡å™¨ã€‚æœåŠ¡å™¨ä¼šåè¿‡æ¥è¿æ¥ç”¨æˆ·æœ¬åœ°æŒ‡å®šçš„æ•°æ®ç«¯å£ï¼Œæ¯”å¦‚20ç«¯å£ã€‚</p><p>ä»¥æœåŠ¡å™¨ç«¯é˜²ç«å¢™ä¸ºç«‹è¶³ç‚¹ï¼Œè¦æ”¯æŒä¸»åŠ¨æ¨¡å¼FTPéœ€è¦æ‰“å¼€å¦‚ä¸‹äº¤äº’ä¸­ä½¿ç”¨åˆ°çš„ç«¯å£ï¼š</p><ul><li>FTPæœåŠ¡å™¨å‘½ä»¤ï¼ˆ21ï¼‰ç«¯å£æ¥å—å®¢æˆ·ç«¯ä»»æ„ç«¯å£ï¼ˆå®¢æˆ·ç«¯åˆå§‹è¿æ¥ï¼‰</li><li>FTPæœåŠ¡å™¨å‘½ä»¤ï¼ˆ21ï¼‰ç«¯å£åˆ°å®¢æˆ·ç«¯ç«¯å£ï¼ˆ&gt;1023ï¼‰ï¼ˆæœåŠ¡å™¨å“åº”å®¢æˆ·ç«¯å‘½ä»¤ï¼‰</li><li>FTPæœåŠ¡å™¨æ•°æ®ï¼ˆ20ï¼‰ç«¯å£åˆ°å®¢æˆ·ç«¯ç«¯å£ï¼ˆ&gt;1023ï¼‰ï¼ˆæœåŠ¡å™¨åˆå§‹åŒ–æ•°æ®è¿æ¥åˆ°å®¢æˆ·ç«¯æ•°æ®ç«¯å£ï¼‰</li><li>FTPæœåŠ¡å™¨æ•°æ®ï¼ˆ20ï¼‰ç«¯å£æ¥å—å®¢æˆ·ç«¯ç«¯å£ï¼ˆ&gt;1023ï¼‰ï¼ˆå®¢æˆ·ç«¯å‘é€ACKåŒ…åˆ°æœåŠ¡å™¨çš„æ•°æ®ç«¯å£ï¼‰</li></ul><p>ç”¨å›¾è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><p><img src="pic/15.jpg" alt="15"></p><p>åœ¨ç¬¬1æ­¥ä¸­ï¼Œå®¢æˆ·ç«¯çš„å‘½ä»¤ç«¯å£ä¸FTPæœåŠ¡å™¨çš„å‘½ä»¤ç«¯å£å»ºç«‹è¿æ¥ï¼Œå¹¶å‘é€å‘½ä»¤â€œPORT 1027â€ã€‚ç„¶ååœ¨ç¬¬2æ­¥ä¸­ï¼ŒFTPæœåŠ¡å™¨ç»™å®¢æˆ·ç«¯çš„å‘½ä»¤ç«¯å£è¿”å›ä¸€ä¸ªâ€ACKâ€ã€‚åœ¨ç¬¬3æ­¥ä¸­ï¼ŒFTPæœåŠ¡å™¨å‘èµ·ä¸€ä¸ªä»å®ƒè‡ªå·±çš„æ•°æ®ç«¯å£ï¼ˆ20ï¼‰åˆ°å®¢æˆ·ç«¯å…ˆå‰æŒ‡å®šçš„æ•°æ®ç«¯å£ï¼ˆ1027ï¼‰çš„è¿æ¥ï¼Œæœ€åå®¢æˆ·ç«¯åœ¨ç¬¬4æ­¥ä¸­ç»™æœåŠ¡å™¨ç«¯è¿”å›ä¸€ä¸ªâ€ACKâ€ã€‚</p><p>ä¸»åŠ¨æ–¹å¼FTPçš„ä¸»è¦é—®é¢˜å®é™…ä¸Šåœ¨äºå®¢æˆ·ç«¯ã€‚FTPçš„å®¢æˆ·ç«¯å¹¶æ²¡æœ‰å®é™…å»ºç«‹ä¸€ä¸ªåˆ°æœåŠ¡å™¨æ•°æ®ç«¯å£çš„è¿æ¥ï¼Œå®ƒåªæ˜¯ç®€å•çš„å‘Šè¯‰æœåŠ¡å™¨è‡ªå·±ç›‘å¬çš„ç«¯å£å·ï¼ŒæœåŠ¡å™¨å†å›æ¥è¿æ¥å®¢æˆ·ç«¯è¿™ä¸ªæŒ‡å®šçš„ç«¯å£ã€‚å¯¹äºå®¢æˆ·ç«¯çš„é˜²ç«å¢™æ¥è¯´ï¼Œè¿™æ˜¯ä»å¤–éƒ¨ç³»ç»Ÿå»ºç«‹åˆ°å†…éƒ¨å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œè¿™æ˜¯é€šå¸¸ä¼šè¢«é˜»å¡çš„ã€‚</p><p><strong>Passiveæ¨¡å¼</strong></p><p>ä¸ºäº†è§£å†³æœåŠ¡å™¨å‘èµ·åˆ°å®¢æˆ·çš„è¿æ¥çš„é—®é¢˜ï¼Œäººä»¬å¼€å‘äº†ä¸€ç§ä¸åŒçš„FTPè¿æ¥æ–¹å¼ã€‚è¿™å°±æ˜¯æ‰€è°“çš„è¢«åŠ¨æ–¹å¼ï¼Œæˆ–è€…å«åšPASVï¼Œå½“å®¢æˆ·ç«¯é€šçŸ¥æœåŠ¡å™¨å®ƒå¤„äºè¢«åŠ¨æ¨¡å¼æ—¶æ‰å¯ç”¨ã€‚</p><p>åœ¨è¢«åŠ¨æ–¹å¼FTPä¸­ï¼Œå‘½ä»¤è¿æ¥å’Œæ•°æ®è¿æ¥éƒ½ç”±å®¢æˆ·ç«¯ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³ä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„æ•°æ®ç«¯å£çš„å…¥æ–¹å‘è¿æ¥è¢«é˜²ç«å¢™è¿‡æ»¤æ‰çš„é—®é¢˜ã€‚å½“å¼€å¯ä¸€ä¸ªFTPè¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯æ‰“å¼€ä¸¤ä¸ªä»»æ„çš„éç‰¹æƒæœ¬åœ°ç«¯å£ï¼ˆN &gt;; 1024å’ŒN+1ï¼‰ã€‚ç¬¬ä¸€ä¸ªç«¯å£è¿æ¥æœåŠ¡å™¨çš„21ç«¯å£ï¼Œä½†ä¸ä¸»åŠ¨æ–¹å¼çš„FTPä¸åŒï¼Œå®¢æˆ·ç«¯ä¸ä¼šæäº¤PORTå‘½ä»¤å¹¶å…è®¸æœåŠ¡å™¨æ¥å›è¿å®ƒçš„æ•°æ®ç«¯å£ï¼Œè€Œæ˜¯æäº¤PASVå‘½ä»¤ã€‚è¿™æ ·åšçš„ç»“æœæ˜¯æœåŠ¡å™¨ä¼šå¼€å¯ä¸€ä¸ªä»»æ„çš„éç‰¹æƒç«¯å£ï¼ˆP &gt;; 1024ï¼‰ï¼Œå¹¶å‘é€PORT På‘½ä»¤ç»™å®¢æˆ·ç«¯ã€‚ç„¶åå®¢æˆ·ç«¯å‘èµ·ä»æœ¬åœ°ç«¯å£N+1åˆ°æœåŠ¡å™¨çš„ç«¯å£Pçš„è¿æ¥ç”¨æ¥ä¼ é€æ•°æ®ã€‚</p><p>å¯¹äºæœåŠ¡å™¨ç«¯çš„é˜²ç«å¢™æ¥è¯´ï¼Œå¿…é¡»å…è®¸ä¸‹é¢çš„é€šè®¯æ‰èƒ½æ”¯æŒè¢«åŠ¨æ–¹å¼çš„FTP:</p><ul><li>FTPæœåŠ¡å™¨å‘½ä»¤ï¼ˆ21ï¼‰ç«¯å£æ¥å—å®¢æˆ·ç«¯ä»»æ„ç«¯å£ï¼ˆå®¢æˆ·ç«¯åˆå§‹è¿æ¥ï¼‰</li><li>FTPæœåŠ¡å™¨å‘½ä»¤ï¼ˆ21ï¼‰ç«¯å£åˆ°å®¢æˆ·ç«¯ç«¯å£ï¼ˆ&gt;1023ï¼‰ï¼ˆæœåŠ¡å™¨å“åº”å®¢æˆ·ç«¯å‘½ä»¤ï¼‰</li><li>FTPæœåŠ¡å™¨æ•°æ®ç«¯å£ï¼ˆ&gt;1023ï¼‰æ¥å—å®¢æˆ·ç«¯ç«¯å£ï¼ˆ&gt;1023ï¼‰ï¼ˆå®¢æˆ·ç«¯åˆå§‹åŒ–æ•°æ®è¿æ¥åˆ°æœåŠ¡å™¨æŒ‡å®šçš„ä»»æ„ç«¯å£ï¼‰</li><li>FTPæœåŠ¡å™¨æ•°æ®ç«¯å£ï¼ˆ&gt;1023ï¼‰åˆ°å®¢æˆ·ç«¯ç«¯å£ï¼ˆ&gt;1023ï¼‰ï¼ˆæœåŠ¡å™¨å‘é€ACKå“åº”å’Œæ•°æ®åˆ°å®¢æˆ·ç«¯çš„æ•°æ®ç«¯å£ï¼‰</li></ul><p>ç”¨å›¾è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><p><img src="pic/16.jpg" alt="16"></p><p>åœ¨ç¬¬1æ­¥ä¸­ï¼Œå®¢æˆ·ç«¯çš„å‘½ä»¤ç«¯å£ä¸æœåŠ¡å™¨çš„å‘½ä»¤ç«¯å£å»ºç«‹è¿æ¥ï¼Œå¹¶å‘é€å‘½ä»¤â€œPASVâ€ã€‚ç„¶ååœ¨ç¬¬2æ­¥ä¸­ï¼ŒæœåŠ¡å™¨è¿”å›å‘½ä»¤â€PORT 2024â€ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯ï¼ˆæœåŠ¡å™¨ï¼‰ç”¨å“ªä¸ªç«¯å£ä¾¦å¬æ•°æ®è¿æ¥ã€‚åœ¨ç¬¬3æ­¥ä¸­ï¼Œå®¢æˆ·ç«¯åˆå§‹åŒ–ä¸€ä¸ªä»è‡ªå·±çš„æ•°æ®ç«¯å£åˆ°æœåŠ¡å™¨ç«¯æŒ‡å®šçš„æ•°æ®ç«¯å£çš„æ•°æ®è¿æ¥ã€‚æœ€åæœåŠ¡å™¨åœ¨ç¬¬4 æ­¥ä¸­ç»™å®¢æˆ·ç«¯çš„æ•°æ®ç«¯å£è¿”å›ä¸€ä¸ªâ€ACKâ€å“åº”ã€‚</p><p>è¢«åŠ¨æ–¹å¼çš„FTPè§£å†³äº†å®¢æˆ·ç«¯çš„è®¸å¤šé—®é¢˜ï¼Œä½†åŒæ—¶ç»™æœåŠ¡å™¨ç«¯å¸¦æ¥äº†æ›´å¤šçš„é—®é¢˜ã€‚æœ€å¤§çš„é—®é¢˜æ˜¯éœ€è¦å…è®¸ä»ä»»æ„è¿œç¨‹ç»ˆç«¯åˆ°æœåŠ¡å™¨é«˜ä½ç«¯å£çš„è¿æ¥ã€‚å¹¸è¿çš„æ˜¯ï¼Œè®¸å¤šFTPå®ˆæŠ¤ç¨‹åºï¼ŒåŒ…æ‹¬æµè¡Œçš„WU-FTPDå…è®¸ç®¡ç†å‘˜æŒ‡å®šFTPæœåŠ¡å™¨ä½¿ç”¨çš„ç«¯å£èŒƒå›´ã€‚è¯¦ç»†å†…å®¹å‚çœ‹é™„å½•1ã€‚</p><p>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯å®¢æˆ·ç«¯æœ‰çš„æ”¯æŒè¢«åŠ¨æ¨¡å¼ï¼Œæœ‰çš„ä¸æ”¯æŒè¢«åŠ¨æ¨¡å¼ï¼Œå¿…é¡»è€ƒè™‘å¦‚ä½•èƒ½æ”¯æŒè¿™äº›å®¢æˆ·ç«¯ï¼Œä»¥åŠä¸ºä»–ä»¬æä¾›è§£å†³åŠæ³•ã€‚ä¾‹å¦‚ï¼ŒSolarisæä¾›çš„FTPå‘½ä»¤è¡Œå·¥å…·å°±ä¸æ”¯æŒè¢«åŠ¨æ¨¡å¼ï¼Œéœ€è¦ç¬¬ä¸‰æ–¹çš„FTPå®¢æˆ·ç«¯ï¼Œæ¯”å¦‚ncftpã€‚</p><p>éšç€WWWçš„å¹¿æ³›æµè¡Œï¼Œè®¸å¤šäººä¹ æƒ¯ç”¨webæµè§ˆå™¨ä½œä¸ºFTPå®¢æˆ·ç«¯ã€‚å¤§å¤šæ•°æµè§ˆå™¨åªåœ¨è®¿é—®ftp://è¿™æ ·çš„URLæ—¶æ‰æ”¯æŒè¢«åŠ¨æ¨¡å¼ã€‚è¿™åˆ°åº•æ˜¯å¥½è¿˜æ˜¯åå–å†³äºæœåŠ¡å™¨å’Œé˜²ç«å¢™çš„é…ç½®ã€‚</p><p>ä¸‹é¢çš„å›¾è¡¨ä¼šå¸®åŠ©ç®¡ç†å‘˜ä»¬è®°ä½æ¯ç§FTPæ–¹å¼æ˜¯æ€æ ·å·¥ä½œçš„ï¼š</p><p><strong>ä¸»åŠ¨FTPï¼š</strong></p><ol><li>å‘½ä»¤è¿æ¥ï¼šå®¢æˆ·ç«¯ &gt;1023ç«¯å£ -&gt; æœåŠ¡å™¨ 21ç«¯å£</li><li>æ•°æ®è¿æ¥ï¼šå®¢æˆ·ç«¯ &gt;1023ç«¯å£ &lt;- æœåŠ¡å™¨ 20ç«¯å£</li></ol><p><strong>è¢«åŠ¨FTPï¼š</strong></p><ol><li>å‘½ä»¤è¿æ¥ï¼šå®¢æˆ·ç«¯ &gt;1023ç«¯å£ -&gt; æœåŠ¡å™¨ 21ç«¯å£</li><li>æ•°æ®è¿æ¥ï¼šå®¢æˆ·ç«¯ &gt;1023ç«¯å£ -&gt; æœåŠ¡å™¨ &gt;1023ç«¯å£</li></ol><p>ä¸‹é¢æ˜¯ä¸»åŠ¨ä¸è¢«åŠ¨FTPä¼˜ç¼ºç‚¹çš„ç®€è¦æ€»ç»“ï¼š</p><p>ä¸»åŠ¨FTPå¯¹FTPæœåŠ¡å™¨çš„ç®¡ç†æœ‰åˆ©ï¼Œä½†å¯¹å®¢æˆ·ç«¯çš„ç®¡ç†ä¸åˆ©ã€‚å› ä¸ºFTPæœåŠ¡å™¨ä¼å›¾ä¸å®¢æˆ·ç«¯çš„é«˜ä½éšæœºç«¯å£å»ºç«‹è¿æ¥ï¼Œè€Œè¿™ä¸ªç«¯å£å¾ˆæœ‰å¯èƒ½è¢«å®¢æˆ·ç«¯çš„é˜²ç«å¢™é˜»å¡æ‰ã€‚è¢«åŠ¨FTPå¯¹FTPå®¢æˆ·ç«¯çš„ç®¡ç†æœ‰åˆ©ï¼Œä½†å¯¹æœåŠ¡å™¨ç«¯çš„ç®¡ç†ä¸åˆ©ã€‚å› ä¸ºå®¢æˆ·ç«¯è¦ä¸æœåŠ¡å™¨ç«¯å»ºç«‹ä¸¤ä¸ªè¿æ¥ï¼Œå…¶ä¸­ä¸€ä¸ªè¿åˆ°ä¸€ä¸ªé«˜ä½éšæœºç«¯å£ï¼Œè€Œè¿™ä¸ªç«¯å£å¾ˆæœ‰å¯èƒ½è¢«æœåŠ¡å™¨ç«¯çš„é˜²ç«å¢™é˜»å¡æ‰ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œæœ‰æŠ˜è¡·çš„åŠæ³•ã€‚æ—¢ç„¶FTPæœåŠ¡å™¨çš„ç®¡ç†å‘˜éœ€è¦ä»–ä»¬çš„æœåŠ¡å™¨æœ‰æœ€å¤šçš„å®¢æˆ·è¿æ¥ï¼Œé‚£ä¹ˆå¿…é¡»å¾—æ”¯æŒè¢«åŠ¨FTPã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºFTPæœåŠ¡å™¨æŒ‡å®šä¸€ä¸ªæœ‰é™çš„ç«¯å£èŒƒå›´æ¥å‡å°æœåŠ¡å™¨é«˜ä½ç«¯å£çš„æš´éœ²ã€‚è¿™æ ·ï¼Œä¸åœ¨è¿™ä¸ªèŒƒå›´çš„ä»»ä½•ç«¯å£ä¼šè¢«æœåŠ¡å™¨çš„é˜²ç«å¢™é˜»å¡ã€‚è™½ç„¶è¿™æ²¡æœ‰æ¶ˆé™¤æ‰€æœ‰é’ˆå¯¹æœåŠ¡å™¨çš„å±é™©ï¼Œä½†å®ƒå¤§å¤§å‡å°‘äº†å±é™©ã€‚</p><h3 id="VSFTPD-è½¯ä»¶"><a href="#VSFTPD-è½¯ä»¶" class="headerlink" title="VSFTPD è½¯ä»¶"></a>VSFTPD è½¯ä»¶</h3><p>å¦‚æœä½ æƒ³åœ¨ä½ çš„Linux/UnixæœåŠ¡å™¨ä¸Šæ­å»ºä¸€ä¸ªå®‰å…¨ã€é«˜æ€§èƒ½ã€ç¨³å®šæ€§å¥½çš„FTPæœåŠ¡å™¨ï¼Œé‚£ä¹ˆvsftpdå¯èƒ½æ˜¯ä½ çš„é¦–é€‰åº”ç”¨ã€‚vsftpdæ„æ€ä¸ºâ€œvery secure FTP daemon(éå¸¸å®‰å…¨çš„FTPè¿›ç¨‹)â€ï¼Œæ˜¯ä¸€ä¸ªåŸºäºGPLå‘å¸ƒçš„ç±»UNIXç±»æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œçš„æœåŠ¡å™¨çš„åå­—ï¼ˆæ˜¯ä¸€ç§å®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼Œå¯ä»¥è¿è¡Œåœ¨è¯¸å¦‚Linuxã€BSDã€Solarisã€HP-UXä»¥åŠIrixç­‰ç³»ç»Ÿä¸Šé¢ã€‚vsftpdæ”¯æŒå¾ˆå¤šå…¶ä»–ä¼ ç»Ÿçš„FTPæœåŠ¡å™¨ä¸æ”¯æŒçš„è‰¯å¥½ç‰¹æ€§ã€‚</p><p>æœ€æ–°çš„vsftpdç‰ˆæœ¬å¯åœ¨å…¶å®˜ç½‘è·å–ï¼š<a href="www.vsftpd.org">www.vsftpd.org</a></p><p>vsftpd æ˜¯â€œvery secure FTP daemonâ€çš„ç¼©å†™ï¼Œå®‰å…¨æ€§æ˜¯å®ƒçš„ä¸€ä¸ªæœ€å¤§çš„ç‰¹ç‚¹ã€‚vsftpd æ˜¯ä¸€ä¸ª UNIX ç±»æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œçš„æœåŠ¡å™¨çš„åå­—ï¼Œå®ƒå¯ä»¥è¿è¡Œåœ¨è¯¸å¦‚ Linuxã€BSDã€Solarisã€ HP-UNIXç­‰ç³»ç»Ÿä¸Šé¢ï¼Œæ˜¯ä¸€ä¸ªå®Œå…¨å…è´¹çš„ã€å¼€å‘æºä»£ç çš„ftpæœåŠ¡å™¨è½¯ä»¶ï¼Œæ”¯æŒå¾ˆå¤šå…¶ä»–çš„ FTP æœåŠ¡å™¨æ‰€ä¸æ”¯æŒçš„ç‰¹å¾ã€‚æ¯”å¦‚ï¼šéå¸¸é«˜çš„å®‰å…¨æ€§éœ€æ±‚ã€å¸¦å®½é™åˆ¶ã€è‰¯å¥½çš„å¯ä¼¸ç¼©æ€§ã€å¯åˆ›å»ºè™šæ‹Ÿç”¨æˆ·ã€æ”¯æŒIPv6ã€é€Ÿç‡é«˜ç­‰ã€‚</p><p>çœ‹çœ‹éƒ½æœ‰å“ªäº›ç½‘ç«™åœ¨ä½¿ç”¨vsftpdå§ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ftp.RedHat.com</span><br><span class="line">ftp.SUSE.com</span><br><span class="line">ftp.debian.org</span><br><span class="line">ftp.openbsd.org</span><br><span class="line">ftp.freebsd.org</span><br><span class="line">ftp.gnu.org</span><br><span class="line">ftp.gnome.org</span><br><span class="line">ftp.kde.org</span><br><span class="line">ftp.kernel.org</span><br><span class="line">rpmfind.net</span><br><span class="line">ftp.linux.org.uk</span><br><span class="line">ftp.gimp.org</span><br><span class="line">ftp-stud.fht-esslingen.de</span><br><span class="line">gd.tuwien.ac.at</span><br><span class="line">ftp.sunet.se</span><br><span class="line">ftp.ximian.com</span><br><span class="line">ftp.engardelinux.org</span><br><span class="line">ftp.sunsite.org.uk</span><br><span class="line">ftp.isc.org</span><br></pre></td></tr></table></figure><h4 id="ä»€ä¹ˆæ˜¯vsftpd"><a href="#ä»€ä¹ˆæ˜¯vsftpd" class="headerlink" title="ä»€ä¹ˆæ˜¯vsftpd"></a>ä»€ä¹ˆæ˜¯vsftpd</h4><p>Vsftpdæ˜¯ä¸€ç§åœ¨GPLè®¸å¯ä¸‹å¼€æ”¾æºä»£ç çš„FTPæœåŠ¡å™¨ï¼Œç”¨äºå¤šç§UNIXç³»ç»Ÿå’ŒLinuxç³»ç»Ÿã€‚Vsftpdä¹Ÿç§°ä¸ºVery Secure FTP Daemonï¼Œå®ƒæ˜¯ä¸€ç§å®‰å…¨ã€å¿«é€Ÿã€ç¨³å®šçš„FTPæœåŠ¡å™¨ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥ã€‚</p><p>Vsftpdçš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><ul><li>æä¾›å®‰å…¨çš„ä½“ç³»ç»“æ„ï¼Œæ ¹æ®ä»»åŠ¡çš„æœ€ä½ç‰¹æƒéœ€æ±‚å•ç‹¬æ‰§è¡Œæ¯ä¸ªä»»åŠ¡ã€‚</li><li>æ”¯æŒè™šæ‹ŸIPé…ç½®ï¼Œå¯ä»¥åœ¨æä¾›ä¸€ä¸ªIPåœ°å€çš„æƒ…å†µä¸‹ï¼Œåœ¨åŸŸä¸­ç”¨è¯¥åœ°å€å»ºç«‹å¤šä¸ªFTPæœåŠ¡å™¨ã€‚</li><li>å…è®¸é…ç½®å¹¶ä½¿ç”¨è™šæ‹Ÿç”¨æˆ·ï¼Œä»è€Œä¸ç³»ç»Ÿç”¨æˆ·è´¦æˆ·åˆ†ç¦»ã€‚</li><li>æ”¯æŒTCPå°è£…ã€‚</li><li>å…è®¸é…ç½®åŒ¿åæœåŠ¡å™¨ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸éœ€è¦èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ã€‚</li><li>æ€§èƒ½ç¨³å®šï¼Œå¯ä»¥å¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥ã€‚</li><li>å¯ä»¥é…ç½®ä¸ºç‹¬ç«‹çš„æœåŠ¡å™¨ã€‚</li><li>VsftpdæœåŠ¡å™¨æ”¯æŒå¸¦å®½æ§åˆ¶ã€‚</li></ul><blockquote><p>ç”¨æˆ·ç±»å‹</p></blockquote><p><strong>r çœŸå®ç”¨æˆ·</strong></p><p>è¿™ç±»ç”¨æˆ·æ˜¯æŒ‡åœ¨FTPæœåŠ¡ä¸Šæ‹¥æœ‰å¸å·ï¼Œå³/etc/passwdé‡Œçš„ç”¨æˆ·ã€‚å½“è¿™ç±»ç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨çš„æ—¶å€™ï¼Œå…¶é»˜è®¤çš„ä¸»ç›®å½•å°±æ˜¯å…¶å¸å·å‘½åçš„ç›®å½•ã€‚ä½†æ˜¯ï¼Œå…¶è¿˜å¯ä»¥å˜æ›´åˆ°å…¶ä»–ç›®å½•ä¸­å»ã€‚å¦‚ç³»ç»Ÿçš„ä¸»ç›®å½•ç­‰ç­‰ã€‚</p><p><strong>g æ¥å®¾ç”¨æˆ·</strong></p><p>åœ¨vsFTPè½¯ä»¶é‡Œæ²¡æœ‰è¿™ç±»ç”¨æˆ·ï¼Œä½†æ˜¯åœ¨FTPæœåŠ¡å™¨ä¸­æœ‰ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šç»™ä¸åŒçš„éƒ¨é—¨æˆ–è€…æŸä¸ªç‰¹å®šçš„ç”¨æˆ·è®¾ç½®ä¸€ä¸ªå¸æˆ·ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªè´¦æˆ·æœ‰ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯å…¶åªèƒ½å¤Ÿè®¿é—®è‡ªå·±çš„ä¸»ç›®å½•ã€‚æœåŠ¡å™¨é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¿éšœFTPæœåŠ¡ä¸Šå…¶ä»–æ–‡ä»¶çš„å®‰å…¨æ€§ã€‚è¿™ç±»å¸æˆ·ï¼Œåœ¨Vsftpdè½¯ä»¶ä¸­å°±å«åšGuestç”¨æˆ·ã€‚æ‹¥æœ‰è¿™ç±»ç”¨æˆ·çš„å¸æˆ·ï¼Œåªèƒ½å¤Ÿè®¿é—®å…¶ä¸»ç›®å½•ä¸‹çš„ç›®å½•ï¼Œè€Œä¸å¾—è®¿é—®ä¸»ç›®å½•ä»¥å¤–çš„æ–‡ä»¶ã€‚</p><p><strong>a åŒ¿åç”¨æˆ·</strong></p><p>Anonymousï¼ˆåŒ¿åï¼‰ç”¨æˆ·ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„åŒ¿åè®¿é—®ã€‚è¿™ç±»ç”¨æˆ·æ˜¯æŒ‡åœ¨FTPæœåŠ¡å™¨ä¸­æ²¡æœ‰æŒ‡å®šå¸æˆ·ï¼Œä½†æ˜¯å…¶ä»ç„¶å¯ä»¥è¿›è¡ŒåŒ¿åè®¿é—®æŸäº›å…¬å¼€çš„èµ„æºã€‚<br>åœ¨ç»„å»ºFTPæœåŠ¡å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦æ ¹æ®ç”¨æˆ·çš„ç±»å‹ï¼Œå¯¹ç”¨æˆ·è¿›è¡Œå½’ç±»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒVsftpdæœåŠ¡å™¨ä¼šæŠŠå»ºç«‹çš„æ‰€æœ‰å¸æˆ·éƒ½å½’å±ä¸ºRealç”¨æˆ·ã€‚ä½†æ˜¯ï¼Œè¿™å¾€å¾€ä¸ç¬¦åˆä¼ä¸šå®‰å…¨çš„éœ€è¦ã€‚å› ä¸ºè¿™ç±»ç”¨æˆ·ä¸ä»…å¯ä»¥è®¿é—®è‡ªå·±çš„ä¸»ç›®å½•ï¼Œè€Œä¸”ï¼Œè¿˜å¯ä»¥è®¿é—®å…¶ä»–ç”¨æˆ·çš„ç›®å½•ã€‚è¿™å°±ç»™å…¶ä»–ç”¨æˆ·æ‰€åœ¨çš„ç©ºé—´å¸¦æ¥ä¸€å®šçš„å®‰å…¨éšæ‚£ã€‚æ‰€ä»¥ï¼Œä¼ä¸šè¦æ ¹æ®å®é™…æƒ…å†µï¼Œä¿®æ”¹ç”¨æˆ·æ‰€åœ¨çš„ç±»åˆ«ã€‚</p><hr><h4 id="é¡¹ç›®å®è·µ1-è®¾ç½®vsftpdæœåŠ¡åŒ¿åç”¨æˆ·èƒ½å¤Ÿå¯¹-var-ftp-pub-ç›®å½•æœ‰ä¸Šä¼ ä¸‹è½½çš„æƒé™"><a href="#é¡¹ç›®å®è·µ1-è®¾ç½®vsftpdæœåŠ¡åŒ¿åç”¨æˆ·èƒ½å¤Ÿå¯¹-var-ftp-pub-ç›®å½•æœ‰ä¸Šä¼ ä¸‹è½½çš„æƒé™" class="headerlink" title="é¡¹ç›®å®è·µ1: è®¾ç½®vsftpdæœåŠ¡åŒ¿åç”¨æˆ·èƒ½å¤Ÿå¯¹/var/ftp/pub/ç›®å½•æœ‰ä¸Šä¼ ä¸‹è½½çš„æƒé™"></a>é¡¹ç›®å®è·µ1: è®¾ç½®vsftpdæœåŠ¡åŒ¿åç”¨æˆ·èƒ½å¤Ÿå¯¹/var/ftp/pub/ç›®å½•æœ‰ä¸Šä¼ ä¸‹è½½çš„æƒé™</h4><h5 id="å®éªŒå‡†å¤‡é˜¶æ®µ"><a href="#å®éªŒå‡†å¤‡é˜¶æ®µ" class="headerlink" title="å®éªŒå‡†å¤‡é˜¶æ®µ"></a>å®éªŒå‡†å¤‡é˜¶æ®µ</h5><ol><li>ç½‘ç»œæ‹“æ‰‘å›¾</li><li>è§„åˆ’è½¯ä»¶å®‰è£…</li><li>ä¿®æ”¹é…ç½®æ–‡ä»¶</li><li>å¯åŠ¨æœåŠ¡</li><li>æ³¨æ„é˜²ç«å¢™å…³é—­</li><li>å®¢æˆ·ç«¯æµ‹è¯•æœåŠ¡        </li></ol><blockquote><p>ç½‘ç»œæ‹“æ‰‘å›¾</p></blockquote><p><img src="pic/17.png" alt="17"></p><blockquote><p>è§„åˆ’è½¯ä»¶å®‰è£…</p></blockquote><p><img src="pic/18.png" alt="18"></p><h5 id="å…·ä½“æ­¥éª¤"><a href="#å…·ä½“æ­¥éª¤" class="headerlink" title="å…·ä½“æ­¥éª¤"></a>å…·ä½“æ­¥éª¤</h5><p>Linuxå‡ ä¹æ‰€æœ‰çš„å‘è¡Œç‰ˆæœ¬éƒ½å†…ç½®äº†VsftpdæœåŠ¡ã€‚</p><p><strong>æœåŠ¡å™¨ç«¯rhel6</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# yum install -y vsftpd</span><br><span class="line">Loaded plugins: product-id, refresh-packagekit, security, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Setting up Install Process</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package vsftpd.x86_64 0:2.2.2-11.el6_4.1 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">=============================================================================================</span><br><span class="line"> Package            Arch               Version                      Repository          Size</span><br><span class="line">=============================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> vsftpd             x86_64             2.2.2-11.el6_4.1             server             151 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">=============================================================================================</span><br><span class="line">Install       1 Package(s)</span><br><span class="line"></span><br><span class="line">Total download size: 151 k</span><br><span class="line">Installed size: 331 k</span><br><span class="line">Downloading Packages:</span><br><span class="line">vsftpd-2.2.2-11.el6_4.1.x86_64.rpm                                    | 151 kB     00:00     </span><br><span class="line">Running rpm_check_debug</span><br><span class="line">Running Transaction Test</span><br><span class="line">Transaction Test Succeeded</span><br><span class="line">Running Transaction</span><br><span class="line">  Installing : vsftpd-2.2.2-11.el6_4.1.x86_64                                            1/1</span><br><span class="line">  Verifying  : vsftpd-2.2.2-11.el6_4.1.x86_64                                            1/1</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  vsftpd.x86_64 0:2.2.2-11.el6_4.1                                                           </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# service iptables stop</span><br><span class="line">iptables: Setting chains to policy ACCEPT: filter          [  OK  ]</span><br><span class="line">iptables: Flushing firewall rules:                         [  OK  ]</span><br><span class="line">iptables: Unloading modules:                               [  OK  ]</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# getenforce</span><br><span class="line">Enforcing</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# rpm -q vsftpd</span><br><span class="line">vsftpd-2.2.2-11.el6_4.1.x86_64</span><br><span class="line">[root@rhel6 ~]# rpm -ql vsftpd</span><br><span class="line">/etc/logrotate.d/vsftpd</span><br><span class="line">/etc/pam.d/vsftpd</span><br><span class="line">/etc/rc.d/init.d/vsftpd</span><br><span class="line">/etc/vsftpd</span><br><span class="line">/etc/vsftpd/ftpusers</span><br><span class="line">/etc/vsftpd/user_list</span><br><span class="line">/etc/vsftpd/vsftpd.conf</span><br><span class="line">/etc/vsftpd/vsftpd_conf_migrate.sh</span><br><span class="line">/usr/sbin/vsftpd</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/AUDIT</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/BENCHMARKS</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/BUGS</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/COPYING</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/Changelog</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE/README.configuration</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE/vsftpd.conf</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE/vsftpd.xinetd</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE_NOINETD</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE_NOINETD/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE_NOINETD/README.configuration</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE_NOINETD/vsftpd.conf</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/PER_IP_CONFIG</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/PER_IP_CONFIG/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/PER_IP_CONFIG/README.configuration</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/PER_IP_CONFIG/hosts.allow</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_HOSTS</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_HOSTS/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/README.configuration</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/logins.txt</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.conf</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.pam</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS_2</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS_2/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/FAQ</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/INSTALL</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/LICENSE</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/README.security</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/REWARD</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/SECURITY</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/SECURITY/DESIGN</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/SECURITY/IMPLEMENTATION</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/SECURITY/OVERVIEW</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/SECURITY/TRUST</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/SIZE</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/SPEED</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/TODO</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/TUNING</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/vsftpd.xinetd</span><br><span class="line">/usr/share/man/man5/vsftpd.conf.5.gz</span><br><span class="line">/usr/share/man/man8/vsftpd.8.gz</span><br><span class="line">/var/ftp</span><br><span class="line">/var/ftp/pub</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# service vsftpd start</span><br><span class="line">Starting vsftpd for vsftpd:                                [  OK  ]</span><br><span class="line">[root@rhel6 ~]# netstat -luntp|grep vsftpd</span><br><span class="line">tcp        0      0 0.0.0.0:21                  0.0.0.0:*                   LISTEN      2940/vsftpd</span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯ rhel7</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# yum install -y lftp</span><br><span class="line">Loaded plugins: langpacks, product-id, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">server                                                                | 4.1 kB  00:00:00     </span><br><span class="line">(1/2): server/group_gz                                                | 134 kB  00:00:00     </span><br><span class="line">(2/2): server/primary_db                                              | 3.4 MB  00:00:00     </span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package lftp.x86_64 0:4.4.8-3.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">=============================================================================================</span><br><span class="line"> Package           Arch                Version                     Repository           Size</span><br><span class="line">=============================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> lftp              x86_64              4.4.8-3.el7                 server              749 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">=============================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 749 k</span><br><span class="line">Installed size: 2.4 M</span><br><span class="line">Downloading packages:</span><br><span class="line">lftp-4.4.8-3.el7.x86_64.rpm                                           | 749 kB  00:00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : lftp-4.4.8-3.el7.x86_64                                                   1/1</span><br><span class="line">server/productid                                                      | 1.6 kB  00:00:00     </span><br><span class="line">  Verifying  : lftp-4.4.8-3.el7.x86_64                                                   1/1</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  lftp.x86_64 0:4.4.8-3.el7                                                                  </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@rhel7 ~]# systemctl stop firewalld</span><br><span class="line">[root@rhel7 ~]# getenforce</span><br><span class="line">Enforcing</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# rpm -ql lftp</span><br><span class="line">/etc/lftp.conf</span><br><span class="line">/usr/bin/lftp</span><br><span class="line">/usr/bin/lftpget</span><br><span class="line">/usr/lib64/lftp</span><br><span class="line">/usr/lib64/lftp/4.4.8</span><br><span class="line">/usr/lib64/lftp/4.4.8/cmd-mirror.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/cmd-sleep.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/cmd-torrent.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/liblftp-network.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/liblftp-pty.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/proto-file.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/proto-fish.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/proto-ftp.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/proto-http.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/proto-sftp.so</span><br><span class="line">/usr/lib64/liblftp-jobs.so.0</span><br><span class="line">/usr/lib64/liblftp-jobs.so.0.0.0</span><br><span class="line">/usr/lib64/liblftp-tasks.so.0</span><br><span class="line">/usr/lib64/liblftp-tasks.so.0.0.0</span><br><span class="line">/usr/share/doc/lftp-4.4.8</span><br><span class="line">/usr/share/doc/lftp-4.4.8/BUGS</span><br><span class="line">/usr/share/doc/lftp-4.4.8/COPYING</span><br><span class="line">/usr/share/doc/lftp-4.4.8/ChangeLog</span><br><span class="line">/usr/share/doc/lftp-4.4.8/FAQ</span><br><span class="line">/usr/share/doc/lftp-4.4.8/FEATURES</span><br><span class="line">/usr/share/doc/lftp-4.4.8/NEWS</span><br><span class="line">/usr/share/doc/lftp-4.4.8/README</span><br><span class="line">/usr/share/doc/lftp-4.4.8/README.debug-levels</span><br><span class="line">/usr/share/doc/lftp-4.4.8/README.dnssec</span><br><span class="line">/usr/share/doc/lftp-4.4.8/README.modules</span><br><span class="line">/usr/share/doc/lftp-4.4.8/THANKS</span><br><span class="line">/usr/share/doc/lftp-4.4.8/TODO</span><br><span class="line">/usr/share/locale/cs/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/de/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/es/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/fr/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/it/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/ja/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/ko/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/pl/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/pt_BR/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/ru/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/zh_CN/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/zh_HK/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/zh_TW/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/man/man1/lftp.1.gz</span><br><span class="line">/usr/share/man/man1/lftpget.1.gz</span><br><span class="line">/usr/share/man/man5/lftp.conf.5.gz</span><br></pre></td></tr></table></figure><blockquote><p>1.ä»å®¢æˆ·ç«¯ä»¥åŒ¿åç”¨æˆ·æ¥è®¿é—®ftpæœåŠ¡</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# lftp 172.25.0.11</span><br><span class="line">lftp 172.25.0.11:~&gt; cd pub</span><br><span class="line">cd ok, cwd=/pub</span><br><span class="line">lftp 172.25.0.11:/pub&gt; ls</span><br><span class="line">lftp 172.25.0.11:/pub&gt; put rhel7</span><br><span class="line">put: Access failed: 550 Permission denied. (rhel7)</span><br></pre></td></tr></table></figure><p><strong>å½“å‰çš„æƒ…å†µ</strong></p><p>åŒ¿åç”¨æˆ·èƒ½å¤Ÿè®¿é—®/var/ftp/pubï¼Œèƒ½å¤ŸæŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œèƒ½å¤Ÿä¸‹è½½ï¼›ä¸èƒ½ä¸Šä¼ æ–‡ä»¶,ä¸èƒ½åˆ é™¤æ–‡ä»¶ã€‚</p><p><strong>é—®é¢˜çš„è§£å†³</strong></p><p>æŠ¥é”™550ï¼Œæ²¡æœ‰æƒé™ä¸Šä¼ æ–‡ä»¶</p><p>æˆ‘ä»¬è¦åˆ†ææƒé™æœ‰å“ªäº›ï¼Ÿ</p><ol><li>vsftpdçš„é…ç½®æ–‡ä»¶</li><li>UGOã€ç‰¹æ®Šã€éšè—ã€ACLã€</li><li>SELINUX</li></ol><p><strong>1.ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/vsftpd/vsftpd.conf</span><br><span class="line">anon_upload_enable=YES</span><br></pre></td></tr></table></figure><p><strong>2./var/ftp/pub ç›®å½•o-rwx</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 pub]# ll -d /var/ftp/pub</span><br><span class="line">drwxr-xrwx. 2 root root 4096 Aug  3 10:35 /var/ftp/pub</span><br></pre></td></tr></table></figure><p><strong>3.æµ‹è¯•</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lftp 172.25.0.11:/pub&gt; put rhel7</span><br><span class="line">put: Access failed: 553 Could not create file. (rhel7)</span><br></pre></td></tr></table></figure><p>ç›®å‰ä¿®æ”¹äº†é…ç½®æ–‡ä»¶å’Œugoæƒé™è¿˜æ˜¯æŠ¥é”™553ï¼Œä¸èƒ½create file</p><p>æˆ‘ä»¬åˆ†æä¸€ä¸‹ï¼Œåªæœ‰selinuxçš„æƒé™é—®é¢˜äº†</p><p><strong>4.SELINUX</strong></p><p>å¦‚ä½•ç¡®å®šæ˜¯å¦æ˜¯selinuxçš„åŸå› ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤ï¼š</p><ul><li>1)å…ˆå…³é—­selinuxï¼Œæµ‹è¯•okçš„</li><li>2)å¼€å¯selinuxï¼Œæµ‹è¯•noçš„</li></ul><p>æˆ‘ä»¬éœ€è¦å»åˆ†æselinuxçš„è®°å½•ï¼Œåˆ†æå·¥å…·æ˜¯<code>sealert</code>,ç”±<code>setroubleshoot</code>è½¯ä»¶å®‰è£…ã€‚</p><ol><li>æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æ˜¯å¦æœ‰sealertå·¥å…·    <code>which sealert</code></li><li>å®‰è£…setroubleshoot        <code>yum install -y setroubleshoot</code></li><li>åˆ†æselinuxè®°å½•        <code>sealert -a /var/log/audit/audit.log</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">*****  Plugin allow_anon_write (53.1 confidence) suggests  *******************</span><br><span class="line"></span><br><span class="line">If you want to allow /usr/sbin/vsftpd to be able to write to shared public content</span><br><span class="line">Then you need to change the label on pub to public_content_rw_t, and potentially turn on the</span><br><span class="line">allow_httpd_sys_script_anon_write boolean.</span><br><span class="line">Do</span><br><span class="line"><span class="meta">#</span><span class="bash"> semanage fcontext -a -t public_content_rw_t pub</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> restorecon -R -v pub</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> setsebool -P allow_ftpd_anon_write 1</span></span><br><span class="line"></span><br><span class="line">[root@rhel6 pub]# semanage fcontext -a -t public_content_rw_t /var/ftp/pub</span><br><span class="line">[root@rhel6 pub]# restorecon -R -v /var/ftp/pub</span><br><span class="line">[root@rhel6 pub]# ll -Zd /var/ftp/pub</span><br><span class="line">drwxr-xrwx. root root system_u:object_r:public_content_rw_t:s0 /var/ftp/pub</span><br></pre></td></tr></table></figure><p><strong>5.å†æµ‹è¯•</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lftp 172.25.0.11:/pub&gt; put rhel7</span><br><span class="line">lftp 172.25.0.11:/pub&gt; ls</span><br><span class="line">-rw-------    1 14       50              0 Aug 03 05:53 rhel7</span><br><span class="line">lftp 172.25.0.11:/pub&gt; exit</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å‘ç°åŒ¿åç”¨æˆ·å·²ç»å¯ä»¥æˆåŠŸåœ°å¯¹/var/ftp/pubç›®å½•è¿›è¡Œä¸Šä¼ ä¸‹è½½äº†ï¼</p><hr><h4 id="é¡¹ç›®å®è·µ2-çœŸå®ç”¨æˆ·ï¼ˆç³»ç»Ÿç”¨æˆ·ï¼‰èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œä¸Šä¼ ä¸‹è½½åˆ é™¤"><a href="#é¡¹ç›®å®è·µ2-çœŸå®ç”¨æˆ·ï¼ˆç³»ç»Ÿç”¨æˆ·ï¼‰èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œä¸Šä¼ ä¸‹è½½åˆ é™¤" class="headerlink" title="é¡¹ç›®å®è·µ2: çœŸå®ç”¨æˆ·ï¼ˆç³»ç»Ÿç”¨æˆ·ï¼‰èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œä¸Šä¼ ä¸‹è½½åˆ é™¤"></a>é¡¹ç›®å®è·µ2: çœŸå®ç”¨æˆ·ï¼ˆç³»ç»Ÿç”¨æˆ·ï¼‰èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œä¸Šä¼ ä¸‹è½½åˆ é™¤</h4><p>åœ¨é¡¹ç›®å®è·µ1çš„åŸºç¡€ä¸Šå®Œæˆã€‚</p><p><strong>æœåŠ¡ç«¯ rhel6</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ftp]# id student</span><br><span class="line">uid=500(student) gid=500(student) groups=500(student)</span><br><span class="line">[root@rhel6 ftp]# passwd student</span><br><span class="line">Changing password for user student.</span><br><span class="line">New password:</span><br><span class="line">BAD PASSWORD: it is based on a dictionary word</span><br><span class="line">Retype new password:</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line"></span><br><span class="line">[root@rhel6 ftp]# su - student</span><br><span class="line">[student@rhel6 ~]$ pwd</span><br><span class="line">/home/student</span><br><span class="line">[student@rhel6 ~]$ touch file1</span><br><span class="line">[student@rhel6 ~]$ echo aaa &gt; file1</span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯ rhel7</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# lftp student@172.25.0.11</span><br><span class="line">Password:</span><br><span class="line">lftp student@172.25.0.11:~&gt; ls      </span><br><span class="line">ls: Login failed: 500 OOPS: cannot change directory:/home/student</span><br></pre></td></tr></table></figure><p><strong>å½“å‰çš„æƒ…å†µ</strong> ç³»ç»Ÿç”¨æˆ·studentä¸èƒ½è®¿é—®å®¶ç›®å½•ã€‚</p><p><strong>é—®é¢˜çš„è§£å†³</strong></p><p>æŠ¥é”™500ï¼Œæ²¡æœ‰æƒé™è¿›å…¥ç”¨æˆ·å®¶ç›®å½•</p><p>é…ç½®æ–‡ä»¶æ²¡æœ‰é—®é¢˜ï¼Œugoæƒé™æ²¡æœ‰é—®é¢˜ï¼Œåªå‰©ä¸‹selinuxï¼Œéœ€è¦åˆ†æ</p><p><strong>1.åˆ†æselinux</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡å™¨ç«¯</span></span><br><span class="line">[root@rhel6 ftp]# sealert -a /var/log/audit/audit.log</span><br><span class="line"></span><br><span class="line">*****  Plugin catchall_boolean (47.5 confidence) suggests  *******************</span><br><span class="line"></span><br><span class="line">If you want to allow ftp to read and write files in the user home directories</span><br><span class="line">Then you must tell SELinux about this by enabling the 'ftp_home_dir'boolean.</span><br><span class="line">Do</span><br><span class="line">setsebool -P ftp_home_dir 1</span><br></pre></td></tr></table></figure><p><strong>2.ä¿®æ”¹å¸ƒå°”å€¼</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ftp]# setsebool -P ftp_home_dir 1</span><br></pre></td></tr></table></figure><p><strong>3.æµ‹è¯•</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯</span></span><br><span class="line">lftp student@172.25.0.11:~&gt; ls</span><br><span class="line">lftp student@172.25.0.11:~&gt; pwd  </span><br><span class="line">ftp://student@172.25.0.11/%2Fhome/student</span><br><span class="line">lftp student@172.25.0.11:~&gt; ls</span><br><span class="line">-rw-rw-r--    1 500      500             4 Aug 03 07:13 file1</span><br><span class="line">lftp student@172.25.0.11:~&gt; cat file1</span><br><span class="line">aaa</span><br><span class="line">4 bytes transferred</span><br><span class="line">lftp student@172.25.0.11:~&gt; get file1</span><br><span class="line">4 bytes transferred</span><br><span class="line">lftp student@172.25.0.11:~&gt; put</span><br><span class="line">.ICEauthority  .bashrc .dbus/     .tcshrcMusic/    Videos/  rhel7</span><br><span class="line">.bash_history  .cache/ .esd_auth  Desktop/Pictures/   anaconda-ks.cfg  test1</span><br><span class="line">.bash_logout   .config/  .local/    Documents/Public/     file1</span><br><span class="line">.bash_profile  .cshrc .ssh/    Downloads/Templates/  initial-setup-ks.cfg</span><br><span class="line">lftp student@172.25.0.11:~&gt; put rhel7</span><br><span class="line">lftp student@172.25.0.11:~&gt; ls</span><br><span class="line">-rw-rw-r--    1 500      500             4 Aug 03 07:13 file1</span><br><span class="line">-rw-r--r--    1 500      500             0 Aug 03 07:13 rhel7</span><br><span class="line">lftp student@172.25.0.11:~&gt; rm file1</span><br><span class="line">rm ok, \`file1\' removed</span><br><span class="line">lftp student@172.25.0.11:~&gt; ls</span><br><span class="line">-rw-r--r--    1 500      500             0 Aug 03 07:13 rhel7</span><br></pre></td></tr></table></figure><p>ç³»ç»Ÿç”¨æˆ·å·²ç»å¯ä»¥å®ç°èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¸‹è½½ã€ä¸Šä¼ ã€åˆ é™¤äº†ï¼</p><hr><h4 id="é¡¹ç›®å®è·µ3-é™¤äº†ç³»ç»Ÿç”¨æˆ·studentæœ‰chrootçš„æƒé™ï¼Œå…¶ä»–ç³»ç»Ÿç”¨æˆ·æ²¡æœ‰chrootçš„æƒé™"><a href="#é¡¹ç›®å®è·µ3-é™¤äº†ç³»ç»Ÿç”¨æˆ·studentæœ‰chrootçš„æƒé™ï¼Œå…¶ä»–ç³»ç»Ÿç”¨æˆ·æ²¡æœ‰chrootçš„æƒé™" class="headerlink" title="é¡¹ç›®å®è·µ3: é™¤äº†ç³»ç»Ÿç”¨æˆ·studentæœ‰chrootçš„æƒé™ï¼Œå…¶ä»–ç³»ç»Ÿç”¨æˆ·æ²¡æœ‰chrootçš„æƒé™"></a>é¡¹ç›®å®è·µ3: é™¤äº†ç³»ç»Ÿç”¨æˆ·studentæœ‰chrootçš„æƒé™ï¼Œå…¶ä»–ç³»ç»Ÿç”¨æˆ·æ²¡æœ‰chrootçš„æƒé™</h4><ul><li>åŒ¿åç”¨æˆ·çš„æ ¹ç›®å½•    /var/ftp/</li><li>ç³»ç»Ÿç”¨æˆ·çš„æ ¹ç›®å½•    /home/student/</li></ul><table><thead><tr><th align="left"></th><th align="left">chroot_local_user=YES</th><th align="left">chroot_local_user=NO</th></tr></thead><tbody><tr><td align="left">chroot_list_enable=YES</td><td align="left">ä¸èƒ½æ¢æ ¹ï¼Œæœ‰ä¾‹å¤–</td><td align="left">éƒ½èƒ½æ¢æ ¹ï¼Œæœ‰ä¾‹å¤–</td></tr><tr><td align="left">chroot_list_enable=NO</td><td align="left">ä¸èƒ½æ¢æ ¹ï¼Œæ²¡ä¾‹å¤–</td><td align="left">éƒ½èƒ½æ¢æ ¹ï¼Œæ²¡ä¾‹å¤–</td></tr></tbody></table><p>å¦‚æœæŒ‡å®š <code>chroot_list_enable=YES</code> åˆ™éœ€è¦æŒ‡å®šæ–‡ä»¶ä½ç½® <code>chroot_list_file=/etc/vsftpd/chroot_list</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# lftp batman@172.25.0.11</span><br><span class="line">Password:</span><br><span class="line">lftp batman@172.25.0.11:~&gt; ls       </span><br><span class="line">lftp batman@172.25.0.11:~&gt; cd /tmp</span><br><span class="line">cd ok, cwd=/tmp</span><br><span class="line">lftp batman@172.25.0.11:/tmp&gt; pwd</span><br><span class="line">ftp://batman@172.25.0.11/%2Ftmp</span><br><span class="line">lftp batman@172.25.0.11:/tmp&gt; exit</span><br></pre></td></tr></table></figure><p><strong>å½“å‰çš„æƒ…å†µ</strong> æ‰€æœ‰çš„ç³»ç»Ÿç”¨æˆ·éƒ½èƒ½å¤Ÿchrootï¼Œè€Œè¦æ±‚é™¤äº†studentç”¨æˆ·ä¹‹å¤–çš„æ‰€æœ‰ç³»ç»Ÿç”¨æˆ·éƒ½ä¸èƒ½chrootã€‚</p><p><strong>è§£å†³æ–¹æ³•</strong></p><p>å¯ä»¥é€‰æ‹©<code>ä¸èƒ½æ¢æ ¹ï¼Œæœ‰ä¾‹å¤–</code></p><p><strong>1.ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡å™¨ç«¯</span></span><br><span class="line">[root@rhel6 ~]# vim /etc/vsftpd/vsftpd.conf</span><br><span class="line">chroot_local_user=YES</span><br><span class="line">chroot_list_enable=YES</span><br><span class="line">chroot_list_file=/etc/vsftpd/chroot_list</span><br></pre></td></tr></table></figure><p><strong>2.åˆ›å»ºchroot_list</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# vim /etc/vsftpd/chroot_list</span><br><span class="line">[root@rhel6 ~]# cat /etc/vsftpd/chroot_list</span><br><span class="line">student</span><br></pre></td></tr></table></figure><p><strong>3.é‡å¯æœåŠ¡</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# service vsftpd restart</span><br><span class="line">Shutting down vsftpd:                                      [  OK  ]</span><br><span class="line">Starting vsftpd for vsftpd:                                [  OK  ]</span><br></pre></td></tr></table></figure><p><strong>2.æµ‹è¯•</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯    </span></span><br><span class="line">[root@rhel7 ~]# lftp batman@172.25.0.11</span><br><span class="line">Password:</span><br><span class="line">lftp batman@172.25.0.11:~&gt; cd /etc/</span><br><span class="line">cd: Access failed: 550 Failed to change directory. (/etc)</span><br><span class="line">lftp batman@172.25.0.11:/&gt; exit</span><br><span class="line">[root@rhel7 ~]# lftp student@172.25.0.11</span><br><span class="line">Password:</span><br><span class="line">lftp student@172.25.0.11:~&gt; cd /etc</span><br><span class="line">cd ok, cwd=/etc                  </span><br><span class="line">lftp student@172.25.0.11:/etc&gt; exit</span><br></pre></td></tr></table></figure><p><strong>å½“å‰çš„æƒ…å†µ</strong></p><p>ç³»ç»Ÿç”¨æˆ·studentå¯ä»¥åˆ‡æ¢æ ¹ç›®å½•ï¼Œè€Œbatmanä¸åœ¨chroot_listæ–‡ä»¶ä¸­æ‰€ä»¥ä¸èƒ½åˆ‡æ¢æ ¹ç›®å½•ã€‚</p><h5 id="æ‹“å±•å†…å®¹"><a href="#æ‹“å±•å†…å®¹" class="headerlink" title="æ‹“å±•å†…å®¹"></a>æ‹“å±•å†…å®¹</h5><p><strong>ä¸ºä»€ä¹ˆrootç”¨æˆ·ä¸èƒ½é€šè¿‡ftpåè®®è®¿é—®æœåŠ¡å™¨ï¼Ÿ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# lftp root@172.25.0.11</span><br><span class="line">Password:</span><br><span class="line">lftp root@172.25.0.11:~&gt; ls         </span><br><span class="line">ls: Login failed: 530 Permission denied.</span><br></pre></td></tr></table></figure><p>å› ä¸ºæœ‰ç”¨æˆ·è®¿é—®æ§åˆ¶åˆ—è¡¨<code>/etc/vsftpd/user_list</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# grep userlist_enable /etc/vsftpd/vsftpd.conf</span><br><span class="line">userlist_enable=YES</span><br><span class="line"></span><br><span class="line">[root@rhel6 ftp]# cat /etc/vsftpd/user_list</span><br><span class="line"><span class="meta">#</span><span class="bash"> vsftpd userlist</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If userlist_deny=NO, only allow users <span class="keyword">in</span> this file</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If userlist_deny=YES (default), never allow users <span class="keyword">in</span> this file, and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">do</span> not even prompt <span class="keyword">for</span> a password.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that the default vsftpd pam config also checks /etc/vsftpd/ftpusers</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> users that are denied.</span></span><br><span class="line">root</span><br><span class="line">bin</span><br><span class="line">daemon</span><br><span class="line">adm</span><br><span class="line">lp</span><br><span class="line">sync</span><br><span class="line">shutdown</span><br><span class="line">halt</span><br><span class="line">mail</span><br><span class="line">news</span><br><span class="line">uucp</span><br><span class="line">operator</span><br><span class="line">games</span><br><span class="line">nobody</span><br></pre></td></tr></table></figure><hr><h4 id="äº†è§£vsftpdçš„é…ç½®æ–‡ä»¶"><a href="#äº†è§£vsftpdçš„é…ç½®æ–‡ä»¶" class="headerlink" title="äº†è§£vsftpdçš„é…ç½®æ–‡ä»¶"></a>äº†è§£vsftpdçš„é…ç½®æ–‡ä»¶</h4><table><thead><tr><th align="left">é…ç½®æ–‡ä»¶</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">/etc/vsftpd/vsftpd.conf</td><td align="left">ä¸»é…ç½®æ–‡ä»¶</td></tr><tr><td align="left">/usr/sbin/vsftpd</td><td align="left">Vsftpdçš„ä¸»ç¨‹åº</td></tr><tr><td align="left">/etc/rc.d/init.d/vsftpd</td><td align="left">å¯åŠ¨è„šæœ¬</td></tr><tr><td align="left">/etc/pam.d/vsftpd</td><td align="left">PAMè®¤è¯æ–‡ä»¶ï¼ˆæ­¤æ–‡ä»¶ä¸­file=/etc/vsftpd/ftpuserså­—æ®µï¼ŒæŒ‡æ˜é˜»æ­¢è®¿é—®çš„ç”¨æˆ·æ¥è‡ª/etc/vsftpd/ftpusersæ–‡ä»¶ä¸­çš„ç”¨æˆ·ï¼‰</td></tr><tr><td align="left">/etc/vsftpd/ftpusers</td><td align="left">ç¦æ­¢ä½¿ç”¨vsftpdçš„ç”¨æˆ·åˆ—è¡¨æ–‡ä»¶ã€‚è®°å½•ä¸å…è®¸è®¿é—®FTPæœåŠ¡å™¨çš„ç”¨æˆ·åå•ï¼Œç®¡ç†å‘˜å¯ä»¥æŠŠä¸€äº›å¯¹ç³»ç»Ÿå®‰å…¨æœ‰å¨èƒçš„ç”¨æˆ·è´¦å·è®°å½•åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œä»¥å…ç”¨æˆ·ä»FTPç™»å½•åè·å¾—å¤§äºä¸Šä¼ ä¸‹è½½æ“ä½œçš„æƒåˆ©ï¼Œè€Œå¯¹ç³»ç»Ÿé€ æˆæŸåã€‚</td></tr><tr><td align="left">/etc/vsftpd/user_list</td><td align="left">ç¦æ­¢æˆ–å…è®¸ä½¿ç”¨vsftpdçš„ç”¨æˆ·åˆ—è¡¨æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶ä¸­æŒ‡å®šçš„ç”¨æˆ·ç¼ºçœæƒ…å†µï¼ˆå³åœ¨/etc/vsftpd/vsftpd.confä¸­è®¾ç½®userlist_deny=YESï¼‰ä¸‹ä¹Ÿä¸èƒ½è®¿é—®FTPæœåŠ¡å™¨ï¼Œåœ¨è®¾ç½®äº†userlist_deny=NOæ—¶,ä»…å…è®¸user_listä¸­æŒ‡å®šçš„ç”¨æˆ·è®¿é—®FTPæœåŠ¡å™¨ã€‚</td></tr><tr><td align="left">/var/ftp</td><td align="left">åŒ¿åç”¨æˆ·ä¸»ç›®å½•ï¼›æœ¬åœ°ç”¨æˆ·ä¸»ç›®å½•ä¸ºï¼š/home/ç”¨æˆ·ä¸»ç›®å½•ï¼Œå³ç™»å½•åè¿›å…¥è‡ªå·±å®¶ç›®å½•</td></tr><tr><td align="left">/var/ftp/pub</td><td align="left">åŒ¿åç”¨æˆ·çš„ä¸‹è½½ç›®å½•ï¼Œæ­¤ç›®å½•éœ€èµ‹æƒæ ¹chmod 1777 pubï¼ˆ1ä¸ºç‰¹æ®Šæƒé™ï¼Œä½¿ä¸Šè½½åæ— æ³•åˆ é™¤ï¼‰</td></tr><tr><td align="left">/etc/logrotate.d/vsftpd.log</td><td align="left">Vsftpdçš„æ—¥å¿—æ–‡ä»¶</td></tr></tbody></table><h5 id="vsftpdçš„ä¸»é…ç½®æ–‡ä»¶-etc-vsftpd-vsftpd-confè¯´æ˜"><a href="#vsftpdçš„ä¸»é…ç½®æ–‡ä»¶-etc-vsftpd-vsftpd-confè¯´æ˜" class="headerlink" title="vsftpdçš„ä¸»é…ç½®æ–‡ä»¶/etc/vsftpd/vsftpd.confè¯´æ˜"></a>vsftpdçš„ä¸»é…ç½®æ–‡ä»¶/etc/vsftpd/vsftpd.confè¯´æ˜</h5><p>å’ŒLinuxç³»ç»Ÿä¸­çš„å¤§å¤šæ•°é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œvsftpdçš„é…ç½®æ–‡ä»¶ä¸­ä»¥#å¼€å§‹æ³¨é‡Šã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">æ˜¯å¦å…è®¸åŒ¿åç™»å½•FTPæœåŠ¡å™¨ï¼Œé»˜è®¤è®¾ç½®ä¸ºYESå…è®¸</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç”¨æˆ·å¯ä½¿ç”¨ç”¨æˆ·åftpæˆ–anonymousè¿›è¡Œftpç™»å½•ï¼Œå£ä»¤ä¸ºç”¨æˆ·çš„E-mailåœ°å€ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚ä¸å…è®¸åŒ¿åè®¿é—®åˆ™è®¾ç½®ä¸ºNO</span></span><br><span class="line">anonymous_enable=YES</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å…è®¸æœ¬åœ°ç”¨æˆ·(å³linuxç³»ç»Ÿä¸­çš„ç”¨æˆ·å¸å·)ç™»å½•FTPæœåŠ¡å™¨ï¼Œé»˜è®¤è®¾ç½®ä¸ºYESå…è®¸</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ¬åœ°ç”¨æˆ·ç™»å½•åä¼šè¿›å…¥ç”¨æˆ·ä¸»ç›®å½•ï¼Œè€ŒåŒ¿åç”¨æˆ·ç™»å½•åè¿›å…¥åŒ¿åç”¨æˆ·çš„ä¸‹è½½ç›®å½•/var/ftp/pub</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è‹¥åªå…è®¸åŒ¿åç”¨æˆ·è®¿é—®ï¼Œå‰é¢åŠ ä¸Š<span class="comment">#æ³¨é‡Šæ‰å³å¯é˜»æ­¢æœ¬åœ°ç”¨æˆ·è®¿é—®FTPæœåŠ¡å™¨</span></span></span><br><span class="line">local_enable=YES</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å…è®¸æœ¬åœ°ç”¨æˆ·å¯¹FTPæœåŠ¡å™¨æ–‡ä»¶å…·æœ‰å†™æƒé™ï¼Œé»˜è®¤è®¾ç½®ä¸ºYESå…è®¸</span></span><br><span class="line">write_enable=YES</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ©ç ï¼Œæœ¬åœ°ç”¨æˆ·é»˜è®¤æ©ç ä¸º077</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½ å¯ä»¥è®¾ç½®æœ¬åœ°ç”¨æˆ·çš„æ–‡ä»¶æ©ç ä¸ºç¼ºçœ022ï¼Œä¹Ÿå¯æ ¹æ®ä¸ªäººå–œå¥½å°†å…¶è®¾ç½®ä¸ºå…¶ä»–å€¼</span></span><br><span class="line"><span class="meta">#</span><span class="bash">local_umask=022</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ï¼Œé¡»å°†å…¨å±€çš„write_enable=YESã€‚é»˜è®¤ä¸ºYES</span></span><br><span class="line"><span class="meta">#</span><span class="bash">anon_upload_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·åˆ›å»ºæ–°æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="meta">#</span><span class="bash">anon_mkdir_write_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦æ¿€æ´»ç›®å½•æ¬¢è¿ä¿¡æ¯åŠŸèƒ½</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å½“ç”¨æˆ·ç”¨CMDæ¨¡å¼é¦–æ¬¡è®¿é—®æœåŠ¡å™¨ä¸ŠæŸä¸ªç›®å½•æ—¶ï¼ŒFTPæœåŠ¡å™¨å°†æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¬¢è¿ä¿¡æ¯æ˜¯é€šè¿‡è¯¥ç›®å½•ä¸‹çš„.messageæ–‡ä»¶è·å¾—çš„</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ­¤æ–‡ä»¶ä¿å­˜è‡ªå®šä¹‰çš„æ¬¢è¿ä¿¡æ¯ï¼Œç”±ç”¨æˆ·è‡ªå·±å»ºç«‹</span></span><br><span class="line"><span class="meta">#</span><span class="bash">dirmessage_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦è®©ç³»ç»Ÿè‡ªåŠ¨ç»´æŠ¤ä¸Šä¼ å’Œä¸‹è½½çš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤æƒ…å†µè¯¥æ—¥å¿—æ–‡ä»¶ä¸º/var/<span class="built_in">log</span>/vsftpd.log,ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„xferlog_fileé€‰é¡¹å¯¹å…¶è¿›è¡Œè®¾å®š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤å€¼ä¸ºNO</span></span><br><span class="line">xferlog_enable=YES</span><br><span class="line"><span class="meta">#</span><span class="bash"> Make sure PORT transfer connections originate from port 20 (ftp-data).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦è®¾å®šFTPæœåŠ¡å™¨å°†å¯ç”¨FTPæ•°æ®ç«¯å£çš„è¿æ¥è¯·æ±‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ftp-dataæ•°æ®ä¼ è¾“ï¼Œ21ä¸ºè¿æ¥æ§åˆ¶ç«¯å£</span></span><br><span class="line">connect_from_port_20=YES</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾å®šæ˜¯å¦å…è®¸æ”¹å˜ä¸Šä¼ æ–‡ä»¶çš„å±ä¸»ï¼Œä¸ä¸‹é¢ä¸€ä¸ªè®¾å®šé¡¹é…åˆä½¿ç”¨</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ³¨æ„ï¼Œä¸æ¨èä½¿ç”¨rootç”¨æˆ·ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash">chown_uploads=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®æƒ³è¦æ”¹å˜çš„ä¸Šä¼ æ–‡ä»¶çš„å±ä¸»ï¼Œå¦‚æœéœ€è¦ï¼Œåˆ™è¾“å…¥ä¸€ä¸ªç³»ç»Ÿç”¨æˆ·å</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ä»¥æŠŠä¸Šä¼ çš„æ–‡ä»¶éƒ½æ”¹æˆrootå±ä¸»ã€‚whoeverï¼šä»»ä½•äºº</span></span><br><span class="line"><span class="meta">#</span><span class="bash">chown_username=whoever</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾å®šç³»ç»Ÿç»´æŠ¤è®°å½•FTPæœåŠ¡å™¨ä¸Šä¼ å’Œä¸‹è½½æƒ…å†µçš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /var/<span class="built_in">log</span>/vsftpd.logæ˜¯é»˜è®¤çš„ï¼Œä¹Ÿå¯ä»¥å¦è®¾å…¶å®ƒ</span></span><br><span class="line"><span class="meta">#</span><span class="bash">xferlog_file=/var/<span class="built_in">log</span>/vsftpd.log</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦ä»¥æ ‡å‡†xferlogçš„æ ¼å¼ä¹¦å†™ä¼ è¾“æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤ä¸º/var/<span class="built_in">log</span>/xferlogï¼Œä¹Ÿå¯ä»¥é€šè¿‡xferlog_fileé€‰é¡¹å¯¹å…¶è¿›è¡Œè®¾å®š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤å€¼ä¸ºNO</span></span><br><span class="line"><span class="meta">#</span><span class="bash">xferlog_std_format=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»¥ä¸‹æ˜¯é™„åŠ é…ç½®ï¼Œæ·»åŠ ç›¸åº”çš„é€‰é¡¹å°†å¯ç”¨ç›¸åº”çš„è®¾ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦ç”Ÿæˆä¸¤ä¸ªç›¸ä¼¼çš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤åœ¨/var/<span class="built_in">log</span>/xferlogå’Œ/var/<span class="built_in">log</span>/vsftpd.logç›®å½•ä¸‹</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‰è€…æ˜¯wu_ftpdç±»å‹çš„ä¼ è¾“æ—¥å¿—ï¼Œå¯ä»¥åˆ©ç”¨æ ‡å‡†æ—¥å¿—å·¥å…·å¯¹å…¶è¿›è¡Œåˆ†æï¼›åè€…æ˜¯vsftpdç±»å‹çš„æ—¥å¿—</span></span><br><span class="line"><span class="meta">#</span><span class="bash">dual_log_enable</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å°†åŸæœ¬è¾“å‡ºåˆ°/var/<span class="built_in">log</span>/vsftpd.logä¸­çš„æ—¥å¿—ï¼Œè¾“å‡ºåˆ°ç³»ç»Ÿæ—¥å¿—</span></span><br><span class="line"><span class="meta">#</span><span class="bash">syslog_enable</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®æ•°æ®ä¼ è¾“ä¸­æ–­é—´éš”æ—¶é—´ï¼Œæ­¤è¯­å¥è¡¨ç¤ºç©ºé—²çš„ç”¨æˆ·ä¼šè¯ä¸­æ–­æ—¶é—´ä¸º600ç§’</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å³å½“æ•°æ®ä¼ è¾“ç»“æŸåï¼Œç”¨æˆ·è¿æ¥FTPæœåŠ¡å™¨çš„æ—¶é—´ä¸åº”è¶…è¿‡600ç§’ã€‚å¯ä»¥æ ¹æ®å®é™…æƒ…å†µå¯¹è¯¥å€¼è¿›è¡Œä¿®æ”¹</span></span><br><span class="line"><span class="meta">#</span><span class="bash">idle_session_timeout=600</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®æ•°æ®è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œè¯¥è¯­å¥è¡¨ç¤ºæ•°æ®è¿æ¥è¶…æ—¶æ—¶é—´ä¸º120ç§’ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µå¯¹å…¶ä¸ªä¿®æ”¹</span></span><br><span class="line"><span class="meta">#</span><span class="bash">data_connection_timeout=120</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿è¡Œvsftpdéœ€è¦çš„éç‰¹æƒç³»ç»Ÿç”¨æˆ·ï¼Œç¼ºçœæ˜¯nobody</span></span><br><span class="line"><span class="meta">#</span><span class="bash">nopriv_user=ftpsecure</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦è¯†åˆ«å¼‚æ­¥ABORè¯·æ±‚ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœFTP clientä¼šä¸‹è¾¾â€œasync ABORâ€è¿™ä¸ªæŒ‡ä»¤æ—¶ï¼Œè¿™ä¸ªè®¾å®šæ‰éœ€è¦å¯ç”¨</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è€Œä¸€èˆ¬æ­¤è®¾å®šå¹¶ä¸å®‰å…¨ï¼Œæ‰€ä»¥é€šå¸¸å°†å…¶å–æ¶ˆ</span></span><br><span class="line"><span class="meta">#</span><span class="bash">async_abor_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦ä»¥ASCIIæ–¹å¼ä¼ è¾“æ•°æ®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šå¿½ç•¥ASCIIæ–¹å¼çš„è¯·æ±‚ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ç”¨æ­¤é€‰é¡¹å°†å…è®¸æœåŠ¡å™¨ä»¥ASCIIæ–¹å¼ä¼ è¾“æ•°æ®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸è¿‡ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´ç”±<span class="string">"SIZE /big/file"</span>æ–¹å¼å¼•èµ·çš„DoSæ”»å‡»</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ascii_upload_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ascii_download_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç™»å½•FTPæœåŠ¡å™¨æ—¶æ˜¾ç¤ºçš„æ¬¢è¿ä¿¡æ¯</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœ‰éœ€è¦ï¼Œå¯åœ¨æ›´æ”¹ç›®å½•æ¬¢è¿ä¿¡æ¯çš„ç›®å½•ä¸‹åˆ›å»ºåä¸º.messageçš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥æ¬¢è¿ä¿¡æ¯ä¿å­˜å</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ftpd_banner=Welcome to blah FTP service.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»‘åå•è®¾ç½®ã€‚å¦‚æœå¾ˆè®¨åŒæŸäº›email addressï¼Œå°±å¯ä»¥ä½¿ç”¨æ­¤è®¾å®šæ¥å–æ¶ˆä»–çš„ç™»å½•æƒé™</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ä»¥å°†æŸäº›ç‰¹æ®Šçš„email addressæŠµæŒ¡ä½ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash">deny_email_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å½“ä¸Šé¢çš„deny_email_enable=YESæ—¶ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªè®¾å®šé¡¹æ¥è§„å®šå“ªäº›é‚®ä»¶åœ°å€ä¸å¯ç™»å½•vsftpdæœåŠ¡å™¨</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ­¤æ–‡ä»¶éœ€ç”¨æˆ·è‡ªå·±åˆ›å»ºï¼Œä¸€è¡Œä¸€ä¸ªemail addresså³å¯</span></span><br><span class="line"><span class="meta">#</span><span class="bash">banned_email_file=/etc/vsftpd/banned_emails</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨åæ˜¯å¦å…·æœ‰è®¿é—®è‡ªå·±ç›®å½•ä»¥å¤–çš„å…¶ä»–æ–‡ä»¶çš„æƒé™</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®ä¸ºYESæ—¶ï¼Œç”¨æˆ·è¢«é”å®šåœ¨è‡ªå·±çš„homeç›®å½•ä¸­ï¼Œvsftpdå°†åœ¨ä¸‹é¢chroot_list_fileé€‰é¡¹å€¼çš„ä½ç½®å¯»æ‰¾chroot_listæ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¿…é¡»ä¸ä¸‹é¢çš„è®¾ç½®é¡¹é…åˆ</span></span><br><span class="line"><span class="meta">#</span><span class="bash">chroot_list_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¢«åˆ—å…¥æ­¤æ–‡ä»¶çš„ç”¨æˆ·ï¼Œåœ¨ç™»å½•åå°†ä¸èƒ½åˆ‡æ¢åˆ°è‡ªå·±ç›®å½•ä»¥å¤–çš„å…¶ä»–ç›®å½•</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»è€Œæœ‰åˆ©äºFTPæœåŠ¡å™¨çš„å®‰å…¨ç®¡ç†å’Œéšç§ä¿æŠ¤ã€‚æ­¤æ–‡ä»¶éœ€è‡ªå·±å»ºç«‹</span></span><br><span class="line"><span class="meta">#</span><span class="bash">chroot_list_file=/etc/vsftpd/chroot_list</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å…è®¸é€’å½’æŸ¥è¯¢ã€‚é»˜è®¤ä¸ºå…³é—­ï¼Œä»¥é˜²æ­¢è¿œç¨‹ç”¨æˆ·é€ æˆè¿‡é‡çš„I/O</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ls_recurse_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å…è®¸ç›‘å¬ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœè®¾ç½®ä¸ºYESï¼Œåˆ™vsftpdå°†ä»¥ç‹¬ç«‹æ¨¡å¼è¿è¡Œï¼Œç”±vsftpdè‡ªå·±ç›‘å¬å’Œå¤„ç†IPv4ç«¯å£çš„è¿æ¥è¯·æ±‚</span></span><br><span class="line">listen=YES</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾å®šæ˜¯å¦æ”¯æŒIPV6ã€‚å¦‚è¦åŒæ—¶ç›‘å¬IPv4å’ŒIPv6ç«¯å£ï¼Œ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ™å¿…é¡»è¿è¡Œä¸¤å¥—vsftpdï¼Œé‡‡ç”¨ä¸¤å¥—é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åŒæ—¶ç¡®ä¿å…¶ä¸­æœ‰ä¸€ä¸ªç›‘å¬é€‰é¡¹æ˜¯è¢«æ³¨é‡Šæ‰çš„</span></span><br><span class="line"><span class="meta">#</span><span class="bash">listen_ipv6=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®PAMå¤–æŒ‚æ¨¡å—æä¾›çš„è®¤è¯æœåŠ¡æ‰€ä½¿ç”¨çš„é…ç½®æ–‡ä»¶åï¼Œå³/etc/pam.d/vsftpdæ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ­¤æ–‡ä»¶ä¸­file=/etc/vsftpd/ftpuserså­—æ®µï¼Œè¯´æ˜äº†PAMæ¨¡å—èƒ½æŠµæŒ¡çš„å¸å·å†…å®¹æ¥è‡ªæ–‡ä»¶/etc/vsftpd/ftpusersä¸­</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pam_service_name=vsftpd</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å…è®¸ftpusersæ–‡ä»¶ä¸­çš„ç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨ï¼Œé»˜è®¤ä¸ºNO</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è‹¥æ­¤é¡¹è®¾ä¸ºYESï¼Œåˆ™user_listæ–‡ä»¶ä¸­çš„ç”¨æˆ·å…è®¸ç™»å½•FTPæœåŠ¡å™¨</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è€Œå¦‚æœåŒæ—¶è®¾ç½®äº†userlist_deny=YESï¼Œåˆ™user_listæ–‡ä»¶ä¸­çš„ç”¨æˆ·å°†ä¸å…è®¸ç™»å½•FTPæœåŠ¡å™¨ï¼Œç”šè‡³è¿è¾“å…¥å¯†ç æç¤ºä¿¡æ¯éƒ½æ²¡æœ‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash">userlist_enable=YES/NO</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®æ˜¯å¦é˜»æ‰¯user_listæ–‡ä»¶ä¸­çš„ç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨ï¼Œé»˜è®¤ä¸ºYES</span></span><br><span class="line"><span class="meta">#</span><span class="bash">userlist_deny=YES/NO</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦ä½¿ç”¨tcp_wrappersä½œä¸ºä¸»æœºè®¿é—®æ§åˆ¶æ–¹å¼ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tcp_wrapperså¯ä»¥å®ç°linuxç³»ç»Ÿä¸­ç½‘ç»œæœåŠ¡çš„åŸºäºä¸»æœºåœ°å€çš„è®¿é—®æ§åˆ¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨/etcç›®å½•ä¸­çš„hosts.allowå’Œhosts.denyä¸¤ä¸ªæ–‡ä»¶ç”¨äºè®¾ç½®tcp_wrappersçš„è®¿é—®æ§åˆ¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‰è€…è®¾ç½®å…è®¸è®¿é—®è®°å½•ï¼Œåè€…è®¾ç½®æ‹’ç»è®¿é—®è®°å½•ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æƒ³é™åˆ¶æŸäº›ä¸»æœºå¯¹FTPæœåŠ¡å™¨192.168.57.2çš„åŒ¿åè®¿é—®ï¼Œç¼–ç¼‰/etc/hosts.allowæ–‡ä»¶ï¼Œå¦‚åœ¨ä¸‹é¢å¢åŠ ä¸¤è¡Œå‘½ä»¤ï¼š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> vsftpd:192.168.57.1:DENY å’Œvsftpd:192.168.57.9:DENY</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¡¨æ˜é™åˆ¶IPä¸º192.168.57.1/192.168.57.9ä¸»æœºè®¿é—®IPä¸º192.168.57.2çš„FTPæœåŠ¡å™¨</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ­¤æ—¶FTPæœåŠ¡å™¨è™½å¯ä»¥PINGé€šï¼Œä½†æ— æ³•è¿æ¥</span></span><br><span class="line">tcp_wrappers=YES</span><br></pre></td></tr></table></figure><p>é™¤äº†ä¸Šè¿°é‚£äº›åŸºæœ¬è®¾å®šï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨vsftpd.confæ–‡ä»¶ä¸­æ·»åŠ æ›´å¤šçš„å®‰å…¨é€‰é¡¹ã€‚å…¶ä¸­å‡ ä¸ªå¸¸ç”¨çš„å¦‚ä¸‹ï¼š</p><p>é™åˆ¶æœ€å¤§è¿æ¥æ•°å’Œä¼ è¾“é€Ÿç‡</p><p>åœ¨FTPæœåŠ¡å™¨çš„ç®¡ç†ä¸­ï¼Œæ— è®ºå¯¹æœ¬åœ°ç”¨æˆ·è¿˜æ˜¯åŒ¿åç”¨æˆ·ï¼Œå¯¹äºFTPæœåŠ¡å™¨èµ„æºçš„ä½¿ç”¨éƒ½éœ€è¦è¿›è¡Œæ§æ§åˆ¶ï¼Œé¿å…ç”±äºè´Ÿæ‹…è¿‡å¤§é€ æˆFTPæœåŠ¡å™¨è¿è¡Œå¼‚å¸¸ï¼Œå¯ä»¥æ·»åŠ ä»¥ä¸‹é…ç½®é¡¹å¯¹FTPå®¢æˆ·æœºä½¿ç”¨FTPæœåŠ¡å™¨èµ„æºè¿›è¡Œæ§åˆ¶ï¼š</p><ul><li><code>max_client</code>è®¾ç½®é¡¹ ç”¨äºè®¾ç½®FTPæœåŠ¡å™¨æ‰€å…è®¸çš„æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œå€¼ä¸º0æ—¶è¡¨ç¤ºä¸é™åˆ¶ã€‚ä¾‹å¦‚<code>max_client=100</code>è¡¨ç¤ºFTPæœåŠ¡å™¨çš„æ‰€æœ‰å®¢æˆ·ç«¯æœ€å¤§è¿æ¥æ•°ä¸è¶…è¿‡100ä¸ªã€‚</li><li><code>max_per_ip</code>è®¾ç½®é¡¹ ç”¨äºè®¾ç½®å¯¹äºåŒä¸€IPåœ°å€å…è®¸çš„æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œå€¼ä¸º0æ—¶è¡¨ç¤ºä¸é™åˆ¶ã€‚ä¾‹å¦‚<code>max_per_ip=5</code>è¡¨ç¤ºåŒä¸€IPåœ°å€çš„FTPå®¢æˆ·æœºä¸FTPæœåŠ¡å™¨å»ºç«‹çš„æœ€å¤§è¿æ¥æ•°ä¸è¶…è¿‡5ä¸ªã€‚</li><li><code>local_max_rate</code>è®¾ç½®é¡¹ ç”¨äºè®¾ç½®æœ¬åœ°ç”¨æˆ·çš„æœ€å¤§ä¼ è¾“é€Ÿç‡ï¼Œå•ä½ä¸ºB/sï¼Œå€¼ä¸º0æ—¶è¡¨ç¤ºä¸é™åˆ¶ã€‚ä¾‹å¦‚<code>local_max_rate=500000</code>è¡¨ç¤ºFTPæœåŠ¡å™¨çš„æœ¬åœ°ç”¨æˆ·æœ€å¤§ä¼ è¾“é€Ÿç‡è®¾ç½®ä¸º500KB/s.</li><li><code>anon_max_rate</code>è®¾ç½®é¡¹ ç”¨äºè®¾ç½®åŒ¿åç”¨æˆ·çš„æœ€å¤§ä¼ è¾“é€Ÿç‡ï¼Œå•ä½ä¸ºB/s,å€¼ä¸º0è¡¨ç¤ºä¸é™åˆ¶ã€‚ä¾‹å¦‚<code>ano_max_rate=200000</code>ï¼Œè¡¨ç¤ºFTPæœåŠ¡å™¨çš„åŒ¿åç”¨æˆ·æœ€å¤§ä¼ è¾“é€Ÿç‡è®¾ç½®ä¸º200KB/s.</li></ul><p>æŒ‡å®šç”¨æˆ·çš„æƒé™è®¾ç½®</p><p><code>vsftpd.user_list</code>æ–‡ä»¶éœ€è¦ä¸<code>vsftpd.conf</code>æ–‡ä»¶ä¸­çš„é…ç½®é¡¹ç»“åˆæ¥å®ç°å¯¹äº<code>vsftpd.user_list</code>æ–‡ä»¶ä¸­æŒ‡å®šç”¨æˆ·è´¦å·çš„è®¿é—®æ§åˆ¶ï¼š</p><p>ï¼ˆ1ï¼‰è®¾ç½®ç¦æ­¢ç™»å½•çš„ç”¨æˆ·è´¦å·</p><p>å½“<code>vsftpd.conf</code>é…ç½®æ–‡ä»¶ä¸­åŒ…æ‹¬ä»¥ä¸‹è®¾ç½®æ—¶ï¼Œ<code>vsftpd.user_list</code>æ–‡ä»¶ä¸­çš„ç”¨æˆ·è´¦å·è¢«ç¦æ­¢è¿›è¡ŒFTPç™»å½•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">userlist_enable=YES</span><br><span class="line">userlist_deny=YES</span><br></pre></td></tr></table></figure><p><code>userlist_enable</code>è®¾ç½®é¡¹è®¾ç½®ä½¿ç”¨<code>vsftpd.user_list</code>æ–‡ä»¶ï¼Œ<code>userlist_deny</code>è®¾ç½®ä¸º<code>YES</code>è¡¨ç¤º<code>vsftpd.user_list</code>æ–‡ä»¶ç”¨äºè®¾ç½®ç¦æ­¢çš„ç”¨æˆ·è´¦å·ã€‚</p><p>ï¼ˆ2ï¼‰è®¾ç½®åªå…è®¸ç™»å½•çš„ç”¨æˆ·è´¦å·</p><p>å½“vsftpd.confé…ç½®æ–‡ä»¶ä¸­åŒ…æ‹¬ä»¥ä¸‹è®¾ç½®æ—¶ï¼Œåªæœ‰<code>vsftpd.user_list</code>æ–‡ä»¶ä¸­çš„ç”¨æˆ·è´¦å·èƒ½å¤Ÿè¿›è¡ŒFTPç™»å½•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">userlist_enable=YES</span><br><span class="line">userlist_deny=NO</span><br></pre></td></tr></table></figure><p><code>userlist_enable</code>è®¾ç½®é¡¹è®¾ç½®ä½¿ç”¨vsftpd.user_listæ–‡ä»¶ï¼Œ<code>userlist _deny</code>è®¾ç½®ä¸º<code>NO</code>è¡¨ç¤º<code>vsftpd.usre_list</code>æ–‡ä»¶ç”¨äºè®¾ç½®åªå…è®¸ç™»å½•çš„ç”¨æˆ·è´¦å·ï¼Œæ–‡ä»¶ä¸­æœªåŒ…æ‹¬çš„ç”¨æˆ·è´¦å·è¢«ç¦æ­¢FTPç™»å½•ã€‚</p><p><code>userlist_deny</code>å’Œ<code>userlist_enable</code>é€‰é¡¹é™åˆ¶ç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨ï¼ˆä½¿ç”¨<code>userlist_deny</code>é€‰é¡¹å’Œ<code>user_list</code>æ–‡ä»¶ä¸€èµ·èƒ½æœ‰æ•ˆé˜»æ­¢<code>root,apache,www</code>ç­‰ç³»ç»Ÿç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨ï¼Œä»è€Œä¿è¯FTPæœåŠ¡å™¨çš„åˆ†çº§å®‰å…¨æ€§ï¼‰ã€‚ä»¥ä¸‹æ˜¯ä¸¤ä¸ªé€‰é¡¹çš„å…·ä½“è¡¨ç°å½¢å¼å’Œä¸¤ç§æ­é…ä½¿ç”¨æ–¹å¼çš„æ•ˆæœï¼š</p><table><thead><tr><th align="left">é…ç½®</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">Userlist_enable=YES</td><td align="left">Ftpusersä¸­ç”¨æˆ·å…è®¸è®¿é—®;User_listä¸­ç”¨æˆ·å…è®¸è®¿é—®</td></tr><tr><td align="left">Userlist_enable=NO</td><td align="left">Ftpusersä¸­ç”¨æˆ·ç¦æ­¢è®¿é—®;User_listä¸­ç”¨æˆ·å…è®¸è®¿é—®</td></tr><tr><td align="left">Userlist_deny=YES</td><td align="left">Ftpusersä¸­ç”¨æˆ·ç¦æ­¢è®¿é—®ï¼ˆç™»å½•æ—¶å¯ä»¥çœ‹åˆ°å¯†ç è¾“å…¥æç¤ºï¼Œä½†ä»æ— æ³•è®¿é—®ï¼‰;user_list ä¸­ç”¨æˆ·ç¦æ­¢è®¿é—®</td></tr><tr><td align="left">Userlist_deny=NO</td><td align="left">ftpusersä¸­ç”¨æˆ·ç¦æ­¢è®¿é—®;user_listä¸­ç”¨æˆ·å…è®¸è®¿</td></tr><tr><td align="left">Userlist_enable=YES å¹¶ä¸”Userlist_deny=YES</td><td align="left">Ftpusersä¸­ç”¨æˆ·ç¦æ­¢è®¿é—®;User_listä¸­ç”¨æˆ·ç¦æ­¢è®¿é—®ï¼ˆç™»å½•æ—¶ä¸ä¼šå‡ºç°å¯†ç æç¤ºï¼Œç›´æ¥è¢«æœåŠ¡å™¨æ‹’ç»ï¼‰</td></tr><tr><td align="left">Userlist_enable=YES å¹¶ä¸”Userlist_deny=NO</td><td align="left">Ftpusersä¸­ç”¨æˆ·ç¦æ­¢è®¿é—®;User_listä¸­ç”¨æˆ·å…è®¸è®¿é—®</td></tr></tbody></table><p>ä¿®æ”¹é»˜è®¤ç«¯å£</p><p>é»˜è®¤FTPæœåŠ¡å™¨ç«¯å£å·æ˜¯21ï¼Œå‡ºäºå®‰å…¨ç›®çš„ï¼Œæœ‰æ—¶éœ€ä¿®æ”¹é»˜è®¤ç«¯å£å·ï¼Œä¿®æ”¹/etc/vsftpd/vsftpd.confï¼Œæ·»åŠ è¯­å¥(ä¾‹)ï¼š</p><p><code>listen_port=4449</code></p><p>è¯­å¥æŒ‡å®šäº†ä¿®æ”¹åFTPæœåŠ¡å™¨çš„ç«¯å£å·ï¼Œåº”å°½é‡å¤§äº4000ã€‚ä¿®æ”¹åè®¿é—®</p><p><code>#ftp 192.168.57.2 4449</code></p><p>æ³¨æ„è¿™é‡Œéœ€åŠ ä¸Šæ­£ç¡®çš„ç«¯å£å·äº†ï¼Œå¦åˆ™ä¸èƒ½æ­£å¸¸è¿æ¥ã€‚</p><p>è®¾ç½®ç”¨æˆ·ç»„</p><p>æœ‰å…³FTPç”¨æˆ·å’Œç”¨æˆ·ç»„çš„é‡è¦æ€§ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰ä»‹ç»vsftpdçš„æ—¶å€™ä¾¿å·²ç»æåˆ°è¿‡ã€‚è¿™é‡Œä¸»è¦æ˜¯ç®€å•çš„è¯´æ˜ç”¨æˆ·ç»„çš„æŠ€æœ¯å®ç°ï¼Œè‡³äºå…·ä½“å¦‚ä½•åº”ç”¨ï¼Œè¿˜æ˜¯å…·ä½“éœ€æ±‚å…·ä½“å¯¹å¾…ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /home/try  é€’å½’åˆ›å»ºæ–°ç›®å½•</span><br><span class="line">groupadd try        æ–°å»ºç»„</span><br><span class="line">useradd -g try -d /home/try try1 æ–°å»ºç”¨æˆ·try1å¹¶æŒ‡å®šå®¶ç›®å½•å’Œå±ç»„</span><br><span class="line">useradd -g try -d /home/try try2 æ–°å»ºç”¨æˆ·try2å¹¶æŒ‡å®šå®¶ç›®å½•å’Œå±ç»„</span><br><span class="line">useradd -g try -d /home/try try3 æ–°å»ºç”¨æˆ·try3å¹¶æŒ‡å®šå®¶ç›®å½•å’Œå±ç»„</span><br><span class="line">passwd try1  ä¸ºæ–°ç”¨æˆ·è®¾å¯†ç </span><br><span class="line">passwd try2  ä¸ºæ–°ç”¨æˆ·è®¾å¯†ç </span><br><span class="line">passwd try3  ä¸ºæ–°ç”¨æˆ·è®¾å¯†ç </span><br><span class="line">chown try1 /home/try è®¾ç½®ç›®å½•å±ä¸»ä¸ºç”¨æˆ·try1</span><br><span class="line">chown .try /home/try è®¾ç½®ç›®å½•å±ç»„ä¸ºç»„try</span><br><span class="line">chmod 750 /home/try  è®¾ç½®ç›®å½•è®¿é—®æƒé™try1ä¸ºè¯»ï¼Œå†™ï¼Œæ‰§è¡Œï¼›try2ï¼Œtry3ä¸ºè¯»ï¼Œæ‰§è¡Œ</span><br></pre></td></tr></table></figure><p>ç”±äºæœ¬åœ°ç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨åè¿›å…¥è‡ªå·±ä¸»ç›®å½•ï¼Œè€Œtry1,try2 try3å¯¹ä¸»ç›®å½•/home/tryåˆ†é…çš„æƒé™ä¸åŒï¼Œæ‰€ä»¥é€šè¿‡FTPè®¿é—®çš„æƒé™ä¹Ÿä¸åŒï¼Œtry1è®¿é—®æƒé™ä¸ºï¼šä¸Šä¼ ï¼Œä¸‹è½½ï¼Œå»ºç›®å½•ï¼›try2ï¼Œtry3è®¿é—®æƒé™ä¸ºä¸‹è½½ï¼Œæµè§ˆï¼Œä¸èƒ½å»ºç›®å½•å’Œä¸Šä¼ ã€‚å®ç°äº†ç¾¤ç»„ä¸­ç”¨æˆ·ä¸åŒè®¿é—®çº§åˆ«ï¼ŒåŠ å¼ºäº†å¯¹FTPæœåŠ¡å™¨çš„åˆ†çº§å®‰å…¨ç®¡ç†ã€‚</p><p>è¿æ¥è¶…æ—¶ï¼ˆæœ¬éƒ¨åˆ†å†…å®¹ç”±ææ´‹æä¾›ï¼‰</p><p>é…ç½®ç©ºé—²çš„ç”¨æˆ·ä¼šè¯çš„ä¸­æ–­æ—¶é—´ï¼šå¦‚ä¸‹é…ç½®å°†åœ¨ç”¨æˆ·ä¼šè¯ç©ºé—²5åˆ†é’Ÿåè¢«ä¸­æ–­ï¼Œä»¥é‡Šæ”¾æœåŠ¡å™¨çš„èµ„æº</p><p><code>Idle_session_timeout=300</code></p><p>é…ç½®ç©ºé—²çš„æ•°æ®è¿æ¥çš„ä¸­æ–­æ—¶é—´ï¼šå¦‚ä¸‹é…ç½®å°†åœ¨æ•°æ®ç©ºé—²è¿æ¥1åˆ†é’Ÿåè¢«ä¸­æ–­ï¼ŒåŒæ ·ä¹Ÿæ˜¯ä¸ºäº†é‡Šæ”¾æœåŠ¡å™¨çš„èµ„æº</p><p><code>Data_connection_timeout=60</code></p><p>é…ç½®å®¢æˆ·ç«¯ç©ºé—²æ—¶çš„è‡ªåŠ¨ä¸­æ–­å’Œæ¿€æ´»è¿æ¥çš„æ—¶é—´ï¼šå¦‚ä¸‹é…ç½®å°†ä½¿å®¢æˆ·ç«¯ç©ºé—²1åˆ†é’Ÿåè‡ªåŠ¨ä¸­æ–­è¿æ¥ï¼Œå¹¶åœ¨30ç§’åè‡ªåŠ¨æ¿€æ´»è¿æ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Accept_timeout=60</span><br><span class="line">Connect_timeout=30</span><br></pre></td></tr></table></figure><h5 id="vsftpdçš„æ—¥å¿—"><a href="#vsftpdçš„æ—¥å¿—" class="headerlink" title="vsftpdçš„æ—¥å¿—"></a>vsftpdçš„æ—¥å¿—</h5><p>å¸¸è§çš„vsftpdæ—¥å¿—è§£å†³æ–¹æ¡ˆ</p><p>åœ¨vsftpd.confä¸­æœ‰å¦‚ä¸‹å†…å®¹å®šä¹‰äº†æ—¥å¿—çš„è®°å½•æ–¹å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¡¨æ˜FTPæœåŠ¡å™¨è®°å½•ä¸Šä¼ ä¸‹è½½çš„æƒ…å†µ</span></span><br><span class="line">xferlog_enable=YES</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¡¨æ˜å°†è®°å½•çš„ä¸Šä¼ ä¸‹è½½æƒ…å†µå†™åœ¨xferlog_fileæ‰€æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œå³xferlog_fileé€‰é¡¹æŒ‡å®šçš„æ–‡ä»¶ä¸­</span></span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">xferlog_file=/var/log/xferlog</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ç”¨åŒä»½æ—¥å¿—ã€‚åœ¨ç”¨xferlogæ–‡ä»¶è®°å½•æœåŠ¡å™¨ä¸Šä¼ ä¸‹è½½æƒ…å†µçš„åŒæ—¶ï¼Œ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> vsftpd_log_fileæ‰€æŒ‡å®šçš„æ–‡ä»¶ï¼Œå³/var/<span class="built_in">log</span>/vsftpd.logä¹Ÿå°†ç”¨æ¥è®°å½•æœåŠ¡å™¨çš„ä¼ è¾“æƒ…å†µ</span></span><br><span class="line">dual_log_enable=YES</span><br><span class="line">vsftpd_log_file=/var/log/vsftpd.log</span><br></pre></td></tr></table></figure><p>vsftpdçš„ä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶åˆ†æå¦‚ä¸‹ï¼š</p><p>/var/log/xferlog</p><p>è®°å½•å†…å®¹ä¸¾ä¾‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Thu Sep 6 09:07:48 2007 7 192.168.57.1 4323279 /home/student/phpMyadmin-2.11.0-all-languages.tar.gz b -i r student ftp 0 * c</span><br></pre></td></tr></table></figure><p>/var/log/vsftpd.log</p><p>è®°å½•å†…å®¹ä¸¾ä¾‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Tue Sep 11 14:59:03 2007 [pid 3460]    CONNECT: Client "127.0.0.1"</span><br><span class="line">Tue Sep 11 14:59:24 2007 [pid 3459] [ftp] OK LOGIN;Client "127.0.0.1" ,anon password â€</span><br></pre></td></tr></table></figure><p>/var/log/xferlogæ—¥å¿—æ–‡ä»¶ä¸­æ•°æ®çš„åˆ†æå’Œå‚æ•°è¯´æ˜</p><p>|è®°å½•æ•°æ®|å‚æ•°åç§°|å‚æ•°è¯´æ˜|<br>|Thu Sep 6 09:07:48 2007|å½“å‰æ—¶é—´|å½“å‰æœåŠ¡å™¨æœ¬åœ°æ—¶é—´ï¼Œæ ¼å¼ä¸ºï¼š DDD MMM dd hh:mm:ss YYY|<br>|7|ä¼ è¾“æ—¶é—´|ä¼ é€æ–‡ä»¶æ‰€ç”¨æ—¶é—´ï¼Œå•ä½ä¸ºç§’|<br>|192.168.57.1|è¿œç¨‹ä¸»æœºåç§°/IP|è¿œç¨‹ä¸»æœºåç§°/IP|<br>|4323279|æ–‡ä»¶å¤§å°|ä¼ é€æ–‡ä»¶çš„å¤§å°ï¼Œå•ä½ä¸ºbyte|<br>|/home/student/phpMyadmin-2.11.0-all-languages.tar.gz|æ–‡ä»¶å|ä¼ è¾“æ–‡ä»¶åï¼ŒåŒ…æ‹¬è·¯å¾„|<br>|b|ä¼ è¾“ç±»å‹|ä¼ è¾“æ–¹å¼çš„ç±»å‹ï¼ŒåŒ…æ‹¬ä¸¤ç§ï¼šaä»¥ASCIIä¼ è¾“ bä»¥äºŒè¿›åˆ¶æ–‡ä»¶ä¼ è¾“|<br>|â€“|ç‰¹æ®Šå¤„ç†æ ‡å¿—|ç‰¹æ®Šå¤„ç†çš„æ ‡å¿—ä½ï¼Œå¯èƒ½çš„å€¼åŒ…æ‹¬ï¼š_ ä¸åšä»»ä½•ç‰¹æ®Šå¤„ç†ï¼›C æ–‡ä»¶æ˜¯å‹ç¼©æ ¼å¼ï¼›U æ–‡ä»¶æ˜¯éå‹ç¼©æ ¼å¼ï¼›T æ–‡ä»¶æ˜¯taræ ¼å¼|<br>|i|ä¼ è¾“æ–¹å‘|æ–‡ä»¶ä¼ è¾“æ–¹å‘ï¼ŒåŒ…æ‹¬ä¸¤ç§ï¼šo ä»FTPæœåŠ¡å™¨å‘å®¢æˆ·ç«¯ä¼ è¾“ï¼›i ä»å®¢æˆ·ç«¯å‘FTPæœåŠ¡å™¨ä¼ è¾“|<br>|r|è®¿é—®æ¨¡å¼|ç”¨æˆ·è®¿é—®æ¨¡å¼ï¼ŒåŒ…æ‹¬ï¼ša åŒ¿åç”¨æˆ·ï¼›g æ¥å®¾ç”¨æˆ·ï¼›r çœŸå®ç”¨æˆ·ï¼Œå³ç³»ç»Ÿä¸­çš„ç”¨æˆ·|<br>|student|ç”¨æˆ·å|ç”¨æˆ·åç§°|<br>|ftp|æœåŠ¡å|æ‰€ä½¿ç”¨çš„æœåŠ¡åç§°ï¼Œä¸€èˆ¬ä¸ºFTP|<br>|0|è®¤è¯æ–¹å¼|è®¤è¯æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼š0 æ— ï¼›1 RFC931è®¤è¯|<br>|<em>|è®¤è¯ç”¨æˆ·id|è®¤è¯ç”¨æˆ·çš„idï¼Œå¦‚æœä½¿ç”¨</em>ï¼Œåˆ™è¡¨ç¤ºæ— æ³•è·å¾—è¯¥id|<br>|c|å®ŒæˆçŠ¶æ€|ä¼ è¾“çš„çŠ¶æ€ï¼šc è¡¨ç¤ºä¼ è¾“å·²å®Œæˆï¼›i è¡¨ç¤ºä¼ è¾“ç¤ºå®Œæˆ|</p><h5 id="å¸¸è§çš„FTPå‘½ä»¤ï¼Œä»¥åŠFTPæ•°å­—ä»£ç çš„æ„ä¹‰"><a href="#å¸¸è§çš„FTPå‘½ä»¤ï¼Œä»¥åŠFTPæ•°å­—ä»£ç çš„æ„ä¹‰" class="headerlink" title="å¸¸è§çš„FTPå‘½ä»¤ï¼Œä»¥åŠFTPæ•°å­—ä»£ç çš„æ„ä¹‰"></a>å¸¸è§çš„FTPå‘½ä»¤ï¼Œä»¥åŠFTPæ•°å­—ä»£ç çš„æ„ä¹‰</h5><p>å‘½ä»¤æ ¼å¼å¦‚ä¸‹æ˜¾ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FTPå‘½ä»¤</span><br><span class="line">  åŠŸèƒ½</span><br><span class="line">  FTPå‘½ä»¤</span><br><span class="line">  åŠŸèƒ½</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br><span class="line">æ˜¾ç¤ºæœåŠ¡å™¨ä¸Šçš„ç›®å½•</span><br><span class="line">  ls [remote-dir][local-file]</span><br><span class="line">  æ˜¾ç¤ºè¿œç¨‹ç›®å½•remote-dirï¼Œå¹¶å­˜å…¥æœ¬åœ°æ–‡ä»¶local-file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">get remote-file [local-file]</span><br><span class="line">ä»æœåŠ¡å™¨ä¸‹è½½æŒ‡å®šæ–‡ä»¶åˆ°å®¢æˆ·ç«¯</span><br><span class="line">  mget remote-files</span><br><span class="line">  ä¸‹è½½å¤šä¸ªè¿œç¨‹æ–‡ä»¶(mgetå‘½ä»¤å…è®¸ç”¨é€šé…ç¬¦ä¸‹è½½å¤šä¸ªæ–‡ä»¶)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">put local-file [remote-file]</span><br><span class="line">ä»å®¢æˆ·ç«¯ä¸Šä¼ æŒ‡å®šæ–‡ä»¶åˆ°æœåŠ¡å™¨</span><br><span class="line">  mput local-file</span><br><span class="line">  å°†å¤šä¸ªæ–‡ä»¶ä¸Šä¼ è‡³è¿œç¨‹ä¸»æœº(mputå‘½ä»¤å…è®¸ç”¨é€šé…ç¬¦ä¸Šä¼ å¤šä¸ªæ–‡ä»¶)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">open</span><br><span class="line">è¿æ¥FTPæœåŠ¡å™¨</span><br><span class="line">  mdelete [remote-file]</span><br><span class="line">  åˆ é™¤è¿œç¨‹ä¸»æœºæ–‡ä»¶</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">close</span><br><span class="line">ä¸­æ–­ä¸è¿œç¨‹æœåŠ¡å™¨çš„ftpä¼šè¯ï¼ˆä¸openå¯¹åº”ï¼‰</span><br><span class="line">  mkdir dir-name</span><br><span class="line">  åœ¨è¿œç¨‹ä¸»æœºä¸­åˆ›å»ºç›®å½•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">open host[port]</span><br><span class="line">å»ºç«‹æŒ‡å®šçš„ftpæœåŠ¡å™¨è¿æ¥ï¼Œå¯æŒ‡å®šè¿æ¥ç«¯å£</span><br><span class="line">  newer file-name</span><br><span class="line">  å¦‚æœè¿œç¨‹ä¸»æœºä¸­file-nameçš„ä¿®æ”¹æ—¶é—´æ¯”æœ¬åœ°ç¡¬ç›˜åŒåæ–‡ä»¶çš„æ—¶é—´æ›´è¿‘ï¼Œåˆ™é‡ä¼ è¯¥æ–‡ä»¶</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd directory</span><br><span class="line">æ”¹å˜æœåŠ¡å™¨çš„å·¥ä½œç›®å½•</span><br><span class="line">  rename [from][to]</span><br><span class="line">  æ›´æ”¹è¿œç¨‹ä¸»æœºçš„æ–‡ä»¶å</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lcd directory</span><br><span class="line">åœ¨å®¢æˆ·ç«¯ä¸Š(æœ¬åœ°)æ”¹å˜å·¥ä½œç›®å½•</span><br><span class="line">  pwd</span><br><span class="line">  æ˜¾ç¤ºè¿œç¨‹ä¸»æœºçš„å½“å‰å·¥ä½œç›®å½•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bye</span><br><span class="line">é€€å‡ºFTPå‘½ä»¤çŠ¶æ€</span><br><span class="line">  quit</span><br><span class="line">  åŒbye,é€€å‡ºftpä¼šè¯</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ascii</span><br><span class="line">è®¾ç½®æ–‡ä»¶ä¼ è¾“æ–¹å¼ä¸ºASCIIæ¨¡å¼</span><br><span class="line">  reget remote-file [local-file]</span><br><span class="line">  ç±»ä¼¼äºget,ä½†è‹¥local-fileå­˜åœ¨ï¼Œåˆ™ä»ä¸Šæ¬¡ä¼ è¾“ä¸­æ–­å¤„ç»­ä¼ </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">binary</span><br><span class="line">è®¾ç½®æ–‡ä»¶ä¼ è¾“æ–¹å¼ä¸ºäºŒè¿›åˆ¶æ¨¡å¼</span><br><span class="line">  rhelp [cmd-name]</span><br><span class="line">  è¯·æ±‚è·å¾—è¿œç¨‹ä¸»æœºçš„å¸®åŠ©</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![cmd [args]]</span><br><span class="line">åœ¨æœ¬åœ°ä¸»æœºä¸­äº¤äº’shellåé€€å›åˆ°ftpç¯å¢ƒï¼Œå¦‚:!ls *.zip</span><br><span class="line">  rstatus [file-name]</span><br><span class="line">  è‹¥æœªæŒ‡å®šæ–‡ä»¶åï¼Œåˆ™æ˜¾ç¤ºè¿œç¨‹ä¸»æœºçš„çŠ¶æ€ï¼Œå¦åˆ™æ˜¾ç¤ºæ–‡ä»¶çŠ¶æ€</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">accout [password]</span><br><span class="line">æä¾›ç™»å½•è¿œç¨‹ç³»ç»ŸæˆåŠŸåè®¿é—®ç³»ç»Ÿèµ„æºæ‰€éœ€çš„å¯†ç </span><br><span class="line">  hash</span><br><span class="line">  æ¯ä¼ è¾“1024å­—èŠ‚ï¼Œæ˜¾ç¤ºä¸€ä¸ªhashç¬¦å·ï¼ˆ#ï¼‰</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">append local-file [remote-file]</span><br><span class="line">å°†æœ¬åœ°æ–‡ä»¶è¿½åŠ åˆ°è¿œç¨‹ç³»ç»Ÿä¸»æœºï¼Œè‹¥æœªæŒ‡å®šè¿œç¨‹ç³»ç»Ÿæ–‡ä»¶åï¼Œåˆ™ä½¿ç”¨æœ¬åœ°æ–‡ä»¶å</span><br><span class="line">  restart marker</span><br><span class="line">  ä»æŒ‡å®šçš„æ ‡å¿—markerå¤„ï¼Œé‡æ–°å¼€å§‹getæˆ–putï¼Œå¦‚restart 130</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bye</span><br><span class="line">é€€å‡ºftpä¼šè¯è¿‡ç¨‹</span><br><span class="line">  rmdir dir-name</span><br><span class="line">  åˆ é™¤è¿œç¨‹ä¸»æœºç›®å½•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">case</span><br><span class="line">åœ¨ä½¿ç”¨mgetå‘½ä»¤æ—¶ï¼Œå°†è¿œç¨‹ä¸»æœºæ–‡ä»¶åä¸­çš„å¤§å†™è½¬ä¸ºå°å†™å­—æ¯</span><br><span class="line">  size file-name</span><br><span class="line">  æ˜¾ç¤ºè¿œç¨‹ä¸»æœºæ–‡ä»¶å¤§å°ï¼Œå¦‚ï¼š</span><br><span class="line">size idle 7200</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd remote-dir</span><br><span class="line">è¿›å…¥è¿œç¨‹ä¸»æœºç›®å½•</span><br><span class="line">  status</span><br><span class="line">  æ˜¾ç¤ºå½“å‰ftpçŠ¶æ€</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cdup</span><br><span class="line">è¿›å…¥è¿œç¨‹ä¸»æœºç›®å½•çš„çˆ¶ç›®å½•</span><br><span class="line">  system</span><br><span class="line">  æ˜¾ç¤ºè¿œç¨‹ä¸»æœºçš„æ“ä½œç³»ç»Ÿ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">delete remote-file</span><br><span class="line">åˆ é™¤è¿œç¨‹ä¸»æœºæ–‡ä»¶</span><br><span class="line">  user user-name [password][account]</span><br><span class="line">  å‘è¿œç¨‹ä¸»æœºè¡¨æ˜è‡ªå·±çš„èº«ä»½ï¼Œéœ€è¦å¯†ç æ—¶ï¼Œå¿…é¡»è¾“å…¥å¯†ç ï¼Œå¦‚:user anonymous my@email</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dir [remote-dir][local-file]</span><br><span class="line">æ˜¾ç¤ºè¿œç¨‹ä¸»æœºç›®å½•ï¼Œå¹¶å°†ç»“æœå­˜å…¥æœ¬åœ°æ–‡ä»¶</span><br><span class="line">  help [cmd]</span><br><span class="line">  æ˜¾ç¤ºftpå†…éƒ¨å‘½ä»¤cmdçš„å¸®åŠ©ä¿¡æ¯ï¼Œå¦‚help get</span><br></pre></td></tr></table></figure><p><strong>FTPæ•°å­—ä»£ç çš„æ„ä¹‰</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">110 é‡æ–°å¯åŠ¨æ ‡è®°åº”ç­”ã€‚</span><br><span class="line">120 æœåŠ¡åœ¨å¤šä¹…æ—¶é—´å†…readyã€‚</span><br><span class="line">125 æ•°æ®é“¾è·¯ç«¯å£å¼€å¯ï¼Œå‡†å¤‡ä¼ é€ã€‚</span><br><span class="line">150 æ–‡ä»¶çŠ¶æ€æ­£å¸¸ï¼Œå¼€å¯æ•°æ®è¿æ¥ç«¯å£ã€‚</span><br><span class="line">200 å‘½ä»¤æ‰§è¡ŒæˆåŠŸã€‚</span><br><span class="line">202 å‘½ä»¤æ‰§è¡Œå¤±è´¥ã€‚</span><br><span class="line">211 ç³»ç»ŸçŠ¶æ€æˆ–æ˜¯ç³»ç»Ÿæ±‚åŠ©å“åº”ã€‚</span><br><span class="line">212 ç›®å½•çš„çŠ¶æ€ã€‚</span><br><span class="line">213 æ–‡ä»¶çš„çŠ¶æ€ã€‚</span><br><span class="line">214 æ±‚åŠ©çš„è®¯æ¯ã€‚</span><br><span class="line">215 åç§°ç³»ç»Ÿç±»å‹ã€‚</span><br><span class="line">220 æ–°çš„è”æœºæœåŠ¡readyã€‚</span><br><span class="line">221 æœåŠ¡çš„æ§åˆ¶è¿æ¥ç«¯å£å…³é—­ï¼Œå¯ä»¥æ³¨é”€ã€‚</span><br><span class="line">225 æ•°æ®è¿ç»“å¼€å¯ï¼Œä½†æ— ä¼ è¾“åŠ¨ä½œã€‚</span><br><span class="line">226 å…³é—­æ•°æ®è¿æ¥ç«¯å£ï¼Œè¯·æ±‚çš„æ–‡ä»¶æ“ä½œæˆåŠŸã€‚</span><br><span class="line">227 è¿›å…¥passive modeã€‚</span><br><span class="line">230 ä½¿ç”¨è€…ç™»å…¥ã€‚</span><br><span class="line">250 è¯·æ±‚çš„æ–‡ä»¶æ“ä½œå®Œæˆã€‚</span><br><span class="line">257 æ˜¾ç¤ºç›®å‰çš„è·¯å¾„åç§°ã€‚</span><br><span class="line">331 ç”¨æˆ·åç§°æ­£ç¡®ï¼Œéœ€è¦å¯†ç ã€‚</span><br><span class="line">332 ç™»å…¥æ—¶éœ€è¦è´¦å·ä¿¡æ¯ã€‚</span><br><span class="line">350 è¯·æ±‚çš„æ“ä½œéœ€è¦è¿›ä¸€éƒ¨çš„å‘½ä»¤ã€‚</span><br><span class="line">421 æ— æ³•æä¾›æœåŠ¡ï¼Œå…³é—­æ§åˆ¶è¿ç»“ã€‚</span><br><span class="line">425 æ— æ³•å¼€å¯æ•°æ®é“¾è·¯ã€‚</span><br><span class="line">426 å…³é—­è”æœºï¼Œç»ˆæ­¢ä¼ è¾“ã€‚</span><br><span class="line">450 è¯·æ±‚çš„æ“ä½œæœªæ‰§è¡Œã€‚</span><br><span class="line">451 å‘½ä»¤ç»ˆæ­¢:æœ‰æœ¬åœ°çš„é”™è¯¯ã€‚</span><br><span class="line">452 æœªæ‰§è¡Œå‘½ä»¤:ç£ç›˜ç©ºé—´ä¸è¶³ã€‚</span><br><span class="line">500 æ ¼å¼é”™è¯¯ï¼Œæ— æ³•è¯†åˆ«å‘½ä»¤ã€‚</span><br><span class="line">501 å‚æ•°è¯­æ³•é”™è¯¯ã€‚</span><br><span class="line">502 å‘½ä»¤æ‰§è¡Œå¤±è´¥ã€‚</span><br><span class="line">503 å‘½ä»¤é¡ºåºé”™è¯¯ã€‚</span><br><span class="line">504 å‘½ä»¤æ‰€æ¥çš„å‚æ•°ä¸æ­£ç¡®ã€‚</span><br><span class="line">530 æœªç™»å…¥ã€‚</span><br><span class="line">532 å‚¨å­˜æ–‡ä»¶éœ€è¦è´¦æˆ·ç™»å…¥ã€‚</span><br><span class="line">550 æœªæ‰§è¡Œè¯·æ±‚çš„æ“ä½œã€‚</span><br><span class="line">551 è¯·æ±‚çš„å‘½ä»¤ç»ˆæ­¢ï¼Œç±»å‹æœªçŸ¥ã€‚</span><br><span class="line">552 è¯·æ±‚çš„æ–‡ä»¶ç»ˆæ­¢ï¼Œå‚¨å­˜ä½æº¢å‡ºã€‚  </span><br><span class="line">553 æœªæ‰§è¡Œè¯·æ±‚çš„çš„å‘½ä»¤ï¼Œåç§°ä¸æ­£ç¡®ã€‚</span><br></pre></td></tr></table></figure><h3 id="é¡¹ç›®å®è·µ"><a href="#é¡¹ç›®å®è·µ" class="headerlink" title="é¡¹ç›®å®è·µ"></a>é¡¹ç›®å®è·µ</h3><ol><li>è®¾ç½®vsftpdæœåŠ¡åŒ¿åç”¨æˆ·èƒ½å¤Ÿå¯¹/var/ftp/test/ç›®å½•æœ‰ä¸Šä¼ ä¸‹è½½çš„æƒé™ã€‚</li><li>ç³»ç»Ÿç”¨æˆ·èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œä¸Šä¼ ä¸‹è½½åˆ é™¤</li><li>é™¤äº†ç³»ç»Ÿç”¨æˆ·batmanæœ‰chrootçš„æƒé™ï¼Œå…¶ä»–ç³»ç»Ÿç”¨æˆ·æ²¡æœ‰chrootçš„æƒé™</li></ol><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><img src="pic/05.png" alt="05"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;è¯¾ç¨‹è¦æ±‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;è®¾ç½®vsftpdæœåŠ¡åŒ¿åç”¨æˆ·èƒ½å¤Ÿå¯¹/var/ftp/pub/ç›®å½•æœ‰ä¸Šä¼ ä¸‹è½½çš„æƒé™ã€‚&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿç”¨æˆ·èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œä¸Šä¼ ä¸‹è½½åˆ é™¤&lt;/li&gt;
&lt;li&gt;é™¤äº†ç³»ç»Ÿç”¨æˆ·student
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/Linux%E7%AE%80%E6%98%93%E6%9C%8D%E5%8A%A1%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="LinuxåŸºç¡€æœåŠ¡" scheme="http://www.toberoot.com/tags/Linux%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>NFSæ–‡ä»¶å…±äº«æœåŠ¡</title>
    <link href="http://www.toberoot.com/2016/12/23/booboo_easy_service/03_nfs/"/>
    <id>http://www.toberoot.com/2016/12/23/booboo_easy_service/03_nfs/</id>
    <published>2016-12-22T21:06:27.000Z</published>
    <updated>2020-03-24T05:02:31.709Z</updated>
    
    <content type="html"><![CDATA[<h3 id="NFSæ˜¯ä»€ä¹ˆ"><a href="#NFSæ˜¯ä»€ä¹ˆ" class="headerlink" title="NFSæ˜¯ä»€ä¹ˆ"></a>NFSæ˜¯ä»€ä¹ˆ</h3><p>NFSï¼ˆNetwork File Systemï¼‰å³ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ŒSUNå…¬å¸å¼€å‘çš„,æ˜¯FreeBSDæ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ç§ï¼Œå®ƒå…è®¸ç½‘ç»œä¸­çš„è®¡ç®—æœºä¹‹é—´é€šè¿‡TCP/IPç½‘ç»œå…±äº«èµ„æºã€‚åœ¨NFSçš„åº”ç”¨ä¸­ï¼Œæœ¬åœ°NFSçš„å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥é€æ˜åœ°è¯»å†™ä½äºè¿œç«¯NFSæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œå°±åƒè®¿é—®æœ¬åœ°æ–‡ä»¶ä¸€æ ·ã€‚</p><h3 id="NFSçš„åŸç†"><a href="#NFSçš„åŸç†" class="headerlink" title="NFSçš„åŸç†"></a>NFSçš„åŸç†</h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä¸¤ä¸ªå®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å¯ä»¥å°†ç½‘ç»œä¸­çš„NFSæœåŠ¡å™¨å…±äº«çš„ç›®å½•æŒ‚è½½åˆ°æœ¬åœ°ç«¯çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè€Œåœ¨æœ¬åœ°ç«¯çš„ç³»ç»Ÿä¸­çœ‹æ¥ï¼Œé‚£ä¸ªè¿œç¨‹ä¸»æœºçš„ç›®å½•å°±å¥½åƒè‡ªå·±çš„ä¸€ä¸ªç£ç›˜åˆ†åŒºä¸€æ ·ã€‚</p><p>æ¯”å¦‚å°†é…ç½®å¥½çš„NFSæœåŠ¡å™¨ä¸Šçš„<code>/var/share/student1</code>ç›®å½•æŒ‚åœ¨åˆ°Aå®¢æˆ·ç«¯çš„<code>/home/share/student1</code>ä¸Šé¢ï¼Œé‚£åœ¨å®¢æˆ·ç«¯Aä¸Šé¢è¿›å…¥<code>/home/share/student1</code>å†…ï¼Œå°±å¯ä»¥çœ‹åˆ°NFSæœåŠ¡å™¨ç³»ç»Ÿä¸­<code>/var/share/student1</code>ç›®å½•ä¸‹æ‰€æœ‰çš„å†…å®¹äº†ï¼Œå¹¶ä¸”å¯ä»¥æ‰§è¡Œ<code>cdï¼Œcpï¼Œmvï¼Œrm</code>ç­‰å‘½ä»¤ã€‚å½“ç„¶ï¼Œæƒé™è¦è¶³å¤Ÿã€‚è¿™ä¸ª<code>/var/share/student1</code>å°±å¥½åƒNFSå®¢æˆ·ç«¯çš„ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸€æ ·ã€‚æ‰€ä»¥ï¼ŒNFSä¹Ÿå¯ä»¥ç®€å•çš„çœ‹åšæ˜¯ä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨ï¼ˆfile systemï¼‰</p><p>åªè¦æƒé™è¶³å¤Ÿï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥å¯¹è¯¥ç›®å½•ä¸‹çš„å†…å®¹è¿›è¡Œè¯»å†™æ“ä½œç­‰ç­‰ã€‚</p><p><strong>NFSæŒ‡çš„æ˜¯ä¸€ç§æœåŠ¡</strong> æ—¢ç„¶æ˜¯æœåŠ¡ï¼Œè‚¯å®šä¼šç”¨åˆ°ä¸€äº›ç›‘å¬ç«¯å£ï¼Œé‚£NFSç”¨çš„æ˜¯ä»€ä¹ˆç«¯å£è¿›è¡Œæ•°æ®ä¼ è¾“çš„ï¼Ÿæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œè°éƒ½ä¸çŸ¥é“ã€‚åŸºæœ¬ä¸ŠNFSè¿™ä¸ªæœåŠ¡çš„ç«¯å£å¼€åœ¨2049ç«¯å£ï¼Œä½†ç”±äºæ–‡ä»¶ç³»ç»Ÿéå¸¸å¤æ‚ï¼ŒNFSæ”¯æŒçš„åŠŸèƒ½åˆç›¸å½“çš„å¤šï¼Œæ¯ä¸€ä¸ªåŠŸèƒ½å°±ä¼šå¯ç”¨ä¸€äº›ç«¯å£æ¥ä¼ è¾“æ•°æ®ï¼Œæ‰€ä»¥ï¼ŒNFSéœ€è¦è°ƒç”¨é¢å¤–çš„ç«¯å£ï¼Œé‚£é¢å¤–çš„ç«¯å£å·åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé¢å¤–çš„ç«¯å£å·å¹¶ä¸å›ºå®šã€‚å› ä¸ºNFSé»˜è®¤ä¼ è¾“çš„ç«¯å£æ˜¯éšæœºå–ç”¨æœªè¢«ä½¿ç”¨çš„å°äº1024çš„ç«¯å£ç”¨äºä¼ è¾“ã€‚ä½†å¦‚æ­¤ä¸€æ¥ï¼Œå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨åˆæˆäº†é—®é¢˜ï¼Œå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“æˆ‘è¦é“¾æ¥é‚£äº›ç«¯å£ã€‚è¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨RPCæœåŠ¡äº† remote procedure callã€‚</p><p>RPCå°±æ˜¯æŒ‡å®šNFSå„åŠŸèƒ½å¯¹åº”çš„ç«¯å£å·ï¼Œç„¶åé€šçŸ¥ç»™å®¢æˆ·ç«¯ï¼Œè®©å®¢æˆ·ç«¯å¯ä»¥è¿æ¥åˆ°æ­£ç¡®çš„ç«¯å£ä¸Šã€‚</p><p><img src="pic/20.png" alt="20"></p><p>å¯¹äºæœåŠ¡ç«¯æ¥è¯´ï¼Œåœ¨NFSå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å‘RPCæ³¨å†Œå…¶å„ä¸ªåŠŸèƒ½æ‰€éœ€è¦çš„éšæœºç«¯å£å·ï¼Œè®©RPCäº†è§£NFSå„é¡¹åŠŸèƒ½çš„ç«¯å£å·ï¼ŒPIDï¼ŒNFSæ‰€ç›‘å¬çš„IPç­‰ç­‰ã€‚å½“å®¢æˆ·ç«¯é€šè¿‡111ç«¯å£å·å‘serverç«¯RPCå‘å‡ºNFSè®¿é—®è¯·æ±‚æ—¶å€™ï¼ŒRPCå°±ä¼šæ‰¾åˆ°å¯¹åº”å·²æ³¨å†Œçš„ç«¯å£å·ï¼Œå¹¶è¿”è¿˜ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥é€šè¿‡è¿™äº›ç«¯å£å·ä¸NFSå‘èµ·é“¾æ¥ã€‚æ¯”å¦‚è¯´æˆ‘æ˜¯NFSï¼Œæˆ‘åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šå‘Šè¯‰RPCï¼Œæˆ‘çš„Aç«¯å£ç”¨äºåšä»€ä¹ˆäº‹æƒ…ï¼Œæˆ‘çš„Bç«¯å£ç”¨äºåšä»€ä¹ˆäº‹æƒ…ï¼ŒRPCå°±ä¼šå°†å…¶ç«¯å£æ³¨å†Œä¿¡æ¯ç™»è®°ï¼Œç­‰å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥æ‰¾åˆ°RPCï¼Œè€Œä¸æ˜¯ç›´æ¥æ‰¾æˆ‘NFSï¼ŒRPCå¯ä»¥ç›´æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯æ‰€éœ€è¯·æ±‚å¯¹åº”çš„æ­£ç¡®çš„ç«¯å£å·ã€‚</p><p>å½“å®¢æˆ·ç«¯æ‰§è¡Œæ“ä½œæ–‡ä»¶ç³»ç»Ÿçš„å„é¡¹å‘½ä»¤æ—¶å€™ï¼Œä¼šè½¬äº¤ç»™å®¢æˆ·ç«¯çš„RPCï¼Œå®¢æˆ·ç«¯RPCè´Ÿè´£æ¥å—å„ä¸ªç¨‹åºä¸å¯¹åº”çš„ç«¯å£åè´Ÿè´£å¯¹ä¸»æœºè¿›è¡Œè§£æã€‚æ‰€ä»¥è¦ä½¿ç”¨NFSæ—¶ï¼Œæ— è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯ï¼Œéƒ½éœ€è¦å¯åŠ¨RPCã€‚</p><p>å¯åŠ¨NFSä¹‹å‰ï¼ŒRPCå°±è¦å…ˆå¯åŠ¨äº†ï¼Œä¸ç„¶NFSæ— æ³•å‘RPCæ³¨å†Œï¼Œå¹¶ä¸”ï¼ŒRPCé‡å¯ä»¥åï¼ŒåŸæ¥æ³¨å†Œçš„æ•°æ®å°±æ²¡æœ‰äº†ï¼Œæ‰€ä»¥RPCé‡æ–°å¯åŠ¨åï¼ŒNFSä¹Ÿè¦é‡å¯ï¼Œé‡æ–°æƒ³RPCæ³¨å†Œæ‰è¡Œã€‚</p><p>åŒæ ·ï¼ŒAå®¢æˆ·ç«¯å¯¹NFSæœåŠ¡å™¨ä¸Šçš„å…±äº«æ–‡ä»¶è¿›è¡Œäº†ä¿®æ”¹åï¼ŒBæœåŠ¡å™¨èƒ½çœ‹åˆ°æ”¹åçš„æ–‡ä»¶ï¼Œä¹Ÿå°±å®Œæˆäº†å„ä¸ªä¸»æœºä¹‹é—´æ–‡ä»¶çš„å…±äº«ã€‚æ‰€ä»¥å¦‚æœé‡å¯äº†rpcï¼Œnfsä¹Ÿå¿…é¡»è¦é‡æ–°å¯åŠ¨ï¼Œä»¥ä¾¿äºé‡æ–°åƒrpcæ³¨å†Œç›¸åº”çš„ç«¯å£å·ã€‚</p><ul><li>NFSï¼šå¤„ç†å®¢æˆ·ç«¯æ•°æ®è¯·æ±‚ï¼Œ</li><li>RPCï¼šå¤„ç†å®¢æˆ·ç«¯é“¾æ¥è¯·æ±‚ã€‚</li></ul><h3 id="NFSçš„ç”¨å¤„"><a href="#NFSçš„ç”¨å¤„" class="headerlink" title="NFSçš„ç”¨å¤„"></a>NFSçš„ç”¨å¤„</h3><ul><li>å­˜å‚¨å…±äº«æ–¹æ¡ˆ</li><li>ç½‘ç»œå…±äº«æ–‡ä»¶ç³»ç»Ÿ</li></ul><h3 id="é¡¹ç›®å®è·µ1ï¼šé…ç½®NFSç½‘ç»œå…±äº«æ–‡ä»¶æœåŠ¡å™¨"><a href="#é¡¹ç›®å®è·µ1ï¼šé…ç½®NFSç½‘ç»œå…±äº«æ–‡ä»¶æœåŠ¡å™¨" class="headerlink" title="é¡¹ç›®å®è·µ1ï¼šé…ç½®NFSç½‘ç»œå…±äº«æ–‡ä»¶æœåŠ¡å™¨"></a>é¡¹ç›®å®è·µ1ï¼šé…ç½®NFSç½‘ç»œå…±äº«æ–‡ä»¶æœåŠ¡å™¨</h3><p>è¦æ±‚rhel7 172.25.X.10 ä½œä¸ºNFSç½‘ç»œå…±äº«æ–‡ä»¶æœåŠ¡å™¨ï¼š</p><ol><li>å…è®¸172.25.X.11è¿™ä¸ªå®¢æˆ·ç«¯æ¥æŒ‚æ¥ä½¿ç”¨/tmpç›®å½•ï¼Œæœ‰è¯»å†™æƒé™ã€‚</li><li>å°†è¯»å†™æƒé™æ”¹æˆåªè¯»æƒé™ï¼›(ro)</li><li>å…è®¸172.25.X.0/24ç½‘æ®µæŒ‚æ¥/tmpç›®å½•ï¼Œæœ‰è¯»å†™æƒé™ï¼›</li><li>æœåŠ¡å™¨ä¸Šåˆ›å»ºuid=1200çš„ç”¨æˆ·tomï¼Œå¹¶ä½¿ç”¨tomç”¨æˆ·åˆ›å»º/tmp/tomfileï¼›åœ¨å®¢æˆ·ç«¯åˆ›å»ºuid=1200çš„ç”¨æˆ·jackï¼Œå°è¯•å»åˆ é™¤tomfileç›®å½•;</li><li>ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨(rw,no_root_squash)</li></ol><h5 id="å®éªŒå‡†å¤‡é˜¶æ®µ"><a href="#å®éªŒå‡†å¤‡é˜¶æ®µ" class="headerlink" title="å®éªŒå‡†å¤‡é˜¶æ®µ"></a>å®éªŒå‡†å¤‡é˜¶æ®µ</h5><ol><li>ç½‘ç»œæ‹“æ‰‘å›¾</li><li>è§„åˆ’è½¯ä»¶å®‰è£…</li><li>ä¿®æ”¹é…ç½®æ–‡ä»¶</li><li>å¯åŠ¨æœåŠ¡</li><li>å®¢æˆ·ç«¯æµ‹è¯•æœåŠ¡        </li></ol><blockquote><p>ç½‘ç»œæ‹“æ‰‘å›¾</p></blockquote><p><img src="pic/12.png" alt="12"></p><blockquote><p>è§„åˆ’è½¯ä»¶å®‰è£…</p></blockquote><table><thead><tr><th align="left">ä¸»æœºå</th><th align="left">ipåœ°å€</th><th align="left">è½¯ä»¶</th><th align="left">åŠŸèƒ½</th></tr></thead><tbody><tr><td align="left">rhel6</td><td align="left">172.25.0.11</td><td align="left">rpcbind nfs-utils</td><td align="left">æœåŠ¡ç«¯</td></tr><tr><td align="left">rhel7</td><td align="left">172.25.0.10</td><td align="left">rpcbind nfs-utils</td><td align="left">å®¢æˆ·ç«¯</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# yum install -y nfs-utils rpcbind</span><br><span class="line">Loaded plugins: product-id, refresh-packagekit, security, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">server                                                                                    | 3.9 kB     00:00     </span><br><span class="line">server/primary_db                                                                         | 3.1 MB     00:00     </span><br><span class="line">Setting up Install Process</span><br><span class="line">Package 1:nfs-utils-1.2.3-39.el6.x86_64 already installed and latest version</span><br><span class="line">Package rpcbind-0.2.0-11.el6.x86_64 already installed and latest version</span><br><span class="line">Nothing to do</span><br></pre></td></tr></table></figure><p>rpcbind</p><ul><li>rpc:ç®¡ç†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ipå’Œç«¯å£å·â€”è¿æ¥</li><li>remote    procedure callâ€”â€”è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®</li></ul><p>nfs-utils</p><ul><li>nfs:ä¼ è¾“æ•°æ®</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# rpm -qf /etc/exports</span><br><span class="line">setup-2.8.14-20.el6_4.1.noarch</span><br><span class="line">[root@rhel6 ~]# rpm -ql rpcbind</span><br><span class="line">/etc/rc.d/init.d/rpcbind</span><br><span class="line">/sbin/rpcbind</span><br><span class="line">/usr/sbin/rpcinfo</span><br><span class="line">/usr/share/doc/rpcbind-0.2.0</span><br><span class="line">/usr/share/doc/rpcbind-0.2.0/AUTHORS</span><br><span class="line">/usr/share/doc/rpcbind-0.2.0/ChangeLog</span><br><span class="line">/usr/share/doc/rpcbind-0.2.0/README</span><br><span class="line">/usr/share/man/man8/rpcbind.8.gz</span><br><span class="line">/usr/share/man/man8/rpcinfo.8.gz</span><br><span class="line">/var/cache/rpcbind</span><br><span class="line">[root@rhel6 ~]# rpm -ql nfs-utils</span><br><span class="line">/etc/nfsmount.conf</span><br><span class="line">/etc/rc.d/init.d/nfs</span><br><span class="line">/etc/rc.d/init.d/nfslock</span><br><span class="line">/etc/rc.d/init.d/rpcgssd</span><br><span class="line">/etc/rc.d/init.d/rpcidmapd</span><br><span class="line">/etc/rc.d/init.d/rpcsvcgssd</span><br><span class="line">/etc/request-key.d/id_resolver.conf</span><br><span class="line">/etc/sysconfig/nfs</span><br><span class="line">/sbin/mount.nfs</span><br><span class="line">/sbin/mount.nfs4</span><br><span class="line">/sbin/nfs_cache_getent</span><br><span class="line">/sbin/rpc.statd</span><br><span class="line">/sbin/umount.nfs</span><br><span class="line">/sbin/umount.nfs4</span><br><span class="line">/usr/sbin/exportfs</span><br><span class="line">/usr/sbin/mountstats</span><br><span class="line">/usr/sbin/nfsidmap</span><br><span class="line">/usr/sbin/nfsiostat</span><br><span class="line">/usr/sbin/nfsstat</span><br><span class="line">/usr/sbin/rpc.gssd</span><br><span class="line">/usr/sbin/rpc.idmapd</span><br><span class="line">/usr/sbin/rpc.mountd</span><br><span class="line">/usr/sbin/rpc.nfsd</span><br><span class="line">/usr/sbin/rpc.svcgssd</span><br><span class="line">/usr/sbin/rpcdebug</span><br><span class="line">/usr/sbin/showmount</span><br><span class="line">/usr/sbin/sm-notify</span><br><span class="line">/usr/sbin/start-statd</span><br><span class="line">/usr/share/doc/n7/nfsd.7.gz</span><br><span class="line">... ...</span><br><span class="line">/var/lib/nfs</span><br><span class="line">/var/lib/nfs/etab</span><br><span class="line">/var/lib/nfs/rmtab</span><br><span class="line">/var/lib/nfs/rpc_pipefs</span><br><span class="line">/var/lib/nfs/statd</span><br><span class="line">/var/lib/nfs/statd/sm</span><br><span class="line">/var/lib/nfs/statd/sm.bak</span><br><span class="line">/var/lib/nfs/state</span><br><span class="line">/var/lib/nfs/v4recovery</span><br><span class="line">/var/lib/nfs/xtab</span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p></blockquote><p><strong>ä¸»é…ç½®æ–‡ä»¶</strong> <code>/etc/exports</code></p><p><strong>æœåŠ¡å</strong> <code>rpcbind</code> <code>nfs</code></p><p>æ ¹æ®è¦æ±‚ï¼Œå…è®¸172.25.X.10è¿™ä¸ªå®¢æˆ·ç«¯æ¥æŒ‚æ¥ä½¿ç”¨/tmpç›®å½•ï¼Œæœ‰è¯»å†™æƒé™ã€‚é…ç½®<code>/etc/exports</code>å†…å®¹ä¸º<code>/tmp 172.25.0.10(rw)</code>åï¼Œæ ¹æ®æœåŠ¡åæ¥æ‰“å¼€ç›¸åº”çš„æœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# vim /etc/exports</span><br><span class="line">[root@rhel6 ~]# cat /etc/exports</span><br><span class="line">/tmp 172.25.0.10(rw)</span><br></pre></td></tr></table></figure><blockquote><p>å¯åŠ¨æœåŠ¡</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# service rpcbind start</span><br><span class="line">[root@rhel6 ~]# service nfs start</span><br><span class="line">Starting NFS services:                                     [  OK  ]</span><br><span class="line">Starting NFS quotas:                                       [  OK  ]</span><br><span class="line">Starting NFS mountd:                                       [  OK  ]</span><br><span class="line">Starting NFS daemon:                                       [  OK  ]</span><br><span class="line">Starting RPC idmapd:                                       [  OK  ]</span><br><span class="line">[root@rhel6 ~]# netstat -luntp |grep rpcbind</span><br><span class="line">tcp        0      0 0.0.0.0:111                 0.0.0.0:*                   LISTEN      1174/rpcbind        </span><br><span class="line">tcp        0      0 :::111                      :::*                        LISTEN      1174/rpcbind        </span><br><span class="line">udp        0      0 0.0.0.0:111                 0.0.0.0:*                               1174/rpcbind        </span><br><span class="line">udp        0      0 0.0.0.0:925                 0.0.0.0:*                               1174/rpcbind        </span><br><span class="line">udp        0      0 :::111                      :::*                                    1174/rpcbind        </span><br><span class="line">udp        0      0 :::925                      :::*                                    1174/rpcbind        </span><br><span class="line">[root@rhel6 ~]# netstat -luntp |grep nfs</span><br><span class="line">[root@rhel6 ~]# ps -ef|grep nfs</span><br><span class="line">root      1888     2  0 15:20 ?        00:00:00 [nfsd4]</span><br><span class="line">root      1889     2  0 15:20 ?        00:00:00 [nfsd4_callbacks]</span><br><span class="line">root      1890     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1891     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1892     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1893     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1894     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1895     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1896     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1897     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1928  1745  0 15:20 pts/0    00:00:00 grep nfs</span><br><span class="line">[root@rhel6 ~]# service iptables stop</span><br><span class="line">iptables: Setting chains to policy ACCEPT: filter          [  OK  ]</span><br><span class="line">iptables: Flushing firewall rules:                         [  OK  ]</span><br><span class="line">iptables: Unloading modules:                               [  OK  ]</span><br></pre></td></tr></table></figure><p><strong>å®ˆæŠ¤è¿›ç¨‹daemon</strong> <code>rpcbind</code> <code>nfsd</code></p><p><strong>ç›‘å¬ç«¯å£å·</strong> 111 925</p><blockquote><p>å®¢æˆ·ç«¯æµ‹è¯•ä½¿ç”¨</p></blockquote><p>æŸ¥çœ‹æœåŠ¡å™¨å…±äº«ç›®å½•çš„æƒ…å†µ <code>showmount -e 172.25.0.11</code></p><p>è¿œç¨‹æŒ‚è½½ <code>mount 172.25.0.10:/tmp /mnt</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# yum install -y nfs-utils rpcbind</span><br><span class="line">Loaded plugins: langpacks, product-id, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Package 1:nfs-utils-1.3.0-0.el7.x86_64 already installed and latest version</span><br><span class="line">Package rpcbind-0.2.0-23.el7.x86_64 already installed and latest version</span><br><span class="line">Nothing to do</span><br><span class="line">[root@rhel7 ~]# showmount -e 172.25.0.11</span><br><span class="line">Export list for 172.25.0.11:</span><br><span class="line">/tmp 172.25.0.10</span><br><span class="line">[root@rhel7 ~]# mount 172.25.0.11:/tmp /mnt</span><br><span class="line">[root@rhel7 ~]# mount |tail -n 1</span><br><span class="line">172.25.0.11:/tmp on /mnt type nfs4 (rw,relatime,vers=4.0,rsize=131072,wsize=131072,namlen=255,hard,proto=tcp,port=0,timeo=600,retrans=2,sec=sys,clientaddr=172.25.0.10,local_lock=none,addr=172.25.0.11)</span><br><span class="line">[root@rhel7 mnt]# touch rhel7test</span><br><span class="line">[root@rhel7 mnt]# ll</span><br><span class="line">total 12</span><br><span class="line">drwx------. 2 gdm       gdm       4096 Sep 25 02:59 orbit-gdm</span><br><span class="line">drwx------. 2 root      root      4096 Jul  2  2015 pulse-oCBy0hGD1JT6</span><br><span class="line">drwx------. 2 gdm       gdm       4096 Sep 25 02:59 pulse-q5sECpImz7Ju</span><br><span class="line">-rw-r--r--. 1 nfsnobody nfsnobody    0 Sep 25  2016 rhel7test</span><br><span class="line">[root@rhel7 mnt]# cd</span><br><span class="line">[root@rhel7 ~]# umount /mnt</span><br></pre></td></tr></table></figure><p><strong>nfsnobody</strong> ä»¥ root ç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶è¢«æ˜ å°„æˆ nfsnobody ç”¨æˆ· , å› ä¸ºåœ¨æœåŠ¡å™¨ä¸Šæ²¡æœ‰æŒ‡å®š no_root_squash</p><blockquote><p>å°†è¯»å†™æƒé™æ”¹æˆåªè¯»æƒé™ï¼›(ro)</p></blockquote><p>æœåŠ¡å™¨ç«¯ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# vim /etc/exports</span><br><span class="line">[root@rhel6 ~]# cat /etc/exports</span><br><span class="line">/tmp 172.25.0.10(ro)</span><br><span class="line">[root@rhel6 ~]# service rpcbind restart</span><br><span class="line">Stopping rpcbind:                                          [  OK  ]</span><br><span class="line">Starting rpcbind:                                          [  OK  ]</span><br><span class="line">[root@rhel6 ~]# service nfs restart</span><br><span class="line">Shutting down NFS daemon:                                  [  OK  ]</span><br><span class="line">Shutting down NFS mountd:                                  [  OK  ]</span><br><span class="line">Shutting down NFS quotas:                                  [  OK  ]</span><br><span class="line">Shutting down NFS services:                                [  OK  ]</span><br><span class="line">Shutting down RPC idmapd:                                  [  OK  ]</span><br><span class="line">Starting NFS services:                                     [  OK  ]</span><br><span class="line">Starting NFS quotas:                                       [  OK  ]</span><br><span class="line">Starting NFS mountd:                                       [  OK  ]</span><br><span class="line">Starting NFS daemon:                                       [  OK  ]</span><br><span class="line">Starting RPC idmapd:                                       [  OK  ]</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯rhel7</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# mount 172.25.0.11:/tmp /mnt</span><br><span class="line">[root@rhel7 ~]# touch /mnt/rhel7test2</span><br><span class="line">touch: cannot touch â€˜/mnt/rhel7test2â€™: Read-only file system</span><br><span class="line">[root@rhel7 ~]# umount /mnt</span><br></pre></td></tr></table></figure><blockquote><p>å…è®¸172.25.X.0/24ç½‘æ®µæŒ‚æ¥/tmpç›®å½•ï¼Œæœ‰è¯»å†™æƒé™ï¼›</p></blockquote><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸º <code>/tmp 172.25.0.0/24(rw)</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# vim /etc/exports</span><br><span class="line">[root@rhel6 ~]# cat /etc/exports</span><br><span class="line">/tmp 172.25.0.0/24(rw)</span><br><span class="line">[root@rhel6 ~]# service rpcbind restart</span><br><span class="line">Stopping rpcbind:                                          [  OK  ]</span><br><span class="line">Starting rpcbind:                                          [  OK  ]</span><br><span class="line">[root@rhel6 ~]# service nfs restart</span><br><span class="line">Shutting down NFS daemon:                                  [  OK  ]</span><br><span class="line">Shutting down NFS mountd:                                  [  OK  ]</span><br><span class="line">Shutting down NFS quotas:                                  [  OK  ]</span><br><span class="line">Shutting down NFS services:                                [  OK  ]</span><br><span class="line">Shutting down RPC idmapd:                                  [  OK  ]</span><br><span class="line">Starting NFS services:                                     [  OK  ]</span><br><span class="line">Starting NFS quotas:                                       [  OK  ]</span><br><span class="line">Starting NFS mountd:                                       [  OK  ]</span><br><span class="line">Starting NFS daemon:                                       [  OK  ]</span><br><span class="line">Starting RPC idmapd:                                       [  OK  ]</span><br></pre></td></tr></table></figure><blockquote><p>åˆ†åˆ«åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šéƒ½åˆ›å»ºä¸€ä¸ªid=1200çš„ç”¨æˆ·tomï¼Œåœ¨å®¢æˆ·ç«¯ç”¨tomç”¨æˆ·æ–°å»ºä¸€ä¸ªæ–‡ä»¶rhel7tomfileï¼Œå¹¶æŸ¥çœ‹å±æ€§ï¼Œå†åˆ°æœåŠ¡å™¨ä¸Šå»æŸ¥çœ‹è¯¥æ–‡ä»¶çš„å±æ€§ï¼›åœ¨æœåŠ¡å™¨ä¸Šç”¨tomç”¨æˆ·å»åˆ›å»ºrhel6tomfileï¼ŒæŸ¥çœ‹å±æ€§ï¼Œå†åˆ°å®¢æˆ·ç«¯ä¸ŠæŸ¥çœ‹å±æ€§ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡ç«¯rhel6</span></span><br><span class="line">[root@rhel6 ~]# useradd -u 1200 tom</span><br><span class="line">[root@rhel6 ~]# echo uplooking|passwd --stdin tom</span><br><span class="line">Changing password for user tom.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">[root@rhel6 ~]# su - tom</span><br><span class="line">[tom@rhel6 ~]$ touch /tmp/tomfile</span><br><span class="line">[tom@rhel6 ~]$ ll /tmp/tomfile</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Sep 25 15:55 /tmp/tomfile</span><br><span class="line">[tom@rhel6 tmp]$ touch rhel6tomfile</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯rhel7</span></span><br><span class="line">[tom@rhel7 mnt]$ touch rhel7tomfile</span><br><span class="line">[tom@rhel7 mnt]$ ll</span><br><span class="line">total 12</span><br><span class="line">-rw-rw-r--. 1 nobody nobody    0 Sep 25 04:03 4913</span><br><span class="line">drwx------. 2 gdm    gdm    4096 Sep 25 02:59 orbit-gdm</span><br><span class="line">drwx------. 2 root   root   4096 Jul  2  2015 pulse-oCBy0hGD1JT6</span><br><span class="line">drwx------. 2 gdm    gdm    4096 Sep 25 02:59 pulse-q5sECpImz7Ju</span><br><span class="line">-rw-rw-r--. 1 nobody nobody    0 Sep 25 04:07 rhel7tomfile</span><br><span class="line">-rw-rw-r--. 1 nobody nobody    0 Sep 25 04:06 tomfile</span><br><span class="line">[tom@rhel7 mnt]$ rm -rf rhel7tomfile</span><br><span class="line">rm: cannot remove â€˜rhel7tomfileâ€™: Operation not permitted</span><br><span class="line">[tom@rhel7 mnt]$ rm -rf rhel6tomfile</span><br><span class="line">rm: cannot remove â€˜rhel6tomfileâ€™: Operation not permitted</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡ç«¯rhel6</span></span><br><span class="line">[tom@rhel6 tmp]$ ll</span><br><span class="line">total 12</span><br><span class="line">-rw-rw-r--. 1 tom  tom     0 Sep 25 16:03 4913</span><br><span class="line">drwx------. 2 gdm  gdm  4096 Sep 25 14:59 orbit-gdm</span><br><span class="line">drwx------. 2 root root 4096 Jul  2  2015 pulse-oCBy0hGD1JT6</span><br><span class="line">drwx------. 2 gdm  gdm  4096 Sep 25 14:59 pulse-q5sECpImz7Ju</span><br><span class="line">-rw-rw-r--. 1 tom  tom     0 Sep 25 16:10 rhel6tomfile</span><br><span class="line">-rw-rw-r--. 1 tom  tom     0 Sep 25 16:07 rhel7tomfile</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªæ–°æ–‡ä»¶åœ¨å®¢æˆ·ç«¯å‡æ˜¾ç¤ºå±äºnobodyï¼Œè€Œåœ¨æœåŠ¡å™¨ç«¯æ˜¾ç¤ºå±äºtomç”¨æˆ·ï¼Œå¹¶ä¸”ä¼šå‘ç°åœ¨å®¢æˆ·ç«¯ç”±tomç”¨æˆ·åˆ›å»ºå‡ºæ¥çš„æ–‡ä»¶ä¹Ÿæ²¡æœ‰åŠæ³•åˆ é™¤ã€‚</p><p>è¿™æ˜¯ç”±äºå½“å‰æœåŠ¡å™¨ç‰ˆæœ¬æ¯”å®¢æˆ·ç«¯ä½çš„ç¼˜æ•…ã€‚</p><p>å¦‚æœå°†rhel7ä½œä¸ºæœåŠ¡ç«¯ï¼Œrhel6ä½œä¸ºå®¢æˆ·ç«¯ï¼Œå°±ä¸ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜äº†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><table><thead><tr><th align="left">ä¸»æœºå</th><th align="left">ipåœ°å€</th><th align="left">è½¯ä»¶</th><th align="left">åŠŸèƒ½</th></tr></thead><tbody><tr><td align="left">rhel6</td><td align="left">172.25.0.11</td><td align="left">rpcbind nfs-utils</td><td align="left">å®¢æˆ·ç«¯</td></tr><tr><td align="left">rhel7</td><td align="left">172.25.0.10</td><td align="left">rpcbind nfs-utils</td><td align="left">æœåŠ¡ç«¯</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡ç«¯rhel7</span></span><br><span class="line">[root@rhel7 ~]# vim /etc/exports</span><br><span class="line">[root@rhel7 ~]# systemctl stop firewalld</span><br><span class="line">[root@rhel7 ~]# systemctl start rpcbind</span><br><span class="line">[root@rhel7 ~]# systemctl start nfs</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯rhel6</span></span><br><span class="line">[root@rhel6 tmp]# mount 172.25.0.10:/tmp /mnt</span><br><span class="line">[root@rhel6 tmp]# cd /mnt</span><br><span class="line">[tom@rhel6 mnt]$ touch rhel6tomfile</span><br><span class="line">[tom@rhel6 mnt]$ ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 tom  tom   0 Sep 25 16:22 rhel6tomfile</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:58 systemd-private-jFcaMN</span><br><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡ç«¯rhel7</span></span><br><span class="line">[tom@rhel7 tmp]$ touch rhel7tomfile</span><br><span class="line">[tom@rhel7 tmp]$ ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 tom  tom   0 Sep 25 04:22 rhel6tomfile</span><br><span class="line">-rw-rw-r--. 1 tom  tom   0 Sep 25 04:24 rhel7tomfile</span><br><span class="line">drwx------. 3 root root 16 Sep 25 02:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 02:58 systemd-private-jFcaMN</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯rhel6</span></span><br><span class="line">[tom@rhel6 mnt]$ ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 tom  tom   0 Sep 25 16:22 rhel6tomfile</span><br><span class="line">-rw-rw-r--. 1 tom  tom   0 Sep 25 16:24 rhel7tomfile</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:58 systemd-private-jFcaMN</span><br><span class="line">[tom@rhel6 mnt]$ rm -rf rhel6tomfile</span><br><span class="line">[tom@rhel6 mnt]$ rm -rf rhel7tomfile</span><br><span class="line">[tom@rhel6 mnt]$ ll</span><br><span class="line">total 0</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:58 systemd-private-jFcaMN</span><br></pre></td></tr></table></figure><p><strong>æ–‡ä»¶æ‰€å±è€…å’Œæ‰€å±ç»„æ˜¯æ ¹æ®uidå’Œgidæ¥åŒ¹é…çš„ã€‚</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡å™¨rhel7</span></span><br><span class="line">[root@rhel7 ~]# useradd -u 1003 batman</span><br><span class="line">[root@rhel7 ~]# echo uplooking|passwd --stdin batman</span><br><span class="line">Changing password for user batman.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">[root@rhel7 ~]# id batman</span><br><span class="line">uid=1003(batman) gid=1003(batman) groups=1003(batman)</span><br><span class="line">[root@rhel7 ~]# su batman</span><br><span class="line">[batman@rhel7 root]$ cd /tmp</span><br><span class="line">[batman@rhel7 tmp]$ ll</span><br><span class="line">total 0</span><br><span class="line">drwx------. 3 root root 16 Sep 25 02:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 02:58 systemd-private-jFcaMN</span><br><span class="line">[batman@rhel7 tmp]$ touch rhel7batmanfile</span><br><span class="line">[batman@rhel7 tmp]$ ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 batman batman  0 Sep 25 04:27 rhel7batmanfile</span><br><span class="line">drwx------. 3 root   root   16 Sep 25 02:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root   root   16 Sep 25 02:58 systemd-private-jFcaMN</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rhel6 mnt]# ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 1003 1003  0 Sep 25 16:27 rhel7batmanfile</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:58 systemd-private-jFcaMN</span><br><span class="line">[root@rhel6 mnt]# useradd -u 1003 superman</span><br><span class="line">[root@rhel6 mnt]# echo uplooking|passwd --stdin superman</span><br><span class="line">Changing password for user superman.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">[root@rhel6 mnt]# ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 superman superman  0 Sep 25 16:27 rhel7batmanfile</span><br><span class="line">drwx------. 3 root     root     16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root     root     16 Sep 25 14:58 systemd-private-jFcaMN</span><br><span class="line">[root@rhel6 mnt]# su  superman</span><br><span class="line">[superman@rhel6 mnt]$ ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 superman superman  0 Sep 25 16:27 rhel7batmanfile</span><br><span class="line">drwx------. 3 root     root     16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root     root     16 Sep 25 14:58 systemd-private-jFcaMN</span><br><span class="line">[superman@rhel6 mnt]$ rm -rf rhel7batmanfile</span><br><span class="line">[superman@rhel6 mnt]$ ll</span><br><span class="line">total 0</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:58 systemd-private-jFcaMN</span><br></pre></td></tr></table></figure><p>åœ¨æœåŠ¡å™¨ä¸Šä»¥ batman ç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶è¢«æ˜ å°„æˆå®¢æˆ·ç«¯çš„ superman ç”¨æˆ· , å› ä¸ºåœ¨æœåŠ¡å™¨ä¸Š batman çš„ id ä¸ superman çš„ id ç›¸åŒ</p><blockquote><p>ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨(rw,no_root_squash)</p></blockquote><p><strong>é¢è¯•é¢˜</strong></p><ol><li>å®¢æˆ·è¯´ä¸ºä»€ä¹ˆæˆ‘æ˜¯rootï¼Œå´ä¸èƒ½åˆ é™¤rootçš„æ–‡ä»¶å‘¢ï¼ˆå‰ææ˜¯è¯¥æ–‡ä»¶æ˜¯nfsæœåŠ¡æŒ‚æ¥ä½¿ç”¨çš„ï¼‰ï¼Ÿ</li></ol><ul><li>1ï¼‰è€ƒè™‘åˆ°å®‰å…¨ï¼Œå½“å‰æˆ‘ä»¬nfsçš„é…ç½®ä¸­å°±è®¾ç½®ä¸ºæœ¬åœ°çš„rootç”¨æˆ·æ˜¯æ²¡æœ‰æƒé™åˆ é™¤æœåŠ¡å™¨ç«¯çš„rootç”¨æˆ·æ–‡ä»¶çš„ã€‚</li><li>2ï¼‰å¦‚æœå®¢æˆ·ä½ ä¸€å®šè¦å»æœ‰è¿™ä¸ªæƒé™ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä¿®æ”¹é…ç½®ï¼Œæ·»åŠ ä¸€ä¸ªno_root_squashï¼›ä¸å»ºè®®è¿™ä¹ˆåšã€‚</li></ul><ol start="2"><li>å®¢æˆ·ç”µè¯å’¨è¯¢è¯´æœåŠ¡å™¨å‡ºæ•…éšœäº†ï¼Œ</li></ol><ul><li>1ï¼‰æŒ‚æ¥ç›®å½•æ‰§è¡Œä»»ä½•æ“ä½œå°±å¡æ­»äº†ï¼Œç„¶åæˆ‘é‡å¯ï¼Œå°±å¡åœ¨å“ªé‡Œäº†ï¼Œ/mnt</li><li>2ï¼‰å‰ä¸€å¤©è¿˜æ­£å¸¸ï¼Œä»Šå¤©ä¸Šç­å¼€ä¸äº†æœºäº†</li><li>3ï¼‰mountæŸ¥çœ‹å½“å‰æŒ‚æ¥ç›®å½•ï¼Œå¡åœ¨å“ªé‡Œï¼Œæ€æ‰è¿›ç¨‹ï¼Œå†mountè¿˜æ˜¯å¡åœ¨é‚£é‡Œ</li></ul><p>ä»¥ä¸Šéƒ½æœ‰å¯èƒ½æ˜¯nfsæœåŠ¡å™¨è¿æ¥å‡ºç°é—®é¢˜äº†ï¼Œåº”è¯¥å»æ£€æŸ¥ä¸€ä¸‹nfsæœåŠ¡å™¨çš„è¿è¡Œæƒ…å†µã€‚å†æ’é”™ã€‚</p><h3 id="é…ç½®æ–‡ä»¶è¯¦è§£"><a href="#é…ç½®æ–‡ä»¶è¯¦è§£" class="headerlink" title="é…ç½®æ–‡ä»¶è¯¦è§£"></a>é…ç½®æ–‡ä»¶è¯¦è§£</h3><h4 id="ä¸»é…ç½®æ–‡ä»¶-etc-exports"><a href="#ä¸»é…ç½®æ–‡ä»¶-etc-exports" class="headerlink" title="ä¸»é…ç½®æ–‡ä»¶/etc/exports"></a>ä¸»é…ç½®æ–‡ä»¶/etc/exports</h4><p>å…³äºexportsçš„å†™æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡  <code>man 5 exports</code> æ¥æŸ¥çœ‹ <code>EXAMPLES</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> sample /etc/exports file</span></span><br><span class="line"><span class="meta">#</span><span class="bash">      å…±äº«ç›®å½•             å®¢æˆ·ç«¯åˆ—è¡¨ï¼ˆæƒé™ï¼‰</span></span><br><span class="line">       /               master(rw) trusty(rw,no_root_squash)</span><br><span class="line">       /projects       proj*.local.domain(rw)</span><br><span class="line">       /usr            *.local.domain(ro) @trusted(rw)</span><br><span class="line">       /home/joe       pc001(rw,all_squash,anonuid=150,anongid=100)</span><br><span class="line">       /pub            *(ro,insecure,all_squash)</span><br><span class="line">       /srv/www        -sync,rw server @trusted @external(ro)</span><br><span class="line">       /foo            2001:db8:9:e54::/64(rw) 192.0.2.0/24(rw)</span><br><span class="line">       /build          buildhost[0-9].local.domain(rw)</span><br></pre></td></tr></table></figure><p>è¯¦ç»†å‚æ•°è§£é‡Šå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">rw</td><td align="left">å¯è¯»å¯å†™</td></tr><tr><td align="left">ro</td><td align="left">åªè¯»</td></tr><tr><td align="left">sync</td><td align="left">æ•°æ®åŒæ­¥å†™å…¥å†…å­˜ç¼“å†²åŒºä¸ç£ç›˜ä¸­ï¼Œè™½ç„¶è¿™æ ·åšæ•ˆç‡è¾ƒä½ï¼Œä½†å¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼ˆé€‚åˆäºå°æ–‡ä»¶ä¼ è¾“ï¼‰</td></tr><tr><td align="left">async</td><td align="left">æ•°æ®å…ˆæš‚æ—¶æ”¾äºå†…å­˜ï¼Œè€Œéç›´æ¥å†™å…¥ç¡¬ç›˜ï¼Œç­‰åˆ°å¿…è¦æ—¶æ‰å†™å…¥ç£ç›˜ï¼ˆé€‚åˆäºå¤§æ–‡ä»¶ä¼ è¾“ï¼‰</td></tr><tr><td align="left">no_root_squash</td><td align="left">ä½¿ç”¨nfsæ—¶ï¼Œå¦‚æœç”¨æˆ·æ˜¯rootï¼Œä¸è¿›è¡Œæƒé™å‹ç¼©ï¼Œå³rootç”¨æˆ·åœ¨nfsä¸Šåˆ›å»ºçš„æ–‡ä»¶   å±ç»„å’Œå±ä¸»ä»ç„¶æ˜¯rootï¼ˆä¸å®‰å…¨ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼‰</td></tr><tr><td align="left">root_squash</td><td align="left">ä½¿ç”¨nfsæ—¶ï¼Œå¦‚æœç”¨æˆ·æ˜¯rootï¼Œåˆ™è¿›è¡Œæƒé™å‹ç¼©ï¼Œå³æŠŠrootç”¨æˆ·åœ¨nfsä¸Šåˆ›å»ºçš„æ–‡ä»¶   å±ç»„å’Œå±ä¸»ä¿®æ”¹ä¸ºnfsnobody</td></tr><tr><td align="left">all_squash</td><td align="left">æ‰€æœ‰çš„æ™®é€šç”¨æˆ·ä½¿ç”¨nfséƒ½å°†ä½¿ç”¨æƒé™å‹ç¼©ï¼Œå³ï¼šå°†è¿œç¨‹è®¿é—®çš„æ‰€æœ‰æ™®é€šç”¨æˆ·åŠæ‰€å±ç”¨æˆ·ç»„éƒ½æ˜ å°„ä¸ºåŒ¿åç”¨æˆ·æˆ–è€…ç”¨æˆ·ç»„ï¼ˆä¸€èˆ¬å‡ä¸ºnfsnobodyï¼‰</td></tr><tr><td align="left">no_all_squash</td><td align="left">æ‰€æœ‰çš„æ™®é€šç”¨æˆ·ä½¿ç”¨nfséƒ½ä¸ä½¿ç”¨æƒé™å‹ç¼©ï¼Œå³ï¼šä¸å°†è¿œç¨‹è®¿é—®çš„æ‰€æœ‰æ™®é€šç”¨æˆ·åŠæ‰€å±ç”¨æˆ·ç»„éƒ½æ˜ å°„ä¸ºåŒ¿åç”¨æˆ·æˆ–è€…ç”¨æˆ·ç»„ï¼ˆé»˜è®¤è®¾ç½®ï¼‰</td></tr><tr><td align="left">anonuid=XXX</td><td align="left">anonå³anonymous(åŒ¿åè€…)ï¼Œå‰é¢å…³äº*_squashæåˆ°çš„åŒ¿åç”¨æˆ·çš„uidçš„è®¾ç½®å€¼ï¼Œé€šå¸¸ä¸ºnobodyæˆ–è€…nfsnobodyï¼Œä½¿ç”¨è¿™ä¸ªå‚æ•°å¯ä»¥è‡ªè¡Œè®¾å®šè¿™ä¸ªuidå€¼ï¼Œè¿™ä¸ªuidå¿…é¡»å­˜åœ¨ äº/etc/passwd</td></tr><tr><td align="left">anongid=XXX</td><td align="left">å°†è¿œç¨‹è®¿é—®çš„æ‰€æœ‰ç”¨æˆ·ç»„éƒ½æ˜ èº«ä¸ºåŒ¿åç”¨æˆ·ç»„è´¦æˆ·ï¼Œå¹¶æŒ‡å®šè¯¥åŒ¿åç”¨æˆ·ç»„è´¦æˆ·ä¸ºæœ¬åœ°ç”¨æˆ·ç»„è´¦æˆ·ï¼ˆGID=XXXï¼‰</td></tr><tr><td align="left">insecure</td><td align="left">å…è®¸å®¢æˆ·ç«¯ä»å¤§äº1024çš„TCP/IPç«¯å£è¿NFSæœåŠ¡å™¨</td></tr><tr><td align="left">secure</td><td align="left">é™åˆ¶å®¢æˆ·ç«¯åªèƒ½ä»å°äº1024çš„TCP/IPç«¯å£è¿æ¥NFSæœåŠ¡å™¨(é»˜è®¤è®¾ç½®)</td></tr><tr><td align="left">wdelay</td><td align="left">æ£€æŸ¥æ˜¯å¦æœ‰ç›¸å…³çš„å†™æ“ä½œï¼Œå¦‚æœæœ‰åˆ™å°†è¿™äº›å†™æ“ä½œä¸€èµ·æ‰§è¡Œï¼Œè¿™æ ·å¯æé«˜æ•ˆç‡(é»˜è®¤è®¾ç½®)</td></tr><tr><td align="left">no_wdelay</td><td align="left">è‹¥æœ‰å†™æ“ä½œåˆ™ç«‹å³æ‰§è¡Œï¼ˆåº”ä¸syncé…ç½®ï¼‰</td></tr><tr><td align="left">subtree_check</td><td align="left">è‹¥è¾“å‡ºç›®å½•æ˜¯ä¸€ä¸ªå­ç›®å½•ï¼Œåˆ™NFSW:åŠ¡å™¨å°†æ£€æŸ¥å…¶çˆ¶ç›®å½•çš„æƒé™(é»˜è®¤è®¾ç½®)</td></tr><tr><td align="left">no_subtree_check</td><td align="left">å³ä½¿è¾“å‡ºç›®å½•æ˜¯ä¸€ä¸ªå­ç›®å½•ï¼ŒNFSæœåŠ¡å™¨ä¹Ÿä¸æ£€æŸ¥å…¶çˆ¶ç›®å½•çš„æƒé™ï¼Œè¿™æ ·åšå¯æé«˜æ•ˆç‡</td></tr></tbody></table><p><strong>è®¾ç½®å®ä¾‹</strong></p><p><code>/tmp *(rw,no_root_squash)</code></p><p>åœ¨æ‰€æœ‰çš„IPï¼ˆä¸»æœºï¼‰ä¸Šç™»å½•çš„ç”¨æˆ·éƒ½å¯å¯¹NFSæœåŠ¡å™¨ä¸Šçš„å…±äº«ç›®å½•/tmpæ‹¥æœ‰rwæ“ä½œæƒé™ï¼ŒåŒæ—¶å¦‚æœæ˜¯rootç”¨æˆ·è®¿é—®è¯¥å…±äº«ç›®å½•ï¼Œé‚£ä¹ˆä¸å°†rootç”¨æˆ·åŠæ‰€å±ç”¨æˆ·ç»„éƒ½æ˜ å°„ä¸ºåŒ¿åç”¨æˆ·æˆ–ç”¨æˆ·ç»„ï¼ˆ*è¡¨ç¤ºæ‰€æœ‰çš„ä¸»æœºæˆ–è€…IPï¼‰</p><p><code>/tmp *(rw)</code></p><p>åœ¨æ‰€æœ‰çš„IPï¼ˆä¸»æœºï¼‰ç™»å½•çš„ç”¨æˆ·éƒ½å¯å¯¹NFSæœåŠ¡å™¨ä¸Šçš„å…±äº«ç›®å½•/tmpæ‹¥æœ‰rwæ“ä½œæƒé™</p><p><code>/home/public 192.168.0.*(rw)   *(ro)</code>  æˆ–è€… <code>/home/public 192.168.0.0/24(rw) *(ro)</code></p><p>é™¤äº†åœ¨<code>192. 168. 0.0/24</code>è¿™ä¸ªç½‘æ®µå†…çš„ä¸»æœºä¸Šç™»å½•çš„ç”¨æˆ·ï¼Œå¯å¯¹NFSæœåŠ¡å™¨å…±äº«ç›®å½•<code>/home/public</code>è¿›è¡Œ<code>rw</code>æ“ä½œæƒé™ï¼Œè€Œå…¶å®ƒç½‘æ®µçš„ä¸»æœºä¸Šç™»å½•çš„ç”¨æˆ·ï¼Œå¯¹NFSæœåŠ¡å™¨å…±äº«ç›®å½•<code>/home/public</code>åªèƒ½è¿›è¡Œ<code>r</code>æ“ä½œ</p><p><code>/home/test 192.168.0.100(rw)</code></p><p>åªå¯¹<code>192.168.0.100</code>è¯¥å°ä¸»æœºè®¾ç½®æƒé™ï¼Œå³ï¼šä½¿åœ¨è¯¥å°ä¸»æœºç™»å½•çš„ç”¨æˆ·éƒ½å¯å¯¹NFSæœåŠ¡å™¨ä¸Šçš„å…±äº«ç›®å½•<code>/home/test</code>æ‹¥æœ‰è¯»ä¸å†™çš„æ“ä½œ</p><p><code>/home/linux *.linux.org(rw,all_squash,anonuid=40,anongid=40)</code></p><p>å½“<code>*.linux.org</code>ï¼ˆåŠ å…¥åŸŸ<code>linux.org</code>çš„æ‰€æœ‰ä¸»æœºï¼‰ ç™»é™†æ­¤NFSä¸»æœºï¼Œå¹¶ä¸”åœ¨<code>/home/linux</code>ä¸‹é¢å†™å…¥æ¡£æ¡ˆæ—¶ï¼Œè¯¥æ¡£æ¡ˆçš„æ‰€æœ‰äººä¸æ‰€æœ‰ç»„ï¼Œå°±ä¼šå˜æˆNFSæœåŠ¡å™¨ä¸Šçš„<code>/etc/passwd</code>æ–‡ä»¶é‡Œé¢å¯¹åº”çš„<code>UID</code>ä¸º40çš„é‚£ä¸ªèº«ä»½çš„ä½¿ç”¨è€…äº†ï¼ˆå› ä¸ºæŒ‡å®šäº†å‚æ•°ï¼š<code>all_squashï¼Œanonuid=40ï¼Œanongid=40</code>ï¼‰</p><hr><h3 id="é¡¹ç›®å®è·µ2ï¼šè‡ªåŠ¨æŒ‚æ¥NFS"><a href="#é¡¹ç›®å®è·µ2ï¼šè‡ªåŠ¨æŒ‚æ¥NFS" class="headerlink" title="é¡¹ç›®å®è·µ2ï¼šè‡ªåŠ¨æŒ‚æ¥NFS"></a>é¡¹ç›®å®è·µ2ï¼šè‡ªåŠ¨æŒ‚æ¥NFS</h3><p>è¦æ±‚åˆ†åˆ«é€šè¿‡ä¸‹é¢ä¸‰ç§æ–¹æ³•å®ç°è‡ªåŠ¨æŒ‚æ¥<br>    *    /etc/fstabï¼ˆå®¹æ˜“å‡ºé—®é¢˜ï¼‰<br>    * /etc/bashrc<br>    * autofsæœåŠ¡</p><h4 id="etc-fstab"><a href="#etc-fstab" class="headerlink" title="/etc/fstab"></a>/etc/fstab</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# vim /etc/fstab</span><br><span class="line">172.25.0.10:/tmp        /mnt                    nfs     defaults        0 0</span><br><span class="line">[root@rhel6 ~]# mount -a</span><br><span class="line">[root@rhel6 ~]# mount |tail -n 1</span><br><span class="line">172.25.0.10:/tmp on /mnt type nfs (rw,vers=4,addr=172.25.0.10,clientaddr=172.25.0.11)</span><br></pre></td></tr></table></figure><p>å¦‚æœnfsæœåŠ¡å™¨å‡ºç°é—®é¢˜ï¼Œå¯¼è‡´å®¢æˆ·ç«¯æ— æ³•æŒ‚æ¥ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°å¼€æœºå¯åŠ¨å¤±è´¥çš„æƒ…å†µã€‚å› æ­¤ä¸å»ºè®®è¿™ä¹ˆåšã€‚</p><h4 id="etc-bashrc"><a href="#etc-bashrc" class="headerlink" title="/etc/bashrc"></a>/etc/bashrc</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# vim /etc/bashrc</span><br><span class="line">[root@rhel6 ~]# grep mount /etc/bashrc</span><br><span class="line">mount 172.25.0.10:/tmp /mnt</span><br><span class="line">[root@rhel6 ~]# reboot</span><br><span class="line"></span><br><span class="line">Broadcast message from root@rhel6</span><br><span class="line">(/dev/pts/0) at 16:53 ...</span><br><span class="line"></span><br><span class="line">The system is going down for reboot NOW!</span><br><span class="line">[root@rhel6 ~]# Connection to 172.25.0.11 closed by remote host.</span><br><span class="line">Connection to 172.25.0.11 closed.</span><br><span class="line">[root@foundation0 ~]# ssh root@172.25.0.11</span><br><span class="line">Last login: Sun Sep 25 16:52:03 2016 from 172.25.0.250</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mount.nfs: Connection timed out</span><br></pre></td></tr></table></figure><p>å¦‚æœå°†æŒ‚æ¥çš„å‘½ä»¤æ”¾åœ¨å¼€æœºå¯åŠ¨åçš„ç»ˆç«¯å¯åŠ¨è„šæœ¬ä¸­ï¼Œé‚£ä¹ˆåªä¼šæœ‰ä¸€ä¸ªæŠ¥é”™è€Œå·²ã€‚</p><h4 id="autofs-è‡ªåŠ¨æŒ‚æ¥æœåŠ¡"><a href="#autofs-è‡ªåŠ¨æŒ‚æ¥æœåŠ¡" class="headerlink" title="autofs è‡ªåŠ¨æŒ‚æ¥æœåŠ¡"></a>autofs è‡ªåŠ¨æŒ‚æ¥æœåŠ¡</h4><p>ä½¿ç”¨çš„æ—¶å€™æŒ‚æ¥ï¼Œä¸ä½¿ç”¨ç­‰å¾…5åˆ†é’Ÿåå¸è½½ï¼Œè€Œç­‰å¾…çš„æ—¶é—´æ—¶å¯ä»¥è°ƒæ•´çš„ï¼Œåœ¨<code>/etc/sysconfig/autofs</code>é…ç½®æ–‡ä»¶ä¸­é€šè¿‡<code>TIMEOUT</code>å‚æ•°è°ƒæ•´ï¼Œä¾‹å¦‚<code>TIMEOUT=300</code>ã€‚</p><ol><li><p>è½¯ä»¶        autofs</p></li><li><p>service        autofs</p></li><li><p>daemon        automount        </p></li><li><p>é…ç½®æ–‡ä»¶</p><ul><li>/etc/auto.master    çˆ¶æŒ‚æ¥ç‚¹</li><li>/etc/auto.booboo    å­æŒ‚æ¥ç‚¹<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">172.25.0.10:&#x2F;tmp &#x2F;mnt&#x2F;share</span><br><span class="line">&#x2F;mntçˆ¶æŒ‚æ¥ç‚¹</span><br><span class="line">shareå­æŒ‚æ¥ç‚¹</span><br></pre></td></tr></table></figure></li></ul></li><li><p>é…ç½®æ–‡ä»¶æ ¼å¼</p></li></ol><p>å¯ä»¥é€šè¿‡<code>man 5 autofs</code>æŸ¥çœ‹é…ç½®æ–‡ä»¶çš„æ ¼å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;auto.master</span><br><span class="line">&#x2F;mnt&#x2F;etc&#x2F;auto.booboo</span><br><span class="line"></span><br><span class="line">&#x2F;etc&#x2F;auto.booboo</span><br><span class="line">share-rw172.25.0.10:&#x2F;tmp</span><br></pre></td></tr></table></figure><p><strong>è‡ªåŠ¨æŒ‚æ¥autofsåœºæ™¯</strong></p><p>rhel7 ä½œä¸ºnfsç½‘ç»œå…±äº«æ–‡ä»¶ç³»ç»ŸæœåŠ¡ï¼›rhel6ä½œä¸ºnfsçš„å®¢æˆ·ç«¯ç°åœ¨æƒ³è‡ªåŠ¨æŒ‚æ¥rhel7çš„/tmpç›®å½•ä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡autofsã€‚</p><table><thead><tr><th align="left">ä¸»æœºå</th><th align="left">ipåœ°å€</th><th align="left">è½¯ä»¶</th><th align="left">åŠŸèƒ½</th></tr></thead><tbody><tr><td align="left">rhel6</td><td align="left">172.25.0.11</td><td align="left">rpcbind nfs-utils</td><td align="left">nfså®¢æˆ·ç«¯ï¼›autofsæœåŠ¡ç«¯</td></tr><tr><td align="left">rhel7</td><td align="left">172.25.0.10</td><td align="left">rpcbind nfs-utils</td><td align="left">nfsæœåŠ¡ç«¯</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# yum install -y autofs</span><br><span class="line">Loaded plugins: product-id, refresh-packagekit, security, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Setting up Install Process</span><br><span class="line">Package 1:autofs-5.0.5-88.el6.x86_64 already installed and latest version</span><br><span class="line">Nothing to do</span><br><span class="line">[root@rhel6 ~]# rpm -ql autofs</span><br><span class="line">/etc/auto.master</span><br><span class="line">/etc/auto.misc</span><br><span class="line">/etc/auto.net</span><br><span class="line">/etc/auto.smb</span><br><span class="line">/etc/autofs_ldap_auth.conf</span><br><span class="line">/etc/rc.d/init.d/autofs</span><br><span class="line">/etc/sysconfig/autofs</span><br><span class="line">/misc</span><br><span class="line">/net</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# vim /etc/auto.master</span><br><span class="line">/mnt    /etc/auto.booboo</span><br><span class="line">[root@rhel6 ~]# vim /etc/auto.booboo</span><br><span class="line">share   -rw     172.25.0.10:/tmp</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# mkdir /mnt/share</span><br><span class="line">[root@rhel6 ~]# service autofs start</span><br><span class="line">Starting automount:                                        [  OK  ]</span><br><span class="line">[root@rhel6 ~]# ll /mnt/share</span><br><span class="line">total 0</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:58 systemd-private-jFcaMN</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><img src="pic/06.png" alt="06"></p><p><img src="pic/07.png" alt="07"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;NFSæ˜¯ä»€ä¹ˆ&quot;&gt;&lt;a href=&quot;#NFSæ˜¯ä»€ä¹ˆ&quot; class=&quot;headerlink&quot; title=&quot;NFSæ˜¯ä»€ä¹ˆ&quot;&gt;&lt;/a&gt;NFSæ˜¯ä»€ä¹ˆ&lt;/h3&gt;&lt;p&gt;NFSï¼ˆNetwork File Systemï¼‰å³ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ŒSUNå…¬å¸å¼€å‘çš„,æ˜¯FreeBSDæ”¯æŒçš„æ–‡ä»¶
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/Linux%E7%AE%80%E6%98%93%E6%9C%8D%E5%8A%A1%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="LinuxåŸºç¡€æœåŠ¡" scheme="http://www.toberoot.com/tags/Linux%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>DNSåŸŸåè§£ææœåŠ¡</title>
    <link href="http://www.toberoot.com/2016/12/23/booboo_easy_service/01_dns/"/>
    <id>http://www.toberoot.com/2016/12/23/booboo_easy_service/01_dns/</id>
    <published>2016-12-22T21:06:27.000Z</published>
    <updated>2020-03-24T05:02:31.694Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¯¾ç¨‹è¦æ±‚</p></blockquote><ol><li>åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸€å°åŸŸåè§£ææœåŠ¡å™¨DNSæ­£åè§£æ</li><li>åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸¤å°åŸŸåè§£ææœåŠ¡å™¨åšDNSä¸»è¾…åŒæ­¥</li></ol><h3 id="DNSæœåŠ¡"><a href="#DNSæœåŠ¡" class="headerlink" title="DNSæœåŠ¡"></a>DNSæœåŠ¡</h3><p>å…¨ç§°æ˜¯domain name serveråŸŸåè§£ææœåŠ¡ã€‚</p><p>æˆ‘ä»¬çŸ¥é“æ¯ä¸ªè”ç½‘çš„è®¡ç®—æœºéƒ½æœ‰ä¸€ä¸ªipåœ°å€å§ï¼ŸIpåœ°å€æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„å‘¢ï¼ŸIpåœ°å€æ˜¯ç”¨æ¥å’Œäº’è”ç½‘ä¸Šåˆ«çš„æœºå™¨è¿›è¡Œé€šè®¯çš„ã€‚ä½†æ˜¯ipåœ°å€å¾ˆéš¾è®°å§ï¼Ÿä¸€ä¸¤ä¸ªipåœ°å€å¯èƒ½è¿˜å¥½ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬æ¯å¤©è¦è®¿é—®çš„ç½‘é¡µä¸ä»…ä»…åªæœ‰ä¸€ä¸¤ä¸ªå§ï¼Ÿ</p><p>æˆ‘ä»¬è®°å¾—éƒ½æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a>. <a href="http://www.sina.comã€‚æˆ‘ä»¬è®°ä½çš„å…¶å®éƒ½æ˜¯å­—ç¬¦ï¼Œéƒ½æ˜¯åŸŸåã€‚å°±åƒæˆ‘ä»¬çš„ç”µè¯å·ç ï¼Œå¾ˆéš¾è®°ï¼Œäºæ˜¯æˆ‘ä»¬æŠŠç”µè¯å·ç å­˜åˆ°æ‰‹æœºé‡Œï¼Œç»™ä»–èµ·ä¸ªæ˜µç§°æˆ–è€…ç›´æ¥è¾“å…¥äººåå¯¹å§ï¼ŒæŠŠç”µè¯å·ç å¯¹åº”æˆäººåå§ï¼Ÿç„¶åæ‰“ç”µè¯çš„æ—¶å€™å°±ç›´æ¥æ‰¾åˆ°è¿™ä¸ªäººåå°±å¥½äº†ã€‚">www.sina.comã€‚æˆ‘ä»¬è®°ä½çš„å…¶å®éƒ½æ˜¯å­—ç¬¦ï¼Œéƒ½æ˜¯åŸŸåã€‚å°±åƒæˆ‘ä»¬çš„ç”µè¯å·ç ï¼Œå¾ˆéš¾è®°ï¼Œäºæ˜¯æˆ‘ä»¬æŠŠç”µè¯å·ç å­˜åˆ°æ‰‹æœºé‡Œï¼Œç»™ä»–èµ·ä¸ªæ˜µç§°æˆ–è€…ç›´æ¥è¾“å…¥äººåå¯¹å§ï¼ŒæŠŠç”µè¯å·ç å¯¹åº”æˆäººåå§ï¼Ÿç„¶åæ‰“ç”µè¯çš„æ—¶å€™å°±ç›´æ¥æ‰¾åˆ°è¿™ä¸ªäººåå°±å¥½äº†ã€‚</a></p><p>æ‰€ä»¥æˆ‘ä»¬ç³»ç»Ÿä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¼šæŠŠipåœ°å€å¯¹åº”æˆä¸€ä¸ªä¸»æœºåã€‚åœ¨æˆ‘ä»¬ç³»ç»Ÿé‡Œæœ‰è¿™ä¹ˆä¸€ä¸ªæ–‡ä»¶ï¼Œå°±æ˜¯ä¸“é—¨ç”¨æ¥åšå¯¹åº”å…³ç³»çš„ï¼Œè¿™ä¸ªæ–‡ä»¶å«<code>/etc/hosts/</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€æ¥çœ‹ä¸€ä¸‹ï¼Œä¸€æ¡è®°å½•ä¸€è¡Œï¼Œè¡Œé‡Œé¢å°±æ˜¯ä¸»æœºåå’Œipåœ°å€ï¼Œå½“ç„¶ä¸€ä¸ªipåœ°å€å¯ä»¥å¯¹åº”å¤šä¸ªä¸»æœºåï¼Œå°±åƒäººæœ‰å¾ˆå¤šçš„æ˜µç§°ä¸€æ ·ã€‚</p><p>é‚£ä¹ˆè¿™æ ·æ˜¯ä¸æ˜¯å°±è§£å†³é—®é¢˜äº†ï¼Œå½“æˆ‘ä»¬æƒ³è¦è®¿é—®ä¸€ä¸ªç½‘ç«™çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¸ç”¨è¾“å…¥ipåœ°å€ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥è¾“å…¥ä¸»æœºåå°±è¡Œäº†ï¼Œæœºå™¨ä¼šå¸®æˆ‘ä»¬åšä¸€ä¸ªè§£æï¼ŒæŠŠä¸»æœºåå¯¹åº”æˆipåœ°å€è¿›è¡Œé€šä¿¡ã€‚æ—©æœŸè¿™æ ·åšçš„ç¡®æ²¡é—®é¢˜ï¼Œä½†æ˜¯éšç€äº’è”ç½‘æ„ˆå‘çš„å£®å¤§ï¼Œè¿™ä¸ªæ–‡ä»¶å°±ä¸é‚£ä¹ˆå®ç”¨äº†ã€‚æˆ‘ä»¬è¦åœ¨æœºå™¨ä¸Šé…ç½®å¤§é‡çš„å¯¹åº”å…³ç³»ï¼Œæ˜¯éå¸¸è€—æ—¶ï¼Œéå¸¸éº»çƒ¦çš„ï¼Œè€Œä¸”è¦é…ç½®çš„æœºå™¨å¯ä¸æ­¢ä¸€å°ã€‚æ¯”å¦‚è¯´æˆ‘æ˜¯ç™¾åº¦ï¼Œæˆ‘å¸Œæœ›ä¸–ç•Œä¸Šæ‰€æœ‰çš„äººéƒ½è¦æ¥è®¿é—®æˆ‘çš„ç½‘é¡µï¼Œé‚£ä¹ˆï¼Œæˆ‘æ˜¯ä¸æ˜¯éœ€è¦è®©ä¸–ç•Œä¸Šæ‰€æœ‰çš„äººéƒ½å»æ·»åŠ æˆ‘çš„ipåœ°å€å’Œä¸»æœºåçš„å¯¹åº”å…³ç³»ã€‚è¿™ä¸ªæ˜¯éå¸¸éš¾åšåˆ°çš„äº‹æƒ…ï¼Œå·¥ä½œé‡å¤ªå¤§ã€‚äºæ˜¯æˆ‘ä»¬å°±å¼•å…¥äº†ä¸€ç§æ–°çš„æœºåˆ¶ã€‚</p><h3 id="DNSçš„å®ç°åŸç†"><a href="#DNSçš„å®ç°åŸç†" class="headerlink" title="DNSçš„å®ç°åŸç†"></a>DNSçš„å®ç°åŸç†</h3><p>è¿™ç§æœºåˆ¶çš„ä½œç”¨å’Œhostsæ–‡ä»¶ä¸€æ ·ï¼Œä½†æ˜¯å®ç°æ–¹æ³•å´ä¸ä¸€æ ·ï¼Œè¿™ä¸ªæœºåˆ¶å°±å«DNS (Domain name server)ã€‚é€šè¿‡dnsï¼Œæˆ‘ä»¬å¯ä»¥è§£å†³è¿™ä¸ªå¤§æ‰¹é‡åŸŸåè§£æçš„é—®é¢˜ã€‚é‚£å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿè¿™å°±æ˜¯dnsçš„ç»“æ„æ–¹é¢çš„é—®é¢˜äº†ã€‚</p><p>æˆ‘ä»¬ä¹‹å‰è¯´æˆ‘ä»¬çš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„ç»“æ„ï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸ªåˆ†å±‚å¼çš„ç»“æ„ï¼Œè¿™ä¸ªç»“æ„çš„ä½“ç°æ–¹å¼å°±æ˜¯ç›®å½•å§ï¼Ÿå¯¹ä¸å¯¹ã€‚Dnsä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå®ƒä¹Ÿé‡‡ç”¨äº†åˆ†å±‚å¸‚ç®¡ç†çš„æ–¹å¼ã€‚</p><p>ä¸è¿‡ä¸åŒäºç›®å½•ï¼Œæˆ‘ä»¬çš„ç›®å½•æ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”¨æ¥å¸®åŠ©æˆ‘ä»¬ç†è§£æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ç§æ–¹å¼ã€‚è€Œdnsï¼Œä»–æ˜¯å®å®åœ¨åœ¨çš„ä¸€ç§ç®¡ç†ç»“æ„ã€‚</p><p>é‚£æˆ‘ä»¬æ¥çœ‹ï¼Œç›®å½•çš„è‡³é«˜ç‚¹æ˜¯ä»€ä¹ˆã€‚æ˜¯æ ¹å§ï¼Œå¯¹ä¸å¯¹ï¼Œé‚£ä¹ˆå¯¹äºæˆ‘ä»¬dnsæ¥è¯´ï¼Œæ—¢ç„¶æ˜¯åˆ†å±‚å¼ç®¡ç†ç»“æ„ï¼Œå®ƒä¹Ÿéœ€è¦æœ‰ä¸€ä¸ªè‡³é«˜ç‚¹å§ã€‚è¿™ä¸ªè‡³é«˜ç‚¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬æŠŠå®ƒç§°ä½œæ ¹åŸŸï¼Œä»¥ç‚¹ä»£è¡¨æ ¹åŸŸã€‚å…¨ä¸–ç•Œæ€»å…±æœ‰13å°æ ¹åŸŸï¼Œæ˜¯å¤„äºè‡³é«˜æ— ä¸Šçš„ä½ç½®çš„ï¼Œåªæœ‰13å°æœºå™¨ã€‚</p><p>é‚£ä¹ˆæ ¹åŸŸä¸‹é¢å°±æ˜¯é¡¶çº§åŸŸäº†ï¼Œé€šå¸¸æˆ‘ä»¬çœ‹åˆ°çš„é¡¶çº§åŸŸæœ‰è¿™ä¸ªcomã€‚æœ‰orgï¼Œæœ‰cnè¿˜æœ‰eduç­‰ç­‰ï¼Œè¿™äº›éƒ½æ˜¯é¡¶çº§åŸŸã€‚é¡¶çº§åŸŸä¸‹é¢ç®¡ç†äºŒçº§åŸŸï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>FQDNï¼šä¸»æœºååŠ ä¸ŠåŸŸåï¼Œè¢«ç§°ä½œå®Œå…¨åˆæ ¼çš„åŸŸåï¼Œfqdnã€‚å…¶å®comåé¢åº”è¯¥æœ‰ä¸ªç‚¹çš„ï¼Œä»£è¡¨æ ¹åŸŸã€‚åªä¸è¿‡æˆ‘ä»¬ç°åœ¨ä¹ æƒ¯æ€§çš„å°†å…¶çœç•¥äº†ã€‚å°±å¥½åƒå›½å®¶ç®¡ç†çœï¼Œçœç®¡ç†å¸‚ï¼Œå¸‚ç®¡ç†å¿ç­‰ç­‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å®Œæ•´çš„åŸŸåwww.baidu.com.</span><br><span class="line">.æ ¹åŸŸå…¨çƒä¸€å…±13ä¸ªæ ¹åŸŸ</span><br><span class="line">.comè¶…çº§åŸŸï¼Œä¸€çº§åŸŸ</span><br><span class="line">.baiduäºŒçº§åŸŸ</span><br><span class="line">wwwä¸»æœºå</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>ä¸¾ä¾‹ï¼šå¯»æ‰¾æ–°æµªçš„æ–¹å¼ã€‚</p></blockquote></blockquote><ol><li>å…ˆçœ‹æœ¬åœ°<code>/etc/hosts</code>æœ‰æ²¡æœ‰è®°å½•ã€‚</li><li>æ‰¾å¦å¤–ä¸€ä¸ªäººé—®ï¼Œâ€“&gt;æ‰¾DNSæœåŠ¡å™¨å»é—®ã€‚ åœ¨<code>/etc/resolv.conf</code>æ–‡ä»¶ä¸­æŒ‡å®šäº†æ‰¾è°å»é—®ã€‚</li></ol><p>å½“ç„¶ï¼Œè¿™å…ˆåé¡ºåºä¹Ÿæ˜¯ç”±æŸä¸ªæ–‡ä»¶å†³å®šçš„ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯<code>/etc/nsswitch.conf</code>.</p><p>Windowsä¸Šé¢ä¹Ÿæœ‰</p><p>ç½‘ä¸Šé‚»å±…&gt;å±æ€§&gt;æœ¬åœ°è¿æ¥ã€‚</p><p><strong>DNSçš„ä¸¤ç§æŸ¥è¯¢æ–¹å¼</strong> å¯¹äºDNSæœåŠ¡å™¨ï¼Œä»–å¯èƒ½çŸ¥é“ä¹Ÿå¯èƒ½ä¸çŸ¥é“ï¼Œ</p><p>çŸ¥é“çš„æƒ…å†µæœ‰ä¸¤ç§ï¼š</p><ol><li>æœ¬åœ°æœ‰è¿™ä¸ªåŸŸï¼Œèƒ½å¤Ÿè§£æåˆ°</li><li>æœ¬åœ°æœ‰ç¼“å­˜ï¼Œå…¶ä»–äººå·²ç»æ¥é—®è¿‡sinaæ˜¯è°ï¼Œé‚£ä¹ˆDNSæœåŠ¡å™¨å¯ä»¥å°†è¯¥ç»“æœç›´æ¥è¿”å›ç»™å®¢æˆ·ã€‚</li></ol><p>ä¸çŸ¥é“çš„è¯å°±ä¼šå»æ‰¾è‡ªå·±çš„ä¸Šçº§åŸŸï¼Œç„¶åé€šè¿‡ç­‰å¾…ä¸Šçº§åŸŸçš„åé¦ˆï¼Œå°†åé¦ˆä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™ç§æ–¹å¼å«åšé€’å½’æŸ¥è¯¢ã€‚</p><p>é‚£ä¹ˆè¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯ï¼ŒDNSå»è¯¢é—®ä¸Šçº§åŸŸï¼Œç„¶åä¸Šçº§åŸŸå°†å¯¹åº”çš„åŒçº§DNSæœåŠ¡å™¨åé¦ˆå›æ¥ï¼Œç”±å®¢æˆ·ç«¯å»è¯¢é—®æ–°çš„DNSæœåŠ¡å™¨æ¥æ‰¾å¯»ç½‘â€â€å€å¯¹åº”çš„IPåœ°å€ã€‚è¿™ç§å«åšè¿­ä»£æŸ¥è¯¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">www.sina.com.</span><br><span class="line">1)æ‰¾æ ¹åŸŸ.</span><br><span class="line">2)æ‰¾è¶…çº§åŸŸ.com</span><br><span class="line">3)æ‰¾äºŒçº§åŸŸ.sina</span><br><span class="line">4)æˆåŠŸæ‰¾åˆ°www</span><br></pre></td></tr></table></figure><h3 id="å®æˆ˜é¡¹ç›®1-åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸€å°åŸŸåè§£ææœåŠ¡å™¨DNSæ­£åè§£æ"><a href="#å®æˆ˜é¡¹ç›®1-åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸€å°åŸŸåè§£ææœåŠ¡å™¨DNSæ­£åè§£æ" class="headerlink" title="å®æˆ˜é¡¹ç›®1:åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸€å°åŸŸåè§£ææœåŠ¡å™¨DNSæ­£åè§£æ"></a>å®æˆ˜é¡¹ç›®1:åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸€å°åŸŸåè§£ææœåŠ¡å™¨DNSæ­£åè§£æ</h3><blockquote><p>1)åœ¨rhel6ä¸Šé…ç½®dnsåŸŸåè§£ææœåŠ¡ï¼Œè§£æuplooking.comåŸŸåï¼Œè¦æ±‚å¦‚ä¸‹ï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">        NS      @</span><br><span class="line">        A       172.25.0.11</span><br><span class="line">www     A       172.25.0.10</span><br><span class="line">        MX 5    mail</span><br><span class="line">mail    A       172.25.0.10</span><br><span class="line">ftp     A       172.25.0.10</span><br><span class="line">bbsCNAMEftp</span><br></pre></td></tr></table></figure><blockquote><p>2)é…ç½®åå‘è§£æ172.25.0.10å’Œ172.25.0.11ï¼›</p></blockquote><blockquote><p>3)è¦æ±‚rhel6å’Œrhel7è¿™ä¸¤å°æœåŠ¡å™¨çš„åŸŸåè§£ææœåŠ¡å™¨ä¸º172.25.0.11è¿™å°æœåŠ¡å™¨ã€‚</p></blockquote><h4 id="å®éªŒå‡†å¤‡é˜¶æ®µ"><a href="#å®éªŒå‡†å¤‡é˜¶æ®µ" class="headerlink" title="å®éªŒå‡†å¤‡é˜¶æ®µ"></a>å®éªŒå‡†å¤‡é˜¶æ®µ</h4><ol><li>ç”»å‡ºç½‘ç»œæ‹“æ‰‘å›¾</li><li>è§„åˆ’ä¸åŒæœåŠ¡å™¨éœ€è¦å®‰è£…çš„è½¯ä»¶(osâ€“softç‰ˆæœ¬)</li><li>å¼€å§‹å®‰è£…</li><li>é…ç½®æœåŠ¡</li><li>å¯åŠ¨æœåŠ¡</li><li>æµ‹è¯•æ’é”™</li></ol><blockquote><p>è¯¦ç»†æ­¥éª¤æ¦‚è§ˆ</p></blockquote><table><thead><tr><th align="left">num</th><th align="left">step</th><th align="left">man</th></tr></thead><tbody><tr><td align="left">1)</td><td align="left">å®‰è£…è½¯ä»¶</td><td align="left">bind bind-chroot</td></tr><tr><td align="left">2)</td><td align="left">æŸ¥çœ‹è½¯ä»¶æ¶æ„</td><td align="left">rpm -ql</td></tr><tr><td align="left"></td><td align="left">æ—¥å¿—</td><td align="left">/var/log/named.log</td></tr><tr><td align="left"></td><td align="left">æ•°æ®</td><td align="left">/var/named/</td></tr><tr><td align="left"></td><td align="left">é…ç½®</td><td align="left">/etc/named.conf</td></tr><tr><td align="left"></td><td align="left"></td><td align="left">/etc/named.rfc1912.zones</td></tr><tr><td align="left">3)</td><td align="left">ä¿®æ”¹é…ç½®æ–‡ä»¶</td><td align="left"></td></tr><tr><td align="left">4)</td><td align="left">å¯åŠ¨æœåŠ¡</td><td align="left"></td></tr><tr><td align="left"></td><td align="left">service</td><td align="left">named</td></tr><tr><td align="left"></td><td align="left">daemon</td><td align="left">named</td></tr><tr><td align="left">4.1ï¼‰</td><td align="left">æ’é™¤é”™è¯¯</td><td align="left">çœ‹æ—¥å¿—</td></tr><tr><td align="left">5)</td><td align="left">æµ‹è¯•</td><td align="left">nslookup</td></tr><tr><td align="left">5.1ï¼‰</td><td align="left">æ’é”™</td><td align="left">çœ‹æ—¥å¿—</td></tr></tbody></table><blockquote><p>ç½‘ç»œæ‹“æ‰‘å›¾</p></blockquote><p><img src="pic/12.png" alt="12"></p><blockquote><p>è§„åˆ’æœåŠ¡å™¨è½¯ä»¶</p></blockquote><p><img src="pic/11.png" alt="11"></p><blockquote><p>å¼€å§‹å®‰è£…</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# yum install -y bind bind-chroot</span><br><span class="line">Loaded plugins: product-id, refresh-packagekit, security, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">server                                                   | 3.9 kB     00:00     </span><br><span class="line">Setting up Install Process</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package bind.x86_64 32:9.8.2-0.17.rc1.el6_4.6 will be installed</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package <span class="built_in">bind</span>-chroot.x86_64 32:9.8.2-0.17.rc1.el6_4.6 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line"> Package          Arch        Version                         Repository   Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> bind             x86_64      32:9.8.2-0.17.rc1.el6_4.6       server      4.0 M</span><br><span class="line"> bind-chroot      x86_64      32:9.8.2-0.17.rc1.el6_4.6       server       71 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install       2 Package(s)</span><br><span class="line"></span><br><span class="line">Total download size: 4.0 M</span><br><span class="line">Installed size: 7.3 M</span><br><span class="line">Downloading Packages:</span><br><span class="line">(1/2): bind-9.8.2-0.17.rc1.el6_4.6.x86_64.rpm            | 4.0 MB     00:00     </span><br><span class="line">(2/2): bind-chroot-9.8.2-0.17.rc1.el6_4.6.x86_64.rpm     |  71 kB     00:00     </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                            23 MB/s | 4.0 MB     00:00     </span><br><span class="line">Running rpm_check_debug</span><br><span class="line">Running Transaction Test</span><br><span class="line">Transaction Test Succeeded</span><br><span class="line">Running Transaction</span><br><span class="line">  Installing : 32:bind-9.8.2-0.17.rc1.el6_4.6.x86_64                        1/2</span><br><span class="line">  Installing : 32:bind-chroot-9.8.2-0.17.rc1.el6_4.6.x86_64                 2/2</span><br><span class="line">  Verifying  : 32:bind-9.8.2-0.17.rc1.el6_4.6.x86_64                        1/2</span><br><span class="line">  Verifying  : 32:bind-chroot-9.8.2-0.17.rc1.el6_4.6.x86_64                 2/2</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  bind.x86_64 32:9.8.2-0.17.rc1.el6_4.6                                         </span><br><span class="line">  bind-chroot.x86_64 32:9.8.2-0.17.rc1.el6_4.6                                  </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@rhel6 ~]# rpm -ql bind</span><br><span class="line">/etc/NetworkManager/dispatcher.d/13-named</span><br><span class="line">/etc/logrotate.d/named</span><br><span class="line">/etc/named</span><br><span class="line">/etc/named.conf</span><br><span class="line">/etc/named.iscdlv.key</span><br><span class="line">/etc/named.rfc1912.zones</span><br><span class="line">/etc/named.root.key</span><br><span class="line">/etc/portreserve/named</span><br><span class="line">/etc/rc.d/init.d/named</span><br><span class="line">/etc/rndc.conf</span><br><span class="line">/etc/rndc.key</span><br><span class="line">/etc/sysconfig/named</span><br><span class="line">/usr/lib64/bind</span><br><span class="line">/usr/sbin/arpaname</span><br><span class="line">/usr/sbin/ddns-confgen</span><br><span class="line">/usr/sbin/dnssec-dsfromkey</span><br><span class="line">/usr/sbin/dnssec-keyfromlabel</span><br><span class="line">/usr/sbin/dnssec-keygen</span><br><span class="line">/usr/sbin/dnssec-revoke</span><br><span class="line">/usr/sbin/dnssec-settime</span><br><span class="line">/usr/sbin/dnssec-signzone</span><br><span class="line">/usr/sbin/genrandom</span><br><span class="line">/usr/sbin/isc-hmac-fixup</span><br><span class="line">/usr/sbin/lwresd</span><br><span class="line">/usr/sbin/named</span><br><span class="line">/usr/sbin/named-checkconf</span><br><span class="line">/usr/sbin/named-checkzone</span><br><span class="line">/usr/sbin/named-compilezone</span><br><span class="line">/usr/sbin/named-journalprint</span><br><span class="line">/usr/sbin/nsec3hash</span><br><span class="line">/usr/sbin/rndc</span><br><span class="line">/usr/sbin/rndc-confgen</span><br><span class="line">/usr/share/doc/bind-9.8.2</span><br><span class="line">... ...</span><br><span class="line">/var/log/named.log</span><br><span class="line">/var/named</span><br><span class="line">/var/named/data</span><br><span class="line">/var/named/dynamic</span><br><span class="line">/var/named/named.ca</span><br><span class="line">/var/named/named.empty</span><br><span class="line">/var/named/named.localhost</span><br><span class="line">/var/named/named.loopback</span><br><span class="line">/var/named/slaves</span><br><span class="line">/var/run/named</span><br><span class="line">[root@rhel6 ~]# rpm -ql bind-chroot</span><br><span class="line">/var/named/chroot</span><br><span class="line">/var/named/chroot/dev</span><br><span class="line">/var/named/chroot/dev/null</span><br><span class="line">/var/named/chroot/dev/random</span><br><span class="line">/var/named/chroot/dev/zero</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®æ–‡ä»¶</p></blockquote><blockquote><blockquote><p>/etc/named.conf</p></blockquote></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">listen-on port 53 &#123; any; &#125;;</span><br><span class="line">listen-on-v6 port 53 &#123; any; &#125;;</span><br><span class="line">directory "/var/named";</span><br><span class="line">dump-file "/var/named/data/cache_dump.db";</span><br><span class="line">       statistics-file "/var/named/data/named_stats.txt";</span><br><span class="line">       memstatistics-file "/var/named/data/named_mem_stats.txt";</span><br><span class="line">allow-query     &#123; any; &#125;;</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>/etc/named.rfc1912.zones</p></blockquote></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ­£è§£æ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åŸŸå--&gt;ip</span></span><br><span class="line">zone "uplooking.com" IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file "named.uplooking";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#</span><span class="bash"> åè§£æ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ip---&gt;åŸŸå</span></span><br><span class="line">zone "0.25.172.in-addr.arpa" IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file "named.arpa.uplooking";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>/var/named/named.uplooking</p></blockquote></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">TTL 1D</span></span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                       3H )    ; minimum</span><br><span class="line">ä¸»æœºåä¸»è¦è®°å½•ip</span><br><span class="line">        NS      @</span><br><span class="line">        A       172.25.0.11</span><br><span class="line">www     A       172.25.0.10</span><br><span class="line">        MX 5    mail</span><br><span class="line">mail    A       172.25.0.10</span><br><span class="line">ftp     A       172.25.0.10</span><br><span class="line">bbsCNAMEftp</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong> æ–‡ä»¶çš„æ‰€å±è€…å’Œæ‰€å±ç»„ä»¥åŠæ–‡ä»¶çš„ugoæƒé™</p><blockquote><blockquote><p>named.arpa.uplooking</p></blockquote></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">TTL 1D</span></span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      uplooking.com.</span><br><span class="line">11      PTR     uplooking.com.</span><br><span class="line">10      PTR     www.uplooking.com.</span><br><span class="line">10      PTR     mail.uplooking.com.</span><br><span class="line">10      PTR     ftp.uplooking.com.</span><br><span class="line">10      PTR     bbs.uplooking.com.</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong>    NSåé¢æ­¤æ—¶ä¸€å®šè¦å°†@æ¢æˆåŸŸåuplooking.com.åŸŸåå¿…é¡»å†™å®Œæ•´çš„åŸŸåï¼Œå¸¦æ ¹åŸŸçš„</p><blockquote><p>æœåŠ¡çš„å¯åŠ¨</p></blockquote><ul><li>rhel6    <code>service named start</code></li><li>rhel7    <code>systemctl start named</code></li></ul><blockquote><p>é˜²ç«å¢™çš„å…³é—­</p></blockquote><ul><li>rhel6    <code>service iptables stop</code></li><li>rhel7    <code>systemctl stop firewalld</code></li></ul><p><strong>å¦‚æœæœåŠ¡å¯åŠ¨ä¸äº†</strong> é‚£ä¹ˆå°è¯•æ‰§è¡Œä»¥ä¸‹è¯­å¥<code>rndc-confgen -a -r /etc/named.conf</code></p><blockquote><p>æµ‹è¯•</p></blockquote><ol><li><code>/etc/hosts</code>        ç³»ç»Ÿç®¡ç†å‘˜æ‰‹åŠ¨å†™</li><li><code>/etc/resolv.conf</code>â€”-ã€‹æŒ‡å®šæ‰¾å“ªä¸ªåŸŸåè§£ææœåŠ¡å™¨<code>nameserver 172.25.0.11</code></li><li>é€šè¿‡<code>nslookup</code>å‘½ä»¤</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@rhel6 named]# nslookup</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> www.uplooking.com</span></span><br><span class="line">Server:172.25.0.11</span><br><span class="line">Address:172.25.0.11#53</span><br><span class="line"></span><br><span class="line">Name:www.uplooking.com</span><br><span class="line">Address: 172.25.0.10</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> mail.uplooking.com</span></span><br><span class="line">Server:172.25.0.11</span><br><span class="line">Address:172.25.0.11#53</span><br><span class="line"></span><br><span class="line">Name:mail.uplooking.com</span><br><span class="line">Address: 172.25.0.10</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> ftp.uplooking.com</span></span><br><span class="line">Server:172.25.0.11</span><br><span class="line">Address:172.25.0.11#53</span><br><span class="line"></span><br><span class="line">Name:ftp.uplooking.com</span><br><span class="line">Address: 172.25.0.10</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> uplooking.com</span></span><br><span class="line">Server:172.25.0.11</span><br><span class="line">Address:172.25.0.11#53</span><br><span class="line"></span><br><span class="line">Name:uplooking.com</span><br><span class="line">Address: 172.25.0.11</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> bbs.uplooking.com</span></span><br><span class="line">Server:172.25.0.11</span><br><span class="line">Address:172.25.0.11#53</span><br><span class="line"></span><br><span class="line">bbs.uplooking.comcanonical name = ftp.uplooking.com.</span><br><span class="line">Name:ftp.uplooking.com</span><br><span class="line">Address: 172.25.0.10</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 172.25.0.10</span></span><br><span class="line">Server:172.25.0.11</span><br><span class="line">Address:172.25.0.11#53</span><br><span class="line"></span><br><span class="line">10.0.25.172.in-addr.arpaname = bbs.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpaname = www.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpaname = mail.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpaname = ftp.uplooking.com.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 172.25.0.11</span></span><br><span class="line">Server:172.25.0.11</span><br><span class="line">Address:172.25.0.11#53</span><br><span class="line"></span><br><span class="line">11.0.25.172.in-addr.arpaname = uplooking.com.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">exit</span></span></span><br></pre></td></tr></table></figure><hr><h3 id="å®æˆ˜é¡¹ç›®2-åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸¤å°åŸŸåè§£ææœåŠ¡å™¨åšDNSä¸»è¾…åŒæ­¥"><a href="#å®æˆ˜é¡¹ç›®2-åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸¤å°åŸŸåè§£ææœåŠ¡å™¨åšDNSä¸»è¾…åŒæ­¥" class="headerlink" title="å®æˆ˜é¡¹ç›®2:åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸¤å°åŸŸåè§£ææœåŠ¡å™¨åšDNSä¸»è¾…åŒæ­¥"></a>å®æˆ˜é¡¹ç›®2:åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸¤å°åŸŸåè§£ææœåŠ¡å™¨åšDNSä¸»è¾…åŒæ­¥</h3><p>ä¸»è¾…åŒæ­¥ï¼šå¦‚æœæœ‰æ•°ä¸‡å°å®¢æˆ·æœºåœ¨åŒä¸€æ—¶é—´æ¥è®¿é—®DNSæœåŠ¡å™¨ï¼Œä¼šå¯¼è‡´æœåŠ¡å™¨æ‰¿å—å¾ˆå¤§çš„å‹åŠ›ï¼Œè¿™æ—¶å€™æˆ‘å¯èƒ½éœ€è¦å¦å¤–ä¸€ä¸ªäººæ¥å¸®æˆ‘åˆ†æ‹…å‹åŠ›ï¼Œæˆ–è€…è¯´å¦‚æœä¸»æœåŠ¡å™¨é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘èƒ½æœ‰å¦å¤–ä¸€ä¸ªäººç›´æ¥é¡¶ä¸Šæˆ‘çš„å·¥ä½œï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç”¨åˆ°ä¸€ä¸ªè¾…åŠ©æœåŠ¡å™¨äº†ã€‚</p><p>é‚£ä¹ˆå¾ˆæ˜¾ç„¶ï¼Œè¾…åŠ©æœåŠ¡å™¨éœ€è¦å’Œä¸»æœåŠ¡å™¨ç”¨ä¸€æ ·çš„é…ç½®ï¼Œé…ç½®é‡Œå†™çš„æ•°æ®ä¹ŸåŸºæœ¬ç›¸åŒã€‚å¯¹äºæˆ‘ä»¬DNSæœåŠ¡å™¨æ¥è¯´ï¼Œå…¶å®å®ƒçš„æ•°æ®æ–‡ä»¶å¹¶ä¸å›ºå®šï¼Œå¯¹åº”çš„IPå’Œä¸»æœºåéƒ½å¯èƒ½ä¼šç»å¸¸å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå½“é‚£ä¸ªæ—¶å€™ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿä¿®æ”¹ä¸»æœºä¸Šçš„æŸä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œä»æœºä¸Šçš„æ–‡ä»¶ä¹Ÿèƒ½å¤Ÿè¢«è‡ªåŠ¨è¢«ä¿®æ”¹ï¼Œä¿æŒä¸¤å°æœºå™¨å®Œå…¨åŒæ­¥ä¸€è‡´ã€‚</p><p>è¿™æ—¶å€™å°±æœ‰äº†ä¸€ç§é…ç½®æ–¹æ³•ï¼Œå«åšä¸»è¾…åŒæ­¥ã€‚</p><h4 id="å®éªŒå‡†å¤‡é˜¶æ®µ-1"><a href="#å®éªŒå‡†å¤‡é˜¶æ®µ-1" class="headerlink" title="å®éªŒå‡†å¤‡é˜¶æ®µ"></a>å®éªŒå‡†å¤‡é˜¶æ®µ</h4><ol><li>ç½‘ç»œæ‹“æ‰‘å›¾</li><li>è§„åˆ’è½¯ä»¶å®‰è£…bind bind-chroot</li><li>ä¿®æ”¹é…ç½®æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#ä¸»æœåŠ¡å™¨&#x2F;etc&#x2F;named.rfc1912.zoneså…è®¸ä¼ è¾“ç»™ä»æœº</span><br><span class="line">&#x2F;var&#x2F;named&#x2F;named.uplookingåºåˆ—å·ä»0æ”¹æˆæ—¥æœŸ</span><br><span class="line">&#x2F;var&#x2F;named&#x2F;named.arpa.uplooking åºåˆ—å·ä»0æ”¹æˆæ—¥æœŸ</span><br><span class="line">#ä»æœåŠ¡å™¨&#x2F;etc&#x2F;named.confany</span><br><span class="line">&#x2F;etc&#x2F;named.rfc1912.zonesslave;masters;file</span><br></pre></td></tr></table></figure></li><li>å¯åŠ¨ä»æœºæœåŠ¡</li><li>æŸ¥çœ‹ä»æœºç¼“å†²/var/named/slaves/</li><li>æ³¨æ„é˜²ç«å¢™å…³é—­</li><li>å®¢æˆ·ç«¯æµ‹è¯•æœåŠ¡        </li></ol><h4 id="å…·ä½“æ­¥éª¤"><a href="#å…·ä½“æ­¥éª¤" class="headerlink" title="å…·ä½“æ­¥éª¤"></a>å…·ä½“æ­¥éª¤</h4><blockquote><p>ç½‘ç»œæ‹“æ‰‘å›¾</p></blockquote><p><img src="pic/14.png" alt="14"></p><blockquote><p>è§„åˆ’è½¯ä»¶å®‰è£…</p></blockquote><p><img src="pic/13.png" alt="13"></p><blockquote><p>ä¸»æœåŠ¡å™¨ï¼š</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 named]# vim /etc/named.rfc1912.zones</span><br><span class="line">zone "uplooking.com" IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file "named.uplooking";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">        allow-transfer &#123; 172.25.0.10; &#125;;    ===&gt;å…è®¸ä»æœº172.25.0.10æ¥è¯»å–</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone "0.25.172.in-addr.arpa" IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file "named.arpa.uplooking";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">        allow-transfer &#123; 172.25.0.10; &#125;;===&gt;å…è®¸ä»æœº172.25.0.10æ¥è¯»å–</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[root@rhel6 named]# pwd</span><br><span class="line">/var/named</span><br><span class="line">[root@rhel6 named]# ll</span><br><span class="line">total 40</span><br><span class="line">drwxr-x---. 6 root  named 4096 Aug  2 10:30 chroot</span><br><span class="line">drwxrwx---. 2 named named 4096 Aug  2 11:03 data</span><br><span class="line">drwxrwx---. 2 named named 4096 Aug  2 15:06 dynamic</span><br><span class="line">-rw-r-----. 1 root  named  271 Aug  2 13:59 named.arpa.uplooking</span><br><span class="line">-rw-r-----. 1 root  named 1892 Feb 18  2008 named.ca</span><br><span class="line">-rw-r-----. 1 root  named  152 Dec 15  2009 named.empty</span><br><span class="line">-rw-r-----. 1 root  named  152 Jun 21  2007 named.localhost</span><br><span class="line">-rw-r-----. 1 root  named  168 Dec 15  2009 named.loopback</span><br><span class="line">-rw-r-----. 1 root  named  224 Aug  2 11:34 named.uplooking</span><br><span class="line">drwxrwx---. 2 named named 4096 Aug 14  2013 slaves</span><br><span class="line">[root@rhel6 named]# vim named.uplooking</span><br><span class="line"><span class="meta">$</span><span class="bash">TTL 1D</span></span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line">                                        20160802        ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      @</span><br><span class="line">        A       172.25.0.11</span><br><span class="line">www     A       172.25.0.10</span><br><span class="line">        MX 5    mail</span><br><span class="line">mail    A       172.25.0.10</span><br><span class="line">ftp     A       172.25.0.10</span><br><span class="line">bbs     CNAME   ftp</span><br><span class="line">~                        </span><br><span class="line"></span><br><span class="line">[root@rhel6 named]# vim named.arpa.uplooking</span><br><span class="line"><span class="meta">$</span><span class="bash">TTL 1D</span></span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line">                                        20160802        ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      uplooking.com.</span><br><span class="line">11      PTR     uplooking.com.</span><br><span class="line">10      PTR     www.uplooking.com.</span><br><span class="line">10      PTR     mail.uplooking.com.</span><br><span class="line">10      PTR     ftp.uplooking.com.</span><br><span class="line">10      PTR     bbs.uplooking.com.</span><br><span class="line"></span><br><span class="line">[root@rhel6 named]# service named restart</span><br><span class="line">Stopping named: .                                          [  OK  ]</span><br><span class="line">Starting named:                                            [  OK  ]</span><br><span class="line">[root@rhel6 named]# service iptables stop</span><br><span class="line">iptables: Firewall is not running.</span><br><span class="line">[root@rhel6 named]# getenforce</span><br><span class="line">Enforcing</span><br></pre></td></tr></table></figure><blockquote><p>ä»æœåŠ¡å™¨</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# cat /etc/resolv.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> Generated by NetworkManager</span></span><br><span class="line">domain example.com</span><br><span class="line">search example.com</span><br><span class="line">nameserver 172.25.254.254</span><br><span class="line">[root@rhel7 ~]# yum install -y bind*</span><br><span class="line">[root@rhel7 ~]# vim /etc/named.conf</span><br><span class="line">[root@rhel7 ~]# vim /etc/named.rfc1912.zones</span><br><span class="line">zone "uplooking.com" IN &#123;</span><br><span class="line">        type slave;&lt;== å®šä¹‰ç±»å‹ä¸ºå¥´éš¶ slave</span><br><span class="line">        masters &#123; 172.25.0.11; &#125;;&lt;== å‘Šè¯‰è®¡ç®—æœºæˆ‘çš„ä¸»äºº master æ˜¯è°</span><br><span class="line">        file "slaves/uploooking.com.zone";&lt;== å‘Šè¯‰è®¡ç®—æœº zone æ•°æ®åº“åœ°å€åœ¨å“ªé‡Œ,å¥´éš¶æœ‰ä¸“é—¨çš„ç›®å½•</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone "0.25.172.in-addr.arpa" IN &#123;</span><br><span class="line">        type slave;</span><br><span class="line">        masters &#123; 172.25.0.11; &#125;;</span><br><span class="line">        file "slaves/arpa.uplooking.zone";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>æœåŠ¡å¯åŠ¨ä¸å…³é—­</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# systemctl stop firewalld</span><br><span class="line">[root@rhel7 ~]# getenforce</span><br><span class="line">Enforcing</span><br><span class="line">[root@rhel7 ~]# systemctl start named</span><br><span class="line">[root@rhel7 ~]# ll /var/named/slaves</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r--. 1 named named 381 Aug  2 03:54 arpa.uplooking.zone</span><br><span class="line">-rw-r--r--. 1 named named 463 Aug  2 03:54 uploooking.com.zone</span><br></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•</p></blockquote><p>å®¢æˆ·ç«¯ rhel7</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# vim /etc/resolv.conf</span><br><span class="line">nameserver 172.25.0.11</span><br><span class="line">[root@rhel7 ~]# nslookup</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> www.uplooking.com</span></span><br><span class="line">Server:172.25.0.11</span><br><span class="line">Address:172.25.0.11#53</span><br><span class="line"></span><br><span class="line">Name:www.uplooking.com</span><br><span class="line">Address: 172.25.0.10</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 172.25.0.10</span></span><br><span class="line">Server:172.25.0.11</span><br><span class="line">Address:172.25.0.11#53</span><br><span class="line"></span><br><span class="line">10.0.25.172.in-addr.arpaname = www.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpaname = mail.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpaname = ftp.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpaname = bbs.uplooking.com.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 172.25.0.11</span></span><br><span class="line">Server:172.25.0.11</span><br><span class="line">Address:172.25.0.11#53</span><br><span class="line"></span><br><span class="line">11.0.25.172.in-addr.arpaname = uplooking.com.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">exit</span></span></span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# vim /etc/resolv.conf</span><br><span class="line">nameserver 172.25.0.10</span><br><span class="line">[root@rhel7 ~]# nslookup</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> www.uplooking.com</span></span><br><span class="line">Server:172.25.0.10</span><br><span class="line">Address:172.25.0.10#53</span><br><span class="line"></span><br><span class="line">Name:www.uplooking.com</span><br><span class="line">Address: 172.25.0.10</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 172.25.0.11</span></span><br><span class="line">Server:172.25.0.10</span><br><span class="line">Address:172.25.0.10#53</span><br><span class="line"></span><br><span class="line">11.0.25.172.in-addr.arpaname = uplooking.com.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 172.25.0.10</span></span><br><span class="line">Server:172.25.0.10</span><br><span class="line">Address:172.25.0.10#53</span><br><span class="line"></span><br><span class="line">10.0.25.172.in-addr.arpaname = bbs.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpaname = www.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpaname = ftp.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpaname = mail.uplooking.com.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">exit</span></span></span><br></pre></td></tr></table></figure><h3 id="æ’é”™è®°å½•"><a href="#æ’é”™è®°å½•" class="headerlink" title="æ’é”™è®°å½•"></a>æ’é”™è®°å½•</h3><h4 id="æœåŠ¡å¯åŠ¨ä¸äº†"><a href="#æœåŠ¡å¯åŠ¨ä¸äº†" class="headerlink" title="æœåŠ¡å¯åŠ¨ä¸äº†"></a>æœåŠ¡å¯åŠ¨ä¸äº†</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# systemctl start named</span><br><span class="line">Job for named.service failed. See 'systemctl status named.service' and 'journalctl -xn' for details.</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# systemctl status named.service</span><br><span class="line">named.service - Berkeley Internet Name Domain (DNS)</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/named.service; disabled)</span><br><span class="line">   Active: failed (Result: exit-code) since Tue 2016-08-02 04:19:20 EDT; 23s ago</span><br><span class="line">  Process: 2297 ExecStartPre=/usr/sbin/named-checkconf -z /etc/named.conf (code=exited, status=1/FAILURE)</span><br><span class="line"></span><br><span class="line">Aug 02 04:19:20 rhel7 systemd[1]: Starting Berkeley Internet Name Domain (DNS)...</span><br><span class="line">Aug 02 04:19:20 rhel7 named-checkconf[2297]: /etc/named.rfc1912.zones:51: missing ';' before '&#125;'</span><br><span class="line">Aug 02 04:19:20 rhel7 systemd[1]: named.service: control process exited, code=exited status=1</span><br><span class="line">Aug 02 04:19:20 rhel7 systemd[1]: Failed to start Berkeley Internet Name Domain (DNS).</span><br><span class="line">Aug 02 04:19:20 rhel7 systemd[1]: Unit named.service entered failed state.</span><br></pre></td></tr></table></figure><p>psï¼šå½“æœåŠ¡å¯åŠ¨ä¸äº†çš„æ—¶å€™ï¼ŒæŠ¥é”™å†…å®¹ä¸­è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹ï¼Œ<code>systemctl status named.service</code> æˆ–è€… <code>journalctl -xn</code>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å»æ‰§è¡Œä»¥ä¸‹ä¸Šé¢å‘½ä»¤ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œéƒ½å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„æŠ¥é”™ä¿¡æ¯ã€‚</p><p><code>Aug 02 04:19:20 rhel7 named-checkconf[2297]: /etc/named.rfc1912.zones:51: missing &#39;;&#39; before &#39;}&#39;</code></p><p>è¿™æ¡æ—¥å¿—å‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨é…ç½®æ–‡ä»¶<code>/etc/named.rfc1912.zones</code>çš„ç¬¬51è¡Œä¸­ï¼Œ<code>&#39;}&#39;</code>å‰å°‘äº†ä¸€ä¸ª<code>&#39;;&#39;</code>ã€‚å› æ­¤æˆ‘ä»¬æ ¹æ®æ—¥å¿—ä¸­çš„æç¤ºå»ä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯ã€‚</p><h4 id="æœåŠ¡å¯åŠ¨ä¸äº†-1"><a href="#æœåŠ¡å¯åŠ¨ä¸äº†-1" class="headerlink" title="æœåŠ¡å¯åŠ¨ä¸äº†"></a>æœåŠ¡å¯åŠ¨ä¸äº†</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# systemctl status named</span><br><span class="line">named.service - Berkeley Internet Name Domain (DNS)</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/named.service; disabled)</span><br><span class="line">   Active: failed (Result: exit-code) since Tue 2016-08-02 04:50:39 EDT; 1min 42s ago</span><br><span class="line">  Process: 6541 ExecStartPre=/usr/sbin/named-checkconf -z /etc/named.conf (code=exited, status=1/FAILURE)</span><br><span class="line"></span><br><span class="line">Aug 02 04:50:39 rhel7 named-checkconf[6541]: zone 1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0...al 0</span><br><span class="line">Aug 02 04:50:39 rhel7 named-checkconf[6541]: zone 1.0.0.127.in-addr.arpa/IN: loaded serial 0</span><br><span class="line">Aug 02 04:50:39 rhel7 named-checkconf[6541]: zone 0.in-addr.arpa/IN: loaded serial 0</span><br><span class="line">Aug 02 04:50:39 rhel7 named-checkconf[6541]: zone uplooking.com/IN: loaded serial 20160802</span><br><span class="line">Aug 02 04:50:39 rhel7 named-checkconf[6541]: zone 19.25.172.in-addr.arpa/IN: loading from master file nam...ound</span><br><span class="line">Aug 02 04:50:39 rhel7 named-checkconf[6541]: zone 19.25.172.in-addr.arpa/IN: not loaded due to errors.</span><br><span class="line">Aug 02 04:50:39 rhel7 named-checkconf[6541]: _default/19.25.172.in-addr.arpa/IN: file not found</span><br><span class="line">Aug 02 04:50:39 rhel7 systemd[1]: named.service: control process exited, code=exited status=1</span><br><span class="line">Aug 02 04:50:39 rhel7 systemd[1]: Failed to start Berkeley Internet Name Domain (DNS).</span><br><span class="line">Aug 02 04:50:39 rhel7 systemd[1]: Unit named.service entered failed state.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# tail -n 15 /etc/named.rfc1912.zones</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone  "uplooking.com" IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file "named.uplooking";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">allow-transfer &#123; 172.25.19.10;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone "19.25.172.in-addr.arpa" IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file "named.uplooking.arpa";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">allow-transfer &#123; 172.25.19.10; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# ll /var/named/named*</span><br><span class="line">-rw-r-----. 1 root named  330 Aug  2 04:50 /var/named/named.arpa.uplooking</span><br><span class="line">-rw-r-----. 1 root named 2076 Jan 28  2013 /var/named/named.ca</span><br><span class="line">-rw-r-----. 1 root named  152 Dec 15  2009 /var/named/named.empty</span><br><span class="line">-rw-r-----. 1 root named  152 Jun 21  2007 /var/named/named.localhost</span><br><span class="line">-rw-r-----. 1 root named  168 Dec 15  2009 /var/named/named.loopback</span><br><span class="line">-rw-r-----. 1 root named  295 Aug  2 04:50 /var/named/named.uplooking</span><br></pre></td></tr></table></figure><p>ps:é—®é¢˜å‡ºåœ¨æ•°æ®æ–‡ä»¶åå’Œé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„æ•°æ®æ–‡ä»¶åä¸ä¸€è‡´ã€‚</p><p><code>file &quot;named.uplooking.arpa&quot;;</code></p><p><code>/var/named/named.arpa.uplooking</code></p><h4 id="ä¸»è¾…åŒæ­¥ç¼“å†²æ–‡ä»¶åªæœ‰ä¸€ä¸ª"><a href="#ä¸»è¾…åŒæ­¥ç¼“å†²æ–‡ä»¶åªæœ‰ä¸€ä¸ª" class="headerlink" title="ä¸»è¾…åŒæ­¥ç¼“å†²æ–‡ä»¶åªæœ‰ä¸€ä¸ª"></a>ä¸»è¾…åŒæ­¥ç¼“å†²æ–‡ä»¶åªæœ‰ä¸€ä¸ª</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# ll /var/named/slaves/</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 named named 386 Jan  1 02:46 uplooking123.zoo</span><br></pre></td></tr></table></figure><p>ps:åŸå› æ˜¯<code>/etc/named.rfc1912.zones</code>ä¸­çš„é…ç½®æœ‰é—®é¢˜ï¼ŒæŒ‡å®šç¼“å†²çš„ç›®å½•å†™å°‘äº†ä¸€ä¸ª<code>s</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">zone \"uplooking.com\" IN &#123;</span><br><span class="line">        type slave;</span><br><span class="line">        masters &#123; 172.25.33.11; &#125;;</span><br><span class="line">        file \"slave/uplooking.zone\";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">      &#125;;</span><br></pre></td></tr></table></figure><h4 id="ä¸»è¾…åŒæ­¥å°†ä»æœºçš„æ•°æ®æ–‡ä»¶æŒ‡å®šä½ç½®æ”¾åœ¨éslavesç›®å½•"><a href="#ä¸»è¾…åŒæ­¥å°†ä»æœºçš„æ•°æ®æ–‡ä»¶æŒ‡å®šä½ç½®æ”¾åœ¨éslavesç›®å½•" class="headerlink" title="ä¸»è¾…åŒæ­¥å°†ä»æœºçš„æ•°æ®æ–‡ä»¶æŒ‡å®šä½ç½®æ”¾åœ¨éslavesç›®å½•"></a>ä¸»è¾…åŒæ­¥å°†ä»æœºçš„æ•°æ®æ–‡ä»¶æŒ‡å®šä½ç½®æ”¾åœ¨éslavesç›®å½•</h4><p>ä»æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶æ”¾ç½®çš„ä½ç½®ä¸åœ¨slavesç›®å½•ä¸‹ï¼Œè€Œåœ¨å…¶ä»–ç›®å½•ä¸‹ï¼Œåˆ™åŒæ­¥ä¸æˆåŠŸã€‚<br>åŸå› ä»ä¸‰å¤„æ’æŸ¥</p><ul><li>é…ç½®æ–‡ä»¶</li><li>UGOæƒé™</li><li>selinuxæƒé™</li></ul><p>æ­¤å¤„æ˜¯ç”±äºselinuxçš„é—®é¢˜ï¼Œæˆ‘ä»¬å®‰è£…ä¸€ä¸ªå·¥å…·<code>setroubleshoot</code>å¸®åŠ©æˆ‘ä»¬åˆ†æ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Yum search setroubleshoot</span><br><span class="line">Yum -y install setroubleshoot</span><br><span class="line">Sealert -a audit.log</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°å…³äºå¸ƒå°”å€¼çš„ä¿¡æ¯å’Œå…³äºå®‰å…¨ä¸Šä¸‹æ–‡çš„ä¿¡æ¯:</p><ul><li>1ï¼‰è®¾ç½®å¸ƒå°”å€¼setsebool -P named_write_master_zones 1</li><li>2ï¼‰è®¾ç½®å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œé€šè¿‡man named_selinuxæˆ–è€…çœ‹ä¸€ä¸‹slavesç›®å½•çš„å®‰å…¨ä¸Šä¸‹æ–‡æ˜¯ä»€ä¹ˆ<br>æ ¹æ®slavesçš„å®‰å…¨ä¸Šä¸‹æ–‡å»æ”¹ã€‚<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Chcon -t named_zone_t test</span><br><span class="line">Chcon -u system_u  -r object_r  test</span><br></pre></td></tr></table></figure>ç„¶åå°†selinuxæ‰“å¼€ï¼Œå°†testä¸‹çš„ç›®å½•çš„åŒæ­¥è¿‡æ¥çš„æ–‡ä»¶ç»™åˆ é™¤ï¼Œé‡å¯æœåŠ¡ï¼Œçœ‹æ˜¯å¦è¢«åŒæ­¥è¿‡æ¥ã€‚</li></ul><p>åŒæ­¥æˆåŠŸã€‚</p><h4 id="å¦‚æœå¯åŠ¨æœåŠ¡æ—¶å€™å¤ªæ…¢"><a href="#å¦‚æœå¯åŠ¨æœåŠ¡æ—¶å€™å¤ªæ…¢" class="headerlink" title="å¦‚æœå¯åŠ¨æœåŠ¡æ—¶å€™å¤ªæ…¢"></a>å¦‚æœå¯åŠ¨æœåŠ¡æ—¶å€™å¤ªæ…¢</h4><p>å¯ä»¥ä½¿ç”¨<code>/usr/sbin/rndc-confgen -a -r /etc/named.conf</code></p><p>è¿™æ˜¯ä¸€ä¸ªç§˜é’¥åŠ å¯†äº§ç”Ÿçš„bug</p><h4 id="æœ‰é¡ºåºçš„æ‰¹é‡é…ç½®çš„å†™æ³•ï¼šï¼ˆç®€å•äº†è§£ä¸€ä¸‹ï¼‰"><a href="#æœ‰é¡ºåºçš„æ‰¹é‡é…ç½®çš„å†™æ³•ï¼šï¼ˆç®€å•äº†è§£ä¸€ä¸‹ï¼‰" class="headerlink" title="æœ‰é¡ºåºçš„æ‰¹é‡é…ç½®çš„å†™æ³•ï¼šï¼ˆç®€å•äº†è§£ä¸€ä¸‹ï¼‰"></a>æœ‰é¡ºåºçš„æ‰¹é‡é…ç½®çš„å†™æ³•ï¼šï¼ˆç®€å•äº†è§£ä¸€ä¸‹ï¼‰</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">GENERATE 1-100 stu$   A   172.25.0.$</span></span><br><span class="line"><span class="meta">$</span><span class="bash">GENERATE 1-200 $ PTR foundation$.ilt.example.com</span></span><br></pre></td></tr></table></figure><h4 id="ä»æœºæ•°æ®æ–‡ä»¶çš„æŸ¥çœ‹"><a href="#ä»æœºæ•°æ®æ–‡ä»¶çš„æŸ¥çœ‹" class="headerlink" title="ä»æœºæ•°æ®æ–‡ä»¶çš„æŸ¥çœ‹"></a>ä»æœºæ•°æ®æ–‡ä»¶çš„æŸ¥çœ‹</h4><p><strong>7ç‰ˆæœ¬ä¸Šæ— æ³•æŸ¥çœ‹</strong>ï¼šå› ä¸ºä»æœºåœ¨slavesç›®å½•ä¸‹ç”Ÿæˆçš„é…ç½®æ–‡ä»¶æ˜¯dataç±»å‹çš„ã€‚<br><strong>6ç‰ˆæœ¬ä¸Šå¯ä»¥æŸ¥çœ‹</strong>ï¼šè€ç‰ˆæœ¬æ˜¯å¯ä»¥æŸ¥çœ‹çš„ã€‚</p><hr><h3 id="é…ç½®æ–‡ä»¶è¯¦ç»†è§£æ"><a href="#é…ç½®æ–‡ä»¶è¯¦ç»†è§£æ" class="headerlink" title="é…ç½®æ–‡ä»¶è¯¦ç»†è§£æ"></a>é…ç½®æ–‡ä»¶è¯¦ç»†è§£æ</h3><h4 id="ä¸»é…ç½®æ–‡ä»¶-etc-named-conf"><a href="#ä¸»é…ç½®æ–‡ä»¶-etc-named-conf" class="headerlink" title="ä¸»é…ç½®æ–‡ä»¶/etc/named.conf"></a>ä¸»é…ç½®æ–‡ä»¶/etc/named.conf</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Options å…¨å±€çš„é…ç½®è¡Œ   </span><br><span class="line">options &#123;Â //æœåŠ¡å™¨çš„å…¨å±€é…ç½®é€‰é¡¹åŠä¸€äº›é»˜è®¤è®¾ç½®</span><br><span class="line">Â  Â Â  Â Â Â listen-on port 53 &#123; any; &#125;;Â //ç›‘å¬ç«¯å£é»˜è®¤ç›‘å¬53å·ç«¯å£ï¼Œä¹Ÿå¯å†™ä¸º &#123; 127.0.0.1; 192.168.139.46; &#125;</span><br><span class="line">Â  Â Â  Â Â Â listen-on-v6 port 53 &#123; ::1; &#125;;Â //å¯¹ip6æ”¯æŒ</span><br><span class="line">Â  Â Â  Â Â Â directoryÂ  Â Â  Â  "/var/named";Â Â //åŒºåŸŸæ–‡ä»¶å­˜å‚¨ç›®å½•</span><br><span class="line">Â  Â Â  Â Â Â dump-fileÂ  Â Â  Â  "/var/named/data/cache_dump.db";Â //ç¼“å­˜çš„ç›®å½•directory</span><br><span class="line">Â  Â Â  Â Â Â statistics-file "/var/named/data/named_stats.txt";  // çŠ¶æ€ä¿¡æ¯æ–‡ä»¶</span><br><span class="line">Â  Â Â  Â Â Â memstatistics-file "/var/named/data/named_mem_stats.txt";   //å†…å­˜ä¿¡æ¯æ–‡ä»¶</span><br><span class="line">Â  Â Â  Â Â Â pid-fileÂ  Â Â  Â Â Â "/var/run/named/named.pid";Â //å­˜ç€namedçš„pid</span><br><span class="line">Â  Â Â  Â Â Â forwardersÂ  Â Â Â &#123; 168.95.1.1; 139.175.10.20; &#125;;Â // å¦‚æœåŸŸåæœåŠ¡å™¨æ— æ³•è§£ææ—¶ï¼Œå°†è¯·æ±‚äº¤ç”±168.95.1.1; 139.175.10.20æ¥è§£æ</span><br><span class="line">Â  Â Â  Â Â Â allow-queryÂ  Â  &#123; any; &#125;;Â  Â //æŒ‡å®šå…è®¸è¿›è¡ŒæŸ¥è¯¢çš„ä¸»æœºï¼Œå½“ç„¶æ˜¯è¦æ‰€æœ‰çš„ç”µè„‘éƒ½å¯ä»¥æŸ¥å•¦</span><br><span class="line">Â  Â Â  Â Â Â allow-transfer &#123; none; &#125;;Â //æŒ‡å®šå…è®¸æ¥å—åŒºåŸŸä¼ é€è¯·æ±‚çš„ä¸»æœºï¼Œè¯´æ˜ç™½ä¸€ç‚¹å°±æ˜¯è¾…dnså®šä¹‰ï¼Œæ¯”å¦‚è¾…dnsçš„ipæ˜¯192.168.139.5ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·å®šä¹‰&#123; 192.168.139.5; &#125;ï¼Œè¦ä¸ç„¶ä¸»è¾…dnsä¸èƒ½åŒæ­¥ï¼Œå½“ç„¶ï¼Œ&#123;&#125;é‡Œçš„ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢æåˆ°çš„aclã€‚</span><br><span class="line">Â  Â Â  Â Â Â // those options should be used carefully because they disable port</span><br><span class="line">Â  Â Â  Â Â Â // randomization</span><br><span class="line">Â  Â Â  Â Â Â // query-sourceÂ  Â  port 53;Â  Â Â Â </span><br><span class="line">Â  Â Â  Â Â Â // query-source-v6 port 53;</span><br><span class="line">Dnssecå¼€å¤´çš„æ˜¯ä¸€äº›åŠ å¯†æ–‡ä»¶</span><br><span class="line">Xxxx.keyæ˜¯ä¸€äº›ç§˜é’¥æ–‡ä»¶</span><br><span class="line">&#125;;</span><br><span class="line">logging &#123;Â //æŒ‡å®šæœåŠ¡å™¨æ—¥å¿—è®°å½•çš„å†…å®¹å’Œæ—¥å¿—ä¿¡æ¯æ¥æº</span><br><span class="line">Â  Â Â  Â Â Â channel default_debug &#123;</span><br><span class="line">Â  Â Â  Â Â  Â Â  Â Â  Â  file "data/named.run";</span><br><span class="line">Â  Â Â  Â Â  Â Â  Â Â  Â  severity dynamic;</span><br><span class="line">Â  Â Â  Â Â Â &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">zone "." IN &#123;Â //åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ˜¯ç”¨zoneå…³é”®å­—æ¥å®šä¹‰åŸŸåŒºçš„ï¼Œä¸€ä¸ªzoneå…³é”®å­—å®šä¹‰ä¸€ä¸ªåŸŸåŒºÂ </span><br><span class="line">type hint;Â </span><br><span class="line">/*åœ¨è¿™é‡Œtypeç±»å‹æœ‰ä¸‰ç§ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯master,slaveå’Œhintå®ƒä»¬çš„å«ä¹‰åˆ†åˆ«æ˜¯ï¼šÂ </span><br><span class="line">master:è¡¨ç¤ºå®šä¹‰çš„æ˜¯ä¸»åŸŸåæœåŠ¡å™¨Â </span><br><span class="line">slave :è¡¨ç¤ºå®šä¹‰çš„æ˜¯è¾…åŠ©åŸŸåæœåŠ¡å™¨Â </span><br><span class="line">hint:è¡¨ç¤ºæ˜¯äº’è”ç½‘ä¸­æ ¹åŸŸåæœåŠ¡å™¨Â </span><br><span class="line">*/Â </span><br><span class="line">Include  "/etc/named.rfc1912.conf"</span><br><span class="line">Include  "/etc/named.root.key"  //ä¸¤ä¸ªincludeå­—æ®µä»£è¡¨è¯»å–æœ¬é…ç½®æ–‡ä»¶æ—¶å€™åŒæ—¶è¯»å–/etc/named.rfc1912.confå’Œ/etc/named.root.keyæ–‡ä»¶ï¼Œè¿™é‡Œä¸»è¦å…³æ³¨ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯ä¸“é—¨ç”¨äºå®šä¹‰åŸŸçš„æ–‡ä»¶ã€‚</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><code>allow-query-cache</code>ä¸»è¾…åŒæ­¥æ—¶:</strong></p><ul><li>6ç‰ˆæœ¬ä¸Šå¿…é¡»åŠ ä¸Š ä¸ç„¶ä¼šæŠ¥é”™</li><li>7ç‰ˆæœ¬ä¸ç”¨</li></ul><p><strong><code>recursion</code>ä¸»è¾…åŒæ­¥æ—¶</strong> å¿…é¡»æ˜¯yesï¼Œå…³æ‰ä¹‹åä¼šé˜»æ­¢æ–°çºªå½•è¿›å…¥åˆ°ç¼“å†²ã€‚</p><h4 id="named-rfc1912-conf"><a href="#named-rfc1912-conf" class="headerlink" title="named.rfc1912.conf"></a>named.rfc1912.conf</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Zone "åŸŸå "IN &#123;</span><br><span class="line">File ;åŸŸå¯¹åº”çš„æ•°æ®æ–‡ä»¶</span><br><span class="line">Allow-update ;æ˜¯å¦éœ€è¦æ›´æ–°</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><ol><li>æ‰€æœ‰è¯­å¥ç»“æŸåéƒ½éœ€è¦ä¸€ä¸ªåˆ†å·ä»£è¡¨ç»“æŸç¬¦</li><li>æ‹¬å·å¿…é¡»æˆå¯¹å‡ºç°</li><li>fileæŒ‡å‘çš„æ•°æ®æ–‡ä»¶å†™çš„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œç›¸å¯¹äºä¸»é…ç½®æ–‡ä»¶çš„dirctoryé…ç½®å­—æ®µï¼Œå³ç›¸å¯¹äº/var/namedç›®å½•ã€‚</li></ol><p><strong>ä¸»è¾…åŒæ­¥ä¸­slaveéœ€è¦çš„é…ç½®</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Zone "åŸŸå" IN &#123;</span><br><span class="line">Type slave;</span><br><span class="line">Masters &#123; 172.25.0.11;&#125; ;</span><br><span class="line">File "slaves/test.com.zone";</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ•°æ®æ–‡ä»¶-var-named-named-localhost"><a href="#æ•°æ®æ–‡ä»¶-var-named-named-localhost" class="headerlink" title="æ•°æ®æ–‡ä»¶/var/named/named.localhost"></a>æ•°æ®æ–‡ä»¶/var/named/named.localhost</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">TTL //ä»£è¡¨å‘¨æœŸï¼Œç¼“å­˜æ—¶é—´ï¼ŒDNSä¼šè‡ªå·±åšç¼“å­˜ï¼Œ1Då°±ä»£è¡¨ä¸€å¤©ï¼Œç¼“å­˜æ—¶é—´ä¸ºä¸€å¤©ã€‚</span><br><span class="line">SOA //è®°å½•  --&gt;èµ·å§‹æˆæƒè®°å½•  @ä»£è¡¨ç»§æ‰¿åŸŸå  </span><br><span class="line">IN  SOA @ ç”¨æˆ·å.åŸŸå  &#123;</span><br><span class="line">     0;serial    //åºåˆ—å·ï¼›ä¸€èˆ¬å†™ä¿®æ”¹å½“å¤©æ—¥æœŸï¼Œä»æœåŠ¡å™¨æ ¹æ®è¯¥åºåˆ—å·æ¥åˆ¤å®šæ–‡ä»¶æ˜¯å¦ä¿®æ”¹è¿‡ã€‚</span><br><span class="line">     1Dï¼›refresh  // å¤šä¹…åšä¸€æ¬¡åŒæ­¥</span><br><span class="line">     1Hï¼›retry    //é‡ç½®æ—¶é—´ï¼ŒåŒæ­¥ä¸æˆåŠŸæ—¶ï¼Œé—´éš”å¤šä¹…é‡æ–°åšä¸€æ¬¡åŒæ­¥</span><br><span class="line">     1Wï¼›expire   //å½“é‡å¤åŒæ­¥ä¸æˆåŠŸæ—¶ï¼Œå¤šä¹…ä¸å†åšåŒæ­¥ã€‚</span><br><span class="line"> 3Hï¼›minimun  //æœ€å°ç¼“å­˜æ—¶é—´ï¼Œä¸€èˆ¬æ˜¯é”™è¯¯ç¼“å­˜ã€‚å‡è®¾æœ‰ä¸€ä¸ªäººï¼Œä¸€ç›´é—®æˆ‘ä¸€ä¸ªé”™è¯¯çš„åŸŸåï¼Œé‚£æˆ‘å°±ä¼šå°†è¯¥é”™è¯¯çš„åŸŸåç¼“å­˜ä¸‹æ¥ï¼Œ</span><br><span class="line">å½“äººå†æ¥é—®æˆ‘æ—¶ï¼Œæˆ‘å°±ä¸å†æœå¯»ï¼Œè€Œå°†è¯¥ç»“æœåé¦ˆç»™ä»–ã€‚</span><br><span class="line"></span><br><span class="line">è¿™é‡Œå°†serialä¸€åˆ—æ”¹ä¸ºå½“å‰æ—¥æœŸã€‚</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NSä»£è¡¨çš„æ˜¯æ­£å‘è®°å½•  ï¼Œè§£æè¿˜åˆ†æˆæ­£å‘è§£æå’Œåå‘è§£æï¼Œæ­£å‘è§£æå°±æ˜¯çŸ¥é“ä¸»æœºåï¼Œæƒ³è¦æœå¯»IPåœ°å€ã€‚è¿™é‡Œå…ˆæ¥çœ‹æ­£å‘è§£æ</span><br><span class="line"></span><br><span class="line">@ä»£è¡¨ç»§æ‰¿åŸŸå</span><br><span class="line">   NS    @</span><br><span class="line">   A    127.0.0.1    </span><br><span class="line">è¿™å¥è¯ä»£è¡¨ï¼Œæˆ‘çš„åŸŸåæ˜¯localhostï¼ŒlocalhostæŒ‡å‘çš„æ˜¯127.0.0.1</span><br><span class="line">å¦‚æœä¸å†™@è€Œå†™æˆåŸŸåï¼Œå°±åº”è¯¥å†™æˆtest.com.   Comåé¢å¿…é¡»æœ‰ä¸ªç‚¹ï¼Œä»£è¡¨æ ¹åŸŸçš„æ„æ€ã€‚</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æŒæ¡å®è·µé¡¹ç›®<br><img src="pic/02.png" alt="02"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;è¯¾ç¨‹è¦æ±‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸€å°åŸŸåè§£ææœåŠ¡å™¨DNSæ­£åè§£æ&lt;/li&gt;
&lt;li&gt;åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸¤å°åŸŸåè§£ææœåŠ¡å™¨åšDNSä¸»è¾…åŒæ­¥&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;DNSæœåŠ¡&quot;&gt;&lt;a href=
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/Linux%E7%AE%80%E6%98%93%E6%9C%8D%E5%8A%A1%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="LinuxåŸºç¡€æœåŠ¡" scheme="http://www.toberoot.com/tags/Linux%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>SAMBAæ–‡ä»¶å…±äº«æœåŠ¡</title>
    <link href="http://www.toberoot.com/2016/12/23/booboo_easy_service/04_samba/"/>
    <id>http://www.toberoot.com/2016/12/23/booboo_easy_service/04_samba/</id>
    <published>2016-12-22T21:06:27.000Z</published>
    <updated>2020-03-24T05:02:31.702Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Sambaçš„å†å²åŠåŸç†"><a href="#Sambaçš„å†å²åŠåŸç†" class="headerlink" title="Sambaçš„å†å²åŠåŸç†"></a>Sambaçš„å†å²åŠåŸç†</h3><p>åœ¨æ—©æœŸçš„ç½‘ç»œä¸–ç•Œä¸­ï¼Œæ–‡ä»¶æ•°æ®åœ¨ä¸åŒä¸»æœºä¹‹é—´çš„ä¼ è¾“å¤§å¤šæ˜¯ä½¿ç”¨FTPè¿™ä¸ªå¥½ç”¨çš„æœåŠ¡å™¨è½¯ä»¶è¿›è¡Œçš„ã€‚ä¸è¿‡ï¼Œä½¿ç”¨FTPä¼ è¾“æ–‡ä»¶å´æœ‰ä¸ªå°å°çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯æ‚¨æ— æ³•ç›´æ¥ä¿®æ”¹ä¸»æœºä¸Šé¢çš„æ–‡ä»¶æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨æƒ³è¦æ›´æ”¹Linuxä¸»æœºä¸Šé¢çš„æŸä¸ªæ–‡ä»¶æ—¶ï¼Œå¿…é¡»è¦ç”±æœåŠ¡å™¨ç«¯å°†è¯¥æ–‡ä»¶ä¸‹è½½åˆ°æ‚¨å·¥ä½œçš„å®¢æˆ·ç«¯åæ‰èƒ½ä¿®æ”¹ï¼Œå› æ­¤è¯¥æ–‡ä»¶åœ¨æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯éƒ½ä¼šå­˜åœ¨ã€‚è¿™æ—¶ï¼Œå¦‚æœæœ‰ä¸€å¤©æ‚¨ä¿®æ”¹äº†æŸä¸ªæ–‡ä»¶ï¼Œå´å¿˜è®°å°†æ•°æ®ä¸Šä¼ å›ä¸»æœºï¼Œé‚£ä¹ˆç­‰è¿‡äº†ä¸€é˜µå­ä¹‹åï¼Œæ‚¨å¦‚ä½•çŸ¥é“å“ªæ—¢ç„¶æœ‰è¿™æ ·çš„é—®é¢˜ï¼Œé‚£å¥½å§ï¼Œæˆ‘å¯ä¸å¯ä»¥åœ¨å®¢æˆ·ç«¯çš„æœºå™¨ä¸Šé¢ç›´æ¥å–ç”¨æœåŠ¡å™¨ä¸Šé¢çš„æ–‡ä»¶ï¼Ÿå¦‚æœå¯ä»¥åœ¨å®¢æˆ·ç«¯ç›´æ¥è¿›è¡ŒæœåŠ¡å™¨ç«¯æ–‡ä»¶çš„è®¿é—®ï¼Œé‚£ä¹ˆæˆ‘åœ¨å®¢æˆ·ç«¯å°±ä¸éœ€è¦å­˜åœ¨è¯¥æ–‡ä»¶æ•°æ®äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘åªè¦æœ‰æœåŠ¡å™¨ä¸Šé¢çš„æ–‡ä»¶æ•°æ®å­˜åœ¨å°±å¯ä»¥äº†ã€‚æœ‰æ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆFile Systemï¼‰å‘¢ï¼Ÿå‰é¢æˆ‘ä»¬æåˆ°è¿‡çš„Network File Systemï¼ˆNFSï¼‰å°±æ˜¯è¿™æ ·çš„æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸€ã€‚åªè¦åœ¨å®¢æˆ·ç«¯å°†æœåŠ¡å™¨ç«¯æ‰€æä¾›çš„å…±äº«ç›®å½•æŒ‚è½½è¿›æ¥ï¼Œé‚£ä¹ˆåœ¨æˆ‘çš„å®¢æˆ·ç«¯å°±å¯ä»¥ç›´æ¥å–ç”¨æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶æ•°æ®ï¼Œè€Œä¸”ï¼Œè¯¥æ•°æ®å°±åƒæ˜¯å®¢æˆ·ç«¯ä¸Šçš„åˆ†åŒºä¸€æ ·ï¼Œéå¸¸å¥½ç”¨ï¼è€Œé™¤äº†å¯ä»¥è®©Unix Likeçš„æœºå™¨äº’ç›¸åˆ†äº«æ–‡ä»¶çš„NFSæœåŠ¡å™¨ä¹‹å¤–ï¼Œåœ¨å¾®è½¯ï¼ˆMicrosoftï¼‰ä¸Šé¢ä¹Ÿæœ‰ç±»ä¼¼çš„æ–‡ä»¶ç³»ç»Ÿï¼Œé‚£å°±æ˜¯Common Internet File Systemï¼ˆCIFSï¼‰ã€‚CIFSæœ€ç®€å•çš„ç”¨é€”å°±æ˜¯ç›®å‰å¸¸è§çš„â€œç½‘ä¸Šé‚»å±…â€ã€‚Windowsç³»ç»Ÿçš„è®¡ç®—æœºå¯ä»¥é€šè¿‡æ¡Œé¢ä¸Šçš„â€œç½‘ä¸Šé‚»å±…â€æ¥è®¿é—®åˆ«äººæ‰€æä¾›çš„æ–‡ä»¶æ•°æ®ã€‚ä¸è¿‡ï¼ŒNFSä»…èƒ½è®©Unixæœºå™¨æ²Ÿé€šï¼ŒCIFSåªèƒ½è®©Windowsæœºå™¨æ²Ÿé€šã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰è®©Windowsä¸Unix Likeè¿™ä¸¤ä¸ªä¸åŒçš„å¹³å°ç›¸äº’åˆ†äº«æ–‡ä»¶æ•°æ®çš„æ–‡ä»¶ç³»ç»Ÿå‘¢ï¼Ÿä¸ªæ–‡ä»¶æ‰æ˜¯æœ€æ–°çš„ï¼Ÿ</p><p>åœ¨1991å¹´ï¼Œä¸€ä¸ªåå«Andrew Tridgwellçš„å¤§å­¦ç”Ÿå°±æœ‰è¿™æ ·çš„å›°æ‰°ï¼Œä»–æ‰‹ä¸Šæœ‰ä¸‰å°æœºå™¨ï¼Œåˆ†åˆ«æ˜¯è¿è¡ŒDOSçš„ä¸ªäººè®¡ç®—æœºã€DECå…¬å¸çš„Digital Unixç³»ç»Ÿä»¥åŠSunçš„Unixç³»ç»Ÿã€‚åœ¨å½“æ—¶ï¼ŒDEC å…¬å¸å¼€å‘å‡ºä¸€å¥—ç§°ä¸ºPATHWORKSçš„è½¯ä»¶ï¼Œè¿™å¥—è½¯ä»¶å¯ä»¥ç”¨æ¥åˆ†äº«DECçš„Unixä¸ä¸ªäººè®¡ç®—æœºçš„DOSè¿™ä¸¤ä¸ªæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æ•°æ®ï¼Œå¯æƒœè®©Tridgwellè§‰å¾—è¾ƒå›°æ‰°çš„æ˜¯Sunçš„Unixæ— æ³•é€šè¿‡è¿™ä¸ªè½¯ä»¶æ¥è¾¾åˆ°æ–‡ä»¶å…±äº«çš„ç›®çš„ã€‚è¿™ä¸ªæ—¶å€™Tridgwellå°±æƒ³ï¼šâ€œå’¦ï¼æ—¢ç„¶è¿™ä¸¤å°ç³»ç»Ÿå¯ä»¥å…±äº«ï¼Œæ²¡é“ç†Sunå°±å¿…é¡»è¿™ä¹ˆè‹¦å‘½å§ï¼Ÿå¯ä¸å¯ä»¥å°†è¿™ä¸¤ä¸ªç³»ç»Ÿçš„å·¥ä½œåŸç†æ‰¾å‡ºæ¥ï¼Œç„¶åè®©Sunæœºå™¨ä¹Ÿèƒ½å¤Ÿå…±äº«æ–‡ä»¶æ•°æ®å‘¢ï¼Ÿâ€ï¼Œä¸ºäº†è§£å†³è¿™æ ·çš„çš„é—®é¢˜ï¼ŒTridgwellå°±è‡ªè¡Œç¼–å†™äº†ä¸€ä¸ªç¨‹åºå»æ£€æµ‹å½“DOSä¸DECçš„Unixç³»ç»Ÿåœ¨è¿›è¡Œæ–‡ä»¶åˆ†äº«ä¼ è¾“æ—¶æ‰€ä½¿ç”¨åˆ°çš„é€šä¿¡åè®®ä¿¡æ¯ï¼Œç„¶åè·å–è¿™äº›é‡è¦çš„ä¿¡æ¯ï¼Œå¹¶ä¸”åŸºäºä¸Šè¿°æ‰€æ‰¾åˆ°çš„é€šä¿¡åè®®è€Œå¼€å‘å‡ºServer Message Blockï¼ˆSMBï¼‰è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè€Œå°±æ˜¯è¿™å¥—SMBè½¯ä»¶å°±èƒ½å¤Ÿè®©Unixä¸DOSäº’ç›¸å…±äº«æ–‡ä»¶ã€‚</p><p>æ—¢ç„¶å†™æˆäº†è½¯ä»¶ï¼Œæ€»éœ€è¦æ³¨å†Œå•†æ ‡ï¼Œå› æ­¤Tridgwellå°±ç”³è¯·SMB Serverä½œä¸ºè¯¥è½¯ä»¶çš„å•†æ ‡ã€‚å¯æƒœå› ä¸ºSMBæ˜¯æ²¡æœ‰æ„ä¹‰çš„æ–‡å­—ï¼Œæ²¡æœ‰åŠæ³•è¾¾æˆæ³¨å†Œã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œèƒ½ä¸èƒ½åœ¨å­—å…¸é‡Œé¢æ‰¾åˆ°ç›¸å…³çš„å­—è¯å¯ä»¥ä½œä¸ºå•†æ ‡æ¥æ³¨å†Œå‘¢ï¼Ÿç¿»äº†è€åŠå¤©ï¼Œå‘ç°SAMBAåˆšå¥½å«æœ‰SMBï¼Œåˆæ˜¯çƒ­æƒ…æœ‰åŠ²çš„æ‹‰ä¸èˆè¹ˆçš„åç§°ï¼Œä¸ç„¶å°±ç”¨è¿™ä¸ªåå­—æ¥ä½œä¸ºå•†æ ‡å¥½äº†ã€‚è¿™æˆä¸ºæˆ‘ä»¬ä»Šå¤©æ‰€ä½¿ç”¨çš„SAMBAçš„åç§°çš„ç”±æ¥ã€‚</p><h3 id="Sambaçš„ä½œç”¨"><a href="#Sambaçš„ä½œç”¨" class="headerlink" title="Sambaçš„ä½œç”¨"></a>Sambaçš„ä½œç”¨</h3><p>ä½œç”¨ï¼šwindowså’Œç±»unixç³»ç»Ÿæ–‡ä»¶å…±äº«æœåŠ¡</p><h3 id="Sambaçš„è½¯ä»¶ç»“æ„"><a href="#Sambaçš„è½¯ä»¶ç»“æ„" class="headerlink" title="Sambaçš„è½¯ä»¶ç»“æ„"></a>Sambaçš„è½¯ä»¶ç»“æ„</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡ç«¯linux</span></span><br><span class="line"></span><br><span class="line">è½¯ä»¶samba samba-common</span><br><span class="line">servicenmbsmb</span><br><span class="line">daemonnmbdsmbd</span><br><span class="line">ç«¯å£137 138|139 445</span><br><span class="line">é…ç½®æ–‡ä»¶/etc/samba/smb.conf</span><br><span class="line">æ•°æ®æ–‡ä»¶/var/lib/samba</span><br><span class="line">æ—¥å¿—æ–‡ä»¶/var/log/samba</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯linux</span></span><br><span class="line">è½¯ä»¶samba-client</span><br><span class="line">å‘½ä»¤smbclient</span><br><span class="line">smbclient -L ip -U username</span><br><span class="line">smbpasswd -a username</span><br><span class="line">smbpasswd username</span><br><span class="line">smbclient //172.25.0.11/å…±äº«å</span><br><span class="line">smbclient //172.25.0.11/å…±äº«å -U student</span><br><span class="line">mount -t cifs //172.25.15.11/å…±äº«å /mnt -o guest</span><br><span class="line">mount -t cifs //172.25.15.11/å…±äº«å /mnt -o username=student</span><br></pre></td></tr></table></figure><h3 id="é¡¹ç›®å®è·µ1ï¼šé…ç½®sambaå…±äº«"><a href="#é¡¹ç›®å®è·µ1ï¼šé…ç½®sambaå…±äº«" class="headerlink" title="é¡¹ç›®å®è·µ1ï¼šé…ç½®sambaå…±äº«"></a>é¡¹ç›®å®è·µ1ï¼šé…ç½®sambaå…±äº«</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br></pre></td><td class="code"><pre><span class="line">ç³»ç»Ÿç”¨æˆ·</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line">æœåŠ¡å™¨ç«¯rhel6</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line">[root@rhel6 ~]# yum install -y samba samba-common</span><br><span class="line">[root@rhel6 ~]# service iptables stop</span><br><span class="line">iptables: Setting chains to policy ACCEPT: filter          [  OK  ]</span><br><span class="line">iptables: Flushing firewall rules:                         [  OK  ]</span><br><span class="line">iptables: Unloading modules:                               [  OK  ]</span><br><span class="line">[root@rhel6 ~]#</span><br><span class="line">[root@rhel6 ~]# service smb start</span><br><span class="line">Starting SMB services:                                     [  OK  ]</span><br><span class="line">[root@rhel6 ~]# service nmb start</span><br><span class="line">Starting NMB services:                                     [  OK  ]</span><br><span class="line">[root@rhel6 ~]# id student</span><br><span class="line">uid=500(student) gid=500(student) groups=500(student)</span><br><span class="line">[root@rhel6 ~]# which smbpasswd</span><br><span class="line">/usr/bin/smbpasswd</span><br><span class="line">[root@rhel6 ~]# smbpasswd -a student</span><br><span class="line">New SMB password:</span><br><span class="line">Retype new SMB password:</span><br><span class="line">Added user student.</span><br><span class="line">[root@rhel6 ~]# getsebool -a|grep samba</span><br><span class="line">samba_create_home_dirs --&gt; off</span><br><span class="line">samba_domain_controller --&gt; off</span><br><span class="line">samba_enable_home_dirs --&gt; off</span><br><span class="line">samba_export_all_ro --&gt; off</span><br><span class="line">samba_export_all_rw --&gt; off</span><br><span class="line">samba_portmapper --&gt; off</span><br><span class="line">samba_run_unconfined --&gt; off</span><br><span class="line">samba_share_fusefs --&gt; off</span><br><span class="line">samba_share_nfs --&gt; off</span><br><span class="line">sanlock_use_samba --&gt; off</span><br><span class="line">use_samba_home_dirs --&gt; off</span><br><span class="line">virt_use_samba --&gt; off</span><br><span class="line">[root@rhel6 ~]# setsebool -P samba_enable_home_dirs 1</span><br><span class="line">[root@rhel6 ~]# getsebool -a|grep samba</span><br><span class="line">samba_create_home_dirs --&gt; off</span><br><span class="line">samba_domain_controller --&gt; off</span><br><span class="line">samba_enable_home_dirs --&gt; on</span><br><span class="line">samba_export_all_ro --&gt; off</span><br><span class="line">samba_export_all_rw --&gt; off</span><br><span class="line">samba_portmapper --&gt; off</span><br><span class="line">samba_run_unconfined --&gt; off</span><br><span class="line">samba_share_fusefs --&gt; off</span><br><span class="line">samba_share_nfs --&gt; off</span><br><span class="line">sanlock_use_samba --&gt; off</span><br><span class="line">use_samba_home_dirs --&gt; off</span><br><span class="line">virt_use_samba --&gt; off</span><br><span class="line">-----------------------------------</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯linuxâ€”â€”ç±»ä¼¼ftpçš„æ–¹å¼è®¿é—®</span></span><br><span class="line">[root@rhel7 ~]# systemctl stop firewalld</span><br><span class="line">[root@rhel7 ~]# yum install -y samba-client</span><br><span class="line">[root@rhel7 ~]# smbclient -L 172.25.0.11</span><br><span class="line">Enter root\'s password:</span><br><span class="line">Anonymous login successful</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line"></span><br><span class="line">Sharename       Type      Comment</span><br><span class="line">---------       ----      -------</span><br><span class="line"><span class="meta">IPC$</span><span class="bash">            IPC       IPC Service (Samba Server Version 3.6.9-164.el6)</span></span><br><span class="line">Anonymous login successful</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line"></span><br><span class="line">Server               Comment</span><br><span class="line">---------            -------</span><br><span class="line">RHEL6                Samba Server Version 3.6.9-164.el6</span><br><span class="line"></span><br><span class="line">Workgroup            Master</span><br><span class="line">---------            -------</span><br><span class="line">MYGROUP              RHEL6</span><br><span class="line">[root@rhel7 ~]# smbclient -L 172.25.0.11 -U student</span><br><span class="line">Enter student\'s password:</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line"></span><br><span class="line">Sharename       Type      Comment</span><br><span class="line">---------       ----      -------</span><br><span class="line"><span class="meta">IPC$</span><span class="bash">            IPC       IPC Service (Samba Server Version 3.6.9-164.el6)</span></span><br><span class="line">student         Disk      Home Directories</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line"></span><br><span class="line">Server               Comment</span><br><span class="line">---------            -------</span><br><span class="line">RHEL6                Samba Server Version 3.6.9-164.el6</span><br><span class="line"></span><br><span class="line">Workgroup            Master</span><br><span class="line">---------            -------</span><br><span class="line">MYGROUP              RHEL6</span><br><span class="line">[root@rhel7 ~]# smbclient //172.25.0.11/student -U student</span><br><span class="line">Enter student\'s password:</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line">smb: \&gt;</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">NT_STATUS_ACCESS_DENIED listing \*</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        0  Thu Jul  2 04:01:16 2015</span><br><span class="line">  ..                                  D        0  Thu Jul  2 03:57:29 2015</span><br><span class="line">  .ssh                               DH        0  Thu Jul  2 04:01:07 2015</span><br><span class="line">  .bashrc                             H      124  Tue Jul  9 09:24:50 2013</span><br><span class="line">  .bash_logout                        H       18  Tue Jul  9 09:24:50 2013</span><br><span class="line">  .mozilla                           DH        0  Thu Jul  2 03:36:20 2015</span><br><span class="line">  .bash_history                       H        5  Thu Jul  2 04:01:16 2015</span><br><span class="line">  .gnome2                            DH        0  Wed Jul 14 11:55:40 2010</span><br><span class="line">  .bash_profile                       H      176  Tue Jul  9 09:24:50 2013</span><br><span class="line"></span><br><span class="line">49584 blocks of size 8192. 45708 blocks available</span><br><span class="line">smb: \&gt; exit</span><br><span class="line">-------------------------------------------------------------</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯windows</span></span><br><span class="line">æ‰“å¼€æµè§ˆå™¨è¾“å…¥\\172.25.0.11\</span><br><span class="line">è¾“å…¥studentå’Œuplookingå¯†ç åå°±å¯ä»¥è¿›å…¥æœåŠ¡å™¨ä¸­çš„ç”¨æˆ·å®¶ç›®å½•ï¼Œåˆ›å»ºç›®å½•aaï¼Œä»¥åŠæ–‡ä»¶aaä¸‹çš„dd.txt</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯linux</span></span><br><span class="line">[root@rhel7 ~]# smbclient //172.25.0.11/student -U student</span><br><span class="line">Enter student\'s password:</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        0  Thu Aug  4 04:30:31 2016</span><br><span class="line">  ..                                  D        0  Thu Jul  2 03:57:30 2015</span><br><span class="line">  .ssh                               DH        0  Thu Jul  2 04:01:07 2015</span><br><span class="line">  aa                                  D        0  Thu Aug  4 04:30:28 2016</span><br><span class="line">  .bashrc                             H      124  Tue Jul  9 09:24:50 2013</span><br><span class="line">  .bash_logout                        H       18  Tue Jul  9 09:24:50 2013</span><br><span class="line">  .mozilla                           DH        0  Thu Jul  2 03:36:20 2015</span><br><span class="line">  .bash_history                       H        5  Thu Jul  2 04:01:16 2015</span><br><span class="line">  .gnome2                            DH        0  Wed Jul 14 11:55:40 2010</span><br><span class="line">  .bash_profile                       H      176  Tue Jul  9 09:24:50 2013</span><br><span class="line"></span><br><span class="line">49584 blocks of size 8192. 45707 blocks available</span><br><span class="line">smb: \&gt; get aa</span><br><span class="line">NT_STATUS_FILE_IS_A_DIRECTORY opening remote file \aa</span><br><span class="line">smb: \&gt; cd aa</span><br><span class="line">smb: \aa\&gt; ls</span><br><span class="line">  .                                   D        0  Thu Aug  4 04:30:28 2016</span><br><span class="line">  ..                                  D        0  Thu Aug  4 04:30:31 2016</span><br><span class="line">  dd.txt                              A        2  Thu Aug  4 04:31:01 2016</span><br><span class="line"></span><br><span class="line">49584 blocks of size 8192. 45707 blocks available</span><br><span class="line">smb: \aa\&gt; get dd.txt</span><br><span class="line">getting file \aa\dd.txt of size 2 as dd.txt (1.0 KiloBytes/sec) (average 1.0 KiloBytes/sec)</span><br><span class="line">å¯ä»¥æŸ¥çœ‹åˆ°äº†ã€‚</span><br><span class="line"></span><br><span class="line">********************************************************************</span><br><span class="line">=====================================================================</span><br><span class="line">åŒ¿åç”¨æˆ·</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line">æœåŠ¡å™¨ç«¯rhel6</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line"></span><br><span class="line">1.åˆ›å»ºå…±äº«ç›®å½•/var/lib/samba/share</span><br><span class="line">[root@rhel6 ~]# mkdir /var/lib/samba/share</span><br><span class="line">2.ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@rhel6 ~]# vim /etc/samba/smb.conf</span><br><span class="line">[public]</span><br><span class="line">       comment = Public Stuff</span><br><span class="line">       path = /var/lib/samba/share</span><br><span class="line">       public = yes</span><br><span class="line">       writable = yes</span><br><span class="line">3.é‡å¯æœåŠ¡</span><br><span class="line">[root@rhel6 ~]# service smb restart</span><br><span class="line">Shutting down SMB services:                                [  OK  ]</span><br><span class="line">Starting SMB services:                                     [  OK  ]</span><br><span class="line">[root@rhel6 ~]# service nmb restart</span><br><span class="line">Shutting down NMB services:                                [  OK  ]</span><br><span class="line">Starting NMB services:                                     [  OK  ]</span><br><span class="line">4.ä¿®æ”¹å…±äº«ç›®å½•çš„UGOæƒé™</span><br><span class="line">[root@rhel6 ~]# ll -d /var/lib/samba/share</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Aug  5 10:27 /var/lib/samba/share</span><br><span class="line">[root@rhel6 ~]# grep nobody /etc/passwd</span><br><span class="line">nobody:x:99:99:Nobody:/:/sbin/nologin</span><br><span class="line">nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin</span><br><span class="line">[root@rhel6 ~]# chown nobody. /var/lib/samba/share</span><br><span class="line">[root@rhel6 ~]# ll -d /var/lib/samba/share</span><br><span class="line">drwxr-xr-x. 2 nobody nobody 4096 Aug  5 10:27 /var/lib/samba/share</span><br><span class="line">[root@rhel6 ~]# touch /var/lib/samba/share</span><br><span class="line">[root@rhel6 ~]# touch /var/lib/samba/share/smb-file&#123;1..5&#125;</span><br><span class="line">[root@rhel6 ~]# chown nobody. /var/lib/samba/share -R</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# service smb stop</span><br><span class="line">Shutting down SMB services:                                [  OK  ]</span><br><span class="line">[root@rhel6 ~]# service smb start</span><br><span class="line">Starting SMB services:                                     [  OK  ]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line">å®¢æˆ·ç«¯rhel7</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line">[root@rhel7 ~]# smbclient -L 172.25.0.11</span><br><span class="line">Enter root\'s password:</span><br><span class="line">Anonymous login successful</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line"></span><br><span class="line">Sharename       Type      Comment</span><br><span class="line">---------       ----      -------</span><br><span class="line">public          Disk      Public Stuff</span><br><span class="line"><span class="meta">IPC$</span><span class="bash">            IPC       IPC Service (Samba Server Version 3.6.9-164.el6)</span></span><br><span class="line">Anonymous login successful</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line"></span><br><span class="line">Server               Comment</span><br><span class="line">---------            -------</span><br><span class="line">RHEL6                Samba Server Version 3.6.9-164.el6</span><br><span class="line"></span><br><span class="line">Workgroup            Master</span><br><span class="line">---------            -------</span><br><span class="line">MYGROUP              RHEL6</span><br><span class="line">[root@rhel7 ~]# smbclient //172.25.0.11/public</span><br><span class="line">Enter root\'s password:</span><br><span class="line">Anonymous login successful</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  ..                                  D        0  Thu Aug  4 22:30:52 2016</span><br><span class="line">  smb-file4                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  smb-file2                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  smb-file5                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  smb-file1                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  smb-file3                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line"></span><br><span class="line">34505 blocks of size 524288. 26941 blocks available</span><br><span class="line">smb: \&gt; get smb-file1</span><br><span class="line">getting file \smb-file1 of size 0 as smb-file1 (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)</span><br><span class="line">smb: \&gt; put rhel7</span><br><span class="line">putting file rhel7 as \rhel7 (0.0 kb/s) (average 0.0 kb/s)</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        0  Thu Aug  4 22:34:46 2016</span><br><span class="line">  ..                                  D        0  Thu Aug  4 22:30:52 2016</span><br><span class="line">  smb-file4                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  rhel7                               A        0  Thu Aug  4 22:34:46 2016</span><br><span class="line">  smb-file2                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  smb-file5                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  smb-file1                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  smb-file3                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line"></span><br><span class="line">34505 blocks of size 524288. 26941 blocks available</span><br><span class="line">smb: \&gt; exit</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line">å®¢æˆ·ç«¯windows</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line">æ‰“å¼€æµè§ˆå™¨è¾“å…¥\\172.25.0.11\</span><br><span class="line">å°±èƒ½çœ‹åˆ°publicäº†</span><br><span class="line"></span><br><span class="line">=================================================================</span><br><span class="line">ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½</span><br><span class="line">ä»¥ç±»ä¼¼nfsæŒ‚æ¥çš„æ–¹å¼æ¥å…±äº«samba</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##</span></span></span><br><span class="line">å®¢æˆ·ç«¯</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##</span></span></span><br><span class="line">mount -t cifs //172.25.0.11/student /mnt -o username=student</span><br><span class="line">uplooking</span><br><span class="line"></span><br><span class="line">1.å®‰è£…è½¯ä»¶cifs-utils</span><br><span class="line">[root@rhel7 ~]# yum install -y cifs-utils</span><br><span class="line">2.mountæŒ‚è½½</span><br><span class="line">[root@rhel7 ~]# mount -t cifs //172.25.0.11/student /mnt -o username=student</span><br><span class="line">Password for student@//172.25.0.11/student:  *********</span><br><span class="line">[root@rhel7 ~]# mount|tail -n 1</span><br><span class="line">//172.25.0.11/student on /mnt type cifs (rw,relatime,vers=1.0,cache=strict,username=student,domain=RHEL6,uid=0,noforceuid,gid=0,noforcegid,addr=172.25.0.11,unix,posixpaths,serverino,acl,rsize=1048576,wsize=65536,actimeo=1)</span><br><span class="line">[root@rhel7 ~]# cd /mnt</span><br><span class="line">[root@rhel7 mnt]# ll</span><br><span class="line">total 1024</span><br><span class="line">-rwxrw-r--. 1 500 500 8 Aug  4 22:15 file-student.txt</span><br><span class="line">drwxr-xr-x. 2 500 500 0 Aug  4 22:19 windows</span><br><span class="line"></span><br><span class="line">3.å¯ä»¥è®¾ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ï¼Œ/etc/bashrcæˆ–è€…/etc/profileä¸­</span><br></pre></td></tr></table></figure><h3 id="Sambaçš„ä¸»é…ç½®æ–‡ä»¶-etc-samba-smb-confè¯¦ç»†è§£æ"><a href="#Sambaçš„ä¸»é…ç½®æ–‡ä»¶-etc-samba-smb-confè¯¦ç»†è§£æ" class="headerlink" title="Sambaçš„ä¸»é…ç½®æ–‡ä»¶/etc/samba/smb.confè¯¦ç»†è§£æ"></a>Sambaçš„ä¸»é…ç½®æ–‡ä»¶/etc/samba/smb.confè¯¦ç»†è§£æ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">é¦–å…ˆæ˜¯å…¨å±€é…ç½®</span><br><span class="line">ã€globalã€‘</span><br><span class="line">        workgroup = MYGROUP     --&gt;å·¥ä½œç»„ï¼Œå·¥ä½œç»„æ˜¯windowsä¸Šçš„æ¦‚å¿µ</span><br><span class="line">        server string = Samba Server Version %v   --&gt;å…³äºsambaçš„è¯´æ˜</span><br><span class="line"></span><br><span class="line">        netbios name = MYSERVER   --&gt;ç½‘ç»œåç§°</span><br><span class="line"></span><br><span class="line">;       interfaces = lo eth0 192.168.12.2/24 192.168.13.2/24   --&gt;æ¥å£ç½‘æ®µä¿¡æ¯</span><br><span class="line">;       hosts allow = 127. 192.168.12. 192.168.13.    --&gt;å…è®¸å“ªäº›æœºå™¨æ¥è®¿é—®å…±äº«</span><br><span class="line"></span><br><span class="line">;       max protocol = SMB2</span><br><span class="line">ã€logging optionsã€‘  å…³äºæ—¥å¿—çš„é…ç½®</span><br><span class="line"> log file = /var/log/samba/log.%m    æ—¥å¿—å­˜æ”¾çš„ä½ç½®ï¼Œ%mä»£è¡¨æ—¥æœŸ</span><br><span class="line"> max log size = 50æ—¥å¿—çš„å¤§å°é™åˆ¶ä¸º50K</span><br><span class="line">ã€ Standalone Server Options ã€‘ å…³äºå®‰å…¨çº§åˆ«çš„ç›¸å…³é…ç½®</span><br><span class="line">        security = user    --&gt; userä»£è¡¨éœ€è¦ç”¨æˆ·åå’Œå¯†ç ï¼Œå¯†ç ä¸ä¸‹é¢çš„passdb backendæœ‰å…³ï¼Œshareä»£è¡¨ä»»ä½•æ¥éƒ½å¯ä»¥ç›´æ¥è®¿é—®ï¼ŒserveræŒ‡çš„æ˜¯ä½¿ç”¨å¤–éƒ¨çš„å¯†ç ï¼Œéœ€è¦æä¾›password server = IPçš„è®¾ç½®å€¼æ‰è¡Œã€‚</span><br><span class="line">        passdb backend = tdbsam   --&gt;æ•°æ®åº“æ ¼å¼ï¼Œé»˜è®¤çš„æ ¼å¼æ˜¯tdbsamï¼Œæ–‡èŒè¢«æ”¾ç½®åˆ°/var/lib/samba/private/passwd.tdb</span><br><span class="line"></span><br><span class="line">ã€ Share Definitions ã€‘</span><br><span class="line">[homes]    --&gt;é»˜è®¤æƒ…å†µç”¨æˆ·å®¶ç›®å½•çš„å…±äº«ä¿¡æ¯</span><br><span class="line">        comment = Home Directories</span><br><span class="line">        browseable = no</span><br><span class="line">        writable = yes</span><br><span class="line">;       valid users = %S</span><br><span class="line">;       valid users = MYDOMAIN\%S</span><br><span class="line">[printers]  --&gt;å…³äºæ‰“å°æœºçš„é…ç½®ï¼Œè¿™æ˜¯ä¸€äº›ä¾‹å­ã€‚ä¸‹é¢è·Ÿä¸Šäº†ä¸€äº›é€‰é¡¹ã€‚</span><br><span class="line">        path = /var/spool/samba</span><br><span class="line">        browseable = no</span><br><span class="line">        guest ok = no</span><br><span class="line">        writable = no</span><br><span class="line">        printable = yes</span><br><span class="line">[sharesmb]        --&gt;å…±äº«ç›®å½•å</span><br><span class="line">        comment = è¯´æ˜</span><br><span class="line">        path = /test    --&gt;å…±äº«è·¯å¾„</span><br><span class="line">        public = yes    --&gt;æ˜¯å¦æ‰€æœ‰äººéƒ½èƒ½å¤Ÿè®¿é—®</span><br><span class="line">        writable = yes  --&gt;æ˜¯å¦å¯ä»¥å†™</span><br><span class="line">        printable = no  --&gt;æ˜¯å¦æ‰“å°ï¼Œé»˜è®¤æ˜¯noï¼Œå†™äº†yesä¼šç›´æ¥è¢«ä¼ é€’åˆ°æ‰“å°æœºï¼Œå¯ä»¥çœç•¥è¯¥è¡Œ</span><br><span class="line">        write list = +staff  --&gt;å¯å†™ç”¨æˆ·åˆ—è¡¨ã€‚æˆ‘ä»¬è¿™é‡Œå…ˆæŠŠè¿™è¡Œåˆ æ‰ã€‚</span><br><span class="line">        browsable=no    --&gt;æ˜¯å¦å¯æµè§ˆï¼Œå¦‚æœæ˜¯yesåˆ™é»˜è®¤éšè—ã€‚</span><br><span class="line">       hosts allow= ç”¨æ¥é™åˆ¶ä¸»æœºå’Œç½‘æ®µã€‚è°å¯ä»¥è®¿é—®ã€‚</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Sambaçš„å†å²åŠåŸç†&quot;&gt;&lt;a href=&quot;#Sambaçš„å†å²åŠåŸç†&quot; class=&quot;headerlink&quot; title=&quot;Sambaçš„å†å²åŠåŸç†&quot;&gt;&lt;/a&gt;Sambaçš„å†å²åŠåŸç†&lt;/h3&gt;&lt;p&gt;åœ¨æ—©æœŸçš„ç½‘ç»œä¸–ç•Œä¸­ï¼Œæ–‡ä»¶æ•°æ®åœ¨ä¸åŒä¸»æœºä¹‹é—´çš„ä¼ è¾“å¤§å¤šæ˜¯ä½¿ç”¨FTPè¿™ä¸ª
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/Linux%E7%AE%80%E6%98%93%E6%9C%8D%E5%8A%A1%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="LinuxåŸºç¡€æœåŠ¡" scheme="http://www.toberoot.com/tags/Linux%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>APACHE WEBæœåŠ¡</title>
    <link href="http://www.toberoot.com/2016/12/23/booboo_easy_service/05_apache/"/>
    <id>http://www.toberoot.com/2016/12/23/booboo_easy_service/05_apache/</id>
    <published>2016-12-22T21:06:27.000Z</published>
    <updated>2020-03-24T05:02:31.712Z</updated>
    
    <content type="html"><![CDATA[<h3 id="WebåŸºç¡€"><a href="#WebåŸºç¡€" class="headerlink" title="WebåŸºç¡€"></a>WebåŸºç¡€</h3><p>æˆ‘ä»¬å¹³æ—¶ä¸Šç½‘çš„æ—¶å€™ï¼Œè¾“å…¥ç½‘å€çš„æ—¶å€™éƒ½ä¼šè¾“å…¥ä»€ä¹ˆï¼Œ<a href="http://www.baidu.comï¼Œå¯¹ä¸å¯¹ï¼Œé‚£ä¹ˆè¿™ä¸ªwwwæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªwwwä»£è¡¨çš„æ˜¯world">www.baidu.comï¼Œå¯¹ä¸å¯¹ï¼Œé‚£ä¹ˆè¿™ä¸ªwwwæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªwwwä»£è¡¨çš„æ˜¯world</a> wide webï¼ŒWWWå¯ä»¥è®©Webå®¢æˆ·ç«¯ï¼ˆå¸¸ç”¨æµè§ˆå™¨ï¼‰è®¿é—®æµè§ˆWebæœåŠ¡å™¨ä¸Šçš„é¡µé¢ã€‚ å®ƒæ˜¯ä¸€ä¸ªç”±è®¸å¤šäº’ç›¸é“¾æ¥çš„è¶…æ–‡æœ¬ç»„æˆçš„ç³»ç»Ÿï¼Œé€šè¿‡äº’è”ç½‘è®¿é—®ï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæœ‰ç”¨çš„äº‹ç‰©ï¼Œç§°ä¸ºä¸€æ ·â€œèµ„æºâ€ï¼›å¹¶ä¸”ç”±ä¸€ä¸ªå…¨å±€â€œç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦â€ï¼ˆURLï¼‰æ ‡è¯†ï¼›è¿™äº›èµ„æºé€šè¿‡è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHypertext Transfer Protocolï¼‰ä¼ é€ç»™ç”¨æˆ·ï¼Œè€Œåè€…é€šè¿‡ç‚¹å‡»é“¾æ¥æ¥è·å¾—èµ„æºã€‚</p><p>HTTPæ˜¯Hypertext Transfer Protocolçš„ç¼©å†™ï¼Œå³è¶…æ–‡æœ¬ä¼ è¾“åè®®ã€‚ é¡¾åæ€ä¹‰ï¼ŒHTTPæä¾›äº†è®¿é—®è¶…æ–‡æœ¬ä¿¡æ¯çš„åŠŸèƒ½ï¼Œæ˜¯WWWæµè§ˆå™¨å’ŒWWWæœåŠ¡å™¨ä¹‹é—´çš„åº”ç”¨å±‚é€šä¿¡åè®®ã€‚HTTPåè®®æ˜¯ç”¨äºåˆ†å¸ƒå¼åä½œè¶…æ–‡æœ¬ä¿¡æ¯ç³»ç»Ÿçš„ã€é€šç”¨çš„ã€é¢å‘å¯¹è±¡çš„åè®®ã€‚é€šè¿‡æ‰©å±•å‘½ä»¤ï¼Œå®ƒå¯ç”¨äºç±»ä¼¼çš„ä»»åŠ¡ï¼Œå¦‚åŸŸåæœåŠ¡æˆ–åˆ†å¸ƒå¼é¢å‘å¯¹è±¡ç³»ç»Ÿã€‚WWWä½¿ç”¨HTTPåè®®ä¼ è¾“å„ç§è¶…æ–‡æœ¬é¡µé¢å’Œæ•°æ®ã€‚</p><p>ç½‘é¡µæ–‡ä»¶æ˜¯ç”¨HTMLï¼ˆæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€ä¸‹çš„ä¸€ä¸ªåº”ç”¨ï¼‰ç¼–å†™çš„ï¼Œå¯åœ¨WWWä¸Šä¼ è¾“ï¼Œèƒ½è¢«æµè§ˆå™¨è¯†åˆ«æ˜¾ç¤ºçš„æ–‡æœ¬æ–‡ä»¶ã€‚å…¶æ‰©å±•åæ˜¯.htmå’Œ.htmlã€‚</p><p>Webçš„æœåŠ¡å™¨æœ€å¸¸è§çš„æœ‰windowsä¸Šçš„IISï¼Œè¿˜æœ‰linuxä¸Šçš„apacheã€‚å¦å¤–è¿˜æœ‰ä¾‹å¦‚nginxç­‰çš„è½»é‡çº§æœåŠ¡å™¨ã€‚éƒ½æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ä¸€äº›æœåŠ¡å™¨ã€‚æˆ‘ä»¬åŸºç¡€è¯¾ä¸»è¦ç®€å•ä»‹ç»ä¸€äº›apacheçš„ä¸€ä¸ªç®€å•æ­å»ºã€‚</p><h3 id="Apacheçš„ç®€ä»‹"><a href="#Apacheçš„ç®€ä»‹" class="headerlink" title="Apacheçš„ç®€ä»‹"></a>Apacheçš„ç®€ä»‹</h3><ul><li>HTTP (Web) serverã€å¼€æºã€1995å¹´</li><li>å®˜ç½‘ï¼š <a href="http://httpd.apache.org/" target="_blank" rel="noopener">http://httpd.apache.org/</a></li></ul><p>Apache èµ·åˆç”± Illinois å¤§å­¦ Urbana-Champaign çš„å›½å®¶é«˜çº§è®¡ç®—ç¨‹åºä¸­å¿ƒå¼€å‘ã€‚æ­¤åï¼ŒApache è¢«å¼€æ”¾æºä»£ç å›¢ä½“çš„æˆå‘˜ä¸æ–­çš„å‘å±•å’ŒåŠ å¼ºã€‚Apache æœåŠ¡å™¨æ‹¥æœ‰ç‰¢é å¯ä¿¡çš„ç¾èª‰ï¼Œå·²ç”¨åœ¨è¶…è¿‡åŠæ•°çš„å› ç‰¹ç½‘ç«™ä¸­ï¼ç‰¹åˆ«æ˜¯å‡ ä¹æ‰€æœ‰æœ€çƒ­é—¨å’Œè®¿é—®é‡æœ€å¤§çš„ç½‘ç«™ã€‚</p><p>å¼€å§‹ï¼ŒApacheåªæ˜¯Netscapeç½‘é¡µæœåŠ¡å™¨ï¼ˆç°åœ¨æ˜¯Sun ONEï¼‰çš„ä¹‹å¤–çš„å¼€æ”¾æºä»£ç é€‰æ‹©ã€‚æ¸æ¸çš„ï¼Œå®ƒå¼€å§‹åœ¨åŠŸèƒ½å’Œé€Ÿåº¦ã€‚è¶…è¶Šå…¶ä»–çš„åŸºäºUnixçš„HTTPæœåŠ¡å™¨ã€‚1996å¹´4æœˆä»¥æ¥ï¼ŒApacheä¸€ç›´æ˜¯Internetä¸Šæœ€æµè¡Œçš„HTTPæœåŠ¡å™¨: 1999å¹´5æœˆå®ƒåœ¨ 57% çš„ç½‘é¡µæœåŠ¡å™¨ä¸Šè¿è¡Œï¼›åˆ°äº†2005å¹´7æœˆè¿™ä¸ªæ¯”ä¾‹ä¸Šå‡åˆ°äº†69%ã€‚</p><p>ä½œè€…å®£ç§°å› ä¸ºè¿™ä¸ªåå­—å¥½è®°æ‰åœ¨æœ€åˆé€‰æ‹©å®ƒï¼Œä½†æ˜¯æµä¼ æœ€å¹¿çš„è§£é‡Šæ˜¯ï¼ˆä¹Ÿæ˜¯æœ€æ˜¾è€Œæ˜“è§çš„ï¼‰:è¿™ä¸ªåå­—æ¥è‡ªè¿™ä¹ˆä¸€ä¸ªäº‹å®:å½“Apacheåœ¨1995å¹´åˆå¼€å‘çš„æ—¶å€™ï¼Œå®ƒæ˜¯ç”±å½“æ—¶æœ€æµè¡Œçš„HTTPæœåŠ¡å™¨NCSA HTTPd 1.3 çš„ä»£ç ä¿®æ”¹è€Œæˆçš„ï¼Œå› æ­¤æ˜¯â€œä¸€ä¸ªä¿®è¡¥çš„ï¼ˆa patchyï¼‰â€æœåŠ¡å™¨ã€‚ç„¶è€Œåœ¨æœåŠ¡å™¨å®˜æ–¹ç½‘ç«™çš„FAQä¸­æ˜¯è¿™ä¹ˆè§£é‡Šçš„:â€œâ€˜Apacheâ€™è¿™ä¸ªåå­—æ˜¯ä¸ºäº†çºªå¿µåä¸ºApache(å°åœ°è¯­)çš„ç¾æ´²å°ç¬¬å®‰äººåœŸè‘—çš„ä¸€æ”¯ï¼Œä¼—æ‰€å‘¨çŸ¥ä»–ä»¬æ‹¥æœ‰é«˜è¶…çš„ä½œæˆ˜ç­–ç•¥å’Œæ— ç©·çš„è€æ€§â€ã€‚</p><p>Apacheçš„è½¯ä»¶åç§°å°±å«åšhttpdï¼Œè¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥el6ä½œä¸ºæœåŠ¡å™¨ï¼Œel7ä½œä¸ºå®¢æˆ·ç«¯ã€‚</p><h3 id="Apacheçš„è½¯ä»¶ç»“æ„"><a href="#Apacheçš„è½¯ä»¶ç»“æ„" class="headerlink" title="Apacheçš„è½¯ä»¶ç»“æ„"></a>Apacheçš„è½¯ä»¶ç»“æ„</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apache</span><br><span class="line">è½¯ä»¶ httpd</span><br><span class="line">rhel6httpd-2.2.15-29.el6_4.x86_64</span><br><span class="line">rhel7httpd-2.4.6-17.el7.x86_64</span><br><span class="line">servicehttpd</span><br><span class="line">daemonhttpd</span><br><span class="line">ç«¯å£80</span><br><span class="line">é…ç½®æ–‡ä»¶/etc/httpd/conf/httpd.conf</span><br><span class="line">/etc/httpd/conf.d/*.conf</span><br><span class="line">æ•°æ®æ–‡ä»¶/var/www/</span><br><span class="line">/var/www/uplooking/www.uplooking.com----ç½‘ç«™æ ¹ç›®å½•</span><br><span class="line">æ—¥å¿—æ–‡ä»¶/var/log/httpd</span><br></pre></td></tr></table></figure><h3 id="Apacheè™šæ‹Ÿä¸»æœºæ–¹æ¡ˆ"><a href="#Apacheè™šæ‹Ÿä¸»æœºæ–¹æ¡ˆ" class="headerlink" title="Apacheè™šæ‹Ÿä¸»æœºæ–¹æ¡ˆ"></a>Apacheè™šæ‹Ÿä¸»æœºæ–¹æ¡ˆ</h3><ol><li>åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">www.uplooking.com:80----&gt;/var/www/uplooking.com/</span><br><span class="line">www.uplooking.com:8080----&gt;/var/www/abc.com/</span><br></pre></td></tr></table></figure></li><li>åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">www.uplooking.com----/var/www/uplooking.com/</span><br><span class="line">www.abc.com----/var/www/abc.com/</span><br></pre></td></tr></table></figure><h3 id="Apacheå®è·µ"><a href="#Apacheå®è·µ" class="headerlink" title="Apacheå®è·µ"></a>Apacheå®è·µ</h3></li></ol><h4 id="é¡¹ç›®å®è·µ1ï¼šé…ç½®åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº"><a href="#é¡¹ç›®å®è·µ1ï¼šé…ç½®åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº" class="headerlink" title="é¡¹ç›®å®è·µ1ï¼šé…ç½®åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº"></a>é¡¹ç›®å®è·µ1ï¼šé…ç½®åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">8080---&gt;</span><span class="bash">/var/www/8080.com/</span></span><br><span class="line">*******************************************</span><br><span class="line">1)ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶ï¼Œæ‰“å¼€è¦ç›‘å¬çš„ç«¯å£å·</span><br><span class="line">[root@rhel6 ~]# vim /etc/httpd/conf/httpd.conf</span><br><span class="line">Listen 80</span><br><span class="line">Listen 8080</span><br><span class="line">2)ä¸ºä¸åŒçš„è™šæ‹Ÿä¸»æœºåˆ›å»ºé…ç½®æ–‡ä»¶</span><br><span class="line">[root@rhel6 conf.d]# pwd</span><br><span class="line">/etc/httpd/conf.d</span><br><span class="line">[root@rhel6 conf.d]# vim 8080.conf</span><br><span class="line">&lt;VirtualHost *:8080&gt;</span><br><span class="line">    ServerAdmin booboo@8080.com</span><br><span class="line">    DocumentRoot /var/www/8080.com</span><br><span class="line">    ServerName www.8080.com</span><br><span class="line">    ErrorLog logs/8080.com-error_log</span><br><span class="line">    CustomLog logs/8080.com-access_log common</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">3.åˆ›å»ºç½‘ç«™æ ¹ç›®å½•ï¼Œå¹¶åˆ›å»ºç½‘ç«™é»˜è®¤é¦–é¡µ</span><br><span class="line">[root@rhel6 conf.d]# mkdir /var/www/8080.com</span><br><span class="line">[root@rhel6 conf.d]# echo 8080.com &gt; /var/www/8080.com/index.html</span><br><span class="line">4.é‡å¯æœåŠ¡</span><br><span class="line">[root@rhel6 conf.d]# service httpd start</span><br></pre></td></tr></table></figure><p>æ‹“å±•8081å’Œ8082ç«¯å£</p><ol><li>å…³é—­selinux</li><li>é…ç½®selinuxå®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå…è®¸httpdç›‘å¬8081å’Œ8082ç«¯å£<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 conf.d]# semanage port -l|grep http</span><br><span class="line">http_cache_port_t              tcp      3128, 8080, 8118, 8123, 10001-10010</span><br><span class="line">http_cache_port_t              udp      3130</span><br><span class="line">http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000</span><br><span class="line">pegasus_http_port_t            tcp      5988</span><br><span class="line">pegasus_https_port_t           tcp      5989</span><br><span class="line"></span><br><span class="line">[root@rhel6 conf.d]# semanage port -a -t http_port_t -p tcp 8081</span><br><span class="line">[root@rhel6 conf.d]# semanage port -a -t http_port_t -p tcp 8082</span><br></pre></td></tr></table></figure></li></ol><h4 id="é¡¹ç›®å®è·µ2ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº"><a href="#é¡¹ç›®å®è·µ2ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº" class="headerlink" title="é¡¹ç›®å®è·µ2ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº"></a>é¡¹ç›®å®è·µ2ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">www.taobao.com/var/www/taobao.com/</span><br><span class="line">www.abc.com/var/www/abc.com/</span><br><span class="line">*******************************************************</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####</span></span></span><br><span class="line">æœåŠ¡ç«¯</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####</span></span></span><br><span class="line">1.ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶</span><br><span class="line">[root@rhel6 conf.d]# vim /etc/httpd/conf/httpd.conf</span><br><span class="line">NameVirtualHost *:80</span><br><span class="line">2.åˆ›å»ºæ‹“å±•é…ç½®æ–‡ä»¶</span><br><span class="line">[root@rhel6 conf.d]# vim taobao.conf</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerAdmin booboo@taobao.com</span><br><span class="line">    DocumentRoot /var/www/taobao.com</span><br><span class="line">    ServerName www.taobao.com</span><br><span class="line">    ErrorLog logs/taobao.com-error_log</span><br><span class="line">    CustomLog logs/taobao.com-access_log common</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory "/var/www/taobao.com/"&gt;</span><br><span class="line">    Options Indexes ==&gt;å¦‚æœæ²¡æœ‰å¯¹åº”çš„indexæ–‡ä»¶ï¼Œå°±å°†è¯¥ç›®å½•ä¸‹çš„å…¶ä»–æ–‡ä»¶ç½—åˆ—å‡ºæ¥ã€‚</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">[root@rhel6 conf.d]# vim abc.conf</span><br><span class="line">[root@rhel6 conf.d]# cat abc.conf</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerAdmin booboo@abc.com</span><br><span class="line">    DocumentRoot /var/www/abc.com</span><br><span class="line">    ServerName www.abc.com</span><br><span class="line">    ErrorLog logs/abc.com-error_log</span><br><span class="line">    CustomLog logs/abc.com-access_log common</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory "/var/www/abc.com/"&gt;</span><br><span class="line">    Options Indexes</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">[root@rhel6 conf.d]# mkdir /var/www/taobao.com</span><br><span class="line">[root@rhel6 conf.d]# mkdir /var/www/abc.com</span><br><span class="line">[root@rhel6 conf.d]# echo www.taobao.com &gt; /var/www/taobao.com/index.html</span><br><span class="line">[root@rhel6 conf.d]# echo www.abc.com &gt; /var/www/abc.com/index.html</span><br><span class="line">[root@rhel6 conf.d]# service httpd restart</span><br><span class="line">==================================================================================================</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####</span></span></span><br><span class="line">å®¢æˆ·ç«¯</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####</span></span></span><br><span class="line">1.å®‰è£…elinksè½¯ä»¶ï¼Œbashä¸‹çš„ä¸€ä¸ªç½‘ç«™æµè§ˆè½¯ä»¶</span><br><span class="line">[root@rhel7 mnt]# yum install -y elinks</span><br><span class="line">2.æ·»åŠ åŸŸåè§£æ</span><br><span class="line">[root@rhel7 mnt]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">172.25.0.11www.taobao.com</span><br><span class="line">172.25.0.11www.abc.com</span><br><span class="line">3.é€šè¿‡linkså‘½ä»¤è®¿é—®www.taobao.comå’Œwww.abc.com</span><br><span class="line">[root@rhel7 mnt]# links www.taobao.com</span><br><span class="line">[root@rhel7 mnt]# links www.abc.com</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####</span></span></span><br><span class="line">-X å¸¦å›¾å½¢åŒ–ç•Œé¢çš„è¿œç¨‹ç™»å½•</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####</span></span></span><br><span class="line">[kiosk@foundation0 Desktop]$ ssh root@172.25.0.10 -X</span><br><span class="line">Last login: Fri Aug  5 03:14:10 2016</span><br><span class="line">/usr/bin/xauth:  file /root/.Xauthority does not exist</span><br><span class="line">[root@rhel7 ~]# firefox</span><br></pre></td></tr></table></figure><h4 id="é¡¹ç›®å®è·µ3ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºé’ˆå¯¹æŸä¸€ä¸ªç›®å½•åšé™åˆ¶"><a href="#é¡¹ç›®å®è·µ3ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºé’ˆå¯¹æŸä¸€ä¸ªç›®å½•åšé™åˆ¶" class="headerlink" title="é¡¹ç›®å®è·µ3ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºé’ˆå¯¹æŸä¸€ä¸ªç›®å½•åšé™åˆ¶"></a>é¡¹ç›®å®è·µ3ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºé’ˆå¯¹æŸä¸€ä¸ªç›®å½•åšé™åˆ¶</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Directoryæ˜¯é’ˆå¯¹æŸä¸€ä¸ªç›®å½•åšé™åˆ¶çš„æ„æ€ã€‚</span><br><span class="line">Options</span><br><span class="line">Indexesçš„æ„æ€ä»£è¡¨å¦‚æœæ²¡æœ‰å¯¹åº”çš„indexæ–‡ä»¶ï¼Œå°±å°†è¯¥ç›®å½•ä¸‹çš„å…¶ä»–æ–‡ä»¶ç½—åˆ—å‡ºæ¥ã€‚</span><br><span class="line">Multiviewä»£è¡¨çš„æ˜¯å¤šè§†å›¾</span><br><span class="line">Follow sysmlinkä»£è¡¨å…è®¸è¿æ¥åˆ°å…¶ä»–ç›®å½•ã€‚</span><br><span class="line">AllowOverride None</span><br><span class="line">æœ€å¸¸ç”¨çš„æ˜¯ï¼š</span><br><span class="line">Order allow,deny</span><br><span class="line">Allow from All</span><br><span class="line">deny from 172.25.0.10==&gt;è¯¥ç›®å½•å…è®¸æ‰€æœ‰äººï¼Œé™¤äº†172.25.0.11</span><br><span class="line">æˆ–è€…</span><br><span class="line">Order deny,allow</span><br><span class="line">deny from All</span><br><span class="line">allow from 172.25.0.10==&gt;è¯¥ç›®å½•ä¸å…è®¸æ‰€æœ‰äººï¼Œé™¤äº†172.25.0.11</span><br></pre></td></tr></table></figure><h4 id="é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº-åˆ«å"><a href="#é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº-åˆ«å" class="headerlink" title="é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº_åˆ«å"></a>é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº_åˆ«å</h4><ul><li>åˆ«å        alias<ul><li>ä½œç”¨åœ¨è®¿é—®è¯¥ç›®å½•çš„æ—¶å€™,æ— è®ºä¹‹å‰çš„è™šæ‹Ÿä¸»æœºç«™ç‚¹åæ˜¯ä»€ä¹ˆ,ä¼šç»Ÿä¸€è½¬åˆ°æŸä¸€ä¸ªæŒ‡å®šçš„ç›®å½•ã€‚</li></ul></li></ul><p><code>Alias /download/ /&quot;var/www/soft/&quot;</code></p><p>è®¿é—® download ç›®å½•æ—¶,æ— è®ºç«™ç‚¹åæ˜¯ä»€ä¹ˆ,éƒ½ä¼šäº¤ç»™ var/www/soft/ å»å¤„ç†,æ³¨æ„:ä»£è¡¨ç›®å½•æ—¶,æœ€åä¸€ä¸ª / ä¸èƒ½çœç•¥</p><h4 id="é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº-ç”¨æˆ·åå’Œå¯†ç è®¿é—®"><a href="#é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº-ç”¨æˆ·åå’Œå¯†ç è®¿é—®" class="headerlink" title="é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº_ç”¨æˆ·åå’Œå¯†ç è®¿é—®"></a>é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº_ç”¨æˆ·åå’Œå¯†ç è®¿é—®</h4><ul><li>1ï¼‰é…ç½®æ–‡ä»¶ä¸­æ·»åŠ è®¤è¯    AllowOverride AuthConfig<ul><li>2ï¼‰åˆ›å»ºè®¤è¯æ–‡ä»¶å’Œç”¨æˆ·å¯†ç     htpasswd -cmb /etc/httpd/test booboo uplooking</li><li>3ï¼‰æ–°å¢ç”¨æˆ·å’Œå¯†ç         htpasswd -bm /etc/httpd/test tom uplooking</li><li>4ï¼‰åˆ é™¤ç”¨æˆ·        htpasswd -D /etc/httpd/test jack</li><li>5ï¼‰ä¿®æ”¹å¯†ç         å…ˆåˆ é™¤å†åˆ›å»º</li></ul></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">è®¾ç½®ç”¨æˆ·å’Œå¯†ç </span><br><span class="line">&lt;Directory "/var/www/booboo.com/football/"&gt;</span><br><span class="line">Options Indexes MultiViews FollowSymLinks</span><br><span class="line">AllowOverride AuthConfig</span><br><span class="line"><span class="meta">#</span><span class="bash">ä»…æœ‰ç½‘é¡µè®¤è¯ ( è´¦å·å¯†ç  ) å¯è¦†å†™ ;</span></span><br><span class="line">AuthName "student"</span><br><span class="line"><span class="meta">#</span><span class="bash">åœ¨è¦ä½ è¾“å…¥è´¦å·ä¸å¯†ç çš„å¯¹è¯çª—å£ä¸­ , å‡ºç°çš„ã€æç¤ºå­—ç¬¦ã€</span></span><br><span class="line">AuthType basic</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¤è¯çš„ç±»å‹</span></span><br><span class="line">AuthUserFile "/etc/httpd/test"</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿™ä¸ªç›®å½•æ‰€ä½¿ç”¨çš„è´¦å·å¯†ç é…ç½®æ–‡ä»¶</span></span><br><span class="line">Require valid-user</span><br><span class="line"><span class="meta">#</span><span class="bash"> åé¢æ¥å¯ä»¥ä½¿ç”¨çš„è´¦å· , æ­¤å¤„æ˜¯è®©è¯¥å¯†ç æ–‡ä»¶å†…çš„ç”¨æˆ·éƒ½èƒ½å¤Ÿç™»å…¥</span></span><br><span class="line">Order allow,deny</span><br><span class="line">Allow from all</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡htpasswdæ·»åŠ ç”¨æˆ·å’Œå¯†ç </span></span><br><span class="line">[root@rhel6 conf.d]# htpasswd -cmb /etc/httpd/test booboo uplooking</span><br><span class="line">Adding password for user student</span><br><span class="line"><span class="meta">#</span><span class="bash"> å†æ·»åŠ ä¸€ä¸ªç”¨æˆ·å’Œå¯†ç </span></span><br><span class="line">[root@rhel6 www]# htpasswd -bm /etc/httpd/test tom uplooking</span><br><span class="line">Adding password for user tom</span><br><span class="line">[root@rhel6 www]# htpasswd -bm /etc/httpd/test jack uplooking</span><br><span class="line">Adding password for user jack</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹ä¿å­˜apacheç”¨æˆ·åå’Œå¯†ç çš„æ–‡ä»¶å†…å®¹</span></span><br><span class="line">[root@rhel6 www]# cat /etc/httpd/test</span><br><span class="line">booboo:$apr1$y6g/XYrn$eEOR4WeAPfONSLExj7x2D1</span><br><span class="line">tom:$apr1$epxVgzER$Or7.R0.5s3z8FbPKrOS1e1</span><br><span class="line">jack:$apr1$Alo3.7mf$3CmcCG9mXp7eEALUsa3YY1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤ç”¨æˆ·</span></span><br><span class="line">[root@rhel6 www]# htpasswd -D /etc/httpd/test jack</span><br><span class="line">Deleting password for user jack</span><br><span class="line">[root@rhel6 www]# cat /etc/httpd/test</span><br><span class="line">booboo:$apr1$y6g/XYrn$eEOR4WeAPfONSLExj7x2D1</span><br><span class="line">tom:$apr1$epxVgzER$Or7.R0.5s3z8FbPKrOS1e1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹ç”¨æˆ·å¯†ç åªèƒ½å…ˆåˆ é™¤å†åˆ›å»º</span></span><br><span class="line">[root@rhel6 abc.com]# htpasswd --help</span><br><span class="line">Usage:</span><br><span class="line">htpasswd [-cmdpsD] passwordfile username</span><br><span class="line">htpasswd -b[cmdpsD] passwordfile username password</span><br><span class="line"></span><br><span class="line">htpasswd -n[mdps] username</span><br><span class="line">htpasswd -nb[mdps] username password</span><br><span class="line"> -c  Create a new file.</span><br><span class="line"> -n  Don\'t update file; display results on stdout.</span><br><span class="line"> -m  Force MD5 encryption of the password.</span><br><span class="line"> -d  Force CRYPT encryption of the password (default).</span><br><span class="line"> -p  Do not encrypt the password (plaintext).</span><br><span class="line"> -s  Force SHA encryption of the password.</span><br><span class="line"> -b  Use the password from the command line rather than prompting for it.</span><br><span class="line"> -D  Delete the specified user.</span><br><span class="line">On Windows, NetWare and TPF systems the '-m' flag is used by default.</span><br><span class="line">On all other systems, the '-p' flag will probably not work.</span><br></pre></td></tr></table></figure><h4 id="é¡¹ç›®å®è·µ5ï¼šåœ¨rhel7ä¸­æ­å»ºapahceï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½"><a href="#é¡¹ç›®å®è·µ5ï¼šåœ¨rhel7ä¸­æ­å»ºapahceï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½" class="headerlink" title="é¡¹ç›®å®è·µ5ï¼šåœ¨rhel7ä¸­æ­å»ºapahceï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½"></a>é¡¹ç›®å®è·µ5ï¼šåœ¨rhel7ä¸­æ­å»ºapahceï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½</h4><ul><li><p>é…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº <a href="http://www.abc.com" target="_blank" rel="noopener">www.abc.com</a> å’Œ <a href="http://www.uplooking.com" target="_blank" rel="noopener">www.uplooking.com</a></p></li><li><p>åªå…è®¸rhel6 172.25.0.11 èƒ½å¤Ÿè®¿é—® <a href="http://www.uplooking.com" target="_blank" rel="noopener">www.uplooking.com</a> </p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">rhel6rhel7</span><br><span class="line">2.22.4</span><br><span class="line">orderrequire</span><br><span class="line"></span><br><span class="line">ã€‹eg1:æ‰€æœ‰è¯·æ±‚éƒ½è¢«æ‹’ç»</span><br><span class="line">order deny,allow //å…ˆæ‹’ç»ï¼Œåå…è®¸</span><br><span class="line">deny from all//æ‹’ç»æ‰€æœ‰</span><br><span class="line">------------------------------</span><br><span class="line">require all denied //æ‹’ç»æ‰€æœ‰</span><br><span class="line"></span><br><span class="line">ã€‹eg2ï¼šæ‰€æœ‰è¯·æ±‚éƒ½å…è®¸</span><br><span class="line">order allowï¼Œdeny //å…ˆå…è®¸ï¼Œåæ‹’ç»</span><br><span class="line">allow from all</span><br><span class="line">------------------------------------</span><br><span class="line">require all granted</span><br><span class="line"></span><br><span class="line">ã€‹æ‹’ç»172.25.0.10/test.uplooking.com çš„è¯·æ±‚</span><br><span class="line">order allowï¼Œdeny //å…ˆå…è®¸ï¼Œåæ‹’ç»</span><br><span class="line">allow from all</span><br><span class="line">deny from 172.25.0.10</span><br><span class="line">-------------------------------------</span><br><span class="line">require  all granted</span><br><span class="line">require no ip 172.25.0.10</span><br><span class="line">require no host test.uplooking.com</span><br><span class="line"></span><br><span class="line">ã€‹åªå…è®¸172.25.3.10å’Œ172.25.0.0/24 uplooking.com çš„è¯·æ±‚</span><br><span class="line">order denyï¼Œallow //å…ˆå†³ç»ï¼Œåå…è®¸</span><br><span class="line">deny from all</span><br><span class="line">allow from 172.25.3.10</span><br><span class="line">allow from 172.25.0.0/24</span><br><span class="line">-------------------------------------</span><br><span class="line">require all denied</span><br><span class="line">require ip 172.25.3.10 172.25.0</span><br><span class="line">require host  uplooking.com</span><br></pre></td></tr></table></figure><hr><h3 id="Apacheé…ç½®æ–‡ä»¶-etc-httpd-conf-httpd-conf"><a href="#Apacheé…ç½®æ–‡ä»¶-etc-httpd-conf-httpd-conf" class="headerlink" title="Apacheé…ç½®æ–‡ä»¶/etc/httpd/conf/httpd.conf"></a>Apacheé…ç½®æ–‡ä»¶/etc/httpd/conf/httpd.conf</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">1ï¼‰</span><br><span class="line"><span class="meta">#</span><span class="bash"> ServerRoot â€œ/etc/httpdâ€œ</span></span><br><span class="line">ServerRootç”¨äºæŒ‡å®šå®ˆæŠ¤è¿›ç¨‹httpdçš„è¿è¡Œç›®å½•ï¼Œhttpdåœ¨å¯åŠ¨ä¹‹åå°†è‡ªåŠ¨å°†è¿›ç¨‹çš„å½“å‰ç›®å½•æ”¹å˜ä¸ºè¿™ä¸ªç›®å½•ï¼Œå› æ­¤å¦‚æœè®¾ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆçœŸå®è·¯å¾„å°±ä½äºè¿™ä¸ªServerR ootå®šä¹‰çš„è·¯å¾„ä¹‹ä¸‹ã€‚</span><br><span class="line"></span><br><span class="line">2ï¼‰</span><br><span class="line">hhhidFile /var/run/httpd.pid</span><br><span class="line">PidFileæŒ‡å®šçš„æ–‡ä»¶å°†è®°å½•httpdå®ˆæŠ¤è¿›ç¨‹çš„è¿›ç¨‹å·ï¼Œç”±äºhttpdèƒ½è‡ªåŠ¨å¤åˆ¶å…¶è‡ªèº«ï¼Œå› æ­¤ç³»ç»Ÿä¸­æœ‰å¤šä¸ªhttpdè¿›ç¨‹ï¼Œä½†åªæœ‰ä¸€ä¸ªè¿›ç¨‹ä¸ºæœ€åˆå¯åŠ¨çš„è¿›ç¨‹ï¼Œå®ƒä¸ºå…¶ä»–è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œå¯¹è¿™ä¸ªè¿›ç¨‹å‘é€ä¿¡å·å°†å½±å“æ‰€æœ‰çš„httpdè¿›ç¨‹ã€‚PidFILEå®šä¹‰çš„æ–‡ä»¶ä¸­å°±è®°å½•httpdçˆ¶è¿›ç¨‹çš„è¿›ç¨‹å·ã€‚</span><br><span class="line">ã€€ã€€</span><br><span class="line"><span class="meta">#</span><span class="bash"> Timeout 300</span></span><br><span class="line">Timeoutå®šä¹‰å®¢æˆ·ç¨‹åºå’ŒæœåŠ¡å™¨è¿æ¥çš„è¶…æ—¶é—´éš”ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´é—´éš”ï¼ˆç§’ï¼‰åæœåŠ¡å™¨å°†æ–­å¼€ä¸å®¢æˆ·æœºçš„è¿æ¥ã€‚</span><br><span class="line"><span class="meta">#</span><span class="bash"> KeepAlive On</span></span><br><span class="line">åœ¨HTTP 1.0ä¸­ï¼Œä¸€æ¬¡è¿æ¥åªèƒ½ä½œä¼ è¾“ä¸€æ¬¡HTTPè¯·æ±‚ï¼Œè€ŒKeepAliveå‚æ•°ç”¨äºæ”¯æŒHTTP 1.1ç‰ˆæœ¬çš„ä¸€æ¬¡è¿æ¥ã€å¤šæ¬¡ä¼ è¾“åŠŸèƒ½ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸€æ¬¡è¿æ¥ä¸­ä¼ é€’å¤šä¸ªHTTPè¯·æ±‚ã€‚ä¸è¿‡åªæœ‰è¾ƒæ–°çš„æµè§ˆå™¨æ‰æ”¯æŒè¿™ä¸ªåŠŸèƒ½</span><br><span class="line"><span class="meta">#</span><span class="bash"> MaxKeepAliveRequests 100</span></span><br><span class="line">MaxKeepAliveRequestsä¸ºä¸€æ¬¡è¿æ¥å¯ä»¥è¿›è¡Œçš„HTTPè¯·æ±‚çš„æœ€å¤§è¯·æ±‚æ¬¡æ•°ã€‚å°†å…¶å€¼è®¾ä¸º0å°†æ”¯æŒåœ¨ä¸€æ¬¡è¿æ¥å†…è¿›è¡Œæ— é™æ¬¡çš„ä¼ è¾“è¯·æ±‚ã€‚äº‹å®ä¸Šæ²¡æœ‰å®¢æˆ·ç¨‹åºåœ¨ä¸€æ¬¡è¿æ¥ä¸­è¯·æ±‚å¤ªå¤šçš„é¡µé¢ï¼Œé€šå¸¸è¾¾ä¸åˆ°è¿™ä¸ªä¸Šé™å°±å®Œæˆè¿æ¥äº†ã€‚</span><br><span class="line"><span class="meta">#</span><span class="bash"> KeepAliveTimeout 15</span></span><br><span class="line">KeepAliveTimeoutæµ‹è¯•ä¸€æ¬¡è¿æ¥ä¸­çš„å¤šæ¬¡è¯·æ±‚ä¼ è¾“ä¹‹é—´çš„æ—¶é—´ï¼Œå¦‚æœæœåŠ¡å™¨å·²ç»å®Œæˆäº†ä¸€æ¬¡è¯·æ±‚ï¼Œä½†ä¸€ç›´æ²¡æœ‰æ¥æ”¶åˆ°å®¢æˆ·ç¨‹åºçš„ä¸‹ä¸€æ¬¡è¯·æ±‚ï¼Œåœ¨é—´éš”è¶…è¿‡äº†è¿™ä¸ªå‚æ•°è®¾ç½®çš„å€¼ä¹‹åï¼ŒæœåŠ¡å™¨å°±æ–­å¼€è¿æ¥ã€‚</span><br><span class="line"><span class="meta">#</span><span class="bash"> ThreadsPerChild 50</span></span><br><span class="line">è®¾ç½®æœåŠ¡å™¨ä½¿ç”¨è¿›ç¨‹çš„æ•°ç›®ã€‚è¿™æ˜¯ä»¥æœåŠ¡å™¨çš„å“åº”é€Ÿåº¦ä¸ºå‡†çš„, æ•°ç›®å¤ªå¤§åˆ™ä¼šå˜æ…¢</span><br><span class="line"><span class="meta">#</span><span class="bash"> MaxRequestsPerChild 30</span></span><br><span class="line">ä½¿ç”¨å­è¿›ç¨‹çš„æ–¹å¼æä¾›æœåŠ¡çš„WebæœåŠ¡ï¼Œå¸¸ç”¨çš„æ–¹å¼æ˜¯ä¸€ä¸ªå­è¿›ç¨‹ä¸ºä¸€æ¬¡è¿æ¥æœåŠ¡ï¼Œè¿™æ ·é€ æˆçš„é—®é¢˜å°±æ˜¯æ¯æ¬¡è¿æ¥éƒ½éœ€è¦ç”Ÿæˆã€é€€å‡ºå­è¿›ç¨‹çš„ç³»ç»Ÿæ“ä½œï¼Œä½¿å¾—è¿™äº›é¢å¤–çš„å¤„ç†è¿‡ç¨‹å æ®äº†è®¡ç®—æœºçš„å¤§é‡å¤„ç†èƒ½åŠ›ã€‚å› æ­¤æœ€å¥½çš„æ–¹å¼æ˜¯ä¸€ä¸ªå­è¿›ç¨‹å¯ä»¥ä¸ºå¤šæ¬¡è¿æ¥è¯·æ±‚æœåŠ¡ï¼Œè¿™æ ·å°±ä¸éœ€è¦è¿™äº›ç”Ÿæˆã€é€€å‡ºè¿›ç¨‹çš„ç³»ç»Ÿæ¶ˆè€—ï¼ŒApacheå°±é‡‡ç”¨äº†è¿™æ ·çš„æ–¹å¼ï¼Œä¸€æ¬¡è¿æ¥ç»“æŸåï¼Œå­è¿›ç¨‹å¹¶ä¸é€€å‡ºï¼Œè€Œæ˜¯åœç•™åœ¨ç³»ç»Ÿä¸­ç­‰å¾…ä¸‹ä¸€æ¬¡æœåŠ¡è¯·æ±‚ï¼Œè¿™æ ·å°±æå¤§çš„æé«˜äº†æ€§èƒ½ã€‚ä½†ç”±äºåœ¨å¤„ç†è¿‡ç¨‹ä¸­å­è¿›ç¨‹è¦ä¸æ–­çš„ç”³è¯·å’Œé‡Šæ”¾å†…å­˜ï¼Œæ¬¡æ•°å¤šäº†å°±ä¼šé€ æˆä¸€äº›å†…å­˜åƒåœ¾ï¼Œå°±ä¼šå½±å“ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œå¹¶ä¸”å½±å“ç³»ç»Ÿèµ„æºçš„æœ‰æ•ˆåˆ©ç”¨ã€‚å› æ­¤åœ¨ä¸€ä¸ªå‰¯æœ¬å¤„ç†è¿‡ä¸€å®šæ¬¡æ•°çš„è¯·æ±‚ä¹‹åï¼Œå°±å¯ä»¥è®©è¿™ä¸ªå­è¿›ç¨‹å‰¯æœ¬é€€å‡ºï¼Œå†ä»åŸå§‹çš„htt pdè¿›ç¨‹ä¸­é‡æ–°å¤åˆ¶ä¸€ä¸ªå¹²å‡€çš„å‰¯æœ¬ï¼Œè¿™æ ·å°±èƒ½æé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚è¿™æ ·ï¼Œæ¯ä¸ªå­è¿›ç¨‹å¤„ç†æœåŠ¡è¯·æ±‚æ¬¡æ•°ç”±MaxRe questPerChildå®šä¹‰ã€‚ ç¼ºçœçš„è®¾ç½®å€¼ä¸º30ï¼Œè¿™ä¸ªå€¼å¯¹äºå…·å¤‡é«˜ç¨³å®šæ€§ç‰¹ç‚¹çš„FreeBSDç³»ç»Ÿæ¥è®²æ˜¯è¿‡äºä¿å®ˆçš„è®¾ç½®ï¼Œå¯ä»¥è®¾ç½®ä¸º1000ç”šè‡³æ›´é«˜ï¼Œè®¾ç½®ä¸º0æ”¯æŒæ¯ä¸ªå‰¯æœ¬è¿›è¡Œæ— é™æ¬¡çš„æœåŠ¡å¤„ç†ã€‚ã€€ã€€ã€€ã€€</span><br><span class="line"><span class="meta">#</span><span class="bash"> ServerAdmin root@localhost</span></span><br><span class="line">é…ç½®æ–‡ä»¶ä¸­åº”è¯¥æ”¹å˜çš„ä¹Ÿè®¸åªæœ‰ServerAdminï¼Œ è¿™ä¸€é¡¹ç”¨äºé…ç½®WWWæœåŠ¡å™¨çš„ç®¡ç†å‘˜çš„emailåœ°å€ï¼Œè¿™å°†åœ¨HTTPæœåŠ¡å‡ºç°é”™è¯¯çš„æ¡ä»¶ä¸‹è¿”å›ç»™æµè§ˆå™¨ï¼Œä»¥ä¾¿è®©Webä½¿ç”¨è€…å’Œç®¡ç†å‘˜è”ç³»ï¼ŒæŠ¥å‘Šé”™è¯¯ã€‚ä¹ æƒ¯ä¸Šä½¿ç”¨æœåŠ¡å™¨ä¸Šçš„webmasterä½œä¸ºWWWæœåŠ¡å™¨çš„ç®¡ç†å‘˜ï¼Œé€šè¿‡é‚®ä»¶æœåŠ¡å™¨çš„åˆ«åæœºåˆ¶ï¼Œå°†å‘é€åˆ°webmaster çš„ç”µå­é‚®ä»¶å‘é€ç»™çœŸæ­£çš„Webç®¡ç†å‘˜ã€‚</span><br><span class="line"><span class="meta">#</span><span class="bash"> ServerName localhost</span></span><br><span class="line">ç¼ºçœæƒ…å†µä¸‹ï¼Œå¹¶ä¸éœ€è¦æŒ‡å®šè¿™ä¸ªServerNameå‚æ•°ï¼ŒæœåŠ¡å™¨å°†è‡ªåŠ¨é€šè¿‡åå­—è§£æè¿‡ç¨‹æ¥è·å¾—è‡ªå·±çš„åå­—ï¼Œä½†å¦‚æœæœåŠ¡å™¨çš„åå­—è§£ææœ‰é—®é¢˜ï¼ˆé€šå¸¸ä¸ºåå‘è§£æä¸æ­£ç¡®ï¼‰ï¼Œæˆ–è€…æ²¡æœ‰æ­£å¼çš„DNSåå­—ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™é‡ŒæŒ‡å®šI Påœ°å€ã€‚å½“ServerNameè®¾ç½®ä¸æ­£ç¡®çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¸èƒ½æ­£å¸¸å¯åŠ¨ã€‚</span><br><span class="line">é€šå¸¸ä¸€ä¸ªWebæœåŠ¡å™¨å¯ä»¥å…·æœ‰å¤šä¸ªåå­—ï¼Œå®¢æˆ·æµè§ˆå™¨å¯ä»¥ä½¿ç”¨æ‰€æœ‰è¿™äº›åå­—æˆ–IPåœ°å€æ¥è®¿é—®è¿™å°æœåŠ¡å™¨ï¼Œä½†åœ¨æ²¡æœ‰å®šä¹‰è™šæ‹Ÿä¸»æœºçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨æ€»æ˜¯ä»¥è‡ªå·±çš„æ­£å¼åå­—å›åº”æµè§ˆå™¨ã€‚ServerNameå°±å®šä¹‰äº†WebæœåŠ¡å™¨è‡ªå·±æ‰¿è®¤çš„æ­£å¼åå­—ï¼Œä¾‹å¦‚ä¸€å°æœåŠ¡å™¨åå­—ï¼ˆåœ¨DNSä¸­å®šä¹‰äº†Aç±»å‹ï¼‰ä¸ºfreebsd.exmaple.org.cnï¼ŒåŒæ—¶ä¸ºäº†æ–¹ä¾¿è®°å¿†è¿˜å®šä¹‰äº†ä¸€ä¸ªåˆ«åï¼ˆCNAMEè®°å½•ï¼‰ä¸ºwww.exmaple.org.cnï¼Œé‚£ä¹ˆApacheè‡ªåŠ¨è§£æå¾—åˆ°çš„åå­—å°±ä¸ºfreebsd.example.org.cnï¼Œè¿™æ ·ä¸ç®¡å®¢æˆ·æµè§ˆå™¨ä½¿ç”¨å“ªä¸ªåå­—å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ€»æ˜¯å‘Šè¯‰å®¢æˆ·ç¨‹åºè‡ªå·±ä¸ºfreebsd.example.org.cnã€‚è™½ç„¶è¿™ä¸€èˆ¬å¹¶ä¸ä¼šé€ æˆä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æŸä¸€å¤©æœåŠ¡å™¨å¯èƒ½è¿ç§»åˆ°å…¶ä»–è®¡ç®—æœºä¸Šï¼Œè€Œåªæƒ³é€šè¿‡æ›´æ”¹DNSä¸­çš„wwwåˆ«åé…ç½®å°±å®Œæˆè¿ç§»ä»»åŠ¡ï¼Œæ‰€ä»¥ä¸æƒ³è®©å®¢æˆ·åœ¨å…¶ä¹¦ç­¾ä¸­ä½¿ç”¨ freebsdè®°å½•ä¸‹è¿™ä¸ªæœåŠ¡å™¨çš„åœ°å€ï¼Œå°±å¿…é¡»ä½¿ç”¨ServerNameæ¥é‡æ–°æŒ‡å®šæœåŠ¡å™¨çš„æ­£å¼åå­—ã€‚</span><br><span class="line">ã€€ã€€</span><br><span class="line">3ï¼‰</span><br><span class="line"><span class="meta">#</span><span class="bash"> DocumentRoot â€œ/var/www/htmlâ€œ</span></span><br><span class="line">DocumentRootå®šä¹‰è¿™ä¸ªæœåŠ¡å™¨å¯¹å¤–å‘å¸ƒçš„è¶…æ–‡æœ¬æ–‡æ¡£å­˜æ”¾çš„è·¯å¾„ï¼Œå®¢æˆ·ç¨‹åºè¯·æ±‚çš„UR Lå°±è¢«æ˜ å°„ä¸ºè¿™ä¸ªç›®å½•ä¸‹çš„ç½‘é¡µæ–‡ä»¶ã€‚è¿™ä¸ªç›®å½•ä¸‹çš„å­ç›®å½•ï¼Œä»¥åŠä½¿ç”¨ç¬¦å·è¿æ¥æŒ‡å‡ºçš„æ–‡ä»¶å’Œç›®å½•éƒ½èƒ½è¢«æµè§ˆå™¨è®¿é—®ï¼Œåªæ˜¯è¦åœ¨URLä¸Šä½¿ç”¨åŒæ ·çš„ç›¸å¯¹ç›®å½•åã€‚æ³¨æ„ï¼Œç¬¦å·è¿æ¥è™½ç„¶é€»è¾‘ä¸Šä½äºæ ¹æ–‡æ¡£ç›®å½•ä¹‹ä¸‹ï¼Œä½†å®é™…ä¸Šå¯ä»¥ä½äºè®¡ç®—æœºä¸Šçš„ä»»æ„ç›®å½•ä¸­ï¼Œå› æ­¤å¯ä»¥ä½¿å®¢æˆ·ç¨‹åºèƒ½è®¿é—®é‚£äº›æ ¹æ–‡æ¡£ç›®å½•ä¹‹å¤–çš„ç›®å½•ï¼Œè¿™åœ¨å¢åŠ äº†çµæ´»æ€§çš„åŒæ—¶ä½†å‡å°‘äº†å®‰å…¨æ€§ã€‚Apacheåœ¨ç›®å½•çš„è®¿é—®æ§åˆ¶ä¸­æä¾›äº†FollowSymLinksé€‰é¡¹æ¥æ‰“å¼€æˆ–å…³é—­æ”¯æŒç¬¦å·è¿æ¥çš„ç‰¹æ€§ã€‚</span><br><span class="line">4ï¼‰</span><br><span class="line"><span class="meta">#</span><span class="bash"> &lt;Directory /&gt;</span></span><br><span class="line">ã€€ã€€ Options FollowSymLinks</span><br><span class="line">ã€€ã€€ AllowOverride None</span><br><span class="line">ã€€ã€€&lt;/Directory&gt;</span><br><span class="line">ApacheæœåŠ¡å™¨å¯ä»¥é’ˆå¯¹ç›®å½•è¿›è¡Œæ–‡æ¡£çš„è®¿é—®æ§åˆ¶ï¼Œç„¶è€Œè®¿é—®æ§åˆ¶å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å®ç°ï¼Œä¸€ä¸ªæ˜¯åœ¨è®¾ç½®æ–‡ä»¶ httpd.confï¼ˆæˆ–access.confï¼‰ä¸­é’ˆå¯¹æ¯ä¸ªç›®å½•è¿›è¡Œè®¾ç½®ï¼Œå¦ä¸€ä¸ªæ–¹æ³•æ˜¯åœ¨æ¯ä¸ªç›®å½•ä¸‹è®¾ç½®è®¿é—®æ§åˆ¶æ–‡ä»¶ï¼Œé€šå¸¸è®¿é—®æ§åˆ¶æ–‡ä»¶åå­—ä¸º.htaccessã€‚è™½ç„¶ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹å¼éƒ½èƒ½ç”¨äºæ§åˆ¶æµè§ˆå™¨çš„è®¿é—®ï¼Œç„¶è€Œä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹æ³•è¦æ±‚æ¯æ¬¡æ”¹åŠ¨åé‡æ–°å¯åŠ¨httpdå®ˆæŠ¤è¿›ç¨‹ï¼Œæ¯”è¾ƒä¸çµæ´»ï¼Œå› æ­¤ä¸»è¦ç”¨äºé…ç½®æœåŠ¡å™¨ç³»ç»Ÿçš„æ•´ä½“å®‰å…¨æ§åˆ¶ç­–ç•¥ï¼Œè€Œä½¿ç”¨æ¯ä¸ªç›®å½•ä¸‹çš„.htaccessæ–‡ä»¶è®¾ç½®å…·ä½“ç›®å½•çš„è®¿é—®æ§åˆ¶æ›´ä¸ºçµæ´»æ–¹ä¾¿.</span><br><span class="line">ã€€ç”±äºApacheå¯¹ä¸€ä¸ªç›®å½•çš„è®¿é—®æ§åˆ¶è®¾ç½®æ˜¯èƒ½å¤Ÿè¢«ä¸‹ä¸€çº§ç›®å½•ç»§æ‰¿çš„ï¼Œå› æ­¤å¯¹æ ¹ç›®å½•çš„è®¾ç½®å°†å½±å“åˆ°å®ƒçš„ä¸‹çº§ç›®å½•ã€‚æ³¨æ„ç”±äºAllowOverride Noneçš„è®¾ç½®ï¼Œä½¿å¾—ApacheæœåŠ¡å™¨ä¸éœ€è¦æŸ¥çœ‹æ ¹ç›®å½•ä¸‹çš„è®¿é—®æ§åˆ¶æ–‡ä»¶ï¼Œä¹Ÿä¸éœ€è¦æŸ¥çœ‹ä»¥ä¸‹å„çº§ç›®å½•ä¸‹çš„è®¿é—®æ§åˆ¶æ–‡ä»¶ï¼Œç›´è‡³httpd.confï¼ˆæˆ–access.conf ï¼‰ä¸­ä¸ºæŸä¸ªç›®å½•æŒ‡å®šäº†å…è®¸Alloworrideï¼Œå³å…è®¸æŸ¥çœ‹è®¿é—®æ§åˆ¶æ–‡ä»¶ã€‚ç”±äºApacheå¯¹ç›®å½•è®¿é—®æ§åˆ¶æ˜¯é‡‡ç”¨çš„ç»§æ‰¿æ–¹å¼ï¼Œå¦‚æœä»æ ¹ç›®å½•å°±å…è®¸æŸ¥çœ‹è®¿é—®æ§åˆ¶æ–‡ä»¶ï¼Œé‚£ä¹ˆApacheå°±å¿…é¡»ä¸€çº§ä¸€çº§çš„æŸ¥çœ‹è®¿é—®æ§åˆ¶æ–‡ä»¶ï¼Œå¯¹ç³»ç»Ÿæ€§èƒ½ä¼šé€ æˆå½±å“ã€‚è€Œç¼ºçœå…³é—­äº†æ ¹ç›®å½•çš„è¿™ä¸ªç‰¹æ€§ï¼Œå°±ä½¿å¾—Apacheä»httpd.confä¸­å…·ä½“æŒ‡å®šçš„ç›®å½•å‘ä¸‹æœå¯»ï¼Œå‡å°‘äº†æœå¯»çš„çº§æ•°ï¼Œå¢åŠ äº†ç³»ç»Ÿæ€§èƒ½ã€‚å› æ­¤å¯¹äºç³»ç»Ÿæ ¹ç›®å½•è®¾ç½®AllowOverride Noneä¸ä½†å¯¹äºç³»ç»Ÿå®‰å…¨æœ‰å¸®åŠ©ï¼Œä¹Ÿæœ‰ç›Šäºç³»ç»Ÿæ€§èƒ½ã€‚</span><br><span class="line">ã€€ã€€&lt;Directory /&gt;</span><br><span class="line">   Options Indexes FollowSymLinks</span><br><span class="line">ã€€ã€€ AllowOverride None</span><br><span class="line">ã€€ã€€ Order allow,deny</span><br><span class="line">ã€€ã€€ Allow from all</span><br><span class="line">ã€€ã€€&lt;/Directory&gt;</span><br><span class="line">è¿™é‡Œå®šä¹‰çš„æ˜¯ç³»ç»Ÿå¯¹å¤–å‘å¸ƒæ–‡æ¡£çš„ç›®å½•çš„è®¿é—®è®¾ç½®ï¼Œè®¾ç½®ä¸åŒçš„AllowOverrideé€‰é¡¹ï¼Œä»¥å®šä¹‰é…ç½®æ–‡ä»¶ä¸­çš„ç›®å½•è®¾ç½®å’Œç”¨æˆ·ç›®å½•ä¸‹çš„å®‰å…¨æ§åˆ¶æ–‡ä»¶çš„å…³ç³»ï¼Œè€ŒOptionsé€‰é¡¹ç”¨äºå®šä¹‰è¯¥ç›®å½•çš„ç‰¹æ€§ã€‚</span><br><span class="line"><span class="meta">#</span><span class="bash">  ErrorLog /var/<span class="built_in">log</span>/httpd-error.log</span></span><br><span class="line">ã€€ã€€LogLevel warn</span><br><span class="line">ã€€ã€€LogFormat â€œ%h %l %u %t \â€œ%r\â€œ %&gt;s %b \â€œ%&#123;Referer&#125;i\â€œ \â€œ%&#123;User-Agent&#125;i\â€œâ€œ combined</span><br><span class="line">ã€€ã€€LogFormat â€œ%h %l %u %t \â€œ%r\â€œ %&gt;s %bâ€œ common</span><br><span class="line">ã€€ã€€LogFormat â€œ%&#123;Referer&#125;i -&gt; %Uâ€œ referer</span><br><span class="line">ã€€ã€€LogFormat â€œ%&#123;User-agent&#125;iâ€œ agent</span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash">CustomLog /var/<span class="built_in">log</span>/httpd-access.log common</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash">CustomLog /var/<span class="built_in">log</span>/httpd-referer.log referer</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash">CustomLog /var/<span class="built_in">log</span>/httpd-agent.log agent</span></span><br><span class="line">ã€€ã€€CustomLog /var/log/httpd-access.log combined</span><br><span class="line">è¿™é‡Œå®šä¹‰äº†ç³»ç»Ÿæ—¥å¿—çš„å½¢å¼ï¼Œå¯¹äºæœåŠ¡å™¨é”™è¯¯è®°å½•ï¼Œç”±ErrorLogã€LogLevel æ¥å®šä¹‰ä¸åŒçš„é”™è¯¯æ—¥å¿—æ–‡ä»¶åŠå…¶è®°å½•å†…å®¹ã€‚ è¿™æ˜¯é€šè¿‡åœ¨ CustomLogä¸­æŒ‡å®šä¸åŒçš„è®°å½•ç±»å‹æ¥å®Œæˆçš„ã€‚commonè¡¨ç¤ºæ™®é€šçš„å¯¹å•é¡µé¢è¯·æ±‚è®¿é—®è®°å½•ï¼Œrefererè¡¨ç¤ºæ¯ä¸ªé¡µé¢çš„å¼•ç”¨è®°å½•ï¼Œå¯ä»¥çœ‹å‡ºä¸€ä¸ªé¡µé¢ä¸­åŒ…å«çš„è¯·æ±‚æ•°ï¼Œagentè¡¨ç¤ºå¯¹å®¢æˆ·æœºçš„ç±»å‹è®°å½•ï¼Œæ˜¾ç„¶å¯ä»¥å°†ç°æœ‰çš„combined å®šä¹‰çš„è®¾ç½®è¡Œæ³¨é‡Šæ‰ï¼Œå¹¶ä½¿ç”¨commonã€refererå’Œagentä½œä¸ºCustomLogçš„å‚æ•°ï¼Œæ¥ä¸ºä¸åŒç§ç±»çš„æ—¥å¿—åˆ†åˆ«æŒ‡å®šæ—¥å¿—è®°å½•æ–‡ä»¶ã€‚æ˜¾ç„¶ï¼ŒLogFormatæ˜¯ç”¨äºå®šä¹‰ä¸åŒç±»å‹çš„æ—¥å¿—è¿›è¡Œè®°å½•æ—¶ä½¿ç”¨çš„æ ¼å¼ï¼Œ è¿™é‡Œä½¿ç”¨äº†ä»¥%å¼€å¤´çš„å®å®šä¹‰ï¼Œä»¥è®°å½•ä¸åŒçš„å†…å®¹ã€‚</span><br><span class="line">å¦‚æœè¿™äº›å‚æ•°æŒ‡å®šçš„æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆå°±æ˜¯ç›¸å¯¹äºServerRootçš„è·¯å¾„ã€‚</span><br><span class="line"><span class="meta">#</span><span class="bash"> Alias /icons/ â€œ/usr/<span class="built_in">local</span>/www/icons/â€œ</span></span><br><span class="line">ã€€ã€€ Options Indexes MultiViews</span><br><span class="line">ã€€ã€€ AllowOverride None</span><br><span class="line">ã€€ã€€ Order allow,deny</span><br><span class="line">ã€€ã€€ Allow from all</span><br><span class="line">Aliaså‚æ•°ç”¨äºå°†URLä¸æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„çœŸå®ä½ç½®è¿›è¡Œç›´æ¥æ˜ å°„ï¼Œä¸€èˆ¬çš„æ–‡æ¡£å°†åœ¨DocumentRoot ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶è€Œä½¿ç”¨Aliaså®šä¹‰çš„è·¯å¾„å°†ç›´æ¥æ˜ å°„åˆ°ç›¸åº”ç›®å½•ä¸‹ï¼Œè€Œä¸å†åˆ°DocumentRoot ä¸‹é¢è¿›è¡ŒæŸ¥è¯¢ã€‚å› æ­¤Aliaså¯ä»¥ç”¨æ¥æ˜ å°„ä¸€äº›å…¬ç”¨æ–‡ä»¶çš„è·¯å¾„ï¼Œä¾‹å¦‚ä¿å­˜äº†å„ç§å¸¸ç”¨å›¾æ ‡çš„iconsè·¯å¾„ã€‚è¿™æ ·ä½¿å¾—é™¤äº†ä½¿ç”¨ç¬¦å·è¿æ¥ä¹‹å¤–ï¼Œæ–‡æ¡£æ ¹ç›®å½•ï¼ˆDocumentRootï¼‰å¤–çš„ç›®å½•ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨äº†Aliasæ˜ å°„ï¼Œæä¾›ç»™æµè§ˆå™¨è®¿é—®ã€‚</span><br><span class="line">å®šä¹‰å¥½æ˜ å°„çš„è·¯å¾„ä¹‹åï¼Œåº”è¯¥éœ€è¦ä½¿ç”¨Directoryè¯­å¥è®¾ç½®è®¿é—®é™åˆ¶ã€‚</span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash">NameVirtualHost 12.34.56.78:80</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash">NameVirtualHost 12.34.56.78</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash"> ServerAdmin webmaster@host.some_domain.com</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash"> DocumentRoot /www/docs/host.some_domain.com</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash"> ServerName host.some_domain.com</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash"> ErrorLog logs/host.some_domain.com-error_log</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash"> CustomLog logs/host.some_domain.com-access_log common</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span></span><br><span class="line">è¿™ä¸ªå­—æ®µæ˜¯è™šæ‹Ÿä¸»æœºçš„ç›¸å…³å†…å®¹ï¼Œè™šæ‹Ÿä¸»æœºæ˜¯åœ¨ä¸€å°WebæœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥ä¸ºå¤šä¸ªå•ç‹¬åŸŸåæä¾›WebæœåŠ¡ï¼Œå¹¶ä¸”æ¯ä¸ªåŸŸåéƒ½å®Œå…¨ç‹¬ç«‹ï¼ŒåŒ…æ‹¬å…·æœ‰å®Œå…¨ç‹¬ç«‹çš„æ–‡æ¡£ç›®å½•ç»“æ„åŠè®¾ç½®ï¼Œè¿™æ ·åŸŸåä¹‹é—´å®Œå…¨ç‹¬ç«‹ï¼Œä¸ä½†ä½¿ç”¨æ¯ä¸ªåŸŸåè®¿é—®åˆ°çš„å†…å®¹å®Œå…¨ç‹¬ç«‹ï¼Œå¹¶ä¸”ä½¿ç”¨å¦ä¸€ä¸ªåŸŸåæ— æ³•è®¿é—®å…¶ä»–åŸŸåæä¾›çš„ç½‘é¡µå†…å®¹ã€‚</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;WebåŸºç¡€&quot;&gt;&lt;a href=&quot;#WebåŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;WebåŸºç¡€&quot;&gt;&lt;/a&gt;WebåŸºç¡€&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬å¹³æ—¶ä¸Šç½‘çš„æ—¶å€™ï¼Œè¾“å…¥ç½‘å€çš„æ—¶å€™éƒ½ä¼šè¾“å…¥ä»€ä¹ˆï¼Œ&lt;a href=&quot;http://www.baidu.comï¼Œå¯¹ä¸å¯¹ï¼Œ
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/Linux%E7%AE%80%E6%98%93%E6%9C%8D%E5%8A%A1%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="LinuxåŸºç¡€æœåŠ¡" scheme="http://www.toberoot.com/tags/Linux%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>æ—¶é—´åŒæ­¥æœåŠ¡NTPå’ŒChony</title>
    <link href="http://www.toberoot.com/2016/12/23/booboo_easy_service/06_ntp_chrony/"/>
    <id>http://www.toberoot.com/2016/12/23/booboo_easy_service/06_ntp_chrony/</id>
    <published>2016-12-22T21:06:27.000Z</published>
    <updated>2020-03-24T05:02:31.706Z</updated>
    
    <content type="html"><![CDATA[<table><thead><tr><th align="left">æœåŠ¡</th><th align="left">åŸŸåè§£ææœåŠ¡</th><th align="left">æ–‡ä»¶å…±äº«æœåŠ¡</th><th align="left"></th><th align="left"></th><th align="left">webæœåŠ¡</th></tr></thead><tbody><tr><td align="left"></td><td align="left">DNS</td><td align="left">FTP</td><td align="left">NFS</td><td align="left">SAMBA</td><td align="left">APACHE</td></tr><tr><td align="left">è½¯ä»¶</td><td align="left">bind    bind-chroot</td><td align="left">vsftpd</td><td align="left">rpcbind nfs-utils</td><td align="left">samba    samba-common</td><td align="left">httpd</td></tr><tr><td align="left">æœåŠ¡</td><td align="left">named</td><td align="left">vsftpd</td><td align="left">rpcbind nfs</td><td align="left">smb nmb</td><td align="left">httpd</td></tr><tr><td align="left">daemon</td><td align="left">named</td><td align="left">vsftpd</td><td align="left">rpcbind nfs</td><td align="left">smbd nmbd</td><td align="left">httpd</td></tr><tr><td align="left">ç«¯å£å·</td><td align="left">53</td><td align="left">21</td><td align="left">111 2049</td><td align="left">137 138 139 445</td><td align="left">80 8080</td></tr><tr><td align="left">é…ç½®æ–‡ä»¶</td><td align="left">/etc/named.conf /etc/named.rfc1912.zones</td><td align="left">/etc/vsftpd/vsftpd.conf</td><td align="left">/etc/exports</td><td align="left">/etc/samba/smb.conf</td><td align="left">/etc/httpd/conf/httpd.conf</td></tr><tr><td align="left">æ•°æ®æ–‡ä»¶</td><td align="left">/var/named/</td><td align="left">/var/ftp/</td><td align="left"></td><td align="left">/var/lib/samba</td><td align="left">/var/www</td></tr><tr><td align="left">å®¢æˆ·ç«¯</td><td align="left"></td><td align="left">lftp</td><td align="left">rpcbind</td><td align="left">samba-client</td><td align="left">elinks</td></tr><tr><td align="left">å‘½ä»¤</td><td align="left">nslookup</td><td align="left">lftp</td><td align="left">nfs-utils mount</td><td align="left">smbclient</td><td align="left">links</td></tr></tbody></table><h3 id="NtpæœåŠ¡çš„ä½œç”¨"><a href="#NtpæœåŠ¡çš„ä½œç”¨" class="headerlink" title="NtpæœåŠ¡çš„ä½œç”¨"></a>NtpæœåŠ¡çš„ä½œç”¨</h3><p>å¤§å®¶è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çš„ä¸»æœºæ—¶é—´ä¸å‡†ï¼Œå¯ä»¥æ€ä¹ˆåšï¼Ÿæœ‰å°†ç¡¬ä»¶æ—¶é—´å’Œè½¯ä»¶æ—¶é—´åŒæ­¥çš„åŠæ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>date -s</code>å»è®¾ç½®ä¸€ä¸ªæ—¶é—´ï¼Œä½†æ˜¯ä½ æ€ä¹ˆçŸ¥é“ä½ è®¾ç½®çš„æ—¶é—´å°±ä¸€å®šå‡†äº†ï¼Œæˆ–è€…è¯´ä½ èƒ½ç¡®å®šç¡¬ä»¶æ—¶é—´ä¸€å®šå‡†ä¹ˆï¼Ÿä¸èƒ½ä¿è¯å§ï¼Ÿé‚£è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æ‰¾å¤©æ–‡å°æˆ–è€…ä¸€äº›ç½‘ç»œä¸Šçš„æ—¶é—´æœåŠ¡å™¨å»åšåŒæ­¥ï¼Œé‚£è¿™æ—¶å€™æ€ä¹ˆå»åšå‘¢ï¼Ÿ</p><p>è¿™é‡Œå°±ç”¨åˆ°ä¸€ç§æœåŠ¡äº†ï¼Œè¿™ç§æœåŠ¡å«åšntpæœåŠ¡ï¼Œå®ƒæ˜¯ä¸€ç§é’ˆå¯¹æ—¶é—´åŒæ­¥çš„æœåŠ¡ã€‚</p><h3 id="NtpæœåŠ¡çš„åŸç†"><a href="#NtpæœåŠ¡çš„åŸç†" class="headerlink" title="NtpæœåŠ¡çš„åŸç†"></a>NtpæœåŠ¡çš„åŸç†</h3><p>å…¶å®æ›´ç»†åŒ–æ¥è¯´ï¼ŒNTPæœåŠ¡å™¨ï¼ˆNetwork Time Protocolï¼‰æ˜¯ç”¨æ¥ä½¿è®¡ç®—æœºæ—¶é—´åŒæ­¥åŒ–çš„ä¸€ç§åè®®ï¼Œå®ƒå¯ä»¥ä½¿è®¡ç®—æœºå¯¹å…¶æœåŠ¡å™¨æˆ–æ—¶é’Ÿæºï¼ˆå¦‚çŸ³è‹±é’Ÿï¼ŒGPSç­‰ç­‰)åšåŒæ­¥åŒ–ï¼Œå®ƒå¯ä»¥æä¾›é«˜ç²¾å‡†åº¦çš„æ—¶é—´æ ¡æ­£ï¼ˆLANä¸Šä¸æ ‡å‡†é—´å·®å°äº1æ¯«ç§’ï¼ŒWANä¸Šå‡ åæ¯«ç§’ï¼‰ï¼Œä¸”å¯ä»‹ç”±åŠ å¯†ç¡®è®¤çš„æ–¹å¼æ¥é˜²æ­¢æ¶æ¯’çš„åè®®æ”»å‡»ã€‚æ—¶é—´æŒ‰NTPæœåŠ¡å™¨çš„ç­‰çº§ä¼ æ’­ã€‚æŒ‰ç…§ç¦»å¤–éƒ¨UTCæºçš„è¿œè¿‘æŠŠæ‰€æœ‰æœåŠ¡å™¨å½’å…¥ä¸åŒçš„Stratumï¼ˆå±‚ï¼‰ä¸­ã€‚</p><p>Stratumå±‚ä¹Ÿæ˜¯ä¸€ä¸ªåˆ†å±‚å¼çš„ç»“æ„ï¼Œä¸‹ä¸€å±‚æ‰¾ä¸Šä¸€å±‚åšåŒæ­¥ï¼Œä¸Šä¸€å±‚è¿˜æœ‰ä¸Šä¸€å±‚ã€‚ä»¥æ­¤ç±»æ¨ã€‚</p><h3 id="æ—¶é—´åŒæ­¥æœåŠ¡é…ç½®"><a href="#æ—¶é—´åŒæ­¥æœåŠ¡é…ç½®" class="headerlink" title="æ—¶é—´åŒæ­¥æœåŠ¡é…ç½®"></a>æ—¶é—´åŒæ­¥æœåŠ¡é…ç½®</h3><p>æœåŠ¡ç«¯</p><table><thead><tr><th align="left"></th><th align="left">rhel6</th><th align="left">rhel7</th></tr></thead><tbody><tr><td align="left">è½¯ä»¶</td><td align="left">ntp</td><td align="left">chrony</td></tr><tr><td align="left">service</td><td align="left">ntpd</td><td align="left">chronyd</td></tr><tr><td align="left">daemon</td><td align="left">ntpd</td><td align="left">chronyd</td></tr><tr><td align="left">é…ç½®æ–‡ä»¶</td><td align="left">/etc/ntp.conf</td><td align="left">/etc/chrony.conf</td></tr><tr><td align="left">æ•°æ®æ–‡ä»¶</td><td align="left">/var/lib/ntp</td><td align="left">/var/lib/chrony</td></tr><tr><td align="left">æ—¥å¿—æ–‡ä»¶</td><td align="left">/var/log/ntpstats</td><td align="left">/var/log/chrony</td></tr></tbody></table><p>å®¢æˆ·ç«¯</p><table><thead><tr><th align="left">å‘½ä»¤</th><th align="left">ntpdate</th><th align="left">timedatectl</th></tr></thead><tbody><tr><td align="left"></td><td align="left">ntpdate 172.25.0.11</td><td align="left">timedatectl set-ntp 1</td></tr></tbody></table><h3 id="é¡¹ç›®å®è·µ1ï¼šé…ç½®ntpæ—¶é—´åŒæ­¥æœåŠ¡å™¨"><a href="#é¡¹ç›®å®è·µ1ï¼šé…ç½®ntpæ—¶é—´åŒæ­¥æœåŠ¡å™¨" class="headerlink" title="é¡¹ç›®å®è·µ1ï¼šé…ç½®ntpæ—¶é—´åŒæ­¥æœåŠ¡å™¨"></a>é¡¹ç›®å®è·µ1ï¼šé…ç½®ntpæ—¶é—´åŒæ­¥æœåŠ¡å™¨</h3><p>rhel6 è½¯ä»¶</p><p>ntp-4.2.6p5-1.el6.x86_64</p><h4 id="é…ç½®è¯¦è§£"><a href="#é…ç½®è¯¦è§£" class="headerlink" title="é…ç½®è¯¦è§£"></a>é…ç½®è¯¦è§£</h4><p>NTPå®‰å…¨è®¾ç½®(restrict)</p><p>è¿è¡Œä¸€ä¸ªNTP Serverä¸éœ€è¦å ç”¨å¾ˆå¤šçš„ç³»ç»Ÿèµ„æº,æ‰€ä»¥ä¹Ÿä¸ç”¨ä¸“é—¨é…ç½®ç‹¬ç«‹çš„æœåŠ¡å™¨,å°±å¯ä»¥ç»™è®¸å¤šclientæä¾›æ—¶é—´åŒæ­¥æœåŠ¡, ä½†æ˜¯ä¸€äº›åŸºæœ¬çš„å®‰å…¨è®¾ç½®è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„é‚£ä¹ˆè¿™é‡Œä¸€ä¸ªå¾ˆç®€å•çš„æ€è·¯å°±æ˜¯ç¬¬ä¸€æˆ‘ä»¬åªå…è®¸å±€åŸŸç½‘å†…ä¸€éƒ¨åˆ†çš„ç”¨æˆ·è¿æ¥åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨. ç¬¬äºŒä¸ªå°±æ˜¯è¿™äº›clientä¸èƒ½ä¿®æ”¹æˆ‘ä»¬æœåŠ¡å™¨ä¸Šçš„æ—¶é—´</p><p>driftfile /var/lib/ntp/drift  #ä¾¦æµ‹BIOSæ—¶é’Ÿä¸Linuxç³»ç»Ÿæ—¶é—´çš„å·®å¼‚å†™å…¥æ¬¡æ–‡ä»¶ã€‚</p><p>åˆ©ç”¨restrict æ¥ç®¡ç†æƒé™æ§åˆ¶</p><p>Restrict [IP]  mask [netmask_IP] [parameter]</p><p>Parameter çš„å‚æ•°ä¸»è¦å¦‚ä¸‹ï¼š</p><ul><li>ignore :æ‹’ç»æ‰€æœ‰ç±»å‹çš„NTPè”æœºã€‚</li><li>nomodify: å®¢æˆ·ç«¯ä¸èƒ½ä½¿ç”¨ntpc ä¸ntpq è¿™ä¸¤ä¸ªç¨‹åºæ¥ä¿®æ”¹æœåŠ¡å™¨çš„æ—¶é—´å‚æ•°ï¼Œä½†å®¢æˆ·ç«¯å¯é€è¿‡è¿™éƒ¨ä¸»æœºæ¥è¿›è¡Œç½‘ç»œæ ¡æ—¶ï¼›</li><li>noquery:å®¢æˆ·ç«¯ä¸èƒ½å¤Ÿä½¿ç”¨ntpc ä¸ntpq ç­‰æŒ‡ä»¤æ¥æŸ¥è¯¢æ—¶é—´æœåŠ¡å™¨ï¼Œä¸æä¾›NTPçš„ç½‘ç»œæ ¡æ—¶ã€‚</li><li>notrap:ä¸æä¾›trap è¿™ä¸ªè¿ç¨‹äº‹ä»¶ç™»å…¥çš„åŠŸèƒ½ã€‚</li><li>notrust:æ‹’ç»æ²¡æœ‰è®¤è¯çš„å®¢æˆ·ç«¯ã€‚</li><li>Kod:kodæŠ€æœ¯å¯ä»¥é˜»æ­¢â€œKiss of Death â€œåŒ…å¯¹æœåŠ¡å™¨çš„ç ´åã€‚æ‹’ç»æœåŠ¡æ”»å‡»</li><li>Nopeer:ä¸ä¸å…¶ä»–åŒä¸€å±‚çš„NTPæœåŠ¡å™¨è¿›è¡Œæ—¶é—´åŒæ­¥ã€‚</li></ul><p>åˆ©ç”¨server è®¾å®šä¸Šå±‚NTPæœåŠ¡å™¨ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><p>server [IP or hostname] [prefer]</p><ul><li><p>perfer:è¡¨ç¤ºä¼˜å…ˆçº§æœ€é«˜</p></li><li><p>burst ï¼šå½“ä¸€ä¸ªè¿ç¨‹NTPæœåŠ¡å™¨å¯ç”¨æ—¶ï¼Œå‘å®ƒå‘é€ä¸€ç³»åˆ—çš„å¹¶å‘åŒ…è¿›è¡Œæ£€æµ‹ã€‚</p></li><li><p>iburst ï¼šå½“ä¸€ä¸ªè¿ç¨‹NTPæœåŠ¡å™¨ä¸å¯ç”¨æ—¶ï¼Œå‘å®ƒå‘é€ä¸€ç³»åˆ—çš„å¹¶å‘åŒ…è¿›è¡Œæ£€æµ‹ã€‚</p><p>æ³¨ï¼šé»˜è®¤æƒ…å†µå°15åˆ†é’Ÿåæ‰ä¼šä¸ä¸Šå±‚NTPæœåŠ¡å™¨è¿›è¡Œæ—¶é—´æ ¡å¯¹ã€‚</p></li></ul><blockquote><p>è°èƒ½æ¥åŒæ­¥æˆ‘çš„æ—¶é—´ï¼Ÿ</p></blockquote><p>é¦–å…ˆæˆ‘ä»¬å¯¹äºé»˜è®¤çš„clientæ‹’ç»æ‰€æœ‰çš„æ“ä½œ</p><p>ä»£ç :<br><code>restrict default kod nomodify notrap nopeer noquery</code></p><p>ç„¶åå…è®¸æœ¬æœºåœ°å€ä¸€åˆ‡çš„æ“ä½œ</p><p>ä»£ç :<br><code>restrict 127.0.0.1</code></p><p>æœ€åæˆ‘ä»¬å…è®¸å±€åŸŸç½‘å†…æ‰€æœ‰clientè¿æ¥åˆ°è¿™å°æœåŠ¡å™¨åŒæ­¥æ—¶é—´.ä½†æ˜¯æ‹’ç»è®©ä»–ä»¬ä¿®æ”¹æœåŠ¡å™¨ä¸Šçš„æ—¶é—´</p><p>ä»£ç :<br><code>restrict 172.25.0.0 mask 255.255.255.0 nomodify</code></p><blockquote><p>æˆ‘å»åŒæ­¥è°çš„æ—¶é—´ï¼Ÿ</p></blockquote><p>server     æ—¶é—´åŒæ­¥æœåŠ¡å™¨    å±‚æ•°æ¯”æˆ‘é«˜çš„ï¼ŒåŠæ•°å­—æ¯”æˆ‘å°çš„</p><p>ä»£ç :</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server  127.127.1.0     # local clock</span><br><span class="line">fudge   127.127.1.0 stratum 10</span><br></pre></td></tr></table></figure><p>####ã€€è¯¦ç»†æ­¥éª¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡å™¨ç«¯</span></span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# yum install -y ntp</span><br><span class="line">[root@rhel6 ~]# vim /etc/ntp.conf</span><br><span class="line">[root@rhel6 ~]# grep -v "^#" /etc/ntp.conf|grep -v "^$"</span><br><span class="line">driftfile /var/lib/ntp/drift</span><br><span class="line">restrict default kod nomodify notrap nopeer noquery</span><br><span class="line">restrict -6 default kod nomodify notrap nopeer noquery</span><br><span class="line">restrict 127.0.0.1</span><br><span class="line">restrict -6 ::1</span><br><span class="line">restrict 172.25.0.0 mask 255.255.255.0 nomodify</span><br><span class="line">server 172.25.0.11</span><br><span class="line">server  127.127.1.0     </span><br><span class="line">fudge   127.127.1.0 stratum 10</span><br><span class="line">includefile /etc/ntp/crypto/pw</span><br><span class="line">keys /etc/ntp/keys</span><br><span class="line">[root@rhel6 ~]# service ntpd start</span><br><span class="line">Starting ntpd:                                             [  OK  ]</span><br><span class="line">[root@rhel6 ~]# service iptables stop</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯</span></span><br><span class="line">[root@rhel7 ~]# which ntpdate</span><br><span class="line">/usr/sbin/ntpdate</span><br><span class="line">[root@rhel7 ~]# rpm -qf /usr/sbin/ntpdate</span><br><span class="line">ntpdate-4.2.6p5-18.el7.x86_64</span><br><span class="line">[root@rhel7 ~]# systemctl stop firewalld</span><br><span class="line">[root@rhel7 ~]# ntpdate 172.25.0.11</span><br><span class="line"> 2 Aug 06:36:51 ntpdate[8128]: step time server 172.25.0.11 offset -0.691491 sec</span><br><span class="line">[root@rhel7 ~]# date -s "2016-08-01"</span><br><span class="line">Mon Aug  1 00:00:00 EDT 2016</span><br><span class="line">[root@rhel7 ~]# date</span><br><span class="line">Mon Aug  1 00:00:01 EDT 2016</span><br><span class="line">[root@rhel7 ~]# ntpdate 172.25.0.11</span><br><span class="line"> 2 Aug 06:37:35 ntpdate[8140]: step time server 172.25.0.11 offset 110240.425235 sec</span><br><span class="line">[root@rhel7 ~]# date</span><br><span class="line">Tue Aug  2 06:37:37 EDT 2016</span><br></pre></td></tr></table></figure><h4 id="ä¸€äº›è¡¥å……å’Œæ‹¾é—ï¼ˆæŒºé‡è¦ï¼‰"><a href="#ä¸€äº›è¡¥å……å’Œæ‹¾é—ï¼ˆæŒºé‡è¦ï¼‰" class="headerlink" title="ä¸€äº›è¡¥å……å’Œæ‹¾é—ï¼ˆæŒºé‡è¦ï¼‰"></a>ä¸€äº›è¡¥å……å’Œæ‹¾é—ï¼ˆæŒºé‡è¦ï¼‰</h4><ol><li><p>é…ç½®æ–‡ä»¶ä¸­çš„driftfileæ˜¯ä»€ä¹ˆ?<br>æˆ‘ä»¬æ¯ä¸€ä¸ªsystem clockçš„é¢‘ç‡éƒ½æœ‰å°å°çš„è¯¯å·®,è¿™ä¸ªå°±æ˜¯ä¸ºä»€ä¹ˆæœºå™¨è¿è¡Œä¸€æ®µæ—¶é—´åä¼šä¸ç²¾ç¡®.NTPä¼šè‡ªåŠ¨æ¥ç›‘æµ‹æˆ‘ä»¬æ—¶é’Ÿçš„è¯¯å·®å€¼å¹¶äºˆä»¥è°ƒæ•´.ä½†é—®é¢˜æ˜¯è¿™æ˜¯ä¸€ä¸ªå†—é•¿çš„è¿‡ç¨‹,æ‰€ä»¥å®ƒä¼šæŠŠè®°å½•ä¸‹æ¥çš„è¯¯å·®å…ˆå†™å…¥driftfile.è¿™æ ·å³ä½¿ä½ é‡æ–°å¼€æœºä»¥åä¹‹å‰çš„è®¡ç®—ç»“æœä¹Ÿå°±ä¸ä¼šä¸¢å¤±äº†</p></li><li><p>å¦‚ä½•åŒæ­¥ç¡¬ä»¶æ—¶é’Ÿ?<br>NTPä¸€èˆ¬åªä¼šåŒæ­¥system clock. ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¹Ÿè¦åŒæ­¥RTC(hwclock)çš„è¯é‚£ä¹ˆåªéœ€è¦æŠŠä¸‹é¢çš„é€‰é¡¹æ‰“å¼€å°±å¯ä»¥äº†</p></li></ol><p>ä»£ç :</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vi /etc/sysconfig/ntpd</span></span><br><span class="line">SYNC_HWCLOCK=yes</span><br></pre></td></tr></table></figure><ol start="3"><li>è®©rhel6è¿è¡Œntpdateæ›´æ–°æ—¶é—´æ—¶ï¼Œrhel6åŒæ­¥å¤±è´¥ï¼Œä¼šæç¤ºç«¯å£è¢«å ç”¨ï¼šå¦‚ä¸‹<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel6 ~]# ntpdate 172.25.0.11</span><br><span class="line"> 2 Aug 18:39:16 ntpdate[4831]: the NTP socket is in use, exiting</span><br></pre></td></tr></table></figure></li><li>åˆ©ç”¨crontabè®©rhel7 NTPå®šæ—¶æ›´æ–°æ—¶é—´<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 8 * * * /usr/sbin/ntpdate 172.25.0.11</span><br></pre></td></tr></table></figure></li></ol><hr><h3 id="chrony"><a href="#chrony" class="headerlink" title="chrony"></a>chrony</h3><p>chrony-1.29.1-1.el7.x86_64</p><p>RHELä»7.0å¼€å§‹æ”¹ç”¨chronyåŒæ­¥æ—¶é—´ï¼ŒåŸntpåŒæ­¥æ–¹å¼ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†è¦å®‰è£…ntpæœåŠ¡ã€‚</p><p>chronydæ˜¯ä¸€ä¸ªåœ¨ç³»ç»Ÿåå°è¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹ã€‚ä»–æ ¹æ®ç½‘ç»œä¸Šå…¶ä»–æ—¶é—´æœåŠ¡å™¨æ—¶é—´æ¥æµ‹é‡æœ¬æœºæ—¶é—´çš„åç§»é‡ä»è€Œè°ƒæ•´ç³»ç»Ÿæ—¶é’Ÿã€‚å¯¹äºå­¤ç«‹ç³»ç»Ÿï¼Œç”¨æˆ·å¯ä»¥æ‰‹åŠ¨å‘¨æœŸæ€§çš„è¾“å…¥æ­£ç¡®æ—¶é—´ï¼ˆé€šè¿‡chronycï¼‰ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œchronydå†³å®šè®¡ç®—æœºå¿«æ…¢çš„æ¯”ä¾‹ï¼Œå¹¶åŠ ä»¥çº æ­£ã€‚chronydå®ç°äº†NTPåè®®å¹¶ä¸”å¯ä»¥ä½œä¸ºæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ã€‚</p><h4 id="é¡¹ç›®å®è·µ2ï¼šé…ç½®chronyæ—¶é—´åŒæ­¥æœåŠ¡å™¨"><a href="#é¡¹ç›®å®è·µ2ï¼šé…ç½®chronyæ—¶é—´åŒæ­¥æœåŠ¡å™¨" class="headerlink" title="é¡¹ç›®å®è·µ2ï¼šé…ç½®chronyæ—¶é—´åŒæ­¥æœåŠ¡å™¨"></a>é¡¹ç›®å®è·µ2ï¼šé…ç½®chronyæ—¶é—´åŒæ­¥æœåŠ¡å™¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# yum install -y chrony</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# vim /etc/chrony.conf</span><br><span class="line">[root@rhel7 ~]# grep -v "^#" /etc/chrony.conf |grep -v "^$"</span><br><span class="line">server 172.25.0.10</span><br><span class="line">allow 172.25.0.0/24</span><br><span class="line">stratumweight 0</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">rtcsync</span><br><span class="line">makestep 10 3</span><br><span class="line">bindcmdaddress 127.0.0.1</span><br><span class="line">bindcmdaddress ::1</span><br><span class="line">keyfile /etc/chrony.keys</span><br><span class="line">commandkey 1</span><br><span class="line">generatecommandkey</span><br><span class="line">noclientlog</span><br><span class="line">logchange 0.5</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line">[root@rhel7 ~]# timedatectl</span><br><span class="line">      Local time: Tue 2016-08-02 07:24:15 EDT</span><br><span class="line">  Universal time: Tue 2016-08-02 11:24:15 UTC</span><br><span class="line">        RTC time: Tue 2016-08-02 11:24:15</span><br><span class="line">        Timezone: America/New_York (EDT, -0400)</span><br><span class="line">     NTP enabled: yes</span><br><span class="line">NTP synchronized: yes</span><br><span class="line"> RTC in local TZ: no</span><br><span class="line">      DST active: yes</span><br><span class="line"> Last DST change: DST began at</span><br><span class="line">                  Sun 2016-03-13 01:59:59 EST</span><br><span class="line">                  Sun 2016-03-13 03:00:00 EDT</span><br><span class="line"> Next DST change: DST ends (the clock jumps one hour backwards) at</span><br><span class="line">                  Sun 2016-11-06 01:59:59 EDT</span><br><span class="line">                  Sun 2016-11-06 01:00:00 EST</span><br></pre></td></tr></table></figure><h3 id="é¡¹ç›®æ±‡æ€»"><a href="#é¡¹ç›®æ±‡æ€»" class="headerlink" title="é¡¹ç›®æ±‡æ€»"></a>é¡¹ç›®æ±‡æ€»</h3><p><img src="sides/ntp-lab_Page_1.jpg" alt="ntp-lab_Page_1"></p><p><img src="sides/ntp-lab_Page_2.jpg" alt="ntp-lab_Page_2"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;left&quot;&gt;æœåŠ¡&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;åŸŸåè§£ææœåŠ¡&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;æ–‡ä»¶å…±äº«æœåŠ¡&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;&lt;/th&gt;
&lt;th align=&quot;le
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/Linux%E7%AE%80%E6%98%93%E6%9C%8D%E5%8A%A1%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="LinuxåŸºç¡€æœåŠ¡" scheme="http://www.toberoot.com/tags/Linux%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>é˜²ç«å¢™ iptables</title>
    <link href="http://www.toberoot.com/2016/12/23/booboo_easy_service/07_iptables_firewalld/"/>
    <id>http://www.toberoot.com/2016/12/23/booboo_easy_service/07_iptables_firewalld/</id>
    <published>2016-12-22T21:06:27.000Z</published>
    <updated>2020-03-24T05:02:31.697Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é˜²ç«å¢™çš„ä½œç”¨"><a href="#é˜²ç«å¢™çš„ä½œç”¨" class="headerlink" title="é˜²ç«å¢™çš„ä½œç”¨"></a>é˜²ç«å¢™çš„ä½œç”¨</h3><p>é˜²ç«å¢™æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå·¥ä½œåœ¨ç½‘ç»œè¾¹ç¼˜ï¼ˆä¸»æœºè¾¹ç¼˜ï¼‰ï¼Œå¯¹è¿›å‡ºç½‘ç»œæ•°æ®åŒ…åŸºäºä¸€å®šçš„è§„åˆ™æ£€æŸ¥ï¼Œå¹¶åœ¨åŒ¹é…æŸè§„åˆ™æ—¶ç”±è§„åˆ™å®šä¹‰çš„å¤„ç†è¿›è¡Œå¤„ç†çš„ä¸€ç»„åŠŸèƒ½çš„ç»„ä»¶ã€‚</p><h3 id="é˜²ç«å¢™ç±»å‹"><a href="#é˜²ç«å¢™ç±»å‹" class="headerlink" title="é˜²ç«å¢™ç±»å‹"></a>é˜²ç«å¢™ç±»å‹</h3><p>æ ¹æ®å·¥ä½œçš„å±‚æ¬¡çš„ä¸åŒæ¥åˆ’åˆ†ï¼Œå¸¸è§çš„é˜²ç«å¢™å·¥ä½œåœ¨OSIç¬¬ä¸‰å±‚ï¼Œå³ç½‘ç»œå±‚é˜²ç«å¢™ï¼Œå·¥ä½œåœ¨OSIç¬¬ä¸ƒå±‚çš„ç§°ä¸ºåº”ç”¨å±‚é˜²ç«å¢™ï¼Œæˆ–è€…ä»£ç†æœåŠ¡å™¨ï¼ˆä»£ç†ç½‘å…³ï¼‰ã€‚</p><p>ç½‘ç»œå±‚é˜²ç«å¢™åˆç§°åŒ…è¿‡æ»¤é˜²ç«å¢™ï¼Œåœ¨ç½‘ç»œå±‚å¯¹æ•°æ®åŒ…è¿›è¡Œé€‰æ‹©ï¼Œé€‰æ‹©çš„ä¾æ®æ˜¯ç³»ç»Ÿå†…è®¾ç½®çš„è¿‡æ»¤é€»è¾‘ï¼Œé€šè¿‡æ£€æŸ¥æ•°æ®æµä¸­æ¯ä¸ªæ•°æ®çš„æºåœ°å€ï¼Œç›®çš„åœ°å€ï¼Œæ‰€ç”¨ç«¯å£å·å’Œåè®®çŠ¶æ€ç­‰å› ç´ æ¥ç¡®å®šæ˜¯å¦å…è®¸è¯¥æ•°æ®åŒ…çš„é€šè¿‡ï¼Œä»¥åŠæ•°æ®åŒ…çš„æµå‘ç­‰ã€‚</p><p>è¿˜å¯ä»¥åˆ†ä¸ºç¡¬ä»¶é˜²ç«å¢™å’Œè½¯ä»¶é˜²ç«å¢™</p><h3 id="è½¯ä»¶é˜²ç«å¢™"><a href="#è½¯ä»¶é˜²ç«å¢™" class="headerlink" title="è½¯ä»¶é˜²ç«å¢™"></a>è½¯ä»¶é˜²ç«å¢™</h3><ul><li>EL6ä¸Šçš„é˜²ç«å¢™å«åšiptablesã€‚</li><li>EL7ä¸Šçš„é˜²ç«å¢™å«åšfirewalldã€‚</li></ul><h3 id="iptablesè¯­æ³•"><a href="#iptablesè¯­æ³•" class="headerlink" title="iptablesè¯­æ³•"></a>iptablesè¯­æ³•</h3><p>iptables -t table CMD chain rule-matcher -j target</p><pre><code>è¡¨      åŠ¨ä½œ é“¾    è§„åˆ™åŒ¹é…       æ‰§è¡Œæ“ä½œ</code></pre><h4 id="è¡¨table"><a href="#è¡¨table" class="headerlink" title="è¡¨table"></a>è¡¨table</h4><p>ä½¿ç”¨ -t æ¥æŒ‡å®šè¡¨,å¦‚æœçœç•¥,åˆ™ä»£è¡¨å¯¹ filter è¡¨è¿›è¡Œæ“ä½œ</p><ul><li>filter è¡¨:ç”¨äºè¿‡æ»¤æ•°æ®åŒ…</li><li>nat è¡¨:ç”¨äºä¿®æ”¹æ•°æ®åŒ…çš„æ¥æºå’Œç›®çš„åœ°</li><li>mangle è¡¨:ç”¨æˆ·ä¿®æ”¹æ•°æ®åŒ…çš„ç”Ÿå­˜å‘¨æœŸç­‰ç­‰</li><li>raw è¡¨:è·Ÿè¸ªæœºåˆ¶</li></ul><h4 id="CMDåŠ¨ä½œ"><a href="#CMDåŠ¨ä½œ" class="headerlink" title="CMDåŠ¨ä½œ"></a>CMDåŠ¨ä½œ</h4><ul><li>A è¿½åŠ </li><li>I æ’å…¥</li><li>D åˆ é™¤</li><li>L ç½—åˆ—</li><li>F æ¸…ç©º</li></ul><h4 id="è¡¨å½“ä¸­åŒ…å«é“¾chain"><a href="#è¡¨å½“ä¸­åŒ…å«é“¾chain" class="headerlink" title="è¡¨å½“ä¸­åŒ…å«é“¾chain"></a>è¡¨å½“ä¸­åŒ…å«é“¾chain</h4><p>é“¾æ˜¯ç”¨æ¥åŒºåˆ†æ•°æ®åŒ…çš„æµå‘çŠ¶æ€</p><ul><li>INPUT å…¥ç«™çš„æ•°æ®åŒ…</li><li>OUTPUT å‡ºç«™çš„æ•°æ®åŒ…</li><li>PREROUTING è·¯ç”±åˆ¤æ–­ä¹‹å‰çš„æ•°æ®åŒ…</li><li>POSTROUTING è·¯ç”±åˆ¤æ–­ä¹‹åçš„æ•°æ®åŒ…</li><li>FORWARD ç¬¬ä¸€æ¬¡è·¯ç”±åˆ¤æ–­ä¹‹å,åˆ°æœ€åä¸€è¯è·¯ç”±åˆ¤æ–­ä¹‹å‰</li></ul><h4 id="è§„åˆ™rule"><a href="#è§„åˆ™rule" class="headerlink" title="è§„åˆ™rule"></a>è§„åˆ™rule</h4><p>æ˜¯ç”¨æ¥åˆ¤æ–­æ•°æ®åŒ…çš„å…·ä½“æƒ…å†µ</p><ul><li>-p åè®®</li><li>-s æ¥æº</li><li>-d ç›®çš„åœ°</li><li>â€“sport æ¥æºç«¯å£</li><li>â€“dport ç›®çš„ç«¯å£</li><li>-i å…¥ç«™ç½‘ç»œæ¥å£</li><li>-o å‡ºç«™ç½‘ç»œæ¥å£</li><li>! å–å</li></ul><h4 id="æ‰§è¡Œæ“ä½œtarget"><a href="#æ‰§è¡Œæ“ä½œtarget" class="headerlink" title="æ‰§è¡Œæ“ä½œtarget"></a>æ‰§è¡Œæ“ä½œtarget</h4><ul><li>ACCEPT æ¥å—</li><li>DROP ä¸¢å¼ƒ</li><li>REJECT æ‹’ç»</li><li>DNAT ç›®æ ‡åœ°å€è½¬æ¢</li><li>SNAT æºåœ°å€è½¬æ¢</li></ul><h3 id="åº”ç”¨å®ä¾‹"><a href="#åº”ç”¨å®ä¾‹" class="headerlink" title="åº”ç”¨å®ä¾‹"></a>åº”ç”¨å®ä¾‹</h3><ol start="0"><li>æŸ¥çœ‹è§„åˆ™    <code>iptables -L</code></li><li>è§„åˆ™æ¸…ç©º    <code>iptables -F</code></li><li>é¢„é€‰ç­–ç•¥    <code>iptables -P INPUT ACCEPT</code></li><li>ä¿å­˜ç­–ç•¥    <code>service iptables save</code> or <code>iptables-save &gt; /etc/sysconfig/iptables</code></li><li>å¼€æœºåé‡æ–°å¯¼å…¥    <code>iptables-restore &lt; /etc/sysconfig/iptables</code></li></ol><blockquote><p>åªå…è®¸172.25.0.250å’Œä½ è‡ªå·±çš„æœåŠ¡å™¨èƒ½å¤Ÿè®¿é—®ftpæœåŠ¡ï¼ˆrhel6ï¼‰</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -s 172.25.0.250 -p tcp --dport 21 -j  ACCEPT</span><br><span class="line">iptables -A INPUT -s 172.25.0.11 -p tcp --dport 21 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 21 -j DROP</span><br></pre></td></tr></table></figure><blockquote><p>ç¦æ­¢pingåŒ…</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p icmp -j DROP</span><br></pre></td></tr></table></figure><blockquote><p>ä»…å…è®¸172.25.0.0/24ç½‘æ®µå’Œ172.25.15.0/24ç½‘æ®µç”¨æˆ·èƒ½å¤Ÿè®¿é—®æˆ‘çš„é‚®ä»¶æœåŠ¡å™¨</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -s 172.25.0.0/24 -p tcp --dport 25 -j ACCEPT</span><br><span class="line">iptables -A INPUT -s 172.25.15.0/24 -p tcp --dport 25 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 25 -j DROP</span><br></pre></td></tr></table></figure><h3 id="è¯¾å ‚ç»ƒä¹ é¢˜ç›®"><a href="#è¯¾å ‚ç»ƒä¹ é¢˜ç›®" class="headerlink" title="è¯¾å ‚ç»ƒä¹ é¢˜ç›®"></a>è¯¾å ‚ç»ƒä¹ é¢˜ç›®</h3><p>rhel6 172.25.x.11</p><ol><li><p>æ¸…ç©ºè§„åˆ™</p></li><li><p>é¢„è®¾filterè¡¨INPUTæ˜¯ACCEPT</p></li><li><p>ä»…å…è®¸172.25.254.250å’Œ172.25.254.X èƒ½å¤Ÿsshåˆ°æˆ‘çš„æœåŠ¡å™¨ï¼ˆrhel6 172.25.X.11ï¼‰ä¸Š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -s 172.25.254.250 -p tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -A INPUT -s 172.25.254.16 -p tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 22 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>ä»…å…è®¸172.25.254.0/24å’Œ172.25.X.0/24èƒ½å¤Ÿpingæˆ‘çš„æœåŠ¡å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -s 172.25.254.0/24 -p icmp -j ACCEPT</span><br><span class="line">iptables -A INPUT -s 172.25.16.0/24 -p icmp -j ACCEPT</span><br><span class="line">iptables -A INPUT -p icpm -j DROP</span><br></pre></td></tr></table></figure></li><li><p>ä¸å…è®¸172.25.254.254è®¿é—®æˆ‘çš„é‚®ä»¶æœåŠ¡å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -s 172.25.254.254 -p tcp --dport 25 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>ä¿å­˜è§„åˆ™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rhel6</span><br><span class="line">servcie iptables save</span><br><span class="line">iptables-save &gt; /etc/sysconfig/iptables</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹è§„åˆ™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -L</span><br></pre></td></tr></table></figure></li><li><p>å…³æœºé‡å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables-restore &lt; /etc/sysconfig/iptables</span><br></pre></td></tr></table></figure></li></ol><h3 id="Firewalldçš„ç”¨æ³•"><a href="#Firewalldçš„ç”¨æ³•" class="headerlink" title="Firewalldçš„ç”¨æ³•"></a>Firewalldçš„ç”¨æ³•</h3><p>Firewalldæ˜¯el7é»˜è®¤çš„é˜²ç«å¢™ï¼Œå’Œiptableså†²çªï¼Œå¦‚æœè¦ä½¿ç”¨å…¶ä¸­ä¹‹ä¸€ï¼Œéœ€è¦å…³é—­å¦å¤–ä¸€ä¸ª</p><p>è¿è¡Œã€åœæ­¢ã€ç¦ç”¨firewalld:</p><ul><li>å¯åŠ¨ï¼š<code>systemctl start  firewalld</code></li><li>æŸ¥çœ‹çŠ¶æ€ï¼š<code>systemctl status firewalld</code> æˆ–è€… <code>firewall-cmd --state</code></li><li>åœæ­¢ï¼š<code>systemctl disable firewalld</code></li><li>ç¦ç”¨ï¼š<code>systemctl stop firewalld</code></li></ul><p>å¯ä»¥é€šè¿‡</p><ol><li>firewall-configå›¾å½¢åŒ–å·¥å…· æ¥æ§åˆ¶</li><li>firewall-cmd  å‘½ä»¤è¡Œå·¥å…·</li></ol><h4 id="Firewall-config"><a href="#Firewall-config" class="headerlink" title="Firewall-config"></a>Firewall-config</h4><ol><li>Configuration    runtimeå’Œpermanent  åˆ†åˆ«æ˜¯è¿è¡Œæ—¶å’Œæ°¸ä¹…</li><li>zone é»˜è®¤åŒºåŸŸé…ç½®</li></ol><ul><li>Trustedï¼šå…è®¸æ‰€æœ‰ä¼ å…¥æ•°æ®åŒ…</li><li>dropï¼šé»˜è®¤ä¸¢å¼ƒæ‰€æœ‰åŒ…</li><li>blockï¼šæ‹’ç»æ‰€æœ‰å¤–éƒ¨è¿æ¥ï¼Œå…è®¸å†…éƒ¨å‘èµ·çš„è¿æ¥</li><li>publicï¼šæŒ‡å®šå¤–éƒ¨è¿æ¥å¯ä»¥è¿›å…¥</li><li>externalï¼šè¿™ä¸ªä¸å¤ªæ˜ç™½ï¼ŒåŠŸèƒ½ä¸Šå’Œä¸Šé¢ç›¸åŒï¼Œå…è®¸æŒ‡å®šçš„å¤–éƒ¨è¿æ¥</li><li>dmzï¼šå’Œç¡¬ä»¶é˜²ç«å¢™ä¸€æ ·ï¼Œå—é™åˆ¶çš„å…¬å…±è¿æ¥å¯ä»¥è¿›å…¥</li><li>workï¼šå·¥ä½œåŒºï¼Œæ¦‚å¿µå’Œworkgoupä¸€æ ·ï¼Œä¹Ÿæ˜¯æŒ‡å®šçš„å¤–éƒ¨è¿æ¥å…è®¸</li><li>homeï¼šç±»ä¼¼å®¶åº­ç»„</li><li>internalï¼šä¿¡ä»»æ‰€æœ‰è¿æ¥</li></ul><ol start="3"><li>å¯Œè§„åˆ™ï¼šå¯ç”¨äºè¡¨è¾¾åŸºæœ¬çš„å…è®¸å’Œæ‹’ç»è§„åˆ™ã€‚<br>Configuration  permenent</li></ol><p><img src="pic/21.png" alt="21"></p><p>å·¦ä¸Šè§’ï¼šOption  reloade firewall<br>Sshå°±æ— æ³•ç™»é™†äº†</p><h4 id="firewall-cmd"><a href="#firewall-cmd" class="headerlink" title="firewall-cmd"></a>firewall-cmd</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family=ipv4 service name="ssh" source address=192.168.137.11 log prefix="ssh" level="notice" limit value="3/m" reject\'</span><br></pre></td></tr></table></figure><p>å°†æ¥è‡ªäº192.168.137.11çš„sshæ‹’ç»æ‰ï¼Œå¹¶ä¸”å°†noticeä»¥ä¸Šçš„æ—¥å¿—å†™å…¥åˆ°sshæ—¥å¿—å½“ä¸­ï¼Œé™åˆ¶æ¯åˆ†é’Ÿæœ€å¤šä¸‰æ¡è®°å½•ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;é˜²ç«å¢™çš„ä½œç”¨&quot;&gt;&lt;a href=&quot;#é˜²ç«å¢™çš„ä½œç”¨&quot; class=&quot;headerlink&quot; title=&quot;é˜²ç«å¢™çš„ä½œç”¨&quot;&gt;&lt;/a&gt;é˜²ç«å¢™çš„ä½œç”¨&lt;/h3&gt;&lt;p&gt;é˜²ç«å¢™æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå·¥ä½œåœ¨ç½‘ç»œè¾¹ç¼˜ï¼ˆä¸»æœºè¾¹ç¼˜ï¼‰ï¼Œå¯¹è¿›å‡ºç½‘ç»œæ•°æ®åŒ…åŸºäºä¸€å®šçš„è§„åˆ™æ£€æŸ¥ï¼Œå¹¶åœ¨åŒ¹é…æŸè§„åˆ™æ—¶ç”±è§„åˆ™å®šä¹‰
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/Linux%E7%AE%80%E6%98%93%E6%9C%8D%E5%8A%A1%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="LinuxåŸºç¡€æœåŠ¡" scheme="http://www.toberoot.com/tags/Linux%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
</feed>
