<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Amy and Booboo</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.toberoot.com/"/>
  <updated>2020-03-22T14:23:51.136Z</updated>
  <id>http://www.toberoot.com/</id>
  
  <author>
    <name>BoobooWei</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hello World</title>
    <link href="http://www.toberoot.com/2020/03/22/booboo_others/hello-world/"/>
    <id>http://www.toberoot.com/2020/03/22/booboo_others/hello-world/</id>
    <published>2020-03-22T14:23:51.136Z</published>
    <updated>2020-03-22T14:23:51.136Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯å¹¿è§’" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="Hexo" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/Hexo/"/>
    
    
      <category term="hexo" scheme="http://www.toberoot.com/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>å›½åº†å‰å­¦æ´—æ‰‹</title>
    <link href="http://www.toberoot.com/2018/09/30/amy_life/%E5%9B%BD%E5%BA%86%E5%89%8D%E5%AD%A6%E6%B4%97%E6%89%8B/"/>
    <id>http://www.toberoot.com/2018/09/30/amy_life/%E5%9B%BD%E5%BA%86%E5%89%8D%E5%AD%A6%E6%B4%97%E6%89%8B/</id>
    <published>2018-09-30T10:43:53.000Z</published>
    <updated>2020-03-22T08:31:38.472Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©äººå°‘ï¼Œæˆ‘ä»¬åå°æœˆäº®ï¼Œç„¶åç»™ä»–ä»¬æ¯äººç”¨äº†å…æ´—æ´—æ‰‹æ¶²ï¼Œæ´—å°æ‰‹ï¼Œå›½åº†èŠ‚å‡ºå»ä¸è¦å¿˜è®°å¸¦å“¦</p><a id="more"></a><p align="center"><embed src='http://player.youku.com/player.php/sid/XMzg0Mzk0NDI5Ng==/v.swf' allowFullScreen='true' quality='high' width='480' height='400' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'></embed></p><p><img src="%E5%9B%BD%E5%BA%86%E5%89%8D%E5%AD%A6%E6%B4%97%E6%89%8B/01.jpg" alt=""></p><p>å›å›è€å¸ˆ:<br>ä»–ä»¬è®©æˆ‘å‘ç»™ä½ ä»¬ğŸ˜‚</p><p>å°æ…ˆçš„æ™šæ‰˜ç­åˆ¶ä½œäº”æ˜Ÿçº¢æ——</p><p align="center"><embed src='http://player.youku.com/player.php/sid/XMzg0Mzk0OTg4MA==/v.swf' allowFullScreen='true' quality='high' width='480' height='400' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'></embed></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©äººå°‘ï¼Œæˆ‘ä»¬åå°æœˆäº®ï¼Œç„¶åç»™ä»–ä»¬æ¯äººç”¨äº†å…æ´—æ´—æ‰‹æ¶²ï¼Œæ´—å°æ‰‹ï¼Œå›½åº†èŠ‚å‡ºå»ä¸è¦å¿˜è®°å¸¦å“¦&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¾€æ˜”è¿½å¿†" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/"/>
    
      <category term="å°äºŒç­" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/%E5%B0%8F%E4%BA%8C%E7%8F%AD/"/>
    
    
      <category term="å®å®æˆé•¿" scheme="http://www.toberoot.com/tags/%E5%AE%9D%E5%AE%9D%E6%88%90%E9%95%BF/"/>
    
  </entry>
  
  <entry>
    <title>å®å®ä»¬ä¸Šç­å•¦</title>
    <link href="http://www.toberoot.com/2018/09/29/amy_life/%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/"/>
    <id>http://www.toberoot.com/2018/09/29/amy_life/%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/</id>
    <published>2018-09-29T10:43:41.000Z</published>
    <updated>2020-03-22T08:31:38.457Z</updated>
    
    <content type="html"><![CDATA[<p>å›å›è€å¸ˆ:<br>æœ€è¿‘æˆ‘ä»¬å­©å­çš„è§’è‰²æ¸¸æˆæ…¢æ…¢è¿›å…¥çŠ¶æ€äº†ï¼Œä½†ä¹Ÿæœ‰å‡ ä¸ªå­©å­æ²‰è¿·äºç§¯æœ¨æ¸¸æˆæ— æ³•è‡ªæ‹”ï¼Œæˆ‘ä»¬å¸Œæœ›å®¶é•¿ä»¬åœ¨å®¶é‡Œä¹Ÿå¯ä»¥å’Œå­©å­ä»¬ä¸€èµ·ç©è§’è‰²æ‰®æ¼”æ¸¸æˆï¼Œå’Œå­©å­å¤šäº’åŠ¨ï¼Œä¹Ÿå¯ä»¥æ‹“å®½æ€è·¯ï¼Œå¯ä»¥åšç°å®ç”Ÿæ´»ä¸­ä¸èƒ½åšçš„ï¼Œæ¯”å¦‚ä»™å¥³å•Šï¼Œå…¬ä¸»å•Šï¼Œå°å£«å…µç­‰ç­‰</p><a id="more"></a><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/01.jpg" alt=""></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/02.jpg" alt="02"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/03.jpg" alt="03"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/04.jpg" alt="04"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/05.jpg" alt="05"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/06.jpg" alt="06"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/07.jpg" alt="07"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/08.jpg" alt="08"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/09.jpg" alt="09"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/10.jpg" alt="10"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/11.jpg" alt="11"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/12.jpg" alt="12"></p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/13.jpg" alt="13"></p><p>å›å›è€å¸ˆ:<br>ä»Šå¤©æˆ‘ä»¬è¿˜è®¤è¯†äº†äº”æ˜Ÿçº¢æ——ï¼ŒçŸ¥é“è‡ªå·±æ˜¯ä¸€ä¸ªä¸­å›½äººï¼Œæˆ‘å‘Šè¯‰ä»–ä»¬è¿‡å‡ å¤©è¦ç»™ç¥–å›½å¦ˆå¦ˆè¿‡ç”Ÿæ—¥äº†ï¼Œè¦ä¼‘æ¯ä¸ƒå¤©ï¼Œæœ‰å­©å­è¿˜åé©³è¯´ä¸è¡Œï¼Œä¼‘æ¯ä¸‰å¤©å°±å¤Ÿäº†ï¼Œå“ˆå“ˆæˆ‘è¿˜å‘Šè¯‰ä»–ä»¬ç¥–å›½å¦ˆå¦ˆä¼šè¯·ä»–ä»¬åƒç”Ÿæ—¥è›‹ç³•çš„</p><p>åˆé¤å‰è¿˜é¢å¤–å­¦äº†ä¸€é¦–æ­Œï¼Œé€ç»™æˆ‘ä»¬çš„ç¥–å›½å¦ˆå¦ˆ</p><p><a href="https://music.163.com/#/song?id=498555737&market=baiduqk" target="_blank" rel="noopener">å„¿æ­Œ-ç¥–å›½ç¥–å›½æˆ‘çˆ±ä½ </a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å›å›è€å¸ˆ:&lt;br&gt;æœ€è¿‘æˆ‘ä»¬å­©å­çš„è§’è‰²æ¸¸æˆæ…¢æ…¢è¿›å…¥çŠ¶æ€äº†ï¼Œä½†ä¹Ÿæœ‰å‡ ä¸ªå­©å­æ²‰è¿·äºç§¯æœ¨æ¸¸æˆæ— æ³•è‡ªæ‹”ï¼Œæˆ‘ä»¬å¸Œæœ›å®¶é•¿ä»¬åœ¨å®¶é‡Œä¹Ÿå¯ä»¥å’Œå­©å­ä»¬ä¸€èµ·ç©è§’è‰²æ‰®æ¼”æ¸¸æˆï¼Œå’Œå­©å­å¤šäº’åŠ¨ï¼Œä¹Ÿå¯ä»¥æ‹“å®½æ€è·¯ï¼Œå¯ä»¥åšç°å®ç”Ÿæ´»ä¸­ä¸èƒ½åšçš„ï¼Œæ¯”å¦‚ä»™å¥³å•Šï¼Œå…¬ä¸»å•Šï¼Œå°å£«å…µç­‰ç­‰&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¾€æ˜”è¿½å¿†" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/"/>
    
      <category term="å°äºŒç­" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/%E5%B0%8F%E4%BA%8C%E7%8F%AD/"/>
    
    
      <category term="å®å®æˆé•¿" scheme="http://www.toberoot.com/tags/%E5%AE%9D%E5%AE%9D%E6%88%90%E9%95%BF/"/>
    
  </entry>
  
  <entry>
    <title>æœˆé¥¼çƒ˜åŸ¹å’Œå°å°æ¬è¿å·¥</title>
    <link href="http://www.toberoot.com/2018/09/21/amy_life/%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/"/>
    <id>http://www.toberoot.com/2018/09/21/amy_life/%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/</id>
    <published>2018-09-21T12:25:51.000Z</published>
    <updated>2020-03-22T08:31:38.460Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸­ç§‹èŠ‚å¿«åˆ°äº†ï¼Œè€å¸ˆå¸¦å®å®ä»¬ä¸€èµ·åšäº†æœˆé¥¼ï¼Œæ‹¿å»çƒ¤äº†ï¼Œå®å®ä»¬è¿˜å¸®è€å¸ˆä¸€èµ·æ¬æ¡Œå­ï¼Œè™½ç„¶ç»“å±€å·®å¼ºäººæ„ï¼Œä½†æ˜¯å­©å­ä»¬éƒ½å¾ˆå¼€å¿ƒå‘¢ï¼</p><a id="more"></a><p align="center"><embed src='http://player.youku.com/player.php/sid/XMzg0Mzk0NDg5Ng==/v.swf' allowFullScreen='true' quality='high' width='480' height='400' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'></embed></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/01.jpg" alt=""></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/02.jpg" alt="02"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/03.jpg" alt="03"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/04.jpg" alt="04"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/05.jpg" alt="05"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/06.jpg" alt="06"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/07.jpg" alt="07"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/08.jpg" alt="08"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/09.jpg" alt="09"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/20.jpg" alt="20"></p><p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/00.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸­ç§‹èŠ‚å¿«åˆ°äº†ï¼Œè€å¸ˆå¸¦å®å®ä»¬ä¸€èµ·åšäº†æœˆé¥¼ï¼Œæ‹¿å»çƒ¤äº†ï¼Œå®å®ä»¬è¿˜å¸®è€å¸ˆä¸€èµ·æ¬æ¡Œå­ï¼Œè™½ç„¶ç»“å±€å·®å¼ºäººæ„ï¼Œä½†æ˜¯å­©å­ä»¬éƒ½å¾ˆå¼€å¿ƒå‘¢ï¼&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¾€æ˜”è¿½å¿†" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/"/>
    
      <category term="å°äºŒç­" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/%E5%B0%8F%E4%BA%8C%E7%8F%AD/"/>
    
    
      <category term="å®å®æˆé•¿" scheme="http://www.toberoot.com/tags/%E5%AE%9D%E5%AE%9D%E6%88%90%E9%95%BF/"/>
    
  </entry>
  
  <entry>
    <title>å®å®ä»¬å¼€å§‹æ¼±å£äº†</title>
    <link href="http://www.toberoot.com/2018/09/20/amy_life/%E5%AE%9D%E5%AE%9D%E4%BB%AC%E5%BC%80%E5%A7%8B%E6%BC%B1%E5%8F%A3%E4%BA%86/"/>
    <id>http://www.toberoot.com/2018/09/20/amy_life/%E5%AE%9D%E5%AE%9D%E4%BB%AC%E5%BC%80%E5%A7%8B%E6%BC%B1%E5%8F%A3%E4%BA%86/</id>
    <published>2018-09-20T12:08:51.000Z</published>
    <updated>2020-03-22T08:31:38.469Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦ï¼šä»Šå¤©å¼€å§‹æˆ‘ä»¬è®©å®å®ä»¬å¼€å§‹æ¼±å£äº†ï¼Œæ‰€ä»¥å›å®¶ä¹Ÿè¦ç»§ç»­ä¿æŒè¿™ä¸ªå¥½ä¹ æƒ¯å“¦ï½</p><a id="more"></a><p>å›å›è€å¸ˆè¯­å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å„ä½äº²ä»¬ï¼Œé€šè¿‡æ˜¨å¤©çš„å®¶é•¿ä¼šï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å®¶é•¿å›å»çš„åŠªåŠ›ï¼Œä»Šå¤©åˆé¥­æ˜æ˜¾è¿›æ­¥çš„å®å®æœ‰ï¼š@å¼ ç‘¾å®‰å¦ˆå¦ˆâ€…@æ“æ¢“æ¡å¦ˆå¦ˆâ€…@ä½†é¢å®¸å¦ˆå¦ˆâ€…@ä½•æ™Ÿç¿å¦ˆå¦ˆâ€…@å¼ æ¬è§…å¦ˆå¦ˆâ€…@ä¸¥é­æ…ˆå¦ˆå¦ˆâ€…@ç‹æ™Ÿå®å¦ˆå¦ˆâ€…ï¼Œå…¶ä»–å®å®ä»¬ç»§ç»­åŠ æ²¹å“¦ï½</span><br><span class="line"></span><br><span class="line">åƒé¥­æˆ‘ä»¬æ˜¯å’Œå­©å­ä»¬è¯´ï¼šå°æ±½è½¦è£…è£…æ»¡ï¼Œè½¬å¼¯é€åˆ°å±±æ´é‡Œï¼Œæ»‘æ»‘æ¢¯æ»‘åˆ°è‚šå­é‡Œï¼Œå› ä¸ºå¾ˆå¤šå®å®å‹ºå­ä¸å¯¹ç€å˜´å·´ï¼Œæ‰€ä»¥é¥­å®å®æ‰åœ¨æ¡Œå­ä¸Šéƒ½å“­äº†ã€‚</span><br><span class="line"></span><br><span class="line">å¦å¤–ï¼Œä»Šå¤©æˆ‘ä»¬ç»ƒä¹ äº†å®å®ä»¬æ’é˜Ÿèµ°æ¥¼æ¢¯ï¼Œå¤§å¤šæ•°å·²ç»åƒæ¨¡åƒæ ·çš„äº†ï¼Œä¸Šä¸‹æ¥¼æ¢¯é å³èµ°äº†ï¼Œä»Šå¤©çš„è¿åŠ¨é‡æœ‰ç‚¹å¤§ï¼Œæ‰€ä»¥ä¼°è®¡å®è´ä»¬ä»Šæ™šåˆè¦æ—©æ—©ç¡è§‰äº†.</span><br></pre></td></tr></table></figure><p>ä»Šå¤©å¼€å§‹æˆ‘ä»¬è®©å®å®ä»¬å¼€å§‹æ¼±å£äº†ï¼Œæ‰€ä»¥å›å®¶ä¹Ÿè¦ç»§ç»­ä¿æŒè¿™ä¸ªå¥½ä¹ æƒ¯å“¦ï½</p><p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E5%BC%80%E5%A7%8B%E6%BC%B1%E5%8F%A3%E4%BA%86/01.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦ï¼šä»Šå¤©å¼€å§‹æˆ‘ä»¬è®©å®å®ä»¬å¼€å§‹æ¼±å£äº†ï¼Œæ‰€ä»¥å›å®¶ä¹Ÿè¦ç»§ç»­ä¿æŒè¿™ä¸ªå¥½ä¹ æƒ¯å“¦ï½&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¾€æ˜”è¿½å¿†" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/"/>
    
      <category term="å°äºŒç­" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/%E5%B0%8F%E4%BA%8C%E7%8F%AD/"/>
    
    
      <category term="å®å®æˆé•¿" scheme="http://www.toberoot.com/tags/%E5%AE%9D%E5%AE%9D%E6%88%90%E9%95%BF/"/>
    
  </entry>
  
  <entry>
    <title>å®¶é•¿ä¼š</title>
    <link href="http://www.toberoot.com/2018/09/19/amy_life/%E5%AE%B6%E9%95%BF%E4%BC%9A/"/>
    <id>http://www.toberoot.com/2018/09/19/amy_life/%E5%AE%B6%E9%95%BF%E4%BC%9A/</id>
    <published>2018-09-19T11:40:55.000Z</published>
    <updated>2020-03-22T08:31:38.466Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦ï¼šå¹¼å„¿å›­å¼€å­¦ç¬¬10å¤©ï¼Œå®å®ä»¬é€æ¸ç¨³å®šï¼Œèå…¥è¿™ä¸ªå¤§å®¶åº­ï¼Œä»Šå¤©è€å¸ˆå’Œæˆ‘ä»¬åˆ†äº«å®å®ä»¬çš„å¹¼å„¿å›­æ—¥å¸¸ç”Ÿæ´»ï¼Œä»¥åŠæˆ‘ä»¬å¯¹æˆ‘ä»¬å®¶é•¿çš„ä¸€äº›å»ºè®®ï¼Œéå¸¸åœ°ç”¨å¿ƒã€‚</p><a id="more"></a><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/001.jpg" alt=""></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/002.jpg" alt="002"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/003.jpg" alt="003"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/004.jpg" alt="004"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/005.jpg" alt="005"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/006.jpg" alt="006"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/007.jpg" alt="007"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/008.jpg" alt="008"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/010.jpg" alt="010"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/011.jpg" alt="011"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/012.jpg" alt="012"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/013.jpg" alt="013"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/014.jpg" alt="014"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/015.jpg" alt="015"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/016.jpg" alt="016"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/017.jpg" alt="017"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/018.jpg" alt="018"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/019.jpg" alt="019"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/020.jpg" alt="020"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/021.jpg" alt="021"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/022.jpg" alt="022"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/023.jpg" alt="023"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/024.jpg" alt="024"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/025.jpg" alt="025"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/026.jpg" alt="026"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/027.jpg" alt="027"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/028.jpg" alt="028"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/029.jpg" alt="029"></p><p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/030.jpg" alt="030"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦ï¼šå¹¼å„¿å›­å¼€å­¦ç¬¬10å¤©ï¼Œå®å®ä»¬é€æ¸ç¨³å®šï¼Œèå…¥è¿™ä¸ªå¤§å®¶åº­ï¼Œä»Šå¤©è€å¸ˆå’Œæˆ‘ä»¬åˆ†äº«å®å®ä»¬çš„å¹¼å„¿å›­æ—¥å¸¸ç”Ÿæ´»ï¼Œä»¥åŠæˆ‘ä»¬å¯¹æˆ‘ä»¬å®¶é•¿çš„ä¸€äº›å»ºè®®ï¼Œéå¸¸åœ°ç”¨å¿ƒã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¾€æ˜”è¿½å¿†" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/"/>
    
      <category term="å°äºŒç­" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/%E5%B0%8F%E4%BA%8C%E7%8F%AD/"/>
    
    
      <category term="å®å®æˆé•¿" scheme="http://www.toberoot.com/tags/%E5%AE%9D%E5%AE%9D%E6%88%90%E9%95%BF/"/>
    
  </entry>
  
  <entry>
    <title>å‘æœˆäº®è¯´æ™šå®‰</title>
    <link href="http://www.toberoot.com/2018/09/10/amy_life/%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/"/>
    <id>http://www.toberoot.com/2018/09/10/amy_life/%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/</id>
    <published>2018-09-10T11:26:39.000Z</published>
    <updated>2020-03-22T08:31:38.463Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦ï¼šä»Šå¤©ä¸­åˆè®²äº†ä¸€ä¸ªå…³äºã€Œæ™šå®‰ï¼Œæœˆäº®ã€çš„ç¡å‰æ•…äº‹ï¼Œæœ€åçŒ«å¤´é¹°å¯¹æœˆäº®è¯´äº†æ™šå®‰ï¼Œå¤§å®¶ä»Šå¤©ç¡å‰è¿˜å¯ä»¥å’Œå®å®è¯´å“¦ï¼Œå†åŠ ä¸€äº›å…¶ä»–çš„åŠ¨ç‰©å®å®</p><a id="more"></a><p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/01.jpg" alt=""></p><p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/02.jpg" alt="02"></p><p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/03.jpg" alt="03"></p><p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/04.jpg" alt="04"></p><p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/05.jpg" alt="05"></p><p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/06.jpg" alt="06"></p><p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/07.jpg" alt="07"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦ï¼šä»Šå¤©ä¸­åˆè®²äº†ä¸€ä¸ªå…³äºã€Œæ™šå®‰ï¼Œæœˆäº®ã€çš„ç¡å‰æ•…äº‹ï¼Œæœ€åçŒ«å¤´é¹°å¯¹æœˆäº®è¯´äº†æ™šå®‰ï¼Œå¤§å®¶ä»Šå¤©ç¡å‰è¿˜å¯ä»¥å’Œå®å®è¯´å“¦ï¼Œå†åŠ ä¸€äº›å…¶ä»–çš„åŠ¨ç‰©å®å®&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¾€æ˜”è¿½å¿†" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/"/>
    
      <category term="å°äºŒç­" scheme="http://www.toberoot.com/categories/%E5%BE%80%E6%98%94%E8%BF%BD%E5%BF%86/%E5%B0%8F%E4%BA%8C%E7%8F%AD/"/>
    
    
      <category term="å®å®æˆé•¿" scheme="http://www.toberoot.com/tags/%E5%AE%9D%E5%AE%9D%E6%88%90%E9%95%BF/"/>
    
  </entry>
  
  <entry>
    <title>çªç ´é˜¿é‡Œé™åˆ¶å®ç°&quot;RDS For MySQL 5.7åˆ°è‡ªå»ºMySQLä¸»ä»&quot;</title>
    <link href="http://www.toberoot.com/2018/08/22/booboo_others/rds-for-mysql-5-7%E5%88%B0%E8%87%AA%E5%BB%BAMySQL%E4%B8%BB%E4%BB%8E%E4%B9%8B%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3user%E8%A1%A8%E5%AE%9E%E7%8E%B0%E4%BB%8E%E5%BA%93%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E6%9B%B4%E6%94%B9%E5%8A%9F%E8%83%BD/"/>
    <id>http://www.toberoot.com/2018/08/22/booboo_others/rds-for-mysql-5-7%E5%88%B0%E8%87%AA%E5%BB%BAMySQL%E4%B8%BB%E4%BB%8E%E4%B9%8B%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3user%E8%A1%A8%E5%AE%9E%E7%8E%B0%E4%BB%8E%E5%BA%93%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E6%9B%B4%E6%94%B9%E5%8A%9F%E8%83%BD/</id>
    <published>2018-08-22T10:41:15.000Z</published>
    <updated>2020-03-22T08:32:42.581Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: é˜¿é‡Œäº‘çš„RDS For MySQL 5.7 åˆ°çº¿ä¸‹IDCæœºæˆ¿çš„ä¸»ä»æ­å»ºç›¸ä¿¡çœ‹å®˜æ–¹æ–‡æ¡£å°±å¯ä»¥å®Œæˆï¼Œä½†æ˜¯æ­å»ºä¹‹åå´å‘ç°æ— æ³•åœ¨æœ¬åœ°è¿›è¡Œè®¤è¯æƒé™çš„ç®¡ç†ï¼Œè¿™æ˜¯ä¸ºä½•ï¼Ÿè€Œé˜¿é‡Œå®˜æ–¹æ¨èä½¿ç”¨DTSåŒæ­¥å·¥å…·å»å®ç°ï¼Œè¿™ä¸ªè´¹ç”¨ç€å®ä¸å°‘ï¼Œåˆæ˜¯å¦èƒ½å¤Ÿç ´è§£å‘¢ï¼Ÿæœ¬æ–‡è¯¦è§£å¦‚ä½•æš´åŠ›ç ´è§£userè¡¨å®ç°ä»åº“ç”¨æˆ·æƒé™æ›´æ”¹åŠŸèƒ½</p><a id="more"></a><h1 id="æ•…äº‹èƒŒæ™¯"><a href="#æ•…äº‹èƒŒæ™¯" class="headerlink" title="æ•…äº‹èƒŒæ™¯"></a>æ•…äº‹èƒŒæ™¯</h1><h2 id="æ•°æ®åº“æ˜ç»†"><a href="#æ•°æ®åº“æ˜ç»†" class="headerlink" title="æ•°æ®åº“æ˜ç»†"></a>æ•°æ®åº“æ˜ç»†</h2><p>è¯´åœ¨å‰é¢ï¼š</p><ul><li>äº‘ä¸Šæ•°æ®åº“ï¼š RDS For MySQL 5.7.20 æ™®é€šç”¨æˆ·æƒé™</li><li>IDCæ•°æ®åº“: MySQL 5.7.20 </li></ul><h2 id="æ•…äº‹æƒ…èŠ‚"><a href="#æ•…äº‹æƒ…èŠ‚" class="headerlink" title="æ•…äº‹æƒ…èŠ‚"></a>æ•…äº‹æƒ…èŠ‚</h2><p>ç°éœ€è¦æ­å»ºRDS For MySQL åˆ°çº¿ä¸‹IDCæœºæˆ¿çš„ä¸»ä»ï¼Œé—®é¢˜å¦‚ä¸‹ï¼š</p><h3 id="åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥"><a href="#åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥" class="headerlink" title="åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥"></a>åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥</h3><h4 id="æ•…éšœåŸå› "><a href="#æ•…éšœåŸå› " class="headerlink" title="æ•…éšœåŸå› "></a>æ•…éšœåŸå› </h4><ul><li>RDS For MySQL 5.7.20 åˆ°è‡ªå»ºMySQL 5.7.20ä¸»ä»åŒæ­¥å¼‚å¸¸çš„åŸå› ä¸ºRDSä¸MySQLå®˜æ–¹ç‰ˆæœ¬ä½¿ç”¨çš„ç³»ç»Ÿåº“ä¸åŒ</li><li>è‡ªå»ºMySQL 5.7.20 æ— æ³•åŒæ­¥ä¸»åº“RDSçš„ç³»ç»Ÿè¡¨</li><li>è‡ªå»ºMySQL 5.7.20 æ¢å¤RDSçš„å…¨å¤‡ä»½æ•°æ®åæ— æ³•æ‰§è¡Œæˆæƒè¯­å¥,æŠ¥é”™å¦‚ä¸‹ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1785 (HY000): Statement violates GTID consistency: Updates to non-transactional tables can only be done in either autocommitted statements or single-statement transactions, and never in the same statement as updates to transactional tables.</span><br></pre></td></tr></table></figure><ul><li>è‡ªå»ºMySQL 5.7.20 æ¢å¤RDSçš„å…¨å¤‡ä»½æ•°æ®åæ— æ³•å¯¹ç³»ç»Ÿè¡¨æ‰§è¡Œæ›´æ–°æ“ä½œï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1064 (42000): Unknown trigger has an error in its body: 'Unknown system variable 'maintain_user_list''</span><br></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h4><ul><li>è·³è¿‡ç³»ç»Ÿè¡¨çš„åŒæ­¥</li></ul><hr><h3 id="ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥"><a href="#ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥" class="headerlink" title="ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥"></a>ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥</h3><p>RDS For MySQL 5.7.20 åˆ°è‡ªå»ºMySQL 5.7.20 æ­å»ºä¸»ä»åŒæ­¥æ¶æ„:</p><ul><li>é…ç½®ä»åº“ä¸åŒæ­¥RDSä¸»åº“çš„ç³»ç»Ÿè¡¨</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># skip rep</span><br><span class="line">replicate_wild_ignore_table&#x3D;mysql.%</span><br><span class="line">replicate_wild_ignore_table&#x3D;sys.%</span><br><span class="line">replicate_wild_ignore_table&#x3D;information_schema.%</span><br></pre></td></tr></table></figure><ul><li><strong>éç³»ç»Ÿåº“æ•°æ®åŒæ­¥æ­£å¸¸</strong></li><li>ä»åº“æ— æ³•æ‰§è¡Œgrantå‘½ä»¤ï¼Œå³æ— æ³•æ·»åŠ æˆæƒä¿¡æ¯</li><li>ä»åº“æ— æ³•å¯¹ç³»ç»Ÿè¡¨mysql.userè¡¨æ‰§è¡Œinsertæ“ä½œ</li><li>ä»åº“æ— æ³•å¯¹ç³»ç»Ÿè¡¨mysql.userè¡¨æ‰§è¡Œupdatæ“ä½œ</li></ul><p>æŠ¥é”™å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1064 (42000): Unknown trigger has an error in its body: 'Unknown system variable 'maintain_user_list''</span><br></pre></td></tr></table></figure><h4 id="å¤±è´¥åŸå› "><a href="#å¤±è´¥åŸå› " class="headerlink" title="å¤±è´¥åŸå› "></a>å¤±è´¥åŸå› </h4><p><strong>é˜¿é‡Œå·¥å•ç­”å¤</strong>ï¼šRDS ç›®å‰å·²ç»ä¸æ”¯æŒ MYISAM å¼•æ“åˆ›å»ºäº†ã€‚æ‰€ä»¥å¦‚æœæ˜¯é€šè¿‡è‡ªå»ºçš„replication åŒæ­¥ å°±ä¼šæœ‰è¿™ä¸ªé—®é¢˜çš„ï¼ŒRDS ç»Ÿä¸€INNOB å¼•æ“ã€‚<br>å¦‚æœéœ€æ±‚æ˜¯ä»RDS åˆ°è‡ªå»ºæ•°æ®åº“çš„åŒæ­¥å…³ç³»ï¼Œå»ºè®®æ‚¨ä½¿ç”¨DTS åšä¸šåŠ¡æ•°æ®çš„åŒæ­¥ã€‚</p><h4 id="æ¢ç´¢è§£å†³æ–¹æ³•"><a href="#æ¢ç´¢è§£å†³æ–¹æ³•" class="headerlink" title="æ¢ç´¢è§£å†³æ–¹æ³•"></a>æ¢ç´¢è§£å†³æ–¹æ³•</h4><h5 id="ä»åº“å°è¯•ä½¿ç”¨MySQL8-0-11"><a href="#ä»åº“å°è¯•ä½¿ç”¨MySQL8-0-11" class="headerlink" title="ä»åº“å°è¯•ä½¿ç”¨MySQL8.0.11"></a>ä»åº“å°è¯•ä½¿ç”¨<code>MySQL8.0.11</code></h5><p>RDS For MySQL 5.7çš„å¤‡ä»½æ–‡ä»¶ åˆ°çº¿ä¸‹è‡ªå»ºMYSQL 8.0.11 æ— æ³•æ¢å¤æ•°æ®ã€‚å› æ­¤è¯¥æ–¹æ³•ä¸å¯è¡Œã€‚</p><h5 id="å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼"><a href="#å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼" class="headerlink" title="å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼"></a>å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼</h5><ol><li>ä¸´æ—¶åœæ­¢slaveåŒæ­¥</li><li>ä¿®æ”¹é…ç½®å…³é—­gtidæ¨¡å¼</li><li>é‡å¯æœåŠ¡</li></ol><p>å¯¹ç³»ç»Ÿè¡¨mysql.useræµ‹è¯•æ˜ç»†ï¼š</p><table><thead><tr><th>No.</th><th>æµ‹è¯•é¡¹ç›®</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>1</td><td>æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œgrantå‘½ä»¤</td><td>Ã—</td></tr><tr><td>2</td><td>æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œupdateå‘½ä»¤</td><td>Ã—</td></tr><tr><td>3</td><td>æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œinsertå‘½ä»¤</td><td>Ã—</td></tr></tbody></table><p>è¯¥æ–¹æ³•åŒæ ·æ— æ³•è§£å†³ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æƒé™ç›¸å…³çš„ä¸€äº›è¡¨ï¼š</span></span><br><span class="line">SCHEMA_PRIVILEGESï¼šæä¾›äº†æ•°æ®åº“çš„ç›¸å…³æƒé™ï¼Œè¿™ä¸ªè¡¨æ˜¯å†…å­˜è¡¨æ˜¯ä»mysql.dbä¸­æ‹‰å»å‡ºæ¥çš„ã€‚</span><br><span class="line">TABLE_PRIVILEGES:æä¾›çš„æ˜¯è¡¨æƒé™ç›¸å…³ä¿¡æ¯ï¼Œä¿¡æ¯æ˜¯ä» mysql.tables_priv è¡¨ä¸­åŠ è½½çš„</span><br><span class="line">COLUMN_PRIVILEGES ï¼šè¿™ä¸ªè¡¨å¯ä»¥æ¸…æ¥šå°±èƒ½çœ‹åˆ°è¡¨æˆæƒçš„ç”¨æˆ·çš„å¯¹è±¡ï¼Œé‚£å¼ è¡¨é‚£ä¸ªåº“ä»¥åŠæˆäºˆçš„æ˜¯ä»€ä¹ˆæƒé™ï¼Œå¦‚æœæˆæƒçš„æ—¶å€™åŠ ä¸Šwith grant optionçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å¾—åˆ°PRIVILEGE_TYPEè¿™ä¸ªå€¼å¿…é¡»æ˜¯YESã€‚</span><br><span class="line">USER_PRIVILEGES:æä¾›çš„æ˜¯è¡¨æƒé™ç›¸å…³ä¿¡æ¯ï¼Œä¿¡æ¯æ˜¯ä» mysql.user è¡¨ä¸­åŠ è½½çš„</span><br><span class="line">é€šè¿‡è¡¨æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ™°çœ‹å¾—åˆ°MySQLæˆæƒçš„å±‚æ¬¡ï¼ŒSCHEMAï¼ŒTABLEï¼ŒCOLUMNçº§åˆ«ï¼Œå½“ç„¶è¿™äº›éƒ½æ˜¯åŸºäºç”¨æˆ·æ¥æˆäºˆçš„</span><br></pre></td></tr></table></figure><p>ä»æ•°æ®åº“ç”¨æˆ·æƒé™ç®¡ç†çš„åŸç†å¯ä»¥äº†è§£åˆ°ç®¡ç†ç”¨æˆ·çš„æ˜¯<code>user</code>è¡¨ï¼Œå¦‚æœè¦æ›´ç»†è‡´çš„æƒé™è¿˜éœ€è¦<code>db</code>è¡¨å’Œ<code>tables_priv</code>è¡¨ã€‚<em>ï¼ˆæœ¬æ–‡åªä»userè¡¨ç€æ‰‹ï¼‰</em></p><h3 id="æ­¥éª¤æ¦‚è§ˆ"><a href="#æ­¥éª¤æ¦‚è§ˆ" class="headerlink" title="æ­¥éª¤æ¦‚è§ˆ"></a>æ­¥éª¤æ¦‚è§ˆ</h3><ol><li>åˆ›å»ºæ–°çš„user_1è¡¨</li><li>å¯¹user_1è¡¨æ·»åŠ æ–°çš„ç”¨æˆ·</li><li>åœæœåŠ¡</li><li>å°†user_1æ›¿æ¢userè¡¨</li><li>å¯åŠ¨è¯¥æœåŠ¡</li><li>å¯ä»¥é€šè¿‡updateã€insertã€deleteæ“ä½œuserè¡¨æ¥æ·»åŠ æƒé™ï¼ˆgrantæ— æ³•æ“ä½œï¼‰</li></ol><h3 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">root@MySQL-01 10:35:  [mysql]&gt; create table user_1 like user;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; select * from user_1;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; show table status like user;</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'user' at line 1</span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; show table status like 'user_1';</span><br><span class="line">+--------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| Name   | Engine | Version | Row_format | Rows | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time         | Check_time | Collation | Checksum | Create_options | Comment                     |</span><br><span class="line">+--------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| user_1 | MyISAM |      10 | Dynamic    |    0 |              0 |           0 | 281474976710655 |         1024 |         0 |           NULL | 2019-01-04 10:36:00 | 2019-01-04 10:36:00 | NULL       | utf8_bin  |     NULL |                | Users and global privileges |</span><br><span class="line">+--------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; show table status like 'user';</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+---------------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| Name | Engine | Version | Row_format | Rows | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time         | Check_time          | Collation | Checksum | Create_options | Comment                     |</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+---------------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| user | MyISAM |      10 | Dynamic    |    3 |             53 |         160 | 281474976710655 |         2048 |         0 |           NULL | 2015-05-22 15:24:42 | 2019-01-04 09:27:49 | 2015-05-22 15:33:22 | utf8_bin  |     NULL |                | Users and global privileges |</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+---------------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; insert into user_1 select * from user;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; select * from user_1;</span><br><span class="line">+-----------+------+----------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+--------+-----------------------+</span><br><span class="line">| Host      | User | Password | Select_priv | Insert_priv | Update_priv | Delete_priv | Create_priv | Drop_priv | Reload_priv | Shutdown_priv | Process_priv | File_priv | Grant_priv | References_priv | Index_priv | Alter_priv | Show_db_priv | Super_priv | Create_tmp_table_priv | Lock_tables_priv | Execute_priv | Repl_slave_priv | Repl_client_priv | Create_view_priv | Show_view_priv | Create_routine_priv | Alter_routine_priv | Create_user_priv | Event_priv | Trigger_priv | Create_tablespace_priv | ssl_type | ssl_cipher | x509_issuer | x509_subject | max_questions | max_updates | max_connections | max_user_connections | plugin | authentication_string |</span><br><span class="line">+-----------+------+----------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+--------+-----------------------+</span><br><span class="line">| localhost | root |          | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          |            |             |              |             0 |           0 |               0 |                    0 |        |                       |</span><br><span class="line">| 127.0.0.1 | root |          | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          |            |             |              |             0 |           0 |               0 |                    0 |        |                       |</span><br><span class="line">| ::1       | root |          | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          |            |             |              |             0 |           0 |               0 |                    0 |        |                       |</span><br><span class="line">+-----------+------+----------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+--------+-----------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; select user,host,authentication_string from user_1;</span><br><span class="line">+------+-----------+-----------------------+</span><br><span class="line">| user | host      | authentication_string |</span><br><span class="line">+------+-----------+-----------------------+</span><br><span class="line">| root | localhost |                       |</span><br><span class="line">| root | 127.0.0.1 |                       |</span><br><span class="line">| root | ::1       |                       |</span><br><span class="line">+------+-----------+-----------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; update user_1 set authentication_string=password('(Uploo00king)') where user='root';</span><br><span class="line">Query OK, 3 rows affected, 1 warning (0.01 sec)</span><br><span class="line">Rows matched: 3  Changed: 3  Warnings: 1</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:37:  [mysql]&gt; select user,host,authentication_string from user_1;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:37:  [mysql]&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@sh_02 data]# /etc/init.d/mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@sh_02 mysql]# ll user_1*</span><br><span class="line">-rw-r-----. 1 mysql mysql 10630 Jan  4 10:36 user_1.frm</span><br><span class="line">-rw-r-----. 1 mysql mysql   328 Jan  4 10:37 user_1.MYD</span><br><span class="line">-rw-r-----. 1 mysql mysql  2048 Jan  4 10:37 user_1.MYI</span><br><span class="line">[root@sh_02 mysql]# mv user_1.frm user.frm</span><br><span class="line">[root@sh_02 mysql]# mv user_1.MYD user.MYD</span><br><span class="line">[root@sh_02 mysql]# mv user_1.MYI user.MYI</span><br><span class="line">[root@sh_02 mysql]# ll user*</span><br><span class="line">-rw-r-----. 1 mysql mysql 10630 Jan  4 10:36 user.frm</span><br><span class="line">-rw-r-----. 1 mysql mysql   328 Jan  4 10:37 user.MYD</span><br><span class="line">-rw-r-----. 1 mysql mysql  2048 Jan  4 10:37 user.MYI</span><br><span class="line">-rw-rw----. 1 mysql mysql  3989 Aug 14 09:14 user_view.frm</span><br><span class="line">[root@sh_02 mysql]# /etc/init.d/mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@sh_02 mysql]# mysql -uroot -p'(Uploo00king)'</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 6</span><br><span class="line">Server version: 5.7.20-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:39:  [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| db1                |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:39:  [(none)]&gt; use mysql</span><br><span class="line">Database changed</span><br><span class="line">root@MySQL-01 10:39:  [mysql]&gt; select user,host from mysql.user;</span><br><span class="line">+------+-----------+</span><br><span class="line">| user | host      |</span><br><span class="line">+------+-----------+</span><br><span class="line">| root | 127.0.0.1 |</span><br><span class="line">| root | ::1       |</span><br><span class="line">| root | localhost |</span><br><span class="line">+------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:39:  [mysql]&gt; grant all on *.* to booboo@'%' identified by '(Uploo00king)';</span><br><span class="line">ERROR 1785 (HY000): Statement violates GTID consistency: Updates to non-transactional tables can only be done in either autocommitted statements or single-statement transactions, and never in the same statement as updates to transactional tables.</span><br><span class="line"></span><br><span class="line">root@MySQL-01 11:39:  [mysql]&gt; update mysql.user_1 set user='aliyun_root' where host='127.0.0.1';</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">root@MySQL-01 11:40:  [mysql]&gt; select user,host from mysql.user_1;</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| user        | host      |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| aliyun_root | 127.0.0.1 |</span><br><span class="line">| root        | ::1       |</span><br><span class="line">| root        | localhost |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">aliyun_root@MySQL-01 11:51:  [mysql]&gt; insert into mysql.user values ('%','jowing', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('Joowing@2017'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">aliyun_root@MySQL-01 11:51:  [mysql]&gt; select user,host from  mysql.user;</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| user        | host      |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| jowing      | %         |</span><br><span class="line">| aliyun_root | 127.0.0.1 |</span><br><span class="line">| root        | ::1       |</span><br><span class="line">| root        | localhost |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿäº§ç¯å¢ƒ"><a href="#ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒ"></a>ç”Ÿäº§ç¯å¢ƒ</h3><h4 id="ç”¨æˆ·æƒé™"><a href="#ç”¨æˆ·æƒé™" class="headerlink" title="ç”¨æˆ·æƒé™"></a>ç”¨æˆ·æƒé™</h4><p>ç›®æ ‡ï¼šIDCæœºæˆ¿ä»åº“æ”¯æŒé€šè¿‡insertã€updateã€deleteå‘½ä»¤æ¥ä¿®æ”¹ç”¨æˆ·æƒé™ï¼Œæƒé™æ¯”è¾ƒç®€å•ï¼Œåˆ†ä¸ºåªè¯»å’Œå†™ã€‚</p><p>éœ€è¦è®¾ç½®ä»¥ä¸‹æƒé™ï¼šæƒé™ä½œç”¨äºæ‰€æœ‰çš„åº“å¤šæœ‰çš„è¡¨</p><table><thead><tr><th align="left">ç”¨æˆ·å</th><th align="left">å¯†ç </th><th align="left">æƒé™</th></tr></thead><tbody><tr><td align="left">root</td><td align="left">123</td><td align="left">è¯»å†™</td></tr><tr><td align="left">joowingbuz</td><td align="left">123</td><td align="left">åªè¯»</td></tr><tr><td align="left">ottersync</td><td align="left">123</td><td align="left">åªè¯»</td></tr><tr><td align="left">syncdw</td><td align="left">123</td><td align="left">åªè¯»</td></tr><tr><td align="left">datasis</td><td align="left">123</td><td align="left">åªè¯»</td></tr><tr><td align="left">joowingv</td><td align="left">123</td><td align="left">åªè¯»</td></tr><tr><td align="left">datadev</td><td align="left">123</td><td align="left">åªè¯»</td></tr><tr><td align="left">readonly</td><td align="left">123</td><td align="left">åªè¯»</td></tr></tbody></table><h4 id="æ­¥éª¤æ¦‚è§ˆ-1"><a href="#æ­¥éª¤æ¦‚è§ˆ-1" class="headerlink" title="æ­¥éª¤æ¦‚è§ˆ"></a>æ­¥éª¤æ¦‚è§ˆ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. ç™»é™†æ•°æ®åº“åæ“ä½œå¦‚ä¸‹ï¼š</span></span><br><span class="line">use mysql;</span><br><span class="line">create table user_1 like user;</span><br><span class="line">insert into user_1 select * from user;</span><br><span class="line">delete from mysql.user_1 where user='root';</span><br><span class="line">insert into mysql.user_1 values ('%','root', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','joowingbuz', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','ottersync', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','syncdw', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','datasis', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','joowingv', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','datadev', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','readonly', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. é€€å‡ºæ•°æ®åº“å¹¶åœæ­¢æœåŠ¡</span></span><br><span class="line">/data/mysql/support-files/mysql.server stop</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. å°†user_1è¡¨çš„ç‰©ç†æ–‡ä»¶è¦†ç›–userè¡¨</span></span><br><span class="line">cd /data/xtrabackup_data/mysql/</span><br><span class="line">mv user.frm user.ibd user.MYD user.MYI user.TRG /tmp</span><br><span class="line">mv user_1.frm user.frm</span><br><span class="line">mv user_1.MYI user.MYI</span><br><span class="line">mv user_1.MYD user.MYD</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. å¯åŠ¨æ•°æ®åº“</span></span><br><span class="line">/data/mysql/support-files/mysql.server start</span><br></pre></td></tr></table></figure><h4 id="æ“ä½œæ˜ç»†"><a href="#æ“ä½œæ˜ç»†" class="headerlink" title="æ“ä½œæ˜ç»†"></a>æ“ä½œæ˜ç»†</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line">root@MySQL-01 15:42:  [(none)]&gt; use mysql</span><br><span class="line">Database changed</span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; create table user_1 like user;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; insert into user_1 select * from user;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; select user,host,authentication_string from mysql.user;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; select user,host,authentication_string from mysql.user_1;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; desc mysql.user_1;</span><br><span class="line">+------------------------+-----------------------------------+------+-----+---------+-------+</span><br><span class="line">| Field                  | Type                              | Null | Key | Default | Extra |</span><br><span class="line">+------------------------+-----------------------------------+------+-----+---------+-------+</span><br><span class="line">| Host                   | char(60)                          | NO   | PRI |         |       |</span><br><span class="line">| User                   | char(16)                          | NO   | PRI |         |       |</span><br><span class="line">| Password               | char(41)                          | NO   |     |         |       |</span><br><span class="line">| Select_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Insert_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Update_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Delete_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Drop_priv              | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Reload_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Shutdown_priv          | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Process_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| File_priv              | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Grant_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| References_priv        | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Index_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Alter_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Show_db_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Super_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_tmp_table_priv  | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Lock_tables_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Execute_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Repl_slave_priv        | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Repl_client_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_view_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Show_view_priv         | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_routine_priv    | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Alter_routine_priv     | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_user_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Event_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Trigger_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_tablespace_priv | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| ssl_type               | enum('','ANY','X509','SPECIFIED') | NO   |     |         |       |</span><br><span class="line">| ssl_cipher             | blob                              | NO   |     | NULL    |       |</span><br><span class="line">| x509_issuer            | blob                              | NO   |     | NULL    |       |</span><br><span class="line">| x509_subject           | blob                              | NO   |     | NULL    |       |</span><br><span class="line">| max_questions          | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| max_updates            | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| max_connections        | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| max_user_connections   | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| plugin                 | char(64)                          | YES  |     |         |       |</span><br><span class="line">| authentication_string  | text                              | YES  |     | NULL    |       |</span><br><span class="line">+------------------------+-----------------------------------+------+-----+---------+-------+</span><br><span class="line">42 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:47:  [mysql]&gt; delete from mysql.user_1 where user='root';</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:51:  [mysql]&gt; insert into mysql.user_1 values ('%','root', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','joowingbuz', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','ottersync', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','syncdw', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','datasis', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','joowingv', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','datadev', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','readonly', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; select user,host,authentication_string from mysql.user;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; select user,host,authentication_string from mysql.user_1;</span><br><span class="line">+------------+------+-------------------------------------------+</span><br><span class="line">| user       | host | authentication_string                     |</span><br><span class="line">+------------+------+-------------------------------------------+</span><br><span class="line">| ottersync  | %    | *9443FA914A2D69FE8832F8294E7422CC1B02A492 |</span><br><span class="line">| joowingbuz | %    | *DFFDA1CA6135E355EF468AB13A465BB5D4FE2B11 |</span><br><span class="line">| root       | %    | *89BE852E4EECFD217F0C5463FB30AD25BD0751E0 |</span><br><span class="line">| syncdw     | %    | *3DD7B4B4F6EE968FF3452B607BDEE6294B6A425A |</span><br><span class="line">| datasis    | %    | *011D511C71990F832C531A0F9CFB34CF7BB4E485 |</span><br><span class="line">| joowingv   | %    | *56B364074270DF7F6D670A6B4F5A4AD13322397A |</span><br><span class="line">| datadev    | %    | *D3D73E0F6BFC3159B024EF31484B6F9CC2963C5B |</span><br><span class="line">| readonly   | %    | *E2BA196C0C7F409990FDB3FAB5F9C7CE95F7C449 |</span><br><span class="line">+------------+------+-------------------------------------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@joowing-server-06:~# /data/mysql/support-files/mysql.server stop</span><br><span class="line">Shutting down MySQL</span><br><span class="line">...... * </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@joowing-server-06:~# cd /data/xtrabackup_data/</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data# cd mysql</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# ll user*</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ  14 15:42 user_1.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   744 8æœˆ  14 15:52 user_1.MYD</span><br><span class="line">-rw-r----- 1 mysql mysql  2048 8æœˆ  14 15:53 user_1.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ   9 20:14 user.frm</span><br><span class="line">-rw-r----- 1 mysql mysql 98304 8æœˆ   9 20:14 user.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql   328 8æœˆ   9 20:14 user.MYD</span><br><span class="line">-rw-r--r-- 1 mysql mysql  2048 8æœˆ   9 20:14 user.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql  3569 8æœˆ   9 20:14 user.TRG</span><br><span class="line">-rw-r----- 1 mysql mysql  3982 8æœˆ   9 20:14 user_view.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user.frm user.ibd user.MYD user.MYI user.TRG /data</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# ll user*</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ  14 15:42 user_1.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   744 8æœˆ  14 15:52 user_1.MYD</span><br><span class="line">-rw-r----- 1 mysql mysql  2048 8æœˆ  14 15:53 user_1.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql  3982 8æœˆ   9 20:14 user_view.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user_1.frm user.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user_1.MYI user.MYI</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user_1.MYD user.MYD</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# ll user*</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ  14 15:42 user.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   744 8æœˆ  14 15:52 user.MYD</span><br><span class="line">-rw-r----- 1 mysql mysql  2048 8æœˆ  14 15:53 user.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql  3982 8æœˆ   9 20:14 user_view.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# /data/mysql/support-files/mysql.server start</span><br><span class="line">Starting MySQL</span><br><span class="line">...... * </span><br><span class="line"></span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mysql -uroot -p'123'</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 5</span><br><span class="line">Server version: 5.7.20-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:55:  [(none)]&gt; show slave status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: rm-uf6f05k2rg95s23bp.mysql.rds.aliyuncs.com</span><br><span class="line">                  Master_User: idc_slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.001641</span><br><span class="line">          Read_Master_Log_Pos: 447207506</span><br><span class="line">               Relay_Log_File: joowing-server-06-relay-bin.000225</span><br><span class="line">                Relay_Log_Pos: 35529076</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.001641</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: mysql.%,sys.%,information_schema.%</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 447207506</span><br><span class="line">              Relay_Log_Space: 35529295</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 1095052097</span><br><span class="line">                  Master_UUID: b3e1de69-5daa-11e8-bed2-7cd30ab8a9fc</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: b3e1de69-5daa-11e8-bed2-7cd30ab8a9fc:97478646-97483368</span><br><span class="line">            Executed_Gtid_Set: b3e1de69-5daa-11e8-bed2-7cd30ab8a9fc:1-97483368,</span><br><span class="line">c39ecf19-5daa-11e8-aa9c-7cd30ac4764a:1-178658794,</span><br><span class="line">c69289d7-9bc9-11e8-b922-44a842431b62:1-12</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: </span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> éªŒè¯åªè¯»è´¦å·</span></span><br><span class="line">mysql -uroot-p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -ujoowingbuz -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -uottersync -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -usyncdw -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -udatasis -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -ujoowingv -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -udatadev -p'123' -e "create database dbzyadmin;"</span><br><span class="line">mysql -ureadonly -p'123'  -e "create database dbzyadmin;"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åªè¯»è´¦å·æ— æ³•æ‰§è¡Œå†™æ“ä½œï¼ŒéªŒè¯æˆåŠŸ</span></span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">ERROR 1044 (42000) at line 1: Access denied for user 'readonly'@'%' to database 'dbzyadmin'</span><br></pre></td></tr></table></figure><h4 id="åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—"><a href="#åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—" class="headerlink" title="åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—"></a>åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—</h4><blockquote><p>åç»­æ–°å¢ç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·ã€æ›´æ”¹å¯†ç å‘½ä»¤å¦‚ä¸‹ï¼š</p></blockquote><h5 id="æ–°å¢è¯»å†™ç”¨æˆ·"><a href="#æ–°å¢è¯»å†™ç”¨æˆ·" class="headerlink" title="æ–°å¢è¯»å†™ç”¨æˆ·"></a>æ–°å¢è¯»å†™ç”¨æˆ·</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into mysql.user_1 values ('%','ã€ç”¨æˆ·åã€‘', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('ã€å¯†ç ã€‘'));</span><br></pre></td></tr></table></figure><h5 id="æ–°å¢åªè¯»ç”¨æˆ·"><a href="#æ–°å¢åªè¯»ç”¨æˆ·" class="headerlink" title="æ–°å¢åªè¯»ç”¨æˆ·"></a>æ–°å¢åªè¯»ç”¨æˆ·</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into mysql.user_1 values ('%','ã€ç”¨æˆ·åã€‘', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('ã€å¯†ç ã€‘'));</span><br></pre></td></tr></table></figure><h5 id="åˆ é™¤ç”¨æˆ·å‘½ä»¤"><a href="#åˆ é™¤ç”¨æˆ·å‘½ä»¤" class="headerlink" title="åˆ é™¤ç”¨æˆ·å‘½ä»¤"></a>åˆ é™¤ç”¨æˆ·å‘½ä»¤</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from mysql.user where user='ã€ç”¨æˆ·åã€‘';</span><br></pre></td></tr></table></figure><h5 id="ä¿®æ”¹å¯†ç "><a href="#ä¿®æ”¹å¯†ç " class="headerlink" title="ä¿®æ”¹å¯†ç "></a>ä¿®æ”¹å¯†ç </h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update mysql.user set authentication_string=password('ã€å¯†ç ã€‘') where user='ã€ç”¨æˆ·åã€‘';</span><br></pre></td></tr></table></figure><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>RDSç›®å‰ä½¿ç”¨MySQLç‰ˆæœ¬å’Œå®˜æ–¹åœ¨ç³»ç»Ÿåº“ä¸Šå·®å¼‚è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œè‹¥éœ€è¦æ­å»ºRDSåˆ°çº¿ä¸‹è‡ªå»ºMySQL5.7çš„ä¸»ä»æ—¶ï¼Œå¯ä»¥é€šè¿‡æ­¤æ³•å»å®ç°ã€‚</p><p>æœ¬æ–‡ä¸­å¯¹userè¡¨çš„ç ´è§£ï¼ŒåŒæ ·é€‚é€‚ç”¨äº<code>mysql.db</code> ã€<code>mysql.tables_priv</code>è¡¨ï¼Œéƒ½ç ´è§£åˆ™å¯ä»¥å°†æƒé™ä»ç”¨æˆ·æ‹“å±•åˆ°åº“è¡¨åˆ—ã€‚è¯»è€…å¯è‡ªè¡Œå®éªŒæµ‹è¯•ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦: é˜¿é‡Œäº‘çš„RDS For MySQL 5.7 åˆ°çº¿ä¸‹IDCæœºæˆ¿çš„ä¸»ä»æ­å»ºç›¸ä¿¡çœ‹å®˜æ–¹æ–‡æ¡£å°±å¯ä»¥å®Œæˆï¼Œä½†æ˜¯æ­å»ºä¹‹åå´å‘ç°æ— æ³•åœ¨æœ¬åœ°è¿›è¡Œè®¤è¯æƒé™çš„ç®¡ç†ï¼Œè¿™æ˜¯ä¸ºä½•ï¼Ÿè€Œé˜¿é‡Œå®˜æ–¹æ¨èä½¿ç”¨DTSåŒæ­¥å·¥å…·å»å®ç°ï¼Œè¿™ä¸ªè´¹ç”¨ç€å®ä¸å°‘ï¼Œåˆæ˜¯å¦èƒ½å¤Ÿç ´è§£å‘¢ï¼Ÿæœ¬æ–‡è¯¦è§£å¦‚ä½•æš´åŠ›ç ´è§£userè¡¨å®ç°ä»åº“ç”¨æˆ·æƒé™æ›´æ”¹åŠŸèƒ½&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯å¹¿è§’" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="RDS" scheme="http://www.toberoot.com/tags/RDS/"/>
    
      <category term="ä¸»ä»åŒæ­¥" scheme="http://www.toberoot.com/tags/%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨splitå·¥å…·è§£å†³ä¸€æ¬¡MongoDBæ—¥å¿—å¼‚å¸¸é—®é¢˜</title>
    <link href="http://www.toberoot.com/2018/08/03/booboo_others/%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/"/>
    <id>http://www.toberoot.com/2018/08/03/booboo_others/%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/</id>
    <published>2018-08-03T12:25:24.000Z</published>
    <updated>2020-03-22T08:32:42.584Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦ï¼š </p><ul><li>æŸå¤©æ™šä¸Šåˆšåˆ°å®¶ä¸ä¹…ï¼Œå°±æ¥åˆ°æ­å·åŒäº‹çš„ç”µè¯ï¼Œå®¢æˆ·MongoDBé›†ç¾¤ä¸­çš„æŸä¸ªåˆ†ç‰‡èŠ‚ç‚¹CPUé£™é«˜ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯æ…¢æŸ¥è¯¢ï¼Œç°åœ¨éœ€è¦æ‹‰å–CPUé£™é«˜æ—¶é—´æ®µçš„æ…¢æŸ¥è¯¢ã€‚å¿ƒæƒ³æ‹‰å–æ…¢æŸ¥è¯¢åº”è¯¥å¾ˆå¿«ï¼Œä¸å°±æ˜¯ä¸ªç³»ç»Ÿæ—¥å¿—å—ï¼Ÿè€Œä¸”è¿˜åšäº†æ—¥å¿—åˆ‡å‰²ä¸€å¤©ä¸€ä¸ªï¼ŒæŒ‰é“ç†å¾ˆå¿«æå®šçš„ï¼Œè°çŸ¥å½“å¤©æ™šä¸Šæäº†æ¥è¿‘ä¸‰ä¸ªå°æ—¶ä¹Ÿæ²¡æå®šã€‚ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</li><li>è¿›å…¥åˆ°æ—¥å¿—ç›®å½•ä¸€çœ‹ï¼Œç›®å‰ä¿ç•™è¿‘7å¤©çš„æ—¥å¿—ï¼Œæ¯å¤©çš„æ—¥å¿—é‡åœ¨23G~24Gï¼Œæˆ‘å½“æ—¶å°±æƒ³è¿™ä¸ªå®¢æˆ·æ•°æ®é‡è¿™ä¹ˆå¤§ï¼åç»­å‘ç°æ—¥å¿—æ ¼å¼æœ¬è¯¥ä¸ºæ™®é€šæ–‡æœ¬æ–‡ä»¶ç¡®å˜æˆäº†å›¾ç‰‡æ ¼å¼ï¼Œç©¶ç«Ÿä¸ºä½•ä¼šæ–‡ä»¶æ ¼å¼ä¼šè½¬å˜ï¼Ÿèƒ½å¦ä»å›¾ç‰‡æ ¼å¼ä¸­æ‹‰å–æŒ‡å®šæ—¶é—´æ®µçš„æ—¥å¿—å‘¢ï¼Ÿ</li><li>ç¬¬äºŒå¤©åˆ°å…¬å¸ï¼Œç”±äºå®¢æˆ·ç¯å¢ƒæˆ‘ä»¬ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥æ‰‹ï¼Œå› æ­¤å’±ä»¬æŠ€æœ¯ä¸“å®¶å›¢é˜Ÿæäº†ä¸€ä¸ª3äººçš„â€ä¸“å®¶ä¼šè¯Šâ€ï¼Œç»è¿‡äº†ä¸€ç•ªæŠ˜è…¾æ€»ç®—æŠŠåŸå› æ‰¾åˆ°äº†ï¼Œå…·ä½“è¿‡ç¨‹è¯·çœ‹ä¸‹æ–‡ï¼</li></ul><a id="more"></a><h2 id="æ•…äº‹èƒŒæ™¯"><a href="#æ•…äº‹èƒŒæ™¯" class="headerlink" title="æ•…äº‹èƒŒæ™¯"></a>æ•…äº‹èƒŒæ™¯</h2><h3 id="æ•°æ®åº“æ˜ç»†"><a href="#æ•°æ®åº“æ˜ç»†" class="headerlink" title="æ•°æ®åº“æ˜ç»†"></a>æ•°æ®åº“æ˜ç»†</h3><p>è¯´åœ¨å‰é¢ï¼š</p><ul><li>æ•°æ®åº“ï¼šMongoDBé›†ç¾¤ 4ä¸ªåˆ†ç‰‡èŠ‚ç‚¹</li><li>åˆ†ç‰‡èŠ‚ç‚¹è§„æ ¼ï¼š16æ ¸ / 32G CentOS 7.4 64ä½</li><li>æ•°æ®ç›®å½•æ‰€åœ¨ç£ç›˜: 300G   49G  252G  17% /data</li></ul><h3 id="æ•…äº‹æƒ…èŠ‚"><a href="#æ•…äº‹æƒ…èŠ‚" class="headerlink" title="æ•…äº‹æƒ…èŠ‚"></a>æ•…äº‹æƒ…èŠ‚</h3><ul><li>æŸå¤©æ™šä¸Šåˆšåˆ°å®¶ä¸ä¹…ï¼Œå°±æ¥åˆ°æ­å·åŒäº‹çš„ç”µè¯ï¼Œå®¢æˆ·MongoDBé›†ç¾¤ä¸­çš„æŸä¸ªåˆ†ç‰‡èŠ‚ç‚¹CPUé£™é«˜ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯æ…¢æŸ¥è¯¢ï¼Œç°åœ¨éœ€è¦æ‹‰å–CPUé£™é«˜æ—¶é—´æ®µçš„æ…¢æŸ¥è¯¢ã€‚å¿ƒæƒ³æ‹‰å–æ…¢æŸ¥è¯¢åº”è¯¥å¾ˆå¿«ï¼Œä¸å°±æ˜¯ä¸ªç³»ç»Ÿæ—¥å¿—å—ï¼Ÿè€Œä¸”è¿˜åšäº†æ—¥å¿—åˆ‡å‰²ä¸€å¤©ä¸€ä¸ªï¼ŒæŒ‰é“ç†å¾ˆå¿«æå®šçš„ï¼Œè°çŸ¥å½“å¤©æ™šä¸Šæäº†æ¥è¿‘ä¸‰ä¸ªå°æ—¶ä¹Ÿæ²¡æå®šã€‚ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</li><li>è¿›å…¥åˆ°æ—¥å¿—ç›®å½•ä¸€çœ‹ï¼Œç›®å‰ä¿ç•™è¿‘7å¤©çš„æ—¥å¿—ï¼Œæ¯å¤©çš„æ—¥å¿—é‡åœ¨23G~24Gï¼Œæˆ‘å½“æ—¶å°±æƒ³è¿™ä¸ªå®¢æˆ·æ•°æ®é‡è¿™ä¹ˆå¤§ï¼åç»­å‘ç°æ—¥å¿—æ ¼å¼æœ¬è¯¥ä¸ºæ™®é€šæ–‡æœ¬æ–‡ä»¶ç¡®å˜æˆäº†å›¾ç‰‡æ ¼å¼ï¼Œç©¶ç«Ÿä¸ºä½•ä¼šæ–‡ä»¶æ ¼å¼ä¼šè½¬å˜ï¼Ÿèƒ½å¦ä»å›¾ç‰‡æ ¼å¼ä¸­æ‹‰å–æŒ‡å®šæ—¶é—´æ®µçš„æ—¥å¿—å‘¢ï¼Ÿ</li><li>ç¬¬äºŒå¤©åˆ°å…¬å¸ï¼Œç”±äºå®¢æˆ·ç¯å¢ƒæˆ‘ä»¬ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥å—ï¼Œå› æ­¤å’±ä»¬æŠ€æœ¯ä¸“å®¶å›¢é˜Ÿæäº†ä¸€ä¸ª3äººçš„â€ä¸“å®¶ä¼šè¯Šâ€ï¼Œç»è¿‡äº†ä¸€ç•ªæŠ˜è…¾æ€»ç®—æŠŠåŸå› æ‰¾åˆ°äº†ï¼Œå…·ä½“è¿‡ç¨‹è¯·çœ‹ä¸‹æ–‡ï¼</li></ul><h2 id="å¤ç°ä¸å‰–æ"><a href="#å¤ç°ä¸å‰–æ" class="headerlink" title="å¤ç°ä¸å‰–æ"></a>å¤ç°ä¸å‰–æ</h2><h3 id="æ‹‰å–æ—¥å¿—å¼‚å¸¸"><a href="#æ‹‰å–æ—¥å¿—å¼‚å¸¸" class="headerlink" title="æ‹‰å–æ—¥å¿—å¼‚å¸¸"></a>æ‹‰å–æ—¥å¿—å¼‚å¸¸</h3><p><strong>ä½¿ç”¨mlogfilterè¿‡æ»¤æ–‡ä»¶æ—¶æŠ¥é”™è¯´æ–‡ä»¶émongodbçš„æ—¥å¿—æ–‡ä»¶</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@sh_01 booboo]# mlogfilter shard.log.2018-08-01 --from 2018-08-01T15:00:00.000+0800 --to "+1h" --slow 1000 &gt; /alidata/booboo/tf.1</span><br><span class="line">æŠ¥é”™:émongodbæ—¥å¿—æ ¼å¼</span><br></pre></td></tr></table></figure><p>å›åˆ°å®¢æˆ·æœåŠ¡å™¨æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ ¼å¼ï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@MONGO-SHARD-18 logs]# file *</span><br><span class="line">shard.log:            PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-25: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-26: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-27: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-28: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-29: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-30: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-31: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-01: PCX ver. 2.5 image data</span><br></pre></td></tr></table></figure><p>mongodbçš„æ—¥å¿—æ­£å¸¸åº”è¯¥ä¸ºï¼š<code>ASCII text, with very long lines</code>ï¼Œä½†æ˜¯ç°åœ¨å´å˜æˆäº†<code>PCX ver. 2.5 image data</code>ã€‚éœ€è¦å¼„æ¸…æ¥šåŸå› ã€‚</p><h3 id="æ—¥å¿—å¼‚å¸¸åˆ†æ"><a href="#æ—¥å¿—å¼‚å¸¸åˆ†æ" class="headerlink" title="æ—¥å¿—å¼‚å¸¸åˆ†æ"></a>æ—¥å¿—å¼‚å¸¸åˆ†æ</h3><ul><li>ä¸ºä»€ä¹ˆå®¢æˆ·æ¯å¤©çš„æ—¥å¿—é‡è¾¾åˆ°22ä¸ªGï¼Œå¹¶ä¸”æ¯å¤©çš„æ—¥å¿—é‡éƒ½æ˜¯å¤§äºç­‰äºå‰ä¸€å¤©ï¼Ÿå¾ˆæ˜¾ç„¶ï¼Œæ—¥å¿—æˆªæ–­æœ‰é—®é¢˜ã€‚</li><li>è¿™ä¸ªæ˜¯è¿‘7å¤©çš„æ—¥å¿—ï¼Œè€Œæ—¥å¿—æ ¼å¼å˜æˆäº†PCXå›¾ç‰‡æ ¼å¼æ˜¯ä¸ºä½•ï¼Ÿ</li><li>æ€€ç–‘æ¯æ¬¡æ—¥å¿—è½®è¯¢æ—¶éƒ½æ²¡æœ‰çœŸæ­£æˆªæ–­æ—¥å¿—ï¼</li></ul><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/01.png" alt=""></p><h3 id="åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†"><a href="#åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†" class="headerlink" title="åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†"></a>åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†</h3><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/03.png" alt=""></p><p>æ€€ç–‘ä¸<code>echo &gt;</code>æœ‰å…³ï¼Œè¿›è¡ŒéªŒè¯ã€‚</p><h3 id="éªŒè¯echo-gt-ä¸PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´"><a href="#éªŒè¯echo-gt-ä¸PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´" class="headerlink" title="éªŒè¯echo &gt;ä¸PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´"></a>éªŒè¯<code>echo &gt;</code>ä¸<code>PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´</code></h3><ol><li>å»ºä¸€ä¸ªç©ºæ–‡æ¡£<code>log</code>ï¼›æ‰§è¡Œ<code>echo &gt; log</code>ï¼›é€šè¿‡<code>cat -A log</code>æŸ¥çœ‹æ–‡ä»¶ä¸­æ’å…¥äº†ä¸€ä¸ªç¬¦å·å³æ¢è¡Œç¬¦<code>\n</code></li><li>é€šè¿‡<code>hexdump -c log</code> æŸ¥çœ‹æµ‹è¯•æ–‡ä»¶å¤´éƒ¨æ˜¾ç¤ºä¸ºASCIIå­—ç¬¦ <code>\n</code></li><li>é€šè¿‡<code>hexdump -d log</code> æŸ¥çœ‹æµ‹è¯•æ–‡ä»¶å¤´éƒ¨æ˜¾ç¤ºä¸º16è¿›åˆ¶<code>00010</code> å³<code>0a</code></li><li>é€šè¿‡<code>vim</code> ç”¨16è¿›åˆ¶æŸ¥çœ‹æ–‡æ¡£<code>log</code>å¯ä»¥çœ‹åˆ°logçš„æ–‡ä»¶å¤´éƒ¨ä¸º<code>0a</code>ï¼Œæ­£æ˜¯PCXå›¾ç‰‡çš„å¤´éƒ¨</li><li>ç”Ÿäº§ç¯å¢ƒæŸ¥çœ‹å®¢æˆ·æœ‰é—®é¢˜çš„mongodbç³»ç»Ÿæ—¥å¿—æ–‡ä»¶æ ¼å¼ä¸º<code>PCX</code>å›¾ç‰‡æ ¼å¼</li><li>é€šè¿‡<code>hexdump -c log</code> æ˜¾ç¤ºä¸ºASCIIå­—ç¬¦ï¼Œç”Ÿäº§æ—¥å¿—æ–‡ä»¶å¤´éƒ¨ä¸æµ‹è¯•çš„logä¸€è‡´ï¼Œéƒ½æ˜¯<code>\n</code></li><li>é€šè¿‡<code>hexdump -d log</code>æ˜¾ç¤ºä¸º16è¿›åˆ¶ï¼Œç”Ÿäº§æ—¥å¿—æ–‡ä»¶å¤´éƒ¨ä¸æµ‹è¯•çš„logä¸€è‡´<code>00010</code> å³ <code>0a</code></li></ol><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/02.png" alt=""></p><p><strong>åˆ°æ­¤éªŒè¯æˆåŠŸ:é€šè¿‡<code>echo &gt; log</code>çš„æ–¹å¼ä¼šå¾€æ–‡ä»¶å¤´éƒ¨æ–°å¢â€™0aâ€™</strong></p><hr><h3 id="å¤ç°MongoDBæ—¥å¿—ä»ASCII-textè½¬å˜ä¸ºPCX-æ ¼å¼"><a href="#å¤ç°MongoDBæ—¥å¿—ä»ASCII-textè½¬å˜ä¸ºPCX-æ ¼å¼" class="headerlink" title="å¤ç°MongoDBæ—¥å¿—ä»ASCII textè½¬å˜ä¸ºPCX æ ¼å¼"></a>å¤ç°MongoDBæ—¥å¿—ä»ASCII textè½¬å˜ä¸ºPCX æ ¼å¼</h3><p>åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¤ç°æ—¥å¿—ä»<code>ASCII text</code>å˜æˆ<code>PCX ver. 2.5 image data</code></p><ol><li>é€šè¿‡mongoç™»é™†æ•°æ®åº“æ‰§è¡Œå¤§é‡çš„æ’å…¥æ“ä½œ</li><li>é€šè¿‡echo &gt; mongod27017.log  å‘½ä»¤å°è¯•æ¸…ç©ºmongod27017.log</li><li>æŸ¥çœ‹æˆªæ–­åçš„æ—¥å¿—æ–‡ä»¶æ ¼å¼ï¼Œå˜æˆäº†very short file (no magic)</li><li>ç­‰æ–‡æ¡£æ’å…¥å®Œæ¯•</li><li>é€šè¿‡<code>tail -f</code> æŸ¥çœ‹æ—¥å¿—æ˜ç»†ï¼Œçœ‹åˆ°ç¡®å®æœ‰æ—¥å¿—å†™å…¥</li><li>æŸ¥çœ‹æ—¥å¿—æ ¼å¼ï¼Œå‘ç°å˜æˆäº†<code>PCX ver. 2.5 image data</code></li></ol><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/05.png" alt=""></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">[root@sh_01 ~]# mongo</span><br><span class="line">MongoDB shell version: 3.2.16</span><br><span class="line">connecting to: test</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.auth(<span class="string">'test_dev'</span>,<span class="string">'uplooking'</span>)</span></span><br><span class="line">1</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.t1.find()</span></span><br><span class="line">&#123; "_id" : ObjectId("5b5ebb6796b8b74a73ee30f6"), "a" : 1, "b" : 2 &#125;</span><br><span class="line">&#123; "_id" : ObjectId("5b5ebb6996b8b74a73ee30f7"), "a" : 1, "b" : 1 &#125;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="keyword">for</span> (i=1;i&lt;200000;i++)&#123;</span></span><br><span class="line">... db.t1.insert(&#123;id:i&#125;)&#125;</span><br><span class="line">WriteResult(&#123; "nInserted" : 1 &#125;)</span><br><span class="line"></span><br><span class="line">[root@sh_01 ~]# cd /alidata/mongodb/logs</span><br><span class="line">[root@sh_01 log]# ll</span><br><span class="line">-rw-r--r-- 1 root root 2182 Aug  3 10:28 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3100 Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line"></span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# ll</span><br><span class="line">total 12</span><br><span class="line">-rw-r--r-- 1 root root    1 Aug  3 10:29 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3100 Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     very short file (no magic)</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line"></span><br><span class="line">[root@sh_01 log]# tail -f mongod27017.log</span><br><span class="line"></span><br><span class="line">2018-08-03T10:30:21.936+0800 I NETWORK  [initandlisten] connection accepted from 127.0.0.1:43720 #2 (2 connections now open)</span><br><span class="line"></span><br><span class="line">[root@sh_01 log]# ll -h</span><br><span class="line">total 12K</span><br><span class="line">-rw-r--r-- 1 root root 2.8K Aug  3 10:30 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3.1K Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1.5K Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     PCX ver. 2.5 image data</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸€è¾¹ä¸æ–­äº§ç”Ÿæ—¥å¿—ï¼Œä¸€è¾¹å¤šæ¬¡æ‰§è¡Œ<span class="built_in">echo</span>&gt; </span></span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     PCX ver. 2.5 image data</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     very short file (no magic)</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# ll -h</span><br><span class="line">total 16K</span><br><span class="line">-rw-r--r-- 1 root root    1 Aug  3 11:28 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3.1K Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1.5K Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">-rw-r--r-- 1 root root 2.9K Aug  3 11:05 mongod27017.log.2018-08-03T03-09-08</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     very short file (no magic)</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     PCX ver. 2.5 image data</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# hexdump -c mongod27017.log</span><br><span class="line">0000000  \n  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">0000010  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">*</span><br><span class="line">0000850  \0  \0  \0  \0  \0  \0  \0   2   0   1   8   -   0   8   -   0</span><br><span class="line">0000860   3   T   1   1   :   2   9   :   0   6   .   7   2   9   +   0</span><br><span class="line">0000870   8   0   0       I       A   C   C   E   S   S               [</span><br><span class="line">0000880   c   o   n   n   3   ]       U   n   a   u   t   h   o   r   i</span><br><span class="line">0000890   z   e   d   :       n   o   t       a   u   t   h   o   r   i</span><br><span class="line">00008a0   z   e   d       o   n       t   e   s   t       t   o       e</span><br><span class="line">00008b0   x   e   c   u   t   e       c   o   m   m   a   n   d       &#123;</span><br><span class="line">00008c0       f   i   n   d   :       "   t   1   "   ,       f   i   l</span><br><span class="line">00008d0   t   e   r   :       &#123;   &#125;       &#125;  \n</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¤ç°äº†å®¢æˆ·çš„æƒ…å†µï¼š</p><ol><li><p>ç¬¬ä¸€æ¬¡<code>echo &gt; log</code>ï¼Œæ–‡ä»¶å¤´éƒ¨æ–°å¢<code>\n</code></p></li><li><p>å¤šæ¬¡<code>echo &gt; log</code>,æ–‡ä»¶å¤´éƒ¨å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0000000  \n  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">0000010  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">*</span><br></pre></td></tr></table></figure></li></ol><p>ç¡®å®æ˜¯mongodbæ—¥å¿—è½®è¯¢å‡ºäº†é—®é¢˜ï¼š</p><ol><li><code>echo &gt; log</code>ä¼šå¾€æ–‡ä»¶å¤´éƒ¨æ’å…¥<code>\n</code>å³16è¿›åˆ¶çš„<code>0a</code></li><li>åœ¨æ•°æ®åº“æ­£å¸¸è¿è¡Œä¸­ï¼Œå¯¹logæ–‡ä»¶æ˜¯åŠ äº†é”çš„ï¼Œå¼ºåˆ¶æ‰§è¡Œ<code>echo &gt; log</code>æ˜¯æ— æ³•è¿›è¡Œè¦†ç›–çš„ï¼Œä¼šå°†æ‰€æœ‰çš„æ•°æ®å…¨éƒ¨ç½®ä¸º<code>0</code></li><li>å¼ºåˆ¶è¦†ç›–åï¼Œæ–‡ä»¶å¤´éƒ¨å˜æˆäº†æ— æ•°çš„ç©ºç™½</li></ol><h3 id="å¾…è§£å†³é—®é¢˜"><a href="#å¾…è§£å†³é—®é¢˜" class="headerlink" title="å¾…è§£å†³é—®é¢˜"></a>å¾…è§£å†³é—®é¢˜</h3><ul><li>MongoDBæ—¥å¿—è½®è¯¢æ–¹æ³•è°ƒæ•´ä¸º<strong>kill -SIGUSER1 [mongodpid]</strong></li><li>ä¿®å¤ç›®å‰å·²ç»å˜ä¸ºå›¾ç‰‡æ ¼å¼çš„æ—¥å¿—ï¼Œå¹¶æ‹‰å–15ç‚¹åˆ°16ç‚¹çš„æ—¥å¿—</li></ul><h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><h3 id="MongoDBæ—¥å¿—è½®è¯¢"><a href="#MongoDBæ—¥å¿—è½®è¯¢" class="headerlink" title="MongoDBæ—¥å¿—è½®è¯¢"></a>MongoDBæ—¥å¿—è½®è¯¢</h3><h4 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@sh_01 log]# pidof mongod</span><br><span class="line">1828</span><br><span class="line">[root@sh_01 log]# kill -SIGUSER1 1828</span><br><span class="line">-bash: kill: SIGUSER1: invalid signal specification</span><br><span class="line">[root@sh_01 log]# kill -SIGUSR1 1828</span><br><span class="line">[root@sh_01 log]# ll</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  3 11:09 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3100 Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">-rw-r--r-- 1 root root 2942 Aug  3 11:05 mongod27017.log.2018-08-03T03-09-08</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br></pre></td></tr></table></figure><h4 id="ç”Ÿäº§ç¯å¢ƒ"><a href="#ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒ"></a>ç”Ÿäº§ç¯å¢ƒ</h4><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/04.png" alt=""></p><p>ä¿®æ”¹æ—¥å¿—è½®è¯¢è„šæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@MONGO-SHARD-18 logs]# cat /etc/init.d/mongo_logspit.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2018/08/02 Apple</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Rotate the MongoDB logs to prevent a single logfile from consuming too much disk space.</span></span><br><span class="line"></span><br><span class="line">cmd=mongod</span><br><span class="line">mongodpath=/opt/mongodb/bin</span><br><span class="line">pidarray=`pidof $&#123;mongodpath&#125;/$cmd`</span><br><span class="line">LOGPATH_SHARD=/data/mongodb/shard1/logs</span><br><span class="line"></span><br><span class="line">for pid in $pidarray;do</span><br><span class="line">if [ $pid ]</span><br><span class="line">then</span><br><span class="line">    kill -SIGUSR1 $pid</span><br><span class="line">fi</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash">clear logfile more than 7 days</span></span><br><span class="line">cd $LOGPATH_SHARD</span><br><span class="line">find ./ -xdev -mtime +7 -name "shard.log.*" -exec rm -f &#123;&#125;  \;</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰çš„åˆ†ç‰‡éƒ½å»æ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -SIGUSR1 pidof mongod</span><br></pre></td></tr></table></figure><p>åˆ†ç‰‡15æ“ä½œå¦‚ä¸‹ï¼šå…¶ä»–åˆ†ç‰‡åŒæ ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[zyadmin@MONGO-SHARD-15 ~]$ sudo -i</span><br><span class="line">[root@MONGO-SHARD-15 ~]# cd /data/mongodb/shard1/logs/</span><br><span class="line">[root@MONGO-SHARD-15 logs]# ll -h</span><br><span class="line">total 1.7G</span><br><span class="line">-rw-r--r-- 1 root root 20G Aug  2 15:27 shard.log</span><br><span class="line">-rw-r--r-- 1 root root 19G Jul 25 23:50 shard.log.2018-07-25</span><br><span class="line">-rw-r--r-- 1 root root 19G Jul 26 23:50 shard.log.2018-07-26</span><br><span class="line">-rw-r--r-- 1 root root 19G Jul 27 23:50 shard.log.2018-07-27</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 28 23:50 shard.log.2018-07-28</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 29 23:50 shard.log.2018-07-29</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 30 23:50 shard.log.2018-07-30</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 31 23:50 shard.log.2018-07-31</span><br><span class="line">-rw-r--r-- 1 root root 20G Aug  1 23:50 shard.log.2018-08-01</span><br><span class="line">[root@MONGO-SHARD-15 logs]# file *</span><br><span class="line">shard.log:            PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-25: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-26: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-27: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-28: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-29: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-30: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-31: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-01: PCX ver. 2.5 image data</span><br><span class="line">[root@MONGO-SHARD-15 logs]# kill -SIGUSR1 `pidof mongod`</span><br><span class="line">[root@MONGO-SHARD-15 logs]# file *</span><br><span class="line">shard.log:                     ASCII text, with very long lines</span><br><span class="line">shard.log.2018-07-25:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-26:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-27:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-28:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-29:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-30:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-31:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-01:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-02T07-27-29: PCX ver. 2.5 image data</span><br><span class="line">[root@MONGO-SHARD-15 logs]# ll -h</span><br><span class="line">total 1.7G</span><br><span class="line">-rw-r--r-- 1 root root 2.0K Aug  2 15:27 shard.log</span><br><span class="line">-rw-r--r-- 1 root root  19G Jul 25 23:50 shard.log.2018-07-25</span><br><span class="line">-rw-r--r-- 1 root root  19G Jul 26 23:50 shard.log.2018-07-26</span><br><span class="line">-rw-r--r-- 1 root root  19G Jul 27 23:50 shard.log.2018-07-27</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 28 23:50 shard.log.2018-07-28</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 29 23:50 shard.log.2018-07-29</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 30 23:50 shard.log.2018-07-30</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 31 23:50 shard.log.2018-07-31</span><br><span class="line">-rw-r--r-- 1 root root  20G Aug  1 23:50 shard.log.2018-08-01</span><br><span class="line">-rw-r--r-- 1 root root  20G Aug  2 15:27 shard.log.2018-08-02T07-27-29</span><br></pre></td></tr></table></figure><h3 id="ä¿®å¤å¼‚å¸¸æ—¥å¿—"><a href="#ä¿®å¤å¼‚å¸¸æ—¥å¿—" class="headerlink" title="ä¿®å¤å¼‚å¸¸æ—¥å¿—"></a>ä¿®å¤å¼‚å¸¸æ—¥å¿—</h3><h4 id="ä¿®å¤æ€è·¯"><a href="#ä¿®å¤æ€è·¯" class="headerlink" title="ä¿®å¤æ€è·¯"></a>ä¿®å¤æ€è·¯</h4><p>å¼„æ¸…æ¥šæ—¥å¿—å˜æ›´çš„åŸå› ä»¥åŠå¤ç°è¿‡ç¨‹åï¼Œä¸éš¾å‘ç°ï¼Œæ—¥å¿—å› ä¸ºå¤´éƒ¨å˜åŒ–ä»è€Œå¯¼è‡´æ–‡ä»¶æ ¼å¼å˜æ›´ã€‚å› æ­¤æ¨æµ‹å¼‚å¸¸æ—¥å¿—çš„ç»„æˆå¦‚ä¸‹ï¼š</p><ol><li>å¤´éƒ¨ä¸º<code>0a</code></li><li>ä¸­é—´å…¨éƒ¨éƒ½æ˜¯<code>0</code></li><li>æœ€åæ˜¯æ­£å¸¸çš„å­—ç¬¦ä¸²è®°å½•ç€mongodbçš„æ—¥å¿—ä¿¡æ¯ï¼Œç±»ä¼¼äº<code>2018-08-03T10:30:21.936+0800 I NETWORK  [initandlisten] connection accepted from 127.0.0.1:43720 #2 (2 connections now open)</code>ç”±æ—¥å¿—å’Œæ—¥å¿—æ˜ç»†ç»„æˆ</li></ol><p>å› æ­¤ä¿®å¤çš„æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>23Gçš„æ—¥å¿—ï¼Œé¦–å…ˆæŒ‰ç…§å¤§å°6Gåšåˆ‡åˆ†<code>split -b 6G log</code>ï¼Œåˆ‡åˆ†æˆ4ä¸ªæ–‡ä»¶</li><li>æŸ¥çœ‹åˆ‡åˆ†åçš„æ—¥å¿—æ ¼å¼ï¼Œå¦‚æœæœ€åä¸€ä¸ªæ—¥å¿—ä¸º<code>ASCII text</code>åˆ™ä¸å†åˆ‡åˆ†å¦åˆ™ï¼Œå°†æœ€åä¸€ä¸ªæ—¥å¿—ç»§ç»­åˆ‡åˆ†</li><li>å¾ªç¯ä¸Šä¸€æ­¥ï¼Œç›´åˆ°æœ€åä¸€ä¸ªæ–‡ä»¶åˆ‡åˆ†å‡ºæ¥æ²¡æœ‰<code>ASCII text</code>ä¸ºæ­¢</li></ul><h4 id="æ“ä½œæ˜ç»†"><a href="#æ“ä½œæ˜ç»†" class="headerlink" title="æ“ä½œæ˜ç»†"></a>æ“ä½œæ˜ç»†</h4><blockquote><p>æ—¥å¿—è½®è¯¢çš„éƒ¨ç½²è·ç¦»ç°åœ¨å¤§æ¦‚4ä¸ªæœˆ</p></blockquote><ol><li><p>ç¬¬ä¸€æ¬¡å°†23Gçš„æ–‡ä»¶ä»¥6Gåˆ‡åˆ†æˆ4ä¸ªæ–‡ä»¶ï¼šxaa\xab\xac\xadï¼ŒæŸ¥çœ‹4ä¸ªæ–‡ä»¶çš„å±æ€§ä¸º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xaa:               PCX ver. 2.5 image data</span><br><span class="line">xab:               PCX ver. 2.5 image data</span><br><span class="line">xac:               PCX ver. 2.5 image data</span><br><span class="line">xad:                PCX ver. 2.5 image data</span><br></pre></td></tr></table></figure></li><li><p>é‡å‘½åxadä¸ºx1ç¬¬äºŒæ¬¡åˆ‡åˆ†x1 5Gï¼ŒæŒ‰ç…§1Gåˆ‡åˆ†æˆ5ä»½ï¼ŒæŸ¥çœ‹æ–‡ä»¶å±æ€§</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xaa:               PCX ver. 2.5 image data</span><br><span class="line">xab:               PCX ver. 2.5 image data</span><br><span class="line">xac:               PCX ver. 2.5 image data</span><br><span class="line">xad:                PCX ver. 2.5 image data</span><br><span class="line">xae:                ASCII text, with very long lines</span><br></pre></td></tr></table></figure></li><li><p>é‡åxad ä¸º x2 æŒ‰ç…§15Mçš„å¤§å°åˆ‡åˆ†ï¼ŒæŸ¥çœ‹æ–‡ä»¶çš„å±æ€§å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">xaa:      PCX ver. 2.5 image data</span><br><span class="line">æ­¤å¤„çœç•¥ã€‚ã€‚ã€‚</span><br><span class="line">xdo:               PCX ver. 2.5 image data</span><br><span class="line">xdp:               ASCII text, with very long lines</span><br><span class="line">xdq:               ASCII text, with very long lines</span><br><span class="line">xdr:               ASCII text, with very long lines</span><br><span class="line">xds:               ASCII text, with very long lines</span><br><span class="line">xdt:               ASCII text, with very long lines</span><br><span class="line">xdu:               ASCII text, with very long lines</span><br><span class="line">xdv:               UTF-8 Unicode text, with very long lines</span><br><span class="line">xdw:               ASCII text, with very long lines</span><br><span class="line">xdx:               ASCII text, with very long lines</span><br><span class="line">xdy:               ASCII text, with very long lines</span><br></pre></td></tr></table></figure></li><li><p>åˆ‡åˆ†åæ–‡ä»¶ç±»å‹ä¸º<code>ASCII text</code>çš„æ–‡ä»¶ä¸­æ‰¾åˆ°15ç‚¹~16ç‚¹çš„æ–‡æ¡£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@sh_01 mongolog_20180801]# head -n 2 xdv</span><br><span class="line">re: "x86_64", version: "Kernel 3.10.0-693.2.2.el7.x86_64" &#125; &#125;</span><br><span class="line">2018-08-01T16:13:44.958+0800 I ACCESS   [conn4972925] Successfully authenticated as principal __system on local</span><br><span class="line">[root@sh_01 mongolog_20180801]# head -n 2 xdu</span><br><span class="line">38422 #4967772 (445 connections now open)</span><br><span class="line">2018-08-01T14:00:10.575+0800 I NETWORK  [thread1] connection accepted from 172.16.0.44:38430 #4967773 (446 connections now open)</span><br></pre></td></tr></table></figure></li></ol><ul><li><code>xdv</code> çš„å¤´éƒ¨æ˜¯<code>2018-08-01T16:13:44.958+0800</code>,å› æ­¤å¯ä»¥ç¡®å®š15~16çš„æ—¥å¿—åœ¨xduä¸­</li><li><code>xdu</code>è®°å½•çš„æ—¥å¿—æ—¶é—´æ®µä¸º<code>2018-08-01T14:00:10.575+0800</code>~<code>2018-08-01T16:13:44.958+0800</code></li><li>é‡å‘½å<code>xdu</code>ä¸º<code>mongolog.18.14_16</code></li></ul><h3 id="åˆ†ææ—¥å¿—"><a href="#åˆ†ææ—¥å¿—" class="headerlink" title="åˆ†ææ—¥å¿—"></a>åˆ†ææ—¥å¿—</h3><h4 id="åˆ†æå‘½ä»¤"><a href="#åˆ†æå‘½ä»¤" class="headerlink" title="åˆ†æå‘½ä»¤"></a>åˆ†æå‘½ä»¤</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è·å–08æœˆ01å·ä¸‹åˆ3ç‚¹å¼€å§‹åˆ°4ç‚¹æ‰§è¡Œæ—¶é—´è¶…è¿‡5ç§’çš„æŸ¥è¯¢</span></span><br><span class="line">mlogfilter mongolog.18.14_16 --from 2018-08-01T15 --to "+1h" --slow 5000 &gt; slowlog.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–08æœˆ01å·ä¸‹åˆ3ç‚¹å¼€å§‹åˆ°4ç‚¹è¯­å¥çš„æ‰§è¡Œæ¬¡æ•°ã€ç”¨æ—¶ç­‰ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line">mloginfo slowlog.txt  --queries &gt; an_slowlog.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡mplotqueriesè¿›è¡Œæ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾ç»˜åˆ¶ï¼Œä¸”åªè¿”å›å‰10ä¸ª</span></span><br><span class="line">mplotqueries slowlog.txt --output-file 01.png --logscale --group-limit 10</span><br></pre></td></tr></table></figure><h4 id="æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾"><a href="#æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾" class="headerlink" title="æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾"></a>æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@sh_01 booboo]# mplotqueries slowlog.txt --output-file 01.png --logscale --group-limit 10</span><br><span class="line">                                                                                          </span><br><span class="line">SCATTER plot</span><br><span class="line">   id   #points  group</span><br><span class="line">    1       692  order.order</span><br><span class="line">    2       615  omdmain.item_region_erp</span><br><span class="line">    3         1  omdmain.customer</span><br><span class="line">()</span><br></pre></td></tr></table></figure><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/10.png" alt=""></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜"><a href="#mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜" class="headerlink" title="mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜"></a>mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜</h3><ol><li><code>echo &gt; log</code>ä¼šå¾€æ–‡ä»¶å¤´éƒ¨æ’å…¥<code>\n</code>å³16è¿›åˆ¶çš„<code>0a</code></li><li>åœ¨æ•°æ®åº“æ­£å¸¸è¿è¡Œä¸­ï¼Œå¯¹logæ–‡ä»¶æ˜¯åŠ äº†é”çš„ï¼Œå¼ºåˆ¶æ‰§è¡Œ<code>echo &gt; log</code>æ˜¯æ— æ³•è¿›è¡Œè¦†ç›–çš„ï¼Œä¼šå°†æ‰€æœ‰çš„æ•°æ®å…¨éƒ¨ç½®ä¸º<code>0</code></li><li>å¼ºåˆ¶è¦†ç›–åï¼Œæ–‡ä»¶å¤´éƒ¨å˜æˆäº†æ— æ•°çš„ç©ºç™½</li></ol><h3 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h3><ul><li>MongoDBæ—¥å¿—è½®è¯¢æ–¹æ³•è°ƒæ•´ä¸º<strong>kill -SIGUSER1 [mongodpid]</strong></li><li>ä¿®å¤ç›®å‰å·²ç»å˜ä¸ºå›¾ç‰‡æ ¼å¼çš„æ—¥å¿—ï¼Œå¹¶æ‹‰å–15ç‚¹åˆ°16ç‚¹çš„æ—¥å¿—</li></ul><p>è¯¥caseèŠ±äº†ä¸€æ•´å¤©ï¼Œä»æ€€ç–‘è¢«æ”»å‡»åˆ°ç¡®è®¤æ˜¯æ—¥å¿—è½®è¯¢å¼•èµ·æ–‡ä»¶æ ¼å¼å˜æ›´æ˜¯ä¸€ä¸ªå…³é”®è½¬æŠ˜ç‚¹ï¼›</p><p>å¦å¤–PCXæ ¼å¼æ˜¯ç¬¬ä¸€æ¬¡ç¢°åˆ°ï¼Œç–‘æƒ‘äº†åŠå¤©~æœ€åæ˜¯@åŸ¹å°§å‘ç°äº†<code>echo</code>çš„ç«¯å€ªï¼Œ@è¡¾è¢­@å¤§å®å»éªŒè¯æœ€ç»ˆç¡®è®¤äº†é—®é¢˜çš„æ ¹æºã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦ï¼š &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŸå¤©æ™šä¸Šåˆšåˆ°å®¶ä¸ä¹…ï¼Œå°±æ¥åˆ°æ­å·åŒäº‹çš„ç”µè¯ï¼Œå®¢æˆ·MongoDBé›†ç¾¤ä¸­çš„æŸä¸ªåˆ†ç‰‡èŠ‚ç‚¹CPUé£™é«˜ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯æ…¢æŸ¥è¯¢ï¼Œç°åœ¨éœ€è¦æ‹‰å–CPUé£™é«˜æ—¶é—´æ®µçš„æ…¢æŸ¥è¯¢ã€‚å¿ƒæƒ³æ‹‰å–æ…¢æŸ¥è¯¢åº”è¯¥å¾ˆå¿«ï¼Œä¸å°±æ˜¯ä¸ªç³»ç»Ÿæ—¥å¿—å—ï¼Ÿè€Œä¸”è¿˜åšäº†æ—¥å¿—åˆ‡å‰²ä¸€å¤©ä¸€ä¸ªï¼ŒæŒ‰é“ç†å¾ˆå¿«æå®šçš„ï¼Œè°çŸ¥å½“å¤©æ™šä¸Šæäº†æ¥è¿‘ä¸‰ä¸ªå°æ—¶ä¹Ÿæ²¡æå®šã€‚ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ&lt;/li&gt;
&lt;li&gt;è¿›å…¥åˆ°æ—¥å¿—ç›®å½•ä¸€çœ‹ï¼Œç›®å‰ä¿ç•™è¿‘7å¤©çš„æ—¥å¿—ï¼Œæ¯å¤©çš„æ—¥å¿—é‡åœ¨23G~24Gï¼Œæˆ‘å½“æ—¶å°±æƒ³è¿™ä¸ªå®¢æˆ·æ•°æ®é‡è¿™ä¹ˆå¤§ï¼åç»­å‘ç°æ—¥å¿—æ ¼å¼æœ¬è¯¥ä¸ºæ™®é€šæ–‡æœ¬æ–‡ä»¶ç¡®å˜æˆäº†å›¾ç‰‡æ ¼å¼ï¼Œç©¶ç«Ÿä¸ºä½•ä¼šæ–‡ä»¶æ ¼å¼ä¼šè½¬å˜ï¼Ÿèƒ½å¦ä»å›¾ç‰‡æ ¼å¼ä¸­æ‹‰å–æŒ‡å®šæ—¶é—´æ®µçš„æ—¥å¿—å‘¢ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒå¤©åˆ°å…¬å¸ï¼Œç”±äºå®¢æˆ·ç¯å¢ƒæˆ‘ä»¬ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥æ‰‹ï¼Œå› æ­¤å’±ä»¬æŠ€æœ¯ä¸“å®¶å›¢é˜Ÿæäº†ä¸€ä¸ª3äººçš„â€ä¸“å®¶ä¼šè¯Šâ€ï¼Œç»è¿‡äº†ä¸€ç•ªæŠ˜è…¾æ€»ç®—æŠŠåŸå› æ‰¾åˆ°äº†ï¼Œå…·ä½“è¿‡ç¨‹è¯·çœ‹ä¸‹æ–‡ï¼&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯å¹¿è§’" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MongoDB" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MongoDB/"/>
    
    
      <category term="æ•°æ®æ•‘æ´" scheme="http://www.toberoot.com/tags/%E6%95%B0%E6%8D%AE%E6%95%91%E6%8F%B4/"/>
    
  </entry>
  
  <entry>
    <title>Oracleæ•°æ®åº“SQLä¼˜åŒ–_ç´¢å¼•ç¼ºå¤±</title>
    <link href="http://www.toberoot.com/2018/05/29/booboo_others/oracle%E6%95%B0%E6%8D%AE%E5%BA%93SQL%E4%BC%98%E5%8C%96-%E7%B4%A2%E5%BC%95%E7%BC%BA%E5%A4%B1/"/>
    <id>http://www.toberoot.com/2018/05/29/booboo_others/oracle%E6%95%B0%E6%8D%AE%E5%BA%93SQL%E4%BC%98%E5%8C%96-%E7%B4%A2%E5%BC%95%E7%BC%BA%E5%A4%B1/</id>
    <published>2018-05-28T18:09:32.000Z</published>
    <updated>2020-03-22T08:32:42.573Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦ï¼šOracleæ•°æ®åº“åšäº†è¿ç§»ï¼Œä»åŸæ¥çš„DGè¿ç§»åˆ°æ–°åº“RACï¼Œå°ç‰ˆæœ¬ä¸åŒï¼›è€åº“ä¸­ç›¸åŒçš„SQLæ‰§è¡Œåªéœ€è¦11ç§’ï¼Œè€Œæ–°åº“éœ€è¦360ç§’ç”šè‡³800å¤šç§’ï¼Œå¦‚ä½•è¿›è¡Œå¤æ‚æŸ¥è¯¢çš„SQLä¼˜åŒ–ï¼Œæœ¬æ–‡æä¾›é€šç”¨çš„ä¸€ä¸ªæ€è·¯ã€‚</p><a id="more"></a><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>oracleæ•°æ®åº“åšäº†è¿ç§»ï¼Œä»åŸæ¥çš„DGè¿ç§»åˆ°æ–°åº“RACï¼Œå°ç‰ˆæœ¬ä¸åŒï¼›</p><p>è€åº“ä¸­ç›¸åŒçš„SQLæ‰§è¡Œåªéœ€è¦11ç§’ï¼Œè€Œæ–°åº“éœ€è¦360ç§’ç”šè‡³800å¤šç§’ã€‚</p><table><thead><tr><th>åº“</th><th>åŸæŸ¥è¯¢æ—¶é—´</th><th>ä¼˜åŒ–åçš„æŸ¥è¯¢æ—¶é—´</th></tr></thead><tbody><tr><td>è€åº“</td><td>11ç§’</td><td>1.4ç§’ ç¼“å­˜å 0.4ç§’</td></tr><tr><td>æ–°åº“RAC</td><td>360ç§’</td><td>1.4ç§’ ç¼“å­˜å0.4ç§’æ’æŸ¥æ€è·¯</td></tr></tbody></table><h2 id="å¾…ä¼˜åŒ–SQL"><a href="#å¾…ä¼˜åŒ–SQL" class="headerlink" title="å¾…ä¼˜åŒ–SQL"></a>å¾…ä¼˜åŒ–SQL</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">prj.PROVINCE_AD_NAME,</span><br><span class="line">prj.CITY_AD_NAME,</span><br><span class="line">prj.AD_NAME,</span><br><span class="line">prj.CHANNEL_SYS_CAT,</span><br><span class="line">prj.EXCUTE_EL,</span><br><span class="line">prj.PRJ_CODE AS PRJ_CODE,</span><br><span class="line">prj.PRJ_NAME AS PRJ_NAME,</span><br><span class="line">prj.POS_CODE AS POS_CODE,</span><br><span class="line">prj.POS_NAME AS POS_NAME,</span><br><span class="line">prj.CUST_CHANNEL_CODE,</span><br><span class="line">prj.CUST_CHANNEL_NAME,</span><br><span class="line">prj.EMP_CODE AS EMP_CODE,</span><br><span class="line">prj.NAME AS EMP_NAME,</span><br><span class="line">prj.ATT_DATE AS APPLY_DATE,</span><br><span class="line">prj.EMP_PK AS EMP_PK,</span><br><span class="line">prj.ATT_START_TIME AS START_TIME,</span><br><span class="line">prj.ATT_END_TIME AS END_TIME,</span><br><span class="line">prj.ATT_ISWORK AS ISWORK,</span><br><span class="line">prj.ATT_UNWORK AS ATTTYPE,</span><br><span class="line">prj.START_XPOS AS ON_WORK_POSITION_LON,</span><br><span class="line">prj.START_YPOS AS ON_WORK_POSITION_LAT,</span><br><span class="line">prj.START_ISEXCEP AS ON_WORK_POSITION_STAUS,</span><br><span class="line">prj.END_XPOS AS OFF_WORK_POSITION_LAT,</span><br><span class="line">prj.END_YPOS AS OFF_WORK_POSITION_LON,</span><br><span class="line">prj.END_ISEXCEP AS OFF_WORK_POSITION_STAUS,</span><br><span class="line">ifcl1Staus.COMPARE_TYPE AS FACE_ATT_TYPE,</span><br><span class="line">ifcl1.STATUS AS FACE_ATT_STATUS,</span><br><span class="line">NVL( ifaceCount.faceCount, 0 ) AS FACE_ATT_COUNT,</span><br><span class="line">NVL( levLeave.LEAVECount, 0 ) AS LEAVE_WORK_COUNT,</span><br><span class="line">NVL( levRtn.RETURNCount, 0 ) AS RETURN_WORK_COUNT,</span><br><span class="line">wq.STATUS AS PRJ_QUESTION_TYPE,</span><br><span class="line">iface2.FACE_ATT_IMG AS FACE_ATT_IMG,</span><br><span class="line">prj.SA_TYPE</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">dpsi.ID AS ID,</span><br><span class="line">P.ID AS PRJ_ID,</span><br><span class="line">mad.AD_CODE,</span><br><span class="line">mad.PROVINCE_AD_NAME,</span><br><span class="line">mad.CITY_AD_NAME,</span><br><span class="line">mad.AD_NAME,</span><br><span class="line">mpk.POS_KIND_CODE,</span><br><span class="line">mpk.POS_KIND_NAME,</span><br><span class="line">P.CODE AS PRJ_CODE,</span><br><span class="line">P.NAME AS PRJ_NAME,</span><br><span class="line">P.START_DATE,</span><br><span class="line">p.END_DATE,</span><br><span class="line">dpsi.CUST_CHANNEL,</span><br><span class="line">dpsi.CUST_SYS,</span><br><span class="line">dpsi.CUST_CHANNEL_CODE,</span><br><span class="line">dpsi.CUST_CHANNEL_NAME,</span><br><span class="line">dcs.CHANNEL_SYS_CAT,</span><br><span class="line">dcs.CHANNEL_CAT_CODE,</span><br><span class="line">dcs.CHANNEL_AD_CODE,</span><br><span class="line">dcs.CHANNEL_PROVINCE_AD_CODE,</span><br><span class="line">dcs.CHANNEL_CITY_AD_CODE,</span><br><span class="line">dcs.ID AS POS_ID,</span><br><span class="line">dcs.CHANNEL_CODE AS POS_CODE,</span><br><span class="line">dcs.CHANNEL_NAME AS POS_NAME,</span><br><span class="line">dcs.LONGITUDE AS LONGITUDE,</span><br><span class="line">dcs.LATITUDE AS LATITUDE,</span><br><span class="line">dss.id AS SALES_ID,</span><br><span class="line">TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' ) AS sc_schedule_date,</span><br><span class="line">wor.SW_BEGIN_TIME AS SALES_WORK_START,</span><br><span class="line">wor.SW_END_TIME AS SALES_WORK_END,</span><br><span class="line">dss.SALES_EAT_START,</span><br><span class="line">dss.SALES_EAT_END,</span><br><span class="line">memp.EMP_PK,</span><br><span class="line">memp.EMP_CODE,</span><br><span class="line">dss.SALES_NAME AS NAME,</span><br><span class="line">dss.SALES_PHONE AS TEL,</span><br><span class="line">dss.SALES_CARD_ID AS ID_CARD,</span><br><span class="line">spp.PRJ_ATT_CHECK_TYPE,</span><br><span class="line">spp.ALLOW_LEAVE_TIME,</span><br><span class="line">e1.EMP_CODE AS EXCUTE_CODE,</span><br><span class="line">e1.emp_name AS EXCUTE_EL,</span><br><span class="line">e2.EMP_CODE AS CITY_CODE,</span><br><span class="line">e2.emp_name AS CITY_EL,</span><br><span class="line">e3.EMP_CODE AS AREA_CODE,</span><br><span class="line">e3.EMP_NAME AS AREA_NAME,</span><br><span class="line">dpsi.SCHEDULE_TYPE,</span><br><span class="line">sac.ATT_START_TIME,</span><br><span class="line">sac.ATT_END_TIME,</span><br><span class="line">sac.ATT_ISWORK,</span><br><span class="line">sac.ATT_UNWORK,</span><br><span class="line">sac.START_XPOS,</span><br><span class="line">sac.START_YPOS,</span><br><span class="line">DECODE( sac.START_ISEXCEP, 0, 2201, 1, 2202, 2, 2203, 3, 2204, 4, 2205, 2206 ) AS START_ISEXCEP,</span><br><span class="line">sac.END_XPOS,</span><br><span class="line">sac.END_YPOS,</span><br><span class="line">sac.END_ISEXCEP,</span><br><span class="line">sac.ATT_SCH_PK,</span><br><span class="line">sac.ATT_DATE,</span><br><span class="line">CASE</span><br><span class="line">WHEN sac.ATT_START_TIME IS NOT NULL</span><br><span class="line">AND sac.ATT_END_TIME IS NOT NULL THEN '1'</span><br><span class="line">WHEN sac.ATT_START_TIME IS NOT NULL</span><br><span class="line">OR sac.ATT_END_TIME IS NOT NULL THEN '2'</span><br><span class="line">ELSE '2'</span><br><span class="line">END AS SA_TYPE</span><br><span class="line">FROM</span><br><span class="line">DM_PROJECT_SELLIN_INFO dpsi</span><br><span class="line">LEFT JOIN MD_EMP e1 ON</span><br><span class="line">dpsi.EMP_CODE = e1.EMP_CODE</span><br><span class="line">LEFT JOIN MD_EMP e2 ON</span><br><span class="line">dpsi.CITY_EMP_CODE = e2.EMP_CODE</span><br><span class="line">LEFT JOIN MD_EMP e3 ON</span><br><span class="line">dpsi.AREA_MANAGER_CODE = e3.EMP_CODE,</span><br><span class="line">DM_PROJECT P,</span><br><span class="line">DM_PROJECT_SELLIN_SALES dss,</span><br><span class="line">DM_CHANNEL_SYNC dcs,</span><br><span class="line">MD_EMP memp,</span><br><span class="line">SP_PRJ_PARM spp,</span><br><span class="line">Md_Admin_Div mad,</span><br><span class="line">MD_POS_KIND mpk,</span><br><span class="line">dm_sales_schedule_calendar cal,</span><br><span class="line">dm_sales_schedule_work wor,</span><br><span class="line">SP_ATT_SCH sac</span><br><span class="line">WHERE</span><br><span class="line">dpsi.PROJECT_ID = P.ID</span><br><span class="line">AND dss.id = cal.sales_id</span><br><span class="line">AND cal.schedule_work_id = wor.id</span><br><span class="line">AND dcs.CHANNEL_CAT_CODE = mpk.POS_KIND_CODE</span><br><span class="line">AND dss.PROJECT_SELLIN_INFO_ID = dpsi.ID</span><br><span class="line">AND dss.DELETE_FLAG = '0'</span><br><span class="line">AND dpsi.CHANNEL_SYNC_ID = dcs.ID</span><br><span class="line">AND LOWER( memp.EMP_S_CODE )= LOWER( dss.SALES_CARD_ID )</span><br><span class="line">AND P.IS_DELETE IS NULL</span><br><span class="line">AND memp.IS_DEL = '0'</span><br><span class="line">AND spp.PRJ_CODE = P.CODE</span><br><span class="line">AND mad.AD_ID = dcs.CHANNEL_ADMIN_DIV_ID</span><br><span class="line">AND mad.IS_DEL = '0'</span><br><span class="line">AND memp.EMP_TYPE = '1001'</span><br><span class="line">AND TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' )&gt;='2018-04-01'</span><br><span class="line">AND TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' )&lt;='2018-04-30'</span><br><span class="line">AND sac.PRJ_CODE = p.CODE</span><br><span class="line">AND sac.POS_CODE = dcs.CHANNEL_CODE</span><br><span class="line">AND sac.EMP_PK = memp.EMP_PK</span><br><span class="line">AND sac.ATT_DATE = TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' )</span><br><span class="line">AND TO_CHAR( sac.CRT_DATE, 'yyyy-mm-dd' )&gt;='2018-04-01'</span><br><span class="line">AND TO_CHAR( sac.CRT_DATE, 'yyyy-mm-dd' )&lt;='2018-04-30'</span><br><span class="line">) prj,</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">ifcl.EMP_PK,</span><br><span class="line">ifcl.COMPARE_DATE,</span><br><span class="line">ifcl.STATUS</span><br><span class="line">FROM</span><br><span class="line">IPG_FACE_COMPARE_LOG ifcl</span><br><span class="line">WHERE</span><br><span class="line">ifcl.HANDLE_TYPE = 0</span><br><span class="line">AND ifcl.DELETE_FLAG = '0'</span><br><span class="line">AND ifcl.COMPARE_TYPE IN(</span><br><span class="line">'1',</span><br><span class="line">'3',</span><br><span class="line">'5'</span><br><span class="line">)</span><br><span class="line">AND ifcl.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">AND ifcl.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">GROUP BY</span><br><span class="line">ifcl.EMP_PK,</span><br><span class="line">ifcl.COMPARE_DATE,</span><br><span class="line">ifcl.STATUS</span><br><span class="line">HAVING</span><br><span class="line">AVG( STATUS )&lt; 1</span><br><span class="line">) ifcl1,</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">*</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">EMP_PK,</span><br><span class="line">COMPARE_DATE,</span><br><span class="line">COMPARE_TYPE,</span><br><span class="line">ROW_NUMBER() OVER(</span><br><span class="line">PARTITION BY EMP_PK,</span><br><span class="line">COMPARE_DATE</span><br><span class="line">ORDER BY</span><br><span class="line">CREATED DESC</span><br><span class="line">) rn</span><br><span class="line">FROM</span><br><span class="line">IPG_FACE_COMPARE_LOG</span><br><span class="line">WHERE</span><br><span class="line">COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">AND COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">AND COMPARE_TYPE IN(</span><br><span class="line">'1',</span><br><span class="line">'3',</span><br><span class="line">'5'</span><br><span class="line">)</span><br><span class="line">) t</span><br><span class="line">WHERE</span><br><span class="line">t.rn &lt;= 1</span><br><span class="line">) ifcl1Staus,</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">SP_LEV_RPT.ATT_SCH_PK,</span><br><span class="line">COUNT(*) AS LEAVECount</span><br><span class="line">FROM</span><br><span class="line">SP_LEV_RPT</span><br><span class="line">WHERE</span><br><span class="line">SP_LEV_RPT.START_TIME IS NOT NULL</span><br><span class="line">GROUP BY</span><br><span class="line">SP_LEV_RPT.ATT_SCH_PK</span><br><span class="line">) levLeave,</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">SP_LEV_RPT.ATT_SCH_PK,</span><br><span class="line">COUNT(*) AS RETURNCount</span><br><span class="line">FROM</span><br><span class="line">SP_LEV_RPT</span><br><span class="line">WHERE</span><br><span class="line">SP_LEV_RPT.END_TIME IS NOT NULL</span><br><span class="line">GROUP BY</span><br><span class="line">SP_LEV_RPT.ATT_SCH_PK</span><br><span class="line">) levRtn,</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">WX_QUESTION.PRJ_ID,</span><br><span class="line">DM_PROJECT.CODE,</span><br><span class="line">'Y' AS STATUS</span><br><span class="line">FROM</span><br><span class="line">WX_QUESTION,</span><br><span class="line">DM_PROJECT</span><br><span class="line">WHERE</span><br><span class="line">DM_PROJECT.ID = WX_QUESTION.PRJ_ID</span><br><span class="line">AND WX_QUESTION.IS_DEL = '0'</span><br><span class="line">AND WX_QUESTION.STATUS = '0'</span><br><span class="line">GROUP BY</span><br><span class="line">WX_QUESTION.PRJ_ID,</span><br><span class="line">DM_PROJECT.CODE</span><br><span class="line">) wq,</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">ifcl.EMP_PK,</span><br><span class="line">ifcl.COMPARE_DATE,</span><br><span class="line">COUNT(*) AS faceCount</span><br><span class="line">FROM</span><br><span class="line">IPG_FACE_COMPARE_LOG ifcl</span><br><span class="line">WHERE</span><br><span class="line">ifcl.HANDLE_TYPE = 0</span><br><span class="line">AND ifcl.COMPARE_TYPE IN(</span><br><span class="line">'1',</span><br><span class="line">'3',</span><br><span class="line">'5'</span><br><span class="line">)</span><br><span class="line">AND ifcl.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">AND ifcl.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">GROUP BY</span><br><span class="line">ifcl.EMP_PK,</span><br><span class="line">ifcl.COMPARE_DATE</span><br><span class="line">) ifaceCount,</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">iface.EMP_PK,</span><br><span class="line">iface.COMPARE_DATE,</span><br><span class="line">wm_concat(</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">NVL( TRIM( T.PAR_VALUE ), TRIM( T.OLD_PAR_VALUE ))</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">PAR_VALUE</span><br><span class="line">FROM</span><br><span class="line">MD_SYS_PARM</span><br><span class="line">WHERE</span><br><span class="line">PAR_CODE = 'OLD_PIC_PATH'</span><br><span class="line">) AS OLD_PAR_VALUE,</span><br><span class="line">PAR_VALUE</span><br><span class="line">FROM</span><br><span class="line">MD_SYS_PARM</span><br><span class="line">WHERE</span><br><span class="line">PAR_CODE = 'ATT_COS_PATH'</span><br><span class="line">) T</span><br><span class="line">)|| REPLACE( SUBSTR( iface.COMPARE_MSG, INSTR( iface.COMPARE_MSG, 'compare', 1, 1 )), ']', '' )</span><br><span class="line">) AS FACE_ATT_IMG</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">ifa.EMP_PK,</span><br><span class="line">ifa.COMPARE_DATE,</span><br><span class="line">ifa.COMPARE_MSG,</span><br><span class="line">RANK() OVER(</span><br><span class="line">PARTITION BY ifa.EMP_PK,</span><br><span class="line">ifa.COMPARE_DATE</span><br><span class="line">ORDER BY</span><br><span class="line">ifa.created DESC</span><br><span class="line">) rankno</span><br><span class="line">FROM</span><br><span class="line">IPG_FACE_COMPARE_LOG ifa</span><br><span class="line">WHERE</span><br><span class="line">ifa.HANDLE_TYPE = 0</span><br><span class="line">AND ifa.COMPARE_TYPE IN(</span><br><span class="line">'1',</span><br><span class="line">'3',</span><br><span class="line">'5'</span><br><span class="line">)</span><br><span class="line">AND INSTR( ifa.COMPARE_MSG, 'compare' )&gt; 0</span><br><span class="line">AND ifa.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">AND ifa.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">) iface</span><br><span class="line">WHERE</span><br><span class="line">iface.rankno &lt;= 3</span><br><span class="line">GROUP BY</span><br><span class="line">iface.EMP_PK,</span><br><span class="line">iface.COMPARE_DATE</span><br><span class="line">) iface2</span><br><span class="line">WHERE</span><br><span class="line">prj.PRJ_NAME ='(2013)è¡Œæ”¿é¡¹ç›®'</span><br><span class="line">AND prj.ATT_DATE &gt;='2018-04-01'</span><br><span class="line">AND prj.ATT_DATE &lt;='2018-04-30'</span><br><span class="line">AND prj.EMP_PK = ifcl1.EMP_PK(+)</span><br><span class="line">AND TO_CHAR( TO_DATE( prj.ATT_DATE, 'yyyy-mm-dd' ), 'yyyymmdd' )= ifcl1.COMPARE_DATE(+)</span><br><span class="line">AND prj.EMP_PK = ifcl1Staus.EMP_PK(+)</span><br><span class="line">AND TO_CHAR( TO_DATE( prj.ATT_DATE, 'yyyy-mm-dd' ), 'yyyymmdd' )= ifcl1Staus.COMPARE_DATE(+)</span><br><span class="line">AND prj.ATT_SCH_PK = levLeave.ATT_SCH_PK(+)</span><br><span class="line">AND prj.ATT_SCH_PK = levRtn.ATT_SCH_PK(+)</span><br><span class="line">AND prj.PRJ_CODE = wq.CODE(+)</span><br><span class="line">AND prj.EMP_PK = ifaceCount.EMP_PK(+)</span><br><span class="line">AND TO_CHAR( TO_DATE( prj.ATT_DATE, 'yyyy-mm-dd' ), 'yyyymmdd' )= ifaceCount.COMPARE_DATE(+)</span><br><span class="line">AND prj.EMP_PK = iface2.EMP_PK(+)</span><br><span class="line">AND TO_CHAR( TO_DATE( prj.sc_schedule_date, 'yyyy-mm-dd' ), 'yyyymmdd' )= iface2.COMPARE_DATE(+)</span><br><span class="line">ORDER BY</span><br><span class="line">APPLY_DATE DESC,</span><br><span class="line">ATTTYPE DESC</span><br></pre></td></tr></table></figure><h2 id="SQLä¼˜åŒ–æ€è·¯"><a href="#SQLä¼˜åŒ–æ€è·¯" class="headerlink" title="SQLä¼˜åŒ–æ€è·¯"></a>SQLä¼˜åŒ–æ€è·¯</h2><p>SQLè¯­å¥è¾ƒå¤æ‚ï¼Œ8ä¸ªå­æŸ¥è¯¢çš„left outer joinï¼Œæ¯ä¸ªå­æŸ¥è¯¢ä¸­åˆæœ‰è¿æ¥ã€‚æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li>ä»å¤–å¾€å†…æ‹†åˆ†å­æŸ¥è¯¢</li><li>è€æ—§å¯¹æ¯”å­æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’å’Œæ‰§è¡Œæ•ˆç‡</li><li>å­æŸ¥è¯¢è¿æ¥ä»1åˆ°2åˆ°3ä¸€ç›´åˆ°8ä¸ªè”æŸ¥å¯¹æ¯”ï¼Œå¯»æ‰¾ç“¶é¢ˆ</li></ol><h3 id="æ‹†åˆ†å­æŸ¥è¯¢"><a href="#æ‹†åˆ†å­æŸ¥è¯¢" class="headerlink" title="æ‹†åˆ†å­æŸ¥è¯¢"></a>æ‹†åˆ†å­æŸ¥è¯¢</h3><table><thead><tr><th>å­æŸ¥è¯¢</th><th>è€åº“ ï¼ˆç§’ï¼‰</th><th>æ–°åº“ï¼ˆç§’ï¼‰</th></tr></thead><tbody><tr><td>prj</td><td>1.182</td><td>0.318</td></tr><tr><td>ifcl1</td><td>14.229</td><td>13.168</td></tr><tr><td>ifclStatus</td><td>15.739</td><td>16.769</td></tr><tr><td>levLeave</td><td>10.147</td><td>9.813</td></tr><tr><td>levRtn</td><td>9.148</td><td>8.3</td></tr><tr><td>wq</td><td>0.141</td><td>0.165</td></tr><tr><td>ifcl1Count</td><td>3.498</td><td>1.966</td></tr><tr><td>iface2</td><td>49.255</td><td>50.897</td></tr></tbody></table><h3 id="å¯»æ‰¾ç“¶é¢ˆ"><a href="#å¯»æ‰¾ç“¶é¢ˆ" class="headerlink" title="å¯»æ‰¾ç“¶é¢ˆ"></a>å¯»æ‰¾ç“¶é¢ˆ</h3><table><thead><tr><th>è¿æ¥</th><th>è€åº“ï¼ˆç§’ï¼‰</th><th>æ–°åº“ï¼ˆç§’ï¼‰</th></tr></thead><tbody><tr><td>prj+ifcl1</td><td>1.522</td><td>1.129</td></tr><tr><td>+ifclStatus</td><td>2.343</td><td>1.957</td></tr><tr><td>+levLeave</td><td>2.525</td><td>1.955</td></tr><tr><td>+levRtn</td><td>2.658</td><td>1.653</td></tr><tr><td>+wq</td><td>2.561</td><td>1.999</td></tr><tr><td>+ifcl1Count</td><td>3.498</td><td>1.966</td></tr><tr><td>+iface2</td><td>11.124</td><td>383</td></tr></tbody></table><p>å‘ç°ç“¶é¢ˆå‡ºç°åœ¨<code>iface2</code></p><h2 id="ä¼˜åŒ–iface2"><a href="#ä¼˜åŒ–iface2" class="headerlink" title="ä¼˜åŒ–iface2"></a>ä¼˜åŒ–iface2</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">iface.EMP_PK,</span><br><span class="line">iface.COMPARE_DATE,</span><br><span class="line">wm_concat(</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">NVL( TRIM( T.PAR_VALUE ), TRIM( T.OLD_PAR_VALUE ))</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">PAR_VALUE</span><br><span class="line">FROM</span><br><span class="line">MD_SYS_PARM</span><br><span class="line">WHERE</span><br><span class="line">PAR_CODE = 'OLD_PIC_PATH'</span><br><span class="line">) AS OLD_PAR_VALUE,</span><br><span class="line">PAR_VALUE</span><br><span class="line">FROM</span><br><span class="line">MD_SYS_PARM</span><br><span class="line">WHERE</span><br><span class="line">PAR_CODE = 'ATT_COS_PATH'</span><br><span class="line">) T</span><br><span class="line">)|| REPLACE( SUBSTR( iface.COMPARE_MSG, INSTR( iface.COMPARE_MSG, 'compare', 1, 1 )), ']', '' )</span><br><span class="line">) AS FACE_ATT_IMG</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">ifa.EMP_PK,</span><br><span class="line">ifa.COMPARE_DATE,</span><br><span class="line">ifa.COMPARE_MSG,</span><br><span class="line">RANK() OVER(</span><br><span class="line">PARTITION BY ifa.EMP_PK,</span><br><span class="line">ifa.COMPARE_DATE</span><br><span class="line">ORDER BY</span><br><span class="line">ifa.created DESC</span><br><span class="line">) rankno</span><br><span class="line">FROM</span><br><span class="line">IPG_FACE_COMPARE_LOG ifa</span><br><span class="line">WHERE</span><br><span class="line">ifa.HANDLE_TYPE = 0</span><br><span class="line">AND ifa.COMPARE_TYPE IN(</span><br><span class="line">'1',</span><br><span class="line">'3',</span><br><span class="line">'5'</span><br><span class="line">)</span><br><span class="line">AND INSTR( ifa.COMPARE_MSG, 'compare' )&gt; 0</span><br><span class="line">AND ifa.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">AND ifa.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">) iface</span><br><span class="line">WHERE</span><br><span class="line">iface.rankno &lt;= 3</span><br><span class="line">GROUP BY</span><br><span class="line">iface.EMP_PK,</span><br><span class="line">iface.COMPARE_DATE</span><br></pre></td></tr></table></figure><p><code>IPG_FACE_COMPARE_LOG</code>è¡¨ä¸­<code>COMPARE_DATEåˆ—</code>éœ€è¦æ–°å¢ç´¢å¼•ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>oracleå°ç‰ˆæœ¬ä¸åŒå¼•èµ·ä¼˜åŒ–å™¨æ— æ³•è·å–ç›¸åŒçš„æ‰§è¡Œè®¡åˆ’</li><li>ç´¢å¼•ç¼ºå¤±æ˜¯æœ¬æ¬¡çš„æ…¢æŸ¥è¯¢çš„ä¸»è¦åŸå› </li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦ï¼šOracleæ•°æ®åº“åšäº†è¿ç§»ï¼Œä»åŸæ¥çš„DGè¿ç§»åˆ°æ–°åº“RACï¼Œå°ç‰ˆæœ¬ä¸åŒï¼›è€åº“ä¸­ç›¸åŒçš„SQLæ‰§è¡Œåªéœ€è¦11ç§’ï¼Œè€Œæ–°åº“éœ€è¦360ç§’ç”šè‡³800å¤šç§’ï¼Œå¦‚ä½•è¿›è¡Œå¤æ‚æŸ¥è¯¢çš„SQLä¼˜åŒ–ï¼Œæœ¬æ–‡æä¾›é€šç”¨çš„ä¸€ä¸ªæ€è·¯ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯å¹¿è§’" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="Oracle" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/Oracle/"/>
    
    
      <category term="SQLä¼˜åŒ–" scheme="http://www.toberoot.com/tags/SQL%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>MySQLä¸€æ¬¡æƒŠå¿ƒåŠ¨é­„åœ°æ•°æ®å¼ºåˆ¶æ¢å¤</title>
    <link href="http://www.toberoot.com/2018/05/17/booboo_others/MySQL%E4%B8%80%E6%AC%A1%E6%83%8A%E5%BF%83%E5%8A%A8%E9%AD%84%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%BC%BA%E5%88%B6%E6%81%A2%E5%A4%8D/"/>
    <id>http://www.toberoot.com/2018/05/17/booboo_others/MySQL%E4%B8%80%E6%AC%A1%E6%83%8A%E5%BF%83%E5%8A%A8%E9%AD%84%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%BC%BA%E5%88%B6%E6%81%A2%E5%A4%8D/</id>
    <published>2018-05-16T19:58:02.000Z</published>
    <updated>2020-03-22T08:32:42.588Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦ï¼šCashæ¢å¤çš„æ­£ç¡®æ–¹å¼æ˜¯ï¼š<strong>å¤‡ä»½æ–‡ä»¶ï¼ˆé€»è¾‘æˆ–ç‰©ç†ï¼‰+ binlog</strong>è¿›è¡Œæ¢å¤ï¼›ç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¿ç»´äººå‘˜éƒ½çŸ¥é“æ€ä¹ˆè¿›è¡Œæ­£ç¡®çš„å¤‡ä»½ï¼Œç”šè‡³è¿é€»è¾‘å¤‡ä»½å’Œç‰©ç†å¤‡ä»½çš„åŒºåˆ«æ˜¯ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Ÿæ›´ä¸çŸ¥é“å¤‡ä»½è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘æ•°æ®çš„ä¸€è‡´æ€§ä¸æœåŠ¡å¯ç”¨æ€§çš„é—®é¢˜ï¼Ÿæˆ–è€…è¿å¤‡ä»½å·¥å…·éƒ½ä¸ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥å½“ä½ é—®ï¼šæœ‰å¤‡ä»½å—ï¼Ÿå›ç­”ï¼šæ²¡æœ‰æˆ–è€…æ— æ•ˆ</p><p>åœ¨æœ¬æ¬¡æ¡ˆä¾‹ä¸­ï¼ŒæŸå®¢æˆ·æ•°æ®åº“å› å­˜å‚¨ç©ºé—´ä¸å¤Ÿå¯¼è‡´æ•°æ®åº“æœåŠ¡å®•æ‰ï¼Œè€Œå®¢æˆ·åœ¨æ•°æ®åº“å®•æœºåï¼Œåªæ‹·è´äº†å•ä¸ª<code>cy</code>åº“æ‰€å±çš„ç›®å½•è¿›è¡Œäº†æ–‡ä»¶å±‚é¢çš„å¤‡ä»½ï¼Œå°±å°†å…¶ä»–æ–‡ä»¶å…¨éƒ¨æ¸…ç©ºï¼Œå½“ä»–æƒ³é‡æ–°å¯åŠ¨æ•°æ®åº“æ—¶å‘ç°æ•°æ®åº“æœåŠ¡å¯åŠ¨ã€‚MySQLä½¿ç”¨5.7.17ç‰ˆæœ¬ï¼Œä½¿ç”¨innodbå­˜å‚¨å¼•æ“ï¼Œå¼€å¯äº†ç‹¬ç«‹è¡¨ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´å½“å‰çš„æ•‘å‘½ç¨»è‰æ˜¯ï¼šæ¯ä¸ªè¡¨çš„<code>.frm</code>å’Œ<code>.ibd</code>æ–‡ä»¶ã€‚</p><a id="more"></a><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>Cashæ¢å¤çš„æ­£ç¡®æ–¹å¼æ˜¯ï¼š<strong>å¤‡ä»½æ–‡ä»¶ï¼ˆé€»è¾‘æˆ–ç‰©ç†ï¼‰+ binlog</strong>è¿›è¡Œæ¢å¤ï¼›ç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¿ç»´äººå‘˜éƒ½çŸ¥é“æ€ä¹ˆè¿›è¡Œæ­£ç¡®çš„å¤‡ä»½ï¼Œç”šè‡³è¿é€»è¾‘å¤‡ä»½å’Œç‰©ç†å¤‡ä»½çš„åŒºåˆ«æ˜¯ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Ÿæ›´ä¸çŸ¥é“å¤‡ä»½è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘æ•°æ®çš„ä¸€è‡´æ€§ä¸æœåŠ¡å¯ç”¨æ€§çš„é—®é¢˜ï¼Ÿæˆ–è€…è¿å¤‡ä»½å·¥å…·éƒ½ä¸ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥å½“ä½ é—®ï¼šæœ‰å¤‡ä»½å—ï¼Ÿå›ç­”ï¼šæ²¡æœ‰æˆ–è€…æ— æ•ˆ</p><p>åœ¨æœ¬æ¬¡æ¡ˆä¾‹ä¸­ï¼ŒæŸå®¢æˆ·åªå¯¹å•ä¸ª<code>cy</code>åº“æ‰€å±çš„ç›®å½•è¿›è¡Œäº†æ–‡ä»¶å±‚é¢çš„å¤‡ä»½ï¼ŒMySQLä½¿ç”¨5.7.17ç‰ˆæœ¬ï¼Œä½¿ç”¨innodbå­˜å‚¨å¼•æ“ï¼Œå¼€å¯äº†ç‹¬ç«‹è¡¨ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´å½“å‰çš„æ•‘å‘½ç¨»è‰æ˜¯ï¼šæ¯ä¸ªè¡¨çš„<code>.frm</code>å’Œ<code>.ibd</code>æ–‡ä»¶ã€‚</p><h2 id="å¼ºåˆ¶è¿˜åŸæ­¥éª¤"><a href="#å¼ºåˆ¶è¿˜åŸæ­¥éª¤" class="headerlink" title="å¼ºåˆ¶è¿˜åŸæ­¥éª¤"></a>å¼ºåˆ¶è¿˜åŸæ­¥éª¤</h2><table><thead><tr><th>æ­¥éª¤</th><th>æè¿°</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>1</td><td><strong>åˆ›å»ºåŒç‰ˆæœ¬çš„MySQLæœåŠ¡å®ä¾‹ä¸€æš</strong></td><td></td></tr><tr><td>2</td><td><strong>è·å–è¡¨çš„åˆ—æ•°</strong></td><td>å¦‚æœæœ‰ddlå¤‡ä»½ç›´æ¥å¯¼å…¥ï¼Œå¯æƒœéƒ½æ˜¯æ²¡æœ‰çš„ï¼Œå“­ã€‚ã€‚ã€‚</td></tr><tr><td>2.1</td><td>åˆ›å»ºåŒåè¡¨ï¼Œç»“æ„æ— æ‰€è°“</td><td>æ•°æ®åº“çš„ä¸–ç•Œä¹Ÿéœ€è¦èº«ä»½è¯ï¼Œå…ˆé€ ä¸ªäººæ‹¿ä¸Šèº«ä»½è¯ï¼Œè‡³äºäººé•¿å¾—å•¥æ ·å‡ æ¡èƒ³è†Šéƒ½æ— æ‰€è°“ï¼Œåå­—æœ€é‡è¦</td></tr><tr><td>2.2</td><td>åœæœåŠ¡ï¼›ä½¿ç”¨å¤‡ä»½çš„frmæ–‡ä»¶è¦†ç›–å½“å‰çš„frm</td><td>å·æ¢æ¢æŸ±</td></tr><tr><td>2.3</td><td>é…ç½®æ–‡ä»¶æ·»åŠ å¼ºåˆ¶æ¢å¤innodbçš„å‚æ•°ï¼›å¯åŠ¨æœåŠ¡</td><td>è’™è”½å¥¹çš„åŒçœ¼</td></tr><tr><td>2.4</td><td>æŸ¥çœ‹è¡¨ç»“æ„</td><td>æ•°æ®åº“ä¼šæ‹¿ç€èº«ä»½è¯å’Œé¢å‰çš„äººï¼ˆfrmæ–‡ä»¶ï¼‰åšå¯¹æ¯”</td></tr><tr><td>2.5</td><td>æŸ¥çœ‹é”™è¯¯æ—¥å¿—ä¸­å…³äºè¯¥è¡¨çš„æŠ¥é”™</td><td>æ•°æ®åº“å‘ç°èº«ä»½è¯ä¸Šçš„äººåªæœ‰1æ¡èƒ³è†Šï¼Œè€Œè¢«æ£€æŸ¥çš„äººæœ‰10æ¡èƒ³è†Šï¼Œæ˜æ˜¾å¯¹ä¸ä¸Šå•Š</td></tr><tr><td>2.6</td><td>æˆåŠŸè·å–è¡¨çš„çœŸå®åˆ—æ•°ï¼›åˆ é™¤è¿™äº›è¡¨</td><td>é€šè¿‡è­¦å‘Šå¯ä»¥çŸ¥é“åº”è¯¥é€ ä¸€ä¸ªæœ‰10æ¡èƒ³è†Šçš„äºº</td></tr><tr><td>3</td><td><strong>è·å–è¡¨çš„ç»“æ„</strong></td><td></td></tr><tr><td>3.1</td><td>åˆ›å»ºåŒåè¡¨ï¼Œåˆ—æ•°ä¸€è‡´ï¼Œåˆ—åæ— æ‰€è°“</td><td>è¿™ä¸€æ¬¡é€ äººçš„æ—¶å€™ï¼Œé€ ä¸€ä¸ªæœ‰10æ¡èƒ³è†Šçš„ï¼Œæ¯æ¡èƒ³è†Šçš„åå­—æ— æ‰€è°“ï¼Œå…³é”®æ˜¯èº«ä»½è¯ä¸Šé¢çš„äººåå’Œ10æ¡èƒ³è†Š</td></tr><tr><td>3.2</td><td>åœæœåŠ¡ï¼›ä½¿ç”¨å¤‡ä»½çš„frmæ–‡ä»¶è¦†ç›–å½“å‰çš„frm</td><td>å·æ¢æ¢æŸ±</td></tr><tr><td>3.3</td><td>é…ç½®æ–‡ä»¶æ·»åŠ å¼ºåˆ¶æ¢å¤innodbçš„å‚æ•°ï¼›å¯åŠ¨æœåŠ¡</td><td>è’™è”½å¥¹çš„åŒçœ¼</td></tr><tr><td>3.4</td><td>æŸ¥çœ‹è¡¨ç»“æ„</td><td>æ•°æ®åº“ä¼šæ‹¿ç€æ–°çš„èº«ä»½è¯å’Œé¢å‰çš„äººï¼ˆfrmæ–‡ä»¶ï¼‰åšå¯¹æ¯”</td></tr><tr><td>3.5</td><td>æˆåŠŸè·å–è¡¨ç»“æ„</td><td>æ•°æ®åº“å‘ç°èº«ä»½è¯ä¸Šä¿¡æ¯å’Œè¢«æ£€æŸ¥çš„äººä¿¡æ¯ä¸€è‡´ï¼Œåå­—ï¼Œèƒ³è†Šçš„æ•°é‡ï¼Œå¯¹ä¸Šäº†å°±è®¤å¯å•¦ï¼ï¼ˆæ•°æ®åº“åªæ£€æŸ¥è¡¨åå’Œåˆ—çš„ä¸ªæ•°ï¼‰</td></tr><tr><td>4</td><td><strong>å¼ºåˆ¶æ¢å¤è¡¨æ•°æ®</strong></td><td></td></tr><tr><td>4.1</td><td>ä¸¢å¼ƒå½“å‰è¡¨çš„æ•°æ®</td><td>æŠŠè¿™ä¸ªäººçš„äº”è„å…­è…‘éƒ½æŒ–å‡ºæ¥</td></tr><tr><td>4.2</td><td>å°†å¤‡ä»½çš„ibdæ”¾åˆ°å¯¹åº”è·¯å¾„</td><td>å°†ä¹‹å‰å¤‡ä»½çš„åƒäº†è‚‰çš„äº”è„å…­è…‘æ”¾è¿›å»</td></tr><tr><td>4.3</td><td>å¯¼å…¥æ–°çš„æ•°æ®ï¼Œå¦‚æœæ•°æ®åº“åŠ è½½æˆåŠŸåˆ™å¯ä»¥çœ‹åˆ°æ•°æ®ï¼›å¦åˆ™åŠ è½½å¤±è´¥ã€‚</td><td>è·Ÿå¤§è„‘æ±‡æŠ¥ä¸€ä¸‹æ–°çš„äº”è„å…­è…‘å·²ç»å°±ä½å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼›å¦‚æœä½¿ç”¨å¾—æ²¡é—®é¢˜å°±æˆåŠŸï¼›å¦‚æœå™¨å®˜å·²ç»æŸåé‚£ä¹ˆæ‰‹æœ¯å¤±è´¥ã€‚</td></tr></tbody></table><h2 id="è¯¦ç»†è¿‡ç¨‹"><a href="#è¯¦ç»†è¿‡ç¨‹" class="headerlink" title="è¯¦ç»†è¿‡ç¨‹"></a>è¯¦ç»†è¿‡ç¨‹</h2><h3 id="æ•°æ®é‡"><a href="#æ•°æ®é‡" class="headerlink" title="æ•°æ®é‡"></a>æ•°æ®é‡</h3><table><thead><tr><th>æ˜ç»†</th><th>å¤§å°</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>ç‰©ç†æ–‡ä»¶</td><td>174M</td><td></td></tr><tr><td>æ•°æ®åº“</td><td>1ä¸ª</td><td>cy</td></tr><tr><td>è¡¨</td><td>57å¼ </td><td></td></tr></tbody></table><h3 id="æ¢å¤ç»“æœ"><a href="#æ¢å¤ç»“æœ" class="headerlink" title="æ¢å¤ç»“æœ"></a>æ¢å¤ç»“æœ</h3><blockquote><p>åœ¨å®¢æˆ·æœåŠ¡å™¨ä¸Šé¢ç»“æœå¦‚ä¸‹ï¼š</p></blockquote><table><thead><tr><th>æ˜ç»†</th><th>æˆåŠŸ</th><th>å¤±è´¥</th><th>æ¢å¤ç‡</th></tr></thead><tbody><tr><td>è¡¨ç»“æ„</td><td>58</td><td>0</td><td>100%</td></tr><tr><td>è¡¨æ•°æ®</td><td>56</td><td>2</td><td>96%</td></tr></tbody></table><blockquote><p>åœ¨æˆ‘çš„æœåŠ¡å™¨ä¸Šé¢ç»“æœå¦‚ä¸‹ï¼š</p></blockquote><table><thead><tr><th>æ˜ç»†</th><th>æˆåŠŸ</th><th>å¤±è´¥</th><th>æ¢å¤ç‡</th></tr></thead><tbody><tr><td>è¡¨ç»“æ„</td><td>58</td><td>0</td><td>100%</td></tr><tr><td>è¡¨æ•°æ®</td><td>58</td><td>0</td><td>100%</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br></pre></td><td class="code"><pre><span class="line">[root@toberoot mysql]# /alidata/mysql/bin/mysqld --initialize-insecure --datadir=/alidata/mysql/data/  --user=mysql</span><br><span class="line">[root@toberoot mysql]# service mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot mysql]# mysql -V</span><br><span class="line">mysql  Ver 14.14 Distrib 5.7.17, for linux-glibc2.5 (x86_64) using  EditLine wrapper</span><br><span class="line"></span><br><span class="line">[root@toberoot mysql]# cd ~/home/cy02/</span><br><span class="line">[root@toberoot cy02]# ll</span><br><span class="line">total 178140</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9022 Aug 14  2017 base_dict.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Mar 14 15:00 base_dict.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8822 Mar  2 11:14 biz_advise.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 14 14:39 biz_advise.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8850 Mar  2 11:14 biz_bank.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Mar  2 11:14 biz_bank.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9580 Mar  2 11:14 biz.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9286 Mar  2 11:14 biz_gift.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Apr 24 14:08 biz_gift.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8890 Mar  2 11:14 biz_gprs_bind.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8745 Mar  2 11:14 biz_gprs_bind_his.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   180224 May 15 09:40 biz_gprs_bind_his.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql   180224 May 15 09:42 biz_gprs_bind.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 14:33 biz.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8845 Aug 14  2017 biz_msg_template.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 biz_msg_template.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8881 Aug 14  2017 biz_take_bank.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 13 19:26 biz_take_bank.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9411 Nov 24 13:22 biz_take.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   196608 May 15 15:22 biz_take.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8862 Aug 14  2017 biz_take_wwlt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 15:22 biz_take_wwlt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8854 Aug 14  2017 biz_take_wx.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 11:52 biz_take_wx.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8925 Aug 14  2017 biz_vip.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Mar 16 09:31 biz_vip.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8852 Aug 14  2017 biz_wlt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 18:30 biz_wlt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8926 Aug 14  2017 biz_wx_focus.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 10 16:24 biz_wx_focus.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9339 Nov 24 13:25 biz_wx.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 10 16:24 biz_wx.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8874 Aug 14  2017 biz_wx_walt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 biz_wx_walt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8776 Aug 14  2017 cfg_area.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   311296 Aug 14  2017 cfg_area.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8721 Aug 14  2017 cfg_id_gen.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 18:41 cfg_id_gen.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql       61 Aug 14  2017 db.opt</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9053 Aug 14  2017 gprs_model.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   212992 May 15 18:47 gprs_model.ibd</span><br><span class="line">-r--r--r-- 1 mysql mysql 79691776 May 16 14:04 ibdata1</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8801 Dec 19 15:00 mbr_coin_chged.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  2097152 May 15 17:27 mbr_coin_chged.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8766 Dec 19 14:53 mbr_coin.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 19:12 mbr_coin.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9155 May 14 11:55 mbr.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   212992 May 15 20:58 mbr.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8876 Aug 14  2017 mbr_oauth.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   475136 May 15 19:37 mbr_oauth.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9011 Aug 14  2017 mbr_pay.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 mbr_pay.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8740 Aug 14  2017 mbr_prizen.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 mbr_prizen.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9147 Dec 19 14:56 mbr_recharge.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   294912 May 15 19:11 mbr_recharge.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8801 Aug 14  2017 mbr_wallet_chged.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9437184 May 15 17:27 mbr_wallet_chged.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8845 Aug 14  2017 mbr_wallet.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   262144 May 15 19:12 mbr_wallet.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql    10100 Dec 19 15:47 ord.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql 31457280 May 15 18:41 ord.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8940 Aug 14  2017 ord_item.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 ord_item.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8917 Aug 14  2017 ord_pay_ali.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 ord_pay_ali.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8924 Dec 19 15:55 ord_pay_coin.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   475136 May 15 17:27 ord_pay_coin.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8926 Aug 14  2017 ord_pay_return.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 ord_pay_return.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8966 Dec 20 16:50 ord_pay_wlt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9437184 May 15 17:27 ord_pay_wlt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9036 Aug 14  2017 ord_pay_wx.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql 32505856 May 15 18:41 ord_pay_wx.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9098 Aug 14  2017 prod_base_args.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_base_args.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8790 Aug 14  2017 prod_bug_rpt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_bug_rpt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8887 Aug 14  2017 prod_cmd.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_cmd.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8984 Aug 14  2017 prod_cmd_invoke.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_cmd_invoke.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9058 Aug 14  2017 prod_coin_rpt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9437184 May 15 14:24 prod_coin_rpt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8798 Aug 14  2017 prod_coin_rpt_log.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 14:24 prod_coin_rpt_log.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9834 Dec 13 14:12 prod.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8835 Aug 14  2017 prod_gprs_bind.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8793 Aug 14  2017 prod_gprs_bind_his.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   196608 May 15 09:42 prod_gprs_bind_his.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_gprs_bind.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql   425984 May 15 09:42 prod.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8851 Aug 14  2017 prod_instl_imgs.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_instl_imgs.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9388 Dec 13 14:13 prod_instl_pos.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   147456 May 15 16:25 prod_instl_pos.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9384 Dec 13 14:14 prod_instl_pos_model.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   131072 May 15 16:24 prod_instl_pos_model.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8892 Aug 14  2017 prod_mod_attr.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_mod_attr.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8873 Aug 14  2017 prod_mod_attr_val.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_mod_attr_val.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9642 Dec 13 14:11 prod_model.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 11 11:58 prod_model.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8815 Aug 14  2017 prod_mod_sku.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_mod_sku.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9050 Aug 14  2017 prod_onl_log.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   163840 May 15 18:42 prod_onl_log.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9143 Aug 14  2017 prod_sp_args.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_sp_args.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8876 Aug 14  2017 prod_sp_arg_vals.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_sp_arg_vals.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9190 Dec 13 14:14 sys_acct.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 14 11:16 sys_acct.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8776 Aug 14  2017 sys_acct_res.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   229376 May 11 11:52 sys_acct_res.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9106 Aug 14  2017 sys_res.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 sys_res.ibd</span><br><span class="line"><span class="meta">#</span><span class="bash">è·å–å¾…æ¢å¤è¡¨å</span></span><br><span class="line">[root@toberoot cy02]# ll *.frm |awk '&#123;print $9&#125;'|awk -F '.' '&#123;print $1&#125;' &gt; /alidata/cy_table.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> pythonè„šæœ¬è‡ªåŠ¨ç”Ÿæˆå»ºè¡¨è¯­å¥</span></span><br><span class="line">[root@toberoot alidata]# cat py_createtable01.py </span><br><span class="line"><span class="meta">#</span><span class="bash">-*- coding : utf8 -*-</span></span><br><span class="line"></span><br><span class="line">def create_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "create table &#123;&#125; (id int);".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    create_table_test('/alidata/cy_table.txt','/alidata/cy_sql1.sql')</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# python /alidata/py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql1.sql </span><br><span class="line">create table base_dict</span><br><span class="line"> (id int);create table biz_advise</span><br><span class="line"> (id int);create table biz_bank</span><br><span class="line"> (id int);create table biz</span><br><span class="line"> (id int);create table biz_gift</span><br><span class="line"> (id int);create table biz_gprs_bind</span><br><span class="line"> (id int);create table biz_gprs_bind_his</span><br><span class="line"> (id int);create table biz_msg_template</span><br><span class="line"> (id int);create table biz_take_bank</span><br><span class="line"> (id int);create table biz_take</span><br><span class="line">çœç•¥ã€‚ã€‚ã€‚</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å…¥æµ‹è¯•è¡¨ç»“æ„</span></span><br><span class="line">[root@toberoot alidata]# mysql -e "show databases"</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">[root@toberoot alidata]# mysql -e "create database cy;"</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; /alidata/cy_sql1.sql </span><br><span class="line">[root@toberoot alidata]# mysql -e "desc cy.sys_res"</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| Field | Type    | Null | Key | Default | Extra |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| id    | int(11) | YES  |     | NULL    |       |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¼€å§‹è·å–è¡¨ç»“æ„ä¸­åˆ—çš„ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# service mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@toberoot alidata]# yes|cp ~/home/cy02/*.frm /alidata/mysql/data/cy/</span><br><span class="line">cp: overwrite â€˜/alidata/mysql/data/cy/base_dict.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_advise.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_bank.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_gift.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_gprs_bind.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_gprs_bind_his.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_msg_template.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take_bank.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take_wwlt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take_wx.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_vip.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wlt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wx_focus.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wx.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wx_walt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/cfg_area.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/cfg_id_gen.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/gprs_model.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_coin_chged.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_coin.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_oauth.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_pay.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_prizen.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_recharge.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_wallet_chged.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_wallet.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_item.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_ali.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_coin.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_return.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_wlt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_wx.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_base_args.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_bug_rpt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_cmd.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_cmd_invoke.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_coin_rpt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_coin_rpt_log.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_gprs_bind.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_gprs_bind_his.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_instl_imgs.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_instl_pos.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_instl_pos_model.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_mod_attr.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_mod_attr_val.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_model.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_mod_sku.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_onl_log.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_sp_args.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_sp_arg_vals.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/sys_acct.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/sys_acct_res.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/sys_res.frmâ€™? [root@toberoot alidata]# </span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# cat py_createtable01.py </span><br><span class="line"><span class="meta">#</span><span class="bash">-*- coding : utf8 -*-</span></span><br><span class="line"></span><br><span class="line">def create_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "create table &#123;&#125; (id int);".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line">   </span><br><span class="line">def desc_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "desc &#123;&#125;;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close()</span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    #create_table_test('/alidata/cy_table.txt','/alidata/cy_sql1.sql')</span><br><span class="line">    desc_table_test('/alidata/cy_table.txt','/alidata/cy_sql2.sql')</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# python py_createtable01.py</span><br><span class="line">[root@toberoot alidata]# head cy_sql2.sql </span><br><span class="line">desc base_dict</span><br><span class="line">;desc biz_advise</span><br><span class="line">;desc biz_bank</span><br><span class="line">;desc biz</span><br><span class="line">;desc biz_gift</span><br><span class="line">;desc biz_gprs_bind</span><br><span class="line">;desc biz_gprs_bind_his</span><br><span class="line">;desc biz_msg_template</span><br><span class="line">;desc biz_take_bank</span><br><span class="line">;desc biz_take</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆªå–åŒ…å«åˆ—åçš„æŠ¥é”™</span></span><br><span class="line">[root@toberoot alidata]# grep contains  mysql/dataerror.log &gt; cy_error1.log</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠ¥é”™æ ¼å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">2018-05-17T07:58:32.926555Z 3 [Warning] InnoDB: Table cy/base_dict contains 1 user defined columns in InnoDB, but 11 columns in MySQL. Please check INFORMATION_SCHEMA.INNODB_SYS_COLUMNS and http://dev.mysql.com/doc/refman/5.7/en/innodb-troubleshooting.html for how to resolve the issue.</span><br><span class="line">2018-05-17T07:59:03.555492Z 4 [Warning] InnoDB: Table cy/biz_advise contains 1 user defined columns in InnoDB, but 7 columns in MySQL. Please check INFORMATION_SCHEMA.INNODB_SYS_COLUMNS and http://dev.mysql.com/doc/refman/5.7/en/innodb-troubleshooting.html for how to resolve the issue.</span><br><span class="line">2018-05-17T07:59:03.556045Z 4 [Warning] InnoDB: Table cy/biz_bank contains 1 user defined columns in InnoDB, but 7 columns in MySQL. Please check INFORMATION_SCHEMA.INNODB_SYS_COLUMNS and http://dev.mysql.com/doc/refman/5.7/en/innodb-troubleshooting.html for how to resolve the issue.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†è¡¨åå’Œåˆ—æ•°å­˜æ”¾è‡³æ–‡ä»¶ä¸­</span></span><br><span class="line">[root@toberoot alidata]# awk '&#123;print $6,$15&#125;' cy_error1.log | awk -F '/' '&#123;print $2&#125;' &gt; cy_table_col.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ ¹æ®ä»¥ä¸Šè¡¨åå’Œåˆ—æ•°ç”Ÿæˆæ–°çš„æµ‹è¯•è¡¨</span></span><br><span class="line">def create_table_col(table_col_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_col_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    # b_list = ['t1 10','t2 20']</span><br><span class="line">    str_list = []</span><br><span class="line">    for table_col_str in b_list:</span><br><span class="line">        table_col_list = table_col_str.split()</span><br><span class="line">table = table_col_list[0]</span><br><span class="line">col = int(table_col_list[1])</span><br><span class="line">        string = "create table &#123;&#125; (".format(table)</span><br><span class="line">        str_list.append(string)</span><br><span class="line">for i in range(1,col+1):</span><br><span class="line">            if i!=col:</span><br><span class="line">                string = 'id&#123;&#125; int,'.format(i)</span><br><span class="line">    else:</span><br><span class="line">                string = 'id&#123;&#125; int);'.format(i)</span><br><span class="line">            str_list.append(string)</span><br><span class="line">    for line in str_list:</span><br><span class="line">        a_file.write(line)</span><br><span class="line">    a_file.close()</span><br><span class="line"></span><br><span class="line">create_table_col('/alidata/cy_table_col.txt','/alidata/cy_sql3.sql')</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤è¿™äº›æµ‹è¯•è¡¨</span></span><br><span class="line">[root@toberoot alidata]# vim py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# python py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# ll</span><br><span class="line">total 60</span><br><span class="line">-rw-r--r--  1 root  root  16729 May 17 16:00 cy_error1.log</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 15:12 cy_sql1.sql</span><br><span class="line">-rw-r--r--  1 root  root   1047 May 17 15:56 cy_sql2.sql</span><br><span class="line">-rw-r--r--  1 root  root   6353 May 17 16:15 cy_sql3.sql</span><br><span class="line">-rw-r--r--  1 root  root   1395 May 17 16:17 cy_sql4.sql</span><br><span class="line">-rw-r--r--  1 root  root    837 May 17 16:03 cy_table_col.txt</span><br><span class="line">-rw-r--r--  1 root  root    699 May 17 15:56 cy_table.txt</span><br><span class="line">drwxr-xr-x  3 root  root   4096 May 17 12:12 install</span><br><span class="line">drwxr-xr-x 11 mysql mysql  4096 May 17 15:44 mysql</span><br><span class="line">-rw-r--r--  1 root  root   1798 May 17 16:17 py_createtable01.py</span><br><span class="line"><span class="meta">#</span><span class="bash">pythonä»£ç å¦‚ä¸‹ï¼š</span></span><br><span class="line">def drop_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "drop table &#123;&#125;;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close()</span><br><span class="line"></span><br><span class="line">drop_table_test('/alidata/cy_table.txt','/alidata/cy_sql4.sql')</span><br><span class="line">    </span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql4.sql </span><br><span class="line">drop table base_dict</span><br><span class="line">;drop table biz_advise</span><br><span class="line">;drop table biz_bank</span><br><span class="line">;drop table biz</span><br><span class="line">;drop table biz_gift</span><br><span class="line">;drop table biz_gprs_bind</span><br><span class="line">;drop table biz_gprs_bind_his</span><br><span class="line">;drop table biz_msg_template</span><br><span class="line">;drop table biz_take_bank</span><br><span class="line">;drop table biz_take</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ é™¤æ•°æ®åº“çš„æ—¶å€™ç›´æ¥å¡æ­»äº†ï¼ŒåŸå› æœªçŸ¥ã€‚ä¹Ÿæ²¡æœ‰æŠ¥é”™ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash">æ¸…æ•°æ®å¯åŠ¨æœåŠ¡</span></span><br><span class="line"></span><br><span class="line">ln: failed to create symbolic link â€˜/usr/local/mysql/bin/mysqldâ€™: File exists</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot ~]# mysql -e 'create database cy'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¼€å§‹å°è¯•è·å–è¡¨çš„ç»“æ„</span></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql3.sql</span><br><span class="line">[root@toberoot alidata]# service mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@toberoot alidata]# cp ~/home/cy02/*.frm /alidata/mysql/data/cy/ -p</span><br><span class="line">cp: overwrite â€˜/alidata/mysql/data/cy/base_dict.frmâ€™? ^C</span><br><span class="line">[root@toberoot alidata]# yes | cp ~/home/cy02/*.frm /alidata/mysql/data/cy/ -p</span><br><span class="line">[root@toberoot alidata]# ll /alidata/mysql/data/cy/sys_res*</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9106 Aug 14  2017 /alidata/mysql/data/cy/sys_res.frm</span><br><span class="line">-rw-r----- 1 mysql mysql 98304 May 17 16:44 /alidata/mysql/data/cy/sys_res.ibd</span><br><span class="line"><span class="meta">#</span><span class="bash"> é…ç½®æ–‡ä»¶</span></span><br><span class="line">[mysqld]</span><br><span class="line">innodb_force_recovery=6</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# service mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¡¨ç»“æ„æˆåŠŸè·å–</span></span><br><span class="line">[root@toberoot alidata]# mysql cy -e 'desc sys_res'</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type         | Null | Key | Default | Extra |</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">| ID     | varchar(64)  | NO   | PRI | NULL    |       |</span><br><span class="line">| NAME   | varchar(32)  | NO   |     | NULL    |       |</span><br><span class="line">| CODE   | varchar(128) | NO   |     | NULL    |       |</span><br><span class="line">| URI    | varchar(128) | NO   |     | NULL    |       |</span><br><span class="line">| LOGO   | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| TYPE   | int(11)      | NO   |     | NULL    |       |</span><br><span class="line">| PCODE  | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| SORT   | int(11)      | YES  |     | 0       |       |</span><br><span class="line">| STATE  | int(11)      | NO   |     | NULL    |       |</span><br><span class="line">| ADMIN  | int(11)      | YES  |     | 0       |       |</span><br><span class="line">| REMARK | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| CRTIME | datetime     | NO   |     | NULL    |       |</span><br><span class="line">| UPTIME | datetime     | NO   |     | NULL    |       |</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">root@MySQL-01 16:49:  [(none)]&gt; select table_name,table_schema from information_schema.tables where table_schema='cy';</span><br><span class="line">+----------------------+--------------+</span><br><span class="line">| table_name           | table_schema |</span><br><span class="line">+----------------------+--------------+</span><br><span class="line">| base_dict            | cy           |</span><br><span class="line">| biz                  | cy           |</span><br><span class="line">| biz_advise           | cy           |</span><br><span class="line">| biz_bank             | cy           |</span><br><span class="line">| biz_gift             | cy           |</span><br><span class="line">| biz_gprs_bind        | cy           |</span><br><span class="line">| biz_gprs_bind_his    | cy           |</span><br><span class="line">| biz_msg_template     | cy           |</span><br><span class="line">| biz_take             | cy           |</span><br><span class="line">| biz_take_bank        | cy           |</span><br><span class="line">| biz_take_wwlt        | cy           |</span><br><span class="line">| biz_take_wx          | cy           |</span><br><span class="line">| biz_vip              | cy           |</span><br><span class="line">| biz_wlt              | cy           |</span><br><span class="line">| biz_wx               | cy           |</span><br><span class="line">| biz_wx_focus         | cy           |</span><br><span class="line">| biz_wx_walt          | cy           |</span><br><span class="line">| cfg_area             | cy           |</span><br><span class="line">| cfg_id_gen           | cy           |</span><br><span class="line">| gprs_model           | cy           |</span><br><span class="line">| mbr                  | cy           |</span><br><span class="line">| mbr_coin             | cy           |</span><br><span class="line">| mbr_coin_chged       | cy           |</span><br><span class="line">| mbr_oauth            | cy           |</span><br><span class="line">| mbr_pay              | cy           |</span><br><span class="line">| mbr_prizen           | cy           |</span><br><span class="line">| mbr_recharge         | cy           |</span><br><span class="line">| mbr_wallet           | cy           |</span><br><span class="line">| mbr_wallet_chged     | cy           |</span><br><span class="line">| ord                  | cy           |</span><br><span class="line">| ord_item             | cy           |</span><br><span class="line">| ord_pay_ali          | cy           |</span><br><span class="line">| ord_pay_coin         | cy           |</span><br><span class="line">| ord_pay_return       | cy           |</span><br><span class="line">| ord_pay_wlt          | cy           |</span><br><span class="line">| ord_pay_wx           | cy           |</span><br><span class="line">| prod                 | cy           |</span><br><span class="line">| prod_base_args       | cy           |</span><br><span class="line">| prod_bug_rpt         | cy           |</span><br><span class="line">| prod_cmd             | cy           |</span><br><span class="line">| prod_cmd_invoke      | cy           |</span><br><span class="line">| prod_coin_rpt        | cy           |</span><br><span class="line">| prod_coin_rpt_log    | cy           |</span><br><span class="line">| prod_gprs_bind       | cy           |</span><br><span class="line">| prod_gprs_bind_his   | cy           |</span><br><span class="line">| prod_instl_imgs      | cy           |</span><br><span class="line">| prod_instl_pos       | cy           |</span><br><span class="line">| prod_instl_pos_model | cy           |</span><br><span class="line">| prod_mod_attr        | cy           |</span><br><span class="line">| prod_mod_attr_val    | cy           |</span><br><span class="line">| prod_mod_sku         | cy           |</span><br><span class="line">| prod_model           | cy           |</span><br><span class="line">| prod_onl_log         | cy           |</span><br><span class="line">| prod_sp_arg_vals     | cy           |</span><br><span class="line">| prod_sp_args         | cy           |</span><br><span class="line">| sys_acct             | cy           |</span><br><span class="line">| sys_acct_res         | cy           |</span><br><span class="line">| sys_res              | cy           |</span><br><span class="line">+----------------------+--------------+</span><br><span class="line">58 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 58å¼ è¡¨dumpå¤‡ä»½å‡ºæ¥</span></span><br><span class="line">[root@toberoot alidata]# mysqldump -B cy -d &gt; /alidata/new_yc_ddl.sql</span><br><span class="line">[root@toberoot alidata]# tail -n 30 /alidata/new_yc_ddl.sql </span><br><span class="line">/*!40101 SET @saved_cs_client     = @@character_set_client */;</span><br><span class="line">/*!40101 SET character_set_client = utf8 */;</span><br><span class="line">CREATE TABLE `sys_res` (</span><br><span class="line">  `ID` varchar(64) NOT NULL COMMENT 'ID',</span><br><span class="line">  `NAME` varchar(32) NOT NULL COMMENT 'èœå•åç§°',</span><br><span class="line">  `CODE` varchar(128) NOT NULL COMMENT 'èœå•ç¼–ç ',</span><br><span class="line">  `URI` varchar(128) NOT NULL COMMENT 'URI',</span><br><span class="line">  `LOGO` varchar(64) DEFAULT NULL COMMENT 'å›¾æ ‡',</span><br><span class="line">  `TYPE` int(11) NOT NULL COMMENT '@èœå•ç±»å‹ï¼ˆ1èœå•ï¼›2æŒ‰é’®ï¼‰',</span><br><span class="line">  `PCODE` varchar(64) DEFAULT NULL COMMENT 'çˆ¶èœå•',</span><br><span class="line">  `SORT` int(11) DEFAULT '0' COMMENT 'æ’åº',</span><br><span class="line">  `STATE` int(11) NOT NULL COMMENT '@@çŠ¶æ€ï¼ˆ0 æ— æ•ˆï¼›1 æ­£å¸¸ï¼‰',</span><br><span class="line">  `ADMIN` int(11) DEFAULT '0' COMMENT 'æ˜¯å¦ç®¡ç†å‘˜èœå•ï¼ˆé»˜è®¤0å¦ï¼‰',</span><br><span class="line">  `REMARK` varchar(64) DEFAULT NULL COMMENT 'å¤‡æ³¨',</span><br><span class="line">  `CRTIME` datetime NOT NULL COMMENT 'CRTIME',</span><br><span class="line">  `UPTIME` datetime NOT NULL COMMENT 'UPTIME',</span><br><span class="line">  PRIMARY KEY (`ID`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='æƒé™_ç³»ç»Ÿèµ„æº';</span><br><span class="line">/*!40101 SET character_set_client = @saved_cs_client */;</span><br><span class="line">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;</span><br><span class="line"></span><br><span class="line">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;</span><br><span class="line">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;</span><br><span class="line">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;</span><br><span class="line">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;</span><br><span class="line">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;</span><br><span class="line">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;</span><br><span class="line">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;</span><br><span class="line"></span><br><span class="line">-- Dump completed on 2018-05-17 16:52:28</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> discardå’Œimportå‘½ä»¤</span></span><br><span class="line">def discard_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "alter table &#123;&#125; discard tablespace;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def import_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "alter table &#123;&#125; import tablespace;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">discard_table_test('/alidata/cy_table.txt','/alidata/cy_sql5.sql')</span><br><span class="line">import_table_test('/alidata/cy_table.txt','/alidata/cy_sql6.sql')</span><br><span class="line">   </span><br><span class="line"><span class="meta">#</span><span class="bash"> ç”Ÿæˆsql</span></span><br><span class="line">[root@toberoot alidata]# python py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# ll</span><br><span class="line">total 124</span><br><span class="line">-rw-r--r--  1 root  root  16729 May 17 16:00 cy_error1.log</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 15:12 cy_sql1.sql</span><br><span class="line">-rw-r--r--  1 root  root   1047 May 17 15:56 cy_sql2.sql</span><br><span class="line">-rw-r--r--  1 root  root   6353 May 17 16:15 cy_sql3.sql</span><br><span class="line">-rw-r--r--  1 root  root   1395 May 17 16:17 cy_sql4.sql</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 16:55 cy_sql5.sql</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 16:55 cy_sql6.sql</span><br><span class="line">-rw-r--r--  1 root  root    837 May 17 16:03 cy_table_col.txt</span><br><span class="line">-rw-r--r--  1 root  root    699 May 17 15:56 cy_table.txt</span><br><span class="line">drwxr-xr-x  3 root  root   4096 May 17 16:41 install</span><br><span class="line">drwxr-xr-x 11 mysql mysql  4096 May 17 16:47 mysql</span><br><span class="line">-rw-r--r--  1 root  root  57068 May 17 16:52 new_yc_ddl.sql</span><br><span class="line">-rw-r--r--  1 root  root   2489 May 17 16:55 py_createtable01.py</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql5.sql </span><br><span class="line">alter table base_dict</span><br><span class="line"> discard tablespace;alter table biz_advise</span><br><span class="line"> discard tablespace;alter table biz_bank</span><br><span class="line"> discard tablespace;alter table biz</span><br><span class="line"> discard tablespace;alter table biz_gift</span><br><span class="line"> discard tablespace;alter table biz_gprs_bind</span><br><span class="line"> discard tablespace;alter table biz_gprs_bind_his</span><br><span class="line"> discard tablespace;alter table biz_msg_template</span><br><span class="line"> discard tablespace;alter table biz_take_bank</span><br><span class="line"> discard tablespace;alter table biz_take</span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql6.sql </span><br><span class="line">alter table base_dict</span><br><span class="line"> import tablespace;alter table biz_advise</span><br><span class="line"> import tablespace;alter table biz_bank</span><br><span class="line"> import tablespace;alter table biz</span><br><span class="line"> import tablespace;alter table biz_gift</span><br><span class="line"> import tablespace;alter table biz_gprs_bind</span><br><span class="line"> import tablespace;alter table biz_gprs_bind_his</span><br><span class="line"> import tablespace;alter table biz_msg_template</span><br><span class="line"> import tablespace;alter table biz_take_bank</span><br><span class="line"> import tablespace;alter table biz_take</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql</span><br><span class="line">ERROR 1036 (HY000) at line 1: Table 'base_dict' is read only</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# service mysqld restart</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# cp /root/home/cy02/*.ibd /alidata/mysql/data/cy/ -rp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line">ERROR 2013 (HY000) at line 1: Lost connection to MySQL server during query</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# service mysqld restart</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line">ERROR 1036 (HY000) at line 1: Table 'base_dict' is read only</span><br><span class="line">[root@toberoot alidata]# service mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@toberoot alidata]# rm -rf /alidata/mysql/data/*</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# service mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot alidata]# mysql &lt; new_yc_ddl.sql </span><br><span class="line">[root@toberoot alidata]# mysql -e 'use cy;select * from sys_res'</span><br><span class="line"></span><br><span class="line">å¼€å¯å¼ºåˆ¶æ¢å¤å‚æ•°</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql</span><br><span class="line">cy_sql1.sql  cy_sql2.sql  cy_sql3.sql  cy_sql4.sql  cy_sql5.sql  cy_sql6.sql  </span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql </span><br><span class="line">[root@toberoot alidata]# cp /root/home/cy02/*.ibd /alidata/mysql/data/cy/ -rp</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å…¨å¤‡ä»½æ•°æ®</span></span><br><span class="line">[root@toberoot alidata]# mysqldump -B cy &gt; new_cy_all.sql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å¤‡ä»½çš„æ•°æ®é‡</span></span><br><span class="line">-rw-r--r--  1 root  root   26M May 17 17:13 new_cy_all.sql</span><br></pre></td></tr></table></figure><h2 id="æŠ¥é”™æ±‡æ€»"><a href="#æŠ¥é”™æ±‡æ€»" class="headerlink" title="æŠ¥é”™æ±‡æ€»"></a>æŠ¥é”™æ±‡æ€»</h2><h3 id="ERROR-1036-ï¼ˆHY00ï¼‰"><a href="#ERROR-1036-ï¼ˆHY00ï¼‰" class="headerlink" title="ERROR 1036 ï¼ˆHY00ï¼‰"></a>ERROR 1036 ï¼ˆHY00ï¼‰</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql</span><br><span class="line">ERROR 1036 (HY000) at line 1: Table 'base_dict' is read only</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•ï¼š</p><ol><li>æ£€æŸ¥æ˜¯å¦é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨innodb_force_recoveryå‚æ•°</li><li>å¦‚æœå­˜åœ¨å»é™¤æˆ–æ³¨é‡Šæ‰ï¼Œé‡å¯æœåŠ¡å³å¯</li><li>è¿˜ä¸è¡Œå°±æ¸…ç©ºæ•°æ®åº“å¯¼å…¥ç»“æ„åå†ç»§ç»­</li></ol><h3 id="ERROR-2013-HY000"><a href="#ERROR-2013-HY000" class="headerlink" title="ERROR 2013 (HY000)"></a>ERROR 2013 (HY000)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line">ERROR 2013 (HY000) at line 1: Lost connection to MySQL server during query</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•ï¼š</p><ol><li><p>sqlè„šæœ¬ä¸­æ‰§è¡Œimport tablespaceçš„æ“ä½œéœ€è¦å¼€å¯recoveryçš„å‚æ•°</p></li><li><p>é‡å¯æœåŠ¡ </p><p>åœ¨å®¢æˆ·æœåŠ¡ä¸Šï¼Œæ‰§è¡Œä»¥ä¸Šæ“ä½œè¿˜æ˜¯æŠ¥é”™æ— æ³•è¿æ¥ï¼Œå°è¯•å¤šæ¬¡éƒ½ä¸è¡Œã€‚</p></li></ol><p><img src="MySQL%E4%B8%80%E6%AC%A1%E6%83%8A%E5%BF%83%E5%8A%A8%E9%AD%84%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%BC%BA%E5%88%B6%E6%81%A2%E5%A4%8D/04.jpg" alt=""></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ¬¡caseçš„æ•™è®­å°±æ˜¯ï¼Œå¤‡ä»½ï¼ä¸€å®šè¦æœ‰å‘¨æœŸæ€§çš„æœ‰æ•ˆå¤‡ä»½ï¼</p><p>æ¬ºéª—MySQLè¿›ç¨‹è’™æ··è¿‡å…³åªèƒ½æ˜¯æ²¡åŠæ³•çš„åŠæ³•ï¼Œè€Œä¸”ä¸èƒ½ä¿è¯æˆåŠŸç‡ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -*- coding : utf8 -*-</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> py_createtable01.py</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> authï¼š booboowei</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class mysql_tools():</span><br><span class="line">    def __init__(self, in_file):</span><br><span class="line">        self.b_list = open(in_file).readlines()</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">    def create_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "create table &#123;&#125; (id int);".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def desc_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "desc &#123;&#125;;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def create_table_col(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        str_list = []</span><br><span class="line">        for table_col_str in self.b_list:</span><br><span class="line">            table_col_list = table_col_str.split()</span><br><span class="line">            table = table_col_list[0]</span><br><span class="line">            col = int(table_col_list[1])</span><br><span class="line">            string = "create table &#123;&#125; (".format(table)</span><br><span class="line">            str_list.append(string)</span><br><span class="line">            for i in range(1, col + 1):</span><br><span class="line">                if i != col:</span><br><span class="line">                    string = 'id&#123;&#125; int,'.format(i)</span><br><span class="line">                else:</span><br><span class="line">                    string = 'id&#123;&#125; int);'.format(i)</span><br><span class="line">                str_list.append(string)</span><br><span class="line">        for line in str_list:</span><br><span class="line">            a_file.write(line)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def drop_table_test(self,  sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "drop table &#123;&#125;;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def discard_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "alter table &#123;&#125; discard tablespace;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def import_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "alter table &#123;&#125; import tablespace;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').create_table_test('/alidata/cy_sql1.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').desc_table_test('/alidata/cy_sql2.sql')</span><br><span class="line">    # æ ¹æ®ä»¥ä¸Šè¡¨åå’Œåˆ—æ•°ç”Ÿæˆæ–°çš„æµ‹è¯•è¡¨</span><br><span class="line">    mysql_tools('/alidata/cy_table_col.txt').create_table_col('/alidata/cy_sql3.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').drop_table_test('/alidata/cy_sql4.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').discard_table_test('/alidata/cy_sql5.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').import_table_test('/alidata/cy_sql6.sql')</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦ï¼šCashæ¢å¤çš„æ­£ç¡®æ–¹å¼æ˜¯ï¼š&lt;strong&gt;å¤‡ä»½æ–‡ä»¶ï¼ˆé€»è¾‘æˆ–ç‰©ç†ï¼‰+ binlog&lt;/strong&gt;è¿›è¡Œæ¢å¤ï¼›ç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¿ç»´äººå‘˜éƒ½çŸ¥é“æ€ä¹ˆè¿›è¡Œæ­£ç¡®çš„å¤‡ä»½ï¼Œç”šè‡³è¿é€»è¾‘å¤‡ä»½å’Œç‰©ç†å¤‡ä»½çš„åŒºåˆ«æ˜¯ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Ÿæ›´ä¸çŸ¥é“å¤‡ä»½è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘æ•°æ®çš„ä¸€è‡´æ€§ä¸æœåŠ¡å¯ç”¨æ€§çš„é—®é¢˜ï¼Ÿæˆ–è€…è¿å¤‡ä»½å·¥å…·éƒ½ä¸ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥å½“ä½ é—®ï¼šæœ‰å¤‡ä»½å—ï¼Ÿå›ç­”ï¼šæ²¡æœ‰æˆ–è€…æ— æ•ˆ&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬æ¬¡æ¡ˆä¾‹ä¸­ï¼ŒæŸå®¢æˆ·æ•°æ®åº“å› å­˜å‚¨ç©ºé—´ä¸å¤Ÿå¯¼è‡´æ•°æ®åº“æœåŠ¡å®•æ‰ï¼Œè€Œå®¢æˆ·åœ¨æ•°æ®åº“å®•æœºåï¼Œåªæ‹·è´äº†å•ä¸ª&lt;code&gt;cy&lt;/code&gt;åº“æ‰€å±çš„ç›®å½•è¿›è¡Œäº†æ–‡ä»¶å±‚é¢çš„å¤‡ä»½ï¼Œå°±å°†å…¶ä»–æ–‡ä»¶å…¨éƒ¨æ¸…ç©ºï¼Œå½“ä»–æƒ³é‡æ–°å¯åŠ¨æ•°æ®åº“æ—¶å‘ç°æ•°æ®åº“æœåŠ¡å¯åŠ¨ã€‚MySQLä½¿ç”¨5.7.17ç‰ˆæœ¬ï¼Œä½¿ç”¨innodbå­˜å‚¨å¼•æ“ï¼Œå¼€å¯äº†ç‹¬ç«‹è¡¨ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´å½“å‰çš„æ•‘å‘½ç¨»è‰æ˜¯ï¼šæ¯ä¸ªè¡¨çš„&lt;code&gt;.frm&lt;/code&gt;å’Œ&lt;code&gt;.ibd&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯å¹¿è§’" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="æ•°æ®æ•‘æ´" scheme="http://www.toberoot.com/tags/%E6%95%B0%E6%8D%AE%E6%95%91%E6%8F%B4/"/>
    
  </entry>
  
  <entry>
    <title>MySQLçš„å…ƒé”MDLå‘ç”Ÿåœºæ™¯å’Œè§£å†³æ–¹æ³•æ€»ç»“</title>
    <link href="http://www.toberoot.com/2017/08/19/booboo_others/MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/"/>
    <id>http://www.toberoot.com/2017/08/19/booboo_others/MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/</id>
    <published>2017-08-18T20:06:27.000Z</published>
    <updated>2020-03-22T08:32:42.577Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦ï¼šMetaData Lockå³å…ƒæ•°æ®é”ï¼Œåœ¨æ•°æ®åº“ä¸­å…ƒæ•°æ®å³æ•°æ®å­—å…¸ä¿¡æ¯åŒ…æ‹¬db,table,function,procedure,trigger,eventç­‰ã€‚metadata lockä¸»è¦ä¸ºäº†ä¿è¯å…ƒæ•°æ®çš„ä¸€è‡´æ€§,ç”¨äºå¤„ç†ä¸åŒçº¿ç¨‹æ“ä½œåŒä¸€æ•°æ®å¯¹è±¡çš„åŒæ­¥ä¸äº’æ–¥é—®é¢˜ã€‚</p><p>ä»Šå¤©æœ‰å®¢æˆ·(MySQL 5.6)é‡åˆ°è¯¥é—®é¢˜ï¼Œæœ€å…³é”®çš„æ˜¯å±äºç¬¬ä¸‰ç§æƒ…å†µï¼Œgoogleä¸Šæ ¹æœ¬æ‰¾ä¸åˆ°ç±»ä¼¼çš„æ•…éšœæ¡ˆä¾‹ï¼Œå”¯ä¸€ä¸€ä¸ªéå¸¸æ¥è¿‘çš„æ•…éšœæ¡ˆä¾‹ä¸­æ•°æ®åº“ç‰ˆæœ¬å´ä¸åŒï¼ˆå…·ä½“çœ‹ä¸‹æ–‡æ…¢æ…¢èŠï¼‰ï¼Œå“ï¼Œå›°éš¾é‡é‡å•Šï¼Œæœ€ç»ˆè¿˜æ˜¯è§£å†³äº†å“ˆã€‚</p><p>alter tableçš„è¯­å¥æ˜¯å¾ˆå±é™©çš„ï¼Œåœ¨æ“ä½œä¹‹å‰æœ€å¥½ç¡®è®¤å¯¹è¦æ“ä½œçš„è¡¨æ²¡æœ‰ä»»ä½•è¿›è¡Œä¸­çš„æ“ä½œã€æ²¡æœ‰æœªæäº¤äº‹åŠ¡ã€ä¹Ÿæ²¡æœ‰æ˜¾å¼äº‹åŠ¡ä¸­çš„æŠ¥é”™è¯­å¥ã€‚å¦‚æœæœ‰alter tableçš„ç»´æŠ¤ä»»åŠ¡ï¼Œåœ¨æ— äººç›‘ç®¡çš„æ—¶å€™è¿è¡Œï¼Œæœ€å¥½é€šè¿‡lock_wait_timeoutè®¾ç½®å¥½è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´çš„metedataé”ç­‰å¾…ã€‚</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯metadata-lockï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯metadata-lockï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯metadata lockï¼Ÿ"></a>ä»€ä¹ˆæ˜¯metadata lockï¼Ÿ</h2><p>MetaData Lockå³å…ƒæ•°æ®é”ï¼Œåœ¨æ•°æ®åº“ä¸­å…ƒæ•°æ®å³æ•°æ®å­—å…¸ä¿¡æ¯åŒ…æ‹¬db,table,function,procedure,trigger,eventç­‰ã€‚metadata lockä¸»è¦ä¸ºäº†ä¿è¯å…ƒæ•°æ®çš„ä¸€è‡´æ€§,ç”¨äºå¤„ç†ä¸åŒçº¿ç¨‹æ“ä½œåŒä¸€æ•°æ®å¯¹è±¡çš„åŒæ­¥ä¸äº’æ–¥é—®é¢˜ã€‚</p><h3 id="MetaData-Lockçš„å‰ä¸–ä»Šç”Ÿ"><a href="#MetaData-Lockçš„å‰ä¸–ä»Šç”Ÿ" class="headerlink" title="MetaData Lockçš„å‰ä¸–ä»Šç”Ÿ"></a><strong>MetaData Lockçš„å‰ä¸–ä»Šç”Ÿ</strong></h3><p>MDLé”æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªæœ‰åçš„<a href="https://bugs.mysql.com/bug.php?id=989" target="_blank" rel="noopener">bug#989</a>ï¼Œæ‰€ä»¥åœ¨5.5.3ç‰ˆæœ¬å¼•å…¥äº†MDLé”ã€‚å…¶å®5.5ä¹Ÿæœ‰ç±»ä¼¼ä¿æŠ¤å…ƒæ•°æ®çš„æœºåˆ¶ï¼Œåªæ˜¯æ²¡æœ‰æ˜ç¡®æå‡ºMDLæ¦‚å¿µè€Œå·²ã€‚ä½†æ˜¯5.5ä¹‹å‰ç‰ˆæœ¬(æ¯”å¦‚5.1)ä¸5.5ä¹‹åç‰ˆæœ¬åœ¨ä¿æŠ¤å…ƒæ•°æ®è¿™å—æœ‰ä¸€ä¸ªæ˜¾è‘—çš„ä¸åŒç‚¹æ˜¯ï¼Œ5.1å¯¹äºå…ƒæ•°æ®çš„ä¿æŠ¤æ˜¯è¯­å¥çº§åˆ«çš„ï¼Œ5.5å¯¹äºmetadataçš„ä¿æŠ¤æ˜¯äº‹åŠ¡çº§åˆ«çš„ã€‚æ‰€è°“è¯­å¥çº§åˆ«ï¼Œå³è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œæ— è®ºäº‹åŠ¡æ˜¯å¦æäº¤æˆ–å›æ»šï¼Œå…¶è¡¨ç»“æ„å¯ä»¥è¢«å…¶ä»–ä¼šè¯æ›´æ–°ï¼›è€Œäº‹åŠ¡çº§åˆ«åˆ™æ˜¯åœ¨äº‹åŠ¡ç»“æŸåæ‰é‡Šæ”¾MDLã€‚å¼•å…¥MDLé”ä¸»è¦æ˜¯ä¸ºäº†<strong>è§£å†³ä¸¤ä¸ªé—®é¢˜</strong>ï¼š</p><ul><li>äº‹åŠ¡éš”ç¦»é—®é¢˜ï¼šæ¯”å¦‚åœ¨å¯é‡å¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¼šè¯Aåœ¨2æ¬¡æŸ¥è¯¢æœŸé—´ï¼Œä¼šè¯Bå¯¹è¡¨ç»“æ„åšäº†ä¿®æ”¹ï¼Œä¸¤æ¬¡æŸ¥è¯¢ç»“æœå°±ä¼šä¸ä¸€è‡´ï¼Œæ— æ³•æ»¡è¶³å¯é‡å¤è¯»çš„è¦æ±‚ã€‚</li><li>æ•°æ®å¤åˆ¶é—®é¢˜ï¼šæ¯”å¦‚ä¼šè¯Aæ‰§è¡Œäº†å¤šæ¡æ›´æ–°è¯­å¥æœŸé—´ï¼Œå¦å¤–ä¸€ä¸ªä¼šè¯Båšäº†è¡¨ç»“æ„å˜æ›´å¹¶ä¸”å…ˆæäº¤ï¼Œå°±ä¼šå¯¼è‡´slaveåœ¨é‡åšæ—¶ï¼Œå…ˆé‡åšalterï¼Œå†é‡åšupdateæ—¶å°±ä¼šå‡ºç°å¤åˆ¶é”™è¯¯çš„ç°è±¡ã€‚ä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„<a href="https://bugs.mysql.com/bug.php?id=989" target="_blank" rel="noopener">bug#989</a>ã€‚</li></ul><hr><h3 id="DDLæ“ä½œä¸MetaData-Lock"><a href="#DDLæ“ä½œä¸MetaData-Lock" class="headerlink" title="DDLæ“ä½œä¸MetaData Lock"></a>DDLæ“ä½œä¸MetaData Lock</h3><ul><li>metadata lock æœºåˆ¶æ˜¯ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§å­˜åœ¨çš„ï¼Œåœ¨æœ‰äº‹åŠ¡çš„æ“ä½œæ—¶å€™ï¼Œéœ€è¦é¦–å…ˆè·å¾—metadata lock ,ç„¶åæ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ï¼Œåˆæ¥äº†ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè¦ddlæ“ä½œåŒä¸€ä¸ªè¡¨ï¼Œå°±ä¼šå‡ºç° metadata lockã€‚</li><li>è‡ªåŠ¨æäº¤æ¨¡å¼ä¸‹ï¼Œå•è¯­å¥å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰§è¡Œå®Œäº†ï¼Œäº‹åŠ¡ä¹Ÿå°±ç»“æŸäº†ã€‚</li><li>preparestatement  ä¼šè·å¾— metalockï¼Œä¸€æ—¦prepare å®Œæ¯•ï¼Œ metalock å°±é‡Šæ”¾äº†ã€‚</li><li>online DDLåº”è¯¥æ˜¯æŒ‡åœ¨alter tableè¿›è¡Œçš„æ—¶å€™ï¼Œ æ’å…¥/ä¿®æ”¹/åˆ é™¤æ•°æ®çš„sqlè¯­å¥ä¸ä¼šWaiting for table metadata lockã€‚ä¸€æ—¦alter table TableAçš„æ“ä½œåœæ»åœ¨Waiting for table metadata lockçš„çŠ¶æ€ï¼Œåç»­å¯¹TableAçš„ä»»ä½•æ“ä½œï¼ˆåŒ…æ‹¬è¯»ï¼‰éƒ½æ— æ³•è¿›è¡Œï¼Œä¹Ÿä¼šåœ¨Opening tablesçš„é˜¶æ®µè¿›å…¥Waiting for table metadata lockçš„é˜Ÿåˆ—ã€‚</li></ul><h2 id="Alter-table-ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯"><a href="#Alter-table-ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯" class="headerlink" title="Alter table ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯"></a>Alter table ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯</h2><h3 id="åœºæ™¯1"><a href="#åœºæ™¯1" class="headerlink" title="åœºæ™¯1"></a>åœºæ™¯1</h3><ul><li>ä¼šè¯Aå¯¹boobooè¡¨æ‰§è¡Œè¯»æ“ä½œ<code>select *,sleep(60) from booboo;</code>ï¼Œæ­£åœ¨è¿›è¡Œæœªæäº¤äº‹åŠ¡</li><li>ä¼šè¯Bå¯¹boobooè¡¨æ‰§è¡Œåœ¨çº¿DDLæ“ä½œ<code>alter table booboo add q4 int default 0;</code></li><li>ä¼šè¯Cå¯¹boobooè¡¨æ‰§è¡Œéšå¼è¯»æ“ä½œ<code>select *,sleep(60) from booboo;</code>,è¿›è¡Œç­‰å¾…</li><li>ä¼šè¯Då¯¹boobooè¡¨æ‰§è¡Œæ˜¾ç¤ºè¯»æ“ä½œ<code>begin;select * from booboo;</code>ä¹Ÿä¼šè¿›è¡Œç­‰å¾…</li><li>é€šè¿‡<code>show processlist</code>å¯ä»¥çœ‹åˆ°ä¼šè¯Aï¼ˆå¯¹boobooè¡¨ä¸Šæ­£åœ¨è¿›è¡Œçš„æ“ä½œï¼‰ï¼Œæ­¤æ—¶ä¼šè¯Bï¼ˆalter tableè¯­å¥ï¼‰æ— æ³•è·å–åˆ°metadata ç‹¬å é”ï¼Œä¼šè¿›è¡Œç­‰å¾…ï¼Œä¼šè¯Cå’Œä¼šè¯Déƒ½ä¼šè¿›è¡Œç­‰å¾…ï¼Œä¸”èƒ½ä»processlistè¡¨ä¸­çœ‹åˆ°å¯¹boobooè¡¨çš„æ“ä½œ</li><li>ä¼šè¯Aæäº¤äº‹åŠ¡åæˆ–killä¹‹åï¼Œä¼šè¯Cäº‹åŠ¡ç»“æŸï¼Œä¼šè¯D<code>select</code>è¯­å¥æ‰§è¡ŒæˆåŠŸï¼Œäº‹åŠ¡æäº¤åˆ™ä¼šè¯Bå¯æ‰§è¡Œï¼Œå¦åˆ™è¿›å…¥åœºæ™¯2</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;</span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |  167 | Waiting for table metadata lock | alter table booboo add q4 int default 0 |</span><br><span class="line">|  7 | root | localhost | uplooking | Query   |  155 | Waiting for table metadata lock | select * from booboo                    |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">|  9 | root | localhost | uplooking | Query   |  181 | User sleep                      | select *,sleep(60) from booboo          |</span><br><span class="line">| 10 | root | localhost | uplooking | Query   |    7 | Waiting for table metadata lock | select * from booboo                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> id=9çš„çº¿ç¨‹ä¸ºä¼šè¯A è™½ç„¶æ˜¯éšå¼äº‹åŠ¡ï¼Œä½†æ˜¯æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œæ‰€ä»¥ä¸ºæœªæäº¤çš„äº‹åŠ¡</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> id=6çš„çº¿ç¨‹ä¸ºä¼šè¯B åœ¨ä¼šè¯Aæœ‰äº‹åŠ¡æœªæäº¤çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡ŒAlteræ“ä½œ,äº‰æŠ¢metadata lock</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> id=7çš„çº¿ç¨‹ä¸ºä¼šè¯C éšå¼æŸ¥è¯¢äº‹åŠ¡ä¹Ÿä¼šè¿›å…¥ç­‰å¾…</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> id=10çš„çº¿ç¨‹ä¸ºä¼šè¯D æ˜¾ç¤ºæŸ¥è¯¢äº‹åŠ¡åŒæ ·è¿›å…¥ç­‰å¾…</span></span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹metadatalock</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ç¬¬ä¸€ç§æƒ…å†µï¼Œåˆ™å®šä½åˆ°é•¿æ—¶é—´æœªæäº¤çš„äº‹åŠ¡killå³å¯</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥è¯¢ information_schema.innodb_trx çœ‹åˆ°æœ‰é•¿æ—¶é—´æœªå®Œæˆçš„äº‹åŠ¡ï¼Œ ä½¿ç”¨ <span class="built_in">kill</span> å‘½ä»¤ç»ˆæ­¢è¯¥æŸ¥è¯¢ã€‚</span></span><br><span class="line"></span><br><span class="line">select concat('kill ',i.trx_mysql_thread_id,';') from information_schema.innodb_trx i,</span><br><span class="line">  (select </span><br><span class="line">         id, time</span><br><span class="line">     from</span><br><span class="line">         information_schema.processlist</span><br><span class="line">     where</span><br><span class="line">         time = (select </span><br><span class="line">                 max(time)</span><br><span class="line">             from</span><br><span class="line">                 information_schema.processlist</span><br><span class="line">             where</span><br><span class="line">                 state = 'Waiting for table metadata lock'</span><br><span class="line">                     and substring(info, 1, 5) in ('alter' , 'optim', 'repai', 'lock ', 'drop ', 'creat'))) p</span><br><span class="line">  where timestampdiff(second, i.trx_started, now()) &gt; p.time</span><br><span class="line">  and i.trx_mysql_thread_id  not in (connection_id(),p.id);</span><br></pre></td></tr></table></figure><h3 id="åœºæ™¯2"><a href="#åœºæ™¯2" class="headerlink" title="åœºæ™¯2"></a>åœºæ™¯2</h3><ul><li>é€šè¿‡<code>show processlist</code>çœ‹ä¸åˆ°boobooä¸Šæœ‰ä»»ä½•æ“ä½œï¼Œä½†å®é™…ä¸Šå­˜åœ¨æœ‰æœªæäº¤çš„äº‹åŠ¡ï¼Œå¯ä»¥åœ¨<code>information_schema.innodb_trx</code>ä¸­æŸ¥çœ‹åˆ°ã€‚åœ¨äº‹åŠ¡æ²¡æœ‰å®Œæˆä¹‹å‰ï¼Œboobooçš„é”ä¸ä¼šé‡Šæ”¾ï¼Œalter tableåŒæ ·è·å–ä¸åˆ°metadataçš„ç‹¬å é”</li><li>ä¼šè¯Dæäº¤äº‹åŠ¡æˆ–å›æ»šæˆ–killï¼Œåˆ™ä¼šè¯Bä¸­çš„Alterå¯ç»§ç»­æ‰§è¡Œ</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœ¨åœºæ™¯1çš„åŸºç¡€ä¸Šï¼Œå°†ä¼šè¯Açš„äº‹åŠ¡å®Œæˆæˆ–è€…<span class="built_in">kill</span>æ‰ï¼Œä¼šè¯Cæ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯ä¼šè¯Bå’Œä¼šè¯Dç»§ç»­è¿›å…¥metadataé”çš„ç­‰å¾…ã€‚åŸå› æ˜¯ä¼šè¯Dè™½ç„¶selectå¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯äº‹åŠ¡æ²¡æœ‰æäº¤ï¼Œåˆ™è¡¨ä¸Šçš„metadataé”è¿˜å­˜åœ¨ï¼Œå¯¼è‡´ä¼šè¯Bçš„ddlæ“ä½œæ— æ³•æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¼šè¯Bå’Œä¼šè¯Dï¼Œæƒ…å†µ1ï¼šçŸ¥é“æœ‰æœªå®Œæˆçš„äº‹åŠ¡Dï¼Œåˆ™ç»“æŸä¼šè¯Dçš„äº‹åŠ¡ï¼Œä¼šè¯Bæ­£å¸¸æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¼šè¯Bå’Œä¼šè¯Dï¼Œæƒ…å†µ2ï¼šä¸çŸ¥é“æœ‰æœªç»“æŸçš„äº‹åŠ¡Dï¼Œå¦‚ä½•æ’é”™å‘¢ï¼Ÿ</span></span><br><span class="line">=================================</span><br><span class="line"></span><br><span class="line">-- è¯·æ ¹æ®å…·ä½“çš„æƒ…æ™¯ä¿®æ”¹æŸ¥è¯¢è¯­å¥</span><br><span class="line">-- å¦‚æœå¯¼è‡´é˜»å¡çš„è¯­å¥çš„ç”¨æˆ·ä¸å½“å‰ç”¨æˆ·ä¸åŒï¼Œè¯·ä½¿ç”¨å¯¼è‡´é˜»å¡çš„è¯­å¥çš„ç”¨æˆ·ç™»å½•æ¥ç»ˆæ­¢ä¼šè¯</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># åœºæ™¯2çš„æƒ…å†µï¼Œæ˜¯åœ¨åœºæ™¯1çš„åŸºç¡€ä¸Šï¼Œè¿˜æ˜¯æœ‰metadatalocké”ï¼ˆ*ä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒä¸ä¼šåœæœåŠ¡ï¼Œå› æ­¤ä¸åœçš„æœ‰æ–°çš„queryå‘é€è¿‡æ¥ï¼Œå°±ä¼šå‡ºç°åœºæ™¯2*ï¼‰ï¼Œåˆ™æ‰‹åŠ¨ç»§ç»­killæ‰é•¿äº‹åŠ¡å³å¯ï¼Œæ³¨æ„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰å¯èƒ½ddlæ“ä½œéœ€è¦ä¿ç•™ï¼ˆ*ä¾‹å¦‚MDLé”å‡ºç°åœ¨ä¸»ä»åŒæ­¥çš„ä»ä¸­ï¼Œä»åº“éœ€è¦å»æ‰§è¡Œä¸»å‘é€çš„è¡¨å˜æ›´ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥å…ˆå°†ä¸»ä»åœæ‰ï¼Œæ‰‹åŠ¨æ‰§è¡Œalteræ“ä½œï¼Œéƒ½å¯ä»¥*ï¼‰ä»¥ä¸‹æ–¹æ³•æ˜¯åœ¨åœæ­¢å¯¹ä»åº“çš„è¯»æ“ä½œåï¼Œå°†éddlçš„è¿æ¥killæ‰</span></span></span><br><span class="line"></span><br><span class="line">select id,State,command from information_schema.processlist where State="Waiting for table metadata lock";</span><br><span class="line">select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx  where trx_mysql_thread_id=id;</span><br><span class="line">show processlist;</span><br><span class="line">select  concat('kill ',trx_mysql_thread_id,';') from information_schema.processlist,information_schema.innodb_trx  where trx_mysql_thread_id=id and State!="Waiting for table metadata lock";</span><br><span class="line"></span><br><span class="line">===============================</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;                                                                                                             </span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |  275 | Waiting for table metadata lock | alter table booboo add q6 int default 0 |</span><br><span class="line">|  7 | root | localhost | uplooking | Sleep   |  269 |                                 | NULL                                    |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">| 10 | root | localhost | uplooking | Sleep   |  249 |                                 | NULL                                    |</span><br><span class="line">| 12 | root | localhost | uplooking | Sleep   |  191 |                                 | NULL                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å½“å‰è¿›ç¨‹å‘ç°é™¤äº†Alterä¹‹å¤–æ²¡æœ‰å¯¹boobooè¡¨çš„æ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx <span class="built_in">where</span> trx_mysql_thread_id=id;</span></span><br><span class="line">+----------+---------------------+---------------------+----+------+-----------+---------+---------------------------------+-----------+-----------------------------------------+</span><br><span class="line">| timediff | sysdate()           | trx_started         | id | USER | DB        | COMMAND | STATE                           | trx_state | trx_query                               |</span><br><span class="line">+----------+---------------------+---------------------+----+------+-----------+---------+---------------------------------+-----------+-----------------------------------------+</span><br><span class="line">| 00:05:38 | 2017-08-18 20:21:07 | 2017-08-18 20:15:29 |  6 | root | uplooking | Query   | Waiting for table metadata lock | RUNNING   | alter table booboo add q6 int default 0 |</span><br><span class="line">| 00:05:38 | 2017-08-18 20:21:07 | 2017-08-18 20:15:29 | 10 | root | uplooking | Sleep   |                                 | RUNNING   | NULL                                    |</span><br><span class="line">+----------+---------------------+---------------------+----+------+-----------+---------+---------------------------------+-----------+-----------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹innodb_trxè¡¨å¯ä»¥çœ‹åˆ°é™¤äº†alterä¹‹å¤–æœ‰æœªå®Œæˆçš„äº‹åŠ¡ï¼Œä½†æ˜¯çœ‹ä¸åˆ°å…·ä½“queryï¼Œå¾—åˆ°çº¿ç¨‹idä¸º10</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°±å¯ä»¥<span class="built_in">kill</span> 10æ¥ç»“æŸäº‹åŠ¡</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¹‹åAlteræ­£å¸¸æ“ä½œ</span></span><br></pre></td></tr></table></figure><h3 id="åœºæ™¯3"><a href="#åœºæ™¯3" class="headerlink" title="åœºæ™¯3"></a>åœºæ™¯3</h3><blockquote><p>ä¸åœºæ™¯2å¯¹æ¯”çš„ç°è±¡ä¸åŒäºï¼š</p><ul><li>åœºæ™¯2ï¼šæœªå®Œæˆäº‹åŠ¡ä¸­å­˜åœ¨æœªå®Œæˆäº‹åŠ¡</li><li>åœºæ™¯3ï¼šæœªå®Œæˆäº‹åŠ¡ä¸­ä¸å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼šç¡®è®¤æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šï¼Œæ‰¾åˆ°è¯¥äº‹åŠ¡çš„session_idç„¶åæ€æ­»</li></ul></blockquote><ul><li>é€šè¿‡<code>show processlist</code>çœ‹ä¸åˆ°<code>booboo</code>è¡¨æœ‰ä»»ä½•æ“ä½œï¼Œåœ¨<code>information_schema.innodb_trx</code>ä¸­ä¹Ÿæ²¡æœ‰ä»»ä½•è¿›è¡Œä¸­çš„äº‹åŠ¡ã€‚</li><li>è¿™å¾ˆå¯èƒ½æ˜¯å› ä¸ºåœ¨ä¸€ä¸ªæ˜¾å¼çš„äº‹åŠ¡ä¸­ï¼Œå¯¹<code>booboo</code>è¡¨è¿›è¡Œäº†ä¸€ä¸ªå¤±è´¥çš„æ“ä½œï¼ˆæ¯”å¦‚æŸ¥è¯¢äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å­—æ®µï¼‰ï¼Œè¿™æ—¶äº‹åŠ¡æ²¡æœ‰å¼€å§‹ï¼Œä½†æ˜¯å¤±è´¥è¯­å¥è·å–åˆ°çš„é”ä¾ç„¶æœ‰æ•ˆã€‚ä»<code>performance_schema.events_statements_current</code>è¡¨ä¸­å¯ä»¥æŸ¥åˆ°å¤±è´¥çš„è¯­å¥</li><li>ä¹Ÿå°±æ˜¯è¯´é™¤äº†è¯­æ³•é”™è¯¯ï¼Œå…¶ä»–é”™è¯¯è¯­å¥è·å–åˆ°çš„é”åœ¨è¿™ä¸ªäº‹åŠ¡æäº¤æˆ–å›æ»šä¹‹å‰ï¼Œä»ç„¶ä¸ä¼šé‡Šæ”¾æ‰ã€‚<code>because the failed statement is written to the binary log and the locks protect log consistency</code>ä½†æ˜¯è§£é‡Šè¿™ä¸€è¡Œä¸ºçš„åŸå› å¾ˆéš¾ç†è§£ï¼Œå› ä¸ºé”™è¯¯çš„è¯­å¥æ ¹æœ¬ä¸ä¼šè¢«è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—</li><li>è§£å†³æ–¹æ³•ï¼šç¡®è®¤æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šï¼Œæ‰¾åˆ°è¯¥äº‹åŠ¡çš„sessionidç„¶åæ€æ­»ï¼ˆéš¾ç‚¹ï¼‰</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœºæ™¯3çš„å‡ºç°å’Œå‰ä¸¤ç§ä¸åŒ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹çº¿ç¨‹æƒ…å†µï¼Œçœ‹åˆ°alteræ“ä½œmetadataé”ï¼Œè¿˜æœ‰å…¶ä»–çš„selectæ“ä½œæœ‰metadataé”</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ç¬¬ä¸€ååº”å°±æ˜¯æœ‰å¯èƒ½æ˜¯åœºæ™¯1ï¼Œäºæ˜¯killæ‰æ‰§è¡Œselectçš„çº¿ç¨‹ï¼Œå†æ¬¡æŸ¥çœ‹çº¿ç¨‹æƒ…å†µï¼Œå°±åªå‰©ä¸‹æ‰§è¡Œalterçº¿ç¨‹äº†</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ¥ä¸‹æ¥æŸ¥çœ‹æœªå®Œæˆçš„äº‹åŠ¡ï¼Œå¦‚æœæ˜¯åœºæ™¯1ï¼Œåœ¨killæ‰å†²çªçš„çº¿ç¨‹ååº”è¯¥å‡ºç°ä¸¤ç§æƒ…å†µï¼ˆA.alteræ“ä½œæ­£å¸¸æ‰§è¡ŒB.çº¿ç¨‹ä¸­åªæœ‰alteræ“ä½œä¸ºwaiting metadata lockçŠ¶æ€ï¼›æœªå®Œæˆäº‹åŠ¡ä¸­å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼‰</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ä½†æ˜¯å´å‘ç°å’ŒBæƒ…å†µæœ‰æ‰€ä¸åŒçš„æ˜¯ï¼šæœªå®Œæˆäº‹åŠ¡ä¸­ä¸å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼Œæ€»ç»“ç¬¬ä¸‰ç§æƒ…å†µ(C.çº¿ç¨‹ä¸­åªæœ‰alteræ“ä½œä¸ºwaiting metadata lockçŠ¶æ€ï¼›æœªå®Œæˆäº‹åŠ¡ä¸­ä¸å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼‰</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡æœç´¢èµ„æ–™å®šä½åˆ°æ˜¯åœºæ™¯3ï¼Œä½†èµ„æ–™ä¸­æ²¡æœ‰è¯´æ€ä¹ˆè§£å†³é—®é¢˜ï¼Œåˆä¸èƒ½é‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼Œåªæœ‰ä¸€ä¸ªèµ„æ–™é‡Œæåˆ°äº†æ–¹æ³•ï¼ˆç¡®è®¤æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šï¼Œæ‰¾åˆ°è¯¥äº‹åŠ¡çš„sessionidç„¶åæ€æ­»ï¼Œå…³é”®å°±æ˜¯å¦‚ä½•æ‰¾åˆ°sessionidå‘¢ï¼Ÿperformance_schema.events_statements_currentä¸­çš„thread_idä¸ºçº¿ç¨‹idå¹¶ä¸æ˜¯sessionidæˆ–è€…è¯´ä¼šè¯idã€è¿æ¥idï¼Œå¦‚ä½•é€šè¿‡thread_idæ‰¾åˆ°session_idæˆä¸ºäº†éš¾ç‚¹ï¼Ÿ5.7ä¸­æœ‰ä¸ªsessionè¡¨å¯ä»¥ç›´æ¥æŸ¥åˆ°ï¼Œè€Œ5.6ä¸­å¿…é¡»é€šè¿‡ä¸‰è¡¨æ‰èƒ½æŸ¥åˆ°ï¼Œåˆ†åˆ«ä¸ºperformance_schema.events_statements_current,performance_schema.threads,information_schema.processlistè¡¨ã€‚ï¼‰</span></span><br><span class="line">=====================================================================================</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">kill</span>æ‰é™¤äº†å†™æ“ä½œä»¥å¤–çš„query</span></span><br><span class="line">select concat('kill ',id) from information_schema.processlist where State="Waiting for table metadata lock" and substring(info, 1, 5) not in ('alter' , 'optim', 'repai', 'lock ', 'drop ', 'creat');</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯»æ‰¾æœªæäº¤æˆ–æœªå›æ»šçš„é”™è¯¯äº‹åŠ¡ï¼Œå¹¶<span class="built_in">kill</span>å³å¯</span></span><br><span class="line">select t.processlist_id,t.processlist_time,e.sql_text from performance_schema.threads t,performance_schema.events_statements_current e where t.thread_id=e.thread_id and e.SQL_TEXT like '%t1%';</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¡ˆä¾‹ä¸­å‡è®¾æ˜¯åœ¨t1è¡¨ä¸Šæœ‰MDLé”ï¼Œåˆ™ï¼Œe.sql_text è¿‘ä¼¼åŒ¹é…t1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ¬æ–¹æ³•5.5 5.6 5.7 éƒ½é€šç”¨ã€‚</span></span><br><span class="line">=============================================================================</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ­¥ï¼šæ¨¡æ‹Ÿç¬¬ä¸‰ç§æƒ…å†µï¼Œä¼šè¯11æ‰§è¡Œä¸€ä¸ªæ˜¾ç¤ºäº‹åŠ¡ï¼Œä¸”queryå‡ºç°åˆ—é”™è¯¯ï¼Œt1è¡¨ä¸­ä¸å­˜åœ¨xxåˆ—ï¼Œä¸æäº¤ã€‚</p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93%5Cmdl01.png" alt=""></p><p>ç¬¬äºŒæ­¥ï¼šä¼šè¯14ä¸­æ‰§è¡Œalteræ“ä½œ</p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl02.png" alt="mdl02"></p><p>ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œä¸€æ¡query</p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl03.png" alt="mdl03"></p><p>ç¬¬å››æ­¥ï¼šä¼šè¯15æ‰§è¡Œä¸€ä¸ªæ˜¾ç¤ºäº‹åŠ¡ï¼ŒæŸ¥è¯¢t1è¡¨</p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl04.png" alt="mdl04"></p><p>ç¬¬äº”æ­¥ï¼šæŸ¥çœ‹å½“å‰çš„processlistæƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°åªè¦æ˜¯å¯¹t1è¡¨çš„æ“ä½œéƒ½å‡ºç°äº†MDLé”ç­‰å¾…ï¼›å°è¯•é€šè¿‡ç¬¬ä¸€ç§æƒ…å†µçš„è§£å†³æ–¹æ³•æ‰¾å‡ºé˜»å¡çš„äº‹åŠ¡ä¼šè¯è¿›è¡Œkillï¼Œå‘ç°ä¸å­˜åœ¨é˜»å¡ä¼šè¯ï¼›æŸ¥çœ‹å½“å‰æœªæäº¤çš„äº‹åŠ¡å‘ç°è¿”å›ç©ºï¼›é€šè¿‡è¿‡æ»¤processlistä¸­è¿›è¡ŒMDLé”ç­‰å¾…ä¸”ä¸æ˜¯alterçš„ä¼šè¯idï¼Œè¿›è¡Œkillã€‚</p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl06.png" alt="mdl06"></p><p>ç¬¬å…­æ­¥ï¼šåªkill 12ï¼Œ15ï¼Œç•™ä¸‹æ‰§è¡Œalterçš„ä¼šè¯14ï¼›æœ‰äººä¼šæƒ³ä¸ºä»€ä¹ˆéƒ½killæ‰å‘¢ï¼Ÿå› ä¸ºå³ä½¿ç°åœ¨killæ‰äº†ï¼Œt1è¡¨çš„MDLé”ä¹Ÿä¸ä¼šé‡Šæ”¾æ‰ï¼Œè¿˜ä¸å¦‚ç•™ä¸‹ä¼šè¯14çš„ddlæ“ä½œï¼Œç­‰å½»åº•è§£å†³äº†ï¼Œè‡ªç„¶å°±èƒ½æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚å…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„åˆ†æã€‚</p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl07.png" alt="mdl07"></p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl08.png" alt="mdl08"></p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl09.png" alt="mdl09"></p><p>ç¬¬ä¸ƒæ­¥ï¼šç»™å¤§å®¶åšä¸ªæµ‹è¯•ï¼Œå³ä½¿å°†ä¼šè¯14çš„alteråŠ¨ä½œkillæ‰ï¼š</p><ul><li>processlistä¸­çœ‹ä¸åˆ°ä»»ä½•ç­‰å¾…MDLé”çš„ä¼šè¯ï¼›</li><li>sys.schema_table_lock_waitsä¸­ä¹Ÿä¸å­˜åœ¨è¡¨é”ï¼ˆ5.7æ‰æœ‰sysåº“ï¼‰ï¼›</li><li>performance_schema.metadata_locksä¸­ä¹Ÿä¸å­˜åœ¨ä»»ä½•é”è®°å½•ï¼›</li><li>ä¼šè¯16æƒ³å†å»æ‰§è¡Œalteræ“ä½œï¼Œåˆå¼€å§‹äº†MDLé”ç­‰å¾…ã€‚</li></ul><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl10.png" alt="mdl10"></p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl11.png" alt="mdl11"></p><p>ç¬¬å…«æ­¥ï¼šæ­¤æ—¶å°±ä¸€å®šå¯ä»¥ç¡®å®šå½“å‰å±äºã€<strong>æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šå¯¼è‡´çš„MDLé”</strong>ã€‘çš„æƒ…å†µäº†ã€‚æˆ‘ä»¬æ‰¾å‡ºè¿™ä¸ªé”™è¯¯äº‹åŠ¡ï¼Œè¿›è¡Œkill</p><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl12.png" alt="mdl12"></p><p>ç¬¬ä¹æ­¥ï¼škillæ‰ä¼šè¯11åï¼ŒæˆåŠŸå°†MDLé”é‡Šæ”¾ã€‚</p><blockquote><p>æœ‰äººåˆä¼šé—®å’¯ï¼šä¸ºä»€ä¹ˆä¸å°†æ•°æ®åº“é‡å¯ï¼Ÿ</p><p>å›ç­”ï¼š</p><p>å¦‚æœè¯´â€”â€”</p><ol><li><p>ä¸šåŠ¡å…è®¸é‡å¯</p></li><li><p>ä¸æƒ³æ‰¾åˆ°é—®é¢˜çš„æ ¹æº</p><p>é‚£ä¹ˆé‡å¯å§</p></li></ol><p>å¦‚æœè¯´â€”â€” </p><ol><li><p>æ•°æ®åº“ä¸Šé¢å¤šä¸ªåº“ï¼Œå…³è”å¤šä¸ªä¸šåŠ¡ï¼Œä¸èƒ½é‡å¯</p></li><li><p>æƒ³æ‰¾åˆ°é—®é¢˜çš„æ ¹æºï¼Œé˜²æ­¢ä¸‹æ¬¡å†æ¬¡å‡ºç°ç±»ä¼¼çš„é—®é¢˜</p><p>é‚£ä¹ˆä½ æ‡‚çš„</p></li></ol><p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¸ç›´æ¥killæ‰€æœ‰ä¼šè¯å‘¢ï¼ŸåŒæ ·å¦‚æœä½ è¦æ‰¾å‡ºé—®é¢˜çš„æ ¹æºé‚£ä¹ˆå°±æ’æŸ¥ï¼Œä¸æƒ³é—®ä¸ºä»€ä¹ˆå°±ç›´æ¥killå§ï¼Œæœ«å°¾æœ‰killçš„è„šæœ¬</p></blockquote><p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl13.png" alt="mdl13"></p><p>ä¸€æ­¥æ­¥åˆ†æå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;                                                                                                                                                                   </span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |   17 | Waiting for table metadata lock | alter table booboo add q9 int default 0 |</span><br><span class="line">|  7 | root | localhost | uplooking | Query   |   11 | Waiting for table metadata lock | select * from booboo                    |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">| 14 | root | localhost | uplooking | Query   |    5 | Waiting for table metadata lock | select * from booboo where id=3         |</span><br><span class="line">| 15 | root | localhost | uplooking | Sleep   |   28 |                                 | NULL                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx <span class="built_in">where</span> trx_mysql_thread_id=id;</span></span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">kill</span> 7 ;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">kill</span> 14;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;                                                                                                                                                                   </span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |   86 | Waiting for table metadata lock | alter table booboo add q9 int default 0 |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">| 15 | root | localhost | uplooking | Sleep   |   97 |                                 | NULL                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx <span class="built_in">where</span> trx_mysql_thread_id=id;</span></span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœç¬¦åˆæƒ…å†µCï¼Œéœ€è¦å»æŸ¥çœ‹performance_schema.events_statements_currentè¡¨ä¸­æ˜¯å¦æœ‰å¯¹boobooçš„é”™è¯¯è¯­å¥ï¼ˆè¿™é‡Œçš„é”™è¯¯è¯­å¥æ˜¯éè¯­æ³•é”™è¯¯çš„ï¼Œä¾‹å¦‚selectä¸­å†™äº†ä¸å­˜åœ¨çš„åˆ—ç­‰æƒ…å†µï¼‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»ä¸‹é¢çš„æŸ¥è¯¢ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œç¡®å®å­˜åœ¨ä¸€ä¸ªé”™è¯¯è¯­å¥äº‹ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡è¯¥é”™è¯¯è¯­å¥äº‹ä»¶çš„THREAD_IDï¼Œåˆ°performance_schema.threadsè¡¨æŸ¥åˆ°è¯¥çº¿ç¨‹å¯¹åº”çš„PROCESSLIST_IDï¼Œè€ŒPROCESSLIST_IDè¿›ç¨‹idç­‰äºprocesslistä¸­çš„id</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from performance_schema.events_statements_current <span class="built_in">where</span> SQL_TEXT like <span class="string">'%booboo%'</span>\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">              THREAD_ID: 31</span><br><span class="line">               EVENT_ID: 16</span><br><span class="line">           END_EVENT_ID: NULL</span><br><span class="line">             EVENT_NAME: statement/sql/alter_table</span><br><span class="line">                 SOURCE: socket_connection.cc:101</span><br><span class="line">            TIMER_START: 3292336129737000</span><br><span class="line">              TIMER_END: 3521408438190000</span><br><span class="line">             TIMER_WAIT: 229072308453000</span><br><span class="line">              LOCK_TIME: 0</span><br><span class="line">               SQL_TEXT: alter table booboo add q9 int default 0</span><br><span class="line">                 DIGEST: NULL</span><br><span class="line">            DIGEST_TEXT: NULL</span><br><span class="line">         CURRENT_SCHEMA: uplooking</span><br><span class="line">            OBJECT_TYPE: NULL</span><br><span class="line">          OBJECT_SCHEMA: NULL</span><br><span class="line">            OBJECT_NAME: NULL</span><br><span class="line">  OBJECT_INSTANCE_BEGIN: NULL</span><br><span class="line">            MYSQL_ERRNO: 0</span><br><span class="line">      RETURNED_SQLSTATE: NULL</span><br><span class="line">           MESSAGE_TEXT: NULL</span><br><span class="line">                 ERRORS: 0</span><br><span class="line">               WARNINGS: 0</span><br><span class="line">          ROWS_AFFECTED: 0</span><br><span class="line">              ROWS_SENT: 0</span><br><span class="line">          ROWS_EXAMINED: 0</span><br><span class="line">CREATED_TMP_DISK_TABLES: 0</span><br><span class="line">     CREATED_TMP_TABLES: 0</span><br><span class="line">       SELECT_FULL_JOIN: 0</span><br><span class="line"> SELECT_FULL_RANGE_JOIN: 0</span><br><span class="line">           SELECT_RANGE: 0</span><br><span class="line">     SELECT_RANGE_CHECK: 0</span><br><span class="line">            SELECT_SCAN: 0</span><br><span class="line">      SORT_MERGE_PASSES: 0</span><br><span class="line">             SORT_RANGE: 0</span><br><span class="line">              SORT_ROWS: 0</span><br><span class="line">              SORT_SCAN: 0</span><br><span class="line">          NO_INDEX_USED: 0</span><br><span class="line">     NO_GOOD_INDEX_USED: 0</span><br><span class="line">       NESTING_EVENT_ID: NULL</span><br><span class="line">     NESTING_EVENT_TYPE: NULL</span><br><span class="line">    NESTING_EVENT_LEVEL: 0</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">              THREAD_ID: 33</span><br><span class="line">               EVENT_ID: 74</span><br><span class="line">           END_EVENT_ID: NULL</span><br><span class="line">             EVENT_NAME: statement/sql/select</span><br><span class="line">                 SOURCE: socket_connection.cc:101</span><br><span class="line">            TIMER_START: 3521408132304000</span><br><span class="line">              TIMER_END: 3521408462141000</span><br><span class="line">             TIMER_WAIT: 329837000</span><br><span class="line">              LOCK_TIME: 184000000</span><br><span class="line">               SQL_TEXT: select * from performance_schema.events_statements_current where SQL_TEXT like '%booboo%'</span><br><span class="line">                 DIGEST: NULL</span><br><span class="line">            DIGEST_TEXT: NULL</span><br><span class="line">         CURRENT_SCHEMA: uplooking</span><br><span class="line">            OBJECT_TYPE: NULL</span><br><span class="line">          OBJECT_SCHEMA: NULL</span><br><span class="line">            OBJECT_NAME: NULL</span><br><span class="line">  OBJECT_INSTANCE_BEGIN: NULL</span><br><span class="line">            MYSQL_ERRNO: 0</span><br><span class="line">      RETURNED_SQLSTATE: NULL</span><br><span class="line">           MESSAGE_TEXT: NULL</span><br><span class="line">                 ERRORS: 0</span><br><span class="line">               WARNINGS: 0</span><br><span class="line">          ROWS_AFFECTED: 0</span><br><span class="line">              ROWS_SENT: 1</span><br><span class="line">          ROWS_EXAMINED: 0</span><br><span class="line">CREATED_TMP_DISK_TABLES: 0</span><br><span class="line">     CREATED_TMP_TABLES: 0</span><br><span class="line">       SELECT_FULL_JOIN: 0</span><br><span class="line"> SELECT_FULL_RANGE_JOIN: 0</span><br><span class="line">           SELECT_RANGE: 0</span><br><span class="line">     SELECT_RANGE_CHECK: 0</span><br><span class="line">            SELECT_SCAN: 1</span><br><span class="line">      SORT_MERGE_PASSES: 0</span><br><span class="line">             SORT_RANGE: 0</span><br><span class="line">              SORT_ROWS: 0</span><br><span class="line">              SORT_SCAN: 0</span><br><span class="line">          NO_INDEX_USED: 1</span><br><span class="line">     NO_GOOD_INDEX_USED: 0</span><br><span class="line">       NESTING_EVENT_ID: NULL</span><br><span class="line">     NESTING_EVENT_TYPE: NULL</span><br><span class="line">    NESTING_EVENT_LEVEL: 0</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">              THREAD_ID: 40</span><br><span class="line">               EVENT_ID: 8</span><br><span class="line">           END_EVENT_ID: 8</span><br><span class="line">             EVENT_NAME: statement/sql/select</span><br><span class="line">                 SOURCE: socket_connection.cc:101</span><br><span class="line">            TIMER_START: 3280938133699000</span><br><span class="line">              TIMER_END: 3280938258470000</span><br><span class="line">             TIMER_WAIT: 124771000</span><br><span class="line">              LOCK_TIME: 0</span><br><span class="line">               SQL_TEXT: select abc from booboo</span><br><span class="line">                 DIGEST: 871dd43dfdfb143e81439bbe7bf7b57e</span><br><span class="line">            DIGEST_TEXT: SELECT `abc` FROM `booboo` </span><br><span class="line">         CURRENT_SCHEMA: uplooking</span><br><span class="line">            OBJECT_TYPE: NULL</span><br><span class="line">          OBJECT_SCHEMA: NULL</span><br><span class="line">            OBJECT_NAME: NULL</span><br><span class="line">  OBJECT_INSTANCE_BEGIN: NULL</span><br><span class="line">            MYSQL_ERRNO: 1054</span><br><span class="line">      RETURNED_SQLSTATE: 42S22</span><br><span class="line">           MESSAGE_TEXT: Unknown column 'abc' in 'field list'</span><br><span class="line">                 ERRORS: 1</span><br><span class="line">               WARNINGS: 0</span><br><span class="line">          ROWS_AFFECTED: 0</span><br><span class="line">              ROWS_SENT: 0</span><br><span class="line">          ROWS_EXAMINED: 0</span><br><span class="line">CREATED_TMP_DISK_TABLES: 0</span><br><span class="line">     CREATED_TMP_TABLES: 0</span><br><span class="line">       SELECT_FULL_JOIN: 0</span><br><span class="line"> SELECT_FULL_RANGE_JOIN: 0</span><br><span class="line">           SELECT_RANGE: 0</span><br><span class="line">     SELECT_RANGE_CHECK: 0</span><br><span class="line">            SELECT_SCAN: 0</span><br><span class="line">      SORT_MERGE_PASSES: 0</span><br><span class="line">             SORT_RANGE: 0</span><br><span class="line">              SORT_ROWS: 0</span><br><span class="line">              SORT_SCAN: 0</span><br><span class="line">          NO_INDEX_USED: 0</span><br><span class="line">     NO_GOOD_INDEX_USED: 0</span><br><span class="line">       NESTING_EVENT_ID: NULL</span><br><span class="line">     NESTING_EVENT_TYPE: NULL</span><br><span class="line">    NESTING_EVENT_LEVEL: 0</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: </span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select THREAD_ID,DIGEST_TEXT from performance_schema.events_statements_current <span class="built_in">where</span> DIGEST_TEXT=<span class="string">"SELECT `abc` FROM `booboo`"</span>;</span></span><br><span class="line">+-----------+-----------------------------+</span><br><span class="line">| THREAD_ID | DIGEST_TEXT                 |</span><br><span class="line">+-----------+-----------------------------+</span><br><span class="line">|        40 | SELECT `abc` FROM `booboo`  |</span><br><span class="line">+-----------+-----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from performance_schema.threads <span class="built_in">where</span> thread_id=40\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">          THREAD_ID: 40</span><br><span class="line">               NAME: thread/sql/one_connection</span><br><span class="line">               TYPE: FOREGROUND</span><br><span class="line">     PROCESSLIST_ID: 15</span><br><span class="line">   PROCESSLIST_USER: root</span><br><span class="line">   PROCESSLIST_HOST: localhost</span><br><span class="line">     PROCESSLIST_DB: uplooking</span><br><span class="line">PROCESSLIST_COMMAND: Sleep</span><br><span class="line">   PROCESSLIST_TIME: 402</span><br><span class="line">  PROCESSLIST_STATE: NULL</span><br><span class="line">   PROCESSLIST_INFO: NULL</span><br><span class="line">   PARENT_THREAD_ID: NULL</span><br><span class="line">               ROLE: NULL</span><br><span class="line">       INSTRUMENTED: YES</span><br><span class="line">            HISTORY: YES</span><br><span class="line">    CONNECTION_TYPE: Socket</span><br><span class="line">       THREAD_OS_ID: 22758</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select PROCESSLIST_ID from performance_schema.threads <span class="built_in">where</span> thread_id=40;</span></span><br><span class="line">+----------------+</span><br><span class="line">| PROCESSLIST_ID |</span><br><span class="line">+----------------+</span><br><span class="line">|             15 |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from information_schema.processlist <span class="built_in">where</span> id=(select PROCESSLIST_ID from performance_schema.threads <span class="built_in">where</span> thread_id=40);</span></span><br><span class="line">+----+------+-----------+-----------+---------+------+-------+------+</span><br><span class="line">| ID | USER | HOST      | DB        | COMMAND | TIME | STATE | INFO |</span><br><span class="line">+----+------+-----------+-----------+---------+------+-------+------+</span><br><span class="line">| 15 | root | localhost | uplooking | Sleep   |  466 |       | NULL |</span><br><span class="line">+----+------+-----------+-----------+---------+------+-------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">kill</span> 15;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¼šè¯B</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> alter table booboo add q9 int default 0;</span></span><br><span class="line">Query OK, 0 rows affected (9 min 54.35 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure><h2 id="å°çŸ¥è¯†ç‚¹æ€»ç»“"><a href="#å°çŸ¥è¯†ç‚¹æ€»ç»“" class="headerlink" title="å°çŸ¥è¯†ç‚¹æ€»ç»“"></a>å°çŸ¥è¯†ç‚¹æ€»ç»“</h2><h3 id="ä¸‰å¼ è¡¨çš„å…³ç³»"><a href="#ä¸‰å¼ è¡¨çš„å…³ç³»" class="headerlink" title="ä¸‰å¼ è¡¨çš„å…³ç³»"></a>ä¸‰å¼ è¡¨çš„å…³ç³»</h3><blockquote><p>MySQL 5.6</p></blockquote><ol><li><code>performance_schema</code>åº“ä¸­ï¼Œ<code>events_statements_current</code>è¡¨ä¸­<code>theard_id</code>ä¸<code>threads</code>è¡¨ä¸­çš„<code>thread_id</code>ç›¸åŒ</li><li><code>performance_schema</code>åº“ä¸­ï¼Œthreadsè¡¨ä¸­ï¼Œthread_idå’Œprocesslist_idä¸ºå¯¹åº”å…³ç³»ï¼Œ<code>thread_id</code>è¡¨ç¤ºä¸€ä¸ªç‹¬ç‰¹çš„çº¿ç¨‹æ ‡è¯†ç¬¦;<code>processlist_id</code>æ˜¯<code>show processlist</code>æ˜¾ç¤ºçš„<code>id</code>å€¼ï¼Œè¿æ¥æ ‡è¯†ç¬¦ï¼›è€Œå¯¹äºåå°çº¿ç¨‹(ä¸ç”¨æˆ·è¿æ¥ä¸ç›¸å…³çš„çº¿ç¨‹)ï¼Œ<code>PROCESSLIST_ID</code>ä¸ºç©ºï¼Œæ­¤å€¼ä¸æ˜¯å”¯ä¸€çš„ã€‚</li><li><code>information_schema</code>åº“ä¸­,<code>PROCESSLIST</code>è¡¨æ˜¯ä¸€ä¸ªéæ ‡å‡†è¡¨ã€‚<code>id</code>è¿æ¥æ ‡è¯†ç¬¦ï¼Œå¹¶ç”±CONNECTION_ID()å‡½æ•°è¿”å›ã€‚</li></ol><table><thead><tr><th>performance_schema</th><th>performance_schema</th><th>performance_schema</th><th>information_schema</th></tr></thead><tbody><tr><td>events_statements_current</td><td>threads</td><td>threads</td><td>processlist</td></tr><tr><td>THREAD_ID</td><td>THREAD_ID</td><td>PROCESSLIST_ID</td><td>ID</td></tr></tbody></table><h3 id="æˆ‘çš„ç†è§£"><a href="#æˆ‘çš„ç†è§£" class="headerlink" title="æˆ‘çš„ç†è§£"></a>æˆ‘çš„ç†è§£</h3><ol><li>çº¿ç¨‹è¡¨ä¸­ä¿å­˜äº†æ‰€æœ‰çº¿ç¨‹çš„ä¿¡æ¯ï¼Œæœ‰å‰å°çš„æœ‰åå°è¿è¡Œçš„ï¼›</li><li>å¦‚æœæ˜¯ç”±è¿æ¥äº§ç”Ÿçš„çº¿ç¨‹ï¼Œä¸€èˆ¬éƒ½æ˜¯å‰å°çº¿ç¨‹ï¼Œä¼šåˆ†é…ä¸€ä¸ªprocesslist_idï¼Œå¯ä»¥åœ¨information_schema.processlistä¸­çœ‹åˆ°</li></ol><h3 id="èµ„æ–™å‚è€ƒ"><a href="#èµ„æ–™å‚è€ƒ" class="headerlink" title="èµ„æ–™å‚è€ƒ"></a>èµ„æ–™å‚è€ƒ</h3><p><a href="https://dev.mysql.com/doc/refman/5.7/en/threads-table.html" target="_blank" rel="noopener">å®˜ç½‘å…³äºthreadsè¡¨çš„è¯´æ˜</a></p><p><a href="https://dev.mysql.com/doc/refman/5.7/en/show-processlist.html" target="_blank" rel="noopener">å®˜æ–¹å…³äºprocesslistè¡¨çš„è¯´æ˜</a></p><p><a href="http://www.voidcn.com/article/p-hjsjvnlz-bog.html" target="_blank" rel="noopener">MySQL5.7 MetaData Lock æ¡ˆä¾‹åˆ†äº«</a></p><h3 id="ä¸åŒç‰ˆæœ¬"><a href="#ä¸åŒç‰ˆæœ¬" class="headerlink" title="ä¸åŒç‰ˆæœ¬"></a>ä¸åŒç‰ˆæœ¬</h3><blockquote><p>MySQL 5.7</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">select * from performance_schema.events_statements_current\G</span><br><span class="line">select * from sys.x$session\G</span><br><span class="line">select * from sys.x$processlist\G</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from x$session\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                thd_id: 3904</span><br><span class="line">               conn_id: 3879</span><br><span class="line">                  user: root@localhost</span><br><span class="line">                    db: sys</span><br><span class="line">               command: Query</span><br><span class="line">                 state: Sending data</span><br><span class="line">                  time: 0</span><br><span class="line">     current_statement: select * from x$session</span><br><span class="line">     statement_latency: 1564453000</span><br><span class="line">              progress: NULL</span><br><span class="line">          lock_latency: 847000000</span><br><span class="line">         rows_examined: 0</span><br><span class="line">             rows_sent: 0</span><br><span class="line">         rows_affected: 0</span><br><span class="line">            tmp_tables: 4</span><br><span class="line">       tmp_disk_tables: 1</span><br><span class="line">             full_scan: YES</span><br><span class="line">        last_statement: NULL</span><br><span class="line">last_statement_latency: NULL</span><br><span class="line">        current_memory: 0</span><br><span class="line">             last_wait: NULL</span><br><span class="line">     last_wait_latency: NULL</span><br><span class="line">                source: NULL</span><br><span class="line">           trx_latency: NULL</span><br><span class="line">             trx_state: NULL</span><br><span class="line">        trx_autocommit: NULL</span><br><span class="line">                   pid: 12880</span><br><span class="line">          program_name: mysql</span><br><span class="line">1 row in set (0.05 sec)</span><br><span class="line">mysql&gt; select * from  x$processlist limit 1\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                thd_id: 1</span><br><span class="line">               conn_id: NULL</span><br><span class="line">                  user: sql&#x2F;main</span><br><span class="line">                    db: NULL</span><br><span class="line">               command: NULL</span><br><span class="line">                 state: NULL</span><br><span class="line">                  time: 230927</span><br><span class="line">     current_statement: NULL</span><br><span class="line">     statement_latency: NULL</span><br><span class="line">              progress: NULL</span><br><span class="line">          lock_latency: NULL</span><br><span class="line">         rows_examined: NULL</span><br><span class="line">             rows_sent: NULL</span><br><span class="line">         rows_affected: NULL</span><br><span class="line">            tmp_tables: NULL</span><br><span class="line">       tmp_disk_tables: NULL</span><br><span class="line">             full_scan: NO</span><br><span class="line">        last_statement: NULL</span><br><span class="line">last_statement_latency: NULL</span><br><span class="line">        current_memory: 0</span><br><span class="line">             last_wait: NULL</span><br><span class="line">     last_wait_latency: NULL</span><br><span class="line">                source: NULL</span><br><span class="line">           trx_latency: NULL</span><br><span class="line">             trx_state: NULL</span><br><span class="line">        trx_autocommit: NULL</span><br><span class="line">                   pid: NULL</span><br><span class="line">          program_name: NULL</span><br><span class="line">1 row in set (0.06 sec)</span><br><span class="line">mysql&gt; select * from information_schema.processlist;</span><br><span class="line">+------+------+-----------+------+---------+------+-----------+----------------------------------------------+</span><br><span class="line">| ID   | USER | HOST      | DB   | COMMAND | TIME | STATE     | INFO                                         |</span><br><span class="line">+------+------+-----------+------+---------+------+-----------+----------------------------------------------+</span><br><span class="line">| 3879 | root | localhost | sys  | Query   |    0 | executing | select * from information_schema.processlist |</span><br><span class="line">+------+------+-----------+------+---------+------+-----------+----------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="MDLæ•…éšœè‡ªæ„ˆ"><a href="#MDLæ•…éšœè‡ªæ„ˆ" class="headerlink" title="MDLæ•…éšœè‡ªæ„ˆ"></a>MDLæ•…éšœè‡ªæ„ˆ</h2><h3 id="killæ‰€æœ‰ä¼šè¯"><a href="#killæ‰€æœ‰ä¼šè¯" class="headerlink" title="killæ‰€æœ‰ä¼šè¯"></a>killæ‰€æœ‰ä¼šè¯</h3><blockquote><p>ä¸æƒ³çŸ¥é“æ•…éšœåŸå› ï¼Œåªæƒ³å¿«é€Ÿè§£å†³æ•…éšœ</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">kill</span>æ‰ æ‰€æœ‰ä¼šè¯</span></span><br><span class="line">user=xxx</span><br><span class="line">password=xxx</span><br><span class="line">host=xxxx.mysql.rds.aliyuncs.com</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">mysql -u$user -p$password -h$host  -P$port -e "select  concat('KILL ',id,';') from information_schema.processlist;" &gt; tmpfile</span><br><span class="line"></span><br><span class="line">awk '&#123;if (NR != 1) print $0 &#125;' tmpfile | mysql -u$user -p$password -h$host  -P$port</span><br></pre></td></tr></table></figure><h3 id="MDLæ•…éšœæ’æŸ¥å’Œè§£å†³"><a href="#MDLæ•…éšœæ’æŸ¥å’Œè§£å†³" class="headerlink" title="MDLæ•…éšœæ’æŸ¥å’Œè§£å†³"></a>MDLæ•…éšœæ’æŸ¥å’Œè§£å†³</h3><p><a href="https://github.com/BoobooWei/DevOps-Database-Troubleshooting/blob/master/fault_self_healing_metadatalock.py" target="_blank" rel="noopener">MDLæ•…éšœè‡ªæ„ˆè„šæœ¬GitHubåœ°å€</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‘˜è¦ï¼šMetaData Lockå³å…ƒæ•°æ®é”ï¼Œåœ¨æ•°æ®åº“ä¸­å…ƒæ•°æ®å³æ•°æ®å­—å…¸ä¿¡æ¯åŒ…æ‹¬db,table,function,procedure,trigger,eventç­‰ã€‚metadata lockä¸»è¦ä¸ºäº†ä¿è¯å…ƒæ•°æ®çš„ä¸€è‡´æ€§,ç”¨äºå¤„ç†ä¸åŒçº¿ç¨‹æ“ä½œåŒä¸€æ•°æ®å¯¹è±¡çš„åŒæ­¥ä¸äº’æ–¥é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¤©æœ‰å®¢æˆ·(MySQL 5.6)é‡åˆ°è¯¥é—®é¢˜ï¼Œæœ€å…³é”®çš„æ˜¯å±äºç¬¬ä¸‰ç§æƒ…å†µï¼Œgoogleä¸Šæ ¹æœ¬æ‰¾ä¸åˆ°ç±»ä¼¼çš„æ•…éšœæ¡ˆä¾‹ï¼Œå”¯ä¸€ä¸€ä¸ªéå¸¸æ¥è¿‘çš„æ•…éšœæ¡ˆä¾‹ä¸­æ•°æ®åº“ç‰ˆæœ¬å´ä¸åŒï¼ˆå…·ä½“çœ‹ä¸‹æ–‡æ…¢æ…¢èŠï¼‰ï¼Œå“ï¼Œå›°éš¾é‡é‡å•Šï¼Œæœ€ç»ˆè¿˜æ˜¯è§£å†³äº†å“ˆã€‚&lt;/p&gt;
&lt;p&gt;alter tableçš„è¯­å¥æ˜¯å¾ˆå±é™©çš„ï¼Œåœ¨æ“ä½œä¹‹å‰æœ€å¥½ç¡®è®¤å¯¹è¦æ“ä½œçš„è¡¨æ²¡æœ‰ä»»ä½•è¿›è¡Œä¸­çš„æ“ä½œã€æ²¡æœ‰æœªæäº¤äº‹åŠ¡ã€ä¹Ÿæ²¡æœ‰æ˜¾å¼äº‹åŠ¡ä¸­çš„æŠ¥é”™è¯­å¥ã€‚å¦‚æœæœ‰alter tableçš„ç»´æŠ¤ä»»åŠ¡ï¼Œåœ¨æ— äººç›‘ç®¡çš„æ—¶å€™è¿è¡Œï¼Œæœ€å¥½é€šè¿‡lock_wait_timeoutè®¾ç½®å¥½è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´çš„metedataé”ç­‰å¾…ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯å¹¿è§’" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="é”æ•…éšœ" scheme="http://www.toberoot.com/tags/%E9%94%81%E6%95%85%E9%9A%9C/"/>
    
  </entry>
  
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬ä¸€è¯¾ è¯¾ç¨‹ç®€ä»‹</title>
    <link href="http://www.toberoot.com/2016/12/25/booboo_mysql/00-MySQL%E7%AE%A1%E7%90%86%E8%AF%BE%E7%A8%8B%E7%AE%80%E4%BB%8B/"/>
    <id>http://www.toberoot.com/2016/12/25/booboo_mysql/00-MySQL%E7%AE%A1%E7%90%86%E8%AF%BE%E7%A8%8B%E7%AE%80%E4%BB%8B/</id>
    <published>2016-12-24T21:06:27.000Z</published>
    <updated>2020-03-24T05:27:17.964Z</updated>
    
    <content type="html"><![CDATA[<p><img src="pic/00-mysql.png" alt="mysqlå›¾ç‰‡"></p><blockquote><ul><li>æ•™å­¦å¯¹è±¡ï¼šæœ‰ä¸€å®šlinuxåŸºç¡€</li><li>æ•°æ®åº“ç‰ˆæœ¬ï¼šmaraidb5.5 mariadb10.2 mysql5.7</li><li>æ“ä½œç³»ç»Ÿï¼šRHEL7.2 æœ€å°åŒ–å®‰è£…</li></ul></blockquote><p>MySQL ç®¡ç†è¯¾ç¨‹ï¼Œé¢„è®¡è¯¾æ—¶10å¤©ï¼Œè¯´æ˜¯è¯´æ•°æ®åº“ï¼Œå…¶å®ä¹Ÿå±äºé¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¼šå‘ç°åœ¨é¡¹ç›®çš„å½“ä¸­ï¼Œå¤šå¤šå°‘å°‘éƒ½ä¼šç”¨åˆ°æ•°æ®åº“ï¼Œè€Œä¸”æ•°æ®åº“è¿˜æ˜¯ä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œåœ¨æ•´ä¸ªé¡¹ç›®ç¯å¢ƒå½“ä¸­å‘¢ï¼Œæˆ‘ä»¬ä¼šè®²åˆ°é¡¹ç›®çš„æ­å»ºã€è¿ç§»ã€æ‹“å±•ï¼Œä¸€å°æœºå™¨å˜æˆå¤šå°æœºå™¨ï¼Œè§£å†³ç”¨æˆ·çš„æ€§èƒ½é—®é¢˜ï¼Œé‚£ä¹ˆåœ¨æ‹“å±•è¿‡ç¨‹å½“ä¸­å‘¢ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ­¥æ‹“å±•çš„éƒ½æ˜¯æ•°æ®åº“ï¼Œå› ä¸ºæ•°æ®åº“çš„å‹åŠ›æ˜¯æœ€å¤§çš„ï¼Œç¬¬ä¸€ä¸ªé‡åˆ°æ€§èƒ½ç“¶é¢ˆçš„éƒ½æ˜¯åœ¨æ•°æ®åº“ä¸Šé¢ï¼Œæ‰€ä»¥çš„è¯å‘¢ï¼Œæˆ‘ä»¬åœ¨MySQLçš„è¯¾ç¨‹å½“ä¸­ä¼šä¸»è¦ä»¥ç³»ç»Ÿç®¡ç†å‘˜çš„è§’åº¦å»è®²è®²æ•°æ®åº“çš„å¤‡ä»½ã€å†—ä½™ã€æ‰©å±•ã€é«˜å¯ç”¨ã€è´Ÿè½½å‡è¡¡ã€‚</p><h2 id="ä¸ºä»€ä¹ˆMySQL"><a href="#ä¸ºä»€ä¹ˆMySQL" class="headerlink" title="ä¸ºä»€ä¹ˆMySQL ?"></a>ä¸ºä»€ä¹ˆMySQL ?</h2><p>DB-Engines æœ€è¿‘å‘å¸ƒäº† 2017 å¹´ 2 æœˆä»½çš„æ•°æ®åº“æ’åã€‚</p><p>å‰ååä¸­ï¼ŒOracleï¼ŒMySQL å’Œ Microsoft SQL Server ä»å æ®å‰ä¸‰åï¼ŒOracle è™½ç„¶é•¿æœŸéœ¸å é¦–ä½ï¼Œä½†å¾—åˆ†å´å‘ˆä¸‹é™è¶‹åŠ¿ï¼Œä¸ 1 æœˆç›¸æ¯”å°‘äº† 12.89ï¼Œä¸å»å¹´åŒæœŸç›¸æ¯”ï¼Œå°‘äº† 72.31ã€‚ç¬¬äºŒåçš„ MySQL å¾—åˆ†å‡æœ‰æ‰€ä¸Šæ¶¨ï¼Œä¸å»å¹´åŒæœŸç›¸æ¯”ï¼Œå¢é•¿ 59.18ï¼Œç¬¬ä¸‰åçš„ Microsoft SQL Server å¾—åˆ†è¾ƒ 1 æœˆä¸‹é™äº† 17.5ï¼Œæ¯”å»å¹´åŒæœŸï¼Œå¾—åˆ†æœ‰æ¯”è¾ƒé«˜çš„æå‡ã€‚</p><p>å…·ä½“æƒ…å†µè¯·çœ‹å‰ 20 åæ’åæƒ…å†µï¼š</p><p><img src="pic/20170206-database-1.jpg" alt="20170206-database-1.jpg"></p><p>å®Œæ•´æ’åè¯·çœ‹è¿™é‡Œï¼š<a href="http://db-engines.com/en/ranking" target="_blank" rel="noopener">http://db-engines.com/en/ranking</a></p><p>DB-Engines æ’åçš„æ•°æ®ä¾æ® 5 ä¸ªä¸åŒçš„å› ç´ ï¼š</p><ul><li>Google ä»¥åŠ Bing æœç´¢å¼•æ“çš„å…³é”®å­—æœç´¢æ•°é‡</li><li>Google Trends çš„æœç´¢æ•°é‡</li><li>Indeed ç½‘ç«™ä¸­çš„èŒä½æœç´¢é‡</li><li>LinkedIn ä¸­æåˆ°å…³é”®å­—çš„ä¸ªäººèµ„æ–™æ•°</li><li>Stackoverflow ä¸Šç›¸å…³çš„é—®é¢˜å’Œå…³æ³¨è€…æ•°é‡</li></ul><p>ä¸‹å›¾æ˜¯æ¯ä¸ªæ•°æ®åº“çš„å˜åŒ–è¶‹åŠ¿ï¼š</p><p><img src="pic/20170206-database-2.jpg" alt="20170206-database-2.jpg"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå‰ 3 åä¸€ç›´ä¿æŒç€è¿œé«˜äºå…¶å®ƒæ•°æ®åº“çš„åœ°ä½ï¼Œå‰ä¸‰åŸºæœ¬æ²¡æœ‰æ‚¬å¿µã€‚åªæ˜¯ï¼Œç¬¬äºŒåå’Œç¬¬ä¸‰åçš„MySQL å’Œ Microsoft SQL Server å·²ç»è¶Šæ¥è¶Šæ¥è¿‘ç¬¬ä¸€åçš„Oracleï¼Œè¯´ä¸å®šåœ¨ä¸‹ä¸€æ¬¡æ’åå‘å¸ƒæ—¶ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°ä¸ä¸€æ ·çš„ä¸‰ç”²æ’åã€‚</p><p>è¯¦ç»†è¶‹åŠ¿è¯·çœ‹è¿™é‡Œï¼š<a href="http://db-engines.com/en/ranking_trend" target="_blank" rel="noopener">http://db-engines.com/en/ranking_trend</a></p><p>æœ‰äººç”¨pythonå†™äº†çˆ¬è™«æŠ“å–å›½å†…ç½‘ç«™æ•°æ®åˆ¶ä½œäº†ä¸­å›½æ•°æ®åº“æ’è¡Œæ¦œã€‚è®¡ç®—æ–¹æ³•å’Œdb-enginesç±»ä¼¼ï¼Œç„¶è€Œæ ¹æ®å›½å†…åšäº†ä¸€äº›è°ƒæ•´ï¼Œç»Ÿè®¡ç»“æœæ˜¯2017å¹´1æœˆMYSQLæ’åç¬¬ä¸€ï¼Œå¾—åˆ†ä¸º2864.75ï¼Œè€Œoracleå¾—åˆ†ä¸º2752.67ï¼Œsql serverå¾—åˆ†ä»…ä»…ä¸º981.5</p><p>æˆ‘ä»¬è¿˜å¯ä»¥çœ‹çœ‹å›½å†…å¯¹mysqlæ•°æ®åº“å·¥ç¨‹å¸ˆçš„æ‹›è˜ä¿¡æ¯</p><p><img src="pic/QQ%E6%88%AA%E5%9B%BE20170206114205.png" alt="QQæˆªå›¾20170206114205.png"></p><p>ä»ä¸Šå›¾çœ‹åˆ°2æœˆ6æ—¥è¿™ä¸€å¤©51jobä¸Šå¯¹mysql dbaçš„èŒä½æä¾›æœ‰316ä¸ªï¼Œæˆ‘ä»¬å†çœ‹çœ‹å¯¹å²—ä½çš„è¦æ±‚ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="pic/20170206114325.png" alt="20170206114325.png"></p><p>ä¸ºä»€ä¹ˆæ˜¯ MySQL ?å¯¹æ¯ä¸€ç§æŠ€æœ¯,æˆ‘ä»¬éƒ½è€ƒè™‘äº†å…¶æœ€å¤§å…³æ³¨ç‚¹,å¹¶æå‡ºåŒæ ·çš„é—®é¢˜ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¯¹ MySQL çš„è€ƒè™‘ :</p><p>Qï¼šå®ƒè§£å†³äº†æˆ‘ä»¬çš„å­˜å‚¨éœ€æ±‚å—? </p><p>Aï¼šæ²¡é”™,æˆ‘ä»¬éœ€è¦æ˜ å°„ã€ç´¢å¼•ã€æ’åºå’Œ blob å­˜å‚¨,è¿™äº›MySQL éƒ½æœ‰ã€‚</p><p>Qï¼šå®ƒå¸¸ç”¨å—? ä½ å¯ä»¥æ‹›è˜åˆ°ç›¸å…³å‘˜å·¥å—?</p><p>Aï¼šMySQL æ˜¯ç›®å‰ç”Ÿäº§çº¿ä¸Šæœ€å¸¸ä½¿ç”¨çš„æ•°æ®åº“ä¹‹ä¸€ã€‚å¾ˆå®¹æ˜“æ‹›åˆ°ä½¿ç”¨è¿‡ MySQL çš„äººã€‚</p><p>Qï¼šå®ƒçš„ç¤¾åŒºæ´»è·ƒå—? </p><p>Aï¼šéå¸¸æ´»è·ƒã€‚æœ‰å¥½å¤šéå¸¸æ£’çš„ä¹¦ç±,å’Œä¸€ä¸ªå¼ºå¤§çš„åœ¨çº¿ç¤¾åŒºã€‚</p><p>Qï¼šé¢å¯¹æ•…éšœ,å®ƒå¥å£®å—?</p><p>Aï¼šå³ä½¿åœ¨æœ€æ¶åŠ£çš„æƒ…å†µä¸‹,æˆ‘ä»¬ä¹Ÿä»æ¥æ²¡æœ‰ä¸¢å¤±è¿‡æ•°æ®ã€‚</p><p>Qï¼šå®ƒçš„æ‰©å±•æ€§å¦‚ä½•?</p><p>Aï¼šå°±å®ƒæœ¬èº«æ¥è¯´,åªæ˜¯ä¸€ä¸ªå¾ˆå°çš„ç»„ä»¶ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§ä¸Šå±‚çš„åˆ†ç‰‡æ–¹æ¡ˆ(è¿™å®Œå…¨æ˜¯å¦ä¸€ä¸ªé—®é¢˜)ã€‚</p><p>Qï¼šä½ ä¼šæ˜¯æœ€å¤§çš„ç”¨æˆ·å—?</p><p>Aï¼šä¸, ç›® å‰ ä¸ æ˜¯ã€‚ æœ€ å¤§ çš„ ç”¨ æˆ· åŒ… æ‹¬ Facebookã€Twitter å’Œ Googleã€‚é™¤éä½ èƒ½å¤Ÿæ”¹è¿›ä¸€ç§æŠ€æœ¯,å¦åˆ™ä½ ä¸ä¼šæƒ³è¦æˆä¸ºå®ƒæœ€å¤§çš„ç”¨æˆ·ã€‚å¦‚æœä½ æ˜¯æœ€å¤§çš„ç”¨æˆ·,ä½ ä¼šç¢°åˆ°ä¸€äº›æ–°çš„æ‰©å±•æ€§é—®é¢˜,è€Œå…¶ä»–äººæ ¹æœ¬æ²¡æœºä¼šé‡åˆ°ã€‚</p><p>Qï¼šå®ƒçš„æˆç†Ÿåº¦å¦‚ä½•? </p><p>Aï¼šçœŸæ­£çš„åŒºåˆ«åœ¨äºæˆç†Ÿåº¦ã€‚æ ¹æ®å¤æ‚åº¦çš„ä¸åŒ,æˆç†Ÿåº¦å°±å¥½æ¯”è¡¡é‡å®Œæˆä¸€ä¸ªç¨‹åºæ‰€éœ€çš„è¡€ã€æ±—å’Œæ³ªã€‚MySQL çš„ç¡®å¤æ‚,ä½†å¯æ¯”ä¸ä¸Šé‚£äº›ç¥å¥‡çš„è‡ªåŠ¨é›†ç¾¤ NoSQL æ–¹æ¡ˆã€‚è€Œä¸”,MySQL æ‹¥æœ‰ 30 å¹´(1996å¹´ç¬¬ä¸€ç‰ˆ)æœ€å¥½å’Œæœ€èªæ˜çš„è´¡çŒ®,æ¥è‡ªäºè¯¸å¦‚Facebook å’Œ Google é‚£æ ·å¤§è§„æ¨¡ä½¿ç”¨å®ƒçš„å…¬å¸ã€‚æ ¹æ®æˆ‘ä»¬çš„æˆç†Ÿåº¦å®šä¹‰,åœ¨æˆ‘ä»¬å®¡æŸ¥çš„æ‰€æœ‰æŠ€æœ¯ä¸­,MySQL æ˜¯ä¸€ä¸ªæ˜æ™ºçš„é€‰æ‹©ã€‚</p><p>Qï¼šæœ‰å¥½çš„è°ƒè¯•å·¥å…·å—? </p><p>Aï¼šä½œä¸ºä¸€ä¸ªæˆç†Ÿçš„äº§å“,ä½ å½“ç„¶éœ€è¦å¼ºå¤§çš„è°ƒè¯•å’Œåˆ†æå·¥å…·,å› ä¸ºäººä»¬å¾ˆå®¹æ˜“é‡åˆ°ä¸€äº›ç±»ä¼¼çš„æ£˜æ‰‹æƒ…å†µã€‚æ¯”å¦‚ä½ å¯èƒ½åœ¨å‡Œæ™¨ä¸‰ç‚¹é‡åˆ°é—®é¢˜(ä¸æ­¢ä¸€æ¬¡)ã€‚ç›¸æ¯”ç”¨å¦ä¸€ç§æŠ€æœ¯é‡å†™ä¸€éç†¬åˆ°å‡Œæ™¨å…­ç‚¹,å‘ç°é—®é¢˜çš„æ ¹æºç„¶åå›å»ç¡è§‰èˆ’æœå¤šäº†ã€‚</p><h2 id="Mysql-ç®¡ç†è¯¾ç¨‹ç¯å¢ƒä½¿ç”¨è¯´æ˜"><a href="#Mysql-ç®¡ç†è¯¾ç¨‹ç¯å¢ƒä½¿ç”¨è¯´æ˜" class="headerlink" title="Mysql ç®¡ç†è¯¾ç¨‹ç¯å¢ƒä½¿ç”¨è¯´æ˜"></a>Mysql ç®¡ç†è¯¾ç¨‹ç¯å¢ƒä½¿ç”¨è¯´æ˜</h2><p>DB100è¯¾ç¨‹åŸºäºRHEL7.2ç³»ç»Ÿï¼Œè¯¾ç¨‹æ•™æˆå­¦ç”Ÿå®ŒæˆåŸºäºæ­¤ç³»ç»Ÿçš„Mysql 5.7 ã€MariaDB 10.2æ•°æ®åº“ç®¡ç†è¯¾ç¨‹å’ŒåŸºç¡€è¯¾ç¨‹å†…å®¹ã€‚</p><h3 id="æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹"><a href="#æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹" class="headerlink" title="æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹"></a>æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹</h3><ul><li><p>workstationè™šæ‹Ÿæœºå‡å®‰è£…rhel7.2ç³»ç»Ÿï¼Œï¼ˆå®‰è£…å›¾å½¢åŒ–ç•Œé¢å¹¶é…ç½®runlevel 5å¯åŠ¨ï¼Œrootå¯†ç ä¸ºuplooking ï¼Œé…ç½®äº†åŸºç¡€çš„YUMæºæŒ‡å‘classroomï¼‰ï¼Œ workstationè™šæ‹Ÿæœºå‡é…ç½®äº†2å—è™šæ‹Ÿæœºç½‘å¡ï¼Œeth0æ¥å…¥ç‰©ç†æœºbr0ç½‘æ¡¥ï¼ŒåŠ¨æ€è·å¾—ipåœ°å€172.25.0.10ï¼›eth1æ¥å…¥ç‰©ç†æœºprivateç½‘æ¡¥ï¼Œä¸è·å¾—ipåœ°å€ï¼›workstationè™šæ‹Ÿæœºå‡é…ç½®2å—è™šæ‹Ÿç¡¬ç›˜ï¼ˆvdaã€vdbï¼‰ï¼Œä»¥æ–¹ä¾¿æˆè¯¾æ¼”ç¤ºã€‚workstationè™šæ‹Ÿæœºå‡é…ç½®2GBè¿è¡Œå†…å­˜ã€‚</p></li><li><p>masteraã€masterbã€slavea ã€slaveb å’Œdbproxyè™šæ‹Ÿæœºå‡å®‰è£…rhel7.2ç³»ç»Ÿï¼Œï¼ˆæ²¡æœ‰å®‰è£…å›¾å½¢åŒ–ç•Œé¢ï¼Œrootå¯†ç ä¸ºuplooking ï¼Œé…ç½®äº†åŸºç¡€çš„YUMæºæŒ‡å‘classroomï¼‰ï¼Œ masteraã€masterbã€slavea ã€slaveb å’Œdbproxyè™šæ‹Ÿæœºå‡é…ç½®äº†2å—è™šæ‹Ÿæœºç½‘å¡ï¼Œeth0æ¥å…¥ç‰©ç†æœºbr0ç½‘æ¡¥ï¼ŒåŠ¨æ€è·å¾—ipåœ°å€172.25.0.11~172.25.0.5ï¼›eth1æ¥å…¥ç‰©ç†æœºprivateç½‘æ¡¥ï¼Œä¸è·å¾—ipåœ°å€ï¼›masteraã€masterbã€slavea ã€slaveb å’Œdbproxyè™šæ‹Ÿæœºå‡é…ç½®2å—è™šæ‹Ÿç¡¬ç›˜ï¼ˆvdaã€vdbï¼‰ï¼Œä»¥æ–¹ä¾¿æˆè¯¾æ¼”ç¤ºã€‚masteraã€masterbã€slavea ã€slaveb å’Œdbproxyè™šæ‹Ÿæœºå‡é…ç½®512MBè¿è¡Œå†…å­˜ã€‚</p></li><li><p>å·²åœ¨classroomä¸Šå®ŒæˆDNSé…ç½®ï¼Œæ­£å‘å’Œæ–¹å‘åŸŸååŠé‚®ä»¶ä»£ç†åŸŸåå’Œè™šæ‹ŸæœºåŸŸåè®¾ç½®å¦‚ä¸‹ï¼š</p><ul><li>classroom.example.com 172.25.254.254</li><li>fN.example.com 172.25.254.N</li><li>workstationN.example.com 172.25.N.10</li><li>masteraN.example.com 172.25.N.11</li><li>masterbN.example.com 172.25.N.12</li><li>slaveaN.example.com 172.25.N.13</li><li>slavebN.example.com 172.25.N.14</li><li>dbproxyN.example.com 172.25.N.15</li><li>N:1~80</li></ul></li><li><p><a href="http://classroom.example.com/materials" target="_blank" rel="noopener">http://classroom.example.com/materials</a> ä¸ºç¬¬ä¸‰æ–¹è½¯ä»¶åŒ…å’Œèµ„æ–™ç›®å½•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<a href="http://materials.example.com" target="_blank" rel="noopener">http://materials.example.com</a> ç›´æ¥è®¿é—®ã€‚</p></li></ul><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>** Mariadb 10.2 å’ŒMysql 5.7 åœ¨yumå®‰è£…ä¸­ä¼šæœ‰å†²çªï¼Œä¸è¦åŒæ—¶é…ç½®MariaDBå’ŒMySQLçš„æºã€‚ **</p><h3 id="ç½‘ç»œæ‹“æ‰‘å›¾"><a href="#ç½‘ç»œæ‹“æ‰‘å›¾" class="headerlink" title="ç½‘ç»œæ‹“æ‰‘å›¾"></a>ç½‘ç»œæ‹“æ‰‘å›¾</h3><p><img src="pic/01-db100-classroom.png" alt="db100ç½‘ç»œæ‹“æ‰‘å›¾"></p><h3 id="è¯¾ç¨‹å¤§çº²"><a href="#è¯¾ç¨‹å¤§çº²" class="headerlink" title="è¯¾ç¨‹å¤§çº²"></a>è¯¾ç¨‹å¤§çº²</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">MYSQL</span><br><span class="line">ä¸€ã€MySQLç®¡ç†è¯¾ç¨‹ç®€ä»‹</span><br><span class="line">1.MySQL ç®¡ç†è¯¾ç¨‹</span><br><span class="line">2.ä¸ºä»€ä¹ˆMySQL ?</span><br><span class="line">3.Mysql ç®¡ç†è¯¾ç¨‹ç¯å¢ƒä½¿ç”¨è¯´æ˜</span><br><span class="line">4.æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹</span><br><span class="line">5.æ³¨æ„äº‹é¡¹</span><br><span class="line">6.ç½‘ç»œæ‹“æ‰‘å›¾</span><br><span class="line"></span><br><span class="line">äºŒã€MySQLå’ŒMariaDBæ•°æ®åº“ä»‹ç»</span><br><span class="line">1.æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ</span><br><span class="line">2.æ•°æ®åº“çš„åˆ†ç±»</span><br><span class="line">3.ä»€ä¹ˆæ˜¯MySQL</span><br><span class="line">4.å¦‚ä½•è·å¾—MySQLç›¸å…³èµ„æº</span><br><span class="line">5.MySQLåœ¨ä¼ä¸šä¸­çš„åº”ç”¨åœºæ™¯</span><br><span class="line">6.MySQL æ•°æ®åº“å®‰è£…</span><br><span class="line">RHEL 7.2 RPM åŒ…å®‰è£… MariaDB 5.5</span><br><span class="line">RHEL 7.2 RPM åŒ…å®‰è£… MariaDB 10.2</span><br><span class="line">RHEL 7.2 RPM åŒ…å®‰è£… MySQL 5.7</span><br><span class="line">RHEL 7.2 äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£… MySQL 5.6</span><br><span class="line">7.MySQLå®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“</span><br><span class="line">MySQLå®¢æˆ·ç«¯çš„ä½¿ç”¨</span><br><span class="line">pythonè¿æ¥MySQLæ•°æ®åº“</span><br><span class="line">PHPmyAdminåœ¨çº¿å·¥å…·ä½¿ç”¨</span><br><span class="line">MySQL Workbench è¿æ¥æ•°æ®åº“</span><br><span class="line"></span><br><span class="line">ä¸‰ã€ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€SQLä»‹ç»å’ŒåŸºæœ¬æ“ä½œ</span><br><span class="line">1.sqlè¯­æ³•ï¼Œæ•°æ®ç±»å‹ï¼Œè¿ç®—ç¬¦</span><br><span class="line">2.DDL(Data Definition Languages)è¯­å¥</span><br><span class="line">3.DML(Data Manipulation Language)è¯­å¥</span><br><span class="line">4.DCL(Data Control Language)è¯­å¥</span><br><span class="line">5.DQL(Data Query Language)è¯­å¥</span><br><span class="line">6.å®æˆ˜é¡¹ç›®1:ç†Ÿæ‚‰SQLè¯­å¥</span><br><span class="line">7.å®æˆ˜é¡¹ç›®2:ç†Ÿæ‚‰mysql.userè¡¨</span><br><span class="line">8.å®æˆ˜é¡¹ç›®3:å®Œæˆæ•°æ®åº“ç”¨æˆ·æƒé™æ“ä½œé¡¹ç›®</span><br><span class="line"></span><br><span class="line">å››ã€MySQLé€»è¾‘æ¶æ„å’ŒInnodbå­˜å‚¨å¼•æ“</span><br><span class="line">1.MySQL é€»è¾‘æ¶æ„</span><br><span class="line">2.MySQL å­˜å‚¨å¼•æ“</span><br><span class="line">å­˜å‚¨å¼•æ“æ¦‚è¿°</span><br><span class="line">çŸ¥åçš„ä¸¤å¤§å­˜å‚¨å¼•æ“</span><br><span class="line">äº‹åŠ¡</span><br><span class="line">å¹¶å‘æ§åˆ¶</span><br><span class="line">é”æœºåˆ¶</span><br><span class="line">å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ MVCC</span><br><span class="line">äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</span><br><span class="line">3.INNODBé”</span><br><span class="line">è®¾ç½®INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«</span><br><span class="line">å®è·µ1ï¼šæŸ¥çœ‹innodbé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</span><br><span class="line">å®è·µ2ï¼šæ”¹å˜å•ä¸ªä¼šè¯çš„éš”ç¦»çº§åˆ«</span><br><span class="line">å®è·µ3ï¼šæ”¹å˜å•ä¸ªå®ä¾‹çš„éš”ç¦»çº§åˆ«</span><br><span class="line">å®è·µ4ï¼šæ”¹å˜æ‰€æœ‰å®ä¾‹çš„éš”ç¦»çº§åˆ«</span><br><span class="line">åŒºåˆ†INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«</span><br><span class="line">InnoDB ä¸­çš„éš”ç¦»çº§è¯¦ç»†æè¿°</span><br><span class="line">å®è·µ1ï¼šSERIALIZABLEéš”ç¦»çº§åˆ«æŸ¥è¯¢è‡ªåŠ¨åŠ å…±äº«é”</span><br><span class="line">å®è·µ2ï¼šRUã€RCã€RRéš”ç¦»çº§åˆ«çš„å¯¹æ¯”</span><br><span class="line">å®ç°ä¸€è‡´æ€§é”å®šè¯»</span><br><span class="line">å®è·µ1ï¼šè®¾ç½®innodbç”³è¯·é”ç­‰å¾…è¶…æ—¶æ—¶é—´</span><br><span class="line">å®è·µ2ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ å…±äº«é”æµ‹è¯•</span><br><span class="line">å®è·µ3ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ æ’ä»–é”æµ‹è¯•</span><br><span class="line">è®¤è¯†é”çš„ç®—æ³•</span><br><span class="line">çŸ¥è¯†ç‚¹</span><br><span class="line">å®è·µ1ï¼š éªŒè¯nextkey</span><br><span class="line">locké™çº§ä¸ºrecord key</span><br><span class="line">å®è·µ2ï¼š å…³é—­GAPé”_RC</span><br><span class="line">å®è·µ3ï¼š å…³é—­GAPé”_innodb_locks_unsafe_for_binlog</span><br><span class="line">å®è·µ4ï¼š nextkeylockingæ˜¯å¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜çš„</span><br><span class="line"></span><br><span class="line">äº”ã€MySQLå¤‡ä»½ä¸æ¢å¤</span><br><span class="line"></span><br><span class="line">1.ä¸ºä»€ä¹ˆè¦å¤‡ä»½</span><br><span class="line">2.ä»€ä¹ˆæ˜¯å¤‡ä»½</span><br><span class="line">3.å¤‡ä»½çš„ä¸¤å¤§è¦ç´ </span><br><span class="line">4.å¤‡ä»½çš„åˆ†ç±»</span><br><span class="line">ç‰©ç†å¤‡ä»½å’Œé€»è¾‘å¤‡ä»½</span><br><span class="line">é€»è¾‘å¤‡ä»½</span><br><span class="line">ç‰©ç†å¤‡ä»½</span><br><span class="line">å¢é‡å¤‡ä»½å’Œå·®å¼‚å¤‡ä»½</span><br><span class="line">åœ¨çº¿ï¼ˆçƒ­ï¼‰å¤‡ä»½ã€æ¸©å¤‡ä»½ã€ç¦»çº¿ï¼ˆå†·ï¼‰å¤‡ä»½</span><br><span class="line">5.å¤‡ä»½å’Œæ¢å¤å·¥å…·</span><br><span class="line">tar</span><br><span class="line">tarå¤‡ä»½æ­¥éª¤</span><br><span class="line">tarè¿˜åŸæ­¥éª¤</span><br><span class="line">è¯¾å ‚å®æˆ˜1: åˆ©ç”¨tarå®ç°ç‰©ç†å¤‡ä»½å¹¶è¿˜åŸ</span><br><span class="line">LVM SnapShot</span><br><span class="line">lvmå¿«ç…§çš„ä¼˜ç‚¹å’Œç¼ºç‚¹</span><br><span class="line">osæ”¯æŒlvmæ–¹å¼ </span><br><span class="line">lvmå¿«ç…§å¤‡ä»½æ•°æ®</span><br><span class="line">lvmå¿«ç…§è¿˜åŸæ•°æ®</span><br><span class="line">è¯¾å ‚å®æˆ˜2: åˆ©ç”¨LVMå¿«ç…§å®ç°ç‰©ç†å¤‡ä»½å¹¶è¿˜åŸ</span><br><span class="line">mysqldump</span><br><span class="line">MyISAMå’ŒINNODBè¡¨çš„å¤‡ä»½</span><br><span class="line">mysqldumpå‘½ä»¤çš„ç”¨æ³•</span><br><span class="line">mysqldumpå¤‡ä»½æ­¥éª¤</span><br><span class="line">mysqldumpè¿˜åŸæ­¥éª¤</span><br><span class="line">è¯¾å ‚å®æˆ˜3: åˆ©ç”¨mysqldumpå®ç°é€»è¾‘å¤‡ä»½å¹¶è¿˜åŸ</span><br><span class="line">Percona Xtrabackup</span><br><span class="line">è¯¾å ‚å®æˆ˜4ï¼šinnobackupexå®æ—¶å¢é‡å¤‡ä»½å’Œè¿˜åŸ</span><br><span class="line">6.MySQL æ—¥å¿—çš„åˆ†ç±»</span><br><span class="line">äºŒè¿›åˆ¶æ—¥å¿—çš„ç®¡ç†å’Œå¤‡ä»½</span><br><span class="line">å¦‚ä½•æ‰“å¼€äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">å¦‚ä½•æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">åŸºäºäºŒè¿›åˆ¶æ—¥å¿—çš„å®æ—¶å¢é‡è¿˜åŸ</span><br><span class="line">æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿä¸€</span><br><span class="line">æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹ŸäºŒ</span><br><span class="line">æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿä¸‰</span><br><span class="line">è¯¾å ‚å®æˆ˜5ï¼šåŸºäºäºŒè¿›åˆ¶æ—¥å¿—æ—¶é—´ç‚¹å’Œä½ç½®çš„æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿ</span><br><span class="line"></span><br><span class="line">å…­ã€MySQLå¤åˆ¶replication </span><br><span class="line">1.å¤åˆ¶æ¦‚è¿°</span><br><span class="line">2.å¤åˆ¶è§£å†³çš„é—®é¢˜</span><br><span class="line">3.å¤åˆ¶çš„åŸç†</span><br><span class="line">é¡¹ç›®å®æˆ˜1ï¼šmariadb server 5.5 å•ä¸»ä»æ¶æ„</span><br><span class="line">é¡¹ç›®å®æˆ˜2ï¼šmysql server 5.7 åŸºäºGTIDçš„å•ä¸»ä»æ¶æ„</span><br><span class="line">4.å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜_é‡æ¼”å»¶è¿Ÿ</span><br><span class="line">é¡¹ç›®å®æˆ˜3ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„</span><br><span class="line">é¡¹ç›®å®æˆ˜4ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„crash safeå‚æ•°è°ƒä¼˜</span><br><span class="line">5.å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜_è¯»å†™åˆ†ç¦»</span><br><span class="line">åŠåŒæ­¥å¤åˆ¶çš„æ½œåœ¨é—®é¢˜</span><br><span class="line">æ— æ•°æ®ä¸¢å¤±çš„åŠåŒæ­¥å¤åˆ¶</span><br><span class="line">é¡¹ç›®å®æˆ˜5ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»åŠåŒæ­¥æ¶æ„</span><br><span class="line">6.å¤åˆ¶ä¸­çš„å•ç‚¹æ•…éšœé—®é¢˜</span><br><span class="line">å¤åˆ¶æ‹“æ‰‘_é…ç½®MSS</span><br><span class="line">å¤åˆ¶æ‹“æ‰‘_é…ç½®MM</span><br><span class="line">å¤åˆ¶æ‹“æ‰‘_é…ç½®M(s)M(s)</span><br><span class="line">å¤åˆ¶æ‹“æ‰‘_é…ç½®MMSS</span><br><span class="line">é¡¹ç›®å®æˆ˜6ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå¤šçº§ä¸»ä» Multisource åŠåŒæ­¥æ¶æ„</span><br><span class="line"></span><br><span class="line">ä¸ƒã€MySQLé«˜å¯ç”¨HA</span><br><span class="line">1.ä»€ä¹ˆæ˜¯é«˜å¯ç”¨</span><br><span class="line">2.å¯¼è‡´å®•æœºçš„åŸå› </span><br><span class="line">3.å¦‚ä½•å®ç°é«˜å¯ç”¨</span><br><span class="line">4.é¿å…å•ç‚¹æ•…éšœ</span><br><span class="line">åŸºäºå¤åˆ¶çš„å†—ä½™</span><br><span class="line">MySQL åŒæ­¥å¤åˆ¶</span><br><span class="line">MySQL Cluster é›†ç¾¤</span><br><span class="line">Galera Cluster é›†ç¾¤</span><br><span class="line">5.æ•…éšœè½¬ç§»å’Œæ•…éšœæ¢å¤</span><br><span class="line">é—®é¢˜çš„æå‡º</span><br><span class="line">è§£å†³æ–¹æ¡ˆ</span><br><span class="line">ä»€ä¹ˆæ˜¯æ•°æ®åº“ä»£ç†æœåŠ¡å™¨</span><br><span class="line">ç›®å‰å¸‚é¢ä¸Šçš„æ•°æ®åº“ä»£ç†æœåŠ¡å™¨</span><br><span class="line">mysqlproxy (äº†è§£ï¼Œä¸è®²)</span><br><span class="line">mycat</span><br><span class="line">6.å®æˆ˜é¡¹ç›®ï¼š æ•°æ®åº“ä¸­é—´ä»¶ Mycat å®ç° è¯»å†™åˆ†ç¦»è´Ÿè½½å‡è¡¡ï¼Œåç«¯æ•°æ®åº“æœåŠ¡å™¨ä¸º MySQL 5.7 MMSS Multisource Replication é«˜å¯ç”¨æ¶æ„</span><br><span class="line">7.å®æˆ˜é¡¹ç›®:  æ•°æ®åº“ä¸­é—´ä»¶ Mycat å®ç° è¯»å†™åˆ†ç¦»è´Ÿè½½å‡è¡¡ï¼Œåç«¯æ•°æ®åº“æœåŠ¡å™¨ä¸º Mariadb 10.2 Galera ClusteråŒæ­¥å¤åˆ¶é«˜å¯ç”¨æ¶æ„</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;pic/00-mysql.png&quot; alt=&quot;mysqlå›¾ç‰‡&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;æ•™å­¦å¯¹è±¡ï¼šæœ‰ä¸€å®šlinuxåŸºç¡€&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“ç‰ˆæœ¬ï¼šmaraidb5.5 mariadb10.2 mysql5.7&lt;/li&gt;

      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†" scheme="http://www.toberoot.com/tags/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬ä¸ƒè¯¾ å¤åˆ¶ AB replication</title>
    <link href="http://www.toberoot.com/2016/12/25/booboo_mysql/04-MySQL%E5%A4%8D%E5%88%B6replication/"/>
    <id>http://www.toberoot.com/2016/12/25/booboo_mysql/04-MySQL%E5%A4%8D%E5%88%B6replication/</id>
    <published>2016-12-24T21:06:27.000Z</published>
    <updated>2020-03-24T05:27:17.967Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬è®²ä¹‰å‚è€ƒ ã€Š HA mysql ã€‹ é«˜å¯ç”¨MySQL:ç¬¬2ç‰ˆ /(ç¾)è´å°”(Bell,C.),(ç¾)è‚¯å¾·å°”(Kindahl,M.),(ç¾)å¡å°”æ›¼</p></blockquote><h3 id="å¤åˆ¶æ¦‚è¿°"><a href="#å¤åˆ¶æ¦‚è¿°" class="headerlink" title="å¤åˆ¶æ¦‚è¿°"></a>å¤åˆ¶æ¦‚è¿°</h3><p>æ•°æ®åº“ä¸ºåº”ç”¨ç¨‹åºæä¾›é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§çš„é‡è¦ç‰¹æ€§ä¹‹ä¸€å°±æ˜¯å¤åˆ¶(Replication)ã€‚å¤åˆ¶åœ¨æ•°æ®åº“å±‚åˆ›å»ºå†—ä½™,åŒæ—¶äº§ç”Ÿå¤šä¸ªæ•°æ®åº“å‰¯æœ¬è¿›è¡Œè¯»æ‰©å±•ã€‚</p><p>å¤åˆ¶å°±æ˜¯æŠŠæŸä¸ªæœåŠ¡å™¨ä¸Š(ç§°ä¸º ä¸»èŠ‚ç‚¹æœåŠ¡å™¨ æˆ–è€…ç®€ç§° ä¸»èŠ‚ç‚¹ ,å³ master)çš„æ‰€æœ‰å˜åŒ–å…‹éš†åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨(ç§°ä¸º ä»èŠ‚ç‚¹æœåŠ¡å™¨ æˆ–ç®€ç§° ä»èŠ‚ç‚¹ ,å³ slave)ã€‚å¤åˆ¶é€šå¸¸ç”¨æ¥åˆ›å»ºmaster çš„ä¸€ä¸ªå¯é å‰¯æœ¬,ä¸è¿‡å¤åˆ¶ä¹Ÿæœ‰å…¶ä»–ç”¨é€”ã€‚</p><p>ä¸¤ç§æœ€å¸¸è§çš„ä½¿ç”¨å¤åˆ¶çš„ä¾‹å­æ˜¯ :</p><ul><li>(1)åˆ›å»ºä¸€ä¸ª master çš„å¤‡ä»½,ä»¥é¿å… master å´©æºƒæ—¶ä¸¢å¤±æ•°æ® ;</li><li>(2)åˆ›å»ºä¸€ä¸ª master çš„å‰¯æœ¬,ä»è€Œåœ¨ä¸å¹²æ‰°å…¶ä»–ä¸šåŠ¡çš„æƒ…å†µä¸‹æ‰§è¡ŒæŠ¥è¡¨å’Œåˆ†æå·¥ä½œã€‚</li></ul><p>å¯¹å°å‹ä¼ä¸šæ¥è¯´,è¿™è¶³ä»¥ç®€åŒ–å¾ˆå¤šäº‹æƒ…,ä½†å¤åˆ¶å¯ä»¥åšå¾—æ›´å¤š,æ¯”å¦‚ :</p><ul><li>æ”¯æŒå¤šä¸ªæœºæˆ¿</li></ul><p>æ¯ä¸ªåœ°ç‚¹éƒ½å¯èƒ½è¦ç»´æŠ¤æœåŠ¡å™¨,ç„¶åå°†å˜æ›´å¤åˆ¶åˆ°å…¶ä»–åœ°æ–¹,ä»è€Œä½¿å¾—ä¿¡æ¯å¤„å¤„å¯ç”¨ã€‚è¿™å°±éœ€è¦ä¿æŠ¤æ•°æ®,åœ¨åˆæ³•çš„æƒ…å†µä¸‹,ä¿è¯ç”¨äºå®¡è®¡ç›®çš„çš„ä¸šåŠ¡ä¿¡æ¯å¯ç”¨ã€‚</p><ul><li>å³ä½¿æœ‰æœåŠ¡å™¨åœæœº,ä¹Ÿèƒ½ä¿è¯ä¸šåŠ¡çš„æŒç»­è¿è¡Œ</li></ul><p>å¦‚æœåŸæ¥çš„æœåŠ¡å™¨å¤±æ•ˆ,ç”±å…¶ä»–æœåŠ¡å™¨å¤„ç†æ‰€æœ‰çš„è®¿é—®é‡ã€‚</p><ul><li>å³ä½¿æœ‰ç¾éš¾å‘ç”Ÿ,ä¹Ÿèƒ½ä¿è¯ä¸šåŠ¡æŒç»­è¿è¡Œ</li></ul><p>å¤åˆ¶å¯ä»¥å°†å˜æ›´å‘é€ç»™ä¸åŒåœ°ç†ä½ç½®çš„å…¶ä»–æ•°æ®ä¸­å¿ƒã€‚</p><ul><li>é”™è¯¯ä¿æŠ¤(oops)</li></ul><p>å½“ slave è¿æ¥ master æ—¶,å¯ä»æ€»æ˜¯æ¯” master è½åä¸€ä¸ªå›ºå®šçš„æ—¶é—´å‘¨æœŸ(ä¾‹å¦‚ 1 å°æ—¶),è¿™æ ·å°±ä¼šäº§ç”Ÿä¸€ä¸ª å»¶è¿Ÿçš„ slave(Delayed Slave)ã€‚å¦‚æœè¿™æ—¶ master ä¸Šå‘ç”Ÿé”™è¯¯,å¯ä»¥æ‰¾åˆ°å‡ºé”™çš„è¯­å¥,ç„¶ååœ¨ slave æ‰§è¡Œä¹‹å‰åˆ é™¤å®ƒã€‚</p><p>ç›®å‰å¾ˆå¤šåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å¤åˆ¶æœ€é‡è¦çš„åœºæ™¯ä¹‹ä¸€å°±æ˜¯ æ¨ªå‘æ‰©å±• (scale out)ã€‚ç°ä»Šçš„åº”ç”¨ç¨‹åºé€šå¸¸æ˜¯è¯»å¯†é›†å‹çš„,å…·æœ‰é«˜è¯»å†™æ¯”ã€‚ä¸ºäº†å‡å°‘ master ä¸Šçš„è´Ÿè½½,ä½ å¯ä»¥æ­å»ºä¸€ä¸ªä¸“é—¨å“åº”è¯»è¯·æ±‚çš„ slaveã€‚é€šè¿‡ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨,å¯ä»¥å°†è¯»è¯·æ±‚å®šå‘åˆ°åˆé€‚çš„ slave,è€Œå†™è¯·æ±‚åˆ™äº¤ç»™ master å¤„ç†ã€‚</p><p>åœ¨æ¨ªå‘æ‰©å±•çš„åœºæ™¯ä¸‹ä½¿ç”¨å¤åˆ¶æ—¶,ç†è§£ MySQL å¤åˆ¶çš„ å¼‚æ­¥æ€§ (asynchronous)å¾ˆé‡è¦,å³äº‹åŠ¡é¦–å…ˆåœ¨ master ä¸Šæäº¤,ç„¶åå¤åˆ¶åˆ° slave å¹¶åœ¨ slave ä¸Šæ‰§è¡Œã€‚è¿™æ„å‘³ç€ master å’Œslave å¯èƒ½å¹¶ä¸ä¸€è‡´,è€Œä¸”å¦‚æœå¤åˆ¶æŒç»­è¿è¡Œ,slave å°†ä¼šè½åäº masterã€‚</p><p>ä½¿ç”¨å¼‚æ­¥å¤åˆ¶çš„å¥½å¤„åœ¨äºå®ƒæ¯”åŒæ­¥å¤åˆ¶æ›´å¿«ã€æ›´å…·å¯æ‰©å±•æ€§,ä½†åœ¨é‚£äº›å®æ—¶æ•°æ®å¾ˆé‡è¦çš„æƒ…å†µä¸‹,å¿…é¡»å¤„ç†å¥½ä¸åŒæ­¥çš„é—®é¢˜ä»¥ä¿è¯ä¿¡æ¯çš„æ—¶æ•ˆæ€§ã€‚</p><p>ç„¶è€Œ,è¯»æ‰©å±•å¹¶ä¸è¶³ä»¥é€‚ç”¨äºæ‰€æœ‰åº”ç”¨ç¨‹åºã€‚éšç€éœ€æ±‚å¢åŠ ,æ•°æ®åº“æ›´å¤§,å†™è´Ÿè½½æ›´é«˜,éœ€è¦æ‰©å±•çš„å°±ä¸åªæ˜¯è¯»æ“ä½œäº†ã€‚ç®¡ç†å¤§å‹æ•°æ®åº“,æå‡å¤§å‹æ•°æ®åº“ç³»ç»Ÿçš„æ€§èƒ½,å¯ä»¥é€šè¿‡åˆ†ç‰‡ (sharding)æŠ€æœ¯æ¥å®ç°ã€‚é€šè¿‡åˆ†ç‰‡,å¯ä»¥å°†æ•°æ®åº“åˆ’åˆ†ä¸ºè‹¥å¹²å¯ç®¡ç†çš„æ•°æ®åˆ†ç‰‡,å°†æ•°æ®åº“åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Š,ä»è€Œå¢åŠ æ•°æ®åº“çš„è§„æ¨¡,å¹¶æœ‰æ•ˆåœ°æ‰©å±•å†™æ“ä½œã€‚</p><p>å¤åˆ¶çš„å¦ä¸€ä¸ªé‡è¦åº”ç”¨æ˜¯é€šè¿‡æ·»åŠ å†—ä½™æ¥ä¿è¯é«˜å¯ç”¨æ€§ã€‚æœ€å¸¸è§çš„æŠ€æœ¯æ˜¯ä½¿ç”¨ åŒä¸»é…ç½®(dual-master),å³é€šè¿‡å¤åˆ¶ä¿æŒä¸€å¯¹ master æ€»æ˜¯å¯ç”¨,å…¶ä¸­æ¯ä¸ª master éƒ½æ˜¯å¯¹æ–¹çš„é•œåƒã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ª master å¤±æ•ˆ,å¦ä¸€ä¸ªä¼šç«‹å³æ¥æ‰‹ã€‚</p><p>é™¤äº†åŒä¸»é…ç½®,è¿˜æœ‰å…¶ä»–ä¸å¤åˆ¶æ— å…³çš„é«˜å¯ç”¨æ€§æŠ€æœ¯,å¦‚ä½¿ç”¨å…±äº«å­˜å‚¨æˆ–å¤åˆ¶ç£ç›˜ã€‚å°½ç®¡å®ƒä»¬ä¸æ˜¯ MySQL ç‰¹æœ‰çš„,ä½†è¿™äº›æŠ€æœ¯å¯¹äºä¿è¯é«˜å¯ç”¨æ€§æ¥è¯´ä¹Ÿæ˜¯å¾ˆé‡è¦çš„å·¥å…·</p><h3 id="å¤åˆ¶è§£å†³çš„é—®é¢˜"><a href="#å¤åˆ¶è§£å†³çš„é—®é¢˜" class="headerlink" title="å¤åˆ¶è§£å†³çš„é—®é¢˜"></a>å¤åˆ¶è§£å†³çš„é—®é¢˜</h3><blockquote><p>å¤åˆ¶ç”¨ä¾‹:</p></blockquote><blockquote><blockquote><p>é€šè¿‡çƒ­å¤‡ä»½è¾¾åˆ°é«˜å¯ç”¨æ€§</p></blockquote></blockquote><p>å¦‚æœæœåŠ¡å™¨å®•æœº,ä¸€åˆ‡éƒ½å°†åœæ­¢ :ä¸èƒ½æ‰§è¡Œ(å¯èƒ½å¾ˆå…³é”®çš„)äº‹åŠ¡, æ— æ³•å¾—åˆ°ç”¨æˆ·ä¿¡æ¯,ä¹Ÿä¸èƒ½æ£€ç´¢å…¶ä»–é‡è¦æ•°æ®ã€‚è¦ä¸æƒœ(å‡ ä¹)ä¸€åˆ‡ä»£ä»·é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿ,å› ä¸ºå®ƒä¼šä¸¥é‡ç ´åä¸šåŠ¡ã€‚æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯é…ç½®ä¸€ä¸ªé¢å¤–çš„æœåŠ¡å™¨ä¸“é—¨ä½œä¸ºçƒ­å¤‡ä»½(hot standby),åœ¨ä¸»æœåŠ¡å™¨å®•æœºçš„æ—¶å€™éšæ—¶æ¥ç®¡ä¸šåŠ¡ã€‚</p><p>å¦‚æœæ•°æ®åº“åªåšäº†å¤‡ä»½ï¼Œç°åœ¨æ•°æ®åº“åäº†ï¼Œæˆ‘ä»¬è¦æ¢å¤æ•°æ®åº“ï¼Œå¯èƒ½è¦èŠ±å‡ ä¸ªå°æ—¶ï¼›ä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¸Œæœ›è¿™å°æ•°æ®åº“åäº†ï¼Œå¦å¤–ä¸€å°èƒ½å¤Ÿç«‹åˆ»é¡¶ä¸Šä½¿ç”¨ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>é‚£å°±éœ€è¦æˆ‘ä»¬æœ‰ä¸€ä¸ªå†—ä½™çš„ç¯å¢ƒï¼Œå¤‡ä»½æ˜¯å¤‡ä»½,å†—ä½™æ˜¯å†—ä½™ã€‚æ¦‚å¿µä¸ä¸€æ ·,å¤‡ä»½æ˜¯å°†æ•°æ®ä»¥éš”ç¦»çš„æ–¹å¼ä¿å­˜,å¤‡ä»½çš„ç¼ºç‚¹,ä»–ä¸æ˜¯ç¬é—´è¿˜åŸ,å¤‡ä»½åœ¨è¿˜åŸè¿‡ç¨‹ä¸­æ˜¯æœ‰è€—æ—¶çš„,ä»–ä¸æ˜¯ç¬é—´è¿˜åŸ,ä¾‹å¦‚,æˆ‘ä»¬æœ‰å‡ ç™¾ä¸ª G çš„æ–‡ä»¶è¦è¿˜åŸå›å»,æ…¢æ…¢æ‹·å§,å‡ ä¸ªå°æ—¶ã€‚å†—ä½™ä¸ä¸€æ ·,ä¸»æœåŠ¡å™¨/ä»æœåŠ¡å™¨,ä¸»æœåŠ¡å™¨åæ‰,ä»æœåŠ¡å™¨å°±é¡¶ä¸Šå·¥ä½œ,æ‰€ä»¥å†—ä½™åœ¨å¯ç”¨æ€§ä¸Šæ¥è®²,æ¢å¤çš„é€Ÿåº¦ä¸Šæ¥è®²,æ¯”å¤‡ä»½æ¥çš„å¿«,ä½†æ˜¯å†—ä½™æœ‰ä»–çš„ç¼ºç‚¹,å¤‡ä»½æœ‰ä»–çš„ä¼˜ç‚¹,æ¯”å¦‚æˆ‘ä»¬ä½œä¸»ä»åŒæ­¥,ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨æ•°æ®éƒ½ä¸€æ ·çš„,å¦‚æœä¸»æœåŠ¡å™¨ä¸Šæœ‰äººé”™åˆ äº†ä¸€ä¸ªè¡¨,æˆ‘ä»¬æŠŠè¿™ç§æ“ä½œç§°ä¸ºè¯¯æ“ä½œ,é‚£ä¹ˆä»æœåŠ¡å™¨ä¹Ÿä¼šå‘ç”Ÿè¯¯æ“ä½œ,æ‰€ä»¥å‘¢,å†—ä½™ä¸èƒ½è§£å†³äººä¸ºçš„è¯¯æ“ä½œ,è€Œå¤‡ä»½å¯ä»¥è§£å†³ã€‚å†—ä½™ä»–èƒ½è§£å†³ç¡¬ä»¶æ•…éšœ,ä½†æ˜¯è¯¯æ“ä½œæ— æ³•è§£å†³,å¤‡ä»½ä¸æ˜¯ç¬é—´è¿˜åŸ,ä½†æ˜¯æ—¢å¯ä»¥è§£å†³ç¡¬ä»¶æ•…éšœåˆèƒ½è§£å†³è¯¯æ“ä½œ,ä»–ä»¬å„æœ‰ä¼˜åŠ£ç‚¹,è€ŒçœŸå®çš„çº¿ä¸Šç”Ÿäº§ç¯å¢ƒæ˜¯ä¸¤ç§æ–¹æ³•ä¸€èµ·ä½¿ç”¨,æ—¢æœ‰å†—ä½™ç¯å¢ƒ,åˆæœ‰å‘¨æœŸæ€§å¤‡ä»½,ç®¡ç†å‘˜è¦å‘¨æœŸæ€§åœ°è¿›è¡Œå¤‡ä»½,åŒæ—¶æœ‰å¤šå°æœåŠ¡å™¨ä½œå†—ä½™ã€‚</p><blockquote><blockquote><p>äº§ç”ŸæŠ¥è¡¨</p></blockquote></blockquote><p>ç›´æ¥ç”¨æœåŠ¡å™¨ä¸Šçš„æ•°æ®åˆ›å»ºæŠ¥è¡¨å°†å¤§å¤§é™ä½æœåŠ¡å™¨çš„æ€§èƒ½,åœ¨æŸäº›æƒ…å†µä¸‹å°¤å…¶æ˜¾è‘—ã€‚å¦‚æœäº§ç”ŸæŠ¥è¡¨éœ€è¦å¤§é‡çš„åå°ä½œä¸š,æœ€å¥½åˆ›å»ºä¸€ä¸ªé¢å¤–çš„æœåŠ¡å™¨æ¥è¿è¡Œè¿™äº›ä½œä¸šã€‚åœæ­¢æŠ¥è¡¨æ•°æ®åº“ä¸Šçš„å¤åˆ¶,ç„¶ååœ¨ä¸å½±å“ä¸»è¦ä¸šåŠ¡æœåŠ¡å™¨çš„æƒ…å†µä¸‹è¿è¡Œå¤§é‡æŸ¥è¯¢,ä»è€Œå¾—åˆ°æ•°æ®åº“åœ¨æŸä¸€ç‰¹å®šæ—¶é—´çš„å¿«ç…§ã€‚ä¾‹å¦‚,å¦‚æœåœ¨æ¯å¤©æœ€åä¸€ä¸ªäº‹åŠ¡å¤„ç†å®Œæ¯•ååœæ­¢å¤åˆ¶,å¯ä»¥æå–æ—¥æŠ¥è¡¨è€Œå…¶ä»–ä¸šåŠ¡ä»æ­£å¸¸è¿è½¬ã€‚</p><blockquote><blockquote><p>è°ƒè¯•å’Œå®¡è®¡</p></blockquote></blockquote><p>è¿˜å¯ä»¥å®¡æŸ¥æœåŠ¡å™¨ä¸Šçš„æŸ¥è¯¢ã€‚ä¾‹å¦‚,æŸ¥çœ‹æŸäº›æŸ¥è¯¢æ˜¯å¦æœ‰æ€§èƒ½é—®é¢˜,ä»¥åŠæœåŠ¡å™¨æ˜¯å¦ç”±äºæŸä¸ªç³Ÿç³•çš„æŸ¥è¯¢è€Œä¸åŒæ­¥ã€‚</p><h3 id="å¤åˆ¶çš„åŸç†"><a href="#å¤åˆ¶çš„åŸç†" class="headerlink" title="å¤åˆ¶çš„åŸç†"></a>å¤åˆ¶çš„åŸç†</h3><p>åœ¨è¯¦ç»†ä»‹ç»å¦‚ä½•è®¾ç½®å¤åˆ¶ä¹‹å‰ï¼Œè®©æˆ‘é—¨å…ˆçœ‹çœ‹MySQLå®é™…ä¸Šæ—¶å¦‚ä½•å¤åˆ¶æ•°æ®çš„ã€‚æ€»çš„æ¥è¯´ï¼Œå¤åˆ¶æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li>åœ¨ä¸»åº“ä¸ŠæŠŠæ•°æ®æ›´æ”¹è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary Logï¼‰ä¸­ï¼ˆè¿™å†™è®°å½•è¢«ç§°ä¸ºäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼‰ã€‚</li><li>å¤‡åº“å°†ä¸»åº“çš„æ—¥å¿—å¤åˆ¶åˆ°è‡ªå·±çš„ä¸­ç»§æ—¥å¿—ï¼ˆRelay Logï¼‰ä¸­ã€‚</li><li>å¤‡åº“è¯»å–ä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†å…¶é‡æ”¾/é‡æ¼”åˆ°å¤‡åº“æ•°æ®ä¹‹ä¸Šã€‚</li></ol><p>ä»¥ä¸Šåªæ˜¯æ¦‚è¿°ï¼Œå®é™…å•†æ¯ä¸€æ­¥éƒ½å¾ˆå¤æ‚ï¼Œä¸‹å›¾æ›´è¯¦ç»†åœ°æè¿°äº†å¤åˆ¶çš„ç»†èŠ‚ã€‚</p><p><img src="pic/23-replication-how.png" alt="replication-how"></p><h4 id="é¡¹ç›®å®æˆ˜1ï¼šmariadb-server-5-5-å•ä¸»ä»æ¶æ„"><a href="#é¡¹ç›®å®æˆ˜1ï¼šmariadb-server-5-5-å•ä¸»ä»æ¶æ„" class="headerlink" title="é¡¹ç›®å®æˆ˜1ï¼šmariadb server 5.5 å•ä¸»ä»æ¶æ„"></a>é¡¹ç›®å®æˆ˜1ï¼šmariadb server 5.5 å•ä¸»ä»æ¶æ„</h4><p><img src="pic/62.jpg" alt="62"></p><p><em>å•ä¸»ä»æ­¥éª¤</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># ä¸»æœåŠ¡å™¨</span><br><span class="line">1ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶log-bin server-id&#x3D;1ï¼ˆé‡å¯æœåŠ¡ï¼‰</span><br><span class="line">2ï¼‰æˆæƒä»æœºgrant replication slave to slave@172.25.0.12 uplooking</span><br><span class="line">3ï¼‰åˆå§‹åŒ–æ•°æ®ä¸€è‡´mysqldump---ã€‹ä¼ è¾“ç»™ä»æœºå™¨</span><br><span class="line"></span><br><span class="line"># ä»æœåŠ¡</span><br><span class="line">1ï¼‰install</span><br><span class="line">2ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶server-id&#x3D;2</span><br><span class="line">3ï¼‰åˆå§‹åŒ–æ•°æ®ä¸€è‡´å¯¼å…¥å…¨å¤‡æ•°æ®</span><br><span class="line">4ï¼‰&gt; change master master_host&#x3D;&#39;172.25.0.11&#39;</span><br><span class="line">master_user&#x3D;&#39;slave&#39;</span><br><span class="line">master_password&#x3D;&#39;uplooking&#39;</span><br><span class="line">master_log_file&#x3D;&#39;&#39;</span><br><span class="line">master_log_pos&#x3D;&#39;&#39;</span><br><span class="line">5)&gt; start slave;</span><br><span class="line">6)&gt; show slave status\G;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ä¸»æœåŠ¡å™¨</span></span></span><br><span class="line">[root@mastera0 mysql]# vim /etc/my.cnf</span><br><span class="line">[root@mastera0 mysql]# grep -v '^#' /etc/my.cnf|grep -v '^$'</span><br><span class="line">[mysqld]</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line">symbolic-links=0</span><br><span class="line">log-bin=/var/lib/mysql-log/mastera</span><br><span class="line">server-id=1</span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error=/var/log/mariadb/mariadb.log</span><br><span class="line">pid-file=/var/run/mariadb/mariadb.pid</span><br><span class="line">!includedir /etc/my.cnf.d</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]# systemctl restart mariadb</span><br><span class="line">[root@mastera0 mysql]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; grant replication slave on *.* to slave@'172.25.0.12' identified by 'uplooking';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line">[root@mastera0 mysql]# mysqldump -uroot -puplooking -A --single-transaction --master-data=2 --flush-logs &gt; /tmp/mysql.91.sql</span><br><span class="line">[root@mastera0 mysql]# scp /tmp/mysql.91.sql root@172.25.0.12:/tmp</span><br><span class="line">The authenticity of host \'172.25.0.12 (172.25.0.12)\' can\'t be established.</span><br><span class="line">ECDSA key fingerprint is 91:2b:bd:df:0e:17:da:a0:f6:01:ff:5b:09:50:e8:ad.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added '172.25.0.12' (ECDSA) to the list of known hosts.</span><br><span class="line">root@172.25.0.12\'s password:</span><br><span class="line">mysql.91.sql                                                      100%  505KB 504.7KB/s   00:00    </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ä»æœåŠ¡å™¨</span></span></span><br><span class="line">[root@masterb0 ~]# yum install -y mariadb-server</span><br><span class="line">[root@masterb0 ~]# vi /etc/my.cnf</span><br><span class="line">[root@masterb0 ~]# systemctl start mariadb</span><br><span class="line">[root@masterb0 ~]# mysql &lt; /tmp/mysql.91.sql</span><br><span class="line">[root@masterb0 ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 3</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line">[root@masterb0 ~]# mysql</span><br><span class="line">ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)</span><br><span class="line">[root@masterb0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 5</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; change master to master_host='172.25.0.11',master_user='slave',master_password='uplooking',master_log_file='mastera.000028',MASTER_LOG_POS=245;</span><br><span class="line">Query OK, 0 rows affected (0.21 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; start slave;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show slave status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.11</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mastera.000028</span><br><span class="line">          Read_Master_Log_Pos: 245</span><br><span class="line">               Relay_Log_File: mariadb-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 527</span><br><span class="line">        Relay_Master_Log_File: mastera.000028</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 245</span><br><span class="line">              Relay_Log_Space: 823</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+-----+</span><br><span class="line">| id  |</span><br><span class="line">+-----+</span><br><span class="line">|   3 |</span><br><span class="line">|   4 |</span><br><span class="line">|   5 |</span><br><span class="line">|   6 |</span><br><span class="line">|   7 |</span><br><span class="line">|   8 |</span><br><span class="line">|   9 |</span><br><span class="line">|  10 |</span><br><span class="line">|  11 |</span><br><span class="line">|  12 |</span><br><span class="line">|  13 |</span><br><span class="line">|  14 |</span><br><span class="line">| 100 |</span><br><span class="line">| 101 |</span><br><span class="line">| 102 |</span><br><span class="line">| 103 |</span><br><span class="line">| 777 |</span><br><span class="line">+-----+</span><br><span class="line">17 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure><p><img src="pic/63.jpg" alt=""></p><h4 id="é¡¹ç›®å®æˆ˜2ï¼šmysql-server-5-7-åŸºäºGTIDçš„å•ä¸»ä»æ¶æ„"><a href="#é¡¹ç›®å®æˆ˜2ï¼šmysql-server-5-7-åŸºäºGTIDçš„å•ä¸»ä»æ¶æ„" class="headerlink" title="é¡¹ç›®å®æˆ˜2ï¼šmysql server 5.7 åŸºäºGTIDçš„å•ä¸»ä»æ¶æ„"></a>é¡¹ç›®å®æˆ˜2ï¼šmysql server 5.7 åŸºäºGTIDçš„å•ä¸»ä»æ¶æ„</h4><p><img src="pic/64.jpg" alt=""></p><table><thead><tr><th align="left">server</th><th align="left">ip</th><th align="left">software</th><th align="left">rule</th></tr></thead><tbody><tr><td align="left">masterb</td><td align="left">172.25.0.12</td><td align="left">mysql-server 5.7</td><td align="left">master</td></tr><tr><td align="left">slaveb</td><td align="left">172.25.0.14</td><td align="left">mysql-server 5.7</td><td align="left">slave</td></tr></tbody></table><p>é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Master:</span><br><span class="line">[mysqld]</span><br><span class="line">server-id=1</span><br><span class="line">log-bin=/var/lib/mysql-log/mastera</span><br><span class="line">gitd_mode=on</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line"></span><br><span class="line">Slave:</span><br><span class="line">[mysqld]</span><br><span class="line">server-id=2</span><br><span class="line">gtid_mode=on</span><br><span class="line">enforce_gtid_consistency=1</span><br></pre></td></tr></table></figure><p>å…¶ä»–æ­¥éª¤ä¸é¡¹ç›®å®è·µç±»ä¼¼ï¼Œå†æ¬¡ä¸å†èµ˜è¿°</p><p><img src="pic/65.jpg" alt=""></p><h3 id="å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜-é‡æ¼”å»¶è¿Ÿ"><a href="#å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜-é‡æ¼”å»¶è¿Ÿ" class="headerlink" title="å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜_é‡æ¼”å»¶è¿Ÿ"></a>å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜_é‡æ¼”å»¶è¿Ÿ</h3><ul><li>mysql5.5ä¹‹å‰æ²¡æœ‰è§£å†³æ–¹æ¡ˆâ€”â€”å•çº¿ç¨‹</li><li>mysql5.6ï¼ˆmariadb10ï¼‰å¼€å§‹â€”â€”ä¸€åº“ä¸€çº¿ç¨‹</li><li>mysql5.7ï¼ˆmariadb10.1ï¼‰çœŸæ­£è§£å†³äº†â€”â€”ä¸€ç»„ä¸€çº¿ç¨‹</li></ul><p><img src="pic/32.png" alt=""></p><h4 id="é¡¹ç›®å®æˆ˜3ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„"><a href="#é¡¹ç›®å®æˆ˜3ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„" class="headerlink" title="é¡¹ç›®å®æˆ˜3ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„"></a>é¡¹ç›®å®æˆ˜3ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„</h4><p>MySQL 5.7æ‰å¯ç§°ä¸ºçœŸæ­£çš„å¹¶è¡Œå¤åˆ¶ï¼Œè¿™å…¶ä¸­æœ€ä¸ºä¸»è¦çš„åŸå› å°±æ˜¯slaveæœåŠ¡å™¨çš„å›æ”¾ä¸ä¸»æœºæ˜¯ä¸€è‡´çš„å³masteræœåŠ¡å™¨ä¸Šæ˜¯æ€ä¹ˆå¹¶è¡Œæ‰§è¡Œçš„slaveä¸Šå°±æ€æ ·è¿›è¡Œå¹¶è¡Œå›æ”¾ã€‚</p><p>MTS: Prepared transactions slave parallel applier </p><p>è¯¥å¹¶è¡Œå¤åˆ¶çš„æ€æƒ³æœ€æ—©æ˜¯ç”±MariaDBçš„Kristainæå‡ºï¼Œå¹¶å·²åœ¨MariaDB 10ä¸­å‡ºç°ï¼Œç›¸ä¿¡å¾ˆå¤šé€‰æ‹©MariaDBçš„å°ä¼™ä¼´æœ€ä¸ºçœ‹é‡çš„åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å¹¶è¡Œå¤åˆ¶ã€‚</p><p>MySQL 5.7å¹¶è¡Œå¤åˆ¶çš„æ€æƒ³ç®€å•æ˜“æ‡‚ï¼Œä¸€è¨€ä»¥è”½ä¹‹ï¼šä¸€ä¸ªç»„æäº¤çš„äº‹åŠ¡éƒ½æ˜¯å¯ä»¥å¹¶è¡Œå›æ”¾ï¼Œå› ä¸ºè¿™äº›äº‹åŠ¡éƒ½å·²è¿›å…¥åˆ°äº‹åŠ¡çš„prepareé˜¶æ®µï¼Œåˆ™è¯´æ˜äº‹åŠ¡ä¹‹é—´æ²¡æœ‰ä»»ä½•å†²çªï¼ˆå¦åˆ™å°±ä¸å¯èƒ½æäº¤ï¼‰ã€‚</p><blockquote><h4 id="è®¾ç½®é‡æ¼”æ¨¡å¼slave-parallel-type"><a href="#è®¾ç½®é‡æ¼”æ¨¡å¼slave-parallel-type" class="headerlink" title="è®¾ç½®é‡æ¼”æ¨¡å¼slave-parallel-type"></a>è®¾ç½®é‡æ¼”æ¨¡å¼<code>slave-parallel-type</code></h4></blockquote><p>ä¸ºäº†å…¼å®¹MySQL 5.6åŸºäºåº“çš„å¹¶è¡Œå¤åˆ¶ï¼Œ5.7å¼•å…¥äº†æ–°çš„å˜é‡<code>slave-parallel-type</code>ï¼Œå…¶å¯ä»¥é…ç½®çš„å€¼æœ‰ï¼š</p><ul><li>DATABASEï¼šé»˜è®¤å€¼ï¼ŒåŸºäºåº“çš„å¹¶è¡Œå¤åˆ¶æ–¹å¼</li><li>LOGICAL_CLOCKï¼šåŸºäºç»„æäº¤çš„å¹¶è¡Œå¤åˆ¶æ–¹å¼</li></ul><p>æ”¯æŒå¹¶è¡Œå¤åˆ¶çš„GTID</p><p>last_committed</p><p>sequence_number</p><p>å¹¶è¡Œå¤åˆ¶é…ç½®ä¸è°ƒä¼˜<br>master_info_repository</p><blockquote><h4 id="è®¾ç½®é‡æ¼”çº¿ç¨‹æ•°slave-parallel-workers"><a href="#è®¾ç½®é‡æ¼”çº¿ç¨‹æ•°slave-parallel-workers" class="headerlink" title="è®¾ç½®é‡æ¼”çº¿ç¨‹æ•°slave_parallel_workers"></a>è®¾ç½®é‡æ¼”çº¿ç¨‹æ•°<code>slave_parallel_workers</code></h4></blockquote><ul><li>slave_parallel_workersè®¾ç½®ä¸º0ï¼Œåˆ™MySQL 5.7é€€åŒ–ä¸ºåŸå•çº¿ç¨‹å¤åˆ¶</li><li>slave_parallel_workersè®¾ç½®ä¸º1ï¼Œåˆ™SQLçº¿ç¨‹åŠŸèƒ½è½¬åŒ–ä¸ºcoordinatorçº¿ç¨‹ï¼Œä½†æ˜¯åªæœ‰1ä¸ªworkerçº¿ç¨‹è¿›è¡Œå›æ”¾ï¼Œä¹Ÿæ˜¯å•çº¿ç¨‹å¤åˆ¶ã€‚ç„¶è€Œï¼Œè¿™ä¸¤ç§æ€§èƒ½å´åˆæœ‰ä¸€äº›çš„åŒºåˆ«ï¼Œå› ä¸ºå¤šäº†ä¸€æ¬¡coordinator<br>çº¿ç¨‹çš„è½¬å‘ï¼Œå› æ­¤slave_parallel_workers=1çš„æ€§èƒ½åè€Œæ¯”0è¿˜è¦å·®</li></ul><blockquote><h4 id="Enhanced-Multi-Threaded-Slaveé…ç½®æ€»ç»“"><a href="#Enhanced-Multi-Threaded-Slaveé…ç½®æ€»ç»“" class="headerlink" title="Enhanced Multi-Threaded Slaveé…ç½®æ€»ç»“"></a>Enhanced Multi-Threaded Slaveé…ç½®æ€»ç»“</h4></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> slave</span></span><br><span class="line">slave-parallel-type=LOGICAL_CLOCK</span><br><span class="line">slave-parallel-workers=16</span><br><span class="line">master_info_repository=TABLE</span><br><span class="line">relay_log_info_repository=TABLE</span><br><span class="line">relay_log_recovery=ON</span><br></pre></td></tr></table></figure><p><img src="pic/66.jpg" alt=""></p><blockquote><h4 id="è½¯ä»¶å®‰è£…"><a href="#è½¯ä»¶å®‰è£…" class="headerlink" title="è½¯ä»¶å®‰è£…"></a>è½¯ä»¶å®‰è£…</h4></blockquote><table><thead><tr><th align="left">host</th><th align="left">ip</th><th align="left">software</th></tr></thead><tbody><tr><td align="left">masterb</td><td align="left">172.25.0.12</td><td align="left">mysql-community-server-5.7</td></tr><tr><td align="left">slaveb</td><td align="left">172.25.0.14</td><td align="left">mysql-community-server-5.7</td></tr></tbody></table><blockquote><h4 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># master</span></span></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="meta">#</span><span class="bash"> AB replication</span></span><br><span class="line">server-id=1</span><br><span class="line">log-bin=/var/lib/mysql-log/masterb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> GTID</span></span><br><span class="line">gtid_mode=on</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># slave</span></span></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="meta">#</span><span class="bash"> AB replication</span></span><br><span class="line">server-id=2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> open gtid mode</span></span><br><span class="line">gtid_mode=on</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> MTS ä¸€ç»„ä¸€çº¿ç¨‹</span></span><br><span class="line">slave-parallel-type=logical_clock</span><br><span class="line">slave-parallel-workers=16</span><br></pre></td></tr></table></figure><blockquote><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>MySQL 5.7æ¨å‡ºçš„Enhanced Multi-Threaded Slaveè§£å†³äº†å›°æ‰°MySQLé•¿è¾¾æ•°åå¹´çš„å¤åˆ¶å»¶è¿Ÿé—®é¢˜</p></blockquote><h4 id="é¡¹ç›®å®æˆ˜4ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„crash-safeå‚æ•°è°ƒä¼˜"><a href="#é¡¹ç›®å®æˆ˜4ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„crash-safeå‚æ•°è°ƒä¼˜" class="headerlink" title="é¡¹ç›®å®æˆ˜4ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„crash safeå‚æ•°è°ƒä¼˜"></a>é¡¹ç›®å®æˆ˜4ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„crash safeå‚æ•°è°ƒä¼˜</h4><p>Master<br>sync_binlog=1 #å¼ºåˆ¶åˆ·æ–°binlogåˆ°ç£ç›˜<br>innodb_flush_log_at_trx_commit=1 #å¼ºåˆ¶åˆ·æ–°redologåˆ°ç£ç›˜</p><p>Slave<br>relay_log_recovery=1 #å¦‚æœslaveçš„ä¸­ç»§æ—¥å¿—å‡ºé—®é¢˜ï¼Œèƒ½å¤Ÿå†æ¬¡è‡ªåŠ¨è·å–masterçš„äºŒè¿›åˆ¶æ—¥å¿—</p><blockquote><h4 id="é…ç½®æ–‡ä»¶-1"><a href="#é…ç½®æ–‡ä»¶-1" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># master</span></span></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="meta">#</span><span class="bash"> AB replication</span></span><br><span class="line">server-id=1</span><br><span class="line">log-bin=/var/lib/mysql-log/masterb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> GTID</span></span><br><span class="line">gtid_mode=on</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> crash safe</span></span><br><span class="line">sync_binlog=1</span><br><span class="line">innodb_flush_log_at_trx_commit=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># slave</span></span></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="meta">#</span><span class="bash"> AB replication</span></span><br><span class="line">server-id=2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> open gtid mode</span></span><br><span class="line">gtid_mode=on</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> slave crash</span></span><br><span class="line">relay_log_recovery=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> MTS ä¸€ç»„ä¸€çº¿ç¨‹</span></span><br><span class="line">slave-parallel-type=logical_clock</span><br><span class="line">slave-parallel-workers=16</span><br></pre></td></tr></table></figure><blockquote><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2></blockquote><p>crash safe æ‰“å¼€åèƒ½å¤Ÿæ›´å¥½çš„ä¿è¯åœ¨æ•°æ®åº“å‡ºç°æ–­ç”µç­‰ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ•°æ®å°½å¯èƒ½åœ°å°‘ä¸¢å¤±ï¼</p><h3 id="å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜-è¯»å†™åˆ†ç¦»"><a href="#å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜-è¯»å†™åˆ†ç¦»" class="headerlink" title="å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜_è¯»å†™åˆ†ç¦»"></a>å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜_è¯»å†™åˆ†ç¦»</h3><p><img src="pic/26-rep4.png" alt="rep1"></p><p>ä¸»æœåŠ¡å™¨å†™å…¥ï¼ŒåŒæ­¥åˆ°ä»æœåŠ¡å™¨ï¼Œåœ¨ä»æœåŠ¡å™¨ä¸­è¯»å–æ•°æ®ï¼Œä¸€èˆ¬ä¸€å°ä¸»æœåŠ¡å™¨ï¼Œå¤šå°ä»æœåŠ¡å™¨(5.7ç‰ˆæœ¬ä»¥åæ”¯æŒå¤šmasterï¼Œä¹‹å‰éƒ½æ˜¯ä¸€ä¸ªmaster )</p><p><img src="pic/30.png" alt=""></p><p><img src="pic/24-rep1.png" alt="rep2"></p><p>ä»MySQL5.5å¼€å§‹ï¼ŒMySQLä»¥æ’ä»¶çš„å½¢å¼æ”¯æŒåŠåŒæ­¥å¤åˆ¶ã€‚</p><p>å¼‚æ­¥å¤åˆ¶ï¼ˆAsynchronous replicationï¼‰</p><p>MySQLé»˜è®¤çš„å¤åˆ¶å³æ˜¯å¼‚æ­¥çš„ï¼Œä¸»åº“åœ¨æ‰§è¡Œå®Œå®¢æˆ·ç«¯æäº¤çš„äº‹åŠ¡åä¼šç«‹å³å°†ç»“æœè¿”ç»™ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¸å…³å¿ƒä»åº“æ˜¯å¦å·²ç»æ¥æ”¶å¹¶å¤„ç†ï¼Œè¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸»å¦‚æœcrashæ‰äº†ï¼Œæ­¤æ—¶ä¸»ä¸Šå·²ç»æäº¤çš„äº‹åŠ¡å¯èƒ½å¹¶æ²¡æœ‰ä¼ åˆ°ä»ä¸Šï¼Œå¦‚æœæ­¤æ—¶ï¼Œå¼ºè¡Œå°†ä»æå‡ä¸ºä¸»ï¼Œå¯èƒ½å¯¼è‡´æ–°ä¸»ä¸Šçš„æ•°æ®ä¸å®Œæ•´ã€‚</p><p>å…¨åŒæ­¥å¤åˆ¶ï¼ˆFully synchronous replicationï¼‰</p><p>æŒ‡å½“ä¸»åº“æ‰§è¡Œå®Œä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰€æœ‰çš„ä»åº“éƒ½æ‰§è¡Œäº†è¯¥äº‹åŠ¡æ‰è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å› ä¸ºéœ€è¦ç­‰å¾…æ‰€æœ‰ä»åº“æ‰§è¡Œå®Œè¯¥äº‹åŠ¡æ‰èƒ½è¿”å›ï¼Œæ‰€ä»¥å…¨åŒæ­¥å¤åˆ¶çš„æ€§èƒ½å¿…ç„¶ä¼šæ”¶åˆ°ä¸¥é‡çš„å½±å“ã€‚</p><p>åŠåŒæ­¥å¤åˆ¶ï¼ˆSemisynchronous replicationï¼‰</p><p>ä»‹äºå¼‚æ­¥å¤åˆ¶å’Œå…¨åŒæ­¥å¤åˆ¶ä¹‹é—´ï¼Œä¸»åº“åœ¨æ‰§è¡Œå®Œå®¢æˆ·ç«¯æäº¤çš„äº‹åŠ¡åä¸æ˜¯ç«‹åˆ»è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯ç­‰å¾…è‡³å°‘ä¸€ä¸ªä»åº“æ¥æ”¶åˆ°å¹¶å†™åˆ°relay logä¸­æ‰è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ç›¸å¯¹äºå¼‚æ­¥å¤åˆ¶ï¼ŒåŠåŒæ­¥å¤åˆ¶æé«˜äº†æ•°æ®çš„å®‰å…¨æ€§ï¼ŒåŒæ—¶å®ƒä¹Ÿé€ æˆäº†ä¸€å®šç¨‹åº¦çš„å»¶è¿Ÿï¼Œè¿™ä¸ªå»¶è¿Ÿæœ€å°‘æ˜¯ä¸€ä¸ªTCP/IPå¾€è¿”çš„æ—¶é—´ã€‚æ‰€ä»¥ï¼ŒåŠåŒæ­¥å¤åˆ¶æœ€å¥½åœ¨ä½å»¶æ—¶çš„ç½‘ç»œä¸­ä½¿ç”¨ã€‚</p><h4 id="åŠåŒæ­¥å¤åˆ¶çš„æ½œåœ¨é—®é¢˜"><a href="#åŠåŒæ­¥å¤åˆ¶çš„æ½œåœ¨é—®é¢˜" class="headerlink" title="åŠåŒæ­¥å¤åˆ¶çš„æ½œåœ¨é—®é¢˜"></a>åŠåŒæ­¥å¤åˆ¶çš„æ½œåœ¨é—®é¢˜</h4><p>å®¢æˆ·ç«¯äº‹åŠ¡åœ¨å­˜å‚¨å¼•æ“å±‚æäº¤åï¼Œåœ¨å¾—åˆ°ä»åº“ç¡®è®¤çš„è¿‡ç¨‹ä¸­ï¼Œä¸»åº“å®•æœºäº†ï¼Œæ­¤æ—¶ï¼Œå¯èƒ½çš„æƒ…å†µæœ‰ä¸¤ç§</p><p>1.äº‹åŠ¡è¿˜æ²¡å‘é€åˆ°ä»åº“ä¸Š</p><p>æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°äº‹åŠ¡æäº¤å¤±è´¥çš„ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯ä¼šé‡æ–°æäº¤è¯¥äº‹åŠ¡åˆ°æ–°çš„ä¸»ä¸Šï¼Œå½“å®•æœºçš„ä¸»åº“é‡æ–°å¯åŠ¨åï¼Œä»¥ä»åº“çš„èº«ä»½é‡æ–°åŠ å…¥åˆ°è¯¥ä¸»ä»ç»“æ„ä¸­ï¼Œä¼šå‘ç°ï¼Œè¯¥äº‹åŠ¡åœ¨ä»åº“ä¸­è¢«æäº¤äº†ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯ä¹‹å‰ä½œä¸ºä¸»çš„æ—¶å€™ï¼Œä¸€æ¬¡æ˜¯è¢«æ–°ä¸»åŒæ­¥è¿‡æ¥çš„ã€‚</p><p>2.äº‹åŠ¡å·²ç»å‘é€åˆ°ä»åº“ä¸Š</p><p>æ­¤æ—¶ï¼Œä»åº“å·²ç»æ”¶åˆ°å¹¶åº”ç”¨äº†è¯¥äº‹åŠ¡ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä»ç„¶ä¼šæ”¶åˆ°äº‹åŠ¡æäº¤å¤±è´¥çš„ä¿¡æ¯ï¼Œé‡æ–°æäº¤è¯¥äº‹åŠ¡åˆ°æ–°çš„ä¸»ä¸Šã€‚</p><h4 id="æ— æ•°æ®ä¸¢å¤±çš„åŠåŒæ­¥å¤åˆ¶"><a href="#æ— æ•°æ®ä¸¢å¤±çš„åŠåŒæ­¥å¤åˆ¶" class="headerlink" title="æ— æ•°æ®ä¸¢å¤±çš„åŠåŒæ­¥å¤åˆ¶"></a>æ— æ•°æ®ä¸¢å¤±çš„åŠåŒæ­¥å¤åˆ¶</h4><p>é’ˆå¯¹ä¸Šè¿°æ½œåœ¨é—®é¢˜ï¼ŒMySQL 5.7å¼•å…¥äº†ä¸€ç§æ–°çš„åŠåŒæ­¥æ–¹æ¡ˆï¼šLoss-LessåŠåŒæ­¥å¤åˆ¶ã€‚</p><p>å½“ç„¶ï¼Œä¹‹å‰çš„åŠåŒæ­¥æ–¹æ¡ˆåŒæ ·æ”¯æŒï¼ŒMySQL 5.7.2å¼•å…¥äº†ä¸€ä¸ªæ–°çš„å‚æ•°è¿›è¡Œæ§åˆ¶-<code>rpl_semi_sync_master_wait_point</code></p><p>rpl_semi_sync_master_wait_pointæœ‰ä¸¤ç§å–å€¼</p><p><code>AFTER_SYNC</code> è¿™ä¸ªå³æ–°çš„åŠåŒæ­¥æ–¹æ¡ˆï¼ŒWaiting Slave dumpåœ¨Storage Commitä¹‹å‰ã€‚</p><p><code>AFTER_COMMIT</code> è€çš„åŠåŒæ­¥æ–¹æ¡ˆ</p><h4 id="é¡¹ç›®å®æˆ˜5ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»åŠåŒæ­¥æ¶æ„"><a href="#é¡¹ç›®å®æˆ˜5ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»åŠåŒæ­¥æ¶æ„" class="headerlink" title="é¡¹ç›®å®æˆ˜5ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»åŠåŒæ­¥æ¶æ„"></a>é¡¹ç›®å®æˆ˜5ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»åŠåŒæ­¥æ¶æ„</h4><p>è¦æƒ³ä½¿ç”¨åŠåŒæ­¥å¤åˆ¶ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š</p><ol><li><p>MySQL 5.5åŠä»¥ä¸Šç‰ˆæœ¬</p></li><li><p>å˜é‡have_dynamic_loadingä¸ºYES</p></li><li><p>å¼‚æ­¥å¤åˆ¶å·²ç»å­˜åœ¨</p></li></ol><p><img src="pic/31.png" alt="31.png"></p><blockquote><h4 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h4></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> install plugin rpl_semi_sync_master soname <span class="string">'semisync_master.so'</span>;</span></span><br><span class="line">Query OK, 0 rows affected (0.10 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> install plugin rpl_semi_sync_slave soname <span class="string">'semisync_slave.so'</span>;</span></span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br></pre></td></tr></table></figure><blockquote><h4 id="é…ç½®æ–‡ä»¶-2"><a href="#é…ç½®æ–‡ä»¶-2" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># master</span></span></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="meta">#</span><span class="bash"> AB replication</span></span><br><span class="line">server-id=1</span><br><span class="line">log-bin=/var/lib/mysql-log/masterb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> GTID</span></span><br><span class="line">gtid_mode=on</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> crash safe</span></span><br><span class="line">sync_binlog=1</span><br><span class="line">innodb_flush_log_at_trx_commit=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åŠåŒæ­¥æ¨¡å¼</span></span><br><span class="line">rpl_semi_sync_master_enabled=1</span><br><span class="line">rpl_semi_sync_master_timeout=1000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># slave</span></span></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="meta">#</span><span class="bash"> AB replication</span></span><br><span class="line">server-id=2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> open gtid mode</span></span><br><span class="line">gtid_mode=on</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> slave crash</span></span><br><span class="line">relay_log_recovery=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> MTS ä¸€ç»„ä¸€çº¿ç¨‹</span></span><br><span class="line">slave-parallel-type=logical_clock</span><br><span class="line">slave-parallel-workers=16</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åŠåŒæ­¥æ¨¡å¼</span></span><br><span class="line">rpl_semi_sync_slave_enabled=1</span><br></pre></td></tr></table></figure><blockquote><h4 id="æµ‹è¯•åŠåŒæ­¥å¤åˆ¶è¶…æ—¶åè‡ªåŠ¨åˆ‡æ¢å›å¼‚æ­¥æ¨¡å¼"><a href="#æµ‹è¯•åŠåŒæ­¥å¤åˆ¶è¶…æ—¶åè‡ªåŠ¨åˆ‡æ¢å›å¼‚æ­¥æ¨¡å¼" class="headerlink" title="æµ‹è¯•åŠåŒæ­¥å¤åˆ¶è¶…æ—¶åè‡ªåŠ¨åˆ‡æ¢å›å¼‚æ­¥æ¨¡å¼"></a>æµ‹è¯•åŠåŒæ­¥å¤åˆ¶è¶…æ—¶åè‡ªåŠ¨åˆ‡æ¢å›å¼‚æ­¥æ¨¡å¼</h4></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create database db1;</span></span><br><span class="line">Query OK, 1 row affected (0.06 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table db1.t1 (id int);</span></span><br><span class="line">Query OK, 0 rows affected (0.26 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into db1.t1 values (1);</span></span><br><span class="line">Query OK, 1 row affected (0.23 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†slaveå…³é—­åå†æ‰§è¡Œä»¥ä¸‹æ“ä½œ</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into db1.t1 values (2);</span></span><br><span class="line">Query OK, 1 row affected (1.19 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into db1.t1 values (3);</span></span><br><span class="line">Query OK, 1 row affected (0.36 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into db1.t1 values (4);</span></span><br><span class="line">Query OK, 1 row affected (0.08 sec)</span><br></pre></td></tr></table></figure><p>å¦‚æœä»æœºæƒ³å›åˆ°åŠå¼‚æ­¥æ¨¡å¼ï¼Œéœ€è¦é‡å¯slaveï¼Œå¦åˆ™é»˜è®¤è¿˜æ˜¯å¼‚æ­¥å¤åˆ¶ã€‚</p><blockquote><h4 id="ç›‘æ§ä¸»ä»æ˜¯å¦è¿è¡Œåœ¨åŠåŒæ­¥å¤åˆ¶æ¨¡å¼ä¸‹"><a href="#ç›‘æ§ä¸»ä»æ˜¯å¦è¿è¡Œåœ¨åŠåŒæ­¥å¤åˆ¶æ¨¡å¼ä¸‹" class="headerlink" title="ç›‘æ§ä¸»ä»æ˜¯å¦è¿è¡Œåœ¨åŠåŒæ­¥å¤åˆ¶æ¨¡å¼ä¸‹"></a>ç›‘æ§ä¸»ä»æ˜¯å¦è¿è¡Œåœ¨åŠåŒæ­¥å¤åˆ¶æ¨¡å¼ä¸‹</h4></blockquote><ul><li><code>show status like &#39;rpl_semi_sync_master_status&#39;;</code></li><li><code>show status like &#39;rpl_semi_sync_slave_status&#39;;</code></li></ul><blockquote><h4 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h4></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show variables like <span class="string">'%Rpl%'</span>;</span></span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line">| Variable_name                             | Value      |</span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line">| rpl_semi_sync_master_enabled              | ON         |</span><br><span class="line">| rpl_semi_sync_master_timeout              | 10000      |</span><br><span class="line">| rpl_semi_sync_master_trace_level          | 32         |</span><br><span class="line">| rpl_semi_sync_master_wait_for_slave_count | 1          |</span><br><span class="line">| rpl_semi_sync_master_wait_no_slave        | ON         |</span><br><span class="line">| rpl_semi_sync_master_wait_point           | AFTER_SYNC |</span><br><span class="line">| rpl_stop_slave_timeout                    | 31536000   |</span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line">7 rows in set (0.30 sec)</span><br></pre></td></tr></table></figure><p><code>rpl_semi_sync_master_wait_for_slave_count</code></p><p>MySQL 5.7.3å¼•å…¥çš„ï¼Œè¯¥å˜é‡è®¾ç½®ä¸»éœ€è¦ç­‰å¾…å¤šå°‘ä¸ªslaveåº”ç­”ï¼Œæ‰èƒ½è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œé»˜è®¤ä¸º1ã€‚</p><p><code>rpl_semi_sync_master_wait_no_slave</code></p><p>ON</p><p>é»˜è®¤å€¼ï¼Œå½“çŠ¶æ€å˜é‡Rpl_semi_sync_master_clientsä¸­çš„å€¼å°äºrpl_semi_sync_master_wait_for_slave_countæ—¶ï¼ŒRpl_semi_sync_master_statusä¾æ—§æ˜¾ç¤ºä¸ºONã€‚</p><p>OFF</p><p>å½“çŠ¶æ€å˜é‡Rpl_semi_sync_master_clientsä¸­çš„å€¼äºrpl_semi_sync_master_wait_for_slave_countæ—¶ï¼ŒRpl_semi_sync_master_statusç«‹å³æ˜¾ç¤ºä¸ºOFFï¼Œå³å¼‚æ­¥å¤åˆ¶ã€‚</p><p>è¯´å¾—ç›´ç™½ä¸€ç‚¹ï¼Œå¦‚æœæˆ‘çš„æ¶æ„æ˜¯1ä¸»2ä»ï¼Œ2ä¸ªä»éƒ½é‡‡ç”¨äº†åŠåŒæ­¥å¤åˆ¶ï¼Œä¸”è®¾ç½®çš„æ˜¯rpl_semi_sync_master_wait_for_slave_count=2ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæŒ‚æ‰äº†ï¼Œå¯¹äºrpl_semi_sync_master_wait_no_slaveè®¾ç½®ä¸ºONçš„æƒ…å†µï¼Œæ­¤æ—¶æ˜¾ç¤ºçš„ä»ç„¶æ˜¯åŠåŒæ­¥å¤åˆ¶ï¼Œå¦‚æœrpl_semi_sync_master_wait_no_slaveè®¾ç½®ä¸ºOFFï¼Œåˆ™ä¼šç«‹åˆ»å˜æˆå¼‚æ­¥å¤åˆ¶ã€‚</p><blockquote><h4 id="çŠ¶æ€å˜é‡"><a href="#çŠ¶æ€å˜é‡" class="headerlink" title="çŠ¶æ€å˜é‡"></a>çŠ¶æ€å˜é‡</h4></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show status like <span class="string">'%Rpl_semi%'</span>;</span></span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name                              | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients               | 1     |</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_waits             | 6     |</span><br><span class="line">| Rpl_semi_sync_master_no_times              | 1     |</span><br><span class="line">| Rpl_semi_sync_master_no_tx                 | 1     |</span><br><span class="line">| Rpl_semi_sync_master_status                | ON    |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time      | 1120  |</span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time          | 4483  |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits              | 4     |</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx                | 4     |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°çŠ¶æ€å˜é‡ä¸­ï¼Œæ¯”è¾ƒé‡è¦çš„æœ‰ä»¥ä¸‹å‡ ä¸ª</p><p><code>Rpl_semi_sync_master_clients</code></p><p>å½“å‰åŠåŒæ­¥å¤åˆ¶ä»çš„ä¸ªæ•°ï¼Œå¦‚æœæ˜¯ä¸€ä¸»å¤šä»çš„æ¶æ„ï¼Œå¹¶ä¸åŒ…å«å¼‚æ­¥å¤åˆ¶ä»çš„ä¸ªæ•°ã€‚</p><p><code>Rpl_semi_sync_master_no_tx</code></p><p>The number of commits that were not acknowledged successfully by a slave.</p><p>å…·ä½“åˆ°ä¸Šé¢çš„æµ‹è¯•ä¸­ï¼ŒæŒ‡çš„æ˜¯insert into test.test values(2)è¿™ä¸ªäº‹åŠ¡ã€‚</p><p><code>Rpl_semi_sync_master_yes_tx</code></p><p>The number of commits that were acknowledged successfully by a slave.</p><blockquote><h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3></blockquote><ol><li><p>åœ¨ä¸€ä¸»å¤šä»çš„æ¶æ„ä¸­ï¼Œå¦‚æœè¦å¼€å¯åŠåŒæ­¥å¤åˆ¶ï¼Œå¹¶ä¸è¦æ±‚æ‰€æœ‰çš„ä»éƒ½æ˜¯åŠåŒæ­¥å¤åˆ¶ã€‚</p></li><li><p>MySQL 5.7æå¤§çš„æå‡äº†åŠåŒæ­¥å¤åˆ¶çš„æ€§èƒ½ã€‚</p><p> 5.6ç‰ˆæœ¬çš„åŠåŒæ­¥å¤åˆ¶ï¼Œdump thread æ‰¿æ‹…äº†ä¸¤ä»½ä¸åŒä¸”åˆååˆ†é¢‘ç¹çš„ä»»åŠ¡ï¼šä¼ é€binlog ç»™slave ï¼Œè¿˜éœ€è¦ç­‰å¾…slaveåé¦ˆä¿¡æ¯ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªä»»åŠ¡æ˜¯ä¸²è¡Œçš„ï¼Œdump thread å¿…é¡»ç­‰å¾… slave è¿”å›ä¹‹åæ‰ä¼šä¼ é€ä¸‹ä¸€ä¸ª events äº‹åŠ¡ã€‚dump thread å·²ç„¶æˆä¸ºæ•´ä¸ªåŠåŒæ­¥æé«˜æ€§èƒ½çš„ç“¶é¢ˆã€‚åœ¨é«˜å¹¶å‘ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œè¿™æ ·çš„æœºåˆ¶ä¼šå½±å“æ•°æ®åº“æ•´ä½“çš„TPS ã€‚</p><p> 5.7ç‰ˆæœ¬çš„åŠåŒæ­¥å¤åˆ¶ä¸­ï¼Œç‹¬ç«‹å‡ºä¸€ä¸ª ack collector thread ï¼Œä¸“é—¨ç”¨äºæ¥æ”¶slave çš„åé¦ˆä¿¡æ¯ã€‚è¿™æ ·master ä¸Šæœ‰ä¸¤ä¸ªçº¿ç¨‹ç‹¬ç«‹å·¥ä½œï¼Œå¯ä»¥åŒæ—¶å‘é€binlog åˆ°slave ï¼Œå’Œæ¥æ”¶slaveçš„åé¦ˆã€‚ </p></li></ol><h3 id="å¤åˆ¶ä¸­çš„å•ç‚¹æ•…éšœé—®é¢˜"><a href="#å¤åˆ¶ä¸­çš„å•ç‚¹æ•…éšœé—®é¢˜" class="headerlink" title="å¤åˆ¶ä¸­çš„å•ç‚¹æ•…éšœé—®é¢˜"></a>å¤åˆ¶ä¸­çš„å•ç‚¹æ•…éšœé—®é¢˜</h3><h4 id="å¤åˆ¶æ‹“æ‰‘-é…ç½®M-S-S"><a href="#å¤åˆ¶æ‹“æ‰‘-é…ç½®M-S-S" class="headerlink" title="å¤åˆ¶æ‹“æ‰‘_é…ç½®M-S-S"></a>å¤åˆ¶æ‹“æ‰‘_é…ç½®M-S-S</h4><p>æœ‰å¾ˆå¤šå¤æ‚çš„æ‹“æ‰‘ç»“æ„ï¼Œä½†å³ä½¿æ˜¯æœ€ç®€å•çš„ä¹Ÿå¯èƒ½ä¼šéå¸¸çµæ´»ã€‚ä¸€ç§æ‹“æ‰‘å¯ä»¥æœ‰å¤šç§ç”¨é€”ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è®¨è®ºä¸€äº›æ¯”è¾ƒæ™®éçš„æ‹“æ‰‘ç»“æ„ä»¥åŠå®ƒä»¬çš„ä¼˜ç¼ºç‚¹ã€‚è®°ä½ä¸‹é¢çš„åŸºæœ¬åŸåˆ™ï¼š</p><ul><li>æ¯ä¸ªå¤‡åº“å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„æœåŠ¡å™¨ID</li><li>ä¸€ä¸ªä¸»åº“å¯ä»¥æœ‰å¤šä¸ªå¤‡åº“</li><li>mysql5.7å¼€å§‹ä¸€ä¸ªå¤‡åº“å¯ä»¥æœ‰å¤šä¸ªä¸»åº“(multisource replication)</li><li>å¦‚æœæ‰“å¼€äº†log_save_updatesé€‰é¡¹ï¼Œä¸€ä¸ªå¤‡åº“å¯ä»¥æŠŠå…¶ä¸»åº“ä¸Šçš„æ•°æ®å˜åŒ–ä¼ æ’­åˆ°å…¶ä»–å¤‡åº“</li></ul><p>ä¸€ä¸»åº“å¤šå¤‡åº“çš„ç»“æ„ï¼Œå¤‡åº“ä¹‹é—´æ²¡æœ‰äº¤äº’ï¼Œå®ƒä»¬ä»…ä»…æ˜¯è¿æ¥åˆ°åŒä¸€ä¸ªä¸»åº“ä¸Šã€‚</p><p><img src="pic/26-rep5.png" alt="rep5"></p><p>å°½ç®¡è¿™æ˜¯éå¸¸ç®€å•çš„æ‹“æ‰‘ç»“æ„ï¼Œä½†å®ƒéå¸¸çµæ´»ï¼Œèƒ½æ»¡è¶³å¤šç§éœ€æ±‚ã€‚</p><p><em>ç”¨é€”ï¼š</em></p><ul><li>ä¸ºä¸åŒçš„è§’è‰²ä½¿ç”¨ä¸åŒçš„å¤‡åº“ï¼ˆä¾‹å¦‚æ·»åŠ ä¸åŒçš„ç´¢å¼•æˆ–ä½¿ç”¨ä¸åŒçš„å­˜å‚¨å¼•æ“ï¼‰ã€‚</li><li>æŠŠä¸€å°å¤‡åº“å½“ä½œå¾…ç”¨çš„ä¸»åº“ï¼Œé™¤äº†å¤åˆ¶æ²¡æœ‰å…¶ä»–æ•°æ®ä¼ è¾“ã€‚</li><li>å°†ä¸€å°å¤‡åº“æ”¾åˆ°è¿œç¨‹æ•°æ®ä¸­å¿ƒï¼Œç”¨ä½œç¾éš¾æ¢å¤ã€‚</li><li>å»¶è¿Ÿä¸€ä¸ªæˆ–å¤šä¸ªå¤‡åº“ï¼Œä»¥å¤‡ç¾éš¾æ¢å¤ã€‚</li><li>ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªå¤‡åº“ï¼Œä½œä¸ºå¤‡ä»½ã€åŸ¹è®­æˆ–è€…æµ‹è¯•ä½¿ç”¨æœåŠ¡å™¨ã€‚</li></ul><p><em>ä¼˜ç‚¹</em> ï¼šé¿å…äº†å¾ˆå¤šå…¶ä»–æ‹“æ‰‘ç»“æ„çš„å¤æ‚æ€§ã€‚</p><h4 id="å¤åˆ¶æ‹“æ‰‘-é…ç½®M-M"><a href="#å¤åˆ¶æ‹“æ‰‘-é…ç½®M-M" class="headerlink" title="å¤åˆ¶æ‹“æ‰‘_é…ç½®M-M"></a>å¤åˆ¶æ‹“æ‰‘_é…ç½®M-M</h4><p><em>ä¸»ä¸»å¤åˆ¶ï¼ˆä¹Ÿå«åšåŒä¸»å¤åˆ¶æˆ–åŒå‘å¤åˆ¶ï¼‰</em> åŒ…å«ä¸¤å°æœåŠ¡å™¨ï¼Œæ¯ä¸€ä¸ªéƒ½è¢«é…ç½®æˆå¯¹æ–¹çš„ä¸»åº“å’Œå¤‡åº“ï¼Œè¿˜å¥è¯è¯´ï¼Œå®ƒä»¬æ˜¯ä¸€å¯¹ä¸»åº“ã€‚</p><p><img src="pic/26-rep6.png" alt="rep6"></p><p><em>åº”ç”¨åœºæ™¯</em> é€šå¸¸ç”¨äºç‰¹æ®Šçš„ç›®çš„ã€‚ä¸€ä¸ªå¯èƒ½çš„åº”ç”¨åœºæ™¯æ˜¯ä¸¤ä¸ªä½äºä¸åŒåœ°ç†ä½ç½®çš„åŠå…¬å®¤ï¼Œå¹¶ä¸”éƒ½éœ€è¦ä¸€ä»½å¯å†™çš„æ•°æ®æ‹·è´ã€‚</p><p><em>æœ€å¤§çš„é—®é¢˜</em> ä¸¤ä¸ªå¯å†™çš„äº’ä¸»æœåŠ¡å™¨å¯¼è‡´çš„é—®é¢˜éå¸¸å¤šã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨ä¸¤å°æœåŠ¡å™¨åŒæ—¶ä¿®æ”¹ä¸€è¡Œè®°å½•ï¼Œæˆ–åŒæ—¶åœ¨é‡å¤ªæœåŠ¡å™¨ä¸Šå‘ä¸€ä¸ªåŒ…å«<code>auto_increment</code>åˆ—çš„è¡¨é‡Œæ’å…¥æ•°æ®ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œå…è®¸å‘ä¸¤å°æœåŠ¡å™¨ä¸Šå†™å¦‚å¸¦æ¥çš„éº»çƒ¦è¿œè¿œå¤§äºå…¶å¸¦æ¥çš„å¥½å¤„ã€‚</p><p><em>åŒä¸»æ­¥éª¤</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mastera masterb</span><br><span class="line">ä¸»      ä»     å·²å®Œæˆ</span><br><span class="line">ä»      ä¸»</span><br><span class="line"># ä¸»æœåŠ¡å™¨ masterb</span><br><span class="line">1ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶log-bin&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql-log&#x2F;masterb</span><br><span class="line">server-id&#x3D;2ï¼ˆé‡å¯æœåŠ¡ï¼‰</span><br><span class="line">mkdir &#x2F;var&#x2F;lib&#x2F;mysql-log&#x2F;--ugo,selinux</span><br><span class="line">2)&gt; show master status\G;</span><br><span class="line"></span><br><span class="line"># ä»æœåŠ¡ mastera</span><br><span class="line">1ï¼‰æˆæƒä»æœºgrant replication slave to slave@172.25.0.11 uplooking   </span><br><span class="line">(masterb &gt; show grants for slave@172.25.0.11;)</span><br><span class="line">2ï¼‰&gt; change master master_host&#x3D;&#39;172.25.0.12&#39;</span><br><span class="line">master_user&#x3D;&#39;slave&#39;</span><br><span class="line">master_password&#x3D;&#39;uplooking&#39;</span><br><span class="line">master_log_file&#x3D;&#39;&#39;</span><br><span class="line">master_log_pos&#x3D;&#39;&#39;</span><br><span class="line">3)&gt; start slave;</span><br><span class="line">4)&gt; show slave status\G;</span><br><span class="line">5)æµ‹è¯•</span><br></pre></td></tr></table></figure><blockquote><p>å®ç° mariadb 5.5 MySQL AB å¤åˆ¶ M-Méƒ¨ç½²</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åŒä¸»ä»</span></span><br><span class="line">[root@masterb0 ~]# vi /etc/my.cnf</span><br><span class="line">[root@masterb0 ~]# grep -v '^#' /etc/my.cnf|grep -v '^$'</span><br><span class="line">[mysqld]</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line">symbolic-links=0</span><br><span class="line">server-id=2</span><br><span class="line">log-bin=/var/lib/mysql-log/masterb</span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error=/var/log/mariadb/mariadb.log</span><br><span class="line">pid-file=/var/run/mariadb/mariadb.pid</span><br><span class="line">!includedir /etc/my.cnf.d</span><br><span class="line"></span><br><span class="line">[root@masterb0 ~]# mkdir /var/lib/mysql-log/</span><br><span class="line">[root@masterb0 ~]# chown mysql. /var/lib/mysql-log/</span><br><span class="line">[root@masterb0 ~]# getenforce</span><br><span class="line">Permissive</span><br><span class="line">[root@masterb0 ~]# systemctl restart mariadb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># é€šè¿‡åœ¨masteraä¸Šæ·»åŠ æˆæƒï¼ŒåŒæ­¥ç»™masterbï¼Œå…è®¸masteraå¯¹masterbæœ‰replication slaveçš„æƒé™</span></span></span><br><span class="line"></span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 7</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; grant replication slave on *.* to slave@'172.25.0.11' identified by 'uplooking';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># åˆ°masterbä¸Šæ£€æŸ¥æ˜¯å¦å·²ç»åŒæ­¥åˆ°å¯¹masteraçš„æˆæƒä¿¡æ¯</span></span></span><br><span class="line"></span><br><span class="line">[root@masterb0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 4</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show grants for slave@172.25.0.11;</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Grants for slave@172.25.0.11                                                                                               |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| GRANT REPLICATION SLAVE ON *.* TO 'slave'@'172.25.0.11' IDENTIFIED BY PASSWORD '*6FF883623B8639D08083FF411D20E6856EB7D2BF' |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æŸ¥çœ‹å½“å‰masterbçš„æ—¥å¿—å†™åˆ°å“ªé‡Œäº†ï¼Œå“ªä¸ªä½ç½®äº†</span></span></span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show master status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">            File: masterb.000001</span><br><span class="line">        Position: 245</span><br><span class="line">    Binlog_Do_DB:</span><br><span class="line">Binlog_Ignore_DB:</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># åœ¨masteraä¸Šæ“ä½œï¼Œchange master to</span></span></span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; change master to master_host='172.25.0.12',master_user='slave',master_password='uplooking',master_log_file='masterb.000001',master_log_pos=245;</span><br><span class="line">Query OK, 0 rows affected (0.20 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; start slave;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show slave status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.12</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: masterb.000001</span><br><span class="line">          Read_Master_Log_Pos: 245</span><br><span class="line">               Relay_Log_File: mariadb-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 527</span><br><span class="line">        Relay_Master_Log_File: masterb.000001</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 245</span><br><span class="line">              Relay_Log_Space: 823</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 2</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æµ‹è¯• åœ¨masterbä¸Šå†™æ•°æ®ï¼Œæµ‹è¯•masteraæ˜¯å¦èƒ½å¤ŸåŒæ­¥åˆ°</span></span></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values (100);</span><br><span class="line">Query OK, 1 row affected (0.06 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># åœ¨masteraä¸ŠæŸ¥çœ‹db1.t1è¡¨æ˜¯å¦åŒæ­¥åˆ°æ•°æ®äº†</span></span></span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+-----+</span><br><span class="line">| id  |</span><br><span class="line">+-----+</span><br><span class="line">|   1 |</span><br><span class="line">|   2 |</span><br><span class="line">| 100 |</span><br><span class="line">+-----+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values (100);</span><br><span class="line">Query OK, 1 row affected (0.06 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+-----+</span><br><span class="line">| id  |</span><br><span class="line">+-----+</span><br><span class="line">|   1 |</span><br><span class="line">|   2 |</span><br><span class="line">| 100 |</span><br><span class="line">+-----+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br></pre></td></tr></table></figure><hr><h4 id="å¤åˆ¶æ‹“æ‰‘-é…ç½®M-s-M-s"><a href="#å¤åˆ¶æ‹“æ‰‘-é…ç½®M-s-M-s" class="headerlink" title="å¤åˆ¶æ‹“æ‰‘_é…ç½®M(s)-M(s)"></a>å¤åˆ¶æ‹“æ‰‘_é…ç½®M(s)-M(s)</h4><p><em>æ‹¥æœ‰å¤‡åº“çš„ä¸»-ä¸»ç»“æ„</em> ä¸ºæ¯ä¸ªä¸»åº“å¢åŠ ä¸€ä¸ªå¤‡åº“ã€‚</p><p><img src="pic/26-rep7.png" alt="rep7"></p><p>è¯¥é…ç½®çš„ä¼˜ç‚¹æ˜¯å¢åŠ äº†å†—ä½™ï¼Œå¯¹äºä¸åŒç‰©ç†ä½ç½®çš„å¤åˆ¶æ‹“æ‰‘ï¼Œèƒ½å¤Ÿæ¶ˆé™¤ç«™ç‚¹å•ç‚¹å¤±æ•ˆçš„é—®é¢˜ã€‚è¿˜èƒ½åšè¯»å†™åˆ†ç¦»ã€‚</p><p>å¦‚æœåœ¨æœ¬åœ°ä¸ºäº†æ•…éšœè½¬ç§»ä½¿ç”¨ä¸»-ä¸»ç»“æ„ï¼Œè¿™ç§é…ç½®åŒæ ·æœ‰ç”¨ã€‚å½“ä¸»åº“å¤±æ•ˆæ—¶ï¼Œç”¨å¤‡åº“æ¥ä»£æ›¿ä¸»åº“è¿˜æ˜¯å¯è¡Œçš„ï¼Œè™½ç„¶è¿™ä¼˜ç‚¹å¤æ‚ï¼ŒåŒæ ·ä¹Ÿåº“ä¸€æŠŠå¤‡åº“æŒ‡å‘ä¸€ä¸ªä¸åŒçš„ä¸»åº“ï¼Œä½†éœ€è¦è€ƒè™‘å¢åŠ çš„å¤æ‚åº¦ã€‚</p><h4 id="å¤åˆ¶æ‹“æ‰‘-é…ç½®M-M-S-S"><a href="#å¤åˆ¶æ‹“æ‰‘-é…ç½®M-M-S-S" class="headerlink" title="å¤åˆ¶æ‹“æ‰‘_é…ç½®M-M-S-S"></a>å¤åˆ¶æ‹“æ‰‘_é…ç½®M-M-S-S</h4><p><em>MySQL 5.7 å¼€å§‹æ”¯æŒå¤šä¸»åº“å¤åˆ¶</em> å¤šä¸»åº“å¤åˆ¶ï¼ˆmultisource replicationï¼‰ç‰¹æŒ‡ä¸€ä¸ªå¤‡åº“æœ‰å¤šä¸ªä¸»åº“ã€‚5.7å¼€å§‹æ”¯æŒçš„ï¼Œæ„å‘³ç€5.7ä¹‹å‰çš„ç‰ˆæœ¬ä¸æ”¯æŒã€‚</p><h5 id="é¡¹ç›®å®æˆ˜6ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå¤šçº§ä¸»ä»-Multisource-åŠåŒæ­¥æ¶æ„"><a href="#é¡¹ç›®å®æˆ˜6ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå¤šçº§ä¸»ä»-Multisource-åŠåŒæ­¥æ¶æ„" class="headerlink" title="é¡¹ç›®å®æˆ˜6ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå¤šçº§ä¸»ä» Multisource åŠåŒæ­¥æ¶æ„"></a>é¡¹ç›®å®æˆ˜6ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå¤šçº§ä¸»ä» Multisource åŠåŒæ­¥æ¶æ„</h5><p><img src="pic/70.png" alt=""></p><table><thead><tr><th align="left">æœåŠ¡å™¨</th><th align="left">ip</th><th align="left">åŠŸèƒ½</th><th align="left">è½¯ä»¶</th></tr></thead><tbody><tr><td align="left">mastera</td><td align="left">172.25.0.11</td><td align="left">ä¸»</td><td align="left">mysql-community-client 5.7</td></tr><tr><td align="left">masterb</td><td align="left">172.25.0.12</td><td align="left">ä¸»</td><td align="left">mysql-community-client 5.7</td></tr><tr><td align="left">slavea</td><td align="left">172.25.0.13</td><td align="left">ä»</td><td align="left">mysql-community-client 5.7</td></tr><tr><td align="left">slaveb</td><td align="left">172.25.0.14</td><td align="left">ä»</td><td align="left">mysql-community-client 5.7</td></tr></tbody></table><blockquote><p>å®‰è£…è½¯ä»¶</p></blockquote><ol><li>æ“ä½œç³»ç»Ÿ RHEL7.2</li><li>ä¸‹è½½è½¯ä»¶ï¼ˆrpmï¼›æœ¬åœ°yumæºï¼› åœ¨çº¿yumæºï¼›ï¼‰<pre><code>http://classroom.example.com/materials/mysql-5.7.repo</code></pre></li><li>/etc/yum.repos.d/</li><li>yum clean all;yum makecache</li><li>yum list|grep mysql<pre><code>mysql-community-server 5.7</code></pre></li><li>yum install â€”-æŠ¥é”™ï¼Œè½¯ä»¶å†²çªï¼šmariadb-libs 5.5 /var/lib/mysql/*</li><li>rpm -e â€“nodeps mariadb-libs</li></ol><blockquote><p>æœåŠ¡å™¨ç«¯</p></blockquote><table><thead><tr><th align="left">é¡¹ç›®å</th><th align="left">å†…å®¹</th></tr></thead><tbody><tr><td align="left">è½¯ä»¶å</td><td align="left">mysql-community-server 5.7</td></tr><tr><td align="left">service</td><td align="left">mysqld</td></tr><tr><td align="left">daemon</td><td align="left">mysqld</td></tr><tr><td align="left">é…ç½®æ–‡ä»¶</td><td align="left">/etc/my.cnfï¼Œ/etc/my.cnf.d/*.cnf</td></tr><tr><td align="left">æ•°æ®æ–‡ä»¶</td><td align="left">/var/lib/mysql</td></tr><tr><td align="left">å¯åŠ¨æ—¥å¿—</td><td align="left">/var/log/mysqld.log</td></tr></tbody></table><blockquote><p>å®¢æˆ·ç«¯</p></blockquote><table><thead><tr><th align="left">é¡¹ç›®å</th><th align="left">å†…å®¹</th></tr></thead><tbody><tr><td align="left">è½¯ä»¶å</td><td align="left">mysql-community-client 5.7</td></tr><tr><td align="left">å‘½ä»¤</td><td align="left">mysql,mysqladmin,mysqlbinlog,mysqldump</td></tr></tbody></table><blockquote><p>æœåŠ¡ç«¯å¯åŠ¨æœåŠ¡</p></blockquote><blockquote><blockquote><p>æŸ¥çœ‹è¿›ç¨‹<code>ps -ef|grep mysqld</code> æˆ– <code>systemctl status mysqld</code></p></blockquote></blockquote><blockquote><blockquote><p>æŸ¥çœ‹ç«¯å£ <code>netstat -lunpt|grep mysqld</code>  <code>3306</code></p></blockquote></blockquote><blockquote><p>æœåŠ¡ç«¯ä¿®æ”¹åˆå§‹å¯†ç </p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep password &#x2F;var&#x2F;log&#x2F;mysqld.log</span><br><span class="line">mysqladmin -uroot -p&#39;&#39; password &#39;(Uploo00king)&#39;</span><br></pre></td></tr></table></figure><blockquote><p>å®¢æˆ·ç«¯ç™»é™†æ•°æ®åº“</p></blockquote><p><code>mysql -uroot -p&#39;(Uploo00king)&#39;</code></p><p>mysql.userè¡¨çš„ç»“æ„å˜åŒ–äº†ï¼ŒåŸå…ˆçš„passwordåˆ—æ”¹ä¸ºäº†authentication_stringåˆ—</p><blockquote><blockquote><p>å®ç°åŠåŒæ­¥ï¼Œéœ€è¦å…ˆå®‰è£…åŠåŒæ­¥æ’ä»¶</p></blockquote></blockquote><blockquote><h3 id="M-M-S-Sæ­¥éª¤"><a href="#M-M-S-Sæ­¥éª¤" class="headerlink" title="M-M-S-Sæ­¥éª¤"></a>M-M-S-Sæ­¥éª¤</h3></blockquote><blockquote><blockquote><p>ä¸»æœåŠ¡å™¨</p></blockquote></blockquote><ol><li>configure  </li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">server-id=1</span><br><span class="line">log-bin=/var/lib/mysql-log/mastera</span><br><span class="line"><span class="meta">#</span><span class="bash"> GTID</span></span><br><span class="line">gitd_mode=on</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> crash safe</span></span><br><span class="line">sync_binlog=1 #å¼ºåˆ¶åˆ·æ–°binlogåˆ°ç£ç›˜</span><br><span class="line">innodb_flush_log_at_trx_commit=1 #å¼ºåˆ¶åˆ·æ–°redologåˆ°ç£ç›˜</span><br><span class="line"><span class="meta">#</span><span class="bash"> semi sync</span></span><br><span class="line">rpl-semi_sync_master_enable=1</span><br><span class="line">rpl_semi_sync_master_timeout=1000 #ms</span><br><span class="line">rpl_semi_sync_master_warit_slave_count=num</span><br></pre></td></tr></table></figure><ol start="2"><li><p>grant replication slave@â€™172.25.X.%â€™</p></li><li><p>mysqldump\tar\lvm\innobackupex</p></li></ol><blockquote><blockquote><p>ä»æœåŠ¡å™¨</p></blockquote></blockquote><ol><li>configure</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">Server-id=2</span><br><span class="line"><span class="meta">#</span><span class="bash"> GTID</span></span><br><span class="line">gtid_mode=on</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> MTS</span></span><br><span class="line">slave-parallel-type=logical_clock</span><br><span class="line">Slave-parallel-workers=16</span><br><span class="line"><span class="meta">#</span><span class="bash"> crash safe</span></span><br><span class="line">relay_log_recovery=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> semi sync</span></span><br><span class="line">rpl_semi_sync_slave_enable=1</span><br></pre></td></tr></table></figure><ol start="2"><li><p>mysql -uroot -pâ€™(Uploo00king)â€™ &lt; mysql.all.sql</p></li><li><p>change mastert to</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">master_host&#x3D;&#39;ip&#39;</span><br><span class="line">master_user&#x3D;&#39;slave&#39;</span><br><span class="line">master_password&#x3D;&#39;&#39;</span><br><span class="line">master_auto_position&#x3D;1</span><br></pre></td></tr></table></figure></li><li><p>start slave;</p></li><li><p>show slave status\G;</p></li></ol><blockquote><p>è¯¦ç»†æ­¥éª¤</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br></pre></td><td class="code"><pre><span class="line">mastera:</span><br><span class="line"></span><br><span class="line">    1  ssh-keygen -t dsa</span><br><span class="line">    2  for i in 11 12 13 14;do ssh-copy-id root@172.25.0.$i;done</span><br><span class="line">    3  for i in 11 12 13 14;do ssh root@172.25.0.$i "setenforce 0;systemctl stop firewalld;yum install -y wget";done</span><br><span class="line">    4  for i in 11 12 13 14;do ssh root@172.25.0.$i "cd /etc/yum.repos.d/;wget http://classroom.example.com/materials/mysql-5.7.repo";done</span><br><span class="line">    5  ls /etc/yum.repos.d/</span><br><span class="line"></span><br><span class="line">    6  for i in 11 12 13 14;do ssh root@172.25.0.$i "rpm -e --nodeps mariadb-libs";done</span><br><span class="line">    7  yum list|grep mysql</span><br><span class="line">    8  for i in 11 12 13 14;do ssh root@172.25.0.$i "yum install -y mysql-community*";done</span><br><span class="line">    9  for i in 11 12 13 14;do ssh root@172.25.0.$i "systemctl start mysqld";done</span><br><span class="line">**********************</span><br><span class="line">æ¯ä¸€å°éƒ½éœ€è¦ä¿®æ”¹å¯†ç </span><br><span class="line">    1  grep password /var/log/mysqld.log</span><br><span class="line">    2  mysqladmin -uroot -p'wXE?ekekJ3Na' password '(Uploo00king)'</span><br><span class="line">**********************</span><br><span class="line">masteraï¼š</span><br><span class="line">æ–°å»ºåº“å’Œè¡¨ï¼Œå¹¶å…¨å¤‡ä»½,å¤åˆ¶åˆ°masterbã€slaveaã€slaveb</span><br><span class="line"></span><br><span class="line">    1  mysql -uroot -p'(Uploo00king)'</span><br><span class="line">create database db1;</span><br><span class="line">use db1;</span><br><span class="line">create table t1 (id int);</span><br><span class="line">    2  mysqldump -A -uroot -p'(Uploo00king)' &gt; /tmp/mysql.all.sql</span><br><span class="line">    3  for i in 12 13 14 ;do scp /tmp/mysql.all.sql root@172.25.0.$i:/tmp; done</span><br><span class="line">    4  for i in 12 13 14 ;do ssh root@172.25.0.$i "mysql -uroot -p'(Uploo00king)' &lt; /tmp/mysql.all.sql"; done</span><br><span class="line">************************</span><br><span class="line">masterb/slavea/slaveb:</span><br><span class="line"><span class="meta">#</span><span class="bash">ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">   1  vi /etc/my.cnf</span><br><span class="line"><span class="meta">#</span><span class="bash">mastera:</span></span><br><span class="line">log-bin=/var/lib/mysql-log/mastera</span><br><span class="line">server-id=1</span><br><span class="line">gtid_mode = ON</span><br><span class="line">enforce_gtid_consistency = 1</span><br><span class="line"><span class="meta">#</span><span class="bash">masterb:</span></span><br><span class="line">log-bin=/var/lib/mysql-log/serverb</span><br><span class="line">server-id=2</span><br><span class="line">gtid_mode = ON</span><br><span class="line">enforce_gtid_consistency = 1</span><br><span class="line"><span class="meta">#</span><span class="bash">slavea:</span></span><br><span class="line">server-id=3</span><br><span class="line">gtid_mode = ON</span><br><span class="line">enforce_gtid_consistency = 1</span><br><span class="line">master-info-repository=TABLE</span><br><span class="line">relay-log-info-repository=TABLE</span><br><span class="line"><span class="meta">#</span><span class="bash">slaveb:</span></span><br><span class="line">server-id=4</span><br><span class="line">gtid_mode = ON</span><br><span class="line">enforce_gtid_consistency = 1</span><br><span class="line">master-info-repository=TABLE</span><br><span class="line">relay-log-info-repository=TABLE</span><br><span class="line"></span><br><span class="line">mastera/masterb:</span><br><span class="line">åˆ›å»ºäºŒè¿›åˆ¶æ—¥å¿—çš„ç›®å½•ï¼Œå¹¶ä¿®æ”¹æƒé™</span><br><span class="line"></span><br><span class="line">    2  mkdir /var/lib/mysql-log</span><br><span class="line">    3  chown mysql. /var/lib/mysql-log</span><br><span class="line"></span><br><span class="line">masteraï¼š</span><br><span class="line">å°†å››å°æœåŠ¡å™¨é‡æ–°å¯åŠ¨æœåŠ¡</span><br><span class="line">    4  for i in 11 12 13 14;do ssh root@172.25.0.$i "systemctl restart mysqld";done</span><br><span class="line"></span><br><span class="line">************************************************</span><br><span class="line"><span class="meta">mastera--&gt;</span><span class="bash">masterb\slavea\slaveb ä¸»ä»åŒæ­¥</span></span><br><span class="line"><span class="meta">masterb--&gt;</span><span class="bash">masteraåŒä¸»</span></span><br><span class="line">multi-source</span><br><span class="line"></span><br><span class="line">åœ¨masteraä¸Šé¢æˆæƒ:</span><br><span class="line"></span><br><span class="line">    1  mysql -uroot -p'(Uploo00king)'</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> grant replication slave on *.* to slave@172.25.0.12 identified by <span class="string">'(Uploo00king)'</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> grant replication slave on *.* to slave@172.25.0.13 identified by <span class="string">'(Uploo00king)'</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> grant replication slave on *.* to slave@172.25.0.14 identified by <span class="string">'(Uploo00king)'</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> grant replication slave on *.* to slave@172.25.0.11 identified by <span class="string">'(Uploo00king)'</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> flush privileges;</span></span><br><span class="line"></span><br><span class="line">åœ¨masterbä¸Šé¢change master:</span><br><span class="line">     2mysql&gt; change master to master_host="172.25.0.11",master_user="slave",master_password="(Uploo00king)",master_auto_position=1;</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> start slave;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show slave status\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.11</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mastera.000002</span><br><span class="line">          Read_Master_Log_Pos: 1188</span><br><span class="line">               Relay_Log_File: masterb0-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 1397</span><br><span class="line">        Relay_Master_Log_File: mastera.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1188</span><br><span class="line">              Relay_Log_Space: 1607</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: ca914200-225d-11e6-a1ab-52540000000b</span><br><span class="line">             Master_Info_File: /var/lib/mysql/master.info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind:</span><br><span class="line">      Last_IO_Error_Timestamp:</span><br><span class="line">     Last_SQL_Error_Timestamp:</span><br><span class="line">               Master_SSL_Crl:</span><br><span class="line">           Master_SSL_Crlpath:</span><br><span class="line">           Retrieved_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:1-4</span><br><span class="line">            Executed_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:1-4</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB:</span><br><span class="line">                 Channel_Name:</span><br><span class="line">           Master_TLS_Version:</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">åœ¨masteraä¸Šé¢change masterï¼š</span></span><br><span class="line">    3  mysql&gt; change master to master_host="172.25.0.12",master_user="slave",master_password="(Uploo00king)",master_auto_position=1;</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> start slave;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show slave status\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.12</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: serverb.000002</span><br><span class="line">          Read_Master_Log_Pos: 154</span><br><span class="line">               Relay_Log_File: mastera0-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 363</span><br><span class="line">        Relay_Master_Log_File: serverb.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 154</span><br><span class="line">              Relay_Log_Space: 573</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 2</span><br><span class="line">                  Master_UUID: e9660793-225d-11e6-996d-52540000000c</span><br><span class="line">             Master_Info_File: /var/lib/mysql/master.info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind:</span><br><span class="line">      Last_IO_Error_Timestamp:</span><br><span class="line">     Last_SQL_Error_Timestamp:</span><br><span class="line">               Master_SSL_Crl:</span><br><span class="line">           Master_SSL_Crlpath:</span><br><span class="line">           Retrieved_Gtid_Set:</span><br><span class="line">            Executed_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:1-6</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB:</span><br><span class="line">                 Channel_Name:</span><br><span class="line">           Master_TLS_Version:</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line">=========================================================================================</span><br><span class="line">åˆ°æ­¤ä½ç½®masteraå’Œmasterbçš„åŒä¸»é…ç½®å¥½äº†ã€‚å¯ä»¥æµ‹è¯•ä»¥ä¸‹ã€‚</span><br><span class="line"></span><br><span class="line">æ¥ä¸‹æ¥é…ç½®å¤šçº§ä¸»ä»ï¼Œä¸è¦ç”¨gtidï¼Œç”¨è€æ–¹æ³•master_log_fileå’Œmaster_log_positon</span><br><span class="line">=============================================================================================</span><br><span class="line"><span class="meta">#</span><span class="bash">åœ¨masteraä¸Šé¢æŸ¥çœ‹masterçš„çŠ¶æ€:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show master status\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">             File: mastera.000002</span><br><span class="line">         Position: 1634</span><br><span class="line">     Binlog_Do_DB:</span><br><span class="line"> Binlog_Ignore_DB:</span><br><span class="line">Executed_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:1-6,</span><br><span class="line">e9660793-225d-11e6-996d-52540000000c:1-3</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">åœ¨masterbä¸Šé¢å»æŸ¥çœ‹masterçš„çŠ¶æ€:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show master status\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">             File: serverb.000002</span><br><span class="line">         Position: 894</span><br><span class="line">     Binlog_Do_DB:</span><br><span class="line"> Binlog_Ignore_DB:</span><br><span class="line">Executed_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:1-6,</span><br><span class="line">e9660793-225d-11e6-996d-52540000000c:1-3</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">åœ¨slaveaä¸Šé¢å»æ“ä½œ:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> change master to master_host=<span class="string">"172.25.0.11"</span>,master_user=<span class="string">"slave"</span>,master_password=<span class="string">"(Uploo00king)"</span>,master_log_file=<span class="string">'mastera.000002'</span>,master_log_pos=1634 <span class="keyword">for</span> channel <span class="string">'mastera'</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> change master to master_host=<span class="string">"172.25.0.12"</span>,master_user=<span class="string">"slave"</span>,master_password=<span class="string">"(Uploo00king)"</span>,master_log_file=<span class="string">'serverb.000002'</span>,master_log_pos=894 <span class="keyword">for</span> channel <span class="string">'masterb'</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> start slave;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show slave status\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.11</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mastera.000002</span><br><span class="line">          Read_Master_Log_Pos: 1885</span><br><span class="line">               Relay_Log_File: slavea0-relay-bin-mastera.000002</span><br><span class="line">                Relay_Log_Pos: 569</span><br><span class="line">        Relay_Master_Log_File: mastera.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1885</span><br><span class="line">              Relay_Log_Space: 786</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: ca914200-225d-11e6-a1ab-52540000000b</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind:</span><br><span class="line">      Last_IO_Error_Timestamp:</span><br><span class="line">     Last_SQL_Error_Timestamp:</span><br><span class="line">               Master_SSL_Crl:</span><br><span class="line">           Master_SSL_Crlpath:</span><br><span class="line">           Retrieved_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:7</span><br><span class="line">            Executed_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:7,</span><br><span class="line">e9660793-225d-11e6-996d-52540000000c:4</span><br><span class="line">                Auto_Position: 0</span><br><span class="line">         Replicate_Rewrite_DB:</span><br><span class="line">                 Channel_Name: mastera</span><br><span class="line">           Master_TLS_Version:</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.12</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: serverb.000002</span><br><span class="line">          Read_Master_Log_Pos: 1142</span><br><span class="line">               Relay_Log_File: slavea0-relay-bin-masterb.000002</span><br><span class="line">                Relay_Log_Pos: 566</span><br><span class="line">        Relay_Master_Log_File: serverb.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1142</span><br><span class="line">              Relay_Log_Space: 783</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 2</span><br><span class="line">                  Master_UUID: e9660793-225d-11e6-996d-52540000000c</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind:</span><br><span class="line">      Last_IO_Error_Timestamp:</span><br><span class="line">     Last_SQL_Error_Timestamp:</span><br><span class="line">               Master_SSL_Crl:</span><br><span class="line">           Master_SSL_Crlpath:</span><br><span class="line">           Retrieved_Gtid_Set: e9660793-225d-11e6-996d-52540000000c:4</span><br><span class="line">            Executed_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:7,</span><br><span class="line">e9660793-225d-11e6-996d-52540000000c:4</span><br><span class="line">                Auto_Position: 0</span><br><span class="line">         Replicate_Rewrite_DB:</span><br><span class="line">                 Channel_Name: masterb</span><br><span class="line">           Master_TLS_Version:</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">åœ¨slavebä¸Šé¢å»æ“ä½œ:</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> change master to master_host=<span class="string">"172.25.0.11"</span>,master_user=<span class="string">"slave"</span>,master_password=<span class="string">"(Uploo00king)"</span>,master_log_file=<span class="string">'mastera.000002'</span>,master_log_pos=1634 <span class="keyword">for</span> channel <span class="string">'mastera'</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> change master to master_host=<span class="string">"172.25.0.12"</span>,master_user=<span class="string">"slave"</span>,master_password=<span class="string">"(Uploo00king)"</span>,master_log_file=<span class="string">'serverb.000002'</span>,master_log_pos=894 <span class="keyword">for</span> channel <span class="string">'masterb'</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> start slave;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show slave status\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.11</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mastera.000002</span><br><span class="line">          Read_Master_Log_Pos: 1634</span><br><span class="line">               Relay_Log_File: slaveb0-relay-bin-mastera.000002</span><br><span class="line">                Relay_Log_Pos: 318</span><br><span class="line">        Relay_Master_Log_File: mastera.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1634</span><br><span class="line">              Relay_Log_Space: 535</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: ca914200-225d-11e6-a1ab-52540000000b</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind:</span><br><span class="line">      Last_IO_Error_Timestamp:</span><br><span class="line">     Last_SQL_Error_Timestamp:</span><br><span class="line">               Master_SSL_Crl:</span><br><span class="line">           Master_SSL_Crlpath:</span><br><span class="line">           Retrieved_Gtid_Set:</span><br><span class="line">            Executed_Gtid_Set:</span><br><span class="line">                Auto_Position: 0</span><br><span class="line">         Replicate_Rewrite_DB:</span><br><span class="line">                 Channel_Name: mastera</span><br><span class="line">           Master_TLS_Version:</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.12</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: serverb.000002</span><br><span class="line">          Read_Master_Log_Pos: 894</span><br><span class="line">               Relay_Log_File: slaveb0-relay-bin-masterb.000002</span><br><span class="line">                Relay_Log_Pos: 318</span><br><span class="line">        Relay_Master_Log_File: serverb.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 894</span><br><span class="line">              Relay_Log_Space: 535</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 2</span><br><span class="line">                  Master_UUID: e9660793-225d-11e6-996d-52540000000c</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind:</span><br><span class="line">      Last_IO_Error_Timestamp:</span><br><span class="line">     Last_SQL_Error_Timestamp:</span><br><span class="line">               Master_SSL_Crl:</span><br><span class="line">           Master_SSL_Crlpath:</span><br><span class="line">           Retrieved_Gtid_Set:</span><br><span class="line">            Executed_Gtid_Set:</span><br><span class="line">                Auto_Position: 0</span><br><span class="line">         Replicate_Rewrite_DB:</span><br><span class="line">                 Channel_Name: masterb</span><br><span class="line">           Master_TLS_Version:</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>å¯ä»¥å»æµ‹è¯•äº†ï¼š</p></blockquote></blockquote><p>mastera: <code>insert into db1.t1 values (2);</code></p><p>masterb slavea slavebéƒ½åŒæ­¥äº†æ•°æ®åº“</p><p>masterb:<code>insert into db1.t1 values (3);</code></p><p>mastera slavea slavebéƒ½åŒæ­¥äº†æ•°æ®åº“</p><p>å…³é—­masteraçš„æ•°æ®ï¼Œå¯¹masterbå†™ï¼Œslaveaå’Œslavebä¹Ÿèƒ½åŒæ­¥æ•°æ®ï¼›å†æ¬¡æ‰“å¼€masteraä¹Ÿèƒ½åŒæ­¥åˆ°æ•°æ®ã€‚</p><h3 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>é‡ç‚¹æŒæ¡</p><ol><li>ä¸»ä»åŒæ­¥çš„åŸç†ä»¥åŠåŒæ­¥è¿‡ç¨‹ä¸­çš„å»¶è¿Ÿå’Œæ•°æ®ä¸€è‡´æ€§é—®é¢˜</li><li>mariadb5.5å’Œmysql5.7çš„ä¸»ä»åŒæ­¥æ­¥éª¤</li></ol><p>éš¾ç‚¹</p><ol><li>åŒæ­¥è¿‡ç¨‹ä¸­çš„å»¶è¿Ÿé—®é¢˜å’Œæ•°æ®ä¸€è‡´æ€§é—®é¢˜</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬è®²ä¹‰å‚è€ƒ ã€Š HA mysql ã€‹ é«˜å¯ç”¨MySQL:ç¬¬2ç‰ˆ /(ç¾)è´å°”(Bell,C.),(ç¾)è‚¯å¾·å°”(Kindahl,M.),(ç¾)å¡å°”æ›¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;å¤åˆ¶æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#å¤åˆ¶æ¦‚è¿°&quot; cl
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†" scheme="http://www.toberoot.com/tags/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬ä¹è¯¾ MySQLå‹åŠ›æµ‹è¯•å·¥å…·sysbench</title>
    <link href="http://www.toberoot.com/2016/12/25/booboo_mysql/06-MySQL%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7sysbench/"/>
    <id>http://www.toberoot.com/2016/12/25/booboo_mysql/06-MySQL%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7sysbench/</id>
    <published>2016-12-24T21:06:27.000Z</published>
    <updated>2020-03-24T05:27:17.974Z</updated>
    
    <content type="html"><![CDATA[<p>sysbenchæ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„ã€è·¨å¹³å°ã€å¤šçº¿ç¨‹åŸºå‡†æµ‹è¯•å·¥å…·ï¼Œä¸»è¦ç”¨äºè¯„ä¼°æµ‹è¯•å„ç§ä¸åŒç³»ç»Ÿå‚æ•°ä¸‹çš„æ•°æ®åº“è´Ÿè½½æƒ…å†µã€‚</p><table><thead><tr><th align="left">ä¸»è¦æµ‹è¯•æ–¹å¼</th><th align="left"></th><th align="left"></th><th align="left"></th><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left">cpuæ€§èƒ½</td><td align="left">ç£ç›˜ioæ€§èƒ½</td><td align="left">è°ƒåº¦ç¨‹åºæ€§èƒ½</td><td align="left">å†…å­˜åˆ†é…åŠä¼ è¾“é€Ÿåº¦</td><td align="left">POSIXçº¿ç¨‹æ€§èƒ½</td><td align="left">æ•°æ®åº“æ€§èƒ½(OLTPåŸºå‡†æµ‹è¯•)</td></tr><tr><td align="left">æ‰¾èŒƒå›´å†…æœ€å¤§ç´ æ•°{æ—¶é—´è¶ŠçŸ­è¶Šå¥½}</td><td align="left">ä¸åŒåœºæ™¯ä¸‹IOPS{è¶Šå¤§è¶Šå¥½}</td><td align="left">çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œå¾ªç¯å“åº”ä¿¡å·é‡èŠ±è´¹çš„æ—¶é—´{è¶Šå°‘è¶Šå¥½}</td><td align="left">ä»¥ä¸åŒå—å¤§å°ä¼ è¾“ä¸€å®šæ•°é‡çš„æ•°æ®ååé‡å¤§å°{è¶Šå¤§è¶Šå¥½}</td><td align="left">å¹¶å‘çº¿ç¨‹åŒæ—¶ç”³è¯·äº’æ–¥é”å¾ªç¯ä¸€å®šæ¬¡æ•°èŠ±è´¹çš„æ—¶é—´{è¶Šå°‘è¶Šå¥½}</td><td align="left">qpsã€tpsè¶Šé«˜è¶Šå¥½</td></tr></tbody></table><p>ç›®å‰sysbenchä¸»è¦æ”¯æŒ MySQL,pgsql,oracle è¿™3ç§æ•°æ®åº“ã€‚</p><p>å®‰è£…æµ‹è¯•ç¯å¢ƒä¸ºï¼šRHEL7.2 MariaDB5.5.44 </p><h2 id="å®‰è£…sysbench-0-5"><a href="#å®‰è£…sysbench-0-5" class="headerlink" title="å®‰è£…sysbench-0.5"></a>å®‰è£…sysbench-0.5</h2><p>æºç åœ°å€<a href="https://codeload.github.com/BoobooWei/sysbench/zip/master" target="_blank" rel="noopener">https://github.com/BoobooWei/sysbench/archive/master.zip</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# unzip sysbench-master.zip</span><br><span class="line">[root@localhost ~]# cd sysbench-master/</span><br><span class="line">[root@localhost sysbench-master]# ls</span><br><span class="line">autogen.sh  configure.ac  doc         Makefile.am    README.md         sysbench     TODO</span><br><span class="line">ChangeLog   COPYING       install-sh  missing        README-Oracle.md  tests</span><br><span class="line">config      debian        m4          mkinstalldirs  README-WIN.txt    third_party</span><br><span class="line">[root@localhost sysbench-master]# yum install -y automake libtool</span><br><span class="line"></span><br><span class="line">[root@localhost sysbench-master]# ./autogen.sh </span><br><span class="line">./autogen.sh: running `libtoolize --copy --force' </span><br><span class="line">libtoolize: putting auxiliary files in AC_CONFIG_AUX_DIR, `config'.</span><br><span class="line">libtoolize: copying file `config/ltmain.sh'</span><br><span class="line">libtoolize: putting macros in AC_CONFIG_MACRO_DIR, `m4'.</span><br><span class="line">æ­¤å¤„çœç•¥... ...</span><br><span class="line"></span><br><span class="line">[root@localhost sysbench-master]# ./configure</span><br><span class="line">æ­¤å¤„çœç•¥... ...</span><br><span class="line">===============================================================================</span><br><span class="line">sysbench version   : 1.0</span><br><span class="line">CC                 : gcc</span><br><span class="line">CFLAGS             : -O2 -ggdb3  -march=core2 -W -Wall -Wextra -Wpointer-arith -Wbad-function-cast   -Wstrict-prototypes -Wnested-externs -Wno-inline -Wno-format-zero-length   -funroll-loops  -Wundef -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wredundant-decls -Wcast-align        -pthread</span><br><span class="line">CPPFLAGS           : -D_GNU_SOURCE   -I$(top_srcdir)/sysbench -I$(abs_top_builddir)/third_party/luajit/inc -I$(abs_top_builddir)/third_party/concurrency_kit/include</span><br><span class="line">LDFLAGS            :  </span><br><span class="line">LIBS               : -lm </span><br><span class="line">EXTRA_LDFLAGS      : </span><br><span class="line"></span><br><span class="line">prefix             : /usr/local/sysbench</span><br><span class="line">bindir             : $&#123;prefix&#125;/bin</span><br><span class="line">libexecdir         : $&#123;prefix&#125;/libexec</span><br><span class="line">mandir             : $&#123;prefix&#125;/share/man</span><br><span class="line"></span><br><span class="line">MySQL support      : yes</span><br><span class="line">Drizzle support    : no</span><br><span class="line">AttachSQL support  : no</span><br><span class="line">Oracle support     : no</span><br><span class="line">PostgreSQL support : no</span><br><span class="line"></span><br><span class="line">LuaJIT             : bundled</span><br><span class="line">LUAJIT_CFLAGS      : -I$(abs_top_builddir)/third_party/luajit/inc</span><br><span class="line">LUAJIT_LIBS        : $(abs_top_builddir)/third_party/luajit/lib/libluajit-5.1.a -ldl</span><br><span class="line">LUAJIT_LDFLAGS     : -rdynamic</span><br><span class="line"></span><br><span class="line">Concurrency Kit    : bundled</span><br><span class="line">CK_CFLAGS          : -I$(abs_top_builddir)/third_party/concurrency_kit/include</span><br><span class="line">CK_LIBS            : $(abs_top_builddir)/third_party/concurrency_kit/lib/libck.a</span><br><span class="line">configure flags    : </span><br><span class="line">===============================================================================</span><br><span class="line">[root@localhost sysbench-master]# make</span><br><span class="line">[root@localhost sysbench-master]# make install</span><br><span class="line">[root@localhost sysbench-master]# cd /usr/local/sysbench</span><br><span class="line">[root@localhost sysbench]# pwd</span><br><span class="line">/usr/local/sysbench</span><br><span class="line">[root@localhost sysbench]# ls</span><br><span class="line">bin  share</span><br><span class="line">[root@localhost sysbench]# echo export PATH=$PATH:/usr/local/sysbench/bin &gt;&gt; /etc/bashrc</span><br><span class="line">[root@localhost sysbench]# source /etc/bashrc</span><br><span class="line">[root@localhost sysbench]# which sysbench</span><br><span class="line">/usr/local/sysbench/bin/sysbench</span><br><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•çš„luaè„šæœ¬å­˜æ”¾ä½ç½®</span></span><br><span class="line">[root@localhost sysbench]# ls /root/sysbench-master/sysbench/tests/</span><br><span class="line">CMakeLists.txt  db      Makefile     Makefile.in  mutex     sb_fileio.h  sb_mutex.h    threads</span><br><span class="line">cpu             fileio  Makefile.am  memory       sb_cpu.h  sb_memory.h  sb_threads.h</span><br><span class="line">[root@localhost sysbench]# ls /root/sysbench-master/sysbench/tests/db</span><br><span class="line">bulk_insert.lua  insert.lua   Makefile.in      parallel_prepare.lua      select_random_ranges.lua</span><br><span class="line">common.lua       Makefile     oltp.lua         select.lua                update_index.lua</span><br><span class="line">delete.lua       Makefile.am  oltp_simple.lua  select_random_points.lua  update_non_index.lua</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><h4 id="MySQLæ•°æ®åº“æµ‹è¯•"><a href="#MySQLæ•°æ®åº“æµ‹è¯•" class="headerlink" title="MySQLæ•°æ®åº“æµ‹è¯•"></a>MySQLæ•°æ®åº“æµ‹è¯•</h4><p>sysbench 0.5é€šè¿‡ä¸€ç³»åˆ—LUAè„šæœ¬æ¥æ›¿æ¢ä¹‹å‰çš„oltpï¼Œæ¥æ¨¡æ‹Ÿæ›´æ¥è¿‘çœŸå®çš„åŸºå‡†æµ‹è¯•ç¯å¢ƒã€‚è¿™äº›æµ‹è¯•è„šæœ¬åŒ…å«ï¼šinsert.luaã€oltp.luaã€parallel_prepare.luaã€select_random_points.luaã€update_index.luaã€delete.luaoltp_simple.luaã€select.luaã€select_random_ranges.luaã€update_non_index.luaï¼Œè„šæœ¬ä½¿ç”¨æ–¹å¼åŸºæœ¬ç±»ä¼¼ã€‚ </p><p>sysbench 0.5é»˜è®¤ä½¿ç”¨sbteståº“ï¼Œä½†æ˜¯éœ€è¦è‡ªå·±æ‰‹å·¥å…ˆåˆ›å»ºå¥½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨â€“mysql-dbæŒ‡å®šï¼Œå…¶ä»–éé»˜è®¤é¡¹æŒ‡å®šé€‰é¡¹ï¼š </p><p>â€“mysql-host </p><p>â€“mysql-port </p><p>â€“mysql-socket </p><p>â€“mysql-user </p><p>â€“mysql-password </p><p>â€“mysql-db </p><p>â€“mysql-ssl </p><p>prepare </p><p>ç”Ÿæˆè¡¨å¹¶æ’å…¥æ•°æ®ï¼Œå¯ä½¿ç”¨parallel_prepare.luaè„šæœ¬æ¥å¹¶è¡Œå‡†å¤‡æ•°æ®ã€‚ </p><p>-â€“db-driver æœåŠ¡å™¨ç±»å‹    mysql | drizzle,é»˜è®¤ä¸ºmysql </p><p>-â€“mysql-table-engine è¡¨å­˜æ•°å¼•æ“ </p><p>-â€“myisam-max-rows MyISAMè¡¨MAX_ROWSé€‰é¡¹(ç”¨äºå¤§è¡¨) </p><p>â€“-oltp-table-count ç”Ÿæˆè¡¨æ•°é‡[sbtest1ã€sbtest2â€¦] </p><p>-â€“oltp-table-size ç”Ÿæˆè¡¨çš„è¡Œæ•° </p><p>-â€“oltp-secondary IDåˆ—ç”ŸæˆäºŒçº§ç´¢å¼•è€Œä¸æ˜¯ä¸»é”® </p><p>â€“-oltp-auto-incè®¾ç½®IDåˆ—æ˜¯å¦è‡ªå¢ on | offï¼Œé»˜è®¤ä¸ºon â€“oltp-read-only=on  </p><p>â€“test=sysbench-0.5/sysbench/testsç›®å½•ä¸‹æµ‹è¯•è„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sysbench \ </span><br><span class="line">--test=/root/sysbench-master/sysbench/tests/db/oltp.lua  \ </span><br><span class="line">--mysql-host=localhost  \ </span><br><span class="line">--mysql-port=3306  \ </span><br><span class="line">--mysql-user=root  \ </span><br><span class="line">--mysql-password=uplooking \ </span><br><span class="line">--oltp-table-size=100000 \ </span><br><span class="line">--num-threads=8 \ </span><br><span class="line">--max-time=10 \ </span><br><span class="line">--mysql-db=sbtest \ </span><br><span class="line">--max-requests=0 \ </span><br><span class="line">--oltp-test-mode=complex \ </span><br><span class="line">--report-interval=1 \ </span><br><span class="line">--mysql-table-engine=innodb  \ </span><br><span class="line">[prepare|run|cleanup]å‡†å¤‡/æµ‹è¯•/æ¸…é™¤</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost sysbench]# sysbench --test=/root/sysbench-master/sysbench/tests/db/oltp.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password=uplooking --oltp-table-size=10000 --num-threads=8 --max-time=10 --mysql-db=sbtest --max-requests=0 --oltp-test-mode=complex --report-interval=1 --mysql-table-engine=innodb prepare</span><br><span class="line">sysbench 1.0 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Creating table 'sbtest1'...</span><br><span class="line">Inserting 10000 records into 'sbtest1'</span><br><span class="line">Creating secondary indexes on 'sbtest1'...</span><br><span class="line"></span><br><span class="line">[root@localhost sysbench]# sysbench --test=/root/sysbench-master/sysbench/tests/db/oltp.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password=uplooking --oltp-table-size=10000 --num-threads=8 --max-time=10 --mysql-db=sbtest --max-requests=0 --oltp-test-mode=complex --report-interval=1 --mysql-table-engine=innodb run</span><br><span class="line">sysbench 1.0 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 8</span><br><span class="line">Report intermediate results every 1 second(s)</span><br><span class="line">Initializing random number generator from current time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Initializing worker threads...</span><br><span class="line"></span><br><span class="line">Threads started!</span><br><span class="line"></span><br><span class="line">[   1s] threads: 8, tps: 39.71, reads: 639.17, writes: 162.63, response time: 363.18ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   2s] threads: 8, tps: 45.45, reads: 626.37, writes: 185.74, response time: 376.49ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   3s] threads: 8, tps: 53.32, reads: 733.18, writes: 214.31, response time: 272.27ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   4s] threads: 8, tps: 43.35, reads: 641.97, writes: 176.17, response time: 356.70ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   5s] threads: 8, tps: 36.87, reads: 501.05, writes: 160.51, response time: 458.96ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   6s] threads: 8, tps: 35.18, reads: 513.58, writes: 141.71, response time: 397.39ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   7s] threads: 8, tps: 40.06, reads: 545.80, writes: 147.22, response time: 520.62ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   8s] threads: 8, tps: 54.99, reads: 763.82, writes: 216.95, response time: 240.02ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   9s] threads: 8, tps: 41.37, reads: 577.26, writes: 176.06, response time: 331.91ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  10s] threads: 7, tps: 57.49, reads: 807.87, writes: 217.62, response time: 240.02ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">OLTP test statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            6398</span><br><span class="line">        write:                           1828</span><br><span class="line">        other:                           914</span><br><span class="line">        total:                           9140</span><br><span class="line">    transactions:                        457    (44.97 per sec.)</span><br><span class="line">    read/write requests:                 8226   (809.37 per sec.)</span><br><span class="line">    other operations:                    914    (89.93 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br><span class="line"></span><br><span class="line">General statistics:</span><br><span class="line">    total time:                          10.1917s</span><br><span class="line">    total number of events:              457</span><br><span class="line">    total time taken by event execution: 80.3041s</span><br><span class="line"></span><br><span class="line">Latency statistics:</span><br><span class="line">         min:                                 22.82ms</span><br><span class="line">         avg:                                175.72ms</span><br><span class="line">         max:                                563.77ms</span><br><span class="line">         approx.  95th percentile:           376.49ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           57.1250/2.93</span><br><span class="line">    execution time (avg/stddev):   10.0380/0.07</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ‘çš„æœºå™¨æ˜¯6Gå†…å­˜ï¼Œ2ä¸ªcpuï¼Œå•æ ¸ï¼Œè¶…å¤šçº¿ç¨‹ç¢¾å‹çš„æ—¶å€™è¯•ä¸€è¯•64å’Œ128ä¸ªçº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">[root@localhost sysbench]# sysbench --test=/root/sysbench-master/sysbench/tests/db/oltp.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password=uplooking --oltp-table-size=10000 --num-threads=64 --max-time=30 --mysql-db=sbtest --max-requests=0 --oltp-test-mode=complex --report-interval=1 --mysql-table-engine=innodb run</span><br><span class="line">sysbench 1.0 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">OLTP test statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            21210</span><br><span class="line">        write:                           6007</span><br><span class="line">        other:                           3008</span><br><span class="line">        total:                           30225</span><br><span class="line">    transactions:                        1493   (49.07 per sec.)</span><br><span class="line">    read/write requests:                 27217  (894.57 per sec.)</span><br><span class="line">    other operations:                    3008   (98.87 per sec.)</span><br><span class="line">    ignored errors:                      22     (0.72 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br><span class="line"></span><br><span class="line">General statistics:</span><br><span class="line">    total time:                          30.6492s</span><br><span class="line">    total number of events:              1493</span><br><span class="line">    total time taken by event execution: 1445.1459s</span><br><span class="line"></span><br><span class="line">Latency statistics:</span><br><span class="line">         min:                                 35.38ms</span><br><span class="line">         avg:                                967.95ms</span><br><span class="line">         max:                               4147.00ms</span><br><span class="line">         approx.  95th percentile:          2238.47ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           23.3281/12.34</span><br><span class="line">    execution time (avg/stddev):   22.5804/11.02</span><br><span class="line"></span><br><span class="line">[root@localhost sysbench]# sysbench --test=/root/sysbench-master/sysbench/tests/db/oltp.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password=uplooking --oltp-table-size=10000 --num-threads=128 --max-time=60 --mysql-db=sbtest --max-requests=0 --oltp-test-mode=complex --report-interval=1 --mysql-table-engine=innodb run</span><br><span class="line"></span><br><span class="line">OLTP test statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            58086</span><br><span class="line">        write:                           16337</span><br><span class="line">        other:                           8198</span><br><span class="line">        total:                           82621</span><br><span class="line">    transactions:                        4049   (67.05 per sec.)</span><br><span class="line">    read/write requests:                 74423  (1232.47 per sec.)</span><br><span class="line">    other operations:                    8198   (135.76 per sec.)</span><br><span class="line">    ignored errors:                      100    (1.66 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br><span class="line"></span><br><span class="line">General statistics:</span><br><span class="line">    total time:                          60.7499s</span><br><span class="line">    total number of events:              4049</span><br><span class="line">    total time taken by event execution: 2685.2741s</span><br><span class="line"></span><br><span class="line">Latency statistics:</span><br><span class="line">         min:                                 15.82ms</span><br><span class="line">         avg:                                663.19ms</span><br><span class="line">         max:                               8312.00ms</span><br><span class="line">         approx.  95th percentile:          1973.38ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           31.6328/45.46</span><br><span class="line">    execution time (avg/stddev):   20.9787/22.98</span><br><span class="line">[root@localhost sysbench]# sysbench --test=/root/sysbench-master/sysbench/tests/db/oltp.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password=uplooking --oltp-table-size=10000 --num-threads=128 --max-time=60 --mysql-db=sbtest --max-requests=0 --oltp-test-mode=complex --report-interval=1 --mysql-table-engine=innodb cleanup</span><br><span class="line">sysbench 1.0 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Dropping table 'sbtest1'...</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯å¤šè¡¨å‘¢å¹¶å¢åŠ è¡¨çš„å¤§å°ï¼Œæƒ…å†µåˆä¼šå¦‚ä½•å‘¢ï¼Ÿ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost sysbench]# sysbench --test=/root/sysbench-master/sysbench/tests/db/oltp.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password=uplooking --oltp-tables-count=10 --oltp-table-size=100000 --num-threads=128 --max-time=60 --mysql-db=sbtest --max-requests=0 --oltp-test-mode=complex --report-interval=1 --mysql-table-engine=innodb prepare</span><br><span class="line">sysbench 1.0 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Creating table 'sbtest1'...</span><br><span class="line">Inserting 100000 records into 'sbtest1'</span><br><span class="line">Creating secondary indexes on 'sbtest1'...</span><br><span class="line">Creating table 'sbtest2'...</span><br><span class="line">Inserting 100000 records into 'sbtest2'</span><br><span class="line">Creating secondary indexes on 'sbtest2'...</span><br><span class="line">Creating table 'sbtest3'...</span><br><span class="line">Inserting 100000 records into 'sbtest3'</span><br><span class="line">Creating secondary indexes on 'sbtest3'...</span><br><span class="line">Creating table 'sbtest4'...</span><br><span class="line">Inserting 100000 records into 'sbtest4'</span><br><span class="line">Creating secondary indexes on 'sbtest4'...</span><br><span class="line">Creating table 'sbtest5'...</span><br><span class="line">Inserting 100000 records into 'sbtest5'</span><br><span class="line">Creating secondary indexes on 'sbtest5'...</span><br><span class="line">Creating table 'sbtest6'...</span><br><span class="line">Inserting 100000 records into 'sbtest6'</span><br><span class="line">Creating secondary indexes on 'sbtest6'...</span><br><span class="line">Creating table 'sbtest7'...</span><br><span class="line">Inserting 100000 records into 'sbtest7'</span><br><span class="line">Creating secondary indexes on 'sbtest7'...</span><br><span class="line">Creating table 'sbtest8'...</span><br><span class="line">Inserting 100000 records into 'sbtest8'</span><br><span class="line">Creating secondary indexes on 'sbtest8'...</span><br><span class="line">Creating table 'sbtest9'...</span><br><span class="line">Inserting 100000 records into 'sbtest9'</span><br><span class="line">Creating secondary indexes on 'sbtest9'...</span><br><span class="line">Creating table 'sbtest10'...</span><br><span class="line">Inserting 100000 records into 'sbtest10'</span><br><span class="line">Creating secondary indexes on 'sbtest10'...</span><br><span class="line">[root@localhost sysbench]# sysbench --test=/root/sysbench-master/sysbench/tests/db/oltp.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password=uplooking --oltp-tables-count=10 --oltp-table-size=100000 --num-threads=130 --max-time=20 --mysql-db=sbtest --max-requests=0 --oltp-test-mode=complex --report-interval=1 --mysql-table-engine=innodb run </span><br><span class="line">sysbench 1.0 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 130</span><br><span class="line">Report intermediate results every 1 second(s)</span><br><span class="line">Initializing random number generator from current time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Initializing worker threads...</span><br><span class="line"></span><br><span class="line">Threads started!</span><br><span class="line"></span><br><span class="line">[   1s] threads: 130, tps: 0.99, reads: 1259.55, writes: 11.93, response time: 87.56ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   2s] threads: 130, tps: 14.04, reads: 619.78, writes: 242.70, response time: 1903.57ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   3s] threads: 130, tps: 66.22, reads: 547.33, writes: 261.00, response time: 2880.27ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   4s] threads: 130, tps: 19.21, reads: 366.95, writes: 62.68, response time: 3911.79ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   5s] threads: 130, tps: 45.63, reads: 876.69, writes: 120.39, response time: 4517.90ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   6s] threads: 130, tps: 38.79, reads: 653.12, writes: 183.46, response time: 5312.73ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   7s] threads: 130, tps: 109.66, reads: 833.38, writes: 366.85, response time: 3982.86ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   8s] threads: 130, tps: 9.94, reads: 611.61, writes: 17.90, response time: 4683.57ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   9s] threads: 130, tps: 4.04, reads: 227.04, writes: 74.67, response time: 4358.09ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  10s] threads: 130, tps: 108.98, reads: 813.88, writes: 425.94, response time: 3574.99ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  11s] threads: 130, tps: 21.48, reads: 660.03, writes: 24.41, response time: 3773.42ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  12s] threads: 130, tps: 41.65, reads: 512.63, writes: 221.12, response time: 3982.86ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  13s] threads: 130, tps: 40.33, reads: 623.56, writes: 256.46, response time: 3267.19ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  14s] threads: 130, tps: 39.68, reads: 460.24, writes: 76.38, response time: 3841.98ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  15s] threads: 130, tps: 37.63, reads: 691.16, writes: 215.86, response time: 4517.90ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  16s] threads: 130, tps: 53.97, reads: 704.44, writes: 166.64, response time: 4055.23ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  17s] threads: 130, tps: 22.56, reads: 305.12, writes: 166.53, response time: 4855.31ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  18s] threads: 130, tps: 1.00, reads: 320.21, writes: 36.14, response time: 4943.53ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  19s] threads: 130, tps: 82.52, reads: 854.02, writes: 259.49, response time: 6026.41ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  20s] threads: 130, tps: 11.85, reads: 332.75, writes: 12.84, response time: 4517.90ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  21s] threads: 130, tps: 52.01, reads: 332.47, writes: 383.46, response time: 5124.81ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">OLTP test statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            12656</span><br><span class="line">        write:                           3616</span><br><span class="line">        other:                           1808</span><br><span class="line">        total:                           18080</span><br><span class="line">    transactions:                        904    (42.53 per sec.)</span><br><span class="line">    read/write requests:                 16272  (765.60 per sec.)</span><br><span class="line">    other operations:                    1808   (85.07 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br><span class="line"></span><br><span class="line">General statistics:</span><br><span class="line">    total time:                          21.5991s</span><br><span class="line">    total number of events:              904</span><br><span class="line">    total time taken by event execution: 2713.1958s</span><br><span class="line"></span><br><span class="line">Latency statistics:</span><br><span class="line">         min:                                 87.55ms</span><br><span class="line">         avg:                               3001.32ms</span><br><span class="line">         max:                               6827.14ms</span><br><span class="line">         approx.  95th percentile:          4855.31ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           6.9538/0.78</span><br><span class="line">    execution time (avg/stddev):   20.8707/0.35</span><br></pre></td></tr></table></figure><h4 id="CPUæµ‹è¯•"><a href="#CPUæµ‹è¯•" class="headerlink" title="CPUæµ‹è¯•"></a>CPUæµ‹è¯•</h4><blockquote><p>ä½¿ç”¨64ä½æ•´æ•°ï¼Œæµ‹è¯•è®¡ç®—ç´ æ•°ç›´åˆ°æŸä¸ªæœ€å¤§å€¼æ‰€éœ€è¦çš„æ—¶é—´</p></blockquote><p><code>sysbench --test=cpu --cpu-max-prime=2000 run</code></p><p>æŸ¥çœ‹CPUä¿¡æ¯æ–¹æ³•,æŸ¥çœ‹ç‰©ç†cpuä¸ªæ•°</p><p><code>grep &quot;physical id&quot; /proc/cpuinfo | sort -u | wc -l</code> æŸ¥çœ‹æ ¸å¿ƒæ•°é‡</p><p><code>grep &quot;core id&quot; /proc/cpuinfo | sort -u | wc -l</code> æŸ¥çœ‹çº¿ç¨‹æ•°é‡</p><p><code>grep &quot;processor&quot; /proc/cpuinfo | sort -u | wc -l</code></p><p>åœ¨sysbenchçš„æµ‹è¯•ä¸­ï¼Œâ€“num-threadså–å€¼ä¸ºâ€çº¿ç¨‹æ•°é‡â€å³å¯</p><h4 id="çº¿ç¨‹-thread-æµ‹è¯•"><a href="#çº¿ç¨‹-thread-æµ‹è¯•" class="headerlink" title="çº¿ç¨‹(thread)æµ‹è¯•"></a>çº¿ç¨‹(thread)æµ‹è¯•</h4><blockquote><p>æµ‹è¯•çº¿ç¨‹è°ƒåº¦å™¨çš„æ€§èƒ½ã€‚å¯¹äºé«˜è´Ÿè½½æƒ…å†µä¸‹æµ‹è¯•çº¿ç¨‹è°ƒåº¦å™¨çš„è¡Œä¸ºéå¸¸æœ‰ç”¨</p></blockquote><p><code>sysbench --test=threads --num-threads=64 --thread-yields=100 --thread-locks=2 run</code></p><h4 id="æ–‡ä»¶IOæ€§èƒ½æµ‹è¯•"><a href="#æ–‡ä»¶IOæ€§èƒ½æµ‹è¯•" class="headerlink" title="æ–‡ä»¶IOæ€§èƒ½æµ‹è¯•"></a>æ–‡ä»¶IOæ€§èƒ½æµ‹è¯•</h4><blockquote><p>ç”Ÿæˆéœ€è¦çš„æµ‹è¯•æ–‡ä»¶ï¼Œæ–‡ä»¶æ€»å¤§å°5Gï¼Œ16ä¸ªå¹¶å‘çº¿ç¨‹ã€‚æ‰§è¡Œå®Œåä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€å †å°æ–‡ä»¶</p></blockquote><p><code>sysbench --test=fileio --num-threads=16 --file-total-size=5G prepare</code></p><p>æ‰§è¡Œæµ‹è¯•ï¼ŒæŒ‡å®šéšæœºè¯»å†™æ¨¡å¼:</p><ul><li>seqwré¡ºåºå†™å…¥</li><li>seqrewré¡ºåºé‡å†™</li><li>seqrdé¡ºåºè¯»å–</li><li>rndrdéšæœºè¯»å–</li><li>rndwréšæœºå†™å…¥</li><li>rndrwæ··åˆéšæœºè¯»/å†™</li></ul><p><code>sysbench --test=fileio --num-threads=16 --init-rng=on --file-total-size=5G --file-test-mode=rndrw run</code></p><p>é™¤æµ‹è¯•æ–‡ä»¶</p><p><code>sysbench --test=fileio --num-threads=16 --file-total-size=5G cleanup</code></p><h4 id="å†…å­˜æµ‹è¯•"><a href="#å†…å­˜æµ‹è¯•" class="headerlink" title="å†…å­˜æµ‹è¯•"></a>å†…å­˜æµ‹è¯•</h4><blockquote><p>å†…å­˜æµ‹è¯•æµ‹è¯•äº†å†…å­˜çš„è¿ç»­è¯»å†™æ€§èƒ½ã€‚</p></blockquote><p><code>sysbench --test=memory --num-threads=16 --memory-block-size=8192 --memory-total-size=1G run</code></p><h4 id="äº’æ–¥é”-Mutex-æµ‹è¯•"><a href="#äº’æ–¥é”-Mutex-æµ‹è¯•" class="headerlink" title="äº’æ–¥é”(Mutex)æµ‹è¯•"></a>äº’æ–¥é”(Mutex)æµ‹è¯•</h4><blockquote><p>æµ‹è¯•äº’æ–¥é”çš„æ€§èƒ½ï¼Œæ–¹å¼æ˜¯æ¨¡æ‹Ÿæ‰€æœ‰çº¿ç¨‹åœ¨åŒä¸€æ—¶åˆ»å¹¶å‘è¿è¡Œï¼Œå¹¶éƒ½çŸ­æš‚è¯·æ±‚äº’æ–¥é”Xã€‚</p></blockquote><p><code>sysbench --test=mutex --num-threads=16 --mutex-num=1024 --mutex-locks=10000 --mutex-loops=5000 run</code></p><h2 id="å®‰è£…sysbench-0-4"><a href="#å®‰è£…sysbench-0-4" class="headerlink" title="å®‰è£…sysbench-0.4"></a>å®‰è£…sysbench-0.4</h2><p>æºç åœ¨çº¿ä¸‹è½½åœ°å€ï¼š<a href="http://101.96.10.46/downloads.mysql.com/source/sysbench-0.4.12.10.tar.gz" target="_blank" rel="noopener">http://101.96.10.46/downloads.mysql.com/source/sysbench-0.4.12.10.tar.gz</a></p><p>rpmåŒ…ä¸‹çº¿ä¸‹è½½åœ°å€ï¼š<a href="http://rpm.pbone.net/index.php3/stat/4/idpl/31446291/dir/centos_7/com/sysbench-0.4.12-12.el7.x86_64.rpm.html" target="_blank" rel="noopener">http://rpm.pbone.net/index.php3/stat/4/idpl/31446291/dir/centos_7/com/sysbench-0.4.12-12.el7.x86_64.rpm.html</a></p><h3 id="æºç æ­¥éª¤"><a href="#æºç æ­¥éª¤" class="headerlink" title="æºç æ­¥éª¤"></a>æºç æ­¥éª¤</h3><h4 id="æ•°æ®åº“rpmåŒ…å®‰è£…åˆ™ç›´æ¥ç¼–è¯‘"><a href="#æ•°æ®åº“rpmåŒ…å®‰è£…åˆ™ç›´æ¥ç¼–è¯‘" class="headerlink" title="æ•°æ®åº“rpmåŒ…å®‰è£…åˆ™ç›´æ¥ç¼–è¯‘"></a>æ•°æ®åº“rpmåŒ…å®‰è£…åˆ™ç›´æ¥ç¼–è¯‘</h4><p>å¦‚æœæ•°æ®åº“æ˜¯rpmåŒ…å®‰è£…åˆ™ç›´æ¥æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼Œå¦åˆ™åœ¨configureçš„æ—¶å€™éœ€è¦æŒ‡å®šmysqlæ•°æ®åº“çš„åº“libså’Œincludesè·¯å¾„</p><ul><li>tar zxf sysbench-0.4.8.tar.gz</li><li>cd sysbench-0.4.8</li><li>./configure &amp;&amp; make &amp;&amp; make install</li><li>strip /usr/local/bin/sysbench</li></ul><h4 id="æ•°æ®åº“ä¸ºæºç ç¼–è¯‘"><a href="#æ•°æ®åº“ä¸ºæºç ç¼–è¯‘" class="headerlink" title="æ•°æ®åº“ä¸ºæºç ç¼–è¯‘"></a>æ•°æ®åº“ä¸ºæºç ç¼–è¯‘</h4><p>æ•°æ®åº“æºç ç¼–è¯‘åè·¯å¾„å¦‚ä¸‹ï¼š</p><p>æ•°æ®ç›®å½•        /usr/local/mysql</p><p>includesç›®å½•    /usr/local/mysql/include</p><p>libsç›®å½•        /usr/local/mysql/lib</p><p>æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p><ul><li>tar zxf sysbench-0.4.8.tar.gz</li><li>cd sysbench-0.4.8</li><li>./configure â€“with-mysql-includes=/usr/local/mysql/include â€“with-mysql-libs=/usr/local/mysql/lib &amp;&amp; make &amp;&amp; make install</li><li>strip /usr/local/bin/sysbench</li></ul><h3 id="rpmåŒ…å®‰è£…æ­¥éª¤"><a href="#rpmåŒ…å®‰è£…æ­¥éª¤" class="headerlink" title="rpmåŒ…å®‰è£…æ­¥éª¤"></a>rpmåŒ…å®‰è£…æ­¥éª¤</h3><p>ä¾èµ–åŒ…ï¼š</p><p>mariadb-devel-5.5.44-2.el7.x86_64</p><p>postgresql-libs.x86_64 0:9.2.13-1.el7_1<br>â€‹        </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# rpm -q mariadb-devel</span><br><span class="line">mariadb-devel-5.5.44-2.el7.x86_64</span><br><span class="line">[root@localhost ~]# </span><br><span class="line">[root@localhost ~]# rpm -ivh sysbench-0.4.12-12.el7.x86_64.rpm </span><br><span class="line">warning: sysbench-0.4.12-12.el7.x86_64.rpm: Header V4 RSA/SHA1 Signature, key ID 764429e6: NOKEY</span><br><span class="line">error: Failed dependencies:</span><br><span class="line">libpq.so.5()(64bit) is needed by sysbench-0.4.12-12.el7.x86_64</span><br><span class="line">[root@localhost ~]# yum localinstall -y sysbench-0.4.12-12.el7.x86_64.rpm </span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Examining sysbench-0.4.12-12.el7.x86_64.rpm: sysbench-0.4.12-12.el7.x86_64</span><br><span class="line">Marking sysbench-0.4.12-12.el7.x86_64.rpm to be installed</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package sysbench.x86_64 0:0.4.12-12.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libpq.so.5()(64bit) <span class="keyword">for</span> package: sysbench-0.4.12-12.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package postgresql-libs.x86_64 0:9.2.13-1.el7_1 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">=====================================================================================================================================</span><br><span class="line"> Package                       Arch                 Version                       Repository                                    Size</span><br><span class="line">=====================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> sysbench                      x86_64               0.4.12-12.el7                 /sysbench-0.4.12-12.el7.x86_64               172 k</span><br><span class="line">Installing for dependencies:</span><br><span class="line"> postgresql-libs               x86_64               9.2.13-1.el7_1                _mnt                                         230 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">=====================================================================================================================================</span><br><span class="line">Install  1 Package (+1 Dependent package)</span><br><span class="line"></span><br><span class="line">Total size: 402 k</span><br><span class="line">Total download size: 230 k</span><br><span class="line">Installed size: 836 k</span><br><span class="line">Downloading packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : postgresql-libs-9.2.13-1.el7_1.x86_64                                                                             1/2 </span><br><span class="line">  Installing : sysbench-0.4.12-12.el7.x86_64                                                                                     2/2 </span><br><span class="line">  Verifying  : sysbench-0.4.12-12.el7.x86_64                                                                                     1/2 </span><br><span class="line">  Verifying  : postgresql-libs-9.2.13-1.el7_1.x86_64                                                                             2/2 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  sysbench.x86_64 0:0.4.12-12.el7                                                                                                    </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  postgresql-libs.x86_64 0:9.2.13-1.el7_1                                                                                            </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure><table><thead><tr><th align="left">ä¸»è¦æµ‹è¯•æ–¹å¼</th><th align="left"></th><th align="left"></th><th align="left"></th><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left">cpuæ€§èƒ½</td><td align="left">ç£ç›˜ioæ€§èƒ½</td><td align="left">è°ƒåº¦ç¨‹åºæ€§èƒ½</td><td align="left">å†…å­˜åˆ†é…åŠä¼ è¾“é€Ÿåº¦</td><td align="left">POSIXçº¿ç¨‹æ€§èƒ½</td><td align="left">æ•°æ®åº“æ€§èƒ½(OLTPåŸºå‡†æµ‹è¯•)</td></tr><tr><td align="left">æ‰¾èŒƒå›´å†…æœ€å¤§ç´ æ•°{æ—¶é—´è¶ŠçŸ­è¶Šå¥½}</td><td align="left">ä¸åŒåœºæ™¯ä¸‹IOPS{è¶Šå¤§è¶Šå¥½}</td><td align="left">çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œå¾ªç¯å“åº”ä¿¡å·é‡èŠ±è´¹çš„æ—¶é—´{è¶Šå°‘è¶Šå¥½}</td><td align="left">ä»¥ä¸åŒå—å¤§å°ä¼ è¾“ä¸€å®šæ•°é‡çš„æ•°æ®ååé‡å¤§å°{è¶Šå¤§è¶Šå¥½}</td><td align="left">å¹¶å‘çº¿ç¨‹åŒæ—¶ç”³è¯·äº’æ–¥é”å¾ªç¯ä¸€å®šæ¬¡æ•°èŠ±è´¹çš„æ—¶é—´{è¶Šå°‘è¶Šå¥½}</td><td align="left">qpsã€tpsè¶Šé«˜è¶Šå¥½</td></tr></tbody></table><h3 id="å¼€å§‹æµ‹è¯•"><a href="#å¼€å§‹æµ‹è¯•" class="headerlink" title="å¼€å§‹æµ‹è¯•"></a>å¼€å§‹æµ‹è¯•</h3><p>ç¼–è¯‘æˆåŠŸä¹‹åï¼Œå°±è¦å¼€å§‹æµ‹è¯•å„ç§æ€§èƒ½äº†ï¼Œæµ‹è¯•çš„æ–¹æ³•å®˜ç½‘ç½‘ç«™ä¸Šä¹Ÿæåˆ°ä¸€äº›ï¼Œä½†æ¶‰åŠåˆ° OLTP æµ‹è¯•çš„éƒ¨åˆ†å´ä¸å¤Ÿå‡†ç¡®ã€‚åœ¨è¿™é‡Œæˆ‘å¤§è‡´æä¸€ä¸‹ï¼š</p><h4 id="cpuæ€§èƒ½æµ‹è¯•"><a href="#cpuæ€§èƒ½æµ‹è¯•" class="headerlink" title="cpuæ€§èƒ½æµ‹è¯•"></a>cpuæ€§èƒ½æµ‹è¯•</h4><blockquote><p>è¿›è¡Œç´ æ•°çš„åŠ æ³•è¿ç®—:æŒ‡å®šæœ€å¤§çš„ç´ æ•°ä¸º 20000ï¼Œè®°å½•æµ‹è¯•ç»“æœï¼ˆå¯ä»¥æ ¹æ®æœºå™¨cpuçš„æ€§èƒ½æ¥é€‚å½“è°ƒæ•´æ•°å€¼ï¼‰</p></blockquote><p>sysbench â€“test=cpu â€“cpu-max-prime=20000 run</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sysbench --test=cpu --cpu-max-prime=20000 run</span><br><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 1</span><br><span class="line"></span><br><span class="line">Doing CPU performance benchmark</span><br><span class="line"></span><br><span class="line">Threads started!</span><br><span class="line">Done.</span><br><span class="line"></span><br><span class="line">Maximum prime number checked in CPU test: 20000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Test execution summary:</span><br><span class="line">    total time:                          30.7005s</span><br><span class="line">    total number of events:              10000</span><br><span class="line">    total time taken by event execution: 30.6870</span><br><span class="line">    per-request statistics:</span><br><span class="line">         min:                                  2.47ms</span><br><span class="line">         avg:                                  3.07ms</span><br><span class="line">         max:                                106.81ms</span><br><span class="line">         approx.  95 percentile:               3.74ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           10000.0000/0.00</span><br><span class="line">    execution time (avg/stddev):   30.6870/0.00</span><br></pre></td></tr></table></figure><h4 id="çº¿ç¨‹æµ‹è¯•"><a href="#çº¿ç¨‹æµ‹è¯•" class="headerlink" title="çº¿ç¨‹æµ‹è¯•"></a>çº¿ç¨‹æµ‹è¯•</h4><blockquote><p>æµ‹è¯•64ä¸ªçº¿ç¨‹<br>sysbench â€“test=threads â€“num-threads=64 â€“thread-yields=100 â€“thread-locks=2 run</p></blockquote><figure class="highlight plain"><figcaption><span>~]# sysbench --test</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 64</span><br><span class="line"></span><br><span class="line">Doing thread subsystem performance test</span><br><span class="line">Thread yields per test: 100 Locks used: 2</span><br><span class="line">Threads started!</span><br><span class="line">Done.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Test execution summary:</span><br><span class="line">    total time:                          1.3949s</span><br><span class="line">    total number of events:              10000</span><br><span class="line">    total time taken by event execution: 66.0646</span><br><span class="line">    per-request statistics:</span><br><span class="line">         min:                                  0.03ms</span><br><span class="line">         avg:                                  6.61ms</span><br><span class="line">         max:                               1265.23ms</span><br><span class="line">         approx.  95 percentile:               9.50ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg&#x2F;stddev):           156.2500&#x2F;302.22</span><br><span class="line">    execution time (avg&#x2F;stddev):   1.0323&#x2F;0.33</span><br></pre></td></tr></table></figure><h4 id="ç£ç›˜IOæ€§èƒ½æµ‹è¯•"><a href="#ç£ç›˜IOæ€§èƒ½æµ‹è¯•" class="headerlink" title="ç£ç›˜IOæ€§èƒ½æµ‹è¯•"></a>ç£ç›˜IOæ€§èƒ½æµ‹è¯•</h4><blockquote><p>æœ€å¤§åˆ›å»º16ä¸ªçº¿ç¨‹ï¼Œåˆ›å»ºçš„æ–‡ä»¶æ€»å¤§å°ä¸º3Gï¼Œæ–‡ä»¶è¯»å†™æ¨¡å¼ä¸ºéšæœºè¯»</p></blockquote><p>sysbench â€“test=fileio â€“num-threads=16 â€“file-total-size=3G â€“file-test-mode=rndrw prepare #åˆ›å»ºæµ‹è¯•æ–‡ä»¶<br>â€‹<br>sysbench â€“test=fileio â€“num-threads=16 â€“file-total-size=3G â€“file-test-mode=rndrw run        #æ‰§è¡Œæµ‹è¯•æ–‡ä»¶<br>â€‹<br>sysbench â€“test=fileio â€“num-threads=16 â€“file-total-size=3G â€“file-test-mode=rndrw cleanup    #åˆ é™¤æµ‹è¯•æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sysbench --test=fileio --num-threads=16 --file-total-size=3G --file-test-mode=rndrw prepare</span><br><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">128 files, 24576Kb each, 3072Mb total</span><br><span class="line">Creating files for the test...</span><br><span class="line">[root@localhost ~]# sysbench --test=fileio --num-threads=16 --file-total-size=3G --file-test-mode=rndrw run</span><br><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 16</span><br><span class="line"></span><br><span class="line">Extra file open flags: 0</span><br><span class="line">128 files, 24Mb each</span><br><span class="line">3Gb total file size</span><br><span class="line">Block size 16Kb</span><br><span class="line">Number of random requests for random IO: 10000</span><br><span class="line">Read/Write ratio for combined random IO test: 1.50</span><br><span class="line">Periodic FSYNC enabled, calling fsync() each 100 requests.</span><br><span class="line">Calling fsync() at the end of test, Enabled.</span><br><span class="line">Using synchronous I/O mode</span><br><span class="line">Doing random r/w test</span><br><span class="line">Threads started!</span><br><span class="line">Done.</span><br><span class="line"></span><br><span class="line">Operations performed:  6008 Read, 3997 Write, 12800 Other = 22805 Total</span><br><span class="line">Read 93.875Mb  Written 62.453Mb  Total transferred 156.33Mb  (2.9644Mb/sec)</span><br><span class="line">  189.72 Requests/sec executed</span><br><span class="line"></span><br><span class="line">Test execution summary:</span><br><span class="line">    total time:                          52.7348s</span><br><span class="line">    total number of events:              10005</span><br><span class="line">    total time taken by event execution: 434.9929</span><br><span class="line">    per-request statistics:</span><br><span class="line">         min:                                  0.01ms</span><br><span class="line">         avg:                                 43.48ms</span><br><span class="line">         max:                               1105.16ms</span><br><span class="line">         approx.  95 percentile:             180.46ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           625.3125/46.52</span><br><span class="line">    execution time (avg/stddev):   27.1871/1.19</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# sysbench --test=fileio --num-threads=16 --file-total-size=3G --file-test-mode=rndrw cleanup</span><br><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">Removing test files...</span><br></pre></td></tr></table></figure><h4 id="å†…å­˜æµ‹è¯•-1"><a href="#å†…å­˜æµ‹è¯•-1" class="headerlink" title="å†…å­˜æµ‹è¯•"></a>å†…å­˜æµ‹è¯•</h4><blockquote><p>æµ‹è¯•è¿‡ç¨‹æ˜¯åœ¨å†…å­˜ä¸­ä¼ è¾“ 4G çš„æ•°æ®é‡ï¼Œæ¯ä¸ª block å¤§å°ä¸º 8Kã€‚</p></blockquote><p>sysbench â€“test=memory â€“memory-block-size=8k â€“memory-total-size=4G run</p><h4 id="OLTPæµ‹è¯•"><a href="#OLTPæµ‹è¯•" class="headerlink" title="OLTPæµ‹è¯•"></a>OLTPæµ‹è¯•</h4><blockquote><p>æµ‹è¯•çš„è¡¨å­˜å‚¨å¼•æ“ç±»å‹ä¸ºinnodbï¼Œè¡¨æœ€å¤§è®°å½•æ•°ä¸º 1000000ï¼Œ</p></blockquote><p>æµ‹è¯• OLTP æ—¶ï¼Œå…ˆåˆ›å»ºæ•°æ®åº“ sbtestï¼Œæˆ–è€…è‡ªå·±ç”¨å‚æ•° â€“mysql-db æ¥æŒ‡å®šå…¶ä»–æ•°æ®åº“ã€‚</p><p>â€“test=oltp åˆ¶å®šæµ‹è¯•ç±»å‹ä¸ºOLTP</p><p>â€“db-driver=mysql æµ‹è¯•çš„æ•°æ®åº“ç±»å‹ä¸ºmysql</p><p>â€“mysql-table-engine æŒ‡å®šåˆ›å»ºçš„æµ‹è¯•è¡¨sbtestä¸º innodb å‚¨å¼•æ“ç±»å‹</p><p>â€“mysql-host=localhost â€“mysql-user=root â€“mysql-password=uplooking åˆ†åˆ«ä¸ºæœåŠ¡å™¨ipï¼Œç”¨æˆ·åå’Œå¯†ç </p><p>â€“oltp-table-size=10000 åˆ›å»ºçš„æµ‹è¯•è¡¨çš„å¤§å°ä¸º1ä¸‡è¡Œ</p><p>â€“num-threads=128 çº¿ç¨‹æ•°é‡ä¸º128</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sysbench --test=oltp --db-driver=mysql --mysql-host=localhost --mysql-user=root --mysql-password=uplooking --mysql-db=sbtest --mysql-table-engine=innodb --oltp-table-size=10000 --num-threads=128 prepare</span><br><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">Creating table 'sbtest'...</span><br><span class="line">Creating 10000 records in table 'sbtest'...</span><br><span class="line">[root@localhost ~]# sysbench --test=oltp --db-driver=mysql --mysql-host=localhost --mysql-user=root --mysql-password=uplooking --mysql-db=sbtest --mysql-table-engine=innodb --oltp-table-size=10000 --num-threads=128 run</span><br><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 128</span><br><span class="line"></span><br><span class="line">Doing OLTP test.</span><br><span class="line">Running mixed OLTP test</span><br><span class="line">Using Special distribution (12 iterations,  1 pct of values are returned in 75 pct cases)</span><br><span class="line">Using "BEGIN" for starting transactions</span><br><span class="line">Using auto_inc on the id column</span><br><span class="line">Maximum number of requests for OLTP test is limited to 10000</span><br><span class="line">Threads started!</span><br><span class="line">Done.</span><br><span class="line"></span><br><span class="line">OLTP test statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            181986</span><br><span class="line">        write:                           57056</span><br><span class="line">        other:                           22999</span><br><span class="line">        total:                           262041</span><br><span class="line">    transactions:                        10000  (50.00 per sec.)</span><br><span class="line">    deadlocks:                           2999   (14.99 per sec.)</span><br><span class="line">    read/write requests:                 239042 (1195.09 per sec.)</span><br><span class="line">    other operations:                    22999  (114.98 per sec.)</span><br><span class="line"></span><br><span class="line">Test execution summary:</span><br><span class="line">    total time:                          200.0198s</span><br><span class="line">    total number of events:              10000</span><br><span class="line">    total time taken by event execution: 25451.6909</span><br><span class="line">    per-request statistics:</span><br><span class="line">         min:                                  9.47ms</span><br><span class="line">         avg:                               2545.17ms</span><br><span class="line">         max:                              26148.89ms</span><br><span class="line">         approx.  95 percentile:            6902.69ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           78.1250/7.68</span><br><span class="line">    execution time (avg/stddev):   198.8413/0.48</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# sysbench --test=oltp --db-driver=mysql --mysql-host=localhost --mysql-user=root --mysql-password=uplooking --mysql-db=sbtest --mysql-table-engine=innodb --oltp-table-size=10000 --num-threads=128 cleanup</span><br><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">Dropping table 'sbtest'...</span><br><span class="line">Done.</span><br></pre></td></tr></table></figure><p>50.00 per sec ä¸ºæ¯ç§’äº‹åŠ¡é‡ï¼Œ1195.09 per sec æ¯ç§’çš„è¯»å†™è¯·æ±‚æ•°ï¼Œtotal time:  200.0198s æ€»çš„ç”¨æ—¶</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;sysbenchæ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„ã€è·¨å¹³å°ã€å¤šçº¿ç¨‹åŸºå‡†æµ‹è¯•å·¥å…·ï¼Œä¸»è¦ç”¨äºè¯„ä¼°æµ‹è¯•å„ç§ä¸åŒç³»ç»Ÿå‚æ•°ä¸‹çš„æ•°æ®åº“è´Ÿè½½æƒ…å†µã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;left&quot;&gt;ä¸»è¦æµ‹è¯•æ–¹å¼&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;&lt;/th&gt;
&lt;th
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†" scheme="http://www.toberoot.com/tags/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬å…­è¯¾ MySQLé€»è¾‘æ¶æ„å’ŒInnodbå­˜å‚¨å¼•æ“</title>
    <link href="http://www.toberoot.com/2016/12/25/booboo_mysql/03-MySQL%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84%E5%92%8CInnodb%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/"/>
    <id>http://www.toberoot.com/2016/12/25/booboo_mysql/03-MySQL%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84%E5%92%8CInnodb%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/</id>
    <published>2016-12-24T21:06:27.000Z</published>
    <updated>2020-03-24T05:27:17.961Z</updated>
    
    <content type="html"><![CDATA[<h3 id="MySQL-é€»è¾‘æ¶æ„"><a href="#MySQL-é€»è¾‘æ¶æ„" class="headerlink" title="MySQL é€»è¾‘æ¶æ„"></a>MySQL é€»è¾‘æ¶æ„</h3><p><img src="pic/04-mysql2.jpg" alt="é€»è¾‘æ¶æ„"></p><p>MySQL é€»è¾‘æ¶æ„ç”±ï¼šè¿æ¥æ± ç»„ä»¶ã€ç®¡ç†æœåŠ¡å’Œå·¥å…·ç»„ä»¶ã€sqlæ¥å£ç»„ä»¶ã€æŸ¥è¯¢åˆ†æå™¨ç»„ä»¶ã€ä¼˜åŒ–å™¨ç»„ä»¶ã€ ç¼“å†²ç»„ä»¶ã€æ’ä»¶å¼å­˜å‚¨å¼•æ“ã€ç‰©ç†æ–‡ä»¶ç»„æˆã€‚ç‹¬æœ‰çš„æ’ä»¶å¼ä½“ç³»ç»“æ„ï¼Œå„ä¸ªå­˜å‚¨å¼•æ“æœ‰è‡ªå·±çš„ç‰¹ç‚¹ã€‚</p><ul><li><p><code>Connectors</code>æŒ‡çš„æ˜¯ä¸åŒè¯­è¨€ä¸­ä¸SQLçš„äº¤äº’</p></li><li><p><code>Management Serveices &amp; Utilities</code>ï¼š ç³»ç»Ÿç®¡ç†å’Œæ§åˆ¶å·¥å…·</p></li><li><p><code>Connection Pool</code>: è¿æ¥æ± ã€‚ç®¡ç†ç¼“å†²ç”¨æˆ·è¿æ¥ï¼Œçº¿ç¨‹å¤„ç†ç­‰éœ€è¦ç¼“å­˜çš„éœ€æ±‚</p></li><li><p><code>SQL Interface</code>: SQLæ¥å£ã€‚æ¥å—ç”¨æˆ·çš„SQLå‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›ç”¨æˆ·éœ€è¦æŸ¥è¯¢çš„ç»“æœã€‚æ¯”å¦‚<code>select from</code>å°±æ˜¯è°ƒç”¨S<code>QL Interface</code></p></li><li><p><code>Parser</code>: è§£æå™¨ã€‚SQLå‘½ä»¤ä¼ é€’åˆ°è§£æå™¨çš„æ—¶å€™ä¼šè¢«è§£æå™¨éªŒè¯å’Œè§£æã€‚è§£æå™¨æ˜¯ç”±Lexå’ŒYACCå®ç°çš„ï¼Œæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„è„šæœ¬ã€‚</p><p>  ä¸»è¦åŠŸèƒ½ï¼š</p><p>  a . å°†SQLè¯­å¥åˆ†è§£æˆæ•°æ®ç»“æ„ï¼Œå¹¶å°†è¿™ä¸ªç»“æ„ä¼ é€’åˆ°åç»­æ­¥éª¤ï¼Œä»¥åSQLè¯­å¥çš„ä¼ é€’å’Œå¤„ç†å°±æ˜¯åŸºäºè¿™ä¸ªç»“æ„çš„</p><p>  b.  å¦‚æœåœ¨åˆ†è§£æ„æˆä¸­é‡åˆ°é”™è¯¯ï¼Œé‚£ä¹ˆå°±è¯´æ˜è¿™ä¸ªsqlè¯­å¥æ˜¯ä¸åˆç†çš„</p></li><li><p><code>Optimizer</code>: æŸ¥è¯¢ä¼˜åŒ–å™¨ã€‚SQLè¯­å¥åœ¨æŸ¥è¯¢ä¹‹å‰ä¼šä½¿ç”¨æŸ¥è¯¢ä¼˜åŒ–å™¨å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚ä»–ä½¿ç”¨çš„æ˜¯â€œé€‰å–-æŠ•å½±-è”æ¥â€ç­–ç•¥è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p>ç”¨ä¸€ä¸ªä¾‹å­å°±å¯ä»¥ç†è§£ï¼š <code>select uid,name from user where gender = 1;</code></p><p>è¿™ä¸ª<code>select</code> æŸ¥è¯¢å…ˆæ ¹æ®<code>where</code> è¯­å¥è¿›è¡Œé€‰å–ï¼Œè€Œä¸æ˜¯å…ˆå°†è¡¨å…¨éƒ¨æŸ¥è¯¢å‡ºæ¥ä»¥åå†è¿›è¡Œ<code>gender</code>è¿‡æ»¤ï¼›è¿™ä¸ª<code>select</code>æŸ¥è¯¢å…ˆæ ¹æ®<code>uid</code>å’Œ<code>name</code>è¿›è¡Œå±æ€§æŠ•å½±ï¼Œè€Œä¸æ˜¯å°†å±æ€§å…¨éƒ¨å–å‡ºä»¥åå†è¿›è¡Œè¿‡æ»¤ï¼›å°†è¿™ä¸¤ä¸ªæŸ¥è¯¢æ¡ä»¶è”æ¥èµ·æ¥ç”Ÿæˆæœ€ç»ˆæŸ¥è¯¢ç»“æœ</p></li><li><p><code>Cache</code>å’Œ<code>Buffer</code>ï¼š æŸ¥è¯¢ç¼“å­˜ã€‚</p><p>å¦‚æœæŸ¥è¯¢ç¼“å­˜æœ‰å‘½ä¸­çš„æŸ¥è¯¢ç»“æœï¼ŒæŸ¥è¯¢è¯­å¥å°±å¯ä»¥ç›´æ¥å»æŸ¥è¯¢ç¼“å­˜ä¸­å–æ•°æ®ã€‚è¿™ä¸ªç¼“å­˜æœºåˆ¶æ˜¯ç”±ä¸€ç³»åˆ—å°ç¼“å­˜ç»„æˆçš„ã€‚æ¯”å¦‚è¡¨ç¼“å­˜ï¼Œè®°å½•ç¼“å­˜ï¼Œkeyç¼“å­˜ï¼Œæƒé™ç¼“å­˜ç­‰</p></li><li><p><code>Engine</code> ï¼šå­˜å‚¨å¼•æ“ã€‚</p><p>å­˜å‚¨å¼•æ“æ˜¯MySqlä¸­å…·ä½“çš„ä¸æ–‡ä»¶æ‰“äº¤é“çš„å­ç³»ç»Ÿã€‚ä¹Ÿæ˜¯Mysqlæœ€å…·æœ‰ç‰¹è‰²çš„ä¸€ä¸ªåœ°æ–¹ã€‚</p><p>Mysqlçš„å­˜å‚¨å¼•æ“æ˜¯æ’ä»¶å¼çš„ã€‚å®ƒæ ¹æ®MySQL ABå…¬å¸æä¾›çš„æ–‡ä»¶è®¿é—®å±‚çš„ä¸€ä¸ªæŠ½è±¡æ¥å£æ¥å®šåˆ¶ä¸€ç§æ–‡ä»¶è®¿é—®æœºåˆ¶ï¼ˆè¿™ç§è®¿é—®æœºåˆ¶å°±å«å­˜å‚¨å¼•æ“ï¼‰</p><p>ç°åœ¨æœ‰å¾ˆå¤šç§å­˜å‚¨å¼•æ“ï¼Œå„ä¸ªå­˜å‚¨å¼•æ“çš„ä¼˜åŠ¿å„ä¸ä¸€æ ·ï¼Œæœ€å¸¸ç”¨çš„MyISAM,InnoDB</p><p>  MySQL 5.5 ç‰ˆæœ¬ä¹‹å‰é»˜è®¤ä½¿ç”¨MyISAMå¼•æ“ï¼Œå®ƒæŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œæœ‰è¾ƒå¥½çš„ç´¢å¼•ä¼˜åŒ–å’Œæ•°æ®å‹ç¼©æŠ€æœ¯ã€‚ä½†æ˜¯å®ƒä¸æ”¯æŒäº‹åŠ¡ã€‚</p><p>  MySQL 5.5 ç‰ˆæœ¬å¼€å§‹é»˜è®¤ä½¿ç”¨InnoDBå¼•æ“ï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªæ”¯æŒæ‹¥æœ‰ACIDç‰¹æ€§äº‹åŠ¡çš„å­˜å‚¨å¼•æ“ï¼Œå¹¶ä¸”æä¾›è¡Œçº§çš„é”å®šï¼Œåº”ç”¨ä¹Ÿç›¸å½“å¹¿æ³›ã€‚</p><p>  Mysqlä¹Ÿæ”¯æŒè‡ªå·±å®šåˆ¶å­˜å‚¨å¼•æ“ï¼Œç”šè‡³ä¸€ä¸ªåº“ä¸­ä¸åŒçš„è¡¨ä½¿ç”¨ä¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œè¿™äº›éƒ½æ˜¯å…è®¸çš„ã€‚</p></li></ul><h3 id="MySQL-å­˜å‚¨å¼•æ“"><a href="#MySQL-å­˜å‚¨å¼•æ“" class="headerlink" title="MySQL å­˜å‚¨å¼•æ“"></a>MySQL å­˜å‚¨å¼•æ“</h3><h4 id="å­˜å‚¨å¼•æ“æ¦‚è¿°"><a href="#å­˜å‚¨å¼•æ“æ¦‚è¿°" class="headerlink" title="å­˜å‚¨å¼•æ“æ¦‚è¿°"></a>å­˜å‚¨å¼•æ“æ¦‚è¿°</h4><p><code>innodb</code>å­˜å‚¨å¼•æ“ï¼šé¢å‘OLTP(online transaction processing)ã€è¡Œé”ã€æ”¯æŒå¤–é”®ã€éé”å®šè¯»ã€é»˜è®¤é‡‡ç”¨repeaableçº§åˆ«ï¼ˆå¯é‡å¤è¯»ï¼‰é€šè¿‡next-keylockingç­–ç•¥é¿å…å¹»è¯»ã€æ’å…¥ç¼“å†²ã€äºŒæ¬¡å†™ã€è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€é¢„è¯»</p><p><code>myisam</code>å­˜å‚¨å¼•æ“ï¼šä¸æ”¯æŒäº‹åŠ¡ã€è¡¨é”ã€å…¨æ–‡ç´¢å¼•ã€é€‚åˆolapï¼ˆåœ¨çº¿åˆ†æå¤„ç†ï¼‰ï¼Œå…¶ä¸­myd:æ”¾æ•°æ®æ–‡ä»¶ï¼Œmyi:æ”¾ç´¢å¼•æ–‡ä»¶</p><p><code>ndb</code>å­˜å‚¨å¼•æ“ï¼šé›†ç¾¤å­˜å‚¨å¼•æ“ï¼Œshare nothingï¼Œå¯æé«˜å¯ç”¨æ€§</p><p><code>memory</code>å­˜å‚¨å¼•æ“ï¼šæ•°æ®å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œè¡¨é”ï¼Œå¹¶å‘æ€§èƒ½å·®ï¼Œé»˜è®¤ä½¿ç”¨å“ˆå¸Œç´¢å¼•</p><p><code>archive</code>å­˜å‚¨å¼•æ“ï¼šåªæ”¯æŒ<code>insert</code>å’Œ<code>select</code> ï¼Œzlibç®—æ³•å‹ç¼©1ï¼š10ï¼Œé€‚åˆå­˜å‚¨å½’æ¡£æ•°æ®å¦‚æ—¥å¿—ç­‰ã€è¡Œé”</p><p><code>maria</code>å­˜å‚¨å¼•æ“ï¼šç›®çš„å–ä»£myisamã€ç¼“å­˜æ•°æ®å’Œç´¢å¼•ã€è¡Œé”ã€mvcc</p><p><img src="pic/14-engine.jpg" alt="engine diff"></p><hr><h4 id="çŸ¥åçš„ä¸¤å¤§å­˜å‚¨å¼•æ“"><a href="#çŸ¥åçš„ä¸¤å¤§å­˜å‚¨å¼•æ“" class="headerlink" title="çŸ¥åçš„ä¸¤å¤§å­˜å‚¨å¼•æ“"></a>çŸ¥åçš„ä¸¤å¤§å­˜å‚¨å¼•æ“</h4><p>å­˜å‚¨å¼•æ“æ˜¯æ•°æ®åº“å½“ä¸­éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œè¿™æ˜¯ä¸€ä¸ªé‡ç‚¹ã€‚ä»€ä¹ˆæ˜¯å­˜å‚¨å¼•æ“å‘¢ï¼Ÿå¼•æ“è¿™ä¸ªä¸œè¥¿æ˜¯ç”¨åœ¨è½¦ä¸Šçš„ï¼Œè¯´è½¦å­è·‘å¿«è·‘æ…¢ï¼Œæœ€ç›´æ¥çš„å…³ç³»ï¼Œå¼•æ“ï¼Œå½“ç„¶ä¸æ˜¯å”¯ä¸€çš„å…³ç³»ã€‚å°±åƒæˆ‘ä»¬è¯´è®¡ç®—æœºcpuæ˜¯æœ€ç›´æ¥çš„åŸå› ã€‚å¯¹æ±½è½¦æ¥è¯´å‘¢ï¼Œå°±æ˜¯å¼•æ“æœ€å…³é”®ã€‚æ•°æ®åº“ä»–çš„ä¼˜ç‚¹æ˜¯æ•°æ®è¯»å†™æ¯”è¾ƒå¿«ï¼Œé‚£ä¹ˆä»–è¯»å†™ä¹‹æ‰€ä»¥æ¯”ä¸€èˆ¬çš„åº”ç”¨ç¨‹åºå¿«ï¼Œé‚£æ˜¯å› ä¸ºä»–è¯»å†™çš„æ–¹å¼ä¸ä¸€æ ·ã€‚æˆ‘ä»¬æŠŠæ•°æ®åº“è¯»æ•°æ®ï¼Œè¯»æ–‡ä»¶ï¼Œå†™æ•°æ®ï¼Œå†™æ–‡ä»¶ï¼Œé‚£ç§è¯»å†™æ“ä½œçš„æ–¹æ³•å«åšå­˜å‚¨å¼•æ“ã€‚æŒ‡çš„æ˜¯â€œDBè¯»å†™æ•°æ®çš„æ–¹å¼â€ã€‚ç®€å•çš„ä¸€å¥è¯æ¦‚æ‹¬ï¼Œæ•°æ®åº“è¯»å†™æ•°æ®çš„æ–¹å¼å«åšå­˜å‚¨å¼•æ“ã€‚è¯»å†™æ•°æ®çš„æ–¹å¼ä¼šç›´æ¥å½±å“åˆ°æ•°æ®åº“æ€§èƒ½ï¼Œæ‰€ä»¥æ˜¯éå¸¸é‡è¦çš„ã€‚mysqlç”¨çš„æ˜¯ä¸¤å¤§å­˜å‚¨å¼•æ“ï¼Œä¸€ä¸ªå«åšmyisamå­˜å‚¨å¼•æ“ï¼Œç¬¬äºŒä¸ªå«åšinnodbå­˜å‚¨å¼•æ“ï¼Œè¿™æ˜¯æœ€å¸¸è§çš„ã€æœ€çŸ¥åçš„å­˜å‚¨å¼•æ“ï¼Œmyisamå’Œinnodbå­˜å‚¨å¼•æ“ã€‚å…¶å®è¿˜æœ‰å…¶ä»–å­˜å‚¨å¼•æ“ï¼Œå¤§æ¦‚æˆ‘è®°å¾—mysqlæ”¯æŒ8ä¸ªä¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œå¯èƒ½åæ¥å‘¢åˆæ‰©å®¹äº†ï¼Œä½†æ˜¯ä¸ç®¡æœ‰å‡ ä¸ªï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯è¿™ä¹ˆä¸¤ä¸ªã€‚</p><p>è¿™ä¸¤ä¸ªå­˜å‚¨å¼•æ“æœ‰å„è‡ªçš„ä¼˜åŠ£ç‚¹ï¼Œæœ‰å„è‡ªçš„ç‰¹æ€§ã€‚æ¯”å¦‚è¯´ï¼Œä¸¤ä¸ªæœ€å¤§çš„åŒºåˆ«ï¼Œmyisamæ˜¯ä¸€ä¸ªéäº‹åŠ¡å‹çš„å­˜å‚¨å¼•æ“ï¼Œå¯ä»¥æ”¯æŒè¡¨é”ï¼Œæˆ–è€…è¯´åªæ”¯æŒè¡¨é”ï¼›innodbæ˜¯ä¸€ä¸ªäº‹åŠ¡å‹å­˜å‚¨å¼•æ“ï¼Œèƒ½å¤Ÿæ”¯æŒåˆ°è¡Œé”ã€‚è¿™æ˜¯ä¸¤ä¸ªç‰¹æ€§ï¼Œä¸æ˜¯è¯´äº‹åŠ¡å‹å­˜å‚¨å°±èƒ½æ”¯æŒè¡Œé”ï¼Œè¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„ç‰¹ç‚¹ï¼Œä¸€ä¸ªç‰¹ç‚¹æ˜¯äº‹åŠ¡å‹å’Œéäº‹åŠ¡å‹ï¼Œä¸€ä¸ªç‰¹ç‚¹æ˜¯è¡Œé”ä¸è¡¨é”ã€‚å®ç°è¡Œé”ï¼Œå…¶å®å¤§éƒ¨åˆ†å¼•æ“å®ç°çš„éƒ½æ˜¯è¡¨é”ï¼Œå®ç°è¡¨é”çš„å­˜å‚¨å¼•æ“ä¸å¤šï¼Œinnodbæ˜¯å…¶ä¸­ä¸€ä¸ªï¼Œndbä¹Ÿæ˜¯ä¸€ä¸ªï¼Œæ¯”è¾ƒè‘—åçš„èƒ½å¤Ÿå®ç°è¡Œé”çš„å­˜å‚¨å¼•æ“ã€‚</p><p>INNODBå¯ä»¥å®ç°è¡Œé”ï¼Œæ‰€ä»¥INNODBåœ¨çº¿ä¸Šç”Ÿå­˜ç¯å¢ƒä¸­ï¼Œå¤§å¹¶å‘ç”¨æˆ·è¯·æ±‚ä¸‹ï¼Œä»–çš„æ€§èƒ½æŸå¤±å¹¶ä¸å¤§ï¼›è€ŒMYISAMç”¨çš„æ˜¯è¡¨é”ï¼Œä¸€æ—¦å¹¶å‘ç”¨æˆ·æ•°é‡å¤šäº†ï¼Œæ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™ï¼Œéšç€ä»–ä»¬ç”¨æˆ·æ•°é‡çš„å¢åŠ ï¼Œå†²çªä¼šæ˜æ˜¾å¢åŠ ï¼Œå†²çªæ¬¡æ•°è¶Šå¤šï¼Œæ€§èƒ½è¶Šä½ï¼Œæ’é˜Ÿç”¨æˆ·è¶Šå¤šã€‚æˆ‘ä»¬è¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ¨èçº¿ä¸Šç”Ÿäº§ç¯å¢ƒå°½é‡ä½¿ç”¨INNODBï¼Œä¼šæœ‰å¾ˆå¤šä¼˜ç‚¹ï¼›ä½†å¦‚æœä¸æ¶‰åŠåˆ°é”å†²çªï¼Œä¸æ¶‰åŠåˆ°äº‹åŠ¡å‹ï¼Œæˆ–è€…è¯´ä¸æ¶‰åŠåˆ°å†™æ“ä½œï¼Œæ¯”å¦‚æˆ‘è¿™å°æœåŠ¡å™¨ä¸“é—¨ç”¨æ¥è¯»ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™MYISAMçš„è¯»æ€§èƒ½æ˜¯å¤§äºINNODBçš„ï¼Œä»–æ˜¯é€‚åˆäºå°å¹¶å‘ä¸‹é¢çš„è¯»å¤šå†™å°‘çš„ç¯å¢ƒã€‚é”è¡Œæ¯”é”è¡¨è¦éº»çƒ¦ï¼Œé”ç²¾åº¦è¶Šç²¾ç»†ï¼Œæ“ä½œèµ·æ¥è‚¯å®šè¶Šéº»çƒ¦ï¼Œæ‰€ä»¥åœ¨åªè¯»çš„ç¯å¢ƒä¸‹ï¼Œç”¨MYISAMè‚¯å®šæ€§èƒ½ä¼šé«˜ä¸€äº›ã€‚å¤šæ•°æƒ…å†µä¸‹MYISAMå­˜å‚¨å¼•æ“å‘¢æ˜¯ç»™ç®¡ç†å‘˜åšç»Ÿè®¡ç”¨çš„ã€‚ç®¡ç†å‘˜æœ‰ä¸€ä¸ªæ•°æ®åº“è¦å»åˆ†ææ•°æ®ï¼Œä¸€ä¸ªäººåˆ†æå°±å¤Ÿäº†ï¼Œä¸ä¼šè¯´æœ‰ä¸€åƒä¸ªç”¨æˆ·åŒæ—¶ç™»ä¸Šå»ï¼Œå¤§å®¶ä¸€èµ·åˆ†æï¼Œä¸ä¼šçš„ã€‚è€Œä¸”åˆ†ææ•°æ®åº“ï¼Œå¾ˆå¤šéƒ½æ˜¯ç”¨çš„è¯»ç¯å¢ƒï¼Œè¿™ä¸ªè¡¨å½“ä¸­æœ‰å¤šå°‘è®°å½•ï¼Œå“ªä¸ªè¡¨å½“ä¸­æœ‰å¤šå°‘è®°å½•ï¼Œè¡¨å½“ä¸­æœ€å¤§å€¼æ˜¯å¤šå°‘ï¼Œæœ€å°å€¼æ˜¯å¤šå°‘ï¼Œç›¸å¯¹äºä¸Šä¸€æ¬¡çš„ç»Ÿè®¡ç»“æœæˆ‘æœ‰ä»€ä¹ˆæ ·çš„æ”¹å˜ï¼Œå¾ˆå¤šæ—¶å€™éƒ½æ˜¯è¯»æ“ä½œã€‚æ‰€ä»¥åƒè¿™ç§çº¿ä¸‹æ•°æ®ç»Ÿè®¡åˆ†ææ¯”è¾ƒé€‚åˆäºMYISAMã€‚<br>å¦å¤–æä¸€ä¸‹ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µä¸‹ä¹Ÿä¼šç”¨MYISAMã€‚åœ¨åšä¸»ä»åŒæ­¥çš„æ—¶å€™ï¼Œä¹Ÿç§°ä¸ºA/Bå¤åˆ¶ã€‚æœ‰ä¸€å°æœåŠ¡å™¨å«åšMasterï¼Œæœ‰ä¸€å †ä»æœåŠ¡å™¨å«åšSlaveï¼ŒMasterç”¨æ¥åšå†™æ“ä½œï¼Œå†™å®Œä»¥ååŒæ­¥ç»™ä»æœºï¼Œä»æœºåªç”¨æ¥åšè¯»æ“ä½œã€‚é‚£ä¹ˆä»æœºå°±æ˜¯ä¸€ä¸ªåªè¯»ç¯å¢ƒï¼Œç”¨MYISAMæ•°æ®åº“å¼•æ“ï¼Œæ˜¯ä¸æ˜¯ç¬¦åˆæˆ‘ä»¬è¯»å¤šå†™å°‘çš„ç¯å¢ƒå•Šï¼Œè€Œä¸»æœåŠ¡å™¨ç”¨INNODBï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§æ¶æ„çš„æ–¹å¼ï¼Œäº†è§£ä¸€ä¸‹ï¼Œæœ‰çš„å…¬å¸æ¯”è¾ƒè¿½æ±‚è¯»æ€§èƒ½å°±ä¼šç”¨è¿™ç§æ¶æ„ï¼Œä½†æ˜¯æˆ‘ä»¬å¤§å¤šæ•°æ—¶å€™æ˜¯ä¸»ä»éƒ½ç”¨INNODBã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ¥äº†è§£ä¸€ä¸‹MYSQLå’ŒMARIADBé»˜è®¤çš„å­˜å‚¨å¼•æ“æ˜¯ä»€ä¹ˆï¼Œå°±æ˜¯è¯´ä½ ä»€ä¹ˆæ“ä½œéƒ½ä¸æ”¹ï¼Œåšæ•°æ®è¯»å†™çš„æ—¶å€™é»˜è®¤ä½¿ç”¨çš„å­˜å‚¨å¼•æ“ã€‚MYSQLæœ‰å‡ ä¸ªä¸åŒçš„ç‰ˆæœ¬ï¼Œåœ¨SUNå…¬å¸æ‰‹ä¸‹çš„æ—¶å€™ï¼Œæœ‰5.0ç‰ˆæœ¬å’Œ5.1ç‰ˆæœ¬ï¼Œé»˜è®¤ä½¿ç”¨MYISAMå­˜å‚¨å¼•æ“ï¼›åæ¥è¢«ORACLEæ”¶è´­ä¹‹åçš„ç¬¬ä¸€ç‰ˆæœ¬æ˜¯5.5ï¼Œå¼€å‘çš„ç¬¬äºŒä¸ªç‰ˆæœ¬æ˜¯5.6ï¼Œç°åœ¨æœ€æ–°çš„ç‰ˆæœ¬æ˜¯5.7ï¼ŒORACLEæ”¶è´­å®Œé»˜è®¤çš„å­˜å‚¨å¼•æ“æ˜¯INNODBã€‚MARIADBæœ‰5.0ï¼Œ5.1ç›¸å¯¹äºMYSQLçš„5.0å’Œ5.1ï¼Œæœ‰ä¸€ä¸ªMYSQLç‰ˆæœ¬ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªMARIADBç‰ˆæœ¬ã€‚RHEL7é»˜è®¤ç”¨çš„MARIADB 5.5ç‰ˆæœ¬ï¼ŒMYSQLæœ‰5.6ç‰ˆæœ¬ï¼ŒMARIADBå¯¹åº”çš„æ˜¯10ç‰ˆæœ¬ï¼ŒMYSQL 5.7ç‰ˆæœ¬ï¼Œå¯¹åº”çš„æ˜¯MARIADB 10.1ç‰ˆæœ¬ã€‚MARIADBè¯´æˆ‘ä»¥åä¸ä¼šè·Ÿç€ä½ çš„ç‰ˆæœ¬èµ°ï¼Œå› ä¸ºæˆ‘åæœŸå¼€å‘çš„è¿‡ç¨‹ä¸­ï¼ŒåŠŸèƒ½æ¯”ä½ å¤šï¼Œæ‰€ä»¥æˆ‘ç‰ˆæœ¬è·Ÿä½ ä¸€æ ·ï¼Œä¼šè®©ç”¨æˆ·æœ‰ä¸€ä¸ªé”™è¯¯çš„åˆ¤æ–­ï¼Œè®¤ä¸ºå¥½åƒæˆ‘æœ‰çš„åŠŸèƒ½MYSQLä¹Ÿæœ‰ï¼Œè€Œäº‹å®ä¸ŠMYSQLæ²¡æœ‰ï¼Œæˆ‘æ˜¯è¶…è¶ŠMYSQLçš„ã€‚<br>ORACLEå®˜æ–¹è¯´ï¼ŒMYSQL 5.6ç‰ˆæœ¬æ€§èƒ½è¦é«˜å‡º5.5ç‰ˆæœ¬çš„30%ï¼Œç›¸åŒçš„ç¡¬ä»¶ï¼Œç›¸åŒçš„æœºå™¨ä¸Šé¢ï¼Œæ€§èƒ½è¦é«˜å‡º30%ã€‚5.7ç›¸å¯¹äº5.6é«˜70%ï¼Œè¿™ä¸œè¥¿ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨æ€§èƒ½è°ƒä¼˜çš„æ—¶å€™æ˜¯å¾ˆéš¾æƒ³è±¡çš„ï¼Œåœ¨ç›¸åŒçš„ç¡¬ä»¶ä¸Šé¢ï¼Œå› ä¸ºç¨‹åºç¨ä½œä¿®æ”¹è®©æ€§èƒ½æå‡è¿™ä¹ˆå¤§ã€‚ä¸€èˆ¬æ¥è¯´ç¨‹åºç‰ˆæœ¬å‡çº§ä¹‹åï¼Œæ€§èƒ½å¢åŠ ä¸ª5%-10%ï¼Œè¿™æ˜¯åœ¨ä¸€ä¸ªå¯ä»¥ç†è§£çš„ï¼Œé€šå¸¸çš„æ–¹æ¡ˆå½“ä¸­ï¼Œä½†æ˜¯ORACLEè¯´èƒ½æå‡70%ï¼Œä»–çš„ç¡®åšäº†å¾ˆå¤šçš„ä¿®æ”¹ã€‚æ‰€ä»¥æˆ‘çš„å»ºè®®æ˜¯ï¼Œå¦‚æœå¤§å®¶ä½¿ç”¨MYSQSLï¼Œé‚£ä¹ˆèµ·ç è¦ä»5.6å¼€å§‹ä½¿ç”¨ï¼Œæœ€å¥½æ˜¯ä½¿ç”¨5.7ç‰ˆæœ¬ï¼Œæ€§èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œè¿˜æœ‰åé¢è¯¸å¤šé—®é¢˜ï¼Œä¾‹å¦‚å®‰å…¨æ€§é—®é¢˜ã€é«˜å¯ç”¨çš„é—®é¢˜ã€å¾ˆå¤šå»¶è¿Ÿæ€§çš„é—®é¢˜éƒ½å¾—åˆ°äº†ORACLEå…¬å¸éå¸¸æœ‰æ•ˆçš„è§£å†³ï¼å½“ç„¶ORACLEè¿™ä¹ˆåšä¹Ÿæ˜¯æœ‰ä»–çš„åŸå› çš„ï¼Œå› ä¸ºå¤ªå¤šçš„äººå»ä½¿ç”¨MARIADBäº†ï¼Œä»–å¦‚æœä¸åœ¨MYSQLä¸Šä½œå‡ºä¸€äº›é‡å¤§çš„çªç ´ï¼Œå°±æ²¡äººæ„¿æ„å»ç”¨MYSQLäº†ï¼Œæ‰€ä»¥ä»–è¿˜æ˜¯æœ‰äº†éå¸¸å¤§çš„æ”¹è¿›ã€‚å½“ç„¶MARIADBä¹Ÿæœ‰äº†æ”¹è¿›ï¼Œä½ æœ‰çš„åŠŸèƒ½æˆ‘ä¹Ÿæœ‰ï¼Œå¦‚æœç”¨MARIADBï¼Œæˆ‘å»ºè®®ç”¨10ç‰ˆæœ¬ï¼Œè¿™ä¸ªå€’ä¸æ˜¯æ€§èƒ½é—®é¢˜ï¼Œä¸»è¦æ˜¯ä¸€äº›æ–°ç‰¹æ€§ï¼Œå’Œå®‰å…¨ç›¸å…³çš„ä¸€äº›ç‰¹æ€§ï¼Œè¿˜æœ‰åŠŸèƒ½ç›¸å…³çš„ä¸€äº›ç‰¹æ€§ï¼Œ5.5ç‰ˆæœ¬ç¡®å®æ˜¯ç¼ºå°‘äº†ä¸€äº›éå¸¸é‡è¦çš„ä¸€äº›ç‰¹æ€§ï¼Œæ‰€ä»¥å»ºè®®ä½ ä¸Š10æˆ–è€…10.1ç‰ˆæœ¬ã€‚<br>æˆ‘ä»¬çš„è¯¾ç¨‹å½“ä¸­è¿˜æ˜¯ä»¥mariadbçš„5.5ç‰ˆæœ¬ï¼Œå› ä¸ºå¸¸è§çš„åŸºç¡€æ“ä½œä¸ç®¡å“ªä¸ªç‰ˆæœ¬éƒ½ä¸€æ ·ï¼ŒåŸºç¡€è®²å®Œäº†ä¼šç”¨mysqlçš„5.7ç‰ˆæœ¬æˆ–è€…mariadb10.1ç‰ˆæœ¬ï¼Œè®²ä¸€äº›ä»–ä»¬å…·æœ‰çš„æ–°ç‰¹æ€§ã€‚ä»¥é»˜è®¤ç‰ˆæœ¬å»è®²åŸºç¡€æ“ä½œï¼Œå†ä»¥æ–°ç‰ˆæœ¬å»è®²æ–°ç‰¹æ€§ã€‚</p><p>INNODB çš„ç‰¹æ€§</p><p><img src="pic/16-mysql5.6innodb.jpg" alt="innodb"></p><ul><li>ä¸»ä½“ç³»ç»“æ„ï¼šé»˜è®¤7ä¸ªåå°çº¿ç¨‹ï¼Œ4ä¸ªio thread(insert bufferã€logã€readã€write),1ä¸ªmaster thread(ä¼˜å…ˆçº§æœ€é«˜),1ä¸ªé”(lock)ç›‘æ§çº¿ç¨‹ï¼Œ1ä¸ªé”™è¯¯ç›‘æ§çº¿ç¨‹ã€‚å¯ä»¥é€šè¿‡<code>show engine innodb status</code>æ¥æŸ¥çœ‹ã€‚æ–°ç‰ˆæœ¬å·²å¯¹é»˜è®¤çš„read threadå’Œwrite threadåˆ†åˆ«å¢å¤§åˆ°4ä¸ªï¼Œå¯é€šè¿‡<code>show variables like &#39;innodb_io_thread%&#39;</code>æŸ¥çœ‹ã€‚</li></ul><p><img src="pic/thread01.png" alt=""></p><ul><li>å­˜å‚¨å¼•æ“ç»„æˆï¼šç¼“å†²æ± (buffer pool)ã€é‡åšæ—¥å¿—ç¼“å†²æ± (redo log buffer)ä»¥åŠé¢å¤–çš„å†…å­˜æ± (additional memory pool).å…·ä½“é…ç½®å¯ç”±<code>show variables like &#39;innodb_buffer_pool_size&#39;</code>ã€<code>show variables like&#39;innodb_log_buffer_size&#39;</code>ã€<code>show variables like &#39;innodb_additional_mem_pool_size&#39;</code>æ¥æŸ¥çœ‹ã€‚</li></ul><p><img src="pic/thread02.png" alt=""></p><ul><li><p>ç¼“å†²æ± ï¼šå æœ€å¤§å—å†…å­˜ï¼Œç”¨æ¥å­˜æ”¾å„ç§æ•°æ®çš„ç¼“å­˜åŒ…æ‹¬æœ‰ç´¢å¼•é¡µã€æ•°æ®é¡µã€undoé¡µã€æ’å…¥ç¼“å†²ã€è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€innodbå­˜å‚¨çš„é”ä¿¡æ¯ã€æ•°æ®å­—å…¸ä¿¡æ¯ç­‰ã€‚å·¥ä½œæ–¹å¼æ€»æ˜¯å°†æ•°æ®åº“æ–‡ä»¶æŒ‰é¡µ(æ¯é¡µ16k)è¯»å–åˆ°ç¼“å†²æ± ï¼Œç„¶åæŒ‰æœ€è¿‘æœ€å°‘ä½¿ç”¨(lru)çš„ç®—æ³•æ¥ä¿ç•™åœ¨ç¼“å†²æ± ä¸­çš„ç¼“å­˜æ•°æ®ã€‚å¦‚æœæ•°æ®åº“æ–‡ä»¶éœ€è¦ä¿®æ”¹ï¼Œæ€»æ˜¯é¦–å…ˆä¿®æ”¹åœ¨ç¼“å­˜æ± ä¸­çš„é¡µ(å‘ç”Ÿä¿®æ”¹åå³ä¸ºè„é¡µ)ï¼Œç„¶åå†æŒ‰ç…§ä¸€å®šçš„é¢‘ç‡å°†ç¼“å†²æ± çš„è„é¡µåˆ·æ–°åˆ°æ–‡ä»¶ã€‚é€šè¿‡å‘½ä»¤<code>show engine innodb status;</code>æ¥æŸ¥çœ‹ã€‚</p></li><li><p>æ—¥å¿—ç¼“å†²ï¼šå°†é‡åšæ—¥å¿—ä¿¡æ¯å…ˆæ”¾å…¥è¿™ä¸ªç¼“å†²åŒºï¼Œç„¶åæŒ‰ä¸€å®šé¢‘ç‡å°†å…¶åˆ·æ–°åˆ°é‡åšæ—¥å¿—æ–‡ä»¶ã€‚</p></li></ul><hr><blockquote><h3 id="master-thread"><a href="#master-thread" class="headerlink" title="master thread:"></a><code>master thread</code>:</h3></blockquote><blockquote><h4 id="loopä¸»å¾ªç¯æ¯ç§’ä¸€æ¬¡çš„æ“ä½œï¼š"><a href="#loopä¸»å¾ªç¯æ¯ç§’ä¸€æ¬¡çš„æ“ä½œï¼š" class="headerlink" title="loopä¸»å¾ªç¯æ¯ç§’ä¸€æ¬¡çš„æ“ä½œï¼š"></a>loopä¸»å¾ªç¯æ¯ç§’ä¸€æ¬¡çš„æ“ä½œï¼š</h4></blockquote><ol><li>ç¡è§‰</li><li>å°†æ—¥å¿—ç¼“å†²åˆ·æ–°åˆ°ç£ç›˜ï¼Œå³ä½¿äº‹åŠ¡æœªæäº¤</li><li>å¦‚æœã€å‰1sçš„I/Oæ¬¡æ•°ã€‘å°äºã€ç£ç›˜I/Oååé‡çš„5% ï¼ˆé»˜è®¤200<em>5%=10ä¸ªé¡µï¼‰ã€‘ï¼Œåˆ™åˆå¹¶æ’å…¥ç¼“å†²ï¼ˆæ•°é‡ä¸ºç£ç›˜I/Oååé‡</em>5%å³10ä¸ªé¡µï¼‰</li><li>å¦‚æœã€è„é¡µæ¯”ä¾‹ã€‘å¤§äºã€é˜€å€¼ï¼ˆé»˜è®¤ä¸º75ï¼Œè„é¡µæ¯”ä¾‹ä¸ºç™¾åˆ†ä¹‹ä¸ƒåäº”ï¼‰ã€‘ï¼Œåˆ™åˆ·æ–°ç¼“å†²æ± ä¸­è„é¡µåˆ°ç£ç›˜ï¼Œå¦åˆ™åªåˆ·æ–°åˆé€‚çš„è„é¡µæ•°é‡ï¼ˆinnodb_adaptive_flushingå‚æ•°å†³å®šï¼‰</li><li>å½“å‰æ²¡æœ‰ç”¨æˆ·æ´»åŠ¨ï¼Œåˆ‡æ¢åˆ°åå°å¾ªç¯</li></ol><blockquote><h4 id="loopä¸»å¾ªç¯æ¯åç§’ä¸€æ¬¡çš„æ“ä½œï¼š"><a href="#loopä¸»å¾ªç¯æ¯åç§’ä¸€æ¬¡çš„æ“ä½œï¼š" class="headerlink" title="loopä¸»å¾ªç¯æ¯åç§’ä¸€æ¬¡çš„æ“ä½œï¼š"></a>loopä¸»å¾ªç¯æ¯åç§’ä¸€æ¬¡çš„æ“ä½œï¼š</h4></blockquote><ol><li>å°†æ—¥å¿—ç¼“å†²åˆ·æ–°åˆ°ç£ç›˜ï¼Œå³ä½¿äº‹åŠ¡æœªæäº¤</li><li>åˆ é™¤æ— ç”¨çš„undoé¡µ</li><li>åˆå¹¶æ’å…¥ç¼“å†²ï¼Œç¼“å†²æ•°é‡ä¸ºã€ç£ç›˜I/Oååé‡çš„5%ï¼Œå¦‚æœé»˜è®¤200ï¼Œåˆ™åˆå¹¶æ’å…¥ç¼“å†²10ä¸ªã€‘</li><li>å¦‚æœã€å‰10sçš„I/Oæ¬¡æ•°ã€‘å°äºã€ç£ç›˜I/Oååé‡ï¼ˆé»˜è®¤200<em>100%=200ä¸ªé¡µï¼‰ã€‘ï¼Œåˆ™åˆ·æ–°ç¼“å†²æ± ä¸­è„é¡µåˆ°ç£ç›˜ï¼ˆæ•°é‡ä¸ºç£ç›˜I/Oååé‡</em>100%å³200ä¸ªé¡µï¼‰</li><li>å¦‚æœã€è„é¡µæ¯”ä¾‹ã€‘å¤§äºã€é˜€å€¼ï¼ˆé»˜è®¤ä¸º75ï¼Œè„é¡µæ¯”ä¾‹ä¸ºç™¾åˆ†ä¹‹ä¸ƒåäº”ï¼‰ã€‘ï¼Œåˆ™åˆ·æ–°ç¼“å†²æ± ä¸­è„é¡µåˆ°ç£ç›˜ï¼ˆæ•°é‡ä¸ºç£ç›˜I/Oååé‡<em>100%å³200ä¸ªé¡µï¼‰ï¼Œå¦åˆ™è„é¡µåˆ·æ–°æ•°é‡ä¸ºï¼ˆç£ç›˜I/Oååé‡</em>10%å³20ä¸ªé¡µï¼‰</li><li>äº§ç”Ÿä¸€ä¸ªæ£€æŸ¥ç‚¹ï¼ˆæ¨¡ç³Šæ£€æŸ¥ç‚¹ï¼‰     </li></ol><blockquote><h4 id="backgroud-loopï¼Œè‹¥å½“å‰æ²¡æœ‰ç”¨æˆ·æ´»åŠ¨-æ•°æ®åº“ç©ºé—²æ—¶-æˆ–è€…æ•°æ®åº“å…³é—­æ—¶ï¼Œå°±ä¼šåˆ‡æ¢åˆ°è¿™ä¸ªå¾ªç¯ï¼š"><a href="#backgroud-loopï¼Œè‹¥å½“å‰æ²¡æœ‰ç”¨æˆ·æ´»åŠ¨-æ•°æ®åº“ç©ºé—²æ—¶-æˆ–è€…æ•°æ®åº“å…³é—­æ—¶ï¼Œå°±ä¼šåˆ‡æ¢åˆ°è¿™ä¸ªå¾ªç¯ï¼š" class="headerlink" title="backgroud loopï¼Œè‹¥å½“å‰æ²¡æœ‰ç”¨æˆ·æ´»åŠ¨(æ•°æ®åº“ç©ºé—²æ—¶)æˆ–è€…æ•°æ®åº“å…³é—­æ—¶ï¼Œå°±ä¼šåˆ‡æ¢åˆ°è¿™ä¸ªå¾ªç¯ï¼š"></a>backgroud loopï¼Œè‹¥å½“å‰æ²¡æœ‰ç”¨æˆ·æ´»åŠ¨(æ•°æ®åº“ç©ºé—²æ—¶)æˆ–è€…æ•°æ®åº“å…³é—­æ—¶ï¼Œå°±ä¼šåˆ‡æ¢åˆ°è¿™ä¸ªå¾ªç¯ï¼š</h4></blockquote><ol><li>åˆ é™¤æ— ç”¨çš„undoé¡µ</li><li>åˆå¹¶æ’å…¥ç¼“å†²ï¼Œç¼“å†²æ•°é‡ä¸ºã€ç£ç›˜I/Oååé‡çš„10%ï¼Œå¦‚æœé»˜è®¤200ï¼Œåˆ™åˆå¹¶æ’å…¥ç¼“å†²20ä¸ªã€‘</li><li>å½“å‰æœ‰ç”¨æˆ·æ´»åŠ¨ï¼Œåˆ‡æ¢åˆ°ä¸»å¾ªç¯</li><li>å½“å‰æ²¡æœ‰ç”¨æˆ·æ´»åŠ¨ï¼Œåˆ‡æ¢åˆ°åˆ·æ–°å¾ªç¯</li></ol><blockquote><h4 id="flush-loop-åˆ·æ–°å¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š"><a href="#flush-loop-åˆ·æ–°å¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š" class="headerlink" title="flush loop åˆ·æ–°å¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š"></a>flush loop åˆ·æ–°å¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š</h4></blockquote><ol><li>åˆ·æ–°ç¼“å†²æ± ä¸­è„é¡µåˆ°ç£ç›˜ï¼ˆæ•°é‡ä¸ºç£ç›˜I/Oååé‡*100%å³200ä¸ªé¡µï¼‰</li><li>å¦‚æœã€è„é¡µæ¯”ä¾‹ã€‘å¤§äºã€é˜€å€¼ï¼ˆé»˜è®¤ä¸º75ï¼Œè„é¡µæ¯”ä¾‹ä¸ºç™¾åˆ†ä¹‹ä¸ƒåäº”ï¼‰ã€‘ï¼Œåˆ™ç»§ç»­è¿›å…¥åˆ·æ–°å¾ªç¯ï¼Œå¦åˆ™è¿›å…¥æš‚åœå¾ªç¯</li></ol><blockquote><h4 id="suspend-loopæš‚åœå¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š"><a href="#suspend-loopæš‚åœå¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š" class="headerlink" title="suspend_loopæš‚åœå¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š"></a>suspend_loopæš‚åœå¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š</h4></blockquote><ol><li>ç­‰å¾…äº‹ä»¶å‘ç”Ÿï¼Œè¿›å…¥ä¸»å¾ªç¯</li></ol><p><img src="pic/thread03.png" alt=""></p><blockquote><h3 id="æ’å…¥ç¼“å†²ï¼š"><a href="#æ’å…¥ç¼“å†²ï¼š" class="headerlink" title="æ’å…¥ç¼“å†²ï¼š"></a><code>æ’å…¥ç¼“å†²</code>ï¼š</h3></blockquote><p>ä¸æ˜¯ç¼“å†²æ± çš„ä¸€éƒ¨åˆ†ï¼ŒInsert Bufferæ˜¯ç‰©ç†é¡µçš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†,å®ƒå¸¦æ¥InnoDBæ€§èƒ½çš„æé«˜ã€‚æ ¹æ®B+ç®—æ³•çš„ç‰¹ç‚¹ï¼Œæ’å…¥æ•°æ®çš„æ—¶å€™ä¸»é”®ç´¢å¼•æ˜¯é¡ºåºçš„ï¼Œä¸ä¼šé€ æˆæ•°æ®åº“çš„éšæœºè¯»å–ï¼Œè€Œå¯¹äºéèšé›†ç´¢å¼•(å³è¾…åŠ©ç´¢å¼•)ï¼Œå¶å­èŠ‚ç‚¹çš„æ’å…¥ä¸å†æ˜¯é¡ºåºçš„äº†ï¼Œè¿™æ—¶éœ€è¦ç¦»æ•£åœ°è®¿é—®éèšé›†ç´¢å¼•ï¼Œæ’å…¥æ€§èƒ½åœ¨è¿™é‡Œå˜ä½äº†ã€‚InnoDBå¼•å…¥æ’å…¥ç¼“å†²ï¼Œåˆ¤æ–­éèšé›†ç´¢å¼•é¡µæ˜¯å¦åœ¨ç¼“å†²æ± ä¸­ï¼Œå¦‚æœåœ¨åˆ™ç›´æ¥æ’å…¥;ä¸åœ¨ï¼Œåˆ™å…ˆæ”¾åœ¨ æ’å…¥ç¼“å†²åŒºä¸­ã€‚ç„¶åæ ¹æ®ä¸Šè¿°master threadä¸­ä»‹ç»çš„ï¼Œä¼šæœ‰ä¸€å®šçš„é¢‘ç‡å°†æ’å…¥ç¼“å†²åˆå¹¶ã€‚æ­¤å¤–ï¼Œè¾…åŠ©ç´¢å¼•ä¸èƒ½æ˜¯å”¯ä¸€çš„ï¼Œå› ä¸ºæ’å…¥åˆ°æ’å…¥ç¼“å†²æ—¶ï¼Œå¹¶ä¸å»æŸ¥æ‰¾ç´¢å¼•é¡µçš„æƒ…å†µï¼Œå¦åˆ™ä»ç„¶ä¼šé€ æˆéšæœºè¯»ï¼Œå¤±å»æ’å…¥ç¼“å†²çš„æ„ä¹‰äº†ã€‚æ’å…¥ç¼“å†²å¯èƒ½ä¼šå ç¼“å†²æ± ä¸­å†…å­˜ï¼Œé»˜è®¤ä¹Ÿèƒ½ä¼šå åˆ°1/2ï¼Œæ‰€ä»¥å¯ä»¥å°†è¿™ä¸ªå€¼è°ƒå°ç‚¹ï¼Œåˆ°1/3ã€‚é€šè¿‡IBUF_POOL_SIZE_PER_MAX_SIZEæ¥è®¾ç½®ï¼Œ2è¡¨ç¤º1/2,3è¡¨ç¤º1/3ã€‚</p><blockquote><h3 id="ä¸¤æ¬¡å†™ï¼š"><a href="#ä¸¤æ¬¡å†™ï¼š" class="headerlink" title="ä¸¤æ¬¡å†™ï¼š"></a><code>ä¸¤æ¬¡å†™</code>ï¼š</h3></blockquote><p>å®ƒå¸¦æ¥InnoDBæ•°æ®çš„å¯é æ€§ã€‚å¦‚æœå†™å¤±æ•ˆï¼Œå¯ä»¥é€šè¿‡é‡åšæ—¥å¿—è¿›è¡Œæ¢å¤ï¼Œä½†æ˜¯é‡åšæ—¥å¿—ä¸­è®°å½•çš„æ˜¯å¯¹é¡µçš„ç‰©ç†æ“ä½œï¼Œå¦‚æœé¡µæœ¬èº«æŸåï¼Œå†å¯¹å…¶è¿›è¡Œé‡åšæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚æ‰€ä»¥ï¼Œåœ¨åº”ç”¨é‡åšæ—¥å¿—å‰ï¼Œéœ€è¦ä¸€ä¸ªé¡µçš„å‰¯æœ¬ï¼Œå½“å†™å…¥å¤±æ•ˆå‘ç”Ÿæ—¶ï¼Œå…ˆé€šè¿‡é¡µçš„å‰¯æœ¬æ¥è¿˜åŸè¯¥é¡µï¼Œå†è¿›è¡Œé‡åšï¼Œè¿™å°±æ˜¯doublewireã€‚</p><p>æ¢å¤æ•°æ®=é¡µå‰¯æœ¬+é‡åšæ—¥å¿—</p><blockquote><h3 id="INNODB-çš„è¡¨"><a href="#INNODB-çš„è¡¨" class="headerlink" title="INNODB çš„è¡¨"></a>INNODB çš„è¡¨</h3></blockquote><ol><li><code>è¡¨ç©ºé—´</code>ï¼šè¡¨ç©ºé—´å¯çœ‹åšæ˜¯InnoDBå­˜å‚¨å¼•æ“é€»è¾‘ç»“æ„çš„æœ€é«˜å±‚ã€‚</li><li><code>æ®µ</code>ï¼šè¡¨ç©ºé—´ç”±å„ä¸ªæ®µç»„æˆï¼Œå¸¸è§çš„æ®µæœ‰æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µç­‰ã€‚</li><li><code>åŒº</code>ï¼šç”±64ä¸ªè¿ç»­çš„é¡µç»„æˆï¼Œæ¯ä¸ªé¡µå¤§å°ä¸º16kbï¼Œå³æ¯ä¸ªåŒºå¤§å°ä¸º1MBã€‚</li><li><code>é¡µ</code>ï¼šæ¯é¡µ16kbï¼Œä¸”ä¸èƒ½æ›´æ”¹ã€‚å¸¸è§çš„é¡µç±»å‹æœ‰ï¼šæ•°æ®é¡µã€Undoé¡µã€ç³»ç»Ÿé¡µã€äº‹åŠ¡æ•°æ®é¡µã€æ’å…¥ç¼“å†²ä½å›¾é¡µã€æ’å…¥ç¼“å†²ç©ºé—²åˆ—è¡¨é¡µã€æœªå‹ç¼©çš„äºŒè¿›åˆ¶å¤§å¯¹è±¡é¡µã€å‹ç¼©çš„äºŒè¿›åˆ¶å¤§å¯¹è±¡é¡µã€‚</li><li><code>è¡Œ</code>ï¼šInnoDBå­˜å‚¨å¼•æ“æ˜¯é¢å‘è¡Œçš„(row-oriented)ï¼Œæ¯é¡µæœ€å¤šå…è®¸å­˜æ”¾7992è¡Œæ•°æ®ã€‚</li><li><code>è¡Œè®°å½•æ ¼å¼</code>ï¼šå¸¸è§ä¸¤ç§è¡Œè®°å½•æ ¼å¼Compactå’ŒRedundantï¼Œmysql5.1ç‰ˆæœ¬åï¼Œä¸»è¦æ˜¯Compactè¡Œè®°å½•æ ¼å¼ã€‚å¯¹äºCompactï¼Œä¸ç®¡æ˜¯charå‹è¿˜æ˜¯varcharå‹ï¼Œnullå‹éƒ½æ˜¯ä¸å ç”¨å­˜å‚¨ç©ºé—´çš„ï¼›å¯¹äºRedudant,varcharçš„nullä¸å ç”¨ç©ºé—´ï¼Œcharçš„nullå‹æ˜¯å ç”¨å­˜å‚¨ç©ºé—´çš„ã€‚</li></ol><p>varcharç±»å‹çš„é•¿åº¦é™åˆ¶æ˜¯65535ï¼Œå…¶å®è¾¾ä¸åˆ°ï¼Œä¼šæœ‰åˆ«çš„å¼€é”€ï¼Œä¸€èˆ¬æ˜¯65530å·¦å³ï¼Œè¿™è¿˜è·Ÿé€‰å–çš„å­—ç¬¦é›†æœ‰å…³ã€‚æ­¤å¤–è¿™ä¸ªé•¿åº¦é™åˆ¶æ˜¯ä¸€æ•´è¡Œçš„ï¼Œä¾‹å¦‚ï¼š<code>create table test(a varchar(22000), b varchar(22000), cvarchar(22000)) charset=latin1 engine=innodb;</code>ä¹Ÿä¼šæŠ¥é”™ã€‚</p><p>å¯¹äºblobç±»å‹çš„æ•°æ®ï¼Œåœ¨æ•°æ®é¡µé¢ä¸­åªä¿å­˜äº†varchar(65535)çš„å‰768ä¸ªå­—èŠ‚å‰ç¼€æ•°æ®ï¼Œä¹‹åè·Ÿçš„æ˜¯åç§»é‡ï¼ŒæŒ‡å‘è¡Œæº¢å‡ºé¡µï¼Œä¹Ÿå°±æ˜¯Uncompressed BLOB Pageã€‚æ–°çš„InnoDB Pluginå¼•å…¥äº†æ–°çš„æ–‡ä»¶æ ¼å¼ç§°ä¸ºBarracudaï¼Œå…¶æœ‰ä¸¤ç§æ–°çš„è¡Œè®°å½•æ ¼å¼Compressedå’ŒDynamicï¼Œä¸¤è€…å¯¹äºå­˜å…¥Blogå­—æ®µé‡‡ç”¨äº†å®Œå…¨æº¢å‡ºçš„æ–¹å¼ï¼Œåœ¨æ•°æ®åº“é¡µä¸­å­˜æ”¾20ä¸ªå­—èŠ‚çš„æŒ‡é’ˆï¼Œå®é™…çš„æ•°æ®éƒ½å­˜å…¥åœ¨BLOB Pageä¸­ã€‚   </p><h4 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h4><p>äº‹åŠ¡(Transaction)æ˜¯å¹¶å‘æ§åˆ¶çš„åŸºæœ¬å•ä½ã€‚</p><p>æ‰€è°“äº‹åŠ¡,å®ƒæ˜¯ä¸€ä¸ªæ“ä½œåºåˆ—,è¿™äº›æ“ä½œè¦ä¹ˆéƒ½æ‰§è¡Œ,è¦ä¹ˆéƒ½ä¸æ‰§è¡Œ, å®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚ä¾‹å¦‚,é“¶è¡Œè½¬å¸å·¥ä½œ:ä»ä¸€ä¸ªå¸å·æ‰£æ¬¾å¹¶ ä½¿å¦ä¸€ä¸ªå¸å·å¢æ¬¾,è¿™ä¸¤ä¸ªæ“ä½œè¦ä¹ˆéƒ½æ‰§è¡Œ,è¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</p><p>æ•°æ®åº“äº‹åŠ¡å¿…é¡»å…·å¤‡ACIDç‰¹æ€§,ACIDæ˜¯Atomic(åŸå­æ€§)ã€ Consistency(ä¸€è‡´æ€§)ã€Isolation(éš”ç¦»æ€§)å’ŒDurability(æŒä¹…æ€§)çš„ è‹±æ–‡ç¼©å†™ã€‚</p><ul><li>åŸå­æ€§:</li></ul><p>æŒ‡æ•´ä¸ªæ•°æ®åº“äº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚åªæœ‰ä½¿æ®åº“ä¸­æ‰€ æœ‰çš„æ“ä½œæ‰§è¡ŒæˆåŠŸ,æ‰ç®—æ•´ä¸ªäº‹åŠ¡æˆåŠŸ;äº‹åŠ¡ä¸­ä»»ä½•ä¸€ä¸ªSQLè¯­å¥æ‰§è¡Œå¤± è´¥,é‚£ä¹ˆå·²ç»æ‰§è¡ŒæˆåŠŸçš„SQLè¯­å¥ä¹Ÿå¿…é¡»æ’¤é”€,æ•°æ®åº“çŠ¶æ€åº”è¯¥é€€å›åˆ°æ‰§ è¡Œäº‹åŠ¡å‰çš„çŠ¶æ€ã€‚</p><ul><li>ä¸€è‡´æ€§:</li></ul><p>æŒ‡æ•°æ®åº“äº‹åŠ¡ä¸èƒ½ç ´åå…³ç³»æ•°æ®çš„å®Œæ•´æ€§ä»¥åŠä¸šåŠ¡é€»è¾‘ä¸Šçš„ ä¸€è‡´æ€§ã€‚ä¾‹å¦‚å¯¹é“¶è¡Œè½¬å¸äº‹åŠ¡,ä¸ç®¡äº‹åŠ¡æˆåŠŸè¿˜æ˜¯å¤±è´¥,åº”è¯¥ä¿è¯äº‹åŠ¡ç»“ æŸåACCOUNTSè¡¨ä¸­Tomå’ŒJackçš„å­˜æ¬¾æ€»é¢ä¸º2000å…ƒã€‚</p><ul><li>éš”ç¦»æ€§:</li></ul><p>æŒ‡çš„æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­,å½“ä¸åŒçš„äº‹åŠ¡åŒæ—¶æ“çºµç›¸åŒçš„æ•°æ® æ—¶,æ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªçš„å®Œæ•´æ•°æ®ç©ºé—´ã€‚ç”±å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å¿…é¡»ä¸ä»» ä½•å…¶ä»–å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹éš”ç¦»ã€‚äº‹åŠ¡æŸ¥çœ‹æ•°æ®æ›´æ–°æ—¶,æ•°æ®æ‰€å¤„çš„çŠ¶æ€ è¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹å‰çš„çŠ¶æ€,è¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹åçš„çŠ¶æ€, äº‹åŠ¡ä¸ä¼šæŸ¥çœ‹åˆ°ä¸­é—´çŠ¶æ€çš„æ•°æ®ã€‚</p><ul><li>æŒä¹…æ€§:</li></ul><p>æŒ‡çš„æ˜¯åªè¦äº‹åŠ¡æˆåŠŸç»“æŸ,å®ƒå¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ–°å°±å¿…é¡»æ°¸ ä¹…ä¿å­˜ä¸‹æ¥ã€‚å³ä½¿å‘ç”Ÿç³»ç»Ÿå´©æºƒ,é‡æ–°å¯åŠ¨æ•°æ®åº“ç³»ç»Ÿå,æ•°æ®åº“è¿˜èƒ½æ¢ å¤åˆ°äº‹åŠ¡æˆåŠŸç»“æŸæ—¶çš„çŠ¶æ€ã€‚</p><p>äº‹åŠ¡çš„(ACID)ç‰¹æ€§æ˜¯ç”±å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆRDBMSï¼‰æ¥å®ç°çš„ã€‚æ•°æ®åº“ç®¡ç†ç³»ç»Ÿé‡‡ç”¨æ—¥å¿—æ¥ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€ä¸€è‡´æ€§å’Œ æŒä¹…æ€§ã€‚æ—¥å¿—è®°å½•äº†äº‹åŠ¡å¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ–°,å¦‚æœæŸä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ ä¸­å‘ç”Ÿé”™è¯¯,å°±å¯ä»¥æ ¹æ®æ—¥å¿—,æ’¤é”€äº‹åŠ¡å¯¹æ•°æ®åº“å·²åšçš„æ›´æ–°,ä½¿æ•°æ®åº“ é€€å›åˆ°æ‰§è¡Œäº‹åŠ¡å‰çš„åˆå§‹çŠ¶æ€ã€‚ æ•°æ®åº“ç®¡ç†ç³»ç»Ÿé‡‡ç”¨é”æœºåˆ¶æ¥å®ç°äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚å½“å¤šä¸ªäº‹åŠ¡åŒæ—¶æ›´ æ–°æ•°æ®åº“ä¸­ç›¸åŒçš„æ•°æ®æ—¶,åªå…è®¸æŒæœ‰é”çš„äº‹åŠ¡èƒ½æ›´æ–°è¯¥æ•°æ®,å…¶ä»–äº‹åŠ¡ å¿…é¡»ç­‰å¾…,ç›´åˆ°å‰ä¸€ä¸ªäº‹åŠ¡é‡Šæ”¾äº†é”,å…¶ä»–äº‹åŠ¡æ‰æœ‰æœºä¼šæ›´æ–°è¯¥æ•°æ®ã€‚</p><h4 id="å¹¶å‘æ§åˆ¶"><a href="#å¹¶å‘æ§åˆ¶" class="headerlink" title="å¹¶å‘æ§åˆ¶"></a>å¹¶å‘æ§åˆ¶</h4><h5 id="é”æœºåˆ¶"><a href="#é”æœºåˆ¶" class="headerlink" title="é”æœºåˆ¶"></a>é”æœºåˆ¶</h5><p>InnoDBå­˜å‚¨å¼•æ“é”çš„å®ç°å’ŒOracleéå¸¸ç±»ä¼¼ï¼Œæä¾›ä¸€è‡´æ€§çš„éé”å®šè¯»ã€è¡Œçº§é”æ”¯æŒã€è¡Œçº§é”æ²¡æœ‰ç›¸å…³çš„å¼€é”€ï¼Œå¯ä»¥åŒæ—¶å¾—åˆ°å¹¶å‘æ€§å’Œä¸€è‡´æ€§ã€‚</p><p>InnoDBå­˜å‚¨å¼•æ“å®ç°äº†å¦‚ä¸‹ä¸¤ç§æ ‡å‡†çš„è¡Œçº§é”ï¼š</p><ol><li>å…±äº«é”(S Lock)ï¼šå…è®¸äº‹åŠ¡è¯»ä¸€è¡Œæ•°æ®ï¼›</li><li>æ’ä»–é”(X Lock)ï¼šå…è®¸äº‹åŠ¡åˆ é™¤æˆ–è€…æ›´æ–°ä¸€è¡Œæ•°æ®ã€‚</li></ol><p>å½“ä¸€ä¸ªäº‹åŠ¡å·²ç»è·å¾—äº†è¡Œçš„å…±äº«é”ï¼Œé‚£ä¹ˆå¦å¤–çš„äº‹åŠ¡å¯ä»¥ç«‹å³è·å¾—è¡Œçš„å…±äº«é”ï¼Œå› ä¸ºè¯»å–æ²¡æœ‰æ”¹å˜è¡Œçš„æ•°æ®ï¼Œæˆ‘ä»¬ç§°è¿™ç§æƒ…å†µä¸ºé”å…¼å®¹ã€‚ä½†å¦‚æœæœ‰äº‹åŠ¡æƒ³è·å¾—è¡Œçš„æ’ä»–é”ï¼Œåˆ™å®ƒå¿…é¡»ç­‰å¾…äº‹åŠ¡é‡Šæ”¾è¡Œrä¸Šçš„å…±äº«é”â€”â€”â€”â€”è¿™ç§æƒ…å†µç§°ä¸ºé”ä¸å…¼å®¹ã€‚</p><p>åœ¨InnoDB Pluginä¹‹å‰ï¼Œåªèƒ½é€šè¿‡<code>SHOW FULL PROCESSLIST;</code>ï¼Œ<code>SHOW ENGINE INOODB STATUS;</code>ç­‰å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰çš„æ•°æ®åº“è¯·æ±‚ï¼Œç„¶åå†åˆ¤æ–­å½“å‰äº‹åŠ¡ä¸­çš„é”çš„æƒ…å†µã€‚æ–°ç‰ˆæœ¬çš„InnoDB Pluginä¸­ï¼Œåœ¨INFORMATION_SCHEMAæ¶æ„ä¸‹æ·»åŠ äº†<code>INNODB_TRXã€INNODB_LOCKSã€InnoDB_LOCK_WAITS</code>ã€‚é€šè¿‡è¿™ä¸‰å¼ è¡¨ï¼Œå¯ä»¥æ›´ç®€å•åœ°ç›‘æ§å½“å‰çš„äº‹åŠ¡å¹¶åˆ†æå¯èƒ½å­˜åœ¨çš„é”çš„é—®é¢˜ã€‚</p><p>INNODB_TRXç”±8ä¸ªå­—æ®µç»„æˆï¼š</p><blockquote><p>é€šè¿‡<code>select * from infomation_schema.INNODB_TRX;</code>å¯æŸ¥çœ‹</p></blockquote><ol><li>trx_id:InnoDBå­˜å‚¨å¼•æ“å†…éƒ¨å”¯ä¸€çš„äº‹åŠ¡ID</li><li>trx_state:å½“å‰äº‹åŠ¡çš„çŠ¶æ€ã€‚</li><li>trx_started:äº‹åŠ¡çš„å¼€å§‹æ—¶é—´ã€‚</li><li>trx_requested_lock_id:ç­‰å¾…äº‹åŠ¡çš„é”IDã€‚å¦‚trx_stateçš„çŠ¶æ€ä¸ºLOCK WAIT,é‚£ä¹ˆè¯¥å€¼ä»£è¡¨å½“å‰çš„ç­‰å¾…ä¹‹å‰äº‹åŠ¡å ç”¨é”èµ„æºçš„ID.</li><li>è‹¥trx_stateä¸æ˜¯LOCK WAIT,åˆ™è¯¥å€¼ä¸ºNULLã€‚</li><li>trx_wait_started:äº‹åŠ¡ç­‰å¾…å¼€å§‹çš„æ—¶é—´ã€‚</li><li>trx_weight:äº‹åŠ¡çš„æƒé‡ï¼Œåæ˜ äº†ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹å’Œé”ä½çš„è¡Œæ•°ã€‚åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œå½“å‘ç”Ÿæ­»é”éœ€è¦å›æ»šæ—¶ï¼ŒInnoDBå­˜å‚¨ä¼šé€‰<br>æ‹©è¯¥å€¼æœ€å°çš„è¿›è¡Œå›æ»šã€‚</li><li>trx_mysql_thread_id:Mysqlä¸­çš„çº¿ç¨‹ID,<code>SHOW PROCESSLIST;</code>æ˜¾ç¤ºçš„ç»“æœã€‚</li><li>trx_query:äº‹åŠ¡è¿è¡Œçš„sqlè¯­å¥ã€‚</li></ol><p>INNODB_LOCKSè¡¨ï¼Œè¯¥è¡¨ç”±å¦‚ä¸‹å­—æ®µç»„æˆï¼š</p><blockquote><p>é€šè¿‡<code>select * from information_schema.INNODB_LOCK;</code>å¯æŸ¥çœ‹</p></blockquote><ol><li>lock_id:é”çš„IDã€‚</li><li>lock_trx_id:äº‹åŠ¡IDã€‚</li><li>lock_mode:é”çš„æ¨¡å¼ã€‚</li><li>lock_type:é”çš„ç±»å‹ï¼Œè¡¨é”è¿˜æ˜¯è¡Œé”ã€‚</li><li>lock_table:è¦åŠ é”çš„è¡¨ã€‚</li><li>lock_index:é”çš„ç´¢å¼•ã€‚</li><li>lock_space:InnoDBå­˜å‚¨å¼•æ“è¡¨ç©ºé—´çš„IDå·ã€‚</li><li>lock_page:è¢«é”ä½çš„é¡µçš„æ•°é‡ã€‚è‹¥æ˜¯è¡¨é”ï¼Œåˆ™è¯¥å€¼ä¸ºNULLã€‚</li><li>lock_rec:è¢«é”ä½çš„è¡Œçš„æ•°é‡ã€‚è‹¥æ˜¯è¡¨é”ï¼Œåˆ™è¯¥å€¼ä¸ºNULLã€‚</li><li>lock_data:è¢«é”ä½çš„è¡Œçš„ä¸»é”®å€¼ã€‚å½“æ˜¯è¡¨é”æ—¶ï¼Œè¯¥å€¼ä¸ºNULLã€‚</li></ol><p>INNODB_LOCK_WAITç”±4ä¸ªå­—æ®µç»„æˆï¼š</p><blockquote><p>é€šè¿‡<code>select * from information_schema.INNODB_LOCK_WAITS;</code>å¯æŸ¥çœ‹ã€‚</p></blockquote><ol><li>requesting_trx_id:ç”³è¯·é”èµ„æºçš„äº‹åŠ¡IDã€‚</li><li>requesting_lock_id:ç”³è¯·çš„é”çš„IDã€‚</li><li>blocking_trx_id:é˜»å¡çš„é”çš„IDã€‚</li></ol><h5 id="å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC"><a href="#å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC" class="headerlink" title="å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ MVCC"></a>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ MVCC</h5><p>InnoDBå­˜å‚¨å¼•æ“é€šè¿‡è¡Œ<code>å¤šç‰ˆæœ¬æ§åˆ¶ MVCC</code>çš„æ–¹å¼æ¥è¯»å–å½“å‰æ‰§è¡Œæ—¶é—´æ•°æ®åº“ä¸­è¡Œçš„æ•°æ®ã€‚å¦‚æœè¯»å–çš„è¡Œæ­£åœ¨æ‰§è¡ŒDeleteã€updateæ“ä½œï¼Œè¿™æ—¶è¯»å–æ“ä½œä¸ä¼šå› æ­¤è€Œä¼šç­‰å¾…è¡Œä¸Šé”çš„é‡Šæ”¾ï¼Œç›¸åï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¼šå»è¯»å–è¡Œçš„ä¸€ä¸ªå¿«ç…§æ•°æ®ã€‚å¿«ç…§æ•°æ®æ˜¯æŒ‡è¯¥è¡Œä¹‹å‰ç‰ˆæœ¬çš„æ•°æ®ï¼Œè¯¥å®ç°æ˜¯é€šè¿‡Undoæ®µæ¥å®ç°ã€‚è€ŒUndoç”¨æ¥äº‹åŠ¡ä¸­å›æ»šæ•°æ®ï¼Œå› æ­¤å¿«ç…§æœ¬èº«æ˜¯æ²¡æœ‰é¢å¤–å¼€é”€çš„ã€‚æ­¤å¤–ï¼Œå¿«ç…§æ•°æ®æ˜¯ä¸éœ€è¦ä¸Šé”çš„ï¼Œå› ä¸ºæ²¡æœ‰å¿…è¦å¯¹å†å²çš„æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚ä¸€ä¸ªè¡Œå¯èƒ½æœ‰ä¸æ­¢ä¸€ä¸ªå¿«ç…§æ•°æ®ï¼Œæ‰€ä»¥ç§°è¿™ç§æŠ€æœ¯ä¸ºè¡Œå¤šç‰ˆæœ¬æŠ€æœ¯ã€‚ç”±æ­¤å¸¦æ¥å¹¶å‘æ§åˆ¶ï¼Œç§°ä¹‹ä¸ºå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(Multi VersionConcurrency Control, MVCC)ã€‚</p><h5 id="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡çš„éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</h5><p>Read uncommittedã€Read committedã€Repeatable readã€serializableã€‚</p><p>åœ¨Read Committedå’ŒRepeatable Readä¸‹ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨éé”å®šä¸€è‡´æ€§è¯»ã€‚ç„¶è€Œï¼Œå¯¹äºå¿«ç…§çš„å®šä¹‰å´ä¸åŒã€‚åœ¨Read Committedäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯¹äºå¿«ç…§æ•°æ®ï¼Œéä¸€è‡´æ€§è¯»æ€»æ˜¯è¯»å–è¢«é”å®šè¡Œçš„æœ€æ–°ä¸€ä»½å¿«ç…§æ•°æ®ã€‚åœ¨Repeatableäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯¹äºå¿«ç…§æ•°æ®ï¼Œéä¸€è‡´æ€§è¯»æ€»æ˜¯è¯»å–äº‹åŠ¡å¼€å§‹æ—¶çš„è¡Œæ•°æ®ç‰ˆæœ¬ã€‚   </p><h3 id="INNODBé”"><a href="#INNODBé”" class="headerlink" title="INNODBé”"></a>INNODBé”</h3><p><img src="pic/lock01.png" alt="lock01"></p><h4 id="è®¾ç½®INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#è®¾ç½®INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="è®¾ç½®INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«"></a>è®¾ç½®INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«</h4><h5 id="å®è·µ1ï¼šæŸ¥çœ‹innodbé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#å®è·µ1ï¼šæŸ¥çœ‹innodbé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="å®è·µ1ï¼šæŸ¥çœ‹innodbé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>å®è·µ1ï¼šæŸ¥çœ‹innodbé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</h5><p>çŸ¥è¯†ç‚¹ï¼š</p><ol><li>å¯ä»¥æŸ¥çœ‹å±€éƒ¨å˜é‡<code>@@tx_isolation</code>å’Œå…¨å±€å˜é‡<code>@@global.tx_isolation</code></li><li>å±€éƒ¨å˜é‡åœ¨ä¼šè¯ä¸­ç”Ÿæ•ˆï¼Œè€Œå…¨å±€å˜é‡æ˜¯åœ¨æ‰€æœ‰ä¼šè¯ä¸­ç”Ÿæ•ˆï¼Œå±€éƒ¨è¦†ç›–å…¨å±€ã€‚</li></ol><blockquote><p>æŸ¥çœ‹å½“å‰ä¼šè¯ä¸­çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> MariaDB [(none)]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å…¨å±€çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select @@global.tx_isolation;</span><br><span class="line">+-----------------------+</span><br><span class="line">| @@global.tx_isolation |</span><br><span class="line">+-----------------------+</span><br><span class="line">| REPEATABLE-READ       |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show variables like "tx_isolation";</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">| Variable_name | Value           |</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">| tx_isolation  | REPEATABLE-READ |</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from information_schema.global_variables where variable_name like "%isolation%";</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">| VARIABLE_NAME | VARIABLE_VALUE  |</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">| TX_ISOLATION  | REPEATABLE-READ |</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">1 row in set (0.03 sec)</span><br></pre></td></tr></table></figure><h5 id="å®è·µ2ï¼šæ”¹å˜å•ä¸ªä¼šè¯çš„éš”ç¦»çº§åˆ«"><a href="#å®è·µ2ï¼šæ”¹å˜å•ä¸ªä¼šè¯çš„éš”ç¦»çº§åˆ«" class="headerlink" title="å®è·µ2ï¼šæ”¹å˜å•ä¸ªä¼šè¯çš„éš”ç¦»çº§åˆ«"></a>å®è·µ2ï¼šæ”¹å˜å•ä¸ªä¼šè¯çš„éš”ç¦»çº§åˆ«</h5><p>çŸ¥è¯†ç‚¹ï¼š</p><p>1.ç”¨æˆ·å¯ä»¥ç”¨SET TRANSACTIONè¯­å¥æ”¹å˜å•ä¸ªä¼šè¯çš„éš”ç¦»çº§åˆ«ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET SESSION  TRANSACTION ISOLATION LEVEL</span><br><span class="line">                       &#123;READ UNCOMMITTED | READ COMMITTED</span><br><span class="line">                        | REPEATABLE READ | SERIALIZABLE&#125;</span><br></pre></td></tr></table></figure><p>2.ä¼šè¯ç»“æŸé‡æ–°å¼€å¯æ–°çš„ä¼šè¯ï¼Œåˆ™ä½¿ç”¨å…¨å±€å˜é‡çš„å€¼</p><p>session1è®¾ç½®RR</p><p>ç”±äºé»˜è®¤çš„éš”ç¦»çº§åˆ«å°±æ˜¯RRï¼Œå› æ­¤ä¸ç”¨è®¾ç½®ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>session2è®¾ç½®RC</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [information_schema]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [information_schema]&gt; set session transaction isolation level read committed;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [information_schema]&gt; select @@tx_isolation;</span><br><span class="line">+----------------+</span><br><span class="line">| @@tx_isolation |</span><br><span class="line">+----------------+</span><br><span class="line">| READ-COMMITTED |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>session2ç»“æŸä¼šè¯ï¼Œå¼€å¯æ–°çš„session3</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [information_schema]&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@localhost ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 6</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h5 id="å®è·µ3ï¼šæ”¹å˜å•ä¸ªå®ä¾‹çš„éš”ç¦»çº§åˆ«"><a href="#å®è·µ3ï¼šæ”¹å˜å•ä¸ªå®ä¾‹çš„éš”ç¦»çº§åˆ«" class="headerlink" title="å®è·µ3ï¼šæ”¹å˜å•ä¸ªå®ä¾‹çš„éš”ç¦»çº§åˆ«"></a>å®è·µ3ï¼šæ”¹å˜å•ä¸ªå®ä¾‹çš„éš”ç¦»çº§åˆ«</h5><p>çŸ¥è¯†ç‚¹ï¼š</p><p>1.ç”¨æˆ·å¯ä»¥ç”¨SET TRANSACTIONè¯­å¥æ”¹å˜å•ä¸ªå®ä¾‹çš„éš”ç¦»çº§åˆ«ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL  TRANSACTION ISOLATION LEVEL</span><br><span class="line">                       &#123;READ UNCOMMITTED | READ COMMITTED</span><br><span class="line">                        | REPEATABLE READ | SERIALIZABLE&#125;</span><br></pre></td></tr></table></figure><p>2.å®ä¾‹ç»“æŸé‡æ–°å¼€å¯æ–°çš„å®ä¾‹ï¼Œåˆ™ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°å€¼ï¼Œæˆ–ç¨‹åºç¼–è¯‘æ—¶çš„å‚æ•°å€¼ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; set global transaction isolation level read committed;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select @@global.tx_isolation;</span><br><span class="line">+-----------------------+</span><br><span class="line">| @@global.tx_isolation |</span><br><span class="line">+-----------------------+</span><br><span class="line">| READ-COMMITTED        |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec).</span><br></pre></td></tr></table></figure><p>å½“å‰ä¼šè¯ä¸­ï¼Œå±€éƒ¨å˜é‡çš„å€¼ä¸ºRRï¼Œå…¨å±€å˜é‡çš„å€¼ä¸ºRCï¼Œè€Œå±€éƒ¨ä¼šè¦†ç›–å…¨å±€ï¼Œæ‰€ä»¥å½“å‰ä¼šè¯ä¸­çš„éš”ç¦»çº§åˆ«è¿˜æ˜¯RRï¼Œæˆ‘ä»¬éœ€è¦é€€å‡ºå½“å‰ä¼šè¯ï¼Œå¼€å¯æ–°çš„ä¼šè¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 8</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select @@tx_isolation;</span><br><span class="line">+----------------+</span><br><span class="line">| @@tx_isolation |</span><br><span class="line">+----------------+</span><br><span class="line">| READ-COMMITTED |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select @@global.tx_isolation;</span><br><span class="line">+-----------------------+</span><br><span class="line">| @@global.tx_isolation |</span><br><span class="line">+-----------------------+</span><br><span class="line">| READ-COMMITTED        |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>åœ¨ä¼šè¯ä¸­é€šè¿‡ä¿®æ”¹å…¨å±€å˜é‡çš„æ–¹å¼ï¼Œåªèƒ½è®©å½“å‰çš„å®ä¾‹ç”Ÿæ•ˆï¼Œå¦‚æœæœåŠ¡é‡å¯äº†ï¼Œåˆ™å¤±æ•ˆã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl restart mariadb</span><br><span class="line">[root@localhost ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select @@global.tx_isolation;</span><br><span class="line">+-----------------------+</span><br><span class="line">| @@global.tx_isolation |</span><br><span class="line">+-----------------------+</span><br><span class="line">| REPEATABLE-READ       |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h5 id="å®è·µ4ï¼šæ”¹å˜æ‰€æœ‰å®ä¾‹çš„éš”ç¦»çº§åˆ«"><a href="#å®è·µ4ï¼šæ”¹å˜æ‰€æœ‰å®ä¾‹çš„éš”ç¦»çº§åˆ«" class="headerlink" title="å®è·µ4ï¼šæ”¹å˜æ‰€æœ‰å®ä¾‹çš„éš”ç¦»çº§åˆ«"></a>å®è·µ4ï¼šæ”¹å˜æ‰€æœ‰å®ä¾‹çš„éš”ç¦»çº§åˆ«</h5><p>çŸ¥è¯†ç‚¹ï¼š</p><p>1.ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä¸ºæ‰€æœ‰å®ä¾‹å’Œè¿æ¥è®¾ç½®é»˜è®¤éš”ç¦»çº§åˆ«ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">transaction-isolation = &#123;READ-UNCOMMITTED | READ-COMMITTED</span><br><span class="line">                         | REPEATABLE-READ | SERIALIZABLE&#125;</span><br></pre></td></tr></table></figure><p>2.innodbé»˜è®¤çš„éš”ç¦»çº§åˆ«ä¸º REPEATABLE-READ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/my.cnf</span><br><span class="line">transaction-isolation=read-committed</span><br><span class="line">[root@localhost ~]# systemctl restart mariadb</span><br><span class="line">[root@localhost ~]# mysql -e "select @@tx_isolation"</span><br><span class="line">+----------------+</span><br><span class="line">| @@tx_isolation |</span><br><span class="line">+----------------+</span><br><span class="line">| READ-COMMITTED |</span><br><span class="line">+----------------+</span><br><span class="line">[root@localhost ~]# mysql -e "select @@global.tx_isolation"</span><br><span class="line">+-----------------------+</span><br><span class="line">| @@global.tx_isolation |</span><br><span class="line">+-----------------------+</span><br><span class="line">| READ-COMMITTED        |</span><br><span class="line">+-----------------------+</span><br></pre></td></tr></table></figure><hr><h4 id="åŒºåˆ†INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#åŒºåˆ†INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="åŒºåˆ†INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«"></a>åŒºåˆ†INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«</h4><p><img src="pic/lock02.png" alt="lock02"></p><h5 id="InnoDB-ä¸­çš„éš”ç¦»çº§è¯¦ç»†æè¿°"><a href="#InnoDB-ä¸­çš„éš”ç¦»çº§è¯¦ç»†æè¿°" class="headerlink" title="InnoDB ä¸­çš„éš”ç¦»çº§è¯¦ç»†æè¿°"></a>InnoDB ä¸­çš„éš”ç¦»çº§è¯¦ç»†æè¿°</h5><ul><li><code>READ UNCOMMITTED</code> è¿™é€šå¸¸ç§°ä¸º â€˜dirty readâ€™ï¼šnon-locking SELECTs çš„æ‰§è¡Œä½¿æˆ‘ä»¬ä¸ä¼šçœ‹åˆ°ä¸€ä¸ªè®°å½•çš„å¯èƒ½æ›´æ—©çš„ç‰ˆæœ¬ï¼›å› è€Œåœ¨è¿™ä¸ªéš”ç¦»åº¦ä¸‹æ˜¯é â€˜consistentâ€™ readsï¼›å¦å¤–ï¼Œè¿™çº§éš”ç¦»çš„è¿ä½œå¦‚åŒ READ COMMITTEDã€‚</li><li><code>READ COMMITTED</code> æœ‰äº›ç±»ä¼¼ Oracle çš„éš”ç¦»çº§ã€‚æ‰€æœ‰ SELECT â€¦ FOR UPDATE å’Œ SELECT â€¦ LOCK IN SHARE MODE è¯­å¥åªé”å®šç´¢å¼•è®°å½•ï¼Œè€Œä¸é”å®šä¹‹å‰çš„é—´éš™ï¼Œå› è€Œå…è®¸åœ¨é”å®šçš„è®°å½•åè‡ªç”±åœ°æ’å…¥æ–°è®°å½•ã€‚ä»¥ä¸€ä¸ªå”¯ä¸€åœ°æœç´¢æ¡ä»¶ä½¿ç”¨ä¸€ä¸ªå”¯ä¸€ç´¢å¼•(unique index)çš„ UPDATE å’Œ DELETEï¼Œä»…ä»…åªé”å®šæ‰€æ‰¾åˆ°çš„ç´¢å¼•è®°å½•ï¼Œè€Œä¸é”å®šè¯¥ç´¢å¼•ä¹‹å‰çš„é—´éš™ã€‚ä½†æ˜¯åœ¨èŒƒå›´å‹çš„ UPDATE and DELETEä¸­ï¼ŒInnoDB å¿…é¡»è®¾ç½® next-key æˆ– gap locks æ¥é˜»å¡å…¶å®ƒç”¨æˆ·å¯¹èŒƒå›´å†…çš„ç©ºéš™æ’å…¥ã€‚ è‡ªä»ä¸ºäº† MySQL è¿›è¡Œå¤åˆ¶(replication)ä¸æ¢å¤(recovery)å·¥ä½œâ€™phantom rowsâ€™å¿…é¡»è¢«é˜»å¡ä»¥æ¥ï¼Œè¿™å°±æ˜¯å¿…é¡»çš„äº†ã€‚Consistent reads è¿ä½œæ–¹å¼ä¸ Oracle æœ‰ç‚¹ç±»ä¼¼ï¼š æ¯ä¸€ä¸ª consistent readï¼Œç”šè‡³æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„ï¼Œå‡è®¾ç½®å¹¶ä½œç”¨å®ƒè‡ªå·±çš„æœ€æ–°å¿«ç…§ã€‚</li><li><code>REPEATABLE READ</code> è¿™æ˜¯ InnoDB é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§ã€‚. SELECT â€¦ FOR UPDATE, SELECT â€¦ LOCK IN SHARE MODE, UPDATE, å’Œ DELETE ï¼Œè¿™äº›ä»¥å”¯ä¸€æ¡ä»¶æœç´¢å”¯ä¸€ç´¢å¼•çš„ï¼Œåªé”å®šæ‰€æ‰¾åˆ°çš„ç´¢å¼•è®°å½•ï¼Œè€Œä¸é”å®šè¯¥ç´¢å¼•ä¹‹å‰çš„é—´éš™ã€‚ å¦åˆ™è¿™äº›æ“ä½œå°†ä½¿ç”¨ next-key é”å®šï¼Œä»¥ next-key å’Œ gap locks é”å®šæ‰¾åˆ°çš„ç´¢å¼•èŒƒå›´ï¼Œå¹¶é˜»å¡å…¶å®ƒç”¨æˆ·çš„æ–°å»ºæ’å…¥ã€‚åœ¨ consistent reads ä¸­ï¼Œä¸å‰ä¸€ä¸ªéš”ç¦»çº§ç›¸æ¯”è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„å·®åˆ«ï¼š åœ¨è¿™ä¸€çº§ä¸­ï¼ŒåŒä¸€äº‹åŠ¡ä¸­æ‰€æœ‰çš„ consistent reads å‡è¯»å–ç¬¬ä¸€æ¬¡è¯»å–æ—¶å·²ç¡®å®šçš„å¿«ç…§ã€‚è¿™ä¸ªçº¦å®šå°±æ„å‘³ç€å¦‚æœåœ¨åŒä¸€äº‹åŠ¡ä¸­å‘å‡ºå‡ ä¸ªæ— æ ¼å¼(plain)çš„SELECTs ï¼Œè¿™äº› SELECTs çš„ç›¸äº’å…³ç³»æ˜¯ä¸€è‡´çš„ã€‚</li><li><code>SERIALIZABLE</code> è¿™ä¸€çº§ä¸ä¸Šä¸€çº§ç›¸ä¼¼ï¼Œåªæ˜¯æ— æ ¼å¼(plain)çš„ SELECTs è¢«éšå«åœ°è½¬æ¢ä¸º SELECT â€¦ LOCK IN SHARE MODEã€‚</li></ul><h5 id="å®è·µ1ï¼šSERIALIZABLEéš”ç¦»çº§åˆ«æŸ¥è¯¢è‡ªåŠ¨åŠ å…±äº«é”"><a href="#å®è·µ1ï¼šSERIALIZABLEéš”ç¦»çº§åˆ«æŸ¥è¯¢è‡ªåŠ¨åŠ å…±äº«é”" class="headerlink" title="å®è·µ1ï¼šSERIALIZABLEéš”ç¦»çº§åˆ«æŸ¥è¯¢è‡ªåŠ¨åŠ å…±äº«é”"></a>å®è·µ1ï¼šSERIALIZABLEéš”ç¦»çº§åˆ«æŸ¥è¯¢è‡ªåŠ¨åŠ å…±äº«é”</h5><ul><li>å¼€å¯å››ä¸ªä¼šè¯session1-4ï¼Œåˆ†åˆ«è®¾ç½®ä¸åŒçš„éš”ç¦»çº§åˆ«</li></ul><p><img src="pic/lock03.png" alt="lock03"></p><ul><li>å†å¼€å¯ä¸€ä¸ªä¼šè¯session5é»˜è®¤ä½¿ç”¨RRéš”ç¦»çº§åˆ«</li></ul><p><img src="pic/lock04.png" alt="lock04"></p><ul><li>session1-5éƒ½å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼ŒæŸ¥çœ‹teståº“ä¸­t1è¡¨ä¸­id=100çš„è¡Œ</li></ul><p><img src="pic/lock05.png" alt="lock05"></p><ul><li>session5ä¸­å°†id=100çš„è¡Œæ”¹ä¸º200ï¼Œå‘ç°å‡ºç°æ­»é”ï¼Œè¿™æ˜¯å› ä¸ºsession4ä¸ºSERIALIZABLEï¼ŒæŸ¥çœ‹id=100çš„è¡Œä¼šè¢«åŠ ä¸Šä¸€ä¸ªå…±äº«é”Sï¼Œè€Œå…¶ä»–ä¸‰ç§æ¨¡å¼éƒ½æ˜¯ä¸åŠ é”çš„ï¼Œä½¿ç”¨ä¸€è‡´æ€§éé”å®šè¯»ã€‚</li></ul><p><img src="pic/lock06.png" alt="lock06"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select * from information_schema.innodb_locks\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">    lock_id: 909:0:308:2</span><br><span class="line">lock_trx_id: 909</span><br><span class="line">  lock_mode: X</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `test`.`t1`</span><br><span class="line"> lock_index: `PRIMARY`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 308</span><br><span class="line">   lock_rec: 2</span><br><span class="line">  lock_data: 100</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">    lock_id: 90A:0:308:2</span><br><span class="line">lock_trx_id: 90A</span><br><span class="line">  lock_mode: S</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `test`.`t1`</span><br><span class="line"> lock_index: `PRIMARY`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 308</span><br><span class="line">   lock_rec: 2</span><br><span class="line">  lock_data: 100</span><br><span class="line">2 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from information_schema.innodb_lock_waits\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">requesting_trx_id: 909</span><br><span class="line">requested_lock_id: 909:0:308:2</span><br><span class="line">  blocking_trx_id: 90A</span><br><span class="line"> blocking_lock_id: 90A:0:308:2</span><br><span class="line">1 row in set (0.04 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from information_schema.innodb_trx\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                    trx_id: 90A</span><br><span class="line">                 trx_state: RUNNING</span><br><span class="line">               trx_started: 2016-12-15 17:08:01</span><br><span class="line">     trx_requested_lock_id: NULL</span><br><span class="line">          trx_wait_started: NULL</span><br><span class="line">                trx_weight: 2</span><br><span class="line">       trx_mysql_thread_id: 5</span><br><span class="line">                 trx_query: NULL</span><br><span class="line">       trx_operation_state: NULL</span><br><span class="line">         trx_tables_in_use: 0</span><br><span class="line">         trx_tables_locked: 0</span><br><span class="line">          trx_lock_structs: 2</span><br><span class="line">     trx_lock_memory_bytes: 376</span><br><span class="line">           trx_rows_locked: 1</span><br><span class="line">         trx_rows_modified: 0</span><br><span class="line">   trx_concurrency_tickets: 0</span><br><span class="line">       trx_isolation_level: SERIALIZABLE</span><br><span class="line">         trx_unique_checks: 1</span><br><span class="line">    trx_foreign_key_checks: 1</span><br><span class="line">trx_last_foreign_key_error: NULL</span><br><span class="line"> trx_adaptive_hash_latched: 0</span><br><span class="line"> trx_adaptive_hash_timeout: 10000</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">                    trx_id: 909</span><br><span class="line">                 trx_state: LOCK WAIT</span><br><span class="line">               trx_started: 2016-12-15 17:02:04</span><br><span class="line">     trx_requested_lock_id: 909:0:308:2</span><br><span class="line">          trx_wait_started: 2016-12-15 17:10:18</span><br><span class="line">                trx_weight: 2</span><br><span class="line">       trx_mysql_thread_id: 4</span><br><span class="line">                 trx_query: update test.t1 set id=200 where id=100</span><br><span class="line">       trx_operation_state: starting index read</span><br><span class="line">         trx_tables_in_use: 1</span><br><span class="line">         trx_tables_locked: 1</span><br><span class="line">          trx_lock_structs: 2</span><br><span class="line">     trx_lock_memory_bytes: 1248</span><br><span class="line">           trx_rows_locked: 1</span><br><span class="line">         trx_rows_modified: 0</span><br><span class="line">   trx_concurrency_tickets: 0</span><br><span class="line">       trx_isolation_level: REPEATABLE READ</span><br><span class="line">         trx_unique_checks: 1</span><br><span class="line">    trx_foreign_key_checks: 1</span><br><span class="line">trx_last_foreign_key_error: NULL</span><br><span class="line"> trx_adaptive_hash_latched: 0</span><br><span class="line"> trx_adaptive_hash_timeout: 10000</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">                    trx_id: 908</span><br><span class="line">                 trx_state: RUNNING</span><br><span class="line">               trx_started: 2016-12-15 17:02:02</span><br><span class="line">     trx_requested_lock_id: NULL</span><br><span class="line">          trx_wait_started: NULL</span><br><span class="line">                trx_weight: 0</span><br><span class="line">       trx_mysql_thread_id: 3</span><br><span class="line">                 trx_query: NULL</span><br><span class="line">       trx_operation_state: NULL</span><br><span class="line">         trx_tables_in_use: 0</span><br><span class="line">         trx_tables_locked: 0</span><br><span class="line">          trx_lock_structs: 0</span><br><span class="line">     trx_lock_memory_bytes: 376</span><br><span class="line">           trx_rows_locked: 0</span><br><span class="line">         trx_rows_modified: 0</span><br><span class="line">   trx_concurrency_tickets: 0</span><br><span class="line">       trx_isolation_level: READ COMMITTED</span><br><span class="line">         trx_unique_checks: 1</span><br><span class="line">    trx_foreign_key_checks: 1</span><br><span class="line">trx_last_foreign_key_error: NULL</span><br><span class="line"> trx_adaptive_hash_latched: 0</span><br><span class="line"> trx_adaptive_hash_timeout: 10000</span><br><span class="line">*************************** 4. row ***************************</span><br><span class="line">                    trx_id: 906</span><br><span class="line">                 trx_state: RUNNING</span><br><span class="line">               trx_started: 2016-12-15 17:01:57</span><br><span class="line">     trx_requested_lock_id: NULL</span><br><span class="line">          trx_wait_started: NULL</span><br><span class="line">                trx_weight: 0</span><br><span class="line">       trx_mysql_thread_id: 6</span><br><span class="line">                 trx_query: NULL</span><br><span class="line">       trx_operation_state: NULL</span><br><span class="line">         trx_tables_in_use: 0</span><br><span class="line">         trx_tables_locked: 0</span><br><span class="line">          trx_lock_structs: 0</span><br><span class="line">     trx_lock_memory_bytes: 376</span><br><span class="line">           trx_rows_locked: 0</span><br><span class="line">         trx_rows_modified: 0</span><br><span class="line">   trx_concurrency_tickets: 0</span><br><span class="line">       trx_isolation_level: REPEATABLE READ</span><br><span class="line">         trx_unique_checks: 1</span><br><span class="line">    trx_foreign_key_checks: 1</span><br><span class="line">trx_last_foreign_key_error: NULL</span><br><span class="line"> trx_adaptive_hash_latched: 0</span><br><span class="line"> trx_adaptive_hash_timeout: 10000</span><br><span class="line">*************************** 5. row ***************************</span><br><span class="line">                    trx_id: 905</span><br><span class="line">                 trx_state: RUNNING</span><br><span class="line">               trx_started: 2016-12-15 17:01:39</span><br><span class="line">     trx_requested_lock_id: NULL</span><br><span class="line">          trx_wait_started: NULL</span><br><span class="line">                trx_weight: 0</span><br><span class="line">       trx_mysql_thread_id: 2</span><br><span class="line">                 trx_query: select * from information_schema.innodb_trx</span><br><span class="line">       trx_operation_state: NULL</span><br><span class="line">         trx_tables_in_use: 0</span><br><span class="line">         trx_tables_locked: 0</span><br><span class="line">          trx_lock_structs: 0</span><br><span class="line">     trx_lock_memory_bytes: 376</span><br><span class="line">           trx_rows_locked: 0</span><br><span class="line">         trx_rows_modified: 0</span><br><span class="line">   trx_concurrency_tickets: 0</span><br><span class="line">       trx_isolation_level: READ UNCOMMITTED</span><br><span class="line">         trx_unique_checks: 1</span><br><span class="line">    trx_foreign_key_checks: 1</span><br><span class="line">trx_last_foreign_key_error: NULL</span><br><span class="line"> trx_adaptive_hash_latched: 0</span><br><span class="line"> trx_adaptive_hash_timeout: 10000</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br></pre></td></tr></table></figure><ul><li>session4ä¸­æäº¤äº‹åŠ¡ï¼Œåˆ™id=100çš„è¡Œé”è¢«è§£é™¤ï¼Œæˆ‘ä»¬å…³é—­session4ï¼Œä¸‹å›¾ä¸ºæœ€æ–°çš„æƒ…å†µ</li></ul><p><img src="pic/lock07.png" alt="lock07"></p><h5 id="å®è·µ2ï¼šRUã€RCã€RRéš”ç¦»çº§åˆ«çš„å¯¹æ¯”"><a href="#å®è·µ2ï¼šRUã€RCã€RRéš”ç¦»çº§åˆ«çš„å¯¹æ¯”" class="headerlink" title="å®è·µ2ï¼šRUã€RCã€RRéš”ç¦»çº§åˆ«çš„å¯¹æ¯”"></a>å®è·µ2ï¼šRUã€RCã€RRéš”ç¦»çº§åˆ«çš„å¯¹æ¯”</h5><ul><li>session5ï¼Œä¿®æ”¹id=100çš„è¡Œï¼Œæ”¹ä¸º200ï¼Œä¸æäº¤äº‹åŠ¡ï¼Œsession1-,3åˆ†åˆ«æŸ¥çœ‹id=100çš„å€¼ï¼Œè§‚å¯Ÿæƒ…å†µ</li></ul><p><img src="pic/lock08.png" alt="lock08"></p><ul><li>RUçº§åˆ«çš„ä¼šè¯ä¸­çš„äº‹åŠ¡åœ¨session5ä¸­äº‹åŠ¡æœªæäº¤çš„æƒ…å†µä¸‹ï¼Œå°±èƒ½å¤ŸæŸ¥çœ‹åˆ°æœ€æ–°çš„è¡Œè®°å½•äº†</li></ul><p><img src="pic/lock09.png" alt="lock09"></p><ul><li>RCçº§åˆ«çš„ä¼šè¯ä¸­çš„äº‹åŠ¡åœ¨session5ä¼šè¯çš„äº‹åŠ¡æäº¤åå°±èƒ½å¤ŸæŸ¥çœ‹åˆ°æœ€æ–°çš„è¡Œè®°å½•äº† </li></ul><p><img src="pic/lock10.png" alt="lock10"></p><p>*ã€€RRçº§åˆ«çš„ä¼šè¯ä¸­å¿…é¡»åœ¨session5çš„äº‹åŠ¡æäº¤åå¹¶ä¸”è‡ªå·±çš„äº‹åŠ¡ä¹Ÿæäº¤åæ‰èƒ½æŸ¥åˆ°æœ€æ–°çš„è¡Œè®°å½•</p><h4 id="å®ç°ä¸€è‡´æ€§é”å®šè¯»"><a href="#å®ç°ä¸€è‡´æ€§é”å®šè¯»" class="headerlink" title="å®ç°ä¸€è‡´æ€§é”å®šè¯»"></a>å®ç°ä¸€è‡´æ€§é”å®šè¯»</h4><p>InnoDBé»˜è®¤æ˜¯å¯é‡å¤è¯»çš„ï¼ˆREPEATABLE READï¼‰ï¼ŒMVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œå®ç°ä¸€è‡´æ€§åœ°éé”å®šè¯»æ“ä½œã€‚</p><p>InnoDBå­˜å‚¨å¼•æ“çš„selectæ“ä½œä½¿ç”¨ä¸€è‡´æ€§éé”å®šè¯»ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œselectæ“ä½œä¸ä¼šå»è¯·æ±‚å…±äº«é”Sï¼›</p><p>å¦‚ä½•æ˜¾ç¤ºåœ°ä½¿ç”¨ä¸€è‡´æ€§é”å®šè¯»å‘¢ï¼Ÿ</p><ul><li>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæ˜¾å¼åœ°åŠ å…±äº«é”Sï¼šselect * from t1 where id=1 lock on share mode;</li><li>ç¬¬äºŒç§æ–¹æ³•ï¼Œæ˜¾å¼åœ°åŠ æ’ä»–é”Xï¼šselect * from t1 where id=1 for update;</li></ul><h5 id="å®è·µ1ï¼šè®¾ç½®innodbç”³è¯·é”ç­‰å¾…è¶…æ—¶æ—¶é—´"><a href="#å®è·µ1ï¼šè®¾ç½®innodbç”³è¯·é”ç­‰å¾…è¶…æ—¶æ—¶é—´" class="headerlink" title="å®è·µ1ï¼šè®¾ç½®innodbç”³è¯·é”ç­‰å¾…è¶…æ—¶æ—¶é—´"></a>å®è·µ1ï¼šè®¾ç½®innodbç”³è¯·é”ç­‰å¾…è¶…æ—¶æ—¶é—´</h5><p><img src="pic/lock13.png" alt="lock13"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; set @@innodb_lock_wait_timeout=3;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure><h5 id="å®è·µ2ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ å…±äº«é”æµ‹è¯•"><a href="#å®è·µ2ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ å…±äº«é”æµ‹è¯•" class="headerlink" title="å®è·µ2ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ å…±äº«é”æµ‹è¯•"></a>å®è·µ2ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ å…±äº«é”æµ‹è¯•</h5><p><img src="pic/lock16.png" alt="lock16"></p><p>æ‰“å¼€ä¸¤ä¸ªä¼šè¯ï¼Œåˆ†åˆ«æŒ‰ç…§å›¾ç‰‡ä¸­å»åšæµ‹è¯•</p><p><img src="pic/lock14.png" alt="lock14"></p><p>ä»å®è·µä¸­å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¿¡æ¯:</p><ul><li>äº‹åŠ¡Aå¯¹id=1çš„è¡Œç”³è¯·äº†å…±äº«Sé”ä¹‹åï¼Œäº‹åŠ¡Bè¦ä¹ˆä½¿ç”¨ä¸€è‡´æ€§éé”å®šè¯»ï¼Œå³ä¸è¯·æ±‚é”ï¼Œæˆ–è€…ä½¿ç”¨ä¸€è‡´æ€§é”å®šè¯»çš„å…±äº«é”ï¼Œå³è¯·æ±‚å…±äº«Sé”</li><li>è€Œäº‹åŠ¡Bä¸­éœ€è¦è¯·æ±‚æ’ä»–é”çš„å†™æ“ä½œéƒ½ä¸èƒ½æ‰§è¡Œï¼Œæ¯æ¬¡éƒ½æ˜¯é”è¯·æ±‚ç­‰å¾…è¶…æ—¶</li></ul><h5 id="å®è·µ3ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ æ’ä»–é”æµ‹è¯•"><a href="#å®è·µ3ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ æ’ä»–é”æµ‹è¯•" class="headerlink" title="å®è·µ3ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ æ’ä»–é”æµ‹è¯•"></a>å®è·µ3ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ æ’ä»–é”æµ‹è¯•</h5><p><img src="pic/lock17.png" alt="lock17"></p><p>è¿™ä¸€æ¬¡äº‹åŠ¡Aä»¥åŠå¯¹id=1çš„è¡Œç”³è¯·äº†æ’ä»–é”Xï¼ŒæŒ‰ç…§ä¸‹å›¾åšæµ‹è¯•ï¼š</p><p><img src="pic/lock15.png" alt="lock15"></p><p>ä»å®è·µä¸­å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¿¡æ¯:</p><ul><li>äº‹åŠ¡Aå¯¹id=1çš„è¡Œç”³è¯·äº†æ’ä»–é”Xä¹‹åï¼Œäº‹åŠ¡Båªèƒ½ä½¿ç”¨ä¸€è‡´æ€§éé”å®šè¯»ï¼Œå³ä¸è¯·æ±‚é”</li><li>è€Œäº‹åŠ¡Bä¸­éœ€è¦è¯·æ±‚é”çš„è¡Œä¸ºéƒ½ä¼šç­‰å¾…è¶…æ—¶ï¼ŒåŒ…æ‹¬æ’ä»–é”çš„å†™æ“ä½œå’Œå…±äº«é”çš„è¯»æ“ä½œéƒ½ä¸èƒ½æ‰§è¡Œ</li></ul><h4 id="è®¤è¯†é”çš„ç®—æ³•"><a href="#è®¤è¯†é”çš„ç®—æ³•" class="headerlink" title="è®¤è¯†é”çš„ç®—æ³•"></a>è®¤è¯†é”çš„ç®—æ³•</h4><p>nnoDBå­˜å‚¨å¼•æ“çš„é”çš„ç®—æ³•æœ‰ä¸‰ç§ï¼š</p><ul><li>Record lockï¼šå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”</li><li>Gap lockï¼šé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«</li><li>Next-key lockï¼šrecord+gap é”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…å«è®°å½•æœ¬èº«</li></ul><p>Lockçš„ç²¾åº¦ï¼ˆtypeï¼‰åˆ†ä¸º è¡Œé”ã€è¡¨é”ã€æ„å‘é”</p><p>Lockçš„æ¨¡å¼ï¼ˆmodeï¼‰åˆ†ä¸º:</p><ul><li>é”çš„ç±»å‹ â€”â€”ã€è¯»é”å’Œå†™é”ã€‘æˆ–è€…ã€å…±äº«é”å’Œæ’ä»–é”ã€‘å³ ã€X or Sã€‘</li><li>é”çš„èŒƒå›´ â€”â€”ã€record lockã€gap lockã€Next-key lockã€‘</li></ul><h5 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h5><ol><li>innodbå¯¹äºè¡Œçš„æŸ¥è¯¢ä½¿ç”¨next-key lock</li><li>Next-locking keyingä¸ºäº†è§£å†³Phantom Problemå¹»è¯»é—®é¢˜</li><li>å½“æŸ¥è¯¢çš„ç´¢å¼•å«æœ‰å”¯ä¸€å±æ€§æ—¶ï¼Œå°†next-key locké™çº§ä¸ºrecord key</li><li>Gapé”è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†é˜»æ­¢å¤šä¸ªäº‹åŠ¡å°†è®°å½•æ’å…¥åˆ°åŒä¸€èŒƒå›´å†…ï¼Œè€Œè¿™ä¼šå¯¼è‡´å¹»è¯»é—®é¢˜çš„äº§ç”Ÿ</li><li>æœ‰ä¸¤ç§æ–¹å¼æ˜¾å¼å…³é—­gapé”ï¼šï¼ˆé™¤äº†å¤–é”®çº¦æŸå’Œå”¯ä¸€æ€§æ£€æŸ¥å¤–ï¼Œå…¶ä½™æƒ…å†µä»…ä½¿ç”¨record lockï¼‰<br> A. å°†äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºRC<br> B. å°†å‚æ•°innodb_locks_unsafe_for_binlogè®¾ç½®ä¸º1</li></ol><p><img src="pic/lock18.png" alt="lock18"></p><h5 id="å®è·µ1ï¼š-éªŒè¯next-key-locké™çº§ä¸ºrecord-key"><a href="#å®è·µ1ï¼š-éªŒè¯next-key-locké™çº§ä¸ºrecord-key" class="headerlink" title="å®è·µ1ï¼š éªŒè¯next-key locké™çº§ä¸ºrecord key"></a>å®è·µ1ï¼š éªŒè¯next-key locké™çº§ä¸ºrecord key</h5><p>åˆ›å»ºdb1.t1è¡¨ï¼Œæœ‰åˆ—aå’Œbï¼Œåˆ†åˆ«ä¸ºchar(10)å’Œintå‹ï¼Œå¹¶ä¸”bä¸ºkeyï¼Œæ³¨æ„båˆ—ä¸ºç´¢å¼•åˆ—ï¼Œä½†å¹¶ä¸æ˜¯ä¸»é”®ï¼Œå› æ­¤ä¸æ˜¯å”¯ä¸€çš„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [db1]&gt; create table db1.t1 (a char(10),b int,key (b));</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',1),('superman',3),('leo',5);</span><br><span class="line">Query OK, 3 rows affected (0.15 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1;</span><br><span class="line">+----------+------+</span><br><span class="line">| a        | b    |</span><br><span class="line">+----------+------+</span><br><span class="line">| batman   |    1 |</span><br><span class="line">| superman |    3 |</span><br><span class="line">| leo      |    5 |</span><br><span class="line">+----------+------+</span><br><span class="line">3 rows in set (0.02 sec)</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å¼€å¯ä¸¤ä¸ªäº‹åŠ¡T1å’ŒT2ï¼ŒT1ä¸­æŸ¥çœ‹b=3çš„è¡Œï¼Œæ˜¾å¼åŠ æ’ä»–é”ï¼›T1æœªæäº¤äº‹åŠ¡æ—¶ï¼ŒT2äº‹åŠ¡å¼€å¯å¹¶å°è¯•æ’å…¥æ–°è¡Œa=â€™batmanâ€™,b=2å’Œa=â€™batmanâ€™,b=4ï¼›</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T1</span></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1 where b=3 for update;</span><br><span class="line">+----------+------+</span><br><span class="line">| a        | b    |</span><br><span class="line">+----------+------+</span><br><span class="line">| superman |    3 |</span><br><span class="line">+----------+------+</span><br><span class="line">1 row in set (0.12 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T2</span></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',2);</span><br><span class="line">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',4);</span><br><span class="line">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</span><br></pre></td></tr></table></figure><p>å‘ç°T2äº‹åŠ¡ä¸­ä¸èƒ½æ’å…¥æ–°è¡Œa=â€™batmanâ€™,b=2å’Œa=â€™batmanâ€™,b=4ï¼›å¯ä»¥æŸ¥çœ‹å½“å‰innodbé”çš„ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [db1]&gt; select * from information_schema.innodb_locks\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">    lock_id: 111B:0:334:3</span><br><span class="line">lock_trx_id: 111B</span><br><span class="line">  lock_mode: X,GAP</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `db1`.`t1`</span><br><span class="line"> lock_index: `b`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 334</span><br><span class="line">   lock_rec: 3</span><br><span class="line">  lock_data: 3, 0x00000000020E</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">    lock_id: 111A:0:334:3</span><br><span class="line">lock_trx_id: 111A</span><br><span class="line">  lock_mode: X</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `db1`.`t1`</span><br><span class="line"> lock_index: `b`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 334</span><br><span class="line">   lock_rec: 3</span><br><span class="line">  lock_data: 3, 0x00000000020E</span><br><span class="line">2 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from information_schema.innodb_lock_waits\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">requesting_trx_id: 111B</span><br><span class="line">requested_lock_id: 111B:0:334:3</span><br><span class="line">  blocking_trx_id: 111A</span><br><span class="line"> blocking_lock_id: 111A:0:334:3</span><br><span class="line">1 row in set (0.09 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from information_schema.innodb_lock_waits\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">requesting_trx_id: 111B</span><br><span class="line">requested_lock_id: 111B:0:334:4</span><br><span class="line">  blocking_trx_id: 111A</span><br><span class="line"> blocking_lock_id: 111A:0:334:4</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from information_schema.innodb_locks\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">    lock_id: 111B:0:334:4</span><br><span class="line">lock_trx_id: 111B</span><br><span class="line">  lock_mode: X,GAP</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `db1`.`t1`</span><br><span class="line"> lock_index: `b`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 334</span><br><span class="line">   lock_rec: 4</span><br><span class="line">  lock_data: 5, 0x00000000020F</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">    lock_id: 111A:0:334:4</span><br><span class="line">lock_trx_id: 111A</span><br><span class="line">  lock_mode: X,GAP</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `db1`.`t1`</span><br><span class="line"> lock_index: `b`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 334</span><br><span class="line">   lock_rec: 4</span><br><span class="line">  lock_data: 5, 0x00000000020F</span><br><span class="line">2 rows in set (0.11 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°T2äº‹åŠ¡çš„ä¸¤æ¬¡æ’å…¥åŠ¨ä½œéƒ½åœ¨è¯·æ±‚æ’ä»–é”ï¼Œä½†æ˜¯æ­¤æ—¶T1äº‹åŠ¡å·²ç»åœ¨åŠ äº†next-key lock(record + gap)ï¼Œè¡¨ç°èŒƒå›´ä¸ºbçš„(1,5)ï¼ŒåŒ…æ‹¬è®°å½•3ï¼Œæ‰€ä»¥T2äº‹åŠ¡åœ¨T1äº‹åŠ¡è§£é”ä¹‹é—´ï¼Œä¸èƒ½æ’å…¥åˆ°bçš„(1,5)èŒƒå›´å†…</p><p>Ã— <code>lock_mode: X,GAP</code> lock_mode å¯ä»¥ç†è§£ä¸º <code>è¯»é”è¿˜æ˜¯å†™é”ï¼Ÿ</code>ï¼›<code>æ˜¯åœ¨ä»€ä¹ˆèŒƒå›´ä¸Šé”ï¼Ÿ</code>;æ­¤å¤„åŠ çš„å†™é”å³æ’ä»–é”ï¼›èŒƒå›´æ˜¯(1,5)</p><ul><li><code>lock_type: RECORD</code> è¡¨ç¤ºé”çš„ç²¾åº¦ï¼Œæ ¹æ®å­˜å‚¨å¼•æ“ä¸åŒï¼Œinnodbæ˜¯è¡Œé”ï¼ŒMYISAMæ˜¯è¡¨é”</li></ul><p>åˆ é™¤db1.t1è¡¨ï¼Œé‡æ–°åˆ›å»ºdb1.t1è¡¨ï¼Œæœ‰åˆ—aå’Œbï¼Œåˆ†åˆ«ä¸ºchar(10)å’Œintå‹ï¼Œå¹¶ä¸”bä¸ºprimay keyï¼Œå› æ­¤båˆ—æ˜¯å”¯ä¸€çš„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [db1]&gt; drop tables t1;</span><br><span class="line">Query OK, 0 rows affected (0.12 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; create table db1.t1 (a char(10),b int ,primary key (b));</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',1),('superman',3),('leo',5);</span><br><span class="line">Query OK, 3 rows affected (0.12 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1;</span><br><span class="line">+----------+---+</span><br><span class="line">| a        | b |</span><br><span class="line">+----------+---+</span><br><span class="line">| batman   | 1 |</span><br><span class="line">| superman | 3 |</span><br><span class="line">| leo      | 5 |</span><br><span class="line">+----------+---+</span><br><span class="line">3 rows in set (0.08 sec)</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å¼€å¯ä¸¤ä¸ªäº‹åŠ¡T1å’ŒT2ï¼ŒT1ä¸­æŸ¥çœ‹b=3çš„è¡Œï¼Œæ˜¾å¼åŠ æ’ä»–é”ï¼›T1æœªæäº¤äº‹åŠ¡æ—¶ï¼ŒT2äº‹åŠ¡å¼€å¯å¹¶å°è¯•æ’å…¥æ–°è¡Œa=â€™batmanâ€™,b=2å’Œa=â€™batmanâ€™,b=4ï¼›</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T1</span></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1 where b=3 for update;</span><br><span class="line">+----------+---+</span><br><span class="line">| a        | b |</span><br><span class="line">+----------+---+</span><br><span class="line">| superman | 3 |</span><br><span class="line">+----------+---+</span><br><span class="line">1 row in set (0.14 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T2</span></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',2);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',4);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure><p>ç»§ç»­åœ¨T2äº‹åŠ¡ä¸­å°è¯•æŸ¥çœ‹b=3çš„è¡Œï¼Œæ˜¾å¼åŠ å…±äº«é”ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T2</span></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1 where b=3 lock in share mode;</span><br><span class="line">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</span><br></pre></td></tr></table></figure><p>å‘ç°T2äº‹åŠ¡ä¸­å¯ä»¥æ’å…¥æ–°è¡Œa=â€™batmanâ€™,b=2å’Œa=â€™batmanâ€™,b=4ï¼›ä½†æ˜¯ä¸èƒ½æŸ¥çœ‹b=3çš„è¡Œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŸ¥çœ‹å½“å‰innodbé”çš„ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [db1]&gt; select * from information_schema.innodb_locks\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">    lock_id: 1122:0:337:3</span><br><span class="line">lock_trx_id: 1122</span><br><span class="line">  lock_mode: S</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `db1`.`t1`</span><br><span class="line"> lock_index: `PRIMARY`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 337</span><br><span class="line">   lock_rec: 3</span><br><span class="line">  lock_data: 3</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">    lock_id: 1121:0:337:3</span><br><span class="line">lock_trx_id: 1121</span><br><span class="line">  lock_mode: X</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `db1`.`t1`</span><br><span class="line"> lock_index: `PRIMARY`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 337</span><br><span class="line">   lock_rec: 3</span><br><span class="line">  lock_data: 3</span><br><span class="line">2 rows in set (0.02 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from information_schema.innodb_lock_waits\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">requesting_trx_id: 1122</span><br><span class="line">requested_lock_id: 1122:0:337:3</span><br><span class="line">  blocking_trx_id: 1121</span><br><span class="line"> blocking_lock_id: 1121:0:337:3</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br></pre></td></tr></table></figure><p>ä»ä»¥ä¸Šä¿¡æ¯å¯ä»¥çœ‹åˆ°ï¼ŒT1äº‹åŠ¡å½“å‰åªåœ¨b=3æ‰€åœ¨çš„è¡Œä¸ŠåŠ äº†å†™é”ï¼Œæ’ä»–é”ï¼Œå¹¶æ²¡æœ‰åŒæ—¶ä½¿ç”¨gapé”æ¥ç»„æˆnext-key lockã€‚</p><p>åˆ°æ­¤ï¼Œå·²ç»è¯æ˜äº†ï¼Œå½“æŸ¥è¯¢çš„ç´¢å¼•å«æœ‰å”¯ä¸€å±æ€§æ—¶ï¼Œå°†next-key locké™çº§ä¸ºrecord key</p><p>æˆ‘ä»¬ç¬¬äºŒæ¬¡åˆ›å»ºçš„t1è¡¨çš„åˆ—bæ˜¯ä¸»é”®ï¼Œè€Œä¸»é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚</p><h5 id="å®è·µ2ï¼š-å…³é—­GAPé”-RC"><a href="#å®è·µ2ï¼š-å…³é—­GAPé”-RC" class="headerlink" title="å®è·µ2ï¼š å…³é—­GAPé”_RC"></a>å®è·µ2ï¼š å…³é—­GAPé”_RC</h5><p>æœ‰ä¸¤ç§æ–¹å¼æ˜¾å¼å…³é—­gapé”ï¼šï¼ˆé™¤äº†å¤–é”®çº¦æŸå’Œå”¯ä¸€æ€§æ£€æŸ¥å¤–ï¼Œå…¶ä½™æƒ…å†µä»…ä½¿ç”¨record lockï¼‰</p><p>A. å°†äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºRC<br>B. å°†å‚æ•°innodb_locks_unsafe_for_binlogè®¾ç½®ä¸º1</p><table><thead><tr><th align="left">T1 RR</th><th align="left">T2 RR</th></tr></thead><tbody><tr><td align="left">begin;</td><td align="left">begin;</td></tr><tr><td align="left">select * from db1.t1 where b=3 for update;</td><td align="left"></td></tr><tr><td align="left"></td><td align="left">insert into db1.t1 values (â€˜batmanâ€™,2)</td></tr><tr><td align="left"></td><td align="left">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</td></tr><tr><td align="left"></td><td align="left">set session transaction isolation level READ COMMITTED;</td></tr><tr><td align="left">commit;</td><td align="left">commit;</td></tr></tbody></table><p>æ³¨æ„ï¼Œå°†T1äº‹åŠ¡è®¾ç½®ä¸ºRCåï¼Œéœ€è¦å°†äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼æ”¹ä¸ºrowæ ¼å¼ï¼Œå¦åˆ™æ‰§è¡Œæ˜¾å¼åŠ é”æ—¶ä¼šæŠ¥é”™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [db1]&gt; insert into t1 values ('batman',2);</span><br><span class="line">ERROR 1665 (HY000): Cannot execute statement: impossible to write to binary log since BINLOG_FORMAT = STATEMENT and at least one table uses a storage engine limited to row-based logging. InnoDB is limited to row-logging when transaction isolation level is READ COMMITTED or READ UNCOMMITTED.</span><br></pre></td></tr></table></figure><table><thead><tr><th align="left">T1 RC</th><th align="left">T2 RR</th></tr></thead><tbody><tr><td align="left">begin;</td><td align="left">begin;</td></tr><tr><td align="left">set session transaction isolation level READ COMMITTED;</td><td align="left"></td></tr><tr><td align="left">select * from db1.t1 where b=3 for update;</td><td align="left"></td></tr><tr><td align="left"></td><td align="left">insert into db1.t1 values (â€˜batmanâ€™,2)</td></tr><tr><td align="left"></td><td align="left">insert into db1.t1 values (â€˜batmanâ€™,4)</td></tr><tr><td align="left">commit;</td><td align="left">commit;</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">T1äº‹åŠ¡</span></span><br><span class="line">MariaDB [db1]&gt; set session transaction isolation level READ COMMITTED;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select @@tx_isolation;</span><br><span class="line">+----------------+</span><br><span class="line">| @@tx_isolation |</span><br><span class="line">+----------------+</span><br><span class="line">| READ-COMMITTED |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.09 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from t1 where b=3 for update;</span><br><span class="line">+----------+------+</span><br><span class="line">| a        | b    |</span><br><span class="line">+----------+------+</span><br><span class="line">| superman |    3 |</span><br><span class="line">+----------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">T2äº‹åŠ¡</span></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.16 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select @@tx_isolation;</span><br><span class="line">+----------------+</span><br><span class="line">| @@tx_isolation |</span><br><span class="line">+----------------+</span><br><span class="line">| READ-COMMITTED |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',2);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; set session transaction isolation level REPEATABLE READ;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',4);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">T1äº‹åŠ¡</span></span><br><span class="line">MariaDB [db1]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure><p>æˆ‘åœ¨åšæµ‹è¯•çš„æ—¶å€™ï¼ŒT1äº‹åŠ¡éš”ç¦»ç•Œåˆ«ä¸ºRCï¼ŒT2äº‹åŠ¡çš„éš”ç¦»ç•Œåˆ«åˆ†åˆ«ç”¨RCå’ŒRRåšäº†æµ‹è¯•ï¼Œéƒ½æ˜¯å¯ä»¥çš„</p><h5 id="å®è·µ3ï¼š-å…³é—­GAPé”-innodb-locks-unsafe-for-binlog"><a href="#å®è·µ3ï¼š-å…³é—­GAPé”-innodb-locks-unsafe-for-binlog" class="headerlink" title="å®è·µ3ï¼š å…³é—­GAPé”_innodb_locks_unsafe_for_binlog"></a>å®è·µ3ï¼š å…³é—­GAPé”_innodb_locks_unsafe_for_binlog</h5><p>æŸ¥çœ‹å½“å‰innodb_locks_unsafe_for_binlogå‚æ•°çš„å€¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select @@innodb_locks_unsafe_for_binlog;</span><br><span class="line">+----------------------------------+</span><br><span class="line">| @@innodb_locks_unsafe_for_binlog |</span><br><span class="line">+----------------------------------+</span><br><span class="line">|                                0 |</span><br><span class="line">+----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å‚æ•°ï¼Œå¹¶é‡æ–°å¯åŠ¨æœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/my.cnf</span><br><span class="line">innodb_locks_unsafe_for_binlog=1</span><br><span class="line">[root@localhost ~]# systemctl restart mariadb</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# mysql -e "select @@innodb_locks_unsafe_for_binlog"</span><br><span class="line">+----------------------------------+</span><br><span class="line">| @@innodb_locks_unsafe_for_binlog |</span><br><span class="line">+----------------------------------+</span><br><span class="line">|                                1 |</span><br><span class="line">+----------------------------------+</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯å»åˆ›å»ºdb1.t1è¡¨ï¼Œå¦‚æœå·²æœ‰å°±å…ˆdropï¼›æœ‰åˆ—aå’Œbï¼Œåˆ†åˆ«ä¸ºchar(10)å’Œintå‹ï¼Œå¹¶ä¸”bä¸ºkeyï¼Œæ³¨æ„båˆ—ä¸ºç´¢å¼•åˆ—ï¼Œä½†å¹¶ä¸æ˜¯ä¸»é”®ï¼Œå› æ­¤ä¸æ˜¯å”¯ä¸€çš„ã€‚</p><table><thead><tr><th align="left">T1 RR</th><th align="left">T2 RR</th></tr></thead><tbody><tr><td align="left">begin;</td><td align="left">begin;</td></tr><tr><td align="left">select * from db1.t1 where b=3 for update;</td><td align="left"></td></tr><tr><td align="left"></td><td align="left">insert into db1.t1 values (â€˜batmanâ€™,2)</td></tr><tr><td align="left"></td><td align="left">insert into db1.t1 values (â€˜batmanâ€™,4)</td></tr><tr><td align="left">commit;</td><td align="left">commit;</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [db1]&gt; create table db1.t1 (a char(10),b int,key (b));</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',1),('superman',3),('leo',5);</span><br><span class="line">Query OK, 3 rows affected (0.15 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1;</span><br><span class="line">+----------+------+</span><br><span class="line">| a        | b    |</span><br><span class="line">+----------+------+</span><br><span class="line">| batman   |    1 |</span><br><span class="line">| superman |    3 |</span><br><span class="line">| leo      |    5 |</span><br><span class="line">+----------+------+</span><br><span class="line">3 rows in set (0.02 sec)</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å¼€å¯ä¸¤ä¸ªäº‹åŠ¡T1å’ŒT2ï¼ŒT1ä¸­æŸ¥çœ‹b=3çš„è¡Œï¼Œæ˜¾å¼åŠ æ’ä»–é”ï¼›T1æœªæäº¤äº‹åŠ¡æ—¶ï¼ŒT2äº‹åŠ¡å¼€å¯å¹¶å°è¯•æ’å…¥æ–°è¡Œa=â€™batmanâ€™,b=2å’Œa=â€™batmanâ€™,b=4ï¼›</p><p>T1äº‹åŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1 where b=3 for update;</span><br><span class="line">+----------+------+</span><br><span class="line">| a        | b    |</span><br><span class="line">+----------+------+</span><br><span class="line">| superman |    3 |</span><br><span class="line">+----------+------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure><p>T2äº‹åŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values ('batman',4);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values ('batman',2);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure><p>T1äº‹åŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure><h5 id="å®è·µ4ï¼šnext-key-lockingæ˜¯å¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜çš„"><a href="#å®è·µ4ï¼šnext-key-lockingæ˜¯å¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜çš„" class="headerlink" title="å®è·µ4ï¼šnext-key lockingæ˜¯å¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜çš„"></a>å®è·µ4ï¼šnext-key lockingæ˜¯å¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜çš„</h5><p><img src="pic/lock19.png" alt="lock19"></p><p>é¦–å…ˆä»€ä¹ˆæ˜¯å¹»è¯»å‘¢ï¼Ÿ </p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸¤ä¸ªç”·å­©åŒæ—¶åœ¨è¿½æ±‚ä¸€ä¸ªå¥³ç”Ÿçš„æ•…äº‹</p><p>Aé—®ï¼šä½ æœ‰ç”·æœ‹å‹å—ï¼Ÿå¥³å­©å¯¹ä»–è¯´æ²¡æœ‰ã€‚Aè¿½æ±‚å¥³å­©çš„äº‹ä»¶è¿˜æ²¡æœ‰æäº¤ï¼Œå°±æ˜¯ç»§ç»­è¿½æ±‚å“ˆã€‚</p><p>å°±åœ¨Aè¿½æ±‚çš„åŒæ—¶ï¼ŒBä¹Ÿåœ¨è¿½æ±‚ï¼Œå¹¶ä¸”ç›´æ¥è®©å¥³å­©åšä»–çš„å¥³æœ‹å‹ï¼Œå¥³å­©ç­”åº”äº†ï¼ŒBçš„è¿½æ±‚äº‹ä»¶ç»“æŸã€‚</p><p>Aåˆé—®ï¼šä½ æœ‰ç”·æœ‹å‹å—ï¼Ÿ å¥³å­©å¯¹ä»–è¯´æˆ‘å·²ç»æœ‰ç”·æœ‹å‹äº†ï¼ å‘œå‘œå‘œ ï¼åˆšæ‰ä½ è¿˜æ²¡æœ‰çš„ï¼Œæ€ä¹ˆç°åœ¨å°±æœ‰äº†å‘¢ï¼Ÿ</p><p>å¥³å­©è¯´ï¼Œä½ ä¹Ÿæ²¡è¯´è¿‡ä½ è¿½æˆ‘çš„æ—¶å€™ä¸è®©åˆ«äººè¿½æˆ‘å•Šï¼â€¦ â€¦ Aå“­ç€èµ°äº†ã€‚</p><p><strong>å¹»è¯» Phantom Problem æ˜¯æŒ‡åœ¨åŒä¸€äº‹åŠ¡ä¸‹ï¼Œè¿ç»­æ‰§è¡Œä¸¤æ¬¡ç›¸åŒçš„sqlè¯­å¥å¯èƒ½å¯¼è‡´ä¸åŒçš„ç»“æœï¼Œç¬¬äºŒæ¬¡çš„sqlè¯­å¥å¯èƒ½ä¼šè¿”å›ä¹‹å‰ä¸å­˜åœ¨çš„è¡Œã€‚</strong></p><p>åœ¨åˆšæ‰æˆ‘ä¸¾çš„ä¾‹å­é‡Œï¼ŒAè™½ç„¶é—®äº†å¥³å­©æœ‰æ²¡æœ‰ç”·æœ‹å‹ï¼Œä½†æ˜¯æ²¡æœ‰å‘Šè¯‰å¥³å­©ï¼Œåœ¨ä»–è¿½æ±‚æ—¶ï¼Œä¸å¯ä»¥æ¥å—åˆ«äººçš„è¿½æ±‚ï¼Œæ‰€ä»¥æ‚²å‚¬çš„ç»“å±€ã€‚</p><p>é‚£ä¹ˆAæ€ä¹ˆæ‰èƒ½åœ¨ä»–è¿½æ±‚äº‹ä»¶ç»“æŸå‰è®©å¥³å­©ä¸ç­”åº”åˆ«äººçš„è¿½æ±‚å‘¢ï¼Ÿ</p><p>innodbä¸­çš„RRéš”ç¦»çº§åˆ«æ˜¯é€šè¿‡next-key lockingæ˜¯å¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜çš„ï¼Œå°±æ˜¯é”ä½ä¸€ä¸ªèŒƒå›´ã€‚</p><p>é‚£ä¹ˆå¦‚æœä½ æ˜¯Aä½ æ€ä¹ˆåšå‘¢ï¼Ÿä½ è‚¯å®šè¦è·Ÿå¥³å­©è¯´ï¼Œåªè¦æˆ‘å¼€å§‹è¿½æ±‚ä½ ï¼Œé—®äº†ä½ æœ‰æ²¡æœ‰ç”·æœ‹å‹ï¼Œåœ¨æˆ‘ç»“æŸè¿½æ±‚ä½ ä¹‹å‰ï¼Œä½ ä¸å¯ä»¥ç­”åº”åˆ«äººçš„è¿½æ±‚ï¼æˆ‘è¦æŠŠä½ è„‘å­é‡Œè®°å½•ç”·æœ‹å‹çš„åŒºåŸŸå…¨éƒ¨é”èµ·æ¥ï¼Œå•Šå“ˆå•Šï¼</p><p>ä¸‹é¢æˆ‘ä»¬æ¥åšä¸€ä¸ªæµ‹è¯•ï¼Œåˆ†åˆ«åœ¨RRå’ŒRCéš”ç¦»çº§åˆ«ä¸­æ¥å®ç°ï¼š</p><p>æµ‹è¯•ä½¿ç”¨è¡¨db1.t1 (a int primary key) ,è®°å½•æœ‰1,3,5</p><table><thead><tr><th align="left">T1 RC</th><th align="left">T2 RR</th></tr></thead><tbody><tr><td align="left">begin;</td><td align="left">begin;</td></tr><tr><td align="left">set session transaction isolation level READ COMMITTED;</td><td align="left"></td></tr><tr><td align="left">select * from db1.t1 where a&gt;3 for update;</td><td align="left"></td></tr><tr><td align="left">æŸ¥è¯¢ç»“æœä¸º5</td><td align="left"></td></tr><tr><td align="left"></td><td align="left">insert into db1.t1 values (4);</td></tr><tr><td align="left"></td><td align="left">commit;</td></tr><tr><td align="left">select * from db1.t1 where a&gt;3;</td><td align="left"></td></tr><tr><td align="left">æŸ¥è¯¢ç»“æœä¸º4 5</td><td align="left"></td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [db1]&gt; create table t1 (a int primary key);</span><br><span class="line">Query OK, 0 rows affected (0.22 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into t1 values (1),(3),(5);</span><br><span class="line">Query OK, 3 rows affected (0.02 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T1</span></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; set session transaction isolation level read co</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1 where a&gt;3 for update;</span><br><span class="line">+---+</span><br><span class="line">| a |</span><br><span class="line">+---+</span><br><span class="line">| 5 |</span><br><span class="line">+---+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T2</span></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values (4);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T1</span></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1 where a&gt;3 for update;</span><br><span class="line">+---+</span><br><span class="line">| a |</span><br><span class="line">+---+</span><br><span class="line">| 4 |</span><br><span class="line">| 5 |</span><br><span class="line">+---+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>å°†ä¼šè¯ä¸­çš„éš”ç¦»ç•Œåˆ«æ”¹ä¸ºRRï¼Œå¹¶åˆ é™¤a=4è®°å½•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [db1]&gt; set session transaction isolation level repeatable read;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; delete from db1.t1 where a=4;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure><table><thead><tr><th align="left">T1 RR</th><th align="left">T2 RR</th></tr></thead><tbody><tr><td align="left">begin;</td><td align="left">begin;</td></tr><tr><td align="left">select * from db1.t1 where a&gt;3 for update;</td><td align="left"></td></tr><tr><td align="left">æŸ¥è¯¢ç»“æœä¸º5</td><td align="left"></td></tr><tr><td align="left"></td><td align="left">insert into db1.t1 values (4);</td></tr><tr><td align="left"></td><td align="left">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</td></tr><tr><td align="left"></td><td align="left">commit;</td></tr><tr><td align="left">select * from db1.t1 where a&gt;3;</td><td align="left"></td></tr><tr><td align="left">æŸ¥è¯¢ç»“æœä¸º5</td><td align="left"></td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T1</span></span><br><span class="line">MariaDB [(none)]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1 where a&gt;3 for update;</span><br><span class="line">+---+</span><br><span class="line">| a |</span><br><span class="line">+---+</span><br><span class="line">| 5 |</span><br><span class="line">+---+</span><br><span class="line">1 row in set (0.02 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T2</span></span><br><span class="line">MariaDB [(none)]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values (4);</span><br><span class="line">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</span><br><span class="line">MariaDB [(none)]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T1</span></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1 where a&gt;3 for update;</span><br><span class="line">+---+</span><br><span class="line">| a |</span><br><span class="line">+---+</span><br><span class="line">| 5 |</span><br><span class="line">+---+</span><br><span class="line">1 row in set (0.02 sec)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;MySQL-é€»è¾‘æ¶æ„&quot;&gt;&lt;a href=&quot;#MySQL-é€»è¾‘æ¶æ„&quot; class=&quot;headerlink&quot; title=&quot;MySQL é€»è¾‘æ¶æ„&quot;&gt;&lt;/a&gt;MySQL é€»è¾‘æ¶æ„&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;pic/04-mysql2.jpg&quot; alt=&quot;é€»è¾‘æ¶æ„
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†" scheme="http://www.toberoot.com/tags/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬å…«è¯¾ é«˜å¯ç”¨æ€§HA</title>
    <link href="http://www.toberoot.com/2016/12/25/booboo_mysql/05-MySQL%E9%AB%98%E5%8F%AF%E7%94%A8HA/"/>
    <id>http://www.toberoot.com/2016/12/25/booboo_mysql/05-MySQL%E9%AB%98%E5%8F%AF%E7%94%A8HA/</id>
    <published>2016-12-24T21:06:27.000Z</published>
    <updated>2020-03-24T05:27:17.971Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯é«˜å¯ç”¨"><a href="#ä»€ä¹ˆæ˜¯é«˜å¯ç”¨" class="headerlink" title="ä»€ä¹ˆæ˜¯é«˜å¯ç”¨"></a>ä»€ä¹ˆæ˜¯é«˜å¯ç”¨</h3><p>é«˜å¯ç”¨æ€§å®é™…ä¸Šæœ‰ç‚¹åƒç¥ç§˜çš„é‡å…½ã€‚å®ƒé€šå¸¸æ˜¯ä»¥ç™¾åˆ†æ¯”è¡¨ç¤ºï¼Œè¿™æœ¬èº«ä¹Ÿæ˜¯ä¸€ç§æš—ç¤ºï¼šé«˜å¯ç”¨æ€§ä¸æ˜¯ç»å¯¹çš„ï¼Œåªæœ‰ç›¸å¯¹æ›´é«˜çš„å¯ç”¨æ€§ã€‚100%çš„å¯ç”¨æ€§æ˜¯ä¸å¯èƒ½è¾¾åˆ°çš„ã€‚å¯ç”¨æ€§çš„â€œ9â€è§„åˆ™æ˜¯è¡¨ç¤ºå¯ç”¨æ€§ç›®æ ‡æœ€æ™®éçš„æ–¹æ³•ã€‚ä½ å¯èƒ½ä¹ŸçŸ¥é“ï¼Œâ€œ5ä¸ª9â€è¡¨ç¤º99.999%çš„æ­£å¸¸å¯ç”¨æ—¶é—´ã€‚æ¢å¥è¯è¯´ï¼Œæ¯å¹´åªå…è®¸5åˆ†é’Ÿçš„å®•æœºæ—¶é—´ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨è¿™å·²ç»æ˜¯ä»¤äººæƒŠå¹çš„æ•°å­—ï¼Œå°½é‡è¿˜æœ‰ä¸€äº›äººè¯•å›¾è·å¾—æ›´å¤šçš„â€œ9â€ã€‚</p><p>æ¯ä¸ªåº”ç”¨å¯¹å¯ç”¨æ€§çš„éœ€æ±‚å„ä¸ç›¸åŒã€‚åœ¨è®¾å®šä¸€ä¸ªå¯ç”¨æ—¶é—´çš„ç›®æ ‡ä¹‹å‰ï¼Œå…ˆé—®é—®è‡ªå·±ï¼Œæ˜¯ä¸æ˜¯ç¡®å®éœ€è¦è¾¾åˆ°è¿™ä¸ªç›®æ ‡ã€‚å¯ç”¨æ€§æ¯æé«˜ä¸€ç‚¹ï¼Œæ‰€èŠ±è´¹çš„æˆæœ¬éƒ½ä¼šè¿œè¶…ä¹‹å‰ï¼›å¯ç”¨æ€§çš„æ•ˆæœå’Œå¼€é”€çš„æ¯”ä¾‹å¹¶ä¸æ˜¯çº¿æ€§çš„ã€‚éœ€è¦ä¿è¯å¤šå°‘å¯ç”¨æ—¶é—´ï¼Œå–å†³äºèƒ½å¤Ÿæ‰¿æ‹…å¤šå°‘æˆæœ¬ã€‚</p><p>é«˜å¯ç”¨å®é™…ä¸Šæ˜¯åœ¨å®•æœºé€ æˆçš„æŸå¤±ä¸é™ä½å®•æœºæ—¶é—´æ‰€èŠ±è´¹çš„æˆæœ¬ä¹‹é—´å–ä¸€ä¸ªå¹³è¡¡ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœéœ€è¦èŠ±å¤§é‡é‡‘é’±å»è·å–æ›´å¥½çš„å¯ç”¨æ—¶é—´ï¼Œä½†æ‰€å¸¦æ¥çš„æ”¶ç›Šå´å¾ˆä½ï¼Œå¯èƒ½å°±ä¸å€¼å¾—å»åšã€‚æ€»çš„æ¥è¯´ï¼Œåº”ç”¨åœ¨è¶…è¿‡ä¸€å®šçš„ç‚¹ä»¥åè¿½æ±‚æ›´é«˜çš„å¯ç”¨æ€§æ˜¯éå¸¸å›°éš¾çš„ï¼Œæˆæœ¬ä¹Ÿä¼šå¾ˆé«˜ï¼Œå› æ­¤æˆ‘ä»¬å»ºè®®è®¾å®šä¸€ä¸ªæ›´ç°å®çš„ç›®æ ‡å¹¶ä¸”é¿å…è¿‡æ¸¡è®¾è®¡ã€‚å¹¸è¿çš„æ˜¯ï¼Œå»ºç«‹2ä¸ª9æˆ–3ä¸ª0çš„å¯ç”¨æ—¶é—´çš„ç›®æ ‡å¯èƒ½å¹¶ä¸å›°éš¾ï¼Œå…·ä½“è¯·æ¬¾å–å†³äºåº”ç”¨ã€‚</p><h3 id="å¯¼è‡´å®•æœºçš„åŸå› "><a href="#å¯¼è‡´å®•æœºçš„åŸå› " class="headerlink" title="å¯¼è‡´å®•æœºçš„åŸå› "></a>å¯¼è‡´å®•æœºçš„åŸå› </h3><ul><li>åœ¨è¿è¡Œç¯å¢ƒçš„é—®é¢˜ä¸­ï¼Œæœ€æ™®éçš„é—®é¢˜æ˜¯ç£ç›˜ç©ºé—´è€—å°½ã€‚</li><li>åœ¨æ€§èƒ½é—®é¢˜ä¸­ï¼Œæœ€æ™®éçš„å®•æœºåŸå› ç¡®å®æ˜¯è¿è¡Œå¾ˆç³Ÿç³•çš„SQLï¼Œä½†ä¹Ÿä¸ä¸€å®šéƒ½æ˜¯è¿™ä¸ªåŸå› ï¼Œæ¯”å¦‚ä¹Ÿæœ‰å¾ˆå¤šé—®é¢˜æ˜¯ç”±äºæœåŠ¡å™¨Bugæˆ–é”™è¯¯çš„è¡Œä¸ºå¯¼è‡´çš„ã€‚</li><li>ç³Ÿç³•çš„Schemaå’Œç´¢å¼•è®¾è®¡æ˜¯ç¬¬äºŒå¤§å½±å“æ€§èƒ½çš„é—®é¢˜ã€‚</li><li>å¤åˆ¶é—®é¢˜é€šå¸¸æ˜¯ç”±äºä¸»å¤‡æ•°æ®ä¸ä¸€è‡´å¯¼è‡´ã€‚</li><li>æ•°æ®ä¸¢å¤±é—®é¢˜é€šå¸¸ç”±äºDROP TABLEçš„è¯¯æ“ä½œå¯¼è‡´ï¼Œå¹¶æ€»æ˜¯ä¼´éšç€ç¼ºå°‘å¯ç”¨å¤‡ä»½çš„é—®é¢˜ã€‚</li></ul><p>å¤åˆ¶è™½ç„¶è¢«äººä»¬ç”¨æ¥æ”¹å–„å¯ç”¨æ—¶é—´ï¼Œä½†å´ä¹Ÿå¯èƒ½å¯¼è‡´å®•æœºã€‚è¿™ä¸»è¦æ˜¯ç”±äºä¸ç¡®å®šçš„ä½¿ç”¨å¯¼è‡´çš„ï¼Œå³ä¾¿å¦‚æ­¤ï¼Œå®ƒä¹Ÿé˜æ˜äº†ä¸€ä¸ªæ™®éçš„æƒ…å†µï¼šè®¸å¤šé«˜å¯ç”¨ç­–ç•¥å¯èƒ½ä¼šäº§ç”Ÿåä½œç”¨ã€‚</p><h3 id="å¦‚ä½•å®ç°é«˜å¯ç”¨"><a href="#å¦‚ä½•å®ç°é«˜å¯ç”¨" class="headerlink" title="å¦‚ä½•å®ç°é«˜å¯ç”¨"></a>å¦‚ä½•å®ç°é«˜å¯ç”¨</h3><ul><li>é™ä½æ•…éšœç‡</li><li>ä¼˜åŒ–æ¶æ„</li></ul><h3 id="é¿å…å•ç‚¹æ•…éšœ"><a href="#é¿å…å•ç‚¹æ•…éšœ" class="headerlink" title="é¿å…å•ç‚¹æ•…éšœ"></a>é¿å…å•ç‚¹æ•…éšœ</h3><h4 id="åŸºäºå¤åˆ¶çš„å†—ä½™"><a href="#åŸºäºå¤åˆ¶çš„å†—ä½™" class="headerlink" title="åŸºäºå¤åˆ¶çš„å†—ä½™"></a>åŸºäºå¤åˆ¶çš„å†—ä½™</h4><p>å‰é¢æˆ‘ä»¬å·²ç»å­¦ä¹ MySQL Replication çš„å†…å®¹ï¼Œå¦‚ä¸‹æ¶æ„ï¼š</p><p><img src="pic/20-ab-replication.jpg" alt="ab"></p><p>MySQL 5.6 ä¸‹çš„ semi-sync</p><p>![ab1](pic/06-MySQL 5.6ä¸‹çš„semi-sync.png)</p><p>MySQL 5.7 ä¸‹çš„ semi-sync</p><p>![ab2](pic/07-MySQL 5.7ä¸‹çš„semi-sync.png)</p><h4 id="MySQL-åŒæ­¥å¤åˆ¶"><a href="#MySQL-åŒæ­¥å¤åˆ¶" class="headerlink" title="MySQL åŒæ­¥å¤åˆ¶"></a>MySQL åŒæ­¥å¤åˆ¶</h4><p>å½“ä½¿ç”¨åŒæ­¥å¤åˆ¶æ—¶ï¼Œä¸»åº“çš„äº‹åŠ¡åªæœ‰åœ¨è‡³å°‘ä¸€ä¸ªå¤‡åº“ä¸Šæäº¤æ‰èƒ½è®¤ä¸ºå…¶æ‰§è¡Œå®Œæˆã€‚è¿™å®ç°äº†ä¸¤ä¸ªç›®æ ‡ï¼š</p><ul><li>å½“æœåŠ¡å™¨å´©æºƒæ—¶æ²¡æœ‰æäº¤çš„äº‹åŠ¡ä¼šä¸¢å¤±ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªå¤‡åº“æœ‰å®æ—¶çš„æ•°æ®å‰¯æœ¬ã€‚</li><li>å¤§å¤šæ•°åŒæ­¥å¤åˆ¶æ¶æ„è¿è¡Œåœ¨ä¸»åŠ¨-ä¸»åŠ¨æ¨¡å¼ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªæœåŠ¡å™¨åœ¨ä»»ä½•æ—¶å€™éƒ½æ˜¯æ•…éšœè½¬ç§»çš„å€™é€‰è€…ï¼Œè¿™ä½¿å¾—é€šè¿‡å†—ä½™è·å¾—é«˜å¯ç”¨æ€§æ›´åŠ å®¹æ˜“ã€‚</li></ul><p>MySQL åˆ°ç›®å‰ä¸ºæ­¢ï¼Œï¼ˆ5.7ç‰ˆæœ¬ï¼‰æœ¬èº«å¹¶ä¸æ”¯æŒåŒæ­¥å¤åˆ¶ï¼Œä½†æœ‰ä¸¤ä¸ªåŸºäºMySQLçš„é›†ç¾¤è§£å†³æ–¹æ¡ˆæ”¯æŒåŒæ­¥å¤åˆ¶ã€‚</p><h5 id="MySQL-Cluster-é›†ç¾¤"><a href="#MySQL-Cluster-é›†ç¾¤" class="headerlink" title="MySQL Cluster é›†ç¾¤"></a>MySQL Cluster é›†ç¾¤</h5><p>MySQL ä¸­çš„åŒæ­¥å¤åˆ¶é¦–å…ˆå‡ºç°åœ¨MySQL Clushter ï¼ˆNDB Clusterï¼‰ã€‚å®ƒåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šè¿›è¡ŒåŒæ­¥çš„ä¸»-ä¸»å¤åˆ¶ã€‚è¿™æ„å‘³ç€å¯ä»¥åœ¨ä»»ä½•èŠ‚ç‚¹ä¸Šå†™å…¥ï¼›è¿™äº›èŠ‚ç‚¹æ‹¥æœ‰ç­‰åŒçš„è¯»å†™èƒ½åŠ›ã€‚æ¯ä¸€è¡Œéƒ½æ˜¯å†—ä½™å­˜å‚¨çš„ï¼Œè¿™æ ·å³ä½¿ä¸¢å¤±ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿä¸ä¸¢å¤±æ•°æ®ï¼Œå¹¶ä¸”é›†ç¾¤ä»ç„¶èƒ½æä¾›æœåŠ¡ã€‚å°½ç®¡MySQL Clusterè¿˜ä¸æ˜¯é€‚ç”¨äºæ‰€æœ‰åº”ç”¨çš„å®Œç¾è§£å†³æ–¹æ¡ˆï¼Œä½†æ­£å¦‚æˆ‘ä»¬åœ¨å‰ä¸€ç« æåˆ°çš„ï¼Œåœ¨æœ€è¿‘çš„ç‰ˆæœ¬ä¸­å®ƒåšäº†éå¸¸å¿«é€Ÿçš„æ”¹è¿›ï¼Œç°åœ¨å·²ç»æ‹¥æœ‰å¤§é‡çš„æ–°ç‰¹æ€§å’ŒåŠŸèƒ½ï¼šéç´¢å¼•æ•°æ®çš„ç£ç›˜å­˜å‚¨ã€å¢åŠ æ•°æ®èŠ‚ç‚¹èƒ½å¤Ÿåœ¨çº¿æ‰©å±•ã€ä½¿ç”¨ndinfoè¡¨æ¥ç®¡ç†é›†ç¾¤ã€é…ç½®å’Œç®¡ç†é›†ç¾¤çš„è„šæœ¬ã€å¤šçº¿ç¨‹æ“ä½œã€ä¸‹æ¨ï¼ˆpush-downï¼‰çš„å…³è”æ“ä½œï¼ˆç°åœ¨ç§°ä¸ºè‡ªé€‚åº”æŸ¥è¯¢æœ¬åœ°åŒ–ï¼‰ã€èƒ½å¤Ÿå¤„ç†BLOBåˆ—å’Œå¾ˆå¤šåˆ—çš„è¡¨ã€é›†ä¸­å¼çš„ç”¨æˆ·ç®¡ç†ï¼Œä»¥åŠé€šè¿‡åƒmemcacheåè®®ä¸€æ ·çš„NDB APIæ¥å®ç°NoSQLè®¿é—®ã€‚åœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¸­å°†åŒ…å«æœ€ç»ˆä¸€è‡´è¿è¡Œæ¨¡å‹ï¼ŒåŒ…æ‹¬ä¸ºè·¨æ•°æ®ä¸­å¿ƒçš„ä¸»åŠ¨-ä¸»åŠ¨å¤åˆ¶æä¾›äº‹åŠ¡å†²çªæ£€æµ‹å’Œè·¨WANè§£å†³æ–¹æ¡ˆã€‚ç®€è€Œè¨€ä¹‹ï¼ŒMySQL Clusteræ˜¯ä¸€é¡¹å¼•äººæ³¨ç›®çš„æŠ€æœ¯ã€‚</p><p>ç°åœ¨è‡³å°‘æœ‰ä¸¤ä¸ªä¸ºç®€åŒ–é›†ç¾¤éƒ¨ç½²å’Œç®¡ç†æä¾›é™„åŠ äº§å“çš„ä¾›åº”å•†ï¼šOracle é’ˆå¯¹ MySQL Cluster çš„æœåŠ¡æ”¯æŒåŒ…å«äº† MySQL Cluster Manager å·¥å…·ï¼›Serveralines æä¾›äº†Cluster Controlå·¥å…·ï¼Œè¯¥å·¥å…·è¿˜èƒ½å¤Ÿå¸®åŠ©éƒ¨ç½²å’Œç®¡ç†å¤åˆ¶é›†ç¾¤ã€‚</p><h5 id="Galera-Cluster-é›†ç¾¤"><a href="#Galera-Cluster-é›†ç¾¤" class="headerlink" title="Galera Cluster é›†ç¾¤"></a>Galera Cluster é›†ç¾¤</h5><p>MariaDBä½œä¸ºMysqlçš„ä¸€ä¸ªåˆ†æ”¯ï¼Œåœ¨å¼€æºé¡¹ç›®ä¸­å·²ç»å¹¿æ³›ä½¿ç”¨ï¼Œä¾‹å¦‚å¤§çƒ­çš„openstackï¼Œæ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨æ€§ï¼ŒåŒæ—¶æé«˜ç³»ç»Ÿçš„è´Ÿè½½èƒ½åŠ›ï¼Œé›†ç¾¤éƒ¨ç½²æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p><p>MariaDB Galera Cluster ä»‹ç»</p><p>MariaDBé›†ç¾¤æ˜¯MariaDBåŒæ­¥å¤šä¸»æœºé›†ç¾¤ã€‚å®ƒä»…æ”¯æŒXtraDB/ InnoDBå­˜å‚¨å¼•æ“ï¼ˆè™½ç„¶æœ‰å¯¹MyISAMå®éªŒæ”¯æŒ - çœ‹wsrep_replicate_myisamç³»ç»Ÿå˜é‡ï¼‰ã€‚</p><p>ä¸»è¦åŠŸèƒ½:</p><ul><li>åŒæ­¥å¤åˆ¶</li><li>çœŸæ­£çš„multi-masterï¼Œå³æ‰€æœ‰èŠ‚ç‚¹å¯ä»¥åŒæ—¶è¯»å†™æ•°æ®åº“</li><li>è‡ªåŠ¨çš„èŠ‚ç‚¹æˆå‘˜æ§åˆ¶ï¼Œå¤±æ•ˆèŠ‚ç‚¹è‡ªåŠ¨è¢«æ¸…é™¤</li><li>æ–°èŠ‚ç‚¹åŠ å…¥æ•°æ®è‡ªåŠ¨å¤åˆ¶</li><li>çœŸæ­£çš„å¹¶è¡Œå¤åˆ¶ï¼Œè¡Œçº§</li><li>ç”¨æˆ·å¯ä»¥ç›´æ¥è¿æ¥é›†ç¾¤ï¼Œä½¿ç”¨æ„Ÿå—ä¸Šä¸MySQLå®Œå…¨ä¸€è‡´</li></ul><p>ä¼˜åŠ¿:</p><ul><li>å› ä¸ºæ˜¯å¤šä¸»ï¼Œæ‰€ä»¥ä¸å­˜åœ¨Slavelag(å»¶è¿Ÿ)</li><li>ä¸å­˜åœ¨ä¸¢å¤±äº‹åŠ¡çš„æƒ…å†µ</li><li>åŒæ—¶å…·æœ‰è¯»å’Œå†™çš„æ‰©å±•èƒ½åŠ›</li><li>æ›´å°çš„å®¢æˆ·ç«¯å»¶è¿Ÿ</li><li>èŠ‚ç‚¹é—´æ•°æ®æ˜¯åŒæ­¥çš„,è€ŒMaster/Slaveæ¨¡å¼æ˜¯å¼‚æ­¥çš„,ä¸åŒslaveä¸Šçš„binlogå¯èƒ½æ˜¯ä¸åŒçš„</li></ul><p>æŠ€æœ¯:</p><p>Galeraé›†ç¾¤çš„å¤åˆ¶åŠŸèƒ½åŸºäºGaleralibraryå®ç°,ä¸ºäº†è®©MySQLä¸Galera libraryé€šè®¯ï¼Œç‰¹åˆ«é’ˆå¯¹MySQLå¼€å‘äº†wsrep APIã€‚</p><p>Galeraæ’ä»¶ä¿è¯é›†ç¾¤åŒæ­¥æ•°æ®ï¼Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ï¼Œé çš„å°±æ˜¯å¯è®¤è¯çš„å¤åˆ¶ï¼Œå·¥ä½œåŸç†å¦‚ä¸‹å›¾ï¼š</p><p>![](pic/14-Galera Cluster.png)</p><p>å½“å®¢æˆ·ç«¯å‘å‡ºä¸€ä¸ªcommitçš„æŒ‡ä»¤ï¼Œåœ¨äº‹åŠ¡è¢«æäº¤ä¹‹å‰ï¼Œæ‰€æœ‰å¯¹æ•°æ®åº“çš„æ›´æ”¹éƒ½ä¼šè¢«write-setæ”¶é›†èµ·æ¥,å¹¶ä¸”å°† write-set çºªå½•çš„å†…å®¹å‘é€ç»™å…¶ä»–èŠ‚ç‚¹ã€‚</p><p>write-set å°†åœ¨æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œè®¤è¯æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå†³å®šç€èŠ‚ç‚¹æ˜¯å¦åº”ç”¨write-setæ›´æ”¹æ•°æ®ã€‚</p><p>å¦‚æœè®¤è¯æµ‹è¯•å¤±è´¥ï¼ŒèŠ‚ç‚¹å°†ä¸¢å¼ƒ write-set ï¼›å¦‚æœè®¤è¯æµ‹è¯•æˆåŠŸï¼Œåˆ™äº‹åŠ¡æäº¤ã€‚</p><blockquote><p>è½¯ä»¶çš„è·å–</p></blockquote><p><a href="http://classroom.example.com/materials/mariadb-10.2.repo" target="_blank" rel="noopener">http://classroom.example.com/materials/mariadb-10.2.repo</a></p><p><a href="http://classroom.example.com/materials/thirdpart.repo" target="_blank" rel="noopener">http://classroom.example.com/materials/thirdpart.repo</a></p><blockquote><p>é›†ç¾¤é…ç½®è¦æ±‚</p></blockquote><ol><li>å®‰è£…4ä¸ªèŠ‚ç‚¹</li><li>å…³é—­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹åé‡èµ·æœåŠ¡ï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œ</li><li>å…³é—­ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œå»æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼Œåœ¨é›†ç¾¤ä¸­ä½œæ’å…¥åŠ¨ä½œï¼Œé‡èµ·æœåŠ¡ï¼Œçœ‹æ˜¯å¦èƒ½å¤ŸåŒæ­¥åˆ°æ•°æ®ã€‚</li></ol><blockquote><p>è¯¦ç»†æ­¥éª¤</p></blockquote><blockquote><blockquote><p>1.å®‰è£…è½¯ä»¶åŒ…</p></blockquote></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">galera   25.3.15</span><br><span class="line">jemalloc*                               </span><br><span class="line">MariaDB-client  10.2         </span><br><span class="line">MariaDB-server  10.2     </span><br><span class="line">MariaDB-compat  10.2</span><br></pre></td></tr></table></figure><p>éœ€è¦å…ˆå¸è½½mariadb-libs</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> rpm -e mariadb-libs --nodeps</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rpm -e mariadb-common --nodeps</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install -y galera jemalloc* MariaDB-client  MariaDB-server MariaDB-compat</span></span><br></pre></td></tr></table></figure><blockquote><blockquote><p>2.åˆå§‹åŒ–MariaDBæ•°æ®åº“å¹¶å¯åŠ¨MariaDBæœåŠ¡ï¼Œå¹¶ä½œå®‰å…¨åŠ å›º</p></blockquote></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> systemctl start mysql</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql_secure_installation</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl stop mysql</span></span><br></pre></td></tr></table></figure><blockquote><blockquote><p>3.é…ç½®</p></blockquote></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf.d/galera.cnf</span><br><span class="line"></span><br><span class="line">[galera]</span><br><span class="line"><span class="meta">#</span><span class="bash"> Mandatory settings</span></span><br><span class="line">wsrep_on=ON</span><br><span class="line">wsrep_provider=/usr/lib64/galera/libgalera_smm.so</span><br><span class="line"><span class="meta">#</span><span class="bash">å¯åŠ¨èŠ‚ç‚¹æ—¶éœ€è¦æŒ‡å®šgalera clusterçš„åœ°å€,ä½œä¸ºclusterä¸­ç¬¬ä¸€ä¸ªå¯åŠ¨çš„èŠ‚ç‚¹,wsrep_cluster_address=gcomm://,å¯¹äºåç»­å¯åŠ¨çš„èŠ‚ç‚¹,wsrep_cluster_address=gcomm://node1,node2,node3</span></span><br><span class="line">wsrep_cluster_address='gcomm://'</span><br><span class="line"><span class="meta">#</span><span class="bash">æ‰€æœ‰nodeå¿…é¡»ä¸€æ ·</span></span><br><span class="line">wsrep_cluster_name='galera'</span><br><span class="line"><span class="meta">#</span><span class="bash">èŠ‚ç‚¹åœ°å€</span></span><br><span class="line">wsrep_node_address='172.25.0.11'</span><br><span class="line"><span class="meta">#</span><span class="bash">èŠ‚ç‚¹åç§°</span></span><br><span class="line">wsrep_node_name='galera1'</span><br><span class="line"><span class="meta">#</span><span class="bash">Snapshot State Transterå¿«ç…§çŠ¶æ€è½¬ç§»æ–¹æ³•:mysqldump/rsync,é»˜è®¤mysqldump</span></span><br><span class="line">wsrep_sst_method=rsync</span><br><span class="line"><span class="meta">#</span><span class="bash">binlogçš„æ ¼å¼ä¹Ÿæœ‰ä¸‰ç§ï¼šSTATEMENTï¼ŒROWï¼ŒMIXED</span></span><br><span class="line">binlog_format=row</span><br><span class="line">default_storage_engine=InnoDB</span><br><span class="line"><span class="meta">#</span><span class="bash">è°ƒæ•´é”ç­–ç•¥çš„</span></span><br><span class="line">innodb_autoinc_lock_mode=2</span><br><span class="line">bind-address=0.0.0.0</span><br></pre></td></tr></table></figure><p>4.å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹ç›®å‰mysqlçš„ç«¯å£</span></span><br><span class="line">netstat -ntpl|grep sql</span><br><span class="line">tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      12877/mysqld        </span><br><span class="line">tcp        0      0 0.0.0.0:4567            0.0.0.0:*               LISTEN      12877/mysqld</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>5.å…¶ä»–èŠ‚ç‚¹ä¸Šåšç›¸åŒé…ç½®</p></blockquote></blockquote><p>ä¾æ¬¡å¯åŠ¨å…¶ä»–èŠ‚ç‚¹,å…¶ä»–èŠ‚ç‚¹ä¼šæ ¹æ®é…ç½®è‡ªåŠ¨åŠ å…¥é›†ç¾¤å¹¶åŒæ­¥æ•°æ®ï¼Œä¸€å®šè¦å…³é—­selinuxï¼Œæˆ–è€…è®¾ä¸º0</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[galera]</span><br><span class="line"><span class="meta">#</span><span class="bash"> Mandatory settings</span></span><br><span class="line">wsrep_on=ON</span><br><span class="line">wsrep_provider=/usr/lib64/galera/libgalera_smm.so</span><br><span class="line">wsrep_cluster_address='gcomm://172.25.0.11'</span><br><span class="line">wsrep_cluster_name='galera'</span><br><span class="line">wsrep_node_address='172.25.0.12'</span><br><span class="line">wsrep_node_name='&lt;æ³¨æ„è¿™é‡Œä¸è§£æçš„ä¸»æœºåç›¸åŒ&gt;'</span><br><span class="line">wsrep_sst_method=rsync</span><br><span class="line"></span><br><span class="line">binlog_format=row</span><br><span class="line">default_storage_engine=InnoDB</span><br><span class="line">innodb_autoinc_lock_mode=2</span><br><span class="line">bind-address=0.0.0.0</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>6.è§‚å¯Ÿæ—¥å¿—</p></blockquote></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mastera0 ~]# tail -f /var/log/mysqld.log</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>7.åœ¨galeraä¸ŠæŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p></blockquote></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show global status like 'wsrep_cluster%';</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line">| Variable_name            | Value                                |</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line">| wsrep_cluster_conf_id    | 14                                   |</span><br><span class="line">| wsrep_cluster_size       | 2                                    |</span><br><span class="line">| wsrep_cluster_state_uuid | ff8cb12b-168a-11e6-ba3c-b36f59743764 |</span><br><span class="line">| wsrep_cluster_status     | Primary                              |</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show global status like 'wsrep_cluster%';</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line">| Variable_name            | Value                                |</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line">| wsrep_cluster_conf_id    | 15                                   |</span><br><span class="line">| wsrep_cluster_size       | 3                                    |</span><br><span class="line">| wsrep_cluster_state_uuid | ff8cb12b-168a-11e6-ba3c-b36f59743764 |</span><br><span class="line">| wsrep_cluster_status     | Primary                              |</span><br><span class="line">+--------------------------+--------------------------------------+</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>8.æµ‹è¯•</p></blockquote></blockquote><p>1.åœ¨ä¸€èŠ‚ç‚¹ä¸Šæ–°å»ºè¡¨å¹¶æ’å…¥æ•°æ®ä»¥åœ¨å…¶ä»–å®ä¾‹ä¸Šè§‚æµ‹æ•°æ®æ˜¯å¦åŒæ­¥</p><p>2.æµ‹è¯•èŠ‚ç‚¹æ•…éšœæœºæ¢å¤A.masterb slavea B.masteraåœæ‰ä¹‹åï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ‰èƒ½é‡æ–°åŠ å…¥ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å…³æ³¨å‡ ä¸ªå…³é”®çš„å‚æ•°:</p><ul><li><code>wsrep_connected = on</code> é“¾æ¥å·²å¼€å¯</li><li><code>wsrep_local_index = 1</code> åœ¨é›†ç¾¤ä¸­çš„ç´¢å¼•å€¼</li><li><code>wsrep_cluster_size =3</code>é›†ç¾¤ä¸­èŠ‚ç‚¹çš„æ•°é‡</li><li><code>wsrep_incoming_addresses = 172.25.0.11:3306,172.25.0.12:3306,172.25.0.13:3306</code></li></ul><p>é›†ç¾¤ä¸­èŠ‚ç‚¹çš„è®¿é—®åœ°å€</p><h3 id="æ•…éšœè½¬ç§»å’Œæ•…éšœæ¢å¤"><a href="#æ•…éšœè½¬ç§»å’Œæ•…éšœæ¢å¤" class="headerlink" title="æ•…éšœè½¬ç§»å’Œæ•…éšœæ¢å¤"></a>æ•…éšœè½¬ç§»å’Œæ•…éšœæ¢å¤</h3><p>æˆ‘ä»¬å›å¿†ä¸€ä¸‹ï¼Œä¸€å¼€å§‹æˆ‘ä»¬åªæœ‰ä¸€å°æ•°æ®åº“æœåŠ¡å™¨ï¼Œrhel7çš„æ“ä½œç³»ç»Ÿï¼Œmaraidb-server5.5ç‰ˆæœ¬ã€‚</p><ul><li>1.1ï¼šç”¨æˆ·å°‘ï¼Œæ•°æ®é‡ä¹Ÿä¸å¤šï¼Œæ¯å¤©ç”¨taræ‰“åŒ…å‹ç¼©å¥½ï¼Œæ‹·è´å‡ºæ¥ï¼Œè¿™ç§æ–¹æ³•æ¯æ¬¡éƒ½è¦åœæ‰æœåŠ¡ï¼›  </li><li>1.2ï¼štaræ‰“åŒ…å¤ªæ…¢äº†ï¼Œæ•°æ®å†å¢é•¿ä¼šæ›´æ…¢ï¼›ç”¨LVM å¿«ç…§æ–¹å¼ï¼Œå¤‡ä»½çš„æ—¶å€™è¦åŠ è¯»é”flush tables with read lockï¼›ç¬é—´å®Œæˆåè§£é”unlock tables;å†æŒ‚åœ¨æ‹·è´å‡ºæ¥ï¼›è¿˜åŸçš„æ—¶å€™æ•°æ®å¤§å°å†³å®šè¿˜åŸæ—¶é—´é•¿çŸ­</li><li>1.3ï¼šå¸Œæœ›å¤‡ä»½è¿‡ç¨‹ä¸­ä¿æŒæ•°æ®ä¸€è‡´æ€§å’ŒæœåŠ¡å¯ç”¨æ€§ï¼›æ”¹ç”¨mysqldumpï¼Œç»“åˆäºŒè¿›åˆ¶æ—¥å¿—ã€‚æ¯å¤©æ—©ä¸Š8ç‚¹åšå…¨å¤‡ä»½ï¼›æ¢å¤çš„æ—¶å€™ï¼Œå…ˆå¯¼å…¥å…¨å¤‡ä»½ï¼Œç„¶åæ ¹æ®binlogåšé‡æ¼”</li><li>1.4ï¼šç”¨æˆ·æ•°é‡è¶Šæ¥è¶Šå¤šï¼Œæ•°æ®åº“ä»åŸæ¥å‡ ä¸ªGåˆ°ç°åœ¨å·²ç»å˜æˆ20ä¸ªGäº†ï¼Œç”¨mysqldumpå‘½ä»¤å¤ªæ…¢äº†ï¼Œäºæ˜¯æ”¹ç”¨percona xtrabackupå·¥å…·ã€‚å¹¶ä¸”åˆ¶å®šäº†ä¸€ä¸ªå¤‡ä»½è®¡åˆ’ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å‘¨ä¸€8ï¼š00 å…¨å¤‡ä»½ï¼›</span><br><span class="line">å‘¨äºŒ8ï¼š00 å¢é‡å¤‡ä»½ï¼›</span><br><span class="line">å‘¨ä¸‰8ï¼š00 å¢é‡å¤‡ä»½ï¼›</span><br><span class="line">å‘¨å››8ï¼š00 å¢é‡å¤‡ä»½ï¼›</span><br><span class="line">å‘¨äº”8ï¼š00 å¢é‡å¤‡ä»½ï¼›</span><br><span class="line">å‘¨å…­8ï¼š00 å¢é‡å¤‡ä»½ï¼›</span><br><span class="line">å‘¨æ—¥8ï¼š00 å¢é‡å¤‡ä»½ï¼›</span><br><span class="line">æ¢å¤çš„æ—¶å€™ï¼Œä¹Ÿå¾ˆæ–¹ä¾¿ã€‚</span><br></pre></td></tr></table></figure><ul><li>2.1ï¼šæœåŠ¡å™¨å®•æœºäº†ï¼Œå¸Œæœ›ç¬é—´åˆ‡æ¢åˆ°å¦ä¸€å°ï¼Œäºæ˜¯æ·»åŠ ä¸€å°æœåŠ¡å™¨slaveaï¼Œåšä¸»ä»åŒæ­¥ã€‚</li><li>2.2ï¼šé˜²æ­¢ä»æœºå•ç‚¹æ•…éšœï¼Œå¢åŠ ä¸€å°slaveb</li><li>2.3ï¼šå¦‚æœ master æ˜¯å•ç‚¹æ•…éšœ,å¦‚ä½•è§£å†³ï¼Ÿå¤šçº§ä¸»ä» multi-sourceï¼Œä¸¤ä¸ªä¸»æœåŠ¡å™¨ï¼Œä¸¤ä¸ªä»æœåŠ¡å™¨ï¼Œä½œmulti-source,å¦‚æœä¸€å°ä¸»æœåŠ¡å™¨å®•æ‰äº†ï¼Œé‚£ä¹ˆä»æœåŠ¡å™¨ä¼šè‡ªåŠ¨å»æ‰¾ç¬¬äºŒå°ä¸»æœåŠ¡å™¨ã€‚</li></ul><h4 id="é—®é¢˜çš„æå‡º"><a href="#é—®é¢˜çš„æå‡º" class="headerlink" title="é—®é¢˜çš„æå‡º"></a>é—®é¢˜çš„æå‡º</h4><p><strong>ä¸¤å°masteræ˜¯å¦éƒ½èƒ½è¿å‘¢ï¼Ÿ</strong></p><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å‰é¢çš„å®¢æˆ·ç«¯è¦æ¥è¿æ¥æ•°æ®åº“ï¼Œæ˜¯è¿æ¥M1ï¼Œè¿˜æ˜¯M2å‘¢?å¦‚æœåŒæ—¶å¯¹M1å’ŒM2æ‰§è¡Œè¯»å†™æ“ä½œï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ˜¯å¦ä¼šå‡ºé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æ¥åšä¸ªå°æ¸¸æˆï¼æ‰¾ä¸€ä¸ªå­¦ç”ŸTomè¿æ¥M1ï¼Œå¦ä¸€ä¸ªå­¦ç”ŸJackè¿æ¥äº†M2ï¼Œç°åœ¨ï¼Œä»–ä»¬åŒæ—¶å¯¹æ•°æ®åº“è¿›è¡Œå†™æ“ä½œï¼Œä¿®æ”¹db1.t1ä¸­çš„id=4çš„è¡Œï¼Œæ”¹ä¸º99ï¼Œç„¶åæŸ¥çœ‹ä¸€ä¸‹t1è¡¨çš„ç»“æœã€‚</p><p>ä»ç»“æœçœ‹ï¼ŒåŒæ—¶å¤šä¸ªç”¨æˆ·å¯¹åŒä¸€å¼ è¡¨çš„åŒä¸€ä¸ªæ•°æ®è¿›è¡Œå†™æ“ä½œï¼Œä¼šæœ‰å†²çªçš„ã€‚æ‰€ä»¥å†™æ“ä½œæ¯æ¬¡åªç»™ä¸€å°æœåŠ¡æœ€å¥½ï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·ä¸å¤šï¼Œæ•°æ®ä¸å¤šï¼Œé—®é¢˜ä¹Ÿä¸å¤§ã€‚</p><p><strong>å½“å‰çš„å›°å¢ƒ</strong></p><p>å‰ç«¯çš„åº”ç”¨ç¨‹åºæ— æ³•ä½¿ç”¨å¤šå°æ•°æ®åº“ï¼Œå‰ç«¯åªèƒ½æŒ‡å®šä¸€å°æ•°æ®åº“çš„ipåœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ è®©å‰ç«¯åº”ç”¨è¿æ¥M1ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è¯»å†™æ“ä½œéƒ½æ˜¯é€šè¿‡M1ï¼Œé‚£ä¹ˆå…¶ä»–æ•°æ®åº“é™¤äº†çƒ­å¤‡çš„ä½œç”¨ä»¥å¤–å°±æ²¡æœ‰äº†ã€‚è¿™æ ·å¾ˆæµªè´¹æ€§èƒ½ï¼Œè€Œä¸”å½“æˆ‘ä»¬å‰ç«¯çš„è¯·æ±‚è¶Šæ¥è¶Šå¤šï¼Œä¸€å°æ•°æ®åº“æœåŠ¡å™¨ä¼šéå¸¸çš„åƒåŠ›ï¼Œæ—¢è¦å“åº”è¯»è¯·æ±‚ï¼Œè¿˜è¦å“åº”å†™è¯·æ±‚ï¼Œä»–çš„å‹åŠ›ä¼šéå¸¸çš„å¤§ã€‚å¦‚æœM1å®•æœºäº†ï¼Œè¿˜è¦æ‰‹åŠ¨åˆ‡æ¢åˆ°M2ï¼Œè¿™æ ·çš„æ•ˆæœå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæˆ‘ä»¬è‚¯å®šå¸Œæœ›ä»–èƒ½ç¬é—´åˆ‡æ¢ã€‚</p><p>å¦å¤–ï¼Œè®©å‰ç«¯åº”ç”¨è¿æ¥slaveå°±æ›´ä¸è¡Œäº†ï¼Œå¦‚æœåœ¨ä»æœºä¸Šè§¦å‘å†™æ“ä½œï¼Œé‚£ä¹ˆä¸»ä»åŒæ­¥å°†ä¼šè¢«æ–­å¼€ï¼Œå› ä¸ºä»æœºçš„æ•°æ®ä¸€å®šè¦å’Œä¸»æœºä¸€æ¨¡ä¸€æ ·ï¼Œä¸ç„¶å°±ä¼šæœ‰å†²çªäº†ã€‚</p><p>æ‰€ä»¥æ€»ç»“ä¸€ä¸‹ï¼Œç°åœ¨æˆ‘ä»¬é‡åˆ°çš„å›°å¢ƒï¼š</p><ol><li>æœ‰å¤šå°æ•°æ®åº“æœåŠ¡å™¨ï¼Œä½†æ˜¯åªèƒ½ä½¿ç”¨ä¸€å°ï¼Œä¸èƒ½ä½œè´Ÿè½½å‡è¡¡ï¼ˆå°†å‰ç«¯ç”¨æˆ·çš„è¯·æ±‚å‡è¡¡åœ°åˆ†é…ç»™åç«¯çš„æœåŠ¡å™¨ï¼‰</li><li>å¦‚æœä¸€å°ä¸»æœåŠ¡å™¨åäº†ï¼Œé‚£ä¹ˆéœ€è¦æ‰‹åŠ¨åˆ‡æ¢ï¼Œä¸èƒ½åšåˆ°ç¬é—´è‡ªåŠ¨åˆ‡æ¢</li><li>ä¸¤å°slaveåªä½œä¸ºå¤‡ä»½ä½¿ç”¨ï¼Œæµªè´¹æ€§èƒ½ï¼Œè™½ç„¶ä¸èƒ½ç”¨æ¥å†™ï¼Œä½†æ˜¯å¯ä»¥ç”¨æ¥è¯»å–æ•°æ®</li></ol><p>ä»ä¸Šé¢çš„æ€»ç»“æ¥çœ‹ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨è¿™ä¸ªæ¶æ„ä¸‹ï¼Œèƒ½å¤Ÿå®ç°æ›´å¤šçš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š</p><ol><li>è´Ÿè½½å‡è¡¡    å°±æ˜¯è¯´èƒ½å¤Ÿå‡è¡¡åœ°åˆ†é…å‰ç«¯çš„ç”¨æˆ·è¯·æ±‚<br> . è¯»å†™åˆ†ç¦»    ä¸¤å°masterç”¨æ¥å†™ï¼Œä¸¤å°slaveç”¨æ¥è¯»ï¼Œæå‡æ•´ä½“æ€§èƒ½</li></ol><h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p><strong>å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</strong></p><ul><li>ç¬¬ä¸€ç§æ–¹æ¡ˆâ€”â€”åœ¨åº”ç”¨ä¸­å¤„ç†æ•…éšœè½¬ç§»ï¼Œæ‰¾å¼€å‘äººå‘˜ä½œäºŒæ¬¡å¼€å‘ï¼Œå°†å‰ç«¯åº”ç”¨ä»£ç ä¿®æ”¹ï¼Œè®©ä»–èƒ½å¤Ÿå®ç°ä¸Šé¢çš„åŠŸèƒ½ï¼›</li><li>ç¬¬äºŒç§æ–¹æ¡ˆâ€”â€”ä¸­é—´ä»¶è§£å†³æ–¹æ¡ˆï¼Œåœ¨å‰ç«¯åº”ç”¨å’Œåå°æ•°æ®åº“ä¹‹é—´æ·»åŠ ä¸€å°ä»£ç†æœåŠ¡å™¨ã€‚é€šè¿‡æ•°æ®åº“çš„mysqlåè®®å»è½¬å‘sqlè¯­å¥ã€‚å¦‚æœåé¢æ•°æ®åº“æ˜¯oracleæ•°æ®åº“ï¼Œé‚£ä¹ˆè¿™ä¸ªåå‘ä»£ç†æœåŠ¡å™¨å°±åº”è¯¥èƒ½å¤Ÿæ”¯æŒoracleçš„åè®®ï¼Œç›‘å¬oracleçš„ç«¯å£ï¼Œèƒ½è·Ÿoracleè¿›è¡Œé€šä¿¡ã€‚</li></ul><p>æˆ‘ä»¬æ¥è®²ç¬¬äºŒç§æ–¹æ³•ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯æ•°æ®åº“ä»£ç†æœåŠ¡å™¨"><a href="#ä»€ä¹ˆæ˜¯æ•°æ®åº“ä»£ç†æœåŠ¡å™¨" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°æ®åº“ä»£ç†æœåŠ¡å™¨"></a>ä»€ä¹ˆæ˜¯æ•°æ®åº“ä»£ç†æœåŠ¡å™¨</h4><p> å¦‚æœä¸€ä¸ªæœåŠ¡å™¨èƒ½å¤Ÿæ”¯æŒæ•°æ®åº“çš„åè®®ï¼Œå¹¶ä¸”èƒ½å¤Ÿè½¬å‘sqlè¯­å¥ï¼Œæˆ‘ä»¬å°±æŠŠä»–ç§°ä¹‹ä¸ºæ•°æ®åº“ä»£ç†æœåŠ¡å™¨ã€‚</p><blockquote><p>è´Ÿè½½å‡è¡¡</p></blockquote><p>æ•°æ®åº“ä»£ç†å’ŒwebæœåŠ¡å™¨çš„ä»£ç†éƒ½éœ€è¦å…·å¤‡ä¸€äº›åŸºæœ¬ä»£ç†æœåŠ¡å™¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼Œè´Ÿè½½å‡è¡¡ï¼Œè‡³å°‘è¦èƒ½å®ç°è´Ÿè½½å‡è¡¡ï¼Œæˆ‘ä»¬åç«¯æœ‰å¤šå°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä»£ç†æœåŠ¡å™¨èƒ½å¤Ÿå°†å‰ç«¯ç”¨æˆ·çš„è¯·æ±‚ä»¥ç›¸å¯¹å‡è¡¡çš„æ–¹å¼åˆ†æ‹…åˆ°åç«¯å¤šå°æœåŠ¡å™¨ä¸Šé¢ã€‚</p><blockquote><p>è¯»å†™åˆ†ç¦»</p></blockquote><p>å¦‚æœæˆ‘ä»¬åç«¯çš„æ•°æ®åº“ä¸å­˜åœ¨ä¸»å’Œä»çš„å…³ç³»ï¼Œå¤§å®¶éƒ½æ˜¯masterï¼Œä»»ä½•ä¸€æ¡è¯­å¥éƒ½èƒ½å†™ï¼Œé‚£ä¹ˆå‘ç»™è°éƒ½æ²¡æœ‰å¤ªå¤§å…³ç³»ï¼›ä½†æ˜¯å¦‚æœåé¢æ˜¯masterå’Œslaveçš„å…³ç³»ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´ä»æœºæ˜¯ä¸èƒ½è¿›è¡Œå†™æ“ä½œçš„ï¼Œæ‰€ä»¥åœ¨è´Ÿè½½å‡è¡¡ï¼Œåˆ†å‘sqlçš„è¿‡ç¨‹å½“ä¸­ï¼Œä½ çš„ä»£ç†æœåŠ¡å™¨è¦èƒ½å¤Ÿè¯†åˆ«è¯»å’Œå†™ï¼Œç„¶åæŠŠè¯»æ“ä½œéƒ½åˆ†å‘ç»™slaveï¼Œå†™åˆ†å‘ç»™masterï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªåŠŸèƒ½å«åšè¯»å†™åˆ†ç¦»ã€‚</p><p>è´Ÿè½½å‡è¡¡å’Œè¯»å†™åˆ†ç¦»æ˜¯æ•°æ®åº“ä»£ç†æœåŠ¡å™¨å½“ä¸­æœ€åŸºæœ¬çš„ä¸¤ä¸ªåŠŸèƒ½ã€‚ä½ ç”¨ä»»ä½•ä¸€ä¸ªæ•°æ®åº“ä»£ç†æœåŠ¡å™¨ï¼Œéƒ½éœ€è¦è¿™ä¸¤ä¸ªåŠŸèƒ½ã€‚å¦‚æœä¸å…·å¤‡è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼Œé‚£åŸºæœ¬ä¸Šæ²¡äººç”¨ã€‚</p><p>ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œä»–å­˜åœ¨äºæˆ‘ä»¬å®¢æˆ·ç«¯å’Œæ•°æ®åº“æœåŠ¡å™¨ä¹‹é—´ï¼Œåç«¯çš„æ•°æ®åº“æœåŠ¡å™¨ä¸éœ€è¦çŸ¥é“å®¢æˆ·ç«¯çš„ipåœ°å€ï¼Œä»–åªè¦çŸ¥é“è°æ¥æ‰¾æˆ‘çš„ï¼Œè°å‘è¯·æ±‚ç»™æˆ‘çš„ï¼Œå¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œä»–ä¸éœ€è¦çŸ¥é“æ•°æ®åº“æœåŠ¡å™¨çš„åœ°å€ï¼Œä»–åªè¦çŸ¥é“ä»£ç†å°±è¡Œäº†ï¼Œåé¢æ€ä¹ˆæ‰§è¡Œä»–ä¸ç®¡ã€‚ä¹Ÿå°±æ˜¯è¯´ç°åœ¨å®¢æˆ·ç«¯ä¸å†ç›´æ¥ä¸æ•°æ®åº“æœåŠ¡å™¨é€šä¿¡äº†ï¼Œè€Œæ˜¯é€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œé€šè®¯ï¼Œä»£ç†æœåŠ¡å™¨å®ç°è´Ÿè½½å‡è¡¡ï¼Œå®ç°è¯»å†™åˆ†ç¦»ã€‚</p><blockquote><p>åˆ†åº“ã€åˆ†è¡¨ã€åˆ†ç‰‡</p></blockquote><p>è¿›é˜¶çº§çš„è¿˜ä¼šæœ‰å…¶ä»–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ä¸€äº›ä¼˜ç§€çš„ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥å®ç°åˆ†åº“ã€åˆ†è¡¨ã€åˆ†ç‰‡ï¼›sqlè·¯ç”±å¹¶å‘æŸ¥è¯¢ï¼›sqlè¿‡æ»¤</p><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><p>4ä¸ªåº“db1 db2 db3 db4ï¼Œåé¢4å°æ•°æ®åº“åšä¸»ä»åŒæ­¥ï¼Œä»–ä»¬çš„æ•°æ®éƒ½æ˜¯ç›¸åŒçš„ï¼Œç°åœ¨ç”¨æˆ·å‘èµ·è¯·æ±‚è¦è®¿é—®db1ï¼Œdb1ä¸Šæœ‰5å¼ è¡¨ï¼Œç»è¿‡è½®è¯¢ï¼Œä»£ç†æœåŠ¡å™¨å°†è¯·æ±‚åˆ†å‘ç»™äº†M1ï¼›å¦‚æœç”¨æˆ·å†æ¬¡è®¿é—®db1ï¼Œé‚£ä¹ˆä»£ç†æœåŠ¡å™¨è¿˜ä¼šå°†è¯·æ±‚å‘ç»™M1ï¼ŒM1ä¸Šåˆšåˆšè¯»è¿‡ä¸€ä¸ªdb1çš„æ–‡ä»¶ï¼Œä¼šäº§ç”Ÿç¼“å­˜ï¼Œæ‰€ä»¥å†è¯»ä¸€æ¬¡çš„æ—¶å€™é€Ÿåº¦å°±å¾ˆå¿«äº†ï¼›å¦‚æœè½®è¯¢æ²¡æœ‰ç»™åˆ°M1ï¼Œè€Œæ˜¯ç»™äº†S1ï¼Œé‚£ä¹ˆS1å°±è¦å†è¯»ä¸€æ¬¡db1çš„æ–‡ä»¶ï¼Œäº§ç”Ÿdb1çš„ç¼“å­˜ï¼›å¦‚æœç”¨æˆ·å†è®¿é—®ï¼Œå¯èƒ½è¿™æ¬¡åˆ†å‘ç»™äº†S2ï¼Œé‚£ä¹ˆS2ä¹Ÿè¦å†è¯»ä¸€æ¬¡db1çš„æ–‡ä»¶ï¼Œå¹¶äº§ç”Ÿdb1çš„ç¼“å­˜ã€‚æœ€ç»ˆçš„ç»“æœå°±æ˜¯å››å°æœºå™¨å°†ç›¸åŒçš„æ•°æ®éƒ½ç¼“å†²äº†ï¼Œæœ€ç»ˆå¯¼è‡´çš„é—®é¢˜å°±æ˜¯æˆ‘ä»¬çš„å†…å­˜ä¼šæœ‰æ‰€æµªè´¹ï¼Œå› ä¸ºå†…å­˜é‡Œé¢ç¼“å†²çš„æ˜¯ä¸€æ ·çš„æ•°æ®ã€‚è€Œæˆ‘ä»¬åç«¯æœ‰4ä¸ªåº“ï¼Œä¸å•å•æ˜¯db1ï¼Œè¿˜æœ‰db2ï¼Œ3ï¼Œ4ï¼Œç”¨æˆ·åœ¨è´Ÿè½½å‡è¡¡çš„è¿‡ç¨‹ä¸­ï¼Œæœ€ç»ˆå¯¼è‡´çš„ç»“æœæ˜¯å››å°æœåŠ¡å™¨å…¨éƒ¨æŠŠå››ä¸ªåº“çš„æ‰€æœ‰çš„è¡¨éƒ½å°è¯•åšç¼“å†²ï¼Œè¿™å››å°æœåŠ¡å™¨ä¸­æœ‰å¤§é‡çš„æ•°æ®æ˜¯é‡å¤çš„ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™æ˜¯ä¸€ç§éå¸¸å¤§çš„æµªè´¹ï¼Œæˆ‘ä»¬æƒ³å‡å°‘è¿™äº›æ€§èƒ½æ¶ˆè€—ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>åœ¨ç¬¬ä¸€å°æ•°æ®åªç¼“å†²db1ï¼Œç¬¬äºŒå°db2ï¼Œç¬¬ä¸‰å°db3ï¼Œç¬¬å››å°db4ï¼Œç”¨æˆ·è®¿é—®å“ªä¸ªåº“å°±åˆ†ç»™å“ªå°æœåŠ¡å™¨ï¼Œè¿™æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„æ–¹æ³•ã€‚è¿™æ ·çš„è¯ï¼Œèƒ½å¤Ÿä¿è¯ç”¨æˆ·å‘å‡ºè¯·æ±‚åèƒ½å¤Ÿè¾ƒå¿«åœ°è¿”å›ç»“æœï¼ŒæœåŠ¡å™¨çš„å†…å­˜ç¼“å†²å¾—åˆ°å……åˆ†çš„åˆ©ç”¨ã€‚ä¸å•å•æé«˜äº†æ€§èƒ½ï¼Œè¿˜èŠ‚çº¦äº†å†…å­˜ï¼Œé¿å…äº†æ•°æ®çš„é‡å¤ã€‚</p><p>ç›¸åŒçš„ç†å¿µï¼Œåˆšåˆšä¸¾çš„æ˜¯åº“çš„ä¾‹å­ï¼ŒåŒæ ·è¡¨ä¹ŸåŒæ ·é€‚ç”¨ï¼Œä¸åŒçš„æœåŠ¡å™¨ç¼“å†²ä¸åŒçš„è¡¨ã€‚</p><p>è¿™æ˜¯æˆ‘ä»¬å°†çš„åˆ†åº“ã€åˆ†è¡¨çš„åŠŸèƒ½ï¼Œè¿˜æœ‰ä¸€ä¸ªåˆ†ç‰‡ï¼ŒæŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä¸¾ä¾‹è¯´æ˜ï¼šåªæœ‰t1ä¸€å¼ è¡¨ï¼Œå‘ç»™è°å‘¢ï¼Ÿå››å°æœºå™¨è½®è¯¢åœ°å‘ï¼Œé‚£ä¹ˆt1è¡¨çš„å†…å®¹è¢«å››å°æœºå™¨å…¨éƒ¨ç¼“å†²ä¸‹æ¥ï¼Œåˆä¼šæµªè´¹å†…å­˜ã€‚è€Œä¸”æœºå™¨æ•°é‡è¶Šå¤šï¼Œæ€§èƒ½æµªè´¹è¶Šå¤§ã€‚é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>å¯ä»¥è¿™ä¹ˆåšï¼š</p><table><thead><tr><th align="left">æœåŠ¡å™¨</th><th align="left">ç¼“å†²</th><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left">m1</td><td align="left">1</td><td align="left">5</td><td align="left">9</td></tr><tr><td align="left">m2</td><td align="left">2</td><td align="left">6</td><td align="left">10</td></tr><tr><td align="left">s1</td><td align="left">3</td><td align="left">7</td><td align="left">11</td></tr><tr><td align="left">s2</td><td align="left">4</td><td align="left">8</td><td align="left">12</td></tr></tbody></table><p>æŒ‰ç…§è¡Œæ¥åˆ†å‘ï¼Œè¿™æ ·çš„è¯é—®é¢˜å°±è§£å†³æ‹‰ï¼è¿™å°±æ˜¯åˆ†ç‰‡ï¼Œè¿™æ ·å°±ä¸ä¼šæµªè´¹æ€§èƒ½ï¼Œæ•°æ®å°±ä¸ä¼šé‡å¤æ‹‰ï¼</p><blockquote><p>sqlè·¯ç”±å¹¶å‘æŸ¥è¯¢</p></blockquote><p>æ¡ˆä¾‹ï¼šå¦‚æœç”¨æˆ·è¦æ‰§è¡Œ<code>select * from t1 where id=1 or id=8;</code>æ€ä¹ˆåŠå‘¢ï¼Ÿä»£ç†æœåŠ¡å™¨æ˜¯åˆ†å‘ç»™m1è¿˜æ˜¯s2å‘¢ï¼Ÿ</p><p>å½“è¿™æ¡è¯­å¥ç»è¿‡ä»£ç†æœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¢«ä¸€åˆ†ä¸ºäºŒï¼Œä¸€æ¡æ˜¯<code>select * from t1 where id=1;</code>ä¸€æ¡æ˜¯<code>select * from t1 where id=8;</code> ç„¶ååŒæ—¶å‘ç»™ä¸¤å°ä¸åŒçš„æœåŠ¡å™¨ï¼Œå°†æŸ¥è¯¢ç»“æœå–å‡ºæ¥ï¼Œåˆå¹¶ä¸€ä¸‹ï¼Œç„¶åè¿”å›ç»™å‰ç«¯ã€‚è¿™ä¸ªå«åšsqlè·¯ç”±å¹¶å‘æŸ¥è¯¢ã€‚</p><h4 id="ç›®å‰å¸‚é¢ä¸Šçš„æ•°æ®åº“ä»£ç†æœåŠ¡å™¨"><a href="#ç›®å‰å¸‚é¢ä¸Šçš„æ•°æ®åº“ä»£ç†æœåŠ¡å™¨" class="headerlink" title="ç›®å‰å¸‚é¢ä¸Šçš„æ•°æ®åº“ä»£ç†æœåŠ¡å™¨"></a>ç›®å‰å¸‚é¢ä¸Šçš„æ•°æ®åº“ä»£ç†æœåŠ¡å™¨</h4><p>æˆ‘ä»¬ä¼šå»è®²ç›®å‰å¸‚é¢ä¸Šçš„ä¸€äº›æ•°æ®åº“ä»£ç†æœåŠ¡å™¨ã€‚ç›®å‰æ•°æ®åº“ä»£ç†å¥½ç”¨çš„çœŸå¿ƒæ¯”è¾ƒå°‘ï¼Œéå¸¸å°‘ï¼ŒåŒ…æ‹¬mysqlå®˜æ–¹ä¹Ÿå¼€å‘è¿‡ä»£ç†ï¼Œéå¸¸åœ°çƒ‚ï¼Œç ´ä¸œè¥¿ï¼Œå¼€å‘äº†å¥½å¤šå¹´äº†ï¼Œä¸€ç›´å¾ˆçƒ‚ï¼›ç„¶åå‘¢ï¼Œæ·˜å®æœ‰è‡ªå·±çš„ä»£ç†ï¼Œä½†æ²¡æœ‰å¼€æºå‡ºæ¥ï¼Œæˆ–è€…è¯´å¼€æºå‡ºæ¥äº†ä¸èƒ½ç”¨ï¼Œä»–çš„ä»£ç†è¦ç”¨åœ¨ä»–ä»¬çš„é‚£å¥—åŸºç¡€æ¶æ„ä¸Šï¼Œè€ŒåŸºç¡€æ¶æ„æ²¡å¼€æºå‡ºæ¥ï¼Œä»…ç¨‹åºå¼€æºå‡ºæ¥æ²¡ç”¨ï¼Œæ²¡æœ‰è¿è¡Œç¯å¢ƒï¼›å¥‡è™360å¯¹mysql-proxyåšäº†æ›´æ”¹ï¼Œæ€§èƒ½åšäº†ä¼˜åŒ–ï¼Œä¼˜åŒ–ä¸‹æ¥çš„æ•ˆæœè¿˜å¯ä»¥ï¼Œæ¯”å®˜æ–¹å¥½å¾ˆå¤šï¼Œè¿è¡Œçš„ç¯å¢ƒè™½ç„¶å¼€æºå‡ºæ¥äº†ï¼Œä½†æ˜¯ä¸èƒ½åœ¨el7ä¸Šè·‘ï¼Œel6ã€el5å¯ä»¥è·‘ï¼Œè¿™ä¸œè¥¿æ²¡åŠæ³•è®²ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€ä¸‹ï¼Œä»¥åå¤§å®¶åšä»£ç†ä¸è¦ç”¨el7ï¼Œç”¨el5ã€el6å¯ä»¥è·‘ç€è¯•è¯•çœ‹ï¼›ç„¶åä¼šå»è®²å¦å¤–ä¸€ä¸ªä»£ç†mycatï¼Œå‰ç”Ÿæ˜¯é˜¿é‡Œå·´å·´çš„æ•°æ®åº“ä»£ç†ï¼Œé˜¿é‡Œå·´å·´å’Œæ·˜å®ç”¨çš„æ•°æ®åº“ä»£ç†æ˜¯ä¸¤å¥—ç¨‹åºï¼Œé˜¿é‡Œå·´å·´ä¹‹å‰çš„æ•°æ®åº“ä»£ç†å„ç§å‘ï¼Œå‘åˆ°ä»–çš„å¼€å‘äººå‘˜å®åœ¨å—ä¸äº†äº†ï¼Œç„¶åå°±è‡ªå·±ç»„ç»‡äº†ä¸€æ‰¹äººï¼Œå¼€å§‹é‡å†™ä»£ç ï¼Œå°†å„ç§å‘è¡¥æ‰ï¼Œé‡å†™å‡ºæ¥çš„è¿™ä¸ªå¼€æºäº§å“å‘¢å°±å«mycatï¼Œæœ‰ç†ç”±ç›¸ä¿¡mycatä»¥åä¼šè¶Šæ¥è¶Šå¥½ï¼Œå› ä¸ºä»–æœ‰ä¸€ä¸ªéå¸¸åšå®çš„åŸºç¡€ï¼Œå°±æ˜¯ä»–æ˜¯æ‹¿é˜¿é‡Œå·´å·´çš„ç³»ç»Ÿï¼Œç»è¿‡çº¿ä¸Šç”Ÿäº§ç¯å¢ƒéªŒè¯çš„ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œæ‹¿ä»–æ¥æ”¹çš„ï¼Œè€Œä¸”è¿˜è¡¥å…¨äº†ä»–å¾ˆå¤šçš„ä¸è¶³ï¼ŒæŠŠä»–å˜æˆäº†ä¸€ä¸ªä¼ä¸šçº§çš„äº§å“ï¼Œç›®å‰mycatçš„ç”¨æˆ·å¹¶ä¸ç®—å¤šï¼Œä½†æ˜¯ä»–çš„å¸‚åœºä»½é¢ä¸€ç›´åœ¨é€æ­¥å¢åŠ ï¼Œä»å¼€æºé¢†åŸŸçš„ä»£ç†æœåŠ¡å™¨æ¥è®²ï¼Œè¿™ä¸ªmycatè¿˜æ˜¯éå¸¸ä¸é”™çš„ã€‚</p><p>æˆ‘ä»¬ä¼šä¸¾ä¸¤ä¸ªä¾‹å­ï¼Œmysqlå®˜æ–¹çš„ mysql-proxyï¼Œå…¶å®æˆ‘æ˜¯ä¸æƒ³è®²mysqlå®˜æ–¹çš„ï¼Œè®²è¿™ä¸œè¥¿ä¹Ÿæ²¡å¤ªå¤§ç”¨å¤„ï¼Œä»–æœ‰äº›è‡ªå·±çš„ç¼ºç‚¹ï¼Œå½“ç„¶äº†ï¼Œè¿™äº›ç¼ºç‚¹å¹¶ä¸æ˜¯ä¸èƒ½å…‹æœçš„ï¼Œå¯ä»¥è§£å†³ï¼Œè§£å†³çš„å‰ææ˜¯ä½ éœ€è¦ä¼šå¼€å‘ï¼Œä»–é‡Œé¢æœ‰ä¸€äº›ä»£ç è¦ä½ è‡ªå·±æ”¹ï¼Œå› ä¸ºä»–å®˜æ–¹çš„ä»£ç æ¯”è¾ƒçƒ‚ã€‚å¦ä¸€ä¸ªå°±æ˜¯mycatã€‚å»å®ç°ä¸¤ä¸ªåŠŸèƒ½ï¼Œè´Ÿè½½å‡è¡¡å’Œè¯»å†™åˆ†ç¦»ã€‚</p><table><thead><tr><th align="left">DBPROXY</th><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left">Mysql-proxy</td><td align="left">luaè„šæœ¬</td><td align="left">é­”å…½ä¸–ç•Œ</td></tr><tr><td align="left"><a href="https://github.com/alibaba/tb_tddl/wiki/TDDL-dynamic-datasource-%E5%85%A5%E9%97%A8%E4%B8%8E%E4%BD%BF%E7%94%A8" target="_blank" rel="noopener">tddl</a></td><td align="left">æ·˜å®çš„æ•°æ®åº“ä»£ç†</td><td align="left">æ²¡æœ‰è¿è¡Œç¯å¢ƒ</td></tr><tr><td align="left"><a href="https://github.com/Qihoo360/Atlas/wiki/Atlas%E7%9A%84%E5%AE%89%E8%A3%85" target="_blank" rel="noopener">atlas</a></td><td align="left">å¥‡è™360çš„æ•°æ®åº“ä»£ç†[ å¸Œè…Šç¥è¯è¢«ç½šä½œè‹¦å½¹çš„å¤§åŠ›ç¥ ]</td><td align="left">rhel7ä¸èƒ½ç”¨</td></tr><tr><td align="left"><a href="https://github.com/alibaba/cobar" target="_blank" rel="noopener">cobar</a></td><td align="left">é˜¿é‡Œå·´å·´</td><td align="left">æµ‹è¯•ç‰ˆä¸èƒ½ç”¨</td></tr><tr><td align="left">mycat</td><td align="left">é˜¿é‡Œå·´å·´äºŒæ¬¡å¼€å‘</td><td align="left">å•†ä¸šå‹äº§å“</td></tr></tbody></table><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬é¡¹ç›®çš„ä¸€ä¸ªç½‘ç»œæ¶æ„ã€‚</p><p><img src="pic/galera.jpg" alt="DBPROXY"></p><h5 id="mysql-proxy"><a href="#mysql-proxy" class="headerlink" title="mysql-proxy"></a>mysql-proxy</h5><p><img src="pic/12-mysql-proxy.jpg" alt="mysql-proxy"></p><blockquote><p>æ•°æ®åº“ä¸­é—´ä»¶ mysql-proxy 0.8.5 å®ç° è¯»å†™åˆ†ç¦»è´Ÿè½½å‡è¡¡</p></blockquote><blockquote><blockquote><p>1.ç½‘ç»œæ‹“æ‰‘è§„åˆ’</p></blockquote></blockquote><table><thead><tr><th align="left">æœåŠ¡å™¨</th><th align="left">IP</th><th align="left">software</th></tr></thead><tbody><tr><td align="left">mastera0</td><td align="left">172.25.0.11</td><td align="left">mariadb5.5</td></tr><tr><td align="left">masterb0</td><td align="left">172.25.0.12</td><td align="left">mariadb5.5</td></tr><tr><td align="left">slavea0</td><td align="left">172.25.0.13</td><td align="left">mariadb5.5</td></tr><tr><td align="left">slaveb0</td><td align="left">172.25.0.14</td><td align="left">mariadb5.5</td></tr><tr><td align="left">dbproxy0</td><td align="left">172.25.0.15</td><td align="left">mysql-proxy0.8.5</td></tr></tbody></table><blockquote><blockquote><p>2.å®‰è£…è½¯ä»¶</p></blockquote></blockquote><p>1ï¼‰æ— å¯†ç sshç™»é™†è™šæ‹Ÿæœº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line">for i in 10 11 12 13 14 15 ;do ssh-copy-id root@172.25.0.$i ;done</span><br></pre></td></tr></table></figure><p>2ï¼‰å…³é—­selinux,firewalld</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for i in 10 11 12 13 14 15 ;\</span><br><span class="line">do ssh root@172.25.0.$i \</span><br><span class="line">\"sed -i '/^SELINUX/s/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config;\</span><br><span class="line">grep -v "^#" /etc/selinux/config;\</span><br><span class="line">systemctl stop firewalld \";done</span><br></pre></td></tr></table></figure><p>3ï¼‰éœ€è¦å®‰è£…çš„è½¯ä»¶åŒ…<code>wgetï¼Œnet-tools,rpc-bind,nfs-utils,vim</code></p><p><code>for i in 10 11 12 13 14 ;do ssh root@172.25.0.$i &quot;yum install -y wget net-tools rpc-bind nfs-utils vim &quot;;done</code></p><p>4ï¼‰æŸ¥çœ‹ipåœ°å€<code>ip addr</code></p><p>5ï¼‰ä¿®æ”¹yumæºï¼Œæ ¹æ®å®é™…éœ€æ±‚æ¥</p><p>ä»æœåŠ¡å™¨ä¸Šä¸‹è½½åˆ°/etc/yum.repos.d/ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d &amp;&amp; \</span><br><span class="line">wget http://classroom.example.com/materials/mariadb-10.2.repo;\</span><br><span class="line">wget http://classroom.example.com/materials/mysql-5.7.repo;\</span><br><span class="line">wget http://classroom.example.com/materials/thirdpart.repo</span><br><span class="line"></span><br><span class="line">yum clean all &amp;&amp; yum makecache</span><br></pre></td></tr></table></figure><p>6) å®‰è£…mariadb-serverï¼Œå¹¶å¯åŠ¨æœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for i in 11 12 13 14 ;do ssh root@172.25.0.$i "yum install -y mariadb-server" ;done</span><br><span class="line">for i in 11 12 13 14 ;do ssh root@172.25.0.$i "systemctl start mariadb" ;done</span><br></pre></td></tr></table></figure><p>7) å®‰è£…ä¾èµ–åŒ…</p><p><code>yum install gcc* lua lua-devel libevent libevent-devel glib2 glib2-devel pkgconfig mariadb-devel flex</code></p><p>8) å®‰è£…mysql-proxy</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://172.25.254.254/content/courses/db100/rhel7.2/materials/mysql-proxy-0.8.5.tar.gz</span><br><span class="line">tar -zxf mysql-proxy-0.8.5.tar.gz</span><br><span class="line">cd mysql-proxy-0.8.5</span><br><span class="line">./configure --prefix=/usr/local/mysql-proxy</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>3.é…ç½®</p></blockquote></blockquote><p>è®¾ç½®å¯†ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i in 11 12 13 14 ;do ssh root@172.25.0.$i "mysqladmin -uroot password uplooking" ;done</span><br></pre></td></tr></table></figure><p>1ï¼‰mastera0</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -puplooking</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> create database db1;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use db1;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> create table t1 (num int not null);</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> insert into t1 values (1);</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> grant all on db1.* to <span class="string">'mysql-proxy'</span>@172.25.0.15 identified by <span class="string">'uplooking'</span>;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> flush privileges;</span></span><br></pre></td></tr></table></figure><p>2ï¼‰slavea0</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -puplooking</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> create database db1;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use db1;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> create table t1 (num int not null);</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> insert into t1 values (2);</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> grant all on db1.* to <span class="string">'mysql-proxy'</span>@172.25.0.15 identified by <span class="string">'uplooking'</span>;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> flush privileges;</span></span><br></pre></td></tr></table></figure><p>3) è¿›å…¥mysql-proxyçš„å®¶ç›®å½•/usr/local/mysql-proxy</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mysql-proxy/;ls</span><br><span class="line"><span class="meta">#</span><span class="bash"> bin  include  lib  libexec  share</span></span><br><span class="line">cd bin;ls</span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql-binlog-dump  mysql-myisam-dump  mysql-proxy</span></span><br><span class="line">./mysql-proxy --help-all---ã€‹æŸ¥çœ‹å‘½ä»¤å¸®åŠ©</span><br><span class="line">./mysql-proxy -P 172.25.0.15:3306 -b 172.25.0.11:3306 -b 172.25.0.13:3306 &amp;</span><br><span class="line">netstat -ntalp|grep 3306</span><br><span class="line"><span class="meta">#</span><span class="bash"> tcp        0      0 172.25.0.15:3306        0.0.0.0:*               LISTEN      24483/./mysql-proxy</span></span><br></pre></td></tr></table></figure><blockquote><blockquote><p>4.æµ‹è¯•</p></blockquote></blockquote><p>å®¢æˆ·ç«¯ 172.25.0.10</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql -u'mysql-proxy' -puplooking -h172.25.0.15</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use db1;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> select * from t1;</span></span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">|   1 |</span><br><span class="line">+-----+</span><br></pre></td></tr></table></figure><p>å°†mastera0çš„æœåŠ¡å…³é—­åï¼Œå†æŸ¥çœ‹è¡¨1ä¸­çš„å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop mariadb</span><br><span class="line"></span><br><span class="line">mysql -u'mysql-proxy' -puplooking -h172.25.0.15</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> select * from t1;</span></span><br><span class="line">ERROR 2013 (HY000): Lost connection to MySQL server during query</span><br><span class="line">MariaDB [db1]&gt; select * from t1;</span><br><span class="line">ERROR 2006 (HY000): MySQL server has gone away</span><br><span class="line">No connection. Trying to reconnect...</span><br><span class="line">Connection id:    5</span><br><span class="line">Current database: db1</span><br><span class="line"></span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">|   2 |</span><br><span class="line">+-----+</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>5.é…ç½®</p></blockquote></blockquote><p>1ï¼‰å°†luaè„šæœ¬å¤åˆ¶åˆ°mysql-proxyçš„å®¶ç›®å½•</p><p><code>cp ~/mysql-proxy-0.8.5/lib/rw-splitting.lua /usr/local/mysql-proxy/</code></p><p>2) mastera0è¯»å†™ï¼Œslavea0åªè¯»ï¼Œé€šè¿‡luaè„šæœ¬</p><p><code>./mysql-proxy -P 172.25.0.15:3306 -b 172.25.0.11:3306 -r 172.25.0.13:3306 -s /usr/local/mysql-proxy/rw-splitting.lua</code></p><blockquote><blockquote><p>6.æµ‹è¯•</p></blockquote></blockquote><p>1ï¼‰å®¢æˆ·ç«¯ä¸Šç™»é™†åæ’å…¥33ï¼›</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -u'mysql-proxy' -puplooking -h172.25.0.15</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use db1;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> insert into t1 values (33);</span></span><br></pre></td></tr></table></figure><p>2ï¼‰mastera0æŸ¥çœ‹t1è¡¨ï¼›</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql -u'mysql-proxy' -puplooking -h172.25.0.15</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use db1;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> select * from t1;</span></span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">|   1 |</span><br><span class="line">|  33 |</span><br><span class="line">+-----+</span><br></pre></td></tr></table></figure><p>3ï¼‰slavea0æŸ¥çœ‹t1ï¼›</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql -u'mysql-proxy' -puplooking -h172.25.0.15</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> select * from t1;</span></span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">|   2 |</span><br><span class="line">+-----+</span><br></pre></td></tr></table></figure><p>4ï¼‰å®¢æˆ·ç«¯æŸ¥çœ‹t1è¡¨ï¼›</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql -u'mysql-proxy' -puplooking -h172.25.0.15</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> select * from t1;</span></span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">|   2 |</span><br><span class="line">+-----+</span><br></pre></td></tr></table></figure><h5 id="mycat"><a href="#mycat" class="headerlink" title="mycat"></a>mycat</h5><p>2013 å¹´é˜¿é‡Œçš„ Cobar åœ¨ç¤¾åŒºä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºç°å­˜åœ¨ä¸€äº›æ¯”è¾ƒä¸¥é‡çš„é—®é¢˜,åŠå…¶ä½¿ç”¨é™åˆ¶ï¼Œç»è¿‡ Mycat ç¬¬ä¸€æ¬¡æ”¹è‰¯,ç¬¬ä¸€ä»£æ”¹è‰¯ç‰ˆâ€”â€”Mycat è¯ç”Ÿã€‚ Mycat å¼€æºä¹‹å,ä¸€äº› Cobar çš„ç”¨æˆ·å‚ä¸äº† Mycat çš„å¼€å‘,æœ€ç»ˆ Mycat å‘å±•æˆä¸ºä¸€ä¸ªç”±ä¼—å¤šè½¯ä»¶å…¬å¸çš„å®åŠ›æ´¾æ¶æ„å¸ˆå’Œèµ„æ·±å¼€å‘äººå‘˜ç»´æŠ¤çš„ç¤¾åŒºå‹å¼€æºè½¯ä»¶ã€‚</p><ul><li>Mycat æèµ åœ°å€ :<a href="http://www.mycat.io/donate.html" target="_blank" rel="noopener">http://www.mycat.io/donate.html</a></li><li>Mycat å®˜ç½‘ç½‘ç«™:<a href="http://www.mycat.io/" target="_blank" rel="noopener">http://www.mycat.io/</a></li><li>Mycat æºç :<a href="https://github.com/MyCATApache/Mycat-Server" target="_blank" rel="noopener">https://github.com/MyCATApache/Mycat-Server</a></li><li>Mycat ä¸‹è½½åœ°å€:<a href="https://github.com/MyCATApache/Mycat-download" target="_blank" rel="noopener">https://github.com/MyCATApache/Mycat-download</a></li></ul><p><img src="pic/13-mycat.jpg" alt="mycat"></p><blockquote><blockquote><p>1.ç½‘ç»œæ‹“æ‰‘è§„åˆ’</p></blockquote></blockquote><table><thead><tr><th align="left">æœåŠ¡å™¨</th><th align="left">IP</th><th align="left">software</th></tr></thead><tbody><tr><td align="left">mastera0</td><td align="left">172.25.0.11</td><td align="left">mariadb5.5</td></tr><tr><td align="left">masterb0</td><td align="left">172.25.0.12</td><td align="left">mariadb5.5</td></tr><tr><td align="left">slavea0</td><td align="left">172.25.0.13</td><td align="left">mariadb5.5</td></tr><tr><td align="left">slaveb0</td><td align="left">172.25.0.14</td><td align="left">mariadb5.5</td></tr><tr><td align="left">dbproxy0</td><td align="left">172.25.0.15</td><td align="left">mysql-proxy0.8.5</td></tr></tbody></table><blockquote><blockquote><p>2.å®‰è£…è½¯ä»¶</p></blockquote></blockquote><p><strong>å®‰è£…jdkè½¯ä»¶</strong> å› ä¸ºmycatæ˜¯ç”¨javaè¯­è¨€ç¼–å†™çš„,å¹¶å®£å‘Šå®¶ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> wget http://172.25.254.254/content/class/mariadb/mycat/jdk-7u79-linux-x64.rpm</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> wget http://172.25.254.254/content/class/mariadb/mycat/Mycat-server-1.5.1-RELEASE-20160328130228-linux.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rpm -ivh jdk-7u79-liunux-x64.rpm</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rpm -ql jdk|head</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> JAVA_HOME=<span class="string">'/usr/java/jdk1.7.0_79'</span></span></span><br></pre></td></tr></table></figure><p>ä¸´æ—¶ç”Ÿæ•ˆï¼Œå¦‚æœè¦æ°¸ä¹…ç”Ÿæ•ˆéœ€è¦å†™åˆ°bashå¯åŠ¨è„šæœ¬ä¸­ä¾‹å¦‚/etc/bashrc</p><p><strong>å®‰è£…mycat</strong> ç›´æ¥è§£å‹ç¼©å³å¯ä½¿ç”¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">*************************************</span><br><span class="line">binmycatå¯åŠ¨è„šæœ¬</span><br><span class="line">confschema.xmlæ•°æ®åº“é…ç½®</span><br><span class="line">    server.xmlé€»è¾‘åº“é…ç½®</span><br><span class="line">*************************************</span><br><span class="line">[root@dbproxy0 ~]# tar xf Mycat-server-1.5.1-RELEASE-20160328130228-linux.tar.gz -C /usr/local</span><br><span class="line">[root@dbproxy0 ~]# cd /usr/local;ls</span><br><span class="line">[root@dbproxy0 local]# cd mycat;ll</span><br><span class="line">[root@dbproxy0 mycat]# chmod 755 * -R</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>4.é…ç½®æ–‡ä»¶</p></blockquote></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@dbproxy0 mycat]# vim conf/schema.xml</span><br><span class="line">[root@dbproxy0 mycat]# vim conf/server.xml</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">server.xml</span><br><span class="line">#ç”¨æˆ·åã€å¯†ç ã€é€»è¾‘åº“åéœ€è¦è‡ªå®šä¹‰</span><br><span class="line">&lt;user name&#x3D;&quot;test&quot;&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;password&quot;&gt;test&lt;&#x2F;property&gt;   æ³¨æ„ï¼šæ­¤å¤„testæ˜¯å¯†ç </span><br><span class="line">&lt;property name&#x3D;&quot;schemas&quot;&gt;TESTDB&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;user&gt;</span><br><span class="line">&lt;system&gt;</span><br><span class="line">#æ–°å¢æœåŠ¡ç«¯å£</span><br><span class="line">&lt;property name&#x3D;&quot;servicePort&quot;&gt;3306&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;system&gt;</span><br><span class="line">****************************</span><br><span class="line">&lt;mycat:schema xmlns:mycat&#x3D;&quot;http:&#x2F;&#x2F;org.opencloudb&#x2F;&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;schema name&#x3D;&quot;TESTDB&quot; checkSQLschema&#x3D;&quot;false&quot; sqlMaxLimit&#x3D;&quot;100&quot;&gt;</span><br><span class="line">                &lt;!-- auto sharding by id (long) --&gt;</span><br><span class="line">                &lt;table name&#x3D;&quot;travelrecord&quot; dataNode&#x3D;&quot;dn1,dn2,dn3&quot; rule&#x3D;&quot;auto-sharding-long&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;table name&#x3D;&quot;t1&quot; dataNode&#x3D;&quot;dn1&quot; &#x2F;&gt;</span><br><span class="line">                &lt;!-- global table is auto cloned to all defined data nodes ,so can join</span><br><span class="line">                        with any table whose sharding node is in the same data node --&gt;</span><br><span class="line">                &lt;table name&#x3D;&quot;company&quot; primaryKey&#x3D;&quot;ID&quot; type&#x3D;&quot;global&quot; dataNode&#x3D;&quot;dn1,dn2,dn3&quot; &#x2F;&gt;</span><br><span class="line">                &lt;table name&#x3D;&quot;goods&quot; primaryKey&#x3D;&quot;ID&quot; type&#x3D;&quot;global&quot; dataNode&#x3D;&quot;dn1,dn2&quot; &#x2F;&gt;</span><br><span class="line">                &lt;!-- random sharding using mod sharind rule --&gt;</span><br><span class="line">                &lt;table name&#x3D;&quot;hotnews&quot; primaryKey&#x3D;&quot;ID&quot; dataNode&#x3D;&quot;dn1,dn2,dn3&quot;</span><br><span class="line">                        rule&#x3D;&quot;mod-long&quot; &#x2F;&gt;</span><br><span class="line">                &lt;!-- &lt;table name&#x3D;&quot;dual&quot; primaryKey&#x3D;&quot;ID&quot; dataNode&#x3D;&quot;dnx,dnoracle2&quot; type&#x3D;&quot;global&quot;</span><br><span class="line">                        needAddLimit&#x3D;&quot;false&quot;&#x2F;&gt; &lt;table name&#x3D;&quot;worker&quot; primaryKey&#x3D;&quot;ID&quot; dataNode&#x3D;&quot;jdbc_dn1,jdbc_dn2,jdbc_dn3&quot;</span><br><span class="line">                        rule&#x3D;&quot;mod-long&quot; &#x2F;&gt; --&gt;</span><br><span class="line">                &lt;table name&#x3D;&quot;employee&quot; primaryKey&#x3D;&quot;ID&quot; dataNode&#x3D;&quot;dn1,dn2&quot;</span><br><span class="line">                        rule&#x3D;&quot;sharding-by-intfile&quot; &#x2F;&gt;</span><br><span class="line">                &lt;table name&#x3D;&quot;customer&quot; primaryKey&#x3D;&quot;ID&quot; dataNode&#x3D;&quot;dn1,dn2&quot;</span><br><span class="line">                        rule&#x3D;&quot;sharding-by-intfile&quot;&gt;</span><br><span class="line">                        &lt;childTable name&#x3D;&quot;orders&quot; primaryKey&#x3D;&quot;ID&quot; joinKey&#x3D;&quot;customer_id&quot;</span><br><span class="line">                                parentKey&#x3D;&quot;id&quot;&gt;</span><br><span class="line">                                &lt;childTable name&#x3D;&quot;order_items&quot; joinKey&#x3D;&quot;order_id&quot;</span><br><span class="line">                                        parentKey&#x3D;&quot;id&quot; &#x2F;&gt;</span><br><span class="line">                        &lt;&#x2F;childTable&gt;</span><br><span class="line">&lt;childTable name&#x3D;&quot;customer_addr&quot; primaryKey&#x3D;&quot;ID&quot; joinKey&#x3D;&quot;customer_id&quot;</span><br><span class="line">                                parentKey&#x3D;&quot;id&quot; &#x2F;&gt;</span><br><span class="line">                &lt;&#x2F;table&gt;</span><br><span class="line">                &lt;!-- &lt;table name&#x3D;&quot;oc_call&quot; primaryKey&#x3D;&quot;ID&quot; dataNode&#x3D;&quot;dn1$0-743&quot; rule&#x3D;&quot;latest-month-calldate&quot;</span><br><span class="line">                        &#x2F;&gt; --&gt;</span><br><span class="line">        &lt;&#x2F;schema&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;dataNode name&#x3D;&quot;dn1&quot; dataHost&#x3D;&quot;localhost1&quot; database&#x3D;&quot;db1&quot; &#x2F;&gt;</span><br><span class="line">&lt;dataHost name&#x3D;&quot;localhost1&quot; maxCon&#x3D;&quot;1000&quot; minCon&#x3D;&quot;10&quot; balance&#x3D;&quot;3&quot;</span><br><span class="line">                writeType&#x3D;&quot;0&quot; dbType&#x3D;&quot;mysql&quot; dbDriver&#x3D;&quot;native&quot; switchType&#x3D;&quot;1&quot;  slaveThreshold&#x3D;&quot;100&quot;&gt;</span><br><span class="line">                &lt;heartbeat&gt;select user()&lt;&#x2F;heartbeat&gt;</span><br><span class="line">                &lt;!-- can have multi write hosts --&gt;</span><br><span class="line">                &lt;writeHost host&#x3D;&quot;mastera&quot; url&#x3D;&quot;172.25.0.11:3306&quot; user&#x3D;&quot;mysqlproxy&quot;</span><br><span class="line">                        password&#x3D;&quot;uplooking&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;readHost host&#x3D;&quot;slavea&quot; url&#x3D;&quot;172.25.0.13:3306&quot; user&#x3D;&quot;mysqlproxy&quot;</span><br><span class="line">                        password&#x3D;&quot;uplooking&quot; &#x2F;&gt;</span><br><span class="line">                &lt;readHost host&#x3D;&quot;slaveb&quot; url&#x3D;&quot;172.25.0.14:3306&quot; user&#x3D;&quot;mysqlproxy&quot;</span><br><span class="line">                        password&#x3D;&quot;uplooking&quot; &#x2F;&gt;</span><br><span class="line">                &lt;&#x2F;writeHost&gt;</span><br><span class="line"></span><br><span class="line">                &lt;writeHost host&#x3D;&quot;masterb&quot; url&#x3D;&quot;172.25.0.12:3306&quot; user&#x3D;&quot;mysqlproxy&quot;</span><br><span class="line">                        password&#x3D;&quot;uplooking&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;readHost host&#x3D;&quot;slavea&quot; url&#x3D;&quot;172.25.0.13:3306&quot; user&#x3D;&quot;mysqlproxy&quot;</span><br><span class="line">                        password&#x3D;&quot;uplooking&quot; &#x2F;&gt;</span><br><span class="line">                &lt;readHost host&#x3D;&quot;slaveb&quot; url&#x3D;&quot;172.25.0.14:3306&quot; user&#x3D;&quot;mysqlproxy&quot;</span><br><span class="line">                        password&#x3D;&quot;uplooking&quot; &#x2F;&gt;</span><br><span class="line">                &lt;&#x2F;writeHost&gt;</span><br><span class="line">&lt;&#x2F;dataHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;mycat:schema&gt;</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>5ï¼‰å¯åŠ¨æœåŠ¡</p></blockquote></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@dbproxy0 mycat]# bin/mycat start</span><br><span class="line">[root@dbproxy0 mycat]# netstat -luntp|grep tcp</span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1190/sshd           </span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1853/master         </span><br><span class="line">tcp        0      0 127.0.0.1:32000         0.0.0.0:*               LISTEN      3168/java           </span><br><span class="line">tcp6       0      0 :::3306                 :::*                    LISTEN      3168/java           </span><br><span class="line">tcp6       0      0 :::9066                 :::*                    LISTEN      3168/java           </span><br><span class="line">tcp6       0      0 :::46764                :::*                    LISTEN      3168/java           </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      1190/sshd           </span><br><span class="line">tcp6       0      0 ::1:25                  :::*                    LISTEN      1853/master         </span><br><span class="line">tcp6       0      0 :::1984                 :::*                    LISTEN      3168/java           </span><br><span class="line">tcp6       0      0 :::43493                :::*                    LISTEN      3168/java</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>6ï¼‰æµ‹è¯•</p></blockquote></blockquote><p>mycatçš„masteræ¯æ¬¡ä¹‹èƒ½ç”¨ä¸€ä¸ªæ¥å†™ï¼Œä»¥è¿™ç§æ–¹æ³•æ¥é˜²æ­¢ä¸¤å°masteräº§ç”Ÿå†²çªã€‚<br>å½“å…¶ä¸­ä¸€å°masterå®•æœºä»¥åï¼Œå¯ä»¥è‡ªåŠ¨åˆ‡æ¢ã€‚</p><p><strong>balance å±æ€§</strong></p><p>è´Ÿè½½å‡è¡¡ç±»å‹æœ‰ 3 ç§:</p><ol><li>balance=â€0â€, masterå¯è¯»å¯å†™ï¼Œslaveä¸ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯ä¸å¯åŠ¨è¯»å†™åˆ†ç¦»</li><li>balance=â€1â€,masterå¯è¯»å¯å†™ï¼Œslaveåªè¯»ï¼›stand by writeHost å‚ä¸ select è¯¢å¥ç™¿è´Ÿè½½å‡è¡¡</li><li>balance=â€2â€,masterå¯è¯»å¯å†™ï¼Œslaveåªè¯»ï¼›æ‰€æœ‰è¯»æ“ä½œéƒ½éšæœºçš„åœ¨ masterå’Œslaveä¸Šåˆ†é…ã€‚</li><li>balance=â€3â€,masteråªå†™ï¼Œslaveåªè¯»ï¼›1.4ç‰ˆæœ¬ä»¥åæœ‰</li></ol><p><strong>switchType å±æ€§</strong></p><ul><li>-1 è¡¨ç¤ºä¸è‡ªåŠ¨åˆ‡æ¢</li><li>1 é»˜è®¤å€¼,è‡ªåŠ¨åˆ‡æ¢</li><li>2 åŸºäº MySQL ä¸»ä»åŒæ­¥çš„çŠ¶æ€å†³å®šæ˜¯å¦åˆ‡æ¢</li></ul><p><strong>æ›´å¤šå†…å®¹</strong> è¯·æŸ¥çœ‹ã€ŠMycat æƒå¨æŒ‡å—ã€‹</p><h3 id="å®æˆ˜é¡¹ç›®"><a href="#å®æˆ˜é¡¹ç›®" class="headerlink" title="å®æˆ˜é¡¹ç›®"></a>å®æˆ˜é¡¹ç›®</h3><blockquote><p>å®æˆ˜é¡¹ç›®1ï¼š æ•°æ®åº“ä¸­é—´ä»¶ mysql-proxy 0.8.5 å®ç° è¯»å†™åˆ†ç¦»è´Ÿè½½å‡è¡¡ï¼Œåç«¯æ•°æ®åº“æœåŠ¡å™¨ä¸º MySQL 5.7 M-M-S-S Multisource Replication é«˜å¯ç”¨æ¶æ„</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line">è½¯ä»¶åmysql-proxy</span><br><span class="line">http://classroom.example.com/materials/mysql-proxy-0.8.5.tar.gz</span><br><span class="line">æœåŠ¡å¯åŠ¨è„šæœ¬</span><br><span class="line">mysql-proxy</span><br><span class="line">-P, --proxy-address=&lt;host:port&gt; 4040æŒ‡å®šmysql-proxyè¿è¡Œçš„ä½ç½®å’Œç«¯å£å·</span><br><span class="line">-b, --proxy-backend-addresses=&lt;host:port&gt;å¯è¯»å¯å†™</span><br><span class="line">-r, --proxy-read-only-backend-addresses=&lt;host:port&gt; åªè¯»</span><br><span class="line">-s, --proxy-lua-script=&lt;file&gt;luaè„šæœ¬</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…å¹¶å¯åŠ¨mysql-proxy</span></span><br><span class="line"></span><br><span class="line">1ï¼‰ä¾èµ–å…³ç³»</span><br><span class="line">yum install -y  gcc* libev lua  lua-devel libevent libevent-devel glib2 glib2-devel pkgconfig mariadb-devel flex</span><br><span class="line">2ï¼‰æºç ç¼–è¯‘</span><br><span class="line">1.configure</span><br><span class="line">2.make</span><br><span class="line">3.make install</span><br><span class="line">---------------</span><br><span class="line">3ï¼‰å¯åŠ¨æœåŠ¡</span><br><span class="line">mysql-proxy -P 172.25.0.15:3306 -b 172.25.0.11:3306 -b 172.25.0.12:3306 -r 172.25.0.13:3306 -r 172.25.0.14:3306 -s /usr/local/mysql-proxy/rw-splitting.lua</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼Œå¯åŠ¨æœåŠ¡ä¹‹å‰éœ€è¦ï¼š</span><br><span class="line">1ï¼‰å…³é—­æ‰€æœ‰æœåŠ¡å™¨çš„selinuxå’Œfirewalld</span><br><span class="line">2ï¼‰åç«¯çœŸå®æ•°æ®åº“éœ€è¦ç»™dbproxyæˆæƒ</span><br><span class="line"></span><br><span class="line">---------------</span><br><span class="line">mysql-proxyè¯¦ç»†æ­¥éª¤</span><br><span class="line"></span><br><span class="line">1.ç½‘ç»œæ‹“æ‰‘è§„åˆ’</span><br><span class="line">mastera0172.25.0.11mariadb5.7 mysql-5.7.repo</span><br><span class="line">masterb0172.25.0.12 mariadb5.7 mysql-5.7.repo</span><br><span class="line">slavea0172.25.0.13mariadb5.7 mysql-5.7.repo</span><br><span class="line">slaveb0172.25.0.14mariadb5.7mysql-5.7.repo</span><br><span class="line">dbproxy0172.25.0.15mysql-proxy0.8.5 thirdpart.repo</span><br><span class="line">2.å®‰è£…è½¯ä»¶</span><br><span class="line">1ï¼‰æ— å¯†ç sshç™»é™†è™šæ‹Ÿæœº</span><br><span class="line"><span class="meta">#</span><span class="bash"> ssh-keygen -t rsa</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> i <span class="keyword">in</span> 10 11 12 13 14 15 ;<span class="keyword">do</span> ssh-copy-id root@172.25.0.<span class="variable">$i</span> ;<span class="keyword">done</span></span></span><br><span class="line"></span><br><span class="line">2ï¼‰å…³é—­selinux,firewalld</span><br><span class="line">for i in 10 11 12 13 14 15 ;\</span><br><span class="line">do ssh root@172.25.0.$i \</span><br><span class="line">"sed -i '/^SELINUX/s/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config;\</span><br><span class="line">grep -v "^#" /etc/selinux/config;\</span><br><span class="line">systemctl stop firewalld;setenforce 0 ";done</span><br><span class="line"></span><br><span class="line">3ï¼‰éœ€è¦å®‰è£…çš„è½¯ä»¶åŒ…wgetï¼Œnet-tools,rpc-bind,nfs-utils,vim</span><br><span class="line">for i in 10 11 12 13 14 ;do ssh root@172.25.0.$i "yum install -y wget net-tools rpc-bind nfs-utils vim ";done</span><br><span class="line"></span><br><span class="line">4ï¼‰æŸ¥çœ‹ipåœ°å€ip addr</span><br><span class="line">5ï¼‰ä¿®æ”¹yumæºï¼Œæ ¹æ®å®é™…éœ€æ±‚æ¥</span><br><span class="line">ä»æœåŠ¡å™¨ä¸Šä¸‹è½½åˆ°/etc/yum.repos.d/ç›®å½•</span><br><span class="line"></span><br><span class="line">6) mastera--slavebå››å°æ•°æ®åº“æœåŠ¡å™¨ï¼Œå®‰è£…mysql5.7ï¼Œå¹¶å¯åŠ¨æœåŠ¡,ä¿®æ”¹åˆå§‹å¯†ç </span><br><span class="line">ä¸ºäº†æµ‹è¯•ä¸­é—´ä»¶çš„åŠŸèƒ½ï¼Œåˆ†åˆ«åˆ›å»ºdb1.t1</span><br><span class="line">masteradb1.t1 (1,'mastera')</span><br><span class="line">masterb db1.t1 (1,'masterb')</span><br><span class="line">slavea db1.t1 (1,'slavea')</span><br><span class="line">slaveb db1.t1 (1,'slaveb')</span><br><span class="line"></span><br><span class="line">7) dbproxyå®‰è£…ä¾èµ–åŒ… (éœ€è¦ç¬¬ä¸‰æ–¹yumæº thirdpart.repo)</span><br><span class="line">yum install -y  gcc* libev lua  lua-devel libevent libevent-devel glib2 glib2-devel pkgconfig mariadb-devel flex</span><br><span class="line"></span><br><span class="line">8) å®‰è£…mysql-proxy</span><br><span class="line"><span class="meta">#</span><span class="bash"> wget http://172.25.254.254/content/courses/db100/rhel7.2/materials/mysql-proxy-0.8.5.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tar -zxf mysql-proxy-0.8.5.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> mysql-proxy-0.8.5</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ./configure --prefix=/usr/<span class="built_in">local</span>/mysql-proxy</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make install</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3) è¿›å…¥mysql-proxyçš„å®¶ç›®å½•/usr/local/mysql-proxy</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mysql-proxy/;ls</span></span><br><span class="line">bin  include  lib  libexec  share</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> bin;ls</span></span><br><span class="line">mysql-binlog-dump  mysql-myisam-dump  mysql-proxy</span><br><span class="line"><span class="meta">#</span><span class="bash"> ./mysql-proxy --<span class="built_in">help</span>-proxy  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†luaè„šæœ¬å¤åˆ¶åˆ°mysql-proxyçš„å®¶ç›®å½•</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cp ~/mysql-proxy-0.8.5/lib/rw-splitting.lua /usr/<span class="built_in">local</span>/mysql-proxy/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨æœåŠ¡</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql-proxy -P 172.25.0.15:3306 -b 172.25.0.11:3306 -b 172.25.0.12:3306 -r 172.25.0.13:3306 -r 172.25.0.14:3306 -s /usr/<span class="built_in">local</span>/mysql-proxy/rw-splitting.lua</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹mysql-proxyç›‘å¬ç«¯å£å·</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> netstat -ntalp|grep 3306</span></span><br><span class="line">tcp        0      0 172.25.0.15:3306        0.0.0.0:*               LISTEN      24483/./mysql-proxy</span><br><span class="line"></span><br><span class="line">4.workstationæµ‹è¯•(éœ€è¦å®‰è£…mariadbå®¢æˆ·ç«¯ï¼Œæˆ–è€…mysqlå®¢æˆ·ç«¯)</span><br><span class="line">å®¢æˆ·ç«¯172.25.0.10</span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql -u<span class="string">'dbproxy'</span> -p<span class="string">'Uploo00king'</span> -h172.25.0.15</span></span><br><span class="line">MySQL [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+---------+</span><br><span class="line">| id | name    |</span><br><span class="line">+----+---------+</span><br><span class="line">|  1 | mastera |</span><br><span class="line">+----+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">***************************************</span><br><span class="line"><span class="meta">#</span><span class="bash">å°†mastera0çš„æœåŠ¡å…³é—­åï¼Œå†æŸ¥çœ‹è¡¨1ä¸­çš„å†…å®¹</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl stop mysqld</span></span><br><span class="line">****************************************</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; select * from db1.t1;</span><br><span class="line">ERROR 2013 (HY000): Lost connection to MySQL server during query</span><br><span class="line">MySQL [(none)]&gt; select * from db1.t1;</span><br><span class="line">ERROR 2006 (HY000): MySQL server has gone away</span><br><span class="line">No connection. Trying to reconnect...</span><br><span class="line">Connection id:    9</span><br><span class="line">Current database: *** NONE ***</span><br><span class="line"></span><br><span class="line">+----+---------+</span><br><span class="line">| id | name    |</span><br><span class="line">+----+---------+</span><br><span class="line">|  1 | masterb |</span><br><span class="line">+----+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">***************************************</span><br><span class="line"><span class="meta">#</span><span class="bash">æ’å…¥æ•°æ®ï¼ŒæŸ¥çœ‹æ’å…¥åˆ°å“ªä¸ªæœåŠ¡å™¨ä¸­äº†</span></span><br><span class="line">****************************************  </span><br><span class="line">MySQL [(none)]&gt; insert into db1.t1 values (2,'test');</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">MySQL [(none)]&gt; select @@hostname;</span><br><span class="line">+----------------------+</span><br><span class="line">| @@hostname           |</span><br><span class="line">+----------------------+</span><br><span class="line">| masterb0.example.com |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">***************************************</span><br><span class="line"><span class="meta">#</span><span class="bash">å°†masterb0çš„æœåŠ¡å…³é—­åï¼Œå†æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl stop mysqld</span></span><br><span class="line">****************************************</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; insert into db1.t1 values (100,'oo');</span><br><span class="line">ERROR 2013 (HY000): Lost connection to MySQL server during query</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; select @@hostname;</span><br><span class="line">ERROR 2013 (HY000): Lost connection to MySQL server during query</span><br><span class="line">MySQL [(none)]&gt; select @@hostname;</span><br><span class="line">ERROR 2006 (HY000): MySQL server has gone away</span><br><span class="line">No connection. Trying to reconnect...</span><br><span class="line">Connection id:    7</span><br><span class="line">Current database: *** NONE ***</span><br><span class="line"></span><br><span class="line">+---------------------+</span><br><span class="line">| @@hostname          |</span><br><span class="line">+---------------------+</span><br><span class="line">| slavea0.example.com |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">***************************************</span><br><span class="line"><span class="meta">#</span><span class="bash">å°†mastera0çš„æœåŠ¡å¯åŠ¨åï¼Œå†æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl start mysqld</span></span><br><span class="line">****************************************</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; select @@hostname;</span><br><span class="line">+----------------------+</span><br><span class="line">| @@hostname           |</span><br><span class="line">+----------------------+</span><br><span class="line">| mastera0.example.com |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; insert into db1.t1 values (101,'oo');</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.07 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; select @@hostname;</span><br><span class="line">+---------------------+</span><br><span class="line">| @@hostname          |</span><br><span class="line">+---------------------+</span><br><span class="line">| slavea0.example.com |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+--------+</span><br><span class="line">| id | name   |</span><br><span class="line">+----+--------+</span><br><span class="line">|  1 | slavea |</span><br><span class="line">+----+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">***************************************</span><br><span class="line"><span class="meta">#</span><span class="bash">æ­¤æ—¶å‘ç°ï¼Œå†™æ“ä½œè¿æ¥masteraï¼Œè¯»æ“ä½œè¿æ¥slavea</span></span><br><span class="line">****************************************</span><br></pre></td></tr></table></figure><blockquote><p>å®æˆ˜é¡¹ç›®2ï¼šæ•°æ®åº“ä¸­é—´ä»¶ mysql-proxy 0.8.5 å®ç° è¯»å†™åˆ†ç¦»è´Ÿè½½å‡è¡¡ï¼Œåç«¯æ•°æ®åº“æœåŠ¡å™¨ä¸º Mariadb 10.2 Galera Cluster åŒæ­¥å¤åˆ¶é«˜å¯ç”¨æ¶æ„</p></blockquote><blockquote><p>å®æˆ˜é¡¹ç›®3: æ•°æ®åº“ä¸­é—´ä»¶ Mycat å®ç° è¯»å†™åˆ†ç¦»è´Ÿè½½å‡è¡¡ï¼Œåç«¯æ•°æ®åº“æœåŠ¡å™¨ä¸º Mariadb 10.2 Galera Cluster åŒæ­¥å¤åˆ¶é«˜å¯ç”¨æ¶æ„</p></blockquote><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol><li>Galera Clusteræ˜¯MariaDBçš„ä¸€ä¸ªåŒæ´»å¤šä¸»é›†ç¾¤,å…¶å¯ä»¥ä½¿å¾—MariDBçš„æ‰€æœ‰èŠ‚ç‚¹ä¿æŒåŒæ­¥,Galeraä¸ºMariaDBæä¾›äº†åŒæ­¥å¤åˆ¶(ç›¸å¯¹äºåŸç”Ÿçš„å¼‚æ­¥å¤åˆ¶),å› æ­¤å…¶å¯ä»¥ä¿è¯HA,ä¸”å…¶å½“å‰ä»…æ”¯æŒXtraDB/InnoDBå­˜å‚¨å¼•æ“(æ‰©å±•æ”¯æŒMyISAM),å¹¶ä¸”åªå¯åœ¨Linuxä¸‹ä½¿ç”¨ã€‚</li><li>mariadb10.2çš„galeraç‰ˆæœ¬å’Œä¹‹å‰ç‰ˆæœ¬æœ‰æ‰€åŒºåˆ«ï¼Œéœ€è¦æ³¨æ„</li><li>mysql-proxyè¿˜æ²¡æœ‰æ­£å¼ç‰ˆï¼Œé—®é¢˜æ¯”è¾ƒå¤šï¼Œå®‰è£…éœ€è¦æºç ç¼–è¯‘ï¼Œä½¿ç”¨luaè„šæœ¬å®ç°è¯»å†™åˆ†ç¦»ï¼›</li><li>mycatæ˜¯ç›®å‰å¼€æºé‡Œé¢åšçš„æœ€å¥½çš„æ•°æ®åº“ä»£ç†æœåŠ¡å™¨ï¼ŒtaråŒ…è§£å‹åˆ°åˆ¶å®šç›®å½•å°±èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯æ³¨æ„éœ€è¦å®‰è£…jdkï¼Œå¹¶å®£å‘Šjavaå®¶ç›®å½•çš„ä½ç½®ã€‚</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;ä»€ä¹ˆæ˜¯é«˜å¯ç”¨&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯é«˜å¯ç”¨&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯é«˜å¯ç”¨&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯é«˜å¯ç”¨&lt;/h3&gt;&lt;p&gt;é«˜å¯ç”¨æ€§å®é™…ä¸Šæœ‰ç‚¹åƒç¥ç§˜çš„é‡å…½ã€‚å®ƒé€šå¸¸æ˜¯ä»¥ç™¾åˆ†æ¯”è¡¨ç¤ºï¼Œè¿™æœ¬èº«ä¹Ÿæ˜¯ä¸€ç§æš—ç¤ºï¼šé«˜å¯ç”¨æ€§ä¸æ˜¯ç»å¯¹çš„ï¼Œåªæœ‰ç›¸å¯¹æ›´é«˜çš„
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†" scheme="http://www.toberoot.com/tags/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬åä¸€è¯¾  MySQLé€»è¾‘å¤‡ä»½å·¥å…·mysqldump,mysqlpump,mydumper</title>
    <link href="http://www.toberoot.com/2016/12/25/booboo_mysql/08-MySQL%E9%80%BB%E8%BE%91%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7mysqldump&amp;mysqlpump&amp;mydumper/"/>
    <id>http://www.toberoot.com/2016/12/25/booboo_mysql/08-MySQL%E9%80%BB%E8%BE%91%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7mysqldump&amp;mysqlpump&amp;mydumper/</id>
    <published>2016-12-24T21:06:27.000Z</published>
    <updated>2020-03-24T05:27:17.977Z</updated>
    
    <content type="html"><![CDATA[<h2 id="mysqldump"><a href="#mysqldump" class="headerlink" title="mysqldump"></a>mysqldump</h2><p>mysqlç»å…¸é€»è¾‘å¤‡ä»½å·¥å…·</p><p>å‚æ•°è¯´æ˜ï¼Œå…·ä½“çš„å‚æ•°å¯ä»¥ç”¨mysqldump â€“helpæŸ¥çœ‹ã€‚</p><p>æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªå‚æ•°</p><p>â‘ ï¼šâ€“single-transaction</p><p>é€šè¿‡å°†å¯¼å‡ºæ“ä½œå°è£…åœ¨ä¸€ä¸ªäº‹åŠ¡(Repeatable Read)å†…æ¥ä½¿å¾—å¯¼å‡ºçš„æ•°æ®æ˜¯ä¸€ä¸ªä¸€è‡´æ€§å¿«ç…§ã€‚åªæœ‰å½“è¡¨ä½¿ç”¨æ”¯æŒMVCCçš„å­˜å‚¨å¼•æ“ï¼ˆç›®å‰åªæœ‰InnoDBï¼‰æ—¶æ‰å¯ä»¥å·¥ä½œï¼›å…¶ä»–å¼•æ“ä¸èƒ½ä¿è¯å¯¼å‡ºæ˜¯ä¸€è‡´çš„ã€‚å½“å¯¼å‡ºå¼€å¯äº†â€“single-transactioné€‰é¡¹æ—¶ï¼Œè¦ç¡®ä¿å¯¼å‡ºæ–‡ä»¶æœ‰æ•ˆï¼ˆæ­£ç¡®çš„è¡¨æ•°æ®å’ŒäºŒè¿›åˆ¶æ—¥å¿—ä½ç½®ï¼‰ï¼Œå°±è¦ä¿è¯æ²¡æœ‰å…¶ä»–è¿æ¥ä¼šæ‰§è¡Œå¦‚ä¸‹è¯­å¥ï¼šALTER TABLE, DROP TABLE, RENAME TABLE, TRUNCATE TABLEï¼Œè¿™ä¼šå¯¼è‡´ä¸€è‡´æ€§å¿«ç…§å¤±æ•ˆã€‚è¿™ä¸ªé€‰é¡¹å¼€å¯åä¼šè‡ªåŠ¨å…³é—­lock-tablesã€‚å¹¶ä¸”åœ¨mysql5.7.11ä¹‹å‰ï¼Œâ€“default-parallelismå¤§äº1çš„æ—¶å€™å’Œæ­¤å‚ä¹Ÿäº’æ–¥ï¼Œå¿…é¡»ä½¿ç”¨â€“default-parallelism=0ã€‚5.7.11ä¹‹åè§£å†³äº†â€“single-transactionå’Œâ€“default-parallelismçš„äº’æ–¥é—®é¢˜ã€‚</p><p>â‘¡ï¼šâ€“master-data</p><p>è¿™ä¸ªé€‰é¡¹å¯ä»¥æŠŠbinlogçš„ä½ç½®å’Œæ–‡ä»¶åæ·»åŠ åˆ°è¾“å‡ºä¸­ï¼Œå¦‚æœç­‰äº1ï¼Œå°†ä¼šæ‰“å°æˆä¸€ä¸ªCHANGE MASTERå‘½ä»¤ï¼›å¦‚æœç­‰äº2ï¼Œä¼šåŠ ä¸Šæ³¨é‡Šå‰ç¼€ã€‚å¹¶ä¸”è¿™ä¸ªé€‰é¡¹ä¼šè‡ªåŠ¨æ‰“å¼€â€“lock-all-tablesï¼Œé™¤éåŒæ—¶è®¾ç½®äº†â€“single-transactionï¼ˆè¿™ç§æƒ…å†µä¸‹ï¼Œå…¨å±€è¯»é”åªä¼šåœ¨å¼€å§‹dumpçš„æ—¶å€™åŠ ä¸Šä¸€å°æ®µæ—¶é—´ï¼Œä¸è¦å¿˜äº†é˜…è¯»â€“single-transactionçš„éƒ¨åˆ†ï¼‰ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ—¥å¿—ä¸­çš„æ“ä½œéƒ½ä¼šå‘ç”Ÿåœ¨å¯¼å‡ºçš„å‡†ç¡®æ—¶åˆ»ã€‚è¿™ä¸ªé€‰é¡¹ä¼šè‡ªåŠ¨å…³é—­â€“lock-tablesã€‚æ‰“å¼€è¯¥å‚æ•°éœ€è¦æœ‰reloadæƒé™ï¼Œå¹¶ä¸”æœåŠ¡å™¨å¼€å¯binlogã€‚</p><p>â‘¢ï¼šâ€“lock-all-tables ï¼Œ-x</p><p>é”å®šæ‰€æœ‰åº“ä¸­æ‰€æœ‰çš„è¡¨ã€‚è¿™æ˜¯é€šè¿‡åœ¨æ•´ä¸ªdumpçš„è¿‡ç¨‹ä¸­æŒæœ‰å…¨å±€è¯»é”æ¥å®ç°çš„ã€‚ä¼šè‡ªåŠ¨å…³é—­â€“single-transaction å’Œ â€“lock-tablesã€‚</p><p>â‘£ï¼šâ€“lock-tablesï¼Œ-l</p><p>å¤‡ä»½æŸä¸ªåº“å°±é”è¯¥åº“çš„æ‰€æœ‰è¡¨ï¼Œç”¨READ LOCALæ¥é”è¡¨ã€‚MyISAMå…è®¸å¹¶å‘å†™å…¥ï¼Œå› ä¸ºé”è¡¨åªé’ˆå¯¹æŒ‡å®šçš„æ•°æ®åº“ï¼Œä¸èƒ½ä¿è¯ç‰©ç†ä¸Šçš„ä¸€è‡´æ€§ï¼Œä¸åŒåº“çš„è¡¨å¤‡ä»½å®Œæˆæ—¶ä¼šæœ‰ä¸åŒçš„çŠ¶æ€ã€‚ç”¨â€“skip-lock-tablesæ¥å…³é—­ã€‚</p><p>â‘¤ï¼šâ€“flush-logsï¼Œ-F</p><p>åœ¨å¼€å§‹å¯¼å‡ºå‰åˆ·æ–°æœåŠ¡å™¨çš„æ—¥å¿—æ–‡ä»¶ã€‚æ³¨æ„ï¼Œå¦‚æœä½ ä¸€æ¬¡æ€§å¯¼å‡ºå¾ˆå¤šæ•°æ®åº“ï¼ˆä½¿ç”¨â€“databases= æˆ–â€“all-databases é€‰é¡¹ï¼‰ï¼Œå¯¼å‡ºæ¯ä¸ªåº“æ—¶éƒ½ä¼šè§¦å‘æ—¥å¿—åˆ·æ–°ã€‚ä¾‹å¤–æ˜¯å½“ä½¿ç”¨äº†â€“lock-all-tablesã€â€“master-dataæˆ–â€“single-transactionæ—¶ï¼šæ—¥å¿—åªä¼šè¢«åˆ·æ–°ä¸€æ¬¡ï¼Œé‚£ä¸ªæ—¶å€™æ‰€æœ‰è¡¨éƒ½ä¼šè¢«é”ä½ã€‚æ‰€ä»¥å¦‚æœä½ å¸Œæœ›ä½ çš„å¯¼å‡ºå’Œæ—¥å¿—åˆ·æ–°å‘ç”Ÿåœ¨åŒä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä½ éœ€è¦ä½¿ç”¨â€“lock-all-tablesã€â€“master-dataå’Œâ€“single-transactioné…åˆ â€“flush-logsã€‚</p><p>â‘¥ï¼šâ€“opt</p><p>è¯¥å‚æ•°é»˜è®¤å¼€å¯ï¼Œè¡¨ç¤ºå¿«é€’å¯åŠ¨â€“add-drop-table â€“add-locks â€“create-options â€“disable-keys â€“extended-insert â€“lock-tables â€“quick â€“set-charseté€‰é¡¹ï¼Œé€šè¿‡ â€“skip-opt å…³é—­ã€‚</p><p>â€“all-databases  , -A<br>å¯¼å‡ºå…¨éƒ¨æ•°æ®åº“ã€‚</p><p>â€“all-tablespaces  , -Y<br>å¯¼å‡ºå…¨éƒ¨è¡¨ç©ºé—´ã€‚</p><p>â€“no-tablespaces  , -y<br>ä¸å¯¼å‡ºä»»ä½•è¡¨ç©ºé—´ä¿¡æ¯ã€‚</p><p>â€“add-drop-database<br>æ¯ä¸ªæ•°æ®åº“åˆ›å»ºä¹‹å‰æ·»åŠ dropæ•°æ®åº“è¯­å¥ã€‚</p><p>â€“add-drop-table<br>æ¯ä¸ªæ•°æ®è¡¨åˆ›å»ºä¹‹å‰æ·»åŠ dropæ•°æ®è¡¨è¯­å¥ã€‚(é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨â€“skip-add-drop-tableå–æ¶ˆé€‰é¡¹)</p><p>â€“add-locks<br>åœ¨æ¯ä¸ªè¡¨å¯¼å‡ºä¹‹å‰å¢åŠ LOCK TABLESå¹¶ä¸”ä¹‹åUNLOCK  TABLEã€‚(é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨â€“skip-add-lockså–æ¶ˆé€‰é¡¹)</p><p>â€“allow-keywords<br>å…è®¸åˆ›å»ºæ˜¯å…³é”®è¯çš„åˆ—åå­—ã€‚è¿™ç”±è¡¨åå‰ç¼€äºæ¯ä¸ªåˆ—ååšåˆ°ã€‚</p><p>â€“apply-slave-statements<br>åœ¨â€™CHANGE MASTERâ€™å‰æ·»åŠ â€™STOP SLAVEâ€™ï¼Œå¹¶ä¸”åœ¨å¯¼å‡ºçš„æœ€åæ·»åŠ â€™START SLAVEâ€™ã€‚</p><p>â€“character-sets-dir<br>å­—ç¬¦é›†æ–‡ä»¶çš„ç›®å½•</p><p>â€“comments<br>é™„åŠ æ³¨é‡Šä¿¡æ¯ã€‚é»˜è®¤ä¸ºæ‰“å¼€ï¼Œå¯ä»¥ç”¨â€“skip-commentså–æ¶ˆ</p><p>â€“compatible<br>å¯¼å‡ºçš„æ•°æ®å°†å’Œå…¶å®ƒæ•°æ®åº“æˆ–æ—§ç‰ˆæœ¬çš„MySQL ç›¸å…¼å®¹ã€‚å€¼å¯ä»¥ä¸ºansiã€mysql323ã€mysql40ã€postgresqlã€oracleã€mssqlã€db2ã€maxdbã€no_key_optionsã€no_tables_optionsã€no_field_optionsç­‰ï¼Œ<br>è¦ä½¿ç”¨å‡ ä¸ªå€¼ï¼Œç”¨é€—å·å°†å®ƒä»¬éš”å¼€ã€‚å®ƒå¹¶ä¸ä¿è¯èƒ½å®Œå…¨å…¼å®¹ï¼Œè€Œæ˜¯å°½é‡å…¼å®¹ã€‚</p><p>â€“compact<br>å¯¼å‡ºæ›´å°‘çš„è¾“å‡ºä¿¡æ¯(ç”¨äºè°ƒè¯•)ã€‚å»æ‰æ³¨é‡Šå’Œå¤´å°¾ç­‰ç»“æ„ã€‚å¯ä»¥ä½¿ç”¨é€‰é¡¹ï¼šâ€“skip-add-drop-table  â€“skip-add-locks â€“skip-comments â€“skip-disable-keys</p><p>â€“complete-insert,  -c<br>ä½¿ç”¨å®Œæ•´çš„insertè¯­å¥(åŒ…å«åˆ—åç§°)ã€‚è¿™ä¹ˆåšèƒ½æé«˜æ’å…¥æ•ˆç‡ï¼Œä½†æ˜¯å¯èƒ½ä¼šå—åˆ°max_allowed_packetå‚æ•°çš„å½±å“è€Œå¯¼è‡´æ’å…¥å¤±è´¥ã€‚</p><p>â€“compress, -C<br>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å¯ç”¨å‹ç¼©ä¼ é€’æ‰€æœ‰ä¿¡æ¯</p><p>â€“create-options,  -a<br>åœ¨CREATE TABLEè¯­å¥ä¸­åŒ…æ‹¬æ‰€æœ‰MySQLç‰¹æ€§é€‰é¡¹ã€‚(é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€)</p><p>â€“databases,  -B<br>å¯¼å‡ºå‡ ä¸ªæ•°æ®åº“ã€‚å‚æ•°åé¢æ‰€æœ‰åå­—å‚é‡éƒ½è¢«çœ‹ä½œæ•°æ®åº“åã€‚</p><p>â€“debug<br>è¾“å‡ºdebugä¿¡æ¯ï¼Œç”¨äºè°ƒè¯•ã€‚é»˜è®¤å€¼ä¸ºï¼šd:t:o,/tmp/mysqldump.trace</p><p>â€“debug-check<br>æ£€æŸ¥å†…å­˜å’Œæ‰“å¼€æ–‡ä»¶ä½¿ç”¨è¯´æ˜å¹¶é€€å‡ºã€‚</p><p>â€“debug-info<br>è¾“å‡ºè°ƒè¯•ä¿¡æ¯å¹¶é€€å‡º</p><p>â€“default-character-set<br>è®¾ç½®é»˜è®¤å­—ç¬¦é›†ï¼Œé»˜è®¤å€¼ä¸ºutf8</p><p>â€“delayed-insert<br>é‡‡ç”¨å»¶æ—¶æ’å…¥æ–¹å¼ï¼ˆINSERT DELAYEDï¼‰å¯¼å‡ºæ•°æ®</p><p>â€“delete-master-logs<br>masterå¤‡ä»½ååˆ é™¤æ—¥å¿—. è¿™ä¸ªå‚æ•°å°†è‡ªåŠ¨æ¿€æ´»â€“master-dataã€‚</p><p>â€“disable-keys<br>å¯¹äºæ¯ä¸ªè¡¨ï¼Œç”¨/<em>!40000 ALTER TABLE tbl_name DISABLE KEYS */;å’Œ/</em>!40000 ALTER TABLE tbl_name ENABLE KEYS */;è¯­å¥å¼•ç”¨INSERTè¯­å¥ã€‚è¿™æ ·å¯ä»¥æ›´å¿«åœ°å¯¼å…¥dumpå‡ºæ¥çš„æ–‡ä»¶ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨æ’å…¥æ‰€æœ‰è¡Œååˆ›å»ºç´¢å¼•çš„ã€‚è¯¥é€‰é¡¹åªé€‚åˆMyISAMè¡¨ï¼Œé»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ã€‚</p><p>â€“dump-slave<br>è¯¥é€‰é¡¹å°†å¯¼è‡´ä¸»çš„binlogä½ç½®å’Œæ–‡ä»¶åè¿½åŠ åˆ°å¯¼å‡ºæ•°æ®çš„æ–‡ä»¶ä¸­ã€‚è®¾ç½®ä¸º1æ—¶ï¼Œå°†ä¼šä»¥CHANGE MASTERå‘½ä»¤è¾“å‡ºåˆ°æ•°æ®æ–‡ä»¶ï¼›è®¾ç½®ä¸º2æ—¶ï¼Œåœ¨å‘½ä»¤å‰å¢åŠ è¯´æ˜ä¿¡æ¯ã€‚è¯¥é€‰é¡¹å°†ä¼šæ‰“å¼€â€“lock-all-tablesï¼Œé™¤éâ€“single-transactionè¢«æŒ‡å®šã€‚è¯¥é€‰é¡¹ä¼šè‡ªåŠ¨å…³é—­â€“lock-tablesé€‰é¡¹ã€‚é»˜è®¤å€¼ä¸º0ã€‚</p><p>â€“events, -E<br>å¯¼å‡ºäº‹ä»¶ã€‚</p><p>â€“extended-insert,  -e<br>ä½¿ç”¨å…·æœ‰å¤šä¸ªVALUESåˆ—çš„INSERTè¯­æ³•ã€‚è¿™æ ·ä½¿å¯¼å‡ºæ–‡ä»¶æ›´å°ï¼Œå¹¶åŠ é€Ÿå¯¼å…¥æ—¶çš„é€Ÿåº¦ã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨â€“skip-extended-insertå–æ¶ˆé€‰é¡¹ã€‚</p><p>â€“fields-terminated-by<br>å¯¼å‡ºæ–‡ä»¶ä¸­å¿½ç•¥ç»™å®šå­—æ®µã€‚ä¸â€“tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äºâ€“databaseså’Œâ€“all-databasesé€‰é¡¹</p><p>â€“fields-enclosed-by<br>è¾“å‡ºæ–‡ä»¶ä¸­çš„å„ä¸ªå­—æ®µç”¨ç»™å®šå­—ç¬¦åŒ…è£¹ã€‚ä¸â€“tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äºâ€“databaseså’Œâ€“all-databasesé€‰é¡¹</p><p>â€“fields-optionally-enclosed-by<br>è¾“å‡ºæ–‡ä»¶ä¸­çš„å„ä¸ªå­—æ®µç”¨ç»™å®šå­—ç¬¦é€‰æ‹©æ€§åŒ…è£¹ã€‚ä¸â€“tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äºâ€“databaseså’Œâ€“all-databasesé€‰é¡¹</p><p>â€“fields-escaped-by<br>è¾“å‡ºæ–‡ä»¶ä¸­çš„å„ä¸ªå­—æ®µå¿½ç•¥ç»™å®šå­—ç¬¦ã€‚ä¸â€“tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äºâ€“databaseså’Œâ€“all-databasesé€‰é¡¹</p><p>â€“flush-logs<br>å¼€å§‹å¯¼å‡ºä¹‹å‰åˆ·æ–°æ—¥å¿—ã€‚<br>è¯·æ³¨æ„ï¼šå‡å¦‚ä¸€æ¬¡å¯¼å‡ºå¤šä¸ªæ•°æ®åº“(ä½¿ç”¨é€‰é¡¹â€“databasesæˆ–è€…â€“all-databases)ï¼Œå°†ä¼šé€ä¸ªæ•°æ®åº“åˆ·æ–°æ—¥å¿—ã€‚é™¤ä½¿ç”¨â€“lock-all-tablesæˆ–è€…â€“master-dataå¤–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ—¥å¿—å°†ä¼šè¢«åˆ·æ–°ä¸€æ¬¡ï¼Œç›¸åº”çš„æ‰€ä»¥è¡¨åŒæ—¶è¢«é”å®šã€‚å› æ­¤ï¼Œå¦‚æœæ‰“ç®—åŒæ—¶å¯¼å‡ºå’Œåˆ·æ–°æ—¥å¿—åº”è¯¥ä½¿ç”¨â€“lock-all-tables æˆ–è€…â€“master-data å’Œâ€“flush-logsã€‚</p><p>â€“flush-privileges<br>åœ¨å¯¼å‡ºmysqlæ•°æ®åº“ä¹‹åï¼Œå‘å‡ºä¸€æ¡FLUSH  PRIVILEGES è¯­å¥ã€‚ä¸ºäº†æ­£ç¡®æ¢å¤ï¼Œè¯¥é€‰é¡¹åº”è¯¥ç”¨äºå¯¼å‡ºmysqlæ•°æ®åº“å’Œä¾èµ–mysqlæ•°æ®åº“æ•°æ®çš„ä»»ä½•æ—¶å€™ã€‚</p><p>â€“force<br>åœ¨å¯¼å‡ºè¿‡ç¨‹ä¸­å¿½ç•¥å‡ºç°çš„SQLé”™è¯¯ã€‚</p><p>â€“help<br>æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡ºã€‚</p><p>â€“hex-blob<br>ä½¿ç”¨åå…­è¿›åˆ¶æ ¼å¼å¯¼å‡ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²å­—æ®µã€‚å¦‚æœæœ‰äºŒè¿›åˆ¶æ•°æ®å°±å¿…é¡»ä½¿ç”¨è¯¥é€‰é¡¹ã€‚å½±å“åˆ°çš„å­—æ®µç±»å‹æœ‰BINARYã€VARBINARYã€BLOBã€‚</p><p>â€“host, -h<br>éœ€è¦å¯¼å‡ºçš„ä¸»æœºä¿¡æ¯</p><p>â€“ignore-table<br>ä¸å¯¼å‡ºæŒ‡å®šè¡¨ã€‚æŒ‡å®šå¿½ç•¥å¤šä¸ªè¡¨æ—¶ï¼Œéœ€è¦é‡å¤å¤šæ¬¡ï¼Œæ¯æ¬¡ä¸€ä¸ªè¡¨ã€‚æ¯ä¸ªè¡¨å¿…é¡»åŒæ—¶æŒ‡å®šæ•°æ®åº“å’Œè¡¨åã€‚ä¾‹å¦‚ï¼šâ€“ignore-table=database.table1 â€“ignore-table=database.table2 â€¦â€¦</p><p>â€“include-master-host-port<br>åœ¨â€“dump-slaveäº§ç”Ÿçš„â€™CHANGE  MASTER TO..â€™è¯­å¥ä¸­å¢åŠ â€™MASTER_HOST=<host>ï¼ŒMASTER_PORT=<port>â€˜  </p><p>â€“insert-ignore<br>åœ¨æ’å…¥è¡Œæ—¶ä½¿ç”¨INSERT IGNOREè¯­å¥.</p><p>â€“lines-terminated-by<br>è¾“å‡ºæ–‡ä»¶çš„æ¯è¡Œç”¨ç»™å®šå­—ç¬¦ä¸²åˆ’åˆ†ã€‚ä¸â€“tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äºâ€“databaseså’Œâ€“all-databasesé€‰é¡¹ã€‚</p><p>â€“lock-all-tables,  -x<br>æäº¤è¯·æ±‚é”å®šæ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ï¼Œä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚è¿™æ˜¯ä¸€ä¸ªå…¨å±€è¯»é”ï¼Œå¹¶ä¸”è‡ªåŠ¨å…³é—­â€“single-transaction å’Œâ€“lock-tables é€‰é¡¹ã€‚</p><p>â€“lock-tables,  -l<br>å¼€å§‹å¯¼å‡ºå‰ï¼Œé”å®šæ‰€æœ‰è¡¨ã€‚ç”¨READ  LOCALé”å®šè¡¨ä»¥å…è®¸MyISAMè¡¨å¹¶è¡Œæ’å…¥ã€‚å¯¹äºæ”¯æŒäº‹åŠ¡çš„è¡¨ä¾‹å¦‚InnoDBå’ŒBDBï¼Œâ€“single-transactionæ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒæ ¹æœ¬ä¸éœ€è¦é”å®šè¡¨ã€‚<br>è¯·æ³¨æ„å½“å¯¼å‡ºå¤šä¸ªæ•°æ®åº“æ—¶ï¼Œâ€“lock-tablesåˆ†åˆ«ä¸ºæ¯ä¸ªæ•°æ®åº“é”å®šè¡¨ã€‚å› æ­¤ï¼Œè¯¥é€‰é¡¹ä¸èƒ½ä¿è¯å¯¼å‡ºæ–‡ä»¶ä¸­çš„è¡¨åœ¨æ•°æ®åº“ä¹‹é—´çš„é€»è¾‘ä¸€è‡´æ€§ã€‚ä¸åŒæ•°æ®åº“è¡¨çš„å¯¼å‡ºçŠ¶æ€å¯ä»¥å®Œå…¨ä¸åŒã€‚</p><p>â€“log-error<br>é™„åŠ è­¦å‘Šå’Œé”™è¯¯ä¿¡æ¯åˆ°ç»™å®šæ–‡ä»¶</p><p>â€“master-data<br>è¯¥é€‰é¡¹å°†binlogçš„ä½ç½®å’Œæ–‡ä»¶åè¿½åŠ åˆ°è¾“å‡ºæ–‡ä»¶ä¸­ã€‚å¦‚æœä¸º1ï¼Œå°†ä¼šè¾“å‡ºCHANGE MASTER å‘½ä»¤ï¼›å¦‚æœä¸º2ï¼Œè¾“å‡ºçš„CHANGE  MASTERå‘½ä»¤å‰æ·»åŠ æ³¨é‡Šä¿¡æ¯ã€‚è¯¥é€‰é¡¹å°†æ‰“å¼€â€“lock-all-tables é€‰é¡¹ï¼Œé™¤éâ€“single-transactionä¹Ÿè¢«æŒ‡å®šï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¨å±€è¯»é”åœ¨å¼€å§‹å¯¼å‡ºæ—¶è·å¾—å¾ˆçŸ­çš„æ—¶é—´ï¼›å…¶ä»–å†…å®¹å‚è€ƒä¸‹é¢çš„â€“single-transactioné€‰é¡¹ï¼‰ã€‚è¯¥é€‰é¡¹è‡ªåŠ¨å…³é—­â€“lock-tablesé€‰é¡¹ã€‚</p><p>â€“max_allowed_packet<br>æœåŠ¡å™¨å‘é€å’Œæ¥å—çš„æœ€å¤§åŒ…é•¿åº¦ã€‚</p><p>â€“net_buffer_length<br>TCP/IPå’Œsocketè¿æ¥çš„ç¼“å­˜å¤§å°ã€‚</p><p>â€“no-autocommit<br>ä½¿ç”¨autocommit/commit è¯­å¥åŒ…è£¹è¡¨ã€‚</p><p>â€“no-create-db,  -n<br>åªå¯¼å‡ºæ•°æ®ï¼Œè€Œä¸æ·»åŠ CREATE DATABASE è¯­å¥ã€‚</p><p>â€“no-create-info,  -t<br>åªå¯¼å‡ºæ•°æ®ï¼Œè€Œä¸æ·»åŠ CREATE TABLE è¯­å¥ã€‚</p><p>â€“no-data, -d<br>ä¸å¯¼å‡ºä»»ä½•æ•°æ®ï¼Œåªå¯¼å‡ºæ•°æ®åº“è¡¨ç»“æ„ã€‚</p><p>â€“no-set-names,  -N<br>ç­‰åŒäºâ€“skip-set-charset</p><p>â€“opt<br>ç­‰åŒäºâ€“add-drop-table,  â€“add-locks, â€“create-options, â€“quick, â€“extended-insert, â€“lock-tables,  â€“set-charset, â€“disable-keys è¯¥é€‰é¡¹é»˜è®¤å¼€å¯,  å¯ä»¥ç”¨â€“skip-optç¦ç”¨.</p><p>â€“order-by-primary<br>å¦‚æœå­˜åœ¨ä¸»é”®ï¼Œæˆ–è€…ç¬¬ä¸€ä¸ªå”¯ä¸€é”®ï¼Œå¯¹æ¯ä¸ªè¡¨çš„è®°å½•è¿›è¡Œæ’åºã€‚åœ¨å¯¼å‡ºMyISAMè¡¨åˆ°InnoDBè¡¨æ—¶æœ‰æ•ˆï¼Œä½†ä¼šä½¿å¾—å¯¼å‡ºå·¥ä½œèŠ±è´¹å¾ˆé•¿æ—¶é—´ã€‚ </p><p>â€“password, -p<br>è¿æ¥æ•°æ®åº“å¯†ç </p><p>â€“pipe(windowsç³»ç»Ÿå¯ç”¨)<br>ä½¿ç”¨å‘½åç®¡é“è¿æ¥mysql</p><p>â€“port, -P<br>è¿æ¥æ•°æ®åº“ç«¯å£å·</p><p>â€“protocol<br>ä½¿ç”¨çš„è¿æ¥åè®®ï¼ŒåŒ…æ‹¬ï¼štcp, socket, pipe, memory.</p><p>â€“quick, -q<br>ä¸ç¼“å†²æŸ¥è¯¢ï¼Œç›´æ¥å¯¼å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨â€“skip-quickå–æ¶ˆè¯¥é€‰é¡¹ã€‚</p><p>â€“quote-names,-Q<br>ä½¿ç”¨ï¼ˆ`ï¼‰å¼•èµ·è¡¨å’Œåˆ—åã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨â€“skip-quote-nameså–æ¶ˆè¯¥é€‰é¡¹ã€‚</p><p>â€“replace<br>ä½¿ç”¨REPLACE INTO å–ä»£INSERT INTO.</p><p>â€“result-file,  -r<br>ç›´æ¥è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ä¸­ã€‚è¯¥é€‰é¡¹åº”è¯¥ç”¨åœ¨ä½¿ç”¨å›è½¦æ¢è¡Œå¯¹ï¼ˆ\r\nï¼‰æ¢è¡Œçš„ç³»ç»Ÿä¸Šï¼ˆä¾‹å¦‚ï¼šDOSï¼ŒWindowsï¼‰ã€‚è¯¥é€‰é¡¹ç¡®ä¿åªæœ‰ä¸€è¡Œè¢«ä½¿ç”¨ã€‚</p><p>â€“routines, -R<br>å¯¼å‡ºå­˜å‚¨è¿‡ç¨‹ä»¥åŠè‡ªå®šä¹‰å‡½æ•°ã€‚</p><p>â€“set-charset<br>æ·»åŠ â€™SET NAMES  default_character_setâ€™åˆ°è¾“å‡ºæ–‡ä»¶ã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨â€“skip-set-charsetå…³é—­é€‰é¡¹ã€‚</p><p>â€“single-transaction<br>è¯¥é€‰é¡¹åœ¨å¯¼å‡ºæ•°æ®ä¹‹å‰æäº¤ä¸€ä¸ªBEGIN SQLè¯­å¥ï¼ŒBEGIN ä¸ä¼šé˜»å¡ä»»ä½•åº”ç”¨ç¨‹åºä¸”èƒ½ä¿è¯å¯¼å‡ºæ—¶æ•°æ®åº“çš„ä¸€è‡´æ€§çŠ¶æ€ã€‚å®ƒåªé€‚ç”¨äºå¤šç‰ˆæœ¬å­˜å‚¨å¼•æ“ï¼Œä»…InnoDBã€‚æœ¬é€‰é¡¹å’Œâ€“lock-tables é€‰é¡¹æ˜¯äº’æ–¥çš„ï¼Œå› ä¸ºLOCK  TABLES ä¼šä½¿ä»»ä½•æŒ‚èµ·çš„äº‹åŠ¡éšå«æäº¤ã€‚è¦æƒ³å¯¼å‡ºå¤§è¡¨çš„è¯ï¼Œåº”ç»“åˆä½¿ç”¨â€“quick é€‰é¡¹ã€‚</p><p>â€“dump-date<br>å°†å¯¼å‡ºæ—¶é—´æ·»åŠ åˆ°è¾“å‡ºæ–‡ä»¶ä¸­ã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨â€“skip-dump-dateå…³é—­é€‰é¡¹ã€‚</p><p>â€“skip-opt<br>ç¦ç”¨â€“opté€‰é¡¹.</p><p>â€“socket,-S<br>`æŒ‡å®šè¿æ¥mysqlçš„socketæ–‡ä»¶ä½ç½®ï¼Œé»˜è®¤è·¯å¾„/tmp/mysql.sock</p><p>â€“tab,-T<br>ä¸ºæ¯ä¸ªè¡¨åœ¨ç»™å®šè·¯å¾„åˆ›å»ºtabåˆ†å‰²çš„æ–‡æœ¬æ–‡ä»¶ã€‚æ³¨æ„ï¼šä»…ä»…ç”¨äºmysqldumpå’ŒmysqldæœåŠ¡å™¨è¿è¡Œåœ¨ç›¸åŒæœºå™¨ä¸Šã€‚</p><p>â€“tables<br>è¦†ç›–â€“databases (-B)å‚æ•°ï¼ŒæŒ‡å®šéœ€è¦å¯¼å‡ºçš„è¡¨åã€‚</p><p>â€“triggers</p><p>å¯¼å‡ºè§¦å‘å™¨ã€‚è¯¥é€‰é¡¹é»˜è®¤å¯ç”¨ï¼Œç”¨â€“skip-triggersç¦ç”¨å®ƒã€‚<br>`<br>â€“tz-utc<br>åœ¨å¯¼å‡ºé¡¶éƒ¨è®¾ç½®æ—¶åŒºTIME_ZONE=â€™+00:00â€™ ï¼Œä»¥ä¿è¯åœ¨ä¸åŒæ—¶åŒºå¯¼å‡ºçš„TIMESTAMP æ•°æ®æˆ–è€…æ•°æ®è¢«ç§»åŠ¨å…¶ä»–æ—¶åŒºæ—¶çš„æ­£ç¡®æ€§ã€‚</p><p>â€“user, -u<br>æŒ‡å®šè¿æ¥çš„ç”¨æˆ·åã€‚</p><p>â€“verbose, â€“v<br>è¾“å‡ºå¤šç§å¹³å°ä¿¡æ¯ã€‚</p><p>â€“version, -V<br>è¾“å‡ºmysqldumpç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡º</p><p>â€“where, -w<br>åªè½¬å‚¨ç»™å®šçš„WHEREæ¡ä»¶é€‰æ‹©çš„è®°å½•ã€‚è¯·æ³¨æ„å¦‚æœæ¡ä»¶åŒ…å«å‘½ä»¤è§£é‡Šç¬¦ä¸“ç”¨ç©ºæ ¼æˆ–å­—ç¬¦ï¼Œä¸€å®šè¦å°†æ¡ä»¶å¼•ç”¨èµ·æ¥ã€‚</p><p>â€“xml, -X<br>å¯¼å‡ºXMLæ ¼å¼.</p><p>â€“plugin_dir<br>å®¢æˆ·ç«¯æ’ä»¶çš„ç›®å½•ï¼Œç”¨äºå…¼å®¹ä¸åŒçš„æ’ä»¶ç‰ˆæœ¬ã€‚</p><p>â€“default_auth<br>å®¢æˆ·ç«¯æ’ä»¶é»˜è®¤ä½¿ç”¨æƒé™ã€‚</p><p>å¤‡ä»½æ•°æ®åº“å¸¸ç”¨æ¡ˆä¾‹ï¼š</p><table><thead><tr><th>å¤‡ä»½å†…å®¹</th><th>æƒ…å†µ1</th><th>å‚æ•°</th><th>æƒ…å†µ2</th><th>å‚æ•°</th><th>æƒ…å†µ3</th></tr></thead><tbody><tr><td>åº“çš„æ•°é‡</td><td>æ‰€æœ‰</td><td>-A</td><td>å¤šä¸ª</td><td>-B db1 db2 db3</td><td>db1</td></tr><tr><td>è¡¨çš„æ•°é‡</td><td>æ‰€æœ‰</td><td></td><td>å¤šä¸ª</td><td>â€“table t1 t2</td><td>ä¸€ä¸ª t1</td></tr><tr><td>ç»“æ„</td><td>å¯¼å‡º</td><td></td><td>ä¸å¯¼å‡º</td><td>-t</td><td></td></tr><tr><td>æ•°æ®</td><td>å¯¼å‡º</td><td></td><td>ä¸å¯¼å‡º</td><td>-d</td><td></td></tr><tr><td>åˆ—å</td><td>å¯¼å‡º</td><td>-c</td><td>ä¸å¯¼å‡º</td><td></td><td></td></tr><tr><td>å­˜å‚¨è¿‡ç¨‹</td><td>å¯¼å‡º</td><td>-R</td><td>ä¸å¯¼å‡º</td><td></td><td></td></tr><tr><td>åˆ›å»ºæ•°æ®åº“</td><td>å¯¼å‡º</td><td></td><td>ä¸å¯¼å‡º</td><td>-n</td><td></td></tr></tbody></table><ol><li><p>å¯¼å‡ºç»“æ„ä¸å¯¼å‡ºæ•°æ®</p><p><code>mysqldump -d æ•°æ®åº“å -uroot -p &gt; xxx.sql</code></p></li><li><p>å¯¼å‡ºæ•°æ®ä¸å¯¼å‡ºç»“æ„</p><p><code>mysqldump -t æ•°æ®åº“å -uroot -p &gt; xxx.sql</code></p></li><li><p>å¯¼å‡ºæ•°æ®å’Œè¡¨ç»“æ„</p><p><code>mysqldump æ•°æ®åº“å -uroot -p &gt; xxx.sql</code></p></li><li><p>å¯¼å‡ºç‰¹å®šè¡¨çš„ç»“æ„</p><p><code>mysqldump -uroot -p -Bæ•°æ®åº“å --table è¡¨å &gt; xxx.sql</code></p></li><li><p>å¯¼å‡ºdb1åº“ä¸­t1è¡¨çš„è¡¨ç»“æ„å’Œæ•°æ®ï¼Œå¹¶ä¸”æ‰“å°å‡ºåˆ—å</p><p><code>mysqldump -uusername -ppassword db1 t1 -c &gt; xxx.sql</code> </p><p> -c, â€“complete-insert   ä½¿ç”¨å®Œæ•´çš„insertè¯­å¥(ç”¨åˆ—åå­—)ã€‚</p></li><li><p>åªå¯¼å‡ºå­˜å‚¨è¿‡ç¨‹</p><p><code>mysqldump -B db1 db2 -t -d -n -R &gt; xxx.sql</code></p></li></ol><h2 id="mysqlpump"><a href="#mysqlpump" class="headerlink" title="mysqlpump"></a>mysqlpump</h2><p>MySQL5.7ä¹‹åå¤šäº†ä¸€ä¸ªå¤‡ä»½å·¥å…·ï¼šmysqlpumpã€‚å®ƒæ˜¯mysqldumpçš„ä¸€ä¸ªè¡ç”Ÿï¼Œmysqldumpå°±ä¸å¤šè¯´æ˜äº†ï¼Œç°åœ¨çœ‹çœ‹mysqlpumpåˆ°åº•æœ‰äº†å“ªäº›æå‡ï¼Œå¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œé’ˆå¯¹å¦‚ä½•ä½¿ç”¨åšä¸‹è¯´æ˜ã€‚</p><p>mysqlpumpå’Œmysqldumpä¸€æ ·ï¼Œå±äºé€»è¾‘å¤‡ä»½ï¼Œå¤‡ä»½ä»¥SQLå½¢å¼çš„æ–‡æœ¬ä¿å­˜ã€‚é€»è¾‘å¤‡ä»½ç›¸å¯¹ç‰©ç†å¤‡ä»½çš„å¥½å¤„æ˜¯ä¸å…³å¿ƒundo logçš„å¤§å°ï¼Œç›´æ¥å¤‡ä»½æ•°æ®å³å¯ã€‚å®ƒæœ€ä¸»è¦çš„ç‰¹ç‚¹æ˜¯ï¼š</p><ul><li>å¹¶è¡Œå¤‡ä»½æ•°æ®åº“å’Œæ•°æ®åº“ä¸­çš„å¯¹è±¡çš„ï¼ŒåŠ å¿«å¤‡ä»½è¿‡ç¨‹ã€‚</li><li>æ›´å¥½çš„æ§åˆ¶æ•°æ®åº“å’Œæ•°æ®åº“å¯¹è±¡ï¼ˆè¡¨ï¼Œå­˜å‚¨è¿‡ç¨‹ï¼Œç”¨æˆ·å¸æˆ·ï¼‰çš„å¤‡ä»½ã€‚</li><li>å¤‡ä»½ç”¨æˆ·è´¦å·ä½œä¸ºå¸æˆ·ç®¡ç†è¯­å¥ï¼ˆCREATE USERï¼ŒGRANTï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥æ’å…¥åˆ°MySQLçš„ç³»ç»Ÿæ•°æ®åº“ã€‚</li><li>å¤‡ä»½å‡ºæ¥ç›´æ¥ç”Ÿæˆå‹ç¼©åçš„å¤‡ä»½æ–‡ä»¶ã€‚</li><li>å¤‡ä»½è¿›åº¦æŒ‡ç¤ºï¼ˆä¼°è®¡å€¼ï¼‰ã€‚</li><li>é‡æ–°åŠ è½½ï¼ˆè¿˜åŸï¼‰å¤‡ä»½æ–‡ä»¶ï¼Œå…ˆå»ºè¡¨åæ’å…¥æ•°æ®æœ€åå»ºç«‹ç´¢å¼•ï¼Œå‡å°‘äº†ç´¢å¼•ç»´æŠ¤å¼€é”€ï¼Œ</li><li>åŠ å¿«äº†è¿˜åŸé€Ÿåº¦ã€‚</li><li>å¤‡ä»½å¯ä»¥æ’é™¤æˆ–åˆ™æŒ‡å®šæ•°æ®åº“ã€‚</li></ul><h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><p>ç»å¤§éƒ¨åˆ†å‚æ•°å’Œmysqldumpä¸€è‡´</p><p>1ï¼šâ€“add-drop-databaseï¼šåœ¨å»ºç«‹åº“ä¹‹å‰å…ˆæ‰§è¡Œåˆ åº“æ“ä½œã€‚</p><p>DROP DATABASE IF EXISTS <code>...</code>;</p><p>2ï¼šâ€“add-drop-tableï¼šåœ¨å»ºè¡¨ä¹‹å‰å…ˆæ‰§è¡Œåˆ è¡¨æ“ä½œã€‚</p><p>DROP TABLE IF EXISTS <code>...</code>.<code>...</code>;</p><p>3ï¼šâ€“add-drop-userï¼šåœ¨CREATE USERè¯­å¥ä¹‹å‰å¢åŠ DROP USERï¼Œæ³¨æ„ï¼šè¿™ä¸ªå‚æ•°éœ€è¦å’Œâ€“usersä¸€èµ·ä½¿ç”¨ï¼Œå¦è€…ä¸ç”Ÿæ•ˆã€‚</p><p>DROP USER â€˜backupâ€™@â€™192.168.123.%â€™;</p><p>4ï¼šâ€“add-locksï¼šå¤‡ä»½è¡¨æ—¶ï¼Œä½¿ç”¨LOCK TABLESå’ŒUNLOCK TABLESã€‚æ³¨æ„ï¼šè¿™ä¸ªå‚æ•°ä¸æ”¯æŒå¹¶è¡Œå¤‡ä»½ï¼Œéœ€è¦å…³é—­å¹¶è¡Œå¤‡ä»½åŠŸèƒ½ï¼šâ€“default-parallelism=0 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LOCK TABLES `...`.`...` WRITE;</span><br><span class="line">...</span><br><span class="line">UNLOCK TABLES;</span><br></pre></td></tr></table></figure><p>5ï¼šâ€“all-databasesï¼šå¤‡ä»½æ‰€æœ‰åº“ï¼Œ-Aã€‚</p><p>6ï¼šâ€“bind-addressï¼šæŒ‡å®šé€šè¿‡å“ªä¸ªç½‘ç»œæ¥å£æ¥è¿æ¥MysqlæœåŠ¡å™¨ï¼ˆä¸€å°æœåŠ¡å™¨å¯èƒ½æœ‰å¤šä¸ªIPï¼‰ï¼Œé˜²æ­¢åŒä¸€ä¸ªç½‘å¡å‡ºå»å½±å“ä¸šåŠ¡ã€‚</p><p>7ï¼šâ€“complete-insertï¼šdumpå‡ºåŒ…å«æ‰€æœ‰åˆ—çš„å®Œæ•´insertè¯­å¥ã€‚</p><p>8ï¼šâ€“compressï¼š å‹ç¼©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¼ è¾“çš„æ‰€æœ‰çš„æ•°æ®ï¼Œ-Cã€‚</p><p>9ï¼šâ€“compress-outputï¼šé»˜è®¤ä¸å‹ç¼©è¾“å‡ºï¼Œç›®å‰å¯ä»¥ä½¿ç”¨çš„å‹ç¼©ç®—æ³•æœ‰LZ4å’ŒZLIBã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">shell&gt;</span><span class="bash"> mysqlpump --compress-output=LZ4 &gt; dump.lz4</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> lz4_decompress dump.lz4 dump.txt</span></span><br><span class="line"></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> mysqlpump --compress-output=ZLIB &gt; dump.zlib</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> zlib_decompress dump.zlib dump.txt</span></span><br></pre></td></tr></table></figure><p>10ï¼šâ€“databasesï¼šæ‰‹åŠ¨æŒ‡å®šè¦å¤‡ä»½çš„åº“ï¼Œæ”¯æŒå¤šä¸ªæ•°æ®åº“ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼Œ-Bã€‚</p><p>11ï¼šâ€“default-character-setï¼šæŒ‡å®šå¤‡ä»½çš„å­—ç¬¦é›†ã€‚</p><p>12ï¼šâ€“default-parallelismï¼šæŒ‡å®šå¹¶è¡Œçº¿ç¨‹æ•°ï¼Œé»˜è®¤æ˜¯2ï¼Œå¦‚æœè®¾ç½®æˆ0ï¼Œè¡¨ç¤ºä¸ä½¿ç”¨å¹¶è¡Œå¤‡ä»½ã€‚æ³¨æ„ï¼šæ¯ä¸ªçº¿ç¨‹çš„å¤‡ä»½æ­¥éª¤æ˜¯ï¼šå…ˆcreate tableä½†ä¸å»ºç«‹äºŒçº§ç´¢å¼•ï¼ˆä¸»é”®ä¼šåœ¨create tableæ—¶å€™å»ºç«‹ï¼‰ï¼Œå†å†™å…¥æ•°æ®ï¼Œæœ€åå»ºç«‹äºŒçº§ç´¢å¼•ã€‚</p><p>13ï¼šâ€“defer-table-indexesï¼šå»¶è¿Ÿåˆ›å»ºç´¢å¼•ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½åŠ è½½å®Œä¹‹åï¼Œå†åˆ›å»ºç´¢å¼•ï¼Œé»˜è®¤å¼€å¯ã€‚è‹¥å…³é—­åˆ™ä¼šå’Œmysqldumpä¸€æ ·ï¼šå…ˆåˆ›å»ºä¸€ä¸ªè¡¨å’Œæ‰€æœ‰ç´¢å¼•ï¼Œå†å¯¼å…¥æ•°æ®ï¼Œå› ä¸ºåœ¨åŠ è½½è¿˜åŸæ•°æ®çš„æ—¶å€™è¦ç»´æŠ¤äºŒçº§ç´¢å¼•çš„å¼€é”€ï¼Œå¯¼è‡´æ•ˆç‡æ¯”è¾ƒä½ã€‚å…³é—­ä½¿ç”¨å‚æ•°ï¼šâ€“skipâ€“defer-table-indexesã€‚</p><p>14ï¼šâ€“eventsï¼šå¤‡ä»½æ•°æ®åº“çš„äº‹ä»¶ï¼Œé»˜è®¤å¼€å¯ï¼Œå…³é—­ä½¿ç”¨â€“skip-eventså‚æ•°ã€‚</p><p>15ï¼šâ€“exclude-databasesï¼šå¤‡ä»½æ’é™¤è¯¥å‚æ•°æŒ‡å®šçš„æ•°æ®åº“ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”ã€‚ç±»ä¼¼çš„è¿˜æœ‰â€“exclude-eventsã€â€“exclude-routinesã€â€“exclude-tablesã€â€“exclude-triggersã€â€“exclude-usersã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysqlpump --exclude-databases=mysql,sys    #å¤‡ä»½è¿‡æ»¤mysqlå’Œsysæ•°æ®åº“</span><br><span class="line"></span><br><span class="line">mysqlpump --exclude-tables=rr,tt   #å¤‡ä»½è¿‡æ»¤æ‰€æœ‰æ•°æ®åº“ä¸­rrã€ttè¡¨</span><br><span class="line"></span><br><span class="line">mysqlpump -B test --exclude-tables=tmp_ifulltext,tt #å¤‡ä»½è¿‡æ»¤teståº“ä¸­çš„rrã€ttè¡¨</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¦æ˜¯åªå¤‡ä»½æ•°æ®åº“çš„è´¦å·ï¼Œéœ€è¦æ·»åŠ å‚æ•°â€“usersï¼Œå¹¶ä¸”éœ€è¦è¿‡æ»¤æ‰æ‰€æœ‰çš„æ•°æ®åº“ï¼Œå¦‚ï¼š</p><p>mysqlpump â€“users â€“exclude-databases=sys,mysql,db1,db2 â€“exclude-users=dba,backup  #å¤‡ä»½é™¤dbaå’Œbackupçš„æ‰€æœ‰è´¦å·ã€‚</p><p>16ï¼šâ€“include-databasesï¼šæŒ‡å®šå¤‡ä»½æ•°æ®åº“ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼Œç±»ä¼¼çš„è¿˜æœ‰â€“include-eventsã€â€“include-routinesã€â€“include-tablesã€â€“include-triggersã€â€“include-usersï¼Œå¤§è‡´æ–¹æ³•ä½¿ç”¨åŒ15ã€‚</p><p>17ï¼šâ€“insert-ignoreï¼šå¤‡ä»½ç”¨insert ignoreè¯­å¥ä»£æ›¿insertè¯­å¥ã€‚</p><p>18ï¼šâ€“log-error-fileï¼šå¤‡ä»½å‡ºç°çš„warningså’Œerrosä¿¡æ¯è¾“å‡ºåˆ°ä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶ã€‚</p><p>19ï¼šâ€“max-allowed-packetï¼šå¤‡ä»½æ—¶ç”¨äºclient/serverç›´æ¥é€šä¿¡çš„æœ€å¤§bufferåŒ…çš„å¤§å°ã€‚</p><p>20ï¼šâ€“net-buffer-lengthï¼šå¤‡ä»½æ—¶ç”¨äºclient/serveré€šä¿¡çš„åˆå§‹bufferå¤§å°ï¼Œå½“åˆ›å»ºå¤šè¡Œæ’å…¥è¯­å¥çš„æ—¶å€™ï¼Œmysqlpump åˆ›å»ºè¡Œåˆ°Nä¸ªå­—èŠ‚é•¿ã€‚</p><p>21ï¼šâ€“no-create-dbï¼šå¤‡ä»½ä¸å†™CREATE DATABASEè¯­å¥ã€‚è¦æ˜¯å¤‡ä»½å¤šä¸ªåº“ï¼Œéœ€è¦ä½¿ç”¨å‚æ•°-Bï¼Œè€Œä½¿ç”¨-Bçš„æ—¶å€™ä¼šå‡ºç°create databaseè¯­å¥ï¼Œè¯¥å‚æ•°å¯ä»¥å±è”½create database è¯­å¥ã€‚</p><p>22ï¼šâ€“no-create-infoï¼šå¤‡ä»½ä¸å†™å»ºè¡¨è¯­å¥ï¼Œå³ä¸å¤‡ä»½è¡¨ç»“æ„ï¼Œåªå¤‡ä»½æ•°æ®ï¼Œ-tã€‚</p><p>23ï¼šâ€“hex-blobï¼š å¤‡ä»½binaryå­—æ®µçš„æ—¶å€™ä½¿ç”¨åå…­è¿›åˆ¶è®¡æ•°æ³•ï¼Œå—å½±å“çš„å­—æ®µç±»å‹æœ‰BINARYã€VARBINARYã€BLOBã€BITã€‚</p><p>24ï¼šâ€“host ï¼šå¤‡ä»½æŒ‡å®šçš„æ•°æ®åº“åœ°å€ï¼Œ-hã€‚</p><p>25ï¼šâ€“parallel-schemas=[N:]db_listï¼šæŒ‡å®šå¹¶è¡Œå¤‡ä»½çš„åº“ï¼Œå¤šä¸ªåº“ç”¨é€—å·åˆ†éš”ï¼Œå¦‚æœæŒ‡å®šäº†Nï¼Œå°†ä½¿ç”¨Nä¸ªçº¿ç¨‹çš„åœ°é˜Ÿåˆ—ï¼Œå¦‚æœNä¸æŒ‡å®šï¼Œå°†ç”± â€“default-parallelismæ‰ç¡®è®¤Nçš„å€¼ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªâ€“parallel-schemasã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysqlpump --parallel-schemas=4:vs,aa --parallel-schemas=3:pt   #4ä¸ªçº¿ç¨‹å¤‡ä»½vså’Œaaï¼Œ3ä¸ªçº¿ç¨‹å¤‡ä»½ptã€‚é€šè¿‡show processlist å¯ä»¥çœ‹åˆ°æœ‰7ä¸ªçº¿ç¨‹ã€‚</span><br><span class="line"></span><br><span class="line">mysqlpump --parallel-schemas=vs,abc --parallel-schemas=pt  #é»˜è®¤2ä¸ªçº¿ç¨‹ï¼Œå³2ä¸ªçº¿ç¨‹å¤‡ä»½vså’Œabcï¼Œ2ä¸ªçº¿ç¨‹å¤‡ä»½pt</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###å½“ç„¶è¦æ˜¯ç¡¬ç›˜IOä¸å…è®¸çš„è¯ï¼Œå¯ä»¥å°‘å¼€å‡ ä¸ªçº¿ç¨‹å’Œæ•°æ®åº“è¿›è¡Œå¹¶è¡Œå¤‡ä»½</span></span></span><br></pre></td></tr></table></figure><p>26ï¼šâ€“passwordï¼šå¤‡ä»½éœ€è¦çš„å¯†ç ã€‚</p><p>27ï¼šâ€“port ï¼šå¤‡ä»½æ•°æ®åº“çš„ç«¯å£ã€‚</p><p>28ï¼šâ€“protocol={TCP|SOCKET|PIPE|MEMORY}ï¼šæŒ‡å®šè¿æ¥æœåŠ¡å™¨çš„åè®®ã€‚</p><p>29ï¼šâ€“replaceï¼šå¤‡ä»½å‡ºæ¥replace intoè¯­å¥ã€‚</p><p>30ï¼šâ€“routinesï¼šå¤‡ä»½å‡ºæ¥åŒ…å«å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ï¼Œé»˜è®¤å¼€å¯ï¼Œéœ€è¦å¯¹ mysql.procè¡¨æœ‰æŸ¥çœ‹æƒé™ã€‚ç”Ÿæˆçš„æ–‡ä»¶ä¸­ä¼šåŒ…å«CREATE PROCEDURE å’Œ CREATE FUNCTIONè¯­å¥ä»¥ç”¨äºæ¢å¤ï¼Œå…³é—­åˆ™éœ€è¦ç”¨â€“skip-routineså‚æ•°ã€‚</p><p>31ï¼šâ€“triggersï¼šå¤‡ä»½å‡ºæ¥åŒ…å«è§¦å‘å™¨ï¼Œé»˜è®¤å¼€å¯ï¼Œä½¿ç”¨â€“skip-triggersæ¥å…³é—­ã€‚</p><p>31ï¼šâ€“set-charsetï¼šå¤‡ä»½æ–‡ä»¶é‡Œå†™SET NAMES default_character_set åˆ°è¾“å‡ºï¼Œæ­¤å‚é»˜è®¤å¼€å¯ã€‚ â€“ skip-set-charsetç¦ç”¨æ­¤å‚æ•°ï¼Œä¸ä¼šåœ¨å¤‡ä»½æ–‡ä»¶é‡Œé¢å†™å‡ºset namesâ€¦</p><p>32ï¼šâ€“single-transactionï¼šè¯¥å‚æ•°åœ¨äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®æˆRepeatable Readï¼Œå¹¶åœ¨dumpä¹‹å‰å‘é€start transaction è¯­å¥ç»™æœåŠ¡ç«¯ã€‚è¿™åœ¨ä½¿ç”¨innodbæ—¶å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºåœ¨å‘å‡ºstart transactionæ—¶ï¼Œä¿è¯äº†åœ¨ä¸é˜»å¡ä»»ä½•åº”ç”¨ä¸‹çš„ä¸€è‡´æ€§çŠ¶æ€ã€‚å¯¹myisamå’Œmemoryç­‰éäº‹åŠ¡è¡¨ï¼Œè¿˜æ˜¯ä¼šæ”¹å˜çŠ¶æ€çš„ï¼Œå½“ä½¿ç”¨æ­¤å‚çš„æ—¶å€™è¦ç¡®ä¿æ²¡æœ‰å…¶ä»–è¿æ¥åœ¨ä½¿ç”¨ALTER TABLEã€CREATE TABLEã€DROP TABLEã€RENAME TABLEã€TRUNCATE TABLEç­‰è¯­å¥ï¼Œå¦åˆ™ä¼šå‡ºç°ä¸æ­£ç¡®çš„å†…å®¹æˆ–åˆ™å¤±è´¥ã€‚â€“add-lockså’Œæ­¤å‚äº’æ–¥ï¼Œåœ¨mysql5.7.11ä¹‹å‰ï¼Œâ€“default-parallelismå¤§äº1çš„æ—¶å€™å’Œæ­¤å‚ä¹Ÿäº’æ–¥ï¼Œå¿…é¡»ä½¿ç”¨â€“default-parallelism=0ã€‚5.7.11ä¹‹åè§£å†³äº†â€“single-transactionå’Œâ€“default-parallelismçš„äº’æ–¥é—®é¢˜ã€‚</p><p>33ï¼šâ€“skip-definerï¼šå¿½ç•¥é‚£äº›åˆ›å»ºè§†å›¾å’Œå­˜å‚¨è¿‡ç¨‹ç”¨åˆ°çš„ DEFINER å’Œ SQL SECURITY è¯­å¥ï¼Œæ¢å¤çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œå¦åˆ™ä¼šåœ¨è¿˜åŸçš„æ—¶å€™çœ‹åˆ°æ²¡æœ‰DEFINERå®šä¹‰æ—¶çš„è´¦å·è€ŒæŠ¥é”™ã€‚</p><p>34ï¼šâ€“skip-dump-rowsï¼šåªå¤‡ä»½è¡¨ç»“æ„ï¼Œä¸å¤‡ä»½æ•°æ®ï¼Œ-dã€‚æ³¨æ„ï¼šmysqldumpæ”¯æŒâ€“no-dataï¼Œmysqlpumpä¸æ”¯æŒâ€“no-data</p><p>35ï¼šâ€“socketï¼šå¯¹äºè¿æ¥åˆ°localhostï¼ŒUnixä½¿ç”¨å¥—æ¥å­—æ–‡ä»¶ï¼Œåœ¨Windowsä¸Šæ˜¯å‘½åç®¡é“çš„åç§°ä½¿ç”¨ï¼Œ-Sã€‚</p><p>36ï¼šâ€“sslï¼šâ€“sslå‚æ•°å°†è¦è¢«å»é™¤ï¼Œç”¨â€“ssl-modeå–ä»£ã€‚å…³äºsslç›¸å…³çš„å¤‡ä»½ï¼Œè¯·çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p><p>37ï¼šâ€“tz-utcï¼šå¤‡ä»½æ—¶ä¼šåœ¨å¤‡ä»½æ–‡ä»¶çš„æœ€å‰å‡ è¡Œæ·»åŠ SET TIME_ZONE=â€™+00:00â€™ã€‚æ³¨æ„ï¼šå¦‚æœè¿˜åŸçš„æœåŠ¡å™¨ä¸åœ¨åŒä¸€ä¸ªæ—¶åŒºå¹¶ä¸”è¿˜åŸè¡¨ä¸­çš„åˆ—æœ‰timestampå­—æ®µï¼Œä¼šå¯¼è‡´è¿˜åŸå‡ºæ¥çš„ç»“æœä¸ä¸€è‡´ã€‚é»˜è®¤å¼€å¯è¯¥å‚æ•°ï¼Œç”¨ â€“skip-tz-utcæ¥å…³é—­å‚æ•°ã€‚</p><p>38ï¼šâ€“userï¼šå¤‡ä»½æ—¶å€™çš„ç”¨æˆ·åï¼Œ-uã€‚</p><p>39ï¼šâ€“usersï¼šå¤‡ä»½æ•°æ®åº“ç”¨æˆ·ï¼Œå¤‡ä»½çš„å½¢å¼æ˜¯CREATE USERâ€¦ï¼ŒGRANTâ€¦ï¼Œåªå¤‡ä»½æ•°æ®åº“è´¦å·å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼š</p><p>mysqlpump â€“exclude-databases=% â€“users    #è¿‡æ»¤æ‰æ‰€æœ‰æ•°æ®åº“</p><p>40ï¼šâ€“watch-progressï¼šå®šæœŸæ˜¾ç¤ºè¿›åº¦çš„å®Œæˆï¼ŒåŒ…æ‹¬æ€»æ•°è¡¨ã€è¡Œå’Œå…¶ä»–å¯¹è±¡ã€‚è¯¥å‚æ•°é»˜è®¤å¼€å¯ï¼Œç”¨â€“skip-watch-progressæ¥å…³é—­ã€‚</p><h3 id="ä½¿ç”¨è¯´æ˜"><a href="#ä½¿ç”¨è¯´æ˜" class="headerlink" title="ä½¿ç”¨è¯´æ˜"></a>ä½¿ç”¨è¯´æ˜</h3><p>mysqlpumpçš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="pic/71.png" alt=""></p><p>mysqlpumpæ”¯æŒåŸºäºåº“å’Œè¡¨çš„å¹¶è¡Œå¯¼å‡ºï¼Œmysqlpumpçš„å¹¶è¡Œå¯¼å‡ºåŠŸèƒ½çš„æ¶æ„ä¸ºï¼šé˜Ÿåˆ—+çº¿ç¨‹ï¼Œå…è®¸æœ‰å¤šä¸ªé˜Ÿåˆ—ï¼ˆâ€“parallel-schemasï¼Ÿï¼‰ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¸‹æœ‰å¤šä¸ªçº¿ç¨‹ï¼ˆNï¼Ÿï¼‰ï¼Œè€Œä¸€ä¸ªé˜Ÿåˆ—å¯ä»¥ç»‘å®š1ä¸ªæˆ–è€…å¤šä¸ªæ•°æ®åº“ï¼ˆé€—å·åˆ†éš”ï¼‰ã€‚mysqlpumpçš„å¤‡ä»½æ˜¯åŸºäºè¡¨å¹¶è¡Œçš„ï¼Œå¯¹äºæ¯å¼ è¡¨çš„å¯¼å‡ºåªèƒ½æ˜¯å•ä¸ªçº¿ç¨‹çš„ï¼Œè¿™é‡Œä¼šæœ‰ä¸ªé™åˆ¶æ˜¯å¦‚æœæŸä¸ªæ•°æ®åº“æœ‰ä¸€å¼ è¡¨éå¸¸å¤§ï¼Œå¯èƒ½å¤§éƒ¨åˆ†çš„æ—¶é—´éƒ½æ˜¯æ¶ˆè€—åœ¨è¿™ä¸ªè¡¨çš„å¤‡ä»½ä¸Šé¢ï¼Œå¹¶è¡Œå¤‡ä»½çš„æ•ˆæœå¯èƒ½å°±ä¸æ˜æ˜¾ã€‚è¿™é‡Œå¯ä»¥åˆ©ç”¨mydumperå…¶æ˜¯ä»¥chunkçš„æ–¹å¼æ‰¹é‡å¯¼å‡ºï¼Œå³mydumperæ”¯æŒä¸€å¼ è¡¨å¤šä¸ªçº¿ç¨‹ä»¥chunkçš„æ–¹å¼æ‰¹é‡å¯¼å‡ºã€‚ä½†æ˜¯ç›¸å¯¹äºmysqldumpè¿˜æ˜¯æœ‰äº†å¾ˆå¤§çš„æå‡ã€‚è¿™é‡Œå¤§è‡´æµ‹è¯•ä¸‹mysqlpumpå’Œmysqldumpçš„å¤‡ä»½æ•ˆç‡ã€‚ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">mysqlpumpå‹ç¼©å¤‡ä»½vsæ•°æ®åº“ ä¸‰ä¸ªå¹¶å‘çº¿ç¨‹å¤‡ä»½ï¼Œæ¶ˆè€—æ—¶é—´ï¼š222s</span></span><br><span class="line">mysqlpump -uzjy -p -h192.168.123.70 --single-transaction --default-character-set=utf8 --compress-output=LZ4 --default-parallelism=3 -B vs &gt; /home/zhoujy/vs_db.sql.lz4</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">mysqldumpå¤‡ä»½å‹ç¼©vsæ•°æ®åº“ å•ä¸ªçº¿ç¨‹å¤‡ä»½ï¼Œæ¶ˆè€—æ—¶é—´ï¼š900sï¼Œgzipçš„å‹ç¼©ç‡æ¯”LZ4çš„é«˜</span></span><br><span class="line">mysqldump -uzjy -p -h192.168.123.70 --default-character-set=utf8 -P3306 --skip-opt --add-drop-table --create-options  --quick --extended-insert --single-transaction -B vs | gzip &gt; /home/zhoujy/vs.sql.gz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">mydumperå¤‡ä»½vsæ•°æ®åº“ ä¸‰ä¸ªå¹¶å‘çº¿ç¨‹å¤‡ä»½ï¼Œæ¶ˆè€—æ—¶é—´ï¼š300sï¼Œgzipçš„å‹ç¼©ç‡æ¯”LZ4çš„é«˜</span></span><br><span class="line">mydumper -u zjy -p  -h 192.168.123.70 -P 3306 -t 3 -c -l 3600 -s 10000000 -B vs -o /home/zhoujy/vs/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">mydumperå¤‡ä»½vsæ•°æ®åº“ï¼Œäº”ä¸ªå¹¶å‘çº¿ç¨‹å¤‡ä»½ï¼Œå¹¶ä¸”å¼€å¯å¯¹ä¸€å¼ è¡¨å¤šä¸ªçº¿ç¨‹ä»¥chunkçš„æ–¹å¼æ‰¹é‡å¯¼å‡ºï¼Œ-rã€‚æ¶ˆè€—æ—¶é—´ï¼š180s</span></span><br><span class="line">mydumper -u zjy -p  -h 192.168.123.70 -P 3306 -t 5 -c -r 300000 -l 3600 -s 10000000 -B vs -o /home/zhoujy/vs/</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çœ‹å‡ºï¼Œmysqlpumpçš„å¤‡ä»½æ•ˆç‡æ˜¯æœ€å¿«çš„ï¼Œmydumperæ¬¡ä¹‹ï¼Œmysqldumpæœ€å·®ã€‚æ‰€ä»¥åœ¨IOå…è®¸çš„æƒ…å†µä¸‹ï¼Œèƒ½ç”¨å¤šçº¿ç¨‹å°±åˆ«ç”¨å•çº¿ç¨‹å¤‡ä»½ã€‚å¹¶ä¸”mysqlpumpè¿˜æ”¯æŒå¤šæ•°æ®åº“çš„å¹¶è¡Œå¤‡ä»½ï¼Œè€Œmydumperè¦ä¹ˆå¤‡ä»½ä¸€ä¸ªåº“ï¼Œè¦ä¹ˆå°±å¤‡ä»½æ‰€æœ‰åº“ã€‚å§œå¤§ç¥çš„Oracleå®˜æ–¹å¹¶è¡Œé€»è¾‘å¤‡ä»½å·¥å…·mysqlpumpè¿™ç¯‡æ–‡ç« çš„æµ‹è¯•ç»“æœä¹Ÿè¯´æ˜äº†mysqlpumpæ¯”mysqldumpçš„æµ‹è¯•å¥½ã€‚ç”±äºå®é™…æƒ…å†µä¸åŒï¼Œæµ‹è¯•ç»™å‡ºçš„é€Ÿåº¦æå‡åªæ˜¯å‚è€ƒã€‚åˆ°åº•å¼€å¯å¤šå°‘ä¸ªå¹¶è¡Œå¤‡ä»½çš„çº¿ç¨‹ï¼Œè¿™ä¸ªçœ‹ç£ç›˜IOçš„æ‰¿å—èƒ½åŠ›ï¼Œè‹¥è¯¥æœåŠ¡å™¨åªè¿›è¡Œå¤‡ä»½ä»»åŠ¡ï¼Œå¯ä»¥æœ€å¤§é™åˆ¶çš„æ¥åˆ©ç”¨ç£ç›˜ã€‚</p><p>æ€»ç»“ï¼š</p><p>mysqldumpå’Œmysqlpumpçš„ä½¿ç”¨æ–¹æ³•ç»å¤§éƒ¨åˆ†ä¸€è‡´ï¼Œåˆ°åº•ç”¨é‚£ç§å·¥å…·å¤‡ä»½æ•°æ®åº“è¿™ä¸ªè¦åœ¨å…·ä½“çš„ç¯å¢ƒä¸‹æ‰èƒ½åšå‡ºé€‰æ‹©ï¼Œæœ‰äº›æ—¶å€™å¯èƒ½ç”¨ç‰©ç†å¤‡ä»½æ›´å¥½ï¼ˆxtrabackupï¼‰ï¼Œæ€»ä¹‹æ ¹æ®éœ€è¦è¿›è¡Œæµ‹è¯•ï¼Œæœ€åå†å†³å®šä½¿ç”¨å“ªç§å¤‡ä»½å·¥å…·è¿›è¡Œå¤‡ä»½ã€‚</p><p>â€“</p><h2 id="mydumper"><a href="#mydumper" class="headerlink" title="mydumper"></a>mydumper</h2><p>mydumperï¼ˆ&amp;myloaderï¼‰æ˜¯ç”¨äºå¯¹MySQLæ•°æ®åº“è¿›è¡Œå¤šçº¿ç¨‹å¤‡ä»½å’Œæ¢å¤çš„å¼€æº (GNU GPLv3)å·¥å…·ã€‚å¼€å‘äººå‘˜ä¸»è¦æ¥è‡ªMySQLã€Facebookå’ŒSkySQLå…¬å¸ï¼Œç›®å‰ç”±Perconaå…¬å¸å¼€å‘å’Œç»´æŠ¤ï¼Œæ˜¯PerconaRemote DBAé¡¹ç›®çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼ŒåŒ…å«åœ¨Percona XtraDB Clusterä¸­ã€‚mydumperçš„ç¬¬ä¸€ç‰ˆ0.1å‘å¸ƒäº2010.3.26ï¼Œæœ€æ–°ç‰ˆæœ¬0.9.1å‘å¸ƒäº2015.11.06ã€‚</p><p>mydumperæ˜¯ä¸€ç§æ¯”MySQLå®˜æ–¹mysqldumpæ›´ä¼˜ç§€çš„å¤‡ä»½å·¥å…·ï¼Œä¸»è¦ä½“ç°åœ¨å¤šçº¿ç¨‹å’Œå¤‡ä»½æ–‡ä»¶ä¿å­˜æ–¹å¼ä¸Šã€‚åœ¨MySQL 5.7ç‰ˆæœ¬ä¸­ï¼Œå®˜æ–¹å‘å¸ƒäº†ä¸€ç§æ–°çš„å¤‡ä»½å·¥å…·mysqlpumpï¼Œä¹Ÿæ˜¯å¤šçº¿ç¨‹çš„ï¼Œå…¶å®ç°æ–¹å¼ç»™äººè€³ç›®ä¸€æ–°çš„æ„Ÿè§‰ï¼Œä½†é—æ†¾çš„æ˜¯å…¶ä»ä¸ºè¡¨çº§åˆ«çš„å¹¶è¡Œã€‚è€Œmydumperèƒ½å¤Ÿå®ç°è®°å½•çº§åˆ«çš„å¹¶è¡Œå¤‡ä»½ï¼Œå…¶å¤‡ä»½æ¡†æ¶ç”±ä¸»çº¿ç¨‹å’Œå¤šä¸ªå·¥ä½œçº¿ç¨‹ç»„æˆ.</p><p>è¿™é‡Œä¸€è‡´æ€§æ•°æ®æŒ‡çš„æ˜¯åœ¨æŸä¸ªæ—¶é—´ç‚¹ï¼Œå¯¼å‡ºçš„æ•°æ®ä¸å¯¼å‡ºçš„Binlogæ–‡ä»¶ä¿¡æ¯ç›¸åŒ¹é…ï¼Œå¦‚æœå¯¼å‡ºäº†å¤šå¼ è¡¨çš„æ•°æ®ï¼Œè¿™äº›ä¸åŒè¡¨ä¹‹é—´çš„æ•°æ®éƒ½æ˜¯åŒä¸€ä¸ªæ—¶é—´ç‚¹çš„æ•°æ®ã€‚</p><h3 id="mydumperå¤‡ä»½åŸç†"><a href="#mydumperå¤‡ä»½åŸç†" class="headerlink" title="mydumperå¤‡ä»½åŸç†"></a>mydumperå¤‡ä»½åŸç†</h3><p>åœ¨mydumperè¿›è¡Œå¤‡ä»½çš„æ—¶å€™ï¼Œç”±ä¸€ä¸ªä¸»çº¿ç¨‹ä»¥åŠå¤šä¸ªå¤‡ä»½çº¿ç¨‹å®Œæˆã€‚å…¶ä¸»çº¿ç¨‹çš„æµç¨‹æ˜¯ï¼š</p><ol><li>è¿æ¥æ•°æ®åº“</li><li>FLUSH TABLES WITH READ LOCK å°†è„é¡µåˆ·æ–°åˆ°ç£ç›˜å¹¶è·å¾—åªè¯»é”</li><li>START TRANSACTION /!40108 WITH CONSISTENT SNAPSHOT / å¼€å¯äº‹ç‰©å¹¶è·å–ä¸€è‡´æ€§å¿«ç…§</li><li>SHOW MASTER STATUS è·å¾—binlogä¿¡æ¯</li><li>åˆ›å»ºå­çº¿ç¨‹å¹¶è¿æ¥æ•°æ®åº“</li><li>ä¸ºå­çº¿ç¨‹åˆ†é…ä»»åŠ¡å¹¶pushåˆ°é˜Ÿåˆ—ä¸­</li><li>UNLOCK TABLES / FTWRL / é‡Šæ”¾é”</li></ol><p>å­çº¿ç¨‹çš„ä¸»è¦æµç¨‹æ˜¯ï¼š</p><ol><li>è¿æ¥æ•°æ®åº“</li><li>SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE</li><li>START TRANSACTION /!40108 WITH CONSISTENT SNAPSHOT /</li><li>ä»é˜Ÿåˆ—ä¸­popä»»åŠ¡å¹¶æ‰§è¡Œ</li></ol><p>ä¸Šè¿°ä¸¤ä¸ªçº¿ç¨‹çš„æµç¨‹çš„å…³ç³»å¦‚å›¾</p><p><img src="pic/72.png" alt=""></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸»çº¿ç¨‹é‡Šæ”¾é”æ˜¯åœ¨å­çº¿ç¨‹å¼€å¯äº‹ç‰©ä¹‹åã€‚è¿™é‡Œæ˜¯ä¿è¯å­çº¿ç¨‹è·å¾—çš„æ•°æ®ä¸€å®šä¸ºä¸€è‡´æ€§æ•°æ®çš„å…³é”®ã€‚</p><p>ä¸»çº¿ç¨‹åœ¨è¿æ¥åˆ°æ•°æ®åº“åç«‹å³é€šè¿‡Flush tables with read lock(FTWRL) æ“ä½œå°†è„é¡µåˆ·æ–°åˆ°ç£ç›˜ï¼Œå¹¶è·å–ä¸€ä¸ªå…¨å±€çš„åªè¯»é”ï¼Œè¿™æ ·ä¾¿å¯ä»¥ä¿è¯åœ¨é”é‡Šæ”¾ä¹‹å‰ç”±ä¸»çº¿ç¨‹çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚ç„¶åç«‹å³é€šè¿‡ Start Transaction with consistent snapshot åˆ›å»ºä¸€ä¸ªå¿«ç…§è¯»äº‹ç‰©ï¼Œå¹¶é€šè¿‡ show master statusè·å–binlogä½ç½®ä¿¡æ¯ã€‚</p><p>ç„¶ååˆ›å»ºå®Œæˆdumpä»»åŠ¡çš„å­çº¿ç¨‹å¹¶ä¸ºå…¶åˆ†é…ä»»åŠ¡ã€‚</p><p>ä¸»çº¿ç¨‹åœ¨åˆ›å»ºå­çº¿ç¨‹åé€šè¿‡ä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ— ready ç­‰å¾…å­çº¿ç¨‹å‡†å¤‡å®Œæ¯•ã€‚ å­çº¿ç¨‹åœ¨åˆ›å»ºåç«‹å³åˆ›å»ºåˆ°MySQLæ•°æ®åº“çš„è¿æ¥ï¼Œç„¶åè®¾ç½®å½“å‰äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºRepeatable Readã€‚</p><p>è®¾ç½®å®Œæˆä¹‹åå¼€å§‹å¿«ç…§è¯»äº‹åŠ¡ã€‚åœ¨å®Œæˆè¿™ä¸€ç³»åˆ—æ“ä½œä¹‹åï¼Œå­çº¿ç¨‹æ‰ä¼šé€šè¿‡readyé˜Ÿåˆ—å‘Šè¯‰ä¸»çº¿è‡ªå·±ç¨‹å‡†å¤‡å®Œæ¯•ã€‚ä¸»çº¿ç¨‹ç­‰å¾…å…¨éƒ¨å­çº¿ç¨‹å‡†å¤‡å®Œæ¯•å¼€å¯ä¸€è‡´æ€§è¯»Snapshotäº‹åŠ¡åæ‰ä¼šé‡Šæ”¾å…¨å±€åªè¯»é”ï¼ˆUnlock Tableï¼‰ã€‚</p><p>å¦‚æœåªæœ‰Innodbè¡¨ï¼Œé‚£ä¹ˆåªæœ‰åœ¨åˆ›å»ºä»»åŠ¡é˜¶æ®µä¼šåŠ é”ã€‚ä½†æ˜¯å¦‚æœå­˜åœ¨MyIsamè¡¨æˆ–å…¶ä»–ä¸å¸¦æœ‰MVCCåŠŸèƒ½çš„è¡¨ï¼Œé‚£ä¹ˆåœ¨è¿™äº›è¡¨çš„å¯¼å‡ºä»»åŠ¡å®Œæˆä¹‹å‰éƒ½å¿…é¡»å¯¹è¿™äº›è¡¨è¿›è¡ŒåŠ é”ã€‚Mydumperæœ¬èº«ç»´æŠ¤äº†ä¸€ä¸ª non_innodb_table åˆ—è¡¨ï¼Œåœ¨åˆ›å»ºä»»åŠ¡é˜¶æ®µä¼šé¦–å…ˆä¸ºéInnodbè¡¨åˆ›å»ºä»»åŠ¡ã€‚åŒæ—¶è¿˜ç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€çš„unlock_tableé˜Ÿåˆ—ä»¥åŠä¸€ä¸ªåŸå­è®¡æ•°å™¨ non_innodb_table_counter , å­çº¿ç¨‹æ¯å®Œæˆä¸€ä¸ªéInnodbè¡¨çš„ä»»åŠ¡ä¾¿å°† non_innodb_table_counter å‡ä¸€ï¼Œå¦‚æœnon_innodb_table_counter å€¼ä¸º0 éé€šè¿‡å‘ unlock_table é˜Ÿåˆ—pushä¸€ä¸ªæ¶ˆæ¯çš„æ–¹å¼é€šçŸ¥ä¸»çº¿ç¨‹å®Œæˆäº†éInnodbè¡¨çš„å¯¼å‡ºä»»åŠ¡å¯ä»¥æ‰§è¡Œ unlock tableæ“ä½œã€‚</p><p>mydumperæ”¯æŒè®°å½•çº§åˆ«çš„å¹¶å‘å¯¼å‡ºã€‚åœ¨è®°å½•çº§åˆ«çš„å¯¼å‡ºæ—¶ï¼Œä¸»çº¿ç¨‹åœ¨åšä»»åŠ¡åˆ†é…çš„æ—¶å€™ä¼šå¯¹è¡¨è¿›è¡Œæ‹†åˆ†ï¼Œä¸ºè¡¨çš„ä¸€éƒ¨åˆ†è®°å½•åˆ›å»ºä¸€ä¸ªä»»åŠ¡ã€‚è¿™æ ·åšä¸€ä¸ªå¥½å¤„å°±æ˜¯å½“æœ‰æŸä¸ªè¡¨ç‰¹åˆ«å¤§çš„æ—¶å€™å¯ä»¥å°½å¯èƒ½çš„åˆ©ç”¨å¤šçº¿ç¨‹å¹¶å‘ä»¥å…æŸä¸ªçº¿ç¨‹åœ¨å¯¼å‡ºä¸€ä¸ªå¤§è¡¨è€Œå…¶ä»–çº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€ã€‚åœ¨åˆ†å‰²æ—¶ï¼Œé¦–å…ˆé€‰å–ä¸»é”®ï¼ˆPRIMARY KEYï¼‰ä½œä¸ºåˆ†éš”ä¾æ®ï¼Œå¦‚æœæ²¡æœ‰ä¸»é”®åˆ™æŸ¥æ‰¾æœ‰æ— å”¯ä¸€ç´¢å¼•(UNIQUE KEY)ã€‚åœ¨ä»¥ä¸Šå°è¯•éƒ½å¤±è´¥åï¼Œå†é€‰å–ä¸€ä¸ªåŒºåˆ†åº¦æ¯”è¾ƒé«˜çš„å­—æ®µåšä¸ºè®°å½•åˆ’åˆ†çš„ä¾æ®(é€šè¿‡ show index ç»“æœé›†ä¸­çš„cardinalityçš„å€¼ç¡®å®š)ã€‚</p><p>åˆ’åˆ†çš„æ–¹å¼æ¯”è¾ƒæš´åŠ›ï¼Œç›´æ¥é€šè¿‡ select min(filed),max(filed) from table è·å¾—åˆ’åˆ†å­—æ®µçš„å–å€¼èŒƒå›´ï¼Œé€šè¿‡ explain select filed from table è·å–å­—æ®µè®°å½•çš„è¡Œæ•°ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªç¡®å®šçš„æ­¥é•¿è·å¾—æ¯ä¸€ä¸ªå­ä»»åŠ¡çš„æ‰§è¡Œæ—¶çš„whereæ¡ä»¶ã€‚è¿™ç§è®¡ç®—æ–¹å¼åªæ”¯æŒæ•°å­—ç±»å‹çš„å­—æ®µã€‚</p><p>ä»¥ä¸Šå°±æ˜¯mydumperçš„å¹¶å‘è·å–ä¸€è‡´æ€§æ•°æ®çš„æ–¹å¼ï¼Œå…¶å…³é”®åœ¨äºåˆ©ç”¨äº†Innodbè¡¨çš„MVCCåŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡å¿«ç…§è¯»å› æ­¤åªæœ‰åœ¨ä»»åŠ¡åˆ›å»ºé˜¶æ®µæ‰éœ€è¦åŠ é”ã€‚</p><h3 id="mydumper-å‚æ•°"><a href="#mydumper-å‚æ•°" class="headerlink" title="mydumper å‚æ•°"></a>mydumper å‚æ•°</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">01</span><br><span class="line">-B, --database              è¦å¤‡ä»½çš„æ•°æ®åº“ï¼Œä¸æŒ‡å®šåˆ™å¤‡ä»½æ‰€æœ‰åº“</span><br><span class="line">02.</span><br><span class="line">-T, --tables-list           éœ€è¦å¤‡ä»½çš„è¡¨ï¼Œåå­—ç”¨é€—å·éš”å¼€</span><br><span class="line">03.</span><br><span class="line">-o, --outputdir             å¤‡ä»½æ–‡ä»¶è¾“å‡ºçš„ç›®å½•</span><br><span class="line">04.</span><br><span class="line">-s, --statement-size        ç”Ÿæˆçš„insertè¯­å¥çš„å­—èŠ‚æ•°ï¼Œé»˜è®¤1000000</span><br><span class="line">05.</span><br><span class="line">-r, --rows                  å°†è¡¨æŒ‰è¡Œåˆ†å—æ—¶ï¼ŒæŒ‡å®šçš„å—è¡Œæ•°ï¼ŒæŒ‡å®šè¿™ä¸ªé€‰é¡¹ä¼šå…³é—­ --chunk-filesize</span><br><span class="line">06.</span><br><span class="line">-F, --chunk-filesize        å°†è¡¨æŒ‰å¤§å°åˆ†å—æ—¶ï¼ŒæŒ‡å®šçš„å—å¤§å°ï¼Œå•ä½æ˜¯ MB</span><br><span class="line">07.</span><br><span class="line">-c, --compress              å‹ç¼©è¾“å‡ºæ–‡ä»¶</span><br><span class="line">08.</span><br><span class="line">-e, --build-empty-files     å¦‚æœè¡¨æ•°æ®æ˜¯ç©ºï¼Œè¿˜æ˜¯äº§ç”Ÿä¸€ä¸ªç©ºæ–‡ä»¶ï¼ˆé»˜è®¤æ— æ•°æ®åˆ™åªæœ‰è¡¨ç»“æ„æ–‡ä»¶ï¼‰</span><br><span class="line">09.</span><br><span class="line">-x, --regex                 æ˜¯åŒæ­£åˆ™è¡¨è¾¾å¼åŒ¹é… 'db.table'</span><br><span class="line">10.</span><br><span class="line">-i, --ignore-engines        å¿½ç•¥çš„å­˜å‚¨å¼•æ“ï¼Œç”¨éƒ½åšåˆ†å‰²</span><br><span class="line">11.</span><br><span class="line">-m, --no-schemas            ä¸å¤‡ä»½è¡¨ç»“æ„</span><br><span class="line">12.</span><br><span class="line">-k, --no-locks              ä¸ä½¿ç”¨ä¸´æ—¶å…±äº«åªè¯»é”ï¼Œä½¿ç”¨è¿™ä¸ªé€‰é¡¹ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´</span><br><span class="line">13.</span><br><span class="line">--less-locking              å‡å°‘å¯¹InnoDBè¡¨çš„é”æ–½åŠ æ—¶é—´ï¼ˆè¿™ç§æ¨¡å¼çš„æœºåˆ¶ä¸‹æ–‡è¯¦è§£ï¼‰</span><br><span class="line">14.</span><br><span class="line">-l, --long-query-guard      è®¾å®šé˜»å¡å¤‡ä»½çš„é•¿æŸ¥è¯¢è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼Œé»˜è®¤æ˜¯60ç§’ï¼ˆè¶…æ—¶åé»˜è®¤mydumperå°†ä¼šé€€å‡ºï¼‰</span><br><span class="line">15.</span><br><span class="line">--kill-long-queries         æ€æ‰é•¿æŸ¥è¯¢ (ä¸é€€å‡º)</span><br><span class="line">16.</span><br><span class="line">-b, --binlogs               å¯¼å‡ºbinlog</span><br><span class="line">17.</span><br><span class="line">-D, --daemon                å¯ç”¨å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ï¼Œå®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ä»¥æŸä¸ªé—´éš”ä¸é—´æ–­å¯¹æ•°æ®åº“è¿›è¡Œå¤‡ä»½</span><br><span class="line">18.</span><br><span class="line">-I, --snapshot-interval     dumpå¿«ç…§é—´éš”æ—¶é—´ï¼Œé»˜è®¤60sï¼Œéœ€è¦åœ¨daemonæ¨¡å¼ä¸‹</span><br><span class="line">19.</span><br><span class="line">-L, --logfile               ä½¿ç”¨çš„æ—¥å¿—æ–‡ä»¶å(mydumperæ‰€äº§ç”Ÿçš„æ—¥å¿—), é»˜è®¤ä½¿ç”¨æ ‡å‡†è¾“å‡º</span><br><span class="line">20.</span><br><span class="line">--tz-utc                    è·¨æ—¶åŒºæ˜¯ä½¿ç”¨çš„é€‰é¡¹ï¼Œä¸è§£é‡Šäº†</span><br><span class="line">21.</span><br><span class="line">--skip-tz-utc               åŒä¸Š</span><br><span class="line">22.</span><br><span class="line">--use-savepoints            ä½¿ç”¨savepointsæ¥å‡å°‘é‡‡é›†metadataæ‰€é€ æˆçš„é”æ—¶é—´ï¼Œéœ€è¦ SUPER æƒé™</span><br><span class="line">23.</span><br><span class="line">--success-on-1146           Not increment error count and Warning instead of Critical in case of table doesn't exist</span><br><span class="line">24.</span><br><span class="line">-h, --host                  è¿æ¥çš„ä¸»æœºå</span><br><span class="line">25.</span><br><span class="line">-u, --user                  å¤‡ä»½æ‰€ä½¿ç”¨çš„ç”¨æˆ·</span><br><span class="line">26.</span><br><span class="line">-p, --pass&lt;a href="http://www.it165.net/edu/ebg/" target="_blank"class="keylink"&gt;word&lt;/a&gt;              å¯†ç </span><br><span class="line">27.</span><br><span class="line">-P, --port                  ç«¯å£</span><br><span class="line">28.</span><br><span class="line">-S, --socket                ä½¿ç”¨socketé€šä¿¡æ—¶çš„socketæ–‡ä»¶</span><br><span class="line">29.</span><br><span class="line">-t, --threads               å¼€å¯çš„å¤‡ä»½çº¿ç¨‹æ•°ï¼Œé»˜è®¤æ˜¯4</span><br><span class="line">30.</span><br><span class="line">-C, --compress-protocol     å‹ç¼©ä¸mysqlé€šä¿¡çš„æ•°æ®</span><br><span class="line">31.</span><br><span class="line">-V, --version               æ˜¾ç¤ºç‰ˆæœ¬å·</span><br><span class="line">32.</span><br><span class="line">-v, --verbose               è¾“å‡ºä¿¡æ¯æ¨¡å¼, 0 = silent, 1 = errors, 2 = warnings, 3= info, é»˜è®¤ä¸º 2</span><br></pre></td></tr></table></figure><h3 id="myloader-å‚æ•°"><a href="#myloader-å‚æ•°" class="headerlink" title="myloader å‚æ•°"></a>myloader å‚æ•°</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">01</span><br><span class="line">-d, --directory                   å¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶å¤¹</span><br><span class="line">02.</span><br><span class="line">-q, --queries-per-transaction     æ¯æ¬¡äº‹ç‰©æ‰§è¡Œçš„æŸ¥è¯¢æ•°é‡ï¼Œé»˜è®¤æ˜¯1000</span><br><span class="line">03.</span><br><span class="line">-o, --overwrite-tables            å¦‚æœè¦æ¢å¤çš„è¡¨å­˜åœ¨ï¼Œåˆ™å…ˆdropæ‰è¯¥è¡¨ï¼Œä½¿ç”¨è¯¥å‚æ•°ï¼Œéœ€è¦å¤‡ä»½æ—¶å€™è¦å¤‡ä»½è¡¨ç»“æ„</span><br><span class="line">04.</span><br><span class="line">-B, --database                    éœ€è¦è¿˜åŸçš„æ•°æ®åº“</span><br><span class="line">05.</span><br><span class="line">-e, --enable-binlog               å¯ç”¨è¿˜åŸæ•°æ®çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">06.</span><br><span class="line">-h, --host                        ä¸»æœº</span><br><span class="line">07.</span><br><span class="line">-u, --user                        è¿˜åŸçš„ç”¨æˆ·</span><br><span class="line">08.</span><br><span class="line">-p, --pass&lt;a href="http://www.it165.net/edu/ebg/" target="_blank"class="keylink"&gt;word&lt;/a&gt;                    å¯†ç </span><br><span class="line">09.</span><br><span class="line">-P, --port                        ç«¯å£</span><br><span class="line">10.</span><br><span class="line">-S, --socket                      socketæ–‡ä»¶</span><br><span class="line">11.</span><br><span class="line">-t, --threads                     è¿˜åŸæ‰€ä½¿ç”¨çš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤æ˜¯4</span><br><span class="line">12.</span><br><span class="line">-C, --compress-protocol           å‹ç¼©åè®®</span><br><span class="line">13.</span><br><span class="line">-V, --version                     æ˜¾ç¤ºç‰ˆæœ¬</span><br><span class="line">14.</span><br><span class="line">-v, --verbose                     è¾“å‡ºæ¨¡å¼, 0 = silent, 1 = errors, 2 = warnings,3 = info, é»˜è®¤ä¸º2</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ¡ˆä¾‹"><a href="#ä½¿ç”¨æ¡ˆä¾‹" class="headerlink" title="ä½¿ç”¨æ¡ˆä¾‹"></a>ä½¿ç”¨æ¡ˆä¾‹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¤‡ä»½gameåº“åˆ°/backup/01æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶å‹ç¼©å¤‡ä»½æ–‡ä»¶</span></span><br><span class="line">mydumper -u root -p ### -h localhost -B game -c -o /backup/01</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¤‡ä»½æ‰€æœ‰æ•°æ®åº“ï¼Œå¹¶å¤‡ä»½äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œå¤‡ä»½è‡³/backup/02æ–‡ä»¶å¤¹</span></span><br><span class="line"></span><br><span class="line">mydumper -u root -p ### -h localhost -o /backup/02</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¤‡ä»½game.tb_playerè¡¨ï¼Œä¸”ä¸å¤‡ä»½è¡¨ç»“æ„ï¼Œå¤‡ä»½è‡³/backup/03æ–‡ä»¶å¤¹</span></span><br><span class="line"></span><br><span class="line">mydumper -u root -p ### -h localhost -T tb_player -m -o /backup/03</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿˜åŸ</span></span><br><span class="line"></span><br><span class="line">mysqlload -u root -p ### -h localhost -B game -d /backup/02</span><br><span class="line"></span><br><span class="line">mydumperçš„less lockingæ¨¡å¼</span><br><span class="line"></span><br><span class="line">mydumperä½¿ç”¨--less-lockingå¯ä»¥å‡å°‘é”ç­‰å¾…æ—¶é—´ï¼Œæ­¤æ—¶mydumperçš„æ‰§è¡Œæœºåˆ¶å¤§è‡´ä¸º</span><br></pre></td></tr></table></figure><h2 id="mysqldump-mysqlpump-mydumperå¯¹æ¯”"><a href="#mysqldump-mysqlpump-mydumperå¯¹æ¯”" class="headerlink" title="mysqldump,mysqlpump,mydumperå¯¹æ¯”"></a>mysqldump,mysqlpump,mydumperå¯¹æ¯”</h2><table><thead><tr><th align="left">è™šæ‹Ÿæœº</th><th align="left">IPåœ°å€</th><th align="left">è½¯ä»¶</th></tr></thead><tbody><tr><td align="left">mastera</td><td align="left">172.25.0.11</td><td align="left">mysql server 5.7.17</td></tr><tr><td align="left">workstation</td><td align="left">172.25.0.10</td><td align="left">python python-matplotlib</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">[root@mastera mysql5.7]# ls</span><br><span class="line">mysql-5.7.17-1.el7.x86_64.rpm-bundle.tar                 mysql-community-libs-compat-5.7.17-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-client-5.7.17-1.el7.x86_64.rpm           mysql-community-minimal-debuginfo-5.7.17-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-common-5.7.17-1.el7.x86_64.rpm           mysql-community-server-5.7.17-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-devel-5.7.17-1.el7.x86_64.rpm            mysql-community-server-minimal-5.7.17-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-embedded-5.7.17-1.el7.x86_64.rpm         mysql-community-test-5.7.17-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-embedded-compat-5.7.17-1.el7.x86_64.rpm  sysbench-master</span><br><span class="line">mysql-community-embedded-devel-5.7.17-1.el7.x86_64.rpm   sysbench-master.zip</span><br><span class="line">mysql-community-libs-5.7.17-1.el7.x86_64.rpm</span><br><span class="line">[root@mastera mysql5.7]# rpm -ivh mysql-community-client-5.7.17-1.el7.x86_64.rpm mysql-community-common-5.7.17-1.el7.x86_64.rpm mysql-community-devel-5.7.17-1.el7.x86_64.rpm mysql-community-server-5.7.17-1.el7.x86_64.rpm mysql-community-libs-5.7.17-1.el7.x86_64.rpm </span><br><span class="line">warning: mysql-community-client-5.7.17-1.el7.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY</span><br><span class="line">Preparing...                          ################################# [100%]</span><br><span class="line">Updating / installing...</span><br><span class="line">   1:mysql-community-common-5.7.17-1.e################################# [ 20%]</span><br><span class="line">   2:mysql-community-libs-5.7.17-1.el7################################# [ 40%]</span><br><span class="line">   3:mysql-community-client-5.7.17-1.e################################# [ 60%]</span><br><span class="line">   4:mysql-community-server-5.7.17-1.e################################# [ 80%]</span><br><span class="line">   5:mysql-community-devel-5.7.17-1.el################################# [100%]</span><br><span class="line">[root@mastera mysql5.7]# systemctl start mysqld</span><br><span class="line">[root@mastera mysql5.7]# grep password /var/log/mysqld.log</span><br><span class="line">2017-02-09T08:32:17.515190Z 1 [Note] A temporary password is generated for root@localhost: p!hHXls+U6Po</span><br><span class="line">[root@mastera mysql5.7]# mysqladmin -uroot -p'p!hHXls+U6Po' password '(Uploo00king)'</span><br><span class="line">mysqladmin: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Warning: Since password will be sent to server in plain text, use ssl connection to ensure password safety.</span><br><span class="line">[root@mastera mysql5.7]# mysql -uroot -p'(Uploo00king)'</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 4</span><br><span class="line">Server version: 5.7.17 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create database db1;</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> use db1;</span></span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table t1 (id int primary key auto_increment,num int);</span></span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table t2 like t1;</span></span><br><span class="line">Query OK, 0 rows affected (0.24 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table t3 like t1;</span></span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table t4 like t1;</span></span><br><span class="line">Query OK, 0 rows affected (0.34 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> delimiter //</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create procedure booboo_insert (<span class="keyword">in</span> tb_name varchar(20)) begin <span class="built_in">declare</span> i int; <span class="built_in">declare</span> j int; <span class="built_in">declare</span> _sql varchar(100); <span class="built_in">set</span> i=1; <span class="built_in">set</span> j=10000; <span class="built_in">set</span> _sql=concat(<span class="string">'insert into '</span>,tb_name,<span class="string">' set num='</span>,i); <span class="built_in">set</span> @sql=_sql;start transaction; prepare s2 from @sql; <span class="keyword">while</span> i&lt;=j <span class="keyword">do</span> execute s2; <span class="built_in">set</span> i=i+1;end <span class="keyword">while</span>; deallocate prepare s2; commit; end//</span></span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> call booboo_insert(<span class="string">'t1'</span>)//</span></span><br><span class="line">Query OK, 0 rows affected (0.71 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> call booboo_insert(<span class="string">'t2'</span>)//</span></span><br><span class="line">Query OK, 0 rows affected (0.71 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> call booboo_insert(<span class="string">'t3'</span>)//</span></span><br><span class="line">Query OK, 0 rows affected (0.68 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> call booboo_insert(<span class="string">'t4'</span>)//</span></span><br><span class="line">Query OK, 0 rows affected (0.83 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show table status;</span></span><br><span class="line">+------+--------+---------+------------+-------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-------------------+----------+----------------+---------+</span><br><span class="line">| Name | Engine | Version | Row_format | Rows  | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time         | Check_time | Collation         | Checksum | Create_options | Comment |</span><br><span class="line">+------+--------+---------+------------+-------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-------------------+----------+----------------+---------+</span><br><span class="line">| t1   | InnoDB |      10 | Dynamic    | 10000 |             32 |      327680 |               0 |            0 |         0 |          10002 | 2017-02-09 16:40:53 | 2017-02-09 16:43:39 | NULL       | latin1_swedish_ci |     NULL |                |         |</span><br><span class="line">| t2   | InnoDB |      10 | Dynamic    | 10000 |             32 |      327680 |               0 |            0 |         0 |          10001 | 2017-02-09 16:40:58 | 2017-02-09 16:43:59 | NULL       | latin1_swedish_ci |     NULL |                |         |</span><br><span class="line">| t3   | InnoDB |      10 | Dynamic    | 10000 |             32 |      327680 |               0 |            0 |         0 |          10001 | 2017-02-09 16:41:00 | 2017-02-09 16:44:02 | NULL       | latin1_swedish_ci |     NULL |                |         |</span><br><span class="line">| t4   | InnoDB |      10 | Dynamic    | 10000 |             32 |      327680 |               0 |            0 |         0 |          10001 | 2017-02-09 16:41:03 | 2017-02-09 16:44:05 | NULL       | latin1_swedish_ci |     NULL |                |         |</span><br><span class="line">+------+--------+---------+------------+-------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-------------------+----------+----------------+---------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">exit</span></span></span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line">[root@mastera mysql5.7]# du -h /var/lib/mysql</span><br><span class="line">12M/var/lib/mysql/mysql</span><br><span class="line">1.1M/var/lib/mysql/performance_schema</span><br><span class="line">676K/var/lib/mysql/sys</span><br><span class="line">1.6M/var/lib/mysql/db1</span><br><span class="line">135M/var/lib/mysql</span><br></pre></td></tr></table></figure><p>å­˜å‚¨è¿‡ç¨‹</p><p>è¯¥å­˜å‚¨è¿‡ç¨‹å¯ä»¥å¾ªç¯æ’å…¥10000æ¡æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥å¸¦å‚æ•°ï¼ˆè¡¨åï¼‰è°ƒç”¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">create procedure booboo_insert (in tb_name varchar(20)) </span><br><span class="line">begin </span><br><span class="line">declare i int; </span><br><span class="line">declare j int; </span><br><span class="line">declare _sql varchar(100); </span><br><span class="line">set i=1; set j=10000; </span><br><span class="line">set _sql=concat('insert into ',tb_name,' set num=',i); </span><br><span class="line">set @sql=_sql;</span><br><span class="line">start transaction; </span><br><span class="line">prepare s2 from @sql; </span><br><span class="line">while i&lt;=j do </span><br><span class="line">execute s2; </span><br><span class="line">set i=i+1;</span><br><span class="line">end while; </span><br><span class="line">deallocate prepare s2; </span><br><span class="line">commit; </span><br><span class="line">end//</span><br></pre></td></tr></table></figure><p>æ‰‹åŠ¨åˆ›å»ºäº†å››ä¸ªæµ‹è¯•è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°db1åº“çš„å¾ˆå°æ‰1.6Mï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹æ•°æ®é‡æ¯”è¾ƒå°æ—¶ï¼Œmysqldumpå’Œmysqlpumpçš„æ€§èƒ½</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@mastera mysql5.7]# time mysqlpump -uroot -p'(Uploo00king)' db1 --default-parallelism=4 &gt; /tmp/mysql.pump4.sql</span><br><span class="line">mysqlpump: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Dump progress: 0/1 tables, 250/10000 rows</span><br><span class="line">Dump completed in 3016 milliseconds</span><br><span class="line"></span><br><span class="line">real0m3.166s</span><br><span class="line">user0m0.219s</span><br><span class="line">sys0m0.475s</span><br><span class="line">[root@mastera mysql5.7]# time mysqlpump -uroot -p'(Uploo00king)' db1  &gt; /tmp/mysql.pump2.sql</span><br><span class="line">mysqlpump: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Dump progress: 0/1 tables, 250/10000 rows</span><br><span class="line">Dump completed in 3703 milliseconds</span><br><span class="line"></span><br><span class="line">real0m3.871s</span><br><span class="line">user0m0.307s</span><br><span class="line">sys0m0.606s</span><br><span class="line">[root@mastera mysql5.7]# time mysqldump -uroot -p'(Uploo00king)' db1 &gt; /tmp/mysql.dump.sql</span><br><span class="line">mysqldump: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line"></span><br><span class="line">real0m0.411s</span><br><span class="line">user0m0.024s</span><br><span class="line">sys0m0.116s</span><br></pre></td></tr></table></figure><p>ä»ç»“æœçœ‹ï¼Œæ•°æ®é‡éå¸¸å°çš„æ—¶å€™æ²¡å¿…è¦å¹¶è¡Œå¤åˆ¶ï¼Œmysqlpumpåè€Œæ›´æ…¢</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¯•ä¸€ä¸‹æ•°æ®é‡æ¯”è¾ƒå¤§çš„æ—¶å€™</p><p>åˆ›å»ºsbteståº“ï¼Œä½¿ç”¨sysbenchå‹æµ‹å·¥å…·å‡†å¤‡4ä¸ª1000000è¡Œçš„è¡¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show table status;</span></span><br><span class="line">+---------+--------+---------+------------+--------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-------------------+----------+------------------+---------+</span><br><span class="line">| Name    | Engine | Version | Row_format | Rows   | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time         | Check_time | Collation         | Checksum | Create_options   | Comment |</span><br><span class="line">+---------+--------+---------+------------+--------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-------------------+----------+------------------+---------+</span><br><span class="line">| sbtest1 | InnoDB |      10 | Dynamic    | 986776 |            221 |   218841088 |               0 |            0 |   4194304 |        1000001 | 2017-02-09 17:03:29 | 2017-02-09 17:03:18 | NULL       | latin1_swedish_ci |     NULL | max_rows=1000000 |         |</span><br><span class="line">| sbtest2 | InnoDB |      10 | Dynamic    | 986020 |            234 |   231456768 |               0 |            0 |   6291456 |           NULL | 2017-02-09 17:06:22 | 2017-02-09 17:07:14 | NULL       | latin1_swedish_ci |     NULL |                  |         |</span><br><span class="line">| sbtest3 | InnoDB |      10 | Dynamic    | 986020 |            234 |   231456768 |               0 |            0 |   6291456 |           NULL | 2017-02-09 17:07:25 | 2017-02-09 17:08:11 | NULL       | latin1_swedish_ci |     NULL |                  |         |</span><br><span class="line">| sbtest4 | InnoDB |      10 | Dynamic    | 986559 |            225 |   222019584 |               0 |            0 |   6291456 |           NULL | 2017-02-09 17:08:24 | 2017-02-09 17:09:15 | NULL       | latin1_swedish_ci |     NULL |                  |         |</span><br><span class="line">+---------+--------+---------+------------+--------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-------------------+----------+------------------+---------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">[root@mastera sysbench-master]# du -h /var/lib/mysql</span><br><span class="line">12M/var/lib/mysql/mysql</span><br><span class="line">1.1M/var/lib/mysql/performance_schema</span><br><span class="line">676K/var/lib/mysql/sys</span><br><span class="line">1.6M/var/lib/mysql/db1</span><br><span class="line">937M/var/lib/mysql/sbtest</span><br><span class="line">1.2G/var/lib/mysql</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°å½“å‰æ•°æ®åº“çš„æ•°æ®è¾¾åˆ°äº†11Gï¼Œæ¥ä¸‹æ¥åšå¤‡ä»½</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@mastera ~]# time mysqldump -uroot -p'(Uploo00king)' sbtest --single-transaction &gt; /tmp/mysqldump.sbtest.sql</span><br><span class="line">[root@mastera ~]# time mysqlpump -uroot -p'(Uploo00king)' sbtest --single-transaction --default-parallelism=2 &gt; /tmp/mysqlpump.sbtest.sql</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;mysqldump&quot;&gt;&lt;a href=&quot;#mysqldump&quot; class=&quot;headerlink&quot; title=&quot;mysqldump&quot;&gt;&lt;/a&gt;mysqldump&lt;/h2&gt;&lt;p&gt;mysqlç»å…¸é€»è¾‘å¤‡ä»½å·¥å…·&lt;/p&gt;
&lt;p&gt;å‚æ•°è¯´æ˜ï¼Œå…·ä½“çš„å‚æ•°å¯ä»¥ç”¨mysqldum
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†" scheme="http://www.toberoot.com/tags/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬åè¯¾ MySQL5.6ä¸€ä¸»å¤šä»åŠåŒæ­¥å¤åˆ¶</title>
    <link href="http://www.toberoot.com/2016/12/25/booboo_mysql/07-MySQL5.6%E4%B8%80%E4%B8%BB%E5%A4%9A%E4%BB%8E%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%A4%8D%E5%88%B6/"/>
    <id>http://www.toberoot.com/2016/12/25/booboo_mysql/07-MySQL5.6%E4%B8%80%E4%B8%BB%E5%A4%9A%E4%BB%8E%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%A4%8D%E5%88%B6/</id>
    <published>2016-12-24T21:06:27.000Z</published>
    <updated>2020-03-24T05:27:17.957Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¦æ±‚æŒæ¡mysql5.6çš„äºŒè¿›åˆ¶å®‰è£…å’ŒAB replicationä¹‹åŠåŒæ­¥å¤åˆ¶</p></blockquote><table><thead><tr><th align="left">role</th><th align="left">server</th><th align="left">ip</th></tr></thead><tbody><tr><td align="left">master</td><td align="left">mastera</td><td align="left">172.25.0.11</td></tr><tr><td align="left">slave</td><td align="left">masterb</td><td align="left">172.25.0.12</td></tr><tr><td align="left">slave</td><td align="left">slavea</td><td align="left">172.25.0.13</td></tr></tbody></table><h2 id="å®‰è£…äºŒè¿›åˆ¶çš„mysql5-6"><a href="#å®‰è£…äºŒè¿›åˆ¶çš„mysql5-6" class="headerlink" title="å®‰è£…äºŒè¿›åˆ¶çš„mysql5.6"></a>å®‰è£…äºŒè¿›åˆ¶çš„mysql5.6</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">[root@mastera0 ~]# tar -xf mysql-5.6.20-linux-glibc2.5-x86_64.tar.gz </span><br><span class="line">[root@mastera0 ~]# cd mysql-5.6.20-linux-glibc2.5-x86_64</span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# ls</span><br><span class="line">bin  COPYING  data  docs  include  INSTALL-BINARY  lib  man  mysql-test  README  scripts  share  sql-bench  support-files</span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# cat INSTALL-BINARY</span><br><span class="line">... ...</span><br><span class="line"> To install and use a MySQL binary distribution, the basic command</span><br><span class="line">   sequence looks like this:</span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> groupadd mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> useradd -r -g mysql mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> <span class="built_in">cd</span> /usr/<span class="built_in">local</span></span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> tar zxvf /path/to/mysql-VERSION-OS.tar.gz</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> ln -s full-path-to-mysql-VERSION-OS mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> <span class="built_in">cd</span> mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chown -R mysql .</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chgrp -R mysql .</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> scripts/mysql_install_db --user=mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chown -R root .</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chown -R mysql data</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> bin/mysqld_safe --user=mysql &amp;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Next <span class="built_in">command</span> is optional</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> cp support-files/mysql.server /etc/init.d/mysql.server</span></span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# groupadd mysql</span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# cd ..</span><br><span class="line">[root@mastera0 ~]# useradd -r -g mysql mysql</span><br><span class="line">[root@mastera0 ~]# cd /usr/local</span><br><span class="line">[root@mastera0 local]# mv /root/mysql-5.6.20-linux-glibc2.5-x86_64 .</span><br><span class="line">[root@mastera0 local]# ls</span><br><span class="line">bin  games    lib    libexec                             sbin   src</span><br><span class="line">etc  include  lib64  mysql-5.6.20-linux-glibc2.5-x86_64  share</span><br><span class="line">[root@mastera0 local]# ln -s mysql-5.6.20-linux-glibc2.5-x86_64 mysql</span><br><span class="line">[root@mastera0 local]# ll mysql</span><br><span class="line">lrwxrwxrwx.  1 root root   34 Dec 11 12:20 mysql -&gt; mysql-5.6.20-linux-glibc2.5-x86_64</span><br><span class="line">[root@mastera0 mysql]# cd mysql</span><br><span class="line">[root@mastera0 mysql]# mkdir /data/mysql/data -p</span><br><span class="line">[root@mastera0 mysql]# chown mysql. /data/mysql/data</span><br><span class="line">[root@mastera0 mysql]# chown mysql. /data/mysql/data -R</span><br><span class="line">[root@mastera0 mysql]# ll -d /data/mysql/data</span><br><span class="line">drwxr-xr-x. 2 mysql mysql 4096 Dec 11 12:24 /data/mysql/data</span><br><span class="line">[root@mastera0 mysql]# scripts/mysql_install_db --user=mysql --datadir=/data/mysql/data --basedir=/usr/local/mysql</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]# ll /data/mysql/data</span><br><span class="line">total 110604</span><br><span class="line">-rw-rw----. 1 mysql mysql 12582912 Dec 11 12:28 ibdata1</span><br><span class="line">-rw-rw----. 1 mysql mysql 50331648 Dec 11 12:28 ib_logfile0</span><br><span class="line">-rw-rw----. 1 mysql mysql 50331648 Dec 11 12:28 ib_logfile1</span><br><span class="line">drwx------. 2 mysql mysql     4096 Dec 11 12:28 mysql</span><br><span class="line">drwx------. 2 mysql mysql     4096 Dec 11 12:28 performance_schema</span><br><span class="line">drwx------. 2 mysql mysql     4096 Dec 11 12:28 test</span><br><span class="line">[root@mastera0 mysql]# cp /mnt/mysql/my.cnf /etc/my.cnf</span><br><span class="line">[root@mastera0 mysql]# vim /etc/my.cnf</span><br><span class="line">[client]</span><br><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœä¸è®¤è¯†è¿™ä¸ªå‚æ•°ä¼šå¿½ç•¥</span></span><br><span class="line">loose-default-character-set=utf8</span><br><span class="line">loose-prompt='\u@\h:\p [\d]&gt;'</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">basedir = /usr/local/mysql</span><br><span class="line">datadir = /data/mysql/data</span><br><span class="line">user=mysql</span><br><span class="line">port = 3306</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">pid-file=/data/tmp/mysql.pid</span><br><span class="line">tmpdir=/data1/tmp</span><br><span class="line">character_set_server=utf8</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">skip</span></span><br><span class="line">skip-external_locking=1</span><br><span class="line">skip-name-resolve=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">AB replication</span></span><br><span class="line">server-id = 1</span><br><span class="line">log-bin = /data/mysql/log-data/mastera</span><br><span class="line">binlog_format=row</span><br><span class="line">max_binlog_cache_size=2000M</span><br><span class="line">max_binlog_size=1G</span><br><span class="line">sync_binlog=1</span><br><span class="line"><span class="meta">#</span><span class="bash">expire_logs_days=7</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">semi_sync</span></span><br><span class="line">rpl_semi_sync_master_enabled=1</span><br><span class="line">rpl_semi_sync_master_timeout=1000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]# pwd</span><br><span class="line">/usr/local/mysql</span><br><span class="line">[root@mastera0 mysql]# cp support-files/mysql.server /etc/init.d/mysql.server</span><br><span class="line">[root@mastera0 mysql]# echo export PATH=$PATH:/usr/local/mysql/support-files/ &gt;&gt; /etc/bashrc</span><br></pre></td></tr></table></figure><table><thead><tr><th align="left">mysql</th><th align="left">è½¯ä»¶æ¶æ„</th></tr></thead><tbody><tr><td align="left">æ•°æ®ç›®å½•</td><td align="left">/data/mysql/data</td></tr><tr><td align="left">binlogç›®å½•</td><td align="left">/data/mysql/log-data</td></tr><tr><td align="left">pidæ–‡ä»¶</td><td align="left">/data/tmp</td></tr><tr><td align="left">ä¸´æ—¶ç›®å½•</td><td align="left">/data1/tmp/</td></tr></tbody></table><p>ä»¥ä¸Šç›®å½•æ‰€å±è€…å’Œæ‰€å±ç»„éƒ½éœ€è¦ä¸ºmysql.mysql</p><p>åŒæ ·å»å®‰è£…masterb slavea</p><hr><h2 id="é…ç½®ä¸»ä»"><a href="#é…ç½®ä¸»ä»" class="headerlink" title="é…ç½®ä¸»ä»"></a>é…ç½®ä¸»ä»</h2><p>æ­¥éª¤å¿½ç•¥</p><h2 id="é…ç½®ä¸»ä»åŠåŒæ­¥æ¨¡å¼"><a href="#é…ç½®ä¸»ä»åŠåŒæ­¥æ¨¡å¼" class="headerlink" title="é…ç½®ä¸»ä»åŠåŒæ­¥æ¨¡å¼"></a>é…ç½®ä¸»ä»åŠåŒæ­¥æ¨¡å¼</h2><blockquote><p>å®‰è£…åŠåŒæ­¥æ’ä»¶</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">install plugin rpl_semi_sync_master soname <span class="string">'semisync_master.so'</span>;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">install plugin rpl_semi_sync_slave soname <span class="string">'semisync_slave.so'</span>;</span></span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®æ–‡ä»¶ä¸­éœ€è¦æ‰“å¼€ç›¸åº”çš„å‚æ•°</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpl_semi_sync_master_enabled=1</span><br><span class="line">rpl_semi_sync_master_timeout=1000 #ms</span><br><span class="line">rpl_semi_sync_slave_enabled=1</span><br></pre></td></tr></table></figure><blockquote><p>é‡æ–°å¯åŠ¨æœåŠ¡</p></blockquote><blockquote><p>æµ‹è¯•</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">mastera</span><br><span class="line">root@localhost:mysql.sock [(none)]&gt;show variables like "%semi%";</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">| Variable_name                      | Value |</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">| rpl_semi_sync_master_enabled       | ON    |</span><br><span class="line">| rpl_semi_sync_master_timeout       | 1000  |</span><br><span class="line">| rpl_semi_sync_master_trace_level   | 32    |</span><br><span class="line">| rpl_semi_sync_master_wait_no_slave | ON    |</span><br><span class="line">| rpl_semi_sync_slave_enabled        | OFF   |</span><br><span class="line">| rpl_semi_sync_slave_trace_level    | 32    |</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">masterb</span><br><span class="line">root@localhost:mysql.sock [(none)]&gt;show variables like "%semi%";</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">| Variable_name                      | Value |</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">| rpl_semi_sync_master_enabled       | OFF   |</span><br><span class="line">| rpl_semi_sync_master_timeout       | 10000 |</span><br><span class="line">| rpl_semi_sync_master_trace_level   | 32    |</span><br><span class="line">| rpl_semi_sync_master_wait_no_slave | ON    |</span><br><span class="line">| rpl_semi_sync_slave_enabled        | ON    |</span><br><span class="line">| rpl_semi_sync_slave_trace_level    | 32    |</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">slavea</span><br><span class="line">root@localhost:mysql.sock [(none)]&gt;show variables like "%semi%";</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">| Variable_name                      | Value |</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">| rpl_semi_sync_master_enabled       | OFF   |</span><br><span class="line">| rpl_semi_sync_master_timeout       | 10000 |</span><br><span class="line">| rpl_semi_sync_master_trace_level   | 32    |</span><br><span class="line">| rpl_semi_sync_master_wait_no_slave | ON    |</span><br><span class="line">| rpl_semi_sync_slave_enabled        | ON    |</span><br><span class="line">| rpl_semi_sync_slave_trace_level    | 32    |</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>ç°åœ¨å°†masterbå’Œslaveaçš„slaveå…³é—­ï¼Œåœ¨masteraä¸Šè¿›è¡Œå†™æ“ä½œï¼Œå¹¶è§‚å¯Ÿã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:mysql.sock [(none)]&gt;insert into db1.t1 values (2);</span><br><span class="line">Query OK, 1 row affected (1.29 sec)</span><br><span class="line"></span><br><span class="line">root@localhost:mysql.sock [(none)]&gt;insert into db1.t1 values (3);</span><br><span class="line">Query OK, 1 row affected (0.20 sec)</span><br><span class="line"></span><br><span class="line">root@localhost:mysql.sock [(none)]&gt;insert into db1.t1 values (4);</span><br><span class="line">Query OK, 1 row affected (0.22 sec)</span><br></pre></td></tr></table></figure><p>å½“masteraç­‰å¾…1000msä¹Ÿå°±æ˜¯1såï¼Œå°±ä¸ç­‰äº†ï¼Œæ‰€ä»¥çœ‹åˆ°æ¶ˆè€—1.29sï¼Œè€Œä¹‹åçš„æ’å…¥å°±å˜æˆå¼‚æ­¥äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;è¦æ±‚æŒæ¡mysql5.6çš„äºŒè¿›åˆ¶å®‰è£…å’ŒAB replicationä¹‹åŠåŒæ­¥å¤åˆ¶&lt;/p&gt;
&lt;/blockquote&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;left&quot;&gt;role&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;s
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†" scheme="http://www.toberoot.com/tags/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬äºŒè¯¾ MySQLå’ŒMariaDBæ•°æ®åº“ä»‹ç»</title>
    <link href="http://www.toberoot.com/2016/12/25/booboo_mysql/01-MySQL%E5%92%8CMariaDB%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8B%E7%BB%8D/"/>
    <id>http://www.toberoot.com/2016/12/25/booboo_mysql/01-MySQL%E5%92%8CMariaDB%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8B%E7%BB%8D/</id>
    <published>2016-12-24T21:06:27.000Z</published>
    <updated>2020-03-24T05:24:35.213Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ"><a href="#æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ" class="headerlink" title="æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ"></a>æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ</h3><p><strong>æ•°æ®åº“(database)</strong>:  ä¿å­˜æœ‰ç»„ç»‡çš„æ•°æ®çš„å®¹å™¨(é€šå¸¸æ˜¯ä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ç»„æ–‡ä»¶)ã€‚</p><p><strong>æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ(DBMS)</strong>: é¡¾åæ€ä¹‰ï¼Œæ—¢ç„¶æ˜¯æ•°æ®ç®¡ç†ç³»ç»Ÿï¼Œå°±æ˜¯ç”¨æ¥ç®¡ç†æ•°æ®çš„æ•°æ®åº“è½¯ä»¶</p><blockquote><p><strong>* çº¿ä¸Šç”Ÿäº§ç¯å¢ƒä¸­æœ‰å¾ˆå¤šæ•°æ®ï¼Œä¸¾ä¾‹è¯´æ˜ï¼Œè®ºå›ã€qqã€å¾®åšã€æœ‹å‹åœˆç­‰ç­‰ã€‚ *</strong><br>åœ¨æˆ‘ä»¬çº¿ä¸Šç”Ÿäº§ç¯å¢ƒå½“ä¸­æœ‰å¾ˆå¤šæ•°æ®ï¼Œé‚£ä¹ˆç”¨æˆ·æ¯”å¦‚è¯´ç™»ä¸€ä¸ªè®ºå›å‘äº†ä¸ªå¸–å­ï¼Œè¿™ä¸ªå¸–å­é‡Œçš„å†…å®¹å°±æ˜¯ä¸€ä¸ªæ•°æ®ï¼›ç”¨æˆ·ç™»é™†ä¸€ä¸ªè´­ç‰©ç½‘ç«™ï¼Œä¹°äº†ä¸€ä¸ªå•†å“ï¼Œç”¨æˆ·è´­ä¹°ä¸€ä¸ªå•†å“æ˜¯ä¸€ä¸ªè®¢å•ä¿¡æ¯ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ•°æ®ï¼Œå„ç§å„æ ·çš„ç¯å¢ƒï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œåœ¨æˆ‘ä»¬çš„çº¿ä¸Šåº”ç”¨å½“ä¸­ï¼Œå­˜åœ¨å¾ˆå¤šç”¨æˆ·ä¿¡æ¯ï¼Œä»–è´­ä¹°å•†å“ä¹Ÿå¥½ï¼Œå‘å¸–å­ä¹Ÿå¥½ï¼Œæˆ–è€…ä»–æ‰“æ¸¸æˆæ³¨å†Œå¸å·ä¹Ÿå¥½ï¼Œç­‰ç­‰ï¼Œè¿™äº›ä¸œè¥¿å…¶å®éƒ½æ˜¯ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›ä¿¡æ¯ä¿å­˜ä¸‹æ¥ï¼Œå› ä¸ºä»¥åæ¯æ¬¡ç”¨æˆ·ç™»é™†æ—¶éƒ½éœ€è¦åå¤çš„è¯»å†™ï¼Œè¯»å†™ä½ è´­ä¹°è¿‡çš„å•†å“ï¼Œè¯»å†™ä½ å‘è¿‡çš„å¸–å­ï¼Œéšç€æˆ‘ä»¬ç”¨æˆ·æ•°é‡è¶Šæ¥è¶Šå¤šï¼Œè¿™ç§ç±»ä¼¼çš„æ•°æ®ä¼šè¶Šæ¥è¶Šå¤šï¼Œä»ä¸€å¼€å§‹çš„ä¸€ä¸ªç”¨æˆ·åˆ°åé¢çš„ä¸€ä¸‡ä¸ªç”¨æˆ·ï¼Œåˆ°æˆå¹´ç´¯æœˆä¸‹æ¥ï¼Œæˆ‘ä»¬å‘ç°è®ºå›å·²ç»æœ‰äº†å‡ åƒä¸‡æ¡å¸–å­ï¼Œæ¯ä¸ªå¸–å­åˆæœ‰å¾ˆå¤šçš„å›å¤ï¼Œè¿™æ—¶å€™ä½ ä¼šå‘ç°æˆ‘ä»¬çš„æ•°æ®é‡è¶Šæ¥è¶Šå¤§ã€‚</p></blockquote><blockquote><p><strong>* æ•°æ®æ—©æœŸä¿å­˜çš„æ–¹å¼ï¼Œæ–‡æœ¬æ–‡ä»¶ï¼Œä»‹ç»è¯»å–æ–¹å¼ã€ä¼˜ç¼ºç‚¹ï¼Œä¸¾ä¾‹è¯´æ˜ï¼Œåšä¸€ä¸ªå°å®éªŒã€‚ *</strong><br>é‚£ä¹ˆåœ¨æ—©äº›å¹´çš„æ—¶å€™å‘¢ï¼Œæˆ‘ä»¬è¯´æœ€æ—©æ•°æ®ä¿å­˜çš„æ–¹æ³•æ˜¯æ–‡æœ¬æ–¹å¼ä¿å­˜ï¼Œæ–‡æœ¬æ–‡ä»¶ä¿å­˜ï¼Œå°±æ˜¯è¯´æˆ‘ä»¬ç½‘ç«™ä¸Šæœ‰ä¸€åƒä¸‡ä¸ªå¸–å­ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸€åƒä¸‡ä¸ªå¸–å­æ”¾åœ¨ä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£é‡Œï¼Œå½“ç”¨æˆ·ç™»é™†åè¦è¯»å¸–çš„æ—¶å€™ï¼Œå°±è¦ä»è¿™ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­å»è¯»ï¼Œåæ¥æˆ‘ä»¬å‘ç°ï¼Œå½“æ–‡æœ¬æ–‡ä»¶è¡Œæ•°æ¯”è¾ƒå°‘çš„æ—¶å€™ï¼Œå‡ ç™¾è¡Œå‡ åƒè¡Œå‡ ä¸‡è¡Œè¿˜è¡Œï¼Œè¦æ˜¯å‡ åä¸‡è¡Œå‡ ç™¾ä¸‡è¡Œçš„è¯ï¼Œä½ ä¼šå‘ç°è¯»å–çš„æ—¶å€™éå¸¸çš„æ…¢ï¼Œæ…¢çš„è¯ï¼Œæœ‰çš„æ—¶å€™éœ€è¦åŠåˆ†é’Ÿï¼Œæœ‰çš„æ—¶å€™å¯èƒ½éœ€è¦äº”åˆ†é’Ÿï¼Œç”šè‡³æœ‰æ—¶å€™åŠå°æ—¶ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾è¿™ä¸ªé€Ÿåº¦æ˜¯ä¸è¡Œçš„ï¼Œæ²¡æœ‰å“ªä¸ªç”¨æˆ·è¯´æ„¿æ„ä¸ºäº†çœ‹ä¸ªå¸–å­ï¼Œåœ¨é‚£é‡Œç­‰ä¸ªåŠå°æ—¶ã€‚çœ‹åˆ°ä½ å¸–å­å‡ºæ¥äº†ï¼Œå¥½ï¼Œå¼€å§‹å›å¸–ï¼Œç„¶åä¸€ä¸ªå›å¸–æ“ä½œå®Œæˆåˆè¦ç­‰åŠä¸ªå°æ—¶ï¼Œæ‰èƒ½çœ‹åˆ°å›å¸–çš„ç»“æœã€‚å¾ˆæ˜æ˜¾ä¸è¡Œï¼Œæ‰€ä»¥å‘¢ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ–‡æœ¬æ–‡æ¡£æ–¹å¼ä¿å­˜ä¿¡æ¯æœ‰ä¸€ä¸ªéå¸¸å¤§çš„ç¼ºç‚¹ï¼Œå°±æ˜¯æˆ‘ä»¬çš„è¯»å†™é€Ÿåº¦ï¼Œéšç€æ–‡ä»¶å†…å®¹çš„å¢åŠ ï¼Œä»–çš„è¯»å†™é€Ÿåº¦ä¼šè¶Šæ¥è¶Šæ…¢ï¼Œå…³äºè¿™ä¸€ç‚¹ï¼Œä½ ä»¬å¯ä»¥è‡ªå·±åšä¸ªå®éªŒæµ‹ä»¥ä¸‹ï¼Œå†™ä¸ªå‡ åä¸‡è¡Œçš„æ•°æ®2-3ä¸ªGï¼Œè¿‡æ»¤å‡ºæŸä¸€è¡Œï¼Œæˆ–è€…è¯»ä¸€ä¸‹ï¼Œçœ‹çœ‹è¦èŠ±å¤šä¸Šå¤šå°‘æ—¶é—´ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">touch /tmp/a</span><br><span class="line">for i in `seq 1 500000 `</span><br><span class="line">do</span><br><span class="line">sed -n '1,$r /var/log/messages' /tmp/a</span><br><span class="line">done</span><br></pre></td></tr></table></figure><blockquote><p><strong>* æˆ‘ä»¬å¸Œæœ›çš„æ•°æ®è¯»å–æ–¹å¼æ˜¯æ€æ ·çš„å‘¢ï¼Ÿå¼•å‡ºæ•°æ®åº“çš„æ¦‚å¿µã€‚ *</strong><br>æˆ‘ä»¬åœ¨æ“ä½œè¿‡ç¨‹çš„å½“ä¸­ï¼Œå¹¶ä¸å¸Œæœ›æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½è¯»å–å‡ºæ¥ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘å¯èƒ½åªéœ€è¦è¯»å–å…¶ä¸­çš„ä¸€è¡Œï¼Œè€Œæ–‡æœ¬æ–‡æ¡£çš„æ“ä½œå‘½ä»¤ï¼Œå±äºç‰›æ“ä½œï¼Œä»–éœ€è¦ä»å¤´éƒ¨å¼€å§‹åšï¼Œå¾ˆå¤šæ—¶å€™ä»–è¿‡æ»¤çš„è¯éƒ½ä¼šä»å¤´åˆ°å°¾å¯»æ‰¾ä¸€éï¼Œæ‰èƒ½æ‰¾åˆ°ä½ éœ€è¦çš„é‚£ä¸€è¡Œæ•°æ®ï¼Œæˆ–è€…å¤šè¡Œæ•°æ®ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šæå¤§åœ°æ¶ˆè€—æ€§èƒ½ã€‚æˆ‘ä»¬å¸Œæœ›å®ç°çš„æ•ˆæœæ˜¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å–å…¶ä¸­çš„å‡ è¡Œï¼Œåˆ™è¿…é€Ÿåœ°å®šä½åˆ°é‚£å‡ è¡Œæ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä¸å•è¦çŸ¥é“æ–‡æœ¬æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ï¼Œæˆ‘è¿˜çŸ¥é“æ–‡æœ¬æ–‡ä»¶å½“ä¸­æ¯ä¸€è¡Œæ‰€åœ¨çš„ç³»ç»Ÿçš„ä½ç½®ï¼Œä¸å•æ˜¯ç³»ç»Ÿè¿˜æœ‰ç¡¬ç›˜ä¸Šçš„ä½ç½®ï¼Œä»–åœ¨ç¡¬ç›˜çš„ç¬¬å‡ ä¸ªç£é“ï¼Œç¬¬å‡ ä¸ªæ‰‡åŒºï¼Œæˆ‘è¦ç¬¬åè¡Œåˆ°å“ªé‡Œå»æ‰¾ï¼Œå–ç¬¬1000è¡Œåˆ°å“ªé‡Œå»æ‰¾ï¼Œä¸éœ€è¦ä»å¤´éƒ¨å»æ‰¾ï¼Œè¿™æ˜¯ä¸€ç§æ–‡ä»¶çš„æ“ä½œæ–¹æ³•ï¼Œæˆ–è€…æ˜¯æ•°æ®çš„æ“ä½œæ–¹æ³•ï¼Œäºæ˜¯å°±æœ‰äº†æˆ‘ä»¬çš„æ•°æ®åº“ã€‚</p></blockquote><p>æ•°æ®åº“å¦‚æœè¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œåœ¨å‡ åGçš„æ–‡ä»¶ä¸­è¿…é€Ÿå®šä½åˆ°ä½ éœ€è¦çš„æ•°æ®ï¼Œä»–éœ€è¦** ç´¢å¼•**ï¼Œæ‰€ä»¥å°½é‡å»ä¿å­˜å¯ç´¢å¼•æ•°æ®ï¼Œè¿™æ ·æ‰ä¼šè®©è¯»å†™æ€§èƒ½æœ‰æ‰€æé«˜ã€‚ä½†æ˜¯æ€»ä¼šæœ‰äººæŠŠå›¾ç‰‡è§†é¢‘ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰æ”¾åˆ°æ•°æ®åº“ä¸­ï¼Œæ•°æ®åº“æ˜¯æ²¡åŠæ³•å¯¹äºŒè¿›åˆ¶æ–‡ä»¶å†…å®¹åšç´¢å¼•çš„ã€‚æ•°æ®åˆ†å¯ç´¢å¼•æ•°æ®å’Œä¸å¯ç´¢å¼•æ•°æ®ã€‚ä½†ä¹Ÿä¸æ˜¯è¯´äºŒè¿›åˆ¶æ•°æ®å°±ä¸èƒ½æ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œåªæ˜¯è¯´æ”¾è¿›å»å¯¹æ€§èƒ½æ²¡æœ‰æé«˜ã€‚æ¯”å¦‚è¯´åšä¸ªè®ºå›ï¼Œå¦‚æœå‘å¸–æœ‰é™„ä»¶ï¼Œé‚£ä¹ˆé™„ä»¶æ˜¯ä¸Šä¼ åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„ï¼Œåœ¨åšå¤‡ä»½çš„æ—¶å€™ï¼Œæ•°æ®åº“è¦å¤‡ä»½ï¼Œç½‘ç«™æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶è¦å¤‡ä»½ï¼Œæœ‰äººå‘¢å°±å·æ‡’å°†æ‰€æœ‰æ•°æ®éƒ½æ”¾åˆ°æ•°æ®åº“ä¸‹ï¼Œå¤‡ä»½çš„æ—¶å€™å°±åªè¦å¤‡ä»½æ•°æ®åº“äº†ï¼Œä½†æ˜¯æˆ‘ä¸å»ºè®®è¿™ä¹ˆåšï¼Œå› ä¸ºæœ¬èº«æ•°æ®åº“å·²ç»å¾ˆå¤§äº†ï¼Œä½ å†æŠŠè¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶å¾€é‡Œé¢æ”¾ä¼šå¯¼è‡´æ•°æ®åº“æ›´å¤§ï¼Œæ›´åŠ è‡ƒè‚¿ã€‚è€Œä¸”æ•°æ®åº“æœ¬èº«æœ‰å¾ˆå¤šç¼“å†²ï¼Œä½ æ”¾çš„æ–‡ä»¶å¤ªå¤§ï¼Œç¼“å†²å°±ç”¨å¾—å¤šï¼Œç¼“å†²ç”¨çš„å¤šï¼Œå†…å­˜æ¶ˆè€—å¤§ï¼Œæ•°æ®åº“çš„æ€§èƒ½æ¶ˆè€—ä¼šæ˜æ˜¾ä¸Šå‡ã€‚æ‰€ä»¥è‡ªå·±å»çœ‹ï¼Œå°½é‡ä¸è¦å»ä¿å­˜ä¸å¯ç´¢å¼•çš„æ•°æ®ã€‚</p><h3 id="æ•°æ®åº“çš„åˆ†ç±»"><a href="#æ•°æ®åº“çš„åˆ†ç±»" class="headerlink" title="æ•°æ®åº“çš„åˆ†ç±»"></a>æ•°æ®åº“çš„åˆ†ç±»</h3><p>|æ•°æ®åº“ç±»å‹|æè¿°|ä¸»æµäº§å“|æœ‰è°åœ¨ç”¨|é€‚ç”¨åœºæ™¯|ä¸é€‚ç”¨åœºæ™¯|<br>|:â€“|:â€“|:â€“|:â€“|:â€“|:â€“|:â€“|<br>|å…³ç³»å‹æ•°æ®åº“|å…³ç³»å‹æ•°æ®åº“å°±æ˜¯ç”±äºŒç»´è¡¨åŠå…¶ä¹‹é—´çš„è”ç³»ç»„æˆçš„ä¸€ä¸ªæ•°æ®ç»„ç»‡|Oracleã€DB2ã€PostgreSQLã€Microsoft SQL Serverã€Microsoft Accessã€MySQLã€MariaDB|alibaba,sina,ç½‘æ˜“ï¼Œyoutubeï¼Œgoogleç­‰|ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ï¼ˆäº‹åŠ¡å¤„ç†ï¼‰ï¼›ç”±äºä»¥æ ‡å‡†åŒ–ä¸ºå‰æï¼Œæ•°æ®æ›´æ–°çš„å¼€é”€å¾ˆå°ï¼ˆç›¸åŒçš„å­—æ®µåŸºæœ¬ä¸Šéƒ½åªæœ‰ä¸€å¤„ï¼‰ï¼›å¯ä»¥è¿›è¡ŒJoinç­‰å¤æ‚æŸ¥è¯¢ï¼›èƒ½å¤Ÿä¿æŒæ•°æ®çš„ä¸€è‡´æ€§æ˜¯å…³ç³»å‹æ•°æ®åº“çš„æœ€å¤§ä¼˜åŠ¿|å¤§é‡æ•°æ®çš„å†™å…¥å¤„ç†ï¼›ä¸ºæœ‰æ•°æ®æ›´æ–°çš„è¡¨åšç´¢å¼•æˆ–è¡¨ç»“æ„(schema)å˜æ›´ï¼›å­—æ®µä¸å›ºå®šæ—¶åº”ç”¨ï¼›å¯¹ç®€å•æŸ¥è¯¢éœ€è¦å¿«é€Ÿè¿”å›ç»“æœçš„å¤„ç†|<br>|é”®å€¼ï¼ˆKey-Valueï¼‰æ•°æ®åº“|é”®å€¼æ•°æ®åº“å°±åƒåœ¨ä¼ ç»Ÿè¯­è¨€ä¸­ä½¿ç”¨çš„å“ˆå¸Œè¡¨ã€‚ä½ å¯ä»¥é€šè¿‡ key æ¥æ·»åŠ ã€æŸ¥è¯¢æˆ–è€…åˆ é™¤æ•°æ®ï¼Œé‰´äºä½¿ç”¨ä¸»é”®è®¿é—®ï¼Œæ‰€ä»¥ä¼šè·å¾—ä¸é”™çš„æ€§èƒ½åŠæ‰©å±•æ€§ã€‚|Riakã€Redisã€Memcachedã€Amazonâ€™s Dynamoã€Project Voldemort|    GitHub ï¼ˆRiakï¼‰ã€BestBuy ï¼ˆRiakï¼‰ã€Twitter ï¼ˆRediså’ŒMemcachedï¼‰ã€StackOverFlow ï¼ˆRedisï¼‰ã€ Instagram ï¼ˆRedisï¼‰ã€Youtube ï¼ˆMemcachedï¼‰ã€Wikipediaï¼ˆMemcachedï¼‰|å‚¨å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯”å¦‚ä¼šè¯ã€é…ç½®æ–‡ä»¶ã€å‚æ•°ã€è´­ç‰©è½¦ç­‰ç­‰ã€‚è¿™äº›ä¿¡æ¯ä¸€èˆ¬éƒ½å’Œ IDï¼ˆé”®ï¼‰æŒ‚é’©ï¼Œè¿™ç§æƒ…æ™¯ä¸‹é”®å€¼æ•°æ®åº“æ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚    |1. å–ä»£é€šè¿‡é”®æŸ¥è¯¢ï¼Œè€Œæ˜¯é€šè¿‡å€¼æ¥æŸ¥è¯¢ã€‚Key-Value æ•°æ®åº“ä¸­æ ¹æœ¬æ²¡æœ‰é€šè¿‡å€¼æŸ¥è¯¢çš„é€”å¾„ã€‚2. éœ€è¦å‚¨å­˜æ•°æ®ä¹‹é—´çš„å…³ç³»ã€‚åœ¨ Key-Value æ•°æ®åº“ä¸­ä¸èƒ½é€šè¿‡ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„é”®æ¥å…³è”æ•°æ®ã€‚3. äº‹åŠ¡çš„æ”¯æŒã€‚åœ¨ Key-Value æ•°æ®åº“ä¸­æ•…éšœäº§ç”Ÿæ—¶ä¸å¯ä»¥è¿›è¡Œå›æ»šã€‚|<br>|é¢å‘æ–‡æ¡£ï¼ˆDocument-Orientedï¼‰æ•°æ®åº“|    é¢å‘æ–‡æ¡£æ•°æ®åº“ä¼šå°†æ•°æ®ä»¥æ–‡æ¡£çš„å½¢å¼å‚¨å­˜ã€‚æ¯ä¸ªæ–‡æ¡£éƒ½æ˜¯è‡ªåŒ…å«çš„æ•°æ®å•å…ƒï¼Œæ˜¯ä¸€ç³»åˆ—æ•°æ®é¡¹çš„é›†åˆã€‚æ¯ä¸ªæ•°æ®é¡¹éƒ½æœ‰ä¸€ä¸ªåç§°ä¸å¯¹åº”çš„å€¼ï¼Œå€¼æ—¢å¯ä»¥æ˜¯ç®€å•çš„æ•°æ®ç±»å‹ï¼Œå¦‚å­—ç¬¦ä¸²ã€æ•°å­—å’Œæ—¥æœŸç­‰ï¼›ä¹Ÿå¯ä»¥æ˜¯å¤æ‚çš„ç±»å‹ï¼Œå¦‚æœ‰åºåˆ—è¡¨å’Œå…³è”å¯¹è±¡ã€‚æ•°æ®å­˜å‚¨çš„æœ€å°å•ä½æ˜¯æ–‡æ¡£ï¼ŒåŒä¸€ä¸ªè¡¨ä¸­å­˜å‚¨çš„æ–‡æ¡£å±æ€§å¯ä»¥æ˜¯ä¸åŒçš„ï¼Œæ•°æ®å¯ä»¥ä½¿ç”¨ XMLã€JSON æˆ–è€… JSONB ç­‰å¤šç§å½¢å¼å­˜å‚¨ã€‚    |MongoDBã€CouchDBã€RavenDB|    SAP ï¼ˆMongoDBï¼‰ã€Codecademy ï¼ˆMongoDBï¼‰ã€Foursquare ï¼ˆMongoDBï¼‰ã€NBC News ï¼ˆRavenDBï¼‰    |1. æ—¥å¿—ã€‚ä¼ä¸šç¯å¢ƒä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸åŒçš„æ—¥å¿—ä¿¡æ¯ã€‚Document-Oriented æ•°æ®åº“å¹¶æ²¡æœ‰å›ºå®šçš„æ¨¡å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒå‚¨å­˜ä¸åŒçš„ä¿¡æ¯ã€‚2. åˆ†æã€‚é‰´äºå®ƒçš„å¼±æ¨¡å¼ç»“æ„ï¼Œä¸æ”¹å˜æ¨¡å¼ä¸‹å°±å¯ä»¥å‚¨å­˜ä¸åŒçš„åº¦é‡æ–¹æ³•åŠæ·»åŠ æ–°çš„åº¦é‡ã€‚|åœ¨ä¸åŒçš„æ–‡æ¡£ä¸Šæ·»åŠ äº‹åŠ¡ã€‚Document-Oriented æ•°æ®åº“å¹¶ä¸æ”¯æŒæ–‡æ¡£é—´çš„äº‹åŠ¡ï¼Œå¦‚æœå¯¹è¿™æ–¹é¢æœ‰éœ€æ±‚åˆ™ä¸åº”è¯¥é€‰ç”¨è¿™ä¸ªè§£å†³æ–¹æ¡ˆã€‚|<br>|åˆ—å­˜å‚¨ï¼ˆWide Column Store/Column-Familyï¼‰æ•°æ®åº“|    åˆ—å­˜å‚¨æ•°æ®åº“å°†æ•°æ®å‚¨å­˜åœ¨åˆ—æ—ï¼ˆcolumn familyï¼‰ä¸­ï¼Œä¸€ä¸ªåˆ—æ—å­˜å‚¨ç»å¸¸è¢«ä¸€èµ·æŸ¥è¯¢çš„ç›¸å…³æ•°æ®ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ª Person ç±»ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä¸€èµ·æŸ¥è¯¢ä»–ä»¬çš„å§“åå’Œå¹´é¾„è€Œä¸æ˜¯è–ªèµ„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå§“åå’Œå¹´é¾„å°±ä¼šè¢«æ”¾å…¥ä¸€ä¸ªåˆ—æ—ä¸­ï¼Œè€Œè–ªèµ„åˆ™åœ¨å¦ä¸€ä¸ªåˆ—æ—ä¸­ã€‚    |Cassandraã€HBase|    Ebay ï¼ˆCassandraï¼‰ã€Instagram ï¼ˆCassandraï¼‰ã€NASA ï¼ˆCassandraï¼‰ã€Twitter ï¼ˆCassandra and HBaseï¼‰ã€Facebook ï¼ˆHBaseï¼‰ã€Yahoo!ï¼ˆHBaseï¼‰|    1. æ—¥å¿—ã€‚å› ä¸ºæˆ‘ä»¬å¯ä»¥å°†æ•°æ®å‚¨å­˜åœ¨ä¸åŒçš„åˆ—ä¸­ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥å°†ä¿¡æ¯å†™å…¥è‡ªå·±çš„åˆ—æ—ä¸­ã€‚2. åšå®¢å¹³å°ã€‚æˆ‘ä»¬å‚¨å­˜æ¯ä¸ªä¿¡æ¯åˆ°ä¸åŒçš„åˆ—æ—ä¸­ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ ‡ç­¾å¯ä»¥å‚¨å­˜åœ¨ä¸€ä¸ªï¼Œç±»åˆ«å¯ä»¥åœ¨ä¸€ä¸ªï¼Œè€Œæ–‡ç« åˆ™åœ¨å¦ä¸€ä¸ªã€‚|    1. å¦‚æœæˆ‘ä»¬éœ€è¦ ACID äº‹åŠ¡ã€‚Vassandra å°±ä¸æ”¯æŒäº‹åŠ¡ã€‚2. åŸå‹è®¾è®¡ã€‚å¦‚æœæˆ‘ä»¬åˆ†æCassandra çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°ç»“æ„æ˜¯åŸºäºæˆ‘ä»¬æœŸæœ›çš„æ•°æ®æŸ¥è¯¢æ–¹å¼è€Œå®šã€‚åœ¨æ¨¡å‹è®¾è®¡ä¹‹åˆï¼Œæˆ‘ä»¬æ ¹æœ¬ä¸å¯èƒ½å»é¢„æµ‹å®ƒçš„æŸ¥è¯¢æ–¹å¼ï¼Œè€Œä¸€æ—¦æŸ¥è¯¢æ–¹å¼æ”¹å˜ï¼Œæˆ‘ä»¬å°±å¿…é¡»é‡æ–°è®¾è®¡åˆ—æ—ã€‚|<br>|å›¾ï¼ˆGraph-Orientedï¼‰æ•°æ®åº“    |å›¾æ•°æ®åº“å…è®¸æˆ‘ä»¬å°†æ•°æ®ä»¥å›¾çš„æ–¹å¼å‚¨å­˜ã€‚å®ä½“ä¼šè¢«ä½œä¸ºé¡¶ç‚¹ï¼Œè€Œå®ä½“ä¹‹é—´çš„å…³ç³»åˆ™ä¼šè¢«ä½œä¸ºè¾¹ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸‰ä¸ªå®ä½“ï¼ŒSteve Jobsã€Apple å’Œ Nextï¼Œåˆ™ä¼šæœ‰ä¸¤ä¸ªâ€œFounded byâ€çš„è¾¹å°† Apple å’Œ Next è¿æ¥åˆ° Steve Jobsã€‚    |Neo4Jã€Infinite Graphã€OrientDB    |Adobe ï¼ˆNeo4Jï¼‰ã€Cisco ï¼ˆNeo4Jï¼‰ã€T-Mobile ï¼ˆNeo4Jï¼‰    |1. åœ¨ä¸€äº›å…³ç³»æ€§å¼ºçš„æ•°æ®ä¸­2. æ¨èå¼•æ“ã€‚å¦‚æœæˆ‘ä»¬å°†æ•°æ®ä»¥å›¾çš„å½¢å¼è¡¨ç°ï¼Œé‚£ä¹ˆå°†ä¼šéå¸¸æœ‰ç›Šäºæ¨èçš„åˆ¶å®š    ä¸é€‚åˆçš„æ•°æ®æ¨¡å‹ã€‚å›¾æ•°æ®åº“çš„é€‚ç”¨èŒƒå›´å¾ˆå°ï¼Œå› ä¸ºå¾ˆå°‘æœ‰æ“ä½œæ¶‰åŠåˆ°æ•´ä¸ªå›¾ã€‚|</p><p>å…³ç³»æ¨¡å‹å°±æ˜¯æŒ‡äºŒç»´è¡¨æ ¼æ¨¡å‹,å› è€Œä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“å°±æ˜¯ç”±äºŒç»´è¡¨åŠå…¶ä¹‹é—´çš„è”ç³»ç»„æˆçš„ä¸€ä¸ªæ•°æ®ç»„ç»‡ã€‚å½“å‰ä¸»æµçš„å…³ç³»å‹æ•°æ®åº“æœ‰<code>Oracleã€DB2ã€PostgreSQLã€Microsoft SQL Serverã€Microsoft Accessã€MySQLã€MariaDBã€æµªæ½®K-DB</code>ç­‰ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯MySQL"><a href="#ä»€ä¹ˆæ˜¯MySQL" class="headerlink" title="ä»€ä¹ˆæ˜¯MySQL"></a>ä»€ä¹ˆæ˜¯MySQL</h3><p>ä»€ä¹ˆæ˜¯mysqlï¼Ÿæ‘˜è‡ªå®˜æ–¹çš„ä¸€ä¸ªè§£é‡Šï¼Œè¯´ ** â€œMySQL æ˜¯é‡‡ç”¨å®¢æˆ·/æœåŠ¡å™¨æ¨¡å‹çš„å¼€æ”¾æºç å…³ç³»å‹ SQL æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ,å®ƒ å¯ä»¥åœ¨å¤šç§æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œ,å®ƒæ˜¯ç”± MySQL Ab å…¬å¸å¼€å‘ã€å‘å¸ƒå¹¶æ”¯æŒçš„ï¼Œåè¢«sunæ”¶è´­ï¼Œç°åœ¨åœ¨oracleå…¬å¸æ——ä¸‹ï¼Œç°åœ¨æœ‰ä¸€ä¸ªçŸ¥åçš„åˆ†æ”¯MariaDBã€‚â€ ** ç¨å¾®æœ‰ç‚¹é•¿ï¼Œæˆ‘ä»¬ä¸€æ®µä¸€æ®µæ¥è§£é‡Šï¼Œé‡Œé¢æœ‰ä¸€äº›å…³é”®ç‚¹ï¼Œèƒ½å¤Ÿå¸®åŠ©ä½ éå¸¸æœ‰æ•ˆåœ°å»ç†è§£MySQLã€‚</p><p><strong>* ç¬¬ä¸€ä¸ªè¦ç‚¹ï¼Œå®¢æˆ·/æœåŠ¡å™¨æ¨¡å‹ã€‚ *</strong></p><blockquote><p>é€šè¿‡C/Så’ŒB/Sçš„å¯¹æ¯”å»ä»‹ç»ä¸ºä»€ä¹ˆmysqlé€‰æ‹©c/sæ¨¡å‹ï¼Œåˆ†åˆ«ä»æ–¹ä¾¿ã€æ€§èƒ½ã€ç¨³å®šã€å®‰å…¨å››ä¸ªæ–¹é¢æ¥è®²ã€‚</p></blockquote><p>mysqlæ˜¯ä¸€ä¸ªc/sæ¨¡å‹åœ°ä¸€å¥—åº”ç”¨ç¨‹åºï¼Œå…¶å®è®²åˆ°c/sæ¨¡å‹å¤§å®¶å°±ä¼šè”æƒ³åˆ°ï¼Œb/sæ¨¡å‹ï¼Œc/så«åšå®¢æˆ·ç«¯/æœåŠ¡å™¨ï¼Œb/så«åšæµè§ˆå™¨/æœåŠ¡å™¨ã€‚æœåŠ¡å™¨è¿˜æ˜¯æœåŠ¡å™¨ï¼Œåªä¸è¿‡å®¢æˆ·ç«¯æ˜¯è£…ä¸€ä¸ªåº”ç”¨æœåŠ¡å‘¢ï¼Œè¿˜æ˜¯ç›´æ¥ç”¨æµè§ˆå™¨ã€‚é‚£ä¹ˆä¸¤ç§æ¨¡å‹å‘¢å„æœ‰ä¼˜åŠ£ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼Œé‚£ä½¿ç”¨æµè§ˆå™¨æ˜¯æ›´æ–¹ä¾¿çš„ï¼Œå› ä¸ºä¸ç®¡ä»€ä¹ˆç³»ç»Ÿéƒ½è‡ªå¸¦æµè§ˆå™¨ï¼Œæ¯”å¦‚æ‰‹æœºè‡ªå¸¦ã€padè‡ªå¸¦ï¼Œå„ç§ç¯å¢ƒéƒ½æœ‰æµè§ˆå™¨ï¼Œè¿™ç§æƒ…å†µæ¯”è¾ƒæ–¹ä¾¿ï¼›ä½†æ˜¯æµè§ˆå™¨ä¸»è¦é€šè¿‡ç½‘ç»œï¼Œé‚£ä¹ˆæ€§èƒ½ã€ç¨³å®šã€å®‰å…¨æ€§å°±ä¼šå—åˆ°ä¸€å®šåœ°å½±å“ã€‚è€Œc/sæ¨¡å‹å°±ä¸æ˜¯ï¼Œæˆ‘è£…ä¸€ä¸ªå®¢æˆ·ç«¯è½¯ä»¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯åœ°é€šä¿¡æ˜¯èµ°è‡ªå·±ä¸“æœ‰åœ°åè®®çš„ï¼Œä»–ä»¬å¯ä»¥å®ç°ä¸€ä¸ªé«˜æ•ˆã€ç¨³å®šçš„é€šä¿¡ï¼Œæ‰€ä»¥c/sæ¨¡å‹ä»–æœ€å¤§çš„æœ‰ç‚¹æ˜¯æ€§èƒ½é«˜ã€ç¨³å®šå¥½ã€åŠŸèƒ½å¤šã€å®‰å…¨æ€§å¥½ï¼Œå„ç§å„æ ·çš„ä¼˜ç‚¹ï¼Œç›¸å¯¹äºb/sæ¨¡å‹æ¥è¯´è¦è£…ä¸€ä¸ªå®¢æˆ·ç«¯è½¯ä»¶ï¼Œç”¨èµ·æ¥æ²¡æœ‰ä»–æ–¹ä¾¿ã€‚æˆ‘ä»¬mysqlç”¨çš„æ˜¯c/sæ¨¡å‹ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ˜¯è€ƒè™‘è®©ä½ ç”¨èµ·æ¥æ–¹ä¾¿ï¼Œæˆ‘ä»¬çš„å…³æ³¨ç‚¹å°±æ˜¯æ€§èƒ½æ›´åŠ é«˜æ•ˆï¼Œå…³æ³¨çš„å°±æ˜¯å®‰å…¨ï¼Œæ•°æ®åº“é‡Œé¢çš„æ•°æ®éå¸¸çš„é‡è¦ï¼Œç»å¸¸æˆ‘ä»¬çš„ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯æ”¾åœ¨æ•°æ®åº“é‡Œé¢ï¼Œæ•°æ®åº“æ³„éœ²ä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜ã€‚å¤§å®¶å¹³æ—¶åœ¨ä¸Šç½‘è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰æ›¾ç»é‡åˆ°è¿‡ä¸€äº›æƒ…å†µï¼Œæ¯”å¦‚ç™»é™†å¾®åšã€QQï¼Œç™»é™†çš„æ—¶å€™ä»–å‘Šè¯‰ä½ ï¼Œä½ çš„å¯†ç ä¸å¤Ÿå®‰å…¨ï¼Œè¦æ±‚ä½ ä¿®æ”¹å¯†ç ï¼Œä¹‹å‰æœ‰æ²¡æœ‰é‡åˆ°è¿‡ï¼Œè«åå…¶å¦™ï¼Œç™»ä¸Šæ¥å°±å‘Šè¯‰ä½ è¦ä¿®æ”¹å¯†ç ï¼Œå‡­ä»€ä¹ˆè¯´ä½ å¯†ç ä¸å®‰å…¨ï¼Œæˆ‘å‘Šè¯‰ä½ å“ªæ€•ä½ å¯†ç è®¾å¾—å†å¤æ‚ä»–ä¹Ÿä¼šè·Ÿä½ è®²ä½ çš„å¯†ç ä¸å®‰å…¨ï¼ŒåŸå› æ˜¯å› ä¸ºä»–æ•°æ®åº“æ³„éœ²è¿‡äº†ï¼Œä»–æ•°æ®åº“æ³„éœ²äº†åˆä¸èƒ½ç›´æ¥è·Ÿä½ è®²ï¼šâ€œæˆ‘æ•°æ®åº“æ³„éœ²äº†ï¼Œä½ å¿«æ”¹å¯†ç é˜¿ï¼â€ä»–ä¸èƒ½è¯´çš„ï¼Œåªèƒ½å‘Šè¯‰ä½ ä½ çš„å¯†ç ä¸å®‰å…¨ï¼Œè®©ä½ æ”¹ã€‚å¦‚æœä½ æ²¡æœ‰ä¿®æ”¹ï¼Œå¾ˆå¯èƒ½å°±ä¼šè¢«ç›—å·äº†ã€‚ä»è¿™ä¸ªä¾‹å­æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“æ•°æ®åº“çš„å®‰å…¨æ€§é—®é¢˜çš„é‡è¦æ€§ã€‚åŒ…æ‹¬å»å¹´å¾ˆç«çš„ï¼Œéå¸¸å‡ºåçš„ä¸€ä»¶äº‹ï¼Œ12306æ•°æ®åº“æ³„éœ²ï¼Œå¤§å®¶ä¹°è¿‡çš„ç«è½¦ç¥¨ï¼Œä¹°ç«è½¦ç¥¨æ—¶ä½¿ç”¨çš„èº«ä»½è¯ã€ç”¨æˆ·åã€å¯†ç ã€é“¶è¡Œä¿¡æ¯å°±éƒ½æ³„éœ²äº†ï¼Œæ³„éœ²äº†å¤§æ¦‚åå‡ ä¸ªGçš„ç”¨æˆ·ä¿¡æ¯ï¼ŒçŸ¥é“å—ï¼Ÿåœ¨12306ä¸Šä¹°è¿‡ç«è½¦ç¥¨å—ï¼Ÿä¹°è¿‡ï¼Œé‚£å¾ˆå¯èƒ½ä½ çš„èº«ä»½è¯ä¿¡æ¯å·²ç»è¢«æ³„éœ²äº†ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œè®²æ•°æ®åº“å…³æ³¨çš„ç‚¹ï¼Œä¸æ˜¯è®©ä½ ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼Œè€Œæ˜¯è¦ä¿è¯æ€§èƒ½ã€å®‰å…¨ã€ç¨³å®šã€‚ç¨³å®šä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„åœ°æ–¹ï¼Œæ•°æ®åº“ä¸èƒ½å‡ºé”™ï¼Œä¸èƒ½è¯´è¿ç€è¿ç€ï¼Œä¸€ä¼šè¿ä¸ä¸Šäº†ã€‚ä»Šå¤©å»å­˜é’±ï¼Œå­˜å®Œé’±æ˜å¤©å»å–é’±ï¼Œå­˜äº†å¤šå°‘é’±ä¸çŸ¥é“ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ•°æ®åº“æ²¡è¿ä¸Šï¼Œä½ æ˜¨å¤©å­˜çš„é’±æˆ‘æ‰¾ä¸åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªç¨³å®šæ€§ã€‚ä½ è¦ä¿è¯æ•°æ®åº“7*24å°æ—¶åœ¨çº¿è¿è¡Œï¼Œä¸èƒ½å‡ºä»»ä½•é—®é¢˜ã€‚å¥½è¿™å°±æ˜¯æˆ‘ä»¬è®²çš„c/sæ¨¡å‹ã€‚</p><p><strong>* ç¬¬äºŒä¸ªè¦ç‚¹ï¼Œå¼€æ”¾æºç ã€‚ *</strong></p><blockquote><p>ä»‹ç»open sourceå’Œclosed sourceçš„æ¦‚å¿µå’ŒåŒºåˆ«ï¼Œä»‹ç»mysqlçš„å¼€æºç†å¿µä»¥åŠå†å²ï¼Œä»‹ç»â€œå»IOEâ€ä»¥åŠMariadbçš„è¯ç”Ÿã€‚</p></blockquote><p>ä»€ä¹ˆå«åšå¼€æºï¼Ÿopen sourceå’Œä»–ç›¸å¯¹åº”çš„å°±æ˜¯é—­æºclosed sourceåº”ç”¨ï¼Œé—­æºçš„ä¸œè¥¿åˆå«åšcopyrightï¼ˆç‰ˆæƒã€è‘—ä½œæƒï¼‰ï¼Œå¾®è½¯çš„ä¸œè¥¿ä¸€èˆ¬éƒ½æ˜¯copyrightï¼›è€Œå¼€æºçš„å«åšcopyleftï¼ˆéç›ˆåˆ©ç‰ˆæƒï¼Œå…¬å…±ç‰ˆæƒï¼‰ã€‚å…¬å¸èµšé’±æœ‰ä¸¤ä¸ªå¤§çš„æµæ´¾ï¼Œä¸€ä¸ªæµæ´¾å°±æ˜¯ä»¥å¾®è½¯ã€oracleä¸ºé¦–çš„é—­æºè½¯ä»¶èµ·å®¶çš„ï¼Œä»–ä»¬è®¤ä¸ºç¨‹åºå†™å®Œä¹‹åä½ å¾—æ‹¿å»å–ï¼Œå–ä»£ç æ¥èµšé’±ï¼Œæˆ‘å–ç»™ä½ ä½¿ç”¨ï¼Œä½ ç»™æˆ‘é’±ï¼Œè¿™æ ·çš„è¯å‘¢ï¼Œæˆ‘æ‰èƒ½æ´»å¾—æ›´æ»‹æ¶¦ä¸€ç‚¹ï¼›å¼€æºåº”ç”¨ä¸æ˜¯ï¼Œä»–è®¤ä¸ºæˆ‘ç¨‹åºå†™å®Œä¹‹åï¼Œå¯ä»¥å…è´¹ç»™ä½ ä½¿ç”¨ï¼Œç„¶åä½ è¦æ˜¯è§‰å¾—æœ‰é—®é¢˜ï¼Œä½ å‘Šè¯‰æˆ‘ä½ åšè¿‡çš„ä¿®æ”¹ï¼Œä½ ä¹Ÿåº”è¯¥æŠŠä»–å¼€æºå‡ºæ¥ï¼Œæˆ‘ä»¬å¼€æºçš„äººè¶Šå¤šï¼Œä¿®æ”¹çš„äººè¶Šå¤šï¼Œç¨‹åºå°±ä¼šè¶Šåšè¶Šå¥½ï¼Œä¸åå¯¹ä½ èµšé’±ï¼Œä½†æ˜¯ä½ èµšé’±çš„æ”¶å…¥ç‚¹ä¸æ˜¯åœ¨ç¨‹åºæœ¬èº«ï¼Œè€Œæ˜¯åœ¨äºä½ åæœŸæ‰€æä¾›çš„æœåŠ¡ï¼Œæä¾›çš„ä¸€äº›é¢å¤–çš„æ“ä½œï¼Œè¿™æ˜¯å¼€æºé¢†åŸŸçš„ä¸€äº›ç†å¿µï¼Œä»¥redhatä¸ºé¦–ï¼Œä»–å°±æ˜¯ä»¥å¼€æºä¸ºç›®æ ‡çš„ã€‚<br>mysqlå¼€å§‹è®¾è®¡çš„æ—¶å€™ï¼Œå°±æ˜¯ä¸€ä¸ªå¼€æºäº§å“ï¼Œå½“ç„¶è¿™æ˜¯ä»¥å‰çš„äº‹æƒ…äº†ï¼Œmysqlå½“å¹´æ˜¯å¼€æºçš„ï¼Œç„¶åè¢«æ”¶è´­äº†ï¼Œå…¶å®æˆ‘ä»¬è¯´é˜¿ï¼Œåšå¼€æºçš„äººå‘¢ï¼Œèµšé’±æœ€å¥½çš„æ–¹å¼å°±æ˜¯æ‰¾äººæŠŠä»–ç»™æ”¶äº†ï¼Œæ”¶è´­çš„è¯åŸºæœ¬ä¸Šèƒ½èµšä¸€å¤§ç¥¨ï¼Œæ”¶è´­mysqlçš„æ˜¯å½“æ—¶æ¯”è¾ƒè‘—åçš„sunå…¬å¸ï¼Œæœ‰å¾ˆå¤šéå¸¸ç»å…¸çš„äº§å“éƒ½æ˜¯sunå¼€å‘å‡ºæ¥çš„ï¼Œæ¯”å¦‚ä»–çš„javaç¼–ç¨‹è¯­è¨€ã€‚é™¤äº†javaè¯­è¨€ä»¥å¤–sunå…¬å¸è¿˜å¼€å‘è¿‡å¾ˆå¤šç»å…¸çš„æŠ€æœ¯ï¼Œé‚£ä¹ˆsunå…¬å¸çš„è¯ï¼Œæœ‰é’±æœ‰å®åŠ›ï¼Œä½†æ˜¯å‘¢ä¸å¤ªä¼šç»è¥ï¼Œæœ€åå°±å€’é—­äº†ï¼Œç„¶åè¢«å¦å¤–ä¸€å®¶æ”¶è´­ï¼Œç°åœ¨mysqlæ‰€å±äºoracleã€‚å½“å¹´æ”¶è´­å®Œmysqlä¹‹åå‘¢ï¼Œä»–è§‰å¾—ï¼Œæˆ‘çš„oracleäº§å“é¢å‘äºå¤§å‹çš„å…¬å¸ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªäº§å“æ¥å¼¥è¡¥ä¸­çš„ç«¯ä¼ä¸šçš„ç©ºç¼ºï¼Œäºæ˜¯ä»–å°±æ”¶è´­äº†mysqlï¼Œæ”¶è´­å®Œä¹‹åæœ¬èº«è§‰å¾—æ²¡ä»€ä¹ˆä½éš¾é¢˜ï¼Œåæ¥mysqlåœ¨oracleçš„å¸¦é¢†ä¸‹è¶Šåšè¶Šå¥½ï¼Œå› ä¸ºoracleåœ¨æ•°æ®åº“é¢†åŸŸç®—å¾—ä¸Šæ˜¯æ’åç¬¬ä¸€äº†ã€‚ä»–æœ‰å¾ˆå¤šä¸“æœ‰çš„æ•°æ®åº“æŠ€æœ¯ï¼Œèƒ½å¤Ÿè®©æ•°æ®åœ¨è¯»å†™è¿‡ç¨‹å½“ä¸­ï¼Œæ€§èƒ½éå¸¸é«˜ï¼Œç„¶ååˆæœ‰é«˜å¯ç”¨ï¼Œæœ‰å¾ˆå¤šçš„æœ‰ç‚¹ï¼Œmysqlè¶Šåšè¶Šå¥½ï¼Œå¥½åˆ°ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Ÿä¸å•å•æ˜¯ä¸­å°å‹ä¼ä¸šåœ¨ç”¨ï¼Œå¤§å‹ä¼ä¸šä¹Ÿå¼€å§‹ç”¨mysqlï¼Œç”¨ä¸‹æ¥è§‰å¾—æ¯”oracleè¦å¥½ï¼Œå‡ºç°è¿™ç§ç°è±¡ï¼Œä»¥è‡³äºæˆ‘ä»¬åœ¨å‰å‡ å¹´çš„æ—¶å€™æœ‰äººæå‡ºäº†ä¸€ä¸ªï¼Œä¿—ç§°ä¸ºITç•Œçš„é©å‘½ï¼Œå«åšâ€œå»IOEâ€ã€‚<br>ä»€ä¹ˆå«åšâ€œå»IOEâ€å‘¢ï¼Ÿä¸‰ä¸ªéå¸¸è‘—åçš„å…¬å¸ï¼ŒIBMã€ORACLEã€EMCï¼Œè¿™ä¸‰ä¸ªå…¬å¸æœ‰ä¸šç•Œä¸€æµçš„äº§å“ï¼ŒIBMæœ‰ä»–çš„å°å‹æœºï¼Œä»æœåŠ¡å™¨çš„æ€§èƒ½ä¸Šæ¥è®²å°å‹æœºå·²ç»ç®—æ˜¯é¡¶å°–çš„ï¼Œæ¯”ä½ çš„pc serverè¦å¥½çš„å¤šï¼›ç„¶åoracleçš„æ•°æ®ä¸šç•Œé¡¶å°–çš„ï¼›EMCçš„å­˜å‚¨è®¾å¤‡ä¹Ÿæ˜¯ä¸šç•Œé¡¶å°–çš„ã€‚ç»å¸¸å‘¢æœ‰å…¬å¸è¯´æˆ‘çš„å‹åŠ›ç‰¹åˆ«å¤§ï¼Œæˆ‘éœ€è¦å»ä¹°æœ€å¥½çš„ç¡¬ä»¶ï¼Œå°±ä¹°è¿™ä¸‰å®¶å…¬å¸çš„ï¼Œæ”¾åœ¨ä¸€èµ·ç»„æˆä¸€å¥—æ€§èƒ½éå¸¸å¼ºå¤§çš„è¿™ä¹ˆä¸€å¥—ç¡¬ä»¶ç¯å¢ƒã€‚åæ¥è¿™äº›å…¬å¸å‘ç°è¿™æ ·ä¸åˆ’ç®—ï¼Œå› ä¸ºä½ æ¯å¹´ä¹°è¿™äº›ç¡¬ä»¶è¦èŠ±å‡ åƒä¸‡ï¼Œè¿™äº›ç¡¬ä»¶éå¸¸è´µçš„é˜¿ï¼ŒåƒIBMçš„å°å‹æœºå‡ åä¸‡ä¸Šç™¾ä¸‡ï¼›å­˜å‚¨ï¼Œæ²¡æœ‰ä¸€ç™¾ä¸‡ä½ åˆ«è°ˆï¼Œè°ˆä¸äº†ï¼Œä»¥åè¦æ˜¯è€æ¿è·Ÿä½ è¯´ï¼Œè¦ä½ æ­ä¸€å¥—å•†ä¸šçš„é«˜æ€§èƒ½çš„å­˜å‚¨æ–¹æ¡ˆï¼Œç‰¹åˆ«æ˜¯æ•°æ®åº“ç”¨çš„ï¼Œä½ å…ˆé—®ä»–æœ‰æ²¡æœ‰ä¸€ç™¾ä¸‡ï¼Œä¸€ç™¾ä¸‡éƒ½ä¸ç»™æˆ‘ï¼Œæ‹¿ä»€ä¹ˆå»è°ˆï¼Œè°ˆä¸äº†ï¼›oracleä¹Ÿä¸è¯´äº†ï¼ŒæŒ‰cpuç»™ä½ å–é’±ï¼Œçœ‹ä½ çš„æœåŠ¡å™¨å‡ ä¸ªcpuæ˜¯å§ï¼Œç°åœ¨æœåŠ¡å™¨å¤šæ ¸ï¼Œå¤šæ ¸ä½ å°±å¤šä»˜é’±å§ã€‚åæ¥å…¬å¸è¯´æˆ‘ä¸€å¹´ä¹°å‡ åƒä¸‡ï¼Œéƒ½æ²¡èµšå¤šå°‘ï¼Œèµšçš„é’±ä¸€å¤§åŠç”¨æ¥ä¹°ç¡¬ä»¶äº†ï¼Œèƒ½ä¸èƒ½æˆæœ¬ä½ä¸€ç‚¹ã€‚<br>IBMçš„å°å‹æœºæ¢æˆäº†pc serverï¼Œæ¯”æˆ‘ä»¬è¿™é‡Œçš„æœåŠ¡å™¨ç¨å¾®å¥½ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ˜¯1Uçš„ï¼Œä»–ä»¬èµ·ç 2Uçš„ï¼Œä¹°ä¸€äº›pc serverï¼Œå•å°æœåŠ¡å™¨çš„æ€§èƒ½æ¯”IBMçš„å°å‹æœºè¦ä½ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨æœ‰éå¸¸æˆç†Ÿçš„é›†ç¾¤è§£å†³æ–¹æ¡ˆï¼Œæœ‰é«˜å¯ç”¨é›†ç¾¤ã€è´Ÿè½½å‡è¡¡é›†ç¾¤ã€é«˜æ€§èƒ½è®¡ç®—é›†ç¾¤ï¼Œå½“å¤šå°pc serveræ”¾åœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œä»–æ•´ä½“ä»·æ ¼è¦æ¯”IBMçš„ä¾¿å®œï¼Œè€Œä¸”æä¾›çš„æ•´ä½“æ€§èƒ½ä¹Ÿæ¯”IBMé«˜ï¼Œæ— éå°±æ˜¯æµªè´¹ä¸€äº›åœ°æ–¹ï¼Œä½†æ˜¯ä¼šå‘ç°å¾—åˆ°çš„æ˜¯æˆæœ¬é™ä½ã€æ”¶ç›Šæ›´å¥½ã€‚ä¸€å°IBMä¸Šç™¾ä¸‡ï¼Œæˆ‘ä¹°10å°pc serveræ€§èƒ½å°±è¶…è¿‡ä½ äº†ï¼Œæ‰€ä»¥pc serveråˆ’ç®—ã€‚<br>oracleè¿™é‡Œä¸è¯´äº†ï¼Œä½ è¦æ”¶é’±çš„ï¼Œæˆ‘å°±ç”¨ä¸æ”¶é’±çš„mysqlï¼Œç”¨mysqlè·‘è·‘ï¼Œå½“ç„¶äº†ï¼Œç°åœ¨æœ‰å¾ˆå¤šå¤§å…¬å¸ä¼šæŠŠoracleæ¢æˆmysqlï¼Œä¹Ÿä¸æ˜¯å…¨éƒ¨éƒ½æ¢æ‰ï¼Œæœ‰ä¸€äº›éå¸¸æ ¸å¿ƒçš„åº”ç”¨è¿˜æ˜¯è·‘åœ¨oracleä¸Šé¢ï¼Œoracleè¿˜æ˜¯æœ‰ä»–çš„æœ‰ç‚¹çš„ã€‚å­˜å‚¨è¿™é‡Œå‘¢ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰isançš„å­˜å‚¨ï¼Œä»¥åè®²åˆ°å­˜å‚¨ä¼šå»è®²ï¼Œisanå­˜å‚¨æ¯”æˆ‘ä»¬å­¦è¿‡çš„nfsã€sambaçš„æ€§èƒ½è¦é«˜ï¼Œä½†æ˜¯æˆæœ¬ä½ï¼Œä¸éœ€è¦æ‹¿ä¸ªå‡ ç™¾ä¸‡å‡ºæ¥ã€‚é’ˆå¯¹è¿™äº›æƒ…å†µï¼ŒIBMæ€ä¹ˆæƒ³çš„æˆ‘ä¸çŸ¥é“ï¼ŒEMCæ€ä¹ˆæƒ³çš„æˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œä½†æ˜¯æˆ‘çŸ¥é“oracleæ€ä¹ˆæƒ³çš„ã€‚oracleè¯´æˆ‘æ”¶è´­mysqlæ˜¯æƒ³è®©ä¸­å°å‹ä¼ä¸šç”¨çš„ï¼Œå¥½é˜¿ï¼Œä½ ä»¬ç°åœ¨éƒ½ç”¨äº†æ˜¯å§ï¼Œoracleå–ä¸å‡ºå»äº†ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿæ˜¯å¤§å®¶åˆ«ç”¨å‘¢ï¼Ÿè¿˜æ˜¯æ€ä¹ˆåšæ¯”è¾ƒå¥½ï¼ŸæŠŠmysqlææ­»ï¼Œä½ ä»¬ä¸æ˜¯è§‰å¾—mysqlå¼€æºä¸è¦é’±å—ï¼Œåæ­£ä»–æ˜¯é¢†å…»çš„å­©å­ï¼Œoracleæ‰æ˜¯æˆ‘è‡ªå·±çš„å­©å­ï¼Œé¢†å…»çš„å­©å­æŠ¢è‡ªå·±å­©å­çš„è›‹ç³•ï¼Œé‚£æˆ‘å°±ææ­»ä»–ã€‚å¥½äº†ï¼Œoracleå†³å®šæŠŠmysqlé—­æºï¼Œæ…¢æ…¢åœ°å°†mysqlçš„æŠ€æœ¯åšé€æ­¥é—­æºã€‚é‚£ä»–ä¸€åšé—­æºï¼Œç”¨æˆ·å°±å‘ç°é—®é¢˜äº†ï¼Œæˆ‘å¼€å§‹ç”¨mysqlï¼Œç»“æœä½ å…ˆåœ¨mysqlä¹Ÿè¦æ”¶é’±ï¼Œé‚£ä¹ˆæœ€å…³é”®çš„æ˜¯mysqlçš„å¼€å‘è€…ï¼Œå½“å¹´æœ€æ—©åœ°å¼€å‘è€…ï¼Œä¸€ä¸ªå¼€å§‹åœ¨mysql-ABå…¬å¸ï¼Œåæ¥è¢«sunæ”¶è´­åå»äº†sunå…¬å¸ï¼Œsunå…¬å¸ä¹Ÿæ˜¯ç§‰æŒå¼€æºç†å¿µåœ°ï¼Œæ‰€ä»¥ä¹Ÿåšåœ°æ¯”è¾ƒå¼€å¿ƒï¼Œoracleæ”¶è´­å®Œä¹‹åå‘¢ï¼Œå¼€å§‹ä¹Ÿå¼€æºï¼Œåæ¥å‘¢å˜é—­æºäº†ï¼Œè¿™äº›äººå—ä¸äº†äº†ï¼Œè¿™äº›äººä¸åœ¨ä¹èµšå¤šå°‘é’±ï¼Œåœ¨ä¹åœ°æ˜¯ä¸ªäººç†æƒ³ã€‚æˆ‘è¦å®ç°ä¸ªäººç†æƒ³ï¼Œæˆ‘çš„ç†æƒ³å°±æ˜¯æŠŠè¿™ä¸ªè½¯ä»¶è¶Šåšè¶Šå¥½ï¼Œç„¶åè®©å¤§å®¶å…è´¹ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸ªäººç†æƒ³ï¼Œè¿™äº›äººç§°ä¹‹ä¸ºé»‘å®¢ã€‚å“ªäº›äººå«é»‘å®¢ï¼Œæç ´åçš„é‚£äº›äººä¸æ˜¯é»‘å®¢ï¼Œå´‡å°šå¼€æ”¾ã€å¹³ç­‰ã€è‡ªç”±çš„ï¼Œç„¶ååˆæœ‰é«˜è¶…çš„è®¡ç®—æœºæ°´å¹³çš„è¿™äº›äººå°±æ˜¯é»‘å®¢ã€‚å°±åƒlinuxçš„åˆ›å§‹äººï¼ŒLinus Torvaldsæ—çº³æ–¯ æ‰˜ç“¦å…¹ï¼Œä»–ä»¬éƒ½æ˜¯éå¸¸è‘—åçš„é»‘å®¢ã€‚æ—¢ç„¶ä½ mysqlè¦æ”¶é’±ï¼Œé‚£æˆ‘å°±ä¸å¹²äº†ï¼Œæ‰€ä»¥å½“å¹´mysqlæœ€æ—©çš„å¼€å‘è€…å½“ä¸­çš„ä¸€ä¸ªé¢†å¤´ï¼Œä»–å°±è·³æ§½å‡ºæ¥äº†ï¼Œç„¶åå¸¦äº†ä¸€æ‰¹æ‰‹ä¸‹åšäº†ä¸€ä¸ªå¼€æºç¤¾åŒºåˆå¸æ”¶äº†ä¸€æ‰¹äººï¼Œå¼€å§‹å†™ä¸€ä¸ªæ–°çš„æ•°æ®åº“ï¼Œå°±æ˜¯æˆ‘ä»¬rhel7å½“ä¸­çš„mariadbã€‚<br>Mariadbï¼Œæœ‰å¾ˆå¤šåœ°æ–¹è·Ÿmysqlå¾ˆåƒï¼Œä½ ä¼šå‘ç°åœ¨æ“ä½œmariadbçš„è¿‡ç¨‹å½“ä¸­ç”¨åˆ°çš„éƒ½æ˜¯mysqlçš„å‘½ä»¤ï¼Œç™»é™†mysqlã€å¤‡ä»½mysqldumpï¼Œä½ ä¼šå‘ç°mariadbæ‰€æœ‰çš„æ¥å£éƒ½å’Œmysqlçš„æ¥å£ä¸€æ¨¡ä¸€æ ·ï¼Œå†…éƒ¨çš„å‡½æ•°åéƒ½å’Œmyslqçš„ä¸€æ¨¡ä¸€æ ·ã€‚æ‰€ä»¥å‘¢ï¼Œä½ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä»mysqlçš„ç¯å¢ƒè¿ç§»åˆ°mariadbä¸Šé¢ã€‚maraidbä¹Ÿåšçš„éå¸¸å¥½ï¼Œåˆšå¼€å§‹æ¯”ä¸è¿‡mysqlï¼Œä½†æ˜¯è¿‘ä¸¤å¹´mysqlæœ‰çš„ä¼˜ç‚¹ä»–éƒ½æœ‰ï¼Œç”šè‡³ä»–è¿˜æœ‰å¾ˆå¤šè‡ªå·±è½¬æœ‰çš„ä¼˜ç‚¹ï¼Œoracleè¿™æ—¶å€™åä¸ä½äº†ï¼Œæˆ‘ç°åœ¨é—­æºï¼Œé—­æºä»¥åå‘¢æ²¡äººæ¥ä¹°æˆ‘çš„oracleï¼Œå¤§å®¶æ¢æˆmariadbäº†ï¼Œé‚£æˆ‘è¿™ä¸ªé—­æºçš„æ„ä¹‰å°±æ²¡äº†ï¼Œæ‰€ä»¥æœ€è¿‘å‘¢åˆå‘è¡¨å£°æ˜ï¼Œè¯´â€œå¤§å®¶æ”¾å¿ƒï¼Œæˆ‘ä»¥åä¸ä¼šå†é—­æºäº†ï¼mysqlä»¥åè¿˜ä¼šä»¥å¼€æºçš„æ–¹å¼ä¸€ç›´å­˜åœ¨ä¸‹å»ã€‚â€ä¸ä¼šæ”¶é’±äº†ï¼Œä½†æ˜¯ä¹Ÿæ²¡ä»€ä¹ˆäººç†ä»–äº†ï¼Œæ›´å¤šçš„äººéƒ½æ„¿æ„ç›¸ä¿¡ï¼Œæ„¿æ„å»ä½¿ç”¨mariadbäº†ã€‚mysqlä¹Ÿæœ‰äººç”¨ï¼Œmariadbä¹Ÿæœ‰äººç”¨ï¼Œç°åœ¨å°±å˜æˆè¿™ä¸ªå¸‚åœºï¼Œmysqlå’Œmariadbå„å äº†ä¸€éƒ¨åˆ†æ±Ÿå±±ã€‚è¿™ä¸ªå‘¢å°±æ˜¯å¼€æ”¾æºç ã€‚</p><p><strong>* ç¬¬ä¸‰ä¸ªè¦ç‚¹ï¼Œå…³ç³»å‹ã€‚ *</strong></p><blockquote><p>ä»‹ç»å…³ç³»å‹å’Œéå…³ç³»å‹æ•°æ®åº“çš„æ¦‚å¿µå’Œä¼˜åŠ£ç‚¹</p></blockquote><p>æ‰€è°“å…³ç³»å‹æ˜¯æŒ‡,å°†æ•°æ®ä¿å­˜åœ¨ä¸åŒçš„è¡¨ä¸­,è¡¨ä¸è¡¨ä¹‹é—´æ”¯æŒä¸€å®šçš„å…³ç³»ï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰æ•°æ®æ”¾åœ¨ ä¸€ä¸ªå¤§çš„ä»“åº“å†…ã€‚è¿™æ ·å°±å¢åŠ äº†é€Ÿåº¦å¹¶æé«˜äº†çµæ´»æ€§ã€‚<br>ä»€ä¹ˆæ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Ÿæˆ‘ä»¬åœ¨å­˜æ”¾æ•°æ®çš„æ—¶å€™ï¼Œæ•°æ®å¾ˆå¤šï¼Œå‡ ç™¾ä¸‡å‡ åƒä¸‡è¡Œï¼Œå¦‚æœè¯´æˆ‘ä»¬æŠŠæ‰€æœ‰çš„æ•°æ®æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œè™½ç„¶æ•°æ®åº“çš„è¯»å†™æ€§èƒ½ä¼šæ¯”ä¸€èˆ¬çš„ç¨‹åºæ¥çš„é«˜ï¼Œä½†æ˜¯æ–‡ä»¶å¤ªå¤§æ€»å½’å¤šå¤šå°‘å°‘ä¼šå½±å“ä¸€äº›æ€§èƒ½ï¼Œä¸ºäº†èƒ½å¤Ÿè®©æˆ‘æ›´å¿«åœ°è¯»å–æ•°æ®ï¼Œæˆ‘ä¼šè€ƒè™‘æŠŠæ•°æ®æ‹†åˆ†å¼€æ¥ï¼Œä¸åŒçš„æ•°æ®æ”¾åœ¨ä¸åŒçš„æ–‡ä»¶å½“ä¸­ï¼Œè€Œæ•°æ®åº“é‡Œé¢åŸºæœ¬çš„å­˜å‚¨æ–¹å¼å«åšè¡¨ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„æ•°æ®æ˜¯æ”¾åœ¨ä¸åŒçš„è¡¨é‡Œé¢ã€‚æ•°æ®åº“ç®¡ç†å‘˜ç®¡ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Œç®¡è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»å¸¸æ˜¯è¿™ä¹ˆè¯´çš„ï¼Œå«æ•°æ®åº“ç®¡ç†å‘˜ï¼Œç”·çš„å«è¡¨å“¥ï¼Œå¥³çš„å«è¡¨å§ï¼Œè€å¤§å«åšå¤§è¡¨å“¥ã€‚é‚£ä¹ˆæˆ‘ç°åœ¨æŠŠæ•°æ®æ”¾åœ¨ä¸åŒçš„è¡¨é‡Œé¢ï¼Œè¡¨å’Œè¡¨ä¹‹é—´èƒ½ä¸èƒ½æ”¯æŒä¸€å®šçš„å…³ç³»ï¼Œå› ä¸ºæˆ‘ä»¬ç»å¸¸åœ¨æ“ä½œè¡¨é‡Œçš„æ•°æ®çš„æ—¶å€™æ˜¯æœ‰å…³ç³»çš„ï¼Œæ¯”å¦‚è¯´ï¼Œæˆ‘å¯èƒ½æœ‰ä¸ªè¡¨å«å‘˜å·¥è¡¨ï¼Œæœ‰ä¸ªè¡¨å«å·¥èµ„è¡¨ï¼Œå·¥èµ„è¡¨é‡Œé¢å‘é’±ï¼Œå‘é’±çš„æ—¶å€™å‘¢ï¼Œæ¯ä¸€ä¸ªå‘å·¥èµ„çš„äººåº”è¯¥åœ¨å‘˜å·¥è¡¨é‡Œé¢å­˜åœ¨ï¼Œä½ ä¸èƒ½è¯´å‘é’±å‘ç»™ä¸æ˜¯æˆ‘ä»¬å…¬å¸çš„äººï¼Œä¸è®¤è¯†çš„äººï¼Œè¿™ä¸è¡Œã€‚æ‰€ä»¥å‘¢ï¼Œè¿™æ˜¯ä¸€ä¸ªè¡¨å’Œè¡¨ä¹‹é—´çš„å…³ç³»ã€‚èƒ½å¤ŸæŠŠè¿™äº›å…³ç³»å®ç°å‡ºæ¥çš„ï¼Œæˆ‘ä»¬ä¸€èˆ¬æŠŠä»–å«åšå…³ç³»å‹æ•°æ®åº“ã€‚èƒ½å¤Ÿä»¥è¡¨æ¥å­˜å‚¨ï¼Œå¹¶åœ¨è¡¨å’Œè¡¨ä¹‹é—´æ”¯æŒä¸€å®šçš„ä¾èµ–å…³ç³»ï¼Œå„ç§å„æ ·çš„ä¾èµ–å…³ç³»ï¼Œå¯èƒ½æ˜¯å¤§å°å€¼çš„åˆ¤æ–­ï¼Œå¯èƒ½æ˜¯å­˜åœ¨çš„åˆ¤æ–­ï¼Œç­‰ç­‰ã€‚å½“ç„¶æˆ‘ä»¬é™¤äº†å…³ç³»å‹æ•°æ®åº“ä»¥å¤–å‘¢ï¼Œè¿˜æœ‰ä¸€ç§æ•°æ®åº“å«åšï¼Œé”®å€¼å‹æ•°æ®åº“ï¼Œæ¯”å¦‚memcache\redisæ•°æ®åº“ï¼Œå…¸å‹çš„ä»£è¡¨ä¾‹å­ï¼Œä¼˜ç‚¹æ˜¯æ€§èƒ½æ›´åŠ é«˜ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨å†…å­˜æ¥å­˜æ”¾æ•°æ®ï¼Œä½†æ˜¯èƒ½å®ç°çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œä»–ä¸æ˜¯åŸºäºè¡¨çš„ï¼ŒåŠŸèƒ½å¾ˆç®€å•ï¼Œä½ åªèƒ½æŸ¥aæ˜¯å¤šå°‘ï¼Œä»€ä¹ˆå€¼æ˜¯å¤šå°‘ã€‚</p><p><strong>* ç¬¬å››ä¸ªè¦ç‚¹ï¼ŒSQLè¯­å¥ã€‚ *</strong></p><blockquote><p>ä»‹ç»SQLè¯­å¥çš„æ¦‚å¿µ</p></blockquote><p>MySQL ä¸­çš„ SQL æŒ‡çš„æ˜¯â€œç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€â€ã€‚SQL æ˜¯è®¿é—®æ•°æ®åº“çš„æœ€å¸¸ç”¨çš„æ ‡å‡†åŒ–è¯­è¨€ã€‚ä»–æ˜¯ç»Ÿä¸€çš„æ“ä½œè¯­æ³•ï¼Œæˆ‘ä»¬è¯´çš„æ˜¯æ•°æ®åº“ç»Ÿä¸€çš„æ“ä½œè¯­æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨mysqlé‡Œé¢å­¦çš„sqlè¯­å¥ä»¥åä½ åœ¨å…¶å®ƒæ•°æ®åº“ä¸­ä¹ŸåŒæ ·é€‚ç”¨ã€‚æ¯ä¸ªæ•°æ®åº“è‡ªå·±çš„sqlè¯­å¥å¾ˆå°‘ï¼Œç™¾åˆ†ä¹‹ä¹åäº”éƒ½æ˜¯ä¸€æ ·çš„ã€‚Sqlè¯­å¥æ—¶é—´ä¸å¤Ÿå­¦æ²¡å…³ç³»ï¼Œåé¢è¿˜æœ‰oracleè¯¾ç¨‹ï¼Œä¼šå»è¯¦ç»†å­¦ä¹ sqlè¯­å¥ã€‚<br>æˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹mysqlçš„å®šä¹‰ã€‚MySQL æ˜¯é‡‡ç”¨å®¢æˆ·/æœåŠ¡å™¨æ¨¡å‹çš„å¼€æ”¾æºç å…³ç³»å‹ SQL æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ,å®ƒå¯ä»¥åœ¨å¤šç§æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œ,ä¸è¦ä»¥ä¸ºä»–åªèƒ½åœ¨linuxç³»ç»Ÿä¸Šè¿è¡Œï¼Œwindowsç³»ç»Ÿä¹Ÿèƒ½è¿è¡Œã€‚åº”è¯¥è¿™ä¹ˆè¯´ï¼ŒMysqlåœ¨linuxä¸Šè¿è¡Œæ€§èƒ½æ›´å¥½ï¼Œç¨³å®šæ€§æ›´é«˜ï¼ŒåŒ…æ‹¬oracleä¹Ÿæ˜¯ï¼Œoracleä¹Ÿèƒ½è£…åœ¨windowsä¸Šé¢ï¼Œä½†æ˜¯è·Ÿè£…åœ¨linuxä¸Šé¢æ€§èƒ½ä¸ä¸€æ ·ï¼Œoracleå®˜æ–¹æ¨èå®‰è£…åœ¨linuxä¸Šé¢ï¼Œmysqlä¹Ÿæœ‰windowsç‰ˆæœ¬ï¼Œæ•´ä¸ªå®‰è£…è¿‡ç¨‹ç›¸å½“ç®€å•ã€‚å¯ä»¥å»ä¸‹è½½ä¸€ä¸ªâ€œwamp.exeâ€è½¯ä»¶ï¼Œä¸‹è½½ä¸‹æ¥ä¸€è·¯nextå®‰è£…åˆ°åº•ï¼Œå°±ç±»ä¼¼ä¸LAMPçš„ç¯å¢ƒï¼Œå°±æ­å»ºå¥½äº†ã€‚è¿™æ˜¯å¤šå¹³å°è¿è¡Œã€‚Mysqlä»mysqlabå…¬å¸åˆ°sunå…¬å¸å†åˆ°oracleå…¬å¸ã€‚ç›®å‰æ˜¯åœ¨oracleå…¬å¸æ——ä¸‹ã€‚</p><h3 id="å¦‚ä½•è·å¾—MySQLç›¸å…³èµ„æº"><a href="#å¦‚ä½•è·å¾—MySQLç›¸å…³èµ„æº" class="headerlink" title="å¦‚ä½•è·å¾—MySQLç›¸å…³èµ„æº"></a>å¦‚ä½•è·å¾—MySQLç›¸å…³èµ„æº</h3><ul><li>ä¸ºäº†å­¦ä¹ æ›´å¤šçš„MySQLçŸ¥è¯†,è¯·è®¿é—®MySQLå®˜ç½‘ <a href="http://dev.mysql.com/ã€‚" target="_blank" rel="noopener">http://dev.mysql.com/ã€‚</a></li><li>ä¸ºäº†ä¸‹è½½æœåŠ¡å™¨çš„ä¸€ä¸ªå‰¯æœ¬,è¯·è®¿é—®MySQLå®˜ç½‘ <a href="http://dev.mysql.com/downloads/ã€‚" target="_blank" rel="noopener">http://dev.mysql.com/downloads/ã€‚</a></li></ul><p><img src="pic/mysqlgw.png" alt="mysqlgw.png"></p><h3 id="MySQLåœ¨ä¼ä¸šä¸­çš„åº”ç”¨åœºæ™¯"><a href="#MySQLåœ¨ä¼ä¸šä¸­çš„åº”ç”¨åœºæ™¯" class="headerlink" title="MySQLåœ¨ä¼ä¸šä¸­çš„åº”ç”¨åœºæ™¯"></a>MySQLåœ¨ä¼ä¸šä¸­çš„åº”ç”¨åœºæ™¯</h3><p>MySQL æ˜¯ä¸–ç•Œä¸Š ** æœ€å—æ¬¢è¿çš„å¼€æºæ•°æ®åº“ ** ,å¥¹æ‹¥æœ‰ç›¸å½“å¤§çš„è£…æœºé‡ã€‚è€Œä¸” DB-Engines çš„æ’åä¸€ç›´å¤„äºæ•°æ®åº“æ€»æ¦œç¬¬äºŒåçš„ä½ç½®,ä»…æ¬¡äº Oracleã€‚MySQL åœ¨å¼€æºé¢†åŸŸæ’åç¬¬ä¸€,è€Œç¬¬äºŒå¤§å¼€æºæ•°æ®åº“ PostgreSQL çš„åˆ†æ•°ä»…ä»…æ˜¯ MySQL çš„é›¶å¤´ã€‚</p><p>MySQL æ‹¥æœ‰åºå¤§çš„ç”¨æˆ·ç¾¤,å›½å¤–çš„æœ‰ ** Facebookã€Flickrã€eBay ** ç­‰,å›½å†…çš„æœ‰ ** é˜¿é‡Œã€è…¾è®¯ã€æ–°æµªã€ç™¾åº¦ç­‰ ** ã€‚è€Œè¿™äº›äº’è”ç½‘å’Œå¤§éƒ¨åˆ†ä¼ ç»Ÿå…¬å¸çš„æœåŠ¡éœ€è¦ ** 7Ã—24 ** å°æ—¶è¿ç»­å·¥ä½œã€‚å½“æ­¤ç±»å‹ç½‘ç«™çš„éƒ¨åˆ†æ•°æ®åº“æœåŠ¡å™¨å®•æœºæ—¶,å°±éœ€è¦é«˜å¯ç”¨æŠ€æœ¯å°†æµé‡ç‰µå¼•è‡³å¤‡ä»½ä¸»æœº,ä»è€Œæ­¤æ—¶è¿™äº›å…¬å¸éœ€è¦é€šè¿‡ ** å¤‡ä»½å’Œæ¢å¤ ** æ‰‹æ®µæ¥äº§ç”Ÿå¤‡æœº,å¹¶é€šè¿‡ ** å¤åˆ¶ ** æ¥åŒæ­¥ä¸»å¤‡æœºé—´çš„çŠ¶æ€,åŒæ—¶éƒ¨ç½²å„ç§ ** ç›‘æ§ ** è½¯ä»¶æ¥ç›‘æ§æœåŠ¡å™¨çŠ¶æ€ã€‚å½“å¼‚å¸¸æ•°æ®åº“æœåŠ¡å™¨å®•æœºæ—¶,é€šè¿‡æ‰‹å·¥æˆ–è‡ªåŠ¨åŒ–æ‰‹æ®µå°†ä¸»æœºæµé‡åˆ‡æ¢è‡³å¤‡æœº,è¿™ä¸ªåŠ¨ä½œå«ä½œ ** failover ** ã€‚è€Œä¸€äº›å¤§å‹å…¬å¸åœ¨é¢å¯¹æˆåƒä¸Šä¸‡å° MySQL æœåŠ¡å™¨æ—¶,é€šå¸¸ä½¿ç”¨ ** è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬ ** æˆ–ç¨‹åºå®Œæˆä¸Šè¿°ç§ç§åŠ¨ä½œã€‚</p><h3 id="MySQL-æ•°æ®åº“å®‰è£…"><a href="#MySQL-æ•°æ®åº“å®‰è£…" class="headerlink" title="MySQL æ•°æ®åº“å®‰è£…"></a>MySQL æ•°æ®åº“å®‰è£…</h3><p>è¯¾ç¨‹è¦æ±‚ï¼š</p><ul><li>å­¦ä¼šMariaDB 5.5çš„å®‰è£…</li><li>å­¦ä¼šMariaDB 10.2çš„å®‰è£…</li><li>å­¦ä¼šMySQL 5.6çš„å®‰è£…</li><li>å­¦ä¼šMySQL 5.7çš„å®‰è£…</li><li>MySQLè‡ªåŠ¨å®‰è£…è„šæœ¬</li></ul><p><strong>å®‰è£…æ–¹æ³•</strong></p><table><thead><tr><th align="left">num</th><th align="left">å®‰è£…æ–¹æ³•</th><th align="left">è¯´æ˜</th><th align="left">æ˜¯å¦ç¼–è¯‘å¥½</th></tr></thead><tbody><tr><td align="left">a</td><td align="left">äºŒè¿›åˆ¶æ–‡ä»¶</td><td align="left">è§£å‹å³å¯</td><td align="left">ç¼–è¯‘å¥½çš„</td></tr><tr><td align="left">b</td><td align="left">åŒ…ç®¡ç†</td><td align="left">rpm,deb</td><td align="left">ç¼–è¯‘å¥½çš„ï¼Œæœ‰ç‰ˆæœ¬(æ¨èä½¿ç”¨)</td></tr><tr><td align="left">c</td><td align="left">æºä»£ç </td><td align="left">ç±»ä¼¼Mplayer</td><td align="left">è‡ªå·±ç¼–è¯‘ï¼ˆæŒ‰éœ€é€‰æ‹©å‚æ•°ï¼›ä»£ç ä¼˜åŒ–ï¼‰</td></tr></tbody></table><h4 id="RHEL-7-2-RPM-åŒ…å®‰è£…-MariaDB-5-5"><a href="#RHEL-7-2-RPM-åŒ…å®‰è£…-MariaDB-5-5" class="headerlink" title="RHEL 7.2 RPM åŒ…å®‰è£… MariaDB 5.5"></a>RHEL 7.2 RPM åŒ…å®‰è£… MariaDB 5.5</h4><table><thead><tr><th align="left">é¡¹ç›®</th><th align="left">å‚æ•°</th></tr></thead><tbody><tr><td align="left">è½¯ä»¶å</td><td align="left">mariadb-server 5.5</td></tr><tr><td align="left">service</td><td align="left">mariadb</td></tr><tr><td align="left">daemon</td><td align="left">mysqld</td></tr><tr><td align="left">é…ç½®æ–‡ä»¶</td><td align="left">/etc/my.cnf    /etc/my.cnf.d/*.cnf</td></tr><tr><td align="left">æ•°æ®æ–‡ä»¶</td><td align="left">/var/lib/mysql</td></tr><tr><td align="left">æ—¥å¿—æ–‡ä»¶</td><td align="left">/var/log/mariadb/mariadb.logï¼ˆé”™è¯¯æ—¥å¿—ï¼Œå¯åŠ¨æ—¥å¿—ï¼‰</td></tr><tr><td align="left">ç«¯å£å·</td><td align="left">3306</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…å¿…è¦çš„è½¯ä»¶åŒ…</span></span><br><span class="line">[root@mastera0 ~]# yum install -y vim net-tools wget</span><br><span class="line"></span><br><span class="line">[root@mastera0 ~]# yum list|grep mariadb</span><br><span class="line">Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast</span><br><span class="line">mariadb-libs.x86_64                     1:5.5.44-2.el7             @anaconda/7.2</span><br><span class="line">mariadb.x86_64                          1:5.5.44-2.el7             rhel_dvd     </span><br><span class="line">mariadb-bench.x86_64                    1:5.5.44-2.el7             rhel_dvd     </span><br><span class="line">mariadb-devel.i686                      1:5.5.44-2.el7             rhel_dvd     </span><br><span class="line">mariadb-devel.x86_64                    1:5.5.44-2.el7             rhel_dvd     </span><br><span class="line">mariadb-libs.i686                       1:5.5.44-2.el7             rhel_dvd     </span><br><span class="line">mariadb-server.x86_64                   1:5.5.44-2.el7             rhel_dvd     </span><br><span class="line">mariadb-test.x86_64                     1:5.5.44-2.el7             rhel_dvd     </span><br><span class="line">[root@mastera0 ~]# yum install -y mariadb-server</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è½¯ä»¶æ¶æ„</span></span><br><span class="line">[root@mastera0 ~]# rpm -ql mariadb-server</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨æœåŠ¡</span></span><br><span class="line">[root@mastera0 ~]# systemctl start mariadb</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å®ˆæŠ¤è¿›ç¨‹</span></span><br><span class="line">[root@mastera0 ~]# ps -ef|grep mysqld</span><br><span class="line">mysql     2496     1  0 13:56 ?        00:00:00 /bin/sh /usr/bin/mysqld_safe --basedir=/usr</span><br><span class="line">mysql     2653  2496  0 13:56 ?        00:00:00 /usr/libexec/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib64/mysql/plugin --log-error=/var/log/mariadb/mariadb.log --pid-file=/var/run/mariadb/mariadb.pid --socket=/var/lib/mysql/mysql.sock</span><br><span class="line">root      2694  2347  0 13:56 pts/0    00:00:00 grep --color=auto mysqld</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹ç›‘å¬ç«¯å£å·</span></span><br><span class="line">[root@mastera0 ~]# netstat -luntp|grep mysqld</span><br><span class="line">tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      2653/mysqld</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»»ä½•ä¸€ä¸ªç¨‹åºå®‰è£…å®Œæˆä¹‹åéƒ½è¦å»çœ‹ä¸€ä¸‹ä»–çš„ç»„æˆ<code>rpm -ql mariadb-server</code>ï¼Œæˆ‘ä»¬çš„æ¯ä¸ªç¨‹åºéƒ½æœ‰è¿™æ ·å‡ ä¸ªéƒ¨åˆ†ï¼Œé…ç½®æ–‡ä»¶ç›®å½•ã€è„šæœ¬æ–‡ä»¶ç›®å½•ã€æ•°æ®æ–‡ä»¶ç›®å½•ã€æ—¥å¿—æ–‡ä»¶ç›®å½•ç­‰ã€‚æˆ‘ä»¬å¯ä»¥ç”¨rpm â€“ql &lt;ç¨‹åºå&gt;æ¥æŸ¥çœ‹ç¨‹åºçš„ç»„æˆã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°mariadb-serverçš„é…ç½®æ–‡ä»¶ä¸º/etc/my.cnfï¼›è„šæœ¬æ–‡ä»¶ç›®å½•ä¸º/usr/local/mysql/bin/ï¼›æ•°æ®æ–‡ä»¶ç›®å½•ä¸º/var/lib/mysql/;æ—¥å¿—æ–‡ä»¶åœ¨/var/log/mysql.logã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†ä»‹ç»æ¯ä¸€ä¸‹è„šæœ¬æ–‡ä»¶ç›®å½•ä¸­çš„è„šæœ¬ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">MYSQLæœåŠ¡å™¨å’ŒæœåŠ¡å™¨å¯åŠ¨è„šæœ¬ï¼š</span><br><span class="line">Mysqld MySQLæœåŠ¡å™¨</span><br><span class="line">mysqld_safeã€mysql.serverå’Œmysqld_multiæ˜¯æœåŠ¡å™¨å¯åŠ¨è„šæœ¬</span><br><span class="line">mysql_install_dbåˆå§‹åŒ–æ•°æ®ç›®å½•å’Œåˆå§‹æ•°æ®åº“</span><br><span class="line"></span><br><span class="line">è®¿é—®æœåŠ¡å™¨çš„å®¢æˆ·ç¨‹åºï¼š</span><br><span class="line">mysqlæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç¨‹åºï¼Œç”¨äºäº¤äº’å¼æˆ–ä»¥æ‰¹å¤„ç†æ¨¡å¼æ‰§è¡ŒSQLè¯­å¥</span><br><span class="line">mysqladminæ˜¯ç”¨äºç®¡ç†åŠŸèƒ½çš„å®¢æˆ·ç¨‹åº</span><br><span class="line">mysqlcheckæ‰§è¡Œè¡¨ç»´æŠ¤æ“ä½œ</span><br><span class="line">mysqldumpå’Œmysqlhotcopyè´Ÿè´£æ•°æ®åº“å¤‡ä»½</span><br><span class="line">mysqlimportå¯¼å…¥æ•°æ®æ–‡ä»¶</span><br><span class="line">mysqlshowæ˜¾ç¤ºä¿¡æ¯æ•°æ®åº“å’Œè¡¨çš„ç›¸å…³ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">ç‹¬ç«‹äºæœåŠ¡å™¨æ“ä½œçš„å·¥å…·ç¨‹åºï¼š</span><br><span class="line">myisamchkæ‰§è¡Œè¡¨ç»´æŠ¤æ“ä½œ</span><br><span class="line">myisampackäº§ç”Ÿå‹ç¼©ã€åªè¯»çš„è¡¨</span><br><span class="line">mysqlbinlogæ˜¯å¤„ç†äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„å®ç”¨å·¥å…·</span><br><span class="line">perroræ˜¾ç¤ºé”™è¯¯ä»£ç çš„å«ä¹‰</span><br></pre></td></tr></table></figure><p><strong>MySQLå®¢æˆ·ç«¯çš„ä½¿ç”¨</strong></p><table><thead><tr><th align="left">é¡¹ç›®</th><th align="left">å‚æ•°</th></tr></thead><tbody><tr><td align="left">è½¯ä»¶åç§°</td><td align="left">mariadb 5.5</td></tr><tr><td align="left">å‘½ä»¤</td><td align="left">mysql ç™»é™†è¿æ¥mysqlæœåŠ¡å™¨</td></tr><tr><td align="left"></td><td align="left">mysqladmin    ä¿®æ”¹æ•°æ®åº“æœåŠ¡å™¨ç”¨æˆ·å¯†ç </td></tr><tr><td align="left"></td><td align="left">mysqldump    å¤‡ä»½</td></tr><tr><td align="left"></td><td align="left">mysqlbinlog    äºŒè¿›åˆ¶æ—¥å¿—çš„æŸ¥çœ‹</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">å‘½ä»¤çš„ä½¿ç”¨</span><br><span class="line">mysql</span><br><span class="line">1.æœåŠ¡å¯åŠ¨åï¼Œmariadb5.5ç›´æ¥ç™»é™†ï¼Œä¸éœ€è¦å¯†ç </span><br><span class="line">2.é€€å‡º \q exit ctrl+d</span><br><span class="line">-u ç”¨æˆ·å ç©ºæ ¼å¯æœ‰å¯æ—  -u root;-uroot</span><br><span class="line">-p å¯†ç  ä¸å¯ä»¥æœ‰ç©ºæ ¼ -puplooking</span><br><span class="line"># mysql -uroot -puplooking</span><br><span class="line">#mysql -uroot -puplooking123</span><br><span class="line"></span><br><span class="line">mysqladmin</span><br><span class="line">1.æ— å¯†ç æƒ…å†µä¸‹æ·»åŠ å¯†ç </span><br><span class="line">mysqladmin -uroot password &#39;uplooking&#39;</span><br><span class="line">-u ç”¨æˆ·å ç©ºæ ¼å¯æœ‰å¯æ—  -u root;-uroot</span><br><span class="line">password æ–°å¯†ç ä¸€å®šè¦æœ‰ç©ºæ ¼</span><br><span class="line">2.æœ‰å¯†ç æƒ…å†µä¸‹ä¿®æ”¹å¯†ç </span><br><span class="line">mysqladmin -uroot -puplooking password &#39;uplooking123&#39;</span><br><span class="line">-u ç”¨æˆ·åå¯æœ‰å¯æ— </span><br><span class="line">-p å½“å‰å¯†ç ä¸èƒ½æœ‰</span><br><span class="line">password æ–°å¯†ç æœ‰</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@mastera0 ~]# mysql==&gt;æœªè®¾ç½®å¯†ç ç™»é™†</span><br><span class="line">Welcome to the MariaDB monitor. Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.41-MariaDB MariaDB Server</span><br><span class="line">Copyright (c) 2000, 2014, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line">[root@mastera0 ~]# mysqladmin -uroot password "uplooking"==&gt;è®¾ç½®å¯†ç </span><br><span class="line">[root@mastera0 ~]# mysql -uroot -p==&gt;ç™»é™†</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MariaDB monitor. Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 4</span><br><span class="line">Server version: 5.5.41-MariaDB MariaDB Server</span><br><span class="line">Copyright (c) 2000, 2014, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line">MariaDB [(none)]&gt; show databases==&gt;;åˆ†å·æäº¤å‘½ä»¤</span><br><span class="line">+--------------------+</span><br><span class="line">| Database</span><br><span class="line">|</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |==&gt;ä¸´æ—¶æ•°æ®åº“</span><br><span class="line">| mysql|==&gt;åš mysql åˆå§‹åŒ–çš„åº“</span><br><span class="line">| performance_schema |</span><br><span class="line">| test|==&gt;ä¸´æ—¶å…±äº«åº“,ä»»ä½•äººéƒ½å¯ä»¥çœ‹</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line">[root@serverg ~]# cat ~/.mysql_history==&gt;æŸ¥çœ‹ä¹‹å‰çš„å‘½ä»¤ä½†æ˜¯ä¸å…¨</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure><h4 id="RHEL-7-2-RPM-åŒ…å®‰è£…-MariaDB-10-2"><a href="#RHEL-7-2-RPM-åŒ…å®‰è£…-MariaDB-10-2" class="headerlink" title="RHEL 7.2 RPM åŒ…å®‰è£… MariaDB 10.2"></a>RHEL 7.2 RPM åŒ…å®‰è£… MariaDB 10.2</h4><table><thead><tr><th align="left">é¡¹ç›®</th><th align="left">å‚æ•°</th></tr></thead><tbody><tr><td align="left">è½¯ä»¶å</td><td align="left">MariaDB-server  10.2</td></tr><tr><td align="left">service</td><td align="left">mariadb/mysql</td></tr><tr><td align="left">daemon</td><td align="left">mysqld</td></tr><tr><td align="left">é…ç½®æ–‡ä»¶</td><td align="left">/etc/my.cnf</td></tr><tr><td align="left">æ•°æ®æ–‡ä»¶</td><td align="left">/var/lib/mysql/</td></tr><tr><td align="left">æ—¥å¿—æ–‡ä»¶</td><td align="left">é»˜è®¤æ²¡æœ‰å¼€å¯</td></tr><tr><td align="left">ç«¯å£å·</td><td align="left">3306</td></tr></tbody></table><blockquote><p>è½¯ä»¶çš„è·å–</p></blockquote><p><a href="http://classroom.example.com/materials/mariadb-10.2.repo" target="_blank" rel="noopener">http://classroom.example.com/materials/mariadb-10.2.repo</a></p><blockquote><p>å¸è½½å†²çªåŒ…mariadb-libså†å®‰è£…mariadb-10.2</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> rpm -e mariadb-libs --nodeps</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install -y MariaDB-server</span></span><br></pre></td></tr></table></figure><blockquote><p>åˆå§‹åŒ–MariaDBæ•°æ®åº“å¹¶å¯åŠ¨MariaDBæœåŠ¡ï¼Œå¹¶ä½œå®‰å…¨åŠ å›º</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> systemctl start mysql</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql_secure_installation</span></span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹MariaDBæ•°æ®åº“å®ä¾‹ç›‘å¬çš„ç«¯å£</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> netstat -ntpl|grep sql</span></span><br><span class="line">tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      12877/mysqld        </span><br><span class="line">tcp        0      0 0.0.0.0:4567            0.0.0.0:*               LISTEN      12877/mysqld</span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯</strong></p><table><thead><tr><th align="left">é¡¹ç›®å</th><th align="left">å‚æ•°</th></tr></thead><tbody><tr><td align="left">è½¯ä»¶å</td><td align="left">MariaDB-client 10.2</td></tr><tr><td align="left">å‘½ä»¤</td><td align="left">mysql,mysqladmin,mysqlbinlog,mysqldump</td></tr></tbody></table><h4 id="RHEL-7-2-RPM-åŒ…å®‰è£…-MySQL-5-7"><a href="#RHEL-7-2-RPM-åŒ…å®‰è£…-MySQL-5-7" class="headerlink" title="RHEL 7.2 RPM åŒ…å®‰è£… MySQL 5.7"></a>RHEL 7.2 RPM åŒ…å®‰è£… MySQL 5.7</h4><table><thead><tr><th align="left">é¡¹ç›®å</th><th align="left">å‚æ•°</th></tr></thead><tbody><tr><td align="left">è½¯ä»¶å</td><td align="left">mysql-community-server 5.7</td></tr><tr><td align="left">service</td><td align="left">mysqld</td></tr><tr><td align="left">daemon</td><td align="left">mysqld</td></tr><tr><td align="left">é…ç½®æ–‡ä»¶</td><td align="left">/etc/my.cnfï¼Œ/etc/my.cnf.d/*.cnf</td></tr><tr><td align="left">æ•°æ®æ–‡ä»¶</td><td align="left">/var/lib/mysql</td></tr><tr><td align="left">å¯åŠ¨æ—¥å¿—</td><td align="left">/var/log/mysqld.log</td></tr></tbody></table><blockquote><p>è½¯ä»¶çš„è·å–</p></blockquote><p><a href="http://classroom.example.com/materials/mysql-5.7.repo" target="_blank" rel="noopener">http://classroom.example.com/materials/mysql-5.7.repo</a></p><blockquote><p>å¸è½½å†²çªåŒ…mariadb-libså†å®‰è£…mysql-5.7</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> rpm -e mariadb-libs --nodeps</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install -y  mysql-community-server</span></span><br></pre></td></tr></table></figure><blockquote><p>åˆå§‹åŒ–MySQLæ•°æ®åº“å¹¶å¯åŠ¨mysqldæœåŠ¡ï¼Œå¹¶ä½œå®‰å…¨åŠ å›º</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> systemctl start mysqld</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql_secure_installation</span></span><br></pre></td></tr></table></figure><blockquote><p>æœåŠ¡ç«¯ä¿®æ”¹åˆå§‹å¯†ç </p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> grep password /var/<span class="built_in">log</span>/mysqld.log</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysqladmin -uroot -p<span class="string">''</span> password <span class="string">'(Uploo00king)'</span></span></span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯</strong></p><table><thead><tr><th align="left">é¡¹ç›®å</th><th align="left">å†…å®¹</th></tr></thead><tbody><tr><td align="left">è½¯ä»¶å</td><td align="left">mysql-community-client 5.7</td></tr><tr><td align="left">å‘½ä»¤</td><td align="left">mysql,mysqladmin,mysqlbinlog,mysqldump</td></tr></tbody></table><blockquote><p>å®¢æˆ·ç«¯ç™»é™†æ•°æ®åº“</p></blockquote><p><code>mysql -uroot -p&#39;(Uploo00king)&#39;</code></p><p>mysql.userè¡¨çš„ç»“æ„å˜åŒ–äº†ï¼ŒåŸå…ˆçš„passwordåˆ—æ”¹ä¸ºäº†authentication_stringåˆ—</p><h4 id="RHEL-7-2-äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…-MySQL-5-6"><a href="#RHEL-7-2-äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…-MySQL-5-6" class="headerlink" title="RHEL 7.2 äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£… MySQL 5.6"></a>RHEL 7.2 äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£… MySQL 5.6</h4><table><thead><tr><th align="left">mysql</th><th align="left">è½¯ä»¶æ¶æ„</th></tr></thead><tbody><tr><td align="left">æ•°æ®ç›®å½•</td><td align="left">/data/mysql/data</td></tr><tr><td align="left">binlogç›®å½•</td><td align="left">/data/mysql/log-data</td></tr><tr><td align="left">pidæ–‡ä»¶</td><td align="left">/data/tmp</td></tr><tr><td align="left">ä¸´æ—¶ç›®å½•</td><td align="left">/data1/tmp/</td></tr></tbody></table><p>ä»¥ä¸Šç›®å½•æ‰€å±è€…å’Œæ‰€å±ç»„éƒ½éœ€è¦ä¸ºmysql.mysql</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">[root@mastera0 ~]# tar -xf mysql-5.6.20-linux-glibc2.5-x86_64.tar.gz </span><br><span class="line">[root@mastera0 ~]# cd mysql-5.6.20-linux-glibc2.5-x86_64</span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# ls</span><br><span class="line">bin  COPYING  data  docs  include  INSTALL-BINARY  lib  man  mysql-test  README  scripts  share  sql-bench  support-files</span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# cat INSTALL-BINARY</span><br><span class="line">... ...</span><br><span class="line"> To install and use a MySQL binary distribution, the basic command</span><br><span class="line">   sequence looks like this:</span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> groupadd mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> useradd -r -g mysql mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> <span class="built_in">cd</span> /usr/<span class="built_in">local</span></span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> tar zxvf /path/to/mysql-VERSION-OS.tar.gz</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> ln -s full-path-to-mysql-VERSION-OS mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> <span class="built_in">cd</span> mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chown -R mysql .</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chgrp -R mysql .</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> scripts/mysql_install_db --user=mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chown -R root .</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chown -R mysql data</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> bin/mysqld_safe --user=mysql &amp;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Next <span class="built_in">command</span> is optional</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> cp support-files/mysql.server /etc/init.d/mysql.server</span></span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# groupadd mysql</span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# cd ..</span><br><span class="line">[root@mastera0 ~]# useradd -r -g mysql mysql</span><br><span class="line">[root@mastera0 ~]# cd /usr/local</span><br><span class="line">[root@mastera0 local]# mv /root/mysql-5.6.20-linux-glibc2.5-x86_64 .</span><br><span class="line">[root@mastera0 local]# ls</span><br><span class="line">bin  games    lib    libexec                             sbin   src</span><br><span class="line">etc  include  lib64  mysql-5.6.20-linux-glibc2.5-x86_64  share</span><br><span class="line">[root@mastera0 local]# ln -s mysql-5.6.20-linux-glibc2.5-x86_64 mysql</span><br><span class="line">[root@mastera0 local]# ll mysql</span><br><span class="line">lrwxrwxrwx.  1 root root   34 Dec 11 12:20 mysql -&gt; mysql-5.6.20-linux-glibc2.5-x86_64</span><br><span class="line">[root@mastera0 mysql]# cd mysql</span><br><span class="line">[root@mastera0 mysql]# mkdir /data/mysql/data -p</span><br><span class="line">[root@mastera0 mysql]# chown mysql. /data/mysql/data</span><br><span class="line">[root@mastera0 mysql]# chown mysql. /data/mysql/data -R</span><br><span class="line">[root@mastera0 mysql]# ll -d /data/mysql/data</span><br><span class="line">drwxr-xr-x. 2 mysql mysql 4096 Dec 11 12:24 /data/mysql/data</span><br><span class="line">[root@mastera0 mysql]# scripts/mysql_install_db --user=mysql --datadir=/data/mysql/data --basedir=/usr/local/mysql</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]# ll /data/mysql/data</span><br><span class="line">total 110604</span><br><span class="line">-rw-rw----. 1 mysql mysql 12582912 Dec 11 12:28 ibdata1</span><br><span class="line">-rw-rw----. 1 mysql mysql 50331648 Dec 11 12:28 ib_logfile0</span><br><span class="line">-rw-rw----. 1 mysql mysql 50331648 Dec 11 12:28 ib_logfile1</span><br><span class="line">drwx------. 2 mysql mysql     4096 Dec 11 12:28 mysql</span><br><span class="line">drwx------. 2 mysql mysql     4096 Dec 11 12:28 performance_schema</span><br><span class="line">drwx------. 2 mysql mysql     4096 Dec 11 12:28 test</span><br><span class="line">[root@mastera0 mysql]# vim /etc/my.cnf</span><br><span class="line">[client]</span><br><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœä¸è®¤è¯†è¿™ä¸ªå‚æ•°ä¼šå¿½ç•¥</span></span><br><span class="line">loose-default-character-set=utf8</span><br><span class="line">loose-prompt='\u@\h:\p [\d]&gt;'</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">basedir = /usr/local/mysql</span><br><span class="line">datadir = /data/mysql/data</span><br><span class="line">user=mysql</span><br><span class="line">port = 3306</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">pid-file=/data/tmp/mysql.pid</span><br><span class="line">tmpdir=/data1/tmp</span><br><span class="line">character_set_server=utf8</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">skip</span></span><br><span class="line">skip-external_locking=1</span><br><span class="line">skip-name-resolve=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">AB replication</span></span><br><span class="line">server-id = 1</span><br><span class="line">log-bin = /data/mysql/log-data/mastera</span><br><span class="line">binlog_format=row</span><br><span class="line">max_binlog_cache_size=2000M</span><br><span class="line">max_binlog_size=1G</span><br><span class="line">sync_binlog=1</span><br><span class="line"><span class="meta">#</span><span class="bash">expire_logs_days=7</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">semi_sync</span></span><br><span class="line">rpl_semi_sync_master_enabled=1</span><br><span class="line">rpl_semi_sync_master_timeout=1000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]# pwd</span><br><span class="line">/usr/local/mysql</span><br><span class="line">[root@mastera0 mysql]# cp support-files/mysql.server /etc/init.d/mysql</span><br><span class="line">[root@mastera0 mysql]# echo export PATH=$PATH:/usr/local/mysql/support-files/ &gt;&gt; /etc/bashrc</span><br><span class="line">[root@mastera0 mysql]# service mysql start</span><br></pre></td></tr></table></figure><h5 id="è„šæœ¬å®ç°è‡ªåŠ¨å®‰è£…MySQL"><a href="#è„šæœ¬å®ç°è‡ªåŠ¨å®‰è£…MySQL" class="headerlink" title="è„šæœ¬å®ç°è‡ªåŠ¨å®‰è£…MySQL"></a>è„šæœ¬å®ç°è‡ªåŠ¨å®‰è£…MySQL</h5><p>å¦‚æœéœ€è¦åŒæ—¶å®‰è£…10å°ç”šè‡³1000å°ï¼Œé€šè¿‡è„šæœ¬æ¥å®Œæˆä¸€å®šæ˜¯æå¥½çš„ï¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> auto_install_mysql_5.6.20 </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‚æ•°è®¾ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --binpos=æŒ‡å®šmysqläºŒè¿›åˆ¶å®‰è£…åŒ…çš„ä½ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --basedir=æŒ‡å®šmysqlå®‰è£…ä½ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --datadir=æŒ‡å®šmysqlæ•°æ®å­˜æ”¾ä½ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --binlogdir=æŒ‡å®šmysqlbinlogå­˜æ”¾ä½ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --piddir=æŒ‡å®šmysqlè¿›ç¨‹å­˜æ”¾ä½ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --tmpdir=æŒ‡å®šmysqlä¸´æ—¶æ–‡ä»¶ä½ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --<span class="built_in">help</span> æŸ¥çœ‹å¸®åŠ©</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> eg. auto_install_mysql_5.6.20 --binpos=/tmp/mysql.tar.gz --datadir=/data/mysql/data --basedir=/usr/<span class="built_in">local</span>/mysql</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> éå†ä½ç½®å‚æ•°ï¼Œè·å–å¯¹åº”çš„å‚æ•°å€¼</span></span><br><span class="line">for i in $&#123;@&#125;</span><br><span class="line">do</span><br><span class="line">case $&#123;i%=*&#125; in </span><br><span class="line">--binpos)</span><br><span class="line">binpos=$&#123;i#*=&#125;;;</span><br><span class="line">--basedir)</span><br><span class="line">basedir=$&#123;i#*=&#125;;;</span><br><span class="line">--datadir)</span><br><span class="line">datadir=$&#123;i#*=&#125;;;</span><br><span class="line">--binlogdir)</span><br><span class="line">binlogdir=$&#123;i#*=&#125;;;</span><br><span class="line">--piddir)</span><br><span class="line">piddir=$&#123;i#*=&#125;;;</span><br><span class="line">--tmpdir)</span><br><span class="line">tmpdir=$&#123;i#*=&#125;;;</span><br><span class="line">esac</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">TAR()&#123;</span><br><span class="line"><span class="meta">#</span><span class="bash"> è§£å‹mysqläºŒè¿›åˆ¶å®‰è£…åŒ…åˆ°æŒ‡å®šmysqlå®‰è£…ä½ç½®</span></span><br><span class="line">tar -xf $binpos -C /tmp &amp;&gt; /dev/null</span><br><span class="line">rpm=$&#123;binpos##*/&#125;</span><br><span class="line">rm -r $basedir </span><br><span class="line">mkdir $basedir -p </span><br><span class="line">mv /tmp/$&#123;rpm%.tar.gz&#125;/* $basedir</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ADD_user_dir()&#123;</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºmysqlç”¨æˆ·å’Œç»„</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºæ•°æ®ç›®å½•ï¼ŒäºŒè¿›åˆ¶æ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œä¸´æ—¶ç›®å½•ï¼Œpidç›®å½•</span></span><br><span class="line">useradd mysql &amp;&gt; /dev/null </span><br><span class="line">for i in $datadir $binlogdir $piddir $tmpdir;do</span><br><span class="line">rm -r $i</span><br><span class="line">mkdir $i -p &amp;&gt; /dev/null </span><br><span class="line">chown -R mysql:mysql $i</span><br><span class="line">done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">INIT()&#123;</span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡è„šæœ¬ç”Ÿæˆåˆå§‹åŒ–æ•°æ®</span></span><br><span class="line"><span class="meta">$</span><span class="bash">basedir/scripts/mysql_install_db --user=mysql --datadir=<span class="variable">$datadir</span> --basedir=<span class="variable">$basedir</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CONF()&#123;</span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–æœåŠ¡å™¨IPåœ°å€çš„ä¸»æœºä½ï¼Œç”¨ä½œserver-idçš„å€¼</span></span><br><span class="line">serverid=`ifconfig|grep -A 1 eno|tail -n 1|awk '&#123;print $2&#125;'|awk -F '.' '&#123;print $4&#125;'`</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/my.cnf &lt;&lt; ENDF</span><br><span class="line">[client]</span><br><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœä¸è®¤è¯†è¿™ä¸ªå‚æ•°ä¼šå¿½ç•¥</span></span><br><span class="line">loose-default-character-set=utf8</span><br><span class="line">loose-prompt='\u@\h:\p [\d]&gt;'</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">basedir = $basedir</span><br><span class="line">datadir = $datadir</span><br><span class="line">user=mysql</span><br><span class="line">port = 3306</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">pid-file=$piddir/mysql.pid</span><br><span class="line">tmpdir=$tmpdir</span><br><span class="line">character_set_server=utf8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">skip</span></span><br><span class="line">skip-external_locking=1</span><br><span class="line">skip-name-resolve=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">AB replication</span></span><br><span class="line">server-id = $serverid</span><br><span class="line">log-bin = $binlogdir/`hostname|awk -F . '&#123;print $1&#125;'`</span><br><span class="line">binlog_format=row</span><br><span class="line">max_binlog_cache_size=2000M</span><br><span class="line">max_binlog_size=1G</span><br><span class="line">sync_binlog=1</span><br><span class="line"><span class="meta">#</span><span class="bash">expire_logs_days=7</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">semi_sync</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rpl_semi_sync_master_enabled=1</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rpl_semi_sync_master_timeout=1000</span></span><br><span class="line">ENDF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†æ•°æ®åº“æœåŠ¡å¯åŠ¨è„šæœ¬å¤åˆ¶åˆ°/etc/init.d/</span></span><br><span class="line">cp $basedir/support-files/mysql.server /etc/init.d/mysql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹PATHè·¯å¾„ï¼Œå°†mysqlç›¸å…³å‘½ä»¤æ‰€åœ¨ç›®å½•åŠ å…¥</span></span><br><span class="line">echo export PATH=$PATH:$basedir/support-files/ &gt;&gt; /etc/bashrc</span><br><span class="line">source /etc/bashrc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Main()&#123;</span><br><span class="line">TAR </span><br><span class="line">ADD_user_dir </span><br><span class="line">INIT </span><br><span class="line">CONF </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Main</span><br></pre></td></tr></table></figure><p>æ€»ç»“</p><p>ç›¸å¯¹äºrpmåŒ…å®‰è£…ï¼ŒäºŒè¿›åˆ¶å®‰è£…ç¨å¤æ‚ä¸€ç‚¹ï¼Œä½†åªéœ€è¦å®ç°è§„åˆ’å¥½basedirã€datadirã€binlogdirã€tmpdirç­‰è·¯å¾„å³å¯</p><p>å¦éœ€è¦æ³¨æ„ç»™mysqlä½¿ç”¨çš„ç›¸å…³ç›®å½•çš„æƒé™ä¸ºmysql:mysql</p><p>è¿˜æœ‰å°±æ˜¯ï¼Œå¦‚æœå·²ç»å®‰è£…è¿‡å…¶ä»–ç‰ˆæœ¬çš„æ•°æ®åº“ï¼Œè®°å¾—å¸è½½å¹²å‡€äº†ã€‚</p><p>æ­¤å¤„å®‰è£…çš„åªæ˜¯æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯éœ€è¦å¦å¤–å®‰è£…ã€‚</p><hr><h3 id="MySQLå®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“"><a href="#MySQLå®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“" class="headerlink" title="MySQLå®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“"></a>MySQLå®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“</h3><h4 id="MySQLå®¢æˆ·ç«¯çš„ä½¿ç”¨"><a href="#MySQLå®¢æˆ·ç«¯çš„ä½¿ç”¨" class="headerlink" title="MySQLå®¢æˆ·ç«¯çš„ä½¿ç”¨"></a>MySQLå®¢æˆ·ç«¯çš„ä½¿ç”¨</h4><p>ä¸Šä¸€èŠ‚å®‰è£…MySQLæœåŠ¡ç«¯æ—¶å·²ç»è®²è§£è¿‡å®¢æˆ·ç«¯çš„ä½¿ç”¨ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p><h4 id="pythonè¿æ¥MySQLæ•°æ®åº“"><a href="#pythonè¿æ¥MySQLæ•°æ®åº“" class="headerlink" title="pythonè¿æ¥MySQLæ•°æ®åº“"></a>pythonè¿æ¥MySQLæ•°æ®åº“</h4><p>Python æ ‡å‡†æ•°æ®åº“æ¥å£ä¸º Python DB-APIï¼ŒPython DB-APIä¸ºå¼€å‘äººå‘˜æä¾›äº†æ•°æ®åº“åº”ç”¨ç¼–ç¨‹æ¥å£ã€‚</p><p>Python æ•°æ®åº“æ¥å£æ”¯æŒéå¸¸å¤šçš„æ•°æ®åº“ï¼Œä½ å¯ä»¥é€‰æ‹©é€‚åˆä½ é¡¹ç›®çš„æ•°æ®åº“ï¼š</p><ul><li>GadFly</li><li>mSQL</li><li>MySQL</li><li>PostgreSQL</li><li>Microsoft SQL Server 2000</li><li>Informix</li><li>Interbase</li><li>Oracle</li><li>Sybase</li></ul><p>ä½ å¯ä»¥è®¿é—®Pythonæ•°æ®åº“æ¥å£åŠAPIæŸ¥çœ‹è¯¦ç»†çš„æ”¯æŒæ•°æ®åº“åˆ—è¡¨ã€‚</p><p>ä¸åŒçš„æ•°æ®åº“ä½ éœ€è¦ä¸‹è½½ä¸åŒçš„DB APIæ¨¡å—ï¼Œä¾‹å¦‚ä½ éœ€è¦è®¿é—®Oracleæ•°æ®åº“å’ŒMysqlæ•°æ®ï¼Œä½ éœ€è¦ä¸‹è½½Oracleå’ŒMySQLæ•°æ®åº“æ¨¡å—ã€‚</p><p>DB-API æ˜¯ä¸€ä¸ªè§„èŒƒ. å®ƒå®šä¹‰äº†ä¸€ç³»åˆ—å¿…é¡»çš„å¯¹è±¡å’Œæ•°æ®åº“å­˜å–æ–¹å¼, ä»¥ä¾¿ä¸ºå„ç§å„æ ·çš„åº•å±‚æ•°æ®åº“ç³»ç»Ÿå’Œå¤šç§å¤šæ ·çš„æ•°æ®åº“æ¥å£ç¨‹åºæä¾›ä¸€è‡´çš„è®¿é—®æ¥å£ ã€‚</p><p>Pythonçš„DB-APIï¼Œä¸ºå¤§å¤šæ•°çš„æ•°æ®åº“å®ç°äº†æ¥å£ï¼Œä½¿ç”¨å®ƒè¿æ¥å„æ•°æ®åº“åï¼Œå°±å¯ä»¥ç”¨ç›¸åŒçš„æ–¹å¼æ“ä½œå„æ•°æ®åº“ã€‚</p><p>Python DB-APIä½¿ç”¨æµç¨‹ï¼š</p><ul><li>å¼•å…¥ API æ¨¡å—ã€‚</li><li>è·å–ä¸æ•°æ®åº“çš„è¿æ¥ã€‚</li><li>æ‰§è¡ŒSQLè¯­å¥å’Œå­˜å‚¨è¿‡ç¨‹ã€‚</li><li>å…³é—­æ•°æ®åº“è¿æ¥ã€‚</li></ul><blockquote><h1 id="ä»€ä¹ˆæ˜¯MySQLdb"><a href="#ä»€ä¹ˆæ˜¯MySQLdb" class="headerlink" title="ä»€ä¹ˆæ˜¯MySQLdb?"></a>ä»€ä¹ˆæ˜¯MySQLdb?</h1></blockquote><p>MySQLdb æ˜¯ç”¨äºPythoné“¾æ¥Mysqlæ•°æ®åº“çš„æ¥å£ï¼Œå®ƒå®ç°äº† Python æ•°æ®åº“ API è§„èŒƒ V2.0ï¼ŒåŸºäº MySQL C API ä¸Šå»ºç«‹çš„ã€‚</p><blockquote><h1 id="å¦‚ä½•å®‰è£…MySQLdb"><a href="#å¦‚ä½•å®‰è£…MySQLdb" class="headerlink" title="å¦‚ä½•å®‰è£…MySQLdb?"></a>å¦‚ä½•å®‰è£…MySQLdb?</h1></blockquote><p>å®‰è£…MySQLdbï¼Œè¯·è®¿é—® <a href="http://sourceforge.net/projects/mysql-python" target="_blank" rel="noopener">http://sourceforge.net/projects/mysql-python</a> ï¼Œ(Linuxå¹³å°å¯ä»¥è®¿é—®ï¼š<a href="https://pypi.python.org/pypi/MySQL-python)ä»è¿™é‡Œå¯é€‰æ‹©é€‚åˆæ‚¨çš„å¹³å°çš„å®‰è£…åŒ…ï¼Œåˆ†ä¸ºé¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œæºä»£ç å®‰è£…åŒ…ã€‚" target="_blank" rel="noopener">https://pypi.python.org/pypi/MySQL-python)ä»è¿™é‡Œå¯é€‰æ‹©é€‚åˆæ‚¨çš„å¹³å°çš„å®‰è£…åŒ…ï¼Œåˆ†ä¸ºé¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œæºä»£ç å®‰è£…åŒ…ã€‚</a><br>å¦‚æœæ‚¨é€‰æ‹©äºŒè¿›åˆ¶æ–‡ä»¶å‘è¡Œç‰ˆæœ¬çš„è¯ï¼Œå®‰è£…è¿‡ç¨‹åŸºæœ¬å®‰è£…æç¤ºå³å¯å®Œæˆã€‚å¦‚æœä»æºä»£ç è¿›è¡Œå®‰è£…çš„è¯ï¼Œåˆ™éœ€è¦åˆ‡æ¢åˆ°MySQLdbå‘è¡Œç‰ˆæœ¬çš„é¡¶çº§ç›®å½•ï¼Œå¹¶é”®å…¥ä¸‹åˆ—å‘½ä»¤:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gunzip MySQL-python-1.2.2.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -xvf MySQL-python-1.2.2.tar</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> MySQL-python-1.2.2</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python setup.py build</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python setup.py install</span></span><br></pre></td></tr></table></figure><blockquote><h2 id="ä¸‹è½½å®‰è£…åŒ…"><a href="#ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="ä¸‹è½½å®‰è£…åŒ…"></a>ä¸‹è½½å®‰è£…åŒ…</h2></blockquote><p><a href="https://pypi.python.org/pypi/MySQL-python" target="_blank" rel="noopener">MySQL-python</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ls</span><br><span class="line">MySQL-python-1.2.5.zip</span><br><span class="line">[root@localhost ~]# unzip MySQL-python-1.2.5.zip </span><br><span class="line">[root@localhost ~]# cd MySQL-python-1.2.5/</span><br><span class="line">[root@localhost MySQL-python-1.2.5]# ls</span><br><span class="line">oc      MANIFEST.in   _mysql_exceptions.py   README.md         setup_posix.py    site.cfg</span><br><span class="line">GPL-2.0  metadata.cfg  MySQL_python.egg-info  setup.cfg         setup_posix.pyc   tests</span><br><span class="line">HISTORY  _mysql.c      PKG-INFO               setup_common.py   setup.py</span><br><span class="line">INSTALL  MySQLdb       pymemcompat.h          setup_common.pyc  setup_windows.py</span><br><span class="line">[root@localhost MySQL-python-1.2.5]# python setup.py build</span><br><span class="line">sh: mysql_config: command not found</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File "setup.py", line 17, in &lt;module&gt;</span><br><span class="line">    metadata, options = get_config()</span><br><span class="line">  File "/root/MySQL-python-1.2.5/setup_posix.py", line 43, in get_config</span><br><span class="line">    libs = mysql_config("libs_r")</span><br><span class="line">  File "/root/MySQL-python-1.2.5/setup_posix.py", line 25, in mysql_config</span><br><span class="line">    raise EnvironmentError("%s not found" % (mysql_config.path,))</span><br><span class="line">EnvironmentError: mysql_config not found</span><br></pre></td></tr></table></figure><blockquote><h2 id="ç¼ºå°‘mysql-configå‘½ä»¤"><a href="#ç¼ºå°‘mysql-configå‘½ä»¤" class="headerlink" title="ç¼ºå°‘mysql_configå‘½ä»¤"></a>ç¼ºå°‘mysql_configå‘½ä»¤</h2></blockquote><p>è¯¥å‘½ä»¤æ˜¯ç”±mysql-develæˆ–è€…mariadb-develå®‰è£…ç”Ÿæˆï¼Œå› æ­¤å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…ï¼Œåœ¨æ£€è½¦site.cfgä¸­mysql_configçš„è·¯å¾„æ˜¯å¦æ­£ç¡®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost MySQL-python-1.2.5]# which mysql_config</span><br><span class="line">/usr/bin/which: no mysql_config in (/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin)</span><br><span class="line"></span><br><span class="line">[root@localhost MySQL-python-1.2.5]# yum install -y mariadb-devel</span><br><span class="line"></span><br><span class="line">[root@localhost MySQL-python-1.2.5]# which mysql_config</span><br><span class="line">/usr/bin/mysql_config</span><br><span class="line"></span><br><span class="line">[root@localhost MySQL-python-1.2.5]# vim site.cfg</span><br><span class="line">mysql_config=/usr/bin/mysql_config</span><br></pre></td></tr></table></figure><blockquote><h2 id="å¼€å§‹ç¼–è¯‘å®‰è£…"><a href="#å¼€å§‹ç¼–è¯‘å®‰è£…" class="headerlink" title="å¼€å§‹ç¼–è¯‘å®‰è£…"></a>å¼€å§‹ç¼–è¯‘å®‰è£…</h2></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost MySQL-python-1.2.5]# python setup.py build</span><br><span class="line">[root@localhost MySQL-python-1.2.5]# python setup.py install</span><br></pre></td></tr></table></figure><blockquote><h2 id="åŠ è½½æ¨¡å—"><a href="#åŠ è½½æ¨¡å—" class="headerlink" title="åŠ è½½æ¨¡å—"></a>åŠ è½½æ¨¡å—</h2></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> MySQLdb</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: dir(MySQLdb)</span><br><span class="line">Out[<span class="number">3</span>]: </span><br><span class="line">[<span class="string">'BINARY'</span>,</span><br><span class="line"> <span class="string">'Binary'</span>,</span><br><span class="line"> <span class="string">'Connect'</span>,</span><br><span class="line"> <span class="string">'Connection'</span>,</span><br><span class="line"> <span class="string">'DATE'</span>,</span><br><span class="line"> <span class="string">'DATETIME'</span>,</span><br><span class="line"> <span class="string">'DBAPISet'</span>,</span><br><span class="line"> <span class="string">'DataError'</span>,</span><br><span class="line"> <span class="string">'DatabaseError'</span>,</span><br><span class="line"> <span class="string">'Date'</span>,</span><br><span class="line"> <span class="string">'DateFromTicks'</span>,</span><br><span class="line"> <span class="string">'Error'</span>,</span><br><span class="line"> <span class="string">'FIELD_TYPE'</span>,</span><br><span class="line"> <span class="string">'IntegrityError'</span>,</span><br><span class="line"> <span class="string">'InterfaceError'</span>,</span><br><span class="line"> <span class="string">'InternalError'</span>,</span><br><span class="line"> <span class="string">'MySQLError'</span>,</span><br><span class="line"> <span class="string">'NULL'</span>,</span><br><span class="line"> <span class="string">'NUMBER'</span>,</span><br><span class="line"> <span class="string">'NotSupportedError'</span>,</span><br><span class="line"> <span class="string">'OperationalError'</span>,</span><br><span class="line"> <span class="string">'ProgrammingError'</span>,</span><br><span class="line"> <span class="string">'ROWID'</span>,</span><br><span class="line"> <span class="string">'STRING'</span>,</span><br><span class="line"> <span class="string">'TIME'</span>,</span><br><span class="line"> <span class="string">'TIMESTAMP'</span>,</span><br><span class="line"> <span class="string">'Time'</span>,</span><br><span class="line"> <span class="string">'TimeFromTicks'</span>,</span><br><span class="line"> <span class="string">'Timestamp'</span>,</span><br><span class="line"> <span class="string">'TimestampFromTicks'</span>,</span><br><span class="line"> <span class="string">'Warning'</span>,</span><br><span class="line"> <span class="string">'__all__'</span>,</span><br><span class="line"> <span class="string">'__author__'</span>,</span><br><span class="line"> <span class="string">'__builtins__'</span>,</span><br><span class="line"> <span class="string">'__doc__'</span>,</span><br><span class="line"> <span class="string">'__file__'</span>,</span><br><span class="line"> <span class="string">'__loader__'</span>,</span><br><span class="line"> <span class="string">'__name__'</span>,</span><br><span class="line"> <span class="string">'__package__'</span>,</span><br><span class="line"> <span class="string">'__path__'</span>,</span><br><span class="line"> <span class="string">'__revision__'</span>,</span><br><span class="line"> <span class="string">'__version__'</span>,</span><br><span class="line"> <span class="string">'_mysql'</span>,</span><br><span class="line"> <span class="string">'apilevel'</span>,</span><br><span class="line"> <span class="string">'connect'</span>,</span><br><span class="line"> <span class="string">'connection'</span>,</span><br><span class="line"> <span class="string">'constants'</span>,</span><br><span class="line"> <span class="string">'debug'</span>,</span><br><span class="line"> <span class="string">'escape'</span>,</span><br><span class="line"> <span class="string">'escape_dict'</span>,</span><br><span class="line"> <span class="string">'escape_sequence'</span>,</span><br><span class="line"> <span class="string">'escape_string'</span>,</span><br><span class="line"> <span class="string">'get_client_info'</span>,</span><br><span class="line"> <span class="string">'paramstyle'</span>,</span><br><span class="line"> <span class="string">'release'</span>,</span><br><span class="line"> <span class="string">'result'</span>,</span><br><span class="line"> <span class="string">'server_end'</span>,</span><br><span class="line"> <span class="string">'server_init'</span>,</span><br><span class="line"> <span class="string">'string_literal'</span>,</span><br><span class="line"> <span class="string">'test_DBAPISet_set_equality'</span>,</span><br><span class="line"> <span class="string">'test_DBAPISet_set_equality_membership'</span>,</span><br><span class="line"> <span class="string">'test_DBAPISet_set_inequality'</span>,</span><br><span class="line"> <span class="string">'test_DBAPISet_set_inequality_membership'</span>,</span><br><span class="line"> <span class="string">'thread_safe'</span>,</span><br><span class="line"> <span class="string">'threadsafety'</span>,</span><br><span class="line"> <span class="string">'times'</span>,</span><br><span class="line"> <span class="string">'version_info'</span></span><br></pre></td></tr></table></figure><blockquote><h1 id="æ•°æ®åº“è¿æ¥"><a href="#æ•°æ®åº“è¿æ¥" class="headerlink" title="æ•°æ®åº“è¿æ¥"></a>æ•°æ®åº“è¿æ¥</h1></blockquote><p>è¿æ¥æ•°æ®åº“å‰ï¼Œè¯·å…ˆç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š</p><ol><li><p>æ•°æ®åº“æœåŠ¡å·²ç»å¯åŠ¨ï¼Œå¹¶å·²åˆ›å»ºäº†æ•°æ®åº“ test1</p></li><li><p>åœ¨test1æ•°æ®åº“ä¸­æ‚¨å·²ç»åˆ›å»ºäº†è¡¨ db1</p></li><li><p>t1è¡¨å­—æ®µä¸º id,first_name,last_name,age,sex,income</p></li><li><p>è¿æ¥æ•°æ®åº“t1ä½¿ç”¨çš„ç”¨æˆ·åä¸º â€œrootâ€ ï¼Œå¯†ç ä¸º â€œuplookingâ€</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl start mariadb</span><br><span class="line">[root@localhost ~]# mysqladmin -uroot password 'uplooking'</span><br><span class="line">[root@localhost ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 4</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; create database db1;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; create table db1.t1 (id int auto_increment primary key,first_name varchar(50),last_name varchar(50),age int,sex char(1),income float);</span><br><span class="line">Query OK, 0 rows affected (0.09 sec)</span><br></pre></td></tr></table></figure><blockquote><h2 id="å®ä¾‹1ï¼šè¿æ¥æ•°æ®åº“è·å–æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯"><a href="#å®ä¾‹1ï¼šè¿æ¥æ•°æ®åº“è·å–æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="å®ä¾‹1ï¼šè¿æ¥æ•°æ®åº“è·å–æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯"></a>å®ä¾‹1ï¼šè¿æ¥æ•°æ®åº“è·å–æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯</h2></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost python-mysql]# vim getversion.py </span><br><span class="line"><span class="meta">#</span><span class="bash">!/usr/bin/python</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line">import MySQLdb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰“å¼€æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db = MySQLdb.connect("localhost","root","uplooking","db1" )</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡ </span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨executeæ–¹æ³•æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">cursor.execute("SELECT VERSION()")</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ fetchone() æ–¹æ³•è·å–ä¸€æ¡æ•°æ®åº“ã€‚</span></span><br><span class="line">data = cursor.fetchone()</span><br><span class="line"></span><br><span class="line">print "Database version : %s " % data</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å…³é—­æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰§è¡Œç»“æœ</span></span><br><span class="line">[root@localhost python-mysql]# python getversion.py </span><br><span class="line">Database version : 5.5.44-MariaDB-log</span><br></pre></td></tr></table></figure><blockquote><h2 id="å®ä¾‹2ï¼šæŸ¥è¯¢mysqlä¸­çš„db1-t1è¡¨çš„ç»“æ„ï¼ˆæ•°æ®å­—å…¸ï¼‰ä¿¡æ¯"><a href="#å®ä¾‹2ï¼šæŸ¥è¯¢mysqlä¸­çš„db1-t1è¡¨çš„ç»“æ„ï¼ˆæ•°æ®å­—å…¸ï¼‰ä¿¡æ¯" class="headerlink" title="å®ä¾‹2ï¼šæŸ¥è¯¢mysqlä¸­çš„db1.t1è¡¨çš„ç»“æ„ï¼ˆæ•°æ®å­—å…¸ï¼‰ä¿¡æ¯"></a>å®ä¾‹2ï¼šæŸ¥è¯¢mysqlä¸­çš„db1.t1è¡¨çš„ç»“æ„ï¼ˆæ•°æ®å­—å…¸ï¼‰ä¿¡æ¯</h2></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">sql=sys.argv[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db = MySQLdb.connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"uplooking"</span>,<span class="string">"db1"</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡ </span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨executeæ–¹æ³•æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ fetchone() æ–¹æ³•è·å–ä¸€æ¡æ•°æ®åº“ã€‚</span></span><br><span class="line">data = cursor.fetchall()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> i:</span><br><span class="line">                sys.stdout.write(str(j)+<span class="string">'\t'</span>)</span><br><span class="line">        sys.stdout.write(<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p>è„šæœ¬å¸¦å‚æ•°æ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost python-mysql]# python select.py "desc db1.t1"</span><br><span class="line">idint(11)NOPRINoneauto_increment</span><br><span class="line">first_namevarchar(50)YESNone</span><br><span class="line">last_namevarchar(50)YESNone</span><br><span class="line">ageint(11)YESNone</span><br><span class="line">sexchar(1)YESNone</span><br><span class="line">incomefloatYESNone</span><br></pre></td></tr></table></figure><p>æ•°æ®åº“æŸ¥è¯¢æ“ä½œ</p><ul><li>PythonæŸ¥è¯¢Mysqlä½¿ç”¨ fetchone() æ–¹æ³•è·å–å•æ¡æ•°æ®, ä½¿ç”¨fetchall() æ–¹æ³•è·å–å¤šæ¡æ•°æ®ã€‚</li><li>fetchone(): è¯¥æ–¹æ³•è·å–ä¸‹ä¸€ä¸ªæŸ¥è¯¢ç»“æœé›†ã€‚ç»“æœé›†æ˜¯ä¸€ä¸ªå¯¹è±¡</li><li>fetchall():æ¥æ”¶å…¨éƒ¨çš„è¿”å›ç»“æœè¡Œ.</li><li>rowcount: è¿™æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ï¼Œå¹¶è¿”å›æ‰§è¡Œexecute()æ–¹æ³•åå½±å“çš„è¡Œæ•°ã€‚</li></ul><blockquote><h2 id="å®ä¾‹3ï¼šè·å–mysqlæ•°æ®åº“çš„å˜é‡å€¼"><a href="#å®ä¾‹3ï¼šè·å–mysqlæ•°æ®åº“çš„å˜é‡å€¼" class="headerlink" title="å®ä¾‹3ï¼šè·å–mysqlæ•°æ®åº“çš„å˜é‡å€¼"></a>å®ä¾‹3ï¼šè·å–mysqlæ•°æ®åº“çš„å˜é‡å€¼</h2></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">key=sys.argv[<span class="number">1</span>]</span><br><span class="line">sql=<span class="string">"select @@"</span>+key</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db = MySQLdb.connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"uplooking"</span>,<span class="string">"db1"</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡ </span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨executeæ–¹æ³•æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ fetchone() æ–¹æ³•è·å–ä¸€æ¡æ•°æ®åº“ã€‚</span></span><br><span class="line">data = cursor.fetchall()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"&#123;&#125; : &#123;&#125;"</span>.format(sys.argv[<span class="number">1</span>],data[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p>è·å–innodb_version\innodb_buffer_pool_size</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost python-mysql]# python Get_variables.py innodb_version</span><br><span class="line">innodb_version : 5.5.43-MariaDB-37.2</span><br><span class="line">[root@localhost python-mysql]# vim Get_variables.py </span><br><span class="line">[root@localhost python-mysql]# python Get_variables.py innodb_buffer_pool_size</span><br><span class="line">innodb_buffer_pool_size : 134217728</span><br></pre></td></tr></table></figure><blockquote><h2 id="å®ä¾‹4ï¼šåˆ›å»ºæ•°æ®åº“è¡¨"><a href="#å®ä¾‹4ï¼šåˆ›å»ºæ•°æ®åº“è¡¨" class="headerlink" title="å®ä¾‹4ï¼šåˆ›å»ºæ•°æ®åº“è¡¨"></a>å®ä¾‹4ï¼šåˆ›å»ºæ•°æ®åº“è¡¨</h2></blockquote><p>å¦‚æœæ•°æ®åº“è¿æ¥å­˜åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨execute()æ–¹æ³•æ¥ä¸ºæ•°æ®åº“åˆ›å»ºè¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºåˆ›å»ºè¡¨t2ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db = MySQLdb.connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"uplooking"</span>,<span class="string">"db1"</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡ </span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ•°æ®è¡¨å·²ç»å­˜åœ¨ä½¿ç”¨ execute() æ–¹æ³•åˆ é™¤è¡¨ã€‚</span></span><br><span class="line">cursor.execute(<span class="string">"DROP TABLE IF EXISTS t2"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ•°æ®è¡¨SQLè¯­å¥</span></span><br><span class="line">sql = <span class="string">"""CREATE TABLE t2 (</span></span><br><span class="line"><span class="string">         FIRST_NAME  CHAR(20) NOT NULL,</span></span><br><span class="line"><span class="string">         LAST_NAME  CHAR(20),</span></span><br><span class="line"><span class="string">         AGE INT,  </span></span><br><span class="line"><span class="string">         SEX CHAR(1),</span></span><br><span class="line"><span class="string">         INCOME FLOAT )"""</span></span><br><span class="line"></span><br><span class="line">cursor.execute(sql)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¯¥è„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost python-mysql]# python createdb.py </span><br><span class="line">createdb.py:13: Warning: Unknown table 't2'</span><br><span class="line">  cursor.execute("DROP TABLE IF EXISTS t2")</span><br><span class="line"></span><br><span class="line">[root@localhost python-mysql]# ls</span><br><span class="line">createdb.py  Get_variables.py  getversion.py  select.py</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹è¡¨çš„ç»“æ„</span></span><br><span class="line"></span><br><span class="line">[root@localhost python-mysql]# python select.py "desc db1.t2"</span><br><span class="line">FIRST_NAMEchar(20)NONone</span><br><span class="line">LAST_NAMEchar(20)YESNone</span><br><span class="line">AGEint(11)YESNone</span><br><span class="line">SEXchar(1)YESNone</span><br><span class="line">INCOMEfloatYESNone</span><br></pre></td></tr></table></figure><blockquote><h2 id="å®ä¾‹5ï¼šæ•°æ®åº“æ’å…¥æ“ä½œ"><a href="#å®ä¾‹5ï¼šæ•°æ®åº“æ’å…¥æ“ä½œ" class="headerlink" title="å®ä¾‹5ï¼šæ•°æ®åº“æ’å…¥æ“ä½œ"></a>å®ä¾‹5ï¼šæ•°æ®åº“æ’å…¥æ“ä½œ</h2></blockquote><p>ä»¥ä¸‹å®ä¾‹ä½¿ç”¨æ‰§è¡Œ SQL INSERT è¯­å¥å‘è¡¨ db1.t1 æ’å…¥è®°å½•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db = MySQLdb.connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"uplooking"</span>,<span class="string">"db1"</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡ </span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># SQL æ’å…¥è¯­å¥</span></span><br><span class="line">sql = <span class="string">"""INSERT INTO t1(FIRST_NAME,</span></span><br><span class="line"><span class="string">         LAST_NAME, AGE, SEX, INCOME)</span></span><br><span class="line"><span class="string">         VALUES ('Mac', 'Mohan', 20, 'M', 2000)"""</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">   <span class="comment"># æ‰§è¡Œsqlè¯­å¥</span></span><br><span class="line">   cursor.execute(sql)</span><br><span class="line">   <span class="comment"># æäº¤åˆ°æ•°æ®åº“æ‰§è¡Œ</span></span><br><span class="line">   db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">   <span class="comment"># Rollback in case there is any error</span></span><br><span class="line">   db.rollback()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¯¥è„šæœ¬ï¼Œå¹¶æŸ¥çœ‹db1.t1è¡¨ä¸­çš„æ‰€æœ‰å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost python-mysql]# python insert_table.py </span><br><span class="line">[root@localhost python-mysql]# python select.py "select * from db1.t1"</span><br><span class="line">1MacMohan20M2000.0</span><br></pre></td></tr></table></figure><blockquote><h2 id="å®ä¾‹6ï¼šåˆ é™¤æ“ä½œ"><a href="#å®ä¾‹6ï¼šåˆ é™¤æ“ä½œ" class="headerlink" title="å®ä¾‹6ï¼šåˆ é™¤æ“ä½œ"></a>å®ä¾‹6ï¼šåˆ é™¤æ“ä½œ</h2></blockquote><p>åˆ é™¤æ“ä½œç”¨äºåˆ é™¤æ•°æ®è¡¨ä¸­çš„æ•°æ®ï¼Œä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº†åˆ é™¤æ•°æ®è¡¨ db1 ä¸­ AGE å¤§äº 20 çš„æ‰€æœ‰æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db = MySQLdb.connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"uplooking"</span>,<span class="string">"db1"</span> ))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡ </span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># SQL åˆ é™¤è¯­å¥</span></span><br><span class="line">sql = <span class="string">"DELETE FROM db1.t1 WHERE age &gt; 20"</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">   <span class="comment"># æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">   cursor.execute(sql)</span><br><span class="line">   <span class="comment"># æäº¤ä¿®æ”¹</span></span><br><span class="line">   db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">   <span class="comment"># å‘ç”Ÿé”™è¯¯æ—¶å›æ»š</span></span><br><span class="line">   db.rollback()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­è¿æ¥</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><blockquote><h2 id="å®ä¾‹7ï¼šæ‰§è¡Œäº‹åŠ¡"><a href="#å®ä¾‹7ï¼šæ‰§è¡Œäº‹åŠ¡" class="headerlink" title="å®ä¾‹7ï¼šæ‰§è¡Œäº‹åŠ¡"></a>å®ä¾‹7ï¼šæ‰§è¡Œäº‹åŠ¡</h2></blockquote><p>äº‹åŠ¡æœºåˆ¶å¯ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</p><p>äº‹åŠ¡åº”è¯¥å…·æœ‰4ä¸ªå±æ€§ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ã€‚è¿™å››ä¸ªå±æ€§é€šå¸¸ç§°ä¸ºACIDç‰¹æ€§ã€‚</p><ul><li>åŸå­æ€§ï¼ˆatomicityï¼‰ã€‚ä¸€ä¸ªäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­åŒ…æ‹¬çš„è¯¸æ“ä½œè¦ä¹ˆéƒ½åšï¼Œè¦ä¹ˆéƒ½ä¸åšã€‚</li><li>ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ã€‚äº‹åŠ¡å¿…é¡»æ˜¯ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚ä¸€è‡´æ€§ä¸åŸå­æ€§æ˜¯å¯†åˆ‡ç›¸å…³çš„ã€‚</li><li>éš”ç¦»æ€§ï¼ˆisolationï¼‰ã€‚ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ã€‚å³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å¹¶å‘çš„å…¶ä»–äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°ã€‚</li><li>æŒä¹…æ€§ï¼ˆdurabilityï¼‰ã€‚æŒç»­æ€§ä¹Ÿç§°æ°¸ä¹…æ€§ï¼ˆpermanenceï¼‰ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±åº”è¯¥æ˜¯æ°¸ä¹…æ€§çš„ã€‚æ¥ä¸‹æ¥çš„å…¶ä»–æ“ä½œæˆ–æ•…éšœä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</li></ul><p>Python DB API 2.0 çš„äº‹åŠ¡æä¾›äº†ä¸¤ä¸ªæ–¹æ³• commit æˆ– rollbackã€‚</p><p>å®ä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLåˆ é™¤è®°å½•è¯­å¥</span></span><br><span class="line">sql = <span class="string">"DELETE FROM db1.t1 WHERE age &gt; 20"</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">   <span class="comment"># æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">   cursor.execute(sql)</span><br><span class="line">   <span class="comment"># å‘æ•°æ®åº“æäº¤</span></span><br><span class="line">   db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">   <span class="comment"># å‘ç”Ÿé”™è¯¯æ—¶å›æ»š</span></span><br><span class="line">   db.rollback()</span><br></pre></td></tr></table></figure><p>å¯¹äºæ”¯æŒäº‹åŠ¡çš„æ•°æ®åº“ï¼Œ åœ¨Pythonæ•°æ®åº“ç¼–ç¨‹ä¸­ï¼Œå½“æ¸¸æ ‡å»ºç«‹ä¹‹æ—¶ï¼Œå°±è‡ªåŠ¨å¼€å§‹äº†ä¸€ä¸ªéšå½¢çš„æ•°æ®åº“äº‹åŠ¡ã€‚</p><p>commit()æ–¹æ³•æ¸¸æ ‡çš„æ‰€æœ‰æ›´æ–°æ“ä½œï¼Œrollbackï¼ˆï¼‰æ–¹æ³•å›æ»šå½“å‰æ¸¸æ ‡çš„æ‰€æœ‰æ“ä½œã€‚æ¯ä¸€ä¸ªæ–¹æ³•éƒ½å¼€å§‹äº†ä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚</p><blockquote><h1 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h1></blockquote><p>DB APIä¸­å®šä¹‰äº†ä¸€äº›æ•°æ®åº“æ“ä½œçš„é”™è¯¯åŠå¼‚å¸¸ï¼Œä¸‹è¡¨åˆ—å‡ºäº†è¿™äº›é”™è¯¯å’Œå¼‚å¸¸:</p><table><thead><tr><th align="left">å¼‚å¸¸</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">Warning</td><td align="left">å½“æœ‰ä¸¥é‡è­¦å‘Šæ—¶è§¦å‘ï¼Œä¾‹å¦‚æ’å…¥æ•°æ®æ˜¯è¢«æˆªæ–­ç­‰ç­‰ã€‚å¿…é¡»æ˜¯ StandardError çš„å­ç±»ã€‚</td></tr><tr><td align="left">Error</td><td align="left">è­¦å‘Šä»¥å¤–æ‰€æœ‰å…¶ä»–é”™è¯¯ç±»ã€‚å¿…é¡»æ˜¯ StandardError çš„å­ç±»ã€‚</td></tr><tr><td align="left">InterfaceError</td><td align="left">å½“æœ‰æ•°æ®åº“æ¥å£æ¨¡å—æœ¬èº«çš„é”™è¯¯ï¼ˆè€Œä¸æ˜¯æ•°æ®åº“çš„é”™è¯¯ï¼‰å‘ç”Ÿæ—¶è§¦å‘ã€‚ å¿…é¡»æ˜¯Errorçš„å­ç±»ã€‚</td></tr><tr><td align="left">DatabaseError</td><td align="left">å’Œæ•°æ®åº“æœ‰å…³çš„é”™è¯¯å‘ç”Ÿæ—¶è§¦å‘ã€‚ å¿…é¡»æ˜¯Errorçš„å­ç±»ã€‚</td></tr><tr><td align="left">DataError</td><td align="left">å½“æœ‰æ•°æ®å¤„ç†æ—¶çš„é”™è¯¯å‘ç”Ÿæ—¶è§¦å‘ï¼Œä¾‹å¦‚ï¼šé™¤é›¶é”™è¯¯ï¼Œæ•°æ®è¶…èŒƒå›´ç­‰ç­‰ã€‚ å¿…é¡»æ˜¯DatabaseErrorçš„å­ç±»ã€‚</td></tr><tr><td align="left">OperationalError</td><td align="left">æŒ‡éç”¨æˆ·æ§åˆ¶çš„ï¼Œè€Œæ˜¯æ“ä½œæ•°æ®åº“æ—¶å‘ç”Ÿçš„é”™è¯¯ã€‚ä¾‹å¦‚ï¼šè¿æ¥æ„å¤–æ–­å¼€ã€ æ•°æ®åº“åæœªæ‰¾åˆ°ã€äº‹åŠ¡å¤„ç†å¤±è´¥ã€å†…å­˜åˆ†é…é”™è¯¯ç­‰ç­‰æ“ä½œæ•°æ®åº“æ˜¯å‘ç”Ÿçš„é”™è¯¯ã€‚ å¿…é¡»æ˜¯DatabaseErrorçš„å­ç±»ã€‚</td></tr><tr><td align="left">IntegrityError</td><td align="left">å®Œæ•´æ€§ç›¸å…³çš„é”™è¯¯ï¼Œä¾‹å¦‚å¤–é”®æ£€æŸ¥å¤±è´¥ç­‰ã€‚å¿…é¡»æ˜¯DatabaseErrorå­ç±»ã€‚</td></tr><tr><td align="left">InternalError</td><td align="left">æ•°æ®åº“çš„å†…éƒ¨é”™è¯¯ï¼Œä¾‹å¦‚æ¸¸æ ‡ï¼ˆcursorï¼‰å¤±æ•ˆäº†ã€äº‹åŠ¡åŒæ­¥å¤±è´¥ç­‰ç­‰ã€‚ å¿…é¡»æ˜¯DatabaseErrorå­ç±»ã€‚</td></tr><tr><td align="left">ProgrammingError</td><td align="left">ç¨‹åºé”™è¯¯ï¼Œä¾‹å¦‚æ•°æ®è¡¨ï¼ˆtableï¼‰æ²¡æ‰¾åˆ°æˆ–å·²å­˜åœ¨ã€SQLè¯­å¥è¯­æ³•é”™è¯¯ã€ å‚æ•°æ•°é‡é”™è¯¯ç­‰ç­‰ã€‚å¿…é¡»æ˜¯DatabaseErrorçš„å­ç±»ã€‚</td></tr><tr><td align="left">NotSupportedError</td><td align="left">ä¸æ”¯æŒé”™è¯¯ï¼ŒæŒ‡ä½¿ç”¨äº†æ•°æ®åº“ä¸æ”¯æŒçš„å‡½æ•°æˆ–APIç­‰ã€‚ä¾‹å¦‚åœ¨è¿æ¥å¯¹è±¡ä¸Š ä½¿ç”¨.rollback()å‡½æ•°ï¼Œç„¶è€Œæ•°æ®åº“å¹¶ä¸æ”¯æŒäº‹åŠ¡æˆ–è€…äº‹åŠ¡å·²å…³é—­ã€‚ å¿…é¡»æ˜¯DatabaseErrorçš„å­ç±»ã€‚</td></tr></tbody></table><blockquote><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1></blockquote><ul><li>å®‰è£…æ¨¡å— mysql-python</li><li>åŠ è½½æ¨¡å— import MySQLdb</li><li>æ‰“å¼€æ•°æ®åº“è¿æ¥ db = MySQLdb.connect(host,user,password,database))</li><li>ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡äº‹åŠ¡å¼€å§‹ cursor = db.cursor() </li><li>æ‰§è¡ŒSQLè¯­å¥ cursor.execute(sql)</li><li>å‘æ•°æ®åº“æäº¤ db.commit()</li><li>å‘ç”Ÿé”™è¯¯æ—¶å›æ»š db.rollback()</li><li>å…³é—­è¿æ¥ db.close()</li></ul><h4 id="PHPmyAdminåœ¨çº¿å·¥å…·ä½¿ç”¨"><a href="#PHPmyAdminåœ¨çº¿å·¥å…·ä½¿ç”¨" class="headerlink" title="PHPmyAdminåœ¨çº¿å·¥å…·ä½¿ç”¨"></a>PHPmyAdminåœ¨çº¿å·¥å…·ä½¿ç”¨</h4><p>PHPMYADMIN æ˜¯ä¸€ä¸ªä½¿ç”¨ PHP è¯­è¨€ç¼–å†™çš„,ä½¿ç”¨ web ç®¡ç† MYSQL çš„ç»„ä»¶ã€‚ä¸¥æ ¼æ„ä¹‰ä¸Šè¯´,å®ƒä¹Ÿæ˜¯ä¸€ç§ MYSQL çš„å®¢æˆ·ç«¯ã€‚æœ€è¿‘ä¸€æ®µæ—¶é—´,å‡ºç°çš„å¾ˆå¤šä¾é ç½‘ç«™è¿æ¥ MYSQL è¿›è¡Œç®¡ç†çš„äº§å“,åœ¨è¿™äº›â€œWEB GUIâ€ä¸­,PHPMYADMIN æ˜¯ä½¿ç”¨èŒƒå›´æœ€ä¸ºå¹¿æ³›çš„,åŒæ—¶ä¹Ÿå—åˆ°å¾ˆå¤š MYSQL æ•°æ®åº“ç®¡ç†å‘˜çš„å¥½è¯„ã€‚é€šè¿‡å®ƒ,ä½ å¯ä»¥éå¸¸è½»æ¾,éå¸¸æ–¹ä¾¿çš„ç®¡ç† MYSQL æ•°æ®åº“</p><ul><li>è·å– PHPMYADMIN</li></ul><p>ä½ å¯ä»¥åˆ° PHPMYADMIN çš„å®˜æ–¹ç½‘ç«™ <a href="http://www.phpmyadmin.net" target="_blank" rel="noopener">http://www.phpmyadmin.net</a> ä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬ã€‚</p><ul><li>å®‰è£… PHPMYADMIN</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">1.yum install -y httpd php php-mysql mariadb-server php-mbstring</span><br><span class="line">ftp://rpmfind.net/linux/centos/7.2.1511/os/x86_64/Packages/php-mbstring-5.4.16-36.el7_1.x86_64.rpm</span><br><span class="line"></span><br><span class="line">2.systemctl start httpd</span><br><span class="line">3.systemctl start mariadb</span><br><span class="line">4.mysqladmin -uroot password uplooking</span><br><span class="line">5.mysql -uroot -puplooking</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">create database phpmyadmin</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">grant all on phpmyadmin.* to php@localhost identified by <span class="string">'uplooking'</span>;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">flush privileges;</span></span><br><span class="line"></span><br><span class="line">6.echo hi &gt; /var/www/html/index.html</span><br><span class="line">æµ‹è¯•ä¸€ä¸‹webæœåŠ¡æ˜¯å¦æˆåŠŸ</span><br><span class="line"></span><br><span class="line">7.tar jxf /mnt/courses/db100/rhel7.2/materials/phpMyAdmin-4.4.15.5-all-languages.tar.bz2 -C /var/www/html</span><br><span class="line">8.chmod -R 755 html</span><br><span class="line">9.mv config.sample.inc.php config.sample.inc;vim config.inc.php</span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'blowfish_secret'</span>] = <span class="string">''</span>; /* YOU MUST FILL IN THIS FOR COOKIE AUTH! */</span></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * Servers configuration</span><br><span class="line"> */</span><br><span class="line"><span class="meta">$</span><span class="bash">i = 0;</span></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * First server</span><br><span class="line"> */</span><br><span class="line"><span class="meta">$</span><span class="bash">i++;</span></span><br><span class="line">/* Authentication type */</span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'user'</span>]          = <span class="string">'root'</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'password'</span>]      = <span class="string">'uplooking'</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'auth_type'</span>] = <span class="string">'config'</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">10.vim /etc/httpd/conf/httpd.conf</span><br><span class="line">&lt;IfModule dir_module&gt;</span><br><span class="line">    DirectoryIndex index.html index.php</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">11.systemctl restart httpd</span><br><span class="line">ä»æµè§ˆå™¨è¾“å…¥172.25.0.10</span><br></pre></td></tr></table></figure><p>é»˜è®¤å®‰è£…phpMyAdminï¼Œé€šå¸¸åªèƒ½è¿ä¸€å°MySqlæœåŠ¡å™¨ï¼Œå…¶é…ç½®ä¿¡æ¯æ˜¯ä¿å­˜åœ¨phpMyAdminçš„é…ç½®æ–‡ä»¶é‡Œçš„ï¼Œå½“æˆ‘ä»¬éœ€è¦åœ¨å¤šå°æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œåˆ‡æ¢ç™»é™†çš„æ—¶å€™ï¼Œä¿®æ”¹èµ·æ¥éå¸¸éº»çƒ¦ã€‚éµç…§ä¸‹é¢çš„é…ç½®æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨phpMyAdminè¿æ¥å¤šå°MySQLã€‚</p><p>ç™»é™†phpMyAdminæ—¶åªéœ€è¾“å…¥ç”¨æˆ·åã€å¯†ç ï¼ŒæœåŠ¡å™¨åœ°å€ä¸ºä¸‹æ‹‰åˆ—è¡¨å¯é€‰ï¼Œç™»é™†åä¹Ÿå¯é€‰æ‹©å…¶ä»–æœåŠ¡å™¨å¿«é€Ÿåˆ‡æ¢ã€‚ ï¼ˆæ¨èï¼‰</p><p>ä¼˜ç‚¹ï¼šç™»é™†æ“ä½œç®€ä¾¿ï¼Œç™»é™†ååˆ‡æ¢æœåŠ¡å™¨æ— é¡»é€€å‡ºå½“å‰è¿æ¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">hosts = array(</span></span><br><span class="line">'1'=&gt;array('host'=&gt;'localhost','user'=&gt;'root','password'=&gt;'uplooking'),</span><br><span class="line">'2'=&gt;array('host'=&gt;'172.25.0.11','user'=&gt;'root','password'=&gt;'uplooking')</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">for ($i=1;$i&lt;=count($hosts);$i++)&#123;</span><br><span class="line"></span><br><span class="line">/* Authentication type */</span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'user'</span>]          = <span class="variable">$hosts</span>[<span class="variable">$i</span>][<span class="string">'user'</span>];</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'password'</span>]      = <span class="variable">$hosts</span>[<span class="variable">$i</span>][<span class="string">'password'</span>];</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'auth_type'</span>] = <span class="string">'config'</span>;</span></span><br><span class="line">/* Server parameters */</span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'host'</span>] = <span class="variable">$hosts</span>[<span class="variable">$i</span>][<span class="string">'host'</span>];</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'connect_type'</span>] = <span class="string">'tcp'</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'compress'</span>] = <span class="literal">false</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'AllowNoPassword'</span>] = <span class="literal">false</span>;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="pic/15-phpmyadmin.png" alt="phpmyadmin1"></p><h4 id="MySQL-Workbench-è¿æ¥æ•°æ®åº“"><a href="#MySQL-Workbench-è¿æ¥æ•°æ®åº“" class="headerlink" title="MySQL Workbench è¿æ¥æ•°æ®åº“"></a>MySQL Workbench è¿æ¥æ•°æ®åº“</h4><p>MySQL Workbench æ˜¯ä¸€æ¬¾ä¸“é—¨ä¸ºç”¨æˆ·æä¾›äº†ç”¨äºåˆ›å»ºã€ä¿®æ”¹ã€æ‰§è¡Œå’Œä¼˜åŒ–SQLçš„å¯è§†åŒ–å·¥å…·ï¼Œå¼€å‘äººå‘˜å¯ä»¥å¾ˆè½»æ¾çš„ç®¡ç†æ•°æ•°æ®ã€‚è¯¥å·¥å…·å¹¶ä¸”æä¾›å¼€å‘è€…ä¸€æ•´å¥—å¯è§†åŒ–ç”¨äºåˆ›å»ºã€ç¼–è¾‘å’Œç®¡ç†SQL æŸ¥è¯¢å’Œç®¡ç†æ•°æ®åº“è¿æ¥ã€‚åœ¨å¯è§†åŒ–SQLç¼–è¾‘å·¥ä½œæ¨¡å¼ä¸‹ï¼Œç”¨æˆ·åˆ›å»ºè¡¨ï¼Œåˆ é™¤è¡¨ï¼Œä¿®æ”¹è¡¨ä¿¡æ¯ç­‰åªéœ€è¦ä½¿ç”¨ç®€å•çš„å¯ç¼–è¾‘åˆ—è¡¨ä¸­å®Œæˆã€‚</p><p>ç”¨æˆ·é€šå¸¸è®¤ä¸ºMySQL Workbench æ˜¯ä¸€ä¸ªMySQL æ•°æ®åº“ERæ¨¡å‹è®¾è®¡çš„å·¥å…·ï¼Œå¯ä»¥è¯´æ˜¯ä¸“é—¨ä¸ºMySQLæ•°æ®åº“æä¾›çš„æ•°æ®åº“è®¾è®¡å·¥å…·ï¼Œç”¨æˆ·ä½¿ç”¨MySQL Workbenchå¯ä»¥å¾ˆå®¹æ˜“çš„è®¾è®¡ã€ç¼–è¾‘æ•°æ®åº“ERæ¨¡å‹ã€‚è¿™ä¸€åŠŸèƒ½å¯ä»¥è¯´æ˜¯MySQL Workbenchçš„ä¸€å¤§äº®ç‚¹ã€‚</p><blockquote><p>è½¯ä»¶è·å–</p></blockquote><p><a href="https://dev.mysql.com/downloads/workbench/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/workbench/</a></p><blockquote><p>è½¯ä»¶å®‰è£…</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@workstation software]# pwd</span><br><span class="line">/software</span><br><span class="line">[root@workstation software]# ls mysql-workbench-community-6.3.8-1.el7.x86_64.rpm mysql-workbench-community-6.3.8-1.el7.x86_64.rpm</span><br><span class="line">[root@workstation software]# rpm -ivh mysql-workbench-community-6.3.8-1.el7.x86_64.rpm </span><br><span class="line">warning: mysql-workbench-community-6.3.8-1.el7.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY</span><br><span class="line">error: Failed dependencies:</span><br><span class="line">tinyxml is needed by mysql-workbench-community-6.3.8-1.el7.x86_64</span><br><span class="line">libzip is needed by mysql-workbench-community-6.3.8-1.el7.x86_64</span><br><span class="line">python-paramiko &gt;= 1.15.1 is needed by mysql-workbench-community-6.3.8-1.el7.x86_64</span><br><span class="line">proj is needed by mysql-workbench-community-6.3.8-1.el7.x86_64</span><br><span class="line">libodbc.so.2()(64bit) is needed by mysql-workbench-community-6.3.8-1.el7.x86_64</span><br><span class="line">libodbcinst.so.2()(64bit) is needed by mysql-workbench-community-6.3.8-1.el7.x86_64</span><br></pre></td></tr></table></figure><p>éœ€è¦ä¸€äº›ä¾èµ–å…³ç³»åŒ…ï¼Œå…¶ä¸­unixODBCå’Œlibzipæœ¬åœ°yumä¸­æœ‰ï¼Œè€Œtinyxml\python-paramiko\projéœ€è¦ä¸‹è½½</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@workstation workbench]# ls</span><br><span class="line">libtomcrypt-1.17-23.el7.x86_64.rpm        mysql-workbench-community-6.3.8-1.el7.x86_64.rpm</span><br><span class="line">libtomcrypt-devel-1.17-23.el7.x86_64.rpm  proj-4.8.0-4.el7.x86_64.rpm</span><br><span class="line">libtomcrypt-doc-1.17-23.el7.noarch.rpm    python2-crypto-2.6.1-13.el7.x86_64.rpm</span><br><span class="line">libtommath-0.42.0-4.el7.x86_64.rpm        python2-ecdsa-0.13-4.el7.noarch.rpm</span><br><span class="line">libtommath-devel-0.42.0-4.el7.x86_64.rpm  python2-paramiko-1.16.1-1.el7.noarch.rpm</span><br><span class="line">libtommath-doc-0.42.0-4.el7.noarch.rpm    tinyxml-2.6.2-3.el7.x86_64.rpm</span><br><span class="line">[root@workstation workbench]# rpm -ivh libtommath* libtomcrypt* python2-crypto* python2-ecdsa* python2-paramiko* tinyxml* proj* </span><br><span class="line">Preparing...                          ################################# [100%]</span><br><span class="line">package libtommath-0.42.0-4.el7.x86_64 is already installed</span><br><span class="line">package libtomcrypt-1.17-23.el7.x86_64 is already installed</span><br><span class="line">package python2-crypto-2.6.1-13.el7.x86_64 is already installed</span><br><span class="line">package python2-ecdsa-0.13-4.el7.noarch is already installed</span><br><span class="line">package python2-paramiko-1.16.1-1.el7.noarch is already installed</span><br><span class="line">package libtomcrypt-devel-1.17-23.el7.x86_64 is already installed</span><br><span class="line">package libtommath-devel-0.42.0-4.el7.x86_64 is already installed</span><br><span class="line">package proj-4.8.0-4.el7.x86_64 is already installed</span><br><span class="line">package tinyxml-2.6.2-3.el7.x86_64 is already installed</span><br><span class="line">package libtomcrypt-doc-1.17-23.el7.noarch is already installed</span><br><span class="line">package libtommath-doc-0.42.0-4.el7.noarch is already installed</span><br><span class="line">[root@workstation workbench]# yum install -y unixODBC libzip</span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Package unixODBC-2.3.1-11.el7.x86_64 already installed and latest version</span><br><span class="line">Package libzip-0.10.1-8.el7.x86_64 already installed and latest version</span><br><span class="line">Nothing to do</span><br><span class="line">[root@workstation workbench]# rpm -ivh mysql-workbench-community-6.3.8-1.el7.x86_64.rpm </span><br><span class="line">warning: mysql-workbench-community-6.3.8-1.el7.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY</span><br><span class="line">Preparing...                          ################################# [100%]</span><br><span class="line">Updating / installing...</span><br><span class="line">   1:mysql-workbench-community-6.3.8-1################################# [100%]</span><br><span class="line">[root@workstation workbench]# </span><br><span class="line">[root@workstation workbench]# rpm -ql mysql-workbench-community |head </span><br><span class="line">/usr/bin/mysql-workbench</span><br><span class="line">/usr/bin/wbcopytables</span><br><span class="line">/usr/lib64/mysql-workbench</span><br><span class="line">/usr/lib64/mysql-workbench/libantlr3c_wb.so</span><br><span class="line">/usr/lib64/mysql-workbench/libcdbc.so</span><br><span class="line">/usr/lib64/mysql-workbench/libcdbc.so.6.3.8</span><br><span class="line">/usr/lib64/mysql-workbench/libctemplate.so</span><br><span class="line">/usr/lib64/mysql-workbench/libctemplate.so.3</span><br><span class="line">/usr/lib64/mysql-workbench/libctemplate.so.3.0.0</span><br><span class="line">/usr/lib64/mysql-workbench/libgdal.so.1</span><br></pre></td></tr></table></figure><blockquote><h1 id="SQL-Developmentçš„åŸºæœ¬æ“ä½œ"><a href="#SQL-Developmentçš„åŸºæœ¬æ“ä½œ" class="headerlink" title="SQL Developmentçš„åŸºæœ¬æ“ä½œ"></a>SQL Developmentçš„åŸºæœ¬æ“ä½œ</h1></blockquote><ul><li>åˆ›å»ºæ•°æ®åº“è¿æ¥</li><li>åˆ›å»ºæ–°çš„æ•°æ®åº“</li><li>åˆ›å»ºå’Œåˆ é™¤æ–°çš„æ•°æ®è¡¨</li><li>æ·»åŠ ã€ä¿®æ”¹è¡¨è®°å½•</li><li>æŸ¥è¯¢è¡¨è®°å½•</li><li>ä¿®æ”¹è¡¨ç»“æ„</li></ul><blockquote><p>å¯åŠ¨MySQL Workbench</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@workstation ~]# mysql-workbench</span><br></pre></td></tr></table></figure><p><img src="pic/33.png" alt="workbench"></p><blockquote><p>MySQL Workbenchå·¥ä½œç©ºé—´ä¸‹å¯¹æ•°æ®åº“æ•°æ®è¿›è¡Œç®¡ç†ä¹‹å‰ï¼Œéœ€è¦å…ˆåˆ›å»ºæ•°æ®åº“è¿æ¥</p></blockquote><p>å»ºç«‹è¿æ¥å‰ï¼Œéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šç»™MySQL Workbenchæˆæƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@mastera ~]# systemctl start mariadb</span><br><span class="line">[root@mastera ~]# systemctl stop firewalld</span><br><span class="line">[root@mastera ~]# mysql</span><br><span class="line">ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)</span><br><span class="line">[root@mastera ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 3</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; grant all on *.* to root@'172.25.0.10' identified by 'uplooking';</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure><p><img src="pic/34.png" alt="workbench"></p><blockquote><p>æˆåŠŸåˆ›å»ºæ•°æ®åº“è¿æ¥åï¼Œå¯ä»¥åˆ›å»ºæ–°çš„æ•°æ®åº“ã€‚</p></blockquote><p><img src="pic/35.png" alt="workbench"></p><p><img src="pic/36.png" alt="workbench"></p><p><img src="pic/37.png" alt="workbench"></p><p><img src="pic/38.png" alt="workbench"></p><blockquote><p>æˆåŠŸåˆ›å»ºæ•°æ®åº“è¿æ¥åï¼Œåœ¨å·¦ä¾§çš„SCHEMASä¸‹é¢å¯ä»¥çœ‹åˆ°testæ•°æ®åº“ã€‚ç”¨æˆ·å¯ä»¥åˆ›å»ºæ–°çš„æ•°æ®åº“ï¼Œæœ¬å°èŠ‚ä¸»è¦åˆ›å»ºå’Œåˆ é™¤æ–°çš„æ•°æ®è¡¨æ“ä½œã€‚</p></blockquote><p><img src="pic/39.png" alt="workbench"></p><p><img src="pic/40.png" alt="workbench"></p><p><img src="pic/41.png" alt="workbench"></p><p><img src="pic/42.png" alt="workbench"></p><p>ä¸‹é¢ç®€å•ä»‹ç»MySQL Workbenchåœ¨å›¾å½¢ç•Œé¢ä¸‹å¯¹æ•°æ®åº“è¡¨çš„ç»´æŠ¤æ“ä½œã€‚</p><blockquote><p>æŸ¥è¯¢t1è¡¨ä¸­çš„æ•°æ®æ“ä½œã€‚</p></blockquote><p><img src="pic/43.png" alt="workbench"></p><blockquote><p>ä½¿ç”¨WorkBenchæ“ä½œå¯ä»¥ä¿®æ”¹è¡¨çš„ç»“æ„ã€‚</p></blockquote><p><img src="pic/44.png" alt="workbench"></p><p><img src="pic/45.png" alt="workbench"></p><p><img src="pic/46.png" alt="workbench"></p><blockquote><h1 id="Data-Modelingçš„åŸºæœ¬æ“ä½œ"><a href="#Data-Modelingçš„åŸºæœ¬æ“ä½œ" class="headerlink" title="Data Modelingçš„åŸºæœ¬æ“ä½œ"></a>Data Modelingçš„åŸºæœ¬æ“ä½œ</h1></blockquote><ul><li>å»ºç«‹ERæ¨¡å‹</li><li>å¯¼å…¥ERæ¨¡å‹</li></ul><p><img src="pic/47.png" alt="workbench"></p><p><img src="pic/48.png" alt="workbench"></p><p><img src="pic/49.png" alt="workbench"></p><p><img src="pic/50.png" alt="workbench"></p><p>æœ€å æ‰§è¡Œ â€œFileâ€-&gt;â€Exportâ€ æŒ‰é’®ï¼Œé€‰æ‹© Forward Engineer SQL CREATE Script (ctrl+shift+G). è¿™æ ·å°±å¯ä»¥æŠŠæ¨¡å‹å¯¼å‡ºä¸ºSQLè„šæœ¬æ–‡ä»¶ã€‚ç°åœ¨æ‰§è¡Œè¿™ä¸ªSQLæ–‡ä»¶å°±OKäº†ã€‚</p><blockquote><h1 id="Server-Administrationçš„åŸºæœ¬æ“ä½œ"><a href="#Server-Administrationçš„åŸºæœ¬æ“ä½œ" class="headerlink" title="Server Administrationçš„åŸºæœ¬æ“ä½œ"></a>Server Administrationçš„åŸºæœ¬æ“ä½œ</h1></blockquote><ul><li>ç®¡ç†MySQLç”¨æˆ·</li><li>å¤‡ä»½MySQLæ•°æ®åº“</li><li>è¿˜åŸMySQLæ•°æ®åº“</li></ul><blockquote><p>ç®¡ç†MySQLç”¨æˆ·</p></blockquote><p><img src="pic/51.png" alt="workbench"></p><blockquote><p>å¤‡ä»½MySQLæ•°æ®åº“</p></blockquote><p><img src="pic/52.png" alt="workbench"></p><p><img src="pic/53.png" alt="workbench"></p><p>æ”¹å¤‡ä»½ä¸ºé€»è¾‘å¤‡ä»½ï¼Œä½¿ç”¨çš„æ˜¯mysqldumpå‘½ä»¤è¿›è¡Œçš„ï¼Œå¤‡ä»½æ•°æ®å­˜æ”¾å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@workstation ~]# ls /root/dumps/Dump20170207/</span><br><span class="line">db1_t1.sql  db1_t2.sql</span><br></pre></td></tr></table></figure><blockquote><p>è¿˜åŸMySQLæ•°æ®åº“</p></blockquote><p>å°†db1åº“ä¸­çš„t1å’Œt2è¡¨åˆ é™¤ï¼Œè¿›è¡Œè¿˜åŸ</p><p><img src="pic/54.png" alt="workbench"></p><p><img src="pic/55.png" alt="workbench"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ&quot;&gt;&lt;/a&gt;æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æ•°æ®åº“(database)&lt;/strong&gt;:  ä¿å­˜æœ‰ç»„ç»‡çš„æ•°æ®çš„å®¹å™¨(é€š
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯åŸ¹è®­" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%9F%B9%E8%AE%AD/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="åŸ¹è®­" scheme="http://www.toberoot.com/tags/%E5%9F%B9%E8%AE%AD/"/>
    
      <category term="MySQLåŸºç¡€ç®¡ç†" scheme="http://www.toberoot.com/tags/MySQL%E5%9F%BA%E7%A1%80%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
</feed>
