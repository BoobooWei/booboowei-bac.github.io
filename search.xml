<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hello World</title>
    <url>/2020/03/22/booboo_others/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯å¹¿è§’</category>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS6.5é…ç½®python3.7å®‰è£…åsslé—®é¢˜</title>
    <url>/2020/03/22/booboo_others/CentOS6.5%E9%85%8D%E7%BD%AEpython3.7%E5%AE%89%E8%A3%85%E5%90%8Essl%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="æŠ¥é”™æ˜ç»†"><a href="#æŠ¥é”™æ˜ç»†" class="headerlink" title="æŠ¥é”™æ˜ç»†"></a>æŠ¥é”™æ˜ç»†</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip is configured with locations that require TLS/SSL, however the ssl module <span class="keyword">in</span> Python is not available.</span><br></pre></td></tr></table></figure>

<h2 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h2><p>ç”±äºAIAç³»ç»Ÿæ˜¯CentOS release 6.7ï¼Œæ‰€æœ‰opensslçš„ç‰ˆæœ¬ä¸º OpenSSL 1.0.1e ,è€Œpython3.7éœ€è¦çš„opensslçš„ç‰ˆæœ¬ä¸º 1.0.2 æˆ–è€… 1.1.x,éœ€è¦å¯¹opensslè¿›è¡Œå‡çº§ï¼Œå¹¶é‡æ–°ç¼–è¯‘python3.7.0</p>
<h2 id="è¯¦ç»†è®°å½•"><a href="#è¯¦ç»†è®°å½•" class="headerlink" title="è¯¦ç»†è®°å½•"></a>è¯¦ç»†è®°å½•</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@CNACLQLJMP010 install]<span class="comment"># rpm -qa|grep openssl</span></span><br><span class="line">openssl-devel-1.0.1e-58.el6_10.x86_64</span><br><span class="line">openssl-1.0.1e-58.el6_10.x86_64</span><br><span class="line">openssl-static-1.0.1e-58.el6_10.x86_64</span><br><span class="line">[root@CNACLQLJMP010 install]<span class="comment"># openssl version</span></span><br><span class="line">OpenSSL 1.0.1e-fips 11 Feb 2013</span><br><span class="line"></span><br><span class="line">wget https://www.openssl.org/<span class="built_in">source</span>/openssl-1.1.1-pre8.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openssl-1.1.1-pre8</span><br><span class="line">./config --prefix=/usr/<span class="built_in">local</span>/openssl no-zlib <span class="comment">#ä¸éœ€è¦zlib</span></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">mv /usr/bin/openssl /usr/bin/openssl.bak</span><br><span class="line">mv /usr/include/openssl/ /usr/include/openssl.bak</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/openssl/include/openssl /usr/include/openssl</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/openssl/lib/libssl.so.1.1 /usr/<span class="built_in">local</span>/lib64/libssl.so</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/openssl/bin/openssl /usr/bin/openssl</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"/usr/local/openssl/lib"</span> &gt;&gt; /etc/ld.so.conf</span><br><span class="line">ldconfig -v</span><br><span class="line"></span><br><span class="line">openssl version</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯å¹¿è§’</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>å›½åº†å‰å­¦æ´—æ‰‹</title>
    <url>/2018/09/30/amy_life/%E5%9B%BD%E5%BA%86%E5%89%8D%E5%AD%A6%E6%B4%97%E6%89%8B/</url>
    <content><![CDATA[<p>ä»Šå¤©äººå°‘ï¼Œæˆ‘ä»¬åå°æœˆäº®ï¼Œç„¶åç»™ä»–ä»¬æ¯äººç”¨äº†å…æ´—æ´—æ‰‹æ¶²ï¼Œæ´—å°æ‰‹ï¼Œå›½åº†èŠ‚å‡ºå»ä¸è¦å¿˜è®°å¸¦å“¦</p>
<a id="more"></a>

<p align="center"><embed src='http://player.youku.com/player.php/sid/XMzg0Mzk0NDI5Ng==/v.swf' allowFullScreen='true' quality='high' width='480' height='400' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'></embed></p>

<p><img src="%E5%9B%BD%E5%BA%86%E5%89%8D%E5%AD%A6%E6%B4%97%E6%89%8B/01.jpg" alt=""></p>
<p>å›å›è€å¸ˆ:<br>ä»–ä»¬è®©æˆ‘å‘ç»™ä½ ä»¬ğŸ˜‚</p>
<p>å°æ…ˆçš„æ™šæ‰˜ç­åˆ¶ä½œäº”æ˜Ÿçº¢æ——</p>
<p align="center"><embed src='http://player.youku.com/player.php/sid/XMzg0Mzk0OTg4MA==/v.swf' allowFullScreen='true' quality='high' width='480' height='400' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'></embed></p>]]></content>
      <categories>
        <category>å¾€æ˜”è¿½å¿†</category>
        <category>å°äºŒç­</category>
      </categories>
      <tags>
        <tag>å®å®æˆé•¿</tag>
      </tags>
  </entry>
  <entry>
    <title>å®å®ä»¬ä¸Šç­å•¦</title>
    <url>/2018/09/29/amy_life/%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/</url>
    <content><![CDATA[<p>å›å›è€å¸ˆ:<br>æœ€è¿‘æˆ‘ä»¬å­©å­çš„è§’è‰²æ¸¸æˆæ…¢æ…¢è¿›å…¥çŠ¶æ€äº†ï¼Œä½†ä¹Ÿæœ‰å‡ ä¸ªå­©å­æ²‰è¿·äºç§¯æœ¨æ¸¸æˆæ— æ³•è‡ªæ‹”ï¼Œæˆ‘ä»¬å¸Œæœ›å®¶é•¿ä»¬åœ¨å®¶é‡Œä¹Ÿå¯ä»¥å’Œå­©å­ä»¬ä¸€èµ·ç©è§’è‰²æ‰®æ¼”æ¸¸æˆï¼Œå’Œå­©å­å¤šäº’åŠ¨ï¼Œä¹Ÿå¯ä»¥æ‹“å®½æ€è·¯ï¼Œå¯ä»¥åšç°å®ç”Ÿæ´»ä¸­ä¸èƒ½åšçš„ï¼Œæ¯”å¦‚ä»™å¥³å•Šï¼Œå…¬ä¸»å•Šï¼Œå°å£«å…µç­‰ç­‰</p>
<a id="more"></a>

<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/01.jpg" alt=""></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/02.jpg" alt="02"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/03.jpg" alt="03"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/04.jpg" alt="04"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/05.jpg" alt="05"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/06.jpg" alt="06"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/07.jpg" alt="07"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/08.jpg" alt="08"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/09.jpg" alt="09"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/10.jpg" alt="10"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/11.jpg" alt="11"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/12.jpg" alt="12"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/13.jpg" alt="13"></p>
<p>å›å›è€å¸ˆ:<br>ä»Šå¤©æˆ‘ä»¬è¿˜è®¤è¯†äº†äº”æ˜Ÿçº¢æ——ï¼ŒçŸ¥é“è‡ªå·±æ˜¯ä¸€ä¸ªä¸­å›½äººï¼Œæˆ‘å‘Šè¯‰ä»–ä»¬è¿‡å‡ å¤©è¦ç»™ç¥–å›½å¦ˆå¦ˆè¿‡ç”Ÿæ—¥äº†ï¼Œè¦ä¼‘æ¯ä¸ƒå¤©ï¼Œæœ‰å­©å­è¿˜åé©³è¯´ä¸è¡Œï¼Œä¼‘æ¯ä¸‰å¤©å°±å¤Ÿäº†ï¼Œå“ˆå“ˆæˆ‘è¿˜å‘Šè¯‰ä»–ä»¬ç¥–å›½å¦ˆå¦ˆä¼šè¯·ä»–ä»¬åƒç”Ÿæ—¥è›‹ç³•çš„</p>
<p>åˆé¤å‰è¿˜é¢å¤–å­¦äº†ä¸€é¦–æ­Œï¼Œé€ç»™æˆ‘ä»¬çš„ç¥–å›½å¦ˆå¦ˆ</p>
<p><a href="https://music.163.com/#/song?id=498555737&market=baiduqk" target="_blank" rel="noopener">å„¿æ­Œ-ç¥–å›½ç¥–å›½æˆ‘çˆ±ä½ </a></p>
]]></content>
      <categories>
        <category>å¾€æ˜”è¿½å¿†</category>
        <category>å°äºŒç­</category>
      </categories>
      <tags>
        <tag>å®å®æˆé•¿</tag>
      </tags>
  </entry>
  <entry>
    <title>æœˆé¥¼çƒ˜åŸ¹å’Œå°å°æ¬è¿å·¥</title>
    <url>/2018/09/21/amy_life/%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/</url>
    <content><![CDATA[<p>ä¸­ç§‹èŠ‚å¿«åˆ°äº†ï¼Œè€å¸ˆå¸¦å®å®ä»¬ä¸€èµ·åšäº†æœˆé¥¼ï¼Œæ‹¿å»çƒ¤äº†ï¼Œå®å®ä»¬è¿˜å¸®è€å¸ˆä¸€èµ·æ¬æ¡Œå­ï¼Œè™½ç„¶ç»“å±€å·®å¼ºäººæ„ï¼Œä½†æ˜¯å­©å­ä»¬éƒ½å¾ˆå¼€å¿ƒå‘¢ï¼</p>
<a id="more"></a>

<p align="center"><embed src='http://player.youku.com/player.php/sid/XMzg0Mzk0NDg5Ng==/v.swf' allowFullScreen='true' quality='high' width='480' height='400' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'></embed></p>

<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/01.jpg" alt=""></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/02.jpg" alt="02"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/03.jpg" alt="03"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/04.jpg" alt="04"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/05.jpg" alt="05"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/06.jpg" alt="06"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/07.jpg" alt="07"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/08.jpg" alt="08"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/09.jpg" alt="09"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/20.jpg" alt="20"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/00.png" alt=""></p>
]]></content>
      <categories>
        <category>å¾€æ˜”è¿½å¿†</category>
        <category>å°äºŒç­</category>
      </categories>
      <tags>
        <tag>å®å®æˆé•¿</tag>
      </tags>
  </entry>
  <entry>
    <title>å®å®ä»¬å¼€å§‹æ¼±å£äº†</title>
    <url>/2018/09/20/amy_life/%E5%AE%9D%E5%AE%9D%E4%BB%AC%E5%BC%80%E5%A7%8B%E6%BC%B1%E5%8F%A3%E4%BA%86/</url>
    <content><![CDATA[<p>æ‘˜è¦ï¼šä»Šå¤©å¼€å§‹æˆ‘ä»¬è®©å®å®ä»¬å¼€å§‹æ¼±å£äº†ï¼Œæ‰€ä»¥å›å®¶ä¹Ÿè¦ç»§ç»­ä¿æŒè¿™ä¸ªå¥½ä¹ æƒ¯å“¦ï½</p>
<a id="more"></a>


<p>å›å›è€å¸ˆè¯­å½•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">å„ä½äº²ä»¬ï¼Œé€šè¿‡æ˜¨å¤©çš„å®¶é•¿ä¼šï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å®¶é•¿å›å»çš„åŠªåŠ›ï¼Œä»Šå¤©åˆé¥­æ˜æ˜¾è¿›æ­¥çš„å®å®æœ‰ï¼š@å¼ ç‘¾å®‰å¦ˆå¦ˆâ€…@æ“æ¢“æ¡å¦ˆå¦ˆâ€…@ä½†é¢å®¸å¦ˆå¦ˆâ€…@ä½•æ™Ÿç¿å¦ˆå¦ˆâ€…@å¼ æ¬è§…å¦ˆå¦ˆâ€…@ä¸¥é­æ…ˆå¦ˆå¦ˆâ€…@ç‹æ™Ÿå®å¦ˆå¦ˆâ€…ï¼Œå…¶ä»–å®å®ä»¬ç»§ç»­åŠ æ²¹å“¦ï½</span><br><span class="line"></span><br><span class="line">åƒé¥­æˆ‘ä»¬æ˜¯å’Œå­©å­ä»¬è¯´ï¼šå°æ±½è½¦è£…è£…æ»¡ï¼Œè½¬å¼¯é€åˆ°å±±æ´é‡Œï¼Œæ»‘æ»‘æ¢¯æ»‘åˆ°è‚šå­é‡Œï¼Œå› ä¸ºå¾ˆå¤šå®å®å‹ºå­ä¸å¯¹ç€å˜´å·´ï¼Œæ‰€ä»¥é¥­å®å®æ‰åœ¨æ¡Œå­ä¸Šéƒ½å“­äº†ã€‚</span><br><span class="line"></span><br><span class="line">å¦å¤–ï¼Œä»Šå¤©æˆ‘ä»¬ç»ƒä¹ äº†å®å®ä»¬æ’é˜Ÿèµ°æ¥¼æ¢¯ï¼Œå¤§å¤šæ•°å·²ç»åƒæ¨¡åƒæ ·çš„äº†ï¼Œä¸Šä¸‹æ¥¼æ¢¯é å³èµ°äº†ï¼Œä»Šå¤©çš„è¿åŠ¨é‡æœ‰ç‚¹å¤§ï¼Œæ‰€ä»¥ä¼°è®¡å®è´ä»¬ä»Šæ™šåˆè¦æ—©æ—©ç¡è§‰äº†.</span><br></pre></td></tr></table></figure>



<p>ä»Šå¤©å¼€å§‹æˆ‘ä»¬è®©å®å®ä»¬å¼€å§‹æ¼±å£äº†ï¼Œæ‰€ä»¥å›å®¶ä¹Ÿè¦ç»§ç»­ä¿æŒè¿™ä¸ªå¥½ä¹ æƒ¯å“¦ï½</p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E5%BC%80%E5%A7%8B%E6%BC%B1%E5%8F%A3%E4%BA%86/01.jpg" alt=""></p>
]]></content>
      <categories>
        <category>å¾€æ˜”è¿½å¿†</category>
        <category>å°äºŒç­</category>
      </categories>
      <tags>
        <tag>å®å®æˆé•¿</tag>
      </tags>
  </entry>
  <entry>
    <title>å®¶é•¿ä¼š</title>
    <url>/2018/09/19/amy_life/%E5%AE%B6%E9%95%BF%E4%BC%9A/</url>
    <content><![CDATA[<p>æ‘˜è¦ï¼šå¹¼å„¿å›­å¼€å­¦ç¬¬10å¤©ï¼Œå®å®ä»¬é€æ¸ç¨³å®šï¼Œèå…¥è¿™ä¸ªå¤§å®¶åº­ï¼Œä»Šå¤©è€å¸ˆå’Œæˆ‘ä»¬åˆ†äº«å®å®ä»¬çš„å¹¼å„¿å›­æ—¥å¸¸ç”Ÿæ´»ï¼Œä»¥åŠæˆ‘ä»¬å¯¹æˆ‘ä»¬å®¶é•¿çš„ä¸€äº›å»ºè®®ï¼Œéå¸¸åœ°ç”¨å¿ƒã€‚</p>
<a id="more"></a>

<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/001.jpg" alt=""></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/002.jpg" alt="002"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/003.jpg" alt="003"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/004.jpg" alt="004"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/005.jpg" alt="005"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/006.jpg" alt="006"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/007.jpg" alt="007"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/008.jpg" alt="008"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/010.jpg" alt="010"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/011.jpg" alt="011"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/012.jpg" alt="012"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/013.jpg" alt="013"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/014.jpg" alt="014"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/015.jpg" alt="015"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/016.jpg" alt="016"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/017.jpg" alt="017"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/018.jpg" alt="018"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/019.jpg" alt="019"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/020.jpg" alt="020"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/021.jpg" alt="021"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/022.jpg" alt="022"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/023.jpg" alt="023"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/024.jpg" alt="024"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/025.jpg" alt="025"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/026.jpg" alt="026"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/027.jpg" alt="027"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/028.jpg" alt="028"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/029.jpg" alt="029"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/030.jpg" alt="030"></p>
]]></content>
      <categories>
        <category>å¾€æ˜”è¿½å¿†</category>
        <category>å°äºŒç­</category>
      </categories>
      <tags>
        <tag>å®å®æˆé•¿</tag>
      </tags>
  </entry>
  <entry>
    <title>å‘æœˆäº®è¯´æ™šå®‰</title>
    <url>/2018/09/10/amy_life/%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/</url>
    <content><![CDATA[<p>æ‘˜è¦ï¼šä»Šå¤©ä¸­åˆè®²äº†ä¸€ä¸ªå…³äºã€Œæ™šå®‰ï¼Œæœˆäº®ã€çš„ç¡å‰æ•…äº‹ï¼Œæœ€åçŒ«å¤´é¹°å¯¹æœˆäº®è¯´äº†æ™šå®‰ï¼Œå¤§å®¶ä»Šå¤©ç¡å‰è¿˜å¯ä»¥å’Œå®å®è¯´å“¦ï¼Œå†åŠ ä¸€äº›å…¶ä»–çš„åŠ¨ç‰©å®å®</p>
<a id="more"></a>

<p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/01.jpg" alt=""></p>
<p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/02.jpg" alt="02"></p>
<p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/03.jpg" alt="03"></p>
<p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/04.jpg" alt="04"></p>
<p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/05.jpg" alt="05"></p>
<p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/06.jpg" alt="06"></p>
<p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/07.jpg" alt="07"></p>
]]></content>
      <categories>
        <category>å¾€æ˜”è¿½å¿†</category>
        <category>å°äºŒç­</category>
      </categories>
      <tags>
        <tag>å®å®æˆé•¿</tag>
      </tags>
  </entry>
  <entry>
    <title>çªç ´é˜¿é‡Œé™åˆ¶å®ç°&quot;RDS For MySQL 5.7åˆ°è‡ªå»ºMySQLä¸»ä»&quot;</title>
    <url>/2018/08/22/booboo_others/rds-for-mysql-5-7%E5%88%B0%E8%87%AA%E5%BB%BAMySQL%E4%B8%BB%E4%BB%8E%E4%B9%8B%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3user%E8%A1%A8%E5%AE%9E%E7%8E%B0%E4%BB%8E%E5%BA%93%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E6%9B%B4%E6%94%B9%E5%8A%9F%E8%83%BD/</url>
    <content><![CDATA[<p>æ‘˜è¦: é˜¿é‡Œäº‘çš„RDS For MySQL 5.7 åˆ°çº¿ä¸‹IDCæœºæˆ¿çš„ä¸»ä»æ­å»ºç›¸ä¿¡çœ‹å®˜æ–¹æ–‡æ¡£å°±å¯ä»¥å®Œæˆï¼Œä½†æ˜¯æ­å»ºä¹‹åå´å‘ç°æ— æ³•åœ¨æœ¬åœ°è¿›è¡Œè®¤è¯æƒé™çš„ç®¡ç†ï¼Œè¿™æ˜¯ä¸ºä½•ï¼Ÿè€Œé˜¿é‡Œå®˜æ–¹æ¨èä½¿ç”¨DTSåŒæ­¥å·¥å…·å»å®ç°ï¼Œè¿™ä¸ªè´¹ç”¨ç€å®ä¸å°‘ï¼Œåˆæ˜¯å¦èƒ½å¤Ÿç ´è§£å‘¢ï¼Ÿæœ¬æ–‡è¯¦è§£å¦‚ä½•æš´åŠ›ç ´è§£userè¡¨å®ç°ä»åº“ç”¨æˆ·æƒé™æ›´æ”¹åŠŸèƒ½</p>
<a id="more"></a>

<h1 id="æ•…äº‹èƒŒæ™¯"><a href="#æ•…äº‹èƒŒæ™¯" class="headerlink" title="æ•…äº‹èƒŒæ™¯"></a>æ•…äº‹èƒŒæ™¯</h1><h2 id="æ•°æ®åº“æ˜ç»†"><a href="#æ•°æ®åº“æ˜ç»†" class="headerlink" title="æ•°æ®åº“æ˜ç»†"></a>æ•°æ®åº“æ˜ç»†</h2><p>è¯´åœ¨å‰é¢ï¼š</p>
<ul>
<li>äº‘ä¸Šæ•°æ®åº“ï¼š RDS For MySQL 5.7.20 æ™®é€šç”¨æˆ·æƒé™</li>
<li>IDCæ•°æ®åº“: MySQL 5.7.20 </li>
</ul>
<h2 id="æ•…äº‹æƒ…èŠ‚"><a href="#æ•…äº‹æƒ…èŠ‚" class="headerlink" title="æ•…äº‹æƒ…èŠ‚"></a>æ•…äº‹æƒ…èŠ‚</h2><p>ç°éœ€è¦æ­å»ºRDS For MySQL åˆ°çº¿ä¸‹IDCæœºæˆ¿çš„ä¸»ä»ï¼Œé—®é¢˜å¦‚ä¸‹ï¼š</p>
<h3 id="åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥"><a href="#åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥" class="headerlink" title="åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥"></a>åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥</h3><h4 id="æ•…éšœåŸå› "><a href="#æ•…éšœåŸå› " class="headerlink" title="æ•…éšœåŸå› "></a>æ•…éšœåŸå› </h4><ul>
<li>RDS For MySQL 5.7.20 åˆ°è‡ªå»ºMySQL 5.7.20ä¸»ä»åŒæ­¥å¼‚å¸¸çš„åŸå› ä¸ºRDSä¸MySQLå®˜æ–¹ç‰ˆæœ¬ä½¿ç”¨çš„ç³»ç»Ÿåº“ä¸åŒ</li>
<li>è‡ªå»ºMySQL 5.7.20 æ— æ³•åŒæ­¥ä¸»åº“RDSçš„ç³»ç»Ÿè¡¨</li>
<li>è‡ªå»ºMySQL 5.7.20 æ¢å¤RDSçš„å…¨å¤‡ä»½æ•°æ®åæ— æ³•æ‰§è¡Œæˆæƒè¯­å¥,æŠ¥é”™å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ERROR 1785 (HY000): Statement violates GTID consistency: Updates to non-transactional tables can only be done in either autocommitted statements or single-statement transactions, and never in the same statement as updates to transactional tables.</span><br></pre></td></tr></table></figure>

<ul>
<li>è‡ªå»ºMySQL 5.7.20 æ¢å¤RDSçš„å…¨å¤‡ä»½æ•°æ®åæ— æ³•å¯¹ç³»ç»Ÿè¡¨æ‰§è¡Œæ›´æ–°æ“ä½œï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ERROR 1064 (42000): Unknown trigger has an error in its body: 'Unknown system variable 'maintain_user_list''</span><br></pre></td></tr></table></figure>

<h4 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h4><ul>
<li>è·³è¿‡ç³»ç»Ÿè¡¨çš„åŒæ­¥</li>
</ul>
<hr>
<h3 id="ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥"><a href="#ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥" class="headerlink" title="ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥"></a>ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥</h3><p>RDS For MySQL 5.7.20 åˆ°è‡ªå»ºMySQL 5.7.20 æ­å»ºä¸»ä»åŒæ­¥æ¶æ„:</p>
<ul>
<li>é…ç½®ä»åº“ä¸åŒæ­¥RDSä¸»åº“çš„ç³»ç»Ÿè¡¨</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># skip rep</span><br><span class="line">replicate_wild_ignore_table&#x3D;mysql.%</span><br><span class="line">replicate_wild_ignore_table&#x3D;sys.%</span><br><span class="line">replicate_wild_ignore_table&#x3D;information_schema.%</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>éç³»ç»Ÿåº“æ•°æ®åŒæ­¥æ­£å¸¸</strong></li>
<li>ä»åº“æ— æ³•æ‰§è¡Œgrantå‘½ä»¤ï¼Œå³æ— æ³•æ·»åŠ æˆæƒä¿¡æ¯</li>
<li>ä»åº“æ— æ³•å¯¹ç³»ç»Ÿè¡¨mysql.userè¡¨æ‰§è¡Œinsertæ“ä½œ</li>
<li>ä»åº“æ— æ³•å¯¹ç³»ç»Ÿè¡¨mysql.userè¡¨æ‰§è¡Œupdatæ“ä½œ</li>
</ul>
<p>æŠ¥é”™å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ERROR 1064 (42000): Unknown trigger has an error in its body: 'Unknown system variable 'maintain_user_list''</span><br></pre></td></tr></table></figure>

<h4 id="å¤±è´¥åŸå› "><a href="#å¤±è´¥åŸå› " class="headerlink" title="å¤±è´¥åŸå› "></a>å¤±è´¥åŸå› </h4><p><strong>é˜¿é‡Œå·¥å•ç­”å¤</strong>ï¼šRDS ç›®å‰å·²ç»ä¸æ”¯æŒ MYISAM å¼•æ“åˆ›å»ºäº†ã€‚æ‰€ä»¥å¦‚æœæ˜¯é€šè¿‡è‡ªå»ºçš„replication åŒæ­¥ å°±ä¼šæœ‰è¿™ä¸ªé—®é¢˜çš„ï¼ŒRDS ç»Ÿä¸€INNOB å¼•æ“ã€‚<br>å¦‚æœéœ€æ±‚æ˜¯ä»RDS åˆ°è‡ªå»ºæ•°æ®åº“çš„åŒæ­¥å…³ç³»ï¼Œå»ºè®®æ‚¨ä½¿ç”¨DTS åšä¸šåŠ¡æ•°æ®çš„åŒæ­¥ã€‚</p>
<h4 id="æ¢ç´¢è§£å†³æ–¹æ³•"><a href="#æ¢ç´¢è§£å†³æ–¹æ³•" class="headerlink" title="æ¢ç´¢è§£å†³æ–¹æ³•"></a>æ¢ç´¢è§£å†³æ–¹æ³•</h4><h5 id="ä»åº“å°è¯•ä½¿ç”¨MySQL8-0-11"><a href="#ä»åº“å°è¯•ä½¿ç”¨MySQL8-0-11" class="headerlink" title="ä»åº“å°è¯•ä½¿ç”¨MySQL8.0.11"></a>ä»åº“å°è¯•ä½¿ç”¨<code>MySQL8.0.11</code></h5><p>RDS For MySQL 5.7çš„å¤‡ä»½æ–‡ä»¶ åˆ°çº¿ä¸‹è‡ªå»ºMYSQL 8.0.11 æ— æ³•æ¢å¤æ•°æ®ã€‚å› æ­¤è¯¥æ–¹æ³•ä¸å¯è¡Œã€‚</p>
<h5 id="å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼"><a href="#å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼" class="headerlink" title="å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼"></a>å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼</h5><ol>
<li>ä¸´æ—¶åœæ­¢slaveåŒæ­¥</li>
<li>ä¿®æ”¹é…ç½®å…³é—­gtidæ¨¡å¼</li>
<li>é‡å¯æœåŠ¡</li>
</ol>
<p>å¯¹ç³»ç»Ÿè¡¨mysql.useræµ‹è¯•æ˜ç»†ï¼š</p>
<table>
<thead>
<tr>
<th>No.</th>
<th>æµ‹è¯•é¡¹ç›®</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œgrantå‘½ä»¤</td>
<td>Ã—</td>
</tr>
<tr>
<td>2</td>
<td>æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œupdateå‘½ä»¤</td>
<td>Ã—</td>
</tr>
<tr>
<td>3</td>
<td>æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œinsertå‘½ä»¤</td>
<td>Ã—</td>
</tr>
</tbody></table>
<p>è¯¥æ–¹æ³•åŒæ ·æ— æ³•è§£å†³ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æƒé™ç›¸å…³çš„ä¸€äº›è¡¨ï¼š</span></span><br><span class="line">SCHEMA_PRIVILEGESï¼šæä¾›äº†æ•°æ®åº“çš„ç›¸å…³æƒé™ï¼Œè¿™ä¸ªè¡¨æ˜¯å†…å­˜è¡¨æ˜¯ä»mysql.dbä¸­æ‹‰å»å‡ºæ¥çš„ã€‚</span><br><span class="line">TABLE_PRIVILEGES:æä¾›çš„æ˜¯è¡¨æƒé™ç›¸å…³ä¿¡æ¯ï¼Œä¿¡æ¯æ˜¯ä» mysql.tables_priv è¡¨ä¸­åŠ è½½çš„</span><br><span class="line">COLUMN_PRIVILEGES ï¼šè¿™ä¸ªè¡¨å¯ä»¥æ¸…æ¥šå°±èƒ½çœ‹åˆ°è¡¨æˆæƒçš„ç”¨æˆ·çš„å¯¹è±¡ï¼Œé‚£å¼ è¡¨é‚£ä¸ªåº“ä»¥åŠæˆäºˆçš„æ˜¯ä»€ä¹ˆæƒé™ï¼Œå¦‚æœæˆæƒçš„æ—¶å€™åŠ ä¸Šwith grant optionçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å¾—åˆ°PRIVILEGE_TYPEè¿™ä¸ªå€¼å¿…é¡»æ˜¯YESã€‚</span><br><span class="line">USER_PRIVILEGES:æä¾›çš„æ˜¯è¡¨æƒé™ç›¸å…³ä¿¡æ¯ï¼Œä¿¡æ¯æ˜¯ä» mysql.user è¡¨ä¸­åŠ è½½çš„</span><br><span class="line">é€šè¿‡è¡¨æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ™°çœ‹å¾—åˆ°MySQLæˆæƒçš„å±‚æ¬¡ï¼ŒSCHEMAï¼ŒTABLEï¼ŒCOLUMNçº§åˆ«ï¼Œå½“ç„¶è¿™äº›éƒ½æ˜¯åŸºäºç”¨æˆ·æ¥æˆäºˆçš„</span><br></pre></td></tr></table></figure>

<p>ä»æ•°æ®åº“ç”¨æˆ·æƒé™ç®¡ç†çš„åŸç†å¯ä»¥äº†è§£åˆ°ç®¡ç†ç”¨æˆ·çš„æ˜¯<code>user</code>è¡¨ï¼Œå¦‚æœè¦æ›´ç»†è‡´çš„æƒé™è¿˜éœ€è¦<code>db</code>è¡¨å’Œ<code>tables_priv</code>è¡¨ã€‚<em>ï¼ˆæœ¬æ–‡åªä»userè¡¨ç€æ‰‹ï¼‰</em></p>
<h3 id="æ­¥éª¤æ¦‚è§ˆ"><a href="#æ­¥éª¤æ¦‚è§ˆ" class="headerlink" title="æ­¥éª¤æ¦‚è§ˆ"></a>æ­¥éª¤æ¦‚è§ˆ</h3><ol>
<li>åˆ›å»ºæ–°çš„user_1è¡¨</li>
<li>å¯¹user_1è¡¨æ·»åŠ æ–°çš„ç”¨æˆ·</li>
<li>åœæœåŠ¡</li>
<li>å°†user_1æ›¿æ¢userè¡¨</li>
<li>å¯åŠ¨è¯¥æœåŠ¡</li>
<li>å¯ä»¥é€šè¿‡updateã€insertã€deleteæ“ä½œuserè¡¨æ¥æ·»åŠ æƒé™ï¼ˆgrantæ— æ³•æ“ä½œï¼‰</li>
</ol>
<h3 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@MySQL-01 10:35:  [mysql]&gt; create table user_1 like user;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; select * from user_1;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; show table status like user;</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'user' at line 1</span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; show table status like 'user_1';</span><br><span class="line">+--------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| Name   | Engine | Version | Row_format | Rows | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time         | Check_time | Collation | Checksum | Create_options | Comment                     |</span><br><span class="line">+--------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| user_1 | MyISAM |      10 | Dynamic    |    0 |              0 |           0 | 281474976710655 |         1024 |         0 |           NULL | 2019-01-04 10:36:00 | 2019-01-04 10:36:00 | NULL       | utf8_bin  |     NULL |                | Users and global privileges |</span><br><span class="line">+--------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; show table status like 'user';</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+---------------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| Name | Engine | Version | Row_format | Rows | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time         | Check_time          | Collation | Checksum | Create_options | Comment                     |</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+---------------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| user | MyISAM |      10 | Dynamic    |    3 |             53 |         160 | 281474976710655 |         2048 |         0 |           NULL | 2015-05-22 15:24:42 | 2019-01-04 09:27:49 | 2015-05-22 15:33:22 | utf8_bin  |     NULL |                | Users and global privileges |</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+---------------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; insert into user_1 select * from user;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; select * from user_1;</span><br><span class="line">+-----------+------+----------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+--------+-----------------------+</span><br><span class="line">| Host      | User | Password | Select_priv | Insert_priv | Update_priv | Delete_priv | Create_priv | Drop_priv | Reload_priv | Shutdown_priv | Process_priv | File_priv | Grant_priv | References_priv | Index_priv | Alter_priv | Show_db_priv | Super_priv | Create_tmp_table_priv | Lock_tables_priv | Execute_priv | Repl_slave_priv | Repl_client_priv | Create_view_priv | Show_view_priv | Create_routine_priv | Alter_routine_priv | Create_user_priv | Event_priv | Trigger_priv | Create_tablespace_priv | ssl_type | ssl_cipher | x509_issuer | x509_subject | max_questions | max_updates | max_connections | max_user_connections | plugin | authentication_string |</span><br><span class="line">+-----------+------+----------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+--------+-----------------------+</span><br><span class="line">| localhost | root |          | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          |            |             |              |             0 |           0 |               0 |                    0 |        |                       |</span><br><span class="line">| 127.0.0.1 | root |          | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          |            |             |              |             0 |           0 |               0 |                    0 |        |                       |</span><br><span class="line">| ::1       | root |          | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          |            |             |              |             0 |           0 |               0 |                    0 |        |                       |</span><br><span class="line">+-----------+------+----------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+--------+-----------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; select user,host,authentication_string from user_1;</span><br><span class="line">+------+-----------+-----------------------+</span><br><span class="line">| user | host      | authentication_string |</span><br><span class="line">+------+-----------+-----------------------+</span><br><span class="line">| root | localhost |                       |</span><br><span class="line">| root | 127.0.0.1 |                       |</span><br><span class="line">| root | ::1       |                       |</span><br><span class="line">+------+-----------+-----------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; update user_1 set authentication_string=password('(Uploo00king)') where user='root';</span><br><span class="line">Query OK, 3 rows affected, 1 warning (0.01 sec)</span><br><span class="line">Rows matched: 3  Changed: 3  Warnings: 1</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:37:  [mysql]&gt; select user,host,authentication_string from user_1;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:37:  [mysql]&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@sh_02 data]# /etc/init.d/mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@sh_02 mysql]# ll user_1*</span><br><span class="line">-rw-r-----. 1 mysql mysql 10630 Jan  4 10:36 user_1.frm</span><br><span class="line">-rw-r-----. 1 mysql mysql   328 Jan  4 10:37 user_1.MYD</span><br><span class="line">-rw-r-----. 1 mysql mysql  2048 Jan  4 10:37 user_1.MYI</span><br><span class="line">[root@sh_02 mysql]# mv user_1.frm user.frm</span><br><span class="line">[root@sh_02 mysql]# mv user_1.MYD user.MYD</span><br><span class="line">[root@sh_02 mysql]# mv user_1.MYI user.MYI</span><br><span class="line">[root@sh_02 mysql]# ll user*</span><br><span class="line">-rw-r-----. 1 mysql mysql 10630 Jan  4 10:36 user.frm</span><br><span class="line">-rw-r-----. 1 mysql mysql   328 Jan  4 10:37 user.MYD</span><br><span class="line">-rw-r-----. 1 mysql mysql  2048 Jan  4 10:37 user.MYI</span><br><span class="line">-rw-rw----. 1 mysql mysql  3989 Aug 14 09:14 user_view.frm</span><br><span class="line">[root@sh_02 mysql]# /etc/init.d/mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@sh_02 mysql]# mysql -uroot -p'(Uploo00king)'</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 6</span><br><span class="line">Server version: 5.7.20-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:39:  [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| db1                |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:39:  [(none)]&gt; use mysql</span><br><span class="line">Database changed</span><br><span class="line">root@MySQL-01 10:39:  [mysql]&gt; select user,host from mysql.user;</span><br><span class="line">+------+-----------+</span><br><span class="line">| user | host      |</span><br><span class="line">+------+-----------+</span><br><span class="line">| root | 127.0.0.1 |</span><br><span class="line">| root | ::1       |</span><br><span class="line">| root | localhost |</span><br><span class="line">+------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:39:  [mysql]&gt; grant all on *.* to booboo@'%' identified by '(Uploo00king)';</span><br><span class="line">ERROR 1785 (HY000): Statement violates GTID consistency: Updates to non-transactional tables can only be done in either autocommitted statements or single-statement transactions, and never in the same statement as updates to transactional tables.</span><br><span class="line"></span><br><span class="line">root@MySQL-01 11:39:  [mysql]&gt; update mysql.user_1 set user='aliyun_root' where host='127.0.0.1';</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">root@MySQL-01 11:40:  [mysql]&gt; select user,host from mysql.user_1;</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| user        | host      |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| aliyun_root | 127.0.0.1 |</span><br><span class="line">| root        | ::1       |</span><br><span class="line">| root        | localhost |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">aliyun_root@MySQL-01 11:51:  [mysql]&gt; insert into mysql.user values ('%','jowing', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('Joowing@2017'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">aliyun_root@MySQL-01 11:51:  [mysql]&gt; select user,host from  mysql.user;</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| user        | host      |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| jowing      | %         |</span><br><span class="line">| aliyun_root | 127.0.0.1 |</span><br><span class="line">| root        | ::1       |</span><br><span class="line">| root        | localhost |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="ç”Ÿäº§ç¯å¢ƒ"><a href="#ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒ"></a>ç”Ÿäº§ç¯å¢ƒ</h3><h4 id="ç”¨æˆ·æƒé™"><a href="#ç”¨æˆ·æƒé™" class="headerlink" title="ç”¨æˆ·æƒé™"></a>ç”¨æˆ·æƒé™</h4><p>ç›®æ ‡ï¼šIDCæœºæˆ¿ä»åº“æ”¯æŒé€šè¿‡insertã€updateã€deleteå‘½ä»¤æ¥ä¿®æ”¹ç”¨æˆ·æƒé™ï¼Œæƒé™æ¯”è¾ƒç®€å•ï¼Œåˆ†ä¸ºåªè¯»å’Œå†™ã€‚</p>
<p>éœ€è¦è®¾ç½®ä»¥ä¸‹æƒé™ï¼šæƒé™ä½œç”¨äºæ‰€æœ‰çš„åº“å¤šæœ‰çš„è¡¨</p>
<table>
<thead>
<tr>
<th align="left">ç”¨æˆ·å</th>
<th align="left">å¯†ç </th>
<th align="left">æƒé™</th>
</tr>
</thead>
<tbody><tr>
<td align="left">root</td>
<td align="left">123</td>
<td align="left">è¯»å†™</td>
</tr>
<tr>
<td align="left">joowingbuz</td>
<td align="left">123</td>
<td align="left">åªè¯»</td>
</tr>
<tr>
<td align="left">ottersync</td>
<td align="left">123</td>
<td align="left">åªè¯»</td>
</tr>
<tr>
<td align="left">syncdw</td>
<td align="left">123</td>
<td align="left">åªè¯»</td>
</tr>
<tr>
<td align="left">datasis</td>
<td align="left">123</td>
<td align="left">åªè¯»</td>
</tr>
<tr>
<td align="left">joowingv</td>
<td align="left">123</td>
<td align="left">åªè¯»</td>
</tr>
<tr>
<td align="left">datadev</td>
<td align="left">123</td>
<td align="left">åªè¯»</td>
</tr>
<tr>
<td align="left">readonly</td>
<td align="left">123</td>
<td align="left">åªè¯»</td>
</tr>
</tbody></table>
<h4 id="æ­¥éª¤æ¦‚è§ˆ-1"><a href="#æ­¥éª¤æ¦‚è§ˆ-1" class="headerlink" title="æ­¥éª¤æ¦‚è§ˆ"></a>æ­¥éª¤æ¦‚è§ˆ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. ç™»é™†æ•°æ®åº“åæ“ä½œå¦‚ä¸‹ï¼š</span></span><br><span class="line">use mysql;</span><br><span class="line">create table user_1 like user;</span><br><span class="line">insert into user_1 select * from user;</span><br><span class="line">delete from mysql.user_1 where user='root';</span><br><span class="line">insert into mysql.user_1 values ('%','root', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','joowingbuz', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','ottersync', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','syncdw', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','datasis', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','joowingv', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','datadev', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','readonly', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. é€€å‡ºæ•°æ®åº“å¹¶åœæ­¢æœåŠ¡</span></span><br><span class="line">/data/mysql/support-files/mysql.server stop</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. å°†user_1è¡¨çš„ç‰©ç†æ–‡ä»¶è¦†ç›–userè¡¨</span></span><br><span class="line">cd /data/xtrabackup_data/mysql/</span><br><span class="line">mv user.frm user.ibd user.MYD user.MYI user.TRG /tmp</span><br><span class="line">mv user_1.frm user.frm</span><br><span class="line">mv user_1.MYI user.MYI</span><br><span class="line">mv user_1.MYD user.MYD</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. å¯åŠ¨æ•°æ®åº“</span></span><br><span class="line">/data/mysql/support-files/mysql.server start</span><br></pre></td></tr></table></figure>

<h4 id="æ“ä½œæ˜ç»†"><a href="#æ“ä½œæ˜ç»†" class="headerlink" title="æ“ä½œæ˜ç»†"></a>æ“ä½œæ˜ç»†</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@MySQL-01 15:42:  [(none)]&gt; use mysql</span><br><span class="line">Database changed</span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; create table user_1 like user;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; insert into user_1 select * from user;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; select user,host,authentication_string from mysql.user;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; select user,host,authentication_string from mysql.user_1;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; desc mysql.user_1;</span><br><span class="line">+------------------------+-----------------------------------+------+-----+---------+-------+</span><br><span class="line">| Field                  | Type                              | Null | Key | Default | Extra |</span><br><span class="line">+------------------------+-----------------------------------+------+-----+---------+-------+</span><br><span class="line">| Host                   | char(60)                          | NO   | PRI |         |       |</span><br><span class="line">| User                   | char(16)                          | NO   | PRI |         |       |</span><br><span class="line">| Password               | char(41)                          | NO   |     |         |       |</span><br><span class="line">| Select_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Insert_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Update_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Delete_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Drop_priv              | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Reload_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Shutdown_priv          | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Process_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| File_priv              | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Grant_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| References_priv        | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Index_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Alter_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Show_db_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Super_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_tmp_table_priv  | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Lock_tables_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Execute_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Repl_slave_priv        | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Repl_client_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_view_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Show_view_priv         | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_routine_priv    | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Alter_routine_priv     | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_user_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Event_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Trigger_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_tablespace_priv | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| ssl_type               | enum('','ANY','X509','SPECIFIED') | NO   |     |         |       |</span><br><span class="line">| ssl_cipher             | blob                              | NO   |     | NULL    |       |</span><br><span class="line">| x509_issuer            | blob                              | NO   |     | NULL    |       |</span><br><span class="line">| x509_subject           | blob                              | NO   |     | NULL    |       |</span><br><span class="line">| max_questions          | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| max_updates            | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| max_connections        | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| max_user_connections   | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| plugin                 | char(64)                          | YES  |     |         |       |</span><br><span class="line">| authentication_string  | text                              | YES  |     | NULL    |       |</span><br><span class="line">+------------------------+-----------------------------------+------+-----+---------+-------+</span><br><span class="line">42 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:47:  [mysql]&gt; delete from mysql.user_1 where user='root';</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:51:  [mysql]&gt; insert into mysql.user_1 values ('%','root', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','joowingbuz', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','ottersync', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','syncdw', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','datasis', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','joowingv', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','datadev', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','readonly', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; select user,host,authentication_string from mysql.user;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; select user,host,authentication_string from mysql.user_1;</span><br><span class="line">+------------+------+-------------------------------------------+</span><br><span class="line">| user       | host | authentication_string                     |</span><br><span class="line">+------------+------+-------------------------------------------+</span><br><span class="line">| ottersync  | %    | *9443FA914A2D69FE8832F8294E7422CC1B02A492 |</span><br><span class="line">| joowingbuz | %    | *DFFDA1CA6135E355EF468AB13A465BB5D4FE2B11 |</span><br><span class="line">| root       | %    | *89BE852E4EECFD217F0C5463FB30AD25BD0751E0 |</span><br><span class="line">| syncdw     | %    | *3DD7B4B4F6EE968FF3452B607BDEE6294B6A425A |</span><br><span class="line">| datasis    | %    | *011D511C71990F832C531A0F9CFB34CF7BB4E485 |</span><br><span class="line">| joowingv   | %    | *56B364074270DF7F6D670A6B4F5A4AD13322397A |</span><br><span class="line">| datadev    | %    | *D3D73E0F6BFC3159B024EF31484B6F9CC2963C5B |</span><br><span class="line">| readonly   | %    | *E2BA196C0C7F409990FDB3FAB5F9C7CE95F7C449 |</span><br><span class="line">+------------+------+-------------------------------------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@joowing-server-06:~# /data/mysql/support-files/mysql.server stop</span><br><span class="line">Shutting down MySQL</span><br><span class="line">...... * </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@joowing-server-06:~# cd /data/xtrabackup_data/</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data# cd mysql</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# ll user*</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ  14 15:42 user_1.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   744 8æœˆ  14 15:52 user_1.MYD</span><br><span class="line">-rw-r----- 1 mysql mysql  2048 8æœˆ  14 15:53 user_1.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ   9 20:14 user.frm</span><br><span class="line">-rw-r----- 1 mysql mysql 98304 8æœˆ   9 20:14 user.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql   328 8æœˆ   9 20:14 user.MYD</span><br><span class="line">-rw-r--r-- 1 mysql mysql  2048 8æœˆ   9 20:14 user.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql  3569 8æœˆ   9 20:14 user.TRG</span><br><span class="line">-rw-r----- 1 mysql mysql  3982 8æœˆ   9 20:14 user_view.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user.frm user.ibd user.MYD user.MYI user.TRG /data</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# ll user*</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ  14 15:42 user_1.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   744 8æœˆ  14 15:52 user_1.MYD</span><br><span class="line">-rw-r----- 1 mysql mysql  2048 8æœˆ  14 15:53 user_1.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql  3982 8æœˆ   9 20:14 user_view.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user_1.frm user.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user_1.MYI user.MYI</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user_1.MYD user.MYD</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# ll user*</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ  14 15:42 user.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   744 8æœˆ  14 15:52 user.MYD</span><br><span class="line">-rw-r----- 1 mysql mysql  2048 8æœˆ  14 15:53 user.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql  3982 8æœˆ   9 20:14 user_view.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# /data/mysql/support-files/mysql.server start</span><br><span class="line">Starting MySQL</span><br><span class="line">...... * </span><br><span class="line"></span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mysql -uroot -p'123'</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 5</span><br><span class="line">Server version: 5.7.20-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:55:  [(none)]&gt; show slave status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: rm-uf6f05k2rg95s23bp.mysql.rds.aliyuncs.com</span><br><span class="line">                  Master_User: idc_slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.001641</span><br><span class="line">          Read_Master_Log_Pos: 447207506</span><br><span class="line">               Relay_Log_File: joowing-server-06-relay-bin.000225</span><br><span class="line">                Relay_Log_Pos: 35529076</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.001641</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: mysql.%,sys.%,information_schema.%</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 447207506</span><br><span class="line">              Relay_Log_Space: 35529295</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 1095052097</span><br><span class="line">                  Master_UUID: b3e1de69-5daa-11e8-bed2-7cd30ab8a9fc</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: b3e1de69-5daa-11e8-bed2-7cd30ab8a9fc:97478646-97483368</span><br><span class="line">            Executed_Gtid_Set: b3e1de69-5daa-11e8-bed2-7cd30ab8a9fc:1-97483368,</span><br><span class="line">c39ecf19-5daa-11e8-aa9c-7cd30ac4764a:1-178658794,</span><br><span class="line">c69289d7-9bc9-11e8-b922-44a842431b62:1-12</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: </span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> éªŒè¯åªè¯»è´¦å·</span></span><br><span class="line">mysql -uroot	-p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -ujoowingbuz -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -uottersync -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -usyncdw -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -udatasis -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -ujoowingv -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -udatadev -p'123' -e "create database dbzyadmin;"</span><br><span class="line">mysql -ureadonly -p'123'  -e "create database dbzyadmin;"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åªè¯»è´¦å·æ— æ³•æ‰§è¡Œå†™æ“ä½œï¼ŒéªŒè¯æˆåŠŸ</span></span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">ERROR 1044 (42000) at line 1: Access denied for user 'readonly'@'%' to database 'dbzyadmin'</span><br></pre></td></tr></table></figure>

<h4 id="åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—"><a href="#åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—" class="headerlink" title="åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—"></a>åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—</h4><blockquote>
<p>åç»­æ–°å¢ç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·ã€æ›´æ”¹å¯†ç å‘½ä»¤å¦‚ä¸‹ï¼š</p>
</blockquote>
<h5 id="æ–°å¢è¯»å†™ç”¨æˆ·"><a href="#æ–°å¢è¯»å†™ç”¨æˆ·" class="headerlink" title="æ–°å¢è¯»å†™ç”¨æˆ·"></a>æ–°å¢è¯»å†™ç”¨æˆ·</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">insert into mysql.user_1 values ('%','ã€ç”¨æˆ·åã€‘', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('ã€å¯†ç ã€‘'));</span><br></pre></td></tr></table></figure>

<h5 id="æ–°å¢åªè¯»ç”¨æˆ·"><a href="#æ–°å¢åªè¯»ç”¨æˆ·" class="headerlink" title="æ–°å¢åªè¯»ç”¨æˆ·"></a>æ–°å¢åªè¯»ç”¨æˆ·</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">insert into mysql.user_1 values ('%','ã€ç”¨æˆ·åã€‘', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('ã€å¯†ç ã€‘'));</span><br></pre></td></tr></table></figure>

<h5 id="åˆ é™¤ç”¨æˆ·å‘½ä»¤"><a href="#åˆ é™¤ç”¨æˆ·å‘½ä»¤" class="headerlink" title="åˆ é™¤ç”¨æˆ·å‘½ä»¤"></a>åˆ é™¤ç”¨æˆ·å‘½ä»¤</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">delete from mysql.user where user='ã€ç”¨æˆ·åã€‘';</span><br></pre></td></tr></table></figure>

<h5 id="ä¿®æ”¹å¯†ç "><a href="#ä¿®æ”¹å¯†ç " class="headerlink" title="ä¿®æ”¹å¯†ç "></a>ä¿®æ”¹å¯†ç </h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">update mysql.user set authentication_string=password('ã€å¯†ç ã€‘') where user='ã€ç”¨æˆ·åã€‘';</span><br></pre></td></tr></table></figure>

<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>RDSç›®å‰ä½¿ç”¨MySQLç‰ˆæœ¬å’Œå®˜æ–¹åœ¨ç³»ç»Ÿåº“ä¸Šå·®å¼‚è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œè‹¥éœ€è¦æ­å»ºRDSåˆ°çº¿ä¸‹è‡ªå»ºMySQL5.7çš„ä¸»ä»æ—¶ï¼Œå¯ä»¥é€šè¿‡æ­¤æ³•å»å®ç°ã€‚</p>
<p>æœ¬æ–‡ä¸­å¯¹userè¡¨çš„ç ´è§£ï¼ŒåŒæ ·é€‚é€‚ç”¨äº<code>mysql.db</code> ã€<code>mysql.tables_priv</code>è¡¨ï¼Œéƒ½ç ´è§£åˆ™å¯ä»¥å°†æƒé™ä»ç”¨æˆ·æ‹“å±•åˆ°åº“è¡¨åˆ—ã€‚è¯»è€…å¯è‡ªè¡Œå®éªŒæµ‹è¯•ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯å¹¿è§’</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>RDS</tag>
        <tag>ä¸»ä»åŒæ­¥</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ©ç”¨splitå·¥å…·è§£å†³ä¸€æ¬¡MongoDBæ—¥å¿—å¼‚å¸¸é—®é¢˜</title>
    <url>/2018/08/03/booboo_others/%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>æ‘˜è¦ï¼š </p>
<ul>
<li>æŸå¤©æ™šä¸Šåˆšåˆ°å®¶ä¸ä¹…ï¼Œå°±æ¥åˆ°æ­å·åŒäº‹çš„ç”µè¯ï¼Œå®¢æˆ·MongoDBé›†ç¾¤ä¸­çš„æŸä¸ªåˆ†ç‰‡èŠ‚ç‚¹CPUé£™é«˜ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯æ…¢æŸ¥è¯¢ï¼Œç°åœ¨éœ€è¦æ‹‰å–CPUé£™é«˜æ—¶é—´æ®µçš„æ…¢æŸ¥è¯¢ã€‚å¿ƒæƒ³æ‹‰å–æ…¢æŸ¥è¯¢åº”è¯¥å¾ˆå¿«ï¼Œä¸å°±æ˜¯ä¸ªç³»ç»Ÿæ—¥å¿—å—ï¼Ÿè€Œä¸”è¿˜åšäº†æ—¥å¿—åˆ‡å‰²ä¸€å¤©ä¸€ä¸ªï¼ŒæŒ‰é“ç†å¾ˆå¿«æå®šçš„ï¼Œè°çŸ¥å½“å¤©æ™šä¸Šæäº†æ¥è¿‘ä¸‰ä¸ªå°æ—¶ä¹Ÿæ²¡æå®šã€‚ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</li>
<li>è¿›å…¥åˆ°æ—¥å¿—ç›®å½•ä¸€çœ‹ï¼Œç›®å‰ä¿ç•™è¿‘7å¤©çš„æ—¥å¿—ï¼Œæ¯å¤©çš„æ—¥å¿—é‡åœ¨23G~24Gï¼Œæˆ‘å½“æ—¶å°±æƒ³è¿™ä¸ªå®¢æˆ·æ•°æ®é‡è¿™ä¹ˆå¤§ï¼åç»­å‘ç°æ—¥å¿—æ ¼å¼æœ¬è¯¥ä¸ºæ™®é€šæ–‡æœ¬æ–‡ä»¶ç¡®å˜æˆäº†å›¾ç‰‡æ ¼å¼ï¼Œç©¶ç«Ÿä¸ºä½•ä¼šæ–‡ä»¶æ ¼å¼ä¼šè½¬å˜ï¼Ÿèƒ½å¦ä»å›¾ç‰‡æ ¼å¼ä¸­æ‹‰å–æŒ‡å®šæ—¶é—´æ®µçš„æ—¥å¿—å‘¢ï¼Ÿ</li>
<li>ç¬¬äºŒå¤©åˆ°å…¬å¸ï¼Œç”±äºå®¢æˆ·ç¯å¢ƒæˆ‘ä»¬ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥æ‰‹ï¼Œå› æ­¤å’±ä»¬æŠ€æœ¯ä¸“å®¶å›¢é˜Ÿæäº†ä¸€ä¸ª3äººçš„â€ä¸“å®¶ä¼šè¯Šâ€ï¼Œç»è¿‡äº†ä¸€ç•ªæŠ˜è…¾æ€»ç®—æŠŠåŸå› æ‰¾åˆ°äº†ï¼Œå…·ä½“è¿‡ç¨‹è¯·çœ‹ä¸‹æ–‡ï¼</li>
</ul>
<a id="more"></a>

<h2 id="æ•…äº‹èƒŒæ™¯"><a href="#æ•…äº‹èƒŒæ™¯" class="headerlink" title="æ•…äº‹èƒŒæ™¯"></a>æ•…äº‹èƒŒæ™¯</h2><h3 id="æ•°æ®åº“æ˜ç»†"><a href="#æ•°æ®åº“æ˜ç»†" class="headerlink" title="æ•°æ®åº“æ˜ç»†"></a>æ•°æ®åº“æ˜ç»†</h3><p>è¯´åœ¨å‰é¢ï¼š</p>
<ul>
<li>æ•°æ®åº“ï¼šMongoDBé›†ç¾¤ 4ä¸ªåˆ†ç‰‡èŠ‚ç‚¹</li>
<li>åˆ†ç‰‡èŠ‚ç‚¹è§„æ ¼ï¼š16æ ¸ / 32G CentOS 7.4 64ä½</li>
<li>æ•°æ®ç›®å½•æ‰€åœ¨ç£ç›˜: 300G   49G  252G  17% /data</li>
</ul>
<h3 id="æ•…äº‹æƒ…èŠ‚"><a href="#æ•…äº‹æƒ…èŠ‚" class="headerlink" title="æ•…äº‹æƒ…èŠ‚"></a>æ•…äº‹æƒ…èŠ‚</h3><ul>
<li>æŸå¤©æ™šä¸Šåˆšåˆ°å®¶ä¸ä¹…ï¼Œå°±æ¥åˆ°æ­å·åŒäº‹çš„ç”µè¯ï¼Œå®¢æˆ·MongoDBé›†ç¾¤ä¸­çš„æŸä¸ªåˆ†ç‰‡èŠ‚ç‚¹CPUé£™é«˜ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯æ…¢æŸ¥è¯¢ï¼Œç°åœ¨éœ€è¦æ‹‰å–CPUé£™é«˜æ—¶é—´æ®µçš„æ…¢æŸ¥è¯¢ã€‚å¿ƒæƒ³æ‹‰å–æ…¢æŸ¥è¯¢åº”è¯¥å¾ˆå¿«ï¼Œä¸å°±æ˜¯ä¸ªç³»ç»Ÿæ—¥å¿—å—ï¼Ÿè€Œä¸”è¿˜åšäº†æ—¥å¿—åˆ‡å‰²ä¸€å¤©ä¸€ä¸ªï¼ŒæŒ‰é“ç†å¾ˆå¿«æå®šçš„ï¼Œè°çŸ¥å½“å¤©æ™šä¸Šæäº†æ¥è¿‘ä¸‰ä¸ªå°æ—¶ä¹Ÿæ²¡æå®šã€‚ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</li>
<li>è¿›å…¥åˆ°æ—¥å¿—ç›®å½•ä¸€çœ‹ï¼Œç›®å‰ä¿ç•™è¿‘7å¤©çš„æ—¥å¿—ï¼Œæ¯å¤©çš„æ—¥å¿—é‡åœ¨23G~24Gï¼Œæˆ‘å½“æ—¶å°±æƒ³è¿™ä¸ªå®¢æˆ·æ•°æ®é‡è¿™ä¹ˆå¤§ï¼åç»­å‘ç°æ—¥å¿—æ ¼å¼æœ¬è¯¥ä¸ºæ™®é€šæ–‡æœ¬æ–‡ä»¶ç¡®å˜æˆäº†å›¾ç‰‡æ ¼å¼ï¼Œç©¶ç«Ÿä¸ºä½•ä¼šæ–‡ä»¶æ ¼å¼ä¼šè½¬å˜ï¼Ÿèƒ½å¦ä»å›¾ç‰‡æ ¼å¼ä¸­æ‹‰å–æŒ‡å®šæ—¶é—´æ®µçš„æ—¥å¿—å‘¢ï¼Ÿ</li>
<li>ç¬¬äºŒå¤©åˆ°å…¬å¸ï¼Œç”±äºå®¢æˆ·ç¯å¢ƒæˆ‘ä»¬ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥å—ï¼Œå› æ­¤å’±ä»¬æŠ€æœ¯ä¸“å®¶å›¢é˜Ÿæäº†ä¸€ä¸ª3äººçš„â€ä¸“å®¶ä¼šè¯Šâ€ï¼Œç»è¿‡äº†ä¸€ç•ªæŠ˜è…¾æ€»ç®—æŠŠåŸå› æ‰¾åˆ°äº†ï¼Œå…·ä½“è¿‡ç¨‹è¯·çœ‹ä¸‹æ–‡ï¼</li>
</ul>
<h2 id="å¤ç°ä¸å‰–æ"><a href="#å¤ç°ä¸å‰–æ" class="headerlink" title="å¤ç°ä¸å‰–æ"></a>å¤ç°ä¸å‰–æ</h2><h3 id="æ‹‰å–æ—¥å¿—å¼‚å¸¸"><a href="#æ‹‰å–æ—¥å¿—å¼‚å¸¸" class="headerlink" title="æ‹‰å–æ—¥å¿—å¼‚å¸¸"></a>æ‹‰å–æ—¥å¿—å¼‚å¸¸</h3><p><strong>ä½¿ç”¨mlogfilterè¿‡æ»¤æ–‡ä»¶æ—¶æŠ¥é”™è¯´æ–‡ä»¶émongodbçš„æ—¥å¿—æ–‡ä»¶</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@sh_01 booboo]# mlogfilter shard.log.2018-08-01 --from 2018-08-01T15:00:00.000+0800 --to "+1h" --slow 1000 &gt; /alidata/booboo/tf.1</span><br><span class="line">æŠ¥é”™:émongodbæ—¥å¿—æ ¼å¼</span><br></pre></td></tr></table></figure>

<p>å›åˆ°å®¢æˆ·æœåŠ¡å™¨æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ ¼å¼ï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@MONGO-SHARD-18 logs]# file *</span><br><span class="line">shard.log:            PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-25: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-26: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-27: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-28: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-29: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-30: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-31: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-01: PCX ver. 2.5 image data</span><br></pre></td></tr></table></figure>

<p>mongodbçš„æ—¥å¿—æ­£å¸¸åº”è¯¥ä¸ºï¼š<code>ASCII text, with very long lines</code>ï¼Œä½†æ˜¯ç°åœ¨å´å˜æˆäº†<code>PCX ver. 2.5 image data</code>ã€‚éœ€è¦å¼„æ¸…æ¥šåŸå› ã€‚</p>
<h3 id="æ—¥å¿—å¼‚å¸¸åˆ†æ"><a href="#æ—¥å¿—å¼‚å¸¸åˆ†æ" class="headerlink" title="æ—¥å¿—å¼‚å¸¸åˆ†æ"></a>æ—¥å¿—å¼‚å¸¸åˆ†æ</h3><ul>
<li>ä¸ºä»€ä¹ˆå®¢æˆ·æ¯å¤©çš„æ—¥å¿—é‡è¾¾åˆ°22ä¸ªGï¼Œå¹¶ä¸”æ¯å¤©çš„æ—¥å¿—é‡éƒ½æ˜¯å¤§äºç­‰äºå‰ä¸€å¤©ï¼Ÿå¾ˆæ˜¾ç„¶ï¼Œæ—¥å¿—æˆªæ–­æœ‰é—®é¢˜ã€‚</li>
<li>è¿™ä¸ªæ˜¯è¿‘7å¤©çš„æ—¥å¿—ï¼Œè€Œæ—¥å¿—æ ¼å¼å˜æˆäº†PCXå›¾ç‰‡æ ¼å¼æ˜¯ä¸ºä½•ï¼Ÿ</li>
<li>æ€€ç–‘æ¯æ¬¡æ—¥å¿—è½®è¯¢æ—¶éƒ½æ²¡æœ‰çœŸæ­£æˆªæ–­æ—¥å¿—ï¼</li>
</ul>
<p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/01.png" alt=""></p>
<h3 id="åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†"><a href="#åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†" class="headerlink" title="åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†"></a>åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†</h3><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/03.png" alt=""></p>
<p>æ€€ç–‘ä¸<code>echo &gt;</code>æœ‰å…³ï¼Œè¿›è¡ŒéªŒè¯ã€‚</p>
<h3 id="éªŒè¯echo-gt-ä¸PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´"><a href="#éªŒè¯echo-gt-ä¸PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´" class="headerlink" title="éªŒè¯echo &gt;ä¸PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´"></a>éªŒè¯<code>echo &gt;</code>ä¸<code>PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´</code></h3><ol>
<li>å»ºä¸€ä¸ªç©ºæ–‡æ¡£<code>log</code>ï¼›æ‰§è¡Œ<code>echo &gt; log</code>ï¼›é€šè¿‡<code>cat -A log</code>æŸ¥çœ‹æ–‡ä»¶ä¸­æ’å…¥äº†ä¸€ä¸ªç¬¦å·å³æ¢è¡Œç¬¦<code>\n</code></li>
<li>é€šè¿‡<code>hexdump -c log</code> æŸ¥çœ‹æµ‹è¯•æ–‡ä»¶å¤´éƒ¨æ˜¾ç¤ºä¸ºASCIIå­—ç¬¦ <code>\n</code></li>
<li>é€šè¿‡<code>hexdump -d log</code> æŸ¥çœ‹æµ‹è¯•æ–‡ä»¶å¤´éƒ¨æ˜¾ç¤ºä¸º16è¿›åˆ¶<code>00010</code> å³<code>0a</code></li>
<li>é€šè¿‡<code>vim</code> ç”¨16è¿›åˆ¶æŸ¥çœ‹æ–‡æ¡£<code>log</code>å¯ä»¥çœ‹åˆ°logçš„æ–‡ä»¶å¤´éƒ¨ä¸º<code>0a</code>ï¼Œæ­£æ˜¯PCXå›¾ç‰‡çš„å¤´éƒ¨</li>
<li>ç”Ÿäº§ç¯å¢ƒæŸ¥çœ‹å®¢æˆ·æœ‰é—®é¢˜çš„mongodbç³»ç»Ÿæ—¥å¿—æ–‡ä»¶æ ¼å¼ä¸º<code>PCX</code>å›¾ç‰‡æ ¼å¼</li>
<li>é€šè¿‡<code>hexdump -c log</code> æ˜¾ç¤ºä¸ºASCIIå­—ç¬¦ï¼Œç”Ÿäº§æ—¥å¿—æ–‡ä»¶å¤´éƒ¨ä¸æµ‹è¯•çš„logä¸€è‡´ï¼Œéƒ½æ˜¯<code>\n</code></li>
<li>é€šè¿‡<code>hexdump -d log</code>æ˜¾ç¤ºä¸º16è¿›åˆ¶ï¼Œç”Ÿäº§æ—¥å¿—æ–‡ä»¶å¤´éƒ¨ä¸æµ‹è¯•çš„logä¸€è‡´<code>00010</code> å³ <code>0a</code></li>
</ol>
<p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/02.png" alt=""></p>
<p><strong>åˆ°æ­¤éªŒè¯æˆåŠŸ:é€šè¿‡<code>echo &gt; log</code>çš„æ–¹å¼ä¼šå¾€æ–‡ä»¶å¤´éƒ¨æ–°å¢â€™0aâ€™</strong></p>
<hr>
<h3 id="å¤ç°MongoDBæ—¥å¿—ä»ASCII-textè½¬å˜ä¸ºPCX-æ ¼å¼"><a href="#å¤ç°MongoDBæ—¥å¿—ä»ASCII-textè½¬å˜ä¸ºPCX-æ ¼å¼" class="headerlink" title="å¤ç°MongoDBæ—¥å¿—ä»ASCII textè½¬å˜ä¸ºPCX æ ¼å¼"></a>å¤ç°MongoDBæ—¥å¿—ä»ASCII textè½¬å˜ä¸ºPCX æ ¼å¼</h3><p>åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¤ç°æ—¥å¿—ä»<code>ASCII text</code>å˜æˆ<code>PCX ver. 2.5 image data</code></p>
<ol>
<li>é€šè¿‡mongoç™»é™†æ•°æ®åº“æ‰§è¡Œå¤§é‡çš„æ’å…¥æ“ä½œ</li>
<li>é€šè¿‡echo &gt; mongod27017.log  å‘½ä»¤å°è¯•æ¸…ç©ºmongod27017.log</li>
<li>æŸ¥çœ‹æˆªæ–­åçš„æ—¥å¿—æ–‡ä»¶æ ¼å¼ï¼Œå˜æˆäº†very short file (no magic)</li>
<li>ç­‰æ–‡æ¡£æ’å…¥å®Œæ¯•</li>
<li>é€šè¿‡<code>tail -f</code> æŸ¥çœ‹æ—¥å¿—æ˜ç»†ï¼Œçœ‹åˆ°ç¡®å®æœ‰æ—¥å¿—å†™å…¥</li>
<li>æŸ¥çœ‹æ—¥å¿—æ ¼å¼ï¼Œå‘ç°å˜æˆäº†<code>PCX ver. 2.5 image data</code></li>
</ol>
<p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/05.png" alt=""></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@sh_01 ~]# mongo</span><br><span class="line">MongoDB shell version: 3.2.16</span><br><span class="line">connecting to: test</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.auth(<span class="string">'test_dev'</span>,<span class="string">'uplooking'</span>)</span></span><br><span class="line">1</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.t1.find()</span></span><br><span class="line">&#123; "_id" : ObjectId("5b5ebb6796b8b74a73ee30f6"), "a" : 1, "b" : 2 &#125;</span><br><span class="line">&#123; "_id" : ObjectId("5b5ebb6996b8b74a73ee30f7"), "a" : 1, "b" : 1 &#125;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="keyword">for</span> (i=1;i&lt;200000;i++)&#123;</span></span><br><span class="line">... db.t1.insert(&#123;id:i&#125;)&#125;</span><br><span class="line">WriteResult(&#123; "nInserted" : 1 &#125;)</span><br><span class="line"></span><br><span class="line">[root@sh_01 ~]# cd /alidata/mongodb/logs</span><br><span class="line">[root@sh_01 log]# ll</span><br><span class="line">-rw-r--r-- 1 root root 2182 Aug  3 10:28 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3100 Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line"></span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# ll</span><br><span class="line">total 12</span><br><span class="line">-rw-r--r-- 1 root root    1 Aug  3 10:29 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3100 Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     very short file (no magic)</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line"></span><br><span class="line">[root@sh_01 log]# tail -f mongod27017.log</span><br><span class="line"></span><br><span class="line">2018-08-03T10:30:21.936+0800 I NETWORK  [initandlisten] connection accepted from 127.0.0.1:43720 #2 (2 connections now open)</span><br><span class="line"></span><br><span class="line">[root@sh_01 log]# ll -h</span><br><span class="line">total 12K</span><br><span class="line">-rw-r--r-- 1 root root 2.8K Aug  3 10:30 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3.1K Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1.5K Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     PCX ver. 2.5 image data</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸€è¾¹ä¸æ–­äº§ç”Ÿæ—¥å¿—ï¼Œä¸€è¾¹å¤šæ¬¡æ‰§è¡Œ<span class="built_in">echo</span>&gt; </span></span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     PCX ver. 2.5 image data</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     very short file (no magic)</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# ll -h</span><br><span class="line">total 16K</span><br><span class="line">-rw-r--r-- 1 root root    1 Aug  3 11:28 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3.1K Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1.5K Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">-rw-r--r-- 1 root root 2.9K Aug  3 11:05 mongod27017.log.2018-08-03T03-09-08</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     very short file (no magic)</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     PCX ver. 2.5 image data</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# hexdump -c mongod27017.log</span><br><span class="line">0000000  \n  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">0000010  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">*</span><br><span class="line">0000850  \0  \0  \0  \0  \0  \0  \0   2   0   1   8   -   0   8   -   0</span><br><span class="line">0000860   3   T   1   1   :   2   9   :   0   6   .   7   2   9   +   0</span><br><span class="line">0000870   8   0   0       I       A   C   C   E   S   S               [</span><br><span class="line">0000880   c   o   n   n   3   ]       U   n   a   u   t   h   o   r   i</span><br><span class="line">0000890   z   e   d   :       n   o   t       a   u   t   h   o   r   i</span><br><span class="line">00008a0   z   e   d       o   n       t   e   s   t       t   o       e</span><br><span class="line">00008b0   x   e   c   u   t   e       c   o   m   m   a   n   d       &#123;</span><br><span class="line">00008c0       f   i   n   d   :       "   t   1   "   ,       f   i   l</span><br><span class="line">00008d0   t   e   r   :       &#123;   &#125;       &#125;  \n</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸå¤ç°äº†å®¢æˆ·çš„æƒ…å†µï¼š</p>
<ol>
<li><p>ç¬¬ä¸€æ¬¡<code>echo &gt; log</code>ï¼Œæ–‡ä»¶å¤´éƒ¨æ–°å¢<code>\n</code></p>
</li>
<li><p>å¤šæ¬¡<code>echo &gt; log</code>,æ–‡ä»¶å¤´éƒ¨å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">0000000  \n  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">0000010  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">*</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>ç¡®å®æ˜¯mongodbæ—¥å¿—è½®è¯¢å‡ºäº†é—®é¢˜ï¼š</p>
<ol>
<li><code>echo &gt; log</code>ä¼šå¾€æ–‡ä»¶å¤´éƒ¨æ’å…¥<code>\n</code>å³16è¿›åˆ¶çš„<code>0a</code></li>
<li>åœ¨æ•°æ®åº“æ­£å¸¸è¿è¡Œä¸­ï¼Œå¯¹logæ–‡ä»¶æ˜¯åŠ äº†é”çš„ï¼Œå¼ºåˆ¶æ‰§è¡Œ<code>echo &gt; log</code>æ˜¯æ— æ³•è¿›è¡Œè¦†ç›–çš„ï¼Œä¼šå°†æ‰€æœ‰çš„æ•°æ®å…¨éƒ¨ç½®ä¸º<code>0</code></li>
<li>å¼ºåˆ¶è¦†ç›–åï¼Œæ–‡ä»¶å¤´éƒ¨å˜æˆäº†æ— æ•°çš„ç©ºç™½</li>
</ol>
<h3 id="å¾…è§£å†³é—®é¢˜"><a href="#å¾…è§£å†³é—®é¢˜" class="headerlink" title="å¾…è§£å†³é—®é¢˜"></a>å¾…è§£å†³é—®é¢˜</h3><ul>
<li>MongoDBæ—¥å¿—è½®è¯¢æ–¹æ³•è°ƒæ•´ä¸º<strong>kill -SIGUSER1 [mongodpid]</strong></li>
<li>ä¿®å¤ç›®å‰å·²ç»å˜ä¸ºå›¾ç‰‡æ ¼å¼çš„æ—¥å¿—ï¼Œå¹¶æ‹‰å–15ç‚¹åˆ°16ç‚¹çš„æ—¥å¿—</li>
</ul>
<h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><h3 id="MongoDBæ—¥å¿—è½®è¯¢"><a href="#MongoDBæ—¥å¿—è½®è¯¢" class="headerlink" title="MongoDBæ—¥å¿—è½®è¯¢"></a>MongoDBæ—¥å¿—è½®è¯¢</h3><h4 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@sh_01 log]# pidof mongod</span><br><span class="line">1828</span><br><span class="line">[root@sh_01 log]# kill -SIGUSER1 1828</span><br><span class="line">-bash: kill: SIGUSER1: invalid signal specification</span><br><span class="line">[root@sh_01 log]# kill -SIGUSR1 1828</span><br><span class="line">[root@sh_01 log]# ll</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  3 11:09 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3100 Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">-rw-r--r-- 1 root root 2942 Aug  3 11:05 mongod27017.log.2018-08-03T03-09-08</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br></pre></td></tr></table></figure>

<h4 id="ç”Ÿäº§ç¯å¢ƒ"><a href="#ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒ"></a>ç”Ÿäº§ç¯å¢ƒ</h4><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/04.png" alt=""></p>
<p>ä¿®æ”¹æ—¥å¿—è½®è¯¢è„šæœ¬ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@MONGO-SHARD-18 logs]# cat /etc/init.d/mongo_logspit.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2018/08/02 Apple</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Rotate the MongoDB logs to prevent a single logfile from consuming too much disk space.</span></span><br><span class="line"></span><br><span class="line">cmd=mongod</span><br><span class="line">mongodpath=/opt/mongodb/bin</span><br><span class="line">pidarray=`pidof $&#123;mongodpath&#125;/$cmd`</span><br><span class="line">LOGPATH_SHARD=/data/mongodb/shard1/logs</span><br><span class="line"></span><br><span class="line">for pid in $pidarray;do</span><br><span class="line">if [ $pid ]</span><br><span class="line">then</span><br><span class="line">    kill -SIGUSR1 $pid</span><br><span class="line">fi</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash">clear logfile more than 7 days</span></span><br><span class="line">cd $LOGPATH_SHARD</span><br><span class="line">find ./ -xdev -mtime +7 -name "shard.log.*" -exec rm -f &#123;&#125;  \;</span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰çš„åˆ†ç‰‡éƒ½å»æ‰§è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kill -SIGUSR1 pidof mongod</span><br></pre></td></tr></table></figure>

<p>åˆ†ç‰‡15æ“ä½œå¦‚ä¸‹ï¼šå…¶ä»–åˆ†ç‰‡åŒæ ·</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zyadmin@MONGO-SHARD-15 ~]$ sudo -i</span><br><span class="line">[root@MONGO-SHARD-15 ~]# cd /data/mongodb/shard1/logs/</span><br><span class="line">[root@MONGO-SHARD-15 logs]# ll -h</span><br><span class="line">total 1.7G</span><br><span class="line">-rw-r--r-- 1 root root 20G Aug  2 15:27 shard.log</span><br><span class="line">-rw-r--r-- 1 root root 19G Jul 25 23:50 shard.log.2018-07-25</span><br><span class="line">-rw-r--r-- 1 root root 19G Jul 26 23:50 shard.log.2018-07-26</span><br><span class="line">-rw-r--r-- 1 root root 19G Jul 27 23:50 shard.log.2018-07-27</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 28 23:50 shard.log.2018-07-28</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 29 23:50 shard.log.2018-07-29</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 30 23:50 shard.log.2018-07-30</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 31 23:50 shard.log.2018-07-31</span><br><span class="line">-rw-r--r-- 1 root root 20G Aug  1 23:50 shard.log.2018-08-01</span><br><span class="line">[root@MONGO-SHARD-15 logs]# file *</span><br><span class="line">shard.log:            PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-25: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-26: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-27: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-28: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-29: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-30: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-31: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-01: PCX ver. 2.5 image data</span><br><span class="line">[root@MONGO-SHARD-15 logs]# kill -SIGUSR1 `pidof mongod`</span><br><span class="line">[root@MONGO-SHARD-15 logs]# file *</span><br><span class="line">shard.log:                     ASCII text, with very long lines</span><br><span class="line">shard.log.2018-07-25:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-26:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-27:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-28:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-29:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-30:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-31:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-01:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-02T07-27-29: PCX ver. 2.5 image data</span><br><span class="line">[root@MONGO-SHARD-15 logs]# ll -h</span><br><span class="line">total 1.7G</span><br><span class="line">-rw-r--r-- 1 root root 2.0K Aug  2 15:27 shard.log</span><br><span class="line">-rw-r--r-- 1 root root  19G Jul 25 23:50 shard.log.2018-07-25</span><br><span class="line">-rw-r--r-- 1 root root  19G Jul 26 23:50 shard.log.2018-07-26</span><br><span class="line">-rw-r--r-- 1 root root  19G Jul 27 23:50 shard.log.2018-07-27</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 28 23:50 shard.log.2018-07-28</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 29 23:50 shard.log.2018-07-29</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 30 23:50 shard.log.2018-07-30</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 31 23:50 shard.log.2018-07-31</span><br><span class="line">-rw-r--r-- 1 root root  20G Aug  1 23:50 shard.log.2018-08-01</span><br><span class="line">-rw-r--r-- 1 root root  20G Aug  2 15:27 shard.log.2018-08-02T07-27-29</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®å¤å¼‚å¸¸æ—¥å¿—"><a href="#ä¿®å¤å¼‚å¸¸æ—¥å¿—" class="headerlink" title="ä¿®å¤å¼‚å¸¸æ—¥å¿—"></a>ä¿®å¤å¼‚å¸¸æ—¥å¿—</h3><h4 id="ä¿®å¤æ€è·¯"><a href="#ä¿®å¤æ€è·¯" class="headerlink" title="ä¿®å¤æ€è·¯"></a>ä¿®å¤æ€è·¯</h4><p>å¼„æ¸…æ¥šæ—¥å¿—å˜æ›´çš„åŸå› ä»¥åŠå¤ç°è¿‡ç¨‹åï¼Œä¸éš¾å‘ç°ï¼Œæ—¥å¿—å› ä¸ºå¤´éƒ¨å˜åŒ–ä»è€Œå¯¼è‡´æ–‡ä»¶æ ¼å¼å˜æ›´ã€‚å› æ­¤æ¨æµ‹å¼‚å¸¸æ—¥å¿—çš„ç»„æˆå¦‚ä¸‹ï¼š</p>
<ol>
<li>å¤´éƒ¨ä¸º<code>0a</code></li>
<li>ä¸­é—´å…¨éƒ¨éƒ½æ˜¯<code>0</code></li>
<li>æœ€åæ˜¯æ­£å¸¸çš„å­—ç¬¦ä¸²è®°å½•ç€mongodbçš„æ—¥å¿—ä¿¡æ¯ï¼Œç±»ä¼¼äº<code>2018-08-03T10:30:21.936+0800 I NETWORK  [initandlisten] connection accepted from 127.0.0.1:43720 #2 (2 connections now open)</code>ç”±æ—¥å¿—å’Œæ—¥å¿—æ˜ç»†ç»„æˆ</li>
</ol>
<p>å› æ­¤ä¿®å¤çš„æ€è·¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>23Gçš„æ—¥å¿—ï¼Œé¦–å…ˆæŒ‰ç…§å¤§å°6Gåšåˆ‡åˆ†<code>split -b 6G log</code>ï¼Œåˆ‡åˆ†æˆ4ä¸ªæ–‡ä»¶</li>
<li>æŸ¥çœ‹åˆ‡åˆ†åçš„æ—¥å¿—æ ¼å¼ï¼Œå¦‚æœæœ€åä¸€ä¸ªæ—¥å¿—ä¸º<code>ASCII text</code>åˆ™ä¸å†åˆ‡åˆ†å¦åˆ™ï¼Œå°†æœ€åä¸€ä¸ªæ—¥å¿—ç»§ç»­åˆ‡åˆ†</li>
<li>å¾ªç¯ä¸Šä¸€æ­¥ï¼Œç›´åˆ°æœ€åä¸€ä¸ªæ–‡ä»¶åˆ‡åˆ†å‡ºæ¥æ²¡æœ‰<code>ASCII text</code>ä¸ºæ­¢</li>
</ul>
<h4 id="æ“ä½œæ˜ç»†"><a href="#æ“ä½œæ˜ç»†" class="headerlink" title="æ“ä½œæ˜ç»†"></a>æ“ä½œæ˜ç»†</h4><blockquote>
<p>æ—¥å¿—è½®è¯¢çš„éƒ¨ç½²è·ç¦»ç°åœ¨å¤§æ¦‚4ä¸ªæœˆ</p>
</blockquote>
<ol>
<li><p>ç¬¬ä¸€æ¬¡å°†23Gçš„æ–‡ä»¶ä»¥6Gåˆ‡åˆ†æˆ4ä¸ªæ–‡ä»¶ï¼šxaa\xab\xac\xadï¼ŒæŸ¥çœ‹4ä¸ªæ–‡ä»¶çš„å±æ€§ä¸º</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xaa:               PCX ver. 2.5 image data</span><br><span class="line">xab:               PCX ver. 2.5 image data</span><br><span class="line">xac:               PCX ver. 2.5 image data</span><br><span class="line">xad:                PCX ver. 2.5 image data</span><br></pre></td></tr></table></figure></li>
<li><p>é‡å‘½åxadä¸ºx1ç¬¬äºŒæ¬¡åˆ‡åˆ†x1 5Gï¼ŒæŒ‰ç…§1Gåˆ‡åˆ†æˆ5ä»½ï¼ŒæŸ¥çœ‹æ–‡ä»¶å±æ€§</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xaa:               PCX ver. 2.5 image data</span><br><span class="line">xab:               PCX ver. 2.5 image data</span><br><span class="line">xac:               PCX ver. 2.5 image data</span><br><span class="line">xad:                PCX ver. 2.5 image data</span><br><span class="line">xae:                ASCII text, with very long lines</span><br></pre></td></tr></table></figure>
</li>
<li><p>é‡åxad ä¸º x2 æŒ‰ç…§15Mçš„å¤§å°åˆ‡åˆ†ï¼ŒæŸ¥çœ‹æ–‡ä»¶çš„å±æ€§å¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xaa:	      PCX ver. 2.5 image data</span><br><span class="line">æ­¤å¤„çœç•¥ã€‚ã€‚ã€‚</span><br><span class="line">xdo:               PCX ver. 2.5 image data</span><br><span class="line">xdp:               ASCII text, with very long lines</span><br><span class="line">xdq:               ASCII text, with very long lines</span><br><span class="line">xdr:               ASCII text, with very long lines</span><br><span class="line">xds:               ASCII text, with very long lines</span><br><span class="line">xdt:               ASCII text, with very long lines</span><br><span class="line">xdu:               ASCII text, with very long lines</span><br><span class="line">xdv:               UTF-8 Unicode text, with very long lines</span><br><span class="line">xdw:               ASCII text, with very long lines</span><br><span class="line">xdx:               ASCII text, with very long lines</span><br><span class="line">xdy:               ASCII text, with very long lines</span><br></pre></td></tr></table></figure></li>
<li><p>åˆ‡åˆ†åæ–‡ä»¶ç±»å‹ä¸º<code>ASCII text</code>çš„æ–‡ä»¶ä¸­æ‰¾åˆ°15ç‚¹~16ç‚¹çš„æ–‡æ¡£</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@sh_01 mongolog_20180801]# head -n 2 xdv</span><br><span class="line">re: "x86_64", version: "Kernel 3.10.0-693.2.2.el7.x86_64" &#125; &#125;</span><br><span class="line">2018-08-01T16:13:44.958+0800 I ACCESS   [conn4972925] Successfully authenticated as principal __system on local</span><br><span class="line">[root@sh_01 mongolog_20180801]# head -n 2 xdu</span><br><span class="line">38422 #4967772 (445 connections now open)</span><br><span class="line">2018-08-01T14:00:10.575+0800 I NETWORK  [thread1] connection accepted from 172.16.0.44:38430 #4967773 (446 connections now open)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><code>xdv</code> çš„å¤´éƒ¨æ˜¯<code>2018-08-01T16:13:44.958+0800</code>,å› æ­¤å¯ä»¥ç¡®å®š15~16çš„æ—¥å¿—åœ¨xduä¸­</li>
<li><code>xdu</code>è®°å½•çš„æ—¥å¿—æ—¶é—´æ®µä¸º<code>2018-08-01T14:00:10.575+0800</code>~<code>2018-08-01T16:13:44.958+0800</code></li>
<li>é‡å‘½å<code>xdu</code>ä¸º<code>mongolog.18.14_16</code></li>
</ul>
<h3 id="åˆ†ææ—¥å¿—"><a href="#åˆ†ææ—¥å¿—" class="headerlink" title="åˆ†ææ—¥å¿—"></a>åˆ†ææ—¥å¿—</h3><h4 id="åˆ†æå‘½ä»¤"><a href="#åˆ†æå‘½ä»¤" class="headerlink" title="åˆ†æå‘½ä»¤"></a>åˆ†æå‘½ä»¤</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è·å–08æœˆ01å·ä¸‹åˆ3ç‚¹å¼€å§‹åˆ°4ç‚¹æ‰§è¡Œæ—¶é—´è¶…è¿‡5ç§’çš„æŸ¥è¯¢</span></span><br><span class="line">mlogfilter mongolog.18.14_16 --from 2018-08-01T15 --to "+1h" --slow 5000 &gt; slowlog.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–08æœˆ01å·ä¸‹åˆ3ç‚¹å¼€å§‹åˆ°4ç‚¹è¯­å¥çš„æ‰§è¡Œæ¬¡æ•°ã€ç”¨æ—¶ç­‰ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line">mloginfo slowlog.txt  --queries &gt; an_slowlog.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡mplotqueriesè¿›è¡Œæ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾ç»˜åˆ¶ï¼Œä¸”åªè¿”å›å‰10ä¸ª</span></span><br><span class="line">mplotqueries slowlog.txt --output-file 01.png --logscale --group-limit 10</span><br></pre></td></tr></table></figure>

<h4 id="æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾"><a href="#æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾" class="headerlink" title="æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾"></a>æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@sh_01 booboo]# mplotqueries slowlog.txt --output-file 01.png --logscale --group-limit 10</span><br><span class="line">                                                                                          </span><br><span class="line">SCATTER plot</span><br><span class="line">   id   #points  group</span><br><span class="line">    1       692  order.order</span><br><span class="line">    2       615  omdmain.item_region_erp</span><br><span class="line">    3         1  omdmain.customer</span><br><span class="line">()</span><br></pre></td></tr></table></figure>
<p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/10.png" alt=""></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜"><a href="#mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜" class="headerlink" title="mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜"></a>mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜</h3><ol>
<li><code>echo &gt; log</code>ä¼šå¾€æ–‡ä»¶å¤´éƒ¨æ’å…¥<code>\n</code>å³16è¿›åˆ¶çš„<code>0a</code></li>
<li>åœ¨æ•°æ®åº“æ­£å¸¸è¿è¡Œä¸­ï¼Œå¯¹logæ–‡ä»¶æ˜¯åŠ äº†é”çš„ï¼Œå¼ºåˆ¶æ‰§è¡Œ<code>echo &gt; log</code>æ˜¯æ— æ³•è¿›è¡Œè¦†ç›–çš„ï¼Œä¼šå°†æ‰€æœ‰çš„æ•°æ®å…¨éƒ¨ç½®ä¸º<code>0</code></li>
<li>å¼ºåˆ¶è¦†ç›–åï¼Œæ–‡ä»¶å¤´éƒ¨å˜æˆäº†æ— æ•°çš„ç©ºç™½</li>
</ol>
<h3 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h3><ul>
<li>MongoDBæ—¥å¿—è½®è¯¢æ–¹æ³•è°ƒæ•´ä¸º<strong>kill -SIGUSER1 [mongodpid]</strong></li>
<li>ä¿®å¤ç›®å‰å·²ç»å˜ä¸ºå›¾ç‰‡æ ¼å¼çš„æ—¥å¿—ï¼Œå¹¶æ‹‰å–15ç‚¹åˆ°16ç‚¹çš„æ—¥å¿—</li>
</ul>
<p>è¯¥caseèŠ±äº†ä¸€æ•´å¤©ï¼Œä»æ€€ç–‘è¢«æ”»å‡»åˆ°ç¡®è®¤æ˜¯æ—¥å¿—è½®è¯¢å¼•èµ·æ–‡ä»¶æ ¼å¼å˜æ›´æ˜¯ä¸€ä¸ªå…³é”®è½¬æŠ˜ç‚¹ï¼›</p>
<p>å¦å¤–PCXæ ¼å¼æ˜¯ç¬¬ä¸€æ¬¡ç¢°åˆ°ï¼Œç–‘æƒ‘äº†åŠå¤©~æœ€åæ˜¯@åŸ¹å°§å‘ç°äº†<code>echo</code>çš„ç«¯å€ªï¼Œ@è¡¾è¢­@å¤§å®å»éªŒè¯æœ€ç»ˆç¡®è®¤äº†é—®é¢˜çš„æ ¹æºã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯å¹¿è§’</category>
        <category>MongoDB</category>
      </categories>
      <tags>
        <tag>æ•°æ®æ•‘æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracleæ•°æ®åº“SQLä¼˜åŒ–_ç´¢å¼•ç¼ºå¤±</title>
    <url>/2018/05/29/booboo_others/oracle%E6%95%B0%E6%8D%AE%E5%BA%93SQL%E4%BC%98%E5%8C%96-%E7%B4%A2%E5%BC%95%E7%BC%BA%E5%A4%B1/</url>
    <content><![CDATA[<p>æ‘˜è¦ï¼šOracleæ•°æ®åº“åšäº†è¿ç§»ï¼Œä»åŸæ¥çš„DGè¿ç§»åˆ°æ–°åº“RACï¼Œå°ç‰ˆæœ¬ä¸åŒï¼›è€åº“ä¸­ç›¸åŒçš„SQLæ‰§è¡Œåªéœ€è¦11ç§’ï¼Œè€Œæ–°åº“éœ€è¦360ç§’ç”šè‡³800å¤šç§’ï¼Œå¦‚ä½•è¿›è¡Œå¤æ‚æŸ¥è¯¢çš„SQLä¼˜åŒ–ï¼Œæœ¬æ–‡æä¾›é€šç”¨çš„ä¸€ä¸ªæ€è·¯ã€‚</p>
<a id="more"></a>

<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>oracleæ•°æ®åº“åšäº†è¿ç§»ï¼Œä»åŸæ¥çš„DGè¿ç§»åˆ°æ–°åº“RACï¼Œå°ç‰ˆæœ¬ä¸åŒï¼›</p>
<p>è€åº“ä¸­ç›¸åŒçš„SQLæ‰§è¡Œåªéœ€è¦11ç§’ï¼Œè€Œæ–°åº“éœ€è¦360ç§’ç”šè‡³800å¤šç§’ã€‚</p>
<table>
<thead>
<tr>
<th>åº“</th>
<th>åŸæŸ¥è¯¢æ—¶é—´</th>
<th>ä¼˜åŒ–åçš„æŸ¥è¯¢æ—¶é—´</th>
</tr>
</thead>
<tbody><tr>
<td>è€åº“</td>
<td>11ç§’</td>
<td>1.4ç§’ ç¼“å­˜å 0.4ç§’</td>
</tr>
<tr>
<td>æ–°åº“RAC</td>
<td>360ç§’</td>
<td>1.4ç§’ ç¼“å­˜å0.4ç§’æ’æŸ¥æ€è·¯</td>
</tr>
</tbody></table>
<h2 id="å¾…ä¼˜åŒ–SQL"><a href="#å¾…ä¼˜åŒ–SQL" class="headerlink" title="å¾…ä¼˜åŒ–SQL"></a>å¾…ä¼˜åŒ–SQL</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	prj.PROVINCE_AD_NAME,</span><br><span class="line">	prj.CITY_AD_NAME,</span><br><span class="line">	prj.AD_NAME,</span><br><span class="line">	prj.CHANNEL_SYS_CAT,</span><br><span class="line">	prj.EXCUTE_EL,</span><br><span class="line">	prj.PRJ_CODE AS PRJ_CODE,</span><br><span class="line">	prj.PRJ_NAME AS PRJ_NAME,</span><br><span class="line">	prj.POS_CODE AS POS_CODE,</span><br><span class="line">	prj.POS_NAME AS POS_NAME,</span><br><span class="line">	prj.CUST_CHANNEL_CODE,</span><br><span class="line">	prj.CUST_CHANNEL_NAME,</span><br><span class="line">	prj.EMP_CODE AS EMP_CODE,</span><br><span class="line">	prj.NAME AS EMP_NAME,</span><br><span class="line">	prj.ATT_DATE AS APPLY_DATE,</span><br><span class="line">	prj.EMP_PK AS EMP_PK,</span><br><span class="line">	prj.ATT_START_TIME AS START_TIME,</span><br><span class="line">	prj.ATT_END_TIME AS END_TIME,</span><br><span class="line">	prj.ATT_ISWORK AS ISWORK,</span><br><span class="line">	prj.ATT_UNWORK AS ATTTYPE,</span><br><span class="line">	prj.START_XPOS AS ON_WORK_POSITION_LON,</span><br><span class="line">	prj.START_YPOS AS ON_WORK_POSITION_LAT,</span><br><span class="line">	prj.START_ISEXCEP AS ON_WORK_POSITION_STAUS,</span><br><span class="line">	prj.END_XPOS AS OFF_WORK_POSITION_LAT,</span><br><span class="line">	prj.END_YPOS AS OFF_WORK_POSITION_LON,</span><br><span class="line">	prj.END_ISEXCEP AS OFF_WORK_POSITION_STAUS,</span><br><span class="line">	ifcl1Staus.COMPARE_TYPE AS FACE_ATT_TYPE,</span><br><span class="line">	ifcl1.STATUS AS FACE_ATT_STATUS,</span><br><span class="line">	NVL( ifaceCount.faceCount, 0 ) AS FACE_ATT_COUNT,</span><br><span class="line">	NVL( levLeave.LEAVECount, 0 ) AS LEAVE_WORK_COUNT,</span><br><span class="line">	NVL( levRtn.RETURNCount, 0 ) AS RETURN_WORK_COUNT,</span><br><span class="line">	wq.STATUS AS PRJ_QUESTION_TYPE,</span><br><span class="line">	iface2.FACE_ATT_IMG AS FACE_ATT_IMG,</span><br><span class="line">	prj.SA_TYPE</span><br><span class="line">FROM</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			dpsi.ID AS ID,</span><br><span class="line">			P.ID AS PRJ_ID,</span><br><span class="line">			mad.AD_CODE,</span><br><span class="line">			mad.PROVINCE_AD_NAME,</span><br><span class="line">			mad.CITY_AD_NAME,</span><br><span class="line">			mad.AD_NAME,</span><br><span class="line">			mpk.POS_KIND_CODE,</span><br><span class="line">			mpk.POS_KIND_NAME,</span><br><span class="line">			P.CODE AS PRJ_CODE,</span><br><span class="line">			P.NAME AS PRJ_NAME,</span><br><span class="line">			P.START_DATE,</span><br><span class="line">			p.END_DATE,</span><br><span class="line">			dpsi.CUST_CHANNEL,</span><br><span class="line">			dpsi.CUST_SYS,</span><br><span class="line">			dpsi.CUST_CHANNEL_CODE,</span><br><span class="line">			dpsi.CUST_CHANNEL_NAME,</span><br><span class="line">			dcs.CHANNEL_SYS_CAT,</span><br><span class="line">			dcs.CHANNEL_CAT_CODE,</span><br><span class="line">			dcs.CHANNEL_AD_CODE,</span><br><span class="line">			dcs.CHANNEL_PROVINCE_AD_CODE,</span><br><span class="line">			dcs.CHANNEL_CITY_AD_CODE,</span><br><span class="line">			dcs.ID AS POS_ID,</span><br><span class="line">			dcs.CHANNEL_CODE AS POS_CODE,</span><br><span class="line">			dcs.CHANNEL_NAME AS POS_NAME,</span><br><span class="line">			dcs.LONGITUDE AS LONGITUDE,</span><br><span class="line">			dcs.LATITUDE AS LATITUDE,</span><br><span class="line">			dss.id AS SALES_ID,</span><br><span class="line">			TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' ) AS sc_schedule_date,</span><br><span class="line">			wor.SW_BEGIN_TIME AS SALES_WORK_START,</span><br><span class="line">			wor.SW_END_TIME AS SALES_WORK_END,</span><br><span class="line">			dss.SALES_EAT_START,</span><br><span class="line">			dss.SALES_EAT_END,</span><br><span class="line">			memp.EMP_PK,</span><br><span class="line">			memp.EMP_CODE,</span><br><span class="line">			dss.SALES_NAME AS NAME,</span><br><span class="line">			dss.SALES_PHONE AS TEL,</span><br><span class="line">			dss.SALES_CARD_ID AS ID_CARD,</span><br><span class="line">			spp.PRJ_ATT_CHECK_TYPE,</span><br><span class="line">			spp.ALLOW_LEAVE_TIME,</span><br><span class="line">			e1.EMP_CODE AS EXCUTE_CODE,</span><br><span class="line">			e1.emp_name AS EXCUTE_EL,</span><br><span class="line">			e2.EMP_CODE AS CITY_CODE,</span><br><span class="line">			e2.emp_name AS CITY_EL,</span><br><span class="line">			e3.EMP_CODE AS AREA_CODE,</span><br><span class="line">			e3.EMP_NAME AS AREA_NAME,</span><br><span class="line">			dpsi.SCHEDULE_TYPE,</span><br><span class="line">			sac.ATT_START_TIME,</span><br><span class="line">			sac.ATT_END_TIME,</span><br><span class="line">			sac.ATT_ISWORK,</span><br><span class="line">			sac.ATT_UNWORK,</span><br><span class="line">			sac.START_XPOS,</span><br><span class="line">			sac.START_YPOS,</span><br><span class="line">			DECODE( sac.START_ISEXCEP, 0, 2201, 1, 2202, 2, 2203, 3, 2204, 4, 2205, 2206 ) AS START_ISEXCEP,</span><br><span class="line">			sac.END_XPOS,</span><br><span class="line">			sac.END_YPOS,</span><br><span class="line">			sac.END_ISEXCEP,</span><br><span class="line">			sac.ATT_SCH_PK,</span><br><span class="line">			sac.ATT_DATE,</span><br><span class="line">			CASE</span><br><span class="line">				WHEN sac.ATT_START_TIME IS NOT NULL</span><br><span class="line">				AND sac.ATT_END_TIME IS NOT NULL THEN '1'</span><br><span class="line">				WHEN sac.ATT_START_TIME IS NOT NULL</span><br><span class="line">				OR sac.ATT_END_TIME IS NOT NULL THEN '2'</span><br><span class="line">				ELSE '2'</span><br><span class="line">			END AS SA_TYPE</span><br><span class="line">		FROM</span><br><span class="line">			DM_PROJECT_SELLIN_INFO dpsi</span><br><span class="line">		LEFT JOIN MD_EMP e1 ON</span><br><span class="line">			dpsi.EMP_CODE = e1.EMP_CODE</span><br><span class="line">		LEFT JOIN MD_EMP e2 ON</span><br><span class="line">			dpsi.CITY_EMP_CODE = e2.EMP_CODE</span><br><span class="line">		LEFT JOIN MD_EMP e3 ON</span><br><span class="line">			dpsi.AREA_MANAGER_CODE = e3.EMP_CODE,</span><br><span class="line">			DM_PROJECT P,</span><br><span class="line">			DM_PROJECT_SELLIN_SALES dss,</span><br><span class="line">			DM_CHANNEL_SYNC dcs,</span><br><span class="line">			MD_EMP memp,</span><br><span class="line">			SP_PRJ_PARM spp,</span><br><span class="line">			Md_Admin_Div mad,</span><br><span class="line">			MD_POS_KIND mpk,</span><br><span class="line">			dm_sales_schedule_calendar cal,</span><br><span class="line">			dm_sales_schedule_work wor,</span><br><span class="line">			SP_ATT_SCH sac</span><br><span class="line">		WHERE</span><br><span class="line">			dpsi.PROJECT_ID = P.ID</span><br><span class="line">			AND dss.id = cal.sales_id</span><br><span class="line">			AND cal.schedule_work_id = wor.id</span><br><span class="line">			AND dcs.CHANNEL_CAT_CODE = mpk.POS_KIND_CODE</span><br><span class="line">			AND dss.PROJECT_SELLIN_INFO_ID = dpsi.ID</span><br><span class="line">			AND dss.DELETE_FLAG = '0'</span><br><span class="line">			AND dpsi.CHANNEL_SYNC_ID = dcs.ID</span><br><span class="line">			AND LOWER( memp.EMP_S_CODE )= LOWER( dss.SALES_CARD_ID )</span><br><span class="line">			AND P.IS_DELETE IS NULL</span><br><span class="line">			AND memp.IS_DEL = '0'</span><br><span class="line">			AND spp.PRJ_CODE = P.CODE</span><br><span class="line">			AND mad.AD_ID = dcs.CHANNEL_ADMIN_DIV_ID</span><br><span class="line">			AND mad.IS_DEL = '0'</span><br><span class="line">			AND memp.EMP_TYPE = '1001'</span><br><span class="line">			AND TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' )&gt;='2018-04-01'</span><br><span class="line">			AND TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' )&lt;='2018-04-30'</span><br><span class="line">			AND sac.PRJ_CODE = p.CODE</span><br><span class="line">			AND sac.POS_CODE = dcs.CHANNEL_CODE</span><br><span class="line">			AND sac.EMP_PK = memp.EMP_PK</span><br><span class="line">			AND sac.ATT_DATE = TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' )</span><br><span class="line">			AND TO_CHAR( sac.CRT_DATE, 'yyyy-mm-dd' )&gt;='2018-04-01'</span><br><span class="line">			AND TO_CHAR( sac.CRT_DATE, 'yyyy-mm-dd' )&lt;='2018-04-30'</span><br><span class="line">	) prj,</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			ifcl.EMP_PK,</span><br><span class="line">			ifcl.COMPARE_DATE,</span><br><span class="line">			ifcl.STATUS</span><br><span class="line">		FROM</span><br><span class="line">			IPG_FACE_COMPARE_LOG ifcl</span><br><span class="line">		WHERE</span><br><span class="line">			ifcl.HANDLE_TYPE = 0</span><br><span class="line">			AND ifcl.DELETE_FLAG = '0'</span><br><span class="line">			AND ifcl.COMPARE_TYPE IN(</span><br><span class="line">				'1',</span><br><span class="line">				'3',</span><br><span class="line">				'5'</span><br><span class="line">			)</span><br><span class="line">			AND ifcl.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">			AND ifcl.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">		GROUP BY</span><br><span class="line">			ifcl.EMP_PK,</span><br><span class="line">			ifcl.COMPARE_DATE,</span><br><span class="line">			ifcl.STATUS</span><br><span class="line">		HAVING</span><br><span class="line">			AVG( STATUS )&lt; 1</span><br><span class="line">	) ifcl1,</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			*</span><br><span class="line">		FROM</span><br><span class="line">			(</span><br><span class="line">				SELECT</span><br><span class="line">					EMP_PK,</span><br><span class="line">					COMPARE_DATE,</span><br><span class="line">					COMPARE_TYPE,</span><br><span class="line">					ROW_NUMBER() OVER(</span><br><span class="line">						PARTITION BY EMP_PK,</span><br><span class="line">						COMPARE_DATE</span><br><span class="line">					ORDER BY</span><br><span class="line">						CREATED DESC</span><br><span class="line">					) rn</span><br><span class="line">				FROM</span><br><span class="line">					IPG_FACE_COMPARE_LOG</span><br><span class="line">				WHERE</span><br><span class="line">					COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">					AND COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">					AND COMPARE_TYPE IN(</span><br><span class="line">						'1',</span><br><span class="line">						'3',</span><br><span class="line">						'5'</span><br><span class="line">					)</span><br><span class="line">			) t</span><br><span class="line">		WHERE</span><br><span class="line">			t.rn &lt;= 1</span><br><span class="line">	) ifcl1Staus,</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			SP_LEV_RPT.ATT_SCH_PK,</span><br><span class="line">			COUNT(*) AS LEAVECount</span><br><span class="line">		FROM</span><br><span class="line">			SP_LEV_RPT</span><br><span class="line">		WHERE</span><br><span class="line">			SP_LEV_RPT.START_TIME IS NOT NULL</span><br><span class="line">		GROUP BY</span><br><span class="line">			SP_LEV_RPT.ATT_SCH_PK</span><br><span class="line">	) levLeave,</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			SP_LEV_RPT.ATT_SCH_PK,</span><br><span class="line">			COUNT(*) AS RETURNCount</span><br><span class="line">		FROM</span><br><span class="line">			SP_LEV_RPT</span><br><span class="line">		WHERE</span><br><span class="line">			SP_LEV_RPT.END_TIME IS NOT NULL</span><br><span class="line">		GROUP BY</span><br><span class="line">			SP_LEV_RPT.ATT_SCH_PK</span><br><span class="line">	) levRtn,</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			WX_QUESTION.PRJ_ID,</span><br><span class="line">			DM_PROJECT.CODE,</span><br><span class="line">			'Y' AS STATUS</span><br><span class="line">		FROM</span><br><span class="line">			WX_QUESTION,</span><br><span class="line">			DM_PROJECT</span><br><span class="line">		WHERE</span><br><span class="line">			DM_PROJECT.ID = WX_QUESTION.PRJ_ID</span><br><span class="line">			AND WX_QUESTION.IS_DEL = '0'</span><br><span class="line">			AND WX_QUESTION.STATUS = '0'</span><br><span class="line">		GROUP BY</span><br><span class="line">			WX_QUESTION.PRJ_ID,</span><br><span class="line">			DM_PROJECT.CODE</span><br><span class="line">	) wq,</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			ifcl.EMP_PK,</span><br><span class="line">			ifcl.COMPARE_DATE,</span><br><span class="line">			COUNT(*) AS faceCount</span><br><span class="line">		FROM</span><br><span class="line">			IPG_FACE_COMPARE_LOG ifcl</span><br><span class="line">		WHERE</span><br><span class="line">			ifcl.HANDLE_TYPE = 0</span><br><span class="line">			AND ifcl.COMPARE_TYPE IN(</span><br><span class="line">				'1',</span><br><span class="line">				'3',</span><br><span class="line">				'5'</span><br><span class="line">			)</span><br><span class="line">			AND ifcl.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">			AND ifcl.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">		GROUP BY</span><br><span class="line">			ifcl.EMP_PK,</span><br><span class="line">			ifcl.COMPARE_DATE</span><br><span class="line">	) ifaceCount,</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			iface.EMP_PK,</span><br><span class="line">			iface.COMPARE_DATE,</span><br><span class="line">			wm_concat(</span><br><span class="line">				(</span><br><span class="line">					SELECT</span><br><span class="line">						NVL( TRIM( T.PAR_VALUE ), TRIM( T.OLD_PAR_VALUE ))</span><br><span class="line">					FROM</span><br><span class="line">						(</span><br><span class="line">							SELECT</span><br><span class="line">								(</span><br><span class="line">									SELECT</span><br><span class="line">										PAR_VALUE</span><br><span class="line">									FROM</span><br><span class="line">										MD_SYS_PARM</span><br><span class="line">									WHERE</span><br><span class="line">										PAR_CODE = 'OLD_PIC_PATH'</span><br><span class="line">								) AS OLD_PAR_VALUE,</span><br><span class="line">								PAR_VALUE</span><br><span class="line">							FROM</span><br><span class="line">								MD_SYS_PARM</span><br><span class="line">							WHERE</span><br><span class="line">								PAR_CODE = 'ATT_COS_PATH'</span><br><span class="line">						) T</span><br><span class="line">				)|| REPLACE( SUBSTR( iface.COMPARE_MSG, INSTR( iface.COMPARE_MSG, 'compare', 1, 1 )), ']', '' )</span><br><span class="line">			) AS FACE_ATT_IMG</span><br><span class="line">		FROM</span><br><span class="line">			(</span><br><span class="line">				SELECT</span><br><span class="line">					ifa.EMP_PK,</span><br><span class="line">					ifa.COMPARE_DATE,</span><br><span class="line">					ifa.COMPARE_MSG,</span><br><span class="line">					RANK() OVER(</span><br><span class="line">						PARTITION BY ifa.EMP_PK,</span><br><span class="line">						ifa.COMPARE_DATE</span><br><span class="line">					ORDER BY</span><br><span class="line">						ifa.created DESC</span><br><span class="line">					) rankno</span><br><span class="line">				FROM</span><br><span class="line">					IPG_FACE_COMPARE_LOG ifa</span><br><span class="line">				WHERE</span><br><span class="line">					ifa.HANDLE_TYPE = 0</span><br><span class="line">					AND ifa.COMPARE_TYPE IN(</span><br><span class="line">						'1',</span><br><span class="line">						'3',</span><br><span class="line">						'5'</span><br><span class="line">					)</span><br><span class="line">					AND INSTR( ifa.COMPARE_MSG, 'compare' )&gt; 0</span><br><span class="line">					AND ifa.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">					AND ifa.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">			) iface</span><br><span class="line">		WHERE</span><br><span class="line">			iface.rankno &lt;= 3</span><br><span class="line">		GROUP BY</span><br><span class="line">			iface.EMP_PK,</span><br><span class="line">			iface.COMPARE_DATE</span><br><span class="line">	) iface2</span><br><span class="line">WHERE</span><br><span class="line">	prj.PRJ_NAME ='(2013)è¡Œæ”¿é¡¹ç›®'</span><br><span class="line">	AND prj.ATT_DATE &gt;='2018-04-01'</span><br><span class="line">	AND prj.ATT_DATE &lt;='2018-04-30'</span><br><span class="line">	AND prj.EMP_PK = ifcl1.EMP_PK(+)</span><br><span class="line">	AND TO_CHAR( TO_DATE( prj.ATT_DATE, 'yyyy-mm-dd' ), 'yyyymmdd' )= ifcl1.COMPARE_DATE(+)</span><br><span class="line">	AND prj.EMP_PK = ifcl1Staus.EMP_PK(+)</span><br><span class="line">	AND TO_CHAR( TO_DATE( prj.ATT_DATE, 'yyyy-mm-dd' ), 'yyyymmdd' )= ifcl1Staus.COMPARE_DATE(+)</span><br><span class="line">	AND prj.ATT_SCH_PK = levLeave.ATT_SCH_PK(+)</span><br><span class="line">	AND prj.ATT_SCH_PK = levRtn.ATT_SCH_PK(+)</span><br><span class="line">	AND prj.PRJ_CODE = wq.CODE(+)</span><br><span class="line">	AND prj.EMP_PK = ifaceCount.EMP_PK(+)</span><br><span class="line">	AND TO_CHAR( TO_DATE( prj.ATT_DATE, 'yyyy-mm-dd' ), 'yyyymmdd' )= ifaceCount.COMPARE_DATE(+)</span><br><span class="line">	AND prj.EMP_PK = iface2.EMP_PK(+)</span><br><span class="line">	AND TO_CHAR( TO_DATE( prj.sc_schedule_date, 'yyyy-mm-dd' ), 'yyyymmdd' )= iface2.COMPARE_DATE(+)</span><br><span class="line">ORDER BY</span><br><span class="line">	APPLY_DATE DESC,</span><br><span class="line">	ATTTYPE DESC</span><br></pre></td></tr></table></figure>

<h2 id="SQLä¼˜åŒ–æ€è·¯"><a href="#SQLä¼˜åŒ–æ€è·¯" class="headerlink" title="SQLä¼˜åŒ–æ€è·¯"></a>SQLä¼˜åŒ–æ€è·¯</h2><p>SQLè¯­å¥è¾ƒå¤æ‚ï¼Œ8ä¸ªå­æŸ¥è¯¢çš„left outer joinï¼Œæ¯ä¸ªå­æŸ¥è¯¢ä¸­åˆæœ‰è¿æ¥ã€‚æ€è·¯å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä»å¤–å¾€å†…æ‹†åˆ†å­æŸ¥è¯¢</li>
<li>è€æ—§å¯¹æ¯”å­æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’å’Œæ‰§è¡Œæ•ˆç‡</li>
<li>å­æŸ¥è¯¢è¿æ¥ä»1åˆ°2åˆ°3ä¸€ç›´åˆ°8ä¸ªè”æŸ¥å¯¹æ¯”ï¼Œå¯»æ‰¾ç“¶é¢ˆ</li>
</ol>
<h3 id="æ‹†åˆ†å­æŸ¥è¯¢"><a href="#æ‹†åˆ†å­æŸ¥è¯¢" class="headerlink" title="æ‹†åˆ†å­æŸ¥è¯¢"></a>æ‹†åˆ†å­æŸ¥è¯¢</h3><table>
<thead>
<tr>
<th>å­æŸ¥è¯¢</th>
<th>è€åº“ ï¼ˆç§’ï¼‰</th>
<th>æ–°åº“ï¼ˆç§’ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>prj</td>
<td>1.182</td>
<td>0.318</td>
</tr>
<tr>
<td>ifcl1</td>
<td>14.229</td>
<td>13.168</td>
</tr>
<tr>
<td>ifclStatus</td>
<td>15.739</td>
<td>16.769</td>
</tr>
<tr>
<td>levLeave</td>
<td>10.147</td>
<td>9.813</td>
</tr>
<tr>
<td>levRtn</td>
<td>9.148</td>
<td>8.3</td>
</tr>
<tr>
<td>wq</td>
<td>0.141</td>
<td>0.165</td>
</tr>
<tr>
<td>ifcl1Count</td>
<td>3.498</td>
<td>1.966</td>
</tr>
<tr>
<td>iface2</td>
<td>49.255</td>
<td>50.897</td>
</tr>
</tbody></table>
<h3 id="å¯»æ‰¾ç“¶é¢ˆ"><a href="#å¯»æ‰¾ç“¶é¢ˆ" class="headerlink" title="å¯»æ‰¾ç“¶é¢ˆ"></a>å¯»æ‰¾ç“¶é¢ˆ</h3><table>
<thead>
<tr>
<th>è¿æ¥</th>
<th>è€åº“ï¼ˆç§’ï¼‰</th>
<th>æ–°åº“ï¼ˆç§’ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>prj+ifcl1</td>
<td>1.522</td>
<td>1.129</td>
</tr>
<tr>
<td>+ifclStatus</td>
<td>2.343</td>
<td>1.957</td>
</tr>
<tr>
<td>+levLeave</td>
<td>2.525</td>
<td>1.955</td>
</tr>
<tr>
<td>+levRtn</td>
<td>2.658</td>
<td>1.653</td>
</tr>
<tr>
<td>+wq</td>
<td>2.561</td>
<td>1.999</td>
</tr>
<tr>
<td>+ifcl1Count</td>
<td>3.498</td>
<td>1.966</td>
</tr>
<tr>
<td>+iface2</td>
<td>11.124</td>
<td>383</td>
</tr>
</tbody></table>
<p>å‘ç°ç“¶é¢ˆå‡ºç°åœ¨<code>iface2</code></p>
<h2 id="ä¼˜åŒ–iface2"><a href="#ä¼˜åŒ–iface2" class="headerlink" title="ä¼˜åŒ–iface2"></a>ä¼˜åŒ–iface2</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SELECT</span><br><span class="line">			iface.EMP_PK,</span><br><span class="line">			iface.COMPARE_DATE,</span><br><span class="line">			wm_concat(</span><br><span class="line">				(</span><br><span class="line">					SELECT</span><br><span class="line">						NVL( TRIM( T.PAR_VALUE ), TRIM( T.OLD_PAR_VALUE ))</span><br><span class="line">					FROM</span><br><span class="line">						(</span><br><span class="line">							SELECT</span><br><span class="line">								(</span><br><span class="line">									SELECT</span><br><span class="line">										PAR_VALUE</span><br><span class="line">									FROM</span><br><span class="line">										MD_SYS_PARM</span><br><span class="line">									WHERE</span><br><span class="line">										PAR_CODE = 'OLD_PIC_PATH'</span><br><span class="line">								) AS OLD_PAR_VALUE,</span><br><span class="line">								PAR_VALUE</span><br><span class="line">							FROM</span><br><span class="line">								MD_SYS_PARM</span><br><span class="line">							WHERE</span><br><span class="line">								PAR_CODE = 'ATT_COS_PATH'</span><br><span class="line">						) T</span><br><span class="line">				)|| REPLACE( SUBSTR( iface.COMPARE_MSG, INSTR( iface.COMPARE_MSG, 'compare', 1, 1 )), ']', '' )</span><br><span class="line">			) AS FACE_ATT_IMG</span><br><span class="line">		FROM</span><br><span class="line">			(</span><br><span class="line">				SELECT</span><br><span class="line">					ifa.EMP_PK,</span><br><span class="line">					ifa.COMPARE_DATE,</span><br><span class="line">					ifa.COMPARE_MSG,</span><br><span class="line">					RANK() OVER(</span><br><span class="line">						PARTITION BY ifa.EMP_PK,</span><br><span class="line">						ifa.COMPARE_DATE</span><br><span class="line">					ORDER BY</span><br><span class="line">						ifa.created DESC</span><br><span class="line">					) rankno</span><br><span class="line">				FROM</span><br><span class="line">					IPG_FACE_COMPARE_LOG ifa</span><br><span class="line">				WHERE</span><br><span class="line">					ifa.HANDLE_TYPE = 0</span><br><span class="line">					AND ifa.COMPARE_TYPE IN(</span><br><span class="line">						'1',</span><br><span class="line">						'3',</span><br><span class="line">						'5'</span><br><span class="line">					)</span><br><span class="line">					AND INSTR( ifa.COMPARE_MSG, 'compare' )&gt; 0</span><br><span class="line">					AND ifa.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">					AND ifa.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">			) iface</span><br><span class="line">		WHERE</span><br><span class="line">			iface.rankno &lt;= 3</span><br><span class="line">		GROUP BY</span><br><span class="line">			iface.EMP_PK,</span><br><span class="line">			iface.COMPARE_DATE</span><br></pre></td></tr></table></figure>

<p><code>IPG_FACE_COMPARE_LOG</code>è¡¨ä¸­<code>COMPARE_DATEåˆ—</code>éœ€è¦æ–°å¢ç´¢å¼•ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li>oracleå°ç‰ˆæœ¬ä¸åŒå¼•èµ·ä¼˜åŒ–å™¨æ— æ³•è·å–ç›¸åŒçš„æ‰§è¡Œè®¡åˆ’</li>
<li>ç´¢å¼•ç¼ºå¤±æ˜¯æœ¬æ¬¡çš„æ…¢æŸ¥è¯¢çš„ä¸»è¦åŸå› </li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯å¹¿è§’</category>
        <category>Oracle</category>
      </categories>
      <tags>
        <tag>SQLä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¸€æ¬¡æƒŠå¿ƒåŠ¨é­„åœ°æ•°æ®å¼ºåˆ¶æ¢å¤</title>
    <url>/2018/05/17/booboo_others/MySQL%E4%B8%80%E6%AC%A1%E6%83%8A%E5%BF%83%E5%8A%A8%E9%AD%84%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%BC%BA%E5%88%B6%E6%81%A2%E5%A4%8D/</url>
    <content><![CDATA[<p>æ‘˜è¦ï¼šCashæ¢å¤çš„æ­£ç¡®æ–¹å¼æ˜¯ï¼š<strong>å¤‡ä»½æ–‡ä»¶ï¼ˆé€»è¾‘æˆ–ç‰©ç†ï¼‰+ binlog</strong>è¿›è¡Œæ¢å¤ï¼›ç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¿ç»´äººå‘˜éƒ½çŸ¥é“æ€ä¹ˆè¿›è¡Œæ­£ç¡®çš„å¤‡ä»½ï¼Œç”šè‡³è¿é€»è¾‘å¤‡ä»½å’Œç‰©ç†å¤‡ä»½çš„åŒºåˆ«æ˜¯ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Ÿæ›´ä¸çŸ¥é“å¤‡ä»½è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘æ•°æ®çš„ä¸€è‡´æ€§ä¸æœåŠ¡å¯ç”¨æ€§çš„é—®é¢˜ï¼Ÿæˆ–è€…è¿å¤‡ä»½å·¥å…·éƒ½ä¸ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥å½“ä½ é—®ï¼šæœ‰å¤‡ä»½å—ï¼Ÿå›ç­”ï¼šæ²¡æœ‰æˆ–è€…æ— æ•ˆ</p>
<p>åœ¨æœ¬æ¬¡æ¡ˆä¾‹ä¸­ï¼ŒæŸå®¢æˆ·æ•°æ®åº“å› å­˜å‚¨ç©ºé—´ä¸å¤Ÿå¯¼è‡´æ•°æ®åº“æœåŠ¡å®•æ‰ï¼Œè€Œå®¢æˆ·åœ¨æ•°æ®åº“å®•æœºåï¼Œåªæ‹·è´äº†å•ä¸ª<code>cy</code>åº“æ‰€å±çš„ç›®å½•è¿›è¡Œäº†æ–‡ä»¶å±‚é¢çš„å¤‡ä»½ï¼Œå°±å°†å…¶ä»–æ–‡ä»¶å…¨éƒ¨æ¸…ç©ºï¼Œå½“ä»–æƒ³é‡æ–°å¯åŠ¨æ•°æ®åº“æ—¶å‘ç°æ•°æ®åº“æœåŠ¡å¯åŠ¨ã€‚MySQLä½¿ç”¨5.7.17ç‰ˆæœ¬ï¼Œä½¿ç”¨innodbå­˜å‚¨å¼•æ“ï¼Œå¼€å¯äº†ç‹¬ç«‹è¡¨ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´å½“å‰çš„æ•‘å‘½ç¨»è‰æ˜¯ï¼šæ¯ä¸ªè¡¨çš„<code>.frm</code>å’Œ<code>.ibd</code>æ–‡ä»¶ã€‚</p>
<a id="more"></a>

<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>Cashæ¢å¤çš„æ­£ç¡®æ–¹å¼æ˜¯ï¼š<strong>å¤‡ä»½æ–‡ä»¶ï¼ˆé€»è¾‘æˆ–ç‰©ç†ï¼‰+ binlog</strong>è¿›è¡Œæ¢å¤ï¼›ç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¿ç»´äººå‘˜éƒ½çŸ¥é“æ€ä¹ˆè¿›è¡Œæ­£ç¡®çš„å¤‡ä»½ï¼Œç”šè‡³è¿é€»è¾‘å¤‡ä»½å’Œç‰©ç†å¤‡ä»½çš„åŒºåˆ«æ˜¯ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Ÿæ›´ä¸çŸ¥é“å¤‡ä»½è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘æ•°æ®çš„ä¸€è‡´æ€§ä¸æœåŠ¡å¯ç”¨æ€§çš„é—®é¢˜ï¼Ÿæˆ–è€…è¿å¤‡ä»½å·¥å…·éƒ½ä¸ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥å½“ä½ é—®ï¼šæœ‰å¤‡ä»½å—ï¼Ÿå›ç­”ï¼šæ²¡æœ‰æˆ–è€…æ— æ•ˆ</p>
<p>åœ¨æœ¬æ¬¡æ¡ˆä¾‹ä¸­ï¼ŒæŸå®¢æˆ·åªå¯¹å•ä¸ª<code>cy</code>åº“æ‰€å±çš„ç›®å½•è¿›è¡Œäº†æ–‡ä»¶å±‚é¢çš„å¤‡ä»½ï¼ŒMySQLä½¿ç”¨5.7.17ç‰ˆæœ¬ï¼Œä½¿ç”¨innodbå­˜å‚¨å¼•æ“ï¼Œå¼€å¯äº†ç‹¬ç«‹è¡¨ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´å½“å‰çš„æ•‘å‘½ç¨»è‰æ˜¯ï¼šæ¯ä¸ªè¡¨çš„<code>.frm</code>å’Œ<code>.ibd</code>æ–‡ä»¶ã€‚</p>
<h2 id="å¼ºåˆ¶è¿˜åŸæ­¥éª¤"><a href="#å¼ºåˆ¶è¿˜åŸæ­¥éª¤" class="headerlink" title="å¼ºåˆ¶è¿˜åŸæ­¥éª¤"></a>å¼ºåˆ¶è¿˜åŸæ­¥éª¤</h2><table>
<thead>
<tr>
<th>æ­¥éª¤</th>
<th>æè¿°</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>åˆ›å»ºåŒç‰ˆæœ¬çš„MySQLæœåŠ¡å®ä¾‹ä¸€æš</strong></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td><strong>è·å–è¡¨çš„åˆ—æ•°</strong></td>
<td>å¦‚æœæœ‰ddlå¤‡ä»½ç›´æ¥å¯¼å…¥ï¼Œå¯æƒœéƒ½æ˜¯æ²¡æœ‰çš„ï¼Œå“­ã€‚ã€‚ã€‚</td>
</tr>
<tr>
<td>2.1</td>
<td>åˆ›å»ºåŒåè¡¨ï¼Œç»“æ„æ— æ‰€è°“</td>
<td>æ•°æ®åº“çš„ä¸–ç•Œä¹Ÿéœ€è¦èº«ä»½è¯ï¼Œå…ˆé€ ä¸ªäººæ‹¿ä¸Šèº«ä»½è¯ï¼Œè‡³äºäººé•¿å¾—å•¥æ ·å‡ æ¡èƒ³è†Šéƒ½æ— æ‰€è°“ï¼Œåå­—æœ€é‡è¦</td>
</tr>
<tr>
<td>2.2</td>
<td>åœæœåŠ¡ï¼›ä½¿ç”¨å¤‡ä»½çš„frmæ–‡ä»¶è¦†ç›–å½“å‰çš„frm</td>
<td>å·æ¢æ¢æŸ±</td>
</tr>
<tr>
<td>2.3</td>
<td>é…ç½®æ–‡ä»¶æ·»åŠ å¼ºåˆ¶æ¢å¤innodbçš„å‚æ•°ï¼›å¯åŠ¨æœåŠ¡</td>
<td>è’™è”½å¥¹çš„åŒçœ¼</td>
</tr>
<tr>
<td>2.4</td>
<td>æŸ¥çœ‹è¡¨ç»“æ„</td>
<td>æ•°æ®åº“ä¼šæ‹¿ç€èº«ä»½è¯å’Œé¢å‰çš„äººï¼ˆfrmæ–‡ä»¶ï¼‰åšå¯¹æ¯”</td>
</tr>
<tr>
<td>2.5</td>
<td>æŸ¥çœ‹é”™è¯¯æ—¥å¿—ä¸­å…³äºè¯¥è¡¨çš„æŠ¥é”™</td>
<td>æ•°æ®åº“å‘ç°èº«ä»½è¯ä¸Šçš„äººåªæœ‰1æ¡èƒ³è†Šï¼Œè€Œè¢«æ£€æŸ¥çš„äººæœ‰10æ¡èƒ³è†Šï¼Œæ˜æ˜¾å¯¹ä¸ä¸Šå•Š</td>
</tr>
<tr>
<td>2.6</td>
<td>æˆåŠŸè·å–è¡¨çš„çœŸå®åˆ—æ•°ï¼›åˆ é™¤è¿™äº›è¡¨</td>
<td>é€šè¿‡è­¦å‘Šå¯ä»¥çŸ¥é“åº”è¯¥é€ ä¸€ä¸ªæœ‰10æ¡èƒ³è†Šçš„äºº</td>
</tr>
<tr>
<td>3</td>
<td><strong>è·å–è¡¨çš„ç»“æ„</strong></td>
<td></td>
</tr>
<tr>
<td>3.1</td>
<td>åˆ›å»ºåŒåè¡¨ï¼Œåˆ—æ•°ä¸€è‡´ï¼Œåˆ—åæ— æ‰€è°“</td>
<td>è¿™ä¸€æ¬¡é€ äººçš„æ—¶å€™ï¼Œé€ ä¸€ä¸ªæœ‰10æ¡èƒ³è†Šçš„ï¼Œæ¯æ¡èƒ³è†Šçš„åå­—æ— æ‰€è°“ï¼Œå…³é”®æ˜¯èº«ä»½è¯ä¸Šé¢çš„äººåå’Œ10æ¡èƒ³è†Š</td>
</tr>
<tr>
<td>3.2</td>
<td>åœæœåŠ¡ï¼›ä½¿ç”¨å¤‡ä»½çš„frmæ–‡ä»¶è¦†ç›–å½“å‰çš„frm</td>
<td>å·æ¢æ¢æŸ±</td>
</tr>
<tr>
<td>3.3</td>
<td>é…ç½®æ–‡ä»¶æ·»åŠ å¼ºåˆ¶æ¢å¤innodbçš„å‚æ•°ï¼›å¯åŠ¨æœåŠ¡</td>
<td>è’™è”½å¥¹çš„åŒçœ¼</td>
</tr>
<tr>
<td>3.4</td>
<td>æŸ¥çœ‹è¡¨ç»“æ„</td>
<td>æ•°æ®åº“ä¼šæ‹¿ç€æ–°çš„èº«ä»½è¯å’Œé¢å‰çš„äººï¼ˆfrmæ–‡ä»¶ï¼‰åšå¯¹æ¯”</td>
</tr>
<tr>
<td>3.5</td>
<td>æˆåŠŸè·å–è¡¨ç»“æ„</td>
<td>æ•°æ®åº“å‘ç°èº«ä»½è¯ä¸Šä¿¡æ¯å’Œè¢«æ£€æŸ¥çš„äººä¿¡æ¯ä¸€è‡´ï¼Œåå­—ï¼Œèƒ³è†Šçš„æ•°é‡ï¼Œå¯¹ä¸Šäº†å°±è®¤å¯å•¦ï¼ï¼ˆæ•°æ®åº“åªæ£€æŸ¥è¡¨åå’Œåˆ—çš„ä¸ªæ•°ï¼‰</td>
</tr>
<tr>
<td>4</td>
<td><strong>å¼ºåˆ¶æ¢å¤è¡¨æ•°æ®</strong></td>
<td></td>
</tr>
<tr>
<td>4.1</td>
<td>ä¸¢å¼ƒå½“å‰è¡¨çš„æ•°æ®</td>
<td>æŠŠè¿™ä¸ªäººçš„äº”è„å…­è…‘éƒ½æŒ–å‡ºæ¥</td>
</tr>
<tr>
<td>4.2</td>
<td>å°†å¤‡ä»½çš„ibdæ”¾åˆ°å¯¹åº”è·¯å¾„</td>
<td>å°†ä¹‹å‰å¤‡ä»½çš„åƒäº†è‚‰çš„äº”è„å…­è…‘æ”¾è¿›å»</td>
</tr>
<tr>
<td>4.3</td>
<td>å¯¼å…¥æ–°çš„æ•°æ®ï¼Œå¦‚æœæ•°æ®åº“åŠ è½½æˆåŠŸåˆ™å¯ä»¥çœ‹åˆ°æ•°æ®ï¼›å¦åˆ™åŠ è½½å¤±è´¥ã€‚</td>
<td>è·Ÿå¤§è„‘æ±‡æŠ¥ä¸€ä¸‹æ–°çš„äº”è„å…­è…‘å·²ç»å°±ä½å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼›å¦‚æœä½¿ç”¨å¾—æ²¡é—®é¢˜å°±æˆåŠŸï¼›å¦‚æœå™¨å®˜å·²ç»æŸåé‚£ä¹ˆæ‰‹æœ¯å¤±è´¥ã€‚</td>
</tr>
</tbody></table>
<h2 id="è¯¦ç»†è¿‡ç¨‹"><a href="#è¯¦ç»†è¿‡ç¨‹" class="headerlink" title="è¯¦ç»†è¿‡ç¨‹"></a>è¯¦ç»†è¿‡ç¨‹</h2><h3 id="æ•°æ®é‡"><a href="#æ•°æ®é‡" class="headerlink" title="æ•°æ®é‡"></a>æ•°æ®é‡</h3><table>
<thead>
<tr>
<th>æ˜ç»†</th>
<th>å¤§å°</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td>ç‰©ç†æ–‡ä»¶</td>
<td>174M</td>
<td></td>
</tr>
<tr>
<td>æ•°æ®åº“</td>
<td>1ä¸ª</td>
<td>cy</td>
</tr>
<tr>
<td>è¡¨</td>
<td>57å¼ </td>
<td></td>
</tr>
</tbody></table>
<h3 id="æ¢å¤ç»“æœ"><a href="#æ¢å¤ç»“æœ" class="headerlink" title="æ¢å¤ç»“æœ"></a>æ¢å¤ç»“æœ</h3><blockquote>
<p>åœ¨å®¢æˆ·æœåŠ¡å™¨ä¸Šé¢ç»“æœå¦‚ä¸‹ï¼š</p>
</blockquote>
<table>
<thead>
<tr>
<th>æ˜ç»†</th>
<th>æˆåŠŸ</th>
<th>å¤±è´¥</th>
<th>æ¢å¤ç‡</th>
</tr>
</thead>
<tbody><tr>
<td>è¡¨ç»“æ„</td>
<td>58</td>
<td>0</td>
<td>100%</td>
</tr>
<tr>
<td>è¡¨æ•°æ®</td>
<td>56</td>
<td>2</td>
<td>96%</td>
</tr>
</tbody></table>
<blockquote>
<p>åœ¨æˆ‘çš„æœåŠ¡å™¨ä¸Šé¢ç»“æœå¦‚ä¸‹ï¼š</p>
</blockquote>
<table>
<thead>
<tr>
<th>æ˜ç»†</th>
<th>æˆåŠŸ</th>
<th>å¤±è´¥</th>
<th>æ¢å¤ç‡</th>
</tr>
</thead>
<tbody><tr>
<td>è¡¨ç»“æ„</td>
<td>58</td>
<td>0</td>
<td>100%</td>
</tr>
<tr>
<td>è¡¨æ•°æ®</td>
<td>58</td>
<td>0</td>
<td>100%</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@toberoot mysql]# /alidata/mysql/bin/mysqld --initialize-insecure --datadir=/alidata/mysql/data/  --user=mysql</span><br><span class="line">[root@toberoot mysql]# service mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot mysql]# mysql -V</span><br><span class="line">mysql  Ver 14.14 Distrib 5.7.17, for linux-glibc2.5 (x86_64) using  EditLine wrapper</span><br><span class="line"></span><br><span class="line">[root@toberoot mysql]# cd ~/home/cy02/</span><br><span class="line">[root@toberoot cy02]# ll</span><br><span class="line">total 178140</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9022 Aug 14  2017 base_dict.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Mar 14 15:00 base_dict.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8822 Mar  2 11:14 biz_advise.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 14 14:39 biz_advise.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8850 Mar  2 11:14 biz_bank.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Mar  2 11:14 biz_bank.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9580 Mar  2 11:14 biz.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9286 Mar  2 11:14 biz_gift.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Apr 24 14:08 biz_gift.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8890 Mar  2 11:14 biz_gprs_bind.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8745 Mar  2 11:14 biz_gprs_bind_his.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   180224 May 15 09:40 biz_gprs_bind_his.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql   180224 May 15 09:42 biz_gprs_bind.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 14:33 biz.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8845 Aug 14  2017 biz_msg_template.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 biz_msg_template.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8881 Aug 14  2017 biz_take_bank.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 13 19:26 biz_take_bank.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9411 Nov 24 13:22 biz_take.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   196608 May 15 15:22 biz_take.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8862 Aug 14  2017 biz_take_wwlt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 15:22 biz_take_wwlt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8854 Aug 14  2017 biz_take_wx.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 11:52 biz_take_wx.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8925 Aug 14  2017 biz_vip.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Mar 16 09:31 biz_vip.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8852 Aug 14  2017 biz_wlt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 18:30 biz_wlt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8926 Aug 14  2017 biz_wx_focus.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 10 16:24 biz_wx_focus.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9339 Nov 24 13:25 biz_wx.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 10 16:24 biz_wx.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8874 Aug 14  2017 biz_wx_walt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 biz_wx_walt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8776 Aug 14  2017 cfg_area.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   311296 Aug 14  2017 cfg_area.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8721 Aug 14  2017 cfg_id_gen.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 18:41 cfg_id_gen.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql       61 Aug 14  2017 db.opt</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9053 Aug 14  2017 gprs_model.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   212992 May 15 18:47 gprs_model.ibd</span><br><span class="line">-r--r--r-- 1 mysql mysql 79691776 May 16 14:04 ibdata1</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8801 Dec 19 15:00 mbr_coin_chged.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  2097152 May 15 17:27 mbr_coin_chged.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8766 Dec 19 14:53 mbr_coin.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 19:12 mbr_coin.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9155 May 14 11:55 mbr.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   212992 May 15 20:58 mbr.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8876 Aug 14  2017 mbr_oauth.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   475136 May 15 19:37 mbr_oauth.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9011 Aug 14  2017 mbr_pay.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 mbr_pay.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8740 Aug 14  2017 mbr_prizen.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 mbr_prizen.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9147 Dec 19 14:56 mbr_recharge.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   294912 May 15 19:11 mbr_recharge.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8801 Aug 14  2017 mbr_wallet_chged.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9437184 May 15 17:27 mbr_wallet_chged.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8845 Aug 14  2017 mbr_wallet.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   262144 May 15 19:12 mbr_wallet.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql    10100 Dec 19 15:47 ord.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql 31457280 May 15 18:41 ord.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8940 Aug 14  2017 ord_item.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 ord_item.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8917 Aug 14  2017 ord_pay_ali.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 ord_pay_ali.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8924 Dec 19 15:55 ord_pay_coin.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   475136 May 15 17:27 ord_pay_coin.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8926 Aug 14  2017 ord_pay_return.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 ord_pay_return.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8966 Dec 20 16:50 ord_pay_wlt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9437184 May 15 17:27 ord_pay_wlt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9036 Aug 14  2017 ord_pay_wx.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql 32505856 May 15 18:41 ord_pay_wx.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9098 Aug 14  2017 prod_base_args.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_base_args.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8790 Aug 14  2017 prod_bug_rpt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_bug_rpt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8887 Aug 14  2017 prod_cmd.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_cmd.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8984 Aug 14  2017 prod_cmd_invoke.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_cmd_invoke.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9058 Aug 14  2017 prod_coin_rpt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9437184 May 15 14:24 prod_coin_rpt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8798 Aug 14  2017 prod_coin_rpt_log.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 14:24 prod_coin_rpt_log.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9834 Dec 13 14:12 prod.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8835 Aug 14  2017 prod_gprs_bind.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8793 Aug 14  2017 prod_gprs_bind_his.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   196608 May 15 09:42 prod_gprs_bind_his.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_gprs_bind.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql   425984 May 15 09:42 prod.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8851 Aug 14  2017 prod_instl_imgs.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_instl_imgs.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9388 Dec 13 14:13 prod_instl_pos.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   147456 May 15 16:25 prod_instl_pos.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9384 Dec 13 14:14 prod_instl_pos_model.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   131072 May 15 16:24 prod_instl_pos_model.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8892 Aug 14  2017 prod_mod_attr.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_mod_attr.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8873 Aug 14  2017 prod_mod_attr_val.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_mod_attr_val.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9642 Dec 13 14:11 prod_model.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 11 11:58 prod_model.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8815 Aug 14  2017 prod_mod_sku.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_mod_sku.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9050 Aug 14  2017 prod_onl_log.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   163840 May 15 18:42 prod_onl_log.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9143 Aug 14  2017 prod_sp_args.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_sp_args.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8876 Aug 14  2017 prod_sp_arg_vals.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_sp_arg_vals.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9190 Dec 13 14:14 sys_acct.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 14 11:16 sys_acct.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8776 Aug 14  2017 sys_acct_res.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   229376 May 11 11:52 sys_acct_res.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9106 Aug 14  2017 sys_res.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 sys_res.ibd</span><br><span class="line"><span class="meta">#</span><span class="bash">è·å–å¾…æ¢å¤è¡¨å</span></span><br><span class="line">[root@toberoot cy02]# ll *.frm |awk '&#123;print $9&#125;'|awk -F '.' '&#123;print $1&#125;' &gt; /alidata/cy_table.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> pythonè„šæœ¬è‡ªåŠ¨ç”Ÿæˆå»ºè¡¨è¯­å¥</span></span><br><span class="line">[root@toberoot alidata]# cat py_createtable01.py </span><br><span class="line"><span class="meta">#</span><span class="bash">-*- coding : utf8 -*-</span></span><br><span class="line"></span><br><span class="line">def create_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "create table &#123;&#125; (id int);".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    create_table_test('/alidata/cy_table.txt','/alidata/cy_sql1.sql')</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# python /alidata/py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql1.sql </span><br><span class="line">create table base_dict</span><br><span class="line"> (id int);create table biz_advise</span><br><span class="line"> (id int);create table biz_bank</span><br><span class="line"> (id int);create table biz</span><br><span class="line"> (id int);create table biz_gift</span><br><span class="line"> (id int);create table biz_gprs_bind</span><br><span class="line"> (id int);create table biz_gprs_bind_his</span><br><span class="line"> (id int);create table biz_msg_template</span><br><span class="line"> (id int);create table biz_take_bank</span><br><span class="line"> (id int);create table biz_take</span><br><span class="line">çœç•¥ã€‚ã€‚ã€‚</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å…¥æµ‹è¯•è¡¨ç»“æ„</span></span><br><span class="line">[root@toberoot alidata]# mysql -e "show databases"</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">[root@toberoot alidata]# mysql -e "create database cy;"</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; /alidata/cy_sql1.sql </span><br><span class="line">[root@toberoot alidata]# mysql -e "desc cy.sys_res"</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| Field | Type    | Null | Key | Default | Extra |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| id    | int(11) | YES  |     | NULL    |       |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¼€å§‹è·å–è¡¨ç»“æ„ä¸­åˆ—çš„ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# service mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@toberoot alidata]# yes|cp ~/home/cy02/*.frm /alidata/mysql/data/cy/</span><br><span class="line">cp: overwrite â€˜/alidata/mysql/data/cy/base_dict.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_advise.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_bank.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_gift.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_gprs_bind.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_gprs_bind_his.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_msg_template.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take_bank.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take_wwlt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take_wx.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_vip.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wlt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wx_focus.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wx.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wx_walt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/cfg_area.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/cfg_id_gen.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/gprs_model.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_coin_chged.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_coin.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_oauth.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_pay.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_prizen.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_recharge.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_wallet_chged.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_wallet.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_item.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_ali.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_coin.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_return.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_wlt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_wx.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_base_args.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_bug_rpt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_cmd.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_cmd_invoke.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_coin_rpt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_coin_rpt_log.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_gprs_bind.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_gprs_bind_his.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_instl_imgs.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_instl_pos.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_instl_pos_model.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_mod_attr.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_mod_attr_val.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_model.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_mod_sku.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_onl_log.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_sp_args.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_sp_arg_vals.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/sys_acct.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/sys_acct_res.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/sys_res.frmâ€™? [root@toberoot alidata]# </span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# cat py_createtable01.py </span><br><span class="line"><span class="meta">#</span><span class="bash">-*- coding : utf8 -*-</span></span><br><span class="line"></span><br><span class="line">def create_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "create table &#123;&#125; (id int);".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line">   </span><br><span class="line">def desc_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "desc &#123;&#125;;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close()</span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    #create_table_test('/alidata/cy_table.txt','/alidata/cy_sql1.sql')</span><br><span class="line">    desc_table_test('/alidata/cy_table.txt','/alidata/cy_sql2.sql')</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# python py_createtable01.py</span><br><span class="line">[root@toberoot alidata]# head cy_sql2.sql </span><br><span class="line">desc base_dict</span><br><span class="line">;desc biz_advise</span><br><span class="line">;desc biz_bank</span><br><span class="line">;desc biz</span><br><span class="line">;desc biz_gift</span><br><span class="line">;desc biz_gprs_bind</span><br><span class="line">;desc biz_gprs_bind_his</span><br><span class="line">;desc biz_msg_template</span><br><span class="line">;desc biz_take_bank</span><br><span class="line">;desc biz_take</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆªå–åŒ…å«åˆ—åçš„æŠ¥é”™</span></span><br><span class="line">[root@toberoot alidata]# grep contains  mysql/dataerror.log &gt; cy_error1.log</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠ¥é”™æ ¼å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">2018-05-17T07:58:32.926555Z 3 [Warning] InnoDB: Table cy/base_dict contains 1 user defined columns in InnoDB, but 11 columns in MySQL. Please check INFORMATION_SCHEMA.INNODB_SYS_COLUMNS and http://dev.mysql.com/doc/refman/5.7/en/innodb-troubleshooting.html for how to resolve the issue.</span><br><span class="line">2018-05-17T07:59:03.555492Z 4 [Warning] InnoDB: Table cy/biz_advise contains 1 user defined columns in InnoDB, but 7 columns in MySQL. Please check INFORMATION_SCHEMA.INNODB_SYS_COLUMNS and http://dev.mysql.com/doc/refman/5.7/en/innodb-troubleshooting.html for how to resolve the issue.</span><br><span class="line">2018-05-17T07:59:03.556045Z 4 [Warning] InnoDB: Table cy/biz_bank contains 1 user defined columns in InnoDB, but 7 columns in MySQL. Please check INFORMATION_SCHEMA.INNODB_SYS_COLUMNS and http://dev.mysql.com/doc/refman/5.7/en/innodb-troubleshooting.html for how to resolve the issue.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†è¡¨åå’Œåˆ—æ•°å­˜æ”¾è‡³æ–‡ä»¶ä¸­</span></span><br><span class="line">[root@toberoot alidata]# awk '&#123;print $6,$15&#125;' cy_error1.log | awk -F '/' '&#123;print $2&#125;' &gt; cy_table_col.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ ¹æ®ä»¥ä¸Šè¡¨åå’Œåˆ—æ•°ç”Ÿæˆæ–°çš„æµ‹è¯•è¡¨</span></span><br><span class="line">def create_table_col(table_col_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_col_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    # b_list = ['t1 10','t2 20']</span><br><span class="line">    str_list = []</span><br><span class="line">    for table_col_str in b_list:</span><br><span class="line">        table_col_list = table_col_str.split()</span><br><span class="line">	table = table_col_list[0]</span><br><span class="line">	col = int(table_col_list[1])</span><br><span class="line">        string = "create table &#123;&#125; (".format(table)</span><br><span class="line">        str_list.append(string)</span><br><span class="line">	for i in range(1,col+1):</span><br><span class="line">            if i!=col:</span><br><span class="line">                string = 'id&#123;&#125; int,'.format(i)</span><br><span class="line">	    else:</span><br><span class="line">                string = 'id&#123;&#125; int);'.format(i)</span><br><span class="line">            str_list.append(string)</span><br><span class="line">    for line in str_list:</span><br><span class="line">        a_file.write(line)</span><br><span class="line">    a_file.close()</span><br><span class="line"></span><br><span class="line">create_table_col('/alidata/cy_table_col.txt','/alidata/cy_sql3.sql')</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤è¿™äº›æµ‹è¯•è¡¨</span></span><br><span class="line">[root@toberoot alidata]# vim py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# python py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# ll</span><br><span class="line">total 60</span><br><span class="line">-rw-r--r--  1 root  root  16729 May 17 16:00 cy_error1.log</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 15:12 cy_sql1.sql</span><br><span class="line">-rw-r--r--  1 root  root   1047 May 17 15:56 cy_sql2.sql</span><br><span class="line">-rw-r--r--  1 root  root   6353 May 17 16:15 cy_sql3.sql</span><br><span class="line">-rw-r--r--  1 root  root   1395 May 17 16:17 cy_sql4.sql</span><br><span class="line">-rw-r--r--  1 root  root    837 May 17 16:03 cy_table_col.txt</span><br><span class="line">-rw-r--r--  1 root  root    699 May 17 15:56 cy_table.txt</span><br><span class="line">drwxr-xr-x  3 root  root   4096 May 17 12:12 install</span><br><span class="line">drwxr-xr-x 11 mysql mysql  4096 May 17 15:44 mysql</span><br><span class="line">-rw-r--r--  1 root  root   1798 May 17 16:17 py_createtable01.py</span><br><span class="line"><span class="meta">#</span><span class="bash">pythonä»£ç å¦‚ä¸‹ï¼š</span></span><br><span class="line">def drop_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "drop table &#123;&#125;;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close()</span><br><span class="line"></span><br><span class="line">drop_table_test('/alidata/cy_table.txt','/alidata/cy_sql4.sql')</span><br><span class="line">    </span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql4.sql </span><br><span class="line">drop table base_dict</span><br><span class="line">;drop table biz_advise</span><br><span class="line">;drop table biz_bank</span><br><span class="line">;drop table biz</span><br><span class="line">;drop table biz_gift</span><br><span class="line">;drop table biz_gprs_bind</span><br><span class="line">;drop table biz_gprs_bind_his</span><br><span class="line">;drop table biz_msg_template</span><br><span class="line">;drop table biz_take_bank</span><br><span class="line">;drop table biz_take</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ é™¤æ•°æ®åº“çš„æ—¶å€™ç›´æ¥å¡æ­»äº†ï¼ŒåŸå› æœªçŸ¥ã€‚ä¹Ÿæ²¡æœ‰æŠ¥é”™ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash">æ¸…æ•°æ®å¯åŠ¨æœåŠ¡</span></span><br><span class="line"></span><br><span class="line">ln: failed to create symbolic link â€˜/usr/local/mysql/bin/mysqldâ€™: File exists</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot ~]# mysql -e 'create database cy'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¼€å§‹å°è¯•è·å–è¡¨çš„ç»“æ„</span></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql3.sql</span><br><span class="line">[root@toberoot alidata]# service mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@toberoot alidata]# cp ~/home/cy02/*.frm /alidata/mysql/data/cy/ -p</span><br><span class="line">cp: overwrite â€˜/alidata/mysql/data/cy/base_dict.frmâ€™? ^C</span><br><span class="line">[root@toberoot alidata]# yes | cp ~/home/cy02/*.frm /alidata/mysql/data/cy/ -p</span><br><span class="line">[root@toberoot alidata]# ll /alidata/mysql/data/cy/sys_res*</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9106 Aug 14  2017 /alidata/mysql/data/cy/sys_res.frm</span><br><span class="line">-rw-r----- 1 mysql mysql 98304 May 17 16:44 /alidata/mysql/data/cy/sys_res.ibd</span><br><span class="line"><span class="meta">#</span><span class="bash"> é…ç½®æ–‡ä»¶</span></span><br><span class="line">[mysqld]</span><br><span class="line">innodb_force_recovery=6</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# service mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¡¨ç»“æ„æˆåŠŸè·å–</span></span><br><span class="line">[root@toberoot alidata]# mysql cy -e 'desc sys_res'</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type         | Null | Key | Default | Extra |</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">| ID     | varchar(64)  | NO   | PRI | NULL    |       |</span><br><span class="line">| NAME   | varchar(32)  | NO   |     | NULL    |       |</span><br><span class="line">| CODE   | varchar(128) | NO   |     | NULL    |       |</span><br><span class="line">| URI    | varchar(128) | NO   |     | NULL    |       |</span><br><span class="line">| LOGO   | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| TYPE   | int(11)      | NO   |     | NULL    |       |</span><br><span class="line">| PCODE  | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| SORT   | int(11)      | YES  |     | 0       |       |</span><br><span class="line">| STATE  | int(11)      | NO   |     | NULL    |       |</span><br><span class="line">| ADMIN  | int(11)      | YES  |     | 0       |       |</span><br><span class="line">| REMARK | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| CRTIME | datetime     | NO   |     | NULL    |       |</span><br><span class="line">| UPTIME | datetime     | NO   |     | NULL    |       |</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">root@MySQL-01 16:49:  [(none)]&gt; select table_name,table_schema from information_schema.tables where table_schema='cy';</span><br><span class="line">+----------------------+--------------+</span><br><span class="line">| table_name           | table_schema |</span><br><span class="line">+----------------------+--------------+</span><br><span class="line">| base_dict            | cy           |</span><br><span class="line">| biz                  | cy           |</span><br><span class="line">| biz_advise           | cy           |</span><br><span class="line">| biz_bank             | cy           |</span><br><span class="line">| biz_gift             | cy           |</span><br><span class="line">| biz_gprs_bind        | cy           |</span><br><span class="line">| biz_gprs_bind_his    | cy           |</span><br><span class="line">| biz_msg_template     | cy           |</span><br><span class="line">| biz_take             | cy           |</span><br><span class="line">| biz_take_bank        | cy           |</span><br><span class="line">| biz_take_wwlt        | cy           |</span><br><span class="line">| biz_take_wx          | cy           |</span><br><span class="line">| biz_vip              | cy           |</span><br><span class="line">| biz_wlt              | cy           |</span><br><span class="line">| biz_wx               | cy           |</span><br><span class="line">| biz_wx_focus         | cy           |</span><br><span class="line">| biz_wx_walt          | cy           |</span><br><span class="line">| cfg_area             | cy           |</span><br><span class="line">| cfg_id_gen           | cy           |</span><br><span class="line">| gprs_model           | cy           |</span><br><span class="line">| mbr                  | cy           |</span><br><span class="line">| mbr_coin             | cy           |</span><br><span class="line">| mbr_coin_chged       | cy           |</span><br><span class="line">| mbr_oauth            | cy           |</span><br><span class="line">| mbr_pay              | cy           |</span><br><span class="line">| mbr_prizen           | cy           |</span><br><span class="line">| mbr_recharge         | cy           |</span><br><span class="line">| mbr_wallet           | cy           |</span><br><span class="line">| mbr_wallet_chged     | cy           |</span><br><span class="line">| ord                  | cy           |</span><br><span class="line">| ord_item             | cy           |</span><br><span class="line">| ord_pay_ali          | cy           |</span><br><span class="line">| ord_pay_coin         | cy           |</span><br><span class="line">| ord_pay_return       | cy           |</span><br><span class="line">| ord_pay_wlt          | cy           |</span><br><span class="line">| ord_pay_wx           | cy           |</span><br><span class="line">| prod                 | cy           |</span><br><span class="line">| prod_base_args       | cy           |</span><br><span class="line">| prod_bug_rpt         | cy           |</span><br><span class="line">| prod_cmd             | cy           |</span><br><span class="line">| prod_cmd_invoke      | cy           |</span><br><span class="line">| prod_coin_rpt        | cy           |</span><br><span class="line">| prod_coin_rpt_log    | cy           |</span><br><span class="line">| prod_gprs_bind       | cy           |</span><br><span class="line">| prod_gprs_bind_his   | cy           |</span><br><span class="line">| prod_instl_imgs      | cy           |</span><br><span class="line">| prod_instl_pos       | cy           |</span><br><span class="line">| prod_instl_pos_model | cy           |</span><br><span class="line">| prod_mod_attr        | cy           |</span><br><span class="line">| prod_mod_attr_val    | cy           |</span><br><span class="line">| prod_mod_sku         | cy           |</span><br><span class="line">| prod_model           | cy           |</span><br><span class="line">| prod_onl_log         | cy           |</span><br><span class="line">| prod_sp_arg_vals     | cy           |</span><br><span class="line">| prod_sp_args         | cy           |</span><br><span class="line">| sys_acct             | cy           |</span><br><span class="line">| sys_acct_res         | cy           |</span><br><span class="line">| sys_res              | cy           |</span><br><span class="line">+----------------------+--------------+</span><br><span class="line">58 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 58å¼ è¡¨dumpå¤‡ä»½å‡ºæ¥</span></span><br><span class="line">[root@toberoot alidata]# mysqldump -B cy -d &gt; /alidata/new_yc_ddl.sql</span><br><span class="line">[root@toberoot alidata]# tail -n 30 /alidata/new_yc_ddl.sql </span><br><span class="line">/*!40101 SET @saved_cs_client     = @@character_set_client */;</span><br><span class="line">/*!40101 SET character_set_client = utf8 */;</span><br><span class="line">CREATE TABLE `sys_res` (</span><br><span class="line">  `ID` varchar(64) NOT NULL COMMENT 'ID',</span><br><span class="line">  `NAME` varchar(32) NOT NULL COMMENT 'èœå•åç§°',</span><br><span class="line">  `CODE` varchar(128) NOT NULL COMMENT 'èœå•ç¼–ç ',</span><br><span class="line">  `URI` varchar(128) NOT NULL COMMENT 'URI',</span><br><span class="line">  `LOGO` varchar(64) DEFAULT NULL COMMENT 'å›¾æ ‡',</span><br><span class="line">  `TYPE` int(11) NOT NULL COMMENT '@èœå•ç±»å‹ï¼ˆ1èœå•ï¼›2æŒ‰é’®ï¼‰',</span><br><span class="line">  `PCODE` varchar(64) DEFAULT NULL COMMENT 'çˆ¶èœå•',</span><br><span class="line">  `SORT` int(11) DEFAULT '0' COMMENT 'æ’åº',</span><br><span class="line">  `STATE` int(11) NOT NULL COMMENT '@@çŠ¶æ€ï¼ˆ0 æ— æ•ˆï¼›1 æ­£å¸¸ï¼‰',</span><br><span class="line">  `ADMIN` int(11) DEFAULT '0' COMMENT 'æ˜¯å¦ç®¡ç†å‘˜èœå•ï¼ˆé»˜è®¤0å¦ï¼‰',</span><br><span class="line">  `REMARK` varchar(64) DEFAULT NULL COMMENT 'å¤‡æ³¨',</span><br><span class="line">  `CRTIME` datetime NOT NULL COMMENT 'CRTIME',</span><br><span class="line">  `UPTIME` datetime NOT NULL COMMENT 'UPTIME',</span><br><span class="line">  PRIMARY KEY (`ID`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='æƒé™_ç³»ç»Ÿèµ„æº';</span><br><span class="line">/*!40101 SET character_set_client = @saved_cs_client */;</span><br><span class="line">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;</span><br><span class="line"></span><br><span class="line">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;</span><br><span class="line">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;</span><br><span class="line">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;</span><br><span class="line">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;</span><br><span class="line">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;</span><br><span class="line">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;</span><br><span class="line">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;</span><br><span class="line"></span><br><span class="line">-- Dump completed on 2018-05-17 16:52:28</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> discardå’Œimportå‘½ä»¤</span></span><br><span class="line">def discard_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "alter table &#123;&#125; discard tablespace;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def import_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "alter table &#123;&#125; import tablespace;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">discard_table_test('/alidata/cy_table.txt','/alidata/cy_sql5.sql')</span><br><span class="line">import_table_test('/alidata/cy_table.txt','/alidata/cy_sql6.sql')</span><br><span class="line">   </span><br><span class="line"><span class="meta">#</span><span class="bash"> ç”Ÿæˆsql</span></span><br><span class="line">[root@toberoot alidata]# python py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# ll</span><br><span class="line">total 124</span><br><span class="line">-rw-r--r--  1 root  root  16729 May 17 16:00 cy_error1.log</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 15:12 cy_sql1.sql</span><br><span class="line">-rw-r--r--  1 root  root   1047 May 17 15:56 cy_sql2.sql</span><br><span class="line">-rw-r--r--  1 root  root   6353 May 17 16:15 cy_sql3.sql</span><br><span class="line">-rw-r--r--  1 root  root   1395 May 17 16:17 cy_sql4.sql</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 16:55 cy_sql5.sql</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 16:55 cy_sql6.sql</span><br><span class="line">-rw-r--r--  1 root  root    837 May 17 16:03 cy_table_col.txt</span><br><span class="line">-rw-r--r--  1 root  root    699 May 17 15:56 cy_table.txt</span><br><span class="line">drwxr-xr-x  3 root  root   4096 May 17 16:41 install</span><br><span class="line">drwxr-xr-x 11 mysql mysql  4096 May 17 16:47 mysql</span><br><span class="line">-rw-r--r--  1 root  root  57068 May 17 16:52 new_yc_ddl.sql</span><br><span class="line">-rw-r--r--  1 root  root   2489 May 17 16:55 py_createtable01.py</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql5.sql </span><br><span class="line">alter table base_dict</span><br><span class="line"> discard tablespace;alter table biz_advise</span><br><span class="line"> discard tablespace;alter table biz_bank</span><br><span class="line"> discard tablespace;alter table biz</span><br><span class="line"> discard tablespace;alter table biz_gift</span><br><span class="line"> discard tablespace;alter table biz_gprs_bind</span><br><span class="line"> discard tablespace;alter table biz_gprs_bind_his</span><br><span class="line"> discard tablespace;alter table biz_msg_template</span><br><span class="line"> discard tablespace;alter table biz_take_bank</span><br><span class="line"> discard tablespace;alter table biz_take</span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql6.sql </span><br><span class="line">alter table base_dict</span><br><span class="line"> import tablespace;alter table biz_advise</span><br><span class="line"> import tablespace;alter table biz_bank</span><br><span class="line"> import tablespace;alter table biz</span><br><span class="line"> import tablespace;alter table biz_gift</span><br><span class="line"> import tablespace;alter table biz_gprs_bind</span><br><span class="line"> import tablespace;alter table biz_gprs_bind_his</span><br><span class="line"> import tablespace;alter table biz_msg_template</span><br><span class="line"> import tablespace;alter table biz_take_bank</span><br><span class="line"> import tablespace;alter table biz_take</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql</span><br><span class="line">ERROR 1036 (HY000) at line 1: Table 'base_dict' is read only</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# service mysqld restart</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# cp /root/home/cy02/*.ibd /alidata/mysql/data/cy/ -rp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line">ERROR 2013 (HY000) at line 1: Lost connection to MySQL server during query</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# service mysqld restart</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line">ERROR 1036 (HY000) at line 1: Table 'base_dict' is read only</span><br><span class="line">[root@toberoot alidata]# service mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@toberoot alidata]# rm -rf /alidata/mysql/data/*</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# service mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot alidata]# mysql &lt; new_yc_ddl.sql </span><br><span class="line">[root@toberoot alidata]# mysql -e 'use cy;select * from sys_res'</span><br><span class="line"></span><br><span class="line">å¼€å¯å¼ºåˆ¶æ¢å¤å‚æ•°</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql</span><br><span class="line">cy_sql1.sql  cy_sql2.sql  cy_sql3.sql  cy_sql4.sql  cy_sql5.sql  cy_sql6.sql  </span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql </span><br><span class="line">[root@toberoot alidata]# cp /root/home/cy02/*.ibd /alidata/mysql/data/cy/ -rp</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å…¨å¤‡ä»½æ•°æ®</span></span><br><span class="line">[root@toberoot alidata]# mysqldump -B cy &gt; new_cy_all.sql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å¤‡ä»½çš„æ•°æ®é‡</span></span><br><span class="line">-rw-r--r--  1 root  root   26M May 17 17:13 new_cy_all.sql</span><br></pre></td></tr></table></figure>

<h2 id="æŠ¥é”™æ±‡æ€»"><a href="#æŠ¥é”™æ±‡æ€»" class="headerlink" title="æŠ¥é”™æ±‡æ€»"></a>æŠ¥é”™æ±‡æ€»</h2><h3 id="ERROR-1036-ï¼ˆHY00ï¼‰"><a href="#ERROR-1036-ï¼ˆHY00ï¼‰" class="headerlink" title="ERROR 1036 ï¼ˆHY00ï¼‰"></a>ERROR 1036 ï¼ˆHY00ï¼‰</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql</span><br><span class="line">ERROR 1036 (HY000) at line 1: Table 'base_dict' is read only</span><br></pre></td></tr></table></figure>

<p>è§£å†³æ–¹æ³•ï¼š</p>
<ol>
<li>æ£€æŸ¥æ˜¯å¦é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨innodb_force_recoveryå‚æ•°</li>
<li>å¦‚æœå­˜åœ¨å»é™¤æˆ–æ³¨é‡Šæ‰ï¼Œé‡å¯æœåŠ¡å³å¯</li>
<li>è¿˜ä¸è¡Œå°±æ¸…ç©ºæ•°æ®åº“å¯¼å…¥ç»“æ„åå†ç»§ç»­</li>
</ol>
<h3 id="ERROR-2013-HY000"><a href="#ERROR-2013-HY000" class="headerlink" title="ERROR 2013 (HY000)"></a>ERROR 2013 (HY000)</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line">ERROR 2013 (HY000) at line 1: Lost connection to MySQL server during query</span><br></pre></td></tr></table></figure>

<p>è§£å†³æ–¹æ³•ï¼š</p>
<ol>
<li><p>sqlè„šæœ¬ä¸­æ‰§è¡Œimport tablespaceçš„æ“ä½œéœ€è¦å¼€å¯recoveryçš„å‚æ•°</p>
</li>
<li><p>é‡å¯æœåŠ¡ </p>
<p>åœ¨å®¢æˆ·æœåŠ¡ä¸Šï¼Œæ‰§è¡Œä»¥ä¸Šæ“ä½œè¿˜æ˜¯æŠ¥é”™æ— æ³•è¿æ¥ï¼Œå°è¯•å¤šæ¬¡éƒ½ä¸è¡Œã€‚</p>
</li>
</ol>
<p><img src="MySQL%E4%B8%80%E6%AC%A1%E6%83%8A%E5%BF%83%E5%8A%A8%E9%AD%84%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%BC%BA%E5%88%B6%E6%81%A2%E5%A4%8D/04.jpg" alt=""></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ¬¡caseçš„æ•™è®­å°±æ˜¯ï¼Œå¤‡ä»½ï¼ä¸€å®šè¦æœ‰å‘¨æœŸæ€§çš„æœ‰æ•ˆå¤‡ä»½ï¼</p>
<p>æ¬ºéª—MySQLè¿›ç¨‹è’™æ··è¿‡å…³åªèƒ½æ˜¯æ²¡åŠæ³•çš„åŠæ³•ï¼Œè€Œä¸”ä¸èƒ½ä¿è¯æˆåŠŸç‡ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -*- coding : utf8 -*-</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> py_createtable01.py</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> authï¼š booboowei</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class mysql_tools():</span><br><span class="line">    def __init__(self, in_file):</span><br><span class="line">        self.b_list = open(in_file).readlines()</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">    def create_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "create table &#123;&#125; (id int);".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def desc_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "desc &#123;&#125;;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def create_table_col(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        str_list = []</span><br><span class="line">        for table_col_str in self.b_list:</span><br><span class="line">            table_col_list = table_col_str.split()</span><br><span class="line">            table = table_col_list[0]</span><br><span class="line">            col = int(table_col_list[1])</span><br><span class="line">            string = "create table &#123;&#125; (".format(table)</span><br><span class="line">            str_list.append(string)</span><br><span class="line">            for i in range(1, col + 1):</span><br><span class="line">                if i != col:</span><br><span class="line">                    string = 'id&#123;&#125; int,'.format(i)</span><br><span class="line">                else:</span><br><span class="line">                    string = 'id&#123;&#125; int);'.format(i)</span><br><span class="line">                str_list.append(string)</span><br><span class="line">        for line in str_list:</span><br><span class="line">            a_file.write(line)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def drop_table_test(self,  sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "drop table &#123;&#125;;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def discard_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "alter table &#123;&#125; discard tablespace;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def import_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "alter table &#123;&#125; import tablespace;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').create_table_test('/alidata/cy_sql1.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').desc_table_test('/alidata/cy_sql2.sql')</span><br><span class="line">    # æ ¹æ®ä»¥ä¸Šè¡¨åå’Œåˆ—æ•°ç”Ÿæˆæ–°çš„æµ‹è¯•è¡¨</span><br><span class="line">    mysql_tools('/alidata/cy_table_col.txt').create_table_col('/alidata/cy_sql3.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').drop_table_test('/alidata/cy_sql4.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').discard_table_test('/alidata/cy_sql5.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').import_table_test('/alidata/cy_sql6.sql')</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>æŠ€æœ¯å¹¿è§’</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>æ•°æ®æ•‘æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLçš„å…ƒé”MDLå‘ç”Ÿåœºæ™¯å’Œè§£å†³æ–¹æ³•æ€»ç»“</title>
    <url>/2017/08/19/booboo_others/MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>æ‘˜è¦ï¼šMetaData Lockå³å…ƒæ•°æ®é”ï¼Œåœ¨æ•°æ®åº“ä¸­å…ƒæ•°æ®å³æ•°æ®å­—å…¸ä¿¡æ¯åŒ…æ‹¬db,table,function,procedure,trigger,eventç­‰ã€‚metadata lockä¸»è¦ä¸ºäº†ä¿è¯å…ƒæ•°æ®çš„ä¸€è‡´æ€§,ç”¨äºå¤„ç†ä¸åŒçº¿ç¨‹æ“ä½œåŒä¸€æ•°æ®å¯¹è±¡çš„åŒæ­¥ä¸äº’æ–¥é—®é¢˜ã€‚</p>
<p>ä»Šå¤©æœ‰å®¢æˆ·(MySQL 5.6)é‡åˆ°è¯¥é—®é¢˜ï¼Œæœ€å…³é”®çš„æ˜¯å±äºç¬¬ä¸‰ç§æƒ…å†µï¼Œgoogleä¸Šæ ¹æœ¬æ‰¾ä¸åˆ°ç±»ä¼¼çš„æ•…éšœæ¡ˆä¾‹ï¼Œå”¯ä¸€ä¸€ä¸ªéå¸¸æ¥è¿‘çš„æ•…éšœæ¡ˆä¾‹ä¸­æ•°æ®åº“ç‰ˆæœ¬å´ä¸åŒï¼ˆå…·ä½“çœ‹ä¸‹æ–‡æ…¢æ…¢èŠï¼‰ï¼Œå“ï¼Œå›°éš¾é‡é‡å•Šï¼Œæœ€ç»ˆè¿˜æ˜¯è§£å†³äº†å“ˆã€‚</p>
<p>alter tableçš„è¯­å¥æ˜¯å¾ˆå±é™©çš„ï¼Œåœ¨æ“ä½œä¹‹å‰æœ€å¥½ç¡®è®¤å¯¹è¦æ“ä½œçš„è¡¨æ²¡æœ‰ä»»ä½•è¿›è¡Œä¸­çš„æ“ä½œã€æ²¡æœ‰æœªæäº¤äº‹åŠ¡ã€ä¹Ÿæ²¡æœ‰æ˜¾å¼äº‹åŠ¡ä¸­çš„æŠ¥é”™è¯­å¥ã€‚å¦‚æœæœ‰alter tableçš„ç»´æŠ¤ä»»åŠ¡ï¼Œåœ¨æ— äººç›‘ç®¡çš„æ—¶å€™è¿è¡Œï¼Œæœ€å¥½é€šè¿‡lock_wait_timeoutè®¾ç½®å¥½è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´çš„metedataé”ç­‰å¾…ã€‚</p>
<a id="more"></a>


<h2 id="ä»€ä¹ˆæ˜¯metadata-lockï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯metadata-lockï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯metadata lockï¼Ÿ"></a>ä»€ä¹ˆæ˜¯metadata lockï¼Ÿ</h2><p>MetaData Lockå³å…ƒæ•°æ®é”ï¼Œåœ¨æ•°æ®åº“ä¸­å…ƒæ•°æ®å³æ•°æ®å­—å…¸ä¿¡æ¯åŒ…æ‹¬db,table,function,procedure,trigger,eventç­‰ã€‚metadata lockä¸»è¦ä¸ºäº†ä¿è¯å…ƒæ•°æ®çš„ä¸€è‡´æ€§,ç”¨äºå¤„ç†ä¸åŒçº¿ç¨‹æ“ä½œåŒä¸€æ•°æ®å¯¹è±¡çš„åŒæ­¥ä¸äº’æ–¥é—®é¢˜ã€‚</p>
<h3 id="MetaData-Lockçš„å‰ä¸–ä»Šç”Ÿ"><a href="#MetaData-Lockçš„å‰ä¸–ä»Šç”Ÿ" class="headerlink" title="MetaData Lockçš„å‰ä¸–ä»Šç”Ÿ"></a><strong>MetaData Lockçš„å‰ä¸–ä»Šç”Ÿ</strong></h3><p>MDLé”æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªæœ‰åçš„<a href="https://bugs.mysql.com/bug.php?id=989" target="_blank" rel="noopener">bug#989</a>ï¼Œæ‰€ä»¥åœ¨5.5.3ç‰ˆæœ¬å¼•å…¥äº†MDLé”ã€‚å…¶å®5.5ä¹Ÿæœ‰ç±»ä¼¼ä¿æŠ¤å…ƒæ•°æ®çš„æœºåˆ¶ï¼Œåªæ˜¯æ²¡æœ‰æ˜ç¡®æå‡ºMDLæ¦‚å¿µè€Œå·²ã€‚ä½†æ˜¯5.5ä¹‹å‰ç‰ˆæœ¬(æ¯”å¦‚5.1)ä¸5.5ä¹‹åç‰ˆæœ¬åœ¨ä¿æŠ¤å…ƒæ•°æ®è¿™å—æœ‰ä¸€ä¸ªæ˜¾è‘—çš„ä¸åŒç‚¹æ˜¯ï¼Œ5.1å¯¹äºå…ƒæ•°æ®çš„ä¿æŠ¤æ˜¯è¯­å¥çº§åˆ«çš„ï¼Œ5.5å¯¹äºmetadataçš„ä¿æŠ¤æ˜¯äº‹åŠ¡çº§åˆ«çš„ã€‚æ‰€è°“è¯­å¥çº§åˆ«ï¼Œå³è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œæ— è®ºäº‹åŠ¡æ˜¯å¦æäº¤æˆ–å›æ»šï¼Œå…¶è¡¨ç»“æ„å¯ä»¥è¢«å…¶ä»–ä¼šè¯æ›´æ–°ï¼›è€Œäº‹åŠ¡çº§åˆ«åˆ™æ˜¯åœ¨äº‹åŠ¡ç»“æŸåæ‰é‡Šæ”¾MDLã€‚å¼•å…¥MDLé”ä¸»è¦æ˜¯ä¸ºäº†<strong>è§£å†³ä¸¤ä¸ªé—®é¢˜</strong>ï¼š</p>
<ul>
<li>äº‹åŠ¡éš”ç¦»é—®é¢˜ï¼šæ¯”å¦‚åœ¨å¯é‡å¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¼šè¯Aåœ¨2æ¬¡æŸ¥è¯¢æœŸé—´ï¼Œä¼šè¯Bå¯¹è¡¨ç»“æ„åšäº†ä¿®æ”¹ï¼Œä¸¤æ¬¡æŸ¥è¯¢ç»“æœå°±ä¼šä¸ä¸€è‡´ï¼Œæ— æ³•æ»¡è¶³å¯é‡å¤è¯»çš„è¦æ±‚ã€‚</li>
<li>æ•°æ®å¤åˆ¶é—®é¢˜ï¼šæ¯”å¦‚ä¼šè¯Aæ‰§è¡Œäº†å¤šæ¡æ›´æ–°è¯­å¥æœŸé—´ï¼Œå¦å¤–ä¸€ä¸ªä¼šè¯Båšäº†è¡¨ç»“æ„å˜æ›´å¹¶ä¸”å…ˆæäº¤ï¼Œå°±ä¼šå¯¼è‡´slaveåœ¨é‡åšæ—¶ï¼Œå…ˆé‡åšalterï¼Œå†é‡åšupdateæ—¶å°±ä¼šå‡ºç°å¤åˆ¶é”™è¯¯çš„ç°è±¡ã€‚ä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„<a href="https://bugs.mysql.com/bug.php?id=989" target="_blank" rel="noopener">bug#989</a>ã€‚</li>
</ul>
<hr>
<h3 id="DDLæ“ä½œä¸MetaData-Lock"><a href="#DDLæ“ä½œä¸MetaData-Lock" class="headerlink" title="DDLæ“ä½œä¸MetaData Lock"></a>DDLæ“ä½œä¸MetaData Lock</h3><ul>
<li>metadata lock æœºåˆ¶æ˜¯ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§å­˜åœ¨çš„ï¼Œåœ¨æœ‰äº‹åŠ¡çš„æ“ä½œæ—¶å€™ï¼Œéœ€è¦é¦–å…ˆè·å¾—metadata lock ,ç„¶åæ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ï¼Œåˆæ¥äº†ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè¦ddlæ“ä½œåŒä¸€ä¸ªè¡¨ï¼Œå°±ä¼šå‡ºç° metadata lockã€‚</li>
<li>è‡ªåŠ¨æäº¤æ¨¡å¼ä¸‹ï¼Œå•è¯­å¥å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰§è¡Œå®Œäº†ï¼Œäº‹åŠ¡ä¹Ÿå°±ç»“æŸäº†ã€‚</li>
<li>preparestatement  ä¼šè·å¾— metalockï¼Œä¸€æ—¦prepare å®Œæ¯•ï¼Œ metalock å°±é‡Šæ”¾äº†ã€‚</li>
<li>online DDLåº”è¯¥æ˜¯æŒ‡åœ¨alter tableè¿›è¡Œçš„æ—¶å€™ï¼Œ æ’å…¥/ä¿®æ”¹/åˆ é™¤æ•°æ®çš„sqlè¯­å¥ä¸ä¼šWaiting for table metadata lockã€‚ä¸€æ—¦alter table TableAçš„æ“ä½œåœæ»åœ¨Waiting for table metadata lockçš„çŠ¶æ€ï¼Œåç»­å¯¹TableAçš„ä»»ä½•æ“ä½œï¼ˆåŒ…æ‹¬è¯»ï¼‰éƒ½æ— æ³•è¿›è¡Œï¼Œä¹Ÿä¼šåœ¨Opening tablesçš„é˜¶æ®µè¿›å…¥Waiting for table metadata lockçš„é˜Ÿåˆ—ã€‚</li>
</ul>
<h2 id="Alter-table-ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯"><a href="#Alter-table-ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯" class="headerlink" title="Alter table ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯"></a>Alter table ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯</h2><h3 id="åœºæ™¯1"><a href="#åœºæ™¯1" class="headerlink" title="åœºæ™¯1"></a>åœºæ™¯1</h3><ul>
<li>ä¼šè¯Aå¯¹boobooè¡¨æ‰§è¡Œè¯»æ“ä½œ<code>select *,sleep(60) from booboo;</code>ï¼Œæ­£åœ¨è¿›è¡Œæœªæäº¤äº‹åŠ¡</li>
<li>ä¼šè¯Bå¯¹boobooè¡¨æ‰§è¡Œåœ¨çº¿DDLæ“ä½œ<code>alter table booboo add q4 int default 0;</code></li>
<li>ä¼šè¯Cå¯¹boobooè¡¨æ‰§è¡Œéšå¼è¯»æ“ä½œ<code>select *,sleep(60) from booboo;</code>,è¿›è¡Œç­‰å¾…</li>
<li>ä¼šè¯Då¯¹boobooè¡¨æ‰§è¡Œæ˜¾ç¤ºè¯»æ“ä½œ<code>begin;select * from booboo;</code>ä¹Ÿä¼šè¿›è¡Œç­‰å¾…</li>
<li>é€šè¿‡<code>show processlist</code>å¯ä»¥çœ‹åˆ°ä¼šè¯Aï¼ˆå¯¹boobooè¡¨ä¸Šæ­£åœ¨è¿›è¡Œçš„æ“ä½œï¼‰ï¼Œæ­¤æ—¶ä¼šè¯Bï¼ˆalter tableè¯­å¥ï¼‰æ— æ³•è·å–åˆ°metadata ç‹¬å é”ï¼Œä¼šè¿›è¡Œç­‰å¾…ï¼Œä¼šè¯Cå’Œä¼šè¯Déƒ½ä¼šè¿›è¡Œç­‰å¾…ï¼Œä¸”èƒ½ä»processlistè¡¨ä¸­çœ‹åˆ°å¯¹boobooè¡¨çš„æ“ä½œ</li>
<li>ä¼šè¯Aæäº¤äº‹åŠ¡åæˆ–killä¹‹åï¼Œä¼šè¯Cäº‹åŠ¡ç»“æŸï¼Œä¼šè¯D<code>select</code>è¯­å¥æ‰§è¡ŒæˆåŠŸï¼Œäº‹åŠ¡æäº¤åˆ™ä¼šè¯Bå¯æ‰§è¡Œï¼Œå¦åˆ™è¿›å…¥åœºæ™¯2</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;</span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |  167 | Waiting for table metadata lock | alter table booboo add q4 int default 0 |</span><br><span class="line">|  7 | root | localhost | uplooking | Query   |  155 | Waiting for table metadata lock | select * from booboo                    |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">|  9 | root | localhost | uplooking | Query   |  181 | User sleep                      | select *,sleep(60) from booboo          |</span><br><span class="line">| 10 | root | localhost | uplooking | Query   |    7 | Waiting for table metadata lock | select * from booboo                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> id=9çš„çº¿ç¨‹ä¸ºä¼šè¯A è™½ç„¶æ˜¯éšå¼äº‹åŠ¡ï¼Œä½†æ˜¯æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œæ‰€ä»¥ä¸ºæœªæäº¤çš„äº‹åŠ¡</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> id=6çš„çº¿ç¨‹ä¸ºä¼šè¯B åœ¨ä¼šè¯Aæœ‰äº‹åŠ¡æœªæäº¤çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡ŒAlteræ“ä½œ,äº‰æŠ¢metadata lock</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> id=7çš„çº¿ç¨‹ä¸ºä¼šè¯C éšå¼æŸ¥è¯¢äº‹åŠ¡ä¹Ÿä¼šè¿›å…¥ç­‰å¾…</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> id=10çš„çº¿ç¨‹ä¸ºä¼šè¯D æ˜¾ç¤ºæŸ¥è¯¢äº‹åŠ¡åŒæ ·è¿›å…¥ç­‰å¾…</span></span><br></pre></td></tr></table></figure>

<p>è§£å†³æ–¹æ³•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹metadatalock</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ç¬¬ä¸€ç§æƒ…å†µï¼Œåˆ™å®šä½åˆ°é•¿æ—¶é—´æœªæäº¤çš„äº‹åŠ¡killå³å¯</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥è¯¢ information_schema.innodb_trx çœ‹åˆ°æœ‰é•¿æ—¶é—´æœªå®Œæˆçš„äº‹åŠ¡ï¼Œ ä½¿ç”¨ <span class="built_in">kill</span> å‘½ä»¤ç»ˆæ­¢è¯¥æŸ¥è¯¢ã€‚</span></span><br><span class="line"></span><br><span class="line">select concat('kill ',i.trx_mysql_thread_id,';') from information_schema.innodb_trx i,</span><br><span class="line">  (select </span><br><span class="line">         id, time</span><br><span class="line">     from</span><br><span class="line">         information_schema.processlist</span><br><span class="line">     where</span><br><span class="line">         time = (select </span><br><span class="line">                 max(time)</span><br><span class="line">             from</span><br><span class="line">                 information_schema.processlist</span><br><span class="line">             where</span><br><span class="line">                 state = 'Waiting for table metadata lock'</span><br><span class="line">                     and substring(info, 1, 5) in ('alter' , 'optim', 'repai', 'lock ', 'drop ', 'creat'))) p</span><br><span class="line">  where timestampdiff(second, i.trx_started, now()) &gt; p.time</span><br><span class="line">  and i.trx_mysql_thread_id  not in (connection_id(),p.id);</span><br></pre></td></tr></table></figure>



<h3 id="åœºæ™¯2"><a href="#åœºæ™¯2" class="headerlink" title="åœºæ™¯2"></a>åœºæ™¯2</h3><ul>
<li>é€šè¿‡<code>show processlist</code>çœ‹ä¸åˆ°boobooä¸Šæœ‰ä»»ä½•æ“ä½œï¼Œä½†å®é™…ä¸Šå­˜åœ¨æœ‰æœªæäº¤çš„äº‹åŠ¡ï¼Œå¯ä»¥åœ¨<code>information_schema.innodb_trx</code>ä¸­æŸ¥çœ‹åˆ°ã€‚åœ¨äº‹åŠ¡æ²¡æœ‰å®Œæˆä¹‹å‰ï¼Œboobooçš„é”ä¸ä¼šé‡Šæ”¾ï¼Œalter tableåŒæ ·è·å–ä¸åˆ°metadataçš„ç‹¬å é”</li>
<li>ä¼šè¯Dæäº¤äº‹åŠ¡æˆ–å›æ»šæˆ–killï¼Œåˆ™ä¼šè¯Bä¸­çš„Alterå¯ç»§ç»­æ‰§è¡Œ</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœ¨åœºæ™¯1çš„åŸºç¡€ä¸Šï¼Œå°†ä¼šè¯Açš„äº‹åŠ¡å®Œæˆæˆ–è€…<span class="built_in">kill</span>æ‰ï¼Œä¼šè¯Cæ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯ä¼šè¯Bå’Œä¼šè¯Dç»§ç»­è¿›å…¥metadataé”çš„ç­‰å¾…ã€‚åŸå› æ˜¯ä¼šè¯Dè™½ç„¶selectå¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯äº‹åŠ¡æ²¡æœ‰æäº¤ï¼Œåˆ™è¡¨ä¸Šçš„metadataé”è¿˜å­˜åœ¨ï¼Œå¯¼è‡´ä¼šè¯Bçš„ddlæ“ä½œæ— æ³•æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¼šè¯Bå’Œä¼šè¯Dï¼Œæƒ…å†µ1ï¼šçŸ¥é“æœ‰æœªå®Œæˆçš„äº‹åŠ¡Dï¼Œåˆ™ç»“æŸä¼šè¯Dçš„äº‹åŠ¡ï¼Œä¼šè¯Bæ­£å¸¸æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¼šè¯Bå’Œä¼šè¯Dï¼Œæƒ…å†µ2ï¼šä¸çŸ¥é“æœ‰æœªç»“æŸçš„äº‹åŠ¡Dï¼Œå¦‚ä½•æ’é”™å‘¢ï¼Ÿ</span></span><br><span class="line">=================================</span><br><span class="line"></span><br><span class="line">-- è¯·æ ¹æ®å…·ä½“çš„æƒ…æ™¯ä¿®æ”¹æŸ¥è¯¢è¯­å¥</span><br><span class="line">-- å¦‚æœå¯¼è‡´é˜»å¡çš„è¯­å¥çš„ç”¨æˆ·ä¸å½“å‰ç”¨æˆ·ä¸åŒï¼Œè¯·ä½¿ç”¨å¯¼è‡´é˜»å¡çš„è¯­å¥çš„ç”¨æˆ·ç™»å½•æ¥ç»ˆæ­¢ä¼šè¯</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># åœºæ™¯2çš„æƒ…å†µï¼Œæ˜¯åœ¨åœºæ™¯1çš„åŸºç¡€ä¸Šï¼Œè¿˜æ˜¯æœ‰metadatalocké”ï¼ˆ*ä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒä¸ä¼šåœæœåŠ¡ï¼Œå› æ­¤ä¸åœçš„æœ‰æ–°çš„queryå‘é€è¿‡æ¥ï¼Œå°±ä¼šå‡ºç°åœºæ™¯2*ï¼‰ï¼Œåˆ™æ‰‹åŠ¨ç»§ç»­killæ‰é•¿äº‹åŠ¡å³å¯ï¼Œæ³¨æ„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰å¯èƒ½ddlæ“ä½œéœ€è¦ä¿ç•™ï¼ˆ*ä¾‹å¦‚MDLé”å‡ºç°åœ¨ä¸»ä»åŒæ­¥çš„ä»ä¸­ï¼Œä»åº“éœ€è¦å»æ‰§è¡Œä¸»å‘é€çš„è¡¨å˜æ›´ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥å…ˆå°†ä¸»ä»åœæ‰ï¼Œæ‰‹åŠ¨æ‰§è¡Œalteræ“ä½œï¼Œéƒ½å¯ä»¥*ï¼‰ä»¥ä¸‹æ–¹æ³•æ˜¯åœ¨åœæ­¢å¯¹ä»åº“çš„è¯»æ“ä½œåï¼Œå°†éddlçš„è¿æ¥killæ‰</span></span></span><br><span class="line"></span><br><span class="line">select id,State,command from information_schema.processlist where State="Waiting for table metadata lock";</span><br><span class="line">select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx  where trx_mysql_thread_id=id;</span><br><span class="line">show processlist;</span><br><span class="line">select  concat('kill ',trx_mysql_thread_id,';') from information_schema.processlist,information_schema.innodb_trx  where trx_mysql_thread_id=id and State!="Waiting for table metadata lock";</span><br><span class="line"></span><br><span class="line">===============================</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;                                                                                                             </span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |  275 | Waiting for table metadata lock | alter table booboo add q6 int default 0 |</span><br><span class="line">|  7 | root | localhost | uplooking | Sleep   |  269 |                                 | NULL                                    |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">| 10 | root | localhost | uplooking | Sleep   |  249 |                                 | NULL                                    |</span><br><span class="line">| 12 | root | localhost | uplooking | Sleep   |  191 |                                 | NULL                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å½“å‰è¿›ç¨‹å‘ç°é™¤äº†Alterä¹‹å¤–æ²¡æœ‰å¯¹boobooè¡¨çš„æ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx <span class="built_in">where</span> trx_mysql_thread_id=id;</span></span><br><span class="line">+----------+---------------------+---------------------+----+------+-----------+---------+---------------------------------+-----------+-----------------------------------------+</span><br><span class="line">| timediff | sysdate()           | trx_started         | id | USER | DB        | COMMAND | STATE                           | trx_state | trx_query                               |</span><br><span class="line">+----------+---------------------+---------------------+----+------+-----------+---------+---------------------------------+-----------+-----------------------------------------+</span><br><span class="line">| 00:05:38 | 2017-08-18 20:21:07 | 2017-08-18 20:15:29 |  6 | root | uplooking | Query   | Waiting for table metadata lock | RUNNING   | alter table booboo add q6 int default 0 |</span><br><span class="line">| 00:05:38 | 2017-08-18 20:21:07 | 2017-08-18 20:15:29 | 10 | root | uplooking | Sleep   |                                 | RUNNING   | NULL                                    |</span><br><span class="line">+----------+---------------------+---------------------+----+------+-----------+---------+---------------------------------+-----------+-----------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹innodb_trxè¡¨å¯ä»¥çœ‹åˆ°é™¤äº†alterä¹‹å¤–æœ‰æœªå®Œæˆçš„äº‹åŠ¡ï¼Œä½†æ˜¯çœ‹ä¸åˆ°å…·ä½“queryï¼Œå¾—åˆ°çº¿ç¨‹idä¸º10</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°±å¯ä»¥<span class="built_in">kill</span> 10æ¥ç»“æŸäº‹åŠ¡</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¹‹åAlteræ­£å¸¸æ“ä½œ</span></span><br></pre></td></tr></table></figure>

<h3 id="åœºæ™¯3"><a href="#åœºæ™¯3" class="headerlink" title="åœºæ™¯3"></a>åœºæ™¯3</h3><blockquote>
<p>ä¸åœºæ™¯2å¯¹æ¯”çš„ç°è±¡ä¸åŒäºï¼š</p>
<ul>
<li>åœºæ™¯2ï¼šæœªå®Œæˆäº‹åŠ¡ä¸­å­˜åœ¨æœªå®Œæˆäº‹åŠ¡</li>
<li>åœºæ™¯3ï¼šæœªå®Œæˆäº‹åŠ¡ä¸­ä¸å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼šç¡®è®¤æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šï¼Œæ‰¾åˆ°è¯¥äº‹åŠ¡çš„session_idç„¶åæ€æ­»</li>
</ul>
</blockquote>
<ul>
<li>é€šè¿‡<code>show processlist</code>çœ‹ä¸åˆ°<code>booboo</code>è¡¨æœ‰ä»»ä½•æ“ä½œï¼Œåœ¨<code>information_schema.innodb_trx</code>ä¸­ä¹Ÿæ²¡æœ‰ä»»ä½•è¿›è¡Œä¸­çš„äº‹åŠ¡ã€‚</li>
<li>è¿™å¾ˆå¯èƒ½æ˜¯å› ä¸ºåœ¨ä¸€ä¸ªæ˜¾å¼çš„äº‹åŠ¡ä¸­ï¼Œå¯¹<code>booboo</code>è¡¨è¿›è¡Œäº†ä¸€ä¸ªå¤±è´¥çš„æ“ä½œï¼ˆæ¯”å¦‚æŸ¥è¯¢äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å­—æ®µï¼‰ï¼Œè¿™æ—¶äº‹åŠ¡æ²¡æœ‰å¼€å§‹ï¼Œä½†æ˜¯å¤±è´¥è¯­å¥è·å–åˆ°çš„é”ä¾ç„¶æœ‰æ•ˆã€‚ä»<code>performance_schema.events_statements_current</code>è¡¨ä¸­å¯ä»¥æŸ¥åˆ°å¤±è´¥çš„è¯­å¥</li>
<li>ä¹Ÿå°±æ˜¯è¯´é™¤äº†è¯­æ³•é”™è¯¯ï¼Œå…¶ä»–é”™è¯¯è¯­å¥è·å–åˆ°çš„é”åœ¨è¿™ä¸ªäº‹åŠ¡æäº¤æˆ–å›æ»šä¹‹å‰ï¼Œä»ç„¶ä¸ä¼šé‡Šæ”¾æ‰ã€‚<code>because the failed statement is written to the binary log and the locks protect log consistency</code>ä½†æ˜¯è§£é‡Šè¿™ä¸€è¡Œä¸ºçš„åŸå› å¾ˆéš¾ç†è§£ï¼Œå› ä¸ºé”™è¯¯çš„è¯­å¥æ ¹æœ¬ä¸ä¼šè¢«è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—</li>
<li>è§£å†³æ–¹æ³•ï¼šç¡®è®¤æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šï¼Œæ‰¾åˆ°è¯¥äº‹åŠ¡çš„sessionidç„¶åæ€æ­»ï¼ˆéš¾ç‚¹ï¼‰</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœºæ™¯3çš„å‡ºç°å’Œå‰ä¸¤ç§ä¸åŒ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹çº¿ç¨‹æƒ…å†µï¼Œçœ‹åˆ°alteræ“ä½œmetadataé”ï¼Œè¿˜æœ‰å…¶ä»–çš„selectæ“ä½œæœ‰metadataé”</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ç¬¬ä¸€ååº”å°±æ˜¯æœ‰å¯èƒ½æ˜¯åœºæ™¯1ï¼Œäºæ˜¯killæ‰æ‰§è¡Œselectçš„çº¿ç¨‹ï¼Œå†æ¬¡æŸ¥çœ‹çº¿ç¨‹æƒ…å†µï¼Œå°±åªå‰©ä¸‹æ‰§è¡Œalterçº¿ç¨‹äº†</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ¥ä¸‹æ¥æŸ¥çœ‹æœªå®Œæˆçš„äº‹åŠ¡ï¼Œå¦‚æœæ˜¯åœºæ™¯1ï¼Œåœ¨killæ‰å†²çªçš„çº¿ç¨‹ååº”è¯¥å‡ºç°ä¸¤ç§æƒ…å†µï¼ˆA.alteræ“ä½œæ­£å¸¸æ‰§è¡ŒB.çº¿ç¨‹ä¸­åªæœ‰alteræ“ä½œä¸ºwaiting metadata lockçŠ¶æ€ï¼›æœªå®Œæˆäº‹åŠ¡ä¸­å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼‰</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ä½†æ˜¯å´å‘ç°å’ŒBæƒ…å†µæœ‰æ‰€ä¸åŒçš„æ˜¯ï¼šæœªå®Œæˆäº‹åŠ¡ä¸­ä¸å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼Œæ€»ç»“ç¬¬ä¸‰ç§æƒ…å†µ(C.çº¿ç¨‹ä¸­åªæœ‰alteræ“ä½œä¸ºwaiting metadata lockçŠ¶æ€ï¼›æœªå®Œæˆäº‹åŠ¡ä¸­ä¸å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼‰</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡æœç´¢èµ„æ–™å®šä½åˆ°æ˜¯åœºæ™¯3ï¼Œä½†èµ„æ–™ä¸­æ²¡æœ‰è¯´æ€ä¹ˆè§£å†³é—®é¢˜ï¼Œåˆä¸èƒ½é‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼Œåªæœ‰ä¸€ä¸ªèµ„æ–™é‡Œæåˆ°äº†æ–¹æ³•ï¼ˆç¡®è®¤æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šï¼Œæ‰¾åˆ°è¯¥äº‹åŠ¡çš„sessionidç„¶åæ€æ­»ï¼Œå…³é”®å°±æ˜¯å¦‚ä½•æ‰¾åˆ°sessionidå‘¢ï¼Ÿperformance_schema.events_statements_currentä¸­çš„thread_idä¸ºçº¿ç¨‹idå¹¶ä¸æ˜¯sessionidæˆ–è€…è¯´ä¼šè¯idã€è¿æ¥idï¼Œå¦‚ä½•é€šè¿‡thread_idæ‰¾åˆ°session_idæˆä¸ºäº†éš¾ç‚¹ï¼Ÿ5.7ä¸­æœ‰ä¸ªsessionè¡¨å¯ä»¥ç›´æ¥æŸ¥åˆ°ï¼Œè€Œ5.6ä¸­å¿…é¡»é€šè¿‡ä¸‰è¡¨æ‰èƒ½æŸ¥åˆ°ï¼Œåˆ†åˆ«ä¸ºperformance_schema.events_statements_current,performance_schema.threads,information_schema.processlistè¡¨ã€‚ï¼‰</span></span><br><span class="line">=====================================================================================</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">kill</span>æ‰é™¤äº†å†™æ“ä½œä»¥å¤–çš„query</span></span><br><span class="line">select concat('kill ',id) from information_schema.processlist where State="Waiting for table metadata lock" and substring(info, 1, 5) not in ('alter' , 'optim', 'repai', 'lock ', 'drop ', 'creat');</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯»æ‰¾æœªæäº¤æˆ–æœªå›æ»šçš„é”™è¯¯äº‹åŠ¡ï¼Œå¹¶<span class="built_in">kill</span>å³å¯</span></span><br><span class="line">select t.processlist_id,t.processlist_time,e.sql_text from performance_schema.threads t,performance_schema.events_statements_current e where t.thread_id=e.thread_id and e.SQL_TEXT like '%t1%';</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¡ˆä¾‹ä¸­å‡è®¾æ˜¯åœ¨t1è¡¨ä¸Šæœ‰MDLé”ï¼Œåˆ™ï¼Œe.sql_text è¿‘ä¼¼åŒ¹é…t1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ¬æ–¹æ³•5.5 5.6 5.7 éƒ½é€šç”¨ã€‚</span></span><br><span class="line">=============================================================================</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ­¥ï¼šæ¨¡æ‹Ÿç¬¬ä¸‰ç§æƒ…å†µï¼Œä¼šè¯11æ‰§è¡Œä¸€ä¸ªæ˜¾ç¤ºäº‹åŠ¡ï¼Œä¸”queryå‡ºç°åˆ—é”™è¯¯ï¼Œt1è¡¨ä¸­ä¸å­˜åœ¨xxåˆ—ï¼Œä¸æäº¤ã€‚</p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93%5Cmdl01.png" alt=""></p>
<p>ç¬¬äºŒæ­¥ï¼šä¼šè¯14ä¸­æ‰§è¡Œalteræ“ä½œ</p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl02.png" alt="mdl02"></p>
<p>ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œä¸€æ¡query</p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl03.png" alt="mdl03"></p>
<p>ç¬¬å››æ­¥ï¼šä¼šè¯15æ‰§è¡Œä¸€ä¸ªæ˜¾ç¤ºäº‹åŠ¡ï¼ŒæŸ¥è¯¢t1è¡¨</p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl04.png" alt="mdl04"></p>
<p>ç¬¬äº”æ­¥ï¼šæŸ¥çœ‹å½“å‰çš„processlistæƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°åªè¦æ˜¯å¯¹t1è¡¨çš„æ“ä½œéƒ½å‡ºç°äº†MDLé”ç­‰å¾…ï¼›å°è¯•é€šè¿‡ç¬¬ä¸€ç§æƒ…å†µçš„è§£å†³æ–¹æ³•æ‰¾å‡ºé˜»å¡çš„äº‹åŠ¡ä¼šè¯è¿›è¡Œkillï¼Œå‘ç°ä¸å­˜åœ¨é˜»å¡ä¼šè¯ï¼›æŸ¥çœ‹å½“å‰æœªæäº¤çš„äº‹åŠ¡å‘ç°è¿”å›ç©ºï¼›é€šè¿‡è¿‡æ»¤processlistä¸­è¿›è¡ŒMDLé”ç­‰å¾…ä¸”ä¸æ˜¯alterçš„ä¼šè¯idï¼Œè¿›è¡Œkillã€‚</p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl06.png" alt="mdl06"></p>
<p>ç¬¬å…­æ­¥ï¼šåªkill 12ï¼Œ15ï¼Œç•™ä¸‹æ‰§è¡Œalterçš„ä¼šè¯14ï¼›æœ‰äººä¼šæƒ³ä¸ºä»€ä¹ˆéƒ½killæ‰å‘¢ï¼Ÿå› ä¸ºå³ä½¿ç°åœ¨killæ‰äº†ï¼Œt1è¡¨çš„MDLé”ä¹Ÿä¸ä¼šé‡Šæ”¾æ‰ï¼Œè¿˜ä¸å¦‚ç•™ä¸‹ä¼šè¯14çš„ddlæ“ä½œï¼Œç­‰å½»åº•è§£å†³äº†ï¼Œè‡ªç„¶å°±èƒ½æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚å…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„åˆ†æã€‚</p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl07.png" alt="mdl07"></p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl08.png" alt="mdl08"></p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl09.png" alt="mdl09"></p>
<p>ç¬¬ä¸ƒæ­¥ï¼šç»™å¤§å®¶åšä¸ªæµ‹è¯•ï¼Œå³ä½¿å°†ä¼šè¯14çš„alteråŠ¨ä½œkillæ‰ï¼š</p>
<ul>
<li>processlistä¸­çœ‹ä¸åˆ°ä»»ä½•ç­‰å¾…MDLé”çš„ä¼šè¯ï¼›</li>
<li>sys.schema_table_lock_waitsä¸­ä¹Ÿä¸å­˜åœ¨è¡¨é”ï¼ˆ5.7æ‰æœ‰sysåº“ï¼‰ï¼›</li>
<li>performance_schema.metadata_locksä¸­ä¹Ÿä¸å­˜åœ¨ä»»ä½•é”è®°å½•ï¼›</li>
<li>ä¼šè¯16æƒ³å†å»æ‰§è¡Œalteræ“ä½œï¼Œåˆå¼€å§‹äº†MDLé”ç­‰å¾…ã€‚</li>
</ul>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl10.png" alt="mdl10"></p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl11.png" alt="mdl11"></p>
<p>ç¬¬å…«æ­¥ï¼šæ­¤æ—¶å°±ä¸€å®šå¯ä»¥ç¡®å®šå½“å‰å±äºã€<strong>æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šå¯¼è‡´çš„MDLé”</strong>ã€‘çš„æƒ…å†µäº†ã€‚æˆ‘ä»¬æ‰¾å‡ºè¿™ä¸ªé”™è¯¯äº‹åŠ¡ï¼Œè¿›è¡Œkill</p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl12.png" alt="mdl12"></p>
<p>ç¬¬ä¹æ­¥ï¼škillæ‰ä¼šè¯11åï¼ŒæˆåŠŸå°†MDLé”é‡Šæ”¾ã€‚</p>
<blockquote>
<p>æœ‰äººåˆä¼šé—®å’¯ï¼šä¸ºä»€ä¹ˆä¸å°†æ•°æ®åº“é‡å¯ï¼Ÿ</p>
<p>å›ç­”ï¼š</p>
<p>å¦‚æœè¯´â€”â€”</p>
<ol>
<li><p>ä¸šåŠ¡å…è®¸é‡å¯</p>
</li>
<li><p>ä¸æƒ³æ‰¾åˆ°é—®é¢˜çš„æ ¹æº</p>
<p>é‚£ä¹ˆé‡å¯å§</p>
</li>
</ol>
<p>å¦‚æœè¯´â€”â€” </p>
<ol>
<li><p>æ•°æ®åº“ä¸Šé¢å¤šä¸ªåº“ï¼Œå…³è”å¤šä¸ªä¸šåŠ¡ï¼Œä¸èƒ½é‡å¯</p>
</li>
<li><p>æƒ³æ‰¾åˆ°é—®é¢˜çš„æ ¹æºï¼Œé˜²æ­¢ä¸‹æ¬¡å†æ¬¡å‡ºç°ç±»ä¼¼çš„é—®é¢˜</p>
<p>é‚£ä¹ˆä½ æ‡‚çš„</p>
</li>
</ol>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¸ç›´æ¥killæ‰€æœ‰ä¼šè¯å‘¢ï¼ŸåŒæ ·å¦‚æœä½ è¦æ‰¾å‡ºé—®é¢˜çš„æ ¹æºé‚£ä¹ˆå°±æ’æŸ¥ï¼Œä¸æƒ³é—®ä¸ºä»€ä¹ˆå°±ç›´æ¥killå§ï¼Œæœ«å°¾æœ‰killçš„è„šæœ¬</p>
</blockquote>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl13.png" alt="mdl13"></p>
<p>ä¸€æ­¥æ­¥åˆ†æå¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;                                                                                                                                                                   </span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |   17 | Waiting for table metadata lock | alter table booboo add q9 int default 0 |</span><br><span class="line">|  7 | root | localhost | uplooking | Query   |   11 | Waiting for table metadata lock | select * from booboo                    |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">| 14 | root | localhost | uplooking | Query   |    5 | Waiting for table metadata lock | select * from booboo where id=3         |</span><br><span class="line">| 15 | root | localhost | uplooking | Sleep   |   28 |                                 | NULL                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx <span class="built_in">where</span> trx_mysql_thread_id=id;</span></span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">kill</span> 7 ;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">kill</span> 14;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;                                                                                                                                                                   </span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |   86 | Waiting for table metadata lock | alter table booboo add q9 int default 0 |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">| 15 | root | localhost | uplooking | Sleep   |   97 |                                 | NULL                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx <span class="built_in">where</span> trx_mysql_thread_id=id;</span></span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœç¬¦åˆæƒ…å†µCï¼Œéœ€è¦å»æŸ¥çœ‹performance_schema.events_statements_currentè¡¨ä¸­æ˜¯å¦æœ‰å¯¹boobooçš„é”™è¯¯è¯­å¥ï¼ˆè¿™é‡Œçš„é”™è¯¯è¯­å¥æ˜¯éè¯­æ³•é”™è¯¯çš„ï¼Œä¾‹å¦‚selectä¸­å†™äº†ä¸å­˜åœ¨çš„åˆ—ç­‰æƒ…å†µï¼‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»ä¸‹é¢çš„æŸ¥è¯¢ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œç¡®å®å­˜åœ¨ä¸€ä¸ªé”™è¯¯è¯­å¥äº‹ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡è¯¥é”™è¯¯è¯­å¥äº‹ä»¶çš„THREAD_IDï¼Œåˆ°performance_schema.threadsè¡¨æŸ¥åˆ°è¯¥çº¿ç¨‹å¯¹åº”çš„PROCESSLIST_IDï¼Œè€ŒPROCESSLIST_IDè¿›ç¨‹idç­‰äºprocesslistä¸­çš„id</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from performance_schema.events_statements_current <span class="built_in">where</span> SQL_TEXT like <span class="string">'%booboo%'</span>\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">              THREAD_ID: 31</span><br><span class="line">               EVENT_ID: 16</span><br><span class="line">           END_EVENT_ID: NULL</span><br><span class="line">             EVENT_NAME: statement/sql/alter_table</span><br><span class="line">                 SOURCE: socket_connection.cc:101</span><br><span class="line">            TIMER_START: 3292336129737000</span><br><span class="line">              TIMER_END: 3521408438190000</span><br><span class="line">             TIMER_WAIT: 229072308453000</span><br><span class="line">              LOCK_TIME: 0</span><br><span class="line">               SQL_TEXT: alter table booboo add q9 int default 0</span><br><span class="line">                 DIGEST: NULL</span><br><span class="line">            DIGEST_TEXT: NULL</span><br><span class="line">         CURRENT_SCHEMA: uplooking</span><br><span class="line">            OBJECT_TYPE: NULL</span><br><span class="line">          OBJECT_SCHEMA: NULL</span><br><span class="line">            OBJECT_NAME: NULL</span><br><span class="line">  OBJECT_INSTANCE_BEGIN: NULL</span><br><span class="line">            MYSQL_ERRNO: 0</span><br><span class="line">      RETURNED_SQLSTATE: NULL</span><br><span class="line">           MESSAGE_TEXT: NULL</span><br><span class="line">                 ERRORS: 0</span><br><span class="line">               WARNINGS: 0</span><br><span class="line">          ROWS_AFFECTED: 0</span><br><span class="line">              ROWS_SENT: 0</span><br><span class="line">          ROWS_EXAMINED: 0</span><br><span class="line">CREATED_TMP_DISK_TABLES: 0</span><br><span class="line">     CREATED_TMP_TABLES: 0</span><br><span class="line">       SELECT_FULL_JOIN: 0</span><br><span class="line"> SELECT_FULL_RANGE_JOIN: 0</span><br><span class="line">           SELECT_RANGE: 0</span><br><span class="line">     SELECT_RANGE_CHECK: 0</span><br><span class="line">            SELECT_SCAN: 0</span><br><span class="line">      SORT_MERGE_PASSES: 0</span><br><span class="line">             SORT_RANGE: 0</span><br><span class="line">              SORT_ROWS: 0</span><br><span class="line">              SORT_SCAN: 0</span><br><span class="line">          NO_INDEX_USED: 0</span><br><span class="line">     NO_GOOD_INDEX_USED: 0</span><br><span class="line">       NESTING_EVENT_ID: NULL</span><br><span class="line">     NESTING_EVENT_TYPE: NULL</span><br><span class="line">    NESTING_EVENT_LEVEL: 0</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">              THREAD_ID: 33</span><br><span class="line">               EVENT_ID: 74</span><br><span class="line">           END_EVENT_ID: NULL</span><br><span class="line">             EVENT_NAME: statement/sql/select</span><br><span class="line">                 SOURCE: socket_connection.cc:101</span><br><span class="line">            TIMER_START: 3521408132304000</span><br><span class="line">              TIMER_END: 3521408462141000</span><br><span class="line">             TIMER_WAIT: 329837000</span><br><span class="line">              LOCK_TIME: 184000000</span><br><span class="line">               SQL_TEXT: select * from performance_schema.events_statements_current where SQL_TEXT like '%booboo%'</span><br><span class="line">                 DIGEST: NULL</span><br><span class="line">            DIGEST_TEXT: NULL</span><br><span class="line">         CURRENT_SCHEMA: uplooking</span><br><span class="line">            OBJECT_TYPE: NULL</span><br><span class="line">          OBJECT_SCHEMA: NULL</span><br><span class="line">            OBJECT_NAME: NULL</span><br><span class="line">  OBJECT_INSTANCE_BEGIN: NULL</span><br><span class="line">            MYSQL_ERRNO: 0</span><br><span class="line">      RETURNED_SQLSTATE: NULL</span><br><span class="line">           MESSAGE_TEXT: NULL</span><br><span class="line">                 ERRORS: 0</span><br><span class="line">               WARNINGS: 0</span><br><span class="line">          ROWS_AFFECTED: 0</span><br><span class="line">              ROWS_SENT: 1</span><br><span class="line">          ROWS_EXAMINED: 0</span><br><span class="line">CREATED_TMP_DISK_TABLES: 0</span><br><span class="line">     CREATED_TMP_TABLES: 0</span><br><span class="line">       SELECT_FULL_JOIN: 0</span><br><span class="line"> SELECT_FULL_RANGE_JOIN: 0</span><br><span class="line">           SELECT_RANGE: 0</span><br><span class="line">     SELECT_RANGE_CHECK: 0</span><br><span class="line">            SELECT_SCAN: 1</span><br><span class="line">      SORT_MERGE_PASSES: 0</span><br><span class="line">             SORT_RANGE: 0</span><br><span class="line">              SORT_ROWS: 0</span><br><span class="line">              SORT_SCAN: 0</span><br><span class="line">          NO_INDEX_USED: 1</span><br><span class="line">     NO_GOOD_INDEX_USED: 0</span><br><span class="line">       NESTING_EVENT_ID: NULL</span><br><span class="line">     NESTING_EVENT_TYPE: NULL</span><br><span class="line">    NESTING_EVENT_LEVEL: 0</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">              THREAD_ID: 40</span><br><span class="line">               EVENT_ID: 8</span><br><span class="line">           END_EVENT_ID: 8</span><br><span class="line">             EVENT_NAME: statement/sql/select</span><br><span class="line">                 SOURCE: socket_connection.cc:101</span><br><span class="line">            TIMER_START: 3280938133699000</span><br><span class="line">              TIMER_END: 3280938258470000</span><br><span class="line">             TIMER_WAIT: 124771000</span><br><span class="line">              LOCK_TIME: 0</span><br><span class="line">               SQL_TEXT: select abc from booboo</span><br><span class="line">                 DIGEST: 871dd43dfdfb143e81439bbe7bf7b57e</span><br><span class="line">            DIGEST_TEXT: SELECT `abc` FROM `booboo` </span><br><span class="line">         CURRENT_SCHEMA: uplooking</span><br><span class="line">            OBJECT_TYPE: NULL</span><br><span class="line">          OBJECT_SCHEMA: NULL</span><br><span class="line">            OBJECT_NAME: NULL</span><br><span class="line">  OBJECT_INSTANCE_BEGIN: NULL</span><br><span class="line">            MYSQL_ERRNO: 1054</span><br><span class="line">      RETURNED_SQLSTATE: 42S22</span><br><span class="line">           MESSAGE_TEXT: Unknown column 'abc' in 'field list'</span><br><span class="line">                 ERRORS: 1</span><br><span class="line">               WARNINGS: 0</span><br><span class="line">          ROWS_AFFECTED: 0</span><br><span class="line">              ROWS_SENT: 0</span><br><span class="line">          ROWS_EXAMINED: 0</span><br><span class="line">CREATED_TMP_DISK_TABLES: 0</span><br><span class="line">     CREATED_TMP_TABLES: 0</span><br><span class="line">       SELECT_FULL_JOIN: 0</span><br><span class="line"> SELECT_FULL_RANGE_JOIN: 0</span><br><span class="line">           SELECT_RANGE: 0</span><br><span class="line">     SELECT_RANGE_CHECK: 0</span><br><span class="line">            SELECT_SCAN: 0</span><br><span class="line">      SORT_MERGE_PASSES: 0</span><br><span class="line">             SORT_RANGE: 0</span><br><span class="line">              SORT_ROWS: 0</span><br><span class="line">              SORT_SCAN: 0</span><br><span class="line">          NO_INDEX_USED: 0</span><br><span class="line">     NO_GOOD_INDEX_USED: 0</span><br><span class="line">       NESTING_EVENT_ID: NULL</span><br><span class="line">     NESTING_EVENT_TYPE: NULL</span><br><span class="line">    NESTING_EVENT_LEVEL: 0</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: </span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select THREAD_ID,DIGEST_TEXT from performance_schema.events_statements_current <span class="built_in">where</span> DIGEST_TEXT=<span class="string">"SELECT `abc` FROM `booboo`"</span>;</span></span><br><span class="line">+-----------+-----------------------------+</span><br><span class="line">| THREAD_ID | DIGEST_TEXT                 |</span><br><span class="line">+-----------+-----------------------------+</span><br><span class="line">|        40 | SELECT `abc` FROM `booboo`  |</span><br><span class="line">+-----------+-----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from performance_schema.threads <span class="built_in">where</span> thread_id=40\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">          THREAD_ID: 40</span><br><span class="line">               NAME: thread/sql/one_connection</span><br><span class="line">               TYPE: FOREGROUND</span><br><span class="line">     PROCESSLIST_ID: 15</span><br><span class="line">   PROCESSLIST_USER: root</span><br><span class="line">   PROCESSLIST_HOST: localhost</span><br><span class="line">     PROCESSLIST_DB: uplooking</span><br><span class="line">PROCESSLIST_COMMAND: Sleep</span><br><span class="line">   PROCESSLIST_TIME: 402</span><br><span class="line">  PROCESSLIST_STATE: NULL</span><br><span class="line">   PROCESSLIST_INFO: NULL</span><br><span class="line">   PARENT_THREAD_ID: NULL</span><br><span class="line">               ROLE: NULL</span><br><span class="line">       INSTRUMENTED: YES</span><br><span class="line">            HISTORY: YES</span><br><span class="line">    CONNECTION_TYPE: Socket</span><br><span class="line">       THREAD_OS_ID: 22758</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select PROCESSLIST_ID from performance_schema.threads <span class="built_in">where</span> thread_id=40;</span></span><br><span class="line">+----------------+</span><br><span class="line">| PROCESSLIST_ID |</span><br><span class="line">+----------------+</span><br><span class="line">|             15 |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from information_schema.processlist <span class="built_in">where</span> id=(select PROCESSLIST_ID from performance_schema.threads <span class="built_in">where</span> thread_id=40);</span></span><br><span class="line">+----+------+-----------+-----------+---------+------+-------+------+</span><br><span class="line">| ID | USER | HOST      | DB        | COMMAND | TIME | STATE | INFO |</span><br><span class="line">+----+------+-----------+-----------+---------+------+-------+------+</span><br><span class="line">| 15 | root | localhost | uplooking | Sleep   |  466 |       | NULL |</span><br><span class="line">+----+------+-----------+-----------+---------+------+-------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">kill</span> 15;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¼šè¯B</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> alter table booboo add q9 int default 0;</span></span><br><span class="line">Query OK, 0 rows affected (9 min 54.35 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>



<h2 id="å°çŸ¥è¯†ç‚¹æ€»ç»“"><a href="#å°çŸ¥è¯†ç‚¹æ€»ç»“" class="headerlink" title="å°çŸ¥è¯†ç‚¹æ€»ç»“"></a>å°çŸ¥è¯†ç‚¹æ€»ç»“</h2><h3 id="ä¸‰å¼ è¡¨çš„å…³ç³»"><a href="#ä¸‰å¼ è¡¨çš„å…³ç³»" class="headerlink" title="ä¸‰å¼ è¡¨çš„å…³ç³»"></a>ä¸‰å¼ è¡¨çš„å…³ç³»</h3><blockquote>
<p>MySQL 5.6</p>
</blockquote>
<ol>
<li><code>performance_schema</code>åº“ä¸­ï¼Œ<code>events_statements_current</code>è¡¨ä¸­<code>theard_id</code>ä¸<code>threads</code>è¡¨ä¸­çš„<code>thread_id</code>ç›¸åŒ</li>
<li><code>performance_schema</code>åº“ä¸­ï¼Œthreadsè¡¨ä¸­ï¼Œthread_idå’Œprocesslist_idä¸ºå¯¹åº”å…³ç³»ï¼Œ<code>thread_id</code>è¡¨ç¤ºä¸€ä¸ªç‹¬ç‰¹çš„çº¿ç¨‹æ ‡è¯†ç¬¦;<code>processlist_id</code>æ˜¯<code>show processlist</code>æ˜¾ç¤ºçš„<code>id</code>å€¼ï¼Œè¿æ¥æ ‡è¯†ç¬¦ï¼›è€Œå¯¹äºåå°çº¿ç¨‹(ä¸ç”¨æˆ·è¿æ¥ä¸ç›¸å…³çš„çº¿ç¨‹)ï¼Œ<code>PROCESSLIST_ID</code>ä¸ºç©ºï¼Œæ­¤å€¼ä¸æ˜¯å”¯ä¸€çš„ã€‚</li>
<li><code>information_schema</code>åº“ä¸­,<code>PROCESSLIST</code>è¡¨æ˜¯ä¸€ä¸ªéæ ‡å‡†è¡¨ã€‚<code>id</code>è¿æ¥æ ‡è¯†ç¬¦ï¼Œå¹¶ç”±CONNECTION_ID()å‡½æ•°è¿”å›ã€‚</li>
</ol>
<table>
<thead>
<tr>
<th>performance_schema</th>
<th>performance_schema</th>
<th>performance_schema</th>
<th>information_schema</th>
</tr>
</thead>
<tbody><tr>
<td>events_statements_current</td>
<td>threads</td>
<td>threads</td>
<td>processlist</td>
</tr>
<tr>
<td>THREAD_ID</td>
<td>THREAD_ID</td>
<td>PROCESSLIST_ID</td>
<td>ID</td>
</tr>
</tbody></table>
<h3 id="æˆ‘çš„ç†è§£"><a href="#æˆ‘çš„ç†è§£" class="headerlink" title="æˆ‘çš„ç†è§£"></a>æˆ‘çš„ç†è§£</h3><ol>
<li>çº¿ç¨‹è¡¨ä¸­ä¿å­˜äº†æ‰€æœ‰çº¿ç¨‹çš„ä¿¡æ¯ï¼Œæœ‰å‰å°çš„æœ‰åå°è¿è¡Œçš„ï¼›</li>
<li>å¦‚æœæ˜¯ç”±è¿æ¥äº§ç”Ÿçš„çº¿ç¨‹ï¼Œä¸€èˆ¬éƒ½æ˜¯å‰å°çº¿ç¨‹ï¼Œä¼šåˆ†é…ä¸€ä¸ªprocesslist_idï¼Œå¯ä»¥åœ¨information_schema.processlistä¸­çœ‹åˆ°</li>
</ol>
<h3 id="èµ„æ–™å‚è€ƒ"><a href="#èµ„æ–™å‚è€ƒ" class="headerlink" title="èµ„æ–™å‚è€ƒ"></a>èµ„æ–™å‚è€ƒ</h3><p><a href="https://dev.mysql.com/doc/refman/5.7/en/threads-table.html" target="_blank" rel="noopener">å®˜ç½‘å…³äºthreadsè¡¨çš„è¯´æ˜</a></p>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/show-processlist.html" target="_blank" rel="noopener">å®˜æ–¹å…³äºprocesslistè¡¨çš„è¯´æ˜</a></p>
<p><a href="http://www.voidcn.com/article/p-hjsjvnlz-bog.html" target="_blank" rel="noopener">MySQL5.7 MetaData Lock æ¡ˆä¾‹åˆ†äº«</a></p>
<h3 id="ä¸åŒç‰ˆæœ¬"><a href="#ä¸åŒç‰ˆæœ¬" class="headerlink" title="ä¸åŒç‰ˆæœ¬"></a>ä¸åŒç‰ˆæœ¬</h3><blockquote>
<p>MySQL 5.7</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from performance_schema.events_statements_current\G</span><br><span class="line">select * from sys.x$session\G</span><br><span class="line">select * from sys.x$processlist\G</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from x$session\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                thd_id: 3904</span><br><span class="line">               conn_id: 3879</span><br><span class="line">                  user: root@localhost</span><br><span class="line">                    db: sys</span><br><span class="line">               command: Query</span><br><span class="line">                 state: Sending data</span><br><span class="line">                  time: 0</span><br><span class="line">     current_statement: select * from x$session</span><br><span class="line">     statement_latency: 1564453000</span><br><span class="line">              progress: NULL</span><br><span class="line">          lock_latency: 847000000</span><br><span class="line">         rows_examined: 0</span><br><span class="line">             rows_sent: 0</span><br><span class="line">         rows_affected: 0</span><br><span class="line">            tmp_tables: 4</span><br><span class="line">       tmp_disk_tables: 1</span><br><span class="line">             full_scan: YES</span><br><span class="line">        last_statement: NULL</span><br><span class="line">last_statement_latency: NULL</span><br><span class="line">        current_memory: 0</span><br><span class="line">             last_wait: NULL</span><br><span class="line">     last_wait_latency: NULL</span><br><span class="line">                source: NULL</span><br><span class="line">           trx_latency: NULL</span><br><span class="line">             trx_state: NULL</span><br><span class="line">        trx_autocommit: NULL</span><br><span class="line">                   pid: 12880</span><br><span class="line">          program_name: mysql</span><br><span class="line">1 row in set (0.05 sec)</span><br><span class="line">mysql&gt; select * from  x$processlist limit 1\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                thd_id: 1</span><br><span class="line">               conn_id: NULL</span><br><span class="line">                  user: sql&#x2F;main</span><br><span class="line">                    db: NULL</span><br><span class="line">               command: NULL</span><br><span class="line">                 state: NULL</span><br><span class="line">                  time: 230927</span><br><span class="line">     current_statement: NULL</span><br><span class="line">     statement_latency: NULL</span><br><span class="line">              progress: NULL</span><br><span class="line">          lock_latency: NULL</span><br><span class="line">         rows_examined: NULL</span><br><span class="line">             rows_sent: NULL</span><br><span class="line">         rows_affected: NULL</span><br><span class="line">            tmp_tables: NULL</span><br><span class="line">       tmp_disk_tables: NULL</span><br><span class="line">             full_scan: NO</span><br><span class="line">        last_statement: NULL</span><br><span class="line">last_statement_latency: NULL</span><br><span class="line">        current_memory: 0</span><br><span class="line">             last_wait: NULL</span><br><span class="line">     last_wait_latency: NULL</span><br><span class="line">                source: NULL</span><br><span class="line">           trx_latency: NULL</span><br><span class="line">             trx_state: NULL</span><br><span class="line">        trx_autocommit: NULL</span><br><span class="line">                   pid: NULL</span><br><span class="line">          program_name: NULL</span><br><span class="line">1 row in set (0.06 sec)</span><br><span class="line">mysql&gt; select * from information_schema.processlist;</span><br><span class="line">+------+------+-----------+------+---------+------+-----------+----------------------------------------------+</span><br><span class="line">| ID   | USER | HOST      | DB   | COMMAND | TIME | STATE     | INFO                                         |</span><br><span class="line">+------+------+-----------+------+---------+------+-----------+----------------------------------------------+</span><br><span class="line">| 3879 | root | localhost | sys  | Query   |    0 | executing | select * from information_schema.processlist |</span><br><span class="line">+------+------+-----------+------+---------+------+-----------+----------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h2 id="MDLæ•…éšœè‡ªæ„ˆ"><a href="#MDLæ•…éšœè‡ªæ„ˆ" class="headerlink" title="MDLæ•…éšœè‡ªæ„ˆ"></a>MDLæ•…éšœè‡ªæ„ˆ</h2><h3 id="killæ‰€æœ‰ä¼šè¯"><a href="#killæ‰€æœ‰ä¼šè¯" class="headerlink" title="killæ‰€æœ‰ä¼šè¯"></a>killæ‰€æœ‰ä¼šè¯</h3><blockquote>
<p>ä¸æƒ³çŸ¥é“æ•…éšœåŸå› ï¼Œåªæƒ³å¿«é€Ÿè§£å†³æ•…éšœ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">kill</span>æ‰ æ‰€æœ‰ä¼šè¯</span></span><br><span class="line">user=xxx</span><br><span class="line">password=xxx</span><br><span class="line">host=xxxx.mysql.rds.aliyuncs.com</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">mysql -u$user -p$password -h$host  -P$port -e "select  concat('KILL ',id,';') from information_schema.processlist;" &gt; tmpfile</span><br><span class="line"></span><br><span class="line">awk '&#123;if (NR != 1) print $0 &#125;' tmpfile | mysql -u$user -p$password -h$host  -P$port</span><br></pre></td></tr></table></figure>

<h3 id="MDLæ•…éšœæ’æŸ¥å’Œè§£å†³"><a href="#MDLæ•…éšœæ’æŸ¥å’Œè§£å†³" class="headerlink" title="MDLæ•…éšœæ’æŸ¥å’Œè§£å†³"></a>MDLæ•…éšœæ’æŸ¥å’Œè§£å†³</h3><p><a href="https://github.com/BoobooWei/DevOps-Database-Troubleshooting/blob/master/fault_self_healing_metadatalock.py" target="_blank" rel="noopener">MDLæ•…éšœè‡ªæ„ˆè„šæœ¬GitHubåœ°å€</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯å¹¿è§’</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>é”æ•…éšœ</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬åä¸€è¯¾  MySQLé€»è¾‘å¤‡ä»½å·¥å…·mysqldump,mysqlpump,mydumper</title>
    <url>/2017/01/05/booboo_mysql/08-MySQL%E9%80%BB%E8%BE%91%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7mysqldump&amp;mysqlpump&amp;mydumper/</url>
    <content><![CDATA[<h2 id="mysqldump"><a href="#mysqldump" class="headerlink" title="mysqldump"></a>mysqldump</h2><p>mysqlç»å…¸é€»è¾‘å¤‡ä»½å·¥å…·</p>
<p>å‚æ•°è¯´æ˜ï¼Œå…·ä½“çš„å‚æ•°å¯ä»¥ç”¨mysqldump â€“helpæŸ¥çœ‹ã€‚</p>
<p>æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªå‚æ•°</p>
<p>â‘ ï¼šâ€“single-transaction</p>
<p>é€šè¿‡å°†å¯¼å‡ºæ“ä½œå°è£…åœ¨ä¸€ä¸ªäº‹åŠ¡(Repeatable Read)å†…æ¥ä½¿å¾—å¯¼å‡ºçš„æ•°æ®æ˜¯ä¸€ä¸ªä¸€è‡´æ€§å¿«ç…§ã€‚åªæœ‰å½“è¡¨ä½¿ç”¨æ”¯æŒMVCCçš„å­˜å‚¨å¼•æ“ï¼ˆç›®å‰åªæœ‰InnoDBï¼‰æ—¶æ‰å¯ä»¥å·¥ä½œï¼›å…¶ä»–å¼•æ“ä¸èƒ½ä¿è¯å¯¼å‡ºæ˜¯ä¸€è‡´çš„ã€‚å½“å¯¼å‡ºå¼€å¯äº†â€“single-transactioné€‰é¡¹æ—¶ï¼Œè¦ç¡®ä¿å¯¼å‡ºæ–‡ä»¶æœ‰æ•ˆï¼ˆæ­£ç¡®çš„è¡¨æ•°æ®å’ŒäºŒè¿›åˆ¶æ—¥å¿—ä½ç½®ï¼‰ï¼Œå°±è¦ä¿è¯æ²¡æœ‰å…¶ä»–è¿æ¥ä¼šæ‰§è¡Œå¦‚ä¸‹è¯­å¥ï¼šALTER TABLE, DROP TABLE, RENAME TABLE, TRUNCATE TABLEï¼Œè¿™ä¼šå¯¼è‡´ä¸€è‡´æ€§å¿«ç…§å¤±æ•ˆã€‚è¿™ä¸ªé€‰é¡¹å¼€å¯åä¼šè‡ªåŠ¨å…³é—­lock-tablesã€‚å¹¶ä¸”åœ¨mysql5.7.11ä¹‹å‰ï¼Œâ€“default-parallelismå¤§äº1çš„æ—¶å€™å’Œæ­¤å‚ä¹Ÿäº’æ–¥ï¼Œå¿…é¡»ä½¿ç”¨â€“default-parallelism=0ã€‚5.7.11ä¹‹åè§£å†³äº†â€“single-transactionå’Œâ€“default-parallelismçš„äº’æ–¥é—®é¢˜ã€‚</p>
<p>â‘¡ï¼šâ€“master-data</p>
<p>è¿™ä¸ªé€‰é¡¹å¯ä»¥æŠŠbinlogçš„ä½ç½®å’Œæ–‡ä»¶åæ·»åŠ åˆ°è¾“å‡ºä¸­ï¼Œå¦‚æœç­‰äº1ï¼Œå°†ä¼šæ‰“å°æˆä¸€ä¸ªCHANGE MASTERå‘½ä»¤ï¼›å¦‚æœç­‰äº2ï¼Œä¼šåŠ ä¸Šæ³¨é‡Šå‰ç¼€ã€‚å¹¶ä¸”è¿™ä¸ªé€‰é¡¹ä¼šè‡ªåŠ¨æ‰“å¼€â€“lock-all-tablesï¼Œé™¤éåŒæ—¶è®¾ç½®äº†â€“single-transactionï¼ˆè¿™ç§æƒ…å†µä¸‹ï¼Œå…¨å±€è¯»é”åªä¼šåœ¨å¼€å§‹dumpçš„æ—¶å€™åŠ ä¸Šä¸€å°æ®µæ—¶é—´ï¼Œä¸è¦å¿˜äº†é˜…è¯»â€“single-transactionçš„éƒ¨åˆ†ï¼‰ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ—¥å¿—ä¸­çš„æ“ä½œéƒ½ä¼šå‘ç”Ÿåœ¨å¯¼å‡ºçš„å‡†ç¡®æ—¶åˆ»ã€‚è¿™ä¸ªé€‰é¡¹ä¼šè‡ªåŠ¨å…³é—­â€“lock-tablesã€‚æ‰“å¼€è¯¥å‚æ•°éœ€è¦æœ‰reloadæƒé™ï¼Œå¹¶ä¸”æœåŠ¡å™¨å¼€å¯binlogã€‚</p>
<p>â‘¢ï¼šâ€“lock-all-tables ï¼Œ-x</p>
<p>é”å®šæ‰€æœ‰åº“ä¸­æ‰€æœ‰çš„è¡¨ã€‚è¿™æ˜¯é€šè¿‡åœ¨æ•´ä¸ªdumpçš„è¿‡ç¨‹ä¸­æŒæœ‰å…¨å±€è¯»é”æ¥å®ç°çš„ã€‚ä¼šè‡ªåŠ¨å…³é—­â€“single-transaction å’Œ â€“lock-tablesã€‚</p>
<p>â‘£ï¼šâ€“lock-tablesï¼Œ-l</p>
<p>å¤‡ä»½æŸä¸ªåº“å°±é”è¯¥åº“çš„æ‰€æœ‰è¡¨ï¼Œç”¨READ LOCALæ¥é”è¡¨ã€‚MyISAMå…è®¸å¹¶å‘å†™å…¥ï¼Œå› ä¸ºé”è¡¨åªé’ˆå¯¹æŒ‡å®šçš„æ•°æ®åº“ï¼Œä¸èƒ½ä¿è¯ç‰©ç†ä¸Šçš„ä¸€è‡´æ€§ï¼Œä¸åŒåº“çš„è¡¨å¤‡ä»½å®Œæˆæ—¶ä¼šæœ‰ä¸åŒçš„çŠ¶æ€ã€‚ç”¨â€“skip-lock-tablesæ¥å…³é—­ã€‚</p>
<p>â‘¤ï¼šâ€“flush-logsï¼Œ-F</p>
<p>åœ¨å¼€å§‹å¯¼å‡ºå‰åˆ·æ–°æœåŠ¡å™¨çš„æ—¥å¿—æ–‡ä»¶ã€‚æ³¨æ„ï¼Œå¦‚æœä½ ä¸€æ¬¡æ€§å¯¼å‡ºå¾ˆå¤šæ•°æ®åº“ï¼ˆä½¿ç”¨â€“databases= æˆ–â€“all-databases é€‰é¡¹ï¼‰ï¼Œå¯¼å‡ºæ¯ä¸ªåº“æ—¶éƒ½ä¼šè§¦å‘æ—¥å¿—åˆ·æ–°ã€‚ä¾‹å¤–æ˜¯å½“ä½¿ç”¨äº†â€“lock-all-tablesã€â€“master-dataæˆ–â€“single-transactionæ—¶ï¼šæ—¥å¿—åªä¼šè¢«åˆ·æ–°ä¸€æ¬¡ï¼Œé‚£ä¸ªæ—¶å€™æ‰€æœ‰è¡¨éƒ½ä¼šè¢«é”ä½ã€‚æ‰€ä»¥å¦‚æœä½ å¸Œæœ›ä½ çš„å¯¼å‡ºå’Œæ—¥å¿—åˆ·æ–°å‘ç”Ÿåœ¨åŒä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä½ éœ€è¦ä½¿ç”¨â€“lock-all-tablesã€â€“master-dataå’Œâ€“single-transactioné…åˆ â€“flush-logsã€‚</p>
<p>â‘¥ï¼šâ€“opt</p>
<p>è¯¥å‚æ•°é»˜è®¤å¼€å¯ï¼Œè¡¨ç¤ºå¿«é€’å¯åŠ¨â€“add-drop-table â€“add-locks â€“create-options â€“disable-keys â€“extended-insert â€“lock-tables â€“quick â€“set-charseté€‰é¡¹ï¼Œé€šè¿‡ â€“skip-opt å…³é—­ã€‚</p>
<p>â€“all-databases  , -A<br>å¯¼å‡ºå…¨éƒ¨æ•°æ®åº“ã€‚</p>
<p>â€“all-tablespaces  , -Y<br>å¯¼å‡ºå…¨éƒ¨è¡¨ç©ºé—´ã€‚</p>
<p>â€“no-tablespaces  , -y<br>ä¸å¯¼å‡ºä»»ä½•è¡¨ç©ºé—´ä¿¡æ¯ã€‚</p>
<p>â€“add-drop-database<br>æ¯ä¸ªæ•°æ®åº“åˆ›å»ºä¹‹å‰æ·»åŠ dropæ•°æ®åº“è¯­å¥ã€‚</p>
<p>â€“add-drop-table<br>æ¯ä¸ªæ•°æ®è¡¨åˆ›å»ºä¹‹å‰æ·»åŠ dropæ•°æ®è¡¨è¯­å¥ã€‚(é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨â€“skip-add-drop-tableå–æ¶ˆé€‰é¡¹)</p>
<p>â€“add-locks<br>åœ¨æ¯ä¸ªè¡¨å¯¼å‡ºä¹‹å‰å¢åŠ LOCK TABLESå¹¶ä¸”ä¹‹åUNLOCK  TABLEã€‚(é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨â€“skip-add-lockså–æ¶ˆé€‰é¡¹)</p>
<p>â€“allow-keywords<br>å…è®¸åˆ›å»ºæ˜¯å…³é”®è¯çš„åˆ—åå­—ã€‚è¿™ç”±è¡¨åå‰ç¼€äºæ¯ä¸ªåˆ—ååšåˆ°ã€‚</p>
<p>â€“apply-slave-statements<br>åœ¨â€™CHANGE MASTERâ€™å‰æ·»åŠ â€™STOP SLAVEâ€™ï¼Œå¹¶ä¸”åœ¨å¯¼å‡ºçš„æœ€åæ·»åŠ â€™START SLAVEâ€™ã€‚</p>
<p>â€“character-sets-dir<br>å­—ç¬¦é›†æ–‡ä»¶çš„ç›®å½•</p>
<p>â€“comments<br>é™„åŠ æ³¨é‡Šä¿¡æ¯ã€‚é»˜è®¤ä¸ºæ‰“å¼€ï¼Œå¯ä»¥ç”¨â€“skip-commentså–æ¶ˆ</p>
<p>â€“compatible<br>å¯¼å‡ºçš„æ•°æ®å°†å’Œå…¶å®ƒæ•°æ®åº“æˆ–æ—§ç‰ˆæœ¬çš„MySQL ç›¸å…¼å®¹ã€‚å€¼å¯ä»¥ä¸ºansiã€mysql323ã€mysql40ã€postgresqlã€oracleã€mssqlã€db2ã€maxdbã€no_key_optionsã€no_tables_optionsã€no_field_optionsç­‰ï¼Œ<br>è¦ä½¿ç”¨å‡ ä¸ªå€¼ï¼Œç”¨é€—å·å°†å®ƒä»¬éš”å¼€ã€‚å®ƒå¹¶ä¸ä¿è¯èƒ½å®Œå…¨å…¼å®¹ï¼Œè€Œæ˜¯å°½é‡å…¼å®¹ã€‚</p>
<p>â€“compact<br>å¯¼å‡ºæ›´å°‘çš„è¾“å‡ºä¿¡æ¯(ç”¨äºè°ƒè¯•)ã€‚å»æ‰æ³¨é‡Šå’Œå¤´å°¾ç­‰ç»“æ„ã€‚å¯ä»¥ä½¿ç”¨é€‰é¡¹ï¼šâ€“skip-add-drop-table  â€“skip-add-locks â€“skip-comments â€“skip-disable-keys</p>
<p>â€“complete-insert,  -c<br>ä½¿ç”¨å®Œæ•´çš„insertè¯­å¥(åŒ…å«åˆ—åç§°)ã€‚è¿™ä¹ˆåšèƒ½æé«˜æ’å…¥æ•ˆç‡ï¼Œä½†æ˜¯å¯èƒ½ä¼šå—åˆ°max_allowed_packetå‚æ•°çš„å½±å“è€Œå¯¼è‡´æ’å…¥å¤±è´¥ã€‚</p>
<p>â€“compress, -C<br>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å¯ç”¨å‹ç¼©ä¼ é€’æ‰€æœ‰ä¿¡æ¯</p>
<p>â€“create-options,  -a<br>åœ¨CREATE TABLEè¯­å¥ä¸­åŒ…æ‹¬æ‰€æœ‰MySQLç‰¹æ€§é€‰é¡¹ã€‚(é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€)</p>
<p>â€“databases,  -B<br>å¯¼å‡ºå‡ ä¸ªæ•°æ®åº“ã€‚å‚æ•°åé¢æ‰€æœ‰åå­—å‚é‡éƒ½è¢«çœ‹ä½œæ•°æ®åº“åã€‚</p>
<p>â€“debug<br>è¾“å‡ºdebugä¿¡æ¯ï¼Œç”¨äºè°ƒè¯•ã€‚é»˜è®¤å€¼ä¸ºï¼šd:t:o,/tmp/mysqldump.trace</p>
<p>â€“debug-check<br>æ£€æŸ¥å†…å­˜å’Œæ‰“å¼€æ–‡ä»¶ä½¿ç”¨è¯´æ˜å¹¶é€€å‡ºã€‚</p>
<p>â€“debug-info<br>è¾“å‡ºè°ƒè¯•ä¿¡æ¯å¹¶é€€å‡º</p>
<p>â€“default-character-set<br>è®¾ç½®é»˜è®¤å­—ç¬¦é›†ï¼Œé»˜è®¤å€¼ä¸ºutf8</p>
<p>â€“delayed-insert<br>é‡‡ç”¨å»¶æ—¶æ’å…¥æ–¹å¼ï¼ˆINSERT DELAYEDï¼‰å¯¼å‡ºæ•°æ®</p>
<p>â€“delete-master-logs<br>masterå¤‡ä»½ååˆ é™¤æ—¥å¿—. è¿™ä¸ªå‚æ•°å°†è‡ªåŠ¨æ¿€æ´»â€“master-dataã€‚</p>
<p>â€“disable-keys<br>å¯¹äºæ¯ä¸ªè¡¨ï¼Œç”¨/<em>!40000 ALTER TABLE tbl_name DISABLE KEYS */;å’Œ/</em>!40000 ALTER TABLE tbl_name ENABLE KEYS */;è¯­å¥å¼•ç”¨INSERTè¯­å¥ã€‚è¿™æ ·å¯ä»¥æ›´å¿«åœ°å¯¼å…¥dumpå‡ºæ¥çš„æ–‡ä»¶ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨æ’å…¥æ‰€æœ‰è¡Œååˆ›å»ºç´¢å¼•çš„ã€‚è¯¥é€‰é¡¹åªé€‚åˆMyISAMè¡¨ï¼Œé»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ã€‚</p>
<p>â€“dump-slave<br>è¯¥é€‰é¡¹å°†å¯¼è‡´ä¸»çš„binlogä½ç½®å’Œæ–‡ä»¶åè¿½åŠ åˆ°å¯¼å‡ºæ•°æ®çš„æ–‡ä»¶ä¸­ã€‚è®¾ç½®ä¸º1æ—¶ï¼Œå°†ä¼šä»¥CHANGE MASTERå‘½ä»¤è¾“å‡ºåˆ°æ•°æ®æ–‡ä»¶ï¼›è®¾ç½®ä¸º2æ—¶ï¼Œåœ¨å‘½ä»¤å‰å¢åŠ è¯´æ˜ä¿¡æ¯ã€‚è¯¥é€‰é¡¹å°†ä¼šæ‰“å¼€â€“lock-all-tablesï¼Œé™¤éâ€“single-transactionè¢«æŒ‡å®šã€‚è¯¥é€‰é¡¹ä¼šè‡ªåŠ¨å…³é—­â€“lock-tablesé€‰é¡¹ã€‚é»˜è®¤å€¼ä¸º0ã€‚</p>
<p>â€“events, -E<br>å¯¼å‡ºäº‹ä»¶ã€‚</p>
<p>â€“extended-insert,  -e<br>ä½¿ç”¨å…·æœ‰å¤šä¸ªVALUESåˆ—çš„INSERTè¯­æ³•ã€‚è¿™æ ·ä½¿å¯¼å‡ºæ–‡ä»¶æ›´å°ï¼Œå¹¶åŠ é€Ÿå¯¼å…¥æ—¶çš„é€Ÿåº¦ã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨â€“skip-extended-insertå–æ¶ˆé€‰é¡¹ã€‚</p>
<p>â€“fields-terminated-by<br>å¯¼å‡ºæ–‡ä»¶ä¸­å¿½ç•¥ç»™å®šå­—æ®µã€‚ä¸â€“tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äºâ€“databaseså’Œâ€“all-databasesé€‰é¡¹</p>
<p>â€“fields-enclosed-by<br>è¾“å‡ºæ–‡ä»¶ä¸­çš„å„ä¸ªå­—æ®µç”¨ç»™å®šå­—ç¬¦åŒ…è£¹ã€‚ä¸â€“tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äºâ€“databaseså’Œâ€“all-databasesé€‰é¡¹</p>
<p>â€“fields-optionally-enclosed-by<br>è¾“å‡ºæ–‡ä»¶ä¸­çš„å„ä¸ªå­—æ®µç”¨ç»™å®šå­—ç¬¦é€‰æ‹©æ€§åŒ…è£¹ã€‚ä¸â€“tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äºâ€“databaseså’Œâ€“all-databasesé€‰é¡¹</p>
<p>â€“fields-escaped-by<br>è¾“å‡ºæ–‡ä»¶ä¸­çš„å„ä¸ªå­—æ®µå¿½ç•¥ç»™å®šå­—ç¬¦ã€‚ä¸â€“tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äºâ€“databaseså’Œâ€“all-databasesé€‰é¡¹</p>
<p>â€“flush-logs<br>å¼€å§‹å¯¼å‡ºä¹‹å‰åˆ·æ–°æ—¥å¿—ã€‚<br>è¯·æ³¨æ„ï¼šå‡å¦‚ä¸€æ¬¡å¯¼å‡ºå¤šä¸ªæ•°æ®åº“(ä½¿ç”¨é€‰é¡¹â€“databasesæˆ–è€…â€“all-databases)ï¼Œå°†ä¼šé€ä¸ªæ•°æ®åº“åˆ·æ–°æ—¥å¿—ã€‚é™¤ä½¿ç”¨â€“lock-all-tablesæˆ–è€…â€“master-dataå¤–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ—¥å¿—å°†ä¼šè¢«åˆ·æ–°ä¸€æ¬¡ï¼Œç›¸åº”çš„æ‰€ä»¥è¡¨åŒæ—¶è¢«é”å®šã€‚å› æ­¤ï¼Œå¦‚æœæ‰“ç®—åŒæ—¶å¯¼å‡ºå’Œåˆ·æ–°æ—¥å¿—åº”è¯¥ä½¿ç”¨â€“lock-all-tables æˆ–è€…â€“master-data å’Œâ€“flush-logsã€‚</p>
<p>â€“flush-privileges<br>åœ¨å¯¼å‡ºmysqlæ•°æ®åº“ä¹‹åï¼Œå‘å‡ºä¸€æ¡FLUSH  PRIVILEGES è¯­å¥ã€‚ä¸ºäº†æ­£ç¡®æ¢å¤ï¼Œè¯¥é€‰é¡¹åº”è¯¥ç”¨äºå¯¼å‡ºmysqlæ•°æ®åº“å’Œä¾èµ–mysqlæ•°æ®åº“æ•°æ®çš„ä»»ä½•æ—¶å€™ã€‚</p>
<p>â€“force<br>åœ¨å¯¼å‡ºè¿‡ç¨‹ä¸­å¿½ç•¥å‡ºç°çš„SQLé”™è¯¯ã€‚</p>
<p>â€“help<br>æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡ºã€‚</p>
<p>â€“hex-blob<br>ä½¿ç”¨åå…­è¿›åˆ¶æ ¼å¼å¯¼å‡ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²å­—æ®µã€‚å¦‚æœæœ‰äºŒè¿›åˆ¶æ•°æ®å°±å¿…é¡»ä½¿ç”¨è¯¥é€‰é¡¹ã€‚å½±å“åˆ°çš„å­—æ®µç±»å‹æœ‰BINARYã€VARBINARYã€BLOBã€‚</p>
<p>â€“host, -h<br>éœ€è¦å¯¼å‡ºçš„ä¸»æœºä¿¡æ¯</p>
<p>â€“ignore-table<br>ä¸å¯¼å‡ºæŒ‡å®šè¡¨ã€‚æŒ‡å®šå¿½ç•¥å¤šä¸ªè¡¨æ—¶ï¼Œéœ€è¦é‡å¤å¤šæ¬¡ï¼Œæ¯æ¬¡ä¸€ä¸ªè¡¨ã€‚æ¯ä¸ªè¡¨å¿…é¡»åŒæ—¶æŒ‡å®šæ•°æ®åº“å’Œè¡¨åã€‚ä¾‹å¦‚ï¼šâ€“ignore-table=database.table1 â€“ignore-table=database.table2 â€¦â€¦</p>
<p>â€“include-master-host-port<br>åœ¨â€“dump-slaveäº§ç”Ÿçš„â€™CHANGE  MASTER TO..â€™è¯­å¥ä¸­å¢åŠ â€™MASTER_HOST=<host>ï¼ŒMASTER_PORT=<port>â€˜  </p>
<p>â€“insert-ignore<br>åœ¨æ’å…¥è¡Œæ—¶ä½¿ç”¨INSERT IGNOREè¯­å¥.</p>
<p>â€“lines-terminated-by<br>è¾“å‡ºæ–‡ä»¶çš„æ¯è¡Œç”¨ç»™å®šå­—ç¬¦ä¸²åˆ’åˆ†ã€‚ä¸â€“tabé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½ç”¨äºâ€“databaseså’Œâ€“all-databasesé€‰é¡¹ã€‚</p>
<p>â€“lock-all-tables,  -x<br>æäº¤è¯·æ±‚é”å®šæ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ï¼Œä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚è¿™æ˜¯ä¸€ä¸ªå…¨å±€è¯»é”ï¼Œå¹¶ä¸”è‡ªåŠ¨å…³é—­â€“single-transaction å’Œâ€“lock-tables é€‰é¡¹ã€‚</p>
<p>â€“lock-tables,  -l<br>å¼€å§‹å¯¼å‡ºå‰ï¼Œé”å®šæ‰€æœ‰è¡¨ã€‚ç”¨READ  LOCALé”å®šè¡¨ä»¥å…è®¸MyISAMè¡¨å¹¶è¡Œæ’å…¥ã€‚å¯¹äºæ”¯æŒäº‹åŠ¡çš„è¡¨ä¾‹å¦‚InnoDBå’ŒBDBï¼Œâ€“single-transactionæ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒæ ¹æœ¬ä¸éœ€è¦é”å®šè¡¨ã€‚<br>è¯·æ³¨æ„å½“å¯¼å‡ºå¤šä¸ªæ•°æ®åº“æ—¶ï¼Œâ€“lock-tablesåˆ†åˆ«ä¸ºæ¯ä¸ªæ•°æ®åº“é”å®šè¡¨ã€‚å› æ­¤ï¼Œè¯¥é€‰é¡¹ä¸èƒ½ä¿è¯å¯¼å‡ºæ–‡ä»¶ä¸­çš„è¡¨åœ¨æ•°æ®åº“ä¹‹é—´çš„é€»è¾‘ä¸€è‡´æ€§ã€‚ä¸åŒæ•°æ®åº“è¡¨çš„å¯¼å‡ºçŠ¶æ€å¯ä»¥å®Œå…¨ä¸åŒã€‚</p>
<p>â€“log-error<br>é™„åŠ è­¦å‘Šå’Œé”™è¯¯ä¿¡æ¯åˆ°ç»™å®šæ–‡ä»¶</p>
<p>â€“master-data<br>è¯¥é€‰é¡¹å°†binlogçš„ä½ç½®å’Œæ–‡ä»¶åè¿½åŠ åˆ°è¾“å‡ºæ–‡ä»¶ä¸­ã€‚å¦‚æœä¸º1ï¼Œå°†ä¼šè¾“å‡ºCHANGE MASTER å‘½ä»¤ï¼›å¦‚æœä¸º2ï¼Œè¾“å‡ºçš„CHANGE  MASTERå‘½ä»¤å‰æ·»åŠ æ³¨é‡Šä¿¡æ¯ã€‚è¯¥é€‰é¡¹å°†æ‰“å¼€â€“lock-all-tables é€‰é¡¹ï¼Œé™¤éâ€“single-transactionä¹Ÿè¢«æŒ‡å®šï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¨å±€è¯»é”åœ¨å¼€å§‹å¯¼å‡ºæ—¶è·å¾—å¾ˆçŸ­çš„æ—¶é—´ï¼›å…¶ä»–å†…å®¹å‚è€ƒä¸‹é¢çš„â€“single-transactioné€‰é¡¹ï¼‰ã€‚è¯¥é€‰é¡¹è‡ªåŠ¨å…³é—­â€“lock-tablesé€‰é¡¹ã€‚</p>
<p>â€“max_allowed_packet<br>æœåŠ¡å™¨å‘é€å’Œæ¥å—çš„æœ€å¤§åŒ…é•¿åº¦ã€‚</p>
<p>â€“net_buffer_length<br>TCP/IPå’Œsocketè¿æ¥çš„ç¼“å­˜å¤§å°ã€‚</p>
<p>â€“no-autocommit<br>ä½¿ç”¨autocommit/commit è¯­å¥åŒ…è£¹è¡¨ã€‚</p>
<p>â€“no-create-db,  -n<br>åªå¯¼å‡ºæ•°æ®ï¼Œè€Œä¸æ·»åŠ CREATE DATABASE è¯­å¥ã€‚</p>
<p>â€“no-create-info,  -t<br>åªå¯¼å‡ºæ•°æ®ï¼Œè€Œä¸æ·»åŠ CREATE TABLE è¯­å¥ã€‚</p>
<p>â€“no-data, -d<br>ä¸å¯¼å‡ºä»»ä½•æ•°æ®ï¼Œåªå¯¼å‡ºæ•°æ®åº“è¡¨ç»“æ„ã€‚</p>
<p>â€“no-set-names,  -N<br>ç­‰åŒäºâ€“skip-set-charset</p>
<p>â€“opt<br>ç­‰åŒäºâ€“add-drop-table,  â€“add-locks, â€“create-options, â€“quick, â€“extended-insert, â€“lock-tables,  â€“set-charset, â€“disable-keys è¯¥é€‰é¡¹é»˜è®¤å¼€å¯,  å¯ä»¥ç”¨â€“skip-optç¦ç”¨.</p>
<p>â€“order-by-primary<br>å¦‚æœå­˜åœ¨ä¸»é”®ï¼Œæˆ–è€…ç¬¬ä¸€ä¸ªå”¯ä¸€é”®ï¼Œå¯¹æ¯ä¸ªè¡¨çš„è®°å½•è¿›è¡Œæ’åºã€‚åœ¨å¯¼å‡ºMyISAMè¡¨åˆ°InnoDBè¡¨æ—¶æœ‰æ•ˆï¼Œä½†ä¼šä½¿å¾—å¯¼å‡ºå·¥ä½œèŠ±è´¹å¾ˆé•¿æ—¶é—´ã€‚ </p>
<p>â€“password, -p<br>è¿æ¥æ•°æ®åº“å¯†ç </p>
<p>â€“pipe(windowsç³»ç»Ÿå¯ç”¨)<br>ä½¿ç”¨å‘½åç®¡é“è¿æ¥mysql</p>
<p>â€“port, -P<br>è¿æ¥æ•°æ®åº“ç«¯å£å·</p>
<p>â€“protocol<br>ä½¿ç”¨çš„è¿æ¥åè®®ï¼ŒåŒ…æ‹¬ï¼štcp, socket, pipe, memory.</p>
<p>â€“quick, -q<br>ä¸ç¼“å†²æŸ¥è¯¢ï¼Œç›´æ¥å¯¼å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨â€“skip-quickå–æ¶ˆè¯¥é€‰é¡¹ã€‚</p>
<p>â€“quote-names,-Q<br>ä½¿ç”¨ï¼ˆ`ï¼‰å¼•èµ·è¡¨å’Œåˆ—åã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨â€“skip-quote-nameså–æ¶ˆè¯¥é€‰é¡¹ã€‚</p>
<p>â€“replace<br>ä½¿ç”¨REPLACE INTO å–ä»£INSERT INTO.</p>
<p>â€“result-file,  -r<br>ç›´æ¥è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ä¸­ã€‚è¯¥é€‰é¡¹åº”è¯¥ç”¨åœ¨ä½¿ç”¨å›è½¦æ¢è¡Œå¯¹ï¼ˆ\r\nï¼‰æ¢è¡Œçš„ç³»ç»Ÿä¸Šï¼ˆä¾‹å¦‚ï¼šDOSï¼ŒWindowsï¼‰ã€‚è¯¥é€‰é¡¹ç¡®ä¿åªæœ‰ä¸€è¡Œè¢«ä½¿ç”¨ã€‚</p>
<p>â€“routines, -R<br>å¯¼å‡ºå­˜å‚¨è¿‡ç¨‹ä»¥åŠè‡ªå®šä¹‰å‡½æ•°ã€‚</p>
<p>â€“set-charset<br>æ·»åŠ â€™SET NAMES  default_character_setâ€™åˆ°è¾“å‡ºæ–‡ä»¶ã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨â€“skip-set-charsetå…³é—­é€‰é¡¹ã€‚</p>
<p>â€“single-transaction<br>è¯¥é€‰é¡¹åœ¨å¯¼å‡ºæ•°æ®ä¹‹å‰æäº¤ä¸€ä¸ªBEGIN SQLè¯­å¥ï¼ŒBEGIN ä¸ä¼šé˜»å¡ä»»ä½•åº”ç”¨ç¨‹åºä¸”èƒ½ä¿è¯å¯¼å‡ºæ—¶æ•°æ®åº“çš„ä¸€è‡´æ€§çŠ¶æ€ã€‚å®ƒåªé€‚ç”¨äºå¤šç‰ˆæœ¬å­˜å‚¨å¼•æ“ï¼Œä»…InnoDBã€‚æœ¬é€‰é¡¹å’Œâ€“lock-tables é€‰é¡¹æ˜¯äº’æ–¥çš„ï¼Œå› ä¸ºLOCK  TABLES ä¼šä½¿ä»»ä½•æŒ‚èµ·çš„äº‹åŠ¡éšå«æäº¤ã€‚è¦æƒ³å¯¼å‡ºå¤§è¡¨çš„è¯ï¼Œåº”ç»“åˆä½¿ç”¨â€“quick é€‰é¡¹ã€‚</p>
<p>â€“dump-date<br>å°†å¯¼å‡ºæ—¶é—´æ·»åŠ åˆ°è¾“å‡ºæ–‡ä»¶ä¸­ã€‚é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨â€“skip-dump-dateå…³é—­é€‰é¡¹ã€‚</p>
<p>â€“skip-opt<br>ç¦ç”¨â€“opté€‰é¡¹.</p>
<p>â€“socket,-S<br>`æŒ‡å®šè¿æ¥mysqlçš„socketæ–‡ä»¶ä½ç½®ï¼Œé»˜è®¤è·¯å¾„/tmp/mysql.sock</p>
<p>â€“tab,-T<br>ä¸ºæ¯ä¸ªè¡¨åœ¨ç»™å®šè·¯å¾„åˆ›å»ºtabåˆ†å‰²çš„æ–‡æœ¬æ–‡ä»¶ã€‚æ³¨æ„ï¼šä»…ä»…ç”¨äºmysqldumpå’ŒmysqldæœåŠ¡å™¨è¿è¡Œåœ¨ç›¸åŒæœºå™¨ä¸Šã€‚</p>
<p>â€“tables<br>è¦†ç›–â€“databases (-B)å‚æ•°ï¼ŒæŒ‡å®šéœ€è¦å¯¼å‡ºçš„è¡¨åã€‚</p>
<p>â€“triggers</p>
<p>å¯¼å‡ºè§¦å‘å™¨ã€‚è¯¥é€‰é¡¹é»˜è®¤å¯ç”¨ï¼Œç”¨â€“skip-triggersç¦ç”¨å®ƒã€‚<br>`<br>â€“tz-utc<br>åœ¨å¯¼å‡ºé¡¶éƒ¨è®¾ç½®æ—¶åŒºTIME_ZONE=â€™+00:00â€™ ï¼Œä»¥ä¿è¯åœ¨ä¸åŒæ—¶åŒºå¯¼å‡ºçš„TIMESTAMP æ•°æ®æˆ–è€…æ•°æ®è¢«ç§»åŠ¨å…¶ä»–æ—¶åŒºæ—¶çš„æ­£ç¡®æ€§ã€‚</p>
<p>â€“user, -u<br>æŒ‡å®šè¿æ¥çš„ç”¨æˆ·åã€‚</p>
<p>â€“verbose, â€“v<br>è¾“å‡ºå¤šç§å¹³å°ä¿¡æ¯ã€‚</p>
<p>â€“version, -V<br>è¾“å‡ºmysqldumpç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡º</p>
<p>â€“where, -w<br>åªè½¬å‚¨ç»™å®šçš„WHEREæ¡ä»¶é€‰æ‹©çš„è®°å½•ã€‚è¯·æ³¨æ„å¦‚æœæ¡ä»¶åŒ…å«å‘½ä»¤è§£é‡Šç¬¦ä¸“ç”¨ç©ºæ ¼æˆ–å­—ç¬¦ï¼Œä¸€å®šè¦å°†æ¡ä»¶å¼•ç”¨èµ·æ¥ã€‚</p>
<p>â€“xml, -X<br>å¯¼å‡ºXMLæ ¼å¼.</p>
<p>â€“plugin_dir<br>å®¢æˆ·ç«¯æ’ä»¶çš„ç›®å½•ï¼Œç”¨äºå…¼å®¹ä¸åŒçš„æ’ä»¶ç‰ˆæœ¬ã€‚</p>
<p>â€“default_auth<br>å®¢æˆ·ç«¯æ’ä»¶é»˜è®¤ä½¿ç”¨æƒé™ã€‚</p>
<p>å¤‡ä»½æ•°æ®åº“å¸¸ç”¨æ¡ˆä¾‹ï¼š</p>
<table>
<thead>
<tr>
<th>å¤‡ä»½å†…å®¹</th>
<th>æƒ…å†µ1</th>
<th>å‚æ•°</th>
<th>æƒ…å†µ2</th>
<th>å‚æ•°</th>
<th>æƒ…å†µ3</th>
</tr>
</thead>
<tbody><tr>
<td>åº“çš„æ•°é‡</td>
<td>æ‰€æœ‰</td>
<td>-A</td>
<td>å¤šä¸ª</td>
<td>-B db1 db2 db3</td>
<td>db1</td>
</tr>
<tr>
<td>è¡¨çš„æ•°é‡</td>
<td>æ‰€æœ‰</td>
<td></td>
<td>å¤šä¸ª</td>
<td>â€“table t1 t2</td>
<td>ä¸€ä¸ª t1</td>
</tr>
<tr>
<td>ç»“æ„</td>
<td>å¯¼å‡º</td>
<td></td>
<td>ä¸å¯¼å‡º</td>
<td>-t</td>
<td></td>
</tr>
<tr>
<td>æ•°æ®</td>
<td>å¯¼å‡º</td>
<td></td>
<td>ä¸å¯¼å‡º</td>
<td>-d</td>
<td></td>
</tr>
<tr>
<td>åˆ—å</td>
<td>å¯¼å‡º</td>
<td>-c</td>
<td>ä¸å¯¼å‡º</td>
<td></td>
<td></td>
</tr>
<tr>
<td>å­˜å‚¨è¿‡ç¨‹</td>
<td>å¯¼å‡º</td>
<td>-R</td>
<td>ä¸å¯¼å‡º</td>
<td></td>
<td></td>
</tr>
<tr>
<td>åˆ›å»ºæ•°æ®åº“</td>
<td>å¯¼å‡º</td>
<td></td>
<td>ä¸å¯¼å‡º</td>
<td>-n</td>
<td></td>
</tr>
</tbody></table>
<ol>
<li><p>å¯¼å‡ºç»“æ„ä¸å¯¼å‡ºæ•°æ®</p>
<p><code>mysqldump -d æ•°æ®åº“å -uroot -p &gt; xxx.sql</code></p>
</li>
<li><p>å¯¼å‡ºæ•°æ®ä¸å¯¼å‡ºç»“æ„</p>
<p><code>mysqldump -t æ•°æ®åº“å -uroot -p &gt; xxx.sql</code></p>
</li>
<li><p>å¯¼å‡ºæ•°æ®å’Œè¡¨ç»“æ„</p>
<p><code>mysqldump æ•°æ®åº“å -uroot -p &gt; xxx.sql</code></p>
</li>
<li><p>å¯¼å‡ºç‰¹å®šè¡¨çš„ç»“æ„</p>
<p><code>mysqldump -uroot -p -Bæ•°æ®åº“å --table è¡¨å &gt; xxx.sql</code></p>
</li>
<li><p>å¯¼å‡ºdb1åº“ä¸­t1è¡¨çš„è¡¨ç»“æ„å’Œæ•°æ®ï¼Œå¹¶ä¸”æ‰“å°å‡ºåˆ—å</p>
<p><code>mysqldump -uusername -ppassword db1 t1 -c &gt; xxx.sql</code> </p>
<p> -c, â€“complete-insert   ä½¿ç”¨å®Œæ•´çš„insertè¯­å¥(ç”¨åˆ—åå­—)ã€‚</p>
</li>
<li><p>åªå¯¼å‡ºå­˜å‚¨è¿‡ç¨‹</p>
<p><code>mysqldump -B db1 db2 -t -d -n -R &gt; xxx.sql</code></p>
</li>
</ol>
<h2 id="mysqlpump"><a href="#mysqlpump" class="headerlink" title="mysqlpump"></a>mysqlpump</h2><p>MySQL5.7ä¹‹åå¤šäº†ä¸€ä¸ªå¤‡ä»½å·¥å…·ï¼šmysqlpumpã€‚å®ƒæ˜¯mysqldumpçš„ä¸€ä¸ªè¡ç”Ÿï¼Œmysqldumpå°±ä¸å¤šè¯´æ˜äº†ï¼Œç°åœ¨çœ‹çœ‹mysqlpumpåˆ°åº•æœ‰äº†å“ªäº›æå‡ï¼Œå¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œé’ˆå¯¹å¦‚ä½•ä½¿ç”¨åšä¸‹è¯´æ˜ã€‚</p>
<p>mysqlpumpå’Œmysqldumpä¸€æ ·ï¼Œå±äºé€»è¾‘å¤‡ä»½ï¼Œå¤‡ä»½ä»¥SQLå½¢å¼çš„æ–‡æœ¬ä¿å­˜ã€‚é€»è¾‘å¤‡ä»½ç›¸å¯¹ç‰©ç†å¤‡ä»½çš„å¥½å¤„æ˜¯ä¸å…³å¿ƒundo logçš„å¤§å°ï¼Œç›´æ¥å¤‡ä»½æ•°æ®å³å¯ã€‚å®ƒæœ€ä¸»è¦çš„ç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>å¹¶è¡Œå¤‡ä»½æ•°æ®åº“å’Œæ•°æ®åº“ä¸­çš„å¯¹è±¡çš„ï¼ŒåŠ å¿«å¤‡ä»½è¿‡ç¨‹ã€‚</li>
<li>æ›´å¥½çš„æ§åˆ¶æ•°æ®åº“å’Œæ•°æ®åº“å¯¹è±¡ï¼ˆè¡¨ï¼Œå­˜å‚¨è¿‡ç¨‹ï¼Œç”¨æˆ·å¸æˆ·ï¼‰çš„å¤‡ä»½ã€‚</li>
<li>å¤‡ä»½ç”¨æˆ·è´¦å·ä½œä¸ºå¸æˆ·ç®¡ç†è¯­å¥ï¼ˆCREATE USERï¼ŒGRANTï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥æ’å…¥åˆ°MySQLçš„ç³»ç»Ÿæ•°æ®åº“ã€‚</li>
<li>å¤‡ä»½å‡ºæ¥ç›´æ¥ç”Ÿæˆå‹ç¼©åçš„å¤‡ä»½æ–‡ä»¶ã€‚</li>
<li>å¤‡ä»½è¿›åº¦æŒ‡ç¤ºï¼ˆä¼°è®¡å€¼ï¼‰ã€‚</li>
<li>é‡æ–°åŠ è½½ï¼ˆè¿˜åŸï¼‰å¤‡ä»½æ–‡ä»¶ï¼Œå…ˆå»ºè¡¨åæ’å…¥æ•°æ®æœ€åå»ºç«‹ç´¢å¼•ï¼Œå‡å°‘äº†ç´¢å¼•ç»´æŠ¤å¼€é”€ï¼Œ</li>
<li>åŠ å¿«äº†è¿˜åŸé€Ÿåº¦ã€‚</li>
<li>å¤‡ä»½å¯ä»¥æ’é™¤æˆ–åˆ™æŒ‡å®šæ•°æ®åº“ã€‚</li>
</ul>
<h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><p>ç»å¤§éƒ¨åˆ†å‚æ•°å’Œmysqldumpä¸€è‡´</p>
<p>1ï¼šâ€“add-drop-databaseï¼šåœ¨å»ºç«‹åº“ä¹‹å‰å…ˆæ‰§è¡Œåˆ åº“æ“ä½œã€‚</p>
<p>DROP DATABASE IF EXISTS <code>...</code>;</p>
<p>2ï¼šâ€“add-drop-tableï¼šåœ¨å»ºè¡¨ä¹‹å‰å…ˆæ‰§è¡Œåˆ è¡¨æ“ä½œã€‚</p>
<p>DROP TABLE IF EXISTS <code>...</code>.<code>...</code>;</p>
<p>3ï¼šâ€“add-drop-userï¼šåœ¨CREATE USERè¯­å¥ä¹‹å‰å¢åŠ DROP USERï¼Œæ³¨æ„ï¼šè¿™ä¸ªå‚æ•°éœ€è¦å’Œâ€“usersä¸€èµ·ä½¿ç”¨ï¼Œå¦è€…ä¸ç”Ÿæ•ˆã€‚</p>
<p>DROP USER â€˜backupâ€™@â€™192.168.123.%â€™;</p>
<p>4ï¼šâ€“add-locksï¼šå¤‡ä»½è¡¨æ—¶ï¼Œä½¿ç”¨LOCK TABLESå’ŒUNLOCK TABLESã€‚æ³¨æ„ï¼šè¿™ä¸ªå‚æ•°ä¸æ”¯æŒå¹¶è¡Œå¤‡ä»½ï¼Œéœ€è¦å…³é—­å¹¶è¡Œå¤‡ä»½åŠŸèƒ½ï¼šâ€“default-parallelism=0 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">LOCK TABLES `...`.`...` WRITE;</span><br><span class="line">...</span><br><span class="line">UNLOCK TABLES;</span><br></pre></td></tr></table></figure>

<p>5ï¼šâ€“all-databasesï¼šå¤‡ä»½æ‰€æœ‰åº“ï¼Œ-Aã€‚</p>
<p>6ï¼šâ€“bind-addressï¼šæŒ‡å®šé€šè¿‡å“ªä¸ªç½‘ç»œæ¥å£æ¥è¿æ¥MysqlæœåŠ¡å™¨ï¼ˆä¸€å°æœåŠ¡å™¨å¯èƒ½æœ‰å¤šä¸ªIPï¼‰ï¼Œé˜²æ­¢åŒä¸€ä¸ªç½‘å¡å‡ºå»å½±å“ä¸šåŠ¡ã€‚</p>
<p>7ï¼šâ€“complete-insertï¼šdumpå‡ºåŒ…å«æ‰€æœ‰åˆ—çš„å®Œæ•´insertè¯­å¥ã€‚</p>
<p>8ï¼šâ€“compressï¼š å‹ç¼©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¼ è¾“çš„æ‰€æœ‰çš„æ•°æ®ï¼Œ-Cã€‚</p>
<p>9ï¼šâ€“compress-outputï¼šé»˜è®¤ä¸å‹ç¼©è¾“å‡ºï¼Œç›®å‰å¯ä»¥ä½¿ç”¨çš„å‹ç¼©ç®—æ³•æœ‰LZ4å’ŒZLIBã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">shell&gt;</span><span class="bash"> mysqlpump --compress-output=LZ4 &gt; dump.lz4</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> lz4_decompress dump.lz4 dump.txt</span></span><br><span class="line"></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> mysqlpump --compress-output=ZLIB &gt; dump.zlib</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> zlib_decompress dump.zlib dump.txt</span></span><br></pre></td></tr></table></figure>

<p>10ï¼šâ€“databasesï¼šæ‰‹åŠ¨æŒ‡å®šè¦å¤‡ä»½çš„åº“ï¼Œæ”¯æŒå¤šä¸ªæ•°æ®åº“ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼Œ-Bã€‚</p>
<p>11ï¼šâ€“default-character-setï¼šæŒ‡å®šå¤‡ä»½çš„å­—ç¬¦é›†ã€‚</p>
<p>12ï¼šâ€“default-parallelismï¼šæŒ‡å®šå¹¶è¡Œçº¿ç¨‹æ•°ï¼Œé»˜è®¤æ˜¯2ï¼Œå¦‚æœè®¾ç½®æˆ0ï¼Œè¡¨ç¤ºä¸ä½¿ç”¨å¹¶è¡Œå¤‡ä»½ã€‚æ³¨æ„ï¼šæ¯ä¸ªçº¿ç¨‹çš„å¤‡ä»½æ­¥éª¤æ˜¯ï¼šå…ˆcreate tableä½†ä¸å»ºç«‹äºŒçº§ç´¢å¼•ï¼ˆä¸»é”®ä¼šåœ¨create tableæ—¶å€™å»ºç«‹ï¼‰ï¼Œå†å†™å…¥æ•°æ®ï¼Œæœ€åå»ºç«‹äºŒçº§ç´¢å¼•ã€‚</p>
<p>13ï¼šâ€“defer-table-indexesï¼šå»¶è¿Ÿåˆ›å»ºç´¢å¼•ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½åŠ è½½å®Œä¹‹åï¼Œå†åˆ›å»ºç´¢å¼•ï¼Œé»˜è®¤å¼€å¯ã€‚è‹¥å…³é—­åˆ™ä¼šå’Œmysqldumpä¸€æ ·ï¼šå…ˆåˆ›å»ºä¸€ä¸ªè¡¨å’Œæ‰€æœ‰ç´¢å¼•ï¼Œå†å¯¼å…¥æ•°æ®ï¼Œå› ä¸ºåœ¨åŠ è½½è¿˜åŸæ•°æ®çš„æ—¶å€™è¦ç»´æŠ¤äºŒçº§ç´¢å¼•çš„å¼€é”€ï¼Œå¯¼è‡´æ•ˆç‡æ¯”è¾ƒä½ã€‚å…³é—­ä½¿ç”¨å‚æ•°ï¼šâ€“skipâ€“defer-table-indexesã€‚</p>
<p>14ï¼šâ€“eventsï¼šå¤‡ä»½æ•°æ®åº“çš„äº‹ä»¶ï¼Œé»˜è®¤å¼€å¯ï¼Œå…³é—­ä½¿ç”¨â€“skip-eventså‚æ•°ã€‚</p>
<p>15ï¼šâ€“exclude-databasesï¼šå¤‡ä»½æ’é™¤è¯¥å‚æ•°æŒ‡å®šçš„æ•°æ®åº“ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”ã€‚ç±»ä¼¼çš„è¿˜æœ‰â€“exclude-eventsã€â€“exclude-routinesã€â€“exclude-tablesã€â€“exclude-triggersã€â€“exclude-usersã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysqlpump --exclude-databases=mysql,sys    #å¤‡ä»½è¿‡æ»¤mysqlå’Œsysæ•°æ®åº“</span><br><span class="line"></span><br><span class="line">mysqlpump --exclude-tables=rr,tt   #å¤‡ä»½è¿‡æ»¤æ‰€æœ‰æ•°æ®åº“ä¸­rrã€ttè¡¨</span><br><span class="line"></span><br><span class="line">mysqlpump -B test --exclude-tables=tmp_ifulltext,tt #å¤‡ä»½è¿‡æ»¤teståº“ä¸­çš„rrã€ttè¡¨</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šè¦æ˜¯åªå¤‡ä»½æ•°æ®åº“çš„è´¦å·ï¼Œéœ€è¦æ·»åŠ å‚æ•°â€“usersï¼Œå¹¶ä¸”éœ€è¦è¿‡æ»¤æ‰æ‰€æœ‰çš„æ•°æ®åº“ï¼Œå¦‚ï¼š</p>
<p>mysqlpump â€“users â€“exclude-databases=sys,mysql,db1,db2 â€“exclude-users=dba,backup  #å¤‡ä»½é™¤dbaå’Œbackupçš„æ‰€æœ‰è´¦å·ã€‚</p>
<p>16ï¼šâ€“include-databasesï¼šæŒ‡å®šå¤‡ä»½æ•°æ®åº“ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼Œç±»ä¼¼çš„è¿˜æœ‰â€“include-eventsã€â€“include-routinesã€â€“include-tablesã€â€“include-triggersã€â€“include-usersï¼Œå¤§è‡´æ–¹æ³•ä½¿ç”¨åŒ15ã€‚</p>
<p>17ï¼šâ€“insert-ignoreï¼šå¤‡ä»½ç”¨insert ignoreè¯­å¥ä»£æ›¿insertè¯­å¥ã€‚</p>
<p>18ï¼šâ€“log-error-fileï¼šå¤‡ä»½å‡ºç°çš„warningså’Œerrosä¿¡æ¯è¾“å‡ºåˆ°ä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶ã€‚</p>
<p>19ï¼šâ€“max-allowed-packetï¼šå¤‡ä»½æ—¶ç”¨äºclient/serverç›´æ¥é€šä¿¡çš„æœ€å¤§bufferåŒ…çš„å¤§å°ã€‚</p>
<p>20ï¼šâ€“net-buffer-lengthï¼šå¤‡ä»½æ—¶ç”¨äºclient/serveré€šä¿¡çš„åˆå§‹bufferå¤§å°ï¼Œå½“åˆ›å»ºå¤šè¡Œæ’å…¥è¯­å¥çš„æ—¶å€™ï¼Œmysqlpump åˆ›å»ºè¡Œåˆ°Nä¸ªå­—èŠ‚é•¿ã€‚</p>
<p>21ï¼šâ€“no-create-dbï¼šå¤‡ä»½ä¸å†™CREATE DATABASEè¯­å¥ã€‚è¦æ˜¯å¤‡ä»½å¤šä¸ªåº“ï¼Œéœ€è¦ä½¿ç”¨å‚æ•°-Bï¼Œè€Œä½¿ç”¨-Bçš„æ—¶å€™ä¼šå‡ºç°create databaseè¯­å¥ï¼Œè¯¥å‚æ•°å¯ä»¥å±è”½create database è¯­å¥ã€‚</p>
<p>22ï¼šâ€“no-create-infoï¼šå¤‡ä»½ä¸å†™å»ºè¡¨è¯­å¥ï¼Œå³ä¸å¤‡ä»½è¡¨ç»“æ„ï¼Œåªå¤‡ä»½æ•°æ®ï¼Œ-tã€‚</p>
<p>23ï¼šâ€“hex-blobï¼š å¤‡ä»½binaryå­—æ®µçš„æ—¶å€™ä½¿ç”¨åå…­è¿›åˆ¶è®¡æ•°æ³•ï¼Œå—å½±å“çš„å­—æ®µç±»å‹æœ‰BINARYã€VARBINARYã€BLOBã€BITã€‚</p>
<p>24ï¼šâ€“host ï¼šå¤‡ä»½æŒ‡å®šçš„æ•°æ®åº“åœ°å€ï¼Œ-hã€‚</p>
<p>25ï¼šâ€“parallel-schemas=[N:]db_listï¼šæŒ‡å®šå¹¶è¡Œå¤‡ä»½çš„åº“ï¼Œå¤šä¸ªåº“ç”¨é€—å·åˆ†éš”ï¼Œå¦‚æœæŒ‡å®šäº†Nï¼Œå°†ä½¿ç”¨Nä¸ªçº¿ç¨‹çš„åœ°é˜Ÿåˆ—ï¼Œå¦‚æœNä¸æŒ‡å®šï¼Œå°†ç”± â€“default-parallelismæ‰ç¡®è®¤Nçš„å€¼ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªâ€“parallel-schemasã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysqlpump --parallel-schemas=4:vs,aa --parallel-schemas=3:pt   #4ä¸ªçº¿ç¨‹å¤‡ä»½vså’Œaaï¼Œ3ä¸ªçº¿ç¨‹å¤‡ä»½ptã€‚é€šè¿‡show processlist å¯ä»¥çœ‹åˆ°æœ‰7ä¸ªçº¿ç¨‹ã€‚</span><br><span class="line"></span><br><span class="line">mysqlpump --parallel-schemas=vs,abc --parallel-schemas=pt  #é»˜è®¤2ä¸ªçº¿ç¨‹ï¼Œå³2ä¸ªçº¿ç¨‹å¤‡ä»½vså’Œabcï¼Œ2ä¸ªçº¿ç¨‹å¤‡ä»½pt</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###å½“ç„¶è¦æ˜¯ç¡¬ç›˜IOä¸å…è®¸çš„è¯ï¼Œå¯ä»¥å°‘å¼€å‡ ä¸ªçº¿ç¨‹å’Œæ•°æ®åº“è¿›è¡Œå¹¶è¡Œå¤‡ä»½</span></span></span><br></pre></td></tr></table></figure>

<p>26ï¼šâ€“passwordï¼šå¤‡ä»½éœ€è¦çš„å¯†ç ã€‚</p>
<p>27ï¼šâ€“port ï¼šå¤‡ä»½æ•°æ®åº“çš„ç«¯å£ã€‚</p>
<p>28ï¼šâ€“protocol={TCP|SOCKET|PIPE|MEMORY}ï¼šæŒ‡å®šè¿æ¥æœåŠ¡å™¨çš„åè®®ã€‚</p>
<p>29ï¼šâ€“replaceï¼šå¤‡ä»½å‡ºæ¥replace intoè¯­å¥ã€‚</p>
<p>30ï¼šâ€“routinesï¼šå¤‡ä»½å‡ºæ¥åŒ…å«å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ï¼Œé»˜è®¤å¼€å¯ï¼Œéœ€è¦å¯¹ mysql.procè¡¨æœ‰æŸ¥çœ‹æƒé™ã€‚ç”Ÿæˆçš„æ–‡ä»¶ä¸­ä¼šåŒ…å«CREATE PROCEDURE å’Œ CREATE FUNCTIONè¯­å¥ä»¥ç”¨äºæ¢å¤ï¼Œå…³é—­åˆ™éœ€è¦ç”¨â€“skip-routineså‚æ•°ã€‚</p>
<p>31ï¼šâ€“triggersï¼šå¤‡ä»½å‡ºæ¥åŒ…å«è§¦å‘å™¨ï¼Œé»˜è®¤å¼€å¯ï¼Œä½¿ç”¨â€“skip-triggersæ¥å…³é—­ã€‚</p>
<p>31ï¼šâ€“set-charsetï¼šå¤‡ä»½æ–‡ä»¶é‡Œå†™SET NAMES default_character_set åˆ°è¾“å‡ºï¼Œæ­¤å‚é»˜è®¤å¼€å¯ã€‚ â€“ skip-set-charsetç¦ç”¨æ­¤å‚æ•°ï¼Œä¸ä¼šåœ¨å¤‡ä»½æ–‡ä»¶é‡Œé¢å†™å‡ºset namesâ€¦</p>
<p>32ï¼šâ€“single-transactionï¼šè¯¥å‚æ•°åœ¨äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®æˆRepeatable Readï¼Œå¹¶åœ¨dumpä¹‹å‰å‘é€start transaction è¯­å¥ç»™æœåŠ¡ç«¯ã€‚è¿™åœ¨ä½¿ç”¨innodbæ—¶å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºåœ¨å‘å‡ºstart transactionæ—¶ï¼Œä¿è¯äº†åœ¨ä¸é˜»å¡ä»»ä½•åº”ç”¨ä¸‹çš„ä¸€è‡´æ€§çŠ¶æ€ã€‚å¯¹myisamå’Œmemoryç­‰éäº‹åŠ¡è¡¨ï¼Œè¿˜æ˜¯ä¼šæ”¹å˜çŠ¶æ€çš„ï¼Œå½“ä½¿ç”¨æ­¤å‚çš„æ—¶å€™è¦ç¡®ä¿æ²¡æœ‰å…¶ä»–è¿æ¥åœ¨ä½¿ç”¨ALTER TABLEã€CREATE TABLEã€DROP TABLEã€RENAME TABLEã€TRUNCATE TABLEç­‰è¯­å¥ï¼Œå¦åˆ™ä¼šå‡ºç°ä¸æ­£ç¡®çš„å†…å®¹æˆ–åˆ™å¤±è´¥ã€‚â€“add-lockså’Œæ­¤å‚äº’æ–¥ï¼Œåœ¨mysql5.7.11ä¹‹å‰ï¼Œâ€“default-parallelismå¤§äº1çš„æ—¶å€™å’Œæ­¤å‚ä¹Ÿäº’æ–¥ï¼Œå¿…é¡»ä½¿ç”¨â€“default-parallelism=0ã€‚5.7.11ä¹‹åè§£å†³äº†â€“single-transactionå’Œâ€“default-parallelismçš„äº’æ–¥é—®é¢˜ã€‚</p>
<p>33ï¼šâ€“skip-definerï¼šå¿½ç•¥é‚£äº›åˆ›å»ºè§†å›¾å’Œå­˜å‚¨è¿‡ç¨‹ç”¨åˆ°çš„ DEFINER å’Œ SQL SECURITY è¯­å¥ï¼Œæ¢å¤çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œå¦åˆ™ä¼šåœ¨è¿˜åŸçš„æ—¶å€™çœ‹åˆ°æ²¡æœ‰DEFINERå®šä¹‰æ—¶çš„è´¦å·è€ŒæŠ¥é”™ã€‚</p>
<p>34ï¼šâ€“skip-dump-rowsï¼šåªå¤‡ä»½è¡¨ç»“æ„ï¼Œä¸å¤‡ä»½æ•°æ®ï¼Œ-dã€‚æ³¨æ„ï¼šmysqldumpæ”¯æŒâ€“no-dataï¼Œmysqlpumpä¸æ”¯æŒâ€“no-data</p>
<p>35ï¼šâ€“socketï¼šå¯¹äºè¿æ¥åˆ°localhostï¼ŒUnixä½¿ç”¨å¥—æ¥å­—æ–‡ä»¶ï¼Œåœ¨Windowsä¸Šæ˜¯å‘½åç®¡é“çš„åç§°ä½¿ç”¨ï¼Œ-Sã€‚</p>
<p>36ï¼šâ€“sslï¼šâ€“sslå‚æ•°å°†è¦è¢«å»é™¤ï¼Œç”¨â€“ssl-modeå–ä»£ã€‚å…³äºsslç›¸å…³çš„å¤‡ä»½ï¼Œè¯·çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p>
<p>37ï¼šâ€“tz-utcï¼šå¤‡ä»½æ—¶ä¼šåœ¨å¤‡ä»½æ–‡ä»¶çš„æœ€å‰å‡ è¡Œæ·»åŠ SET TIME_ZONE=â€™+00:00â€™ã€‚æ³¨æ„ï¼šå¦‚æœè¿˜åŸçš„æœåŠ¡å™¨ä¸åœ¨åŒä¸€ä¸ªæ—¶åŒºå¹¶ä¸”è¿˜åŸè¡¨ä¸­çš„åˆ—æœ‰timestampå­—æ®µï¼Œä¼šå¯¼è‡´è¿˜åŸå‡ºæ¥çš„ç»“æœä¸ä¸€è‡´ã€‚é»˜è®¤å¼€å¯è¯¥å‚æ•°ï¼Œç”¨ â€“skip-tz-utcæ¥å…³é—­å‚æ•°ã€‚</p>
<p>38ï¼šâ€“userï¼šå¤‡ä»½æ—¶å€™çš„ç”¨æˆ·åï¼Œ-uã€‚</p>
<p>39ï¼šâ€“usersï¼šå¤‡ä»½æ•°æ®åº“ç”¨æˆ·ï¼Œå¤‡ä»½çš„å½¢å¼æ˜¯CREATE USERâ€¦ï¼ŒGRANTâ€¦ï¼Œåªå¤‡ä»½æ•°æ®åº“è´¦å·å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<p>mysqlpump â€“exclude-databases=% â€“users    #è¿‡æ»¤æ‰æ‰€æœ‰æ•°æ®åº“</p>
<p>40ï¼šâ€“watch-progressï¼šå®šæœŸæ˜¾ç¤ºè¿›åº¦çš„å®Œæˆï¼ŒåŒ…æ‹¬æ€»æ•°è¡¨ã€è¡Œå’Œå…¶ä»–å¯¹è±¡ã€‚è¯¥å‚æ•°é»˜è®¤å¼€å¯ï¼Œç”¨â€“skip-watch-progressæ¥å…³é—­ã€‚</p>
<h3 id="ä½¿ç”¨è¯´æ˜"><a href="#ä½¿ç”¨è¯´æ˜" class="headerlink" title="ä½¿ç”¨è¯´æ˜"></a>ä½¿ç”¨è¯´æ˜</h3><p>mysqlpumpçš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="pic/71.png" alt=""></p>
<p>mysqlpumpæ”¯æŒåŸºäºåº“å’Œè¡¨çš„å¹¶è¡Œå¯¼å‡ºï¼Œmysqlpumpçš„å¹¶è¡Œå¯¼å‡ºåŠŸèƒ½çš„æ¶æ„ä¸ºï¼šé˜Ÿåˆ—+çº¿ç¨‹ï¼Œå…è®¸æœ‰å¤šä¸ªé˜Ÿåˆ—ï¼ˆâ€“parallel-schemasï¼Ÿï¼‰ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¸‹æœ‰å¤šä¸ªçº¿ç¨‹ï¼ˆNï¼Ÿï¼‰ï¼Œè€Œä¸€ä¸ªé˜Ÿåˆ—å¯ä»¥ç»‘å®š1ä¸ªæˆ–è€…å¤šä¸ªæ•°æ®åº“ï¼ˆé€—å·åˆ†éš”ï¼‰ã€‚mysqlpumpçš„å¤‡ä»½æ˜¯åŸºäºè¡¨å¹¶è¡Œçš„ï¼Œå¯¹äºæ¯å¼ è¡¨çš„å¯¼å‡ºåªèƒ½æ˜¯å•ä¸ªçº¿ç¨‹çš„ï¼Œè¿™é‡Œä¼šæœ‰ä¸ªé™åˆ¶æ˜¯å¦‚æœæŸä¸ªæ•°æ®åº“æœ‰ä¸€å¼ è¡¨éå¸¸å¤§ï¼Œå¯èƒ½å¤§éƒ¨åˆ†çš„æ—¶é—´éƒ½æ˜¯æ¶ˆè€—åœ¨è¿™ä¸ªè¡¨çš„å¤‡ä»½ä¸Šé¢ï¼Œå¹¶è¡Œå¤‡ä»½çš„æ•ˆæœå¯èƒ½å°±ä¸æ˜æ˜¾ã€‚è¿™é‡Œå¯ä»¥åˆ©ç”¨mydumperå…¶æ˜¯ä»¥chunkçš„æ–¹å¼æ‰¹é‡å¯¼å‡ºï¼Œå³mydumperæ”¯æŒä¸€å¼ è¡¨å¤šä¸ªçº¿ç¨‹ä»¥chunkçš„æ–¹å¼æ‰¹é‡å¯¼å‡ºã€‚ä½†æ˜¯ç›¸å¯¹äºmysqldumpè¿˜æ˜¯æœ‰äº†å¾ˆå¤§çš„æå‡ã€‚è¿™é‡Œå¤§è‡´æµ‹è¯•ä¸‹mysqlpumpå’Œmysqldumpçš„å¤‡ä»½æ•ˆç‡ã€‚ </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">mysqlpumpå‹ç¼©å¤‡ä»½vsæ•°æ®åº“ ä¸‰ä¸ªå¹¶å‘çº¿ç¨‹å¤‡ä»½ï¼Œæ¶ˆè€—æ—¶é—´ï¼š222s</span></span><br><span class="line">mysqlpump -uzjy -p -h192.168.123.70 --single-transaction --default-character-set=utf8 --compress-output=LZ4 --default-parallelism=3 -B vs &gt; /home/zhoujy/vs_db.sql.lz4</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">mysqldumpå¤‡ä»½å‹ç¼©vsæ•°æ®åº“ å•ä¸ªçº¿ç¨‹å¤‡ä»½ï¼Œæ¶ˆè€—æ—¶é—´ï¼š900sï¼Œgzipçš„å‹ç¼©ç‡æ¯”LZ4çš„é«˜</span></span><br><span class="line">mysqldump -uzjy -p -h192.168.123.70 --default-character-set=utf8 -P3306 --skip-opt --add-drop-table --create-options  --quick --extended-insert --single-transaction -B vs | gzip &gt; /home/zhoujy/vs.sql.gz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">mydumperå¤‡ä»½vsæ•°æ®åº“ ä¸‰ä¸ªå¹¶å‘çº¿ç¨‹å¤‡ä»½ï¼Œæ¶ˆè€—æ—¶é—´ï¼š300sï¼Œgzipçš„å‹ç¼©ç‡æ¯”LZ4çš„é«˜</span></span><br><span class="line">mydumper -u zjy -p  -h 192.168.123.70 -P 3306 -t 3 -c -l 3600 -s 10000000 -B vs -o /home/zhoujy/vs/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">mydumperå¤‡ä»½vsæ•°æ®åº“ï¼Œäº”ä¸ªå¹¶å‘çº¿ç¨‹å¤‡ä»½ï¼Œå¹¶ä¸”å¼€å¯å¯¹ä¸€å¼ è¡¨å¤šä¸ªçº¿ç¨‹ä»¥chunkçš„æ–¹å¼æ‰¹é‡å¯¼å‡ºï¼Œ-rã€‚æ¶ˆè€—æ—¶é—´ï¼š180s</span></span><br><span class="line">mydumper -u zjy -p  -h 192.168.123.70 -P 3306 -t 5 -c -r 300000 -l 3600 -s 10000000 -B vs -o /home/zhoujy/vs/</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çœ‹å‡ºï¼Œmysqlpumpçš„å¤‡ä»½æ•ˆç‡æ˜¯æœ€å¿«çš„ï¼Œmydumperæ¬¡ä¹‹ï¼Œmysqldumpæœ€å·®ã€‚æ‰€ä»¥åœ¨IOå…è®¸çš„æƒ…å†µä¸‹ï¼Œèƒ½ç”¨å¤šçº¿ç¨‹å°±åˆ«ç”¨å•çº¿ç¨‹å¤‡ä»½ã€‚å¹¶ä¸”mysqlpumpè¿˜æ”¯æŒå¤šæ•°æ®åº“çš„å¹¶è¡Œå¤‡ä»½ï¼Œè€Œmydumperè¦ä¹ˆå¤‡ä»½ä¸€ä¸ªåº“ï¼Œè¦ä¹ˆå°±å¤‡ä»½æ‰€æœ‰åº“ã€‚å§œå¤§ç¥çš„Oracleå®˜æ–¹å¹¶è¡Œé€»è¾‘å¤‡ä»½å·¥å…·mysqlpumpè¿™ç¯‡æ–‡ç« çš„æµ‹è¯•ç»“æœä¹Ÿè¯´æ˜äº†mysqlpumpæ¯”mysqldumpçš„æµ‹è¯•å¥½ã€‚ç”±äºå®é™…æƒ…å†µä¸åŒï¼Œæµ‹è¯•ç»™å‡ºçš„é€Ÿåº¦æå‡åªæ˜¯å‚è€ƒã€‚åˆ°åº•å¼€å¯å¤šå°‘ä¸ªå¹¶è¡Œå¤‡ä»½çš„çº¿ç¨‹ï¼Œè¿™ä¸ªçœ‹ç£ç›˜IOçš„æ‰¿å—èƒ½åŠ›ï¼Œè‹¥è¯¥æœåŠ¡å™¨åªè¿›è¡Œå¤‡ä»½ä»»åŠ¡ï¼Œå¯ä»¥æœ€å¤§é™åˆ¶çš„æ¥åˆ©ç”¨ç£ç›˜ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<p>mysqldumpå’Œmysqlpumpçš„ä½¿ç”¨æ–¹æ³•ç»å¤§éƒ¨åˆ†ä¸€è‡´ï¼Œåˆ°åº•ç”¨é‚£ç§å·¥å…·å¤‡ä»½æ•°æ®åº“è¿™ä¸ªè¦åœ¨å…·ä½“çš„ç¯å¢ƒä¸‹æ‰èƒ½åšå‡ºé€‰æ‹©ï¼Œæœ‰äº›æ—¶å€™å¯èƒ½ç”¨ç‰©ç†å¤‡ä»½æ›´å¥½ï¼ˆxtrabackupï¼‰ï¼Œæ€»ä¹‹æ ¹æ®éœ€è¦è¿›è¡Œæµ‹è¯•ï¼Œæœ€åå†å†³å®šä½¿ç”¨å“ªç§å¤‡ä»½å·¥å…·è¿›è¡Œå¤‡ä»½ã€‚</p>
<p>â€“</p>
<h2 id="mydumper"><a href="#mydumper" class="headerlink" title="mydumper"></a>mydumper</h2><p>mydumperï¼ˆ&amp;myloaderï¼‰æ˜¯ç”¨äºå¯¹MySQLæ•°æ®åº“è¿›è¡Œå¤šçº¿ç¨‹å¤‡ä»½å’Œæ¢å¤çš„å¼€æº (GNU GPLv3)å·¥å…·ã€‚å¼€å‘äººå‘˜ä¸»è¦æ¥è‡ªMySQLã€Facebookå’ŒSkySQLå…¬å¸ï¼Œç›®å‰ç”±Perconaå…¬å¸å¼€å‘å’Œç»´æŠ¤ï¼Œæ˜¯PerconaRemote DBAé¡¹ç›®çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼ŒåŒ…å«åœ¨Percona XtraDB Clusterä¸­ã€‚mydumperçš„ç¬¬ä¸€ç‰ˆ0.1å‘å¸ƒäº2010.3.26ï¼Œæœ€æ–°ç‰ˆæœ¬0.9.1å‘å¸ƒäº2015.11.06ã€‚</p>
<p>mydumperæ˜¯ä¸€ç§æ¯”MySQLå®˜æ–¹mysqldumpæ›´ä¼˜ç§€çš„å¤‡ä»½å·¥å…·ï¼Œä¸»è¦ä½“ç°åœ¨å¤šçº¿ç¨‹å’Œå¤‡ä»½æ–‡ä»¶ä¿å­˜æ–¹å¼ä¸Šã€‚åœ¨MySQL 5.7ç‰ˆæœ¬ä¸­ï¼Œå®˜æ–¹å‘å¸ƒäº†ä¸€ç§æ–°çš„å¤‡ä»½å·¥å…·mysqlpumpï¼Œä¹Ÿæ˜¯å¤šçº¿ç¨‹çš„ï¼Œå…¶å®ç°æ–¹å¼ç»™äººè€³ç›®ä¸€æ–°çš„æ„Ÿè§‰ï¼Œä½†é—æ†¾çš„æ˜¯å…¶ä»ä¸ºè¡¨çº§åˆ«çš„å¹¶è¡Œã€‚è€Œmydumperèƒ½å¤Ÿå®ç°è®°å½•çº§åˆ«çš„å¹¶è¡Œå¤‡ä»½ï¼Œå…¶å¤‡ä»½æ¡†æ¶ç”±ä¸»çº¿ç¨‹å’Œå¤šä¸ªå·¥ä½œçº¿ç¨‹ç»„æˆ.</p>
<p>è¿™é‡Œä¸€è‡´æ€§æ•°æ®æŒ‡çš„æ˜¯åœ¨æŸä¸ªæ—¶é—´ç‚¹ï¼Œå¯¼å‡ºçš„æ•°æ®ä¸å¯¼å‡ºçš„Binlogæ–‡ä»¶ä¿¡æ¯ç›¸åŒ¹é…ï¼Œå¦‚æœå¯¼å‡ºäº†å¤šå¼ è¡¨çš„æ•°æ®ï¼Œè¿™äº›ä¸åŒè¡¨ä¹‹é—´çš„æ•°æ®éƒ½æ˜¯åŒä¸€ä¸ªæ—¶é—´ç‚¹çš„æ•°æ®ã€‚</p>
<h3 id="mydumperå¤‡ä»½åŸç†"><a href="#mydumperå¤‡ä»½åŸç†" class="headerlink" title="mydumperå¤‡ä»½åŸç†"></a>mydumperå¤‡ä»½åŸç†</h3><p>åœ¨mydumperè¿›è¡Œå¤‡ä»½çš„æ—¶å€™ï¼Œç”±ä¸€ä¸ªä¸»çº¿ç¨‹ä»¥åŠå¤šä¸ªå¤‡ä»½çº¿ç¨‹å®Œæˆã€‚å…¶ä¸»çº¿ç¨‹çš„æµç¨‹æ˜¯ï¼š</p>
<ol>
<li>è¿æ¥æ•°æ®åº“</li>
<li>FLUSH TABLES WITH READ LOCK å°†è„é¡µåˆ·æ–°åˆ°ç£ç›˜å¹¶è·å¾—åªè¯»é”</li>
<li>START TRANSACTION /!40108 WITH CONSISTENT SNAPSHOT / å¼€å¯äº‹ç‰©å¹¶è·å–ä¸€è‡´æ€§å¿«ç…§</li>
<li>SHOW MASTER STATUS è·å¾—binlogä¿¡æ¯</li>
<li>åˆ›å»ºå­çº¿ç¨‹å¹¶è¿æ¥æ•°æ®åº“</li>
<li>ä¸ºå­çº¿ç¨‹åˆ†é…ä»»åŠ¡å¹¶pushåˆ°é˜Ÿåˆ—ä¸­</li>
<li>UNLOCK TABLES / FTWRL / é‡Šæ”¾é”</li>
</ol>
<p>å­çº¿ç¨‹çš„ä¸»è¦æµç¨‹æ˜¯ï¼š</p>
<ol>
<li>è¿æ¥æ•°æ®åº“</li>
<li>SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE</li>
<li>START TRANSACTION /!40108 WITH CONSISTENT SNAPSHOT /</li>
<li>ä»é˜Ÿåˆ—ä¸­popä»»åŠ¡å¹¶æ‰§è¡Œ</li>
</ol>
<p>ä¸Šè¿°ä¸¤ä¸ªçº¿ç¨‹çš„æµç¨‹çš„å…³ç³»å¦‚å›¾</p>
<p><img src="pic/72.png" alt=""></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸»çº¿ç¨‹é‡Šæ”¾é”æ˜¯åœ¨å­çº¿ç¨‹å¼€å¯äº‹ç‰©ä¹‹åã€‚è¿™é‡Œæ˜¯ä¿è¯å­çº¿ç¨‹è·å¾—çš„æ•°æ®ä¸€å®šä¸ºä¸€è‡´æ€§æ•°æ®çš„å…³é”®ã€‚</p>
<p>ä¸»çº¿ç¨‹åœ¨è¿æ¥åˆ°æ•°æ®åº“åç«‹å³é€šè¿‡Flush tables with read lock(FTWRL) æ“ä½œå°†è„é¡µåˆ·æ–°åˆ°ç£ç›˜ï¼Œå¹¶è·å–ä¸€ä¸ªå…¨å±€çš„åªè¯»é”ï¼Œè¿™æ ·ä¾¿å¯ä»¥ä¿è¯åœ¨é”é‡Šæ”¾ä¹‹å‰ç”±ä¸»çº¿ç¨‹çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚ç„¶åç«‹å³é€šè¿‡ Start Transaction with consistent snapshot åˆ›å»ºä¸€ä¸ªå¿«ç…§è¯»äº‹ç‰©ï¼Œå¹¶é€šè¿‡ show master statusè·å–binlogä½ç½®ä¿¡æ¯ã€‚</p>
<p>ç„¶ååˆ›å»ºå®Œæˆdumpä»»åŠ¡çš„å­çº¿ç¨‹å¹¶ä¸ºå…¶åˆ†é…ä»»åŠ¡ã€‚</p>
<p>ä¸»çº¿ç¨‹åœ¨åˆ›å»ºå­çº¿ç¨‹åé€šè¿‡ä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ— ready ç­‰å¾…å­çº¿ç¨‹å‡†å¤‡å®Œæ¯•ã€‚ å­çº¿ç¨‹åœ¨åˆ›å»ºåç«‹å³åˆ›å»ºåˆ°MySQLæ•°æ®åº“çš„è¿æ¥ï¼Œç„¶åè®¾ç½®å½“å‰äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºRepeatable Readã€‚</p>
<p>è®¾ç½®å®Œæˆä¹‹åå¼€å§‹å¿«ç…§è¯»äº‹åŠ¡ã€‚åœ¨å®Œæˆè¿™ä¸€ç³»åˆ—æ“ä½œä¹‹åï¼Œå­çº¿ç¨‹æ‰ä¼šé€šè¿‡readyé˜Ÿåˆ—å‘Šè¯‰ä¸»çº¿è‡ªå·±ç¨‹å‡†å¤‡å®Œæ¯•ã€‚ä¸»çº¿ç¨‹ç­‰å¾…å…¨éƒ¨å­çº¿ç¨‹å‡†å¤‡å®Œæ¯•å¼€å¯ä¸€è‡´æ€§è¯»Snapshotäº‹åŠ¡åæ‰ä¼šé‡Šæ”¾å…¨å±€åªè¯»é”ï¼ˆUnlock Tableï¼‰ã€‚</p>
<p>å¦‚æœåªæœ‰Innodbè¡¨ï¼Œé‚£ä¹ˆåªæœ‰åœ¨åˆ›å»ºä»»åŠ¡é˜¶æ®µä¼šåŠ é”ã€‚ä½†æ˜¯å¦‚æœå­˜åœ¨MyIsamè¡¨æˆ–å…¶ä»–ä¸å¸¦æœ‰MVCCåŠŸèƒ½çš„è¡¨ï¼Œé‚£ä¹ˆåœ¨è¿™äº›è¡¨çš„å¯¼å‡ºä»»åŠ¡å®Œæˆä¹‹å‰éƒ½å¿…é¡»å¯¹è¿™äº›è¡¨è¿›è¡ŒåŠ é”ã€‚Mydumperæœ¬èº«ç»´æŠ¤äº†ä¸€ä¸ª non_innodb_table åˆ—è¡¨ï¼Œåœ¨åˆ›å»ºä»»åŠ¡é˜¶æ®µä¼šé¦–å…ˆä¸ºéInnodbè¡¨åˆ›å»ºä»»åŠ¡ã€‚åŒæ—¶è¿˜ç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€çš„unlock_tableé˜Ÿåˆ—ä»¥åŠä¸€ä¸ªåŸå­è®¡æ•°å™¨ non_innodb_table_counter , å­çº¿ç¨‹æ¯å®Œæˆä¸€ä¸ªéInnodbè¡¨çš„ä»»åŠ¡ä¾¿å°† non_innodb_table_counter å‡ä¸€ï¼Œå¦‚æœnon_innodb_table_counter å€¼ä¸º0 éé€šè¿‡å‘ unlock_table é˜Ÿåˆ—pushä¸€ä¸ªæ¶ˆæ¯çš„æ–¹å¼é€šçŸ¥ä¸»çº¿ç¨‹å®Œæˆäº†éInnodbè¡¨çš„å¯¼å‡ºä»»åŠ¡å¯ä»¥æ‰§è¡Œ unlock tableæ“ä½œã€‚</p>
<p>mydumperæ”¯æŒè®°å½•çº§åˆ«çš„å¹¶å‘å¯¼å‡ºã€‚åœ¨è®°å½•çº§åˆ«çš„å¯¼å‡ºæ—¶ï¼Œä¸»çº¿ç¨‹åœ¨åšä»»åŠ¡åˆ†é…çš„æ—¶å€™ä¼šå¯¹è¡¨è¿›è¡Œæ‹†åˆ†ï¼Œä¸ºè¡¨çš„ä¸€éƒ¨åˆ†è®°å½•åˆ›å»ºä¸€ä¸ªä»»åŠ¡ã€‚è¿™æ ·åšä¸€ä¸ªå¥½å¤„å°±æ˜¯å½“æœ‰æŸä¸ªè¡¨ç‰¹åˆ«å¤§çš„æ—¶å€™å¯ä»¥å°½å¯èƒ½çš„åˆ©ç”¨å¤šçº¿ç¨‹å¹¶å‘ä»¥å…æŸä¸ªçº¿ç¨‹åœ¨å¯¼å‡ºä¸€ä¸ªå¤§è¡¨è€Œå…¶ä»–çº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€ã€‚åœ¨åˆ†å‰²æ—¶ï¼Œé¦–å…ˆé€‰å–ä¸»é”®ï¼ˆPRIMARY KEYï¼‰ä½œä¸ºåˆ†éš”ä¾æ®ï¼Œå¦‚æœæ²¡æœ‰ä¸»é”®åˆ™æŸ¥æ‰¾æœ‰æ— å”¯ä¸€ç´¢å¼•(UNIQUE KEY)ã€‚åœ¨ä»¥ä¸Šå°è¯•éƒ½å¤±è´¥åï¼Œå†é€‰å–ä¸€ä¸ªåŒºåˆ†åº¦æ¯”è¾ƒé«˜çš„å­—æ®µåšä¸ºè®°å½•åˆ’åˆ†çš„ä¾æ®(é€šè¿‡ show index ç»“æœé›†ä¸­çš„cardinalityçš„å€¼ç¡®å®š)ã€‚</p>
<p>åˆ’åˆ†çš„æ–¹å¼æ¯”è¾ƒæš´åŠ›ï¼Œç›´æ¥é€šè¿‡ select min(filed),max(filed) from table è·å¾—åˆ’åˆ†å­—æ®µçš„å–å€¼èŒƒå›´ï¼Œé€šè¿‡ explain select filed from table è·å–å­—æ®µè®°å½•çš„è¡Œæ•°ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªç¡®å®šçš„æ­¥é•¿è·å¾—æ¯ä¸€ä¸ªå­ä»»åŠ¡çš„æ‰§è¡Œæ—¶çš„whereæ¡ä»¶ã€‚è¿™ç§è®¡ç®—æ–¹å¼åªæ”¯æŒæ•°å­—ç±»å‹çš„å­—æ®µã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯mydumperçš„å¹¶å‘è·å–ä¸€è‡´æ€§æ•°æ®çš„æ–¹å¼ï¼Œå…¶å…³é”®åœ¨äºåˆ©ç”¨äº†Innodbè¡¨çš„MVCCåŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡å¿«ç…§è¯»å› æ­¤åªæœ‰åœ¨ä»»åŠ¡åˆ›å»ºé˜¶æ®µæ‰éœ€è¦åŠ é”ã€‚</p>
<h3 id="mydumper-å‚æ•°"><a href="#mydumper-å‚æ•°" class="headerlink" title="mydumper å‚æ•°"></a>mydumper å‚æ•°</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">01</span><br><span class="line">-B, --database              è¦å¤‡ä»½çš„æ•°æ®åº“ï¼Œä¸æŒ‡å®šåˆ™å¤‡ä»½æ‰€æœ‰åº“</span><br><span class="line">02.</span><br><span class="line">-T, --tables-list           éœ€è¦å¤‡ä»½çš„è¡¨ï¼Œåå­—ç”¨é€—å·éš”å¼€</span><br><span class="line">03.</span><br><span class="line">-o, --outputdir             å¤‡ä»½æ–‡ä»¶è¾“å‡ºçš„ç›®å½•</span><br><span class="line">04.</span><br><span class="line">-s, --statement-size        ç”Ÿæˆçš„insertè¯­å¥çš„å­—èŠ‚æ•°ï¼Œé»˜è®¤1000000</span><br><span class="line">05.</span><br><span class="line">-r, --rows                  å°†è¡¨æŒ‰è¡Œåˆ†å—æ—¶ï¼ŒæŒ‡å®šçš„å—è¡Œæ•°ï¼ŒæŒ‡å®šè¿™ä¸ªé€‰é¡¹ä¼šå…³é—­ --chunk-filesize</span><br><span class="line">06.</span><br><span class="line">-F, --chunk-filesize        å°†è¡¨æŒ‰å¤§å°åˆ†å—æ—¶ï¼ŒæŒ‡å®šçš„å—å¤§å°ï¼Œå•ä½æ˜¯ MB</span><br><span class="line">07.</span><br><span class="line">-c, --compress              å‹ç¼©è¾“å‡ºæ–‡ä»¶</span><br><span class="line">08.</span><br><span class="line">-e, --build-empty-files     å¦‚æœè¡¨æ•°æ®æ˜¯ç©ºï¼Œè¿˜æ˜¯äº§ç”Ÿä¸€ä¸ªç©ºæ–‡ä»¶ï¼ˆé»˜è®¤æ— æ•°æ®åˆ™åªæœ‰è¡¨ç»“æ„æ–‡ä»¶ï¼‰</span><br><span class="line">09.</span><br><span class="line">-x, --regex                 æ˜¯åŒæ­£åˆ™è¡¨è¾¾å¼åŒ¹é… 'db.table'</span><br><span class="line">10.</span><br><span class="line">-i, --ignore-engines        å¿½ç•¥çš„å­˜å‚¨å¼•æ“ï¼Œç”¨éƒ½åšåˆ†å‰²</span><br><span class="line">11.</span><br><span class="line">-m, --no-schemas            ä¸å¤‡ä»½è¡¨ç»“æ„</span><br><span class="line">12.</span><br><span class="line">-k, --no-locks              ä¸ä½¿ç”¨ä¸´æ—¶å…±äº«åªè¯»é”ï¼Œä½¿ç”¨è¿™ä¸ªé€‰é¡¹ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´</span><br><span class="line">13.</span><br><span class="line">--less-locking              å‡å°‘å¯¹InnoDBè¡¨çš„é”æ–½åŠ æ—¶é—´ï¼ˆè¿™ç§æ¨¡å¼çš„æœºåˆ¶ä¸‹æ–‡è¯¦è§£ï¼‰</span><br><span class="line">14.</span><br><span class="line">-l, --long-query-guard      è®¾å®šé˜»å¡å¤‡ä»½çš„é•¿æŸ¥è¯¢è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼Œé»˜è®¤æ˜¯60ç§’ï¼ˆè¶…æ—¶åé»˜è®¤mydumperå°†ä¼šé€€å‡ºï¼‰</span><br><span class="line">15.</span><br><span class="line">--kill-long-queries         æ€æ‰é•¿æŸ¥è¯¢ (ä¸é€€å‡º)</span><br><span class="line">16.</span><br><span class="line">-b, --binlogs               å¯¼å‡ºbinlog</span><br><span class="line">17.</span><br><span class="line">-D, --daemon                å¯ç”¨å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ï¼Œå®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ä»¥æŸä¸ªé—´éš”ä¸é—´æ–­å¯¹æ•°æ®åº“è¿›è¡Œå¤‡ä»½</span><br><span class="line">18.</span><br><span class="line">-I, --snapshot-interval     dumpå¿«ç…§é—´éš”æ—¶é—´ï¼Œé»˜è®¤60sï¼Œéœ€è¦åœ¨daemonæ¨¡å¼ä¸‹</span><br><span class="line">19.</span><br><span class="line">-L, --logfile               ä½¿ç”¨çš„æ—¥å¿—æ–‡ä»¶å(mydumperæ‰€äº§ç”Ÿçš„æ—¥å¿—), é»˜è®¤ä½¿ç”¨æ ‡å‡†è¾“å‡º</span><br><span class="line">20.</span><br><span class="line">--tz-utc                    è·¨æ—¶åŒºæ˜¯ä½¿ç”¨çš„é€‰é¡¹ï¼Œä¸è§£é‡Šäº†</span><br><span class="line">21.</span><br><span class="line">--skip-tz-utc               åŒä¸Š</span><br><span class="line">22.</span><br><span class="line">--use-savepoints            ä½¿ç”¨savepointsæ¥å‡å°‘é‡‡é›†metadataæ‰€é€ æˆçš„é”æ—¶é—´ï¼Œéœ€è¦ SUPER æƒé™</span><br><span class="line">23.</span><br><span class="line">--success-on-1146           Not increment error count and Warning instead of Critical in case of table doesn't exist</span><br><span class="line">24.</span><br><span class="line">-h, --host                  è¿æ¥çš„ä¸»æœºå</span><br><span class="line">25.</span><br><span class="line">-u, --user                  å¤‡ä»½æ‰€ä½¿ç”¨çš„ç”¨æˆ·</span><br><span class="line">26.</span><br><span class="line">-p, --pass&lt;a href="http://www.it165.net/edu/ebg/" target="_blank"class="keylink"&gt;word&lt;/a&gt;              å¯†ç </span><br><span class="line">27.</span><br><span class="line">-P, --port                  ç«¯å£</span><br><span class="line">28.</span><br><span class="line">-S, --socket                ä½¿ç”¨socketé€šä¿¡æ—¶çš„socketæ–‡ä»¶</span><br><span class="line">29.</span><br><span class="line">-t, --threads               å¼€å¯çš„å¤‡ä»½çº¿ç¨‹æ•°ï¼Œé»˜è®¤æ˜¯4</span><br><span class="line">30.</span><br><span class="line">-C, --compress-protocol     å‹ç¼©ä¸mysqlé€šä¿¡çš„æ•°æ®</span><br><span class="line">31.</span><br><span class="line">-V, --version               æ˜¾ç¤ºç‰ˆæœ¬å·</span><br><span class="line">32.</span><br><span class="line">-v, --verbose               è¾“å‡ºä¿¡æ¯æ¨¡å¼, 0 = silent, 1 = errors, 2 = warnings, 3= info, é»˜è®¤ä¸º 2</span><br></pre></td></tr></table></figure>

<h3 id="myloader-å‚æ•°"><a href="#myloader-å‚æ•°" class="headerlink" title="myloader å‚æ•°"></a>myloader å‚æ•°</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">01</span><br><span class="line">-d, --directory                   å¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶å¤¹</span><br><span class="line">02.</span><br><span class="line">-q, --queries-per-transaction     æ¯æ¬¡äº‹ç‰©æ‰§è¡Œçš„æŸ¥è¯¢æ•°é‡ï¼Œé»˜è®¤æ˜¯1000</span><br><span class="line">03.</span><br><span class="line">-o, --overwrite-tables            å¦‚æœè¦æ¢å¤çš„è¡¨å­˜åœ¨ï¼Œåˆ™å…ˆdropæ‰è¯¥è¡¨ï¼Œä½¿ç”¨è¯¥å‚æ•°ï¼Œéœ€è¦å¤‡ä»½æ—¶å€™è¦å¤‡ä»½è¡¨ç»“æ„</span><br><span class="line">04.</span><br><span class="line">-B, --database                    éœ€è¦è¿˜åŸçš„æ•°æ®åº“</span><br><span class="line">05.</span><br><span class="line">-e, --enable-binlog               å¯ç”¨è¿˜åŸæ•°æ®çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">06.</span><br><span class="line">-h, --host                        ä¸»æœº</span><br><span class="line">07.</span><br><span class="line">-u, --user                        è¿˜åŸçš„ç”¨æˆ·</span><br><span class="line">08.</span><br><span class="line">-p, --pass&lt;a href="http://www.it165.net/edu/ebg/" target="_blank"class="keylink"&gt;word&lt;/a&gt;                    å¯†ç </span><br><span class="line">09.</span><br><span class="line">-P, --port                        ç«¯å£</span><br><span class="line">10.</span><br><span class="line">-S, --socket                      socketæ–‡ä»¶</span><br><span class="line">11.</span><br><span class="line">-t, --threads                     è¿˜åŸæ‰€ä½¿ç”¨çš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤æ˜¯4</span><br><span class="line">12.</span><br><span class="line">-C, --compress-protocol           å‹ç¼©åè®®</span><br><span class="line">13.</span><br><span class="line">-V, --version                     æ˜¾ç¤ºç‰ˆæœ¬</span><br><span class="line">14.</span><br><span class="line">-v, --verbose                     è¾“å‡ºæ¨¡å¼, 0 = silent, 1 = errors, 2 = warnings,3 = info, é»˜è®¤ä¸º2</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨æ¡ˆä¾‹"><a href="#ä½¿ç”¨æ¡ˆä¾‹" class="headerlink" title="ä½¿ç”¨æ¡ˆä¾‹"></a>ä½¿ç”¨æ¡ˆä¾‹</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¤‡ä»½gameåº“åˆ°/backup/01æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶å‹ç¼©å¤‡ä»½æ–‡ä»¶</span></span><br><span class="line">mydumper -u root -p ### -h localhost -B game -c -o /backup/01</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¤‡ä»½æ‰€æœ‰æ•°æ®åº“ï¼Œå¹¶å¤‡ä»½äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œå¤‡ä»½è‡³/backup/02æ–‡ä»¶å¤¹</span></span><br><span class="line"></span><br><span class="line">mydumper -u root -p ### -h localhost -o /backup/02</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¤‡ä»½game.tb_playerè¡¨ï¼Œä¸”ä¸å¤‡ä»½è¡¨ç»“æ„ï¼Œå¤‡ä»½è‡³/backup/03æ–‡ä»¶å¤¹</span></span><br><span class="line"></span><br><span class="line">mydumper -u root -p ### -h localhost -T tb_player -m -o /backup/03</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿˜åŸ</span></span><br><span class="line"></span><br><span class="line">mysqlload -u root -p ### -h localhost -B game -d /backup/02</span><br><span class="line"></span><br><span class="line">mydumperçš„less lockingæ¨¡å¼</span><br><span class="line"></span><br><span class="line">mydumperä½¿ç”¨--less-lockingå¯ä»¥å‡å°‘é”ç­‰å¾…æ—¶é—´ï¼Œæ­¤æ—¶mydumperçš„æ‰§è¡Œæœºåˆ¶å¤§è‡´ä¸º</span><br></pre></td></tr></table></figure>

<h2 id="mysqldump-mysqlpump-mydumperå¯¹æ¯”"><a href="#mysqldump-mysqlpump-mydumperå¯¹æ¯”" class="headerlink" title="mysqldump,mysqlpump,mydumperå¯¹æ¯”"></a>mysqldump,mysqlpump,mydumperå¯¹æ¯”</h2><table>
<thead>
<tr>
<th align="left">è™šæ‹Ÿæœº</th>
<th align="left">IPåœ°å€</th>
<th align="left">è½¯ä»¶</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mastera</td>
<td align="left">172.25.0.11</td>
<td align="left">mysql server 5.7.17</td>
</tr>
<tr>
<td align="left">workstation</td>
<td align="left">172.25.0.10</td>
<td align="left">python python-matplotlib</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera mysql5.7]# ls</span><br><span class="line">mysql-5.7.17-1.el7.x86_64.rpm-bundle.tar                 mysql-community-libs-compat-5.7.17-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-client-5.7.17-1.el7.x86_64.rpm           mysql-community-minimal-debuginfo-5.7.17-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-common-5.7.17-1.el7.x86_64.rpm           mysql-community-server-5.7.17-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-devel-5.7.17-1.el7.x86_64.rpm            mysql-community-server-minimal-5.7.17-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-embedded-5.7.17-1.el7.x86_64.rpm         mysql-community-test-5.7.17-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-embedded-compat-5.7.17-1.el7.x86_64.rpm  sysbench-master</span><br><span class="line">mysql-community-embedded-devel-5.7.17-1.el7.x86_64.rpm   sysbench-master.zip</span><br><span class="line">mysql-community-libs-5.7.17-1.el7.x86_64.rpm</span><br><span class="line">[root@mastera mysql5.7]# rpm -ivh mysql-community-client-5.7.17-1.el7.x86_64.rpm mysql-community-common-5.7.17-1.el7.x86_64.rpm mysql-community-devel-5.7.17-1.el7.x86_64.rpm mysql-community-server-5.7.17-1.el7.x86_64.rpm mysql-community-libs-5.7.17-1.el7.x86_64.rpm </span><br><span class="line">warning: mysql-community-client-5.7.17-1.el7.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY</span><br><span class="line">Preparing...                          ################################# [100%]</span><br><span class="line">Updating / installing...</span><br><span class="line">   1:mysql-community-common-5.7.17-1.e################################# [ 20%]</span><br><span class="line">   2:mysql-community-libs-5.7.17-1.el7################################# [ 40%]</span><br><span class="line">   3:mysql-community-client-5.7.17-1.e################################# [ 60%]</span><br><span class="line">   4:mysql-community-server-5.7.17-1.e################################# [ 80%]</span><br><span class="line">   5:mysql-community-devel-5.7.17-1.el################################# [100%]</span><br><span class="line">[root@mastera mysql5.7]# systemctl start mysqld</span><br><span class="line">[root@mastera mysql5.7]# grep password /var/log/mysqld.log</span><br><span class="line">2017-02-09T08:32:17.515190Z 1 [Note] A temporary password is generated for root@localhost: p!hHXls+U6Po</span><br><span class="line">[root@mastera mysql5.7]# mysqladmin -uroot -p'p!hHXls+U6Po' password '(Uploo00king)'</span><br><span class="line">mysqladmin: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Warning: Since password will be sent to server in plain text, use ssl connection to ensure password safety.</span><br><span class="line">[root@mastera mysql5.7]# mysql -uroot -p'(Uploo00king)'</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 4</span><br><span class="line">Server version: 5.7.17 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create database db1;</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> use db1;</span></span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table t1 (id int primary key auto_increment,num int);</span></span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table t2 like t1;</span></span><br><span class="line">Query OK, 0 rows affected (0.24 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table t3 like t1;</span></span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table t4 like t1;</span></span><br><span class="line">Query OK, 0 rows affected (0.34 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> delimiter //</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create procedure booboo_insert (<span class="keyword">in</span> tb_name varchar(20)) begin <span class="built_in">declare</span> i int; <span class="built_in">declare</span> j int; <span class="built_in">declare</span> _sql varchar(100); <span class="built_in">set</span> i=1; <span class="built_in">set</span> j=10000; <span class="built_in">set</span> _sql=concat(<span class="string">'insert into '</span>,tb_name,<span class="string">' set num='</span>,i); <span class="built_in">set</span> @sql=_sql;start transaction; prepare s2 from @sql; <span class="keyword">while</span> i&lt;=j <span class="keyword">do</span> execute s2; <span class="built_in">set</span> i=i+1;end <span class="keyword">while</span>; deallocate prepare s2; commit; end//</span></span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> call booboo_insert(<span class="string">'t1'</span>)//</span></span><br><span class="line">Query OK, 0 rows affected (0.71 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> call booboo_insert(<span class="string">'t2'</span>)//</span></span><br><span class="line">Query OK, 0 rows affected (0.71 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> call booboo_insert(<span class="string">'t3'</span>)//</span></span><br><span class="line">Query OK, 0 rows affected (0.68 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> call booboo_insert(<span class="string">'t4'</span>)//</span></span><br><span class="line">Query OK, 0 rows affected (0.83 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show table status;</span></span><br><span class="line">+------+--------+---------+------------+-------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-------------------+----------+----------------+---------+</span><br><span class="line">| Name | Engine | Version | Row_format | Rows  | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time         | Check_time | Collation         | Checksum | Create_options | Comment |</span><br><span class="line">+------+--------+---------+------------+-------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-------------------+----------+----------------+---------+</span><br><span class="line">| t1   | InnoDB |      10 | Dynamic    | 10000 |             32 |      327680 |               0 |            0 |         0 |          10002 | 2017-02-09 16:40:53 | 2017-02-09 16:43:39 | NULL       | latin1_swedish_ci |     NULL |                |         |</span><br><span class="line">| t2   | InnoDB |      10 | Dynamic    | 10000 |             32 |      327680 |               0 |            0 |         0 |          10001 | 2017-02-09 16:40:58 | 2017-02-09 16:43:59 | NULL       | latin1_swedish_ci |     NULL |                |         |</span><br><span class="line">| t3   | InnoDB |      10 | Dynamic    | 10000 |             32 |      327680 |               0 |            0 |         0 |          10001 | 2017-02-09 16:41:00 | 2017-02-09 16:44:02 | NULL       | latin1_swedish_ci |     NULL |                |         |</span><br><span class="line">| t4   | InnoDB |      10 | Dynamic    | 10000 |             32 |      327680 |               0 |            0 |         0 |          10001 | 2017-02-09 16:41:03 | 2017-02-09 16:44:05 | NULL       | latin1_swedish_ci |     NULL |                |         |</span><br><span class="line">+------+--------+---------+------------+-------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-------------------+----------+----------------+---------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">exit</span></span></span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line">[root@mastera mysql5.7]# du -h /var/lib/mysql</span><br><span class="line">12M	/var/lib/mysql/mysql</span><br><span class="line">1.1M	/var/lib/mysql/performance_schema</span><br><span class="line">676K	/var/lib/mysql/sys</span><br><span class="line">1.6M	/var/lib/mysql/db1</span><br><span class="line">135M	/var/lib/mysql</span><br></pre></td></tr></table></figure>

<p>å­˜å‚¨è¿‡ç¨‹</p>
<p>è¯¥å­˜å‚¨è¿‡ç¨‹å¯ä»¥å¾ªç¯æ’å…¥10000æ¡æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥å¸¦å‚æ•°ï¼ˆè¡¨åï¼‰è°ƒç”¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">create procedure booboo_insert (in tb_name varchar(20)) </span><br><span class="line">begin </span><br><span class="line">declare i int; </span><br><span class="line">declare j int; </span><br><span class="line">declare _sql varchar(100); </span><br><span class="line">set i=1; set j=10000; </span><br><span class="line">set _sql=concat('insert into ',tb_name,' set num=',i); </span><br><span class="line">set @sql=_sql;</span><br><span class="line">start transaction; </span><br><span class="line">prepare s2 from @sql; </span><br><span class="line">while i&lt;=j do </span><br><span class="line">execute s2; </span><br><span class="line">set i=i+1;</span><br><span class="line">end while; </span><br><span class="line">deallocate prepare s2; </span><br><span class="line">commit; </span><br><span class="line">end//</span><br></pre></td></tr></table></figure>

<p>æ‰‹åŠ¨åˆ›å»ºäº†å››ä¸ªæµ‹è¯•è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°db1åº“çš„å¾ˆå°æ‰1.6Mï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹æ•°æ®é‡æ¯”è¾ƒå°æ—¶ï¼Œmysqldumpå’Œmysqlpumpçš„æ€§èƒ½</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera mysql5.7]# time mysqlpump -uroot -p'(Uploo00king)' db1 --default-parallelism=4 &gt; /tmp/mysql.pump4.sql</span><br><span class="line">mysqlpump: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Dump progress: 0/1 tables, 250/10000 rows</span><br><span class="line">Dump completed in 3016 milliseconds</span><br><span class="line"></span><br><span class="line">real	0m3.166s</span><br><span class="line">user	0m0.219s</span><br><span class="line">sys	0m0.475s</span><br><span class="line">[root@mastera mysql5.7]# time mysqlpump -uroot -p'(Uploo00king)' db1  &gt; /tmp/mysql.pump2.sql</span><br><span class="line">mysqlpump: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Dump progress: 0/1 tables, 250/10000 rows</span><br><span class="line">Dump completed in 3703 milliseconds</span><br><span class="line"></span><br><span class="line">real	0m3.871s</span><br><span class="line">user	0m0.307s</span><br><span class="line">sys	0m0.606s</span><br><span class="line">[root@mastera mysql5.7]# time mysqldump -uroot -p'(Uploo00king)' db1 &gt; /tmp/mysql.dump.sql</span><br><span class="line">mysqldump: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line"></span><br><span class="line">real	0m0.411s</span><br><span class="line">user	0m0.024s</span><br><span class="line">sys	0m0.116s</span><br></pre></td></tr></table></figure>

<p>ä»ç»“æœçœ‹ï¼Œæ•°æ®é‡éå¸¸å°çš„æ—¶å€™æ²¡å¿…è¦å¹¶è¡Œå¤åˆ¶ï¼Œmysqlpumpåè€Œæ›´æ…¢</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¯•ä¸€ä¸‹æ•°æ®é‡æ¯”è¾ƒå¤§çš„æ—¶å€™</p>
<p>åˆ›å»ºsbteståº“ï¼Œä½¿ç”¨sysbenchå‹æµ‹å·¥å…·å‡†å¤‡4ä¸ª1000000è¡Œçš„è¡¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show table status;</span></span><br><span class="line">+---------+--------+---------+------------+--------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-------------------+----------+------------------+---------+</span><br><span class="line">| Name    | Engine | Version | Row_format | Rows   | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time         | Check_time | Collation         | Checksum | Create_options   | Comment |</span><br><span class="line">+---------+--------+---------+------------+--------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-------------------+----------+------------------+---------+</span><br><span class="line">| sbtest1 | InnoDB |      10 | Dynamic    | 986776 |            221 |   218841088 |               0 |            0 |   4194304 |        1000001 | 2017-02-09 17:03:29 | 2017-02-09 17:03:18 | NULL       | latin1_swedish_ci |     NULL | max_rows=1000000 |         |</span><br><span class="line">| sbtest2 | InnoDB |      10 | Dynamic    | 986020 |            234 |   231456768 |               0 |            0 |   6291456 |           NULL | 2017-02-09 17:06:22 | 2017-02-09 17:07:14 | NULL       | latin1_swedish_ci |     NULL |                  |         |</span><br><span class="line">| sbtest3 | InnoDB |      10 | Dynamic    | 986020 |            234 |   231456768 |               0 |            0 |   6291456 |           NULL | 2017-02-09 17:07:25 | 2017-02-09 17:08:11 | NULL       | latin1_swedish_ci |     NULL |                  |         |</span><br><span class="line">| sbtest4 | InnoDB |      10 | Dynamic    | 986559 |            225 |   222019584 |               0 |            0 |   6291456 |           NULL | 2017-02-09 17:08:24 | 2017-02-09 17:09:15 | NULL       | latin1_swedish_ci |     NULL |                  |         |</span><br><span class="line">+---------+--------+---------+------------+--------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-------------------+----------+------------------+---------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">[root@mastera sysbench-master]# du -h /var/lib/mysql</span><br><span class="line">12M	/var/lib/mysql/mysql</span><br><span class="line">1.1M	/var/lib/mysql/performance_schema</span><br><span class="line">676K	/var/lib/mysql/sys</span><br><span class="line">1.6M	/var/lib/mysql/db1</span><br><span class="line">937M	/var/lib/mysql/sbtest</span><br><span class="line">1.2G	/var/lib/mysql</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°å½“å‰æ•°æ®åº“çš„æ•°æ®è¾¾åˆ°äº†11Gï¼Œæ¥ä¸‹æ¥åšå¤‡ä»½</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera ~]# time mysqldump -uroot -p'(Uploo00king)' sbtest --single-transaction &gt; /tmp/mysqldump.sbtest.sql</span><br><span class="line">[root@mastera ~]# time mysqlpump -uroot -p'(Uploo00king)' sbtest --single-transaction --default-parallelism=2 &gt; /tmp/mysqlpump.sbtest.sql</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>MySQLåŸºç¡€ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬åè¯¾ MySQL5.6ä¸€ä¸»å¤šä»åŠåŒæ­¥å¤åˆ¶</title>
    <url>/2017/01/04/booboo_mysql/07-MySQL5.6%E4%B8%80%E4%B8%BB%E5%A4%9A%E4%BB%8E%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%A4%8D%E5%88%B6/</url>
    <content><![CDATA[<blockquote>
<p>è¦æ±‚æŒæ¡mysql5.6çš„äºŒè¿›åˆ¶å®‰è£…å’ŒAB replicationä¹‹åŠåŒæ­¥å¤åˆ¶</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">role</th>
<th align="left">server</th>
<th align="left">ip</th>
</tr>
</thead>
<tbody><tr>
<td align="left">master</td>
<td align="left">mastera</td>
<td align="left">172.25.0.11</td>
</tr>
<tr>
<td align="left">slave</td>
<td align="left">masterb</td>
<td align="left">172.25.0.12</td>
</tr>
<tr>
<td align="left">slave</td>
<td align="left">slavea</td>
<td align="left">172.25.0.13</td>
</tr>
</tbody></table>
<h2 id="å®‰è£…äºŒè¿›åˆ¶çš„mysql5-6"><a href="#å®‰è£…äºŒè¿›åˆ¶çš„mysql5-6" class="headerlink" title="å®‰è£…äºŒè¿›åˆ¶çš„mysql5.6"></a>å®‰è£…äºŒè¿›åˆ¶çš„mysql5.6</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera0 ~]# tar -xf mysql-5.6.20-linux-glibc2.5-x86_64.tar.gz </span><br><span class="line">[root@mastera0 ~]# cd mysql-5.6.20-linux-glibc2.5-x86_64</span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# ls</span><br><span class="line">bin  COPYING  data  docs  include  INSTALL-BINARY  lib  man  mysql-test  README  scripts  share  sql-bench  support-files</span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# cat INSTALL-BINARY</span><br><span class="line">... ...</span><br><span class="line"> To install and use a MySQL binary distribution, the basic command</span><br><span class="line">   sequence looks like this:</span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> groupadd mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> useradd -r -g mysql mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> <span class="built_in">cd</span> /usr/<span class="built_in">local</span></span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> tar zxvf /path/to/mysql-VERSION-OS.tar.gz</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> ln -s full-path-to-mysql-VERSION-OS mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> <span class="built_in">cd</span> mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chown -R mysql .</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chgrp -R mysql .</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> scripts/mysql_install_db --user=mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chown -R root .</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chown -R mysql data</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> bin/mysqld_safe --user=mysql &amp;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Next <span class="built_in">command</span> is optional</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> cp support-files/mysql.server /etc/init.d/mysql.server</span></span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# groupadd mysql</span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# cd ..</span><br><span class="line">[root@mastera0 ~]# useradd -r -g mysql mysql</span><br><span class="line">[root@mastera0 ~]# cd /usr/local</span><br><span class="line">[root@mastera0 local]# mv /root/mysql-5.6.20-linux-glibc2.5-x86_64 .</span><br><span class="line">[root@mastera0 local]# ls</span><br><span class="line">bin  games    lib    libexec                             sbin   src</span><br><span class="line">etc  include  lib64  mysql-5.6.20-linux-glibc2.5-x86_64  share</span><br><span class="line">[root@mastera0 local]# ln -s mysql-5.6.20-linux-glibc2.5-x86_64 mysql</span><br><span class="line">[root@mastera0 local]# ll mysql</span><br><span class="line">lrwxrwxrwx.  1 root root   34 Dec 11 12:20 mysql -&gt; mysql-5.6.20-linux-glibc2.5-x86_64</span><br><span class="line">[root@mastera0 mysql]# cd mysql</span><br><span class="line">[root@mastera0 mysql]# mkdir /data/mysql/data -p</span><br><span class="line">[root@mastera0 mysql]# chown mysql. /data/mysql/data</span><br><span class="line">[root@mastera0 mysql]# chown mysql. /data/mysql/data -R</span><br><span class="line">[root@mastera0 mysql]# ll -d /data/mysql/data</span><br><span class="line">drwxr-xr-x. 2 mysql mysql 4096 Dec 11 12:24 /data/mysql/data</span><br><span class="line">[root@mastera0 mysql]# scripts/mysql_install_db --user=mysql --datadir=/data/mysql/data --basedir=/usr/local/mysql</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]# ll /data/mysql/data</span><br><span class="line">total 110604</span><br><span class="line">-rw-rw----. 1 mysql mysql 12582912 Dec 11 12:28 ibdata1</span><br><span class="line">-rw-rw----. 1 mysql mysql 50331648 Dec 11 12:28 ib_logfile0</span><br><span class="line">-rw-rw----. 1 mysql mysql 50331648 Dec 11 12:28 ib_logfile1</span><br><span class="line">drwx------. 2 mysql mysql     4096 Dec 11 12:28 mysql</span><br><span class="line">drwx------. 2 mysql mysql     4096 Dec 11 12:28 performance_schema</span><br><span class="line">drwx------. 2 mysql mysql     4096 Dec 11 12:28 test</span><br><span class="line">[root@mastera0 mysql]# cp /mnt/mysql/my.cnf /etc/my.cnf</span><br><span class="line">[root@mastera0 mysql]# vim /etc/my.cnf</span><br><span class="line">[client]</span><br><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœä¸è®¤è¯†è¿™ä¸ªå‚æ•°ä¼šå¿½ç•¥</span></span><br><span class="line">loose-default-character-set=utf8</span><br><span class="line">loose-prompt='\u@\h:\p [\d]&gt;'</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">basedir = /usr/local/mysql</span><br><span class="line">datadir = /data/mysql/data</span><br><span class="line">user=mysql</span><br><span class="line">port = 3306</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">pid-file=/data/tmp/mysql.pid</span><br><span class="line">tmpdir=/data1/tmp</span><br><span class="line">character_set_server=utf8</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">skip</span></span><br><span class="line">skip-external_locking=1</span><br><span class="line">skip-name-resolve=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">AB replication</span></span><br><span class="line">server-id = 1</span><br><span class="line">log-bin = /data/mysql/log-data/mastera</span><br><span class="line">binlog_format=row</span><br><span class="line">max_binlog_cache_size=2000M</span><br><span class="line">max_binlog_size=1G</span><br><span class="line">sync_binlog=1</span><br><span class="line"><span class="meta">#</span><span class="bash">expire_logs_days=7</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">semi_sync</span></span><br><span class="line">rpl_semi_sync_master_enabled=1</span><br><span class="line">rpl_semi_sync_master_timeout=1000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]# pwd</span><br><span class="line">/usr/local/mysql</span><br><span class="line">[root@mastera0 mysql]# cp support-files/mysql.server /etc/init.d/mysql.server</span><br><span class="line">[root@mastera0 mysql]# echo export PATH=$PATH:/usr/local/mysql/support-files/ &gt;&gt; /etc/bashrc</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">mysql</th>
<th align="left">è½¯ä»¶æ¶æ„</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ•°æ®ç›®å½•</td>
<td align="left">/data/mysql/data</td>
</tr>
<tr>
<td align="left">binlogç›®å½•</td>
<td align="left">/data/mysql/log-data</td>
</tr>
<tr>
<td align="left">pidæ–‡ä»¶</td>
<td align="left">/data/tmp</td>
</tr>
<tr>
<td align="left">ä¸´æ—¶ç›®å½•</td>
<td align="left">/data1/tmp/</td>
</tr>
</tbody></table>
<p>ä»¥ä¸Šç›®å½•æ‰€å±è€…å’Œæ‰€å±ç»„éƒ½éœ€è¦ä¸ºmysql.mysql</p>
<p>åŒæ ·å»å®‰è£…masterb slavea</p>
<hr>
<h2 id="é…ç½®ä¸»ä»"><a href="#é…ç½®ä¸»ä»" class="headerlink" title="é…ç½®ä¸»ä»"></a>é…ç½®ä¸»ä»</h2><p>æ­¥éª¤å¿½ç•¥</p>
<h2 id="é…ç½®ä¸»ä»åŠåŒæ­¥æ¨¡å¼"><a href="#é…ç½®ä¸»ä»åŠåŒæ­¥æ¨¡å¼" class="headerlink" title="é…ç½®ä¸»ä»åŠåŒæ­¥æ¨¡å¼"></a>é…ç½®ä¸»ä»åŠåŒæ­¥æ¨¡å¼</h2><blockquote>
<p>å®‰è£…åŠåŒæ­¥æ’ä»¶</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">install plugin rpl_semi_sync_master soname <span class="string">'semisync_master.so'</span>;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">install plugin rpl_semi_sync_slave soname <span class="string">'semisync_slave.so'</span>;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>é…ç½®æ–‡ä»¶ä¸­éœ€è¦æ‰“å¼€ç›¸åº”çš„å‚æ•°</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rpl_semi_sync_master_enabled=1</span><br><span class="line">rpl_semi_sync_master_timeout=1000 #ms</span><br><span class="line">rpl_semi_sync_slave_enabled=1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é‡æ–°å¯åŠ¨æœåŠ¡</p>
</blockquote>
<blockquote>
<p>æµ‹è¯•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mastera</span><br><span class="line">root@localhost:mysql.sock [(none)]&gt;show variables like "%semi%";</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">| Variable_name                      | Value |</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">| rpl_semi_sync_master_enabled       | ON    |</span><br><span class="line">| rpl_semi_sync_master_timeout       | 1000  |</span><br><span class="line">| rpl_semi_sync_master_trace_level   | 32    |</span><br><span class="line">| rpl_semi_sync_master_wait_no_slave | ON    |</span><br><span class="line">| rpl_semi_sync_slave_enabled        | OFF   |</span><br><span class="line">| rpl_semi_sync_slave_trace_level    | 32    |</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">masterb</span><br><span class="line">root@localhost:mysql.sock [(none)]&gt;show variables like "%semi%";</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">| Variable_name                      | Value |</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">| rpl_semi_sync_master_enabled       | OFF   |</span><br><span class="line">| rpl_semi_sync_master_timeout       | 10000 |</span><br><span class="line">| rpl_semi_sync_master_trace_level   | 32    |</span><br><span class="line">| rpl_semi_sync_master_wait_no_slave | ON    |</span><br><span class="line">| rpl_semi_sync_slave_enabled        | ON    |</span><br><span class="line">| rpl_semi_sync_slave_trace_level    | 32    |</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">slavea</span><br><span class="line">root@localhost:mysql.sock [(none)]&gt;show variables like "%semi%";</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">| Variable_name                      | Value |</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">| rpl_semi_sync_master_enabled       | OFF   |</span><br><span class="line">| rpl_semi_sync_master_timeout       | 10000 |</span><br><span class="line">| rpl_semi_sync_master_trace_level   | 32    |</span><br><span class="line">| rpl_semi_sync_master_wait_no_slave | ON    |</span><br><span class="line">| rpl_semi_sync_slave_enabled        | ON    |</span><br><span class="line">| rpl_semi_sync_slave_trace_level    | 32    |</span><br><span class="line">+------------------------------------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å°†masterbå’Œslaveaçš„slaveå…³é—­ï¼Œåœ¨masteraä¸Šè¿›è¡Œå†™æ“ä½œï¼Œå¹¶è§‚å¯Ÿã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@localhost:mysql.sock [(none)]&gt;insert into db1.t1 values (2);</span><br><span class="line">Query OK, 1 row affected (1.29 sec)</span><br><span class="line"></span><br><span class="line">root@localhost:mysql.sock [(none)]&gt;insert into db1.t1 values (3);</span><br><span class="line">Query OK, 1 row affected (0.20 sec)</span><br><span class="line"></span><br><span class="line">root@localhost:mysql.sock [(none)]&gt;insert into db1.t1 values (4);</span><br><span class="line">Query OK, 1 row affected (0.22 sec)</span><br></pre></td></tr></table></figure>

<p>å½“masteraç­‰å¾…1000msä¹Ÿå°±æ˜¯1såï¼Œå°±ä¸ç­‰äº†ï¼Œæ‰€ä»¥çœ‹åˆ°æ¶ˆè€—1.29sï¼Œè€Œä¹‹åçš„æ’å…¥å°±å˜æˆå¼‚æ­¥äº†ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>MySQLåŸºç¡€ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬ä¹è¯¾ MySQLå‹åŠ›æµ‹è¯•å·¥å…·sysbench</title>
    <url>/2017/01/03/booboo_mysql/06-MySQL%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7sysbench/</url>
    <content><![CDATA[<p>sysbenchæ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„ã€è·¨å¹³å°ã€å¤šçº¿ç¨‹åŸºå‡†æµ‹è¯•å·¥å…·ï¼Œä¸»è¦ç”¨äºè¯„ä¼°æµ‹è¯•å„ç§ä¸åŒç³»ç»Ÿå‚æ•°ä¸‹çš„æ•°æ®åº“è´Ÿè½½æƒ…å†µã€‚</p>
<table>
<thead>
<tr>
<th align="left">ä¸»è¦æµ‹è¯•æ–¹å¼</th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">cpuæ€§èƒ½</td>
<td align="left">ç£ç›˜ioæ€§èƒ½</td>
<td align="left">è°ƒåº¦ç¨‹åºæ€§èƒ½</td>
<td align="left">å†…å­˜åˆ†é…åŠä¼ è¾“é€Ÿåº¦</td>
<td align="left">POSIXçº¿ç¨‹æ€§èƒ½</td>
<td align="left">æ•°æ®åº“æ€§èƒ½(OLTPåŸºå‡†æµ‹è¯•)</td>
</tr>
<tr>
<td align="left">æ‰¾èŒƒå›´å†…æœ€å¤§ç´ æ•°{æ—¶é—´è¶ŠçŸ­è¶Šå¥½}</td>
<td align="left">ä¸åŒåœºæ™¯ä¸‹IOPS{è¶Šå¤§è¶Šå¥½}</td>
<td align="left">çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œå¾ªç¯å“åº”ä¿¡å·é‡èŠ±è´¹çš„æ—¶é—´{è¶Šå°‘è¶Šå¥½}</td>
<td align="left">ä»¥ä¸åŒå—å¤§å°ä¼ è¾“ä¸€å®šæ•°é‡çš„æ•°æ®ååé‡å¤§å°{è¶Šå¤§è¶Šå¥½}</td>
<td align="left">å¹¶å‘çº¿ç¨‹åŒæ—¶ç”³è¯·äº’æ–¥é”å¾ªç¯ä¸€å®šæ¬¡æ•°èŠ±è´¹çš„æ—¶é—´{è¶Šå°‘è¶Šå¥½}</td>
<td align="left">qpsã€tpsè¶Šé«˜è¶Šå¥½</td>
</tr>
</tbody></table>
<p>ç›®å‰sysbenchä¸»è¦æ”¯æŒ MySQL,pgsql,oracle è¿™3ç§æ•°æ®åº“ã€‚</p>
<p>å®‰è£…æµ‹è¯•ç¯å¢ƒä¸ºï¼šRHEL7.2 MariaDB5.5.44 </p>
<h2 id="å®‰è£…sysbench-0-5"><a href="#å®‰è£…sysbench-0-5" class="headerlink" title="å®‰è£…sysbench-0.5"></a>å®‰è£…sysbench-0.5</h2><p>æºç åœ°å€<a href="https://codeload.github.com/BoobooWei/sysbench/zip/master" target="_blank" rel="noopener">https://github.com/BoobooWei/sysbench/archive/master.zip</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# unzip sysbench-master.zip</span><br><span class="line">[root@localhost ~]# cd sysbench-master/</span><br><span class="line">[root@localhost sysbench-master]# ls</span><br><span class="line">autogen.sh  configure.ac  doc         Makefile.am    README.md         sysbench     TODO</span><br><span class="line">ChangeLog   COPYING       install-sh  missing        README-Oracle.md  tests</span><br><span class="line">config      debian        m4          mkinstalldirs  README-WIN.txt    third_party</span><br><span class="line">[root@localhost sysbench-master]# yum install -y automake libtool</span><br><span class="line"></span><br><span class="line">[root@localhost sysbench-master]# ./autogen.sh </span><br><span class="line">./autogen.sh: running `libtoolize --copy --force' </span><br><span class="line">libtoolize: putting auxiliary files in AC_CONFIG_AUX_DIR, `config'.</span><br><span class="line">libtoolize: copying file `config/ltmain.sh'</span><br><span class="line">libtoolize: putting macros in AC_CONFIG_MACRO_DIR, `m4'.</span><br><span class="line">æ­¤å¤„çœç•¥... ...</span><br><span class="line"></span><br><span class="line">[root@localhost sysbench-master]# ./configure</span><br><span class="line">æ­¤å¤„çœç•¥... ...</span><br><span class="line">===============================================================================</span><br><span class="line">sysbench version   : 1.0</span><br><span class="line">CC                 : gcc</span><br><span class="line">CFLAGS             : -O2 -ggdb3  -march=core2 -W -Wall -Wextra -Wpointer-arith -Wbad-function-cast   -Wstrict-prototypes -Wnested-externs -Wno-inline -Wno-format-zero-length   -funroll-loops  -Wundef -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wredundant-decls -Wcast-align        -pthread</span><br><span class="line">CPPFLAGS           : -D_GNU_SOURCE   -I$(top_srcdir)/sysbench -I$(abs_top_builddir)/third_party/luajit/inc -I$(abs_top_builddir)/third_party/concurrency_kit/include</span><br><span class="line">LDFLAGS            :  </span><br><span class="line">LIBS               : -lm </span><br><span class="line">EXTRA_LDFLAGS      : </span><br><span class="line"></span><br><span class="line">prefix             : /usr/local/sysbench</span><br><span class="line">bindir             : $&#123;prefix&#125;/bin</span><br><span class="line">libexecdir         : $&#123;prefix&#125;/libexec</span><br><span class="line">mandir             : $&#123;prefix&#125;/share/man</span><br><span class="line"></span><br><span class="line">MySQL support      : yes</span><br><span class="line">Drizzle support    : no</span><br><span class="line">AttachSQL support  : no</span><br><span class="line">Oracle support     : no</span><br><span class="line">PostgreSQL support : no</span><br><span class="line"></span><br><span class="line">LuaJIT             : bundled</span><br><span class="line">LUAJIT_CFLAGS      : -I$(abs_top_builddir)/third_party/luajit/inc</span><br><span class="line">LUAJIT_LIBS        : $(abs_top_builddir)/third_party/luajit/lib/libluajit-5.1.a -ldl</span><br><span class="line">LUAJIT_LDFLAGS     : -rdynamic</span><br><span class="line"></span><br><span class="line">Concurrency Kit    : bundled</span><br><span class="line">CK_CFLAGS          : -I$(abs_top_builddir)/third_party/concurrency_kit/include</span><br><span class="line">CK_LIBS            : $(abs_top_builddir)/third_party/concurrency_kit/lib/libck.a</span><br><span class="line">configure flags    : </span><br><span class="line">===============================================================================</span><br><span class="line">[root@localhost sysbench-master]# make</span><br><span class="line">[root@localhost sysbench-master]# make install</span><br><span class="line">[root@localhost sysbench-master]# cd /usr/local/sysbench</span><br><span class="line">[root@localhost sysbench]# pwd</span><br><span class="line">/usr/local/sysbench</span><br><span class="line">[root@localhost sysbench]# ls</span><br><span class="line">bin  share</span><br><span class="line">[root@localhost sysbench]# echo export PATH=$PATH:/usr/local/sysbench/bin &gt;&gt; /etc/bashrc</span><br><span class="line">[root@localhost sysbench]# source /etc/bashrc</span><br><span class="line">[root@localhost sysbench]# which sysbench</span><br><span class="line">/usr/local/sysbench/bin/sysbench</span><br><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•çš„luaè„šæœ¬å­˜æ”¾ä½ç½®</span></span><br><span class="line">[root@localhost sysbench]# ls /root/sysbench-master/sysbench/tests/</span><br><span class="line">CMakeLists.txt  db      Makefile     Makefile.in  mutex     sb_fileio.h  sb_mutex.h    threads</span><br><span class="line">cpu             fileio  Makefile.am  memory       sb_cpu.h  sb_memory.h  sb_threads.h</span><br><span class="line">[root@localhost sysbench]# ls /root/sysbench-master/sysbench/tests/db</span><br><span class="line">bulk_insert.lua  insert.lua   Makefile.in      parallel_prepare.lua      select_random_ranges.lua</span><br><span class="line">common.lua       Makefile     oltp.lua         select.lua                update_index.lua</span><br><span class="line">delete.lua       Makefile.am  oltp_simple.lua  select_random_points.lua  update_non_index.lua</span><br></pre></td></tr></table></figure>

<h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><h4 id="MySQLæ•°æ®åº“æµ‹è¯•"><a href="#MySQLæ•°æ®åº“æµ‹è¯•" class="headerlink" title="MySQLæ•°æ®åº“æµ‹è¯•"></a>MySQLæ•°æ®åº“æµ‹è¯•</h4><p>sysbench 0.5é€šè¿‡ä¸€ç³»åˆ—LUAè„šæœ¬æ¥æ›¿æ¢ä¹‹å‰çš„oltpï¼Œæ¥æ¨¡æ‹Ÿæ›´æ¥è¿‘çœŸå®çš„åŸºå‡†æµ‹è¯•ç¯å¢ƒã€‚è¿™äº›æµ‹è¯•è„šæœ¬åŒ…å«ï¼šinsert.luaã€oltp.luaã€parallel_prepare.luaã€select_random_points.luaã€update_index.luaã€delete.luaoltp_simple.luaã€select.luaã€select_random_ranges.luaã€update_non_index.luaï¼Œè„šæœ¬ä½¿ç”¨æ–¹å¼åŸºæœ¬ç±»ä¼¼ã€‚ </p>
<p>sysbench 0.5é»˜è®¤ä½¿ç”¨sbteståº“ï¼Œä½†æ˜¯éœ€è¦è‡ªå·±æ‰‹å·¥å…ˆåˆ›å»ºå¥½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨â€“mysql-dbæŒ‡å®šï¼Œå…¶ä»–éé»˜è®¤é¡¹æŒ‡å®šé€‰é¡¹ï¼š </p>
<p>â€“mysql-host </p>
<p>â€“mysql-port </p>
<p>â€“mysql-socket </p>
<p>â€“mysql-user </p>
<p>â€“mysql-password </p>
<p>â€“mysql-db </p>
<p>â€“mysql-ssl </p>
<p>prepare </p>
<p>ç”Ÿæˆè¡¨å¹¶æ’å…¥æ•°æ®ï¼Œå¯ä½¿ç”¨parallel_prepare.luaè„šæœ¬æ¥å¹¶è¡Œå‡†å¤‡æ•°æ®ã€‚ </p>
<p>-â€“db-driver æœåŠ¡å™¨ç±»å‹    mysql | drizzle,é»˜è®¤ä¸ºmysql </p>
<p>-â€“mysql-table-engine è¡¨å­˜æ•°å¼•æ“ </p>
<p>-â€“myisam-max-rows MyISAMè¡¨MAX_ROWSé€‰é¡¹(ç”¨äºå¤§è¡¨) </p>
<p>â€“-oltp-table-count ç”Ÿæˆè¡¨æ•°é‡[sbtest1ã€sbtest2â€¦] </p>
<p>-â€“oltp-table-size ç”Ÿæˆè¡¨çš„è¡Œæ•° </p>
<p>-â€“oltp-secondary IDåˆ—ç”ŸæˆäºŒçº§ç´¢å¼•è€Œä¸æ˜¯ä¸»é”® </p>
<p>â€“-oltp-auto-incè®¾ç½®IDåˆ—æ˜¯å¦è‡ªå¢ on | offï¼Œé»˜è®¤ä¸ºon â€“oltp-read-only=on  </p>
<p>â€“test=sysbench-0.5/sysbench/testsç›®å½•ä¸‹æµ‹è¯•è„šæœ¬</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sysbench \ </span><br><span class="line">--test=/root/sysbench-master/sysbench/tests/db/oltp.lua  \ </span><br><span class="line">--mysql-host=localhost  \ </span><br><span class="line">--mysql-port=3306  \ </span><br><span class="line">--mysql-user=root  \ </span><br><span class="line">--mysql-password=uplooking \ </span><br><span class="line">--oltp-table-size=100000 \ </span><br><span class="line">--num-threads=8 \ </span><br><span class="line">--max-time=10 \ </span><br><span class="line">--mysql-db=sbtest \ </span><br><span class="line">--max-requests=0 \ </span><br><span class="line">--oltp-test-mode=complex \ </span><br><span class="line">--report-interval=1 \ </span><br><span class="line">--mysql-table-engine=innodb  \ </span><br><span class="line">[prepare|run|cleanup]å‡†å¤‡/æµ‹è¯•/æ¸…é™¤</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost sysbench]# sysbench --test=/root/sysbench-master/sysbench/tests/db/oltp.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password=uplooking --oltp-table-size=10000 --num-threads=8 --max-time=10 --mysql-db=sbtest --max-requests=0 --oltp-test-mode=complex --report-interval=1 --mysql-table-engine=innodb prepare</span><br><span class="line">sysbench 1.0 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Creating table 'sbtest1'...</span><br><span class="line">Inserting 10000 records into 'sbtest1'</span><br><span class="line">Creating secondary indexes on 'sbtest1'...</span><br><span class="line"></span><br><span class="line">[root@localhost sysbench]# sysbench --test=/root/sysbench-master/sysbench/tests/db/oltp.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password=uplooking --oltp-table-size=10000 --num-threads=8 --max-time=10 --mysql-db=sbtest --max-requests=0 --oltp-test-mode=complex --report-interval=1 --mysql-table-engine=innodb run</span><br><span class="line">sysbench 1.0 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 8</span><br><span class="line">Report intermediate results every 1 second(s)</span><br><span class="line">Initializing random number generator from current time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Initializing worker threads...</span><br><span class="line"></span><br><span class="line">Threads started!</span><br><span class="line"></span><br><span class="line">[   1s] threads: 8, tps: 39.71, reads: 639.17, writes: 162.63, response time: 363.18ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   2s] threads: 8, tps: 45.45, reads: 626.37, writes: 185.74, response time: 376.49ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   3s] threads: 8, tps: 53.32, reads: 733.18, writes: 214.31, response time: 272.27ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   4s] threads: 8, tps: 43.35, reads: 641.97, writes: 176.17, response time: 356.70ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   5s] threads: 8, tps: 36.87, reads: 501.05, writes: 160.51, response time: 458.96ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   6s] threads: 8, tps: 35.18, reads: 513.58, writes: 141.71, response time: 397.39ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   7s] threads: 8, tps: 40.06, reads: 545.80, writes: 147.22, response time: 520.62ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   8s] threads: 8, tps: 54.99, reads: 763.82, writes: 216.95, response time: 240.02ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   9s] threads: 8, tps: 41.37, reads: 577.26, writes: 176.06, response time: 331.91ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  10s] threads: 7, tps: 57.49, reads: 807.87, writes: 217.62, response time: 240.02ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">OLTP test statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            6398</span><br><span class="line">        write:                           1828</span><br><span class="line">        other:                           914</span><br><span class="line">        total:                           9140</span><br><span class="line">    transactions:                        457    (44.97 per sec.)</span><br><span class="line">    read/write requests:                 8226   (809.37 per sec.)</span><br><span class="line">    other operations:                    914    (89.93 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br><span class="line"></span><br><span class="line">General statistics:</span><br><span class="line">    total time:                          10.1917s</span><br><span class="line">    total number of events:              457</span><br><span class="line">    total time taken by event execution: 80.3041s</span><br><span class="line"></span><br><span class="line">Latency statistics:</span><br><span class="line">         min:                                 22.82ms</span><br><span class="line">         avg:                                175.72ms</span><br><span class="line">         max:                                563.77ms</span><br><span class="line">         approx.  95th percentile:           376.49ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           57.1250/2.93</span><br><span class="line">    execution time (avg/stddev):   10.0380/0.07</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ‘çš„æœºå™¨æ˜¯6Gå†…å­˜ï¼Œ2ä¸ªcpuï¼Œå•æ ¸ï¼Œè¶…å¤šçº¿ç¨‹ç¢¾å‹çš„æ—¶å€™è¯•ä¸€è¯•64å’Œ128ä¸ªçº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">[root@localhost sysbench]# sysbench --test=/root/sysbench-master/sysbench/tests/db/oltp.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password=uplooking --oltp-table-size=10000 --num-threads=64 --max-time=30 --mysql-db=sbtest --max-requests=0 --oltp-test-mode=complex --report-interval=1 --mysql-table-engine=innodb run</span><br><span class="line">sysbench 1.0 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">OLTP test statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            21210</span><br><span class="line">        write:                           6007</span><br><span class="line">        other:                           3008</span><br><span class="line">        total:                           30225</span><br><span class="line">    transactions:                        1493   (49.07 per sec.)</span><br><span class="line">    read/write requests:                 27217  (894.57 per sec.)</span><br><span class="line">    other operations:                    3008   (98.87 per sec.)</span><br><span class="line">    ignored errors:                      22     (0.72 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br><span class="line"></span><br><span class="line">General statistics:</span><br><span class="line">    total time:                          30.6492s</span><br><span class="line">    total number of events:              1493</span><br><span class="line">    total time taken by event execution: 1445.1459s</span><br><span class="line"></span><br><span class="line">Latency statistics:</span><br><span class="line">         min:                                 35.38ms</span><br><span class="line">         avg:                                967.95ms</span><br><span class="line">         max:                               4147.00ms</span><br><span class="line">         approx.  95th percentile:          2238.47ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           23.3281/12.34</span><br><span class="line">    execution time (avg/stddev):   22.5804/11.02</span><br><span class="line"></span><br><span class="line">[root@localhost sysbench]# sysbench --test=/root/sysbench-master/sysbench/tests/db/oltp.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password=uplooking --oltp-table-size=10000 --num-threads=128 --max-time=60 --mysql-db=sbtest --max-requests=0 --oltp-test-mode=complex --report-interval=1 --mysql-table-engine=innodb run</span><br><span class="line">	</span><br><span class="line">OLTP test statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            58086</span><br><span class="line">        write:                           16337</span><br><span class="line">        other:                           8198</span><br><span class="line">        total:                           82621</span><br><span class="line">    transactions:                        4049   (67.05 per sec.)</span><br><span class="line">    read/write requests:                 74423  (1232.47 per sec.)</span><br><span class="line">    other operations:                    8198   (135.76 per sec.)</span><br><span class="line">    ignored errors:                      100    (1.66 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br><span class="line"></span><br><span class="line">General statistics:</span><br><span class="line">    total time:                          60.7499s</span><br><span class="line">    total number of events:              4049</span><br><span class="line">    total time taken by event execution: 2685.2741s</span><br><span class="line"></span><br><span class="line">Latency statistics:</span><br><span class="line">         min:                                 15.82ms</span><br><span class="line">         avg:                                663.19ms</span><br><span class="line">         max:                               8312.00ms</span><br><span class="line">         approx.  95th percentile:          1973.38ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           31.6328/45.46</span><br><span class="line">    execution time (avg/stddev):   20.9787/22.98</span><br><span class="line">[root@localhost sysbench]# sysbench --test=/root/sysbench-master/sysbench/tests/db/oltp.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password=uplooking --oltp-table-size=10000 --num-threads=128 --max-time=60 --mysql-db=sbtest --max-requests=0 --oltp-test-mode=complex --report-interval=1 --mysql-table-engine=innodb cleanup</span><br><span class="line">sysbench 1.0 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Dropping table 'sbtest1'...</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯å¤šè¡¨å‘¢å¹¶å¢åŠ è¡¨çš„å¤§å°ï¼Œæƒ…å†µåˆä¼šå¦‚ä½•å‘¢ï¼Ÿ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost sysbench]# sysbench --test=/root/sysbench-master/sysbench/tests/db/oltp.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password=uplooking --oltp-tables-count=10 --oltp-table-size=100000 --num-threads=128 --max-time=60 --mysql-db=sbtest --max-requests=0 --oltp-test-mode=complex --report-interval=1 --mysql-table-engine=innodb prepare</span><br><span class="line">sysbench 1.0 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Creating table 'sbtest1'...</span><br><span class="line">Inserting 100000 records into 'sbtest1'</span><br><span class="line">Creating secondary indexes on 'sbtest1'...</span><br><span class="line">Creating table 'sbtest2'...</span><br><span class="line">Inserting 100000 records into 'sbtest2'</span><br><span class="line">Creating secondary indexes on 'sbtest2'...</span><br><span class="line">Creating table 'sbtest3'...</span><br><span class="line">Inserting 100000 records into 'sbtest3'</span><br><span class="line">Creating secondary indexes on 'sbtest3'...</span><br><span class="line">Creating table 'sbtest4'...</span><br><span class="line">Inserting 100000 records into 'sbtest4'</span><br><span class="line">Creating secondary indexes on 'sbtest4'...</span><br><span class="line">Creating table 'sbtest5'...</span><br><span class="line">Inserting 100000 records into 'sbtest5'</span><br><span class="line">Creating secondary indexes on 'sbtest5'...</span><br><span class="line">Creating table 'sbtest6'...</span><br><span class="line">Inserting 100000 records into 'sbtest6'</span><br><span class="line">Creating secondary indexes on 'sbtest6'...</span><br><span class="line">Creating table 'sbtest7'...</span><br><span class="line">Inserting 100000 records into 'sbtest7'</span><br><span class="line">Creating secondary indexes on 'sbtest7'...</span><br><span class="line">Creating table 'sbtest8'...</span><br><span class="line">Inserting 100000 records into 'sbtest8'</span><br><span class="line">Creating secondary indexes on 'sbtest8'...</span><br><span class="line">Creating table 'sbtest9'...</span><br><span class="line">Inserting 100000 records into 'sbtest9'</span><br><span class="line">Creating secondary indexes on 'sbtest9'...</span><br><span class="line">Creating table 'sbtest10'...</span><br><span class="line">Inserting 100000 records into 'sbtest10'</span><br><span class="line">Creating secondary indexes on 'sbtest10'...</span><br><span class="line">[root@localhost sysbench]# sysbench --test=/root/sysbench-master/sysbench/tests/db/oltp.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password=uplooking --oltp-tables-count=10 --oltp-table-size=100000 --num-threads=130 --max-time=20 --mysql-db=sbtest --max-requests=0 --oltp-test-mode=complex --report-interval=1 --mysql-table-engine=innodb run </span><br><span class="line">sysbench 1.0 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 130</span><br><span class="line">Report intermediate results every 1 second(s)</span><br><span class="line">Initializing random number generator from current time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Initializing worker threads...</span><br><span class="line"></span><br><span class="line">Threads started!</span><br><span class="line"></span><br><span class="line">[   1s] threads: 130, tps: 0.99, reads: 1259.55, writes: 11.93, response time: 87.56ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   2s] threads: 130, tps: 14.04, reads: 619.78, writes: 242.70, response time: 1903.57ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   3s] threads: 130, tps: 66.22, reads: 547.33, writes: 261.00, response time: 2880.27ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   4s] threads: 130, tps: 19.21, reads: 366.95, writes: 62.68, response time: 3911.79ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   5s] threads: 130, tps: 45.63, reads: 876.69, writes: 120.39, response time: 4517.90ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   6s] threads: 130, tps: 38.79, reads: 653.12, writes: 183.46, response time: 5312.73ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   7s] threads: 130, tps: 109.66, reads: 833.38, writes: 366.85, response time: 3982.86ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   8s] threads: 130, tps: 9.94, reads: 611.61, writes: 17.90, response time: 4683.57ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[   9s] threads: 130, tps: 4.04, reads: 227.04, writes: 74.67, response time: 4358.09ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  10s] threads: 130, tps: 108.98, reads: 813.88, writes: 425.94, response time: 3574.99ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  11s] threads: 130, tps: 21.48, reads: 660.03, writes: 24.41, response time: 3773.42ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  12s] threads: 130, tps: 41.65, reads: 512.63, writes: 221.12, response time: 3982.86ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  13s] threads: 130, tps: 40.33, reads: 623.56, writes: 256.46, response time: 3267.19ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  14s] threads: 130, tps: 39.68, reads: 460.24, writes: 76.38, response time: 3841.98ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  15s] threads: 130, tps: 37.63, reads: 691.16, writes: 215.86, response time: 4517.90ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  16s] threads: 130, tps: 53.97, reads: 704.44, writes: 166.64, response time: 4055.23ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  17s] threads: 130, tps: 22.56, reads: 305.12, writes: 166.53, response time: 4855.31ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  18s] threads: 130, tps: 1.00, reads: 320.21, writes: 36.14, response time: 4943.53ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  19s] threads: 130, tps: 82.52, reads: 854.02, writes: 259.49, response time: 6026.41ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  20s] threads: 130, tps: 11.85, reads: 332.75, writes: 12.84, response time: 4517.90ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">[  21s] threads: 130, tps: 52.01, reads: 332.47, writes: 383.46, response time: 5124.81ms (95%), errors: 0.00, reconnects:  0.00</span><br><span class="line">OLTP test statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            12656</span><br><span class="line">        write:                           3616</span><br><span class="line">        other:                           1808</span><br><span class="line">        total:                           18080</span><br><span class="line">    transactions:                        904    (42.53 per sec.)</span><br><span class="line">    read/write requests:                 16272  (765.60 per sec.)</span><br><span class="line">    other operations:                    1808   (85.07 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br><span class="line"></span><br><span class="line">General statistics:</span><br><span class="line">    total time:                          21.5991s</span><br><span class="line">    total number of events:              904</span><br><span class="line">    total time taken by event execution: 2713.1958s</span><br><span class="line"></span><br><span class="line">Latency statistics:</span><br><span class="line">         min:                                 87.55ms</span><br><span class="line">         avg:                               3001.32ms</span><br><span class="line">         max:                               6827.14ms</span><br><span class="line">         approx.  95th percentile:          4855.31ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           6.9538/0.78</span><br><span class="line">    execution time (avg/stddev):   20.8707/0.35</span><br></pre></td></tr></table></figure>

<h4 id="CPUæµ‹è¯•"><a href="#CPUæµ‹è¯•" class="headerlink" title="CPUæµ‹è¯•"></a>CPUæµ‹è¯•</h4><blockquote>
<p>ä½¿ç”¨64ä½æ•´æ•°ï¼Œæµ‹è¯•è®¡ç®—ç´ æ•°ç›´åˆ°æŸä¸ªæœ€å¤§å€¼æ‰€éœ€è¦çš„æ—¶é—´</p>
</blockquote>
<p><code>sysbench --test=cpu --cpu-max-prime=2000 run</code></p>
<p>æŸ¥çœ‹CPUä¿¡æ¯æ–¹æ³•,æŸ¥çœ‹ç‰©ç†cpuä¸ªæ•°</p>
<p><code>grep &quot;physical id&quot; /proc/cpuinfo | sort -u | wc -l</code> æŸ¥çœ‹æ ¸å¿ƒæ•°é‡</p>
<p><code>grep &quot;core id&quot; /proc/cpuinfo | sort -u | wc -l</code> æŸ¥çœ‹çº¿ç¨‹æ•°é‡</p>
<p><code>grep &quot;processor&quot; /proc/cpuinfo | sort -u | wc -l</code></p>
<p>åœ¨sysbenchçš„æµ‹è¯•ä¸­ï¼Œâ€“num-threadså–å€¼ä¸ºâ€çº¿ç¨‹æ•°é‡â€å³å¯</p>
<h4 id="çº¿ç¨‹-thread-æµ‹è¯•"><a href="#çº¿ç¨‹-thread-æµ‹è¯•" class="headerlink" title="çº¿ç¨‹(thread)æµ‹è¯•"></a>çº¿ç¨‹(thread)æµ‹è¯•</h4><blockquote>
<p>æµ‹è¯•çº¿ç¨‹è°ƒåº¦å™¨çš„æ€§èƒ½ã€‚å¯¹äºé«˜è´Ÿè½½æƒ…å†µä¸‹æµ‹è¯•çº¿ç¨‹è°ƒåº¦å™¨çš„è¡Œä¸ºéå¸¸æœ‰ç”¨</p>
</blockquote>
<p><code>sysbench --test=threads --num-threads=64 --thread-yields=100 --thread-locks=2 run</code></p>
<h4 id="æ–‡ä»¶IOæ€§èƒ½æµ‹è¯•"><a href="#æ–‡ä»¶IOæ€§èƒ½æµ‹è¯•" class="headerlink" title="æ–‡ä»¶IOæ€§èƒ½æµ‹è¯•"></a>æ–‡ä»¶IOæ€§èƒ½æµ‹è¯•</h4><blockquote>
<p>ç”Ÿæˆéœ€è¦çš„æµ‹è¯•æ–‡ä»¶ï¼Œæ–‡ä»¶æ€»å¤§å°5Gï¼Œ16ä¸ªå¹¶å‘çº¿ç¨‹ã€‚æ‰§è¡Œå®Œåä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€å †å°æ–‡ä»¶</p>
</blockquote>
<p><code>sysbench --test=fileio --num-threads=16 --file-total-size=5G prepare</code></p>
<p>æ‰§è¡Œæµ‹è¯•ï¼ŒæŒ‡å®šéšæœºè¯»å†™æ¨¡å¼:</p>
<ul>
<li>seqwré¡ºåºå†™å…¥</li>
<li>seqrewré¡ºåºé‡å†™</li>
<li>seqrdé¡ºåºè¯»å–</li>
<li>rndrdéšæœºè¯»å–</li>
<li>rndwréšæœºå†™å…¥</li>
<li>rndrwæ··åˆéšæœºè¯»/å†™</li>
</ul>
<p><code>sysbench --test=fileio --num-threads=16 --init-rng=on --file-total-size=5G --file-test-mode=rndrw run</code></p>
<p>é™¤æµ‹è¯•æ–‡ä»¶</p>
<p><code>sysbench --test=fileio --num-threads=16 --file-total-size=5G cleanup</code></p>
<h4 id="å†…å­˜æµ‹è¯•"><a href="#å†…å­˜æµ‹è¯•" class="headerlink" title="å†…å­˜æµ‹è¯•"></a>å†…å­˜æµ‹è¯•</h4><blockquote>
<p>å†…å­˜æµ‹è¯•æµ‹è¯•äº†å†…å­˜çš„è¿ç»­è¯»å†™æ€§èƒ½ã€‚</p>
</blockquote>
<p><code>sysbench --test=memory --num-threads=16 --memory-block-size=8192 --memory-total-size=1G run</code></p>
<h4 id="äº’æ–¥é”-Mutex-æµ‹è¯•"><a href="#äº’æ–¥é”-Mutex-æµ‹è¯•" class="headerlink" title="äº’æ–¥é”(Mutex)æµ‹è¯•"></a>äº’æ–¥é”(Mutex)æµ‹è¯•</h4><blockquote>
<p>æµ‹è¯•äº’æ–¥é”çš„æ€§èƒ½ï¼Œæ–¹å¼æ˜¯æ¨¡æ‹Ÿæ‰€æœ‰çº¿ç¨‹åœ¨åŒä¸€æ—¶åˆ»å¹¶å‘è¿è¡Œï¼Œå¹¶éƒ½çŸ­æš‚è¯·æ±‚äº’æ–¥é”Xã€‚</p>
</blockquote>
<p><code>sysbench --test=mutex --num-threads=16 --mutex-num=1024 --mutex-locks=10000 --mutex-loops=5000 run</code></p>
<h2 id="å®‰è£…sysbench-0-4"><a href="#å®‰è£…sysbench-0-4" class="headerlink" title="å®‰è£…sysbench-0.4"></a>å®‰è£…sysbench-0.4</h2><p>æºç åœ¨çº¿ä¸‹è½½åœ°å€ï¼š<a href="http://101.96.10.46/downloads.mysql.com/source/sysbench-0.4.12.10.tar.gz" target="_blank" rel="noopener">http://101.96.10.46/downloads.mysql.com/source/sysbench-0.4.12.10.tar.gz</a></p>
<p>rpmåŒ…ä¸‹çº¿ä¸‹è½½åœ°å€ï¼š<a href="http://rpm.pbone.net/index.php3/stat/4/idpl/31446291/dir/centos_7/com/sysbench-0.4.12-12.el7.x86_64.rpm.html" target="_blank" rel="noopener">http://rpm.pbone.net/index.php3/stat/4/idpl/31446291/dir/centos_7/com/sysbench-0.4.12-12.el7.x86_64.rpm.html</a></p>
<h3 id="æºç æ­¥éª¤"><a href="#æºç æ­¥éª¤" class="headerlink" title="æºç æ­¥éª¤"></a>æºç æ­¥éª¤</h3><h4 id="æ•°æ®åº“rpmåŒ…å®‰è£…åˆ™ç›´æ¥ç¼–è¯‘"><a href="#æ•°æ®åº“rpmåŒ…å®‰è£…åˆ™ç›´æ¥ç¼–è¯‘" class="headerlink" title="æ•°æ®åº“rpmåŒ…å®‰è£…åˆ™ç›´æ¥ç¼–è¯‘"></a>æ•°æ®åº“rpmåŒ…å®‰è£…åˆ™ç›´æ¥ç¼–è¯‘</h4><p>å¦‚æœæ•°æ®åº“æ˜¯rpmåŒ…å®‰è£…åˆ™ç›´æ¥æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼Œå¦åˆ™åœ¨configureçš„æ—¶å€™éœ€è¦æŒ‡å®šmysqlæ•°æ®åº“çš„åº“libså’Œincludesè·¯å¾„</p>
<ul>
<li>tar zxf sysbench-0.4.8.tar.gz</li>
<li>cd sysbench-0.4.8</li>
<li>./configure &amp;&amp; make &amp;&amp; make install</li>
<li>strip /usr/local/bin/sysbench</li>
</ul>
<h4 id="æ•°æ®åº“ä¸ºæºç ç¼–è¯‘"><a href="#æ•°æ®åº“ä¸ºæºç ç¼–è¯‘" class="headerlink" title="æ•°æ®åº“ä¸ºæºç ç¼–è¯‘"></a>æ•°æ®åº“ä¸ºæºç ç¼–è¯‘</h4><p>æ•°æ®åº“æºç ç¼–è¯‘åè·¯å¾„å¦‚ä¸‹ï¼š</p>
<p>æ•°æ®ç›®å½•        /usr/local/mysql</p>
<p>includesç›®å½•    /usr/local/mysql/include</p>
<p>libsç›®å½•        /usr/local/mysql/lib</p>
<p>æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>tar zxf sysbench-0.4.8.tar.gz</li>
<li>cd sysbench-0.4.8</li>
<li>./configure â€“with-mysql-includes=/usr/local/mysql/include â€“with-mysql-libs=/usr/local/mysql/lib &amp;&amp; make &amp;&amp; make install</li>
<li>strip /usr/local/bin/sysbench</li>
</ul>
<h3 id="rpmåŒ…å®‰è£…æ­¥éª¤"><a href="#rpmåŒ…å®‰è£…æ­¥éª¤" class="headerlink" title="rpmåŒ…å®‰è£…æ­¥éª¤"></a>rpmåŒ…å®‰è£…æ­¥éª¤</h3><p>ä¾èµ–åŒ…ï¼š</p>
<p>mariadb-devel-5.5.44-2.el7.x86_64</p>
<p>postgresql-libs.x86_64 0:9.2.13-1.el7_1<br>â€‹        </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# rpm -q mariadb-devel</span><br><span class="line">mariadb-devel-5.5.44-2.el7.x86_64</span><br><span class="line">[root@localhost ~]# </span><br><span class="line">[root@localhost ~]# rpm -ivh sysbench-0.4.12-12.el7.x86_64.rpm </span><br><span class="line">warning: sysbench-0.4.12-12.el7.x86_64.rpm: Header V4 RSA/SHA1 Signature, key ID 764429e6: NOKEY</span><br><span class="line">error: Failed dependencies:</span><br><span class="line">	libpq.so.5()(64bit) is needed by sysbench-0.4.12-12.el7.x86_64</span><br><span class="line">[root@localhost ~]# yum localinstall -y sysbench-0.4.12-12.el7.x86_64.rpm </span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Examining sysbench-0.4.12-12.el7.x86_64.rpm: sysbench-0.4.12-12.el7.x86_64</span><br><span class="line">Marking sysbench-0.4.12-12.el7.x86_64.rpm to be installed</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package sysbench.x86_64 0:0.4.12-12.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libpq.so.5()(64bit) <span class="keyword">for</span> package: sysbench-0.4.12-12.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package postgresql-libs.x86_64 0:9.2.13-1.el7_1 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">=====================================================================================================================================</span><br><span class="line"> Package                       Arch                 Version                       Repository                                    Size</span><br><span class="line">=====================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> sysbench                      x86_64               0.4.12-12.el7                 /sysbench-0.4.12-12.el7.x86_64               172 k</span><br><span class="line">Installing for dependencies:</span><br><span class="line"> postgresql-libs               x86_64               9.2.13-1.el7_1                _mnt                                         230 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">=====================================================================================================================================</span><br><span class="line">Install  1 Package (+1 Dependent package)</span><br><span class="line"></span><br><span class="line">Total size: 402 k</span><br><span class="line">Total download size: 230 k</span><br><span class="line">Installed size: 836 k</span><br><span class="line">Downloading packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : postgresql-libs-9.2.13-1.el7_1.x86_64                                                                             1/2 </span><br><span class="line">  Installing : sysbench-0.4.12-12.el7.x86_64                                                                                     2/2 </span><br><span class="line">  Verifying  : sysbench-0.4.12-12.el7.x86_64                                                                                     1/2 </span><br><span class="line">  Verifying  : postgresql-libs-9.2.13-1.el7_1.x86_64                                                                             2/2 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  sysbench.x86_64 0:0.4.12-12.el7                                                                                                    </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  postgresql-libs.x86_64 0:9.2.13-1.el7_1                                                                                            </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">ä¸»è¦æµ‹è¯•æ–¹å¼</th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">cpuæ€§èƒ½</td>
<td align="left">ç£ç›˜ioæ€§èƒ½</td>
<td align="left">è°ƒåº¦ç¨‹åºæ€§èƒ½</td>
<td align="left">å†…å­˜åˆ†é…åŠä¼ è¾“é€Ÿåº¦</td>
<td align="left">POSIXçº¿ç¨‹æ€§èƒ½</td>
<td align="left">æ•°æ®åº“æ€§èƒ½(OLTPåŸºå‡†æµ‹è¯•)</td>
</tr>
<tr>
<td align="left">æ‰¾èŒƒå›´å†…æœ€å¤§ç´ æ•°{æ—¶é—´è¶ŠçŸ­è¶Šå¥½}</td>
<td align="left">ä¸åŒåœºæ™¯ä¸‹IOPS{è¶Šå¤§è¶Šå¥½}</td>
<td align="left">çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œå¾ªç¯å“åº”ä¿¡å·é‡èŠ±è´¹çš„æ—¶é—´{è¶Šå°‘è¶Šå¥½}</td>
<td align="left">ä»¥ä¸åŒå—å¤§å°ä¼ è¾“ä¸€å®šæ•°é‡çš„æ•°æ®ååé‡å¤§å°{è¶Šå¤§è¶Šå¥½}</td>
<td align="left">å¹¶å‘çº¿ç¨‹åŒæ—¶ç”³è¯·äº’æ–¥é”å¾ªç¯ä¸€å®šæ¬¡æ•°èŠ±è´¹çš„æ—¶é—´{è¶Šå°‘è¶Šå¥½}</td>
<td align="left">qpsã€tpsè¶Šé«˜è¶Šå¥½</td>
</tr>
</tbody></table>
<h3 id="å¼€å§‹æµ‹è¯•"><a href="#å¼€å§‹æµ‹è¯•" class="headerlink" title="å¼€å§‹æµ‹è¯•"></a>å¼€å§‹æµ‹è¯•</h3><p>ç¼–è¯‘æˆåŠŸä¹‹åï¼Œå°±è¦å¼€å§‹æµ‹è¯•å„ç§æ€§èƒ½äº†ï¼Œæµ‹è¯•çš„æ–¹æ³•å®˜ç½‘ç½‘ç«™ä¸Šä¹Ÿæåˆ°ä¸€äº›ï¼Œä½†æ¶‰åŠåˆ° OLTP æµ‹è¯•çš„éƒ¨åˆ†å´ä¸å¤Ÿå‡†ç¡®ã€‚åœ¨è¿™é‡Œæˆ‘å¤§è‡´æä¸€ä¸‹ï¼š</p>
<h4 id="cpuæ€§èƒ½æµ‹è¯•"><a href="#cpuæ€§èƒ½æµ‹è¯•" class="headerlink" title="cpuæ€§èƒ½æµ‹è¯•"></a>cpuæ€§èƒ½æµ‹è¯•</h4><blockquote>
<p>è¿›è¡Œç´ æ•°çš„åŠ æ³•è¿ç®—:æŒ‡å®šæœ€å¤§çš„ç´ æ•°ä¸º 20000ï¼Œè®°å½•æµ‹è¯•ç»“æœï¼ˆå¯ä»¥æ ¹æ®æœºå™¨cpuçš„æ€§èƒ½æ¥é€‚å½“è°ƒæ•´æ•°å€¼ï¼‰</p>
</blockquote>
<p>sysbench â€“test=cpu â€“cpu-max-prime=20000 run</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# sysbench --test=cpu --cpu-max-prime=20000 run</span><br><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 1</span><br><span class="line"></span><br><span class="line">Doing CPU performance benchmark</span><br><span class="line"></span><br><span class="line">Threads started!</span><br><span class="line">Done.</span><br><span class="line"></span><br><span class="line">Maximum prime number checked in CPU test: 20000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Test execution summary:</span><br><span class="line">    total time:                          30.7005s</span><br><span class="line">    total number of events:              10000</span><br><span class="line">    total time taken by event execution: 30.6870</span><br><span class="line">    per-request statistics:</span><br><span class="line">         min:                                  2.47ms</span><br><span class="line">         avg:                                  3.07ms</span><br><span class="line">         max:                                106.81ms</span><br><span class="line">         approx.  95 percentile:               3.74ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           10000.0000/0.00</span><br><span class="line">    execution time (avg/stddev):   30.6870/0.00</span><br></pre></td></tr></table></figure>

<h4 id="çº¿ç¨‹æµ‹è¯•"><a href="#çº¿ç¨‹æµ‹è¯•" class="headerlink" title="çº¿ç¨‹æµ‹è¯•"></a>çº¿ç¨‹æµ‹è¯•</h4><blockquote>
<p>æµ‹è¯•64ä¸ªçº¿ç¨‹<br>sysbench â€“test=threads â€“num-threads=64 â€“thread-yields=100 â€“thread-locks=2 run</p>
</blockquote>
<figure class="highlight plain"><figcaption><span>~]# sysbench --test</span></figcaption><table><tr><td class="code"><pre><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 64</span><br><span class="line"></span><br><span class="line">Doing thread subsystem performance test</span><br><span class="line">Thread yields per test: 100 Locks used: 2</span><br><span class="line">Threads started!</span><br><span class="line">Done.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Test execution summary:</span><br><span class="line">    total time:                          1.3949s</span><br><span class="line">    total number of events:              10000</span><br><span class="line">    total time taken by event execution: 66.0646</span><br><span class="line">    per-request statistics:</span><br><span class="line">         min:                                  0.03ms</span><br><span class="line">         avg:                                  6.61ms</span><br><span class="line">         max:                               1265.23ms</span><br><span class="line">         approx.  95 percentile:               9.50ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg&#x2F;stddev):           156.2500&#x2F;302.22</span><br><span class="line">    execution time (avg&#x2F;stddev):   1.0323&#x2F;0.33</span><br></pre></td></tr></table></figure>



<h4 id="ç£ç›˜IOæ€§èƒ½æµ‹è¯•"><a href="#ç£ç›˜IOæ€§èƒ½æµ‹è¯•" class="headerlink" title="ç£ç›˜IOæ€§èƒ½æµ‹è¯•"></a>ç£ç›˜IOæ€§èƒ½æµ‹è¯•</h4><blockquote>
<p>æœ€å¤§åˆ›å»º16ä¸ªçº¿ç¨‹ï¼Œåˆ›å»ºçš„æ–‡ä»¶æ€»å¤§å°ä¸º3Gï¼Œæ–‡ä»¶è¯»å†™æ¨¡å¼ä¸ºéšæœºè¯»</p>
</blockquote>
<p>sysbench â€“test=fileio â€“num-threads=16 â€“file-total-size=3G â€“file-test-mode=rndrw prepare #åˆ›å»ºæµ‹è¯•æ–‡ä»¶<br>â€‹<br>sysbench â€“test=fileio â€“num-threads=16 â€“file-total-size=3G â€“file-test-mode=rndrw run        #æ‰§è¡Œæµ‹è¯•æ–‡ä»¶<br>â€‹<br>sysbench â€“test=fileio â€“num-threads=16 â€“file-total-size=3G â€“file-test-mode=rndrw cleanup    #åˆ é™¤æµ‹è¯•æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# sysbench --test=fileio --num-threads=16 --file-total-size=3G --file-test-mode=rndrw prepare</span><br><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">128 files, 24576Kb each, 3072Mb total</span><br><span class="line">Creating files for the test...</span><br><span class="line">[root@localhost ~]# sysbench --test=fileio --num-threads=16 --file-total-size=3G --file-test-mode=rndrw run</span><br><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 16</span><br><span class="line"></span><br><span class="line">Extra file open flags: 0</span><br><span class="line">128 files, 24Mb each</span><br><span class="line">3Gb total file size</span><br><span class="line">Block size 16Kb</span><br><span class="line">Number of random requests for random IO: 10000</span><br><span class="line">Read/Write ratio for combined random IO test: 1.50</span><br><span class="line">Periodic FSYNC enabled, calling fsync() each 100 requests.</span><br><span class="line">Calling fsync() at the end of test, Enabled.</span><br><span class="line">Using synchronous I/O mode</span><br><span class="line">Doing random r/w test</span><br><span class="line">Threads started!</span><br><span class="line">Done.</span><br><span class="line"></span><br><span class="line">Operations performed:  6008 Read, 3997 Write, 12800 Other = 22805 Total</span><br><span class="line">Read 93.875Mb  Written 62.453Mb  Total transferred 156.33Mb  (2.9644Mb/sec)</span><br><span class="line">  189.72 Requests/sec executed</span><br><span class="line"></span><br><span class="line">Test execution summary:</span><br><span class="line">    total time:                          52.7348s</span><br><span class="line">    total number of events:              10005</span><br><span class="line">    total time taken by event execution: 434.9929</span><br><span class="line">    per-request statistics:</span><br><span class="line">         min:                                  0.01ms</span><br><span class="line">         avg:                                 43.48ms</span><br><span class="line">         max:                               1105.16ms</span><br><span class="line">         approx.  95 percentile:             180.46ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           625.3125/46.52</span><br><span class="line">    execution time (avg/stddev):   27.1871/1.19</span><br><span class="line">	</span><br><span class="line">[root@localhost ~]# sysbench --test=fileio --num-threads=16 --file-total-size=3G --file-test-mode=rndrw cleanup</span><br><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">Removing test files...</span><br></pre></td></tr></table></figure>

<h4 id="å†…å­˜æµ‹è¯•-1"><a href="#å†…å­˜æµ‹è¯•-1" class="headerlink" title="å†…å­˜æµ‹è¯•"></a>å†…å­˜æµ‹è¯•</h4><blockquote>
<p>æµ‹è¯•è¿‡ç¨‹æ˜¯åœ¨å†…å­˜ä¸­ä¼ è¾“ 4G çš„æ•°æ®é‡ï¼Œæ¯ä¸ª block å¤§å°ä¸º 8Kã€‚</p>
</blockquote>
<p>sysbench â€“test=memory â€“memory-block-size=8k â€“memory-total-size=4G run</p>
<h4 id="OLTPæµ‹è¯•"><a href="#OLTPæµ‹è¯•" class="headerlink" title="OLTPæµ‹è¯•"></a>OLTPæµ‹è¯•</h4><blockquote>
<p>æµ‹è¯•çš„è¡¨å­˜å‚¨å¼•æ“ç±»å‹ä¸ºinnodbï¼Œè¡¨æœ€å¤§è®°å½•æ•°ä¸º 1000000ï¼Œ</p>
</blockquote>
<p>æµ‹è¯• OLTP æ—¶ï¼Œå…ˆåˆ›å»ºæ•°æ®åº“ sbtestï¼Œæˆ–è€…è‡ªå·±ç”¨å‚æ•° â€“mysql-db æ¥æŒ‡å®šå…¶ä»–æ•°æ®åº“ã€‚</p>
<p>â€“test=oltp åˆ¶å®šæµ‹è¯•ç±»å‹ä¸ºOLTP</p>
<p>â€“db-driver=mysql æµ‹è¯•çš„æ•°æ®åº“ç±»å‹ä¸ºmysql</p>
<p>â€“mysql-table-engine æŒ‡å®šåˆ›å»ºçš„æµ‹è¯•è¡¨sbtestä¸º innodb å‚¨å¼•æ“ç±»å‹</p>
<p>â€“mysql-host=localhost â€“mysql-user=root â€“mysql-password=uplooking åˆ†åˆ«ä¸ºæœåŠ¡å™¨ipï¼Œç”¨æˆ·åå’Œå¯†ç </p>
<p>â€“oltp-table-size=10000 åˆ›å»ºçš„æµ‹è¯•è¡¨çš„å¤§å°ä¸º1ä¸‡è¡Œ</p>
<p>â€“num-threads=128 çº¿ç¨‹æ•°é‡ä¸º128</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# sysbench --test=oltp --db-driver=mysql --mysql-host=localhost --mysql-user=root --mysql-password=uplooking --mysql-db=sbtest --mysql-table-engine=innodb --oltp-table-size=10000 --num-threads=128 prepare</span><br><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">Creating table 'sbtest'...</span><br><span class="line">Creating 10000 records in table 'sbtest'...</span><br><span class="line">[root@localhost ~]# sysbench --test=oltp --db-driver=mysql --mysql-host=localhost --mysql-user=root --mysql-password=uplooking --mysql-db=sbtest --mysql-table-engine=innodb --oltp-table-size=10000 --num-threads=128 run</span><br><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 128</span><br><span class="line"></span><br><span class="line">Doing OLTP test.</span><br><span class="line">Running mixed OLTP test</span><br><span class="line">Using Special distribution (12 iterations,  1 pct of values are returned in 75 pct cases)</span><br><span class="line">Using "BEGIN" for starting transactions</span><br><span class="line">Using auto_inc on the id column</span><br><span class="line">Maximum number of requests for OLTP test is limited to 10000</span><br><span class="line">Threads started!</span><br><span class="line">Done.</span><br><span class="line"></span><br><span class="line">OLTP test statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            181986</span><br><span class="line">        write:                           57056</span><br><span class="line">        other:                           22999</span><br><span class="line">        total:                           262041</span><br><span class="line">    transactions:                        10000  (50.00 per sec.)</span><br><span class="line">    deadlocks:                           2999   (14.99 per sec.)</span><br><span class="line">    read/write requests:                 239042 (1195.09 per sec.)</span><br><span class="line">    other operations:                    22999  (114.98 per sec.)</span><br><span class="line"></span><br><span class="line">Test execution summary:</span><br><span class="line">    total time:                          200.0198s</span><br><span class="line">    total number of events:              10000</span><br><span class="line">    total time taken by event execution: 25451.6909</span><br><span class="line">    per-request statistics:</span><br><span class="line">         min:                                  9.47ms</span><br><span class="line">         avg:                               2545.17ms</span><br><span class="line">         max:                              26148.89ms</span><br><span class="line">         approx.  95 percentile:            6902.69ms</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           78.1250/7.68</span><br><span class="line">    execution time (avg/stddev):   198.8413/0.48</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# sysbench --test=oltp --db-driver=mysql --mysql-host=localhost --mysql-user=root --mysql-password=uplooking --mysql-db=sbtest --mysql-table-engine=innodb --oltp-table-size=10000 --num-threads=128 cleanup</span><br><span class="line">sysbench 0.4.12:  multi-threaded system evaluation benchmark</span><br><span class="line"></span><br><span class="line">Dropping table 'sbtest'...</span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>

<p>50.00 per sec ä¸ºæ¯ç§’äº‹åŠ¡é‡ï¼Œ1195.09 per sec æ¯ç§’çš„è¯»å†™è¯·æ±‚æ•°ï¼Œtotal time:  200.0198s æ€»çš„ç”¨æ—¶</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>MySQLåŸºç¡€ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬å…«è¯¾ é«˜å¯ç”¨æ€§HA</title>
    <url>/2017/01/02/booboo_mysql/05-MySQL%E9%AB%98%E5%8F%AF%E7%94%A8HA/</url>
    <content><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯é«˜å¯ç”¨"><a href="#ä»€ä¹ˆæ˜¯é«˜å¯ç”¨" class="headerlink" title="ä»€ä¹ˆæ˜¯é«˜å¯ç”¨"></a>ä»€ä¹ˆæ˜¯é«˜å¯ç”¨</h3><p>é«˜å¯ç”¨æ€§å®é™…ä¸Šæœ‰ç‚¹åƒç¥ç§˜çš„é‡å…½ã€‚å®ƒé€šå¸¸æ˜¯ä»¥ç™¾åˆ†æ¯”è¡¨ç¤ºï¼Œè¿™æœ¬èº«ä¹Ÿæ˜¯ä¸€ç§æš—ç¤ºï¼šé«˜å¯ç”¨æ€§ä¸æ˜¯ç»å¯¹çš„ï¼Œåªæœ‰ç›¸å¯¹æ›´é«˜çš„å¯ç”¨æ€§ã€‚100%çš„å¯ç”¨æ€§æ˜¯ä¸å¯èƒ½è¾¾åˆ°çš„ã€‚å¯ç”¨æ€§çš„â€œ9â€è§„åˆ™æ˜¯è¡¨ç¤ºå¯ç”¨æ€§ç›®æ ‡æœ€æ™®éçš„æ–¹æ³•ã€‚ä½ å¯èƒ½ä¹ŸçŸ¥é“ï¼Œâ€œ5ä¸ª9â€è¡¨ç¤º99.999%çš„æ­£å¸¸å¯ç”¨æ—¶é—´ã€‚æ¢å¥è¯è¯´ï¼Œæ¯å¹´åªå…è®¸5åˆ†é’Ÿçš„å®•æœºæ—¶é—´ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨è¿™å·²ç»æ˜¯ä»¤äººæƒŠå¹çš„æ•°å­—ï¼Œå°½é‡è¿˜æœ‰ä¸€äº›äººè¯•å›¾è·å¾—æ›´å¤šçš„â€œ9â€ã€‚</p>
<p>æ¯ä¸ªåº”ç”¨å¯¹å¯ç”¨æ€§çš„éœ€æ±‚å„ä¸ç›¸åŒã€‚åœ¨è®¾å®šä¸€ä¸ªå¯ç”¨æ—¶é—´çš„ç›®æ ‡ä¹‹å‰ï¼Œå…ˆé—®é—®è‡ªå·±ï¼Œæ˜¯ä¸æ˜¯ç¡®å®éœ€è¦è¾¾åˆ°è¿™ä¸ªç›®æ ‡ã€‚å¯ç”¨æ€§æ¯æé«˜ä¸€ç‚¹ï¼Œæ‰€èŠ±è´¹çš„æˆæœ¬éƒ½ä¼šè¿œè¶…ä¹‹å‰ï¼›å¯ç”¨æ€§çš„æ•ˆæœå’Œå¼€é”€çš„æ¯”ä¾‹å¹¶ä¸æ˜¯çº¿æ€§çš„ã€‚éœ€è¦ä¿è¯å¤šå°‘å¯ç”¨æ—¶é—´ï¼Œå–å†³äºèƒ½å¤Ÿæ‰¿æ‹…å¤šå°‘æˆæœ¬ã€‚</p>
<p>é«˜å¯ç”¨å®é™…ä¸Šæ˜¯åœ¨å®•æœºé€ æˆçš„æŸå¤±ä¸é™ä½å®•æœºæ—¶é—´æ‰€èŠ±è´¹çš„æˆæœ¬ä¹‹é—´å–ä¸€ä¸ªå¹³è¡¡ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœéœ€è¦èŠ±å¤§é‡é‡‘é’±å»è·å–æ›´å¥½çš„å¯ç”¨æ—¶é—´ï¼Œä½†æ‰€å¸¦æ¥çš„æ”¶ç›Šå´å¾ˆä½ï¼Œå¯èƒ½å°±ä¸å€¼å¾—å»åšã€‚æ€»çš„æ¥è¯´ï¼Œåº”ç”¨åœ¨è¶…è¿‡ä¸€å®šçš„ç‚¹ä»¥åè¿½æ±‚æ›´é«˜çš„å¯ç”¨æ€§æ˜¯éå¸¸å›°éš¾çš„ï¼Œæˆæœ¬ä¹Ÿä¼šå¾ˆé«˜ï¼Œå› æ­¤æˆ‘ä»¬å»ºè®®è®¾å®šä¸€ä¸ªæ›´ç°å®çš„ç›®æ ‡å¹¶ä¸”é¿å…è¿‡æ¸¡è®¾è®¡ã€‚å¹¸è¿çš„æ˜¯ï¼Œå»ºç«‹2ä¸ª9æˆ–3ä¸ª0çš„å¯ç”¨æ—¶é—´çš„ç›®æ ‡å¯èƒ½å¹¶ä¸å›°éš¾ï¼Œå…·ä½“è¯·æ¬¾å–å†³äºåº”ç”¨ã€‚</p>
<h3 id="å¯¼è‡´å®•æœºçš„åŸå› "><a href="#å¯¼è‡´å®•æœºçš„åŸå› " class="headerlink" title="å¯¼è‡´å®•æœºçš„åŸå› "></a>å¯¼è‡´å®•æœºçš„åŸå› </h3><ul>
<li>åœ¨è¿è¡Œç¯å¢ƒçš„é—®é¢˜ä¸­ï¼Œæœ€æ™®éçš„é—®é¢˜æ˜¯ç£ç›˜ç©ºé—´è€—å°½ã€‚</li>
<li>åœ¨æ€§èƒ½é—®é¢˜ä¸­ï¼Œæœ€æ™®éçš„å®•æœºåŸå› ç¡®å®æ˜¯è¿è¡Œå¾ˆç³Ÿç³•çš„SQLï¼Œä½†ä¹Ÿä¸ä¸€å®šéƒ½æ˜¯è¿™ä¸ªåŸå› ï¼Œæ¯”å¦‚ä¹Ÿæœ‰å¾ˆå¤šé—®é¢˜æ˜¯ç”±äºæœåŠ¡å™¨Bugæˆ–é”™è¯¯çš„è¡Œä¸ºå¯¼è‡´çš„ã€‚</li>
<li>ç³Ÿç³•çš„Schemaå’Œç´¢å¼•è®¾è®¡æ˜¯ç¬¬äºŒå¤§å½±å“æ€§èƒ½çš„é—®é¢˜ã€‚</li>
<li>å¤åˆ¶é—®é¢˜é€šå¸¸æ˜¯ç”±äºä¸»å¤‡æ•°æ®ä¸ä¸€è‡´å¯¼è‡´ã€‚</li>
<li>æ•°æ®ä¸¢å¤±é—®é¢˜é€šå¸¸ç”±äºDROP TABLEçš„è¯¯æ“ä½œå¯¼è‡´ï¼Œå¹¶æ€»æ˜¯ä¼´éšç€ç¼ºå°‘å¯ç”¨å¤‡ä»½çš„é—®é¢˜ã€‚</li>
</ul>
<p>å¤åˆ¶è™½ç„¶è¢«äººä»¬ç”¨æ¥æ”¹å–„å¯ç”¨æ—¶é—´ï¼Œä½†å´ä¹Ÿå¯èƒ½å¯¼è‡´å®•æœºã€‚è¿™ä¸»è¦æ˜¯ç”±äºä¸ç¡®å®šçš„ä½¿ç”¨å¯¼è‡´çš„ï¼Œå³ä¾¿å¦‚æ­¤ï¼Œå®ƒä¹Ÿé˜æ˜äº†ä¸€ä¸ªæ™®éçš„æƒ…å†µï¼šè®¸å¤šé«˜å¯ç”¨ç­–ç•¥å¯èƒ½ä¼šäº§ç”Ÿåä½œç”¨ã€‚</p>
<h3 id="å¦‚ä½•å®ç°é«˜å¯ç”¨"><a href="#å¦‚ä½•å®ç°é«˜å¯ç”¨" class="headerlink" title="å¦‚ä½•å®ç°é«˜å¯ç”¨"></a>å¦‚ä½•å®ç°é«˜å¯ç”¨</h3><ul>
<li>é™ä½æ•…éšœç‡</li>
<li>ä¼˜åŒ–æ¶æ„</li>
</ul>
<h3 id="é¿å…å•ç‚¹æ•…éšœ"><a href="#é¿å…å•ç‚¹æ•…éšœ" class="headerlink" title="é¿å…å•ç‚¹æ•…éšœ"></a>é¿å…å•ç‚¹æ•…éšœ</h3><h4 id="åŸºäºå¤åˆ¶çš„å†—ä½™"><a href="#åŸºäºå¤åˆ¶çš„å†—ä½™" class="headerlink" title="åŸºäºå¤åˆ¶çš„å†—ä½™"></a>åŸºäºå¤åˆ¶çš„å†—ä½™</h4><p>å‰é¢æˆ‘ä»¬å·²ç»å­¦ä¹ MySQL Replication çš„å†…å®¹ï¼Œå¦‚ä¸‹æ¶æ„ï¼š</p>
<p><img src="pic/20-ab-replication.jpg" alt="ab"></p>
<p>MySQL 5.6 ä¸‹çš„ semi-sync</p>
<p>![ab1](pic/06-MySQL 5.6ä¸‹çš„semi-sync.png)</p>
<p>MySQL 5.7 ä¸‹çš„ semi-sync</p>
<p>![ab2](pic/07-MySQL 5.7ä¸‹çš„semi-sync.png)</p>
<h4 id="MySQL-åŒæ­¥å¤åˆ¶"><a href="#MySQL-åŒæ­¥å¤åˆ¶" class="headerlink" title="MySQL åŒæ­¥å¤åˆ¶"></a>MySQL åŒæ­¥å¤åˆ¶</h4><p>å½“ä½¿ç”¨åŒæ­¥å¤åˆ¶æ—¶ï¼Œä¸»åº“çš„äº‹åŠ¡åªæœ‰åœ¨è‡³å°‘ä¸€ä¸ªå¤‡åº“ä¸Šæäº¤æ‰èƒ½è®¤ä¸ºå…¶æ‰§è¡Œå®Œæˆã€‚è¿™å®ç°äº†ä¸¤ä¸ªç›®æ ‡ï¼š</p>
<ul>
<li>å½“æœåŠ¡å™¨å´©æºƒæ—¶æ²¡æœ‰æäº¤çš„äº‹åŠ¡ä¼šä¸¢å¤±ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªå¤‡åº“æœ‰å®æ—¶çš„æ•°æ®å‰¯æœ¬ã€‚</li>
<li>å¤§å¤šæ•°åŒæ­¥å¤åˆ¶æ¶æ„è¿è¡Œåœ¨ä¸»åŠ¨-ä¸»åŠ¨æ¨¡å¼ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªæœåŠ¡å™¨åœ¨ä»»ä½•æ—¶å€™éƒ½æ˜¯æ•…éšœè½¬ç§»çš„å€™é€‰è€…ï¼Œè¿™ä½¿å¾—é€šè¿‡å†—ä½™è·å¾—é«˜å¯ç”¨æ€§æ›´åŠ å®¹æ˜“ã€‚</li>
</ul>
<p>MySQL åˆ°ç›®å‰ä¸ºæ­¢ï¼Œï¼ˆ5.7ç‰ˆæœ¬ï¼‰æœ¬èº«å¹¶ä¸æ”¯æŒåŒæ­¥å¤åˆ¶ï¼Œä½†æœ‰ä¸¤ä¸ªåŸºäºMySQLçš„é›†ç¾¤è§£å†³æ–¹æ¡ˆæ”¯æŒåŒæ­¥å¤åˆ¶ã€‚</p>
<h5 id="MySQL-Cluster-é›†ç¾¤"><a href="#MySQL-Cluster-é›†ç¾¤" class="headerlink" title="MySQL Cluster é›†ç¾¤"></a>MySQL Cluster é›†ç¾¤</h5><p>MySQL ä¸­çš„åŒæ­¥å¤åˆ¶é¦–å…ˆå‡ºç°åœ¨MySQL Clushter ï¼ˆNDB Clusterï¼‰ã€‚å®ƒåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šè¿›è¡ŒåŒæ­¥çš„ä¸»-ä¸»å¤åˆ¶ã€‚è¿™æ„å‘³ç€å¯ä»¥åœ¨ä»»ä½•èŠ‚ç‚¹ä¸Šå†™å…¥ï¼›è¿™äº›èŠ‚ç‚¹æ‹¥æœ‰ç­‰åŒçš„è¯»å†™èƒ½åŠ›ã€‚æ¯ä¸€è¡Œéƒ½æ˜¯å†—ä½™å­˜å‚¨çš„ï¼Œè¿™æ ·å³ä½¿ä¸¢å¤±ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿä¸ä¸¢å¤±æ•°æ®ï¼Œå¹¶ä¸”é›†ç¾¤ä»ç„¶èƒ½æä¾›æœåŠ¡ã€‚å°½ç®¡MySQL Clusterè¿˜ä¸æ˜¯é€‚ç”¨äºæ‰€æœ‰åº”ç”¨çš„å®Œç¾è§£å†³æ–¹æ¡ˆï¼Œä½†æ­£å¦‚æˆ‘ä»¬åœ¨å‰ä¸€ç« æåˆ°çš„ï¼Œåœ¨æœ€è¿‘çš„ç‰ˆæœ¬ä¸­å®ƒåšäº†éå¸¸å¿«é€Ÿçš„æ”¹è¿›ï¼Œç°åœ¨å·²ç»æ‹¥æœ‰å¤§é‡çš„æ–°ç‰¹æ€§å’ŒåŠŸèƒ½ï¼šéç´¢å¼•æ•°æ®çš„ç£ç›˜å­˜å‚¨ã€å¢åŠ æ•°æ®èŠ‚ç‚¹èƒ½å¤Ÿåœ¨çº¿æ‰©å±•ã€ä½¿ç”¨ndinfoè¡¨æ¥ç®¡ç†é›†ç¾¤ã€é…ç½®å’Œç®¡ç†é›†ç¾¤çš„è„šæœ¬ã€å¤šçº¿ç¨‹æ“ä½œã€ä¸‹æ¨ï¼ˆpush-downï¼‰çš„å…³è”æ“ä½œï¼ˆç°åœ¨ç§°ä¸ºè‡ªé€‚åº”æŸ¥è¯¢æœ¬åœ°åŒ–ï¼‰ã€èƒ½å¤Ÿå¤„ç†BLOBåˆ—å’Œå¾ˆå¤šåˆ—çš„è¡¨ã€é›†ä¸­å¼çš„ç”¨æˆ·ç®¡ç†ï¼Œä»¥åŠé€šè¿‡åƒmemcacheåè®®ä¸€æ ·çš„NDB APIæ¥å®ç°NoSQLè®¿é—®ã€‚åœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¸­å°†åŒ…å«æœ€ç»ˆä¸€è‡´è¿è¡Œæ¨¡å‹ï¼ŒåŒ…æ‹¬ä¸ºè·¨æ•°æ®ä¸­å¿ƒçš„ä¸»åŠ¨-ä¸»åŠ¨å¤åˆ¶æä¾›äº‹åŠ¡å†²çªæ£€æµ‹å’Œè·¨WANè§£å†³æ–¹æ¡ˆã€‚ç®€è€Œè¨€ä¹‹ï¼ŒMySQL Clusteræ˜¯ä¸€é¡¹å¼•äººæ³¨ç›®çš„æŠ€æœ¯ã€‚</p>
<p>ç°åœ¨è‡³å°‘æœ‰ä¸¤ä¸ªä¸ºç®€åŒ–é›†ç¾¤éƒ¨ç½²å’Œç®¡ç†æä¾›é™„åŠ äº§å“çš„ä¾›åº”å•†ï¼šOracle é’ˆå¯¹ MySQL Cluster çš„æœåŠ¡æ”¯æŒåŒ…å«äº† MySQL Cluster Manager å·¥å…·ï¼›Serveralines æä¾›äº†Cluster Controlå·¥å…·ï¼Œè¯¥å·¥å…·è¿˜èƒ½å¤Ÿå¸®åŠ©éƒ¨ç½²å’Œç®¡ç†å¤åˆ¶é›†ç¾¤ã€‚</p>
<h5 id="Galera-Cluster-é›†ç¾¤"><a href="#Galera-Cluster-é›†ç¾¤" class="headerlink" title="Galera Cluster é›†ç¾¤"></a>Galera Cluster é›†ç¾¤</h5><p>MariaDBä½œä¸ºMysqlçš„ä¸€ä¸ªåˆ†æ”¯ï¼Œåœ¨å¼€æºé¡¹ç›®ä¸­å·²ç»å¹¿æ³›ä½¿ç”¨ï¼Œä¾‹å¦‚å¤§çƒ­çš„openstackï¼Œæ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨æ€§ï¼ŒåŒæ—¶æé«˜ç³»ç»Ÿçš„è´Ÿè½½èƒ½åŠ›ï¼Œé›†ç¾¤éƒ¨ç½²æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p>
<p>MariaDB Galera Cluster ä»‹ç»</p>
<p>MariaDBé›†ç¾¤æ˜¯MariaDBåŒæ­¥å¤šä¸»æœºé›†ç¾¤ã€‚å®ƒä»…æ”¯æŒXtraDB/ InnoDBå­˜å‚¨å¼•æ“ï¼ˆè™½ç„¶æœ‰å¯¹MyISAMå®éªŒæ”¯æŒ - çœ‹wsrep_replicate_myisamç³»ç»Ÿå˜é‡ï¼‰ã€‚</p>
<p>ä¸»è¦åŠŸèƒ½:</p>
<ul>
<li>åŒæ­¥å¤åˆ¶</li>
<li>çœŸæ­£çš„multi-masterï¼Œå³æ‰€æœ‰èŠ‚ç‚¹å¯ä»¥åŒæ—¶è¯»å†™æ•°æ®åº“</li>
<li>è‡ªåŠ¨çš„èŠ‚ç‚¹æˆå‘˜æ§åˆ¶ï¼Œå¤±æ•ˆèŠ‚ç‚¹è‡ªåŠ¨è¢«æ¸…é™¤</li>
<li>æ–°èŠ‚ç‚¹åŠ å…¥æ•°æ®è‡ªåŠ¨å¤åˆ¶</li>
<li>çœŸæ­£çš„å¹¶è¡Œå¤åˆ¶ï¼Œè¡Œçº§</li>
<li>ç”¨æˆ·å¯ä»¥ç›´æ¥è¿æ¥é›†ç¾¤ï¼Œä½¿ç”¨æ„Ÿå—ä¸Šä¸MySQLå®Œå…¨ä¸€è‡´</li>
</ul>
<p>ä¼˜åŠ¿:</p>
<ul>
<li>å› ä¸ºæ˜¯å¤šä¸»ï¼Œæ‰€ä»¥ä¸å­˜åœ¨Slavelag(å»¶è¿Ÿ)</li>
<li>ä¸å­˜åœ¨ä¸¢å¤±äº‹åŠ¡çš„æƒ…å†µ</li>
<li>åŒæ—¶å…·æœ‰è¯»å’Œå†™çš„æ‰©å±•èƒ½åŠ›</li>
<li>æ›´å°çš„å®¢æˆ·ç«¯å»¶è¿Ÿ</li>
<li>èŠ‚ç‚¹é—´æ•°æ®æ˜¯åŒæ­¥çš„,è€ŒMaster/Slaveæ¨¡å¼æ˜¯å¼‚æ­¥çš„,ä¸åŒslaveä¸Šçš„binlogå¯èƒ½æ˜¯ä¸åŒçš„</li>
</ul>
<p>æŠ€æœ¯:</p>
<p>Galeraé›†ç¾¤çš„å¤åˆ¶åŠŸèƒ½åŸºäºGaleralibraryå®ç°,ä¸ºäº†è®©MySQLä¸Galera libraryé€šè®¯ï¼Œç‰¹åˆ«é’ˆå¯¹MySQLå¼€å‘äº†wsrep APIã€‚</p>
<p>Galeraæ’ä»¶ä¿è¯é›†ç¾¤åŒæ­¥æ•°æ®ï¼Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ï¼Œé çš„å°±æ˜¯å¯è®¤è¯çš„å¤åˆ¶ï¼Œå·¥ä½œåŸç†å¦‚ä¸‹å›¾ï¼š</p>
<p>![](pic/14-Galera Cluster.png)</p>
<p>å½“å®¢æˆ·ç«¯å‘å‡ºä¸€ä¸ªcommitçš„æŒ‡ä»¤ï¼Œåœ¨äº‹åŠ¡è¢«æäº¤ä¹‹å‰ï¼Œæ‰€æœ‰å¯¹æ•°æ®åº“çš„æ›´æ”¹éƒ½ä¼šè¢«write-setæ”¶é›†èµ·æ¥,å¹¶ä¸”å°† write-set çºªå½•çš„å†…å®¹å‘é€ç»™å…¶ä»–èŠ‚ç‚¹ã€‚</p>
<p>write-set å°†åœ¨æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œè®¤è¯æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå†³å®šç€èŠ‚ç‚¹æ˜¯å¦åº”ç”¨write-setæ›´æ”¹æ•°æ®ã€‚</p>
<p>å¦‚æœè®¤è¯æµ‹è¯•å¤±è´¥ï¼ŒèŠ‚ç‚¹å°†ä¸¢å¼ƒ write-set ï¼›å¦‚æœè®¤è¯æµ‹è¯•æˆåŠŸï¼Œåˆ™äº‹åŠ¡æäº¤ã€‚</p>
<blockquote>
<p>è½¯ä»¶çš„è·å–</p>
</blockquote>
<p><a href="http://classroom.example.com/materials/mariadb-10.2.repo" target="_blank" rel="noopener">http://classroom.example.com/materials/mariadb-10.2.repo</a></p>
<p><a href="http://classroom.example.com/materials/thirdpart.repo" target="_blank" rel="noopener">http://classroom.example.com/materials/thirdpart.repo</a></p>
<blockquote>
<p>é›†ç¾¤é…ç½®è¦æ±‚</p>
</blockquote>
<ol>
<li>å®‰è£…4ä¸ªèŠ‚ç‚¹</li>
<li>å…³é—­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹åé‡èµ·æœåŠ¡ï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œ</li>
<li>å…³é—­ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œå»æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼Œåœ¨é›†ç¾¤ä¸­ä½œæ’å…¥åŠ¨ä½œï¼Œé‡èµ·æœåŠ¡ï¼Œçœ‹æ˜¯å¦èƒ½å¤ŸåŒæ­¥åˆ°æ•°æ®ã€‚</li>
</ol>
<blockquote>
<p>è¯¦ç»†æ­¥éª¤</p>
</blockquote>
<blockquote>
<blockquote>
<p>1.å®‰è£…è½¯ä»¶åŒ…</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">galera   25.3.15</span><br><span class="line">jemalloc*                               </span><br><span class="line">MariaDB-client  10.2         </span><br><span class="line">MariaDB-server  10.2     </span><br><span class="line">MariaDB-compat  10.2</span><br></pre></td></tr></table></figure>

<p>éœ€è¦å…ˆå¸è½½mariadb-libs</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> rpm -e mariadb-libs --nodeps</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rpm -e mariadb-common --nodeps</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install -y galera jemalloc* MariaDB-client  MariaDB-server MariaDB-compat</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>2.åˆå§‹åŒ–MariaDBæ•°æ®åº“å¹¶å¯åŠ¨MariaDBæœåŠ¡ï¼Œå¹¶ä½œå®‰å…¨åŠ å›º</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> systemctl start mysql</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql_secure_installation</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl stop mysql</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>3.é…ç½®</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/my.cnf.d/galera.cnf</span><br><span class="line"></span><br><span class="line">[galera]</span><br><span class="line"><span class="meta">#</span><span class="bash"> Mandatory settings</span></span><br><span class="line">wsrep_on=ON</span><br><span class="line">wsrep_provider=/usr/lib64/galera/libgalera_smm.so</span><br><span class="line"><span class="meta">#</span><span class="bash">å¯åŠ¨èŠ‚ç‚¹æ—¶éœ€è¦æŒ‡å®šgalera clusterçš„åœ°å€,ä½œä¸ºclusterä¸­ç¬¬ä¸€ä¸ªå¯åŠ¨çš„èŠ‚ç‚¹,wsrep_cluster_address=gcomm://,å¯¹äºåç»­å¯åŠ¨çš„èŠ‚ç‚¹,wsrep_cluster_address=gcomm://node1,node2,node3</span></span><br><span class="line">wsrep_cluster_address='gcomm://'</span><br><span class="line"><span class="meta">#</span><span class="bash">æ‰€æœ‰nodeå¿…é¡»ä¸€æ ·</span></span><br><span class="line">wsrep_cluster_name='galera'</span><br><span class="line"><span class="meta">#</span><span class="bash">èŠ‚ç‚¹åœ°å€</span></span><br><span class="line">wsrep_node_address='172.25.0.11'</span><br><span class="line"><span class="meta">#</span><span class="bash">èŠ‚ç‚¹åç§°</span></span><br><span class="line">wsrep_node_name='galera1'</span><br><span class="line"><span class="meta">#</span><span class="bash">Snapshot State Transterå¿«ç…§çŠ¶æ€è½¬ç§»æ–¹æ³•:mysqldump/rsync,é»˜è®¤mysqldump</span></span><br><span class="line">wsrep_sst_method=rsync</span><br><span class="line"><span class="meta">#</span><span class="bash">binlogçš„æ ¼å¼ä¹Ÿæœ‰ä¸‰ç§ï¼šSTATEMENTï¼ŒROWï¼ŒMIXED</span></span><br><span class="line">binlog_format=row</span><br><span class="line">default_storage_engine=InnoDB</span><br><span class="line"><span class="meta">#</span><span class="bash">è°ƒæ•´é”ç­–ç•¥çš„</span></span><br><span class="line">innodb_autoinc_lock_mode=2</span><br><span class="line">bind-address=0.0.0.0</span><br></pre></td></tr></table></figure>

<p>4.å¯åŠ¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start mysql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹ç›®å‰mysqlçš„ç«¯å£</span></span><br><span class="line">netstat -ntpl|grep sql</span><br><span class="line">tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      12877/mysqld        </span><br><span class="line">tcp        0      0 0.0.0.0:4567            0.0.0.0:*               LISTEN      12877/mysqld</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>5.å…¶ä»–èŠ‚ç‚¹ä¸Šåšç›¸åŒé…ç½®</p>
</blockquote>
</blockquote>
<p>ä¾æ¬¡å¯åŠ¨å…¶ä»–èŠ‚ç‚¹,å…¶ä»–èŠ‚ç‚¹ä¼šæ ¹æ®é…ç½®è‡ªåŠ¨åŠ å…¥é›†ç¾¤å¹¶åŒæ­¥æ•°æ®ï¼Œä¸€å®šè¦å…³é—­selinuxï¼Œæˆ–è€…è®¾ä¸º0</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[galera]</span><br><span class="line"><span class="meta">#</span><span class="bash"> Mandatory settings</span></span><br><span class="line">wsrep_on=ON</span><br><span class="line">wsrep_provider=/usr/lib64/galera/libgalera_smm.so</span><br><span class="line">wsrep_cluster_address='gcomm://172.25.0.11'</span><br><span class="line">wsrep_cluster_name='galera'</span><br><span class="line">wsrep_node_address='172.25.0.12'</span><br><span class="line">wsrep_node_name='&lt;æ³¨æ„è¿™é‡Œä¸è§£æçš„ä¸»æœºåç›¸åŒ&gt;'</span><br><span class="line">wsrep_sst_method=rsync</span><br><span class="line"></span><br><span class="line">binlog_format=row</span><br><span class="line">default_storage_engine=InnoDB</span><br><span class="line">innodb_autoinc_lock_mode=2</span><br><span class="line">bind-address=0.0.0.0</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>6.è§‚å¯Ÿæ—¥å¿—</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera0 ~]# tail -f /var/log/mysqld.log</span><br></pre></td></tr></table></figure>


<blockquote>
<blockquote>
<p>7.åœ¨galeraä¸ŠæŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show global status like 'wsrep_cluster%';</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line">| Variable_name            | Value                                |</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line">| wsrep_cluster_conf_id    | 14                                   |</span><br><span class="line">| wsrep_cluster_size       | 2                                    |</span><br><span class="line">| wsrep_cluster_state_uuid | ff8cb12b-168a-11e6-ba3c-b36f59743764 |</span><br><span class="line">| wsrep_cluster_status     | Primary                              |</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show global status like 'wsrep_cluster%';</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line">| Variable_name            | Value                                |</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line">| wsrep_cluster_conf_id    | 15                                   |</span><br><span class="line">| wsrep_cluster_size       | 3                                    |</span><br><span class="line">| wsrep_cluster_state_uuid | ff8cb12b-168a-11e6-ba3c-b36f59743764 |</span><br><span class="line">| wsrep_cluster_status     | Primary                              |</span><br><span class="line">+--------------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>8.æµ‹è¯•</p>
</blockquote>
</blockquote>
<p>1.åœ¨ä¸€èŠ‚ç‚¹ä¸Šæ–°å»ºè¡¨å¹¶æ’å…¥æ•°æ®ä»¥åœ¨å…¶ä»–å®ä¾‹ä¸Šè§‚æµ‹æ•°æ®æ˜¯å¦åŒæ­¥</p>
<p>2.æµ‹è¯•èŠ‚ç‚¹æ•…éšœæœºæ¢å¤A.masterb slavea B.masteraåœæ‰ä¹‹åï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ‰èƒ½é‡æ–°åŠ å…¥ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å…³æ³¨å‡ ä¸ªå…³é”®çš„å‚æ•°:</p>
<ul>
<li><code>wsrep_connected = on</code> é“¾æ¥å·²å¼€å¯</li>
<li><code>wsrep_local_index = 1</code> åœ¨é›†ç¾¤ä¸­çš„ç´¢å¼•å€¼</li>
<li><code>wsrep_cluster_size =3</code>é›†ç¾¤ä¸­èŠ‚ç‚¹çš„æ•°é‡</li>
<li><code>wsrep_incoming_addresses = 172.25.0.11:3306,172.25.0.12:3306,172.25.0.13:3306</code></li>
</ul>
<p>é›†ç¾¤ä¸­èŠ‚ç‚¹çš„è®¿é—®åœ°å€</p>
<h3 id="æ•…éšœè½¬ç§»å’Œæ•…éšœæ¢å¤"><a href="#æ•…éšœè½¬ç§»å’Œæ•…éšœæ¢å¤" class="headerlink" title="æ•…éšœè½¬ç§»å’Œæ•…éšœæ¢å¤"></a>æ•…éšœè½¬ç§»å’Œæ•…éšœæ¢å¤</h3><p>æˆ‘ä»¬å›å¿†ä¸€ä¸‹ï¼Œä¸€å¼€å§‹æˆ‘ä»¬åªæœ‰ä¸€å°æ•°æ®åº“æœåŠ¡å™¨ï¼Œrhel7çš„æ“ä½œç³»ç»Ÿï¼Œmaraidb-server5.5ç‰ˆæœ¬ã€‚</p>
<ul>
<li>1.1ï¼šç”¨æˆ·å°‘ï¼Œæ•°æ®é‡ä¹Ÿä¸å¤šï¼Œæ¯å¤©ç”¨taræ‰“åŒ…å‹ç¼©å¥½ï¼Œæ‹·è´å‡ºæ¥ï¼Œè¿™ç§æ–¹æ³•æ¯æ¬¡éƒ½è¦åœæ‰æœåŠ¡ï¼›  </li>
<li>1.2ï¼štaræ‰“åŒ…å¤ªæ…¢äº†ï¼Œæ•°æ®å†å¢é•¿ä¼šæ›´æ…¢ï¼›ç”¨LVM å¿«ç…§æ–¹å¼ï¼Œå¤‡ä»½çš„æ—¶å€™è¦åŠ è¯»é”flush tables with read lockï¼›ç¬é—´å®Œæˆåè§£é”unlock tables;å†æŒ‚åœ¨æ‹·è´å‡ºæ¥ï¼›è¿˜åŸçš„æ—¶å€™æ•°æ®å¤§å°å†³å®šè¿˜åŸæ—¶é—´é•¿çŸ­</li>
<li>1.3ï¼šå¸Œæœ›å¤‡ä»½è¿‡ç¨‹ä¸­ä¿æŒæ•°æ®ä¸€è‡´æ€§å’ŒæœåŠ¡å¯ç”¨æ€§ï¼›æ”¹ç”¨mysqldumpï¼Œç»“åˆäºŒè¿›åˆ¶æ—¥å¿—ã€‚æ¯å¤©æ—©ä¸Š8ç‚¹åšå…¨å¤‡ä»½ï¼›æ¢å¤çš„æ—¶å€™ï¼Œå…ˆå¯¼å…¥å…¨å¤‡ä»½ï¼Œç„¶åæ ¹æ®binlogåšé‡æ¼”</li>
<li>1.4ï¼šç”¨æˆ·æ•°é‡è¶Šæ¥è¶Šå¤šï¼Œæ•°æ®åº“ä»åŸæ¥å‡ ä¸ªGåˆ°ç°åœ¨å·²ç»å˜æˆ20ä¸ªGäº†ï¼Œç”¨mysqldumpå‘½ä»¤å¤ªæ…¢äº†ï¼Œäºæ˜¯æ”¹ç”¨percona xtrabackupå·¥å…·ã€‚å¹¶ä¸”åˆ¶å®šäº†ä¸€ä¸ªå¤‡ä»½è®¡åˆ’ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å‘¨ä¸€8ï¼š00 å…¨å¤‡ä»½ï¼›</span><br><span class="line">å‘¨äºŒ8ï¼š00 å¢é‡å¤‡ä»½ï¼›</span><br><span class="line">å‘¨ä¸‰8ï¼š00 å¢é‡å¤‡ä»½ï¼›</span><br><span class="line">å‘¨å››8ï¼š00 å¢é‡å¤‡ä»½ï¼›</span><br><span class="line">å‘¨äº”8ï¼š00 å¢é‡å¤‡ä»½ï¼›</span><br><span class="line">å‘¨å…­8ï¼š00 å¢é‡å¤‡ä»½ï¼›</span><br><span class="line">å‘¨æ—¥8ï¼š00 å¢é‡å¤‡ä»½ï¼›</span><br><span class="line">æ¢å¤çš„æ—¶å€™ï¼Œä¹Ÿå¾ˆæ–¹ä¾¿ã€‚</span><br></pre></td></tr></table></figure>

<ul>
<li>2.1ï¼šæœåŠ¡å™¨å®•æœºäº†ï¼Œå¸Œæœ›ç¬é—´åˆ‡æ¢åˆ°å¦ä¸€å°ï¼Œäºæ˜¯æ·»åŠ ä¸€å°æœåŠ¡å™¨slaveaï¼Œåšä¸»ä»åŒæ­¥ã€‚</li>
<li>2.2ï¼šé˜²æ­¢ä»æœºå•ç‚¹æ•…éšœï¼Œå¢åŠ ä¸€å°slaveb</li>
<li>2.3ï¼šå¦‚æœ master æ˜¯å•ç‚¹æ•…éšœ,å¦‚ä½•è§£å†³ï¼Ÿå¤šçº§ä¸»ä» multi-sourceï¼Œä¸¤ä¸ªä¸»æœåŠ¡å™¨ï¼Œä¸¤ä¸ªä»æœåŠ¡å™¨ï¼Œä½œmulti-source,å¦‚æœä¸€å°ä¸»æœåŠ¡å™¨å®•æ‰äº†ï¼Œé‚£ä¹ˆä»æœåŠ¡å™¨ä¼šè‡ªåŠ¨å»æ‰¾ç¬¬äºŒå°ä¸»æœåŠ¡å™¨ã€‚</li>
</ul>
<h4 id="é—®é¢˜çš„æå‡º"><a href="#é—®é¢˜çš„æå‡º" class="headerlink" title="é—®é¢˜çš„æå‡º"></a>é—®é¢˜çš„æå‡º</h4><p><strong>ä¸¤å°masteræ˜¯å¦éƒ½èƒ½è¿å‘¢ï¼Ÿ</strong></p>
<p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å‰é¢çš„å®¢æˆ·ç«¯è¦æ¥è¿æ¥æ•°æ®åº“ï¼Œæ˜¯è¿æ¥M1ï¼Œè¿˜æ˜¯M2å‘¢?å¦‚æœåŒæ—¶å¯¹M1å’ŒM2æ‰§è¡Œè¯»å†™æ“ä½œï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ˜¯å¦ä¼šå‡ºé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æ¥åšä¸ªå°æ¸¸æˆï¼æ‰¾ä¸€ä¸ªå­¦ç”ŸTomè¿æ¥M1ï¼Œå¦ä¸€ä¸ªå­¦ç”ŸJackè¿æ¥äº†M2ï¼Œç°åœ¨ï¼Œä»–ä»¬åŒæ—¶å¯¹æ•°æ®åº“è¿›è¡Œå†™æ“ä½œï¼Œä¿®æ”¹db1.t1ä¸­çš„id=4çš„è¡Œï¼Œæ”¹ä¸º99ï¼Œç„¶åæŸ¥çœ‹ä¸€ä¸‹t1è¡¨çš„ç»“æœã€‚</p>
<p>ä»ç»“æœçœ‹ï¼ŒåŒæ—¶å¤šä¸ªç”¨æˆ·å¯¹åŒä¸€å¼ è¡¨çš„åŒä¸€ä¸ªæ•°æ®è¿›è¡Œå†™æ“ä½œï¼Œä¼šæœ‰å†²çªçš„ã€‚æ‰€ä»¥å†™æ“ä½œæ¯æ¬¡åªç»™ä¸€å°æœåŠ¡æœ€å¥½ï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·ä¸å¤šï¼Œæ•°æ®ä¸å¤šï¼Œé—®é¢˜ä¹Ÿä¸å¤§ã€‚</p>
<p><strong>å½“å‰çš„å›°å¢ƒ</strong></p>
<p>å‰ç«¯çš„åº”ç”¨ç¨‹åºæ— æ³•ä½¿ç”¨å¤šå°æ•°æ®åº“ï¼Œå‰ç«¯åªèƒ½æŒ‡å®šä¸€å°æ•°æ®åº“çš„ipåœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ è®©å‰ç«¯åº”ç”¨è¿æ¥M1ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è¯»å†™æ“ä½œéƒ½æ˜¯é€šè¿‡M1ï¼Œé‚£ä¹ˆå…¶ä»–æ•°æ®åº“é™¤äº†çƒ­å¤‡çš„ä½œç”¨ä»¥å¤–å°±æ²¡æœ‰äº†ã€‚è¿™æ ·å¾ˆæµªè´¹æ€§èƒ½ï¼Œè€Œä¸”å½“æˆ‘ä»¬å‰ç«¯çš„è¯·æ±‚è¶Šæ¥è¶Šå¤šï¼Œä¸€å°æ•°æ®åº“æœåŠ¡å™¨ä¼šéå¸¸çš„åƒåŠ›ï¼Œæ—¢è¦å“åº”è¯»è¯·æ±‚ï¼Œè¿˜è¦å“åº”å†™è¯·æ±‚ï¼Œä»–çš„å‹åŠ›ä¼šéå¸¸çš„å¤§ã€‚å¦‚æœM1å®•æœºäº†ï¼Œè¿˜è¦æ‰‹åŠ¨åˆ‡æ¢åˆ°M2ï¼Œè¿™æ ·çš„æ•ˆæœå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæˆ‘ä»¬è‚¯å®šå¸Œæœ›ä»–èƒ½ç¬é—´åˆ‡æ¢ã€‚</p>
<p>å¦å¤–ï¼Œè®©å‰ç«¯åº”ç”¨è¿æ¥slaveå°±æ›´ä¸è¡Œäº†ï¼Œå¦‚æœåœ¨ä»æœºä¸Šè§¦å‘å†™æ“ä½œï¼Œé‚£ä¹ˆä¸»ä»åŒæ­¥å°†ä¼šè¢«æ–­å¼€ï¼Œå› ä¸ºä»æœºçš„æ•°æ®ä¸€å®šè¦å’Œä¸»æœºä¸€æ¨¡ä¸€æ ·ï¼Œä¸ç„¶å°±ä¼šæœ‰å†²çªäº†ã€‚</p>
<p>æ‰€ä»¥æ€»ç»“ä¸€ä¸‹ï¼Œç°åœ¨æˆ‘ä»¬é‡åˆ°çš„å›°å¢ƒï¼š</p>
<ol>
<li>æœ‰å¤šå°æ•°æ®åº“æœåŠ¡å™¨ï¼Œä½†æ˜¯åªèƒ½ä½¿ç”¨ä¸€å°ï¼Œä¸èƒ½ä½œè´Ÿè½½å‡è¡¡ï¼ˆå°†å‰ç«¯ç”¨æˆ·çš„è¯·æ±‚å‡è¡¡åœ°åˆ†é…ç»™åç«¯çš„æœåŠ¡å™¨ï¼‰</li>
<li>å¦‚æœä¸€å°ä¸»æœåŠ¡å™¨åäº†ï¼Œé‚£ä¹ˆéœ€è¦æ‰‹åŠ¨åˆ‡æ¢ï¼Œä¸èƒ½åšåˆ°ç¬é—´è‡ªåŠ¨åˆ‡æ¢</li>
<li>ä¸¤å°slaveåªä½œä¸ºå¤‡ä»½ä½¿ç”¨ï¼Œæµªè´¹æ€§èƒ½ï¼Œè™½ç„¶ä¸èƒ½ç”¨æ¥å†™ï¼Œä½†æ˜¯å¯ä»¥ç”¨æ¥è¯»å–æ•°æ®</li>
</ol>
<p>ä»ä¸Šé¢çš„æ€»ç»“æ¥çœ‹ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨è¿™ä¸ªæ¶æ„ä¸‹ï¼Œèƒ½å¤Ÿå®ç°æ›´å¤šçš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li>è´Ÿè½½å‡è¡¡    å°±æ˜¯è¯´èƒ½å¤Ÿå‡è¡¡åœ°åˆ†é…å‰ç«¯çš„ç”¨æˆ·è¯·æ±‚<br> . è¯»å†™åˆ†ç¦»    ä¸¤å°masterç”¨æ¥å†™ï¼Œä¸¤å°slaveç”¨æ¥è¯»ï¼Œæå‡æ•´ä½“æ€§èƒ½</li>
</ol>
<h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p><strong>å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</strong></p>
<ul>
<li>ç¬¬ä¸€ç§æ–¹æ¡ˆâ€”â€”åœ¨åº”ç”¨ä¸­å¤„ç†æ•…éšœè½¬ç§»ï¼Œæ‰¾å¼€å‘äººå‘˜ä½œäºŒæ¬¡å¼€å‘ï¼Œå°†å‰ç«¯åº”ç”¨ä»£ç ä¿®æ”¹ï¼Œè®©ä»–èƒ½å¤Ÿå®ç°ä¸Šé¢çš„åŠŸèƒ½ï¼›</li>
<li>ç¬¬äºŒç§æ–¹æ¡ˆâ€”â€”ä¸­é—´ä»¶è§£å†³æ–¹æ¡ˆï¼Œåœ¨å‰ç«¯åº”ç”¨å’Œåå°æ•°æ®åº“ä¹‹é—´æ·»åŠ ä¸€å°ä»£ç†æœåŠ¡å™¨ã€‚é€šè¿‡æ•°æ®åº“çš„mysqlåè®®å»è½¬å‘sqlè¯­å¥ã€‚å¦‚æœåé¢æ•°æ®åº“æ˜¯oracleæ•°æ®åº“ï¼Œé‚£ä¹ˆè¿™ä¸ªåå‘ä»£ç†æœåŠ¡å™¨å°±åº”è¯¥èƒ½å¤Ÿæ”¯æŒoracleçš„åè®®ï¼Œç›‘å¬oracleçš„ç«¯å£ï¼Œèƒ½è·Ÿoracleè¿›è¡Œé€šä¿¡ã€‚</li>
</ul>
<p>æˆ‘ä»¬æ¥è®²ç¬¬äºŒç§æ–¹æ³•ã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯æ•°æ®åº“ä»£ç†æœåŠ¡å™¨"><a href="#ä»€ä¹ˆæ˜¯æ•°æ®åº“ä»£ç†æœåŠ¡å™¨" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°æ®åº“ä»£ç†æœåŠ¡å™¨"></a>ä»€ä¹ˆæ˜¯æ•°æ®åº“ä»£ç†æœåŠ¡å™¨</h4><p> å¦‚æœä¸€ä¸ªæœåŠ¡å™¨èƒ½å¤Ÿæ”¯æŒæ•°æ®åº“çš„åè®®ï¼Œå¹¶ä¸”èƒ½å¤Ÿè½¬å‘sqlè¯­å¥ï¼Œæˆ‘ä»¬å°±æŠŠä»–ç§°ä¹‹ä¸ºæ•°æ®åº“ä»£ç†æœåŠ¡å™¨ã€‚</p>
<blockquote>
<p>è´Ÿè½½å‡è¡¡</p>
</blockquote>
<p>æ•°æ®åº“ä»£ç†å’ŒwebæœåŠ¡å™¨çš„ä»£ç†éƒ½éœ€è¦å…·å¤‡ä¸€äº›åŸºæœ¬ä»£ç†æœåŠ¡å™¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼Œè´Ÿè½½å‡è¡¡ï¼Œè‡³å°‘è¦èƒ½å®ç°è´Ÿè½½å‡è¡¡ï¼Œæˆ‘ä»¬åç«¯æœ‰å¤šå°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä»£ç†æœåŠ¡å™¨èƒ½å¤Ÿå°†å‰ç«¯ç”¨æˆ·çš„è¯·æ±‚ä»¥ç›¸å¯¹å‡è¡¡çš„æ–¹å¼åˆ†æ‹…åˆ°åç«¯å¤šå°æœåŠ¡å™¨ä¸Šé¢ã€‚</p>
<blockquote>
<p>è¯»å†™åˆ†ç¦»</p>
</blockquote>
<p>å¦‚æœæˆ‘ä»¬åç«¯çš„æ•°æ®åº“ä¸å­˜åœ¨ä¸»å’Œä»çš„å…³ç³»ï¼Œå¤§å®¶éƒ½æ˜¯masterï¼Œä»»ä½•ä¸€æ¡è¯­å¥éƒ½èƒ½å†™ï¼Œé‚£ä¹ˆå‘ç»™è°éƒ½æ²¡æœ‰å¤ªå¤§å…³ç³»ï¼›ä½†æ˜¯å¦‚æœåé¢æ˜¯masterå’Œslaveçš„å…³ç³»ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´ä»æœºæ˜¯ä¸èƒ½è¿›è¡Œå†™æ“ä½œçš„ï¼Œæ‰€ä»¥åœ¨è´Ÿè½½å‡è¡¡ï¼Œåˆ†å‘sqlçš„è¿‡ç¨‹å½“ä¸­ï¼Œä½ çš„ä»£ç†æœåŠ¡å™¨è¦èƒ½å¤Ÿè¯†åˆ«è¯»å’Œå†™ï¼Œç„¶åæŠŠè¯»æ“ä½œéƒ½åˆ†å‘ç»™slaveï¼Œå†™åˆ†å‘ç»™masterï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªåŠŸèƒ½å«åšè¯»å†™åˆ†ç¦»ã€‚</p>
<p>è´Ÿè½½å‡è¡¡å’Œè¯»å†™åˆ†ç¦»æ˜¯æ•°æ®åº“ä»£ç†æœåŠ¡å™¨å½“ä¸­æœ€åŸºæœ¬çš„ä¸¤ä¸ªåŠŸèƒ½ã€‚ä½ ç”¨ä»»ä½•ä¸€ä¸ªæ•°æ®åº“ä»£ç†æœåŠ¡å™¨ï¼Œéƒ½éœ€è¦è¿™ä¸¤ä¸ªåŠŸèƒ½ã€‚å¦‚æœä¸å…·å¤‡è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼Œé‚£åŸºæœ¬ä¸Šæ²¡äººç”¨ã€‚</p>
<p>ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œä»–å­˜åœ¨äºæˆ‘ä»¬å®¢æˆ·ç«¯å’Œæ•°æ®åº“æœåŠ¡å™¨ä¹‹é—´ï¼Œåç«¯çš„æ•°æ®åº“æœåŠ¡å™¨ä¸éœ€è¦çŸ¥é“å®¢æˆ·ç«¯çš„ipåœ°å€ï¼Œä»–åªè¦çŸ¥é“è°æ¥æ‰¾æˆ‘çš„ï¼Œè°å‘è¯·æ±‚ç»™æˆ‘çš„ï¼Œå¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œä»–ä¸éœ€è¦çŸ¥é“æ•°æ®åº“æœåŠ¡å™¨çš„åœ°å€ï¼Œä»–åªè¦çŸ¥é“ä»£ç†å°±è¡Œäº†ï¼Œåé¢æ€ä¹ˆæ‰§è¡Œä»–ä¸ç®¡ã€‚ä¹Ÿå°±æ˜¯è¯´ç°åœ¨å®¢æˆ·ç«¯ä¸å†ç›´æ¥ä¸æ•°æ®åº“æœåŠ¡å™¨é€šä¿¡äº†ï¼Œè€Œæ˜¯é€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œé€šè®¯ï¼Œä»£ç†æœåŠ¡å™¨å®ç°è´Ÿè½½å‡è¡¡ï¼Œå®ç°è¯»å†™åˆ†ç¦»ã€‚</p>
<blockquote>
<p>åˆ†åº“ã€åˆ†è¡¨ã€åˆ†ç‰‡</p>
</blockquote>
<p>è¿›é˜¶çº§çš„è¿˜ä¼šæœ‰å…¶ä»–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ä¸€äº›ä¼˜ç§€çš„ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥å®ç°åˆ†åº“ã€åˆ†è¡¨ã€åˆ†ç‰‡ï¼›sqlè·¯ç”±å¹¶å‘æŸ¥è¯¢ï¼›sqlè¿‡æ»¤</p>
<p>ä¸¾ä¾‹è¯´æ˜ï¼š</p>
<p>4ä¸ªåº“db1 db2 db3 db4ï¼Œåé¢4å°æ•°æ®åº“åšä¸»ä»åŒæ­¥ï¼Œä»–ä»¬çš„æ•°æ®éƒ½æ˜¯ç›¸åŒçš„ï¼Œç°åœ¨ç”¨æˆ·å‘èµ·è¯·æ±‚è¦è®¿é—®db1ï¼Œdb1ä¸Šæœ‰5å¼ è¡¨ï¼Œç»è¿‡è½®è¯¢ï¼Œä»£ç†æœåŠ¡å™¨å°†è¯·æ±‚åˆ†å‘ç»™äº†M1ï¼›å¦‚æœç”¨æˆ·å†æ¬¡è®¿é—®db1ï¼Œé‚£ä¹ˆä»£ç†æœåŠ¡å™¨è¿˜ä¼šå°†è¯·æ±‚å‘ç»™M1ï¼ŒM1ä¸Šåˆšåˆšè¯»è¿‡ä¸€ä¸ªdb1çš„æ–‡ä»¶ï¼Œä¼šäº§ç”Ÿç¼“å­˜ï¼Œæ‰€ä»¥å†è¯»ä¸€æ¬¡çš„æ—¶å€™é€Ÿåº¦å°±å¾ˆå¿«äº†ï¼›å¦‚æœè½®è¯¢æ²¡æœ‰ç»™åˆ°M1ï¼Œè€Œæ˜¯ç»™äº†S1ï¼Œé‚£ä¹ˆS1å°±è¦å†è¯»ä¸€æ¬¡db1çš„æ–‡ä»¶ï¼Œäº§ç”Ÿdb1çš„ç¼“å­˜ï¼›å¦‚æœç”¨æˆ·å†è®¿é—®ï¼Œå¯èƒ½è¿™æ¬¡åˆ†å‘ç»™äº†S2ï¼Œé‚£ä¹ˆS2ä¹Ÿè¦å†è¯»ä¸€æ¬¡db1çš„æ–‡ä»¶ï¼Œå¹¶äº§ç”Ÿdb1çš„ç¼“å­˜ã€‚æœ€ç»ˆçš„ç»“æœå°±æ˜¯å››å°æœºå™¨å°†ç›¸åŒçš„æ•°æ®éƒ½ç¼“å†²äº†ï¼Œæœ€ç»ˆå¯¼è‡´çš„é—®é¢˜å°±æ˜¯æˆ‘ä»¬çš„å†…å­˜ä¼šæœ‰æ‰€æµªè´¹ï¼Œå› ä¸ºå†…å­˜é‡Œé¢ç¼“å†²çš„æ˜¯ä¸€æ ·çš„æ•°æ®ã€‚è€Œæˆ‘ä»¬åç«¯æœ‰4ä¸ªåº“ï¼Œä¸å•å•æ˜¯db1ï¼Œè¿˜æœ‰db2ï¼Œ3ï¼Œ4ï¼Œç”¨æˆ·åœ¨è´Ÿè½½å‡è¡¡çš„è¿‡ç¨‹ä¸­ï¼Œæœ€ç»ˆå¯¼è‡´çš„ç»“æœæ˜¯å››å°æœåŠ¡å™¨å…¨éƒ¨æŠŠå››ä¸ªåº“çš„æ‰€æœ‰çš„è¡¨éƒ½å°è¯•åšç¼“å†²ï¼Œè¿™å››å°æœåŠ¡å™¨ä¸­æœ‰å¤§é‡çš„æ•°æ®æ˜¯é‡å¤çš„ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™æ˜¯ä¸€ç§éå¸¸å¤§çš„æµªè´¹ï¼Œæˆ‘ä»¬æƒ³å‡å°‘è¿™äº›æ€§èƒ½æ¶ˆè€—ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<p>åœ¨ç¬¬ä¸€å°æ•°æ®åªç¼“å†²db1ï¼Œç¬¬äºŒå°db2ï¼Œç¬¬ä¸‰å°db3ï¼Œç¬¬å››å°db4ï¼Œç”¨æˆ·è®¿é—®å“ªä¸ªåº“å°±åˆ†ç»™å“ªå°æœåŠ¡å™¨ï¼Œè¿™æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„æ–¹æ³•ã€‚è¿™æ ·çš„è¯ï¼Œèƒ½å¤Ÿä¿è¯ç”¨æˆ·å‘å‡ºè¯·æ±‚åèƒ½å¤Ÿè¾ƒå¿«åœ°è¿”å›ç»“æœï¼ŒæœåŠ¡å™¨çš„å†…å­˜ç¼“å†²å¾—åˆ°å……åˆ†çš„åˆ©ç”¨ã€‚ä¸å•å•æé«˜äº†æ€§èƒ½ï¼Œè¿˜èŠ‚çº¦äº†å†…å­˜ï¼Œé¿å…äº†æ•°æ®çš„é‡å¤ã€‚</p>
<p>ç›¸åŒçš„ç†å¿µï¼Œåˆšåˆšä¸¾çš„æ˜¯åº“çš„ä¾‹å­ï¼ŒåŒæ ·è¡¨ä¹ŸåŒæ ·é€‚ç”¨ï¼Œä¸åŒçš„æœåŠ¡å™¨ç¼“å†²ä¸åŒçš„è¡¨ã€‚</p>
<p>è¿™æ˜¯æˆ‘ä»¬å°†çš„åˆ†åº“ã€åˆ†è¡¨çš„åŠŸèƒ½ï¼Œè¿˜æœ‰ä¸€ä¸ªåˆ†ç‰‡ï¼ŒæŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ä¸¾ä¾‹è¯´æ˜ï¼šåªæœ‰t1ä¸€å¼ è¡¨ï¼Œå‘ç»™è°å‘¢ï¼Ÿå››å°æœºå™¨è½®è¯¢åœ°å‘ï¼Œé‚£ä¹ˆt1è¡¨çš„å†…å®¹è¢«å››å°æœºå™¨å…¨éƒ¨ç¼“å†²ä¸‹æ¥ï¼Œåˆä¼šæµªè´¹å†…å­˜ã€‚è€Œä¸”æœºå™¨æ•°é‡è¶Šå¤šï¼Œæ€§èƒ½æµªè´¹è¶Šå¤§ã€‚é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>å¯ä»¥è¿™ä¹ˆåšï¼š</p>
<table>
<thead>
<tr>
<th align="left">æœåŠ¡å™¨</th>
<th align="left">ç¼“å†²</th>
<th align="left"></th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">m1</td>
<td align="left">1</td>
<td align="left">5</td>
<td align="left">9</td>
</tr>
<tr>
<td align="left">m2</td>
<td align="left">2</td>
<td align="left">6</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">s1</td>
<td align="left">3</td>
<td align="left">7</td>
<td align="left">11</td>
</tr>
<tr>
<td align="left">s2</td>
<td align="left">4</td>
<td align="left">8</td>
<td align="left">12</td>
</tr>
</tbody></table>
<p>æŒ‰ç…§è¡Œæ¥åˆ†å‘ï¼Œè¿™æ ·çš„è¯é—®é¢˜å°±è§£å†³æ‹‰ï¼è¿™å°±æ˜¯åˆ†ç‰‡ï¼Œè¿™æ ·å°±ä¸ä¼šæµªè´¹æ€§èƒ½ï¼Œæ•°æ®å°±ä¸ä¼šé‡å¤æ‹‰ï¼</p>
<blockquote>
<p>sqlè·¯ç”±å¹¶å‘æŸ¥è¯¢</p>
</blockquote>
<p>æ¡ˆä¾‹ï¼šå¦‚æœç”¨æˆ·è¦æ‰§è¡Œ<code>select * from t1 where id=1 or id=8;</code>æ€ä¹ˆåŠå‘¢ï¼Ÿä»£ç†æœåŠ¡å™¨æ˜¯åˆ†å‘ç»™m1è¿˜æ˜¯s2å‘¢ï¼Ÿ</p>
<p>å½“è¿™æ¡è¯­å¥ç»è¿‡ä»£ç†æœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¢«ä¸€åˆ†ä¸ºäºŒï¼Œä¸€æ¡æ˜¯<code>select * from t1 where id=1;</code>ä¸€æ¡æ˜¯<code>select * from t1 where id=8;</code> ç„¶ååŒæ—¶å‘ç»™ä¸¤å°ä¸åŒçš„æœåŠ¡å™¨ï¼Œå°†æŸ¥è¯¢ç»“æœå–å‡ºæ¥ï¼Œåˆå¹¶ä¸€ä¸‹ï¼Œç„¶åè¿”å›ç»™å‰ç«¯ã€‚è¿™ä¸ªå«åšsqlè·¯ç”±å¹¶å‘æŸ¥è¯¢ã€‚</p>
<h4 id="ç›®å‰å¸‚é¢ä¸Šçš„æ•°æ®åº“ä»£ç†æœåŠ¡å™¨"><a href="#ç›®å‰å¸‚é¢ä¸Šçš„æ•°æ®åº“ä»£ç†æœåŠ¡å™¨" class="headerlink" title="ç›®å‰å¸‚é¢ä¸Šçš„æ•°æ®åº“ä»£ç†æœåŠ¡å™¨"></a>ç›®å‰å¸‚é¢ä¸Šçš„æ•°æ®åº“ä»£ç†æœåŠ¡å™¨</h4><p>æˆ‘ä»¬ä¼šå»è®²ç›®å‰å¸‚é¢ä¸Šçš„ä¸€äº›æ•°æ®åº“ä»£ç†æœåŠ¡å™¨ã€‚ç›®å‰æ•°æ®åº“ä»£ç†å¥½ç”¨çš„çœŸå¿ƒæ¯”è¾ƒå°‘ï¼Œéå¸¸å°‘ï¼ŒåŒ…æ‹¬mysqlå®˜æ–¹ä¹Ÿå¼€å‘è¿‡ä»£ç†ï¼Œéå¸¸åœ°çƒ‚ï¼Œç ´ä¸œè¥¿ï¼Œå¼€å‘äº†å¥½å¤šå¹´äº†ï¼Œä¸€ç›´å¾ˆçƒ‚ï¼›ç„¶åå‘¢ï¼Œæ·˜å®æœ‰è‡ªå·±çš„ä»£ç†ï¼Œä½†æ²¡æœ‰å¼€æºå‡ºæ¥ï¼Œæˆ–è€…è¯´å¼€æºå‡ºæ¥äº†ä¸èƒ½ç”¨ï¼Œä»–çš„ä»£ç†è¦ç”¨åœ¨ä»–ä»¬çš„é‚£å¥—åŸºç¡€æ¶æ„ä¸Šï¼Œè€ŒåŸºç¡€æ¶æ„æ²¡å¼€æºå‡ºæ¥ï¼Œä»…ç¨‹åºå¼€æºå‡ºæ¥æ²¡ç”¨ï¼Œæ²¡æœ‰è¿è¡Œç¯å¢ƒï¼›å¥‡è™360å¯¹mysql-proxyåšäº†æ›´æ”¹ï¼Œæ€§èƒ½åšäº†ä¼˜åŒ–ï¼Œä¼˜åŒ–ä¸‹æ¥çš„æ•ˆæœè¿˜å¯ä»¥ï¼Œæ¯”å®˜æ–¹å¥½å¾ˆå¤šï¼Œè¿è¡Œçš„ç¯å¢ƒè™½ç„¶å¼€æºå‡ºæ¥äº†ï¼Œä½†æ˜¯ä¸èƒ½åœ¨el7ä¸Šè·‘ï¼Œel6ã€el5å¯ä»¥è·‘ï¼Œè¿™ä¸œè¥¿æ²¡åŠæ³•è®²ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€ä¸‹ï¼Œä»¥åå¤§å®¶åšä»£ç†ä¸è¦ç”¨el7ï¼Œç”¨el5ã€el6å¯ä»¥è·‘ç€è¯•è¯•çœ‹ï¼›ç„¶åä¼šå»è®²å¦å¤–ä¸€ä¸ªä»£ç†mycatï¼Œå‰ç”Ÿæ˜¯é˜¿é‡Œå·´å·´çš„æ•°æ®åº“ä»£ç†ï¼Œé˜¿é‡Œå·´å·´å’Œæ·˜å®ç”¨çš„æ•°æ®åº“ä»£ç†æ˜¯ä¸¤å¥—ç¨‹åºï¼Œé˜¿é‡Œå·´å·´ä¹‹å‰çš„æ•°æ®åº“ä»£ç†å„ç§å‘ï¼Œå‘åˆ°ä»–çš„å¼€å‘äººå‘˜å®åœ¨å—ä¸äº†äº†ï¼Œç„¶åå°±è‡ªå·±ç»„ç»‡äº†ä¸€æ‰¹äººï¼Œå¼€å§‹é‡å†™ä»£ç ï¼Œå°†å„ç§å‘è¡¥æ‰ï¼Œé‡å†™å‡ºæ¥çš„è¿™ä¸ªå¼€æºäº§å“å‘¢å°±å«mycatï¼Œæœ‰ç†ç”±ç›¸ä¿¡mycatä»¥åä¼šè¶Šæ¥è¶Šå¥½ï¼Œå› ä¸ºä»–æœ‰ä¸€ä¸ªéå¸¸åšå®çš„åŸºç¡€ï¼Œå°±æ˜¯ä»–æ˜¯æ‹¿é˜¿é‡Œå·´å·´çš„ç³»ç»Ÿï¼Œç»è¿‡çº¿ä¸Šç”Ÿäº§ç¯å¢ƒéªŒè¯çš„ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œæ‹¿ä»–æ¥æ”¹çš„ï¼Œè€Œä¸”è¿˜è¡¥å…¨äº†ä»–å¾ˆå¤šçš„ä¸è¶³ï¼ŒæŠŠä»–å˜æˆäº†ä¸€ä¸ªä¼ä¸šçº§çš„äº§å“ï¼Œç›®å‰mycatçš„ç”¨æˆ·å¹¶ä¸ç®—å¤šï¼Œä½†æ˜¯ä»–çš„å¸‚åœºä»½é¢ä¸€ç›´åœ¨é€æ­¥å¢åŠ ï¼Œä»å¼€æºé¢†åŸŸçš„ä»£ç†æœåŠ¡å™¨æ¥è®²ï¼Œè¿™ä¸ªmycatè¿˜æ˜¯éå¸¸ä¸é”™çš„ã€‚</p>
<p>æˆ‘ä»¬ä¼šä¸¾ä¸¤ä¸ªä¾‹å­ï¼Œmysqlå®˜æ–¹çš„ mysql-proxyï¼Œå…¶å®æˆ‘æ˜¯ä¸æƒ³è®²mysqlå®˜æ–¹çš„ï¼Œè®²è¿™ä¸œè¥¿ä¹Ÿæ²¡å¤ªå¤§ç”¨å¤„ï¼Œä»–æœ‰äº›è‡ªå·±çš„ç¼ºç‚¹ï¼Œå½“ç„¶äº†ï¼Œè¿™äº›ç¼ºç‚¹å¹¶ä¸æ˜¯ä¸èƒ½å…‹æœçš„ï¼Œå¯ä»¥è§£å†³ï¼Œè§£å†³çš„å‰ææ˜¯ä½ éœ€è¦ä¼šå¼€å‘ï¼Œä»–é‡Œé¢æœ‰ä¸€äº›ä»£ç è¦ä½ è‡ªå·±æ”¹ï¼Œå› ä¸ºä»–å®˜æ–¹çš„ä»£ç æ¯”è¾ƒçƒ‚ã€‚å¦ä¸€ä¸ªå°±æ˜¯mycatã€‚å»å®ç°ä¸¤ä¸ªåŠŸèƒ½ï¼Œè´Ÿè½½å‡è¡¡å’Œè¯»å†™åˆ†ç¦»ã€‚</p>
<table>
<thead>
<tr>
<th align="left">DBPROXY</th>
<th align="left"></th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Mysql-proxy</td>
<td align="left">luaè„šæœ¬</td>
<td align="left">é­”å…½ä¸–ç•Œ</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/alibaba/tb_tddl/wiki/TDDL-dynamic-datasource-%E5%85%A5%E9%97%A8%E4%B8%8E%E4%BD%BF%E7%94%A8" target="_blank" rel="noopener">tddl</a></td>
<td align="left">æ·˜å®çš„æ•°æ®åº“ä»£ç†</td>
<td align="left">æ²¡æœ‰è¿è¡Œç¯å¢ƒ</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/Qihoo360/Atlas/wiki/Atlas%E7%9A%84%E5%AE%89%E8%A3%85" target="_blank" rel="noopener">atlas</a></td>
<td align="left">å¥‡è™360çš„æ•°æ®åº“ä»£ç†[ å¸Œè…Šç¥è¯è¢«ç½šä½œè‹¦å½¹çš„å¤§åŠ›ç¥ ]</td>
<td align="left">rhel7ä¸èƒ½ç”¨</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/alibaba/cobar" target="_blank" rel="noopener">cobar</a></td>
<td align="left">é˜¿é‡Œå·´å·´</td>
<td align="left">æµ‹è¯•ç‰ˆä¸èƒ½ç”¨</td>
</tr>
<tr>
<td align="left">mycat</td>
<td align="left">é˜¿é‡Œå·´å·´äºŒæ¬¡å¼€å‘</td>
<td align="left">å•†ä¸šå‹äº§å“</td>
</tr>
</tbody></table>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬é¡¹ç›®çš„ä¸€ä¸ªç½‘ç»œæ¶æ„ã€‚</p>
<p><img src="pic/galera.jpg" alt="DBPROXY"></p>
<h5 id="mysql-proxy"><a href="#mysql-proxy" class="headerlink" title="mysql-proxy"></a>mysql-proxy</h5><p><img src="pic/12-mysql-proxy.jpg" alt="mysql-proxy"></p>
<blockquote>
<p>æ•°æ®åº“ä¸­é—´ä»¶ mysql-proxy 0.8.5 å®ç° è¯»å†™åˆ†ç¦»è´Ÿè½½å‡è¡¡</p>
</blockquote>
<blockquote>
<blockquote>
<p>1.ç½‘ç»œæ‹“æ‰‘è§„åˆ’</p>
</blockquote>
</blockquote>
<table>
<thead>
<tr>
<th align="left">æœåŠ¡å™¨</th>
<th align="left">IP</th>
<th align="left">software</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mastera0</td>
<td align="left">172.25.0.11</td>
<td align="left">mariadb5.5</td>
</tr>
<tr>
<td align="left">masterb0</td>
<td align="left">172.25.0.12</td>
<td align="left">mariadb5.5</td>
</tr>
<tr>
<td align="left">slavea0</td>
<td align="left">172.25.0.13</td>
<td align="left">mariadb5.5</td>
</tr>
<tr>
<td align="left">slaveb0</td>
<td align="left">172.25.0.14</td>
<td align="left">mariadb5.5</td>
</tr>
<tr>
<td align="left">dbproxy0</td>
<td align="left">172.25.0.15</td>
<td align="left">mysql-proxy0.8.5</td>
</tr>
</tbody></table>
<blockquote>
<blockquote>
<p>2.å®‰è£…è½¯ä»¶</p>
</blockquote>
</blockquote>
<p>1ï¼‰æ— å¯†ç sshç™»é™†è™šæ‹Ÿæœº</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line">for i in 10 11 12 13 14 15 ;do ssh-copy-id root@172.25.0.$i ;done</span><br></pre></td></tr></table></figure>

<p>2ï¼‰å…³é—­selinux,firewalld</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for i in 10 11 12 13 14 15 ;\</span><br><span class="line">do ssh root@172.25.0.$i \</span><br><span class="line">\"sed -i '/^SELINUX/s/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config;\</span><br><span class="line">grep -v "^#" /etc/selinux/config;\</span><br><span class="line">systemctl stop firewalld \";done</span><br></pre></td></tr></table></figure>

<p>3ï¼‰éœ€è¦å®‰è£…çš„è½¯ä»¶åŒ…<code>wgetï¼Œnet-tools,rpc-bind,nfs-utils,vim</code></p>
<p><code>for i in 10 11 12 13 14 ;do ssh root@172.25.0.$i &quot;yum install -y wget net-tools rpc-bind nfs-utils vim &quot;;done</code></p>
<p>4ï¼‰æŸ¥çœ‹ipåœ°å€<code>ip addr</code></p>
<p>5ï¼‰ä¿®æ”¹yumæºï¼Œæ ¹æ®å®é™…éœ€æ±‚æ¥</p>
<p>ä»æœåŠ¡å™¨ä¸Šä¸‹è½½åˆ°/etc/yum.repos.d/ç›®å½•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /etc/yum.repos.d &amp;&amp; \</span><br><span class="line">wget http://classroom.example.com/materials/mariadb-10.2.repo;\</span><br><span class="line">wget http://classroom.example.com/materials/mysql-5.7.repo;\</span><br><span class="line">wget http://classroom.example.com/materials/thirdpart.repo</span><br><span class="line"></span><br><span class="line">yum clean all &amp;&amp; yum makecache</span><br></pre></td></tr></table></figure>

<p>6) å®‰è£…mariadb-serverï¼Œå¹¶å¯åŠ¨æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for i in 11 12 13 14 ;do ssh root@172.25.0.$i "yum install -y mariadb-server" ;done</span><br><span class="line">for i in 11 12 13 14 ;do ssh root@172.25.0.$i "systemctl start mariadb" ;done</span><br></pre></td></tr></table></figure>

<p>7) å®‰è£…ä¾èµ–åŒ…</p>
<p><code>yum install gcc* lua lua-devel libevent libevent-devel glib2 glib2-devel pkgconfig mariadb-devel flex</code></p>
<p>8) å®‰è£…mysql-proxy</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget http://172.25.254.254/content/courses/db100/rhel7.2/materials/mysql-proxy-0.8.5.tar.gz</span><br><span class="line">tar -zxf mysql-proxy-0.8.5.tar.gz</span><br><span class="line">cd mysql-proxy-0.8.5</span><br><span class="line">./configure --prefix=/usr/local/mysql-proxy</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>3.é…ç½®</p>
</blockquote>
</blockquote>
<p>è®¾ç½®å¯†ç </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for i in 11 12 13 14 ;do ssh root@172.25.0.$i "mysqladmin -uroot password uplooking" ;done</span><br></pre></td></tr></table></figure>

<p>1ï¼‰mastera0</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -uroot -puplooking</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> create database db1;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use db1;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> create table t1 (num int not null);</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> insert into t1 values (1);</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> grant all on db1.* to <span class="string">'mysql-proxy'</span>@172.25.0.15 identified by <span class="string">'uplooking'</span>;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> flush privileges;</span></span><br></pre></td></tr></table></figure>

<p>2ï¼‰slavea0</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -uroot -puplooking</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> create database db1;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use db1;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> create table t1 (num int not null);</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> insert into t1 values (2);</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> grant all on db1.* to <span class="string">'mysql-proxy'</span>@172.25.0.15 identified by <span class="string">'uplooking'</span>;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> flush privileges;</span></span><br></pre></td></tr></table></figure>

<p>3) è¿›å…¥mysql-proxyçš„å®¶ç›®å½•/usr/local/mysql-proxy</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/mysql-proxy/;ls</span><br><span class="line"><span class="meta">#</span><span class="bash"> bin  include  lib  libexec  share</span></span><br><span class="line">cd bin;ls</span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql-binlog-dump  mysql-myisam-dump  mysql-proxy</span></span><br><span class="line">./mysql-proxy --help-all---ã€‹æŸ¥çœ‹å‘½ä»¤å¸®åŠ©</span><br><span class="line">./mysql-proxy -P 172.25.0.15:3306 -b 172.25.0.11:3306 -b 172.25.0.13:3306 &amp;</span><br><span class="line">netstat -ntalp|grep 3306</span><br><span class="line"><span class="meta">#</span><span class="bash"> tcp        0      0 172.25.0.15:3306        0.0.0.0:*               LISTEN      24483/./mysql-proxy</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>4.æµ‹è¯•</p>
</blockquote>
</blockquote>
<p>å®¢æˆ·ç«¯ 172.25.0.10</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -u'mysql-proxy' -puplooking -h172.25.0.15</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use db1;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> select * from t1;</span></span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">|   1 |</span><br><span class="line">+-----+</span><br></pre></td></tr></table></figure>

<p>å°†mastera0çš„æœåŠ¡å…³é—­åï¼Œå†æŸ¥çœ‹è¡¨1ä¸­çš„å†…å®¹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop mariadb</span><br><span class="line"></span><br><span class="line">mysql -u'mysql-proxy' -puplooking -h172.25.0.15</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> select * from t1;</span></span><br><span class="line">ERROR 2013 (HY000): Lost connection to MySQL server during query</span><br><span class="line">MariaDB [db1]&gt; select * from t1;</span><br><span class="line">ERROR 2006 (HY000): MySQL server has gone away</span><br><span class="line">No connection. Trying to reconnect...</span><br><span class="line">Connection id:    5</span><br><span class="line">Current database: db1</span><br><span class="line"></span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">|   2 |</span><br><span class="line">+-----+</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>5.é…ç½®</p>
</blockquote>
</blockquote>
<p>1ï¼‰å°†luaè„šæœ¬å¤åˆ¶åˆ°mysql-proxyçš„å®¶ç›®å½•</p>
<p><code>cp ~/mysql-proxy-0.8.5/lib/rw-splitting.lua /usr/local/mysql-proxy/</code></p>
<p>2) mastera0è¯»å†™ï¼Œslavea0åªè¯»ï¼Œé€šè¿‡luaè„šæœ¬</p>
<p><code>./mysql-proxy -P 172.25.0.15:3306 -b 172.25.0.11:3306 -r 172.25.0.13:3306 -s /usr/local/mysql-proxy/rw-splitting.lua</code></p>
<blockquote>
<blockquote>
<p>6.æµ‹è¯•</p>
</blockquote>
</blockquote>
<p>1ï¼‰å®¢æˆ·ç«¯ä¸Šç™»é™†åæ’å…¥33ï¼›</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -u'mysql-proxy' -puplooking -h172.25.0.15</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use db1;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> insert into t1 values (33);</span></span><br></pre></td></tr></table></figure>

<p>2ï¼‰mastera0æŸ¥çœ‹t1è¡¨ï¼›</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -u'mysql-proxy' -puplooking -h172.25.0.15</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use db1;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> select * from t1;</span></span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">|   1 |</span><br><span class="line">|  33 |</span><br><span class="line">+-----+</span><br></pre></td></tr></table></figure>

<p>3ï¼‰slavea0æŸ¥çœ‹t1ï¼›</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -u'mysql-proxy' -puplooking -h172.25.0.15</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> select * from t1;</span></span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">|   2 |</span><br><span class="line">+-----+</span><br></pre></td></tr></table></figure>

<p>4ï¼‰å®¢æˆ·ç«¯æŸ¥çœ‹t1è¡¨ï¼›</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -u'mysql-proxy' -puplooking -h172.25.0.15</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> select * from t1;</span></span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">|   2 |</span><br><span class="line">+-----+</span><br></pre></td></tr></table></figure>



<h5 id="mycat"><a href="#mycat" class="headerlink" title="mycat"></a>mycat</h5><p>2013 å¹´é˜¿é‡Œçš„ Cobar åœ¨ç¤¾åŒºä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºç°å­˜åœ¨ä¸€äº›æ¯”è¾ƒä¸¥é‡çš„é—®é¢˜,åŠå…¶ä½¿ç”¨é™åˆ¶ï¼Œç»è¿‡ Mycat ç¬¬ä¸€æ¬¡æ”¹è‰¯,ç¬¬ä¸€ä»£æ”¹è‰¯ç‰ˆâ€”â€”Mycat è¯ç”Ÿã€‚ Mycat å¼€æºä¹‹å,ä¸€äº› Cobar çš„ç”¨æˆ·å‚ä¸äº† Mycat çš„å¼€å‘,æœ€ç»ˆ Mycat å‘å±•æˆä¸ºä¸€ä¸ªç”±ä¼—å¤šè½¯ä»¶å…¬å¸çš„å®åŠ›æ´¾æ¶æ„å¸ˆå’Œèµ„æ·±å¼€å‘äººå‘˜ç»´æŠ¤çš„ç¤¾åŒºå‹å¼€æºè½¯ä»¶ã€‚</p>
<ul>
<li>Mycat æèµ åœ°å€ :<a href="http://www.mycat.io/donate.html" target="_blank" rel="noopener">http://www.mycat.io/donate.html</a></li>
<li>Mycat å®˜ç½‘ç½‘ç«™:<a href="http://www.mycat.io/" target="_blank" rel="noopener">http://www.mycat.io/</a></li>
<li>Mycat æºç :<a href="https://github.com/MyCATApache/Mycat-Server" target="_blank" rel="noopener">https://github.com/MyCATApache/Mycat-Server</a></li>
<li>Mycat ä¸‹è½½åœ°å€:<a href="https://github.com/MyCATApache/Mycat-download" target="_blank" rel="noopener">https://github.com/MyCATApache/Mycat-download</a></li>
</ul>
<p><img src="pic/13-mycat.jpg" alt="mycat"></p>
<blockquote>
<blockquote>
<p>1.ç½‘ç»œæ‹“æ‰‘è§„åˆ’</p>
</blockquote>
</blockquote>
<table>
<thead>
<tr>
<th align="left">æœåŠ¡å™¨</th>
<th align="left">IP</th>
<th align="left">software</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mastera0</td>
<td align="left">172.25.0.11</td>
<td align="left">mariadb5.5</td>
</tr>
<tr>
<td align="left">masterb0</td>
<td align="left">172.25.0.12</td>
<td align="left">mariadb5.5</td>
</tr>
<tr>
<td align="left">slavea0</td>
<td align="left">172.25.0.13</td>
<td align="left">mariadb5.5</td>
</tr>
<tr>
<td align="left">slaveb0</td>
<td align="left">172.25.0.14</td>
<td align="left">mariadb5.5</td>
</tr>
<tr>
<td align="left">dbproxy0</td>
<td align="left">172.25.0.15</td>
<td align="left">mysql-proxy0.8.5</td>
</tr>
</tbody></table>
<blockquote>
<blockquote>
<p>2.å®‰è£…è½¯ä»¶</p>
</blockquote>
</blockquote>
<p><strong>å®‰è£…jdkè½¯ä»¶</strong> å› ä¸ºmycatæ˜¯ç”¨javaè¯­è¨€ç¼–å†™çš„,å¹¶å®£å‘Šå®¶ç›®å½•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> wget http://172.25.254.254/content/class/mariadb/mycat/jdk-7u79-linux-x64.rpm</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> wget http://172.25.254.254/content/class/mariadb/mycat/Mycat-server-1.5.1-RELEASE-20160328130228-linux.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rpm -ivh jdk-7u79-liunux-x64.rpm</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rpm -ql jdk|head</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> JAVA_HOME=<span class="string">'/usr/java/jdk1.7.0_79'</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸´æ—¶ç”Ÿæ•ˆï¼Œå¦‚æœè¦æ°¸ä¹…ç”Ÿæ•ˆéœ€è¦å†™åˆ°bashå¯åŠ¨è„šæœ¬ä¸­ä¾‹å¦‚/etc/bashrc</p>
<p><strong>å®‰è£…mycat</strong> ç›´æ¥è§£å‹ç¼©å³å¯ä½¿ç”¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">*************************************</span><br><span class="line">bin	mycatå¯åŠ¨è„šæœ¬</span><br><span class="line">conf	schema.xml	æ•°æ®åº“é…ç½®</span><br><span class="line">	    server.xml	é€»è¾‘åº“é…ç½®</span><br><span class="line">*************************************</span><br><span class="line">[root@dbproxy0 ~]# tar xf Mycat-server-1.5.1-RELEASE-20160328130228-linux.tar.gz -C /usr/local</span><br><span class="line">[root@dbproxy0 ~]# cd /usr/local;ls</span><br><span class="line">[root@dbproxy0 local]# cd mycat;ll</span><br><span class="line">[root@dbproxy0 mycat]# chmod 755 * -R</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>4.é…ç½®æ–‡ä»¶</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@dbproxy0 mycat]# vim conf/schema.xml</span><br><span class="line">[root@dbproxy0 mycat]# vim conf/server.xml</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server.xml</span><br><span class="line">#ç”¨æˆ·åã€å¯†ç ã€é€»è¾‘åº“åéœ€è¦è‡ªå®šä¹‰</span><br><span class="line">&lt;user name&#x3D;&quot;test&quot;&gt;</span><br><span class="line">	&lt;property name&#x3D;&quot;password&quot;&gt;test&lt;&#x2F;property&gt;   æ³¨æ„ï¼šæ­¤å¤„testæ˜¯å¯†ç </span><br><span class="line">	&lt;property name&#x3D;&quot;schemas&quot;&gt;TESTDB&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;user&gt;</span><br><span class="line">&lt;system&gt;</span><br><span class="line">#æ–°å¢æœåŠ¡ç«¯å£</span><br><span class="line">	&lt;property name&#x3D;&quot;servicePort&quot;&gt;3306&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;system&gt;</span><br><span class="line">****************************</span><br><span class="line">&lt;mycat:schema xmlns:mycat&#x3D;&quot;http:&#x2F;&#x2F;org.opencloudb&#x2F;&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;schema name&#x3D;&quot;TESTDB&quot; checkSQLschema&#x3D;&quot;false&quot; sqlMaxLimit&#x3D;&quot;100&quot;&gt;</span><br><span class="line">                &lt;!-- auto sharding by id (long) --&gt;</span><br><span class="line">                &lt;table name&#x3D;&quot;travelrecord&quot; dataNode&#x3D;&quot;dn1,dn2,dn3&quot; rule&#x3D;&quot;auto-sharding-long&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;table name&#x3D;&quot;t1&quot; dataNode&#x3D;&quot;dn1&quot; &#x2F;&gt;</span><br><span class="line">                &lt;!-- global table is auto cloned to all defined data nodes ,so can join</span><br><span class="line">                        with any table whose sharding node is in the same data node --&gt;</span><br><span class="line">                &lt;table name&#x3D;&quot;company&quot; primaryKey&#x3D;&quot;ID&quot; type&#x3D;&quot;global&quot; dataNode&#x3D;&quot;dn1,dn2,dn3&quot; &#x2F;&gt;</span><br><span class="line">                &lt;table name&#x3D;&quot;goods&quot; primaryKey&#x3D;&quot;ID&quot; type&#x3D;&quot;global&quot; dataNode&#x3D;&quot;dn1,dn2&quot; &#x2F;&gt;</span><br><span class="line">                &lt;!-- random sharding using mod sharind rule --&gt;</span><br><span class="line">                &lt;table name&#x3D;&quot;hotnews&quot; primaryKey&#x3D;&quot;ID&quot; dataNode&#x3D;&quot;dn1,dn2,dn3&quot;</span><br><span class="line">                        rule&#x3D;&quot;mod-long&quot; &#x2F;&gt;</span><br><span class="line">                &lt;!-- &lt;table name&#x3D;&quot;dual&quot; primaryKey&#x3D;&quot;ID&quot; dataNode&#x3D;&quot;dnx,dnoracle2&quot; type&#x3D;&quot;global&quot;</span><br><span class="line">                        needAddLimit&#x3D;&quot;false&quot;&#x2F;&gt; &lt;table name&#x3D;&quot;worker&quot; primaryKey&#x3D;&quot;ID&quot; dataNode&#x3D;&quot;jdbc_dn1,jdbc_dn2,jdbc_dn3&quot;</span><br><span class="line">                        rule&#x3D;&quot;mod-long&quot; &#x2F;&gt; --&gt;</span><br><span class="line">                &lt;table name&#x3D;&quot;employee&quot; primaryKey&#x3D;&quot;ID&quot; dataNode&#x3D;&quot;dn1,dn2&quot;</span><br><span class="line">                        rule&#x3D;&quot;sharding-by-intfile&quot; &#x2F;&gt;</span><br><span class="line">                &lt;table name&#x3D;&quot;customer&quot; primaryKey&#x3D;&quot;ID&quot; dataNode&#x3D;&quot;dn1,dn2&quot;</span><br><span class="line">                        rule&#x3D;&quot;sharding-by-intfile&quot;&gt;</span><br><span class="line">                        &lt;childTable name&#x3D;&quot;orders&quot; primaryKey&#x3D;&quot;ID&quot; joinKey&#x3D;&quot;customer_id&quot;</span><br><span class="line">                                parentKey&#x3D;&quot;id&quot;&gt;</span><br><span class="line">                                &lt;childTable name&#x3D;&quot;order_items&quot; joinKey&#x3D;&quot;order_id&quot;</span><br><span class="line">                                        parentKey&#x3D;&quot;id&quot; &#x2F;&gt;</span><br><span class="line">                        &lt;&#x2F;childTable&gt;</span><br><span class="line">			&lt;childTable name&#x3D;&quot;customer_addr&quot; primaryKey&#x3D;&quot;ID&quot; joinKey&#x3D;&quot;customer_id&quot;</span><br><span class="line">                                parentKey&#x3D;&quot;id&quot; &#x2F;&gt;</span><br><span class="line">                &lt;&#x2F;table&gt;</span><br><span class="line">                &lt;!-- &lt;table name&#x3D;&quot;oc_call&quot; primaryKey&#x3D;&quot;ID&quot; dataNode&#x3D;&quot;dn1$0-743&quot; rule&#x3D;&quot;latest-month-calldate&quot;</span><br><span class="line">                        &#x2F;&gt; --&gt;</span><br><span class="line">        &lt;&#x2F;schema&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;dataNode name&#x3D;&quot;dn1&quot; dataHost&#x3D;&quot;localhost1&quot; database&#x3D;&quot;db1&quot; &#x2F;&gt;</span><br><span class="line">&lt;dataHost name&#x3D;&quot;localhost1&quot; maxCon&#x3D;&quot;1000&quot; minCon&#x3D;&quot;10&quot; balance&#x3D;&quot;3&quot;</span><br><span class="line">                writeType&#x3D;&quot;0&quot; dbType&#x3D;&quot;mysql&quot; dbDriver&#x3D;&quot;native&quot; switchType&#x3D;&quot;1&quot;  slaveThreshold&#x3D;&quot;100&quot;&gt;</span><br><span class="line">                &lt;heartbeat&gt;select user()&lt;&#x2F;heartbeat&gt;</span><br><span class="line">                &lt;!-- can have multi write hosts --&gt;</span><br><span class="line">                &lt;writeHost host&#x3D;&quot;mastera&quot; url&#x3D;&quot;172.25.0.11:3306&quot; user&#x3D;&quot;mysqlproxy&quot;</span><br><span class="line">                        password&#x3D;&quot;uplooking&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;readHost host&#x3D;&quot;slavea&quot; url&#x3D;&quot;172.25.0.13:3306&quot; user&#x3D;&quot;mysqlproxy&quot;</span><br><span class="line">                        password&#x3D;&quot;uplooking&quot; &#x2F;&gt;</span><br><span class="line">                &lt;readHost host&#x3D;&quot;slaveb&quot; url&#x3D;&quot;172.25.0.14:3306&quot; user&#x3D;&quot;mysqlproxy&quot;</span><br><span class="line">                        password&#x3D;&quot;uplooking&quot; &#x2F;&gt;</span><br><span class="line">                &lt;&#x2F;writeHost&gt;</span><br><span class="line"></span><br><span class="line">                &lt;writeHost host&#x3D;&quot;masterb&quot; url&#x3D;&quot;172.25.0.12:3306&quot; user&#x3D;&quot;mysqlproxy&quot;</span><br><span class="line">                        password&#x3D;&quot;uplooking&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;readHost host&#x3D;&quot;slavea&quot; url&#x3D;&quot;172.25.0.13:3306&quot; user&#x3D;&quot;mysqlproxy&quot;</span><br><span class="line">                        password&#x3D;&quot;uplooking&quot; &#x2F;&gt;</span><br><span class="line">                &lt;readHost host&#x3D;&quot;slaveb&quot; url&#x3D;&quot;172.25.0.14:3306&quot; user&#x3D;&quot;mysqlproxy&quot;</span><br><span class="line">                        password&#x3D;&quot;uplooking&quot; &#x2F;&gt;</span><br><span class="line">                &lt;&#x2F;writeHost&gt;</span><br><span class="line">&lt;&#x2F;dataHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;mycat:schema&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>5ï¼‰å¯åŠ¨æœåŠ¡</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@dbproxy0 mycat]# bin/mycat start</span><br><span class="line">[root@dbproxy0 mycat]# netstat -luntp|grep tcp</span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1190/sshd           </span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1853/master         </span><br><span class="line">tcp        0      0 127.0.0.1:32000         0.0.0.0:*               LISTEN      3168/java           </span><br><span class="line">tcp6       0      0 :::3306                 :::*                    LISTEN      3168/java           </span><br><span class="line">tcp6       0      0 :::9066                 :::*                    LISTEN      3168/java           </span><br><span class="line">tcp6       0      0 :::46764                :::*                    LISTEN      3168/java           </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      1190/sshd           </span><br><span class="line">tcp6       0      0 ::1:25                  :::*                    LISTEN      1853/master         </span><br><span class="line">tcp6       0      0 :::1984                 :::*                    LISTEN      3168/java           </span><br><span class="line">tcp6       0      0 :::43493                :::*                    LISTEN      3168/java</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>6ï¼‰æµ‹è¯•</p>
</blockquote>
</blockquote>
<p>mycatçš„masteræ¯æ¬¡ä¹‹èƒ½ç”¨ä¸€ä¸ªæ¥å†™ï¼Œä»¥è¿™ç§æ–¹æ³•æ¥é˜²æ­¢ä¸¤å°masteräº§ç”Ÿå†²çªã€‚<br>å½“å…¶ä¸­ä¸€å°masterå®•æœºä»¥åï¼Œå¯ä»¥è‡ªåŠ¨åˆ‡æ¢ã€‚</p>
<p><strong>balance å±æ€§</strong></p>
<p>è´Ÿè½½å‡è¡¡ç±»å‹æœ‰ 3 ç§:</p>
<ol>
<li>balance=â€0â€, masterå¯è¯»å¯å†™ï¼Œslaveä¸ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯ä¸å¯åŠ¨è¯»å†™åˆ†ç¦»</li>
<li>balance=â€1â€,masterå¯è¯»å¯å†™ï¼Œslaveåªè¯»ï¼›stand by writeHost å‚ä¸ select è¯¢å¥ç™¿è´Ÿè½½å‡è¡¡</li>
<li>balance=â€2â€,masterå¯è¯»å¯å†™ï¼Œslaveåªè¯»ï¼›æ‰€æœ‰è¯»æ“ä½œéƒ½éšæœºçš„åœ¨ masterå’Œslaveä¸Šåˆ†é…ã€‚</li>
<li>balance=â€3â€,masteråªå†™ï¼Œslaveåªè¯»ï¼›1.4ç‰ˆæœ¬ä»¥åæœ‰</li>
</ol>
<p><strong>switchType å±æ€§</strong></p>
<ul>
<li>-1 è¡¨ç¤ºä¸è‡ªåŠ¨åˆ‡æ¢</li>
<li>1 é»˜è®¤å€¼,è‡ªåŠ¨åˆ‡æ¢</li>
<li>2 åŸºäº MySQL ä¸»ä»åŒæ­¥çš„çŠ¶æ€å†³å®šæ˜¯å¦åˆ‡æ¢</li>
</ul>
<p><strong>æ›´å¤šå†…å®¹</strong> è¯·æŸ¥çœ‹ã€ŠMycat æƒå¨æŒ‡å—ã€‹</p>
<h3 id="å®æˆ˜é¡¹ç›®"><a href="#å®æˆ˜é¡¹ç›®" class="headerlink" title="å®æˆ˜é¡¹ç›®"></a>å®æˆ˜é¡¹ç›®</h3><blockquote>
<p>å®æˆ˜é¡¹ç›®1ï¼š æ•°æ®åº“ä¸­é—´ä»¶ mysql-proxy 0.8.5 å®ç° è¯»å†™åˆ†ç¦»è´Ÿè½½å‡è¡¡ï¼Œåç«¯æ•°æ®åº“æœåŠ¡å™¨ä¸º MySQL 5.7 M-M-S-S Multisource Replication é«˜å¯ç”¨æ¶æ„</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è½¯ä»¶å	mysql-proxy</span><br><span class="line">	http://classroom.example.com/materials/mysql-proxy-0.8.5.tar.gz</span><br><span class="line">æœåŠ¡å¯åŠ¨è„šæœ¬</span><br><span class="line">	mysql-proxy</span><br><span class="line">		-P, --proxy-address=&lt;host:port&gt; 	4040	æŒ‡å®šmysql-proxyè¿è¡Œçš„ä½ç½®å’Œç«¯å£å·</span><br><span class="line">		-b, --proxy-backend-addresses=&lt;host:port&gt;	å¯è¯»å¯å†™</span><br><span class="line">		-r, --proxy-read-only-backend-addresses=&lt;host:port&gt; åªè¯»</span><br><span class="line">		-s, --proxy-lua-script=&lt;file&gt;			luaè„šæœ¬		</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…å¹¶å¯åŠ¨mysql-proxy</span></span><br><span class="line"></span><br><span class="line">1ï¼‰ä¾èµ–å…³ç³»</span><br><span class="line">yum install -y  gcc* libev lua  lua-devel libevent libevent-devel glib2 glib2-devel pkgconfig mariadb-devel flex</span><br><span class="line">2ï¼‰æºç ç¼–è¯‘</span><br><span class="line">1.configure</span><br><span class="line">2.make</span><br><span class="line">3.make install</span><br><span class="line">---------------</span><br><span class="line">3ï¼‰å¯åŠ¨æœåŠ¡</span><br><span class="line">mysql-proxy -P 172.25.0.15:3306 -b 172.25.0.11:3306 -b 172.25.0.12:3306 -r 172.25.0.13:3306 -r 172.25.0.14:3306 -s /usr/local/mysql-proxy/rw-splitting.lua</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼Œå¯åŠ¨æœåŠ¡ä¹‹å‰éœ€è¦ï¼š</span><br><span class="line">	1ï¼‰å…³é—­æ‰€æœ‰æœåŠ¡å™¨çš„selinuxå’Œfirewalld</span><br><span class="line">	2ï¼‰åç«¯çœŸå®æ•°æ®åº“éœ€è¦ç»™dbproxyæˆæƒ</span><br><span class="line"></span><br><span class="line">---------------</span><br><span class="line">mysql-proxyè¯¦ç»†æ­¥éª¤</span><br><span class="line"></span><br><span class="line">1.ç½‘ç»œæ‹“æ‰‘è§„åˆ’</span><br><span class="line">mastera0	172.25.0.11	mariadb5.7 	mysql-5.7.repo</span><br><span class="line">masterb0	172.25.0.12 	mariadb5.7 	mysql-5.7.repo</span><br><span class="line">slavea0		172.25.0.13	mariadb5.7 	mysql-5.7.repo</span><br><span class="line">slaveb0		172.25.0.14	mariadb5.7	mysql-5.7.repo</span><br><span class="line">dbproxy0	172.25.0.15	mysql-proxy0.8.5 thirdpart.repo</span><br><span class="line">2.å®‰è£…è½¯ä»¶</span><br><span class="line">1ï¼‰æ— å¯†ç sshç™»é™†è™šæ‹Ÿæœº</span><br><span class="line"><span class="meta">#</span><span class="bash"> ssh-keygen -t rsa</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> i <span class="keyword">in</span> 10 11 12 13 14 15 ;<span class="keyword">do</span> ssh-copy-id root@172.25.0.<span class="variable">$i</span> ;<span class="keyword">done</span></span></span><br><span class="line"></span><br><span class="line">2ï¼‰å…³é—­selinux,firewalld</span><br><span class="line">for i in 10 11 12 13 14 15 ;\</span><br><span class="line">do ssh root@172.25.0.$i \</span><br><span class="line">"sed -i '/^SELINUX/s/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config;\</span><br><span class="line">grep -v "^#" /etc/selinux/config;\</span><br><span class="line">systemctl stop firewalld;setenforce 0 ";done</span><br><span class="line"></span><br><span class="line">3ï¼‰éœ€è¦å®‰è£…çš„è½¯ä»¶åŒ…wgetï¼Œnet-tools,rpc-bind,nfs-utils,vim</span><br><span class="line">for i in 10 11 12 13 14 ;do ssh root@172.25.0.$i "yum install -y wget net-tools rpc-bind nfs-utils vim ";done</span><br><span class="line"></span><br><span class="line">4ï¼‰æŸ¥çœ‹ipåœ°å€ip addr</span><br><span class="line">5ï¼‰ä¿®æ”¹yumæºï¼Œæ ¹æ®å®é™…éœ€æ±‚æ¥</span><br><span class="line">ä»æœåŠ¡å™¨ä¸Šä¸‹è½½åˆ°/etc/yum.repos.d/ç›®å½•</span><br><span class="line"></span><br><span class="line">6) mastera--slavebå››å°æ•°æ®åº“æœåŠ¡å™¨ï¼Œå®‰è£…mysql5.7ï¼Œå¹¶å¯åŠ¨æœåŠ¡,ä¿®æ”¹åˆå§‹å¯†ç </span><br><span class="line">ä¸ºäº†æµ‹è¯•ä¸­é—´ä»¶çš„åŠŸèƒ½ï¼Œåˆ†åˆ«åˆ›å»ºdb1.t1</span><br><span class="line">mastera	db1.t1 (1,'mastera')</span><br><span class="line">masterb db1.t1 (1,'masterb')</span><br><span class="line">slavea db1.t1 (1,'slavea')</span><br><span class="line">slaveb db1.t1 (1,'slaveb')</span><br><span class="line"></span><br><span class="line">7) dbproxyå®‰è£…ä¾èµ–åŒ… (éœ€è¦ç¬¬ä¸‰æ–¹yumæº thirdpart.repo)</span><br><span class="line">yum install -y  gcc* libev lua  lua-devel libevent libevent-devel glib2 glib2-devel pkgconfig mariadb-devel flex</span><br><span class="line"></span><br><span class="line">8) å®‰è£…mysql-proxy</span><br><span class="line"><span class="meta">#</span><span class="bash"> wget http://172.25.254.254/content/courses/db100/rhel7.2/materials/mysql-proxy-0.8.5.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tar -zxf mysql-proxy-0.8.5.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> mysql-proxy-0.8.5</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ./configure --prefix=/usr/<span class="built_in">local</span>/mysql-proxy</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make install</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3) è¿›å…¥mysql-proxyçš„å®¶ç›®å½•/usr/local/mysql-proxy</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mysql-proxy/;ls</span></span><br><span class="line">bin  include  lib  libexec  share</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> bin;ls</span></span><br><span class="line">mysql-binlog-dump  mysql-myisam-dump  mysql-proxy</span><br><span class="line"><span class="meta">#</span><span class="bash"> ./mysql-proxy --<span class="built_in">help</span>-proxy  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†luaè„šæœ¬å¤åˆ¶åˆ°mysql-proxyçš„å®¶ç›®å½•</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cp ~/mysql-proxy-0.8.5/lib/rw-splitting.lua /usr/<span class="built_in">local</span>/mysql-proxy/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨æœåŠ¡</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql-proxy -P 172.25.0.15:3306 -b 172.25.0.11:3306 -b 172.25.0.12:3306 -r 172.25.0.13:3306 -r 172.25.0.14:3306 -s /usr/<span class="built_in">local</span>/mysql-proxy/rw-splitting.lua</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹mysql-proxyç›‘å¬ç«¯å£å·</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> netstat -ntalp|grep 3306</span></span><br><span class="line">tcp        0      0 172.25.0.15:3306        0.0.0.0:*               LISTEN      24483/./mysql-proxy</span><br><span class="line"></span><br><span class="line">4.workstationæµ‹è¯•(éœ€è¦å®‰è£…mariadbå®¢æˆ·ç«¯ï¼Œæˆ–è€…mysqlå®¢æˆ·ç«¯)</span><br><span class="line">å®¢æˆ·ç«¯172.25.0.10</span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql -u<span class="string">'dbproxy'</span> -p<span class="string">'Uploo00king'</span> -h172.25.0.15</span></span><br><span class="line">MySQL [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+---------+</span><br><span class="line">| id | name    |</span><br><span class="line">+----+---------+</span><br><span class="line">|  1 | mastera |</span><br><span class="line">+----+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">***************************************</span><br><span class="line"><span class="meta">#</span><span class="bash">å°†mastera0çš„æœåŠ¡å…³é—­åï¼Œå†æŸ¥çœ‹è¡¨1ä¸­çš„å†…å®¹</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl stop mysqld</span></span><br><span class="line">****************************************</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; select * from db1.t1;</span><br><span class="line">ERROR 2013 (HY000): Lost connection to MySQL server during query</span><br><span class="line">MySQL [(none)]&gt; select * from db1.t1;</span><br><span class="line">ERROR 2006 (HY000): MySQL server has gone away</span><br><span class="line">No connection. Trying to reconnect...</span><br><span class="line">Connection id:    9</span><br><span class="line">Current database: *** NONE ***</span><br><span class="line"></span><br><span class="line">+----+---------+</span><br><span class="line">| id | name    |</span><br><span class="line">+----+---------+</span><br><span class="line">|  1 | masterb |</span><br><span class="line">+----+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">***************************************</span><br><span class="line"><span class="meta">#</span><span class="bash">æ’å…¥æ•°æ®ï¼ŒæŸ¥çœ‹æ’å…¥åˆ°å“ªä¸ªæœåŠ¡å™¨ä¸­äº†</span></span><br><span class="line">****************************************  </span><br><span class="line">MySQL [(none)]&gt; insert into db1.t1 values (2,'test');</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">MySQL [(none)]&gt; select @@hostname;</span><br><span class="line">+----------------------+</span><br><span class="line">| @@hostname           |</span><br><span class="line">+----------------------+</span><br><span class="line">| masterb0.example.com |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">***************************************</span><br><span class="line"><span class="meta">#</span><span class="bash">å°†masterb0çš„æœåŠ¡å…³é—­åï¼Œå†æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl stop mysqld</span></span><br><span class="line">****************************************</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; insert into db1.t1 values (100,'oo');</span><br><span class="line">ERROR 2013 (HY000): Lost connection to MySQL server during query</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; select @@hostname;</span><br><span class="line">ERROR 2013 (HY000): Lost connection to MySQL server during query</span><br><span class="line">MySQL [(none)]&gt; select @@hostname;</span><br><span class="line">ERROR 2006 (HY000): MySQL server has gone away</span><br><span class="line">No connection. Trying to reconnect...</span><br><span class="line">Connection id:    7</span><br><span class="line">Current database: *** NONE ***</span><br><span class="line"></span><br><span class="line">+---------------------+</span><br><span class="line">| @@hostname          |</span><br><span class="line">+---------------------+</span><br><span class="line">| slavea0.example.com |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">***************************************</span><br><span class="line"><span class="meta">#</span><span class="bash">å°†mastera0çš„æœåŠ¡å¯åŠ¨åï¼Œå†æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl start mysqld</span></span><br><span class="line">****************************************</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; select @@hostname;</span><br><span class="line">+----------------------+</span><br><span class="line">| @@hostname           |</span><br><span class="line">+----------------------+</span><br><span class="line">| mastera0.example.com |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; insert into db1.t1 values (101,'oo');</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.07 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; select @@hostname;</span><br><span class="line">+---------------------+</span><br><span class="line">| @@hostname          |</span><br><span class="line">+---------------------+</span><br><span class="line">| slavea0.example.com |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+--------+</span><br><span class="line">| id | name   |</span><br><span class="line">+----+--------+</span><br><span class="line">|  1 | slavea |</span><br><span class="line">+----+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">***************************************</span><br><span class="line"><span class="meta">#</span><span class="bash">æ­¤æ—¶å‘ç°ï¼Œå†™æ“ä½œè¿æ¥masteraï¼Œè¯»æ“ä½œè¿æ¥slavea</span></span><br><span class="line">****************************************</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®æˆ˜é¡¹ç›®2ï¼šæ•°æ®åº“ä¸­é—´ä»¶ mysql-proxy 0.8.5 å®ç° è¯»å†™åˆ†ç¦»è´Ÿè½½å‡è¡¡ï¼Œåç«¯æ•°æ®åº“æœåŠ¡å™¨ä¸º Mariadb 10.2 Galera Cluster åŒæ­¥å¤åˆ¶é«˜å¯ç”¨æ¶æ„</p>
</blockquote>
<blockquote>
<p>å®æˆ˜é¡¹ç›®3: æ•°æ®åº“ä¸­é—´ä»¶ Mycat å®ç° è¯»å†™åˆ†ç¦»è´Ÿè½½å‡è¡¡ï¼Œåç«¯æ•°æ®åº“æœåŠ¡å™¨ä¸º Mariadb 10.2 Galera Cluster åŒæ­¥å¤åˆ¶é«˜å¯ç”¨æ¶æ„</p>
</blockquote>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol>
<li>Galera Clusteræ˜¯MariaDBçš„ä¸€ä¸ªåŒæ´»å¤šä¸»é›†ç¾¤,å…¶å¯ä»¥ä½¿å¾—MariDBçš„æ‰€æœ‰èŠ‚ç‚¹ä¿æŒåŒæ­¥,Galeraä¸ºMariaDBæä¾›äº†åŒæ­¥å¤åˆ¶(ç›¸å¯¹äºåŸç”Ÿçš„å¼‚æ­¥å¤åˆ¶),å› æ­¤å…¶å¯ä»¥ä¿è¯HA,ä¸”å…¶å½“å‰ä»…æ”¯æŒXtraDB/InnoDBå­˜å‚¨å¼•æ“(æ‰©å±•æ”¯æŒMyISAM),å¹¶ä¸”åªå¯åœ¨Linuxä¸‹ä½¿ç”¨ã€‚</li>
<li>mariadb10.2çš„galeraç‰ˆæœ¬å’Œä¹‹å‰ç‰ˆæœ¬æœ‰æ‰€åŒºåˆ«ï¼Œéœ€è¦æ³¨æ„</li>
<li>mysql-proxyè¿˜æ²¡æœ‰æ­£å¼ç‰ˆï¼Œé—®é¢˜æ¯”è¾ƒå¤šï¼Œå®‰è£…éœ€è¦æºç ç¼–è¯‘ï¼Œä½¿ç”¨luaè„šæœ¬å®ç°è¯»å†™åˆ†ç¦»ï¼›</li>
<li>mycatæ˜¯ç›®å‰å¼€æºé‡Œé¢åšçš„æœ€å¥½çš„æ•°æ®åº“ä»£ç†æœåŠ¡å™¨ï¼ŒtaråŒ…è§£å‹åˆ°åˆ¶å®šç›®å½•å°±èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯æ³¨æ„éœ€è¦å®‰è£…jdkï¼Œå¹¶å®£å‘Šjavaå®¶ç›®å½•çš„ä½ç½®ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>MySQLåŸºç¡€ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬ä¸ƒè¯¾ å¤åˆ¶ AB replication</title>
    <url>/2016/12/31/booboo_mysql/04-MySQL%E5%A4%8D%E5%88%B6replication/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬è®²ä¹‰å‚è€ƒ ã€Š HA mysql ã€‹ é«˜å¯ç”¨MySQL:ç¬¬2ç‰ˆ /(ç¾)è´å°”(Bell,C.),(ç¾)è‚¯å¾·å°”(Kindahl,M.),(ç¾)å¡å°”æ›¼</p>
</blockquote>
<h3 id="å¤åˆ¶æ¦‚è¿°"><a href="#å¤åˆ¶æ¦‚è¿°" class="headerlink" title="å¤åˆ¶æ¦‚è¿°"></a>å¤åˆ¶æ¦‚è¿°</h3><p>æ•°æ®åº“ä¸ºåº”ç”¨ç¨‹åºæä¾›é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§çš„é‡è¦ç‰¹æ€§ä¹‹ä¸€å°±æ˜¯å¤åˆ¶(Replication)ã€‚å¤åˆ¶åœ¨æ•°æ®åº“å±‚åˆ›å»ºå†—ä½™,åŒæ—¶äº§ç”Ÿå¤šä¸ªæ•°æ®åº“å‰¯æœ¬è¿›è¡Œè¯»æ‰©å±•ã€‚</p>
<p>å¤åˆ¶å°±æ˜¯æŠŠæŸä¸ªæœåŠ¡å™¨ä¸Š(ç§°ä¸º ä¸»èŠ‚ç‚¹æœåŠ¡å™¨ æˆ–è€…ç®€ç§° ä¸»èŠ‚ç‚¹ ,å³ master)çš„æ‰€æœ‰å˜åŒ–å…‹éš†åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨(ç§°ä¸º ä»èŠ‚ç‚¹æœåŠ¡å™¨ æˆ–ç®€ç§° ä»èŠ‚ç‚¹ ,å³ slave)ã€‚å¤åˆ¶é€šå¸¸ç”¨æ¥åˆ›å»ºmaster çš„ä¸€ä¸ªå¯é å‰¯æœ¬,ä¸è¿‡å¤åˆ¶ä¹Ÿæœ‰å…¶ä»–ç”¨é€”ã€‚</p>
<p>ä¸¤ç§æœ€å¸¸è§çš„ä½¿ç”¨å¤åˆ¶çš„ä¾‹å­æ˜¯ :</p>
<ul>
<li>(1)åˆ›å»ºä¸€ä¸ª master çš„å¤‡ä»½,ä»¥é¿å… master å´©æºƒæ—¶ä¸¢å¤±æ•°æ® ;</li>
<li>(2)åˆ›å»ºä¸€ä¸ª master çš„å‰¯æœ¬,ä»è€Œåœ¨ä¸å¹²æ‰°å…¶ä»–ä¸šåŠ¡çš„æƒ…å†µä¸‹æ‰§è¡ŒæŠ¥è¡¨å’Œåˆ†æå·¥ä½œã€‚</li>
</ul>
<p>å¯¹å°å‹ä¼ä¸šæ¥è¯´,è¿™è¶³ä»¥ç®€åŒ–å¾ˆå¤šäº‹æƒ…,ä½†å¤åˆ¶å¯ä»¥åšå¾—æ›´å¤š,æ¯”å¦‚ :</p>
<ul>
<li>æ”¯æŒå¤šä¸ªæœºæˆ¿</li>
</ul>
<p>æ¯ä¸ªåœ°ç‚¹éƒ½å¯èƒ½è¦ç»´æŠ¤æœåŠ¡å™¨,ç„¶åå°†å˜æ›´å¤åˆ¶åˆ°å…¶ä»–åœ°æ–¹,ä»è€Œä½¿å¾—ä¿¡æ¯å¤„å¤„å¯ç”¨ã€‚è¿™å°±éœ€è¦ä¿æŠ¤æ•°æ®,åœ¨åˆæ³•çš„æƒ…å†µä¸‹,ä¿è¯ç”¨äºå®¡è®¡ç›®çš„çš„ä¸šåŠ¡ä¿¡æ¯å¯ç”¨ã€‚</p>
<ul>
<li>å³ä½¿æœ‰æœåŠ¡å™¨åœæœº,ä¹Ÿèƒ½ä¿è¯ä¸šåŠ¡çš„æŒç»­è¿è¡Œ</li>
</ul>
<p>å¦‚æœåŸæ¥çš„æœåŠ¡å™¨å¤±æ•ˆ,ç”±å…¶ä»–æœåŠ¡å™¨å¤„ç†æ‰€æœ‰çš„è®¿é—®é‡ã€‚</p>
<ul>
<li>å³ä½¿æœ‰ç¾éš¾å‘ç”Ÿ,ä¹Ÿèƒ½ä¿è¯ä¸šåŠ¡æŒç»­è¿è¡Œ</li>
</ul>
<p>å¤åˆ¶å¯ä»¥å°†å˜æ›´å‘é€ç»™ä¸åŒåœ°ç†ä½ç½®çš„å…¶ä»–æ•°æ®ä¸­å¿ƒã€‚</p>
<ul>
<li>é”™è¯¯ä¿æŠ¤(oops)</li>
</ul>
<p>å½“ slave è¿æ¥ master æ—¶,å¯ä»æ€»æ˜¯æ¯” master è½åä¸€ä¸ªå›ºå®šçš„æ—¶é—´å‘¨æœŸ(ä¾‹å¦‚ 1 å°æ—¶),è¿™æ ·å°±ä¼šäº§ç”Ÿä¸€ä¸ª å»¶è¿Ÿçš„ slave(Delayed Slave)ã€‚å¦‚æœè¿™æ—¶ master ä¸Šå‘ç”Ÿé”™è¯¯,å¯ä»¥æ‰¾åˆ°å‡ºé”™çš„è¯­å¥,ç„¶ååœ¨ slave æ‰§è¡Œä¹‹å‰åˆ é™¤å®ƒã€‚</p>
<p>ç›®å‰å¾ˆå¤šåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å¤åˆ¶æœ€é‡è¦çš„åœºæ™¯ä¹‹ä¸€å°±æ˜¯ æ¨ªå‘æ‰©å±• (scale out)ã€‚ç°ä»Šçš„åº”ç”¨ç¨‹åºé€šå¸¸æ˜¯è¯»å¯†é›†å‹çš„,å…·æœ‰é«˜è¯»å†™æ¯”ã€‚ä¸ºäº†å‡å°‘ master ä¸Šçš„è´Ÿè½½,ä½ å¯ä»¥æ­å»ºä¸€ä¸ªä¸“é—¨å“åº”è¯»è¯·æ±‚çš„ slaveã€‚é€šè¿‡ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨,å¯ä»¥å°†è¯»è¯·æ±‚å®šå‘åˆ°åˆé€‚çš„ slave,è€Œå†™è¯·æ±‚åˆ™äº¤ç»™ master å¤„ç†ã€‚</p>
<p>åœ¨æ¨ªå‘æ‰©å±•çš„åœºæ™¯ä¸‹ä½¿ç”¨å¤åˆ¶æ—¶,ç†è§£ MySQL å¤åˆ¶çš„ å¼‚æ­¥æ€§ (asynchronous)å¾ˆé‡è¦,å³äº‹åŠ¡é¦–å…ˆåœ¨ master ä¸Šæäº¤,ç„¶åå¤åˆ¶åˆ° slave å¹¶åœ¨ slave ä¸Šæ‰§è¡Œã€‚è¿™æ„å‘³ç€ master å’Œslave å¯èƒ½å¹¶ä¸ä¸€è‡´,è€Œä¸”å¦‚æœå¤åˆ¶æŒç»­è¿è¡Œ,slave å°†ä¼šè½åäº masterã€‚</p>
<p>ä½¿ç”¨å¼‚æ­¥å¤åˆ¶çš„å¥½å¤„åœ¨äºå®ƒæ¯”åŒæ­¥å¤åˆ¶æ›´å¿«ã€æ›´å…·å¯æ‰©å±•æ€§,ä½†åœ¨é‚£äº›å®æ—¶æ•°æ®å¾ˆé‡è¦çš„æƒ…å†µä¸‹,å¿…é¡»å¤„ç†å¥½ä¸åŒæ­¥çš„é—®é¢˜ä»¥ä¿è¯ä¿¡æ¯çš„æ—¶æ•ˆæ€§ã€‚</p>
<p>ç„¶è€Œ,è¯»æ‰©å±•å¹¶ä¸è¶³ä»¥é€‚ç”¨äºæ‰€æœ‰åº”ç”¨ç¨‹åºã€‚éšç€éœ€æ±‚å¢åŠ ,æ•°æ®åº“æ›´å¤§,å†™è´Ÿè½½æ›´é«˜,éœ€è¦æ‰©å±•çš„å°±ä¸åªæ˜¯è¯»æ“ä½œäº†ã€‚ç®¡ç†å¤§å‹æ•°æ®åº“,æå‡å¤§å‹æ•°æ®åº“ç³»ç»Ÿçš„æ€§èƒ½,å¯ä»¥é€šè¿‡åˆ†ç‰‡ (sharding)æŠ€æœ¯æ¥å®ç°ã€‚é€šè¿‡åˆ†ç‰‡,å¯ä»¥å°†æ•°æ®åº“åˆ’åˆ†ä¸ºè‹¥å¹²å¯ç®¡ç†çš„æ•°æ®åˆ†ç‰‡,å°†æ•°æ®åº“åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Š,ä»è€Œå¢åŠ æ•°æ®åº“çš„è§„æ¨¡,å¹¶æœ‰æ•ˆåœ°æ‰©å±•å†™æ“ä½œã€‚</p>
<p>å¤åˆ¶çš„å¦ä¸€ä¸ªé‡è¦åº”ç”¨æ˜¯é€šè¿‡æ·»åŠ å†—ä½™æ¥ä¿è¯é«˜å¯ç”¨æ€§ã€‚æœ€å¸¸è§çš„æŠ€æœ¯æ˜¯ä½¿ç”¨ åŒä¸»é…ç½®(dual-master),å³é€šè¿‡å¤åˆ¶ä¿æŒä¸€å¯¹ master æ€»æ˜¯å¯ç”¨,å…¶ä¸­æ¯ä¸ª master éƒ½æ˜¯å¯¹æ–¹çš„é•œåƒã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ª master å¤±æ•ˆ,å¦ä¸€ä¸ªä¼šç«‹å³æ¥æ‰‹ã€‚</p>
<p>é™¤äº†åŒä¸»é…ç½®,è¿˜æœ‰å…¶ä»–ä¸å¤åˆ¶æ— å…³çš„é«˜å¯ç”¨æ€§æŠ€æœ¯,å¦‚ä½¿ç”¨å…±äº«å­˜å‚¨æˆ–å¤åˆ¶ç£ç›˜ã€‚å°½ç®¡å®ƒä»¬ä¸æ˜¯ MySQL ç‰¹æœ‰çš„,ä½†è¿™äº›æŠ€æœ¯å¯¹äºä¿è¯é«˜å¯ç”¨æ€§æ¥è¯´ä¹Ÿæ˜¯å¾ˆé‡è¦çš„å·¥å…·</p>
<h3 id="å¤åˆ¶è§£å†³çš„é—®é¢˜"><a href="#å¤åˆ¶è§£å†³çš„é—®é¢˜" class="headerlink" title="å¤åˆ¶è§£å†³çš„é—®é¢˜"></a>å¤åˆ¶è§£å†³çš„é—®é¢˜</h3><blockquote>
<p>å¤åˆ¶ç”¨ä¾‹:</p>
</blockquote>
<blockquote>
<blockquote>
<p>é€šè¿‡çƒ­å¤‡ä»½è¾¾åˆ°é«˜å¯ç”¨æ€§</p>
</blockquote>
</blockquote>
<p>å¦‚æœæœåŠ¡å™¨å®•æœº,ä¸€åˆ‡éƒ½å°†åœæ­¢ :ä¸èƒ½æ‰§è¡Œ(å¯èƒ½å¾ˆå…³é”®çš„)äº‹åŠ¡, æ— æ³•å¾—åˆ°ç”¨æˆ·ä¿¡æ¯,ä¹Ÿä¸èƒ½æ£€ç´¢å…¶ä»–é‡è¦æ•°æ®ã€‚è¦ä¸æƒœ(å‡ ä¹)ä¸€åˆ‡ä»£ä»·é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿ,å› ä¸ºå®ƒä¼šä¸¥é‡ç ´åä¸šåŠ¡ã€‚æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯é…ç½®ä¸€ä¸ªé¢å¤–çš„æœåŠ¡å™¨ä¸“é—¨ä½œä¸ºçƒ­å¤‡ä»½(hot standby),åœ¨ä¸»æœåŠ¡å™¨å®•æœºçš„æ—¶å€™éšæ—¶æ¥ç®¡ä¸šåŠ¡ã€‚</p>
<p>å¦‚æœæ•°æ®åº“åªåšäº†å¤‡ä»½ï¼Œç°åœ¨æ•°æ®åº“åäº†ï¼Œæˆ‘ä»¬è¦æ¢å¤æ•°æ®åº“ï¼Œå¯èƒ½è¦èŠ±å‡ ä¸ªå°æ—¶ï¼›ä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¸Œæœ›è¿™å°æ•°æ®åº“åäº†ï¼Œå¦å¤–ä¸€å°èƒ½å¤Ÿç«‹åˆ»é¡¶ä¸Šä½¿ç”¨ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<p>é‚£å°±éœ€è¦æˆ‘ä»¬æœ‰ä¸€ä¸ªå†—ä½™çš„ç¯å¢ƒï¼Œå¤‡ä»½æ˜¯å¤‡ä»½,å†—ä½™æ˜¯å†—ä½™ã€‚æ¦‚å¿µä¸ä¸€æ ·,å¤‡ä»½æ˜¯å°†æ•°æ®ä»¥éš”ç¦»çš„æ–¹å¼ä¿å­˜,å¤‡ä»½çš„ç¼ºç‚¹,ä»–ä¸æ˜¯ç¬é—´è¿˜åŸ,å¤‡ä»½åœ¨è¿˜åŸè¿‡ç¨‹ä¸­æ˜¯æœ‰è€—æ—¶çš„,ä»–ä¸æ˜¯ç¬é—´è¿˜åŸ,ä¾‹å¦‚,æˆ‘ä»¬æœ‰å‡ ç™¾ä¸ª G çš„æ–‡ä»¶è¦è¿˜åŸå›å»,æ…¢æ…¢æ‹·å§,å‡ ä¸ªå°æ—¶ã€‚å†—ä½™ä¸ä¸€æ ·,ä¸»æœåŠ¡å™¨/ä»æœåŠ¡å™¨,ä¸»æœåŠ¡å™¨åæ‰,ä»æœåŠ¡å™¨å°±é¡¶ä¸Šå·¥ä½œ,æ‰€ä»¥å†—ä½™åœ¨å¯ç”¨æ€§ä¸Šæ¥è®²,æ¢å¤çš„é€Ÿåº¦ä¸Šæ¥è®²,æ¯”å¤‡ä»½æ¥çš„å¿«,ä½†æ˜¯å†—ä½™æœ‰ä»–çš„ç¼ºç‚¹,å¤‡ä»½æœ‰ä»–çš„ä¼˜ç‚¹,æ¯”å¦‚æˆ‘ä»¬ä½œä¸»ä»åŒæ­¥,ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨æ•°æ®éƒ½ä¸€æ ·çš„,å¦‚æœä¸»æœåŠ¡å™¨ä¸Šæœ‰äººé”™åˆ äº†ä¸€ä¸ªè¡¨,æˆ‘ä»¬æŠŠè¿™ç§æ“ä½œç§°ä¸ºè¯¯æ“ä½œ,é‚£ä¹ˆä»æœåŠ¡å™¨ä¹Ÿä¼šå‘ç”Ÿè¯¯æ“ä½œ,æ‰€ä»¥å‘¢,å†—ä½™ä¸èƒ½è§£å†³äººä¸ºçš„è¯¯æ“ä½œ,è€Œå¤‡ä»½å¯ä»¥è§£å†³ã€‚å†—ä½™ä»–èƒ½è§£å†³ç¡¬ä»¶æ•…éšœ,ä½†æ˜¯è¯¯æ“ä½œæ— æ³•è§£å†³,å¤‡ä»½ä¸æ˜¯ç¬é—´è¿˜åŸ,ä½†æ˜¯æ—¢å¯ä»¥è§£å†³ç¡¬ä»¶æ•…éšœåˆèƒ½è§£å†³è¯¯æ“ä½œ,ä»–ä»¬å„æœ‰ä¼˜åŠ£ç‚¹,è€ŒçœŸå®çš„çº¿ä¸Šç”Ÿäº§ç¯å¢ƒæ˜¯ä¸¤ç§æ–¹æ³•ä¸€èµ·ä½¿ç”¨,æ—¢æœ‰å†—ä½™ç¯å¢ƒ,åˆæœ‰å‘¨æœŸæ€§å¤‡ä»½,ç®¡ç†å‘˜è¦å‘¨æœŸæ€§åœ°è¿›è¡Œå¤‡ä»½,åŒæ—¶æœ‰å¤šå°æœåŠ¡å™¨ä½œå†—ä½™ã€‚</p>
<blockquote>
<blockquote>
<p>äº§ç”ŸæŠ¥è¡¨</p>
</blockquote>
</blockquote>
<p>ç›´æ¥ç”¨æœåŠ¡å™¨ä¸Šçš„æ•°æ®åˆ›å»ºæŠ¥è¡¨å°†å¤§å¤§é™ä½æœåŠ¡å™¨çš„æ€§èƒ½,åœ¨æŸäº›æƒ…å†µä¸‹å°¤å…¶æ˜¾è‘—ã€‚å¦‚æœäº§ç”ŸæŠ¥è¡¨éœ€è¦å¤§é‡çš„åå°ä½œä¸š,æœ€å¥½åˆ›å»ºä¸€ä¸ªé¢å¤–çš„æœåŠ¡å™¨æ¥è¿è¡Œè¿™äº›ä½œä¸šã€‚åœæ­¢æŠ¥è¡¨æ•°æ®åº“ä¸Šçš„å¤åˆ¶,ç„¶ååœ¨ä¸å½±å“ä¸»è¦ä¸šåŠ¡æœåŠ¡å™¨çš„æƒ…å†µä¸‹è¿è¡Œå¤§é‡æŸ¥è¯¢,ä»è€Œå¾—åˆ°æ•°æ®åº“åœ¨æŸä¸€ç‰¹å®šæ—¶é—´çš„å¿«ç…§ã€‚ä¾‹å¦‚,å¦‚æœåœ¨æ¯å¤©æœ€åä¸€ä¸ªäº‹åŠ¡å¤„ç†å®Œæ¯•ååœæ­¢å¤åˆ¶,å¯ä»¥æå–æ—¥æŠ¥è¡¨è€Œå…¶ä»–ä¸šåŠ¡ä»æ­£å¸¸è¿è½¬ã€‚</p>
<blockquote>
<blockquote>
<p>è°ƒè¯•å’Œå®¡è®¡</p>
</blockquote>
</blockquote>
<p>è¿˜å¯ä»¥å®¡æŸ¥æœåŠ¡å™¨ä¸Šçš„æŸ¥è¯¢ã€‚ä¾‹å¦‚,æŸ¥çœ‹æŸäº›æŸ¥è¯¢æ˜¯å¦æœ‰æ€§èƒ½é—®é¢˜,ä»¥åŠæœåŠ¡å™¨æ˜¯å¦ç”±äºæŸä¸ªç³Ÿç³•çš„æŸ¥è¯¢è€Œä¸åŒæ­¥ã€‚</p>
<h3 id="å¤åˆ¶çš„åŸç†"><a href="#å¤åˆ¶çš„åŸç†" class="headerlink" title="å¤åˆ¶çš„åŸç†"></a>å¤åˆ¶çš„åŸç†</h3><p>åœ¨è¯¦ç»†ä»‹ç»å¦‚ä½•è®¾ç½®å¤åˆ¶ä¹‹å‰ï¼Œè®©æˆ‘é—¨å…ˆçœ‹çœ‹MySQLå®é™…ä¸Šæ—¶å¦‚ä½•å¤åˆ¶æ•°æ®çš„ã€‚æ€»çš„æ¥è¯´ï¼Œå¤åˆ¶æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>åœ¨ä¸»åº“ä¸ŠæŠŠæ•°æ®æ›´æ”¹è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary Logï¼‰ä¸­ï¼ˆè¿™å†™è®°å½•è¢«ç§°ä¸ºäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼‰ã€‚</li>
<li>å¤‡åº“å°†ä¸»åº“çš„æ—¥å¿—å¤åˆ¶åˆ°è‡ªå·±çš„ä¸­ç»§æ—¥å¿—ï¼ˆRelay Logï¼‰ä¸­ã€‚</li>
<li>å¤‡åº“è¯»å–ä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†å…¶é‡æ”¾/é‡æ¼”åˆ°å¤‡åº“æ•°æ®ä¹‹ä¸Šã€‚</li>
</ol>
<p>ä»¥ä¸Šåªæ˜¯æ¦‚è¿°ï¼Œå®é™…å•†æ¯ä¸€æ­¥éƒ½å¾ˆå¤æ‚ï¼Œä¸‹å›¾æ›´è¯¦ç»†åœ°æè¿°äº†å¤åˆ¶çš„ç»†èŠ‚ã€‚</p>
<p><img src="pic/23-replication-how.png" alt="replication-how"></p>
<h4 id="é¡¹ç›®å®æˆ˜1ï¼šmariadb-server-5-5-å•ä¸»ä»æ¶æ„"><a href="#é¡¹ç›®å®æˆ˜1ï¼šmariadb-server-5-5-å•ä¸»ä»æ¶æ„" class="headerlink" title="é¡¹ç›®å®æˆ˜1ï¼šmariadb server 5.5 å•ä¸»ä»æ¶æ„"></a>é¡¹ç›®å®æˆ˜1ï¼šmariadb server 5.5 å•ä¸»ä»æ¶æ„</h4><p><img src="pic/62.jpg" alt="62"></p>
<p><em>å•ä¸»ä»æ­¥éª¤</em></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä¸»æœåŠ¡å™¨</span><br><span class="line">1ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶	log-bin server-id&#x3D;1ï¼ˆé‡å¯æœåŠ¡ï¼‰</span><br><span class="line">2ï¼‰æˆæƒä»æœº	grant replication slave to slave@172.25.0.12 uplooking</span><br><span class="line">3ï¼‰åˆå§‹åŒ–æ•°æ®ä¸€è‡´	mysqldump---ã€‹ä¼ è¾“ç»™ä»æœºå™¨</span><br><span class="line"></span><br><span class="line"># ä»æœåŠ¡</span><br><span class="line">1ï¼‰install</span><br><span class="line">2ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶	server-id&#x3D;2</span><br><span class="line">3ï¼‰åˆå§‹åŒ–æ•°æ®ä¸€è‡´	å¯¼å…¥å…¨å¤‡æ•°æ®</span><br><span class="line">4ï¼‰&gt; change master master_host&#x3D;&#39;172.25.0.11&#39;</span><br><span class="line">		master_user&#x3D;&#39;slave&#39;</span><br><span class="line">		master_password&#x3D;&#39;uplooking&#39;</span><br><span class="line">		master_log_file&#x3D;&#39;&#39;</span><br><span class="line">		master_log_pos&#x3D;&#39;&#39;</span><br><span class="line">5)&gt; start slave;</span><br><span class="line">6)&gt; show slave status\G;</span><br></pre></td></tr></table></figure>


<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ä¸»æœåŠ¡å™¨</span></span></span><br><span class="line">[root@mastera0 mysql]# vim /etc/my.cnf</span><br><span class="line">[root@mastera0 mysql]# grep -v '^#' /etc/my.cnf|grep -v '^$'</span><br><span class="line">[mysqld]</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line">symbolic-links=0</span><br><span class="line">log-bin=/var/lib/mysql-log/mastera</span><br><span class="line">server-id=1</span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error=/var/log/mariadb/mariadb.log</span><br><span class="line">pid-file=/var/run/mariadb/mariadb.pid</span><br><span class="line">!includedir /etc/my.cnf.d</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]# systemctl restart mariadb</span><br><span class="line">[root@mastera0 mysql]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; grant replication slave on *.* to slave@'172.25.0.12' identified by 'uplooking';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line">[root@mastera0 mysql]# mysqldump -uroot -puplooking -A --single-transaction --master-data=2 --flush-logs &gt; /tmp/mysql.91.sql</span><br><span class="line">[root@mastera0 mysql]# scp /tmp/mysql.91.sql root@172.25.0.12:/tmp</span><br><span class="line">The authenticity of host \'172.25.0.12 (172.25.0.12)\' can\'t be established.</span><br><span class="line">ECDSA key fingerprint is 91:2b:bd:df:0e:17:da:a0:f6:01:ff:5b:09:50:e8:ad.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added '172.25.0.12' (ECDSA) to the list of known hosts.</span><br><span class="line">root@172.25.0.12\'s password:</span><br><span class="line">mysql.91.sql                                                      100%  505KB 504.7KB/s   00:00    </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ä»æœåŠ¡å™¨</span></span></span><br><span class="line">[root@masterb0 ~]# yum install -y mariadb-server</span><br><span class="line">[root@masterb0 ~]# vi /etc/my.cnf</span><br><span class="line">[root@masterb0 ~]# systemctl start mariadb</span><br><span class="line">[root@masterb0 ~]# mysql &lt; /tmp/mysql.91.sql</span><br><span class="line">[root@masterb0 ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 3</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line">[root@masterb0 ~]# mysql</span><br><span class="line">ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)</span><br><span class="line">[root@masterb0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 5</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; change master to master_host='172.25.0.11',master_user='slave',master_password='uplooking',master_log_file='mastera.000028',MASTER_LOG_POS=245;</span><br><span class="line">Query OK, 0 rows affected (0.21 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; start slave;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show slave status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.11</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mastera.000028</span><br><span class="line">          Read_Master_Log_Pos: 245</span><br><span class="line">               Relay_Log_File: mariadb-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 527</span><br><span class="line">        Relay_Master_Log_File: mastera.000028</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 245</span><br><span class="line">              Relay_Log_Space: 823</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+-----+</span><br><span class="line">| id  |</span><br><span class="line">+-----+</span><br><span class="line">|   3 |</span><br><span class="line">|   4 |</span><br><span class="line">|   5 |</span><br><span class="line">|   6 |</span><br><span class="line">|   7 |</span><br><span class="line">|   8 |</span><br><span class="line">|   9 |</span><br><span class="line">|  10 |</span><br><span class="line">|  11 |</span><br><span class="line">|  12 |</span><br><span class="line">|  13 |</span><br><span class="line">|  14 |</span><br><span class="line">| 100 |</span><br><span class="line">| 101 |</span><br><span class="line">| 102 |</span><br><span class="line">| 103 |</span><br><span class="line">| 777 |</span><br><span class="line">+-----+</span><br><span class="line">17 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>

<p><img src="pic/63.jpg" alt=""></p>
<h4 id="é¡¹ç›®å®æˆ˜2ï¼šmysql-server-5-7-åŸºäºGTIDçš„å•ä¸»ä»æ¶æ„"><a href="#é¡¹ç›®å®æˆ˜2ï¼šmysql-server-5-7-åŸºäºGTIDçš„å•ä¸»ä»æ¶æ„" class="headerlink" title="é¡¹ç›®å®æˆ˜2ï¼šmysql server 5.7 åŸºäºGTIDçš„å•ä¸»ä»æ¶æ„"></a>é¡¹ç›®å®æˆ˜2ï¼šmysql server 5.7 åŸºäºGTIDçš„å•ä¸»ä»æ¶æ„</h4><p><img src="pic/64.jpg" alt=""></p>
<table>
<thead>
<tr>
<th align="left">server</th>
<th align="left">ip</th>
<th align="left">software</th>
<th align="left">rule</th>
</tr>
</thead>
<tbody><tr>
<td align="left">masterb</td>
<td align="left">172.25.0.12</td>
<td align="left">mysql-server 5.7</td>
<td align="left">master</td>
</tr>
<tr>
<td align="left">slaveb</td>
<td align="left">172.25.0.14</td>
<td align="left">mysql-server 5.7</td>
<td align="left">slave</td>
</tr>
</tbody></table>
<p>é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Master:</span><br><span class="line">[mysqld]</span><br><span class="line">server-id=1</span><br><span class="line">log-bin=/var/lib/mysql-log/mastera</span><br><span class="line">gitd_mode=on</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line"></span><br><span class="line">Slave:</span><br><span class="line">[mysqld]</span><br><span class="line">server-id=2</span><br><span class="line">gtid_mode=on</span><br><span class="line">enforce_gtid_consistency=1</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–æ­¥éª¤ä¸é¡¹ç›®å®è·µç±»ä¼¼ï¼Œå†æ¬¡ä¸å†èµ˜è¿°</p>
<p><img src="pic/65.jpg" alt=""></p>
<h3 id="å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜-é‡æ¼”å»¶è¿Ÿ"><a href="#å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜-é‡æ¼”å»¶è¿Ÿ" class="headerlink" title="å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜_é‡æ¼”å»¶è¿Ÿ"></a>å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜_é‡æ¼”å»¶è¿Ÿ</h3><ul>
<li>mysql5.5ä¹‹å‰æ²¡æœ‰è§£å†³æ–¹æ¡ˆâ€”â€”å•çº¿ç¨‹</li>
<li>mysql5.6ï¼ˆmariadb10ï¼‰å¼€å§‹â€”â€”ä¸€åº“ä¸€çº¿ç¨‹</li>
<li>mysql5.7ï¼ˆmariadb10.1ï¼‰çœŸæ­£è§£å†³äº†â€”â€”ä¸€ç»„ä¸€çº¿ç¨‹</li>
</ul>
<p><img src="pic/32.png" alt=""></p>
<h4 id="é¡¹ç›®å®æˆ˜3ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„"><a href="#é¡¹ç›®å®æˆ˜3ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„" class="headerlink" title="é¡¹ç›®å®æˆ˜3ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„"></a>é¡¹ç›®å®æˆ˜3ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„</h4><p>MySQL 5.7æ‰å¯ç§°ä¸ºçœŸæ­£çš„å¹¶è¡Œå¤åˆ¶ï¼Œè¿™å…¶ä¸­æœ€ä¸ºä¸»è¦çš„åŸå› å°±æ˜¯slaveæœåŠ¡å™¨çš„å›æ”¾ä¸ä¸»æœºæ˜¯ä¸€è‡´çš„å³masteræœåŠ¡å™¨ä¸Šæ˜¯æ€ä¹ˆå¹¶è¡Œæ‰§è¡Œçš„slaveä¸Šå°±æ€æ ·è¿›è¡Œå¹¶è¡Œå›æ”¾ã€‚</p>
<p>MTS: Prepared transactions slave parallel applier </p>
<p>è¯¥å¹¶è¡Œå¤åˆ¶çš„æ€æƒ³æœ€æ—©æ˜¯ç”±MariaDBçš„Kristainæå‡ºï¼Œå¹¶å·²åœ¨MariaDB 10ä¸­å‡ºç°ï¼Œç›¸ä¿¡å¾ˆå¤šé€‰æ‹©MariaDBçš„å°ä¼™ä¼´æœ€ä¸ºçœ‹é‡çš„åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å¹¶è¡Œå¤åˆ¶ã€‚</p>
<p>MySQL 5.7å¹¶è¡Œå¤åˆ¶çš„æ€æƒ³ç®€å•æ˜“æ‡‚ï¼Œä¸€è¨€ä»¥è”½ä¹‹ï¼šä¸€ä¸ªç»„æäº¤çš„äº‹åŠ¡éƒ½æ˜¯å¯ä»¥å¹¶è¡Œå›æ”¾ï¼Œå› ä¸ºè¿™äº›äº‹åŠ¡éƒ½å·²è¿›å…¥åˆ°äº‹åŠ¡çš„prepareé˜¶æ®µï¼Œåˆ™è¯´æ˜äº‹åŠ¡ä¹‹é—´æ²¡æœ‰ä»»ä½•å†²çªï¼ˆå¦åˆ™å°±ä¸å¯èƒ½æäº¤ï¼‰ã€‚</p>
<blockquote>
<h4 id="è®¾ç½®é‡æ¼”æ¨¡å¼slave-parallel-type"><a href="#è®¾ç½®é‡æ¼”æ¨¡å¼slave-parallel-type" class="headerlink" title="è®¾ç½®é‡æ¼”æ¨¡å¼slave-parallel-type"></a>è®¾ç½®é‡æ¼”æ¨¡å¼<code>slave-parallel-type</code></h4></blockquote>
<p>ä¸ºäº†å…¼å®¹MySQL 5.6åŸºäºåº“çš„å¹¶è¡Œå¤åˆ¶ï¼Œ5.7å¼•å…¥äº†æ–°çš„å˜é‡<code>slave-parallel-type</code>ï¼Œå…¶å¯ä»¥é…ç½®çš„å€¼æœ‰ï¼š</p>
<ul>
<li>DATABASEï¼šé»˜è®¤å€¼ï¼ŒåŸºäºåº“çš„å¹¶è¡Œå¤åˆ¶æ–¹å¼</li>
<li>LOGICAL_CLOCKï¼šåŸºäºç»„æäº¤çš„å¹¶è¡Œå¤åˆ¶æ–¹å¼</li>
</ul>
<p>æ”¯æŒå¹¶è¡Œå¤åˆ¶çš„GTID</p>
<p>last_committed</p>
<p>sequence_number</p>
<p>å¹¶è¡Œå¤åˆ¶é…ç½®ä¸è°ƒä¼˜<br>master_info_repository</p>
<blockquote>
<h4 id="è®¾ç½®é‡æ¼”çº¿ç¨‹æ•°slave-parallel-workers"><a href="#è®¾ç½®é‡æ¼”çº¿ç¨‹æ•°slave-parallel-workers" class="headerlink" title="è®¾ç½®é‡æ¼”çº¿ç¨‹æ•°slave_parallel_workers"></a>è®¾ç½®é‡æ¼”çº¿ç¨‹æ•°<code>slave_parallel_workers</code></h4></blockquote>
<ul>
<li>slave_parallel_workersè®¾ç½®ä¸º0ï¼Œåˆ™MySQL 5.7é€€åŒ–ä¸ºåŸå•çº¿ç¨‹å¤åˆ¶</li>
<li>slave_parallel_workersè®¾ç½®ä¸º1ï¼Œåˆ™SQLçº¿ç¨‹åŠŸèƒ½è½¬åŒ–ä¸ºcoordinatorçº¿ç¨‹ï¼Œä½†æ˜¯åªæœ‰1ä¸ªworkerçº¿ç¨‹è¿›è¡Œå›æ”¾ï¼Œä¹Ÿæ˜¯å•çº¿ç¨‹å¤åˆ¶ã€‚ç„¶è€Œï¼Œè¿™ä¸¤ç§æ€§èƒ½å´åˆæœ‰ä¸€äº›çš„åŒºåˆ«ï¼Œå› ä¸ºå¤šäº†ä¸€æ¬¡coordinator<br>çº¿ç¨‹çš„è½¬å‘ï¼Œå› æ­¤slave_parallel_workers=1çš„æ€§èƒ½åè€Œæ¯”0è¿˜è¦å·®</li>
</ul>
<blockquote>
<h4 id="Enhanced-Multi-Threaded-Slaveé…ç½®æ€»ç»“"><a href="#Enhanced-Multi-Threaded-Slaveé…ç½®æ€»ç»“" class="headerlink" title="Enhanced Multi-Threaded Slaveé…ç½®æ€»ç»“"></a>Enhanced Multi-Threaded Slaveé…ç½®æ€»ç»“</h4></blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> slave</span></span><br><span class="line">slave-parallel-type=LOGICAL_CLOCK</span><br><span class="line">slave-parallel-workers=16</span><br><span class="line">master_info_repository=TABLE</span><br><span class="line">relay_log_info_repository=TABLE</span><br><span class="line">relay_log_recovery=ON</span><br></pre></td></tr></table></figure>

<p><img src="pic/66.jpg" alt=""></p>
<blockquote>
<h4 id="è½¯ä»¶å®‰è£…"><a href="#è½¯ä»¶å®‰è£…" class="headerlink" title="è½¯ä»¶å®‰è£…"></a>è½¯ä»¶å®‰è£…</h4></blockquote>
<table>
<thead>
<tr>
<th align="left">host</th>
<th align="left">ip</th>
<th align="left">software</th>
</tr>
</thead>
<tbody><tr>
<td align="left">masterb</td>
<td align="left">172.25.0.12</td>
<td align="left">mysql-community-server-5.7</td>
</tr>
<tr>
<td align="left">slaveb</td>
<td align="left">172.25.0.14</td>
<td align="left">mysql-community-server-5.7</td>
</tr>
</tbody></table>
<blockquote>
<h4 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4></blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># master</span></span></span><br><span class="line">	[mysqld]</span><br><span class="line"><span class="meta">	#</span><span class="bash"> AB replication</span></span><br><span class="line">	server-id=1</span><br><span class="line">	log-bin=/var/lib/mysql-log/masterb</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> GTID</span></span><br><span class="line">	gtid_mode=on</span><br><span class="line">	enforce_gtid_consistency=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># slave</span></span></span><br><span class="line">	[mysqld]</span><br><span class="line"><span class="meta">	#</span><span class="bash"> AB replication</span></span><br><span class="line">	server-id=2</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> open gtid mode</span></span><br><span class="line">	gtid_mode=on</span><br><span class="line">	enforce_gtid_consistency=1</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> MTS ä¸€ç»„ä¸€çº¿ç¨‹</span></span><br><span class="line">	slave-parallel-type=logical_clock</span><br><span class="line">	slave-parallel-workers=16</span><br></pre></td></tr></table></figure>

<blockquote>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>MySQL 5.7æ¨å‡ºçš„Enhanced Multi-Threaded Slaveè§£å†³äº†å›°æ‰°MySQLé•¿è¾¾æ•°åå¹´çš„å¤åˆ¶å»¶è¿Ÿé—®é¢˜</p>
</blockquote>
<h4 id="é¡¹ç›®å®æˆ˜4ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„crash-safeå‚æ•°è°ƒä¼˜"><a href="#é¡¹ç›®å®æˆ˜4ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„crash-safeå‚æ•°è°ƒä¼˜" class="headerlink" title="é¡¹ç›®å®æˆ˜4ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„crash safeå‚æ•°è°ƒä¼˜"></a>é¡¹ç›®å®æˆ˜4ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„crash safeå‚æ•°è°ƒä¼˜</h4><p>Master<br>sync_binlog=1 #å¼ºåˆ¶åˆ·æ–°binlogåˆ°ç£ç›˜<br>innodb_flush_log_at_trx_commit=1 #å¼ºåˆ¶åˆ·æ–°redologåˆ°ç£ç›˜</p>
<p>Slave<br>relay_log_recovery=1 #å¦‚æœslaveçš„ä¸­ç»§æ—¥å¿—å‡ºé—®é¢˜ï¼Œèƒ½å¤Ÿå†æ¬¡è‡ªåŠ¨è·å–masterçš„äºŒè¿›åˆ¶æ—¥å¿—</p>
<blockquote>
<h4 id="é…ç½®æ–‡ä»¶-1"><a href="#é…ç½®æ–‡ä»¶-1" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4></blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># master</span></span></span><br><span class="line">	[mysqld]</span><br><span class="line"><span class="meta">	#</span><span class="bash"> AB replication</span></span><br><span class="line">	server-id=1</span><br><span class="line">	log-bin=/var/lib/mysql-log/masterb</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> GTID</span></span><br><span class="line">	gtid_mode=on</span><br><span class="line">	enforce_gtid_consistency=1</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> crash safe</span></span><br><span class="line">	sync_binlog=1</span><br><span class="line">	innodb_flush_log_at_trx_commit=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># slave</span></span></span><br><span class="line">	[mysqld]</span><br><span class="line"><span class="meta">	#</span><span class="bash"> AB replication</span></span><br><span class="line">	server-id=2</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> open gtid mode</span></span><br><span class="line">	gtid_mode=on</span><br><span class="line">	enforce_gtid_consistency=1</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> slave crash</span></span><br><span class="line">	relay_log_recovery=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> MTS ä¸€ç»„ä¸€çº¿ç¨‹</span></span><br><span class="line">	slave-parallel-type=logical_clock</span><br><span class="line">	slave-parallel-workers=16</span><br></pre></td></tr></table></figure>

<blockquote>
<h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2></blockquote>
<p>crash safe æ‰“å¼€åèƒ½å¤Ÿæ›´å¥½çš„ä¿è¯åœ¨æ•°æ®åº“å‡ºç°æ–­ç”µç­‰ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ•°æ®å°½å¯èƒ½åœ°å°‘ä¸¢å¤±ï¼</p>
<h3 id="å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜-è¯»å†™åˆ†ç¦»"><a href="#å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜-è¯»å†™åˆ†ç¦»" class="headerlink" title="å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜_è¯»å†™åˆ†ç¦»"></a>å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜_è¯»å†™åˆ†ç¦»</h3><p><img src="pic/26-rep4.png" alt="rep1"></p>
<p>ä¸»æœåŠ¡å™¨å†™å…¥ï¼ŒåŒæ­¥åˆ°ä»æœåŠ¡å™¨ï¼Œåœ¨ä»æœåŠ¡å™¨ä¸­è¯»å–æ•°æ®ï¼Œä¸€èˆ¬ä¸€å°ä¸»æœåŠ¡å™¨ï¼Œå¤šå°ä»æœåŠ¡å™¨(5.7ç‰ˆæœ¬ä»¥åæ”¯æŒå¤šmasterï¼Œä¹‹å‰éƒ½æ˜¯ä¸€ä¸ªmaster )</p>
<p><img src="pic/30.png" alt=""></p>
<p><img src="pic/24-rep1.png" alt="rep2"></p>
<p>ä»MySQL5.5å¼€å§‹ï¼ŒMySQLä»¥æ’ä»¶çš„å½¢å¼æ”¯æŒåŠåŒæ­¥å¤åˆ¶ã€‚</p>
<p>å¼‚æ­¥å¤åˆ¶ï¼ˆAsynchronous replicationï¼‰</p>
<p>MySQLé»˜è®¤çš„å¤åˆ¶å³æ˜¯å¼‚æ­¥çš„ï¼Œä¸»åº“åœ¨æ‰§è¡Œå®Œå®¢æˆ·ç«¯æäº¤çš„äº‹åŠ¡åä¼šç«‹å³å°†ç»“æœè¿”ç»™ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¸å…³å¿ƒä»åº“æ˜¯å¦å·²ç»æ¥æ”¶å¹¶å¤„ç†ï¼Œè¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸»å¦‚æœcrashæ‰äº†ï¼Œæ­¤æ—¶ä¸»ä¸Šå·²ç»æäº¤çš„äº‹åŠ¡å¯èƒ½å¹¶æ²¡æœ‰ä¼ åˆ°ä»ä¸Šï¼Œå¦‚æœæ­¤æ—¶ï¼Œå¼ºè¡Œå°†ä»æå‡ä¸ºä¸»ï¼Œå¯èƒ½å¯¼è‡´æ–°ä¸»ä¸Šçš„æ•°æ®ä¸å®Œæ•´ã€‚</p>
<p>å…¨åŒæ­¥å¤åˆ¶ï¼ˆFully synchronous replicationï¼‰</p>
<p>æŒ‡å½“ä¸»åº“æ‰§è¡Œå®Œä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰€æœ‰çš„ä»åº“éƒ½æ‰§è¡Œäº†è¯¥äº‹åŠ¡æ‰è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å› ä¸ºéœ€è¦ç­‰å¾…æ‰€æœ‰ä»åº“æ‰§è¡Œå®Œè¯¥äº‹åŠ¡æ‰èƒ½è¿”å›ï¼Œæ‰€ä»¥å…¨åŒæ­¥å¤åˆ¶çš„æ€§èƒ½å¿…ç„¶ä¼šæ”¶åˆ°ä¸¥é‡çš„å½±å“ã€‚</p>
<p>åŠåŒæ­¥å¤åˆ¶ï¼ˆSemisynchronous replicationï¼‰</p>
<p>ä»‹äºå¼‚æ­¥å¤åˆ¶å’Œå…¨åŒæ­¥å¤åˆ¶ä¹‹é—´ï¼Œä¸»åº“åœ¨æ‰§è¡Œå®Œå®¢æˆ·ç«¯æäº¤çš„äº‹åŠ¡åä¸æ˜¯ç«‹åˆ»è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯ç­‰å¾…è‡³å°‘ä¸€ä¸ªä»åº“æ¥æ”¶åˆ°å¹¶å†™åˆ°relay logä¸­æ‰è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ç›¸å¯¹äºå¼‚æ­¥å¤åˆ¶ï¼ŒåŠåŒæ­¥å¤åˆ¶æé«˜äº†æ•°æ®çš„å®‰å…¨æ€§ï¼ŒåŒæ—¶å®ƒä¹Ÿé€ æˆäº†ä¸€å®šç¨‹åº¦çš„å»¶è¿Ÿï¼Œè¿™ä¸ªå»¶è¿Ÿæœ€å°‘æ˜¯ä¸€ä¸ªTCP/IPå¾€è¿”çš„æ—¶é—´ã€‚æ‰€ä»¥ï¼ŒåŠåŒæ­¥å¤åˆ¶æœ€å¥½åœ¨ä½å»¶æ—¶çš„ç½‘ç»œä¸­ä½¿ç”¨ã€‚</p>
<h4 id="åŠåŒæ­¥å¤åˆ¶çš„æ½œåœ¨é—®é¢˜"><a href="#åŠåŒæ­¥å¤åˆ¶çš„æ½œåœ¨é—®é¢˜" class="headerlink" title="åŠåŒæ­¥å¤åˆ¶çš„æ½œåœ¨é—®é¢˜"></a>åŠåŒæ­¥å¤åˆ¶çš„æ½œåœ¨é—®é¢˜</h4><p>å®¢æˆ·ç«¯äº‹åŠ¡åœ¨å­˜å‚¨å¼•æ“å±‚æäº¤åï¼Œåœ¨å¾—åˆ°ä»åº“ç¡®è®¤çš„è¿‡ç¨‹ä¸­ï¼Œä¸»åº“å®•æœºäº†ï¼Œæ­¤æ—¶ï¼Œå¯èƒ½çš„æƒ…å†µæœ‰ä¸¤ç§</p>
<p>1.äº‹åŠ¡è¿˜æ²¡å‘é€åˆ°ä»åº“ä¸Š</p>
<p>æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°äº‹åŠ¡æäº¤å¤±è´¥çš„ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯ä¼šé‡æ–°æäº¤è¯¥äº‹åŠ¡åˆ°æ–°çš„ä¸»ä¸Šï¼Œå½“å®•æœºçš„ä¸»åº“é‡æ–°å¯åŠ¨åï¼Œä»¥ä»åº“çš„èº«ä»½é‡æ–°åŠ å…¥åˆ°è¯¥ä¸»ä»ç»“æ„ä¸­ï¼Œä¼šå‘ç°ï¼Œè¯¥äº‹åŠ¡åœ¨ä»åº“ä¸­è¢«æäº¤äº†ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯ä¹‹å‰ä½œä¸ºä¸»çš„æ—¶å€™ï¼Œä¸€æ¬¡æ˜¯è¢«æ–°ä¸»åŒæ­¥è¿‡æ¥çš„ã€‚</p>
<p>2.äº‹åŠ¡å·²ç»å‘é€åˆ°ä»åº“ä¸Š</p>
<p>æ­¤æ—¶ï¼Œä»åº“å·²ç»æ”¶åˆ°å¹¶åº”ç”¨äº†è¯¥äº‹åŠ¡ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä»ç„¶ä¼šæ”¶åˆ°äº‹åŠ¡æäº¤å¤±è´¥çš„ä¿¡æ¯ï¼Œé‡æ–°æäº¤è¯¥äº‹åŠ¡åˆ°æ–°çš„ä¸»ä¸Šã€‚</p>
<h4 id="æ— æ•°æ®ä¸¢å¤±çš„åŠåŒæ­¥å¤åˆ¶"><a href="#æ— æ•°æ®ä¸¢å¤±çš„åŠåŒæ­¥å¤åˆ¶" class="headerlink" title="æ— æ•°æ®ä¸¢å¤±çš„åŠåŒæ­¥å¤åˆ¶"></a>æ— æ•°æ®ä¸¢å¤±çš„åŠåŒæ­¥å¤åˆ¶</h4><p>é’ˆå¯¹ä¸Šè¿°æ½œåœ¨é—®é¢˜ï¼ŒMySQL 5.7å¼•å…¥äº†ä¸€ç§æ–°çš„åŠåŒæ­¥æ–¹æ¡ˆï¼šLoss-LessåŠåŒæ­¥å¤åˆ¶ã€‚</p>
<p>å½“ç„¶ï¼Œä¹‹å‰çš„åŠåŒæ­¥æ–¹æ¡ˆåŒæ ·æ”¯æŒï¼ŒMySQL 5.7.2å¼•å…¥äº†ä¸€ä¸ªæ–°çš„å‚æ•°è¿›è¡Œæ§åˆ¶-<code>rpl_semi_sync_master_wait_point</code></p>
<p>rpl_semi_sync_master_wait_pointæœ‰ä¸¤ç§å–å€¼</p>
<p><code>AFTER_SYNC</code> è¿™ä¸ªå³æ–°çš„åŠåŒæ­¥æ–¹æ¡ˆï¼ŒWaiting Slave dumpåœ¨Storage Commitä¹‹å‰ã€‚</p>
<p><code>AFTER_COMMIT</code> è€çš„åŠåŒæ­¥æ–¹æ¡ˆ</p>
<h4 id="é¡¹ç›®å®æˆ˜5ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»åŠåŒæ­¥æ¶æ„"><a href="#é¡¹ç›®å®æˆ˜5ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»åŠåŒæ­¥æ¶æ„" class="headerlink" title="é¡¹ç›®å®æˆ˜5ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»åŠåŒæ­¥æ¶æ„"></a>é¡¹ç›®å®æˆ˜5ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»åŠåŒæ­¥æ¶æ„</h4><p>è¦æƒ³ä½¿ç”¨åŠåŒæ­¥å¤åˆ¶ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š</p>
<ol>
<li><p>MySQL 5.5åŠä»¥ä¸Šç‰ˆæœ¬</p>
</li>
<li><p>å˜é‡have_dynamic_loadingä¸ºYES</p>
</li>
<li><p>å¼‚æ­¥å¤åˆ¶å·²ç»å­˜åœ¨</p>
</li>
</ol>
<p><img src="pic/31.png" alt="31.png"></p>
<blockquote>
<h4 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h4></blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> install plugin rpl_semi_sync_master soname <span class="string">'semisync_master.so'</span>;</span></span><br><span class="line">Query OK, 0 rows affected (0.10 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> install plugin rpl_semi_sync_slave soname <span class="string">'semisync_slave.so'</span>;</span></span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<h4 id="é…ç½®æ–‡ä»¶-2"><a href="#é…ç½®æ–‡ä»¶-2" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4></blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># master</span></span></span><br><span class="line">	[mysqld]</span><br><span class="line"><span class="meta">	#</span><span class="bash"> AB replication</span></span><br><span class="line">	server-id=1</span><br><span class="line">	log-bin=/var/lib/mysql-log/masterb</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> GTID</span></span><br><span class="line">	gtid_mode=on</span><br><span class="line">	enforce_gtid_consistency=1</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> crash safe</span></span><br><span class="line">	sync_binlog=1</span><br><span class="line">	innodb_flush_log_at_trx_commit=1</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> åŠåŒæ­¥æ¨¡å¼</span></span><br><span class="line">	rpl_semi_sync_master_enabled=1</span><br><span class="line">	rpl_semi_sync_master_timeout=1000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># slave</span></span></span><br><span class="line">	[mysqld]</span><br><span class="line"><span class="meta">	#</span><span class="bash"> AB replication</span></span><br><span class="line">	server-id=2</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> open gtid mode</span></span><br><span class="line">	gtid_mode=on</span><br><span class="line">	enforce_gtid_consistency=1</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> slave crash</span></span><br><span class="line">	relay_log_recovery=1</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> MTS ä¸€ç»„ä¸€çº¿ç¨‹</span></span><br><span class="line">	slave-parallel-type=logical_clock</span><br><span class="line">	slave-parallel-workers=16</span><br><span class="line"></span><br><span class="line"><span class="meta">	#</span><span class="bash"> åŠåŒæ­¥æ¨¡å¼</span></span><br><span class="line">	rpl_semi_sync_slave_enabled=1</span><br></pre></td></tr></table></figure>

<blockquote>
<h4 id="æµ‹è¯•åŠåŒæ­¥å¤åˆ¶è¶…æ—¶åè‡ªåŠ¨åˆ‡æ¢å›å¼‚æ­¥æ¨¡å¼"><a href="#æµ‹è¯•åŠåŒæ­¥å¤åˆ¶è¶…æ—¶åè‡ªåŠ¨åˆ‡æ¢å›å¼‚æ­¥æ¨¡å¼" class="headerlink" title="æµ‹è¯•åŠåŒæ­¥å¤åˆ¶è¶…æ—¶åè‡ªåŠ¨åˆ‡æ¢å›å¼‚æ­¥æ¨¡å¼"></a>æµ‹è¯•åŠåŒæ­¥å¤åˆ¶è¶…æ—¶åè‡ªåŠ¨åˆ‡æ¢å›å¼‚æ­¥æ¨¡å¼</h4></blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create database db1;</span></span><br><span class="line">Query OK, 1 row affected (0.06 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table db1.t1 (id int);</span></span><br><span class="line">Query OK, 0 rows affected (0.26 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into db1.t1 values (1);</span></span><br><span class="line">Query OK, 1 row affected (0.23 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†slaveå…³é—­åå†æ‰§è¡Œä»¥ä¸‹æ“ä½œ</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into db1.t1 values (2);</span></span><br><span class="line">Query OK, 1 row affected (1.19 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into db1.t1 values (3);</span></span><br><span class="line">Query OK, 1 row affected (0.36 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into db1.t1 values (4);</span></span><br><span class="line">Query OK, 1 row affected (0.08 sec)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä»æœºæƒ³å›åˆ°åŠå¼‚æ­¥æ¨¡å¼ï¼Œéœ€è¦é‡å¯slaveï¼Œå¦åˆ™é»˜è®¤è¿˜æ˜¯å¼‚æ­¥å¤åˆ¶ã€‚</p>
<blockquote>
<h4 id="ç›‘æ§ä¸»ä»æ˜¯å¦è¿è¡Œåœ¨åŠåŒæ­¥å¤åˆ¶æ¨¡å¼ä¸‹"><a href="#ç›‘æ§ä¸»ä»æ˜¯å¦è¿è¡Œåœ¨åŠåŒæ­¥å¤åˆ¶æ¨¡å¼ä¸‹" class="headerlink" title="ç›‘æ§ä¸»ä»æ˜¯å¦è¿è¡Œåœ¨åŠåŒæ­¥å¤åˆ¶æ¨¡å¼ä¸‹"></a>ç›‘æ§ä¸»ä»æ˜¯å¦è¿è¡Œåœ¨åŠåŒæ­¥å¤åˆ¶æ¨¡å¼ä¸‹</h4></blockquote>
<ul>
<li><code>show status like &#39;rpl_semi_sync_master_status&#39;;</code></li>
<li><code>show status like &#39;rpl_semi_sync_slave_status&#39;;</code></li>
</ul>
<blockquote>
<h4 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h4></blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show variables like <span class="string">'%Rpl%'</span>;</span></span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line">| Variable_name                             | Value      |</span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line">| rpl_semi_sync_master_enabled              | ON         |</span><br><span class="line">| rpl_semi_sync_master_timeout              | 10000      |</span><br><span class="line">| rpl_semi_sync_master_trace_level          | 32         |</span><br><span class="line">| rpl_semi_sync_master_wait_for_slave_count | 1          |</span><br><span class="line">| rpl_semi_sync_master_wait_no_slave        | ON         |</span><br><span class="line">| rpl_semi_sync_master_wait_point           | AFTER_SYNC |</span><br><span class="line">| rpl_stop_slave_timeout                    | 31536000   |</span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line">7 rows in set (0.30 sec)</span><br></pre></td></tr></table></figure>

<p><code>rpl_semi_sync_master_wait_for_slave_count</code></p>
<p>MySQL 5.7.3å¼•å…¥çš„ï¼Œè¯¥å˜é‡è®¾ç½®ä¸»éœ€è¦ç­‰å¾…å¤šå°‘ä¸ªslaveåº”ç­”ï¼Œæ‰èƒ½è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œé»˜è®¤ä¸º1ã€‚</p>
<p><code>rpl_semi_sync_master_wait_no_slave</code></p>
<p>ON</p>
<p>é»˜è®¤å€¼ï¼Œå½“çŠ¶æ€å˜é‡Rpl_semi_sync_master_clientsä¸­çš„å€¼å°äºrpl_semi_sync_master_wait_for_slave_countæ—¶ï¼ŒRpl_semi_sync_master_statusä¾æ—§æ˜¾ç¤ºä¸ºONã€‚</p>
<p>OFF</p>
<p>å½“çŠ¶æ€å˜é‡Rpl_semi_sync_master_clientsä¸­çš„å€¼äºrpl_semi_sync_master_wait_for_slave_countæ—¶ï¼ŒRpl_semi_sync_master_statusç«‹å³æ˜¾ç¤ºä¸ºOFFï¼Œå³å¼‚æ­¥å¤åˆ¶ã€‚</p>
<p>è¯´å¾—ç›´ç™½ä¸€ç‚¹ï¼Œå¦‚æœæˆ‘çš„æ¶æ„æ˜¯1ä¸»2ä»ï¼Œ2ä¸ªä»éƒ½é‡‡ç”¨äº†åŠåŒæ­¥å¤åˆ¶ï¼Œä¸”è®¾ç½®çš„æ˜¯rpl_semi_sync_master_wait_for_slave_count=2ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæŒ‚æ‰äº†ï¼Œå¯¹äºrpl_semi_sync_master_wait_no_slaveè®¾ç½®ä¸ºONçš„æƒ…å†µï¼Œæ­¤æ—¶æ˜¾ç¤ºçš„ä»ç„¶æ˜¯åŠåŒæ­¥å¤åˆ¶ï¼Œå¦‚æœrpl_semi_sync_master_wait_no_slaveè®¾ç½®ä¸ºOFFï¼Œåˆ™ä¼šç«‹åˆ»å˜æˆå¼‚æ­¥å¤åˆ¶ã€‚</p>
<blockquote>
<h4 id="çŠ¶æ€å˜é‡"><a href="#çŠ¶æ€å˜é‡" class="headerlink" title="çŠ¶æ€å˜é‡"></a>çŠ¶æ€å˜é‡</h4></blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show status like <span class="string">'%Rpl_semi%'</span>;</span></span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name                              | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients               | 1     |</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_waits             | 6     |</span><br><span class="line">| Rpl_semi_sync_master_no_times              | 1     |</span><br><span class="line">| Rpl_semi_sync_master_no_tx                 | 1     |</span><br><span class="line">| Rpl_semi_sync_master_status                | ON    |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time      | 1120  |</span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time          | 4483  |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits              | 4     |</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx                | 4     |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>


<p>ä¸Šè¿°çŠ¶æ€å˜é‡ä¸­ï¼Œæ¯”è¾ƒé‡è¦çš„æœ‰ä»¥ä¸‹å‡ ä¸ª</p>
<p><code>Rpl_semi_sync_master_clients</code></p>
<p>å½“å‰åŠåŒæ­¥å¤åˆ¶ä»çš„ä¸ªæ•°ï¼Œå¦‚æœæ˜¯ä¸€ä¸»å¤šä»çš„æ¶æ„ï¼Œå¹¶ä¸åŒ…å«å¼‚æ­¥å¤åˆ¶ä»çš„ä¸ªæ•°ã€‚</p>
<p><code>Rpl_semi_sync_master_no_tx</code></p>
<p>The number of commits that were not acknowledged successfully by a slave.</p>
<p>å…·ä½“åˆ°ä¸Šé¢çš„æµ‹è¯•ä¸­ï¼ŒæŒ‡çš„æ˜¯insert into test.test values(2)è¿™ä¸ªäº‹åŠ¡ã€‚</p>
<p><code>Rpl_semi_sync_master_yes_tx</code></p>
<p>The number of commits that were acknowledged successfully by a slave.</p>
<blockquote>
<h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3></blockquote>
<ol>
<li><p>åœ¨ä¸€ä¸»å¤šä»çš„æ¶æ„ä¸­ï¼Œå¦‚æœè¦å¼€å¯åŠåŒæ­¥å¤åˆ¶ï¼Œå¹¶ä¸è¦æ±‚æ‰€æœ‰çš„ä»éƒ½æ˜¯åŠåŒæ­¥å¤åˆ¶ã€‚</p>
</li>
<li><p>MySQL 5.7æå¤§çš„æå‡äº†åŠåŒæ­¥å¤åˆ¶çš„æ€§èƒ½ã€‚</p>
<p> 5.6ç‰ˆæœ¬çš„åŠåŒæ­¥å¤åˆ¶ï¼Œdump thread æ‰¿æ‹…äº†ä¸¤ä»½ä¸åŒä¸”åˆååˆ†é¢‘ç¹çš„ä»»åŠ¡ï¼šä¼ é€binlog ç»™slave ï¼Œè¿˜éœ€è¦ç­‰å¾…slaveåé¦ˆä¿¡æ¯ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªä»»åŠ¡æ˜¯ä¸²è¡Œçš„ï¼Œdump thread å¿…é¡»ç­‰å¾… slave è¿”å›ä¹‹åæ‰ä¼šä¼ é€ä¸‹ä¸€ä¸ª events äº‹åŠ¡ã€‚dump thread å·²ç„¶æˆä¸ºæ•´ä¸ªåŠåŒæ­¥æé«˜æ€§èƒ½çš„ç“¶é¢ˆã€‚åœ¨é«˜å¹¶å‘ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œè¿™æ ·çš„æœºåˆ¶ä¼šå½±å“æ•°æ®åº“æ•´ä½“çš„TPS ã€‚</p>
<p> 5.7ç‰ˆæœ¬çš„åŠåŒæ­¥å¤åˆ¶ä¸­ï¼Œç‹¬ç«‹å‡ºä¸€ä¸ª ack collector thread ï¼Œä¸“é—¨ç”¨äºæ¥æ”¶slave çš„åé¦ˆä¿¡æ¯ã€‚è¿™æ ·master ä¸Šæœ‰ä¸¤ä¸ªçº¿ç¨‹ç‹¬ç«‹å·¥ä½œï¼Œå¯ä»¥åŒæ—¶å‘é€binlog åˆ°slave ï¼Œå’Œæ¥æ”¶slaveçš„åé¦ˆã€‚ </p>
</li>
</ol>
<h3 id="å¤åˆ¶ä¸­çš„å•ç‚¹æ•…éšœé—®é¢˜"><a href="#å¤åˆ¶ä¸­çš„å•ç‚¹æ•…éšœé—®é¢˜" class="headerlink" title="å¤åˆ¶ä¸­çš„å•ç‚¹æ•…éšœé—®é¢˜"></a>å¤åˆ¶ä¸­çš„å•ç‚¹æ•…éšœé—®é¢˜</h3><h4 id="å¤åˆ¶æ‹“æ‰‘-é…ç½®M-S-S"><a href="#å¤åˆ¶æ‹“æ‰‘-é…ç½®M-S-S" class="headerlink" title="å¤åˆ¶æ‹“æ‰‘_é…ç½®M-S-S"></a>å¤åˆ¶æ‹“æ‰‘_é…ç½®M-S-S</h4><p>æœ‰å¾ˆå¤šå¤æ‚çš„æ‹“æ‰‘ç»“æ„ï¼Œä½†å³ä½¿æ˜¯æœ€ç®€å•çš„ä¹Ÿå¯èƒ½ä¼šéå¸¸çµæ´»ã€‚ä¸€ç§æ‹“æ‰‘å¯ä»¥æœ‰å¤šç§ç”¨é€”ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è®¨è®ºä¸€äº›æ¯”è¾ƒæ™®éçš„æ‹“æ‰‘ç»“æ„ä»¥åŠå®ƒä»¬çš„ä¼˜ç¼ºç‚¹ã€‚è®°ä½ä¸‹é¢çš„åŸºæœ¬åŸåˆ™ï¼š</p>
<ul>
<li>æ¯ä¸ªå¤‡åº“å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„æœåŠ¡å™¨ID</li>
<li>ä¸€ä¸ªä¸»åº“å¯ä»¥æœ‰å¤šä¸ªå¤‡åº“</li>
<li>mysql5.7å¼€å§‹ä¸€ä¸ªå¤‡åº“å¯ä»¥æœ‰å¤šä¸ªä¸»åº“(multisource replication)</li>
<li>å¦‚æœæ‰“å¼€äº†log_save_updatesé€‰é¡¹ï¼Œä¸€ä¸ªå¤‡åº“å¯ä»¥æŠŠå…¶ä¸»åº“ä¸Šçš„æ•°æ®å˜åŒ–ä¼ æ’­åˆ°å…¶ä»–å¤‡åº“</li>
</ul>
<p>ä¸€ä¸»åº“å¤šå¤‡åº“çš„ç»“æ„ï¼Œå¤‡åº“ä¹‹é—´æ²¡æœ‰äº¤äº’ï¼Œå®ƒä»¬ä»…ä»…æ˜¯è¿æ¥åˆ°åŒä¸€ä¸ªä¸»åº“ä¸Šã€‚</p>
<p><img src="pic/26-rep5.png" alt="rep5"></p>
<p>å°½ç®¡è¿™æ˜¯éå¸¸ç®€å•çš„æ‹“æ‰‘ç»“æ„ï¼Œä½†å®ƒéå¸¸çµæ´»ï¼Œèƒ½æ»¡è¶³å¤šç§éœ€æ±‚ã€‚</p>
<p><em>ç”¨é€”ï¼š</em></p>
<ul>
<li>ä¸ºä¸åŒçš„è§’è‰²ä½¿ç”¨ä¸åŒçš„å¤‡åº“ï¼ˆä¾‹å¦‚æ·»åŠ ä¸åŒçš„ç´¢å¼•æˆ–ä½¿ç”¨ä¸åŒçš„å­˜å‚¨å¼•æ“ï¼‰ã€‚</li>
<li>æŠŠä¸€å°å¤‡åº“å½“ä½œå¾…ç”¨çš„ä¸»åº“ï¼Œé™¤äº†å¤åˆ¶æ²¡æœ‰å…¶ä»–æ•°æ®ä¼ è¾“ã€‚</li>
<li>å°†ä¸€å°å¤‡åº“æ”¾åˆ°è¿œç¨‹æ•°æ®ä¸­å¿ƒï¼Œç”¨ä½œç¾éš¾æ¢å¤ã€‚</li>
<li>å»¶è¿Ÿä¸€ä¸ªæˆ–å¤šä¸ªå¤‡åº“ï¼Œä»¥å¤‡ç¾éš¾æ¢å¤ã€‚</li>
<li>ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªå¤‡åº“ï¼Œä½œä¸ºå¤‡ä»½ã€åŸ¹è®­æˆ–è€…æµ‹è¯•ä½¿ç”¨æœåŠ¡å™¨ã€‚</li>
</ul>
<p><em>ä¼˜ç‚¹</em> ï¼šé¿å…äº†å¾ˆå¤šå…¶ä»–æ‹“æ‰‘ç»“æ„çš„å¤æ‚æ€§ã€‚</p>
<h4 id="å¤åˆ¶æ‹“æ‰‘-é…ç½®M-M"><a href="#å¤åˆ¶æ‹“æ‰‘-é…ç½®M-M" class="headerlink" title="å¤åˆ¶æ‹“æ‰‘_é…ç½®M-M"></a>å¤åˆ¶æ‹“æ‰‘_é…ç½®M-M</h4><p><em>ä¸»ä¸»å¤åˆ¶ï¼ˆä¹Ÿå«åšåŒä¸»å¤åˆ¶æˆ–åŒå‘å¤åˆ¶ï¼‰</em> åŒ…å«ä¸¤å°æœåŠ¡å™¨ï¼Œæ¯ä¸€ä¸ªéƒ½è¢«é…ç½®æˆå¯¹æ–¹çš„ä¸»åº“å’Œå¤‡åº“ï¼Œè¿˜å¥è¯è¯´ï¼Œå®ƒä»¬æ˜¯ä¸€å¯¹ä¸»åº“ã€‚</p>
<p><img src="pic/26-rep6.png" alt="rep6"></p>
<p><em>åº”ç”¨åœºæ™¯</em> é€šå¸¸ç”¨äºç‰¹æ®Šçš„ç›®çš„ã€‚ä¸€ä¸ªå¯èƒ½çš„åº”ç”¨åœºæ™¯æ˜¯ä¸¤ä¸ªä½äºä¸åŒåœ°ç†ä½ç½®çš„åŠå…¬å®¤ï¼Œå¹¶ä¸”éƒ½éœ€è¦ä¸€ä»½å¯å†™çš„æ•°æ®æ‹·è´ã€‚</p>
<p><em>æœ€å¤§çš„é—®é¢˜</em> ä¸¤ä¸ªå¯å†™çš„äº’ä¸»æœåŠ¡å™¨å¯¼è‡´çš„é—®é¢˜éå¸¸å¤šã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨ä¸¤å°æœåŠ¡å™¨åŒæ—¶ä¿®æ”¹ä¸€è¡Œè®°å½•ï¼Œæˆ–åŒæ—¶åœ¨é‡å¤ªæœåŠ¡å™¨ä¸Šå‘ä¸€ä¸ªåŒ…å«<code>auto_increment</code>åˆ—çš„è¡¨é‡Œæ’å…¥æ•°æ®ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œå…è®¸å‘ä¸¤å°æœåŠ¡å™¨ä¸Šå†™å¦‚å¸¦æ¥çš„éº»çƒ¦è¿œè¿œå¤§äºå…¶å¸¦æ¥çš„å¥½å¤„ã€‚</p>
<p><em>åŒä¸»æ­¥éª¤</em></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mastera masterb</span><br><span class="line">ä¸»	      ä»     å·²å®Œæˆ</span><br><span class="line">ä»	      ä¸»</span><br><span class="line">	# ä¸»æœåŠ¡å™¨ masterb</span><br><span class="line">	1ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶	log-bin&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql-log&#x2F;masterb</span><br><span class="line">			server-id&#x3D;2ï¼ˆé‡å¯æœåŠ¡ï¼‰</span><br><span class="line">			mkdir &#x2F;var&#x2F;lib&#x2F;mysql-log&#x2F;	--ugo,selinux</span><br><span class="line">	2)&gt; show master status\G;</span><br><span class="line"></span><br><span class="line">	# ä»æœåŠ¡ mastera</span><br><span class="line">	1ï¼‰æˆæƒä»æœº	grant replication slave to slave@172.25.0.11 uplooking   </span><br><span class="line">			(masterb &gt; show grants for slave@172.25.0.11;)</span><br><span class="line">	2ï¼‰&gt; change master master_host&#x3D;&#39;172.25.0.12&#39;</span><br><span class="line">			master_user&#x3D;&#39;slave&#39;</span><br><span class="line">			master_password&#x3D;&#39;uplooking&#39;</span><br><span class="line">			master_log_file&#x3D;&#39;&#39;</span><br><span class="line">			master_log_pos&#x3D;&#39;&#39;</span><br><span class="line">	3)&gt; start slave;</span><br><span class="line">	4)&gt; show slave status\G;</span><br><span class="line">	5)æµ‹è¯•</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®ç° mariadb 5.5 MySQL AB å¤åˆ¶ M-Méƒ¨ç½²</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åŒä¸»ä»</span></span><br><span class="line">[root@masterb0 ~]# vi /etc/my.cnf</span><br><span class="line">[root@masterb0 ~]# grep -v '^#' /etc/my.cnf|grep -v '^$'</span><br><span class="line">[mysqld]</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line">symbolic-links=0</span><br><span class="line">server-id=2</span><br><span class="line">log-bin=/var/lib/mysql-log/masterb</span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error=/var/log/mariadb/mariadb.log</span><br><span class="line">pid-file=/var/run/mariadb/mariadb.pid</span><br><span class="line">!includedir /etc/my.cnf.d</span><br><span class="line"></span><br><span class="line">[root@masterb0 ~]# mkdir /var/lib/mysql-log/</span><br><span class="line">[root@masterb0 ~]# chown mysql. /var/lib/mysql-log/</span><br><span class="line">[root@masterb0 ~]# getenforce</span><br><span class="line">Permissive</span><br><span class="line">[root@masterb0 ~]# systemctl restart mariadb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># é€šè¿‡åœ¨masteraä¸Šæ·»åŠ æˆæƒï¼ŒåŒæ­¥ç»™masterbï¼Œå…è®¸masteraå¯¹masterbæœ‰replication slaveçš„æƒé™</span></span></span><br><span class="line"></span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 7</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; grant replication slave on *.* to slave@'172.25.0.11' identified by 'uplooking';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># åˆ°masterbä¸Šæ£€æŸ¥æ˜¯å¦å·²ç»åŒæ­¥åˆ°å¯¹masteraçš„æˆæƒä¿¡æ¯</span></span></span><br><span class="line"></span><br><span class="line">[root@masterb0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 4</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show grants for slave@172.25.0.11;</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Grants for slave@172.25.0.11                                                                                               |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| GRANT REPLICATION SLAVE ON *.* TO 'slave'@'172.25.0.11' IDENTIFIED BY PASSWORD '*6FF883623B8639D08083FF411D20E6856EB7D2BF' |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æŸ¥çœ‹å½“å‰masterbçš„æ—¥å¿—å†™åˆ°å“ªé‡Œäº†ï¼Œå“ªä¸ªä½ç½®äº†</span></span></span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show master status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">            File: masterb.000001</span><br><span class="line">        Position: 245</span><br><span class="line">    Binlog_Do_DB:</span><br><span class="line">Binlog_Ignore_DB:</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># åœ¨masteraä¸Šæ“ä½œï¼Œchange master to</span></span></span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; change master to master_host='172.25.0.12',master_user='slave',master_password='uplooking',master_log_file='masterb.000001',master_log_pos=245;</span><br><span class="line">Query OK, 0 rows affected (0.20 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; start slave;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show slave status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.12</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: masterb.000001</span><br><span class="line">          Read_Master_Log_Pos: 245</span><br><span class="line">               Relay_Log_File: mariadb-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 527</span><br><span class="line">        Relay_Master_Log_File: masterb.000001</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 245</span><br><span class="line">              Relay_Log_Space: 823</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 2</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æµ‹è¯• åœ¨masterbä¸Šå†™æ•°æ®ï¼Œæµ‹è¯•masteraæ˜¯å¦èƒ½å¤ŸåŒæ­¥åˆ°</span></span></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values (100);</span><br><span class="line">Query OK, 1 row affected (0.06 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># åœ¨masteraä¸ŠæŸ¥çœ‹db1.t1è¡¨æ˜¯å¦åŒæ­¥åˆ°æ•°æ®äº†</span></span></span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+-----+</span><br><span class="line">| id  |</span><br><span class="line">+-----+</span><br><span class="line">|   1 |</span><br><span class="line">|   2 |</span><br><span class="line">| 100 |</span><br><span class="line">+-----+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values (100);</span><br><span class="line">Query OK, 1 row affected (0.06 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+-----+</span><br><span class="line">| id  |</span><br><span class="line">+-----+</span><br><span class="line">|   1 |</span><br><span class="line">|   2 |</span><br><span class="line">| 100 |</span><br><span class="line">+-----+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="å¤åˆ¶æ‹“æ‰‘-é…ç½®M-s-M-s"><a href="#å¤åˆ¶æ‹“æ‰‘-é…ç½®M-s-M-s" class="headerlink" title="å¤åˆ¶æ‹“æ‰‘_é…ç½®M(s)-M(s)"></a>å¤åˆ¶æ‹“æ‰‘_é…ç½®M(s)-M(s)</h4><p><em>æ‹¥æœ‰å¤‡åº“çš„ä¸»-ä¸»ç»“æ„</em> ä¸ºæ¯ä¸ªä¸»åº“å¢åŠ ä¸€ä¸ªå¤‡åº“ã€‚</p>
<p><img src="pic/26-rep7.png" alt="rep7"></p>
<p>è¯¥é…ç½®çš„ä¼˜ç‚¹æ˜¯å¢åŠ äº†å†—ä½™ï¼Œå¯¹äºä¸åŒç‰©ç†ä½ç½®çš„å¤åˆ¶æ‹“æ‰‘ï¼Œèƒ½å¤Ÿæ¶ˆé™¤ç«™ç‚¹å•ç‚¹å¤±æ•ˆçš„é—®é¢˜ã€‚è¿˜èƒ½åšè¯»å†™åˆ†ç¦»ã€‚</p>
<p>å¦‚æœåœ¨æœ¬åœ°ä¸ºäº†æ•…éšœè½¬ç§»ä½¿ç”¨ä¸»-ä¸»ç»“æ„ï¼Œè¿™ç§é…ç½®åŒæ ·æœ‰ç”¨ã€‚å½“ä¸»åº“å¤±æ•ˆæ—¶ï¼Œç”¨å¤‡åº“æ¥ä»£æ›¿ä¸»åº“è¿˜æ˜¯å¯è¡Œçš„ï¼Œè™½ç„¶è¿™ä¼˜ç‚¹å¤æ‚ï¼ŒåŒæ ·ä¹Ÿåº“ä¸€æŠŠå¤‡åº“æŒ‡å‘ä¸€ä¸ªä¸åŒçš„ä¸»åº“ï¼Œä½†éœ€è¦è€ƒè™‘å¢åŠ çš„å¤æ‚åº¦ã€‚</p>
<h4 id="å¤åˆ¶æ‹“æ‰‘-é…ç½®M-M-S-S"><a href="#å¤åˆ¶æ‹“æ‰‘-é…ç½®M-M-S-S" class="headerlink" title="å¤åˆ¶æ‹“æ‰‘_é…ç½®M-M-S-S"></a>å¤åˆ¶æ‹“æ‰‘_é…ç½®M-M-S-S</h4><p><em>MySQL 5.7 å¼€å§‹æ”¯æŒå¤šä¸»åº“å¤åˆ¶</em> å¤šä¸»åº“å¤åˆ¶ï¼ˆmultisource replicationï¼‰ç‰¹æŒ‡ä¸€ä¸ªå¤‡åº“æœ‰å¤šä¸ªä¸»åº“ã€‚5.7å¼€å§‹æ”¯æŒçš„ï¼Œæ„å‘³ç€5.7ä¹‹å‰çš„ç‰ˆæœ¬ä¸æ”¯æŒã€‚</p>
<h5 id="é¡¹ç›®å®æˆ˜6ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå¤šçº§ä¸»ä»-Multisource-åŠåŒæ­¥æ¶æ„"><a href="#é¡¹ç›®å®æˆ˜6ï¼šmysql-server-5-7-åŸºäºGTIDçš„å¹¶è¡ŒMTSå¤šçº§ä¸»ä»-Multisource-åŠåŒæ­¥æ¶æ„" class="headerlink" title="é¡¹ç›®å®æˆ˜6ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå¤šçº§ä¸»ä» Multisource åŠåŒæ­¥æ¶æ„"></a>é¡¹ç›®å®æˆ˜6ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå¤šçº§ä¸»ä» Multisource åŠåŒæ­¥æ¶æ„</h5><p><img src="pic/70.png" alt=""></p>
<table>
<thead>
<tr>
<th align="left">æœåŠ¡å™¨</th>
<th align="left">ip</th>
<th align="left">åŠŸèƒ½</th>
<th align="left">è½¯ä»¶</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mastera</td>
<td align="left">172.25.0.11</td>
<td align="left">ä¸»</td>
<td align="left">mysql-community-client 5.7</td>
</tr>
<tr>
<td align="left">masterb</td>
<td align="left">172.25.0.12</td>
<td align="left">ä¸»</td>
<td align="left">mysql-community-client 5.7</td>
</tr>
<tr>
<td align="left">slavea</td>
<td align="left">172.25.0.13</td>
<td align="left">ä»</td>
<td align="left">mysql-community-client 5.7</td>
</tr>
<tr>
<td align="left">slaveb</td>
<td align="left">172.25.0.14</td>
<td align="left">ä»</td>
<td align="left">mysql-community-client 5.7</td>
</tr>
</tbody></table>
<blockquote>
<p>å®‰è£…è½¯ä»¶</p>
</blockquote>
<ol>
<li>æ“ä½œç³»ç»Ÿ RHEL7.2</li>
<li>ä¸‹è½½è½¯ä»¶ï¼ˆrpmï¼›æœ¬åœ°yumæºï¼› åœ¨çº¿yumæºï¼›ï¼‰<pre><code>http://classroom.example.com/materials/mysql-5.7.repo</code></pre></li>
<li>/etc/yum.repos.d/</li>
<li>yum clean all;yum makecache</li>
<li>yum list|grep mysql<pre><code>mysql-community-server 5.7</code></pre></li>
<li>yum install â€”-æŠ¥é”™ï¼Œè½¯ä»¶å†²çªï¼šmariadb-libs 5.5 /var/lib/mysql/*</li>
<li>rpm -e â€“nodeps mariadb-libs</li>
</ol>
<blockquote>
<p>æœåŠ¡å™¨ç«¯</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">é¡¹ç›®å</th>
<th align="left">å†…å®¹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">è½¯ä»¶å</td>
<td align="left">mysql-community-server 5.7</td>
</tr>
<tr>
<td align="left">service</td>
<td align="left">mysqld</td>
</tr>
<tr>
<td align="left">daemon</td>
<td align="left">mysqld</td>
</tr>
<tr>
<td align="left">é…ç½®æ–‡ä»¶</td>
<td align="left">/etc/my.cnfï¼Œ/etc/my.cnf.d/*.cnf</td>
</tr>
<tr>
<td align="left">æ•°æ®æ–‡ä»¶</td>
<td align="left">/var/lib/mysql</td>
</tr>
<tr>
<td align="left">å¯åŠ¨æ—¥å¿—</td>
<td align="left">/var/log/mysqld.log</td>
</tr>
</tbody></table>
<blockquote>
<p>å®¢æˆ·ç«¯</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">é¡¹ç›®å</th>
<th align="left">å†…å®¹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">è½¯ä»¶å</td>
<td align="left">mysql-community-client 5.7</td>
</tr>
<tr>
<td align="left">å‘½ä»¤</td>
<td align="left">mysql,mysqladmin,mysqlbinlog,mysqldump</td>
</tr>
</tbody></table>
<blockquote>
<p>æœåŠ¡ç«¯å¯åŠ¨æœåŠ¡</p>
</blockquote>
<blockquote>
<blockquote>
<p>æŸ¥çœ‹è¿›ç¨‹<code>ps -ef|grep mysqld</code> æˆ– <code>systemctl status mysqld</code></p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>æŸ¥çœ‹ç«¯å£ <code>netstat -lunpt|grep mysqld</code>  <code>3306</code></p>
</blockquote>
</blockquote>
<blockquote>
<p>æœåŠ¡ç«¯ä¿®æ”¹åˆå§‹å¯†ç </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grep password &#x2F;var&#x2F;log&#x2F;mysqld.log</span><br><span class="line">mysqladmin -uroot -p&#39;&#39; password &#39;(Uploo00king)&#39;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®¢æˆ·ç«¯ç™»é™†æ•°æ®åº“</p>
</blockquote>
<p><code>mysql -uroot -p&#39;(Uploo00king)&#39;</code></p>
<p>mysql.userè¡¨çš„ç»“æ„å˜åŒ–äº†ï¼ŒåŸå…ˆçš„passwordåˆ—æ”¹ä¸ºäº†authentication_stringåˆ—</p>
<blockquote>
<blockquote>
<p>å®ç°åŠåŒæ­¥ï¼Œéœ€è¦å…ˆå®‰è£…åŠåŒæ­¥æ’ä»¶</p>
</blockquote>
</blockquote>
<blockquote>
<h3 id="M-M-S-Sæ­¥éª¤"><a href="#M-M-S-Sæ­¥éª¤" class="headerlink" title="M-M-S-Sæ­¥éª¤"></a>M-M-S-Sæ­¥éª¤</h3></blockquote>
<blockquote>
<blockquote>
<p>ä¸»æœåŠ¡å™¨</p>
</blockquote>
</blockquote>
<ol>
<li>configure  </li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">server-id=1</span><br><span class="line">log-bin=/var/lib/mysql-log/mastera</span><br><span class="line"><span class="meta">#</span><span class="bash"> GTID</span></span><br><span class="line">gitd_mode=on</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> crash safe</span></span><br><span class="line">sync_binlog=1 #å¼ºåˆ¶åˆ·æ–°binlogåˆ°ç£ç›˜</span><br><span class="line">innodb_flush_log_at_trx_commit=1 #å¼ºåˆ¶åˆ·æ–°redologåˆ°ç£ç›˜</span><br><span class="line"><span class="meta">#</span><span class="bash"> semi sync</span></span><br><span class="line">rpl-semi_sync_master_enable=1</span><br><span class="line">rpl_semi_sync_master_timeout=1000 #ms</span><br><span class="line">rpl_semi_sync_master_warit_slave_count=num</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>grant replication slave@â€™172.25.X.%â€™</p>
</li>
<li><p>mysqldump\tar\lvm\innobackupex</p>
</li>
</ol>
<blockquote>
<blockquote>
<p>ä»æœåŠ¡å™¨</p>
</blockquote>
</blockquote>
<ol>
<li>configure</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">Server-id=2</span><br><span class="line"><span class="meta">#</span><span class="bash"> GTID</span></span><br><span class="line">gtid_mode=on</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> MTS</span></span><br><span class="line">slave-parallel-type=logical_clock</span><br><span class="line">Slave-parallel-workers=16</span><br><span class="line"><span class="meta">#</span><span class="bash"> crash safe</span></span><br><span class="line">relay_log_recovery=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> semi sync</span></span><br><span class="line">rpl_semi_sync_slave_enable=1</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>mysql -uroot -pâ€™(Uploo00king)â€™ &lt; mysql.all.sql</p>
</li>
<li><p>change mastert to</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">master_host&#x3D;&#39;ip&#39;</span><br><span class="line">master_user&#x3D;&#39;slave&#39;</span><br><span class="line">master_password&#x3D;&#39;&#39;</span><br><span class="line">master_auto_position&#x3D;1</span><br></pre></td></tr></table></figure></li>
<li><p>start slave;</p>
</li>
<li><p>show slave status\G;</p>
</li>
</ol>
<blockquote>
<p>è¯¦ç»†æ­¥éª¤</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mastera:</span><br><span class="line"></span><br><span class="line">    1  ssh-keygen -t dsa</span><br><span class="line">    2  for i in 11 12 13 14;do ssh-copy-id root@172.25.0.$i;done</span><br><span class="line">    3  for i in 11 12 13 14;do ssh root@172.25.0.$i "setenforce 0;systemctl stop firewalld;yum install -y wget";done</span><br><span class="line">    4  for i in 11 12 13 14;do ssh root@172.25.0.$i "cd /etc/yum.repos.d/;wget http://classroom.example.com/materials/mysql-5.7.repo";done</span><br><span class="line">    5  ls /etc/yum.repos.d/</span><br><span class="line"></span><br><span class="line">    6  for i in 11 12 13 14;do ssh root@172.25.0.$i "rpm -e --nodeps mariadb-libs";done</span><br><span class="line">    7  yum list|grep mysql</span><br><span class="line">    8  for i in 11 12 13 14;do ssh root@172.25.0.$i "yum install -y mysql-community*";done</span><br><span class="line">    9  for i in 11 12 13 14;do ssh root@172.25.0.$i "systemctl start mysqld";done</span><br><span class="line">**********************</span><br><span class="line">æ¯ä¸€å°éƒ½éœ€è¦ä¿®æ”¹å¯†ç </span><br><span class="line">    1  grep password /var/log/mysqld.log</span><br><span class="line">    2  mysqladmin -uroot -p'wXE?ekekJ3Na' password '(Uploo00king)'</span><br><span class="line">**********************</span><br><span class="line">masteraï¼š</span><br><span class="line">æ–°å»ºåº“å’Œè¡¨ï¼Œå¹¶å…¨å¤‡ä»½,å¤åˆ¶åˆ°masterbã€slaveaã€slaveb</span><br><span class="line"></span><br><span class="line">    1  mysql -uroot -p'(Uploo00king)'</span><br><span class="line">	create database db1;</span><br><span class="line">	use db1;</span><br><span class="line">	create table t1 (id int);</span><br><span class="line">    2  mysqldump -A -uroot -p'(Uploo00king)' &gt; /tmp/mysql.all.sql</span><br><span class="line">    3  for i in 12 13 14 ;do scp /tmp/mysql.all.sql root@172.25.0.$i:/tmp; done</span><br><span class="line">    4  for i in 12 13 14 ;do ssh root@172.25.0.$i "mysql -uroot -p'(Uploo00king)' &lt; /tmp/mysql.all.sql"; done</span><br><span class="line">************************</span><br><span class="line">masterb/slavea/slaveb:</span><br><span class="line"><span class="meta">#</span><span class="bash">ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">   1  vi /etc/my.cnf</span><br><span class="line"><span class="meta">#</span><span class="bash">mastera:</span></span><br><span class="line">	log-bin=/var/lib/mysql-log/mastera</span><br><span class="line">	server-id=1</span><br><span class="line">	gtid_mode = ON</span><br><span class="line">	enforce_gtid_consistency = 1</span><br><span class="line"><span class="meta">#</span><span class="bash">masterb:</span></span><br><span class="line">	log-bin=/var/lib/mysql-log/serverb</span><br><span class="line">	server-id=2</span><br><span class="line">	gtid_mode = ON</span><br><span class="line">	enforce_gtid_consistency = 1</span><br><span class="line"><span class="meta">#</span><span class="bash">slavea:</span></span><br><span class="line">	server-id=3</span><br><span class="line">	gtid_mode = ON</span><br><span class="line">	enforce_gtid_consistency = 1</span><br><span class="line">	master-info-repository=TABLE</span><br><span class="line">	relay-log-info-repository=TABLE</span><br><span class="line"><span class="meta">#</span><span class="bash">slaveb:</span></span><br><span class="line">	server-id=4</span><br><span class="line">	gtid_mode = ON</span><br><span class="line">	enforce_gtid_consistency = 1</span><br><span class="line">	master-info-repository=TABLE</span><br><span class="line">	relay-log-info-repository=TABLE</span><br><span class="line"></span><br><span class="line">mastera/masterb:</span><br><span class="line">åˆ›å»ºäºŒè¿›åˆ¶æ—¥å¿—çš„ç›®å½•ï¼Œå¹¶ä¿®æ”¹æƒé™</span><br><span class="line"></span><br><span class="line">    2  mkdir /var/lib/mysql-log</span><br><span class="line">    3  chown mysql. /var/lib/mysql-log</span><br><span class="line"></span><br><span class="line">masteraï¼š</span><br><span class="line">å°†å››å°æœåŠ¡å™¨é‡æ–°å¯åŠ¨æœåŠ¡</span><br><span class="line">    4  for i in 11 12 13 14;do ssh root@172.25.0.$i "systemctl restart mysqld";done</span><br><span class="line"></span><br><span class="line">************************************************</span><br><span class="line"><span class="meta">mastera--&gt;</span><span class="bash">masterb\slavea\slaveb ä¸»ä»åŒæ­¥</span></span><br><span class="line"><span class="meta">masterb--&gt;</span><span class="bash">masteraåŒä¸»</span></span><br><span class="line">multi-source</span><br><span class="line"></span><br><span class="line">åœ¨masteraä¸Šé¢æˆæƒ:</span><br><span class="line"></span><br><span class="line">    1  mysql -uroot -p'(Uploo00king)'</span><br><span class="line"></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> grant replication slave on *.* to slave@172.25.0.12 identified by <span class="string">'(Uploo00king)'</span>;</span></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> grant replication slave on *.* to slave@172.25.0.13 identified by <span class="string">'(Uploo00king)'</span>;</span></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> grant replication slave on *.* to slave@172.25.0.14 identified by <span class="string">'(Uploo00king)'</span>;</span></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> grant replication slave on *.* to slave@172.25.0.11 identified by <span class="string">'(Uploo00king)'</span>;</span></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> flush privileges;</span></span><br><span class="line"></span><br><span class="line">åœ¨masterbä¸Šé¢change master:</span><br><span class="line">     2	mysql&gt; change master to master_host="172.25.0.11",master_user="slave",master_password="(Uploo00king)",master_auto_position=1;</span><br><span class="line"></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> start slave;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> show slave status\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.11</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mastera.000002</span><br><span class="line">          Read_Master_Log_Pos: 1188</span><br><span class="line">               Relay_Log_File: masterb0-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 1397</span><br><span class="line">        Relay_Master_Log_File: mastera.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1188</span><br><span class="line">              Relay_Log_Space: 1607</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: ca914200-225d-11e6-a1ab-52540000000b</span><br><span class="line">             Master_Info_File: /var/lib/mysql/master.info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind:</span><br><span class="line">      Last_IO_Error_Timestamp:</span><br><span class="line">     Last_SQL_Error_Timestamp:</span><br><span class="line">               Master_SSL_Crl:</span><br><span class="line">           Master_SSL_Crlpath:</span><br><span class="line">           Retrieved_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:1-4</span><br><span class="line">            Executed_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:1-4</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB:</span><br><span class="line">                 Channel_Name:</span><br><span class="line">           Master_TLS_Version:</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">åœ¨masteraä¸Šé¢change masterï¼š</span></span><br><span class="line">    3  mysql&gt; change master to master_host="172.25.0.12",master_user="slave",master_password="(Uploo00king)",master_auto_position=1;</span><br><span class="line"></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> start slave;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> show slave status\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.12</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: serverb.000002</span><br><span class="line">          Read_Master_Log_Pos: 154</span><br><span class="line">               Relay_Log_File: mastera0-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 363</span><br><span class="line">        Relay_Master_Log_File: serverb.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 154</span><br><span class="line">              Relay_Log_Space: 573</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 2</span><br><span class="line">                  Master_UUID: e9660793-225d-11e6-996d-52540000000c</span><br><span class="line">             Master_Info_File: /var/lib/mysql/master.info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind:</span><br><span class="line">      Last_IO_Error_Timestamp:</span><br><span class="line">     Last_SQL_Error_Timestamp:</span><br><span class="line">               Master_SSL_Crl:</span><br><span class="line">           Master_SSL_Crlpath:</span><br><span class="line">           Retrieved_Gtid_Set:</span><br><span class="line">            Executed_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:1-6</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB:</span><br><span class="line">                 Channel_Name:</span><br><span class="line">           Master_TLS_Version:</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line">=========================================================================================</span><br><span class="line">åˆ°æ­¤ä½ç½®masteraå’Œmasterbçš„åŒä¸»é…ç½®å¥½äº†ã€‚å¯ä»¥æµ‹è¯•ä»¥ä¸‹ã€‚</span><br><span class="line"></span><br><span class="line">æ¥ä¸‹æ¥é…ç½®å¤šçº§ä¸»ä»ï¼Œä¸è¦ç”¨gtidï¼Œç”¨è€æ–¹æ³•master_log_fileå’Œmaster_log_positon</span><br><span class="line">=============================================================================================</span><br><span class="line"><span class="meta">#</span><span class="bash">åœ¨masteraä¸Šé¢æŸ¥çœ‹masterçš„çŠ¶æ€:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> show master status\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">             File: mastera.000002</span><br><span class="line">         Position: 1634</span><br><span class="line">     Binlog_Do_DB:</span><br><span class="line"> Binlog_Ignore_DB:</span><br><span class="line">Executed_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:1-6,</span><br><span class="line">e9660793-225d-11e6-996d-52540000000c:1-3</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">åœ¨masterbä¸Šé¢å»æŸ¥çœ‹masterçš„çŠ¶æ€:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> show master status\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">             File: serverb.000002</span><br><span class="line">         Position: 894</span><br><span class="line">     Binlog_Do_DB:</span><br><span class="line"> Binlog_Ignore_DB:</span><br><span class="line">Executed_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:1-6,</span><br><span class="line">e9660793-225d-11e6-996d-52540000000c:1-3</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">åœ¨slaveaä¸Šé¢å»æ“ä½œ:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> change master to master_host=<span class="string">"172.25.0.11"</span>,master_user=<span class="string">"slave"</span>,master_password=<span class="string">"(Uploo00king)"</span>,master_log_file=<span class="string">'mastera.000002'</span>,master_log_pos=1634 <span class="keyword">for</span> channel <span class="string">'mastera'</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> change master to master_host=<span class="string">"172.25.0.12"</span>,master_user=<span class="string">"slave"</span>,master_password=<span class="string">"(Uploo00king)"</span>,master_log_file=<span class="string">'serverb.000002'</span>,master_log_pos=894 <span class="keyword">for</span> channel <span class="string">'masterb'</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> start slave;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> show slave status\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.11</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mastera.000002</span><br><span class="line">          Read_Master_Log_Pos: 1885</span><br><span class="line">               Relay_Log_File: slavea0-relay-bin-mastera.000002</span><br><span class="line">                Relay_Log_Pos: 569</span><br><span class="line">        Relay_Master_Log_File: mastera.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1885</span><br><span class="line">              Relay_Log_Space: 786</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: ca914200-225d-11e6-a1ab-52540000000b</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind:</span><br><span class="line">      Last_IO_Error_Timestamp:</span><br><span class="line">     Last_SQL_Error_Timestamp:</span><br><span class="line">               Master_SSL_Crl:</span><br><span class="line">           Master_SSL_Crlpath:</span><br><span class="line">           Retrieved_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:7</span><br><span class="line">            Executed_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:7,</span><br><span class="line">e9660793-225d-11e6-996d-52540000000c:4</span><br><span class="line">                Auto_Position: 0</span><br><span class="line">         Replicate_Rewrite_DB:</span><br><span class="line">                 Channel_Name: mastera</span><br><span class="line">           Master_TLS_Version:</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.12</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: serverb.000002</span><br><span class="line">          Read_Master_Log_Pos: 1142</span><br><span class="line">               Relay_Log_File: slavea0-relay-bin-masterb.000002</span><br><span class="line">                Relay_Log_Pos: 566</span><br><span class="line">        Relay_Master_Log_File: serverb.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1142</span><br><span class="line">              Relay_Log_Space: 783</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 2</span><br><span class="line">                  Master_UUID: e9660793-225d-11e6-996d-52540000000c</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind:</span><br><span class="line">      Last_IO_Error_Timestamp:</span><br><span class="line">     Last_SQL_Error_Timestamp:</span><br><span class="line">               Master_SSL_Crl:</span><br><span class="line">           Master_SSL_Crlpath:</span><br><span class="line">           Retrieved_Gtid_Set: e9660793-225d-11e6-996d-52540000000c:4</span><br><span class="line">            Executed_Gtid_Set: ca914200-225d-11e6-a1ab-52540000000b:7,</span><br><span class="line">e9660793-225d-11e6-996d-52540000000c:4</span><br><span class="line">                Auto_Position: 0</span><br><span class="line">         Replicate_Rewrite_DB:</span><br><span class="line">                 Channel_Name: masterb</span><br><span class="line">           Master_TLS_Version:</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">åœ¨slavebä¸Šé¢å»æ“ä½œ:</span></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> change master to master_host=<span class="string">"172.25.0.11"</span>,master_user=<span class="string">"slave"</span>,master_password=<span class="string">"(Uploo00king)"</span>,master_log_file=<span class="string">'mastera.000002'</span>,master_log_pos=1634 <span class="keyword">for</span> channel <span class="string">'mastera'</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> change master to master_host=<span class="string">"172.25.0.12"</span>,master_user=<span class="string">"slave"</span>,master_password=<span class="string">"(Uploo00king)"</span>,master_log_file=<span class="string">'serverb.000002'</span>,master_log_pos=894 <span class="keyword">for</span> channel <span class="string">'masterb'</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> start slave;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	mysql&gt;</span><span class="bash"> show slave status\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.11</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mastera.000002</span><br><span class="line">          Read_Master_Log_Pos: 1634</span><br><span class="line">               Relay_Log_File: slaveb0-relay-bin-mastera.000002</span><br><span class="line">                Relay_Log_Pos: 318</span><br><span class="line">        Relay_Master_Log_File: mastera.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1634</span><br><span class="line">              Relay_Log_Space: 535</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: ca914200-225d-11e6-a1ab-52540000000b</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind:</span><br><span class="line">      Last_IO_Error_Timestamp:</span><br><span class="line">     Last_SQL_Error_Timestamp:</span><br><span class="line">               Master_SSL_Crl:</span><br><span class="line">           Master_SSL_Crlpath:</span><br><span class="line">           Retrieved_Gtid_Set:</span><br><span class="line">            Executed_Gtid_Set:</span><br><span class="line">                Auto_Position: 0</span><br><span class="line">         Replicate_Rewrite_DB:</span><br><span class="line">                 Channel_Name: mastera</span><br><span class="line">           Master_TLS_Version:</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.25.0.12</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: serverb.000002</span><br><span class="line">          Read_Master_Log_Pos: 894</span><br><span class="line">               Relay_Log_File: slaveb0-relay-bin-masterb.000002</span><br><span class="line">                Relay_Log_Pos: 318</span><br><span class="line">        Relay_Master_Log_File: serverb.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 894</span><br><span class="line">              Relay_Log_Space: 535</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 2</span><br><span class="line">                  Master_UUID: e9660793-225d-11e6-996d-52540000000c</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind:</span><br><span class="line">      Last_IO_Error_Timestamp:</span><br><span class="line">     Last_SQL_Error_Timestamp:</span><br><span class="line">               Master_SSL_Crl:</span><br><span class="line">           Master_SSL_Crlpath:</span><br><span class="line">           Retrieved_Gtid_Set:</span><br><span class="line">            Executed_Gtid_Set:</span><br><span class="line">                Auto_Position: 0</span><br><span class="line">         Replicate_Rewrite_DB:</span><br><span class="line">                 Channel_Name: masterb</span><br><span class="line">           Master_TLS_Version:</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>å¯ä»¥å»æµ‹è¯•äº†ï¼š</p>
</blockquote>
</blockquote>
<p>mastera: <code>insert into db1.t1 values (2);</code></p>
<p>masterb slavea slavebéƒ½åŒæ­¥äº†æ•°æ®åº“</p>
<p>masterb:<code>insert into db1.t1 values (3);</code></p>
<p>mastera slavea slavebéƒ½åŒæ­¥äº†æ•°æ®åº“</p>
<p>å…³é—­masteraçš„æ•°æ®ï¼Œå¯¹masterbå†™ï¼Œslaveaå’Œslavebä¹Ÿèƒ½åŒæ­¥æ•°æ®ï¼›å†æ¬¡æ‰“å¼€masteraä¹Ÿèƒ½åŒæ­¥åˆ°æ•°æ®ã€‚</p>
<h3 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>é‡ç‚¹æŒæ¡</p>
<ol>
<li>ä¸»ä»åŒæ­¥çš„åŸç†ä»¥åŠåŒæ­¥è¿‡ç¨‹ä¸­çš„å»¶è¿Ÿå’Œæ•°æ®ä¸€è‡´æ€§é—®é¢˜</li>
<li>mariadb5.5å’Œmysql5.7çš„ä¸»ä»åŒæ­¥æ­¥éª¤</li>
</ol>
<p>éš¾ç‚¹</p>
<ol>
<li>åŒæ­¥è¿‡ç¨‹ä¸­çš„å»¶è¿Ÿé—®é¢˜å’Œæ•°æ®ä¸€è‡´æ€§é—®é¢˜</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>MySQLåŸºç¡€ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬å…­è¯¾ MySQLé€»è¾‘æ¶æ„å’ŒInnodbå­˜å‚¨å¼•æ“</title>
    <url>/2016/12/30/booboo_mysql/03-MySQL%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84%E5%92%8CInnodb%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/</url>
    <content><![CDATA[<h3 id="MySQL-é€»è¾‘æ¶æ„"><a href="#MySQL-é€»è¾‘æ¶æ„" class="headerlink" title="MySQL é€»è¾‘æ¶æ„"></a>MySQL é€»è¾‘æ¶æ„</h3><p><img src="pic/04-mysql2.jpg" alt="é€»è¾‘æ¶æ„"></p>
<p>MySQL é€»è¾‘æ¶æ„ç”±ï¼šè¿æ¥æ± ç»„ä»¶ã€ç®¡ç†æœåŠ¡å’Œå·¥å…·ç»„ä»¶ã€sqlæ¥å£ç»„ä»¶ã€æŸ¥è¯¢åˆ†æå™¨ç»„ä»¶ã€ä¼˜åŒ–å™¨ç»„ä»¶ã€ ç¼“å†²ç»„ä»¶ã€æ’ä»¶å¼å­˜å‚¨å¼•æ“ã€ç‰©ç†æ–‡ä»¶ç»„æˆã€‚ç‹¬æœ‰çš„æ’ä»¶å¼ä½“ç³»ç»“æ„ï¼Œå„ä¸ªå­˜å‚¨å¼•æ“æœ‰è‡ªå·±çš„ç‰¹ç‚¹ã€‚</p>
<ul>
<li><p><code>Connectors</code>æŒ‡çš„æ˜¯ä¸åŒè¯­è¨€ä¸­ä¸SQLçš„äº¤äº’</p>
</li>
<li><p><code>Management Serveices &amp; Utilities</code>ï¼š ç³»ç»Ÿç®¡ç†å’Œæ§åˆ¶å·¥å…·</p>
</li>
<li><p><code>Connection Pool</code>: è¿æ¥æ± ã€‚ç®¡ç†ç¼“å†²ç”¨æˆ·è¿æ¥ï¼Œçº¿ç¨‹å¤„ç†ç­‰éœ€è¦ç¼“å­˜çš„éœ€æ±‚</p>
</li>
<li><p><code>SQL Interface</code>: SQLæ¥å£ã€‚æ¥å—ç”¨æˆ·çš„SQLå‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›ç”¨æˆ·éœ€è¦æŸ¥è¯¢çš„ç»“æœã€‚æ¯”å¦‚<code>select from</code>å°±æ˜¯è°ƒç”¨S<code>QL Interface</code></p>
</li>
<li><p><code>Parser</code>: è§£æå™¨ã€‚SQLå‘½ä»¤ä¼ é€’åˆ°è§£æå™¨çš„æ—¶å€™ä¼šè¢«è§£æå™¨éªŒè¯å’Œè§£æã€‚è§£æå™¨æ˜¯ç”±Lexå’ŒYACCå®ç°çš„ï¼Œæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„è„šæœ¬ã€‚</p>
<p>  ä¸»è¦åŠŸèƒ½ï¼š</p>
<p>  a . å°†SQLè¯­å¥åˆ†è§£æˆæ•°æ®ç»“æ„ï¼Œå¹¶å°†è¿™ä¸ªç»“æ„ä¼ é€’åˆ°åç»­æ­¥éª¤ï¼Œä»¥åSQLè¯­å¥çš„ä¼ é€’å’Œå¤„ç†å°±æ˜¯åŸºäºè¿™ä¸ªç»“æ„çš„</p>
<p>  b.  å¦‚æœåœ¨åˆ†è§£æ„æˆä¸­é‡åˆ°é”™è¯¯ï¼Œé‚£ä¹ˆå°±è¯´æ˜è¿™ä¸ªsqlè¯­å¥æ˜¯ä¸åˆç†çš„</p>
</li>
<li><p><code>Optimizer</code>: æŸ¥è¯¢ä¼˜åŒ–å™¨ã€‚SQLè¯­å¥åœ¨æŸ¥è¯¢ä¹‹å‰ä¼šä½¿ç”¨æŸ¥è¯¢ä¼˜åŒ–å™¨å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚ä»–ä½¿ç”¨çš„æ˜¯â€œé€‰å–-æŠ•å½±-è”æ¥â€ç­–ç•¥è¿›è¡ŒæŸ¥è¯¢ã€‚</p>
<p>ç”¨ä¸€ä¸ªä¾‹å­å°±å¯ä»¥ç†è§£ï¼š <code>select uid,name from user where gender = 1;</code></p>
<p>è¿™ä¸ª<code>select</code> æŸ¥è¯¢å…ˆæ ¹æ®<code>where</code> è¯­å¥è¿›è¡Œé€‰å–ï¼Œè€Œä¸æ˜¯å…ˆå°†è¡¨å…¨éƒ¨æŸ¥è¯¢å‡ºæ¥ä»¥åå†è¿›è¡Œ<code>gender</code>è¿‡æ»¤ï¼›è¿™ä¸ª<code>select</code>æŸ¥è¯¢å…ˆæ ¹æ®<code>uid</code>å’Œ<code>name</code>è¿›è¡Œå±æ€§æŠ•å½±ï¼Œè€Œä¸æ˜¯å°†å±æ€§å…¨éƒ¨å–å‡ºä»¥åå†è¿›è¡Œè¿‡æ»¤ï¼›å°†è¿™ä¸¤ä¸ªæŸ¥è¯¢æ¡ä»¶è”æ¥èµ·æ¥ç”Ÿæˆæœ€ç»ˆæŸ¥è¯¢ç»“æœ</p>
</li>
<li><p><code>Cache</code>å’Œ<code>Buffer</code>ï¼š æŸ¥è¯¢ç¼“å­˜ã€‚</p>
<p>å¦‚æœæŸ¥è¯¢ç¼“å­˜æœ‰å‘½ä¸­çš„æŸ¥è¯¢ç»“æœï¼ŒæŸ¥è¯¢è¯­å¥å°±å¯ä»¥ç›´æ¥å»æŸ¥è¯¢ç¼“å­˜ä¸­å–æ•°æ®ã€‚è¿™ä¸ªç¼“å­˜æœºåˆ¶æ˜¯ç”±ä¸€ç³»åˆ—å°ç¼“å­˜ç»„æˆçš„ã€‚æ¯”å¦‚è¡¨ç¼“å­˜ï¼Œè®°å½•ç¼“å­˜ï¼Œkeyç¼“å­˜ï¼Œæƒé™ç¼“å­˜ç­‰</p>
</li>
<li><p><code>Engine</code> ï¼šå­˜å‚¨å¼•æ“ã€‚</p>
<p>å­˜å‚¨å¼•æ“æ˜¯MySqlä¸­å…·ä½“çš„ä¸æ–‡ä»¶æ‰“äº¤é“çš„å­ç³»ç»Ÿã€‚ä¹Ÿæ˜¯Mysqlæœ€å…·æœ‰ç‰¹è‰²çš„ä¸€ä¸ªåœ°æ–¹ã€‚</p>
<p>Mysqlçš„å­˜å‚¨å¼•æ“æ˜¯æ’ä»¶å¼çš„ã€‚å®ƒæ ¹æ®MySQL ABå…¬å¸æä¾›çš„æ–‡ä»¶è®¿é—®å±‚çš„ä¸€ä¸ªæŠ½è±¡æ¥å£æ¥å®šåˆ¶ä¸€ç§æ–‡ä»¶è®¿é—®æœºåˆ¶ï¼ˆè¿™ç§è®¿é—®æœºåˆ¶å°±å«å­˜å‚¨å¼•æ“ï¼‰</p>
<p>ç°åœ¨æœ‰å¾ˆå¤šç§å­˜å‚¨å¼•æ“ï¼Œå„ä¸ªå­˜å‚¨å¼•æ“çš„ä¼˜åŠ¿å„ä¸ä¸€æ ·ï¼Œæœ€å¸¸ç”¨çš„MyISAM,InnoDB</p>
<p>  MySQL 5.5 ç‰ˆæœ¬ä¹‹å‰é»˜è®¤ä½¿ç”¨MyISAMå¼•æ“ï¼Œå®ƒæŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œæœ‰è¾ƒå¥½çš„ç´¢å¼•ä¼˜åŒ–å’Œæ•°æ®å‹ç¼©æŠ€æœ¯ã€‚ä½†æ˜¯å®ƒä¸æ”¯æŒäº‹åŠ¡ã€‚</p>
<p>  MySQL 5.5 ç‰ˆæœ¬å¼€å§‹é»˜è®¤ä½¿ç”¨InnoDBå¼•æ“ï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªæ”¯æŒæ‹¥æœ‰ACIDç‰¹æ€§äº‹åŠ¡çš„å­˜å‚¨å¼•æ“ï¼Œå¹¶ä¸”æä¾›è¡Œçº§çš„é”å®šï¼Œåº”ç”¨ä¹Ÿç›¸å½“å¹¿æ³›ã€‚</p>
<p>  Mysqlä¹Ÿæ”¯æŒè‡ªå·±å®šåˆ¶å­˜å‚¨å¼•æ“ï¼Œç”šè‡³ä¸€ä¸ªåº“ä¸­ä¸åŒçš„è¡¨ä½¿ç”¨ä¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œè¿™äº›éƒ½æ˜¯å…è®¸çš„ã€‚</p>
</li>
</ul>
<h3 id="MySQL-å­˜å‚¨å¼•æ“"><a href="#MySQL-å­˜å‚¨å¼•æ“" class="headerlink" title="MySQL å­˜å‚¨å¼•æ“"></a>MySQL å­˜å‚¨å¼•æ“</h3><h4 id="å­˜å‚¨å¼•æ“æ¦‚è¿°"><a href="#å­˜å‚¨å¼•æ“æ¦‚è¿°" class="headerlink" title="å­˜å‚¨å¼•æ“æ¦‚è¿°"></a>å­˜å‚¨å¼•æ“æ¦‚è¿°</h4><p><code>innodb</code>å­˜å‚¨å¼•æ“ï¼šé¢å‘OLTP(online transaction processing)ã€è¡Œé”ã€æ”¯æŒå¤–é”®ã€éé”å®šè¯»ã€é»˜è®¤é‡‡ç”¨repeaableçº§åˆ«ï¼ˆå¯é‡å¤è¯»ï¼‰é€šè¿‡next-keylockingç­–ç•¥é¿å…å¹»è¯»ã€æ’å…¥ç¼“å†²ã€äºŒæ¬¡å†™ã€è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€é¢„è¯»</p>
<p><code>myisam</code>å­˜å‚¨å¼•æ“ï¼šä¸æ”¯æŒäº‹åŠ¡ã€è¡¨é”ã€å…¨æ–‡ç´¢å¼•ã€é€‚åˆolapï¼ˆåœ¨çº¿åˆ†æå¤„ç†ï¼‰ï¼Œå…¶ä¸­myd:æ”¾æ•°æ®æ–‡ä»¶ï¼Œmyi:æ”¾ç´¢å¼•æ–‡ä»¶</p>
<p><code>ndb</code>å­˜å‚¨å¼•æ“ï¼šé›†ç¾¤å­˜å‚¨å¼•æ“ï¼Œshare nothingï¼Œå¯æé«˜å¯ç”¨æ€§</p>
<p><code>memory</code>å­˜å‚¨å¼•æ“ï¼šæ•°æ®å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œè¡¨é”ï¼Œå¹¶å‘æ€§èƒ½å·®ï¼Œé»˜è®¤ä½¿ç”¨å“ˆå¸Œç´¢å¼•</p>
<p><code>archive</code>å­˜å‚¨å¼•æ“ï¼šåªæ”¯æŒ<code>insert</code>å’Œ<code>select</code> ï¼Œzlibç®—æ³•å‹ç¼©1ï¼š10ï¼Œé€‚åˆå­˜å‚¨å½’æ¡£æ•°æ®å¦‚æ—¥å¿—ç­‰ã€è¡Œé”</p>
<p><code>maria</code>å­˜å‚¨å¼•æ“ï¼šç›®çš„å–ä»£myisamã€ç¼“å­˜æ•°æ®å’Œç´¢å¼•ã€è¡Œé”ã€mvcc</p>
<p><img src="pic/14-engine.jpg" alt="engine diff"></p>
<hr>
<h4 id="çŸ¥åçš„ä¸¤å¤§å­˜å‚¨å¼•æ“"><a href="#çŸ¥åçš„ä¸¤å¤§å­˜å‚¨å¼•æ“" class="headerlink" title="çŸ¥åçš„ä¸¤å¤§å­˜å‚¨å¼•æ“"></a>çŸ¥åçš„ä¸¤å¤§å­˜å‚¨å¼•æ“</h4><p>å­˜å‚¨å¼•æ“æ˜¯æ•°æ®åº“å½“ä¸­éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œè¿™æ˜¯ä¸€ä¸ªé‡ç‚¹ã€‚ä»€ä¹ˆæ˜¯å­˜å‚¨å¼•æ“å‘¢ï¼Ÿå¼•æ“è¿™ä¸ªä¸œè¥¿æ˜¯ç”¨åœ¨è½¦ä¸Šçš„ï¼Œè¯´è½¦å­è·‘å¿«è·‘æ…¢ï¼Œæœ€ç›´æ¥çš„å…³ç³»ï¼Œå¼•æ“ï¼Œå½“ç„¶ä¸æ˜¯å”¯ä¸€çš„å…³ç³»ã€‚å°±åƒæˆ‘ä»¬è¯´è®¡ç®—æœºcpuæ˜¯æœ€ç›´æ¥çš„åŸå› ã€‚å¯¹æ±½è½¦æ¥è¯´å‘¢ï¼Œå°±æ˜¯å¼•æ“æœ€å…³é”®ã€‚æ•°æ®åº“ä»–çš„ä¼˜ç‚¹æ˜¯æ•°æ®è¯»å†™æ¯”è¾ƒå¿«ï¼Œé‚£ä¹ˆä»–è¯»å†™ä¹‹æ‰€ä»¥æ¯”ä¸€èˆ¬çš„åº”ç”¨ç¨‹åºå¿«ï¼Œé‚£æ˜¯å› ä¸ºä»–è¯»å†™çš„æ–¹å¼ä¸ä¸€æ ·ã€‚æˆ‘ä»¬æŠŠæ•°æ®åº“è¯»æ•°æ®ï¼Œè¯»æ–‡ä»¶ï¼Œå†™æ•°æ®ï¼Œå†™æ–‡ä»¶ï¼Œé‚£ç§è¯»å†™æ“ä½œçš„æ–¹æ³•å«åšå­˜å‚¨å¼•æ“ã€‚æŒ‡çš„æ˜¯â€œDBè¯»å†™æ•°æ®çš„æ–¹å¼â€ã€‚ç®€å•çš„ä¸€å¥è¯æ¦‚æ‹¬ï¼Œæ•°æ®åº“è¯»å†™æ•°æ®çš„æ–¹å¼å«åšå­˜å‚¨å¼•æ“ã€‚è¯»å†™æ•°æ®çš„æ–¹å¼ä¼šç›´æ¥å½±å“åˆ°æ•°æ®åº“æ€§èƒ½ï¼Œæ‰€ä»¥æ˜¯éå¸¸é‡è¦çš„ã€‚mysqlç”¨çš„æ˜¯ä¸¤å¤§å­˜å‚¨å¼•æ“ï¼Œä¸€ä¸ªå«åšmyisamå­˜å‚¨å¼•æ“ï¼Œç¬¬äºŒä¸ªå«åšinnodbå­˜å‚¨å¼•æ“ï¼Œè¿™æ˜¯æœ€å¸¸è§çš„ã€æœ€çŸ¥åçš„å­˜å‚¨å¼•æ“ï¼Œmyisamå’Œinnodbå­˜å‚¨å¼•æ“ã€‚å…¶å®è¿˜æœ‰å…¶ä»–å­˜å‚¨å¼•æ“ï¼Œå¤§æ¦‚æˆ‘è®°å¾—mysqlæ”¯æŒ8ä¸ªä¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œå¯èƒ½åæ¥å‘¢åˆæ‰©å®¹äº†ï¼Œä½†æ˜¯ä¸ç®¡æœ‰å‡ ä¸ªï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯è¿™ä¹ˆä¸¤ä¸ªã€‚</p>
<p>è¿™ä¸¤ä¸ªå­˜å‚¨å¼•æ“æœ‰å„è‡ªçš„ä¼˜åŠ£ç‚¹ï¼Œæœ‰å„è‡ªçš„ç‰¹æ€§ã€‚æ¯”å¦‚è¯´ï¼Œä¸¤ä¸ªæœ€å¤§çš„åŒºåˆ«ï¼Œmyisamæ˜¯ä¸€ä¸ªéäº‹åŠ¡å‹çš„å­˜å‚¨å¼•æ“ï¼Œå¯ä»¥æ”¯æŒè¡¨é”ï¼Œæˆ–è€…è¯´åªæ”¯æŒè¡¨é”ï¼›innodbæ˜¯ä¸€ä¸ªäº‹åŠ¡å‹å­˜å‚¨å¼•æ“ï¼Œèƒ½å¤Ÿæ”¯æŒåˆ°è¡Œé”ã€‚è¿™æ˜¯ä¸¤ä¸ªç‰¹æ€§ï¼Œä¸æ˜¯è¯´äº‹åŠ¡å‹å­˜å‚¨å°±èƒ½æ”¯æŒè¡Œé”ï¼Œè¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„ç‰¹ç‚¹ï¼Œä¸€ä¸ªç‰¹ç‚¹æ˜¯äº‹åŠ¡å‹å’Œéäº‹åŠ¡å‹ï¼Œä¸€ä¸ªç‰¹ç‚¹æ˜¯è¡Œé”ä¸è¡¨é”ã€‚å®ç°è¡Œé”ï¼Œå…¶å®å¤§éƒ¨åˆ†å¼•æ“å®ç°çš„éƒ½æ˜¯è¡¨é”ï¼Œå®ç°è¡¨é”çš„å­˜å‚¨å¼•æ“ä¸å¤šï¼Œinnodbæ˜¯å…¶ä¸­ä¸€ä¸ªï¼Œndbä¹Ÿæ˜¯ä¸€ä¸ªï¼Œæ¯”è¾ƒè‘—åçš„èƒ½å¤Ÿå®ç°è¡Œé”çš„å­˜å‚¨å¼•æ“ã€‚</p>
<p>INNODBå¯ä»¥å®ç°è¡Œé”ï¼Œæ‰€ä»¥INNODBåœ¨çº¿ä¸Šç”Ÿå­˜ç¯å¢ƒä¸­ï¼Œå¤§å¹¶å‘ç”¨æˆ·è¯·æ±‚ä¸‹ï¼Œä»–çš„æ€§èƒ½æŸå¤±å¹¶ä¸å¤§ï¼›è€ŒMYISAMç”¨çš„æ˜¯è¡¨é”ï¼Œä¸€æ—¦å¹¶å‘ç”¨æˆ·æ•°é‡å¤šäº†ï¼Œæ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™ï¼Œéšç€ä»–ä»¬ç”¨æˆ·æ•°é‡çš„å¢åŠ ï¼Œå†²çªä¼šæ˜æ˜¾å¢åŠ ï¼Œå†²çªæ¬¡æ•°è¶Šå¤šï¼Œæ€§èƒ½è¶Šä½ï¼Œæ’é˜Ÿç”¨æˆ·è¶Šå¤šã€‚æˆ‘ä»¬è¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ¨èçº¿ä¸Šç”Ÿäº§ç¯å¢ƒå°½é‡ä½¿ç”¨INNODBï¼Œä¼šæœ‰å¾ˆå¤šä¼˜ç‚¹ï¼›ä½†å¦‚æœä¸æ¶‰åŠåˆ°é”å†²çªï¼Œä¸æ¶‰åŠåˆ°äº‹åŠ¡å‹ï¼Œæˆ–è€…è¯´ä¸æ¶‰åŠåˆ°å†™æ“ä½œï¼Œæ¯”å¦‚æˆ‘è¿™å°æœåŠ¡å™¨ä¸“é—¨ç”¨æ¥è¯»ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™MYISAMçš„è¯»æ€§èƒ½æ˜¯å¤§äºINNODBçš„ï¼Œä»–æ˜¯é€‚åˆäºå°å¹¶å‘ä¸‹é¢çš„è¯»å¤šå†™å°‘çš„ç¯å¢ƒã€‚é”è¡Œæ¯”é”è¡¨è¦éº»çƒ¦ï¼Œé”ç²¾åº¦è¶Šç²¾ç»†ï¼Œæ“ä½œèµ·æ¥è‚¯å®šè¶Šéº»çƒ¦ï¼Œæ‰€ä»¥åœ¨åªè¯»çš„ç¯å¢ƒä¸‹ï¼Œç”¨MYISAMè‚¯å®šæ€§èƒ½ä¼šé«˜ä¸€äº›ã€‚å¤šæ•°æƒ…å†µä¸‹MYISAMå­˜å‚¨å¼•æ“å‘¢æ˜¯ç»™ç®¡ç†å‘˜åšç»Ÿè®¡ç”¨çš„ã€‚ç®¡ç†å‘˜æœ‰ä¸€ä¸ªæ•°æ®åº“è¦å»åˆ†ææ•°æ®ï¼Œä¸€ä¸ªäººåˆ†æå°±å¤Ÿäº†ï¼Œä¸ä¼šè¯´æœ‰ä¸€åƒä¸ªç”¨æˆ·åŒæ—¶ç™»ä¸Šå»ï¼Œå¤§å®¶ä¸€èµ·åˆ†æï¼Œä¸ä¼šçš„ã€‚è€Œä¸”åˆ†ææ•°æ®åº“ï¼Œå¾ˆå¤šéƒ½æ˜¯ç”¨çš„è¯»ç¯å¢ƒï¼Œè¿™ä¸ªè¡¨å½“ä¸­æœ‰å¤šå°‘è®°å½•ï¼Œå“ªä¸ªè¡¨å½“ä¸­æœ‰å¤šå°‘è®°å½•ï¼Œè¡¨å½“ä¸­æœ€å¤§å€¼æ˜¯å¤šå°‘ï¼Œæœ€å°å€¼æ˜¯å¤šå°‘ï¼Œç›¸å¯¹äºä¸Šä¸€æ¬¡çš„ç»Ÿè®¡ç»“æœæˆ‘æœ‰ä»€ä¹ˆæ ·çš„æ”¹å˜ï¼Œå¾ˆå¤šæ—¶å€™éƒ½æ˜¯è¯»æ“ä½œã€‚æ‰€ä»¥åƒè¿™ç§çº¿ä¸‹æ•°æ®ç»Ÿè®¡åˆ†ææ¯”è¾ƒé€‚åˆäºMYISAMã€‚<br>å¦å¤–æä¸€ä¸‹ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µä¸‹ä¹Ÿä¼šç”¨MYISAMã€‚åœ¨åšä¸»ä»åŒæ­¥çš„æ—¶å€™ï¼Œä¹Ÿç§°ä¸ºA/Bå¤åˆ¶ã€‚æœ‰ä¸€å°æœåŠ¡å™¨å«åšMasterï¼Œæœ‰ä¸€å †ä»æœåŠ¡å™¨å«åšSlaveï¼ŒMasterç”¨æ¥åšå†™æ“ä½œï¼Œå†™å®Œä»¥ååŒæ­¥ç»™ä»æœºï¼Œä»æœºåªç”¨æ¥åšè¯»æ“ä½œã€‚é‚£ä¹ˆä»æœºå°±æ˜¯ä¸€ä¸ªåªè¯»ç¯å¢ƒï¼Œç”¨MYISAMæ•°æ®åº“å¼•æ“ï¼Œæ˜¯ä¸æ˜¯ç¬¦åˆæˆ‘ä»¬è¯»å¤šå†™å°‘çš„ç¯å¢ƒå•Šï¼Œè€Œä¸»æœåŠ¡å™¨ç”¨INNODBï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§æ¶æ„çš„æ–¹å¼ï¼Œäº†è§£ä¸€ä¸‹ï¼Œæœ‰çš„å…¬å¸æ¯”è¾ƒè¿½æ±‚è¯»æ€§èƒ½å°±ä¼šç”¨è¿™ç§æ¶æ„ï¼Œä½†æ˜¯æˆ‘ä»¬å¤§å¤šæ•°æ—¶å€™æ˜¯ä¸»ä»éƒ½ç”¨INNODBã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ¥äº†è§£ä¸€ä¸‹MYSQLå’ŒMARIADBé»˜è®¤çš„å­˜å‚¨å¼•æ“æ˜¯ä»€ä¹ˆï¼Œå°±æ˜¯è¯´ä½ ä»€ä¹ˆæ“ä½œéƒ½ä¸æ”¹ï¼Œåšæ•°æ®è¯»å†™çš„æ—¶å€™é»˜è®¤ä½¿ç”¨çš„å­˜å‚¨å¼•æ“ã€‚MYSQLæœ‰å‡ ä¸ªä¸åŒçš„ç‰ˆæœ¬ï¼Œåœ¨SUNå…¬å¸æ‰‹ä¸‹çš„æ—¶å€™ï¼Œæœ‰5.0ç‰ˆæœ¬å’Œ5.1ç‰ˆæœ¬ï¼Œé»˜è®¤ä½¿ç”¨MYISAMå­˜å‚¨å¼•æ“ï¼›åæ¥è¢«ORACLEæ”¶è´­ä¹‹åçš„ç¬¬ä¸€ç‰ˆæœ¬æ˜¯5.5ï¼Œå¼€å‘çš„ç¬¬äºŒä¸ªç‰ˆæœ¬æ˜¯5.6ï¼Œç°åœ¨æœ€æ–°çš„ç‰ˆæœ¬æ˜¯5.7ï¼ŒORACLEæ”¶è´­å®Œé»˜è®¤çš„å­˜å‚¨å¼•æ“æ˜¯INNODBã€‚MARIADBæœ‰5.0ï¼Œ5.1ç›¸å¯¹äºMYSQLçš„5.0å’Œ5.1ï¼Œæœ‰ä¸€ä¸ªMYSQLç‰ˆæœ¬ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªMARIADBç‰ˆæœ¬ã€‚RHEL7é»˜è®¤ç”¨çš„MARIADB 5.5ç‰ˆæœ¬ï¼ŒMYSQLæœ‰5.6ç‰ˆæœ¬ï¼ŒMARIADBå¯¹åº”çš„æ˜¯10ç‰ˆæœ¬ï¼ŒMYSQL 5.7ç‰ˆæœ¬ï¼Œå¯¹åº”çš„æ˜¯MARIADB 10.1ç‰ˆæœ¬ã€‚MARIADBè¯´æˆ‘ä»¥åä¸ä¼šè·Ÿç€ä½ çš„ç‰ˆæœ¬èµ°ï¼Œå› ä¸ºæˆ‘åæœŸå¼€å‘çš„è¿‡ç¨‹ä¸­ï¼ŒåŠŸèƒ½æ¯”ä½ å¤šï¼Œæ‰€ä»¥æˆ‘ç‰ˆæœ¬è·Ÿä½ ä¸€æ ·ï¼Œä¼šè®©ç”¨æˆ·æœ‰ä¸€ä¸ªé”™è¯¯çš„åˆ¤æ–­ï¼Œè®¤ä¸ºå¥½åƒæˆ‘æœ‰çš„åŠŸèƒ½MYSQLä¹Ÿæœ‰ï¼Œè€Œäº‹å®ä¸ŠMYSQLæ²¡æœ‰ï¼Œæˆ‘æ˜¯è¶…è¶ŠMYSQLçš„ã€‚<br>ORACLEå®˜æ–¹è¯´ï¼ŒMYSQL 5.6ç‰ˆæœ¬æ€§èƒ½è¦é«˜å‡º5.5ç‰ˆæœ¬çš„30%ï¼Œç›¸åŒçš„ç¡¬ä»¶ï¼Œç›¸åŒçš„æœºå™¨ä¸Šé¢ï¼Œæ€§èƒ½è¦é«˜å‡º30%ã€‚5.7ç›¸å¯¹äº5.6é«˜70%ï¼Œè¿™ä¸œè¥¿ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨æ€§èƒ½è°ƒä¼˜çš„æ—¶å€™æ˜¯å¾ˆéš¾æƒ³è±¡çš„ï¼Œåœ¨ç›¸åŒçš„ç¡¬ä»¶ä¸Šé¢ï¼Œå› ä¸ºç¨‹åºç¨ä½œä¿®æ”¹è®©æ€§èƒ½æå‡è¿™ä¹ˆå¤§ã€‚ä¸€èˆ¬æ¥è¯´ç¨‹åºç‰ˆæœ¬å‡çº§ä¹‹åï¼Œæ€§èƒ½å¢åŠ ä¸ª5%-10%ï¼Œè¿™æ˜¯åœ¨ä¸€ä¸ªå¯ä»¥ç†è§£çš„ï¼Œé€šå¸¸çš„æ–¹æ¡ˆå½“ä¸­ï¼Œä½†æ˜¯ORACLEè¯´èƒ½æå‡70%ï¼Œä»–çš„ç¡®åšäº†å¾ˆå¤šçš„ä¿®æ”¹ã€‚æ‰€ä»¥æˆ‘çš„å»ºè®®æ˜¯ï¼Œå¦‚æœå¤§å®¶ä½¿ç”¨MYSQSLï¼Œé‚£ä¹ˆèµ·ç è¦ä»5.6å¼€å§‹ä½¿ç”¨ï¼Œæœ€å¥½æ˜¯ä½¿ç”¨5.7ç‰ˆæœ¬ï¼Œæ€§èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œè¿˜æœ‰åé¢è¯¸å¤šé—®é¢˜ï¼Œä¾‹å¦‚å®‰å…¨æ€§é—®é¢˜ã€é«˜å¯ç”¨çš„é—®é¢˜ã€å¾ˆå¤šå»¶è¿Ÿæ€§çš„é—®é¢˜éƒ½å¾—åˆ°äº†ORACLEå…¬å¸éå¸¸æœ‰æ•ˆçš„è§£å†³ï¼å½“ç„¶ORACLEè¿™ä¹ˆåšä¹Ÿæ˜¯æœ‰ä»–çš„åŸå› çš„ï¼Œå› ä¸ºå¤ªå¤šçš„äººå»ä½¿ç”¨MARIADBäº†ï¼Œä»–å¦‚æœä¸åœ¨MYSQLä¸Šä½œå‡ºä¸€äº›é‡å¤§çš„çªç ´ï¼Œå°±æ²¡äººæ„¿æ„å»ç”¨MYSQLäº†ï¼Œæ‰€ä»¥ä»–è¿˜æ˜¯æœ‰äº†éå¸¸å¤§çš„æ”¹è¿›ã€‚å½“ç„¶MARIADBä¹Ÿæœ‰äº†æ”¹è¿›ï¼Œä½ æœ‰çš„åŠŸèƒ½æˆ‘ä¹Ÿæœ‰ï¼Œå¦‚æœç”¨MARIADBï¼Œæˆ‘å»ºè®®ç”¨10ç‰ˆæœ¬ï¼Œè¿™ä¸ªå€’ä¸æ˜¯æ€§èƒ½é—®é¢˜ï¼Œä¸»è¦æ˜¯ä¸€äº›æ–°ç‰¹æ€§ï¼Œå’Œå®‰å…¨ç›¸å…³çš„ä¸€äº›ç‰¹æ€§ï¼Œè¿˜æœ‰åŠŸèƒ½ç›¸å…³çš„ä¸€äº›ç‰¹æ€§ï¼Œ5.5ç‰ˆæœ¬ç¡®å®æ˜¯ç¼ºå°‘äº†ä¸€äº›éå¸¸é‡è¦çš„ä¸€äº›ç‰¹æ€§ï¼Œæ‰€ä»¥å»ºè®®ä½ ä¸Š10æˆ–è€…10.1ç‰ˆæœ¬ã€‚<br>æˆ‘ä»¬çš„è¯¾ç¨‹å½“ä¸­è¿˜æ˜¯ä»¥mariadbçš„5.5ç‰ˆæœ¬ï¼Œå› ä¸ºå¸¸è§çš„åŸºç¡€æ“ä½œä¸ç®¡å“ªä¸ªç‰ˆæœ¬éƒ½ä¸€æ ·ï¼ŒåŸºç¡€è®²å®Œäº†ä¼šç”¨mysqlçš„5.7ç‰ˆæœ¬æˆ–è€…mariadb10.1ç‰ˆæœ¬ï¼Œè®²ä¸€äº›ä»–ä»¬å…·æœ‰çš„æ–°ç‰¹æ€§ã€‚ä»¥é»˜è®¤ç‰ˆæœ¬å»è®²åŸºç¡€æ“ä½œï¼Œå†ä»¥æ–°ç‰ˆæœ¬å»è®²æ–°ç‰¹æ€§ã€‚</p>
<p>INNODB çš„ç‰¹æ€§</p>
<p><img src="pic/16-mysql5.6innodb.jpg" alt="innodb"></p>
<ul>
<li>ä¸»ä½“ç³»ç»“æ„ï¼šé»˜è®¤7ä¸ªåå°çº¿ç¨‹ï¼Œ4ä¸ªio thread(insert bufferã€logã€readã€write),1ä¸ªmaster thread(ä¼˜å…ˆçº§æœ€é«˜),1ä¸ªé”(lock)ç›‘æ§çº¿ç¨‹ï¼Œ1ä¸ªé”™è¯¯ç›‘æ§çº¿ç¨‹ã€‚å¯ä»¥é€šè¿‡<code>show engine innodb status</code>æ¥æŸ¥çœ‹ã€‚æ–°ç‰ˆæœ¬å·²å¯¹é»˜è®¤çš„read threadå’Œwrite threadåˆ†åˆ«å¢å¤§åˆ°4ä¸ªï¼Œå¯é€šè¿‡<code>show variables like &#39;innodb_io_thread%&#39;</code>æŸ¥çœ‹ã€‚</li>
</ul>
<p><img src="pic/thread01.png" alt=""></p>
<ul>
<li>å­˜å‚¨å¼•æ“ç»„æˆï¼šç¼“å†²æ± (buffer pool)ã€é‡åšæ—¥å¿—ç¼“å†²æ± (redo log buffer)ä»¥åŠé¢å¤–çš„å†…å­˜æ± (additional memory pool).å…·ä½“é…ç½®å¯ç”±<code>show variables like &#39;innodb_buffer_pool_size&#39;</code>ã€<code>show variables like
&#39;innodb_log_buffer_size&#39;</code>ã€<code>show variables like &#39;innodb_additional_mem_pool_size&#39;</code>æ¥æŸ¥çœ‹ã€‚</li>
</ul>
<p><img src="pic/thread02.png" alt=""></p>
<ul>
<li><p>ç¼“å†²æ± ï¼šå æœ€å¤§å—å†…å­˜ï¼Œç”¨æ¥å­˜æ”¾å„ç§æ•°æ®çš„ç¼“å­˜åŒ…æ‹¬æœ‰ç´¢å¼•é¡µã€æ•°æ®é¡µã€undoé¡µã€æ’å…¥ç¼“å†²ã€è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€innodbå­˜å‚¨çš„é”ä¿¡æ¯ã€æ•°æ®å­—å…¸ä¿¡æ¯ç­‰ã€‚å·¥ä½œæ–¹å¼æ€»æ˜¯å°†æ•°æ®åº“æ–‡ä»¶æŒ‰é¡µ(æ¯é¡µ16k)è¯»å–åˆ°ç¼“å†²æ± ï¼Œç„¶åæŒ‰æœ€è¿‘æœ€å°‘ä½¿ç”¨(lru)çš„ç®—æ³•æ¥ä¿ç•™åœ¨ç¼“å†²æ± ä¸­çš„ç¼“å­˜æ•°æ®ã€‚å¦‚æœæ•°æ®åº“æ–‡ä»¶éœ€è¦ä¿®æ”¹ï¼Œæ€»æ˜¯é¦–å…ˆä¿®æ”¹åœ¨ç¼“å­˜æ± ä¸­çš„é¡µ(å‘ç”Ÿä¿®æ”¹åå³ä¸ºè„é¡µ)ï¼Œç„¶åå†æŒ‰ç…§ä¸€å®šçš„é¢‘ç‡å°†ç¼“å†²æ± çš„è„é¡µåˆ·æ–°åˆ°æ–‡ä»¶ã€‚é€šè¿‡å‘½ä»¤<code>show engine innodb status;</code>æ¥æŸ¥çœ‹ã€‚</p>
</li>
<li><p>æ—¥å¿—ç¼“å†²ï¼šå°†é‡åšæ—¥å¿—ä¿¡æ¯å…ˆæ”¾å…¥è¿™ä¸ªç¼“å†²åŒºï¼Œç„¶åæŒ‰ä¸€å®šé¢‘ç‡å°†å…¶åˆ·æ–°åˆ°é‡åšæ—¥å¿—æ–‡ä»¶ã€‚</p>
</li>
</ul>
<hr>
<blockquote>
<h3 id="master-thread"><a href="#master-thread" class="headerlink" title="master thread:"></a><code>master thread</code>:</h3></blockquote>
<blockquote>
<h4 id="loopä¸»å¾ªç¯æ¯ç§’ä¸€æ¬¡çš„æ“ä½œï¼š"><a href="#loopä¸»å¾ªç¯æ¯ç§’ä¸€æ¬¡çš„æ“ä½œï¼š" class="headerlink" title="loopä¸»å¾ªç¯æ¯ç§’ä¸€æ¬¡çš„æ“ä½œï¼š"></a>loopä¸»å¾ªç¯æ¯ç§’ä¸€æ¬¡çš„æ“ä½œï¼š</h4></blockquote>
<ol>
<li>ç¡è§‰</li>
<li>å°†æ—¥å¿—ç¼“å†²åˆ·æ–°åˆ°ç£ç›˜ï¼Œå³ä½¿äº‹åŠ¡æœªæäº¤</li>
<li>å¦‚æœã€å‰1sçš„I/Oæ¬¡æ•°ã€‘å°äºã€ç£ç›˜I/Oååé‡çš„5% ï¼ˆé»˜è®¤200<em>5%=10ä¸ªé¡µï¼‰ã€‘ï¼Œåˆ™åˆå¹¶æ’å…¥ç¼“å†²ï¼ˆæ•°é‡ä¸ºç£ç›˜I/Oååé‡</em>5%å³10ä¸ªé¡µï¼‰</li>
<li>å¦‚æœã€è„é¡µæ¯”ä¾‹ã€‘å¤§äºã€é˜€å€¼ï¼ˆé»˜è®¤ä¸º75ï¼Œè„é¡µæ¯”ä¾‹ä¸ºç™¾åˆ†ä¹‹ä¸ƒåäº”ï¼‰ã€‘ï¼Œåˆ™åˆ·æ–°ç¼“å†²æ± ä¸­è„é¡µåˆ°ç£ç›˜ï¼Œå¦åˆ™åªåˆ·æ–°åˆé€‚çš„è„é¡µæ•°é‡ï¼ˆinnodb_adaptive_flushingå‚æ•°å†³å®šï¼‰</li>
<li>å½“å‰æ²¡æœ‰ç”¨æˆ·æ´»åŠ¨ï¼Œåˆ‡æ¢åˆ°åå°å¾ªç¯</li>
</ol>
<blockquote>
<h4 id="loopä¸»å¾ªç¯æ¯åç§’ä¸€æ¬¡çš„æ“ä½œï¼š"><a href="#loopä¸»å¾ªç¯æ¯åç§’ä¸€æ¬¡çš„æ“ä½œï¼š" class="headerlink" title="loopä¸»å¾ªç¯æ¯åç§’ä¸€æ¬¡çš„æ“ä½œï¼š"></a>loopä¸»å¾ªç¯æ¯åç§’ä¸€æ¬¡çš„æ“ä½œï¼š</h4></blockquote>
<ol>
<li>å°†æ—¥å¿—ç¼“å†²åˆ·æ–°åˆ°ç£ç›˜ï¼Œå³ä½¿äº‹åŠ¡æœªæäº¤</li>
<li>åˆ é™¤æ— ç”¨çš„undoé¡µ</li>
<li>åˆå¹¶æ’å…¥ç¼“å†²ï¼Œç¼“å†²æ•°é‡ä¸ºã€ç£ç›˜I/Oååé‡çš„5%ï¼Œå¦‚æœé»˜è®¤200ï¼Œåˆ™åˆå¹¶æ’å…¥ç¼“å†²10ä¸ªã€‘</li>
<li>å¦‚æœã€å‰10sçš„I/Oæ¬¡æ•°ã€‘å°äºã€ç£ç›˜I/Oååé‡ï¼ˆé»˜è®¤200<em>100%=200ä¸ªé¡µï¼‰ã€‘ï¼Œåˆ™åˆ·æ–°ç¼“å†²æ± ä¸­è„é¡µåˆ°ç£ç›˜ï¼ˆæ•°é‡ä¸ºç£ç›˜I/Oååé‡</em>100%å³200ä¸ªé¡µï¼‰</li>
<li>å¦‚æœã€è„é¡µæ¯”ä¾‹ã€‘å¤§äºã€é˜€å€¼ï¼ˆé»˜è®¤ä¸º75ï¼Œè„é¡µæ¯”ä¾‹ä¸ºç™¾åˆ†ä¹‹ä¸ƒåäº”ï¼‰ã€‘ï¼Œåˆ™åˆ·æ–°ç¼“å†²æ± ä¸­è„é¡µåˆ°ç£ç›˜ï¼ˆæ•°é‡ä¸ºç£ç›˜I/Oååé‡<em>100%å³200ä¸ªé¡µï¼‰ï¼Œå¦åˆ™è„é¡µåˆ·æ–°æ•°é‡ä¸ºï¼ˆç£ç›˜I/Oååé‡</em>10%å³20ä¸ªé¡µï¼‰</li>
<li>äº§ç”Ÿä¸€ä¸ªæ£€æŸ¥ç‚¹ï¼ˆæ¨¡ç³Šæ£€æŸ¥ç‚¹ï¼‰     </li>
</ol>
<blockquote>
<h4 id="backgroud-loopï¼Œè‹¥å½“å‰æ²¡æœ‰ç”¨æˆ·æ´»åŠ¨-æ•°æ®åº“ç©ºé—²æ—¶-æˆ–è€…æ•°æ®åº“å…³é—­æ—¶ï¼Œå°±ä¼šåˆ‡æ¢åˆ°è¿™ä¸ªå¾ªç¯ï¼š"><a href="#backgroud-loopï¼Œè‹¥å½“å‰æ²¡æœ‰ç”¨æˆ·æ´»åŠ¨-æ•°æ®åº“ç©ºé—²æ—¶-æˆ–è€…æ•°æ®åº“å…³é—­æ—¶ï¼Œå°±ä¼šåˆ‡æ¢åˆ°è¿™ä¸ªå¾ªç¯ï¼š" class="headerlink" title="backgroud loopï¼Œè‹¥å½“å‰æ²¡æœ‰ç”¨æˆ·æ´»åŠ¨(æ•°æ®åº“ç©ºé—²æ—¶)æˆ–è€…æ•°æ®åº“å…³é—­æ—¶ï¼Œå°±ä¼šåˆ‡æ¢åˆ°è¿™ä¸ªå¾ªç¯ï¼š"></a>backgroud loopï¼Œè‹¥å½“å‰æ²¡æœ‰ç”¨æˆ·æ´»åŠ¨(æ•°æ®åº“ç©ºé—²æ—¶)æˆ–è€…æ•°æ®åº“å…³é—­æ—¶ï¼Œå°±ä¼šåˆ‡æ¢åˆ°è¿™ä¸ªå¾ªç¯ï¼š</h4></blockquote>
<ol>
<li>åˆ é™¤æ— ç”¨çš„undoé¡µ</li>
<li>åˆå¹¶æ’å…¥ç¼“å†²ï¼Œç¼“å†²æ•°é‡ä¸ºã€ç£ç›˜I/Oååé‡çš„10%ï¼Œå¦‚æœé»˜è®¤200ï¼Œåˆ™åˆå¹¶æ’å…¥ç¼“å†²20ä¸ªã€‘</li>
<li>å½“å‰æœ‰ç”¨æˆ·æ´»åŠ¨ï¼Œåˆ‡æ¢åˆ°ä¸»å¾ªç¯</li>
<li>å½“å‰æ²¡æœ‰ç”¨æˆ·æ´»åŠ¨ï¼Œåˆ‡æ¢åˆ°åˆ·æ–°å¾ªç¯</li>
</ol>
<blockquote>
<h4 id="flush-loop-åˆ·æ–°å¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š"><a href="#flush-loop-åˆ·æ–°å¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š" class="headerlink" title="flush loop åˆ·æ–°å¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š"></a>flush loop åˆ·æ–°å¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š</h4></blockquote>
<ol>
<li>åˆ·æ–°ç¼“å†²æ± ä¸­è„é¡µåˆ°ç£ç›˜ï¼ˆæ•°é‡ä¸ºç£ç›˜I/Oååé‡*100%å³200ä¸ªé¡µï¼‰</li>
<li>å¦‚æœã€è„é¡µæ¯”ä¾‹ã€‘å¤§äºã€é˜€å€¼ï¼ˆé»˜è®¤ä¸º75ï¼Œè„é¡µæ¯”ä¾‹ä¸ºç™¾åˆ†ä¹‹ä¸ƒåäº”ï¼‰ã€‘ï¼Œåˆ™ç»§ç»­è¿›å…¥åˆ·æ–°å¾ªç¯ï¼Œå¦åˆ™è¿›å…¥æš‚åœå¾ªç¯</li>
</ol>
<blockquote>
<h4 id="suspend-loopæš‚åœå¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š"><a href="#suspend-loopæš‚åœå¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š" class="headerlink" title="suspend_loopæš‚åœå¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š"></a>suspend_loopæš‚åœå¾ªç¯ï¼ŒåŒ…æ‹¬ï¼š</h4></blockquote>
<ol>
<li>ç­‰å¾…äº‹ä»¶å‘ç”Ÿï¼Œè¿›å…¥ä¸»å¾ªç¯</li>
</ol>
<p><img src="pic/thread03.png" alt=""></p>
<blockquote>
<h3 id="æ’å…¥ç¼“å†²ï¼š"><a href="#æ’å…¥ç¼“å†²ï¼š" class="headerlink" title="æ’å…¥ç¼“å†²ï¼š"></a><code>æ’å…¥ç¼“å†²</code>ï¼š</h3></blockquote>
<p>ä¸æ˜¯ç¼“å†²æ± çš„ä¸€éƒ¨åˆ†ï¼ŒInsert Bufferæ˜¯ç‰©ç†é¡µçš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†,å®ƒå¸¦æ¥InnoDBæ€§èƒ½çš„æé«˜ã€‚æ ¹æ®B+ç®—æ³•çš„ç‰¹ç‚¹ï¼Œæ’å…¥æ•°æ®çš„æ—¶å€™ä¸»é”®ç´¢å¼•æ˜¯é¡ºåºçš„ï¼Œä¸ä¼šé€ æˆæ•°æ®åº“çš„éšæœºè¯»å–ï¼Œè€Œå¯¹äºéèšé›†ç´¢å¼•(å³è¾…åŠ©ç´¢å¼•)ï¼Œå¶å­èŠ‚ç‚¹çš„æ’å…¥ä¸å†æ˜¯é¡ºåºçš„äº†ï¼Œè¿™æ—¶éœ€è¦ç¦»æ•£åœ°è®¿é—®éèšé›†ç´¢å¼•ï¼Œæ’å…¥æ€§èƒ½åœ¨è¿™é‡Œå˜ä½äº†ã€‚InnoDBå¼•å…¥æ’å…¥ç¼“å†²ï¼Œåˆ¤æ–­éèšé›†ç´¢å¼•é¡µæ˜¯å¦åœ¨ç¼“å†²æ± ä¸­ï¼Œå¦‚æœåœ¨åˆ™ç›´æ¥æ’å…¥;ä¸åœ¨ï¼Œåˆ™å…ˆæ”¾åœ¨ æ’å…¥ç¼“å†²åŒºä¸­ã€‚ç„¶åæ ¹æ®ä¸Šè¿°master threadä¸­ä»‹ç»çš„ï¼Œä¼šæœ‰ä¸€å®šçš„é¢‘ç‡å°†æ’å…¥ç¼“å†²åˆå¹¶ã€‚æ­¤å¤–ï¼Œè¾…åŠ©ç´¢å¼•ä¸èƒ½æ˜¯å”¯ä¸€çš„ï¼Œå› ä¸ºæ’å…¥åˆ°æ’å…¥ç¼“å†²æ—¶ï¼Œå¹¶ä¸å»æŸ¥æ‰¾ç´¢å¼•é¡µçš„æƒ…å†µï¼Œå¦åˆ™ä»ç„¶ä¼šé€ æˆéšæœºè¯»ï¼Œå¤±å»æ’å…¥ç¼“å†²çš„æ„ä¹‰äº†ã€‚æ’å…¥ç¼“å†²å¯èƒ½ä¼šå ç¼“å†²æ± ä¸­å†…å­˜ï¼Œé»˜è®¤ä¹Ÿèƒ½ä¼šå åˆ°1/2ï¼Œæ‰€ä»¥å¯ä»¥å°†è¿™ä¸ªå€¼è°ƒå°ç‚¹ï¼Œåˆ°1/3ã€‚é€šè¿‡IBUF_POOL_SIZE_PER_MAX_SIZEæ¥è®¾ç½®ï¼Œ2è¡¨ç¤º1/2,3è¡¨ç¤º1/3ã€‚</p>
<blockquote>
<h3 id="ä¸¤æ¬¡å†™ï¼š"><a href="#ä¸¤æ¬¡å†™ï¼š" class="headerlink" title="ä¸¤æ¬¡å†™ï¼š"></a><code>ä¸¤æ¬¡å†™</code>ï¼š</h3></blockquote>
<p>å®ƒå¸¦æ¥InnoDBæ•°æ®çš„å¯é æ€§ã€‚å¦‚æœå†™å¤±æ•ˆï¼Œå¯ä»¥é€šè¿‡é‡åšæ—¥å¿—è¿›è¡Œæ¢å¤ï¼Œä½†æ˜¯é‡åšæ—¥å¿—ä¸­è®°å½•çš„æ˜¯å¯¹é¡µçš„ç‰©ç†æ“ä½œï¼Œå¦‚æœé¡µæœ¬èº«æŸåï¼Œå†å¯¹å…¶è¿›è¡Œé‡åšæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚æ‰€ä»¥ï¼Œåœ¨åº”ç”¨é‡åšæ—¥å¿—å‰ï¼Œéœ€è¦ä¸€ä¸ªé¡µçš„å‰¯æœ¬ï¼Œå½“å†™å…¥å¤±æ•ˆå‘ç”Ÿæ—¶ï¼Œå…ˆé€šè¿‡é¡µçš„å‰¯æœ¬æ¥è¿˜åŸè¯¥é¡µï¼Œå†è¿›è¡Œé‡åšï¼Œè¿™å°±æ˜¯doublewireã€‚</p>
<p>æ¢å¤æ•°æ®=é¡µå‰¯æœ¬+é‡åšæ—¥å¿—</p>
<blockquote>
<h3 id="INNODB-çš„è¡¨"><a href="#INNODB-çš„è¡¨" class="headerlink" title="INNODB çš„è¡¨"></a>INNODB çš„è¡¨</h3></blockquote>
<ol>
<li><code>è¡¨ç©ºé—´</code>ï¼šè¡¨ç©ºé—´å¯çœ‹åšæ˜¯InnoDBå­˜å‚¨å¼•æ“é€»è¾‘ç»“æ„çš„æœ€é«˜å±‚ã€‚</li>
<li><code>æ®µ</code>ï¼šè¡¨ç©ºé—´ç”±å„ä¸ªæ®µç»„æˆï¼Œå¸¸è§çš„æ®µæœ‰æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µç­‰ã€‚</li>
<li><code>åŒº</code>ï¼šç”±64ä¸ªè¿ç»­çš„é¡µç»„æˆï¼Œæ¯ä¸ªé¡µå¤§å°ä¸º16kbï¼Œå³æ¯ä¸ªåŒºå¤§å°ä¸º1MBã€‚</li>
<li><code>é¡µ</code>ï¼šæ¯é¡µ16kbï¼Œä¸”ä¸èƒ½æ›´æ”¹ã€‚å¸¸è§çš„é¡µç±»å‹æœ‰ï¼šæ•°æ®é¡µã€Undoé¡µã€ç³»ç»Ÿé¡µã€äº‹åŠ¡æ•°æ®é¡µã€æ’å…¥ç¼“å†²ä½å›¾é¡µã€æ’å…¥ç¼“å†²ç©ºé—²åˆ—è¡¨é¡µã€æœªå‹ç¼©çš„äºŒè¿›åˆ¶å¤§å¯¹è±¡é¡µã€å‹ç¼©çš„äºŒè¿›åˆ¶å¤§å¯¹è±¡é¡µã€‚</li>
<li><code>è¡Œ</code>ï¼šInnoDBå­˜å‚¨å¼•æ“æ˜¯é¢å‘è¡Œçš„(row-oriented)ï¼Œæ¯é¡µæœ€å¤šå…è®¸å­˜æ”¾7992è¡Œæ•°æ®ã€‚</li>
<li><code>è¡Œè®°å½•æ ¼å¼</code>ï¼šå¸¸è§ä¸¤ç§è¡Œè®°å½•æ ¼å¼Compactå’ŒRedundantï¼Œmysql5.1ç‰ˆæœ¬åï¼Œä¸»è¦æ˜¯Compactè¡Œè®°å½•æ ¼å¼ã€‚å¯¹äºCompactï¼Œä¸ç®¡æ˜¯charå‹è¿˜æ˜¯varcharå‹ï¼Œnullå‹éƒ½æ˜¯ä¸å ç”¨å­˜å‚¨ç©ºé—´çš„ï¼›å¯¹äºRedudant,varcharçš„nullä¸å ç”¨ç©ºé—´ï¼Œcharçš„nullå‹æ˜¯å ç”¨å­˜å‚¨ç©ºé—´çš„ã€‚</li>
</ol>
<p>varcharç±»å‹çš„é•¿åº¦é™åˆ¶æ˜¯65535ï¼Œå…¶å®è¾¾ä¸åˆ°ï¼Œä¼šæœ‰åˆ«çš„å¼€é”€ï¼Œä¸€èˆ¬æ˜¯65530å·¦å³ï¼Œè¿™è¿˜è·Ÿé€‰å–çš„å­—ç¬¦é›†æœ‰å…³ã€‚æ­¤å¤–è¿™ä¸ªé•¿åº¦é™åˆ¶æ˜¯ä¸€æ•´è¡Œçš„ï¼Œä¾‹å¦‚ï¼š<code>create table test(a varchar(22000), b varchar(22000), cvarchar(22000)) charset=latin1 engine=innodb;</code>ä¹Ÿä¼šæŠ¥é”™ã€‚</p>
<p>å¯¹äºblobç±»å‹çš„æ•°æ®ï¼Œåœ¨æ•°æ®é¡µé¢ä¸­åªä¿å­˜äº†varchar(65535)çš„å‰768ä¸ªå­—èŠ‚å‰ç¼€æ•°æ®ï¼Œä¹‹åè·Ÿçš„æ˜¯åç§»é‡ï¼ŒæŒ‡å‘è¡Œæº¢å‡ºé¡µï¼Œä¹Ÿå°±æ˜¯Uncompressed BLOB Pageã€‚æ–°çš„InnoDB Pluginå¼•å…¥äº†æ–°çš„æ–‡ä»¶æ ¼å¼ç§°ä¸ºBarracudaï¼Œå…¶æœ‰ä¸¤ç§æ–°çš„è¡Œè®°å½•æ ¼å¼Compressedå’ŒDynamicï¼Œä¸¤è€…å¯¹äºå­˜å…¥Blogå­—æ®µé‡‡ç”¨äº†å®Œå…¨æº¢å‡ºçš„æ–¹å¼ï¼Œåœ¨æ•°æ®åº“é¡µä¸­å­˜æ”¾20ä¸ªå­—èŠ‚çš„æŒ‡é’ˆï¼Œå®é™…çš„æ•°æ®éƒ½å­˜å…¥åœ¨BLOB Pageä¸­ã€‚   </p>
<h4 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h4><p>äº‹åŠ¡(Transaction)æ˜¯å¹¶å‘æ§åˆ¶çš„åŸºæœ¬å•ä½ã€‚</p>
<p>æ‰€è°“äº‹åŠ¡,å®ƒæ˜¯ä¸€ä¸ªæ“ä½œåºåˆ—,è¿™äº›æ“ä½œè¦ä¹ˆéƒ½æ‰§è¡Œ,è¦ä¹ˆéƒ½ä¸æ‰§è¡Œ, å®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚ä¾‹å¦‚,é“¶è¡Œè½¬å¸å·¥ä½œ:ä»ä¸€ä¸ªå¸å·æ‰£æ¬¾å¹¶ ä½¿å¦ä¸€ä¸ªå¸å·å¢æ¬¾,è¿™ä¸¤ä¸ªæ“ä½œè¦ä¹ˆéƒ½æ‰§è¡Œ,è¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</p>
<p>æ•°æ®åº“äº‹åŠ¡å¿…é¡»å…·å¤‡ACIDç‰¹æ€§,ACIDæ˜¯Atomic(åŸå­æ€§)ã€ Consistency(ä¸€è‡´æ€§)ã€Isolation(éš”ç¦»æ€§)å’ŒDurability(æŒä¹…æ€§)çš„ è‹±æ–‡ç¼©å†™ã€‚</p>
<ul>
<li>åŸå­æ€§:</li>
</ul>
<p>æŒ‡æ•´ä¸ªæ•°æ®åº“äº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚åªæœ‰ä½¿æ®åº“ä¸­æ‰€ æœ‰çš„æ“ä½œæ‰§è¡ŒæˆåŠŸ,æ‰ç®—æ•´ä¸ªäº‹åŠ¡æˆåŠŸ;äº‹åŠ¡ä¸­ä»»ä½•ä¸€ä¸ªSQLè¯­å¥æ‰§è¡Œå¤± è´¥,é‚£ä¹ˆå·²ç»æ‰§è¡ŒæˆåŠŸçš„SQLè¯­å¥ä¹Ÿå¿…é¡»æ’¤é”€,æ•°æ®åº“çŠ¶æ€åº”è¯¥é€€å›åˆ°æ‰§ è¡Œäº‹åŠ¡å‰çš„çŠ¶æ€ã€‚</p>
<ul>
<li>ä¸€è‡´æ€§:</li>
</ul>
<p>æŒ‡æ•°æ®åº“äº‹åŠ¡ä¸èƒ½ç ´åå…³ç³»æ•°æ®çš„å®Œæ•´æ€§ä»¥åŠä¸šåŠ¡é€»è¾‘ä¸Šçš„ ä¸€è‡´æ€§ã€‚ä¾‹å¦‚å¯¹é“¶è¡Œè½¬å¸äº‹åŠ¡,ä¸ç®¡äº‹åŠ¡æˆåŠŸè¿˜æ˜¯å¤±è´¥,åº”è¯¥ä¿è¯äº‹åŠ¡ç»“ æŸåACCOUNTSè¡¨ä¸­Tomå’ŒJackçš„å­˜æ¬¾æ€»é¢ä¸º2000å…ƒã€‚</p>
<ul>
<li>éš”ç¦»æ€§:</li>
</ul>
<p>æŒ‡çš„æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­,å½“ä¸åŒçš„äº‹åŠ¡åŒæ—¶æ“çºµç›¸åŒçš„æ•°æ® æ—¶,æ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªçš„å®Œæ•´æ•°æ®ç©ºé—´ã€‚ç”±å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å¿…é¡»ä¸ä»» ä½•å…¶ä»–å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹éš”ç¦»ã€‚äº‹åŠ¡æŸ¥çœ‹æ•°æ®æ›´æ–°æ—¶,æ•°æ®æ‰€å¤„çš„çŠ¶æ€ è¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹å‰çš„çŠ¶æ€,è¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹åçš„çŠ¶æ€, äº‹åŠ¡ä¸ä¼šæŸ¥çœ‹åˆ°ä¸­é—´çŠ¶æ€çš„æ•°æ®ã€‚</p>
<ul>
<li>æŒä¹…æ€§:</li>
</ul>
<p>æŒ‡çš„æ˜¯åªè¦äº‹åŠ¡æˆåŠŸç»“æŸ,å®ƒå¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ–°å°±å¿…é¡»æ°¸ ä¹…ä¿å­˜ä¸‹æ¥ã€‚å³ä½¿å‘ç”Ÿç³»ç»Ÿå´©æºƒ,é‡æ–°å¯åŠ¨æ•°æ®åº“ç³»ç»Ÿå,æ•°æ®åº“è¿˜èƒ½æ¢ å¤åˆ°äº‹åŠ¡æˆåŠŸç»“æŸæ—¶çš„çŠ¶æ€ã€‚</p>
<p>äº‹åŠ¡çš„(ACID)ç‰¹æ€§æ˜¯ç”±å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆRDBMSï¼‰æ¥å®ç°çš„ã€‚æ•°æ®åº“ç®¡ç†ç³»ç»Ÿé‡‡ç”¨æ—¥å¿—æ¥ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€ä¸€è‡´æ€§å’Œ æŒä¹…æ€§ã€‚æ—¥å¿—è®°å½•äº†äº‹åŠ¡å¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ–°,å¦‚æœæŸä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ ä¸­å‘ç”Ÿé”™è¯¯,å°±å¯ä»¥æ ¹æ®æ—¥å¿—,æ’¤é”€äº‹åŠ¡å¯¹æ•°æ®åº“å·²åšçš„æ›´æ–°,ä½¿æ•°æ®åº“ é€€å›åˆ°æ‰§è¡Œäº‹åŠ¡å‰çš„åˆå§‹çŠ¶æ€ã€‚ æ•°æ®åº“ç®¡ç†ç³»ç»Ÿé‡‡ç”¨é”æœºåˆ¶æ¥å®ç°äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚å½“å¤šä¸ªäº‹åŠ¡åŒæ—¶æ›´ æ–°æ•°æ®åº“ä¸­ç›¸åŒçš„æ•°æ®æ—¶,åªå…è®¸æŒæœ‰é”çš„äº‹åŠ¡èƒ½æ›´æ–°è¯¥æ•°æ®,å…¶ä»–äº‹åŠ¡ å¿…é¡»ç­‰å¾…,ç›´åˆ°å‰ä¸€ä¸ªäº‹åŠ¡é‡Šæ”¾äº†é”,å…¶ä»–äº‹åŠ¡æ‰æœ‰æœºä¼šæ›´æ–°è¯¥æ•°æ®ã€‚</p>
<h4 id="å¹¶å‘æ§åˆ¶"><a href="#å¹¶å‘æ§åˆ¶" class="headerlink" title="å¹¶å‘æ§åˆ¶"></a>å¹¶å‘æ§åˆ¶</h4><h5 id="é”æœºåˆ¶"><a href="#é”æœºåˆ¶" class="headerlink" title="é”æœºåˆ¶"></a>é”æœºåˆ¶</h5><p>InnoDBå­˜å‚¨å¼•æ“é”çš„å®ç°å’ŒOracleéå¸¸ç±»ä¼¼ï¼Œæä¾›ä¸€è‡´æ€§çš„éé”å®šè¯»ã€è¡Œçº§é”æ”¯æŒã€è¡Œçº§é”æ²¡æœ‰ç›¸å…³çš„å¼€é”€ï¼Œå¯ä»¥åŒæ—¶å¾—åˆ°å¹¶å‘æ€§å’Œä¸€è‡´æ€§ã€‚</p>
<p>InnoDBå­˜å‚¨å¼•æ“å®ç°äº†å¦‚ä¸‹ä¸¤ç§æ ‡å‡†çš„è¡Œçº§é”ï¼š</p>
<ol>
<li>å…±äº«é”(S Lock)ï¼šå…è®¸äº‹åŠ¡è¯»ä¸€è¡Œæ•°æ®ï¼›</li>
<li>æ’ä»–é”(X Lock)ï¼šå…è®¸äº‹åŠ¡åˆ é™¤æˆ–è€…æ›´æ–°ä¸€è¡Œæ•°æ®ã€‚</li>
</ol>
<p>å½“ä¸€ä¸ªäº‹åŠ¡å·²ç»è·å¾—äº†è¡Œçš„å…±äº«é”ï¼Œé‚£ä¹ˆå¦å¤–çš„äº‹åŠ¡å¯ä»¥ç«‹å³è·å¾—è¡Œçš„å…±äº«é”ï¼Œå› ä¸ºè¯»å–æ²¡æœ‰æ”¹å˜è¡Œçš„æ•°æ®ï¼Œæˆ‘ä»¬ç§°è¿™ç§æƒ…å†µä¸ºé”å…¼å®¹ã€‚ä½†å¦‚æœæœ‰äº‹åŠ¡æƒ³è·å¾—è¡Œçš„æ’ä»–é”ï¼Œåˆ™å®ƒå¿…é¡»ç­‰å¾…äº‹åŠ¡é‡Šæ”¾è¡Œrä¸Šçš„å…±äº«é”â€”â€”â€”â€”è¿™ç§æƒ…å†µç§°ä¸ºé”ä¸å…¼å®¹ã€‚</p>
<p>åœ¨InnoDB Pluginä¹‹å‰ï¼Œåªèƒ½é€šè¿‡<code>SHOW FULL PROCESSLIST;</code>ï¼Œ<code>SHOW ENGINE INOODB STATUS;</code>ç­‰å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰çš„æ•°æ®åº“è¯·æ±‚ï¼Œç„¶åå†åˆ¤æ–­å½“å‰äº‹åŠ¡ä¸­çš„é”çš„æƒ…å†µã€‚æ–°ç‰ˆæœ¬çš„InnoDB Pluginä¸­ï¼Œåœ¨INFORMATION_SCHEMAæ¶æ„ä¸‹æ·»åŠ äº†<code>INNODB_TRXã€INNODB_LOCKSã€InnoDB_LOCK_WAITS</code>ã€‚é€šè¿‡è¿™ä¸‰å¼ è¡¨ï¼Œå¯ä»¥æ›´ç®€å•åœ°ç›‘æ§å½“å‰çš„äº‹åŠ¡å¹¶åˆ†æå¯èƒ½å­˜åœ¨çš„é”çš„é—®é¢˜ã€‚</p>
<p>INNODB_TRXç”±8ä¸ªå­—æ®µç»„æˆï¼š</p>
<blockquote>
<p>é€šè¿‡<code>select * from infomation_schema.INNODB_TRX;</code>å¯æŸ¥çœ‹</p>
</blockquote>
<ol>
<li>trx_id:InnoDBå­˜å‚¨å¼•æ“å†…éƒ¨å”¯ä¸€çš„äº‹åŠ¡ID</li>
<li>trx_state:å½“å‰äº‹åŠ¡çš„çŠ¶æ€ã€‚</li>
<li>trx_started:äº‹åŠ¡çš„å¼€å§‹æ—¶é—´ã€‚</li>
<li>trx_requested_lock_id:ç­‰å¾…äº‹åŠ¡çš„é”IDã€‚å¦‚trx_stateçš„çŠ¶æ€ä¸ºLOCK WAIT,é‚£ä¹ˆè¯¥å€¼ä»£è¡¨å½“å‰çš„ç­‰å¾…ä¹‹å‰äº‹åŠ¡å ç”¨é”èµ„æºçš„ID.</li>
<li>è‹¥trx_stateä¸æ˜¯LOCK WAIT,åˆ™è¯¥å€¼ä¸ºNULLã€‚</li>
<li>trx_wait_started:äº‹åŠ¡ç­‰å¾…å¼€å§‹çš„æ—¶é—´ã€‚</li>
<li>trx_weight:äº‹åŠ¡çš„æƒé‡ï¼Œåæ˜ äº†ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹å’Œé”ä½çš„è¡Œæ•°ã€‚åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œå½“å‘ç”Ÿæ­»é”éœ€è¦å›æ»šæ—¶ï¼ŒInnoDBå­˜å‚¨ä¼šé€‰<br>æ‹©è¯¥å€¼æœ€å°çš„è¿›è¡Œå›æ»šã€‚</li>
<li>trx_mysql_thread_id:Mysqlä¸­çš„çº¿ç¨‹ID,<code>SHOW PROCESSLIST;</code>æ˜¾ç¤ºçš„ç»“æœã€‚</li>
<li>trx_query:äº‹åŠ¡è¿è¡Œçš„sqlè¯­å¥ã€‚</li>
</ol>
<p>INNODB_LOCKSè¡¨ï¼Œè¯¥è¡¨ç”±å¦‚ä¸‹å­—æ®µç»„æˆï¼š</p>
<blockquote>
<p>é€šè¿‡<code>select * from information_schema.INNODB_LOCK;</code>å¯æŸ¥çœ‹</p>
</blockquote>
<ol>
<li>lock_id:é”çš„IDã€‚</li>
<li>lock_trx_id:äº‹åŠ¡IDã€‚</li>
<li>lock_mode:é”çš„æ¨¡å¼ã€‚</li>
<li>lock_type:é”çš„ç±»å‹ï¼Œè¡¨é”è¿˜æ˜¯è¡Œé”ã€‚</li>
<li>lock_table:è¦åŠ é”çš„è¡¨ã€‚</li>
<li>lock_index:é”çš„ç´¢å¼•ã€‚</li>
<li>lock_space:InnoDBå­˜å‚¨å¼•æ“è¡¨ç©ºé—´çš„IDå·ã€‚</li>
<li>lock_page:è¢«é”ä½çš„é¡µçš„æ•°é‡ã€‚è‹¥æ˜¯è¡¨é”ï¼Œåˆ™è¯¥å€¼ä¸ºNULLã€‚</li>
<li>lock_rec:è¢«é”ä½çš„è¡Œçš„æ•°é‡ã€‚è‹¥æ˜¯è¡¨é”ï¼Œåˆ™è¯¥å€¼ä¸ºNULLã€‚</li>
<li>lock_data:è¢«é”ä½çš„è¡Œçš„ä¸»é”®å€¼ã€‚å½“æ˜¯è¡¨é”æ—¶ï¼Œè¯¥å€¼ä¸ºNULLã€‚</li>
</ol>
<p>INNODB_LOCK_WAITç”±4ä¸ªå­—æ®µç»„æˆï¼š</p>
<blockquote>
<p>é€šè¿‡<code>select * from information_schema.INNODB_LOCK_WAITS;</code>å¯æŸ¥çœ‹ã€‚</p>
</blockquote>
<ol>
<li>requesting_trx_id:ç”³è¯·é”èµ„æºçš„äº‹åŠ¡IDã€‚</li>
<li>requesting_lock_id:ç”³è¯·çš„é”çš„IDã€‚</li>
<li>blocking_trx_id:é˜»å¡çš„é”çš„IDã€‚</li>
</ol>
<h5 id="å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC"><a href="#å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC" class="headerlink" title="å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ MVCC"></a>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ MVCC</h5><p>InnoDBå­˜å‚¨å¼•æ“é€šè¿‡è¡Œ<code>å¤šç‰ˆæœ¬æ§åˆ¶ MVCC</code>çš„æ–¹å¼æ¥è¯»å–å½“å‰æ‰§è¡Œæ—¶é—´æ•°æ®åº“ä¸­è¡Œçš„æ•°æ®ã€‚å¦‚æœè¯»å–çš„è¡Œæ­£åœ¨æ‰§è¡ŒDeleteã€updateæ“ä½œï¼Œè¿™æ—¶è¯»å–æ“ä½œä¸ä¼šå› æ­¤è€Œä¼šç­‰å¾…è¡Œä¸Šé”çš„é‡Šæ”¾ï¼Œç›¸åï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¼šå»è¯»å–è¡Œçš„ä¸€ä¸ªå¿«ç…§æ•°æ®ã€‚å¿«ç…§æ•°æ®æ˜¯æŒ‡è¯¥è¡Œä¹‹å‰ç‰ˆæœ¬çš„æ•°æ®ï¼Œè¯¥å®ç°æ˜¯é€šè¿‡Undoæ®µæ¥å®ç°ã€‚è€ŒUndoç”¨æ¥äº‹åŠ¡ä¸­å›æ»šæ•°æ®ï¼Œå› æ­¤å¿«ç…§æœ¬èº«æ˜¯æ²¡æœ‰é¢å¤–å¼€é”€çš„ã€‚æ­¤å¤–ï¼Œå¿«ç…§æ•°æ®æ˜¯ä¸éœ€è¦ä¸Šé”çš„ï¼Œå› ä¸ºæ²¡æœ‰å¿…è¦å¯¹å†å²çš„æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚ä¸€ä¸ªè¡Œå¯èƒ½æœ‰ä¸æ­¢ä¸€ä¸ªå¿«ç…§æ•°æ®ï¼Œæ‰€ä»¥ç§°è¿™ç§æŠ€æœ¯ä¸ºè¡Œå¤šç‰ˆæœ¬æŠ€æœ¯ã€‚ç”±æ­¤å¸¦æ¥å¹¶å‘æ§åˆ¶ï¼Œç§°ä¹‹ä¸ºå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(Multi VersionConcurrency Control, MVCC)ã€‚</p>
<h5 id="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡çš„éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</h5><p>Read uncommittedã€Read committedã€Repeatable readã€serializableã€‚</p>
<p>åœ¨Read Committedå’ŒRepeatable Readä¸‹ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨éé”å®šä¸€è‡´æ€§è¯»ã€‚ç„¶è€Œï¼Œå¯¹äºå¿«ç…§çš„å®šä¹‰å´ä¸åŒã€‚åœ¨Read Committedäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯¹äºå¿«ç…§æ•°æ®ï¼Œéä¸€è‡´æ€§è¯»æ€»æ˜¯è¯»å–è¢«é”å®šè¡Œçš„æœ€æ–°ä¸€ä»½å¿«ç…§æ•°æ®ã€‚åœ¨Repeatableäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯¹äºå¿«ç…§æ•°æ®ï¼Œéä¸€è‡´æ€§è¯»æ€»æ˜¯è¯»å–äº‹åŠ¡å¼€å§‹æ—¶çš„è¡Œæ•°æ®ç‰ˆæœ¬ã€‚   </p>
<h3 id="INNODBé”"><a href="#INNODBé”" class="headerlink" title="INNODBé”"></a>INNODBé”</h3><p><img src="pic/lock01.png" alt="lock01"></p>
<h4 id="è®¾ç½®INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#è®¾ç½®INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="è®¾ç½®INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«"></a>è®¾ç½®INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«</h4><h5 id="å®è·µ1ï¼šæŸ¥çœ‹innodbé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#å®è·µ1ï¼šæŸ¥çœ‹innodbé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="å®è·µ1ï¼šæŸ¥çœ‹innodbé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>å®è·µ1ï¼šæŸ¥çœ‹innodbé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</h5><p>çŸ¥è¯†ç‚¹ï¼š</p>
<ol>
<li>å¯ä»¥æŸ¥çœ‹å±€éƒ¨å˜é‡<code>@@tx_isolation</code>å’Œå…¨å±€å˜é‡<code>@@global.tx_isolation</code></li>
<li>å±€éƒ¨å˜é‡åœ¨ä¼šè¯ä¸­ç”Ÿæ•ˆï¼Œè€Œå…¨å±€å˜é‡æ˜¯åœ¨æ‰€æœ‰ä¼šè¯ä¸­ç”Ÿæ•ˆï¼Œå±€éƒ¨è¦†ç›–å…¨å±€ã€‚</li>
</ol>
<blockquote>
<p>æŸ¥çœ‹å½“å‰ä¼šè¯ä¸­çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> MariaDB [(none)]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å…¨å±€çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select @@global.tx_isolation;</span><br><span class="line">+-----------------------+</span><br><span class="line">| @@global.tx_isolation |</span><br><span class="line">+-----------------------+</span><br><span class="line">| REPEATABLE-READ       |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show variables like "tx_isolation";</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">| Variable_name | Value           |</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">| tx_isolation  | REPEATABLE-READ |</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from information_schema.global_variables where variable_name like "%isolation%";</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">| VARIABLE_NAME | VARIABLE_VALUE  |</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">| TX_ISOLATION  | REPEATABLE-READ |</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">1 row in set (0.03 sec)</span><br></pre></td></tr></table></figure>

<h5 id="å®è·µ2ï¼šæ”¹å˜å•ä¸ªä¼šè¯çš„éš”ç¦»çº§åˆ«"><a href="#å®è·µ2ï¼šæ”¹å˜å•ä¸ªä¼šè¯çš„éš”ç¦»çº§åˆ«" class="headerlink" title="å®è·µ2ï¼šæ”¹å˜å•ä¸ªä¼šè¯çš„éš”ç¦»çº§åˆ«"></a>å®è·µ2ï¼šæ”¹å˜å•ä¸ªä¼šè¯çš„éš”ç¦»çº§åˆ«</h5><p>çŸ¥è¯†ç‚¹ï¼š</p>
<p>1.ç”¨æˆ·å¯ä»¥ç”¨SET TRANSACTIONè¯­å¥æ”¹å˜å•ä¸ªä¼šè¯çš„éš”ç¦»çº§åˆ«ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SET SESSION  TRANSACTION ISOLATION LEVEL</span><br><span class="line">                       &#123;READ UNCOMMITTED | READ COMMITTED</span><br><span class="line">                        | REPEATABLE READ | SERIALIZABLE&#125;</span><br></pre></td></tr></table></figure>

<p>2.ä¼šè¯ç»“æŸé‡æ–°å¼€å¯æ–°çš„ä¼šè¯ï¼Œåˆ™ä½¿ç”¨å…¨å±€å˜é‡çš„å€¼</p>
<p>session1è®¾ç½®RR</p>
<p>ç”±äºé»˜è®¤çš„éš”ç¦»çº§åˆ«å°±æ˜¯RRï¼Œå› æ­¤ä¸ç”¨è®¾ç½®ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å³å¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>session2è®¾ç½®RC</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [information_schema]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [information_schema]&gt; set session transaction isolation level read committed;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [information_schema]&gt; select @@tx_isolation;</span><br><span class="line">+----------------+</span><br><span class="line">| @@tx_isolation |</span><br><span class="line">+----------------+</span><br><span class="line">| READ-COMMITTED |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>session2ç»“æŸä¼šè¯ï¼Œå¼€å¯æ–°çš„session3</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [information_schema]&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@localhost ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 6</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h5 id="å®è·µ3ï¼šæ”¹å˜å•ä¸ªå®ä¾‹çš„éš”ç¦»çº§åˆ«"><a href="#å®è·µ3ï¼šæ”¹å˜å•ä¸ªå®ä¾‹çš„éš”ç¦»çº§åˆ«" class="headerlink" title="å®è·µ3ï¼šæ”¹å˜å•ä¸ªå®ä¾‹çš„éš”ç¦»çº§åˆ«"></a>å®è·µ3ï¼šæ”¹å˜å•ä¸ªå®ä¾‹çš„éš”ç¦»çº§åˆ«</h5><p>çŸ¥è¯†ç‚¹ï¼š</p>
<p>1.ç”¨æˆ·å¯ä»¥ç”¨SET TRANSACTIONè¯­å¥æ”¹å˜å•ä¸ªå®ä¾‹çš„éš”ç¦»çº§åˆ«ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SET GLOBAL  TRANSACTION ISOLATION LEVEL</span><br><span class="line">                       &#123;READ UNCOMMITTED | READ COMMITTED</span><br><span class="line">                        | REPEATABLE READ | SERIALIZABLE&#125;</span><br></pre></td></tr></table></figure>

<p>2.å®ä¾‹ç»“æŸé‡æ–°å¼€å¯æ–°çš„å®ä¾‹ï¼Œåˆ™ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°å€¼ï¼Œæˆ–ç¨‹åºç¼–è¯‘æ—¶çš„å‚æ•°å€¼ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; set global transaction isolation level read committed;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select @@global.tx_isolation;</span><br><span class="line">+-----------------------+</span><br><span class="line">| @@global.tx_isolation |</span><br><span class="line">+-----------------------+</span><br><span class="line">| READ-COMMITTED        |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec).</span><br></pre></td></tr></table></figure>


<p>å½“å‰ä¼šè¯ä¸­ï¼Œå±€éƒ¨å˜é‡çš„å€¼ä¸ºRRï¼Œå…¨å±€å˜é‡çš„å€¼ä¸ºRCï¼Œè€Œå±€éƒ¨ä¼šè¦†ç›–å…¨å±€ï¼Œæ‰€ä»¥å½“å‰ä¼šè¯ä¸­çš„éš”ç¦»çº§åˆ«è¿˜æ˜¯RRï¼Œæˆ‘ä»¬éœ€è¦é€€å‡ºå½“å‰ä¼šè¯ï¼Œå¼€å¯æ–°çš„ä¼šè¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 8</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select @@tx_isolation;</span><br><span class="line">+----------------+</span><br><span class="line">| @@tx_isolation |</span><br><span class="line">+----------------+</span><br><span class="line">| READ-COMMITTED |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select @@global.tx_isolation;</span><br><span class="line">+-----------------------+</span><br><span class="line">| @@global.tx_isolation |</span><br><span class="line">+-----------------------+</span><br><span class="line">| READ-COMMITTED        |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¼šè¯ä¸­é€šè¿‡ä¿®æ”¹å…¨å±€å˜é‡çš„æ–¹å¼ï¼Œåªèƒ½è®©å½“å‰çš„å®ä¾‹ç”Ÿæ•ˆï¼Œå¦‚æœæœåŠ¡é‡å¯äº†ï¼Œåˆ™å¤±æ•ˆã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# systemctl restart mariadb</span><br><span class="line">[root@localhost ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select @@global.tx_isolation;</span><br><span class="line">+-----------------------+</span><br><span class="line">| @@global.tx_isolation |</span><br><span class="line">+-----------------------+</span><br><span class="line">| REPEATABLE-READ       |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h5 id="å®è·µ4ï¼šæ”¹å˜æ‰€æœ‰å®ä¾‹çš„éš”ç¦»çº§åˆ«"><a href="#å®è·µ4ï¼šæ”¹å˜æ‰€æœ‰å®ä¾‹çš„éš”ç¦»çº§åˆ«" class="headerlink" title="å®è·µ4ï¼šæ”¹å˜æ‰€æœ‰å®ä¾‹çš„éš”ç¦»çº§åˆ«"></a>å®è·µ4ï¼šæ”¹å˜æ‰€æœ‰å®ä¾‹çš„éš”ç¦»çº§åˆ«</h5><p>çŸ¥è¯†ç‚¹ï¼š</p>
<p>1.ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä¸ºæ‰€æœ‰å®ä¾‹å’Œè¿æ¥è®¾ç½®é»˜è®¤éš”ç¦»çº§åˆ«ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">transaction-isolation = &#123;READ-UNCOMMITTED | READ-COMMITTED</span><br><span class="line">                         | REPEATABLE-READ | SERIALIZABLE&#125;</span><br></pre></td></tr></table></figure>

<p>2.innodbé»˜è®¤çš„éš”ç¦»çº§åˆ«ä¸º REPEATABLE-READ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/my.cnf</span><br><span class="line">transaction-isolation=read-committed</span><br><span class="line">[root@localhost ~]# systemctl restart mariadb</span><br><span class="line">[root@localhost ~]# mysql -e "select @@tx_isolation"</span><br><span class="line">+----------------+</span><br><span class="line">| @@tx_isolation |</span><br><span class="line">+----------------+</span><br><span class="line">| READ-COMMITTED |</span><br><span class="line">+----------------+</span><br><span class="line">[root@localhost ~]# mysql -e "select @@global.tx_isolation"</span><br><span class="line">+-----------------------+</span><br><span class="line">| @@global.tx_isolation |</span><br><span class="line">+-----------------------+</span><br><span class="line">| READ-COMMITTED        |</span><br><span class="line">+-----------------------+</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="åŒºåˆ†INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#åŒºåˆ†INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="åŒºåˆ†INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«"></a>åŒºåˆ†INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«</h4><p><img src="pic/lock02.png" alt="lock02"></p>
<h5 id="InnoDB-ä¸­çš„éš”ç¦»çº§è¯¦ç»†æè¿°"><a href="#InnoDB-ä¸­çš„éš”ç¦»çº§è¯¦ç»†æè¿°" class="headerlink" title="InnoDB ä¸­çš„éš”ç¦»çº§è¯¦ç»†æè¿°"></a>InnoDB ä¸­çš„éš”ç¦»çº§è¯¦ç»†æè¿°</h5><ul>
<li><code>READ UNCOMMITTED</code> è¿™é€šå¸¸ç§°ä¸º â€˜dirty readâ€™ï¼šnon-locking SELECTs çš„æ‰§è¡Œä½¿æˆ‘ä»¬ä¸ä¼šçœ‹åˆ°ä¸€ä¸ªè®°å½•çš„å¯èƒ½æ›´æ—©çš„ç‰ˆæœ¬ï¼›å› è€Œåœ¨è¿™ä¸ªéš”ç¦»åº¦ä¸‹æ˜¯é â€˜consistentâ€™ readsï¼›å¦å¤–ï¼Œè¿™çº§éš”ç¦»çš„è¿ä½œå¦‚åŒ READ COMMITTEDã€‚</li>
<li><code>READ COMMITTED</code> æœ‰äº›ç±»ä¼¼ Oracle çš„éš”ç¦»çº§ã€‚æ‰€æœ‰ SELECT â€¦ FOR UPDATE å’Œ SELECT â€¦ LOCK IN SHARE MODE è¯­å¥åªé”å®šç´¢å¼•è®°å½•ï¼Œè€Œä¸é”å®šä¹‹å‰çš„é—´éš™ï¼Œå› è€Œå…è®¸åœ¨é”å®šçš„è®°å½•åè‡ªç”±åœ°æ’å…¥æ–°è®°å½•ã€‚ä»¥ä¸€ä¸ªå”¯ä¸€åœ°æœç´¢æ¡ä»¶ä½¿ç”¨ä¸€ä¸ªå”¯ä¸€ç´¢å¼•(unique index)çš„ UPDATE å’Œ DELETEï¼Œä»…ä»…åªé”å®šæ‰€æ‰¾åˆ°çš„ç´¢å¼•è®°å½•ï¼Œè€Œä¸é”å®šè¯¥ç´¢å¼•ä¹‹å‰çš„é—´éš™ã€‚ä½†æ˜¯åœ¨èŒƒå›´å‹çš„ UPDATE and DELETEä¸­ï¼ŒInnoDB å¿…é¡»è®¾ç½® next-key æˆ– gap locks æ¥é˜»å¡å…¶å®ƒç”¨æˆ·å¯¹èŒƒå›´å†…çš„ç©ºéš™æ’å…¥ã€‚ è‡ªä»ä¸ºäº† MySQL è¿›è¡Œå¤åˆ¶(replication)ä¸æ¢å¤(recovery)å·¥ä½œâ€™phantom rowsâ€™å¿…é¡»è¢«é˜»å¡ä»¥æ¥ï¼Œè¿™å°±æ˜¯å¿…é¡»çš„äº†ã€‚Consistent reads è¿ä½œæ–¹å¼ä¸ Oracle æœ‰ç‚¹ç±»ä¼¼ï¼š æ¯ä¸€ä¸ª consistent readï¼Œç”šè‡³æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„ï¼Œå‡è®¾ç½®å¹¶ä½œç”¨å®ƒè‡ªå·±çš„æœ€æ–°å¿«ç…§ã€‚</li>
<li><code>REPEATABLE READ</code> è¿™æ˜¯ InnoDB é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§ã€‚. SELECT â€¦ FOR UPDATE, SELECT â€¦ LOCK IN SHARE MODE, UPDATE, å’Œ DELETE ï¼Œè¿™äº›ä»¥å”¯ä¸€æ¡ä»¶æœç´¢å”¯ä¸€ç´¢å¼•çš„ï¼Œåªé”å®šæ‰€æ‰¾åˆ°çš„ç´¢å¼•è®°å½•ï¼Œè€Œä¸é”å®šè¯¥ç´¢å¼•ä¹‹å‰çš„é—´éš™ã€‚ å¦åˆ™è¿™äº›æ“ä½œå°†ä½¿ç”¨ next-key é”å®šï¼Œä»¥ next-key å’Œ gap locks é”å®šæ‰¾åˆ°çš„ç´¢å¼•èŒƒå›´ï¼Œå¹¶é˜»å¡å…¶å®ƒç”¨æˆ·çš„æ–°å»ºæ’å…¥ã€‚åœ¨ consistent reads ä¸­ï¼Œä¸å‰ä¸€ä¸ªéš”ç¦»çº§ç›¸æ¯”è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„å·®åˆ«ï¼š åœ¨è¿™ä¸€çº§ä¸­ï¼ŒåŒä¸€äº‹åŠ¡ä¸­æ‰€æœ‰çš„ consistent reads å‡è¯»å–ç¬¬ä¸€æ¬¡è¯»å–æ—¶å·²ç¡®å®šçš„å¿«ç…§ã€‚è¿™ä¸ªçº¦å®šå°±æ„å‘³ç€å¦‚æœåœ¨åŒä¸€äº‹åŠ¡ä¸­å‘å‡ºå‡ ä¸ªæ— æ ¼å¼(plain)çš„SELECTs ï¼Œè¿™äº› SELECTs çš„ç›¸äº’å…³ç³»æ˜¯ä¸€è‡´çš„ã€‚</li>
<li><code>SERIALIZABLE</code> è¿™ä¸€çº§ä¸ä¸Šä¸€çº§ç›¸ä¼¼ï¼Œåªæ˜¯æ— æ ¼å¼(plain)çš„ SELECTs è¢«éšå«åœ°è½¬æ¢ä¸º SELECT â€¦ LOCK IN SHARE MODEã€‚</li>
</ul>
<h5 id="å®è·µ1ï¼šSERIALIZABLEéš”ç¦»çº§åˆ«æŸ¥è¯¢è‡ªåŠ¨åŠ å…±äº«é”"><a href="#å®è·µ1ï¼šSERIALIZABLEéš”ç¦»çº§åˆ«æŸ¥è¯¢è‡ªåŠ¨åŠ å…±äº«é”" class="headerlink" title="å®è·µ1ï¼šSERIALIZABLEéš”ç¦»çº§åˆ«æŸ¥è¯¢è‡ªåŠ¨åŠ å…±äº«é”"></a>å®è·µ1ï¼šSERIALIZABLEéš”ç¦»çº§åˆ«æŸ¥è¯¢è‡ªåŠ¨åŠ å…±äº«é”</h5><ul>
<li>å¼€å¯å››ä¸ªä¼šè¯session1-4ï¼Œåˆ†åˆ«è®¾ç½®ä¸åŒçš„éš”ç¦»çº§åˆ«</li>
</ul>
<p><img src="pic/lock03.png" alt="lock03"></p>
<ul>
<li>å†å¼€å¯ä¸€ä¸ªä¼šè¯session5é»˜è®¤ä½¿ç”¨RRéš”ç¦»çº§åˆ«</li>
</ul>
<p><img src="pic/lock04.png" alt="lock04"></p>
<ul>
<li>session1-5éƒ½å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼ŒæŸ¥çœ‹teståº“ä¸­t1è¡¨ä¸­id=100çš„è¡Œ</li>
</ul>
<p><img src="pic/lock05.png" alt="lock05"></p>
<ul>
<li>session5ä¸­å°†id=100çš„è¡Œæ”¹ä¸º200ï¼Œå‘ç°å‡ºç°æ­»é”ï¼Œè¿™æ˜¯å› ä¸ºsession4ä¸ºSERIALIZABLEï¼ŒæŸ¥çœ‹id=100çš„è¡Œä¼šè¢«åŠ ä¸Šä¸€ä¸ªå…±äº«é”Sï¼Œè€Œå…¶ä»–ä¸‰ç§æ¨¡å¼éƒ½æ˜¯ä¸åŠ é”çš„ï¼Œä½¿ç”¨ä¸€è‡´æ€§éé”å®šè¯»ã€‚</li>
</ul>
<p><img src="pic/lock06.png" alt="lock06"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select * from information_schema.innodb_locks\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">    lock_id: 909:0:308:2</span><br><span class="line">lock_trx_id: 909</span><br><span class="line">  lock_mode: X</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `test`.`t1`</span><br><span class="line"> lock_index: `PRIMARY`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 308</span><br><span class="line">   lock_rec: 2</span><br><span class="line">  lock_data: 100</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">    lock_id: 90A:0:308:2</span><br><span class="line">lock_trx_id: 90A</span><br><span class="line">  lock_mode: S</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `test`.`t1`</span><br><span class="line"> lock_index: `PRIMARY`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 308</span><br><span class="line">   lock_rec: 2</span><br><span class="line">  lock_data: 100</span><br><span class="line">2 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from information_schema.innodb_lock_waits\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">requesting_trx_id: 909</span><br><span class="line">requested_lock_id: 909:0:308:2</span><br><span class="line">  blocking_trx_id: 90A</span><br><span class="line"> blocking_lock_id: 90A:0:308:2</span><br><span class="line">1 row in set (0.04 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from information_schema.innodb_trx\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                    trx_id: 90A</span><br><span class="line">                 trx_state: RUNNING</span><br><span class="line">               trx_started: 2016-12-15 17:08:01</span><br><span class="line">     trx_requested_lock_id: NULL</span><br><span class="line">          trx_wait_started: NULL</span><br><span class="line">                trx_weight: 2</span><br><span class="line">       trx_mysql_thread_id: 5</span><br><span class="line">                 trx_query: NULL</span><br><span class="line">       trx_operation_state: NULL</span><br><span class="line">         trx_tables_in_use: 0</span><br><span class="line">         trx_tables_locked: 0</span><br><span class="line">          trx_lock_structs: 2</span><br><span class="line">     trx_lock_memory_bytes: 376</span><br><span class="line">           trx_rows_locked: 1</span><br><span class="line">         trx_rows_modified: 0</span><br><span class="line">   trx_concurrency_tickets: 0</span><br><span class="line">       trx_isolation_level: SERIALIZABLE</span><br><span class="line">         trx_unique_checks: 1</span><br><span class="line">    trx_foreign_key_checks: 1</span><br><span class="line">trx_last_foreign_key_error: NULL</span><br><span class="line"> trx_adaptive_hash_latched: 0</span><br><span class="line"> trx_adaptive_hash_timeout: 10000</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">                    trx_id: 909</span><br><span class="line">                 trx_state: LOCK WAIT</span><br><span class="line">               trx_started: 2016-12-15 17:02:04</span><br><span class="line">     trx_requested_lock_id: 909:0:308:2</span><br><span class="line">          trx_wait_started: 2016-12-15 17:10:18</span><br><span class="line">                trx_weight: 2</span><br><span class="line">       trx_mysql_thread_id: 4</span><br><span class="line">                 trx_query: update test.t1 set id=200 where id=100</span><br><span class="line">       trx_operation_state: starting index read</span><br><span class="line">         trx_tables_in_use: 1</span><br><span class="line">         trx_tables_locked: 1</span><br><span class="line">          trx_lock_structs: 2</span><br><span class="line">     trx_lock_memory_bytes: 1248</span><br><span class="line">           trx_rows_locked: 1</span><br><span class="line">         trx_rows_modified: 0</span><br><span class="line">   trx_concurrency_tickets: 0</span><br><span class="line">       trx_isolation_level: REPEATABLE READ</span><br><span class="line">         trx_unique_checks: 1</span><br><span class="line">    trx_foreign_key_checks: 1</span><br><span class="line">trx_last_foreign_key_error: NULL</span><br><span class="line"> trx_adaptive_hash_latched: 0</span><br><span class="line"> trx_adaptive_hash_timeout: 10000</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">                    trx_id: 908</span><br><span class="line">                 trx_state: RUNNING</span><br><span class="line">               trx_started: 2016-12-15 17:02:02</span><br><span class="line">     trx_requested_lock_id: NULL</span><br><span class="line">          trx_wait_started: NULL</span><br><span class="line">                trx_weight: 0</span><br><span class="line">       trx_mysql_thread_id: 3</span><br><span class="line">                 trx_query: NULL</span><br><span class="line">       trx_operation_state: NULL</span><br><span class="line">         trx_tables_in_use: 0</span><br><span class="line">         trx_tables_locked: 0</span><br><span class="line">          trx_lock_structs: 0</span><br><span class="line">     trx_lock_memory_bytes: 376</span><br><span class="line">           trx_rows_locked: 0</span><br><span class="line">         trx_rows_modified: 0</span><br><span class="line">   trx_concurrency_tickets: 0</span><br><span class="line">       trx_isolation_level: READ COMMITTED</span><br><span class="line">         trx_unique_checks: 1</span><br><span class="line">    trx_foreign_key_checks: 1</span><br><span class="line">trx_last_foreign_key_error: NULL</span><br><span class="line"> trx_adaptive_hash_latched: 0</span><br><span class="line"> trx_adaptive_hash_timeout: 10000</span><br><span class="line">*************************** 4. row ***************************</span><br><span class="line">                    trx_id: 906</span><br><span class="line">                 trx_state: RUNNING</span><br><span class="line">               trx_started: 2016-12-15 17:01:57</span><br><span class="line">     trx_requested_lock_id: NULL</span><br><span class="line">          trx_wait_started: NULL</span><br><span class="line">                trx_weight: 0</span><br><span class="line">       trx_mysql_thread_id: 6</span><br><span class="line">                 trx_query: NULL</span><br><span class="line">       trx_operation_state: NULL</span><br><span class="line">         trx_tables_in_use: 0</span><br><span class="line">         trx_tables_locked: 0</span><br><span class="line">          trx_lock_structs: 0</span><br><span class="line">     trx_lock_memory_bytes: 376</span><br><span class="line">           trx_rows_locked: 0</span><br><span class="line">         trx_rows_modified: 0</span><br><span class="line">   trx_concurrency_tickets: 0</span><br><span class="line">       trx_isolation_level: REPEATABLE READ</span><br><span class="line">         trx_unique_checks: 1</span><br><span class="line">    trx_foreign_key_checks: 1</span><br><span class="line">trx_last_foreign_key_error: NULL</span><br><span class="line"> trx_adaptive_hash_latched: 0</span><br><span class="line"> trx_adaptive_hash_timeout: 10000</span><br><span class="line">*************************** 5. row ***************************</span><br><span class="line">                    trx_id: 905</span><br><span class="line">                 trx_state: RUNNING</span><br><span class="line">               trx_started: 2016-12-15 17:01:39</span><br><span class="line">     trx_requested_lock_id: NULL</span><br><span class="line">          trx_wait_started: NULL</span><br><span class="line">                trx_weight: 0</span><br><span class="line">       trx_mysql_thread_id: 2</span><br><span class="line">                 trx_query: select * from information_schema.innodb_trx</span><br><span class="line">       trx_operation_state: NULL</span><br><span class="line">         trx_tables_in_use: 0</span><br><span class="line">         trx_tables_locked: 0</span><br><span class="line">          trx_lock_structs: 0</span><br><span class="line">     trx_lock_memory_bytes: 376</span><br><span class="line">           trx_rows_locked: 0</span><br><span class="line">         trx_rows_modified: 0</span><br><span class="line">   trx_concurrency_tickets: 0</span><br><span class="line">       trx_isolation_level: READ UNCOMMITTED</span><br><span class="line">         trx_unique_checks: 1</span><br><span class="line">    trx_foreign_key_checks: 1</span><br><span class="line">trx_last_foreign_key_error: NULL</span><br><span class="line"> trx_adaptive_hash_latched: 0</span><br><span class="line"> trx_adaptive_hash_timeout: 10000</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br></pre></td></tr></table></figure>

<ul>
<li>session4ä¸­æäº¤äº‹åŠ¡ï¼Œåˆ™id=100çš„è¡Œé”è¢«è§£é™¤ï¼Œæˆ‘ä»¬å…³é—­session4ï¼Œä¸‹å›¾ä¸ºæœ€æ–°çš„æƒ…å†µ</li>
</ul>
<p><img src="pic/lock07.png" alt="lock07"></p>
<h5 id="å®è·µ2ï¼šRUã€RCã€RRéš”ç¦»çº§åˆ«çš„å¯¹æ¯”"><a href="#å®è·µ2ï¼šRUã€RCã€RRéš”ç¦»çº§åˆ«çš„å¯¹æ¯”" class="headerlink" title="å®è·µ2ï¼šRUã€RCã€RRéš”ç¦»çº§åˆ«çš„å¯¹æ¯”"></a>å®è·µ2ï¼šRUã€RCã€RRéš”ç¦»çº§åˆ«çš„å¯¹æ¯”</h5><ul>
<li>session5ï¼Œä¿®æ”¹id=100çš„è¡Œï¼Œæ”¹ä¸º200ï¼Œä¸æäº¤äº‹åŠ¡ï¼Œsession1-,3åˆ†åˆ«æŸ¥çœ‹id=100çš„å€¼ï¼Œè§‚å¯Ÿæƒ…å†µ</li>
</ul>
<p><img src="pic/lock08.png" alt="lock08"></p>
<ul>
<li>RUçº§åˆ«çš„ä¼šè¯ä¸­çš„äº‹åŠ¡åœ¨session5ä¸­äº‹åŠ¡æœªæäº¤çš„æƒ…å†µä¸‹ï¼Œå°±èƒ½å¤ŸæŸ¥çœ‹åˆ°æœ€æ–°çš„è¡Œè®°å½•äº†</li>
</ul>
<p><img src="pic/lock09.png" alt="lock09"></p>
<ul>
<li>RCçº§åˆ«çš„ä¼šè¯ä¸­çš„äº‹åŠ¡åœ¨session5ä¼šè¯çš„äº‹åŠ¡æäº¤åå°±èƒ½å¤ŸæŸ¥çœ‹åˆ°æœ€æ–°çš„è¡Œè®°å½•äº† </li>
</ul>
<p><img src="pic/lock10.png" alt="lock10"></p>
<p>*ã€€RRçº§åˆ«çš„ä¼šè¯ä¸­å¿…é¡»åœ¨session5çš„äº‹åŠ¡æäº¤åå¹¶ä¸”è‡ªå·±çš„äº‹åŠ¡ä¹Ÿæäº¤åæ‰èƒ½æŸ¥åˆ°æœ€æ–°çš„è¡Œè®°å½•</p>
<h4 id="å®ç°ä¸€è‡´æ€§é”å®šè¯»"><a href="#å®ç°ä¸€è‡´æ€§é”å®šè¯»" class="headerlink" title="å®ç°ä¸€è‡´æ€§é”å®šè¯»"></a>å®ç°ä¸€è‡´æ€§é”å®šè¯»</h4><p>InnoDBé»˜è®¤æ˜¯å¯é‡å¤è¯»çš„ï¼ˆREPEATABLE READï¼‰ï¼ŒMVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œå®ç°ä¸€è‡´æ€§åœ°éé”å®šè¯»æ“ä½œã€‚</p>
<p>InnoDBå­˜å‚¨å¼•æ“çš„selectæ“ä½œä½¿ç”¨ä¸€è‡´æ€§éé”å®šè¯»ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œselectæ“ä½œä¸ä¼šå»è¯·æ±‚å…±äº«é”Sï¼›</p>
<p>å¦‚ä½•æ˜¾ç¤ºåœ°ä½¿ç”¨ä¸€è‡´æ€§é”å®šè¯»å‘¢ï¼Ÿ</p>
<ul>
<li>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæ˜¾å¼åœ°åŠ å…±äº«é”Sï¼šselect * from t1 where id=1 lock on share mode;</li>
<li>ç¬¬äºŒç§æ–¹æ³•ï¼Œæ˜¾å¼åœ°åŠ æ’ä»–é”Xï¼šselect * from t1 where id=1 for update;</li>
</ul>
<h5 id="å®è·µ1ï¼šè®¾ç½®innodbç”³è¯·é”ç­‰å¾…è¶…æ—¶æ—¶é—´"><a href="#å®è·µ1ï¼šè®¾ç½®innodbç”³è¯·é”ç­‰å¾…è¶…æ—¶æ—¶é—´" class="headerlink" title="å®è·µ1ï¼šè®¾ç½®innodbç”³è¯·é”ç­‰å¾…è¶…æ—¶æ—¶é—´"></a>å®è·µ1ï¼šè®¾ç½®innodbç”³è¯·é”ç­‰å¾…è¶…æ—¶æ—¶é—´</h5><p><img src="pic/lock13.png" alt="lock13"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; set @@innodb_lock_wait_timeout=3;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure>

<h5 id="å®è·µ2ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ å…±äº«é”æµ‹è¯•"><a href="#å®è·µ2ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ å…±äº«é”æµ‹è¯•" class="headerlink" title="å®è·µ2ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ å…±äº«é”æµ‹è¯•"></a>å®è·µ2ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ å…±äº«é”æµ‹è¯•</h5><p><img src="pic/lock16.png" alt="lock16"></p>
<p>æ‰“å¼€ä¸¤ä¸ªä¼šè¯ï¼Œåˆ†åˆ«æŒ‰ç…§å›¾ç‰‡ä¸­å»åšæµ‹è¯•</p>
<p><img src="pic/lock14.png" alt="lock14"></p>
<p>ä»å®è·µä¸­å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¿¡æ¯:</p>
<ul>
<li>äº‹åŠ¡Aå¯¹id=1çš„è¡Œç”³è¯·äº†å…±äº«Sé”ä¹‹åï¼Œäº‹åŠ¡Bè¦ä¹ˆä½¿ç”¨ä¸€è‡´æ€§éé”å®šè¯»ï¼Œå³ä¸è¯·æ±‚é”ï¼Œæˆ–è€…ä½¿ç”¨ä¸€è‡´æ€§é”å®šè¯»çš„å…±äº«é”ï¼Œå³è¯·æ±‚å…±äº«Sé”</li>
<li>è€Œäº‹åŠ¡Bä¸­éœ€è¦è¯·æ±‚æ’ä»–é”çš„å†™æ“ä½œéƒ½ä¸èƒ½æ‰§è¡Œï¼Œæ¯æ¬¡éƒ½æ˜¯é”è¯·æ±‚ç­‰å¾…è¶…æ—¶</li>
</ul>
<h5 id="å®è·µ3ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ æ’ä»–é”æµ‹è¯•"><a href="#å®è·µ3ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ æ’ä»–é”æµ‹è¯•" class="headerlink" title="å®è·µ3ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ æ’ä»–é”æµ‹è¯•"></a>å®è·µ3ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ æ’ä»–é”æµ‹è¯•</h5><p><img src="pic/lock17.png" alt="lock17"></p>
<p>è¿™ä¸€æ¬¡äº‹åŠ¡Aä»¥åŠå¯¹id=1çš„è¡Œç”³è¯·äº†æ’ä»–é”Xï¼ŒæŒ‰ç…§ä¸‹å›¾åšæµ‹è¯•ï¼š</p>
<p><img src="pic/lock15.png" alt="lock15"></p>
<p>ä»å®è·µä¸­å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¿¡æ¯:</p>
<ul>
<li>äº‹åŠ¡Aå¯¹id=1çš„è¡Œç”³è¯·äº†æ’ä»–é”Xä¹‹åï¼Œäº‹åŠ¡Båªèƒ½ä½¿ç”¨ä¸€è‡´æ€§éé”å®šè¯»ï¼Œå³ä¸è¯·æ±‚é”</li>
<li>è€Œäº‹åŠ¡Bä¸­éœ€è¦è¯·æ±‚é”çš„è¡Œä¸ºéƒ½ä¼šç­‰å¾…è¶…æ—¶ï¼ŒåŒ…æ‹¬æ’ä»–é”çš„å†™æ“ä½œå’Œå…±äº«é”çš„è¯»æ“ä½œéƒ½ä¸èƒ½æ‰§è¡Œ</li>
</ul>
<h4 id="è®¤è¯†é”çš„ç®—æ³•"><a href="#è®¤è¯†é”çš„ç®—æ³•" class="headerlink" title="è®¤è¯†é”çš„ç®—æ³•"></a>è®¤è¯†é”çš„ç®—æ³•</h4><p>nnoDBå­˜å‚¨å¼•æ“çš„é”çš„ç®—æ³•æœ‰ä¸‰ç§ï¼š</p>
<ul>
<li>Record lockï¼šå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”</li>
<li>Gap lockï¼šé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«</li>
<li>Next-key lockï¼šrecord+gap é”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…å«è®°å½•æœ¬èº«</li>
</ul>
<p>Lockçš„ç²¾åº¦ï¼ˆtypeï¼‰åˆ†ä¸º è¡Œé”ã€è¡¨é”ã€æ„å‘é”</p>
<p>Lockçš„æ¨¡å¼ï¼ˆmodeï¼‰åˆ†ä¸º:</p>
<ul>
<li>é”çš„ç±»å‹ â€”â€”ã€è¯»é”å’Œå†™é”ã€‘æˆ–è€…ã€å…±äº«é”å’Œæ’ä»–é”ã€‘å³ ã€X or Sã€‘</li>
<li>é”çš„èŒƒå›´ â€”â€”ã€record lockã€gap lockã€Next-key lockã€‘</li>
</ul>
<h5 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h5><ol>
<li>innodbå¯¹äºè¡Œçš„æŸ¥è¯¢ä½¿ç”¨next-key lock</li>
<li>Next-locking keyingä¸ºäº†è§£å†³Phantom Problemå¹»è¯»é—®é¢˜</li>
<li>å½“æŸ¥è¯¢çš„ç´¢å¼•å«æœ‰å”¯ä¸€å±æ€§æ—¶ï¼Œå°†next-key locké™çº§ä¸ºrecord key</li>
<li>Gapé”è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†é˜»æ­¢å¤šä¸ªäº‹åŠ¡å°†è®°å½•æ’å…¥åˆ°åŒä¸€èŒƒå›´å†…ï¼Œè€Œè¿™ä¼šå¯¼è‡´å¹»è¯»é—®é¢˜çš„äº§ç”Ÿ</li>
<li>æœ‰ä¸¤ç§æ–¹å¼æ˜¾å¼å…³é—­gapé”ï¼šï¼ˆé™¤äº†å¤–é”®çº¦æŸå’Œå”¯ä¸€æ€§æ£€æŸ¥å¤–ï¼Œå…¶ä½™æƒ…å†µä»…ä½¿ç”¨record lockï¼‰<br> A. å°†äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºRC<br> B. å°†å‚æ•°innodb_locks_unsafe_for_binlogè®¾ç½®ä¸º1</li>
</ol>
<p><img src="pic/lock18.png" alt="lock18"></p>
<h5 id="å®è·µ1ï¼š-éªŒè¯next-key-locké™çº§ä¸ºrecord-key"><a href="#å®è·µ1ï¼š-éªŒè¯next-key-locké™çº§ä¸ºrecord-key" class="headerlink" title="å®è·µ1ï¼š éªŒè¯next-key locké™çº§ä¸ºrecord key"></a>å®è·µ1ï¼š éªŒè¯next-key locké™çº§ä¸ºrecord key</h5><p>åˆ›å»ºdb1.t1è¡¨ï¼Œæœ‰åˆ—aå’Œbï¼Œåˆ†åˆ«ä¸ºchar(10)å’Œintå‹ï¼Œå¹¶ä¸”bä¸ºkeyï¼Œæ³¨æ„båˆ—ä¸ºç´¢å¼•åˆ—ï¼Œä½†å¹¶ä¸æ˜¯ä¸»é”®ï¼Œå› æ­¤ä¸æ˜¯å”¯ä¸€çš„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [db1]&gt; create table db1.t1 (a char(10),b int,key (b));</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',1),('superman',3),('leo',5);</span><br><span class="line">Query OK, 3 rows affected (0.15 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1;</span><br><span class="line">+----------+------+</span><br><span class="line">| a        | b    |</span><br><span class="line">+----------+------+</span><br><span class="line">| batman   |    1 |</span><br><span class="line">| superman |    3 |</span><br><span class="line">| leo      |    5 |</span><br><span class="line">+----------+------+</span><br><span class="line">3 rows in set (0.02 sec)</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å¼€å¯ä¸¤ä¸ªäº‹åŠ¡T1å’ŒT2ï¼ŒT1ä¸­æŸ¥çœ‹b=3çš„è¡Œï¼Œæ˜¾å¼åŠ æ’ä»–é”ï¼›T1æœªæäº¤äº‹åŠ¡æ—¶ï¼ŒT2äº‹åŠ¡å¼€å¯å¹¶å°è¯•æ’å…¥æ–°è¡Œa=â€™batmanâ€™,b=2å’Œa=â€™batmanâ€™,b=4ï¼›</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T1</span></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1 where b=3 for update;</span><br><span class="line">+----------+------+</span><br><span class="line">| a        | b    |</span><br><span class="line">+----------+------+</span><br><span class="line">| superman |    3 |</span><br><span class="line">+----------+------+</span><br><span class="line">1 row in set (0.12 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T2</span></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',2);</span><br><span class="line">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',4);</span><br><span class="line">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</span><br></pre></td></tr></table></figure>

<p>å‘ç°T2äº‹åŠ¡ä¸­ä¸èƒ½æ’å…¥æ–°è¡Œa=â€™batmanâ€™,b=2å’Œa=â€™batmanâ€™,b=4ï¼›å¯ä»¥æŸ¥çœ‹å½“å‰innodbé”çš„ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [db1]&gt; select * from information_schema.innodb_locks\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">    lock_id: 111B:0:334:3</span><br><span class="line">lock_trx_id: 111B</span><br><span class="line">  lock_mode: X,GAP</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `db1`.`t1`</span><br><span class="line"> lock_index: `b`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 334</span><br><span class="line">   lock_rec: 3</span><br><span class="line">  lock_data: 3, 0x00000000020E</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">    lock_id: 111A:0:334:3</span><br><span class="line">lock_trx_id: 111A</span><br><span class="line">  lock_mode: X</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `db1`.`t1`</span><br><span class="line"> lock_index: `b`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 334</span><br><span class="line">   lock_rec: 3</span><br><span class="line">  lock_data: 3, 0x00000000020E</span><br><span class="line">2 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from information_schema.innodb_lock_waits\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">requesting_trx_id: 111B</span><br><span class="line">requested_lock_id: 111B:0:334:3</span><br><span class="line">  blocking_trx_id: 111A</span><br><span class="line"> blocking_lock_id: 111A:0:334:3</span><br><span class="line">1 row in set (0.09 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from information_schema.innodb_lock_waits\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">requesting_trx_id: 111B</span><br><span class="line">requested_lock_id: 111B:0:334:4</span><br><span class="line">  blocking_trx_id: 111A</span><br><span class="line"> blocking_lock_id: 111A:0:334:4</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from information_schema.innodb_locks\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">    lock_id: 111B:0:334:4</span><br><span class="line">lock_trx_id: 111B</span><br><span class="line">  lock_mode: X,GAP</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `db1`.`t1`</span><br><span class="line"> lock_index: `b`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 334</span><br><span class="line">   lock_rec: 4</span><br><span class="line">  lock_data: 5, 0x00000000020F</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">    lock_id: 111A:0:334:4</span><br><span class="line">lock_trx_id: 111A</span><br><span class="line">  lock_mode: X,GAP</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `db1`.`t1`</span><br><span class="line"> lock_index: `b`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 334</span><br><span class="line">   lock_rec: 4</span><br><span class="line">  lock_data: 5, 0x00000000020F</span><br><span class="line">2 rows in set (0.11 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çœ‹åˆ°T2äº‹åŠ¡çš„ä¸¤æ¬¡æ’å…¥åŠ¨ä½œéƒ½åœ¨è¯·æ±‚æ’ä»–é”ï¼Œä½†æ˜¯æ­¤æ—¶T1äº‹åŠ¡å·²ç»åœ¨åŠ äº†next-key lock(record + gap)ï¼Œè¡¨ç°èŒƒå›´ä¸ºbçš„(1,5)ï¼ŒåŒ…æ‹¬è®°å½•3ï¼Œæ‰€ä»¥T2äº‹åŠ¡åœ¨T1äº‹åŠ¡è§£é”ä¹‹é—´ï¼Œä¸èƒ½æ’å…¥åˆ°bçš„(1,5)èŒƒå›´å†…</p>
<p>Ã— <code>lock_mode: X,GAP</code> lock_mode å¯ä»¥ç†è§£ä¸º <code>è¯»é”è¿˜æ˜¯å†™é”ï¼Ÿ</code>ï¼›<code>æ˜¯åœ¨ä»€ä¹ˆèŒƒå›´ä¸Šé”ï¼Ÿ</code>;æ­¤å¤„åŠ çš„å†™é”å³æ’ä»–é”ï¼›èŒƒå›´æ˜¯(1,5)</p>
<ul>
<li><code>lock_type: RECORD</code> è¡¨ç¤ºé”çš„ç²¾åº¦ï¼Œæ ¹æ®å­˜å‚¨å¼•æ“ä¸åŒï¼Œinnodbæ˜¯è¡Œé”ï¼ŒMYISAMæ˜¯è¡¨é”</li>
</ul>
<p>åˆ é™¤db1.t1è¡¨ï¼Œé‡æ–°åˆ›å»ºdb1.t1è¡¨ï¼Œæœ‰åˆ—aå’Œbï¼Œåˆ†åˆ«ä¸ºchar(10)å’Œintå‹ï¼Œå¹¶ä¸”bä¸ºprimay keyï¼Œå› æ­¤båˆ—æ˜¯å”¯ä¸€çš„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [db1]&gt; drop tables t1;</span><br><span class="line">Query OK, 0 rows affected (0.12 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; create table db1.t1 (a char(10),b int ,primary key (b));</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',1),('superman',3),('leo',5);</span><br><span class="line">Query OK, 3 rows affected (0.12 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1;</span><br><span class="line">+----------+---+</span><br><span class="line">| a        | b |</span><br><span class="line">+----------+---+</span><br><span class="line">| batman   | 1 |</span><br><span class="line">| superman | 3 |</span><br><span class="line">| leo      | 5 |</span><br><span class="line">+----------+---+</span><br><span class="line">3 rows in set (0.08 sec)</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å¼€å¯ä¸¤ä¸ªäº‹åŠ¡T1å’ŒT2ï¼ŒT1ä¸­æŸ¥çœ‹b=3çš„è¡Œï¼Œæ˜¾å¼åŠ æ’ä»–é”ï¼›T1æœªæäº¤äº‹åŠ¡æ—¶ï¼ŒT2äº‹åŠ¡å¼€å¯å¹¶å°è¯•æ’å…¥æ–°è¡Œa=â€™batmanâ€™,b=2å’Œa=â€™batmanâ€™,b=4ï¼›</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T1</span></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1 where b=3 for update;</span><br><span class="line">+----------+---+</span><br><span class="line">| a        | b |</span><br><span class="line">+----------+---+</span><br><span class="line">| superman | 3 |</span><br><span class="line">+----------+---+</span><br><span class="line">1 row in set (0.14 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T2</span></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',2);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',4);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ç»§ç»­åœ¨T2äº‹åŠ¡ä¸­å°è¯•æŸ¥çœ‹b=3çš„è¡Œï¼Œæ˜¾å¼åŠ å…±äº«é”ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T2</span></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1 where b=3 lock in share mode;</span><br><span class="line">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</span><br></pre></td></tr></table></figure>

<p>å‘ç°T2äº‹åŠ¡ä¸­å¯ä»¥æ’å…¥æ–°è¡Œa=â€™batmanâ€™,b=2å’Œa=â€™batmanâ€™,b=4ï¼›ä½†æ˜¯ä¸èƒ½æŸ¥çœ‹b=3çš„è¡Œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŸ¥çœ‹å½“å‰innodbé”çš„ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [db1]&gt; select * from information_schema.innodb_locks\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">    lock_id: 1122:0:337:3</span><br><span class="line">lock_trx_id: 1122</span><br><span class="line">  lock_mode: S</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `db1`.`t1`</span><br><span class="line"> lock_index: `PRIMARY`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 337</span><br><span class="line">   lock_rec: 3</span><br><span class="line">  lock_data: 3</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">    lock_id: 1121:0:337:3</span><br><span class="line">lock_trx_id: 1121</span><br><span class="line">  lock_mode: X</span><br><span class="line">  lock_type: RECORD</span><br><span class="line"> lock_table: `db1`.`t1`</span><br><span class="line"> lock_index: `PRIMARY`</span><br><span class="line"> lock_space: 0</span><br><span class="line">  lock_page: 337</span><br><span class="line">   lock_rec: 3</span><br><span class="line">  lock_data: 3</span><br><span class="line">2 rows in set (0.02 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from information_schema.innodb_lock_waits\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">requesting_trx_id: 1122</span><br><span class="line">requested_lock_id: 1122:0:337:3</span><br><span class="line">  blocking_trx_id: 1121</span><br><span class="line"> blocking_lock_id: 1121:0:337:3</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br></pre></td></tr></table></figure>

<p>ä»ä»¥ä¸Šä¿¡æ¯å¯ä»¥çœ‹åˆ°ï¼ŒT1äº‹åŠ¡å½“å‰åªåœ¨b=3æ‰€åœ¨çš„è¡Œä¸ŠåŠ äº†å†™é”ï¼Œæ’ä»–é”ï¼Œå¹¶æ²¡æœ‰åŒæ—¶ä½¿ç”¨gapé”æ¥ç»„æˆnext-key lockã€‚</p>
<p>åˆ°æ­¤ï¼Œå·²ç»è¯æ˜äº†ï¼Œå½“æŸ¥è¯¢çš„ç´¢å¼•å«æœ‰å”¯ä¸€å±æ€§æ—¶ï¼Œå°†next-key locké™çº§ä¸ºrecord key</p>
<p>æˆ‘ä»¬ç¬¬äºŒæ¬¡åˆ›å»ºçš„t1è¡¨çš„åˆ—bæ˜¯ä¸»é”®ï¼Œè€Œä¸»é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚</p>
<h5 id="å®è·µ2ï¼š-å…³é—­GAPé”-RC"><a href="#å®è·µ2ï¼š-å…³é—­GAPé”-RC" class="headerlink" title="å®è·µ2ï¼š å…³é—­GAPé”_RC"></a>å®è·µ2ï¼š å…³é—­GAPé”_RC</h5><p>æœ‰ä¸¤ç§æ–¹å¼æ˜¾å¼å…³é—­gapé”ï¼šï¼ˆé™¤äº†å¤–é”®çº¦æŸå’Œå”¯ä¸€æ€§æ£€æŸ¥å¤–ï¼Œå…¶ä½™æƒ…å†µä»…ä½¿ç”¨record lockï¼‰</p>
<p>A. å°†äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºRC<br>B. å°†å‚æ•°innodb_locks_unsafe_for_binlogè®¾ç½®ä¸º1</p>
<table>
<thead>
<tr>
<th align="left">T1 RR</th>
<th align="left">T2 RR</th>
</tr>
</thead>
<tbody><tr>
<td align="left">begin;</td>
<td align="left">begin;</td>
</tr>
<tr>
<td align="left">select * from db1.t1 where b=3 for update;</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">insert into db1.t1 values (â€˜batmanâ€™,2)</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">set session transaction isolation level READ COMMITTED;</td>
</tr>
<tr>
<td align="left">commit;</td>
<td align="left">commit;</td>
</tr>
</tbody></table>
<p>æ³¨æ„ï¼Œå°†T1äº‹åŠ¡è®¾ç½®ä¸ºRCåï¼Œéœ€è¦å°†äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼æ”¹ä¸ºrowæ ¼å¼ï¼Œå¦åˆ™æ‰§è¡Œæ˜¾å¼åŠ é”æ—¶ä¼šæŠ¥é”™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [db1]&gt; insert into t1 values ('batman',2);</span><br><span class="line">ERROR 1665 (HY000): Cannot execute statement: impossible to write to binary log since BINLOG_FORMAT = STATEMENT and at least one table uses a storage engine limited to row-based logging. InnoDB is limited to row-logging when transaction isolation level is READ COMMITTED or READ UNCOMMITTED.</span><br></pre></td></tr></table></figure>


<table>
<thead>
<tr>
<th align="left">T1 RC</th>
<th align="left">T2 RR</th>
</tr>
</thead>
<tbody><tr>
<td align="left">begin;</td>
<td align="left">begin;</td>
</tr>
<tr>
<td align="left">set session transaction isolation level READ COMMITTED;</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">select * from db1.t1 where b=3 for update;</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">insert into db1.t1 values (â€˜batmanâ€™,2)</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">insert into db1.t1 values (â€˜batmanâ€™,4)</td>
</tr>
<tr>
<td align="left">commit;</td>
<td align="left">commit;</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">T1äº‹åŠ¡</span></span><br><span class="line">MariaDB [db1]&gt; set session transaction isolation level READ COMMITTED;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select @@tx_isolation;</span><br><span class="line">+----------------+</span><br><span class="line">| @@tx_isolation |</span><br><span class="line">+----------------+</span><br><span class="line">| READ-COMMITTED |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.09 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from t1 where b=3 for update;</span><br><span class="line">+----------+------+</span><br><span class="line">| a        | b    |</span><br><span class="line">+----------+------+</span><br><span class="line">| superman |    3 |</span><br><span class="line">+----------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">T2äº‹åŠ¡</span></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.16 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select @@tx_isolation;</span><br><span class="line">+----------------+</span><br><span class="line">| @@tx_isolation |</span><br><span class="line">+----------------+</span><br><span class="line">| READ-COMMITTED |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',2);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; set session transaction isolation level REPEATABLE READ;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',4);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">T1äº‹åŠ¡</span></span><br><span class="line">MariaDB [db1]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æˆ‘åœ¨åšæµ‹è¯•çš„æ—¶å€™ï¼ŒT1äº‹åŠ¡éš”ç¦»ç•Œåˆ«ä¸ºRCï¼ŒT2äº‹åŠ¡çš„éš”ç¦»ç•Œåˆ«åˆ†åˆ«ç”¨RCå’ŒRRåšäº†æµ‹è¯•ï¼Œéƒ½æ˜¯å¯ä»¥çš„</p>
<h5 id="å®è·µ3ï¼š-å…³é—­GAPé”-innodb-locks-unsafe-for-binlog"><a href="#å®è·µ3ï¼š-å…³é—­GAPé”-innodb-locks-unsafe-for-binlog" class="headerlink" title="å®è·µ3ï¼š å…³é—­GAPé”_innodb_locks_unsafe_for_binlog"></a>å®è·µ3ï¼š å…³é—­GAPé”_innodb_locks_unsafe_for_binlog</h5><p>æŸ¥çœ‹å½“å‰innodb_locks_unsafe_for_binlogå‚æ•°çš„å€¼</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select @@innodb_locks_unsafe_for_binlog;</span><br><span class="line">+----------------------------------+</span><br><span class="line">| @@innodb_locks_unsafe_for_binlog |</span><br><span class="line">+----------------------------------+</span><br><span class="line">|                                0 |</span><br><span class="line">+----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹å‚æ•°ï¼Œå¹¶é‡æ–°å¯åŠ¨æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/my.cnf</span><br><span class="line">innodb_locks_unsafe_for_binlog=1</span><br><span class="line">[root@localhost ~]# systemctl restart mariadb</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# mysql -e "select @@innodb_locks_unsafe_for_binlog"</span><br><span class="line">+----------------------------------+</span><br><span class="line">| @@innodb_locks_unsafe_for_binlog |</span><br><span class="line">+----------------------------------+</span><br><span class="line">|                                1 |</span><br><span class="line">+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>è¿˜æ˜¯å»åˆ›å»ºdb1.t1è¡¨ï¼Œå¦‚æœå·²æœ‰å°±å…ˆdropï¼›æœ‰åˆ—aå’Œbï¼Œåˆ†åˆ«ä¸ºchar(10)å’Œintå‹ï¼Œå¹¶ä¸”bä¸ºkeyï¼Œæ³¨æ„båˆ—ä¸ºç´¢å¼•åˆ—ï¼Œä½†å¹¶ä¸æ˜¯ä¸»é”®ï¼Œå› æ­¤ä¸æ˜¯å”¯ä¸€çš„ã€‚</p>
<table>
<thead>
<tr>
<th align="left">T1 RR</th>
<th align="left">T2 RR</th>
</tr>
</thead>
<tbody><tr>
<td align="left">begin;</td>
<td align="left">begin;</td>
</tr>
<tr>
<td align="left">select * from db1.t1 where b=3 for update;</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">insert into db1.t1 values (â€˜batmanâ€™,2)</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">insert into db1.t1 values (â€˜batmanâ€™,4)</td>
</tr>
<tr>
<td align="left">commit;</td>
<td align="left">commit;</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [db1]&gt; create table db1.t1 (a char(10),b int,key (b));</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values ('batman',1),('superman',3),('leo',5);</span><br><span class="line">Query OK, 3 rows affected (0.15 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1;</span><br><span class="line">+----------+------+</span><br><span class="line">| a        | b    |</span><br><span class="line">+----------+------+</span><br><span class="line">| batman   |    1 |</span><br><span class="line">| superman |    3 |</span><br><span class="line">| leo      |    5 |</span><br><span class="line">+----------+------+</span><br><span class="line">3 rows in set (0.02 sec)</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å¼€å¯ä¸¤ä¸ªäº‹åŠ¡T1å’ŒT2ï¼ŒT1ä¸­æŸ¥çœ‹b=3çš„è¡Œï¼Œæ˜¾å¼åŠ æ’ä»–é”ï¼›T1æœªæäº¤äº‹åŠ¡æ—¶ï¼ŒT2äº‹åŠ¡å¼€å¯å¹¶å°è¯•æ’å…¥æ–°è¡Œa=â€™batmanâ€™,b=2å’Œa=â€™batmanâ€™,b=4ï¼›</p>
<p>T1äº‹åŠ¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1 where b=3 for update;</span><br><span class="line">+----------+------+</span><br><span class="line">| a        | b    |</span><br><span class="line">+----------+------+</span><br><span class="line">| superman |    3 |</span><br><span class="line">+----------+------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>T2äº‹åŠ¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values ('batman',4);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values ('batman',2);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>T1äº‹åŠ¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<h5 id="å®è·µ4ï¼šnext-key-lockingæ˜¯å¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜çš„"><a href="#å®è·µ4ï¼šnext-key-lockingæ˜¯å¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜çš„" class="headerlink" title="å®è·µ4ï¼šnext-key lockingæ˜¯å¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜çš„"></a>å®è·µ4ï¼šnext-key lockingæ˜¯å¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜çš„</h5><p><img src="pic/lock19.png" alt="lock19"></p>
<p>é¦–å…ˆä»€ä¹ˆæ˜¯å¹»è¯»å‘¢ï¼Ÿ </p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸¤ä¸ªç”·å­©åŒæ—¶åœ¨è¿½æ±‚ä¸€ä¸ªå¥³ç”Ÿçš„æ•…äº‹</p>
<p>Aé—®ï¼šä½ æœ‰ç”·æœ‹å‹å—ï¼Ÿå¥³å­©å¯¹ä»–è¯´æ²¡æœ‰ã€‚Aè¿½æ±‚å¥³å­©çš„äº‹ä»¶è¿˜æ²¡æœ‰æäº¤ï¼Œå°±æ˜¯ç»§ç»­è¿½æ±‚å“ˆã€‚</p>
<p>å°±åœ¨Aè¿½æ±‚çš„åŒæ—¶ï¼ŒBä¹Ÿåœ¨è¿½æ±‚ï¼Œå¹¶ä¸”ç›´æ¥è®©å¥³å­©åšä»–çš„å¥³æœ‹å‹ï¼Œå¥³å­©ç­”åº”äº†ï¼ŒBçš„è¿½æ±‚äº‹ä»¶ç»“æŸã€‚</p>
<p>Aåˆé—®ï¼šä½ æœ‰ç”·æœ‹å‹å—ï¼Ÿ å¥³å­©å¯¹ä»–è¯´æˆ‘å·²ç»æœ‰ç”·æœ‹å‹äº†ï¼ å‘œå‘œå‘œ ï¼åˆšæ‰ä½ è¿˜æ²¡æœ‰çš„ï¼Œæ€ä¹ˆç°åœ¨å°±æœ‰äº†å‘¢ï¼Ÿ</p>
<p>å¥³å­©è¯´ï¼Œä½ ä¹Ÿæ²¡è¯´è¿‡ä½ è¿½æˆ‘çš„æ—¶å€™ä¸è®©åˆ«äººè¿½æˆ‘å•Šï¼â€¦ â€¦ Aå“­ç€èµ°äº†ã€‚</p>
<p><strong>å¹»è¯» Phantom Problem æ˜¯æŒ‡åœ¨åŒä¸€äº‹åŠ¡ä¸‹ï¼Œè¿ç»­æ‰§è¡Œä¸¤æ¬¡ç›¸åŒçš„sqlè¯­å¥å¯èƒ½å¯¼è‡´ä¸åŒçš„ç»“æœï¼Œç¬¬äºŒæ¬¡çš„sqlè¯­å¥å¯èƒ½ä¼šè¿”å›ä¹‹å‰ä¸å­˜åœ¨çš„è¡Œã€‚</strong></p>
<p>åœ¨åˆšæ‰æˆ‘ä¸¾çš„ä¾‹å­é‡Œï¼ŒAè™½ç„¶é—®äº†å¥³å­©æœ‰æ²¡æœ‰ç”·æœ‹å‹ï¼Œä½†æ˜¯æ²¡æœ‰å‘Šè¯‰å¥³å­©ï¼Œåœ¨ä»–è¿½æ±‚æ—¶ï¼Œä¸å¯ä»¥æ¥å—åˆ«äººçš„è¿½æ±‚ï¼Œæ‰€ä»¥æ‚²å‚¬çš„ç»“å±€ã€‚</p>
<p>é‚£ä¹ˆAæ€ä¹ˆæ‰èƒ½åœ¨ä»–è¿½æ±‚äº‹ä»¶ç»“æŸå‰è®©å¥³å­©ä¸ç­”åº”åˆ«äººçš„è¿½æ±‚å‘¢ï¼Ÿ</p>
<p>innodbä¸­çš„RRéš”ç¦»çº§åˆ«æ˜¯é€šè¿‡next-key lockingæ˜¯å¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜çš„ï¼Œå°±æ˜¯é”ä½ä¸€ä¸ªèŒƒå›´ã€‚</p>
<p>é‚£ä¹ˆå¦‚æœä½ æ˜¯Aä½ æ€ä¹ˆåšå‘¢ï¼Ÿä½ è‚¯å®šè¦è·Ÿå¥³å­©è¯´ï¼Œåªè¦æˆ‘å¼€å§‹è¿½æ±‚ä½ ï¼Œé—®äº†ä½ æœ‰æ²¡æœ‰ç”·æœ‹å‹ï¼Œåœ¨æˆ‘ç»“æŸè¿½æ±‚ä½ ä¹‹å‰ï¼Œä½ ä¸å¯ä»¥ç­”åº”åˆ«äººçš„è¿½æ±‚ï¼æˆ‘è¦æŠŠä½ è„‘å­é‡Œè®°å½•ç”·æœ‹å‹çš„åŒºåŸŸå…¨éƒ¨é”èµ·æ¥ï¼Œå•Šå“ˆå•Šï¼</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥åšä¸€ä¸ªæµ‹è¯•ï¼Œåˆ†åˆ«åœ¨RRå’ŒRCéš”ç¦»çº§åˆ«ä¸­æ¥å®ç°ï¼š</p>
<p>æµ‹è¯•ä½¿ç”¨è¡¨db1.t1 (a int primary key) ,è®°å½•æœ‰1,3,5</p>
<table>
<thead>
<tr>
<th align="left">T1 RC</th>
<th align="left">T2 RR</th>
</tr>
</thead>
<tbody><tr>
<td align="left">begin;</td>
<td align="left">begin;</td>
</tr>
<tr>
<td align="left">set session transaction isolation level READ COMMITTED;</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">select * from db1.t1 where a&gt;3 for update;</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">æŸ¥è¯¢ç»“æœä¸º5</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">insert into db1.t1 values (4);</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">commit;</td>
</tr>
<tr>
<td align="left">select * from db1.t1 where a&gt;3;</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">æŸ¥è¯¢ç»“æœä¸º4 5</td>
<td align="left"></td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [db1]&gt; create table t1 (a int primary key);</span><br><span class="line">Query OK, 0 rows affected (0.22 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into t1 values (1),(3),(5);</span><br><span class="line">Query OK, 3 rows affected (0.02 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T1</span></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; set session transaction isolation level read co</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1 where a&gt;3 for update;</span><br><span class="line">+---+</span><br><span class="line">| a |</span><br><span class="line">+---+</span><br><span class="line">| 5 |</span><br><span class="line">+---+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T2</span></span><br><span class="line">MariaDB [db1]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; insert into db1.t1 values (4);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T1</span></span><br><span class="line">MariaDB [db1]&gt; select * from db1.t1 where a&gt;3 for update;</span><br><span class="line">+---+</span><br><span class="line">| a |</span><br><span class="line">+---+</span><br><span class="line">| 4 |</span><br><span class="line">| 5 |</span><br><span class="line">+---+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>


<p>å°†ä¼šè¯ä¸­çš„éš”ç¦»ç•Œåˆ«æ”¹ä¸ºRRï¼Œå¹¶åˆ é™¤a=4è®°å½•ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [db1]&gt; set session transaction isolation level repeatable read;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db1]&gt; delete from db1.t1 where a=4;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">T1 RR</th>
<th align="left">T2 RR</th>
</tr>
</thead>
<tbody><tr>
<td align="left">begin;</td>
<td align="left">begin;</td>
</tr>
<tr>
<td align="left">select * from db1.t1 where a&gt;3 for update;</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">æŸ¥è¯¢ç»“æœä¸º5</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">insert into db1.t1 values (4);</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">commit;</td>
</tr>
<tr>
<td align="left">select * from db1.t1 where a&gt;3;</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">æŸ¥è¯¢ç»“æœä¸º5</td>
<td align="left"></td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T1</span></span><br><span class="line">MariaDB [(none)]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1 where a&gt;3 for update;</span><br><span class="line">+---+</span><br><span class="line">| a |</span><br><span class="line">+---+</span><br><span class="line">| 5 |</span><br><span class="line">+---+</span><br><span class="line">1 row in set (0.02 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T2</span></span><br><span class="line">MariaDB [(none)]&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values (4);</span><br><span class="line">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</span><br><span class="line">MariaDB [(none)]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">äº‹åŠ¡T1</span></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1 where a&gt;3 for update;</span><br><span class="line">+---+</span><br><span class="line">| a |</span><br><span class="line">+---+</span><br><span class="line">| 5 |</span><br><span class="line">+---+</span><br><span class="line">1 row in set (0.02 sec)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>MySQLåŸºç¡€ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬äº”è¯¾ å¤‡ä»½ä¸æ¢å¤</title>
    <url>/2016/12/29/booboo_mysql/03-MySQL%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/</url>
    <content><![CDATA[<h3 id="ä¸ºä»€ä¹ˆè¦å¤‡ä»½"><a href="#ä¸ºä»€ä¹ˆè¦å¤‡ä»½" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å¤‡ä»½"></a>ä¸ºä»€ä¹ˆè¦å¤‡ä»½</h3><p>æœåŠ¡å™¨ç»´æŠ¤çš„å·¥ä½œæ°¸è¿œéƒ½æœ‰ä¸€ä¸ªä¸å˜çš„ä¸»é¢˜,é‚£å°±æ˜¯å¤‡ä»½ã€‚æ­£æ‰€è°“,æ‰‹é‡Œæœ‰ç²®,å¿ƒé‡Œä¸æ…Œã€‚ä»äº‹æ•°æ®åº“ç›¸å…³å·¥ä½œä¸€æ ·æ°¸è¿œéƒ½ä¸è¦å¿˜è®°ä¸€ä¸ªé‡ç‚¹:å¤‡ä»½ã€‚å› ä¸º,æœ‰äº†å¤‡ä»½,æˆ‘ä»¬å°±ä»€ä¹ˆéƒ½ä¸æ€•ã€‚å‡ºäº†ä»»ä½•é—®é¢˜(å½“ç„¶,æˆ‘ä»¬å–„æ„çš„å¸Œæœ›æ°¸è¿œä¸è¦å‡ºä»€ä¹ˆé—®é¢˜),åªè¦æˆ‘ä»¬æ‰‹ä¸Šæœ‰å®Œæ•´çš„å¤‡ä»½,é‚£å°±æœ‰æœºä¼šæ¢å¤å›æ¥ã€‚</p>
<p><img src="pic/59.jpg" alt=""></p>
<p>2017å¹´ 1 æœˆ 31 æ—¥æ™šä¸Šææ€•æ˜¯çŸ¥åç¨‹åºæºç ä»£ç®¡æœåŠ¡ç½‘ç«™ GitLab æœ€é•¿çš„ä¸€å¤œï¼Œå› ä¸ºä¸€ä½å·¥ç¨‹å¸ˆçš„ç–å¿½é€ æˆå¤§é‡èµ„æ–™æµå¤±ï¼Œè€Œåˆå‘ç°æ‰€æœ‰å¤‡ä»½æ–¹æ¡ˆéƒ½æ— æ•ˆè€Œå´©æºƒã€‚</p>
<p><img src="pic/60.png" alt=""></p>
<p>300GB çš„èµ„æ–™è¢«åˆ åˆ°åªå‰©ä¸‹ 4.5GBã€‚è€Œæœ€åä¸€ä¸ªæ½œåœ¨å¯ç”¨çš„å¤‡ä»½æ˜¯ 6 å°æ—¶å‰æ‰‹åŠ¨æ“ä½œçš„ï¼Œä¸€æ—¶ä¹‹é—´è¿ç½‘ç«™éƒ½è¿ä¸è¿›å»äº†ã€‚æ ¹æ®è¯¥å…¬å¸ Google docs çš„ç»´æŠ¤çºªå½•åœ¨æœ€æ–°çš„è®¯æ¯æåˆ°ï¼šâ€œè¿™ä¸ªäº‹ä»¶å½±å“äº†ç½‘ç«™æ•°æ®åº“ï¼ˆåŒ…æ‹¬ issue é—®é¢˜å’Œ merge requests åˆå¹¶è¯·æ±‚ï¼‰ï¼Œä½†ä¸å½±å“ git reposï¼ˆgit ç‰ˆæœ¬ç®¡æ§æ¡£æ¡ˆåº“å’Œ wiki æœåŠ¡ï¼‰ã€‚â€</p>
<p>ç”±äºä¸æ˜¯æ‰€æœ‰èµ„æ–™éƒ½é—å¤±äº†ï¼Œæ‰€ä»¥å¯¹ç”¨æˆ·æ¥è¯´è¿˜æ˜¯ç¨æ„Ÿå®‰æ…°ï¼Œä½†æ˜¯è¯¥æ–‡ä»¶åœ¨â€œé‡åˆ°çš„é—®é¢˜â€ï¼ˆProblems Encounteredï¼‰å°èŠ‚é‡Œï¼Œæœ€åæ€»ç»“ï¼š</p>
<p>â€œå› æ­¤ï¼Œæ¢å¥è¯è¯´ï¼Œéƒ¨ç½²çš„ 5 ä¸ªä¸åŒå¤‡ä»½ï¼è¿˜åŸæŠ€æœ¯ä¸­ï¼Œæ²¡æœ‰ä¸€ä¸ªèƒ½å¯é åœ°å·¥ä½œæˆ–ç¬¬ä¸€æ—¶é—´è¿˜åŸå›æ¥ï¼Œæˆ‘ä»¬åªèƒ½ä» 6 å°æ—¶å‰æœ‰æ•ˆçš„å¤‡ä»½è¿˜åŸã€‚â€</p>
<p>äº¡ç¾Šè¡¥ç‰¢ä¸ºæ—¶ä¸æ™šï¼ŒGitLab å±•ç°è¯šæ„ä»¥ YouTube ç›´æ’­ä¸ Twitter å°†è®¯æ¯å…¬è¯¸äºç½‘ç»œï¼Œä½†æ˜¯çœ‹æ¥ GitLab å¿…é¡»éå¸¸åŠªåŠ›ï¼Œæ‰èƒ½æŒ½å›å®¢æˆ·ä¸æŠ•èµ„è€…å¯¹è¯¥å…¬å¸çš„ä¿¡å¿ƒã€‚å¯¹å…¶ä»–ä¾èµ–èµ„è®¯ç§‘æŠ€çš„å…¬å¸è€Œè¨€ï¼Œç›¸ä¿¡è¿™ä¹Ÿæ˜¯å¾ˆå¥½çš„å€Ÿé•œã€‚</p>
<p><img src="pic/61.jpg" alt=""></p>
<h3 id="ä»€ä¹ˆæ˜¯å¤‡ä»½"><a href="#ä»€ä¹ˆæ˜¯å¤‡ä»½" class="headerlink" title="ä»€ä¹ˆæ˜¯å¤‡ä»½"></a>ä»€ä¹ˆæ˜¯å¤‡ä»½</h3><p>å¤‡ä»½å·²ç»æˆä¸ºæ‰€æœ‰DBAçš„å¿…ä¿®ç§‘ç›®ï¼Œåˆ°åº•ä»€ä¹ˆæ˜¯å¤‡ä»½æ¢å¤å‘¢ï¼Ÿç®€å•çš„è®²ï¼šå¤‡ä»½ï¼Œå°±æ˜¯æŠŠæ•°æ®ä¿å­˜ä¸€ä»½å¤‡ç”¨ï¼›æ¢å¤ï¼Œå°±æ˜¯æŠŠä¿å­˜çš„æ•°æ®è¿˜åŸå›å»ã€‚</p>
<p>å½“æœåŠ¡å™¨å‡ºç°æ•…éšœéœ€è¦ä¿®å¤ï¼Œæˆ–è€…æ•°æ®ç ´åéœ€è¦æ¢å¤ï¼Œåˆæ¯”å¦‚ç³»ç»Ÿå®•æœºã€ç¡¬ä»¶æŸåã€ç”¨æˆ·é”™è¯¯åˆ é™¤æ•°æ®ç­‰åœºæ™¯ï¼Œéƒ½æ˜¯éœ€è¦å€Ÿç”¨å¤‡ä»½æ‰èƒ½æ‰§è¡Œæ¢å¤ã€‚</p>
<p>å¤‡ä»½æ˜¯å¤‡ä»½ï¼Œå†—ä½™æ˜¯å†—ä½™ã€‚æ¦‚å¿µä¸ä¸€æ ·ï¼Œå¤‡ä»½æ˜¯å°†æ•°æ®ä»¥éš”ç¦»çš„æ–¹å¼ä¿å­˜ï¼Œå°†å¤‡ä»½çš„æ•°æ®æ”¾åœ¨å…¶ä»–åœ°æ–¹ï¼ŒåŸæ¥çš„æ•°æ®è¢«ä¸Šä¿®æ”¹ï¼Œå¤‡ä»½çš„æ•°æ®ä¸ä¼šå˜æ›´ã€‚ä¹Ÿå°±æ˜¯è¯´å¤‡ä»½å‡ºæ¥çš„æ•°æ®ä¸ä¼šå› ä¸ºåŸæ•°æ®çš„æ”¹å˜è€Œæ”¹å˜ï¼Œè¿™æ ·å°±æ¯”è¾ƒå®‰å…¨ã€‚ä½†æ˜¯å¤‡ä»½çš„ç¼ºç‚¹æ˜¯ï¼Œä»–ä¸æ˜¯ç¬é—´è¿˜åŸï¼Œå¤‡ä»½åœ¨è¿˜åŸè¿‡ç¨‹ä¸­æ˜¯æœ‰è€—æ—¶çš„ï¼Œä»–ä¸æ˜¯ç¬é—´è¿˜åŸï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰å‡ ç™¾ä¸ªGçš„æ–‡ä»¶è¦è¿˜åŸå›å»ï¼Œæ…¢æ…¢æ‹·å§ï¼Œå‡ ä¸ªå°æ—¶ã€‚å†—ä½™ä¸ä¸€æ ·ï¼Œä»–æ˜¯çƒ­å¤‡ï¼Œèƒ½å¤Ÿç¬é—´æ¢å¤ã€‚ä¸»æœåŠ¡å™¨/ä»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨åæ‰ï¼Œä»æœåŠ¡å™¨å°±é¡¶ä¸Šå·¥ä½œï¼Œæ‰€ä»¥å†—ä½™åœ¨å¯ç”¨æ€§ä¸Šæ¥è®²ï¼Œæ¢å¤çš„é€Ÿåº¦ä¸Šæ¥è®²ï¼Œæ¯”å¤‡ä»½æ¥çš„å¿«ï¼Œä½†æ˜¯å†—ä½™æœ‰ä»–çš„ç¼ºç‚¹ï¼Œå¤‡ä»½æœ‰ä»–çš„ä¼˜ç‚¹ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½œä¸»ä»åŒæ­¥ï¼Œä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨æ•°æ®éƒ½ä¸€æ ·çš„ï¼Œå¦‚æœä¸»æœåŠ¡å™¨ä¸Šæœ‰äººé”™åˆ äº†ä¸€ä¸ªè¡¨ï¼Œæˆ‘ä»¬æŠŠè¿™ç§æ“ä½œç§°ä¸ºè¯¯æ“ä½œï¼Œé‚£ä¹ˆä»æœåŠ¡å™¨ä¹Ÿä¼šå‘ç”Ÿè¯¯æ“ä½œï¼Œæ‰€ä»¥å‘¢ï¼Œå†—ä½™ä¸èƒ½è§£å†³äººä¸ºçš„è¯¯æ“ä½œï¼Œè€Œå¤‡ä»½å¯ä»¥è§£å†³ã€‚å†—ä½™ä»–èƒ½è§£å†³ç¡¬ä»¶æ•…éšœï¼Œä½†æ˜¯è¯¯æ“ä½œæ— æ³•è§£å†³ï¼Œå¤‡ä»½ä¸æ˜¯ç¬é—´è¿˜åŸï¼Œä½†æ˜¯æ—¢å¯ä»¥è§£å†³ç¡¬ä»¶æ•…éšœåˆèƒ½è§£å†³è¯¯æ“ä½œï¼Œä»–ä»¬å„æœ‰ä¼˜åŠ£ç‚¹ï¼Œè€ŒçœŸå®çš„çº¿ä¸Šç”Ÿäº§ç¯å¢ƒæ˜¯ä¸¤ç§æ–¹æ³•ä¸€èµ·ä½¿ç”¨ï¼Œæ—¢æœ‰å†—ä½™ç¯å¢ƒï¼Œåˆæœ‰å‘¨æœŸæ€§å¤‡ä»½ï¼Œç®¡ç†å‘˜è¦å‘¨æœŸæ€§åœ°è¿›è¡Œå¤‡ä»½ï¼ŒåŒæ—¶æœ‰å¤šå°æœåŠ¡å™¨ä½œå†—ä½™ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å¤‡ä»½</th>
<th align="left">å®šä¹‰</th>
<th align="left">ä¼˜ç‚¹</th>
<th align="left">ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å¤‡ä»½</td>
<td align="left">å°†æ•°æ®ä»¥éš”ç¦»çš„æ–¹å¼ä¿å­˜</td>
<td align="left">è§£å†³ç¡¬ä»¶æ•…éšœï¼Œè¯¯æ“ä½œ</td>
<td align="left">ä¸æ˜¯ç¬é—´è¿˜åŸ</td>
</tr>
<tr>
<td align="left">å†—ä½™</td>
<td align="left">äººä¸ºåœ°å¢åŠ é‡å¤éƒ¨åˆ†ï¼Œå…¶ç›®çš„æ˜¯ç”¨æ¥å¯¹åŸæœ¬çš„å•ä¸€éƒ¨åˆ†è¿›è¡Œå¤‡ä»½ï¼Œä»¥è¾¾åˆ°å¢å¼ºå…¶å®‰å…¨æ€§çš„ç›®çš„,æ„å»ºå†—ä½™ï¼ˆä¸»æœåŠ¡å™¨ä»æœåŠ¡å™¨ï¼‰çš„ç¯å¢ƒ</td>
<td align="left">æ¢å¤é€Ÿåº¦å¿«</td>
<td align="left">è§£å†³ç¡¬ä»¶æ•…éšœï¼Œè¯¯æ“ä½œæ— æ³•è§£å†³</td>
</tr>
</tbody></table>
<h3 id="å¤‡ä»½çš„ä¸¤å¤§è¦ç´ "><a href="#å¤‡ä»½çš„ä¸¤å¤§è¦ç´ " class="headerlink" title="å¤‡ä»½çš„ä¸¤å¤§è¦ç´ "></a>å¤‡ä»½çš„ä¸¤å¤§è¦ç´ </h3><blockquote>
<p>MySQLå¯¹å­˜å‚¨å¼•æ“çš„é€‰æ‹©ä¼šå¯¼è‡´å¤‡ä»½æ˜æ˜¾æ›´å¤æ‚ã€‚é—®é¢˜æ˜¯ï¼Œå¯¹äºç»™å®šçš„å­˜å‚¨å¼•æ“ï¼Œå¦‚ä½•å¾—åˆ°ä¸€è‡´çš„å¤‡ä»½ã€‚</p>
</blockquote>
<p>å®é™…ä¸Šæœ‰ä¸¤ç±»ä¸€è‡´æ€§éœ€è¦è€ƒè™‘ï¼šæ•°æ®ä¸€è‡´æ€§å’Œæ–‡ä»¶ä¸€è‡´æ€§ã€‚</p>
<ul>
<li>æ•°æ®ä¸€è‡´æ€§ï¼šå¤‡ä»½æ•°æ®åœ¨æŒ‡å®šæ—¶é—´ç‚¹ä¸€è‡´</li>
<li>æ–‡ä»¶ä¸€è‡´æ€§ï¼šç¡®ä¿æ–‡ä»¶åœ¨ç£ç›˜ä¸Šä¸€è‡´</li>
<li>æœåŠ¡å¯ç”¨æ€§ï¼šæ•°æ®åº“æ˜¯å¦å¯ä»¥è¯»å†™ï¼Œæ—¢èƒ½è¯»ä¹Ÿèƒ½å†™æ‰æ˜¯æœåŠ¡å¯ç”¨ã€‚</li>
</ul>
<p>å½“æˆ‘ä»¬åœ¨å¤‡ä»½æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœæœ‰äººåœ¨ä¿®æ”¹è¡¨çš„å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¤‡ä»½å‡ºæ¥çš„æ•°æ®å¯èƒ½å°±ä¼šæœ‰é—®é¢˜ï¼Œå¤‡ä»½å‡ºæ¥çš„æ•°æ®å¯èƒ½ä¸æ˜¯æˆ‘ä»¬è¦çš„æ—¶é—´ç‚¹ã€‚æ¯”å¦‚æˆ‘éœ€è¦å°†4ç‚¹è¿™ä¸ªçŠ¶æ€çš„æ•°æ®å¤‡ä»½ï¼Œä»4ç‚¹å¼€å§‹å¤‡ä»½ä¸€ç›´åˆ°5ç‚¹ç»“æŸï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰äººåœ¨4.30ä¿®æ”¹ä¸€ä¸ªæ•°æ®ï¼Œå‡è®¾æ˜¯å°†Aå‘˜å·¥çš„å·¥èµ„ä»4000æ”¹ä¸º5000ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ€åå¤‡ä»½å‡ºæ¥çš„æ•°æ®åˆ°åº•æ˜¯å‡ ç‚¹çš„çŠ¶æ€å°±æœªçŸ¥äº†ã€‚å¦‚æœ4.30çš„æ—¶å€™å·²ç»å¤‡ä»½è¿‡Aå‘˜å·¥äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¤‡ä»½å‡ºæ¥çš„Aå‘˜å·¥çš„å·¥èµ„å°±è¿˜æ˜¯4000ï¼›å¦‚æœ4.30çš„æ—¶å€™è¿˜æ²¡æœ‰å¤‡ä»½åˆ°Aå‘˜å·¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ€åå¤‡ä»½å‡ºæ¥çš„Aå‘˜å·¥çš„å·¥èµ„å°±å˜æˆ5000äº†ã€‚è¿™å°±æ˜¯æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æ¥ä¿è¯æ•°æ®ä¸€è‡´å‘¢ï¼Ÿ</p>
<h3 id="å¤‡ä»½çš„åˆ†ç±»"><a href="#å¤‡ä»½çš„åˆ†ç±»" class="headerlink" title="å¤‡ä»½çš„åˆ†ç±»"></a>å¤‡ä»½çš„åˆ†ç±»</h3><ol>
<li>åˆ†ç±»ï¼šå†·å¤‡ã€çƒ­å¤‡ã€å¼‚åœ°ç¾å¤‡</li>
<li>å†·å¤‡çš„åˆ†ç±»ï¼š<ul>
<li>ç‰©ç†å¤‡ä»½ã€é€»è¾‘å¤‡ä»½</li>
<li>å®Œå…¨å¤‡ä»½ã€å¢é‡å¤‡ä»½</li>
<li>åœ¨çº¿ï¼ˆçƒ­ï¼‰å¤‡ä»½ã€æ¸©å¤‡ä»½ã€ç¦»çº¿ï¼ˆå†·ï¼‰å¤‡ä»½</li>
</ul>
</li>
</ol>
<h4 id="ç‰©ç†å¤‡ä»½å’Œé€»è¾‘å¤‡ä»½"><a href="#ç‰©ç†å¤‡ä»½å’Œé€»è¾‘å¤‡ä»½" class="headerlink" title="ç‰©ç†å¤‡ä»½å’Œé€»è¾‘å¤‡ä»½"></a>ç‰©ç†å¤‡ä»½å’Œé€»è¾‘å¤‡ä»½</h4><p>æœ‰ä¸¤ç§ä¸»è¦çš„æ–¹æ³•æ¥å¤‡ä»½MySQLæ•°æ®ï¼šé€»è¾‘å¤‡ä»½ï¼ˆä¹Ÿå«â€œå¯¼å‡ºâ€ï¼‰å’Œç›´æ¥å¤åˆ¶åŸå§‹æ–‡ä»¶çš„ç‰©ç†å¤‡ä»½ã€‚é€»è¾‘å¤‡ä»½å°†æ•°æ®åŒ…å«åœ¨ä¸€ç§MySQLèƒ½å¤Ÿè§£æçš„æ ¼å¼ä¸­ï¼Œè¦ä¹ˆæ˜¯SQLï¼Œè¦ä¹ˆæ˜¯ä»¥æŸä¸ªç¬¦å·åˆ†éš”çš„æ–‡æœ¬ã€‚åŸå§‹æ–‡ä»¶æ˜¯æŒ‡å­˜åœ¨ä¸ç¡¬ç›˜ä¸Šçš„æ–‡ä»¶ã€‚</p>
<p>ä»»ä½•ä¸€ç§å¤‡ä»½éƒ½æœ‰å…¶æœ‰ç‚¹å’Œç¼ºç‚¹ã€‚</p>
<h5 id="é€»è¾‘å¤‡ä»½"><a href="#é€»è¾‘å¤‡ä»½" class="headerlink" title="é€»è¾‘å¤‡ä»½"></a>é€»è¾‘å¤‡ä»½</h5><p>é€»è¾‘å¤‡ä»½æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p>
<ul>
<li>é€»è¾‘å¤‡ä»½æ˜¯å¯ä»¥ç”¨ç¼–è¾‘å™¨æˆ–è€…åƒ<code>grep</code>å’Œ<code>sed</code>ä¹‹ç±»çš„å‘½ä»¤æŸ¥çœ‹å’Œæ“ä½œçš„æ™®é€šæ–‡ä»¶ã€‚å½“éœ€è¦æ¢å¤æ•°æ®æˆ–åªæƒ³æŸ¥çœ‹æ•°æ®ä½†ä¸æ¢å¤æ—¶ï¼Œè¿™éƒ½æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚</li>
<li>æ¢å¤éå¸¸ç®€å•ã€‚å¯ä»¥é€šè¿‡ç®¡é“æŠŠå®ƒä»¬è¾“å…¥åˆ°<code>mysql</code>ï¼Œæˆ–è€…ä½¿ç”¨<code>mysqlimport</code>ã€‚</li>
<li>å¯ä»¥é€šè¿‡ç½‘ç»œæ¥å¤‡ä»½å’Œæ¢å¤â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ä¸Mysqlä¸»æœºä¸åŒçš„å¦å¤–ä¸€å°æœºå™¨ä¸Šæ“ä½œã€‚</li>
<li>å¯ä»¥åœ¨ç±»ä¼¼Amazon RDSè¿™æ ·ä¸èƒ½è®¿é—®åº•å±‚æ–‡ä»¶ç³»ç»Ÿçš„çš„ç³»ç»Ÿä¸­ä½¿ç”¨ã€‚</li>
<li>éå¸¸çµæ´»ï¼Œå› ä¸º<code>mysqldump</code>â€”â€”â€”å¤§éƒ¨åˆ†äººå–œæ¬¢çš„å·¥å…·â€”â€”å¯ä»¥æ¥å—è®¸å¤šé€‰é¡¹ï¼Œä¾‹å¦‚å¯ä»¥ç”¨whereå­å¥æ¥é™åˆ¶éœ€è¦å¤‡ä»½é‚£äº›è¡Œã€‚</li>
<li>ä¸å­˜å‚¨å¼•æ“æ— å…³ã€‚å› ä¸ºæ˜¯ä»MySQLæœåŠ¡å™¨ä¸­æå–æ•°æ®è€Œç”Ÿæˆï¼Œæ‰€ä»¥æ¶ˆé™¤äº†åº•å±‚æ•°æ®å­˜å‚¨å’Œä¸åŒã€‚å› æ­¤ï¼Œå¯ä»¥ä»InnoDBè¡¨ä¸­å¤‡ä»½ï¼Œç„¶ååªéœ€æå°çš„å·¥ä½œé‡å°±å¯ä»¥è¿˜åŸåˆ°MyISAMè¡¨ä¸­ã€‚è€Œå¯¹äºåŸå§‹æ•°æ®å´ä¸èƒ½è¿™ä¹ˆåšã€‚</li>
<li>æœ‰åŠ©äºé¿å…æ•°æ®æŸåã€‚å¦‚æœç£ç›˜é©±åŠ¨å™¨æœ‰æ•…éšœè€Œè¦æ¢å¤åŸå§‹æ–‡ä»¶æ—¶ï¼Œä½ å°†ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯å¹¶ä¸”/æˆ–ç”Ÿæˆä¸€ä¸ªéƒ¨åˆ†æˆ–æŸåçš„å¤‡ä»½ã€‚å¦‚æœMySQLåœ¨å†…å­˜ä¸­çš„æ•°æ®è¿˜æ²¡æœ‰æŸåï¼Œå½“ä¸èƒ½å¤Ÿå¾—åˆ°ä¸€ä¸ªæ­£å¸¸çš„åŸå§‹æ–‡ä»¶å¤åˆ¶æ—¶ï¼Œæœ‰æ—¶è¿˜å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¯ä»¥ä¿¡èµ–çš„é€»è¾‘å¤‡ä»½ã€‚</li>
</ul>
<p>å°½ç®¡å¦‚æ­¤ï¼Œé€»è¾‘å¤‡ä»½ä¹Ÿæœ‰å®ƒçš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>å¿…é¡»ç”±æ•°æ®åº“æœåŠ¡å™¨å®Œæˆç”Ÿæˆé€»è¾‘å¤‡ä»½çš„å·¥ä½œï¼Œå› æ­¤è¦ä½¿ç”¨æ›´å¤šçš„cpuå‘¨æœŸã€‚</li>
<li>é€»è¾‘å¤‡ä»½åœ¨æŸäº›åœºæ™¯ä¸‹æ¯”æ•°æ®åº“æ–‡ä»¶æœ¬èº«è¿˜è¦æ›´å¤§ã€‚ASCIIå½¢å¼çš„æ•°æ®ä¸æ€»æ˜¯å’Œå­˜å‚¨å¼•æ“å­˜å‚¨æ•°æ®ä¸€æ ·é«˜æ•ˆã€‚</li>
<li>æ— æ³•ä¿è¯å¯¼å‡ºåå†è¿˜åŸå‡ºæ¥çš„ä¸€å®šæ˜¯åŒæ ·çš„æ•°æ®ã€‚æµ®ç‚¹è¡¨ç¤ºçš„é—®é¢˜ã€è½¯ä»¶Bugç­‰éƒ½ä¼šå¯¼è‡´é—®é¢˜ï¼Œå°½ç®¡éå¸¸å°‘è§ã€‚</li>
<li>ä»é€»è¾‘å¤‡ä»½ä¸­è¿˜åŸéœ€è¦MySQLåŠ è½½å’Œè§£é‡Šè¯­å¥ï¼Œè½¬åŒ–ä¸ºå­˜å‚¨æ ¼å¼ï¼Œå¹¶é‡å»ºç´¢å¼•ï¼Œæ‰€æœ‰è¿™ä¸€åˆ‡ä¼šå¾ˆæ…¢ã€‚</li>
</ul>
<p>æœ€å¤§çš„ç¼ºç‚¹æ˜¯ä»MySQLä¸­å¯¼å‡ºæ•°æ®å’Œé€šè¿‡SQLè¯­å¥å°†å…¶åŠ è½½å›å»çš„å¼€æ¶ˆã€‚å¦‚æœä½¿ç”¨é€»è¾‘å¤‡ä»½ï¼Œæµ‹è¯•æ¢å¤éœ€è¦çš„æ—¶é—´å°†éå¸¸é‡è¦ã€‚</p>
<h5 id="ç‰©ç†å¤‡ä»½"><a href="#ç‰©ç†å¤‡ä»½" class="headerlink" title="ç‰©ç†å¤‡ä»½"></a>ç‰©ç†å¤‡ä»½</h5><p>ç‰©ç†å¤‡ä»½æœ‰å¦‚ä¸‹å¥½å¤„ï¼š</p>
<ul>
<li>åŸºäºæ–‡ä»¶çš„ç‰©ç†å¤‡ä»½ï¼Œåªéœ€è¦å°†éœ€è¦çš„æ–‡ä»¶å¤åˆ¶åˆ°å…¶ä»–åœ°æ–¹å³å¯å®Œæˆå¤‡ä»½ã€‚ä¸éœ€è¦é¢å¤–çš„å·¥ä½œæ¥ç”ŸæˆåŸå§‹æ–‡ä»¶ã€‚</li>
<li>ç‰©ç†å¤‡ä»½çš„æ¢å¤å°±æ›´ç®€å•äº†ï¼Œè¿™å–å†³äºå­˜å‚¨å¼•æ“ã€‚å¯¹äºMyISAMï¼Œåªéœ€è¦ç®€å•åœ°å¤åˆ¶æ–‡ä»¶åˆ°ç›®çš„åœ°å³å¯ã€‚å¯¹äºInnoDBåˆ™éœ€è¦åœæ­¢æ•°æ®åº“æœåŠ¡ï¼Œå¯èƒ½è¿˜è¦é‡‡å–å…¶ä»–ä¸€äº›æ­¥éª¤ã€‚</li>
<li>InnoDBå’ŒMyISAMçš„ç‰©ç†å¤‡ä»½éå¸¸å®¹æ˜“è·¨å¹³å°ã€æ“ä½œç³»ç»Ÿå’ŒMySQLç‰ˆæœ¬ã€‚ï¼ˆé€»è¾‘å¤‡ä»½å¯¼å‡ºäº¦æ˜¯å¦‚æ­¤ã€‚è¿™é‡Œç‰¹åˆ«æŒ‡å‡ºè¿™ä¸€ç‚¹æ˜¯ä¸ºäº†æ¶ˆé™¤å¤§å®¶çš„æ‹…å¿ƒã€‚ï¼‰</li>
<li>ä»ç‰©ç†å¤‡ä»½ä¸­æ¢å¤ä¼šæ›´å¼€ï¼Œæ— æ³•å®Œå…¨ç¼“å†²åˆ°å†…å®¹ä¸­ï¼Œåˆ™ç‰©ç†å¤‡ä»½çš„æ¢å¤è¦å¿«éå¸¸å¤šâ€”â€”è‡³å°‘è¦å¿«ä¸€ä¸ªæ•°é‡çº§ã€‚äº‹å®ä¸Šï¼Œé€»è¾‘å¤‡ä»½æœ€å¯æ€•çš„åœ°æ–¹å°±æ˜¯ä¸ç¡®å®šçš„è¿˜åŸæ—¶é—´ã€‚</li>
</ul>
<p>ç‰©ç†å¤‡ä»½ä¹Ÿæœ‰å…¶ç¼ºç‚¹ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>InnoDBçš„åŸå§‹æ–‡ä»¶é€šå¸¸æ¯”ç›¸åº”çš„é€»è¾‘åˆ«åˆ†è¦å¤§çš„å¤šã€‚InnoDBçš„è¡¨ç©ºé—´å¾€å¾€åŒ…å«å¾ˆå¤šæœªä½¿ç”¨çš„ç©ºé—´ã€‚è¿˜æœ‰å¾ˆå¤šç©ºé—´ç”¨æ¥å­˜å‚¨æ•°æ®ä»¥å¤–çš„ç”¨é€”ï¼ˆæ’å…¥ç¼“å†²ã€å›æ»šæ®µç­‰ï¼‰ã€‚</li>
<li>ç‰©ç†å¤‡ä»½ä¸æ€»æ˜¯è·¨å¹³å°ã€æ“ä½œç³»ç»ŸåŠMySQLç‰ˆæœ¬ã€‚æ–‡ä»¶åå¤§å°å†™æ•æ„Ÿå’Œæµ®ç‚¹æ ¼å¼å¯èƒ½ä¼šé‡åˆ°éº»çƒ¦ã€‚å¾ˆå¯èƒ½å› æµ®ç‚¹æ ¼å¼ä¸åŒè€Œä¸èƒ½ç§»åŠ¨æ–‡ä»¶åˆ°å¦ä¸€ä¸ªç³»ç»Ÿï¼ˆè™½ç„¶ä¸»æµå¤„ç†å™¨éƒ½ä½¿ç”¨IEEEæµ®ç‚¹æ ¼å¼ã€‚ï¼‰</li>
</ul>
<p>ç‰©ç†å¤‡ä»½é€šå¸¸æ›´åŠ ç®€å•é«˜æ•ˆã€‚å°½ç®¡å¦‚æ­¤ï¼Œå¯¹äºéœ€è¦é•¿æœŸä¿ç•™çš„å¤‡ä»½ï¼Œæˆ–è€…æ˜¯æ»¡è¶³æ³•å¾‹<br>åˆè§„è¦æ±‚çš„å¤‡ä»½ï¼Œå°½é‡ä¸è¦å®Œå…¨ä¾èµ–ç‰©ç†å¤‡ä»½ã€‚è‡³å°‘æ¯éš”ä¸€æ®µæ—¶é—´è¿˜æ˜¯éœ€è¦åšä¸€æ¬¡é€»è¾‘å¤‡ä»½ã€‚</p>
<p>é™¤éç»è¿‡æµ‹è¯•ï¼Œä¸è¦å‡å®šå¤‡ä»½ï¼ˆç‰¹åˆ«æ˜¯ç‰©ç†å¤‡ä»½ï¼‰æ˜¯æ­£å¸¸çš„ã€‚å¯¹InnoDBæ¥è¯´ï¼Œè¿™æ„å‘³ç€éœ€è¦å¯åŠ¨ä¸€ä¸ªMySQLå®ä¾‹ï¼Œæ‰§è¡ŒInnoDBæ¢å¤æ“ä½œï¼Œç„¶åè¿è¡Œ<code>CHECK TABLES</code>ã€‚ä¹Ÿå¯ä»¥è·³è¿‡è¿™ä¸€æ“ä½œï¼Œä»…å¯¹æ–‡ä»¶è¿è¡Œinnochecksumï¼Œä½†æˆ‘ä»¬ä¸å»ºè®®è¿™æ ·åšã€‚å¯¹äºMyISAMï¼Œå¯ä»¥è¿è¡Œ<code>CHECK TABLES</code>ï¼Œæˆ–è€…ä½¿ç”¨mysqlcheckã€‚ä½¿ç”¨<code>mysqlcheck</code>å¯ä»¥å¯¹æ‰€æœ‰è¡¨æ‰§è¡Œ<code>CHECK TABLES</code>æ“ä½œã€‚</p>
<p>å»ºè®®æ··åˆä½¿ç”¨ç‰©ç†å’Œé€»è¾‘ä¸¤ç§æ–¹æ³•æ¥åšå¤‡ä»½ï¼šå…ˆä½¿ç”¨ç‰©ç†å¤åˆ¶ï¼Œä»¥æ­¤æ•°æ®å¯åŠ¨MySQLæœåŠ¡å™¨å®ä¾‹å¹¶è¿è¡Œ<code>mysqlcheck</code>ã€‚ç„¶åï¼Œå‘¨æœŸæ€§åœ°ä½¿ç”¨mysqldumpæ‰§è¡Œé€»è¾‘å¤‡ä»½ã€‚è¿™æ ·åšå¯ä»¥è·å¾—ä¸¤ç§æ–¹æ³•çš„ä¼˜ç‚¹ï¼Œä¸ä¼šä½¿ç”Ÿäº§æœåŠ¡å™¨åœ¨å¯¼å‡ºæ—¶æœ‰è¿‡æ¸¡è´Ÿæ‹…ã€‚å¦‚æœèƒ½å¤Ÿæ–¹ä¾¿åœ°åˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿçš„å¿«ç…§ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆä¸€ä¸ªå¿«ç…§ï¼Œå°†è¯¥å¿«ç…§å¤åˆ¶åˆ°å¦å¤–ä¸€ä¸ªæœåŠ¡å™¨ä¸Šå¹¶é‡Šæ”¾ï¼Œç„¶åæµ‹è¯•åŸå§‹æ–‡ä»¶ï¼Œå†æ‰§è¡Œé€»è¾‘å¤‡ä»½ã€‚</p>
<p>æ³¨æ„ï¼šå€¼å¾—ä¸€æçš„æ˜¯ç‰©ç†å¤‡ä»½ä¼šæ›´å®¹æ˜“å‡ºé”™ï¼›å¾ˆéš¾åƒ<code>mysqldump</code>ä¸€æ ·ç®€å•ã€‚</p>
<h4 id="å¢é‡å¤‡ä»½å’Œå·®å¼‚å¤‡ä»½"><a href="#å¢é‡å¤‡ä»½å’Œå·®å¼‚å¤‡ä»½" class="headerlink" title="å¢é‡å¤‡ä»½å’Œå·®å¼‚å¤‡ä»½"></a>å¢é‡å¤‡ä»½å’Œå·®å¼‚å¤‡ä»½</h4><p>å½“æ•°æ®é‡å¾ˆåºå¤§æ—¶ï¼Œä¸€ä¸ªå¸¸è§çš„ç­–ç•¥æ˜¯åšå®šæœŸçš„å¢é‡æˆ–å·®å¼‚å¤‡ä»½ã€‚ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«æœ‰ç‚¹å®¹æ˜“è®©äººæ··æ·†ï¼Œæ‰€ä»¥å…ˆæ¥æ¾„æ¸…è¿™ä¸¤ä¸ªæœ¯è¯­ï¼š</p>
<p>å·®å¼‚å¤‡ä»½ï¼Œæ˜¯å¯¹è‡ªä¸Šæ¬¡å…¨å¤‡ä»½åæ‰€æœ‰æ”¹å˜çš„éƒ¨åˆ†è€Œåšçš„å¤‡ä»½ï¼›<br>å¢é‡å¤‡ä»½ï¼Œæ˜¯ä»ä»»æ„ç±»å‹çš„ä¸Šæ¬¡å¤‡ä»½åæ‰€æœ‰ä¿®æ”¹åšçš„å¤‡ä»½ï¼›</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æ¯å‘¨æ—¥åšä¸€ä¸ªå…¨å¤‡ä»½ã€‚åœ¨å‘¨ä¸€ï¼Œå¯¹è‡ªå‘¨æ—¥ä»¥æ¥æ‰€æœ‰çš„æ”¹å˜åšä¸€ä¸ªå·®å¼‚å¤‡ä»½ã€‚åœ¨å‘¨äºŒï¼Œå°±æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼šå¤‡ä»½è‡ªå‘¨æ—¥ä»¥æ¥æ‰€æœ‰çš„æ”¹å˜ï¼ˆå·®å¼‚ï¼‰ï¼Œæˆ–åªåˆ«åˆ†è‡ªå‘¨ä¸€åæ‰€æœ‰çš„æ”¹å˜ï¼ˆå¢é‡ï¼‰ã€‚</p>
<p>å¢é‡å’Œå·®å¼‚å¤‡ä»½éƒ½æ˜¯éƒ¨åˆ†å¤‡ä»½ï¼šå®ƒä»¬ä¸€èˆ¬ä¸åŒ…å«å®Œæ•´çš„æ•°æ®é›†ï¼Œå› ä¸ºæŸäº›æ•°æ®å‡ ä¹è‚¯å®šæ²¡æœ‰æ”¹å˜ã€‚éƒ¨åˆ†å¤‡ä»½å¯¹å‡å°‘æœåŠ¡å™¨å¼€é”€ã€å¤‡ä»½æ—¶é—´åŠå¤‡ä»½ç©ºé—´è€Œè¨€éƒ½å¾ˆåˆé€‚ã€‚å°½ç®¡æŸäº›éƒ¨åˆ†å¤‡ä»½å¹¶ä¸ä¼šçœŸæ­£å‡å°‘æœåŠ¡å™¨çš„å¼€é”€ã€‚ä¾‹å¦‚Percona XtraBackupå’ŒMySQL Enterprise Backupï¼Œä»ç„¶ä¼šæ‰«ææœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰æ•°æ®å—ï¼Œå› è€Œå¹¶ä¸ä¼šèŠ‚çº¦å¤ªå¤šçš„å¼€é”€ï¼Œä½†å®ƒä»¬ç¡®å®ä¼šå‡å°‘ä¸€å®šé‡çš„å¤‡ä»½æ—¶é—´å’Œå¤§é‡ç”¨äºå‹ç¼©çš„CPUæ—¶é—´ï¼Œå½“ç„¶ä¹Ÿä¼šå‡å°‘ç£ç›˜ç©ºé—´ä½¿ç”¨ã€‚</p>
<p>ä¸è¦å› ä¸ºä¼šç”¨é«˜çº§å¤‡ä»½æŠ€æœ¯è€Œè‡ªè´Ÿï¼Œè§£å†³æ–¹æ¡ˆè¶Šå¤æ‚ï¼Œé¢ä¸´çš„é£é™©ä¹Ÿè¶Šå¤§ã€‚è¦æ³¨æ„åˆ†æéšè—çš„å±é™©ï¼Œå¦‚æœå¤šæ¬¡è¿­ä»£å¤‡ä»½ç´§å¯†åœ°è€¦åˆåœ¨ä¸€èµ·ï¼Œåˆ™åªè¦å…¶ä¸­çš„ä¸€æ¬¡è¿­ä»£å¤‡ä»½æœ‰æŸåï¼Œå°±å¯èƒ½å¯¼è‡´æ‰€æœ‰çš„å¤‡ä»½éƒ½æ— æ•ˆã€‚</p>
<p>ä¸‹é¢æœ‰ä¸€äº›å»ºè®®ï¼š</p>
<ul>
<li>ä½¿ç”¨Percona XtraBackupå’ŒMySQL Enterprise Backupä¸­çš„å¢é‡å¤‡ä»½ç‰¹æ€§ã€‚</li>
<li>å¤‡ä»½äºŒè¿›åˆ¶æ—¥å¿—ã€‚å¯ä»¥åœ¨æ¯æ¬¡å¤‡ä»½åä½¿ç”¨flush logsæ¥å¼€å§‹ä¸€ä¸ªæ–°äºŒè¿›åˆ¶æ—¥å¿—ï¼Œè¿™æ ·å°±åªéœ€è¦å¤‡ä»½æ–°çš„äºŒè¿›åˆ¶æ—¥å¿—ã€‚</li>
<li>ä¸è¦å¤‡ä»½æ²¡æœ‰å˜åŒ–çš„è¡¨ã€‚æœ‰äº›å­˜å‚¨å¼•æ“ï¼Œä¾‹å¦‚ï¼ŒMyISAMï¼Œä¼šè®°å½•æ¯ä¸ªè¡¨æœ€åä¿®æ”¹æ—¶é—´ã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹ç£ç›˜ä¸Šçš„æ–‡ä»¶æˆ–è¿è¡Œshow table status æ¥æŸ¥çœ‹è¿™ä¸ªæ—¶é—´ã€‚å¦‚æœä½¿ç”¨InnoDBï¼Œå¯ä»¥åˆ©ç”¨è§¦å‘å™¨è®°å½•ä¿®æ”¹æ—¶é—´åˆ°ä¸€ä¸ªå°çš„â€œæœ€åä¿®æ”¹æ—¶é—´â€è¡¨ä¸­ï¼Œå¸®åŠ©è·Ÿè¸ªæœ€æ–°çš„ä¿®æ”¹æ“ä½œã€‚éœ€è¦ç¡®ä¿åªå¯¹å˜æ›´ä¸é¢‘ç¹çš„è¡¨è¿›è¡Œè·Ÿè¸ªï¼Œè¿™æ ·æ‰èƒ½é™ä½å¼€é”€ã€‚é€šè¿‡å®šåˆ¶çš„å¤‡ä»½è„šæœ¬å¯ä»¥è½»æ¾è·å–åˆ°å“ªäº›è¡¨æœ‰å˜æ›´ã€‚<br>ä¾‹å¦‚ï¼Œå¦‚æœæœ‰åŒ…å«ä¸åŒè¯­ç§å„ä¸ªæœˆçš„åç§°åˆ—è¡¨ï¼Œæˆ–è€…å·æˆ–åŒºåŸŸçš„ç®€å†™ä¹‹ç±»çš„â€œæŸ¥æ‰¾â€è¡¨ï¼Œå°†å®ƒä»¬æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„æ•°æ®åº“æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯æ¬¡éƒ½å¤‡ä»½è¿™äº›è¡¨ã€‚</li>
<li>ä¸è¦å¤‡ä»½æ²¡æœ‰æ”¹å˜çš„è¡Œã€‚æœ‰æ—¶å€™è¿™æ ·åšå½±å“ä¼šå¾ˆå¤§â€”â€”ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªä»å…¶ä»–æ•°æ®æ„å»ºçš„æ•°æ®ä»“åº“ï¼Œä»æŠ€æœ¯è®²å®Œå…¨æ˜¯å†—ä½™çš„ï¼Œå°±å¯ä»¥ä»…å¤‡ä»½æ„å»ºä»“åº“çš„æ•°æ®ï¼Œè€Œä¸æ˜¯æ•°æ®ä»“åº“æœ¬èº«ã€‚å³ä½¿ä»æºæ•°æ®æ–‡ä»¶é‡å»ºä»“åº“çš„â€œæ¢å¤â€æ—¶é—´è¾ƒé•¿ï¼Œè¿™ä¹Ÿæ˜¯ä¸ªå¥½æƒ³æ³•ã€‚ç›¸å¯¹äºä»å…¨å¤‡ä»½ä¸­å¯èƒ½è·å¾—çš„å¿«é€Ÿæ¢å¤æ—¶é—´ï¼Œé¿å…å¤‡ä»½å¯ä»¥èŠ‚çº¦æ›´å¤šçš„å®—çš„æ—¶é—´å¼€é”€ã€‚ä¸´æ—¶æ•°æ®ä¹Ÿå¯ä»¥ä¸ç”¨å¤‡ä»½ï¼Œä¾‹å¦‚ä¿ç•™ç½‘ç«™ä¼šè¯æ•°æ®çš„è¡¨ã€‚</li>
<li>å¤‡ä»½æ‰€æœ‰çš„æ•°æ®ï¼Œç„¶åå‘é€åˆ°ä¸€ä¸ªæœ‰å»é‡ç‰¹æ€§çš„ç›®çš„åœ°ï¼Œä¾‹å¦‚ZFSæ–‡ä»¶ç®¡ç†ç¨‹åºã€‚</li>
</ul>
<p>å¢é‡å¤‡ä»½çš„ç¼ºç‚¹åŒ…æ‹¬å¢åŠ æ¢å¤å¤æ‚æ€§ï¼Œé¢å¤–çš„é£é™©ï¼Œä»¥åŠæ›´é•¿çš„æ¢å¤æ—¶é—´ã€‚å¦‚æœå¯ä»¥åšå…¨å¤‡ï¼Œè€ƒè™‘åˆ°ç®€ä¾¿æ€§ï¼Œæˆ‘ä»¬å»ºè®®å°½é‡åšå…¨å¤‡ã€‚</p>
<p>ä¸ç®¡å¦‚ä½•ï¼Œè¿˜æ˜¯éœ€è¦ç»å¸¸åšå…¨å¤‡ä»½â€”â€”å»ºè®®è‡³å°‘ä¸€å‘¨ä¸€æ¬¡ã€‚ä½ è‚¯å®šä¸å¸Œæœ›ä½¿ç”¨ä¸€ä¸ªæœˆçš„æ‰€æœ‰å¢é‡å¤‡ä»½æ¥è¿›è¡Œæ¢å¤ã€‚å³ä½¿ä¸€å‘¨ä¹Ÿè¿˜æ˜¯æœ‰å¾ˆå¤šçš„å·¥ä½œå’Œé£é™©çš„ã€‚</p>
<h4 id="åœ¨çº¿ï¼ˆçƒ­ï¼‰å¤‡ä»½ã€æ¸©å¤‡ä»½ã€ç¦»çº¿ï¼ˆå†·ï¼‰å¤‡ä»½"><a href="#åœ¨çº¿ï¼ˆçƒ­ï¼‰å¤‡ä»½ã€æ¸©å¤‡ä»½ã€ç¦»çº¿ï¼ˆå†·ï¼‰å¤‡ä»½" class="headerlink" title="åœ¨çº¿ï¼ˆçƒ­ï¼‰å¤‡ä»½ã€æ¸©å¤‡ä»½ã€ç¦»çº¿ï¼ˆå†·ï¼‰å¤‡ä»½"></a>åœ¨çº¿ï¼ˆçƒ­ï¼‰å¤‡ä»½ã€æ¸©å¤‡ä»½ã€ç¦»çº¿ï¼ˆå†·ï¼‰å¤‡ä»½</h4><p>å¦‚æœå¯èƒ½ï¼Œå…³é—­MySQLåšå¤‡ä»½æ˜¯æœ€ç®€å•æœ€å®‰å…¨çš„ï¼Œä¹Ÿæ˜¯æ‰€æœ‰è·å–ä¸€è‡´æ€§å‰¯æœ¬çš„æ–¹æ³•ä¸­æœ€å¥½çš„ï¼Œè€Œä¸”æŸåæˆ–ä¸ä¸€è‡´çš„é£é™©æœ€å°ã€‚å¦‚æœå…³é—­äº†MySQLï¼Œå°±æ ¹æœ¬ä¸ç”¨å…³å¿ƒInnoDBç¼“å†²æ± ä¸­çš„è„é¡µæˆ–è¿™å…¶ä»–ç¼“å­˜ã€‚ä¹Ÿä¸éœ€è¦æ‹…å¿ƒæ•°æ®åœ¨å°è¯•å¤‡ä»½çš„è¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ï¼Œå¹¶ä¸”å› ä¸ºæœåŠ¡å™¨ä¸å¯¹åº”ç”¨æä¾›è®¿é—®ï¼Œæ‰€ä»¥å¯ä»¥æ›´å¿«åœ°å®Œæˆå¤‡ä»½ã€‚</p>
<p>å°½ç®¡å¦‚æ­¤ï¼Œè®©æœåŠ¡å™¨åœæœºçš„ä»£ä»·å¯èƒ½æ¯”çœ‹èµ·æ¥è¦æ›´æ˜‚è´µã€‚å³ä½¿èƒ½æœ€å°åŒ–åœæœºæ—¶é—´ï¼Œåœ¨é«˜è´Ÿè½½å’Œé«˜æ•°æ®é‡ä¸‹å…³é—­å’Œé‡å¯MySQLä¹Ÿå¯èƒ½è¦èŠ±å¾ˆé•¿ä¸€æ®µæ—¶é—´ã€‚å› æ­¤ï¼Œå¿…é¡»è¦è®¾è®¡ä¸éœ€è¦ç”Ÿäº§æœåŠ¡å™¨åœæœºçš„å¤‡ä»½ã€‚å³ä¾¿å¦‚æ­¤ï¼Œç”±äºä¸€è‡´æ€§çš„éœ€è¦ï¼Œå¯¹æœåŠ¡å™¨è¿›è¡Œåœ¨çº¿å¤‡ä»½ä»ç„¶ä¼šæœ‰æ˜æ˜¾çš„æœåŠ¡ä¸­æ–­ã€‚</p>
<ul>
<li>ç¦»çº¿ï¼ˆå†·ï¼‰å¤‡ä»½:å¤‡ä»½è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡ä¸­æ–­</li>
<li>æ¸©å¤‡ä»½ï¼šå¤‡ä»½è¿‡ç¨‹ä¸­ï¼Œåªèƒ½è¯»ä¸èƒ½å†™</li>
<li>åœ¨çº¿ï¼ˆçƒ­ï¼‰å¤‡ä»½ï¼šå¤‡ä»½è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡æ­£å¸¸ä½¿ç”¨</li>
</ul>
<p>åœ¨è§„åˆ’å¤‡ä»½æ—¶ï¼Œæœ‰ä¸€äº›ä¸æ€§èƒ½ç›¸å…³çš„å› ç´ éœ€è¦è€ƒè™‘ã€‚</p>
<ul>
<li>é”æ—¶é—´ï¼šéœ€è¦æŒæœ‰é”å¤šé•¿æ—¶é—´ï¼Œä¾‹å¦‚åœ¨å¤‡ä»½æœŸé—´æŒæœ‰çš„å…¨å±€ <code>flush tables with read lock</code>?</li>
<li>å¤‡ä»½æ—¶é—´ï¼šå¤åˆ¶å¤‡ä»½åˆ°ç›®çš„åœ°éœ€è¦å¤šä¹…ï¼Ÿ</li>
<li>å¤‡ä»½è´Ÿè½½ï¼šåœ¨å¤åˆ¶å¤‡ä»½åˆ°ç›®çš„åœ°æ—¶å¯¹æœåŠ¡å™¨æ€§èƒ½çš„å½±å“æœ‰å¤šå°‘ï¼Ÿ</li>
<li>æ¢å¤æ—¶é—´ï¼šæŠŠå¤‡ä»½é•œåƒä»å­˜å‚¨ä½ç½®å¤åˆ¶åˆ°MySQLæœåŠ¡å™¨ï¼Œé‡æ”¾äºŒè¿›åˆ¶æ—¥å¿—ç­‰ï¼Œéœ€è¦å¤šä¹…ï¼Ÿ</li>
</ul>
<p>æœ€å¤§çš„æƒè¡¡æ—¶å¤‡ä»½æ—¶é—´ä¸å¤‡ä»½è´Ÿè½½ã€‚å¯ä»¥ç‰ºç‰²å…¶ä¸€ä»¥å¢åŠ å¦å¤–ä¸€ä¸ªã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æé«˜å¤‡ä»½çš„ä¼˜å…ˆçº§ï¼Œä»£ä»·æ˜¯é™ä½æœåŠ¡å™¨æ€§èƒ½ã€‚åŒæ ·ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨è´Ÿè½½çš„ç‰¹æ€§æ¥è®¾è®¡å¤‡ä»½ã€‚</p>
<h3 id="å¤‡ä»½å’Œæ¢å¤å·¥å…·"><a href="#å¤‡ä»½å’Œæ¢å¤å·¥å…·" class="headerlink" title="å¤‡ä»½å’Œæ¢å¤å·¥å…·"></a>å¤‡ä»½å’Œæ¢å¤å·¥å…·</h3><p>1) ç‰©ç†å¤‡ä»½ï¼šcp tar lvmå¿«ç…§æ–¹å¼</p>
<p>2) é€»è¾‘å¤‡ä»½ï¼šmysqldump</p>
<h4 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h4><h5 id="tarå¤‡ä»½æ­¥éª¤"><a href="#tarå¤‡ä»½æ­¥éª¤" class="headerlink" title="tarå¤‡ä»½æ­¥éª¤"></a>tarå¤‡ä»½æ­¥éª¤</h5><ul>
<li>1ï¼‰åœæ­¢æœåŠ¡ systemctl stop mariadb</li>
<li>2ï¼‰å¤‡ä»½æ•°æ® tar -cf /tmp/mysql.all.tar /var/lib/mysql</li>
<li>3ï¼‰å¯åŠ¨æœåŠ¡ systemctl start mariadb</li>
</ul>
<h5 id="tarè¿˜åŸæ­¥éª¤"><a href="#tarè¿˜åŸæ­¥éª¤" class="headerlink" title="tarè¿˜åŸæ­¥éª¤"></a>tarè¿˜åŸæ­¥éª¤</h5><ul>
<li>1ï¼‰åœæ­¢æœåŠ¡ systemctl stop mariadb</li>
<li>2ï¼‰æ¸…ç¯å¢ƒ   rm -rf /var/lib/mysql/*</li>
<li>3ï¼‰å¯¼å…¥æ•°æ® tar -xf /tmp/mysql.all.tar -C /</li>
<li>4ï¼‰å¯åŠ¨æœåŠ¡ systemctl start mariadb</li>
<li>5ï¼‰æµ‹è¯•      &gt; select * from db1.t1;</li>
</ul>
<h5 id="è¯¾å ‚å®æˆ˜1-åˆ©ç”¨tarå®ç°ç‰©ç†å¤‡ä»½å¹¶è¿˜åŸ"><a href="#è¯¾å ‚å®æˆ˜1-åˆ©ç”¨tarå®ç°ç‰©ç†å¤‡ä»½å¹¶è¿˜åŸ" class="headerlink" title="è¯¾å ‚å®æˆ˜1: åˆ©ç”¨tarå®ç°ç‰©ç†å¤‡ä»½å¹¶è¿˜åŸ"></a>è¯¾å ‚å®æˆ˜1: åˆ©ç”¨tarå®ç°ç‰©ç†å¤‡ä»½å¹¶è¿˜åŸ</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¤‡ä»½</span></span><br><span class="line">[root@mastera0 ~]# systemctl stop mariadb</span><br><span class="line">[root@mastera0 ~]# tar -cf /tmp/mysql.all.tar /var/lib/mysql/</span><br><span class="line">tar: Removing leading \`/\' from member names</span><br><span class="line">[root@mastera0 ~]# systemctl start mariadb</span><br><span class="line">[root@mastera0 ~]# ll /tmp</span><br><span class="line">total 29772</span><br><span class="line">-rw-r--r--. 1 root root 30484480 Aug 30 11:28 mysql.all.tar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿˜åŸ</span></span><br><span class="line">[root@mastera0 ~]# systemctl stop mariadb</span><br><span class="line">ot@mastera0 ~]# rm -rf /var/lib/mysql/*</span><br><span class="line">[root@mastera0 ~]# ll /var/lib/mysql</span><br><span class="line">total 0</span><br><span class="line">[root@mastera0 ~]# tar -xf /tmp/mysql.all.tar -C /</span><br><span class="line">[root@mastera0 ~]# ll /var/lib/mysql</span><br><span class="line">total 28700</span><br><span class="line">-rw-rw----. 1 mysql mysql    16384 Aug 30 11:27 aria_log.00000001</span><br><span class="line">-rw-rw----. 1 mysql mysql       52 Aug 30 11:27 aria_log_control</span><br><span class="line">drwx------. 2 mysql mysql       32 Aug 30 11:24 db1</span><br><span class="line">-rw-rw----. 1 mysql mysql 18874368 Aug 30 11:27 ibdata1</span><br><span class="line">-rw-rw----. 1 mysql mysql  5242880 Aug 30 11:27 ib_logfile0</span><br><span class="line">-rw-rw----. 1 mysql mysql  5242880 Aug 30 11:23 ib_logfile1</span><br><span class="line">drwx------. 2 mysql mysql     4096 Aug 30 11:23 mysql</span><br><span class="line">drwx------. 2 mysql mysql     4096 Aug 30 11:23 performance_schema</span><br><span class="line">drwx------. 2 mysql mysql        6 Aug 30 11:23 test</span><br><span class="line">[root@mastera0 ~]# systemctl start mariadb</span><br><span class="line">[root@mastera0 ~]# echo \"select * from db1.t1\"|mysql -uroot -puplooking</span><br><span class="line">id</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<h4 id="LVM-SnapShot"><a href="#LVM-SnapShot" class="headerlink" title="LVM SnapShot"></a>LVM SnapShot</h4><h5 id="lvmå¿«ç…§çš„ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#lvmå¿«ç…§çš„ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="lvmå¿«ç…§çš„ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>lvmå¿«ç…§çš„ä¼˜ç‚¹å’Œç¼ºç‚¹</h5><p>äº‹å®ä¸Š,MySQL æ•°æ®åº“çš„å¤‡ä»½æ˜¯ä¸€ä¸ªè®©ç®¡ç†å‘˜ä¸€ç›´å¾ˆå¤´ç–¼çš„é—®é¢˜ã€‚å„ç§å·¥ä½œ<br>è™½ ç„¶ ä¸ å°‘ ,ä½†æ˜¯ å„ æœ‰ä¼˜ åŠ£ , æƒ³æ‰¾ åˆ°ä¸€ä¸ª æ¯”è¾ƒ å®Œ ç¾ çš„æ–¹ æ³• å´ éå¸¸ å›° éš¾ ã€‚<br>Mysqldump ä½œä¸ºæ•°æ®çš„é€»è¾‘å¤‡ä»½å·¥å…·,å¼±ç‚¹åœ¨äºæ— æ³•è¿›è¡Œåœ¨çº¿çƒ­å¤‡,åŒæ—¶åœ¨æ•°<br>æ®åº“æ¯”è¾ƒå¤§çš„æ—¶å€™,å¤‡ä»½å’Œæ¢å¤çš„æ—¶é—´æ˜¯åœ¨é•¿å¾—è®©äººæ— æ³•æ¥å—ã€‚Mysqlhotcopy<br>è™½ç„¶å…‹æœäº†æ™®é€šç³»ç»Ÿå‘½ä»¤å¤‡ä»½å¿…é¡»å…³é—­ mysql æœåŠ¡çš„å°´å°¬,ä½†æ˜¯è¿™ä¸œè¥¿åªèƒ½ç”¨<br>äºå¤‡ä»½ä½¿ç”¨ MYISAM å­˜å‚¨å¼•æ“çš„æ•°æ®è¡¨,å¹¶ä¸”åªèƒ½åœ¨ç±» UNIX ç¯å¢ƒä¸­ä½¿ç”¨ã€‚å¦‚æœ<br>ä½¿ç”¨ mysql replication çš„è¯,å€’æ˜¯å¯ä»¥è§£å†³çƒ­å¤‡é—®é¢˜ã€‚ä½†æ˜¯ä½ éœ€è¦æ‰¿æ‹…å¢åŠ <br>ä¸€å°æœåŠ¡å™¨çš„æˆæœ¬ã€‚åŒæ—¶,å¦‚æœæ•°æ®è¢«æ— æ„æˆ–æ¶æ„çš„ç¯¡æ”¹ã€åˆ é™¤,é‚£ä¹ˆ slave<br>æœåŠ¡å™¨ä¸Šçš„æ•°æ®åŒæ ·ä¸èƒ½å¹¸å…ã€‚<br>ç›¸å¯¹äºä»¥ä¸Šæ–¹æ³•,åœ¨ä¸­ã€å¤§è§„æ¨¡çš„ MySQL åº”ç”¨ç¯å¢ƒä¸­,æˆ‘æ¨èä½¿ç”¨ LVM å¿«<br>ç…§çš„æ–¹å¼æ¥åˆ¶ä½œå¤‡ä»½ã€‚ä¸ºä»€ä¹ˆè¿™ç§æ–¹å¼æ¯”è¾ƒå¥½å‘¢?</p>
<p>åŸå› å¦‚ä¸‹:</p>
<p>1ã€ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹,è¿™ç§æ–¹å¼å‡ ä¹ç®—å¾—ä¸Šæ˜¯çƒ­å¤‡ã€‚å®ƒæ— éœ€å…³é—­æœåŠ¡,<br>åªéœ€è¦è®¾ç½®åªè¯»æˆ–è€…ç±»ä¼¼è¿™æ ·çš„é™åˆ¶ã€‚<br>2ã€ æ”¯æŒæ‰€æœ‰åŸºäºæœ¬åœ°ç£ç›˜çš„å­˜å‚¨å¼•æ“,æ¯”å¦‚ MYISAMã€InnoDB å’Œ BDB,<br>è¿˜æ”¯æŒ Solidã€PrimeXT å’Œ Factionã€‚<br>3ã€ å¤‡ä»½é€Ÿåº¦æœ€å¿«,å› ä¸ºä½ åªéœ€è¦æ‹·è´ç›¸å…³çš„äºŒè¿›åˆ¶æ•°æ®æ–‡ä»¶å³å¯ã€‚<br>4ã€ ç”±äºåªæ˜¯ç®€å•çš„æ‹·è´æ–‡ä»¶,å› æ­¤å¯¹æœåŠ¡å™¨å¼€é”€éå¸¸ä½ã€‚<br>5ã€ ä¿å­˜æ–¹å¼å¤šç§å¤šæ ·,ä½ å¯ä»¥å¤‡ä»½åˆ°ç£å¸¦ä¸Šã€FTP æœåŠ¡å™¨ä¸Šã€NFS æœåŠ¡<br>å™¨ä¸Šæˆ–è€…å…¶ä»–ä»€ä¹ˆç½‘ç»œæœåŠ¡å™¨,ä»¥åŠä½¿ç”¨å„ç§ç½‘ç»œå¤‡ä»½è½¯ä»¶æ¥å¤‡ä»½ã€‚<br>åšåˆ°è¿™äº›å¾ˆç®€å•,è¯´åˆ°åº•å°±æ˜¯æ‹·è´æ–‡ä»¶è€Œå·²ã€‚<br>6ã€ æ¢å¤é€Ÿåº¦å¾ˆå¿«ã€‚æ¢å¤æ‰€éœ€è¦çš„æ—¶é—´ç­‰äºä½ æŠŠæ•°æ®æ‹·è´å›æ¥çš„æ—¶é—´ã€‚<br>ä½ å¯ä»¥æƒ³å‡ºæ›´å¤šçš„æ–¹æ³•è®©è¿™ä¸ªæ—¶é—´å˜å¾—æ›´çŸ­ã€‚<br>7ã€<br>æ— éœ€ä½¿ç”¨æ˜‚è´µçš„å•†ä¸šè½¯ä»¶ã€‚</p>
<p>å½“ç„¶,æ¯ä¸ªäº‹ç‰©éƒ½æœ‰å…¶ä¸¤é¢æ€§,å®ƒä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹:<br>1ã€ å¾ˆæ˜æ˜¾,ä½ çš„ç³»ç»Ÿéœ€è¦æ”¯æŒå¿«ç…§ã€‚<br>2ã€ åœ¨ä¸€äº›å…¬å¸é‡Œ,ç³»ç»Ÿç®¡ç†å‘˜å’Œ DBA å±äºä¸åŒçš„å›¢é˜Ÿã€‚è€Œä½¿ç”¨å¿«ç…§éœ€è¦<br>ç³»ç»Ÿ root æƒé™ã€‚å› æ­¤,ä½ å¯èƒ½éœ€è¦åšä¸€äº›å›¢é˜Ÿåè°ƒå·¥ä½œæˆ–è€…å¹²è„†åœ¨<br>DBA Team é‡Œå®‰æ’ä¸€ä¸ªç³»ç»Ÿç®¡ç†å‘˜ã€‚è¿™ç§äº‹åœ¨æŸäº›å…¬å¸å¾ˆå®¹æ˜“,ä½†ä¹Ÿ<br>å¯èƒ½å¾ˆéº»çƒ¦ã€‚<br>3ã€ æ— æ³•ç¡®åˆ‡çš„é¢„è®¡æœåŠ¡åœæ­¢æ—¶é—´ã€‚å› ä¸º,è¿™ç§æ–¹æ³•åˆ°åº•ä»€ä¹ˆæ—¶å€™ç®—çƒ­å¤‡<br>ä»€ä¹ˆæ—¶å€™ä¸ç®—,å®Œå…¨å–å†³äº FLUSH TABLE WITH READ LOCK å‘½ä»¤æ‰§è¡Œ<br>æ—¶é—´çš„é•¿çŸ­ã€‚å› æ­¤,æˆ‘è¿˜æ˜¯å»ºè®®ä½ åœ¨å‡Œæ™¨å¹²è¿™ä»¶äº‹æƒ…ã€‚æˆ–è€…å¹²è„†å®šä¸‹<br>ä¸€ä¸ªç»´æŠ¤æ—¶é—´æ®µ(æ¯”å¦‚æŸäº›ç½‘ç»œæ¸¸æˆè¿è¥å•†çš„åšæ³•)ã€‚<br>4ã€ å¦‚æœä½ æŠŠæ—¥å¿—æ”¾åœ¨ç‹¬ç«‹çš„è®¾å¤‡ä¸Šæˆ–è€…ä½ çš„æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªå·ä¸Š,é‚£ä¹ˆ<br>å°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚å› ä¸ºè¿™æ ·ä¸€æ¥ä½ å°±æ— æ³•å¾—åˆ°å…¨éƒ¨æ•°æ®çš„ä¸€è‡´æ€§å¿«ç…§,<br>è¿™å°±æ˜¯æ‰€è°“çš„å¤šå·ä¸Šçš„æ•°æ®é—®é¢˜ã€‚ä¸è¿‡,æœ‰äº›ç³»ç»Ÿå¯èƒ½è‡ªåŠ¨åšåˆ°å¤šå·<br>å¿«ç…§ã€‚</p>
<p>ç°åœ¨,æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚æœä½¿ç”¨ LVM çš„å¿«ç…§åŠŸèƒ½æ¥åˆ¶ä½œ MySQL å¤‡ä»½ã€‚<br>å½“ç„¶,é¦–å…ˆæˆ‘ä»¬å‡†å¤‡å¥½ç›¸åº”çš„ç¯å¢ƒã€‚é…ç½®ä¸€ä¸ª LVM,å¹¶ä¸”åˆ’åˆ†åˆé€‚å¤§å°çš„<br>LV,å¹¶ä¸”å°†å…¶æŒ‚è½½åˆ° MySQL çš„æ•°æ®æ–‡ä»¶ç›®å½•ä¸Šã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­,ä½ å¯ä»¥çœ‹åˆ°æˆ‘<br>å·²ç»å»ºç«‹å¥½äº†ä¸€ä¸ªåå« db1 çš„æ•°æ®åº“,å¹¶ä¸”é‡Œé¢åŒ…å«ä¸€ä¸ªå«åš t1 çš„è¡¨,<br>å¹¶ä¸”å·²ç»å†™å…¥äº†ä¸€äº›æ•°æ®ã€‚</p>
<p>/var/lib/mysql/â€”&gt;lv â€”-&gt;snapshot</p>
<p>/dev/vdbâ€”fdiskâ€”/dev/vdb1 1Gâ€”-&gt;mkfs.ext4â€”&gt;ç›®å½•æ ‘</p>
<p>/dev/vdbâ€”fdiskâ€”/dev/vdb1 1Gâ€“pvâ€“vgâ€“lvâ€”&gt;mkfs.ext4â€”&gt;ç›®å½•æ ‘</p>
<h5 id="osæ”¯æŒlvmæ–¹å¼-lv1â€”-var-lib-mysql"><a href="#osæ”¯æŒlvmæ–¹å¼-lv1â€”-var-lib-mysql" class="headerlink" title="osæ”¯æŒlvmæ–¹å¼ lv1â€”/var/lib/mysql"></a>osæ”¯æŒlvmæ–¹å¼ lv1â€”/var/lib/mysql</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1)fdisk</span><br><span class="line">2)pv</span><br><span class="line">3)vg</span><br><span class="line">4)lv</span><br><span class="line">5)mkfs ext4 (xfs)</span><br><span class="line">6)åœæ­¢æœåŠ¡</span><br><span class="line">7)å…¨å¤‡ä»½tar</span><br><span class="line">8)æŒ‚æ¥&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;</span><br><span class="line">9)å¯¼å…¥æ•°æ®(æ³¨æ„æƒé™ï¼Œugoï¼Œselinux)</span><br><span class="line">10)å¯åŠ¨æœåŠ¡</span><br></pre></td></tr></table></figure>

<h5 id="lvmå¿«ç…§å¤‡ä»½æ•°æ®"><a href="#lvmå¿«ç…§å¤‡ä»½æ•°æ®" class="headerlink" title="lvmå¿«ç…§å¤‡ä»½æ•°æ®"></a>lvmå¿«ç…§å¤‡ä»½æ•°æ®</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä¸æ•°æ®åº“æœåŠ¡ç›¸å…³çš„æ“ä½œ</span><br><span class="line">	1)æ·»åŠ å…¨å±€çš„è¯»é”ï¼ˆåªèƒ½è¯»ä¸èƒ½å†™---ã€‹æ•°æ®ä¸ä¼šå˜ï¼‰&gt; flush tables with read lock;</span><br><span class="line">	2)åˆ›å»ºå¿«ç…§	lvcreate -s -L 1G -n snap1 &#x2F;dev&#x2F;vgmysql&#x2F;lv1 ---&gt;&#x2F;dev&#x2F;vgmysql&#x2F;snap1</span><br><span class="line">	3)è§£é”		&gt; unlock tables;</span><br><span class="line"></span><br><span class="line"># ä¸æ•°æ®åº“æœåŠ¡æ— å…³çš„æ“ä½œ</span><br><span class="line">	4)æŒ‚æ¥å¿«ç…§	mount &#x2F;dev&#x2F;vgmysql&#x2F;snap1 &#x2F;mnt (å¦‚æœæ˜¯xfsï¼Œmount -o nouuid &#x2F;dev&#x2F;vgmysql&#x2F;snap1 &#x2F;mnt )</span><br><span class="line">	5)taræ‰“åŒ…	cd &#x2F;mnt;tar -cf &#x2F;tmp&#x2F;mysql.2.tar .&#x2F;*</span><br><span class="line">	6)umount	umount &#x2F;mnt</span><br><span class="line">	7)åˆ é™¤å¿«ç…§	lvremove &#x2F;dev&#x2F;vgmysql&#x2F;snap1</span><br></pre></td></tr></table></figure>

<h5 id="lvmå¿«ç…§è¿˜åŸæ•°æ®"><a href="#lvmå¿«ç…§è¿˜åŸæ•°æ®" class="headerlink" title="lvmå¿«ç…§è¿˜åŸæ•°æ®"></a>lvmå¿«ç…§è¿˜åŸæ•°æ®</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1ï¼‰åœæ­¢æœåŠ¡ systemctl stop mariadb</span><br><span class="line">2ï¼‰æ¸…ç¯å¢ƒ   rm -rf &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;*</span><br><span class="line">3ï¼‰å¯¼å…¥æ•°æ® tar -xf &#x2F;tmp&#x2F;mysql.2.tar -C &#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">4ï¼‰å¯åŠ¨æœåŠ¡ systemctl start mariadb</span><br><span class="line">5ï¼‰æµ‹è¯•	  &gt; select * from db1.t1;</span><br></pre></td></tr></table></figure>

<h5 id="è¯¾å ‚å®æˆ˜2-åˆ©ç”¨LVMå¿«ç…§å®ç°ç‰©ç†å¤‡ä»½å¹¶è¿˜åŸ"><a href="#è¯¾å ‚å®æˆ˜2-åˆ©ç”¨LVMå¿«ç…§å®ç°ç‰©ç†å¤‡ä»½å¹¶è¿˜åŸ" class="headerlink" title="è¯¾å ‚å®æˆ˜2: åˆ©ç”¨LVMå¿«ç…§å®ç°ç‰©ç†å¤‡ä»½å¹¶è¿˜åŸ"></a>è¯¾å ‚å®æˆ˜2: åˆ©ç”¨LVMå¿«ç…§å®ç°ç‰©ç†å¤‡ä»½å¹¶è¿˜åŸ</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> lv1--&gt;/var/lib/mysql</span></span><br><span class="line">[root@mastera0 mysql]# fdisk -l</span><br><span class="line"></span><br><span class="line">Disk /dev/vda: 10.7 GB, 10737418240 bytes, 20971520 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x000deb17</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/vda1   *        2048      411647      204800   83  Linux</span><br><span class="line">/dev/vda2          411648    20971519    10279936   8e  Linux LVM</span><br><span class="line"></span><br><span class="line">Disk /dev/vdb: 21.5 GB, 21474836480 bytes, 41943040 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/rhel-root: 9458 MB, 9458155520 bytes, 18472960 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/rhel-swap: 536 MB, 536870912 bytes, 1048576 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/rhel-home: 524 MB, 524288000 bytes, 1024000 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]#</span><br><span class="line">[root@mastera0 mysql]# fdisk /dev/vdb</span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain in memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table</span><br><span class="line">Building a new DOS disklabel with disk identifier 0xb9ec589f.</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p</span><br><span class="line">Partition number (1-4, default 1): 1</span><br><span class="line">First sector (2048-41943039, default 2048):</span><br><span class="line">Using default value 2048</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-41943039, default 41943039): +1G</span><br><span class="line">Partition 1 of type Linux and of size 1 GiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (1 primary, 0 extended, 3 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p</span><br><span class="line">Partition number (2-4, default 2): 2</span><br><span class="line">First sector (2099200-41943039, default 2099200):</span><br><span class="line">Using default value 2099200</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2099200-41943039, default 41943039): +1G</span><br><span class="line">Partition 2 of type Linux and of size 1 GiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/vdb: 21.5 GB, 21474836480 bytes, 41943040 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0xb9ec589f</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/vdb1            2048     2099199     1048576   83  Linux</span><br><span class="line">/dev/vdb2         2099200     4196351     1048576   83  Linux</span><br><span class="line"></span><br><span class="line">Command (m for help): w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br><span class="line">[root@mastera0 mysql]# ls /dev/vdb*</span><br><span class="line">/dev/vdb  /dev/vdb1  /dev/vdb2</span><br><span class="line">[root@mastera0 mysql]# pvcreate /dev/vdb&#123;1,2&#125;</span><br><span class="line">  Physical volume \"/dev/vdb1\" successfully created</span><br><span class="line">  Physical volume \"/dev/vdb2\" successfully created</span><br><span class="line">[root@mastera0 mysql]# vgcreate vgmysql /dev/vdb&#123;1,2&#125;</span><br><span class="line">  Volume group \"vgmysql\" successfully created</span><br><span class="line">[root@mastera0 mysql]# lvcreate -L 1G -n lv1 vgmysql</span><br><span class="line">  Logical volume \"lv1\" created.</span><br><span class="line">[root@mastera0 mysql]# lvs</span><br><span class="line">  LV   VG      Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  home rhel    -wi-ao---- 500.00m                                                    </span><br><span class="line">  root rhel    -wi-ao----   8.81g                                                    </span><br><span class="line">  swap rhel    -wi-ao---- 512.00m                                                    </span><br><span class="line">  lv1  vgmysql -wi-a-----   1.00g                                                    </span><br><span class="line">[root@mastera0 mysql]# mkfs.ext4 /dev/vgmysql/lv1</span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS type: Linux</span><br><span class="line">Block size=4096 (log=2)</span><br><span class="line">Fragment size=4096 (log=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">65536 inodes, 262144 blocks</span><br><span class="line">13107 blocks (5.00%) reserved for the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=268435456</span><br><span class="line">8 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8192 inodes per group</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">	32768, 98304, 163840, 229376</span><br><span class="line"></span><br><span class="line">Allocating group tables: done                            </span><br><span class="line">Writing inode tables: done                            </span><br><span class="line">Creating journal (8192 blocks): done</span><br><span class="line">Writing superblocks and filesystem accounting information: done</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]#</span><br><span class="line">[root@mastera0 mysql]# systemctl stop mariadb</span><br><span class="line">[root@mastera0 mysql]# tar -cf /tmp/mysql.1.tar /var/lib/mysql/</span><br><span class="line">tar: Removing leading \`/\' from member names</span><br><span class="line">[root@mastera0 mysql]# mount /dev/vgmysql/lv1 /var/lib/mysql^C</span><br><span class="line">[root@mastera0 mysql]# ll -dZ /var/lib/mysql</span><br><span class="line">drwxr-xr-x. mysql mysql system_u:object_r:mysqld_db_t:s0 /var/lib/mysql</span><br><span class="line">[root@mastera0 mysql]# mount /dev/vgmysql/lv1 /var/lib/mysql</span><br><span class="line">[root@mastera0 mysql]# ll -dZ /var/lib/mysql</span><br><span class="line">drwxr-xr-x. root root system_u:object_r:unlabeled_t:s0 /var/lib/mysql</span><br><span class="line">[root@mastera0 mysql]# ll  /var/lib/mysql</span><br><span class="line">total 16</span><br><span class="line">drwx------. 2 root root 16384 Aug 30 13:57 lost+found</span><br><span class="line">[root@mastera0 ~]# ll -d /var/lib/mysql</span><br><span class="line">drwxr-xr-x. 3 root root 4096 Aug 30 13:57 /var/lib/mysql</span><br><span class="line">[root@mastera0 ~]# tar -xf /tmp/mysql.1.tar -C /</span><br><span class="line">[root@mastera0 ~]# ll -d /var/lib/mysql</span><br><span class="line">drwxr-xr-x. 7 mysql mysql 4096 Aug 30 14:01 /var/lib/mysql</span><br><span class="line">[root@mastera0 ~]# ll  /var/lib/mysql</span><br><span class="line">total 28724</span><br><span class="line">-rw-rw----. 1 mysql mysql    16384 Aug 30 14:01 aria_log.00000001</span><br><span class="line">-rw-rw----. 1 mysql mysql       52 Aug 30 14:01 aria_log_control</span><br><span class="line">drwx------. 2 mysql mysql     4096 Aug 30 11:24 db1</span><br><span class="line">-rw-rw----. 1 mysql mysql 18874368 Aug 30 14:01 ibdata1</span><br><span class="line">-rw-rw----. 1 mysql mysql  5242880 Aug 30 14:01 ib_logfile0</span><br><span class="line">-rw-rw----. 1 mysql mysql  5242880 Aug 30 11:23 ib_logfile1</span><br><span class="line">drwx------. 2 root  root     16384 Aug 30 13:57 lost+found</span><br><span class="line">drwx------. 2 mysql mysql     4096 Aug 30 11:23 mysql</span><br><span class="line">drwx------. 2 mysql mysql     4096 Aug 30 11:23 performance_schema</span><br><span class="line">drwx------. 2 mysql mysql     4096 Aug 30 11:23 test</span><br><span class="line">[root@mastera0 ~]# systemctl start mariadb</span><br><span class="line">Job for mariadb.service failed because the control process exited with error code. See "systemctl status mariadb.service" and "journalctl -xe" for details.</span><br><span class="line">[root@mastera0 ~]# setenforce 0</span><br><span class="line">[root@mastera0 ~]# systemctl start mariadb</span><br><span class="line">[root@mastera0 ~]# ll  /var/lib/mysql -Z</span><br><span class="line">-rw-rw----. mysql mysql unconfined_u:object_r:unlabeled_t:s0 aria_log.00000001</span><br><span class="line">-rw-rw----. mysql mysql unconfined_u:object_r:unlabeled_t:s0 aria_log_control</span><br><span class="line">drwx------. mysql mysql unconfined_u:object_r:unlabeled_t:s0 db1</span><br><span class="line">-rw-rw----. mysql mysql unconfined_u:object_r:unlabeled_t:s0 ibdata1</span><br><span class="line">-rw-rw----. mysql mysql unconfined_u:object_r:unlabeled_t:s0 ib_logfile0</span><br><span class="line">-rw-rw----. mysql mysql unconfined_u:object_r:unlabeled_t:s0 ib_logfile1</span><br><span class="line">drwx------. root  root  system_u:object_r:unlabeled_t:s0 lost+found</span><br><span class="line">drwx------. mysql mysql unconfined_u:object_r:unlabeled_t:s0 mysql</span><br><span class="line">srwxrwxrwx. mysql mysql system_u:object_r:unlabeled_t:s0 mysql.sock</span><br><span class="line">drwx------. mysql mysql unconfined_u:object_r:unlabeled_t:s0 performance_schema</span><br><span class="line">drwx------. mysql mysql unconfined_u:object_r:unlabeled_t:s0 test</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> lvmå¿«ç…§å¤‡ä»½</span></span><br><span class="line">MariaDB [(none)]&gt; flush tables with read lock;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ•°æ®åº“åŠ ä¸Šå…¨å±€è¯»é”åï¼Œç«‹åˆ»åœ¨æ–°ç»ˆç«¯ä¸­åˆ›å»ºå¿«ç…§</span></span></span><br><span class="line">[root@mastera0 ~]# lvcreate -s -L 500M -n snap1 /dev/vgmysql/lv1</span><br><span class="line">  Logical volume "snap1" created.</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># å¿«ç…§åˆ›å»ºä¹‹åï¼Œè§£é”ï¼ŒæœåŠ¡å¯ä»¥æ­£å¸¸é€‚ç”¨äº†</span></span></span><br><span class="line">MariaDB [(none)]&gt; unlock tables;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æŒ‚æ¥å¿«ç…§ä½¿ç”¨</span></span></span><br><span class="line">[root@mastera0 ~]# mount /dev/vgmysql/snap1 /mnt</span><br><span class="line">[root@mastera0 ~]# ls /mnt</span><br><span class="line">aria_log.00000001  db1      ib_logfile0  lost+found  mysql.sock          test</span><br><span class="line">aria_log_control   ibdata1  ib_logfile1  mysql       performance_schema</span><br><span class="line">[root@mastera0 ~]# cd /mnt</span><br><span class="line">[root@mastera0 mnt]# tar -cf /tmp/mysql.2.tar ./*</span><br><span class="line">tar: ./mysql.sock: socket ignored</span><br><span class="line">[root@mastera0 mnt]# ll /tmp</span><br><span class="line">total 89316</span><br><span class="line">drwxr-xr-x. 2 root root        6 Aug 30 11:31 a</span><br><span class="line">-rw-r--r--. 1 root root 30484480 Aug 30 14:01 mysql.1.tar</span><br><span class="line">-rw-r--r--. 1 root root 30484480 Aug 30 14:58 mysql.2.tar</span><br><span class="line">-rw-r--r--. 1 root root 30484480 Aug 30 11:28 mysql.all.tar</span><br><span class="line">[root@mastera0 mnt]# cd</span><br><span class="line">[root@mastera0 ~]# umount /mnt</span><br><span class="line">[root@mastera0 ~]# lv</span><br><span class="line">lvchange     lvdisplay    lvmchange    lvmdiskscan  lvmpolld     lvreduce     lvresize</span><br><span class="line">lvconvert    lvextend     lvmconf      lvmdump      lvmsadc      lvremove     lvs</span><br><span class="line">lvcreate     lvm          lvmconfig    lvmetad      lvmsar       lvrename     lvscan</span><br><span class="line">[root@mastera0 ~]# lvremove /dev/vgmysql/snap1</span><br><span class="line">Do you really want to remove active logical volume snap1? [y/n]: y</span><br><span class="line">  Logical volume "snap1" successfully removed</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿˜åŸæ•°æ®</span></span><br><span class="line">[root@mastera0 ~]# systemctl stop mariadb</span><br><span class="line">[root@mastera0 ~]# rm -rf /var/lib/mysql/*</span><br><span class="line">[root@mastera0 ~]# tar -xf /tmp/mysql.2.tar -C /var/lib/mysql</span><br><span class="line">[root@mastera0 ~]# ll /var/lib/mysql</span><br><span class="line">total 28712</span><br><span class="line">-rw-rw----. 1 mysql mysql    16384 Aug 30 14:01 aria_log.00000001</span><br><span class="line">-rw-rw----. 1 mysql mysql       52 Aug 30 14:01 aria_log_control</span><br><span class="line">drwx------. 2 mysql mysql     4096 Aug 30 11:24 db1</span><br><span class="line">-rw-rw----. 1 mysql mysql 18874368 Aug 30 14:42 ibdata1</span><br><span class="line">-rw-rw----. 1 mysql mysql  5242880 Aug 30 14:42 ib_logfile0</span><br><span class="line">-rw-rw----. 1 mysql mysql  5242880 Aug 30 11:23 ib_logfile1</span><br><span class="line">drwx------. 2 root  root      4096 Aug 30 13:57 lost+found</span><br><span class="line">drwx------. 2 mysql mysql     4096 Aug 30 11:23 mysql</span><br><span class="line">drwx------. 2 mysql mysql     4096 Aug 30 11:23 performance_schema</span><br><span class="line">drwx------. 2 mysql mysql     4096 Aug 30 11:23 test</span><br><span class="line">[root@mastera0 ~]# systemctl start mariadb</span><br><span class="line">[root@mastera0 ~]# echo "select * from db1.t1" | mysql -uroot -puplooking</span><br><span class="line">id</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure>



<h4 id="mysqldump"><a href="#mysqldump" class="headerlink" title="mysqldump"></a>mysqldump</h4><p>é€»è¾‘å¤‡ä»½å’Œç‰©ç†å¤‡ä»½å„æœ‰ä¼˜ç¼ºç‚¹,é€»è¾‘å¤‡ä»½ä¿å­˜çš„æ˜¯ SQL æ–‡æœ¬,å¯ä»¥åœ¨å„ç§æ¡ä»¶ä¸‹æ¢<br>å¤,ä½†æ˜¯å¯¹äºå¤§æ•°æ®é‡çš„ç³»ç»Ÿ,å¤‡ä»½å’Œæ¢å¤çš„æ—¶é—´éƒ½æ¯”è¾ƒé•¿;ç‰©ç†å¤‡ä»½æ°æ°ç›¸å,ç”±äºæ˜¯æ–‡<br>ä»¶çš„ç‰©ç† cp,å¤‡ä»½å’Œæ¢å¤æ—¶é—´éƒ½æ¯”è¾ƒçŸ­,ä½†æ˜¯å¤‡ä»½çš„æ–‡ä»¶åœ¨ä¸åŒçš„å¹³å°ä¸Šä¸ä¸€å®šå…¼å®¹ã€‚<br>å…¶ä¸­,mysqldump æ˜¯æœ€å¸¸ç”¨çš„é€»è¾‘å¤‡ä»½å·¥å…·,é€‚åˆå„ç§å­˜å‚¨å¼•æ“,å¸Œæœ›å¤§å®¶é‡ç‚¹æŒæ¡ã€‚</p>
<h5 id="MyISAMå’ŒINNODBè¡¨çš„å¤‡ä»½"><a href="#MyISAMå’ŒINNODBè¡¨çš„å¤‡ä»½" class="headerlink" title="MyISAMå’ŒINNODBè¡¨çš„å¤‡ä»½"></a>MyISAMå’ŒINNODBè¡¨çš„å¤‡ä»½</h5><table>
<thead>
<tr>
<th align="left">å­˜å‚¨å¼•æ“</th>
<th align="left">æ•°æ®ä¸€è‡´</th>
<th align="left">æœåŠ¡å¯ç”¨</th>
<th align="left">å®ç°æ–¹å¼</th>
</tr>
</thead>
<tbody><tr>
<td align="left">MYISAM</td>
<td align="left">ok</td>
<td align="left">no</td>
<td align="left">é”è¡¨</td>
</tr>
<tr>
<td align="left">INNODB</td>
<td align="left">ok</td>
<td align="left">ok</td>
<td align="left">MVCC</td>
</tr>
</tbody></table>
<h5 id="mysqldumpå‘½ä»¤çš„ç”¨æ³•"><a href="#mysqldumpå‘½ä»¤çš„ç”¨æ³•" class="headerlink" title="mysqldumpå‘½ä»¤çš„ç”¨æ³•"></a>mysqldumpå‘½ä»¤çš„ç”¨æ³•</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysqldump å¤‡ä»½æ•°æ®---é€»è¾‘å¤‡ä»½sqlè¯­å¥</span><br><span class="line">	-u ç”¨æˆ·å</span><br><span class="line">	-p å¯†ç </span><br><span class="line">	-A æ‰€æœ‰çš„åº“</span><br><span class="line">	--single-transaction INNODBå­˜å‚¨å¼•æ“çš„è¡¨å¤‡ä»½æ—¶èƒ½å¤Ÿåšåˆ°æ•°æ®ä¸€è‡´ï¼ŒæœåŠ¡å¯ç”¨</span><br><span class="line">mysqldump -uroot -puplooking -A --single-transaction &gt; &#x2F;tmp&#x2F;mysql.201608301600.sql</span><br><span class="line">	--lock-all-tables    MYISAMå­˜å‚¨å¼•æ“çš„è¡¨å¤‡ä»½æ—¶èƒ½å¤Ÿåšåˆ°æ•°æ®ä¸€è‡´ï¼ŒæœåŠ¡ä¸å¯ç”¨</span><br><span class="line">mysqldump -uroot -puplooking -A --lock-all-tables &gt; &#x2F;tmp&#x2F;mysql.xxx.sql</span><br></pre></td></tr></table></figure>

<h5 id="mysqldumpå¤‡ä»½æ­¥éª¤"><a href="#mysqldumpå¤‡ä»½æ­¥éª¤" class="headerlink" title="mysqldumpå¤‡ä»½æ­¥éª¤"></a>mysqldumpå¤‡ä»½æ­¥éª¤</h5><pre><code>INNODB    mysqldump -uroot -puplooking -A --single-transaction &gt; /tmp/mysql.201608301600.sql
MYISAM    mysqldump -uroot -puplooking -A --lock-all-tables &gt; /tmp/mysql.xxx.sql</code></pre><h5 id="mysqldumpè¿˜åŸæ­¥éª¤"><a href="#mysqldumpè¿˜åŸæ­¥éª¤" class="headerlink" title="mysqldumpè¿˜åŸæ­¥éª¤"></a>mysqldumpè¿˜åŸæ­¥éª¤</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1ï¼‰åœæ­¢æœåŠ¡</span><br><span class="line">2ï¼‰æ¸…ç©ºç¯å¢ƒ</span><br><span class="line">3ï¼‰å¯åŠ¨æœåŠ¡</span><br><span class="line">4ï¼‰å¯¼å…¥æ•°æ®</span><br><span class="line">5ï¼‰åˆ·æ–°æˆæƒ</span><br><span class="line">6ï¼‰æµ‹è¯•</span><br></pre></td></tr></table></figure>

<h5 id="è¯¾å ‚å®æˆ˜3-åˆ©ç”¨mysqldumpå®ç°é€»è¾‘å¤‡ä»½å¹¶è¿˜åŸ"><a href="#è¯¾å ‚å®æˆ˜3-åˆ©ç”¨mysqldumpå®ç°é€»è¾‘å¤‡ä»½å¹¶è¿˜åŸ" class="headerlink" title="è¯¾å ‚å®æˆ˜3: åˆ©ç”¨mysqldumpå®ç°é€»è¾‘å¤‡ä»½å¹¶è¿˜åŸ"></a>è¯¾å ‚å®æˆ˜3: åˆ©ç”¨mysqldumpå®ç°é€»è¾‘å¤‡ä»½å¹¶è¿˜åŸ</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera0 ~]# mysqldump -uroot -puplooking -A --single-transaction &gt; /tmp/mysql.all.1.sql</span><br><span class="line">[root@mastera0 ~]# ll /tmp</span><br><span class="line">total 89820</span><br><span class="line">drwxr-xr-x. 2 root root        6 Aug 30 11:31 a</span><br><span class="line">-rw-r--r--. 1 root root 30484480 Aug 30 14:01 mysql.1.tar</span><br><span class="line">-rw-r--r--. 1 root root 30484480 Aug 30 14:58 mysql.2.tar</span><br><span class="line">-rw-r--r--. 1 root root   515980 Aug 30 16:02 mysql.all.1.sql</span><br><span class="line">-rw-r--r--. 1 root root 30484480 Aug 30 11:28 mysql.all.tar</span><br><span class="line">[root@mastera0 ~]# systemctl stop mariadb</span><br><span class="line">[root@mastera0 ~]# rm -rf /var/lib/mysql/*</span><br><span class="line">[root@mastera0 ~]# ll /var/lib/mysql</span><br><span class="line">total 0</span><br><span class="line">[root@mastera0 ~]# systemctl start mariadb</span><br><span class="line">[root@mastera0 ~]# ll /var/lib/mysql</span><br><span class="line">total 28704</span><br><span class="line">-rw-rw----. 1 mysql mysql    16384 Aug 30 16:10 aria_log.00000001</span><br><span class="line">-rw-rw----. 1 mysql mysql       52 Aug 30 16:10 aria_log_control</span><br><span class="line">-rw-rw----. 1 mysql mysql 18874368 Aug 30 16:10 ibdata1</span><br><span class="line">-rw-rw----. 1 mysql mysql  5242880 Aug 30 16:10 ib_logfile0</span><br><span class="line">-rw-rw----. 1 mysql mysql  5242880 Aug 30 16:10 ib_logfile1</span><br><span class="line">drwx------. 2 mysql mysql     4096 Aug 30 16:10 mysql</span><br><span class="line">srwxrwxrwx. 1 mysql mysql        0 Aug 30 16:10 mysql.sock</span><br><span class="line">drwx------. 2 mysql mysql     4096 Aug 30 16:10 performance_schema</span><br><span class="line">drwx------. 2 mysql mysql     4096 Aug 30 16:10 test</span><br><span class="line">[root@mastera0 ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line">[root@mastera0 ~]#</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@mastera0 ~]# mysql &lt; /tmp/mysql.all.1.sql</span><br><span class="line">[root@mastera0 ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 4</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line">[root@mastera0 ~]# mysql</span><br><span class="line">ERROR 1045 (28000): Access denied for user \'root\'@\'localhost\' (using password: NO)</span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 6</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type \'help;\' or \'\h\' for help. Type \'\c\' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  1 |</span><br><span class="line">|  2 |</span><br><span class="line">|  3 |</span><br><span class="line">+----+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+---------------------+</span><br><span class="line">| Database            |</span><br><span class="line">+---------------------+</span><br><span class="line">| information_schema  |</span><br><span class="line">| db1                 |</span><br><span class="line">| db2                 |</span><br><span class="line">| #mysql50#lost+found |</span><br><span class="line">| mysql               |</span><br><span class="line">| performance_schema  |</span><br><span class="line">| test                |</span><br><span class="line">+---------------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; exit</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Percona-Xtrabackup"><a href="#Percona-Xtrabackup" class="headerlink" title="Percona Xtrabackup"></a>Percona Xtrabackup</h4><p><img src="pic/08-percona1.jpg" alt="percona1"><br><img src="pic/09-percona2.jpg" alt="percona1"><br><img src="pic/10-percona3.jpg" alt="percona1"></p>
<blockquote>
<p>å¦‚ä½•è·å–è½¯ä»¶ï¼Ÿ</p>
</blockquote>
<pre><code>[Perconaå®˜ç½‘](www.percona.com)</code></pre><blockquote>
<p>æ•™å®¤ç¯å¢ƒå·²ç»ä¸‹è½½å¥½è½¯ä»¶ï¼Œå­˜æ”¾è·¯å¾„ä¸ºï¼š</p>
</blockquote>
<pre><code>http://classroom.example.com/content/MYSQL/04-others/soft/Percona-XtraBackup-2.3.4-re80c779-el7-x86_64-bundle.tar</code></pre><blockquote>
<p>ç¼ºå°‘libev.so.4()(64bit)</p>
</blockquote>
<pre><code>http://classroom.example.com/content/MYSQL/04-others/soft/libev-4.15-6.el7.x86_64.rpm</code></pre><blockquote>
<p>install libev-4.15-6.el7.x86_64.rpm</p>
</blockquote>
<pre><code># install percona-xtrabackup-2.3.4-1.el7.x86_64.rpm
# install percona-xtrabackup-2.3.4-1.el7.x86_64.rpm</code></pre><blockquote>
<p>æŸ¥çœ‹è½¯ä»¶æ¶æ„</p>
</blockquote>
<ul>
<li><p>è½¯ä»¶å    percona-xtrabackup</p>
</li>
<li><p>å‘½ä»¤        innobackupex</p>
</li>
<li><p>é€‰é¡¹<br>  â€“user=name        ç”¨æˆ·å</p>
<p>  â€”-password=name    å¯†ç </p>
<p>  â€“apply-log        é‡æ¼”å›æ»š</p>
<p>  â€“copy-back        è¿˜åŸæ•°æ®</p>
<p>  â€“redo-only        åªé‡æ¼”ä¸å›æ»šï¼Œä¸apply-logåŒæ—¶ä½¿ç”¨</p>
</li>
</ul>
<blockquote>
<p>ç¤ºä¾‹1-å…¨å¤‡ä»½å¹¶è¿˜åŸ</p>
</blockquote>
<ul>
<li><p>å…¨å¤‡ä»½        </p>
<p>  innobackupex â€“user=root â€“password=uplooking /tmp/backup</p>
</li>
<li><p>è¿˜åŸå…¨å¤‡ä»½</p>
<p>  innobackupex â€“apply-log /tmp/backup/2016â€”â€“</p>
</li>
</ul>
<pre><code>innobackupex --copy-back /tmp/backup/2016-----</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1ï¼‰åœæ­¢æœåŠ¡</span><br><span class="line">2ï¼‰è¯·ç¯å¢ƒ</span><br><span class="line">3ï¼‰å¯¼å…¥æ•°æ®</span><br><span class="line">	1&gt; apply-log</span><br><span class="line">	2&gt; copy-back</span><br><span class="line">4ï¼‰ä¿®æ”¹æƒé™</span><br><span class="line">5ï¼‰å¯åŠ¨æœåŠ¡</span><br><span class="line">6ï¼‰æµ‹è¯•</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç¤ºä¾‹2-å…¨å¤‡å¢å¤‡å¹¶è¿˜åŸ</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å…¨å¤‡ä»½		innobackupex --user&#x3D;root --password&#x3D;uplooking &#x2F;tmp&#x2F;backup</span><br><span class="line">å¢é‡å¤‡ä»½1	innobackupex --user&#x3D;root --password&#x3D;uplooking --incremental-basedir&#x3D;&#x2F;tmp&#x2F;backup&#x2F;2016-09-01_11-32-43 --incremental &#x2F;tmp&#x2F;backup</span><br><span class="line">å¢é‡å¤‡ä»½2	innobackupex --user&#x3D;root --password&#x3D;uplooking --incremental-basedir&#x3D; --incremental</span><br><span class="line">å¢é‡å¤‡ä»½3	innobackupex --user&#x3D;root --password&#x3D;uplooking --incremental-basedir&#x3D; --incremental</span><br><span class="line"></span><br><span class="line">å…¨å¤‡ä»½è¿˜åŸ	innobackupex --apply-log  --redo-only &#x2F;tmp&#x2F;backup&#x2F;å…¨å¤‡ä»½</span><br><span class="line">		innobackupex --apply-log  --redo-only &#x2F;tmp&#x2F;backup&#x2F;å…¨å¤‡ä»½ --incremental-dir&#x3D;å¢é‡1</span><br><span class="line">		innobackupex --apply-log  --redo-only &#x2F;tmp&#x2F;backup&#x2F;å…¨å¤‡ä»½ --incremental-dir&#x3D;å¢é‡2</span><br><span class="line">		innobackupex --apply-log  --redo-only &#x2F;tmp&#x2F;backup&#x2F;å…¨å¤‡ä»½ --incremental-dir&#x3D;å¢é‡3</span><br><span class="line">		innobackupex --apply-log  &#x2F;tmp&#x2F;backup&#x2F;å…¨å¤‡ä»½</span><br><span class="line">		innobackupex --copy-back  &#x2F;tmp&#x2F;backup&#x2F;å…¨å¤‡ä»½</span><br></pre></td></tr></table></figure>


<h5 id="è¯¾å ‚å®æˆ˜4ï¼šinnobackupexå®æ—¶å¢é‡å¤‡ä»½å’Œè¿˜åŸ"><a href="#è¯¾å ‚å®æˆ˜4ï¼šinnobackupexå®æ—¶å¢é‡å¤‡ä»½å’Œè¿˜åŸ" class="headerlink" title="è¯¾å ‚å®æˆ˜4ï¼šinnobackupexå®æ—¶å¢é‡å¤‡ä»½å’Œè¿˜åŸ"></a>è¯¾å ‚å®æˆ˜4ï¼šinnobackupexå®æ—¶å¢é‡å¤‡ä»½å’Œè¿˜åŸ</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># install</span></span></span><br><span class="line">[root@mastera0 ~]# setenforce 0</span><br><span class="line">[root@mastera0 ~]# systemctl stop firewalld</span><br><span class="line">[root@mastera0 ~]# wget http://classroom.example.com/content/MYSQL/04-others/soft/Percona-XtraBackup-2.3.4-re80c779-el7-x86_64-bundle.tar</span><br><span class="line">--2016-09-01 10:41:05--  http://classroom.example.com/content/MYSQL/04-others/soft/Percona-XtraBackup-2.3.4-re80c779-el7-x86_64-bundle.tar</span><br><span class="line">Reusing existing connection to classroom.example.com:80.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 25548800 (24M) [application/x-tar]</span><br><span class="line">Saving to: â€˜Percona-XtraBackup-2.3.4-re80c779-el7-x86_64-bundle.tarâ€™</span><br><span class="line"></span><br><span class="line"><span class="meta">100%</span><span class="bash">[===========================================&gt;] 25,548,800   122MB/s   <span class="keyword">in</span> 0.2s   </span></span><br><span class="line"></span><br><span class="line">2016-09-01 10:41:05 (122 MB/s) - â€˜Percona-XtraBackup-2.3.4-re80c779-el7-x86_64-bundle.tarâ€™ saved [25548800/25548800]</span><br><span class="line"></span><br><span class="line">FINISHED --2016-09-01 10:41:05--</span><br><span class="line">Total wall clock time: 0.3s</span><br><span class="line">Downloaded: 1 files, 24M in 0.2s (122 MB/s)</span><br><span class="line">[root@mastera0 ~]# ls</span><br><span class="line">anaconda-ks.cfg  Percona-XtraBackup-2.3.4-re80c779-el7-x86_64-bundle.tar</span><br><span class="line">[root@mastera0 ~]# tar -xf Percona-XtraBackup-2.3.4-re80c779-el7-x86_64-bundle.tar</span><br><span class="line">[root@mastera0 ~]# ls</span><br><span class="line">anaconda-ks.cfg</span><br><span class="line">percona-xtrabackup-2.3.4-1.el7.x86_64.rpm</span><br><span class="line">Percona-XtraBackup-2.3.4-re80c779-el7-x86_64-bundle.tar</span><br><span class="line">percona-xtrabackup-debuginfo-2.3.4-1.el7.x86_64.rpm</span><br><span class="line">percona-xtrabackup-test-2.3.4-1.el7.x86_64.rpm</span><br><span class="line">[root@mastera0 ~]# yum localinstall -y percona-xtrabackup</span><br><span class="line">Loaded plugins: product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Skipping: percona-xtrabackup, filename does not end in .rpm.</span><br><span class="line">Nothing to do</span><br><span class="line">[root@mastera0 ~]# yum localinstall -y percona-xtrabackup-2.3.4-1.el7.x86_64.rpm</span><br><span class="line">Loaded plugins: product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Examining percona-xtrabackup-2.3.4-1.el7.x86_64.rpm: percona-xtrabackup-2.3.4-1.el7.x86_64</span><br><span class="line">Marking percona-xtrabackup-2.3.4-1.el7.x86_64.rpm to be installed</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package percona-xtrabackup.x86_64 0:2.3.4-1.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: rsync <span class="keyword">for</span> package: percona-xtrabackup-2.3.4-1.el7.x86_64</span></span><br><span class="line">rhel_dvd                                                      | 4.1 kB  00:00:00     </span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libev.so.4()(64bit) <span class="keyword">for</span> package: percona-xtrabackup-2.3.4-1.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package percona-xtrabackup.x86_64 0:2.3.4-1.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libev.so.4()(64bit) <span class="keyword">for</span> package: percona-xtrabackup-2.3.4-1.el7.x86_64</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package rsync.x86_64 0:3.0.9-17.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line">Error: Package: percona-xtrabackup-2.3.4-1.el7.x86_64 (/percona-xtrabackup-2.3.4-1.el7.x86_64)</span><br><span class="line">           Requires: libev.so.4()(64bit)</span><br><span class="line"> You could try using --skip-broken to work around the problem</span><br><span class="line"> You could try running: rpm -Va --nofiles --nodigest</span><br><span class="line">[root@mastera0 ~]# wget http://classroom.example.com/content/MYSQL/04-others/soft/libev-4.15-6.el7.x86_64.rpm</span><br><span class="line">--2016-09-01 10:43:37--  http://classroom.example.com/content/MYSQL/04-others/soft/libev-4.15-6.el7.x86_64.rpm</span><br><span class="line">Resolving classroom.example.com (classroom.example.com)... 172.25.254.254</span><br><span class="line">Connecting to classroom.example.com (classroom.example.com)|172.25.254.254|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 44964 (44K) [application/x-rpm]</span><br><span class="line">Saving to: â€˜libev-4.15-6.el7.x86_64.rpmâ€™</span><br><span class="line"></span><br><span class="line"><span class="meta">100%</span><span class="bash">[===========================================&gt;] 44,964      --.-K/s   <span class="keyword">in</span> 0s      </span></span><br><span class="line"></span><br><span class="line">2016-09-01 10:43:37 (360 MB/s) - â€˜libev-4.15-6.el7.x86_64.rpmâ€™ saved [44964/44964]</span><br><span class="line"></span><br><span class="line">[root@mastera0 ~]# ls</span><br><span class="line">anaconda-ks.cfg</span><br><span class="line">libev-4.15-6.el7.x86_64.rpm</span><br><span class="line">percona-xtrabackup-2.3.4-1.el7.x86_64.rpm</span><br><span class="line">Percona-XtraBackup-2.3.4-re80c779-el7-x86_64-bundle.tar</span><br><span class="line">percona-xtrabackup-debuginfo-2.3.4-1.el7.x86_64.rpm</span><br><span class="line">percona-xtrabackup-test-2.3.4-1.el7.x86_64.rpm</span><br><span class="line">[root@mastera0 ~]# yum localinstall -y libev-4.15-6.el7.x86_64.rpm</span><br><span class="line">Loaded plugins: product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Examining libev-4.15-6.el7.x86_64.rpm: libev-4.15-6.el7.x86_64</span><br><span class="line">Marking libev-4.15-6.el7.x86_64.rpm to be installed</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package libev.x86_64 0:4.15-6.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">=====================================================================================</span><br><span class="line"> Package      Arch          Version            Repository                       Size</span><br><span class="line">=====================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> libev        x86_64        4.15-6.el7         /libev-4.15-6.el7.x86_64         86 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">=====================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total size: 86 k</span><br><span class="line">Installed size: 86 k</span><br><span class="line">Downloading packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : libev-4.15-6.el7.x86_64                                           1/1</span><br><span class="line">  Verifying  : libev-4.15-6.el7.x86_64                                           1/1</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  libev.x86_64 0:4.15-6.el7                                                          </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@mastera0 ~]# yum localinstall -y percona-xtrabackup-2.3.4-1.el7.x86_64.rpm Loaded plugins: product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Examining percona-xtrabackup-2.3.4-1.el7.x86_64.rpm: percona-xtrabackup-2.3.4-1.el7.x86_64</span><br><span class="line">Marking percona-xtrabackup-2.3.4-1.el7.x86_64.rpm to be installed</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package percona-xtrabackup.x86_64 0:2.3.4-1.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: rsync <span class="keyword">for</span> package: percona-xtrabackup-2.3.4-1.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package rsync.x86_64 0:3.0.9-17.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">=====================================================================================</span><br><span class="line"> Package            Arch   Version      Repository                              Size</span><br><span class="line">=====================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> percona-xtrabackup x86_64 2.3.4-1.el7  /percona-xtrabackup-2.3.4-1.el7.x86_64  21 M</span><br><span class="line">Installing for dependencies:</span><br><span class="line"> rsync              x86_64 3.0.9-17.el7 rhel_dvd                               359 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">=====================================================================================</span><br><span class="line">Install  1 Package (+1 Dependent package)</span><br><span class="line"></span><br><span class="line">Total size: 22 M</span><br><span class="line">Total download size: 359 k</span><br><span class="line">Installed size: 22 M</span><br><span class="line">Downloading packages:</span><br><span class="line">rsync-3.0.9-17.el7.x86_64.rpm                                 | 359 kB  00:00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : rsync-3.0.9-17.el7.x86_64                                         1/2</span><br><span class="line">  Installing : percona-xtrabackup-2.3.4-1.el7.x86_64                             2/2</span><br><span class="line">  Verifying  : rsync-3.0.9-17.el7.x86_64                                         1/2</span><br><span class="line">  Verifying  : percona-xtrabackup-2.3.4-1.el7.x86_64                             2/2</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  percona-xtrabackup.x86_64 0:2.3.4-1.el7                                            </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  rsync.x86_64 0:3.0.9-17.el7                                                        </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@mastera0 ~]# ls</span><br><span class="line">anaconda-ks.cfg</span><br><span class="line">libev-4.15-6.el7.x86_64.rpm</span><br><span class="line">percona-xtrabackup-2.3.4-1.el7.x86_64.rpm</span><br><span class="line">Percona-XtraBackup-2.3.4-re80c779-el7-x86_64-bundle.tar</span><br><span class="line">percona-xtrabackup-debuginfo-2.3.4-1.el7.x86_64.rpm</span><br><span class="line">percona-xtrabackup-test-2.3.4-1.el7.x86_64.rpm</span><br><span class="line">[root@mastera0 ~]# rpm -ql percona-xtrabackup</span><br><span class="line">/usr/bin/innobackupex</span><br><span class="line">/usr/bin/xbcloud</span><br><span class="line">/usr/bin/xbcloud_osenv</span><br><span class="line">/usr/bin/xbcrypt</span><br><span class="line">/usr/bin/xbstream</span><br><span class="line">/usr/bin/xtrabackup</span><br><span class="line">/usr/share/doc/percona-xtrabackup-2.3.4</span><br><span class="line">/usr/share/doc/percona-xtrabackup-2.3.4/COPYING</span><br><span class="line">/usr/share/man/man1/innobackupex.1.gz</span><br><span class="line">/usr/share/man/man1/xbcrypt.1.gz</span><br><span class="line">/usr/share/man/man1/xbstream.1.gz</span><br><span class="line">/usr/share/man/man1/xtrabackup.1.gz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># backup</span></span></span><br><span class="line">[root@mastera0 mysql-log]# innobackupex --user=root --password=uplooking /tmp/backup</span><br><span class="line">160901 11:32:43 innobackupex: Starting the backup operation</span><br><span class="line"></span><br><span class="line">IMPORTANT: Please check that the backup run completes successfully.</span><br><span class="line">           At the end of a successful backup run innobackupex</span><br><span class="line">           prints \"completed OK!\".</span><br><span class="line"></span><br><span class="line">Can\'t locate Digest/MD5.pm in @INC (@INC contains: /usr/local/lib64/perl5 /usr/local/share/perl5 /usr/lib64/perl5/vendor_perl /usr/share/perl5/vendor_perl /usr/lib64/perl5 /usr/share/perl5 .) at - line 693.</span><br><span class="line">BEGIN failed--compilation aborted at - line 693.</span><br><span class="line">160901 11:32:43 Connecting to MySQL server host: localhost, user: root, password: set, port: 0, socket: /var/lib/mysql/mysql.sock</span><br><span class="line">Using server version 5.5.44-MariaDB-log</span><br><span class="line">innobackupex version 2.3.4 based on MySQL server 5.6.24 Linux (x86_64) (revision id: e80c779)</span><br><span class="line">xtrabackup: uses posix_fadvise().</span><br><span class="line">xtrabackup: cd to /var/lib/mysql</span><br><span class="line">xtrabackup: open files limit requested 0, set to 1024</span><br><span class="line">xtrabackup: using the following InnoDB configuration:</span><br><span class="line">xtrabackup:   innodb_data_home_dir = ./</span><br><span class="line">xtrabackup:   innodb_data_file_path = ibdata1:10M:autoextend</span><br><span class="line">xtrabackup:   innodb_log_group_home_dir = ./</span><br><span class="line">xtrabackup:   innodb_log_files_in_group = 2</span><br><span class="line">xtrabackup:   innodb_log_file_size = 5242880</span><br><span class="line">160901 11:32:43 &gt;&gt; log scanned up to (1607773)</span><br><span class="line">xtrabackup: Generating a list of tablespaces</span><br><span class="line">160901 11:32:43 [01] Copying ./ibdata1 to /tmp/backup/2016-09-01_11-32-43/ibdata1</span><br><span class="line">160901 11:32:43 [01]        ...done</span><br><span class="line">160901 11:32:44 &gt;&gt; log scanned up to (1607773)</span><br><span class="line">160901 11:32:44 Executing FLUSH NO_WRITE_TO_BINLOG TABLES...</span><br><span class="line">160901 11:32:44 Executing FLUSH TABLES WITH READ LOCK...</span><br><span class="line">160901 11:32:44 Starting to backup non-InnoDB tables and files</span><br><span class="line">160901 11:32:44 [01] Copying ./mysql/tables_priv.frm to /tmp/backup/2016-09-01_11-32-43/mysql/tables_priv.frm</span><br><span class="line">160901 11:32:44 [01]        ...done</span><br><span class="line">160901 11:32:44 [01] Copying ./mysql/tables_priv.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/tables_priv.MYI</span><br><span class="line">160901 11:32:44 [01]        ...done</span><br><span class="line">160901 11:32:44 [01] Copying ./mysql/time_zone.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone.MYD</span><br><span class="line">160901 11:32:44 [01]        ...done</span><br><span class="line">160901 11:32:44 [01] Copying ./mysql/ndb_binlog_index.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/ndb_binlog_index.MYD</span><br><span class="line">160901 11:32:44 [01]        ...done</span><br><span class="line">160901 11:32:44 [01] Copying ./mysql/plugin.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/plugin.MYD</span><br><span class="line">160901 11:32:44 [01]        ...done</span><br><span class="line">160901 11:32:44 [01] Copying ./mysql/proc.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/proc.MYI</span><br><span class="line">160901 11:32:44 [01]        ...done</span><br><span class="line">160901 11:32:44 [01] Copying ./mysql/procs_priv.frm to /tmp/backup/2016-09-01_11-32-43/mysql/procs_priv.frm</span><br><span class="line">160901 11:32:44 [01]        ...done</span><br><span class="line">160901 11:32:44 [01] Copying ./mysql/procs_priv.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/procs_priv.MYD</span><br><span class="line">160901 11:32:44 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/proxies_priv.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/proxies_priv.MYI</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/servers.frm to /tmp/backup/2016-09-01_11-32-43/mysql/servers.frm</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/servers.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/servers.MYD</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/time_zone.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone.MYI</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/time_zone_name.frm to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone_name.frm</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/time_zone_name.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone_name.MYI</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/time_zone_name.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone_name.MYD</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/time_zone_transition.frm to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone_transition.frm</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/time_zone_transition.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone_transition.MYI</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 &gt;&gt; log scanned up to (1607773)</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/time_zone_transition.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone_transition.MYD</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/time_zone_transition_type.frm to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone_transition_type.frm</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/time_zone_transition_type.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone_transition_type.MYI</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/time_zone_transition_type.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone_transition_type.MYD</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/user.frm to /tmp/backup/2016-09-01_11-32-43/mysql/user.frm</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/user.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/user.MYI</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/user.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/user.MYD</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/time_zone_leap_second.frm to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone_leap_second.frm</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/time_zone_leap_second.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone_leap_second.MYI</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/general_log.frm to /tmp/backup/2016-09-01_11-32-43/mysql/general_log.frm</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:45 [01] Copying ./mysql/general_log.CSM to /tmp/backup/2016-09-01_11-32-43/mysql/general_log.CSM</span><br><span class="line">160901 11:32:45 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/general_log.CSV to /tmp/backup/2016-09-01_11-32-43/mysql/general_log.CSV</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/slow_log.frm to /tmp/backup/2016-09-01_11-32-43/mysql/slow_log.frm</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/slow_log.CSM to /tmp/backup/2016-09-01_11-32-43/mysql/slow_log.CSM</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/slow_log.CSV to /tmp/backup/2016-09-01_11-32-43/mysql/slow_log.CSV</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/tables_priv.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/tables_priv.MYD</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/columns_priv.frm to /tmp/backup/2016-09-01_11-32-43/mysql/columns_priv.frm</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/columns_priv.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/columns_priv.MYI</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/columns_priv.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/columns_priv.MYD</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/db.frm to /tmp/backup/2016-09-01_11-32-43/mysql/db.frm</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/db.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/db.MYI</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/db.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/db.MYD</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 &gt;&gt; log scanned up to (1607773)</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/event.frm to /tmp/backup/2016-09-01_11-32-43/mysql/event.frm</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/event.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/event.MYI</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/event.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/event.MYD</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/func.frm to /tmp/backup/2016-09-01_11-32-43/mysql/func.frm</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/func.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/func.MYI</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/func.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/func.MYD</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/help_category.frm to /tmp/backup/2016-09-01_11-32-43/mysql/help_category.frm</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/help_category.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/help_category.MYI</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/help_category.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/help_category.MYD</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:46 [01] Copying ./mysql/help_keyword.frm to /tmp/backup/2016-09-01_11-32-43/mysql/help_keyword.frm</span><br><span class="line">160901 11:32:46 [01]        ...done</span><br><span class="line">160901 11:32:47 [01] Copying ./mysql/help_keyword.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/help_keyword.MYI</span><br><span class="line">160901 11:32:47 [01]        ...done</span><br><span class="line">160901 11:32:47 [01] Copying ./mysql/help_keyword.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/help_keyword.MYD</span><br><span class="line">160901 11:32:47 [01]        ...done</span><br><span class="line">160901 11:32:47 [01] Copying ./mysql/help_relation.frm to /tmp/backup/2016-09-01_11-32-43/mysql/help_relation.frm</span><br><span class="line">160901 11:32:47 [01]        ...done</span><br><span class="line">160901 11:32:47 [01] Copying ./mysql/help_relation.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/help_relation.MYI</span><br><span class="line">160901 11:32:47 [01]        ...done</span><br><span class="line">160901 11:32:47 [01] Copying ./mysql/help_relation.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/help_relation.MYD</span><br><span class="line">160901 11:32:47 [01]        ...done</span><br><span class="line">160901 11:32:47 [01] Copying ./mysql/help_topic.frm to /tmp/backup/2016-09-01_11-32-43/mysql/help_topic.frm</span><br><span class="line">160901 11:32:47 [01]        ...done</span><br><span class="line">160901 11:32:47 [01] Copying ./mysql/help_topic.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/help_topic.MYI</span><br><span class="line">160901 11:32:47 [01]        ...done</span><br><span class="line">160901 11:32:47 &gt;&gt; log scanned up to (1607773)</span><br><span class="line">160901 11:32:47 [01] Copying ./mysql/help_topic.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/help_topic.MYD</span><br><span class="line">160901 11:32:47 [01]        ...done</span><br><span class="line">160901 11:32:47 [01] Copying ./mysql/host.frm to /tmp/backup/2016-09-01_11-32-43/mysql/host.frm</span><br><span class="line">160901 11:32:47 [01]        ...done</span><br><span class="line">160901 11:32:47 [01] Copying ./mysql/host.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/host.MYI</span><br><span class="line">160901 11:32:47 [01]        ...done</span><br><span class="line">160901 11:32:47 [01] Copying ./mysql/host.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/host.MYD</span><br><span class="line">160901 11:32:47 [01]        ...done</span><br><span class="line">160901 11:32:47 [01] Copying ./mysql/ndb_binlog_index.frm to /tmp/backup/2016-09-01_11-32-43/mysql/ndb_binlog_index.frm</span><br><span class="line">160901 11:32:47 [01]        ...done</span><br><span class="line">160901 11:32:47 [01] Copying ./mysql/ndb_binlog_index.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/ndb_binlog_index.MYI</span><br><span class="line">160901 11:32:47 [01]        ...done</span><br><span class="line">160901 11:32:47 [01] Copying ./mysql/plugin.frm to /tmp/backup/2016-09-01_11-32-43/mysql/plugin.frm</span><br><span class="line">160901 11:32:47 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./mysql/plugin.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/plugin.MYI</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./mysql/proc.frm to /tmp/backup/2016-09-01_11-32-43/mysql/proc.frm</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./mysql/proc.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/proc.MYD</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./mysql/procs_priv.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/procs_priv.MYI</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./mysql/proxies_priv.frm to /tmp/backup/2016-09-01_11-32-43/mysql/proxies_priv.frm</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./mysql/proxies_priv.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/proxies_priv.MYD</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./mysql/servers.MYI to /tmp/backup/2016-09-01_11-32-43/mysql/servers.MYI</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./mysql/time_zone.frm to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone.frm</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./mysql/time_zone_leap_second.MYD to /tmp/backup/2016-09-01_11-32-43/mysql/time_zone_leap_second.MYD</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 &gt;&gt; log scanned up to (1607773)</span><br><span class="line">160901 11:32:48 [00] Writing test/db.opt</span><br><span class="line">160901 11:32:48 [00]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./performance_schema/db.opt to /tmp/backup/2016-09-01_11-32-43/performance_schema/db.opt</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./performance_schema/cond_instances.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/cond_instances.frm</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./performance_schema/events_waits_current.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/events_waits_current.frm</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./performance_schema/events_waits_history.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/events_waits_history.frm</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./performance_schema/events_waits_history_long.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/events_waits_history_long.frm</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./performance_schema/events_waits_summary_by_instance.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/events_waits_summary_by_instance.frm</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./performance_schema/events_waits_summary_by_thread_by_event_name.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/events_waits_summary_by_thread_by_event_name.frm</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./performance_schema/events_waits_summary_global_by_event_name.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/events_waits_summary_global_by_event_name.frm</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:48 [01] Copying ./performance_schema/file_instances.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/file_instances.frm</span><br><span class="line">160901 11:32:48 [01]        ...done</span><br><span class="line">160901 11:32:49 [01] Copying ./performance_schema/file_summary_by_event_name.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/file_summary_by_event_name.frm</span><br><span class="line">160901 11:32:49 [01]        ...done</span><br><span class="line">160901 11:32:49 [01] Copying ./performance_schema/file_summary_by_instance.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/file_summary_by_instance.frm</span><br><span class="line">160901 11:32:49 [01]        ...done</span><br><span class="line">160901 11:32:49 [01] Copying ./performance_schema/mutex_instances.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/mutex_instances.frm</span><br><span class="line">160901 11:32:49 [01]        ...done</span><br><span class="line">160901 11:32:49 [01] Copying ./performance_schema/performance_timers.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/performance_timers.frm</span><br><span class="line">160901 11:32:49 [01]        ...done</span><br><span class="line">160901 11:32:49 [01] Copying ./performance_schema/rwlock_instances.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/rwlock_instances.frm</span><br><span class="line">160901 11:32:49 [01]        ...done</span><br><span class="line">160901 11:32:49 [01] Copying ./performance_schema/setup_consumers.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/setup_consumers.frm</span><br><span class="line">160901 11:32:49 [01]        ...done</span><br><span class="line">160901 11:32:49 [01] Copying ./performance_schema/setup_instruments.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/setup_instruments.frm</span><br><span class="line">160901 11:32:49 [01]        ...done</span><br><span class="line">160901 11:32:49 [01] Copying ./performance_schema/setup_timers.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/setup_timers.frm</span><br><span class="line">160901 11:32:49 [01]        ...done</span><br><span class="line">160901 11:32:49 [01] Copying ./performance_schema/threads.frm to /tmp/backup/2016-09-01_11-32-43/performance_schema/threads.frm</span><br><span class="line">160901 11:32:49 [01]        ...done</span><br><span class="line">160901 11:32:49 &gt;&gt; log scanned up to (1607773)</span><br><span class="line">160901 11:32:49 [01] Copying ./db1/db.opt to /tmp/backup/2016-09-01_11-32-43/db1/db.opt</span><br><span class="line">160901 11:32:49 [01]        ...done</span><br><span class="line">160901 11:32:49 [01] Copying ./db1/t1.frm to /tmp/backup/2016-09-01_11-32-43/db1/t1.frm</span><br><span class="line">160901 11:32:49 [01]        ...done</span><br><span class="line">160901 11:32:49 [01] Copying ./db2/db.opt to /tmp/backup/2016-09-01_11-32-43/db2/db.opt</span><br><span class="line">160901 11:32:49 [01]        ...done</span><br><span class="line">160901 11:32:49 [01] Copying ./db2/t1.frm to /tmp/backup/2016-09-01_11-32-43/db2/t1.frm</span><br><span class="line">160901 11:32:49 [01]        ...done</span><br><span class="line">160901 11:32:49 Finished backing up non-InnoDB tables and files</span><br><span class="line">160901 11:32:49 [00] Writing xtrabackup_binlog_info</span><br><span class="line">160901 11:32:49 [00]        ...done</span><br><span class="line">160901 11:32:49 Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS...</span><br><span class="line">xtrabackup: The latest check point (for incremental): '1607773'</span><br><span class="line">xtrabackup: Stopping log copying thread.</span><br><span class="line">.160901 11:32:49 &gt;&gt; log scanned up to (1607773)</span><br><span class="line"></span><br><span class="line">160901 11:32:50 Executing UNLOCK TABLES</span><br><span class="line">160901 11:32:50 All tables unlocked</span><br><span class="line">160901 11:32:50 Backup created in directory '/tmp/backup/2016-09-01_11-32-43'</span><br><span class="line">MySQL binlog position: filename 'mastera.000021', position '426'</span><br><span class="line">160901 11:32:50 [00] Writing backup-my.cnf</span><br><span class="line">160901 11:32:50 [00]        ...done</span><br><span class="line">160901 11:32:50 [00] Writing xtrabackup_info</span><br><span class="line">160901 11:32:50 [00]        ...done</span><br><span class="line">xtrabackup: Transaction log of lsn (1607773) to (1607773) was copied.</span><br><span class="line">160901 11:32:50 completed OK!</span><br><span class="line">[root@mastera0 mysql-log]# cd /tmp/backup/</span><br><span class="line">[root@mastera0 backup]# ll</span><br><span class="line">total 4</span><br><span class="line">drwx------. 7 root root 4096 Sep  1 11:32 2016-09-01_11-32-43</span><br><span class="line">[root@mastera0 backup]# cd 2016-09-01_11-32-43/</span><br><span class="line">[root@mastera0 2016-09-01_11-32-43]# ll</span><br><span class="line">total 18460</span><br><span class="line">-rw-r-----. 1 root root      386 Sep  1 11:32 backup-my.cnf</span><br><span class="line">drwx------. 2 root root       32 Sep  1 11:32 db1</span><br><span class="line">drwx------. 2 root root       32 Sep  1 11:32 db2</span><br><span class="line">-rw-r-----. 1 root root 18874368 Sep  1 11:32 ibdata1</span><br><span class="line">drwx------. 2 root root     4096 Sep  1 11:32 mysql</span><br><span class="line">drwx------. 2 root root     4096 Sep  1 11:32 performance_schema</span><br><span class="line">drwx------. 2 root root       19 Sep  1 11:32 test</span><br><span class="line">-rw-r-----. 1 root root       19 Sep  1 11:32 xtrabackup_binlog_info</span><br><span class="line">-rw-r-----. 1 root root      113 Sep  1 11:32 xtrabackup_checkpoints</span><br><span class="line">-rw-r-----. 1 root root      473 Sep  1 11:32 xtrabackup_info</span><br><span class="line">-rw-r-----. 1 root root     2560 Sep  1 11:32 xtrabackup_logfile</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># copyback</span></span></span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]# systemctl stop mariadb</span><br><span class="line">[root@mastera0 mysql]# rm -rf /var/lib/mysql/*</span><br><span class="line">[root@mastera0 mysql]# innobackupex --apply-log /tmp/backup/2016-09-01_11-32-43/</span><br><span class="line">160901 11:36:33 innobackupex: Starting the apply-log operation</span><br><span class="line"></span><br><span class="line">IMPORTANT: Please check that the apply-log run completes successfully.</span><br><span class="line">           At the end of a successful apply-log run innobackupex</span><br><span class="line">           prints "completed OK!".</span><br><span class="line"></span><br><span class="line">innobackupex version 2.3.4 based on MySQL server 5.6.24 Linux (x86_64) (revision id: e80c779)</span><br><span class="line">xtrabackup: cd to /tmp/backup/2016-09-01_11-32-43/</span><br><span class="line">xtrabackup: This target seems to be not prepared yet.</span><br><span class="line">xtrabackup: xtrabackup_logfile detected: size=2097152, start_lsn=(1607773)</span><br><span class="line">xtrabackup: using the following InnoDB configuration for recovery:</span><br><span class="line">xtrabackup:   innodb_data_home_dir = ./</span><br><span class="line">xtrabackup:   innodb_data_file_path = ibdata1:10M:autoextend</span><br><span class="line">xtrabackup:   innodb_log_group_home_dir = ./</span><br><span class="line">xtrabackup:   innodb_log_files_in_group = 1</span><br><span class="line">xtrabackup:   innodb_log_file_size = 2097152</span><br><span class="line">xtrabackup: using the following InnoDB configuration for recovery:</span><br><span class="line">xtrabackup:   innodb_data_home_dir = ./</span><br><span class="line">xtrabackup:   innodb_data_file_path = ibdata1:10M:autoextend</span><br><span class="line">xtrabackup:   innodb_log_group_home_dir = ./</span><br><span class="line">xtrabackup:   innodb_log_files_in_group = 1</span><br><span class="line">xtrabackup:   innodb_log_file_size = 2097152</span><br><span class="line">xtrabackup: Starting InnoDB instance for recovery.</span><br><span class="line">xtrabackup: Using 104857600 bytes for buffer pool (set by --use-memory parameter)</span><br><span class="line">InnoDB: Using atomics to ref count buffer pool pages</span><br><span class="line">InnoDB: The InnoDB memory heap is disabled</span><br><span class="line">InnoDB: Mutexes and rw_locks use GCC atomic builtins</span><br><span class="line">InnoDB: Memory barrier is not used</span><br><span class="line">InnoDB: Compressed tables use zlib 1.2.7</span><br><span class="line">InnoDB: Using CPU crc32 instructions</span><br><span class="line">InnoDB: Initializing buffer pool, size = 100.0M</span><br><span class="line">InnoDB: Completed initialization of buffer pool</span><br><span class="line">InnoDB: Highest supported file format is Barracuda.</span><br><span class="line">InnoDB: The log sequence numbers 0 and 0 in ibdata files do not match the log sequence number 1607773 in the ib_logfiles!</span><br><span class="line">InnoDB: Database was not shutdown normally!</span><br><span class="line">InnoDB: Starting crash recovery.</span><br><span class="line">InnoDB: Reading tablespace information from the .ibd files...</span><br><span class="line">InnoDB: Restoring possible half-written data pages</span><br><span class="line">InnoDB: from the doublewrite buffer...</span><br><span class="line">InnoDB: 128 rollback segment(s) are active.</span><br><span class="line">InnoDB: Waiting for purge to start</span><br><span class="line">InnoDB: 5.6.24 started; log sequence number 1607773</span><br><span class="line">xtrabackup: Last MySQL binlog file position 426, file name /var/lib/mysql-log/mastera.000021</span><br><span class="line"></span><br><span class="line">xtrabackup: starting shutdown with innodb_fast_shutdown = 1</span><br><span class="line">InnoDB: FTS optimize thread exiting.</span><br><span class="line">InnoDB: Starting shutdown...</span><br><span class="line">InnoDB: Shutdown completed; log sequence number 1607783</span><br><span class="line">xtrabackup: using the following InnoDB configuration for recovery:</span><br><span class="line">xtrabackup:   innodb_data_home_dir = ./</span><br><span class="line">xtrabackup:   innodb_data_file_path = ibdata1:10M:autoextend</span><br><span class="line">xtrabackup:   innodb_log_group_home_dir = ./</span><br><span class="line">xtrabackup:   innodb_log_files_in_group = 2</span><br><span class="line">xtrabackup:   innodb_log_file_size = 5242880</span><br><span class="line">InnoDB: Using atomics to ref count buffer pool pages</span><br><span class="line">InnoDB: The InnoDB memory heap is disabled</span><br><span class="line">InnoDB: Mutexes and rw_locks use GCC atomic builtins</span><br><span class="line">InnoDB: Memory barrier is not used</span><br><span class="line">InnoDB: Compressed tables use zlib 1.2.7</span><br><span class="line">InnoDB: Using CPU crc32 instructions</span><br><span class="line">InnoDB: Initializing buffer pool, size = 100.0M</span><br><span class="line">InnoDB: Completed initialization of buffer pool</span><br><span class="line">InnoDB: Setting log file ./ib_logfile101 size to 5 MB</span><br><span class="line">InnoDB: Setting log file ./ib_logfile1 size to 5 MB</span><br><span class="line">InnoDB: Renaming log file ./ib_logfile101 to ./ib_logfile0</span><br><span class="line">InnoDB: New log files created, LSN=1607783</span><br><span class="line">InnoDB: Highest supported file format is Barracuda.</span><br><span class="line">InnoDB: 128 rollback segment(s) are active.</span><br><span class="line">InnoDB: Waiting for purge to start</span><br><span class="line">InnoDB: 5.6.24 started; log sequence number 1608204</span><br><span class="line">xtrabackup: starting shutdown with innodb_fast_shutdown = 1</span><br><span class="line">InnoDB: FTS optimize thread exiting.</span><br><span class="line">InnoDB: Starting shutdown...</span><br><span class="line">InnoDB: Shutdown completed; log sequence number 1608214</span><br><span class="line">160901 11:36:37 completed OK!</span><br><span class="line">[root@mastera0 mysql]# innobackupex --copy-back /tmp/backup/2016-09-01_11-32-43/</span><br><span class="line">160901 11:36:56 innobackupex: Starting the copy-back operation</span><br><span class="line"></span><br><span class="line">IMPORTANT: Please check that the copy-back run completes successfully.</span><br><span class="line">           At the end of a successful copy-back run innobackupex</span><br><span class="line">           prints "completed OK!".</span><br><span class="line"></span><br><span class="line">innobackupex version 2.3.4 based on MySQL server 5.6.24 Linux (x86_64) (revision id: e80c779)</span><br><span class="line">160901 11:36:56 [01] Copying ib_logfile0 to /var/lib/mysql/ib_logfile0</span><br><span class="line">160901 11:36:56 [01]        ...done</span><br><span class="line">160901 11:36:56 [01] Copying ib_logfile1 to /var/lib/mysql/ib_logfile1</span><br><span class="line">160901 11:36:56 [01]        ...done</span><br><span class="line">160901 11:36:56 [01] Copying ibdata1 to /var/lib/mysql/ibdata1</span><br><span class="line">160901 11:36:56 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/tables_priv.frm to /var/lib/mysql/mysql/tables_priv.frm</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/tables_priv.MYI to /var/lib/mysql/mysql/tables_priv.MYI</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/time_zone.MYD to /var/lib/mysql/mysql/time_zone.MYD</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/ndb_binlog_index.MYD to /var/lib/mysql/mysql/ndb_binlog_index.MYD</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/plugin.MYD to /var/lib/mysql/mysql/plugin.MYD</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/proc.MYI to /var/lib/mysql/mysql/proc.MYI</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/procs_priv.frm to /var/lib/mysql/mysql/procs_priv.frm</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/procs_priv.MYD to /var/lib/mysql/mysql/procs_priv.MYD</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/proxies_priv.MYI to /var/lib/mysql/mysql/proxies_priv.MYI</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/servers.frm to /var/lib/mysql/mysql/servers.frm</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/servers.MYD to /var/lib/mysql/mysql/servers.MYD</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/time_zone.MYI to /var/lib/mysql/mysql/time_zone.MYI</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/time_zone_name.frm to /var/lib/mysql/mysql/time_zone_name.frm</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/time_zone_name.MYI to /var/lib/mysql/mysql/time_zone_name.MYI</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/time_zone_name.MYD to /var/lib/mysql/mysql/time_zone_name.MYD</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/time_zone_transition.frm to /var/lib/mysql/mysql/time_zone_transition.frm</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:57 [01] Copying ./mysql/time_zone_transition.MYI to /var/lib/mysql/mysql/time_zone_transition.MYI</span><br><span class="line">160901 11:36:57 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/time_zone_transition.MYD to /var/lib/mysql/mysql/time_zone_transition.MYD</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/time_zone_transition_type.frm to /var/lib/mysql/mysql/time_zone_transition_type.frm</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/time_zone_transition_type.MYI to /var/lib/mysql/mysql/time_zone_transition_type.MYI</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/time_zone_transition_type.MYD to /var/lib/mysql/mysql/time_zone_transition_type.MYD</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/user.frm to /var/lib/mysql/mysql/user.frm</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/user.MYI to /var/lib/mysql/mysql/user.MYI</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/user.MYD to /var/lib/mysql/mysql/user.MYD</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/time_zone_leap_second.frm to /var/lib/mysql/mysql/time_zone_leap_second.frm</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/time_zone_leap_second.MYI to /var/lib/mysql/mysql/time_zone_leap_second.MYI</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/general_log.frm to /var/lib/mysql/mysql/general_log.frm</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/general_log.CSM to /var/lib/mysql/mysql/general_log.CSM</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/general_log.CSV to /var/lib/mysql/mysql/general_log.CSV</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/slow_log.frm to /var/lib/mysql/mysql/slow_log.frm</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/slow_log.CSM to /var/lib/mysql/mysql/slow_log.CSM</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/slow_log.CSV to /var/lib/mysql/mysql/slow_log.CSV</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/tables_priv.MYD to /var/lib/mysql/mysql/tables_priv.MYD</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/columns_priv.frm to /var/lib/mysql/mysql/columns_priv.frm</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/columns_priv.MYI to /var/lib/mysql/mysql/columns_priv.MYI</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/columns_priv.MYD to /var/lib/mysql/mysql/columns_priv.MYD</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/db.frm to /var/lib/mysql/mysql/db.frm</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:58 [01] Copying ./mysql/db.MYI to /var/lib/mysql/mysql/db.MYI</span><br><span class="line">160901 11:36:58 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/db.MYD to /var/lib/mysql/mysql/db.MYD</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/event.frm to /var/lib/mysql/mysql/event.frm</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/event.MYI to /var/lib/mysql/mysql/event.MYI</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/event.MYD to /var/lib/mysql/mysql/event.MYD</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/func.frm to /var/lib/mysql/mysql/func.frm</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/func.MYI to /var/lib/mysql/mysql/func.MYI</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/func.MYD to /var/lib/mysql/mysql/func.MYD</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/help_category.frm to /var/lib/mysql/mysql/help_category.frm</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/help_category.MYI to /var/lib/mysql/mysql/help_category.MYI</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/help_category.MYD to /var/lib/mysql/mysql/help_category.MYD</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/help_keyword.frm to /var/lib/mysql/mysql/help_keyword.frm</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/help_keyword.MYI to /var/lib/mysql/mysql/help_keyword.MYI</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/help_keyword.MYD to /var/lib/mysql/mysql/help_keyword.MYD</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/help_relation.frm to /var/lib/mysql/mysql/help_relation.frm</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/help_relation.MYI to /var/lib/mysql/mysql/help_relation.MYI</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/help_relation.MYD to /var/lib/mysql/mysql/help_relation.MYD</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/help_topic.frm to /var/lib/mysql/mysql/help_topic.frm</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/help_topic.MYI to /var/lib/mysql/mysql/help_topic.MYI</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:36:59 [01] Copying ./mysql/help_topic.MYD to /var/lib/mysql/mysql/help_topic.MYD</span><br><span class="line">160901 11:36:59 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/host.frm to /var/lib/mysql/mysql/host.frm</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/host.MYI to /var/lib/mysql/mysql/host.MYI</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/host.MYD to /var/lib/mysql/mysql/host.MYD</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/ndb_binlog_index.frm to /var/lib/mysql/mysql/ndb_binlog_index.frm</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/ndb_binlog_index.MYI to /var/lib/mysql/mysql/ndb_binlog_index.MYI</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/plugin.frm to /var/lib/mysql/mysql/plugin.frm</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/plugin.MYI to /var/lib/mysql/mysql/plugin.MYI</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/proc.frm to /var/lib/mysql/mysql/proc.frm</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/proc.MYD to /var/lib/mysql/mysql/proc.MYD</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/procs_priv.MYI to /var/lib/mysql/mysql/procs_priv.MYI</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/proxies_priv.frm to /var/lib/mysql/mysql/proxies_priv.frm</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/proxies_priv.MYD to /var/lib/mysql/mysql/proxies_priv.MYD</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/servers.MYI to /var/lib/mysql/mysql/servers.MYI</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/time_zone.frm to /var/lib/mysql/mysql/time_zone.frm</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./mysql/time_zone_leap_second.MYD to /var/lib/mysql/mysql/time_zone_leap_second.MYD</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./test/db.opt to /var/lib/mysql/test/db.opt</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./performance_schema/db.opt to /var/lib/mysql/performance_schema/db.opt</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./performance_schema/cond_instances.frm to /var/lib/mysql/performance_schema/cond_instances.frm</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./performance_schema/events_waits_current.frm to /var/lib/mysql/performance_schema/events_waits_current.frm</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:00 [01] Copying ./performance_schema/events_waits_history.frm to /var/lib/mysql/performance_schema/events_waits_history.frm</span><br><span class="line">160901 11:37:00 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./performance_schema/events_waits_history_long.frm to /var/lib/mysql/performance_schema/events_waits_history_long.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./performance_schema/events_waits_summary_by_instance.frm to /var/lib/mysql/performance_schema/events_waits_summary_by_instance.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./performance_schema/events_waits_summary_by_thread_by_event_name.frm to /var/lib/mysql/performance_schema/events_waits_summary_by_thread_by_event_name.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./performance_schema/events_waits_summary_global_by_event_name.frm to /var/lib/mysql/performance_schema/events_waits_summary_global_by_event_name.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./performance_schema/file_instances.frm to /var/lib/mysql/performance_schema/file_instances.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./performance_schema/file_summary_by_event_name.frm to /var/lib/mysql/performance_schema/file_summary_by_event_name.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./performance_schema/file_summary_by_instance.frm to /var/lib/mysql/performance_schema/file_summary_by_instance.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./performance_schema/mutex_instances.frm to /var/lib/mysql/performance_schema/mutex_instances.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./performance_schema/performance_timers.frm to /var/lib/mysql/performance_schema/performance_timers.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./performance_schema/rwlock_instances.frm to /var/lib/mysql/performance_schema/rwlock_instances.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./performance_schema/setup_consumers.frm to /var/lib/mysql/performance_schema/setup_consumers.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./performance_schema/setup_instruments.frm to /var/lib/mysql/performance_schema/setup_instruments.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./performance_schema/setup_timers.frm to /var/lib/mysql/performance_schema/setup_timers.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./performance_schema/threads.frm to /var/lib/mysql/performance_schema/threads.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./db1/db.opt to /var/lib/mysql/db1/db.opt</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./db1/t1.frm to /var/lib/mysql/db1/t1.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./db2/db.opt to /var/lib/mysql/db2/db.opt</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./db2/t1.frm to /var/lib/mysql/db2/t1.frm</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:01 [01] Copying ./xtrabackup_info to /var/lib/mysql/xtrabackup_info</span><br><span class="line">160901 11:37:01 [01]        ...done</span><br><span class="line">160901 11:37:02 [01] Copying ./xtrabackup_binlog_pos_innodb to /var/lib/mysql/xtrabackup_binlog_pos_innodb</span><br><span class="line">160901 11:37:02 [01]        ...done</span><br><span class="line">160901 11:37:02 completed OK!</span><br><span class="line">[root@mastera0 mysql]#</span><br><span class="line">[root@mastera0 mysql]# ll /var/lib/mysql</span><br><span class="line">total 28688</span><br><span class="line">drwx------. 2 root root       32 Sep  1 11:37 db1</span><br><span class="line">drwx------. 2 root root       32 Sep  1 11:37 db2</span><br><span class="line">-rw-r-----. 1 root root 18874368 Sep  1 11:36 ibdata1</span><br><span class="line">-rw-r-----. 1 root root  5242880 Sep  1 11:36 ib_logfile0</span><br><span class="line">-rw-r-----. 1 root root  5242880 Sep  1 11:36 ib_logfile1</span><br><span class="line">drwx------. 2 root root     4096 Sep  1 11:37 mysql</span><br><span class="line">drwx------. 2 root root     4096 Sep  1 11:37 performance_schema</span><br><span class="line">drwx------. 2 root root       19 Sep  1 11:37 test</span><br><span class="line">-rw-r-----. 1 root root       38 Sep  1 11:37 xtrabackup_binlog_pos_innodb</span><br><span class="line">-rw-r-----. 1 root root      473 Sep  1 11:37 xtrabackup_info</span><br><span class="line">[root@mastera0 mysql]# ll /var/lib/mysql -d</span><br><span class="line">drwxr-xr-x. 7 mysql mysql 4096 Sep  1 11:37 /var/lib/mysql</span><br><span class="line">[root@mastera0 mysql]# chown mysql. /var/lib/mysql/ -R</span><br><span class="line">[root@mastera0 mysql]# ll /var/lib/mysql</span><br><span class="line">total 28688</span><br><span class="line">drwx------. 2 mysql mysql       32 Sep  1 11:37 db1</span><br><span class="line">drwx------. 2 mysql mysql       32 Sep  1 11:37 db2</span><br><span class="line">-rw-r-----. 1 mysql mysql 18874368 Sep  1 11:36 ibdata1</span><br><span class="line">-rw-r-----. 1 mysql mysql  5242880 Sep  1 11:36 ib_logfile0</span><br><span class="line">-rw-r-----. 1 mysql mysql  5242880 Sep  1 11:36 ib_logfile1</span><br><span class="line">drwx------. 2 mysql mysql     4096 Sep  1 11:37 mysql</span><br><span class="line">drwx------. 2 mysql mysql     4096 Sep  1 11:37 performance_schema</span><br><span class="line">drwx------. 2 mysql mysql       19 Sep  1 11:37 test</span><br><span class="line">-rw-r-----. 1 mysql mysql       38 Sep  1 11:37 xtrabackup_binlog_pos_innodb</span><br><span class="line">-rw-r-----. 1 mysql mysql      473 Sep  1 11:37 xtrabackup_info</span><br><span class="line">[root@mastera0 mysql]# getenforce</span><br><span class="line">Permissive</span><br><span class="line">[root@mastera0 mysql]#</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]# systemctl start maraidb</span><br><span class="line">Failed to start maraidb.service: Unit maraidb.service failed to load: No such file or directory.</span><br><span class="line">[root@mastera0 mysql]# systemctl start mariadb</span><br><span class="line">[root@mastera0 mysql]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1 ;</span><br><span class="line">+-----+</span><br><span class="line">| id  |</span><br><span class="line">+-----+</span><br><span class="line">|   3 |</span><br><span class="line">|   4 |</span><br><span class="line">|   5 |</span><br><span class="line">|   6 |</span><br><span class="line">|   7 |</span><br><span class="line">|   8 |</span><br><span class="line">|   9 |</span><br><span class="line">|  10 |</span><br><span class="line">|  11 |</span><br><span class="line">|  12 |</span><br><span class="line">|  13 |</span><br><span class="line">|  14 |</span><br><span class="line">| 100 |</span><br><span class="line">+-----+</span><br><span class="line">13 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line">===========================================</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¢é‡å¤‡ä»½å¹¶è¿˜åŸ</span></span><br><span class="line">[root@mastera0 mysql]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 4</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  3 |</span><br><span class="line">|  4 |</span><br><span class="line">|  5 |</span><br><span class="line">|  6 |</span><br><span class="line">|  7 |</span><br><span class="line">|  8 |</span><br><span class="line">|  9 |</span><br><span class="line">| 10 |</span><br><span class="line">| 11 |</span><br><span class="line">| 12 |</span><br><span class="line">| 13 |</span><br><span class="line">| 14 |</span><br><span class="line">+----+</span><br><span class="line">12 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values (100);</span><br><span class="line">Query OK, 1 row affected (0.13 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># å…¨å¤‡ä»½</span></span></span><br><span class="line">[root@mastera0 ~]# rm -rf /tmp/backup/*</span><br><span class="line">[root@mastera0 ~]# innobackupex --user=root --password=uplooking /tmp/backup</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+-----+</span><br><span class="line">| id  |</span><br><span class="line">+-----+</span><br><span class="line">|   3 |</span><br><span class="line">|   4 |</span><br><span class="line">|   5 |</span><br><span class="line">|   6 |</span><br><span class="line">|   7 |</span><br><span class="line">|   8 |</span><br><span class="line">|   9 |</span><br><span class="line">|  10 |</span><br><span class="line">|  11 |</span><br><span class="line">|  12 |</span><br><span class="line">|  13 |</span><br><span class="line">|  14 |</span><br><span class="line">| 100 |</span><br><span class="line">+-----+</span><br><span class="line">13 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values (101);</span><br><span class="line">Query OK, 1 row affected (0.22 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¢é‡1</span></span><br><span class="line">[root@mastera0 ~]# innobackupex --user=root --password=uplooking --incremental-basedir=/tmp/backup/2016-09-01_14-07-43/ --incremental /tmp/backup</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values (102);</span><br><span class="line">Query OK, 1 row affected (0.06 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¢é‡2</span></span><br><span class="line">[root@mastera0 ~]# innobackupex --user=root --password=uplooking --incremental-basedir=/tmp/backup/2016-09-01_14-08-35 --incremental /tmp/backup</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values (103);</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¢é‡3</span></span><br><span class="line">[root@mastera0 ~]# innobackupex --user=root --password=uplooking --incremental-basedir=/tmp/backup/2016-09-01_14-09-39 --incremental /tmp/backup</span><br><span class="line"></span><br><span class="line">==============</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿˜åŸ</span></span><br><span class="line">[root@mastera0 mysql]# systemctl stop mariadb</span><br><span class="line">[root@mastera0 mysql]# rm -rf /var/lib/mysql/*</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]# innobackupex --apply-log  --redo-only /tmp/backup/2016-09-01_14-07-43</span><br><span class="line">[root@mastera0 mysql]# innobackupex --apply-log  --redo-only /tmp/backup/2016-09-01_14-07-43 --incremental-dir=/tmp/backup/2016-09-01_14-08-35/</span><br><span class="line">[root@mastera0 mysql]# innobackupex --apply-log  --redo-only /tmp/backup/2016-09-01_14-07-43 --incremental-dir=/tmp/backup/2016-09-01_14-09-39</span><br><span class="line">[root@mastera0 mysql]# innobackupex --apply-log  --redo-only /tmp/backup/2016-09-01_14-07-43 --incremental-dir=/tmp/backup/2016-09-01_14-10-09</span><br><span class="line">[root@mastera0 mysql]# innobackupex --apply-log  /tmp/backup/2016-09-01_14-07-43</span><br><span class="line">[root@mastera0 mysql]# innobackupex --copy-back  /tmp/backup/2016-09-01_14-07-43</span><br><span class="line">[root@mastera0 mysql]# ll /var/lib/mysql</span><br><span class="line">total 28688</span><br><span class="line">drwx------. 2 root root       32 Sep  1 14:14 db1</span><br><span class="line">drwx------. 2 root root       32 Sep  1 14:14 db2</span><br><span class="line">-rw-r-----. 1 root root 18874368 Sep  1 14:14 ibdata1</span><br><span class="line">-rw-r-----. 1 root root  5242880 Sep  1 14:14 ib_logfile0</span><br><span class="line">-rw-r-----. 1 root root  5242880 Sep  1 14:14 ib_logfile1</span><br><span class="line">drwx------. 2 root root     4096 Sep  1 14:14 mysql</span><br><span class="line">drwx------. 2 root root     4096 Sep  1 14:14 performance_schema</span><br><span class="line">drwx------. 2 root root       19 Sep  1 14:14 test</span><br><span class="line">-rw-r-----. 1 root root       41 Sep  1 14:14 xtrabackup_binlog_pos_innodb</span><br><span class="line">-rw-r-----. 1 root root      550 Sep  1 14:14 xtrabackup_info</span><br><span class="line">[root@mastera0 mysql]# chown mysql. /var/lib/mysql -R</span><br><span class="line">[root@mastera0 mysql]# ll /var/lib/mysql</span><br><span class="line">total 28688</span><br><span class="line">drwx------. 2 mysql mysql       32 Sep  1 14:14 db1</span><br><span class="line">drwx------. 2 mysql mysql       32 Sep  1 14:14 db2</span><br><span class="line">-rw-r-----. 1 mysql mysql 18874368 Sep  1 14:14 ibdata1</span><br><span class="line">-rw-r-----. 1 mysql mysql  5242880 Sep  1 14:14 ib_logfile0</span><br><span class="line">-rw-r-----. 1 mysql mysql  5242880 Sep  1 14:14 ib_logfile1</span><br><span class="line">drwx------. 2 mysql mysql     4096 Sep  1 14:14 mysql</span><br><span class="line">drwx------. 2 mysql mysql     4096 Sep  1 14:14 performance_schema</span><br><span class="line">drwx------. 2 mysql mysql       19 Sep  1 14:14 test</span><br><span class="line">-rw-r-----. 1 mysql mysql       41 Sep  1 14:14 xtrabackup_binlog_pos_innodb</span><br><span class="line">-rw-r-----. 1 mysql mysql      550 Sep  1 14:14 xtrabackup_info</span><br><span class="line">[root@mastera0 mysql]# systemctl start mariadb</span><br><span class="line">[root@mastera0 mysql]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+-----+</span><br><span class="line">| id  |</span><br><span class="line">+-----+</span><br><span class="line">|   3 |</span><br><span class="line">|   4 |</span><br><span class="line">|   5 |</span><br><span class="line">|   6 |</span><br><span class="line">|   7 |</span><br><span class="line">|   8 |</span><br><span class="line">|   9 |</span><br><span class="line">|  10 |</span><br><span class="line">|  11 |</span><br><span class="line">|  12 |</span><br><span class="line">|  13 |</span><br><span class="line">|  14 |</span><br><span class="line">| 100 |</span><br><span class="line">| 101 |</span><br><span class="line">| 102 |</span><br><span class="line">| 103 |</span><br><span class="line">+-----+</span><br><span class="line">16 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="MySQL-æ—¥å¿—çš„åˆ†ç±»"><a href="#MySQL-æ—¥å¿—çš„åˆ†ç±»" class="headerlink" title="MySQL æ—¥å¿—çš„åˆ†ç±»"></a>MySQL æ—¥å¿—çš„åˆ†ç±»</h4><table>
<thead>
<tr>
<th align="left">æ—¥å¿—åˆ†ç±»</th>
<th align="left">è§£é‡Š</th>
<th align="left">é…ç½®å­—æ®µ</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å¯åŠ¨æ—¥å¿—</td>
<td align="left">æ’é”™æ—¥å¿—</td>
<td align="left">/var/log/mariadb/mariadb.log    æ’é”™çš„</td>
</tr>
<tr>
<td align="left">å†™æ—¥å¿—</td>
<td align="left">äºŒè¿›åˆ¶æ—¥å¿—</td>
<td align="left">é»˜è®¤ä¸æ‰“å¼€ï¼Œè®°å½•å†™æ“ä½œddl dcl dml    å¤‡ä»½</td>
</tr>
<tr>
<td align="left">è¯»æ—¥å¿—</td>
<td align="left">æ…¢æŸ¥è¯¢æ—¥å¿—    é»˜è®¤ä¸æ‰“å¼€ï¼Œè®°å½•è¯»æ“ä½œdql</td>
<td align="left">æ€§èƒ½è°ƒä¼˜</td>
</tr>
</tbody></table>
<h4 id="äºŒè¿›åˆ¶æ—¥å¿—çš„ç®¡ç†å’Œå¤‡ä»½"><a href="#äºŒè¿›åˆ¶æ—¥å¿—çš„ç®¡ç†å’Œå¤‡ä»½" class="headerlink" title="äºŒè¿›åˆ¶æ—¥å¿—çš„ç®¡ç†å’Œå¤‡ä»½"></a>äºŒè¿›åˆ¶æ—¥å¿—çš„ç®¡ç†å’Œå¤‡ä»½</h4><p>æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ—¥å¿—æ˜¯å¤‡ä»½çš„æœ€é‡è¦å› ç´ ä¹‹ä¸€ã€‚å®ƒä»¬å¯¹äºåŸºäºæ—¶é—´ç‚¹çš„æ¢å¤æ˜¯å¿…éœ€çš„ï¼Œå¹¶ä¸”é€šå¸¸æ¯”æ•°æ®è¦å°ï¼Œæ‰€ä»¥æ›´å®¹æ˜“è¿›è¡Œé¢‘ç¹çš„å¤‡ä»½ã€‚å¦‚æœæœ‰æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®å¤‡ä»½å’Œæ‰€æœ‰ä»é‚£æ—¶ä»¥åçš„äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå°±å¯ä»¥é‡æ”¾è‡ªä»ä¸Šæ¬¡å…¨å¤‡ä»¥æ¥çš„äºŒè¿›åˆ¶æ—¥å¿—å¹¶â€œå‰æ»šâ€æ‰€æœ‰çš„å˜æ›´ã€‚</p>
<p>MySQLå¤åˆ¶ä¹Ÿä½¿ç”¨äºŒè¿›åˆ¶æ—¥å¿—ã€‚å› æ­¤å¤‡ä»½å’Œæ¢å¤çš„ç­–ç•¥ç»å¸¸å’Œå¤åˆ¶é…ç½®ç›¸äº’å½±å“ã€‚</p>
<p>äºŒè¿›åˆ¶æ—¥å¿—å¾ˆâ€œç‰¹åˆ«â€ã€‚å¦‚æœä¸¢å¤±äº†æ•°æ®ï¼Œä½ ä¸€å®šä¸å¸Œæœ›åŒæ—¶ä¸¢å¤±äº†äºŒè¿›åˆ¶æ—¥å¿—ã€‚ä¸ºäº†è®©è¿™ç§æƒ…å†µå‘ç”Ÿçš„å‡ ç‡å‡å°‘åˆ°æœ€å°ï¼Œå¯ä»¥åœ¨ä¸åŒçš„å·ä¸Šä¿å­˜æ•°æ®å’ŒäºŒè¿›åˆ¶æ—¥å¿—ã€‚å³ä½¿åœ¨LVMä¸‹ç”ŸæˆäºŒè¿›åˆ¶æ—¥å¿—çš„å¿«ç…§ï¼Œå¯ä»¥æ˜¯å¯ä»¥çš„ã€‚ä¸ºäº†é¢å¤–çš„å®‰å…¨èµ·è§ï¼Œå¯ä»¥å°†å®ƒä»¬ä¿å­˜åœ¨SANä¸Šï¼Œæˆ–ç”¨DRBDå¤åˆ¶åˆ°å¦å¤–ä¸€ä¸ªè®¾å¤‡ä¸Šã€‚</p>
<p>ç»å¸¸å¤‡ä»½äºŒè¿›åˆ¶æ—¥å¿—æ˜¯ä¸ªå¥½æ³¨æ„ã€‚å¦‚æœä¸èƒ½æ‰¿å—ä¸¢å¤±è¶…è¿‡30åˆ†é’Ÿæ•°æ®çš„ä»·å€¼ï¼Œè‡³å°‘è¦æ¯30åˆ†é’Ÿå°±å¤‡ä»½ä¸€æ¬¡ã€‚ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªé…ç½®<code>--log_slave_update</code>çš„åªè¯»å¤‡åº“ï¼Œè¿™æ ·å¯ä»¥è·å¾—é¢å¤–çš„å®‰å…¨æ€§ã€‚å¤‡åº“ä¸Šæ—¥å¿—ä½ç½®ä¸ä¸»åº“ä¸åŒ¹é…ï¼Œä½†æ‰¾åˆ°æ¢å¤æ—¶æ­£ç¡®çš„ä½ç½®å¹¶ä¸éš¾ã€‚æœ€åï¼Œä»mysql5.6ç‰ˆæœ¬å¼€å§‹<code>mysqlbinlog</code>æœ‰ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„ç‰¹æ€§ï¼Œå¯è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šæ¥å®ç°äºŒè¿›åˆ¶æ—¥å¿—åšé•œåƒï¼Œæ¯”èµ·è¿è¡Œ<code>mysqld</code>å®ä¾‹è¦ç®€å•å’Œè½»ä¾¿ã€‚å®ƒä¸è€ç‰ˆæœ¬æ—¶å‘åå…¼å®¹çš„ã€‚</p>
<h5 id="å¦‚ä½•æ‰“å¼€äºŒè¿›åˆ¶æ—¥å¿—"><a href="#å¦‚ä½•æ‰“å¼€äºŒè¿›åˆ¶æ—¥å¿—" class="headerlink" title="å¦‚ä½•æ‰“å¼€äºŒè¿›åˆ¶æ—¥å¿—"></a>å¦‚ä½•æ‰“å¼€äºŒè¿›åˆ¶æ—¥å¿—</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1)configure	ä¿®æ”¹é…ç½®æ–‡ä»¶&#x2F;etc&#x2F;my.cnf</span><br><span class="line">2)log-bin&#x3D;	æ·»åŠ äºŒè¿›åˆ¶æ—¥å¿—å­˜æ”¾çš„è·¯å¾„ï¼Œä»¥åŠäºŒè¿›åˆ¶æ—¥å¿—çš„åå­—log-bin&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql-log&#x2F;mastera</span><br><span class="line">3)mkdir 	åˆ›å»ºç›®å½•</span><br><span class="line">4)UGO,selinux	ä¿®æ”¹æƒé™mysql:mysql;selinux å…è®¸</span><br><span class="line">5)restart mariadb é‡å¯æœåŠ¡</span><br></pre></td></tr></table></figure>

<h5 id="å¦‚ä½•æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—"><a href="#å¦‚ä½•æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—"></a>å¦‚ä½•æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—</h5><pre><code>index    æ—¥å¿—çš„ç´¢å¼•
000001    æ—¥å¿—</code></pre><p>äºŒè¿›åˆ¶æ—¥å¿—åŒ…å«ä¸€ç³»åˆ—çš„äº‹ä»¶ã€‚æ¯ä¸ªäº‹ä»¶æœ‰ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å¤´ï¼Œå…¶ä¸­æœ‰å„ç§ä¿¡æ¯ï¼Œä¾‹å¦‚å½“å‰æ—¶é—´æˆ³å’Œé»˜è®¤çš„æ•°æ®åº“ã€‚å¯ä»¥ä½¿ç”¨mysqlbinlogå·¥å…·æ¥æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—çš„å†…å®¹ï¼Œæ‰“å°å‡ºä¸€äº›å¤´ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè¾“å‡ºçš„ä¾‹å­ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> at 1017</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 1109 	Query	thread_id=11	exec_time=0	error_code=0</span></span><br><span class="line">SET TIMESTAMP=1472627369/*!*/;</span><br><span class="line">insert into db2.t1 values (4),(5)</span><br><span class="line">/*!*/;</span><br></pre></td></tr></table></figure>

<p><em>äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼</em></p>
<p>ç¬¬ä¸€è¡ŒåŒ…å«æ—¥å¿—æ–‡ä»¶å†…çš„åç§»å­—èŠ‚å€¼ï¼ˆä½ç½®ç¼–å·positionï¼‰ï¼Œæœ¬ä¾‹ä¸­ä¸º1017</p>
<p>ç¬¬äºŒè¡ŒåŒ…å«å¦‚ä¸‹å‡ é¡¹ï¼š</p>
<ul>
<li>äº‹ä»¶çš„æ—¥æœŸå’Œæ—¶é—´ï¼ŒMySQLä¼šç”¨å®ƒä»¬æ¥äº§ç”ŸSET TIMESTAMPè¯­å¥ã€‚</li>
<li>åŸæœåŠ¡å™¨çš„æœåŠ¡å™¨IDï¼Œå¯¹äºé˜²æ­¢å¤åˆ¶ä¹‹é—´æ— é™å¾ªç¯å’Œå…¶ä»–é—®é¢˜æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚</li>
<li>end_log_posï¼Œä¸‹ä¸€ä¸ªäº‹ä»¶çš„åç§»å­—èŠ‚å€¼ã€‚è¯¥å€¼å¯¹ä¸€ä¸ªå¤šè¯­å¥äº‹åŠ¡ä¸­çš„å¤§éƒ¨åˆ†äº‹ä»¶æ˜¯ä¸æ­£ç¡®çš„ã€‚åœ¨æ­¤ç±»äº‹åŠ¡è¿‡ç¨‹ä¸­ï¼ŒMySQLçš„ä¸»åº“ä¼šå¤åˆ¶äº‹ä»¶åˆ°ä¸€ä¸ªç¼“å†²åŒºï¼Œä½†è¿™æ ·åšçš„æ—¶å€™å®ƒå¹¶ä¸çŸ¥é“ä¸‹ä¸ªæ—¥å¿—äº‹ä»¶çš„ä½ç½®ã€‚</li>
<li>äº‹ä»¶ç±»å‹ï¼Œæœ¬ä¾‹ä¸­çš„ç±»å‹ä¸ºQueryï¼Œä½†è¿˜æœ‰è®¸å¤šä¸åŒçš„ç±»å‹ã€‚</li>
<li>åŸæœåŠ¡å™¨ä¸Šæ‰§è¡Œäº‹ä»¶çš„çº¿ç¨‹IDï¼Œå¯¹äºå®¡è®¡å’Œæ‰§è¡ŒCONNECTION_IDï¼ˆï¼‰å‡½æ•°å¾ˆé‡è¦ã€‚</li>
<li>exec_timeï¼Œè¿™æ˜¯è¯­å¥çš„æ—¶é—´æˆ³å’Œå†™å…¥äºŒè¿›åˆ¶æ—¥å¿—çš„äº‹ä»¶åªå·®ã€‚ä¸è¦ä¾èµ–è¿™ä¸ªå€¼ï¼Œå› ä¸ºå®ƒå¯èƒ½åœ¨å¤åˆ¶è½åçš„å¤‡åº“ä¸Šä¼šæœ‰å¾ˆå¤§çš„åå·®ã€‚</li>
<li>åœ¨åŸæœåŠ¡å™¨ä¸Šäº‹ä»¶äº§ç”Ÿçš„é”™è¯¯ä»£ç ã€‚å¦‚æœäº‹ä»¶åœ¨å¤‡åº“ä¸Šé‡æ”¾æ—¶å¯¼è‡´ä¸åŒçš„é”™è¯¯ï¼Œé‚£ä¹ˆå¤åˆ¶å°†å› å®‰å…¨é¢„è­¦è€Œå¤±è´¥ã€‚</li>
</ul>
<p><em>å®‰å…¨æ¸…é™¤äºŒè¿›åˆ¶æ—¥å¿—</em></p>
<p>éœ€è¦å†³å®šæ—¥å¿—çš„è¿‡æœŸç­–ç•¥ä»¥é˜²æ­¢ç£ç›˜è¢«äºŒè¿›åˆ¶æ—¥å¿—å†™æ»¡ã€‚æ—¥å¿—å¢é•¿å¤šå¤§å–å†³äºè´Ÿè½½å’Œæ—¥å¿—æ ¼å¼ã€‚æˆ‘ä»¬å»ºè®®ï¼Œå¦‚æœå¯èƒ½ï¼Œåªè¦æ—¥å¿—æœ‰ç”¨å°±å°½å¯èƒ½ä¿ç•™ã€‚ä¿ç•™æ—¥å¿—å¯¹äºè®¾ç½®å¤åˆ¶ã€åˆ†ææœåŠ¡å™¨è´Ÿè½½ã€å®¡è®¡å’Œä»ä¸Šæ¬¡å…¨å¤‡æŒ‰æ—¶é—´ç‚¹è¿›è¡Œæ¢å¤ï¼Œéƒ½å¾ˆæœ‰å¸®åŠ©ã€‚å½“å†³å®šæƒ³è¦ä¿ç•™æ—¥å¿—å¤šä¹…æ—¶ï¼Œåº”è¯¥è€ƒè™‘è¿™äº›éœ€æ±‚ã€‚</p>
<p>ä¸€ä¸ªå¸¸è§çš„è®¾ç½®æ—¶ä½¿ç”¨<code>expire_logs_days</code>å˜é‡æ¥å‘Šè¯‰MySQLå®šæœŸæ¸…ç†æ—¥å¿—ã€‚è¿™ä¸ªå˜é‡ç›´åˆ°MySQL4.1æ‰å¼•å…¥ï¼Œåœ¨æ­¤ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¿…é¡»æ‰‹åŠ¨æ¸…ç†äºŒè¿›åˆ¶æ—¥å¿—ã€‚åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œç”¨<code>rm</code>åˆ é™¤æ—¥å¿—ä¼šå¯¼è‡´<code>mysqlbin.index</code>çŠ¶æ€æ–‡ä»¶ä¸ç£ç›˜ä¸Šçš„æ–‡ä»¶ä¸ä¸€è‡´ï¼Œæœ‰äº›è¯­å¥ï¼Œä¾‹å¦‚s<code>how master logs</code>å¯èƒ½ä¼šå—åˆ°å½±å“è€Œå¤±è´¥ã€‚æ‰‹åŠ¨ä¿®æ”¹<code>mysqlbin.index</code>æ–‡ä»¶ä¹Ÿä¸èƒ½ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚åº”è¯¥ç”¨ç±»æ¬¡ä¸‹é¢çš„<code>cron</code>å‘½ä»¤ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">0 0 * * * /usr/bin/mysql -e "purge master logs before current_date - interval n day"</span><br></pre></td></tr></table></figure>

<p><code>expire_logs_days</code>è®¾ç½®åœ¨æœåŠ¡å™¨å¯åŠ¨æˆ–MySQLåˆ‡æ¢äºŒè¿›åˆ¶æ—¥å¿—æ—¶ç”Ÿæ•ˆï¼Œå› æ­¤ï¼Œå¦‚æœäºŒè¿›åˆ¶æ—¥å¿—ä»æ²¡æœ‰å¢é•¿å’Œåˆ‡æ¢ï¼ŒæœåŠ¡å™¨ä¸ä¼šæ¸…é™¤è€æ¡ç›®ã€‚æ­¤è®¾ç½®æ—¶é€šè¿‡æŸ¥çœ‹æ—¥å¿—çš„ä¿®æ”¹æ—¶é—´è€Œä¸æ˜¯å†…å®¹æ¥å†³å®šå“ªä¸ªæ–‡ä»¶éœ€è¦è¢«æ¸…é™¤ã€‚</p>
<p><em>MYSQLBINLOGå‘½ä»¤</em></p>
<p>mysqlbinlog /var/lib/mysql-log/mariadb.000001</p>
<ul>
<li>â€“start-datetime=name èµ·å§‹æ—¶é—´ç‚¹</li>
<li>â€“stop-datetime=name  ç»“æŸæ—¶é—´ç‚¹</li>
</ul>
<p>mysqlbinlog â€“stop-datetime=â€2016-08-31 11:19:12â€</p>
<ul>
<li>â€“start-position=pos  ä½ç½®ç¼–å· å”¯ä¸€ï¼Œå¢å¤§ at</li>
<li>â€“stop-position=pos</li>
</ul>
<h4 id="åŸºäºäºŒè¿›åˆ¶æ—¥å¿—çš„å®æ—¶å¢é‡è¿˜åŸ"><a href="#åŸºäºäºŒè¿›åˆ¶æ—¥å¿—çš„å®æ—¶å¢é‡è¿˜åŸ" class="headerlink" title="åŸºäºäºŒè¿›åˆ¶æ—¥å¿—çš„å®æ—¶å¢é‡è¿˜åŸ"></a>åŸºäºäºŒè¿›åˆ¶æ—¥å¿—çš„å®æ—¶å¢é‡è¿˜åŸ</h4><p><img src="pic/18-mysqlbinlog1.emf.png" alt="mysqlbinlog"></p>
<h5 id="æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿä¸€"><a href="#æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿä¸€" class="headerlink" title="æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿä¸€"></a>æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿä¸€</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">	1)11:00 mysqldump db1.t1 1 2 3 4 5 6</span><br><span class="line">	2)11:00-12:00 insert 7 8 9 update 1--ã€‹10 delete 2</span><br><span class="line">	3)12:00 äººä¸ºè¯¯æ“ä½œ delete db1.t1</span><br><span class="line">--------------------------</span><br><span class="line">	æ¢å¤æ•°æ®ï¼Œè¿˜åŸçš„æ ‡å‡†æ­¥éª¤ï¼š</span><br><span class="line">	1)åœæ­¢æœåŠ¡	systemctl stop mariadb</span><br><span class="line">	2)æ¸…ç©ºç¯å¢ƒ	rm -rf &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;*</span><br><span class="line">	3)å¯åŠ¨æœåŠ¡	systemctl start mariadb</span><br><span class="line">	4)å¯¼å…¥å…¨å¤‡ä»½æ•°æ®	mysql &lt; &#x2F;tmp&#x2F;mysql.11.sql</span><br><span class="line">	5)åˆ·æ–°æˆæƒ	&gt; flush privileges;</span><br><span class="line">	6)æµ‹è¯•ï¼Œå…¨å¤‡ä»½æ•°æ®æ˜¯å¦æ­£ç¡®	&gt; select * from db1.t1;</span><br><span class="line">	7)æŸ¥çœ‹åˆ†æäºŒè¿›åˆ¶æ—¥å¿—---ã€‹å¾—åˆ°æ­£ç¡®çš„æ“ä½œå‘½ä»¤ï¼Œè·³è¿‡é”™è¯¯çš„	mysqlbinlog &#x2F;var&#x2F;lib&#x2F;mysql-log&#x2F;master.00000X</span><br><span class="line">			* è‡ªå·±è®°ä¸‹æ¥ï¼Œåšå…¨å¤‡ä»½çš„æ—¶å€™</span><br><span class="line">			* è¯·åˆ«äººè®°ï¼Œå…¨å¤‡ä»½æ–‡ä»¶ --master-data&#x3D;2 æ–‡ä»¶çš„ç¬¬22è¡Œ</span><br><span class="line">			åˆ†æï¼š</span><br><span class="line">				* è‡ªå·±çœ‹ï¼Œç”¨çœ¼ç›æ‰¾</span><br><span class="line">				* grep æˆªå–å…³é”®å­— ï¼Œdelete drop -B æ˜¾ç¤ºå‰é¢çš„å‡ è¡Œ</span><br><span class="line">	8)å¯¼å…¥å¢é‡å¤‡ä»½	é€šè¿‡ç®¡é“å¯¼å…¥æ•°æ®åº“</span><br><span class="line">			mysqlbinlog --stop-datetime&#x3D;&#39;2016-08-31 11:19:12&#39; &#x2F;var&#x2F;lib&#x2F;mysql-log&#x2F;mastera.000002 | mysql -uroot -puplooking</span><br><span class="line">	9)æµ‹è¯•ï¼ŒæŸ¥çœ‹å¢é‡å¤‡ä»½æ•°æ®æ˜¯å¦æ­£ç¡®</span><br><span class="line">	10)å…¨å¤‡ä»½	mysqldump -uroot -puplooking -A --single-transaction --master-data&#x3D;2 --flush-logs &gt; &#x2F;tmp&#x2F;mysql.12.mysql</span><br></pre></td></tr></table></figure>

<h5 id="æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹ŸäºŒ"><a href="#æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹ŸäºŒ" class="headerlink" title="æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹ŸäºŒ"></a>æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹ŸäºŒ</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1)12:00 mysqldump db1.t1 3 4 5 6 7 8 9 10</span><br><span class="line">2)12:00-14:00 	æ­£å¸¸çš„å†™ï¼šinsert db1.t1  11 12</span><br><span class="line">		äººä¸ºè¯¯æ“ä½œ delete from db1.t1;</span><br><span class="line">		æ­£å¸¸çš„å†™ï¼š</span><br><span class="line">			Create database db2;</span><br><span class="line">			Create table db2.t1 (id int);</span><br><span class="line">		äººä¸ºè¯¯æ“ä½œ</span><br><span class="line">			Drop table  db2.t1;</span><br><span class="line">3)14:00 æ¢å¤</span><br><span class="line"></span><br><span class="line">start	å¼€å¤´</span><br><span class="line">stop	2016-08-31 13:45:02</span><br><span class="line"></span><br><span class="line">start	2016-08-31 13:45:10</span><br><span class="line">stop	2016-08-31 13:45:42</span><br></pre></td></tr></table></figure>
<p><img src="pic/19-mysqlbinlog2.emf.png" alt="mysqlbinlog3"></p>
<h5 id="æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿä¸‰"><a href="#æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿä¸‰" class="headerlink" title="æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿä¸‰"></a>æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿä¸‰</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1)14:00 	mysqldump db1.t1 3 4 5 6 7 8 9 10 11 12 db2.t1</span><br><span class="line">2)14:00-16:00 	</span><br><span class="line">		insert into db1.t1 values (13),(14);</span><br><span class="line">		delete from db1.t1;</span><br><span class="line">		insert into db2.t1 values (1),(2),(3);</span><br><span class="line">		delete from db2.t1;</span><br><span class="line">		insert into db2.t1 values (4),(5);</span><br><span class="line">3)16:00 æ¢å¤</span><br><span class="line">		start at 245	at 598  at 953</span><br><span class="line">		stop  at 430	at 785	at 1136</span><br></pre></td></tr></table></figure>

<h5 id="è¯¾å ‚å®æˆ˜5ï¼šåŸºäºäºŒè¿›åˆ¶æ—¥å¿—æ—¶é—´ç‚¹å’Œä½ç½®çš„æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿ"><a href="#è¯¾å ‚å®æˆ˜5ï¼šåŸºäºäºŒè¿›åˆ¶æ—¥å¿—æ—¶é—´ç‚¹å’Œä½ç½®çš„æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿ" class="headerlink" title="è¯¾å ‚å®æˆ˜5ï¼šåŸºäºäºŒè¿›åˆ¶æ—¥å¿—æ—¶é—´ç‚¹å’Œä½ç½®çš„æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿ"></a>è¯¾å ‚å®æˆ˜5ï¼šåŸºäºäºŒè¿›åˆ¶æ—¥å¿—æ—¶é—´ç‚¹å’Œä½ç½®çš„æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿ</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ‰“å¼€äºŒè¿›åˆ¶æ—¥å¿— open binlog</span></span><br><span class="line">[root@mastera0 ~]# setenforce 0</span><br><span class="line">[root@mastera0 ~]# getenforce</span><br><span class="line">Permissive</span><br><span class="line">[root@mastera0 ~]# vim /etc/my.cnf</span><br><span class="line">[root@mastera0 ~]# mkdir /var/lib/mysql-log</span><br><span class="line">[root@mastera0 ~]# chown mysql. /var/lib/mysql-log</span><br><span class="line">[root@mastera0 ~]# ll -d /var/lib/mysql-log</span><br><span class="line">drwxr-xr-x. 2 mysql mysql 6 Aug 31 10:33 /var/lib/mysql-log</span><br><span class="line">[root@mastera0 ~]# systemctl start mariadb</span><br><span class="line">[root@mastera0 ~]# cd /var/lib/mysql-log</span><br><span class="line">[root@mastera0 mysql-log]# ll</span><br><span class="line">total 8</span><br><span class="line">-rw-rw----. 1 mysql mysql 245 Aug 31 10:35 mastera.000001</span><br><span class="line">-rw-rw----. 1 mysql mysql  34 Aug 31 10:35 mastera.index</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰§è¡Œå†™æ“ä½œ	ddl dcl dml</span></span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  1 |</span><br><span class="line">|  2 |</span><br><span class="line">+----+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values (3),(4);</span><br><span class="line">Query OK, 2 rows affected (0.04 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  1 |</span><br><span class="line">|  2 |</span><br><span class="line">|  3 |</span><br><span class="line">|  4 |</span><br><span class="line">+----+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values (5),(6);</span><br><span class="line">Query OK, 2 rows affected (0.03 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  1 |</span><br><span class="line">|  2 |</span><br><span class="line">|  3 |</span><br><span class="line">|  4 |</span><br><span class="line">|  5 |</span><br><span class="line">|  6 |</span><br><span class="line">+----+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—	mysqlbinlog</span></span><br><span class="line">[root@mastera0 mysql-log]# mysqlbinlog /var/lib/mysql-log/mastera.000001 |sed 's@\/\*.*\*\/@@'|sed -n '/BEGIN/,$p'</span><br><span class="line">BEGIN</span><br><span class="line">;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 309</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 10:44:02 server id 1  end_log_pos 401 	Query	thread_id=2	exec_time=0	error_code=0</span></span><br><span class="line">SET TIMESTAMP=1472611442;</span><br><span class="line">insert into db1.t1 values (3),(4)</span><br><span class="line">;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 401</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 10:44:02 server id 1  end_log_pos 428 	Xid = 5</span></span><br><span class="line">COMMIT;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 428</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 10:44:29 server id 1  end_log_pos 492 	Query	thread_id=2	exec_time=0	error_code=0</span></span><br><span class="line">SET TIMESTAMP=1472611469;</span><br><span class="line">BEGIN</span><br><span class="line">;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 492</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 10:44:29 server id 1  end_log_pos 584 	Query	thread_id=2	exec_time=0	error_code=0</span></span><br><span class="line">SET TIMESTAMP=1472611469;</span><br><span class="line">insert into db1.t1 values (5),(6)</span><br><span class="line">;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 584</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 10:44:29 server id 1  end_log_pos 611 	Xid = 7</span></span><br><span class="line">COMMIT;</span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="meta">#</span><span class="bash"> End of <span class="built_in">log</span> file</span></span><br><span class="line">ROLLBACK ;</span><br><span class="line">;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql-log]# mysqlbinlog /var/lib/mysql-log/mastera.000001 |sed 's@\/\*.*\*\/@@'|sed -n '/BEGIN/,$p'|sed -n '/^[^#]/p'</span><br><span class="line">BEGIN</span><br><span class="line">;</span><br><span class="line">SET TIMESTAMP=1472611442;</span><br><span class="line">insert into db1.t1 values (3),(4)</span><br><span class="line">;</span><br><span class="line">COMMIT;</span><br><span class="line">SET TIMESTAMP=1472611469;</span><br><span class="line">BEGIN</span><br><span class="line">;</span><br><span class="line">SET TIMESTAMP=1472611469;</span><br><span class="line">insert into db1.t1 values (5),(6)</span><br><span class="line">;</span><br><span class="line">COMMIT;</span><br><span class="line">DELIMITER ;</span><br><span class="line">ROLLBACK ;</span><br><span class="line">;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">---------------------------------------</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ•°æ®åº“å¤‡ä»½æ¢å¤æ¼”ä¹ 1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ¨¡æ‹Ÿåœºæ™¯</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## å…¨å¤‡ä»½</span></span></span><br><span class="line">[root@mastera0 ~]# mysqldump -uroot -puplooking -A --single-transaction --master-data=2 --flush-logs &gt; /tmp/mysql.11.mysql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## æ¨¡æ‹Ÿæ­£ç¡®æ“ä½œå’Œé”™è¯¯æ“ä½œ</span></span></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values (7),(8),(9);</span><br><span class="line">Query OK, 3 rows affected (0.04 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; update db1.t1 set id=10 where id=1;</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; delete from db1.t1 where id=2;</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  3 |</span><br><span class="line">|  4 |</span><br><span class="line">|  5 |</span><br><span class="line">|  6 |</span><br><span class="line">|  7 |</span><br><span class="line">|  8 |</span><br><span class="line">|  9 |</span><br><span class="line">| 10 |</span><br><span class="line">+----+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; delete from db1.t1;</span><br><span class="line">Query OK, 8 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># å¼€å§‹æ¢å¤æ•°æ®</span></span></span><br><span class="line"></span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 9</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  3 |</span><br><span class="line">|  4 |</span><br><span class="line">|  5 |</span><br><span class="line">|  6 |</span><br><span class="line">|  7 |</span><br><span class="line">|  8 |</span><br><span class="line">|  9 |</span><br><span class="line">| 10 |</span><br><span class="line">| 11 |</span><br><span class="line">| 12 |</span><br><span class="line">+----+</span><br><span class="line">10 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; desc db2.t1;</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| Field | Type    | Null | Key | Default | Extra |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| id    | int(11) | NO   | PRI | NULL    |       |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db2.t1;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># å…¨å¤‡ä»½</span></span></span><br><span class="line">[root@mastera0 ~]# mysqldump -uroot -puplooking -A --single-transaction --master-data=2 --flush-logs &gt; /tmp/mysql.12.mysql</span><br><span class="line"></span><br><span class="line">---------------------------------------</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ•°æ®åº“å¤‡ä»½æ¢å¤æ¼”ä¹ 2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ¨¡æ‹Ÿåœºæ™¯</span></span></span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 9</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; insert into db1.t1 values (11),(12);</span><br><span class="line">Query OK, 2 rows affected (0.04 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; delete from db1.t1;</span><br><span class="line">Query OK, 10 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; create database db2;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; create table db2.t1 (id int primary key);</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; drop table db2.t1;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| db1                |</span><br><span class="line">| db2                |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">+--------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db2.t1;</span><br><span class="line">ERROR 1146 (42S02): Table \'db2.t1\' doesn\'t exist</span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ•°æ®è¿˜åŸ</span></span></span><br><span class="line">[root@mastera0 ~]# systemctl stop mariadb</span><br><span class="line">[root@mastera0 ~]# rm -rf /var/lib/mysql/*</span><br><span class="line">[root@mastera0 ~]# systemctl start mariadb</span><br><span class="line">[root@mastera0 ~]# mysql &lt; /tmp/mysql.12.mysql</span><br><span class="line">[root@mastera0 ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 3</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 4</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from t1;</span><br><span class="line">ERROR 1046 (3D000): No database selected</span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  3 |</span><br><span class="line">|  4 |</span><br><span class="line">|  5 |</span><br><span class="line">|  6 |</span><br><span class="line">|  7 |</span><br><span class="line">|  8 |</span><br><span class="line">|  9 |</span><br><span class="line">| 10 |</span><br><span class="line">+----+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## å¢é‡å¤‡ä»½è¿˜åŸ</span></span></span><br><span class="line">[root@mastera0 mysql-log]# mysqlbinlog --stop-datetime='2016-08-31 13:45:02' /var/lib/mysql-log/mastera.000006|mysql -uroot -puplooking</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql-log]# mysqlbinlog --start-datetime='2016-08-31 13:45:10' --stop-datetime='2016-08-31 13:45:42' /var/lib/mysql-log/mastera.000006|mysql -uroot -puplooking</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## æ£€æµ‹</span></span></span><br><span class="line">[root@mastera0 mysql-log]# mysql -uroot -puplookingWelcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 8</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| db1                |</span><br><span class="line">| db2                |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">+--------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  3 |</span><br><span class="line">|  4 |</span><br><span class="line">|  5 |</span><br><span class="line">|  6 |</span><br><span class="line">|  7 |</span><br><span class="line">|  8 |</span><br><span class="line">|  9 |</span><br><span class="line">| 10 |</span><br><span class="line">| 11 |</span><br><span class="line">| 12 |</span><br><span class="line">+----+</span><br><span class="line">10 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; use db2;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MariaDB [db2]&gt; show tables;</span><br><span class="line">+---------------+</span><br><span class="line">| Tables_in_db2 |</span><br><span class="line">+---------------+</span><br><span class="line">| t1            |</span><br><span class="line">+---------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db2]&gt; desc t1;</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| Field | Type    | Null | Key | Default | Extra |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| id    | int(11) | NO   | PRI | NULL    |       |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db2]&gt; show table status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           Name: t1</span><br><span class="line">         Engine: InnoDB</span><br><span class="line">        Version: 10</span><br><span class="line">     Row_format: Compact</span><br><span class="line">           Rows: 0</span><br><span class="line"> Avg_row_length: 0</span><br><span class="line">    Data_length: 16384</span><br><span class="line">Max_data_length: 0</span><br><span class="line">   Index_length: 0</span><br><span class="line">      Data_free: 10485760</span><br><span class="line"> Auto_increment: NULL</span><br><span class="line">    Create_time: 2016-08-31 14:56:22</span><br><span class="line">    Update_time: NULL</span><br><span class="line">     Check_time: NULL</span><br><span class="line">      Collation: latin1_swedish_ci</span><br><span class="line">       Checksum: NULL</span><br><span class="line"> Create_options:</span><br><span class="line">        Comment:</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: No query specified</span><br><span class="line"></span><br><span class="line">MariaDB [db2]&gt; exit</span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql-log]# mysqldump -uroot -puplooking -A --master-data=2 --flush-logs &gt; /tmp/mysql.14.mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----------------------------------</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ•°æ®åº“å¤‡ä»½æ¢å¤æ¼”ä¹ 3</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ¨¡æ‹Ÿåœºæ™¯</span></span></span><br><span class="line">[root@mastera0 mysql-log]# vim /tmp/mysql.test.sql</span><br><span class="line">[root@mastera0 mysql-log]# cat /tmp/mysql.test.sql</span><br><span class="line">insert into db1.t1 values (13),(14);</span><br><span class="line">delete from db1.t1;</span><br><span class="line">insert into db2.t1 values (1),(2),(3);</span><br><span class="line">delete from db2.t1;</span><br><span class="line">insert into db2.t1 values (4),(5);</span><br><span class="line">[root@mastera0 mysql-log]# mysql -uroot -puplooking &lt; /tmp/mysql.test.sql</span><br><span class="line">[root@mastera0 mysql-log]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 12</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db2.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  4 |</span><br><span class="line">|  5 |</span><br><span class="line">+----+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ•°æ®è¿˜åŸ</span></span></span><br><span class="line">[root@mastera0 ~]# systemctl stop mariadb</span><br><span class="line">[root@mastera0 ~]# rm -rf /var/lib/mysql/*</span><br><span class="line">[root@mastera0 ~]# systemctl start mariadb</span><br><span class="line">[root@mastera0 ~]# mysql &lt; /tmp/mysql.14.mysql</span><br><span class="line">[root@mastera0 ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 3</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 4</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  3 |</span><br><span class="line">|  4 |</span><br><span class="line">|  5 |</span><br><span class="line">|  6 |</span><br><span class="line">|  7 |</span><br><span class="line">|  8 |</span><br><span class="line">|  9 |</span><br><span class="line">| 10 |</span><br><span class="line">| 11 |</span><br><span class="line">| 12 |</span><br><span class="line">+----+</span><br><span class="line">10 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db2.t1;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line">[root@mastera0 ~]# sed -n '22p' /tmp/mysql.14.mysql</span><br><span class="line">-- CHANGE MASTER TO MASTER_LOG_FILE='mastera.000015', MASTER_LOG_POS=245;</span><br><span class="line">[root@mastera0 ~]# mysqlbinlog /var/lib/mysql-log/mastera.000015</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;</span><br><span class="line">/*!40019 SET @@session.max_insert_delayed_threads=0*/;</span><br><span class="line">/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;</span><br><span class="line">DELIMITER /*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 4</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:06:16 server id 1  end_log_pos 245 	Start: binlog v 4, server v 5.5.44-MariaDB-log created 160831 15:06:16</span></span><br><span class="line">BINLOG \'</span><br><span class="line">6IHGVw8BAAAA8QAAAPUAAAAAAAQANS41LjQ0LU1hcmlhREItbG9nAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAA2QAEGggAAAAICAgCAAAAAAAAAAAAAAAA</span><br><span class="line">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">AAAAAAAAAAAAAKeZqQ==</span><br><span class="line">\'/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 245</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 309 	Query	thread_id=11	exec_time=0	error_code=0</span></span><br><span class="line">SET TIMESTAMP=1472627369/*!*/;</span><br><span class="line">SET @@session.pseudo_thread_id=11/*!*/;</span><br><span class="line">SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/;</span><br><span class="line">SET @@session.sql_mode=0/*!*/;</span><br><span class="line">SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/;</span><br><span class="line">/*!\C utf8 *//*!*/;</span><br><span class="line">SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/;</span><br><span class="line">SET @@session.lc_time_names=0/*!*/;</span><br><span class="line">SET @@session.collation_database=DEFAULT/*!*/;</span><br><span class="line">BEGIN</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 309</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 403 	Query	thread_id=11	exec_time=0	error_code=0</span></span><br><span class="line">SET TIMESTAMP=1472627369/*!*/;</span><br><span class="line">insert into db1.t1 values (13),(14)</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 403</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 430 	Xid = 646</span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 430</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 494 	Query	thread_id=11	exec_time=0	error_code=0</span></span><br><span class="line">SET TIMESTAMP=1472627369/*!*/;</span><br><span class="line">BEGIN</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 494</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 571 	Query	thread_id=11	exec_time=0	error_code=0</span></span><br><span class="line">SET TIMESTAMP=1472627369/*!*/;</span><br><span class="line">delete from db1.t1</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 571</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 598 	Xid = 647</span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 598</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 662 	Query	thread_id=11	exec_time=0	error_code=0</span></span><br><span class="line">SET TIMESTAMP=1472627369/*!*/;</span><br><span class="line">BEGIN</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 662</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 758 	Query	thread_id=11	exec_time=0	error_code=0</span></span><br><span class="line">SET TIMESTAMP=1472627369/*!*/;</span><br><span class="line">insert into db2.t1 values (1),(2),(3)</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 758</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 785 	Xid = 648</span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 785</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 849 	Query	thread_id=11	exec_time=0	error_code=0</span></span><br><span class="line">SET TIMESTAMP=1472627369/*!*/;</span><br><span class="line">BEGIN</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 849</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 926 	Query	thread_id=11	exec_time=0	error_code=0</span></span><br><span class="line">SET TIMESTAMP=1472627369/*!*/;</span><br><span class="line">delete from db2.t1</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 926</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 953 	Xid = 649</span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 953</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 1017 	Query	thread_id=11	exec_time=0	error_code=0</span></span><br><span class="line">SET TIMESTAMP=1472627369/*!*/;</span><br><span class="line">BEGIN</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 1017</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 1109 	Query	thread_id=11	exec_time=0	error_code=0</span></span><br><span class="line">SET TIMESTAMP=1472627369/*!*/;</span><br><span class="line">insert into db2.t1 values (4),(5)</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 1109</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:09:29 server id 1  end_log_pos 1136 	Xid = 650</span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line"><span class="meta">#</span><span class="bash"> at 1136</span></span><br><span class="line"><span class="meta">#</span><span class="bash">160831 15:10:32 server id 1  end_log_pos 1155 	Stop</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="meta">#</span><span class="bash"> End of <span class="built_in">log</span> file</span></span><br><span class="line">ROLLBACK /* added by mysqlbinlog */;</span><br><span class="line">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;</span><br><span class="line">[root@mastera0 ~]#</span><br><span class="line">[root@mastera0 ~]# mysqlbinlog --start-position=245 --stop-position=430 /var/lib/mysql-log/mastera.000015|mysql -uroot -puplooking</span><br><span class="line">[root@mastera0 ~]# mysqlbinlog --start-position=598 --stop-position=785 /var/lib/mysql-log/mastera.000015|mysql -uroot -puplooking</span><br><span class="line">[root@mastera0 ~]# mysqlbinlog --start-position=953 --stop-position=1136 /var/lib/mysql-log/mastera.000015|mysql -uroot -puplooking</span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 8</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  3 |</span><br><span class="line">|  4 |</span><br><span class="line">|  5 |</span><br><span class="line">|  6 |</span><br><span class="line">|  7 |</span><br><span class="line">|  8 |</span><br><span class="line">|  9 |</span><br><span class="line">| 10 |</span><br><span class="line">| 11 |</span><br><span class="line">| 12 |</span><br><span class="line">| 13 |</span><br><span class="line">| 14 |</span><br><span class="line">+----+</span><br><span class="line">12 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db2.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  1 |</span><br><span class="line">|  2 |</span><br><span class="line">|  3 |</span><br><span class="line">|  4 |</span><br><span class="line">|  5 |</span><br><span class="line">+----+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql-log]# vim /tmp/mysql.test.sql</span><br><span class="line">[root@mastera0 mysql-log]# cat /tmp/mysql.test.sql</span><br><span class="line">insert into db1.t1 values (13),(14);</span><br><span class="line">delete from db1.t1;</span><br><span class="line">insert into db2.t1 values (1),(2),(3);</span><br><span class="line">delete from db2.t1;</span><br><span class="line">insert into db2.t1 values (4),(5);</span><br><span class="line">[root@mastera0 mysql-log]# mysql -uroot -puplooking &lt; /tmp/mysql.test.sql</span><br><span class="line">[root@mastera0 mysql-log]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 12</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db1.t1;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select * from db2.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  4 |</span><br><span class="line">|  5 |</span><br><span class="line">+----+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line">[root@mastera0 mysql-log]# mysqldump -uroot -puplooking -A --master-data=2 --flush-logs &gt; /tmp/mysql.16.mysql</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="è®¾è®¡-MySQL-å¤‡ä»½è®¡åˆ’"><a href="#è®¾è®¡-MySQL-å¤‡ä»½è®¡åˆ’" class="headerlink" title="è®¾è®¡ MySQL å¤‡ä»½è®¡åˆ’"></a>è®¾è®¡ MySQL å¤‡ä»½è®¡åˆ’</h3><p>å¤‡ä»½MySQLæ¯”çœ‹èµ·æ¥éš¾ã€‚æœ€åŸºæœ¬çš„ï¼Œå¤‡ä»½ä»…æ˜¯æ•°æ®çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œä½†æ˜¯å—é™äºåº”ç”¨ç¨‹åºçš„è¦æ±‚ã€MySQLçš„å­˜å‚¨å¼•æ“æ¶æ„ï¼Œä»¥åŠç³»ç»Ÿé…ç½®ç­‰å› ç´ ï¼Œä¼šè®©å¤åˆ¶ä¸€ä»½æ•°æ®å˜å¾—å›°éš¾ã€‚</p>
<ul>
<li>åœ¨ç”Ÿäº§å®è·µä¸­ï¼Œå¯¹äºå¤§æ•°æ®åº“æ¥è¯´ï¼Œç‰©ç†å¤‡ä»½æ˜¯å¿…é¡»çš„ï¼šé€»è¾‘å¤‡ä»½å¤ªæ…¢å¹¶å—åˆ°èµ„æºé™åˆ¶ï¼Œä»é€»è¾‘å¤‡ä»½ä¸­æ¢å¤éœ€è¦å¾ˆé•¿æ—¶é—´ã€‚åŸºäºå¿«ç…§å¤‡ä»½ï¼Œä¾‹å¦‚Percona XtraBackupå’ŒMySQL Enterprise Backupæ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚å¯¹äºè¾ƒå°çš„æ•°æ®åº“ï¼Œé€»è¾‘å¤‡ä»½å¯ä»¥å¾ˆå¥½çš„èƒœä»»ã€‚</li>
<li>ä¿ç•™å¤šä¸ªå¤‡ä»½é›†ã€‚</li>
<li>å®šæœŸä»é€»è¾‘å¤‡ä»½æˆ–è€…ç‰©ç†å¤‡ä»½ä¸­æŠ½å–æ•°æ®è¿›è¡Œæ¢å¤æµ‹è¯•ã€‚  </li>
<li>ä¿å­˜äºŒè¿›åˆ¶æ—¥è‡³ç”¨äºåŸºäºæ•…éšœæ—¶é—´ç‚¹çš„æ¢å¤ã€‚<code>expire_logs_days</code>å‚æ•°åº”è¯¥è®¾ç½®å¾—è¶³å¤Ÿé•¿ï¼Œè‡³å°‘å¯ä»¥ä»æœ€è¿‘ä¸¤æ¬¡ç‰©ç†å¤‡ä»½ä¸­ä½œåŸºäºæ—¶é—´ç‚¹çš„æ¢å¤ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¿æŒä¸»åº“è¿è¡Œä¸”ä¸åº”ç”¨ä»»ä½•äºŒè¿›åˆ¶æ—¥å¿—çš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ªå¤‡åº“ã€‚å¤‡ä»½äºŒè¿›åˆ¶æ—¥è‡³ä¸å›½æ——è®¾ç½®æ— å…³ï¼ŒäºŒè¿›åˆ¶æ—¥å¿—å¤‡ä»½éœ€è¦ä¿å­˜è¶³å¤Ÿé•¿çš„æ—¶é—´ï¼Œä»¥ä¾¿èƒ½å¤Ÿä»æœ€è¿‘çš„é€»è¾‘å¤‡ä»½è¿›è¡Œæ¢å¤ã€‚</li>
<li>å®Œå…¨ä¸å€ŸåŠ©å¤‡ä»½å·¥å…·æœ¬èº«æ¥ç›‘æ§å¤‡ä»½å’Œå¤‡ä»½çš„è¿‡ç¨‹ã€‚éœ€è¦å¦å¤–éªŒè¯å¤‡ä»½æ˜¯å¦æ­£å¸¸ã€‚</li>
<li>é€šè¿‡æ¼”ç»ƒæ•´ä¸ªæ¢å¤è¿‡ç¨‹æ¥æµ‹è¯•å¤‡ä»½å’Œæ¢å¤ã€‚æµ‹ç®—æ¢å¤æ‰€éœ€è¦çš„èµ„æºï¼ˆCPUã€ç£ç›˜ç©ºé—´ã€å®é™…æ—¶é—´ï¼Œä»¥åŠç½‘ç»œå¸¦å®½ç­‰ï¼‰ã€‚</li>
<li>å¯¹å®‰å…¨æ€§è¦ä»”ç»†è€ƒè™‘ã€‚å¦‚æœæœ‰äººèƒ½å¤Ÿæ¥è§¦ç”Ÿäº§æœåŠ¡å™¨ï¼Œä»–æ˜¯å¦ä¹Ÿèƒ½è®¿é—®å¤‡ä»½æœåŠ¡å™¨ï¼Ÿåè¿‡æ¥å‘¢ï¼Ÿ</li>
</ul>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œèƒ½æ‰¿å—çš„æ•°æ®ä¸¢å¤±è¶Šå¤šï¼Œå¤‡ä»½è¶Šç®€å•ã€‚å¦‚æœæœ‰éå¸¸ä¸¥è‹›çš„éœ€æ±‚ï¼Œè¦ç¡®ä¿èƒ½æ¢å¤æ‰€æœ‰æ•°æ®ï¼Œå¤‡ä»½å°±å¾ˆå›°éš¾ã€‚åŸºäºæ•…éšœæ—¶é—´ç‚¹çš„æ¢å¤ä¹Ÿæœ‰å‡ ç±»ã€‚ä¸€ä¸ªâ€œå®½æ¾â€çš„æ•…éšœæ—¶é—´ç‚¹æ¢å¤éœ€æ±‚æ„å‘³ç€éœ€è¦é‡å»ºæ•°æ®ï¼ŒçŸ¥é“â€œè¶³å¤Ÿæ¥è¿‘â€é—®é¢˜å‘ç”Ÿçš„æ—¶åˆ»ã€‚ä¸€ä¸ªâ€œç¡¬æ€§â€çš„éœ€æ±‚æ„å‘³ç€ä¸èƒ½å®¹å¿ä¸¢å¤±ä»»ä½•ä¸€ä¸ªå·²æäº¤çš„äº‹åŠ¡ï¼Œå³ä½¿æŸäº›å¯æ€•çš„äº‹æƒ…å‘ç”Ÿï¼ˆä¾‹å¦‚æœåŠ¡å™¨ç€ç«äº†ï¼‰ã€‚è¿™éœ€è¦ç‰¹åˆ«çš„æŠ€æœ¯ï¼Œä¾‹å¦‚äºŒè¿›åˆ¶æ—¥è‡³ä¿å­˜åœ¨ä¸€ä¸ªç‹¬ç«‹çš„çš„SANå·æˆ–ä½¿ç”¨DRBDç£ç›˜å¤åˆ¶ã€‚</p>
<p>æ¥ä¸‹æ¥ä½ è¿˜è¦è€ƒè™‘</p>
<ul>
<li>åœ¨çº¿ï¼ˆçƒ­ï¼‰å¤‡ä»½è¿˜æ˜¯ç¦»çº¿ï¼ˆå†·ï¼‰å¤‡ä»½ï¼Œåˆæˆ–è€…æ¸©å¤‡ä»½ï¼Ÿ</li>
<li>é€»è¾‘å¤‡ä»½è¿˜æ˜¯ç‰©ç†å¤‡ä»½ï¼Ÿ</li>
<li>å¤‡ä»½ä»€ä¹ˆï¼Ÿ</li>
<li>å­˜å‚¨å¼•æ“å’Œä¸€è‡´æ€§ï¼Ÿ</li>
</ul>
<p>åœ¨è§„åˆ’å¤‡ä»½æ—¶ï¼Œæœ‰ä¸€äº›ä¸æ€§èƒ½ç›¸å…³çš„å› ç´ éœ€è¦è€ƒè™‘ã€‚</p>
<ul>
<li>é”æ—¶é—´ï¼šéœ€è¦æŒæœ‰é”å¤šé•¿æ—¶é—´ï¼Œä¾‹å¦‚åœ¨å¤‡ä»½æœŸé—´æŒæœ‰çš„å…¨å±€ <code>flush tables with read lock</code>?</li>
<li>å¤‡ä»½æ—¶é—´ï¼šå¤åˆ¶å¤‡ä»½åˆ°ç›®çš„åœ°éœ€è¦å¤šä¹…ï¼Ÿ</li>
<li>å¤‡ä»½è´Ÿè½½ï¼šåœ¨å¤åˆ¶å¤‡ä»½åˆ°ç›®çš„åœ°æ—¶å¯¹æœåŠ¡å™¨æ€§èƒ½çš„å½±å“æœ‰å¤šå°‘ï¼Ÿ</li>
<li>æ¢å¤æ—¶é—´ï¼šæŠŠå¤‡ä»½é•œåƒä»å­˜å‚¨ä½ç½®å¤åˆ¶åˆ°MySQLæœåŠ¡å™¨ï¼Œé‡æ”¾äºŒè¿›åˆ¶æ—¥å¿—ç­‰ï¼Œéœ€è¦å¤šä¹…ï¼Ÿ</li>
</ul>
<p>æœ€å¤§çš„æƒè¡¡æ—¶å¤‡ä»½æ—¶é—´ä¸å¤‡ä»½è´Ÿè½½ã€‚å¯ä»¥ç‰ºç‰²å…¶ä¸€ä»¥å¢åŠ å¦å¤–ä¸€ä¸ªã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æé«˜å¤‡ä»½çš„ä¼˜å…ˆçº§ï¼Œä»£ä»·æ˜¯é™ä½æœåŠ¡å™¨æ€§èƒ½ã€‚åŒæ ·ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨è´Ÿè½½çš„ç‰¹æ€§æ¥è®¾è®¡å¤‡ä»½ã€‚</p>
<hr>
<h3 id="å®æˆ˜é¡¹ç›®"><a href="#å®æˆ˜é¡¹ç›®" class="headerlink" title="å®æˆ˜é¡¹ç›®"></a>å®æˆ˜é¡¹ç›®</h3><blockquote>
<p>å®æˆ˜é¡¹ç›®1: è„šæœ¬åˆ©ç”¨LVMå¿«ç…§å®ç°ç‰©ç†å¤‡ä»½</p>
</blockquote>
<blockquote>
<p>å®æˆ˜é¡¹ç›®2: ç¼–å†™MySQLå¤‡ä»½è„šæœ¬ï¼ˆé€»è¾‘/ç‰©ç†/å®Œå…¨/å¢é‡ï¼‰</p>
</blockquote>
<blockquote>
<p>å®æˆ˜é¡¹ç›®3: æ€»ç»“ç‰©ç†å¤‡ä»½å’Œé€»è¾‘å¤‡ä»½çš„åŒºåˆ«</p>
</blockquote>
<blockquote>
<p>å®æˆ˜é¡¹ç›®4: å°† MySQL ä¸­çš„æ•°æ®è¿ç§»åˆ° MariaDB</p>
</blockquote>
<hr>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>é‡ç‚¹æŒæ¡</p>
<ol>
<li>å¤‡ä»½æ¦‚å¿µ</li>
<li>å¤‡ä»½çš„è¿‡ç¨‹</li>
<li>Mysqldumpå‘½ä»¤</li>
<li>äºŒè¿›åˆ¶æ—¥å¿—</li>
<li>ä¸åŒçš„å¤‡ä»½æ–¹æ³•çš„åŸç†ä»¥åŠå¤‡ä»½è¿‡ç¨‹ä¸­ä¼šé‡åˆ°çš„é—®é¢˜</li>
<li>æ¸…æ¥šæ¯ä¸€ç§å¤‡ä»½æ–¹æ³•çš„ä¼˜ç¼ºç‚¹</li>
<li>æŒæ¡å¤‡ä»½æ•°æ®çš„è¿˜åŸ</li>
</ol>
<p>éš¾ç‚¹</p>
<ol>
<li>å¤‡ä»½ä¸å†—ä½™çš„åŒºåˆ«</li>
<li>å¤‡ä»½ä¸­æœåŠ¡å¯ç”¨æ€§ä¸æ•°æ®ä¸€è‡´æ€§</li>
<li>MVCCç‰ˆæœ¬æ§åˆ¶æœºåˆ¶</li>
<li>å¤‡ä»½ä¸­æ•°æ®ä¸€è‡´æ€§å’ŒæœåŠ¡å¯ç”¨æ€§çš„ç†è§£</li>
<li>Percona XtraBackupå¢é‡å¤‡ä»½å’Œè¿˜åŸçš„åŸç†</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>MySQLåŸºç¡€ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬å››è¯¾ ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€SQLä»‹ç»å’ŒåŸºæœ¬æ“ä½œ2</title>
    <url>/2016/12/28/booboo_mysql/02-%E7%BB%93%E6%9E%84%E5%8C%96%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80SQL%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C2/</url>
    <content><![CDATA[<h4 id="å…¨æ–‡æœ¬æœç´¢"><a href="#å…¨æ–‡æœ¬æœç´¢" class="headerlink" title="å…¨æ–‡æœ¬æœç´¢"></a>å…¨æ–‡æœ¬æœç´¢</h4><p>æœ¬ç« å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨MySQLçš„å…¨æ–‡æœ¬æœç´¢åŠŸèƒ½è¿›è¡Œé«˜çº§çš„æ•°æ®æŸ¥è¯¢å’Œé€‰æ‹©ã€‚</p>
<blockquote>
<p>ç†è§£å…¨æ–‡æœ¬æœç´¢</p>
</blockquote>
<p><strong>å¹¶éæ‰€æœ‰å¼•æ“éƒ½æ”¯æŒå…¨æ–‡æœ¬æœç´¢</strong> MySQLæ”¯æŒå‡ ç§åŸºæœ¬çš„æ•°æ®åº“å¼•æ“ã€‚å¹¶éæ‰€æœ‰çš„å¼•æ“éƒ½æ”¯æŒå…¨æ–‡æœ¬æœç´¢ã€‚ä¸¤ä¸ªæœ€å¸¸ä½¿ç”¨çš„å¼•æ“ä¸º MyISAM å’Œ InnoDB ,å‰è€…æ”¯æŒå…¨æ–‡æœ¬æœç´¢,è€Œåè€…ä¸æ”¯æŒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè™½ç„¶æœ¬ä¹¦ä¸­åˆ›å»ºçš„å¤šæ•°æ ·ä¾‹è¡¨ä½¿ç”¨ InnoDB ,è€Œæœ‰ä¸€ä¸ªæ ·ä¾‹è¡¨( productnotes è¡¨)å´ä½¿ç”¨ MyISAM çš„åŸå› ã€‚å¦‚æœä½ çš„åº”ç”¨ä¸­éœ€è¦å…¨æ–‡æœ¬æœç´¢åŠŸèƒ½,åº”è¯¥è®°ä½è¿™ä¸€ç‚¹ã€‚</p>
<p>å‰é¢ä»‹ç»äº† LIKE å…³é”®å­—,å®ƒåˆ©ç”¨é€šé…æ“ä½œç¬¦åŒ¹é…æ–‡æœ¬(å’Œéƒ¨åˆ†æ–‡æœ¬)ã€‚ä½¿ç”¨ LIKE ,èƒ½å¤ŸæŸ¥æ‰¾åŒ…å«ç‰¹æ®Šå€¼æˆ–éƒ¨åˆ†å€¼çš„è¡Œ(ä¸ç®¡è¿™äº›å€¼ä½äºåˆ—å†…ä»€ä¹ˆä½ç½®)ã€‚</p>
<p>è¿˜å­¦ä¹ äº†,ç”¨åŸºäºæ–‡æœ¬çš„æœç´¢ä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ—å€¼çš„æ›´è¿›ä¸€æ­¥çš„ä»‹ç»ã€‚ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼,å¯ä»¥ç¼–å†™æŸ¥æ‰¾æ‰€éœ€è¡Œçš„éå¸¸å¤æ‚çš„åŒ¹é…æ¨¡å¼ã€‚</p>
<p>è™½ç„¶è¿™äº›æœç´¢æœºåˆ¶éå¸¸æœ‰ç”¨,ä½†å­˜åœ¨å‡ ä¸ªé‡è¦çš„é™åˆ¶ã€‚</p>
<ul>
<li>æ€§èƒ½â€”â€”é€šé…ç¬¦å’Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é€šå¸¸è¦æ±‚MySQLå°è¯•åŒ¹é…è¡¨ä¸­æ‰€æœ‰è¡Œ(è€Œä¸”è¿™äº›æœç´¢æå°‘ä½¿ç”¨è¡¨ç´¢å¼•)ã€‚å› æ­¤,ç”±äºè¢«æœç´¢è¡Œæ•°ä¸æ–­å¢åŠ ,è¿™äº›æœç´¢å¯èƒ½éå¸¸è€—æ—¶ã€‚</li>
<li>æ˜ç¡®æ§åˆ¶â€”â€”ä½¿ç”¨é€šé…ç¬¦å’Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…,å¾ˆéš¾(è€Œä¸”å¹¶ä¸æ€»æ˜¯èƒ½)æ˜ç¡®åœ°æ§åˆ¶åŒ¹é…ä»€ä¹ˆå’Œä¸åŒ¹é…ä»€ä¹ˆã€‚ä¾‹å¦‚,æŒ‡å®šä¸€ä¸ªè¯å¿…é¡»åŒ¹é…,ä¸€ä¸ªè¯å¿…é¡»ä¸åŒ¹é…,è€Œä¸€ä¸ªè¯ä»…åœ¨ç¬¬ä¸€ä¸ªè¯ç¡®å®åŒ¹é…çš„æƒ…å†µä¸‹æ‰å¯ä»¥åŒ¹é…æˆ–è€…æ‰å¯ä»¥ä¸åŒ¹é…ã€‚</li>
<li>æ™ºèƒ½åŒ–çš„ç»“æœâ€”â€”è™½ç„¶åŸºäºé€šé…ç¬¦å’Œæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢æä¾›äº†éå¸¸çµæ´»çš„æœç´¢,ä½†å®ƒä»¬éƒ½ä¸èƒ½æä¾›ä¸€ç§æ™ºèƒ½åŒ–çš„é€‰æ‹©ç»“æœçš„æ–¹æ³•ã€‚ä¾‹å¦‚,ä¸€ä¸ªç‰¹æ®Šè¯çš„æœç´¢å°†ä¼šè¿”å›åŒ…å«è¯¥è¯çš„æ‰€æœ‰è¡Œ,è€Œä¸åŒºåˆ†åŒ…å«å•ä¸ªåŒ¹é…çš„è¡Œå’ŒåŒ…å«å¤šä¸ªåŒ¹é…çš„è¡Œ(æŒ‰ç…§å¯èƒ½æ˜¯æ›´å¥½çš„åŒ¹é…æ¥æ’åˆ—å®ƒä»¬)ã€‚ç±»ä¼¼,ä¸€ä¸ªç‰¹æ®Šè¯çš„æœç´¢å°†ä¸ä¼šæ‰¾å‡ºä¸åŒ…å«è¯¥è¯ä½†åŒ…å«å…¶ä»–ç›¸å…³è¯çš„è¡Œã€‚</li>
</ul>
<p>æ‰€æœ‰è¿™äº›é™åˆ¶ä»¥åŠæ›´å¤šçš„é™åˆ¶éƒ½å¯ä»¥ç”¨å…¨æ–‡æœ¬æœç´¢æ¥è§£å†³ã€‚åœ¨ä½¿ç”¨å…¨æ–‡æœ¬æœç´¢æ—¶,MySQLä¸éœ€è¦åˆ†åˆ«æŸ¥çœ‹æ¯ä¸ªè¡Œ,ä¸éœ€è¦åˆ†åˆ«åˆ†æå’Œå¤„ç†æ¯ä¸ªè¯ã€‚MySQLåˆ›å»ºæŒ‡å®šåˆ—ä¸­å„è¯çš„ä¸€ä¸ªç´¢å¼•,æœç´¢å¯ä»¥é’ˆå¯¹è¿™äº›è¯è¿›è¡Œã€‚è¿™æ ·,MySQLå¯ä»¥å¿«é€Ÿæœ‰æ•ˆåœ°å†³å®šå“ªäº›è¯åŒ¹é…(å“ªäº›è¡ŒåŒ…å«å®ƒä»¬),å“ªäº›è¯ä¸åŒ¹é…,å®ƒä»¬åŒ¹é…çš„é¢‘ç‡,ç­‰ç­‰ã€‚</p>
<blockquote>
<p>ä½¿ç”¨å…¨æ–‡æœ¬æœç´¢</p>
</blockquote>
<p>ä¸ºäº†è¿›è¡Œå…¨æ–‡æœ¬æœç´¢,å¿…é¡»ç´¢å¼•è¢«æœç´¢çš„åˆ—,è€Œä¸”è¦éšç€æ•°æ®çš„æ”¹å˜ä¸æ–­åœ°é‡æ–°ç´¢å¼•ã€‚åœ¨å¯¹è¡¨åˆ—è¿›è¡Œé€‚å½“è®¾è®¡å,MySQLä¼šè‡ªåŠ¨è¿›è¡Œæ‰€æœ‰çš„ç´¢å¼•å’Œé‡æ–°ç´¢å¼•ã€‚</p>
<p>åœ¨ç´¢å¼•ä¹‹å, SELECT å¯ä¸ Match() å’Œ Against() ä¸€èµ·ä½¿ç”¨ä»¥å®é™…æ‰§è¡Œæœç´¢ã€‚</p>
<p>1.å¯ç”¨å…¨æ–‡æœ¬æœç´¢æ”¯æŒ</p>
<p>ä¸€èˆ¬åœ¨åˆ›å»ºè¡¨æ—¶å¯ç”¨å…¨æ–‡æœ¬æœç´¢ã€‚ <code>CREATE TABLE</code> è¯­å¥æ¥å— <code>FULLTEXT</code> å­å¥,å®ƒç»™å‡ºè¢«ç´¢å¼•åˆ—çš„ä¸€ä¸ªé€—å·åˆ†éš”çš„åˆ—è¡¨ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸‹é¢çš„ CREATE è¯­å¥æ¼”ç¤ºäº† FULLTEXT å­å¥çš„ä½¿ç”¨:</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create table productnotes1 (note_id int not null auto_increment,prod_id char(10) not null,note_date datetime not null,note_text text null,primary key(note_id),fulltext(note_text)) engine&#x3D;myisam;</span><br><span class="line">Query OK, 0 rows affected (0.37 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; show table status where name&#x3D;&#39;productnotes1&#39;\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           Name: productnotes1</span><br><span class="line">         Engine: MyISAM</span><br><span class="line">        Version: 10</span><br><span class="line">     Row_format: Dynamic</span><br><span class="line">           Rows: 0</span><br><span class="line"> Avg_row_length: 0</span><br><span class="line">    Data_length: 0</span><br><span class="line">Max_data_length: 281474976710655</span><br><span class="line">   Index_length: 1024</span><br><span class="line">      Data_free: 0</span><br><span class="line"> Auto_increment: 1</span><br><span class="line">    Create_time: 2016-09-20 15:20:19</span><br><span class="line">    Update_time: 2016-09-20 15:20:19</span><br><span class="line">     Check_time: NULL</span><br><span class="line">      Collation: latin1_swedish_ci</span><br><span class="line">       Checksum: NULL</span><br><span class="line"> Create_options:</span><br><span class="line">        Comment:</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>åé¢å°†è¯¦ç»†è€ƒå¯Ÿ <code>CREATE TABLE</code> è¯­å¥ã€‚ç°åœ¨,åªéœ€çŸ¥é“è¿™æ¡<code>CREATE TABLE</code> è¯­å¥å®šä¹‰è¡¨ <code>productnotes1</code> å¹¶åˆ—å‡ºå®ƒæ‰€åŒ…å«çš„åˆ—å³å¯ã€‚è¿™äº›åˆ—ä¸­æœ‰ä¸€ä¸ªåä¸º <code>note_text</code> çš„åˆ—,ä¸ºäº†è¿›è¡Œå…¨æ–‡æœ¬æœç´¢,MySQLæ ¹æ®å­å¥ <code>FULLTEXT(note_text)</code> çš„æŒ‡ç¤ºå¯¹å®ƒè¿›è¡Œç´¢å¼•ã€‚è¿™é‡Œçš„<code>FULLTEXT</code> ç´¢å¼•å•ä¸ªåˆ—,å¦‚æœéœ€è¦ä¹Ÿå¯ä»¥æŒ‡å®šå¤šä¸ªåˆ—ã€‚</p>
<p>åœ¨å®šä¹‰ä¹‹å,MySQLè‡ªåŠ¨ç»´æŠ¤è¯¥ç´¢å¼•ã€‚åœ¨å¢åŠ ã€æ›´æ–°æˆ–åˆ é™¤è¡Œæ—¶,ç´¢å¼•éšä¹‹è‡ªåŠ¨æ›´æ–°ã€‚å¯ä»¥åœ¨åˆ›å»ºè¡¨æ—¶æŒ‡å®š <code>FULLTEXT</code> ,æˆ–è€…åœ¨ç¨åæŒ‡å®š(åœ¨è¿™ç§æƒ…å†µä¸‹æ‰€æœ‰å·²æœ‰æ•°æ®å¿…é¡»ç«‹å³ç´¢å¼•)ã€‚</p>
<p><strong>ä¸è¦åœ¨å¯¼å…¥æ•°æ®æ—¶ä½¿ç”¨ FULLTEXT</strong> æ›´æ–°ç´¢å¼•è¦èŠ±æ—¶é—´,è™½ç„¶ä¸æ˜¯å¾ˆå¤š,ä½†æ¯•ç«Ÿè¦èŠ±æ—¶é—´ã€‚å¦‚æœæ­£åœ¨å¯¼å…¥æ•°æ®åˆ°ä¸€ä¸ªæ–°è¡¨,æ­¤æ—¶ä¸åº”è¯¥å¯ç”¨ <code>FULLTEXT</code> ç´¢å¼•ã€‚åº”è¯¥é¦–å…ˆå¯¼å…¥æ‰€æœ‰æ•°æ®,ç„¶åå†ä¿®æ”¹è¡¨,å®šä¹‰<code>FULLTEXT</code> ã€‚è¿™æ ·æœ‰åŠ©äºæ›´å¿«åœ°å¯¼å…¥æ•°æ®(è€Œä¸”ä½¿ç´¢å¼•æ•°æ®çš„æ€»æ—¶é—´å°äºåœ¨å¯¼å…¥æ¯è¡Œæ—¶åˆ†åˆ«è¿›è¡Œç´¢å¼•æ‰€éœ€çš„æ€»æ—¶é—´)</p>
<p>2.è¿›è¡Œå…¨æ–‡æœ¬æœç´¢</p>
<p>åœ¨ç´¢å¼•ä¹‹å,ä½¿ç”¨ä¸¤ä¸ªå‡½æ•° Match() å’Œ Against() æ‰§è¡Œå…¨æ–‡æœ¬æœç´¢,å…¶ä¸­ Match() æŒ‡å®šè¢«æœç´¢çš„åˆ—, Against() æŒ‡å®šè¦ä½¿ç”¨çš„æœç´¢è¡¨è¾¾å¼ã€‚</p>
<p>ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from productnotes;</span><br><span class="line">+---------+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| note_id | prod_id | note_date           | note_text                                                                                                                                                 |</span><br><span class="line">+---------+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">|     101 | TNT2    | 2005-08-17 00:00:00 | Customer complaint:</span><br><span class="line">Sticks not individually wrapped, too easy to mistakenly detonate all at once.</span><br><span class="line">Recommend individual wrapping.                          |</span><br><span class="line">|     102 | OL1     | 2005-08-18 00:00:00 | Can shipped full, refills not available.</span><br><span class="line">Need to order new can if refill needed.                                                                          |</span><br><span class="line">|     103 | SAFE    | 2005-08-18 00:00:00 | Safe is combination locked, combination not provided with safe.</span><br><span class="line">This is rarely a problem as safes are typically blown up or dropped by customers.         |</span><br><span class="line">|     104 | FC      | 2005-08-19 00:00:00 | Quantity varies, sold by the sack load.</span><br><span class="line">All guaranteed to be bright and orange, and suitable for use as rabbit bait.                                      |</span><br><span class="line">|     105 | TNT2    | 2005-08-20 00:00:00 | Included fuses are short and have been known to detonate too quickly for some customers.</span><br><span class="line">Longer fuses are available (item FU1) and should be recommended. |</span><br><span class="line">|     106 | TNT2    | 2005-08-22 00:00:00 | Matches not included, recommend purchase of matches or detonator (item DTNTR).                                                                            |</span><br><span class="line">|     107 | SAFE    | 2005-08-23 00:00:00 | Please note that no returns will be accepted if safe opened using explosives.                                                                             |</span><br><span class="line">|     108 | ANV01   | 2005-08-25 00:00:00 | Multiple customer returns, anvils failing to drop fast enough or falling backwards on purchaser. Recommend that customer considers using heavier anvils.  |</span><br><span class="line">|     109 | ANV03   | 2005-09-01 00:00:00 | Item is extremely heavy. Designed for dropping, not recommended for use with slings, ropes, pulleys, or tightropes.                                       |</span><br><span class="line">|     110 | FC      | 2005-09-01 00:00:00 | Customer complaint: rabbit has been able to detect trap, food apparently less effective now.                                                              |</span><br><span class="line">|     111 | SLING   | 2005-09-02 00:00:00 | Shipped unassembled, requires common tools (including oversized hammer).                                                                                  |</span><br><span class="line">|     112 | SAFE    | 2005-09-02 00:00:00 | Customer complaint:</span><br><span class="line">Circular hole in safe floor can apparently be easily cut with handsaw.                                                                |</span><br><span class="line">|     113 | ANV01   | 2005-09-05 00:00:00 | Customer complaint:</span><br><span class="line">Not heavy enough to generate flying stars around head of victim. If being purchased for dropping, recommend ANV02 or ANV03 instead.   |</span><br><span class="line">|     114 | SAFE    | 2005-09-07 00:00:00 | Call from individual trapped in safe plummeting to the ground, suggests an escape hatch be added.</span><br><span class="line">Comment forwarded to vendor.                            |</span><br><span class="line">+---------+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select note_text from productnotes where note_text regexp 'rabbit';</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| note_text                                                                                                            |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Quantity varies, sold by the sack load.</span><br><span class="line">All guaranteed to be bright and orange, and suitable for use as rabbit bait. |</span><br><span class="line">| Customer complaint: rabbit has been able to detect trap, food apparently less effective now.                         |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select note_text from productnotes where match(note_text) against('rabbit');</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| note_text                                                                                                            |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Customer complaint: rabbit has been able to detect trap, food apparently less effective now.                         |</span><br><span class="line">| Quantity varies, sold by the sack load.</span><br><span class="line">All guaranteed to be bright and orange, and suitable for use as rabbit bait. |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ­¤ SELECT è¯­å¥æ£€ç´¢å•ä¸ªåˆ— <code>note_text</code> ã€‚ç”±äº WHERE å­å¥,ä¸€ä¸ªå…¨æ–‡æœ¬æœç´¢è¢«æ‰§è¡Œã€‚ <code>Match(note_text)</code> æŒ‡ç¤ºMySQLé’ˆå¯¹æŒ‡å®šçš„åˆ—è¿›è¡Œæœç´¢, <code>Against(&#39;rabbit&#39;)</code> æŒ‡å®šè¯ <code>rabbit</code> ä½œä¸ºæœç´¢æ–‡æœ¬ã€‚ç”±äºæœ‰ä¸¤è¡ŒåŒ…å«è¯ <code>rabbit</code> ,è¿™ä¸¤ä¸ªè¡Œè¢«è¿”å›ã€‚</p>
<p><strong>ä½¿ç”¨å®Œæ•´çš„Match()è¯´æ˜</strong> ä¼ é€’ç»™ Match() çš„å€¼å¿…é¡»ä¸FULLTEXT() å®šä¹‰ä¸­çš„ç›¸åŒã€‚å¦‚æœæŒ‡å®šå¤šä¸ªåˆ—,åˆ™å¿…é¡»åˆ—å‡ºå®ƒä»¬(è€Œä¸”æ¬¡åºæ­£ç¡®)ã€‚</p>
<p><strong>æœç´¢ä¸åŒºåˆ†å¤§å°å†™</strong> é™¤éä½¿ç”¨ BINARY æ–¹å¼(æœ¬ç« ä¸­æ²¡æœ‰ä»‹ç»),å¦åˆ™å…¨æ–‡æœ¬æœç´¢ä¸åŒºåˆ†å¤§å°å†™ã€‚</p>
<p>äº‹å®æ˜¯åˆšæ‰çš„æœç´¢å¯ä»¥ç®€å•åœ°ç”¨ LIKE å­å¥å®Œæˆ,å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select note_text from productnotes where note_text like '%rabbit%';</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| note_text                                                                                                            |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Quantity varies, sold by the sack load.</span><br><span class="line">All guaranteed to be bright and orange, and suitable for use as rabbit bait. |</span><br><span class="line">| Customer complaint: rabbit has been able to detect trap, food apparently less effective now.                         |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡ SELECT è¯­å¥åŒæ ·æ£€ç´¢å‡ºä¸¤è¡Œ,ä½†æ¬¡åºä¸åŒ(è™½ç„¶å¹¶ä¸æ€»æ˜¯å‡ºç°è¿™ç§æƒ…å†µ)ã€‚</p>
<p>ä¸Šè¿°ä¸¤æ¡ SELECT è¯­å¥éƒ½ä¸åŒ…å« ORDER BY å­å¥ã€‚åè€…(ä½¿ç”¨ LIKE )ä»¥ä¸ç‰¹åˆ«æœ‰ç”¨çš„é¡ºåºè¿”å›æ•°æ®ã€‚å‰è€…(ä½¿ç”¨å…¨æ–‡æœ¬æœç´¢)è¿”å›ä»¥æ–‡æœ¬åŒ¹é…çš„è‰¯å¥½ç¨‹åº¦æ’åºçš„æ•°æ®ã€‚ä¸¤ä¸ªè¡Œéƒ½åŒ…å«è¯ rabbit ,ä½†åŒ…å«è¯ rabbit ä½œä¸ºç¬¬3ä¸ªè¯çš„è¡Œçš„ç­‰çº§æ¯”ä½œä¸ºç¬¬20ä¸ªè¯çš„è¡Œé«˜ã€‚è¿™å¾ˆé‡è¦ã€‚å…¨æ–‡æœ¬æœç´¢çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†å°±æ˜¯å¯¹ç»“æœæ’åºã€‚å…·æœ‰è¾ƒé«˜ç­‰çº§çš„è¡Œå…ˆè¿”å›(å› ä¸ºè¿™äº›è¡Œå¾ˆå¯èƒ½æ˜¯ä½ çœŸæ­£æƒ³è¦çš„è¡Œ)ã€‚</p>
<p>ä¸ºæ¼”ç¤ºæ’åºå¦‚ä½•å·¥ä½œ,è¯·çœ‹ä»¥ä¸‹ä¾‹å­:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select note_text,match(note_text) against('rabbit') as rank from productnotes;</span><br><span class="line">+-----------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+</span><br><span class="line">| note_text                                                                                                                                                 | rank               |</span><br><span class="line">+-----------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+</span><br><span class="line">| Customer complaint:</span><br><span class="line">Sticks not individually wrapped, too easy to mistakenly detonate all at once.</span><br><span class="line">Recommend individual wrapping.                          |                  0 |</span><br><span class="line">| Can shipped full, refills not available.</span><br><span class="line">Need to order new can if refill needed.                                                                          |                  0 |</span><br><span class="line">| Safe is combination locked, combination not provided with safe.</span><br><span class="line">This is rarely a problem as safes are typically blown up or dropped by customers.         |                  0 |</span><br><span class="line">| Quantity varies, sold by the sack load.</span><br><span class="line">All guaranteed to be bright and orange, and suitable for use as rabbit bait.                                      | 1.5905543565750122 |</span><br><span class="line">| Included fuses are short and have been known to detonate too quickly for some customers.</span><br><span class="line">Longer fuses are available (item FU1) and should be recommended. |                  0 |</span><br><span class="line">| Matches not included, recommend purchase of matches or detonator (item DTNTR).                                                                            |                  0 |</span><br><span class="line">| Please note that no returns will be accepted if safe opened using explosives.                                                                             |                  0 |</span><br><span class="line">| Multiple customer returns, anvils failing to drop fast enough or falling backwards on purchaser. Recommend that customer considers using heavier anvils.  |                  0 |</span><br><span class="line">| Item is extremely heavy. Designed for dropping, not recommended for use with slings, ropes, pulleys, or tightropes.                                       |                  0 |</span><br><span class="line">| Customer complaint: rabbit has been able to detect trap, food apparently less effective now.                                                              | 1.6408053636550903 |</span><br><span class="line">| Shipped unassembled, requires common tools (including oversized hammer).                                                                                  |                  0 |</span><br><span class="line">| Customer complaint:</span><br><span class="line">Circular hole in safe floor can apparently be easily cut with handsaw.                                                                |                  0 |</span><br><span class="line">| Customer complaint:</span><br><span class="line">Not heavy enough to generate flying stars around head of victim. If being purchased for dropping, recommend ANV02 or ANV03 instead.   |                  0 |</span><br><span class="line">| Call from individual trapped in safe plummeting to the ground, suggests an escape hatch be added.</span><br><span class="line">Comment forwarded to vendor.                            |                  0 |</span><br><span class="line">+-----------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ,åœ¨ <code>SELECT</code> è€Œä¸æ˜¯ <code>WHERE</code> å­å¥ä¸­ä½¿ç”¨ <code>Match()</code> å’Œ <code>Against()</code> ã€‚è¿™ä½¿æ‰€æœ‰è¡Œéƒ½è¢«è¿”å›(å› ä¸ºæ²¡æœ‰ WHERE å­å¥)ã€‚ <code>Match()</code> å’Œ <code>Against()</code>ç”¨æ¥å»ºç«‹ä¸€ä¸ªè®¡ç®—åˆ—(åˆ«åä¸º <code>rank</code> ),æ­¤åˆ—åŒ…å«å…¨æ–‡æœ¬æœç´¢è®¡ç®—å‡ºçš„ç­‰çº§å€¼ã€‚ç­‰çº§ç”±MySQLæ ¹æ®è¡Œä¸­è¯çš„æ•°ç›®ã€å”¯ä¸€è¯çš„æ•°ç›®ã€æ•´ä¸ªç´¢å¼•ä¸­è¯çš„æ€»æ•°ä»¥åŠåŒ…å«è¯¥è¯çš„è¡Œçš„æ•°ç›®è®¡ç®—å‡ºæ¥ã€‚æ­£å¦‚æ‰€è§,ä¸åŒ…å«è¯ <code>rabbit</code> çš„è¡Œç­‰çº§ä¸º0(å› æ­¤ä¸è¢«å‰ä¸€ä¾‹å­ä¸­çš„ <code>WHERE</code> å­å¥é€‰æ‹©)ã€‚ç¡®å®åŒ…å«è¯ <code>rabbit</code>çš„ä¸¤ä¸ªè¡Œæ¯è¡Œéƒ½æœ‰ä¸€ä¸ªç­‰çº§å€¼,æ–‡æœ¬ä¸­è¯é å‰çš„è¡Œçš„ç­‰çº§å€¼æ¯”è¯é åçš„è¡Œçš„ç­‰çº§å€¼é«˜ã€‚</p>
<p>è¿™ä¸ªä¾‹å­æœ‰åŠ©äºè¯´æ˜å…¨æ–‡æœ¬æœç´¢å¦‚ä½•æ’é™¤è¡Œ(æ’é™¤é‚£äº›ç­‰çº§ä¸º0çš„è¡Œ),å¦‚ä½•æ’åºç»“æœ(æŒ‰ç­‰çº§ä»¥é™åºæ’åº)ã€‚</p>
<p><strong>æ’åºå¤šä¸ªæœç´¢é¡¹</strong> å¦‚æœæŒ‡å®šå¤šä¸ªæœç´¢é¡¹,åˆ™åŒ…å«å¤šæ•°åŒ¹é…è¯çš„é‚£äº›è¡Œå°†å…·æœ‰æ¯”åŒ…å«è¾ƒå°‘è¯(æˆ–ä»…æœ‰ä¸€ä¸ªåŒ¹é…)çš„é‚£äº›è¡Œé«˜çš„ç­‰çº§å€¼ã€‚</p>
<p>æ­£å¦‚æ‰€è§,å…¨æ–‡æœ¬æœç´¢æä¾›äº†ç®€å• LIKE æœç´¢ä¸èƒ½æä¾›çš„åŠŸèƒ½ã€‚è€Œä¸”,ç”±äºæ•°æ®æ˜¯ç´¢å¼•çš„,å…¨æ–‡æœ¬æœç´¢è¿˜ç›¸å½“å¿«ã€‚</p>
<p>3.ä½¿ç”¨æŸ¥è¯¢æ‰©å±•</p>
<p>æŸ¥è¯¢æ‰©å±•ç”¨æ¥è®¾æ³•æ”¾å®½æ‰€è¿”å›çš„å…¨æ–‡æœ¬æœç´¢ç»“æœçš„èŒƒå›´ã€‚è€ƒè™‘ä¸‹é¢çš„æƒ…å†µã€‚ä½ æƒ³æ‰¾å‡ºæ‰€æœ‰æåˆ° anvils çš„æ³¨é‡Šã€‚åªæœ‰ä¸€ä¸ªæ³¨é‡ŠåŒ…å«è¯ anvils ,ä½†ä½ è¿˜æƒ³æ‰¾å‡ºå¯èƒ½ä¸ä½ çš„æœç´¢æœ‰å…³çš„æ‰€æœ‰å…¶ä»–è¡Œ,å³ä½¿å®ƒä»¬ä¸åŒ…å«è¯anvils ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯æŸ¥è¯¢æ‰©å±•çš„ä¸€é¡¹ä»»åŠ¡ã€‚åœ¨ä½¿ç”¨æŸ¥è¯¢æ‰©å±•æ—¶,MySQLå¯¹æ•°æ®å’Œç´¢å¼•è¿›è¡Œä¸¤éæ‰«ææ¥å®Œæˆæœç´¢:</p>
<ul>
<li>é¦–å…ˆ,è¿›è¡Œä¸€ä¸ªåŸºæœ¬çš„å…¨æ–‡æœ¬æœç´¢,æ‰¾å‡ºä¸æœç´¢æ¡ä»¶åŒ¹é…çš„æ‰€æœ‰è¡Œ;</li>
<li>å…¶æ¬¡,MySQLæ£€æŸ¥è¿™äº›åŒ¹é…è¡Œå¹¶é€‰æ‹©æ‰€æœ‰æœ‰ç”¨çš„è¯(æˆ‘ä»¬å°†ä¼šç®€è¦åœ°è§£é‡ŠMySQLå¦‚ä½•æ–­å®šä»€ä¹ˆæœ‰ç”¨,ä»€ä¹ˆæ— ç”¨)ã€‚</li>
<li>å†å…¶æ¬¡, MySQLå†æ¬¡è¿›è¡Œå…¨æ–‡æœ¬æœç´¢,è¿™æ¬¡ä¸ä»…ä½¿ç”¨åŸæ¥çš„æ¡ä»¶,è€Œä¸”è¿˜ä½¿ç”¨æ‰€æœ‰æœ‰ç”¨çš„è¯ã€‚</li>
</ul>
<p>åˆ©ç”¨æŸ¥è¯¢æ‰©å±•,èƒ½æ‰¾å‡ºå¯èƒ½ç›¸å…³çš„ç»“æœ,å³ä½¿å®ƒä»¬å¹¶ä¸ç²¾ç¡®åŒ…å«æ‰€æŸ¥æ‰¾çš„è¯ã€‚</p>
<p><strong>åªç”¨äºMySQLç‰ˆæœ¬4.1.1æˆ–æ›´é«˜çº§çš„ç‰ˆæœ¬</strong> æŸ¥è¯¢æ‰©å±•åŠŸèƒ½æ˜¯åœ¨MySQL 4.1.1ä¸­å¼•å…¥çš„,å› æ­¤ä¸èƒ½ç”¨äºä¹‹å‰çš„ç‰ˆæœ¬ã€‚</p>
<p>ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­,é¦–å…ˆè¿›è¡Œä¸€ä¸ªç®€å•çš„å…¨æ–‡æœ¬æœç´¢,æ²¡æœ‰æŸ¥è¯¢æ‰©å±•:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select note_text from productnotes where match(note_text) against('anvils');</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| note_text                                                                                                                                                |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Multiple customer returns, anvils failing to drop fast enough or falling backwards on purchaser. Recommend that customer considers using heavier anvils. |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>åªæœ‰ä¸€è¡ŒåŒ…å«è¯ anvils ,å› æ­¤åªè¿”å›ä¸€è¡Œã€‚</p>
<p>ä¸‹é¢æ˜¯ç›¸åŒçš„æœç´¢,è¿™æ¬¡ä½¿ç”¨æŸ¥è¯¢æ‰©å±•:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select note_text from productnotes where match(note_text) against('anvils' with query expansion);</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| note_text                                                                                                                                                |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Multiple customer returns, anvils failing to drop fast enough or falling backwards on purchaser. Recommend that customer considers using heavier anvils. |</span><br><span class="line">| Customer complaint:</span><br><span class="line">Sticks not individually wrapped, too easy to mistakenly detonate all at once.</span><br><span class="line">Recommend individual wrapping.                         |</span><br><span class="line">| Customer complaint:</span><br><span class="line">Not heavy enough to generate flying stars around head of victim. If being purchased for dropping, recommend ANV02 or ANV03 instead.  |</span><br><span class="line">| Please note that no returns will be accepted if safe opened using explosives.                                                                            |</span><br><span class="line">| Customer complaint: rabbit has been able to detect trap, food apparently less effective now.                                                             |</span><br><span class="line">| Customer complaint:</span><br><span class="line">Circular hole in safe floor can apparently be easily cut with handsaw.                                                               |</span><br><span class="line">| Matches not included, recommend purchase of matches or detonator (item DTNTR).                                                                           |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¬¡è¿”å›äº†7è¡Œã€‚ç¬¬ä¸€è¡ŒåŒ…å«è¯ <code>anvils</code> ,å› æ­¤ç­‰çº§æœ€é«˜ã€‚ç¬¬äºŒè¡Œä¸ <code>anvils</code> æ— å…³,ä½†å› ä¸ºå®ƒåŒ…å«ç¬¬ä¸€è¡Œä¸­çš„ä¸¤ä¸ªè¯( <code>customer</code>å’Œ <code>recommend</code> ),æ‰€ä»¥ä¹Ÿè¢«æ£€ç´¢å‡ºæ¥ã€‚ç¬¬3è¡Œä¹ŸåŒ…å«è¿™ä¸¤ä¸ªç›¸åŒçš„è¯,ä½†å®ƒä»¬åœ¨æ–‡æœ¬ä¸­çš„ä½ç½®æ›´é åä¸”åˆ†å¼€å¾—æ›´è¿œ,å› æ­¤ä¹ŸåŒ…å«è¿™ä¸€è¡Œ,ä½†ç­‰çº§ä¸ºç¬¬ä¸‰ã€‚ç¬¬ä¸‰è¡Œç¡®å®ä¹Ÿæ²¡æœ‰æ¶‰åŠ <code>anvils</code> (æŒ‰å®ƒä»¬çš„äº§å“å)ã€‚</p>
<p>æ­£å¦‚æ‰€è§,æŸ¥è¯¢æ‰©å±•æå¤§åœ°å¢åŠ äº†è¿”å›çš„è¡Œæ•°,ä½†è¿™æ ·åšä¹Ÿå¢åŠ äº†ä½ å®é™…ä¸Šå¹¶ä¸æƒ³è¦çš„è¡Œçš„æ•°ç›®ã€‚</p>
<p><strong>è¡Œè¶Šå¤šè¶Šå¥½</strong> è¡¨ä¸­çš„è¡Œè¶Šå¤š(è¿™äº›è¡Œä¸­çš„æ–‡æœ¬å°±è¶Šå¤š),ä½¿ç”¨æŸ¥è¯¢æ‰©å±•è¿”å›çš„ç»“æœè¶Šå¥½ã€‚</p>
<p>4.å¸ƒå°”æ–‡æœ¬æœç´¢</p>
<p>MySQLæ”¯æŒå…¨æ–‡æœ¬æœç´¢çš„å¦å¤–ä¸€ç§å½¢å¼,ç§°ä¸ºå¸ƒå°”æ–¹å¼(boolean mode)ã€‚</p>
<p>ä»¥å¸ƒå°”æ–¹å¼,å¯ä»¥æä¾›å…³äºå¦‚ä¸‹å†…å®¹çš„ç»†èŠ‚:</p>
<ul>
<li>è¦åŒ¹é…çš„è¯;</li>
<li>è¦æ’æ–¥çš„è¯(å¦‚æœæŸè¡ŒåŒ…å«è¿™ä¸ªè¯,åˆ™ä¸è¿”å›è¯¥è¡Œ,å³ä½¿å®ƒåŒ…å«å…¶ä»–æŒ‡å®šçš„è¯ä¹Ÿæ˜¯å¦‚æ­¤);</li>
<li>æ’åˆ—æç¤º(æŒ‡å®šæŸäº›è¯æ¯”å…¶ä»–è¯æ›´é‡è¦,æ›´é‡è¦çš„è¯ç­‰çº§æ›´é«˜);</li>
<li>è¡¨è¾¾å¼åˆ†ç»„;</li>
<li>å¦å¤–ä¸€äº›å†…å®¹ã€‚</li>
</ul>
<p><strong>å³ä½¿æ²¡æœ‰ FULLTEXT ç´¢å¼•ä¹Ÿå¯ä»¥ä½¿ç”¨</strong> å¸ƒå°”æ–¹å¼ä¸åŒäºè¿„ä»Šä¸ºæ­¢ä½¿ç”¨çš„å…¨æ–‡æœ¬æœç´¢è¯­æ³•çš„åœ°æ–¹åœ¨äº,å³ä½¿æ²¡æœ‰å®šä¹‰FULLTEXT ç´¢å¼•,ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒã€‚ä½†è¿™æ˜¯ä¸€ç§éå¸¸ç¼“æ…¢çš„æ“ä½œ(å…¶æ€§èƒ½å°†éšç€æ•°æ®é‡çš„å¢åŠ è€Œé™ä½)ã€‚</p>
<p>ä¸ºæ¼”ç¤º IN BOOLEAN MODE çš„ä½œç”¨,ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select note_text from productnotes where match(note_text) against('heavy' in boolean mode);</span><br><span class="line">+---------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| note_text                                                                                                                                               |</span><br><span class="line">+---------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Item is extremely heavy. Designed for dropping, not recommended for use with slings, ropes, pulleys, or tightropes.                                     |</span><br><span class="line">| Customer complaint:</span><br><span class="line">Not heavy enough to generate flying stars around head of victim. If being purchased for dropping, recommend ANV02 or ANV03 instead. |</span><br><span class="line">+---------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ­¤å…¨æ–‡æœ¬æœç´¢æ£€ç´¢åŒ…å«è¯ heavy çš„æ‰€æœ‰è¡Œ(æœ‰ä¸¤è¡Œ)ã€‚å…¶ä¸­ä½¿ç”¨äº†å…³é”®å­— IN BOOLEAN MODE ,ä½†å®é™…ä¸Šæ²¡æœ‰æŒ‡å®šå¸ƒå°”æ“ä½œç¬¦,å› æ­¤,å…¶ç»“æœä¸æ²¡æœ‰æŒ‡å®šå¸ƒå°”æ–¹å¼çš„ç»“æœç›¸åŒã€‚</p>
<p><strong>IN BOOLEAN MODE çš„è¡Œä¸ºå·®å¼‚</strong> è™½ç„¶è¿™ä¸ªä¾‹å­çš„ç»“æœä¸æ²¡æœ‰IN BOOLEAN MODE çš„ç›¸åŒ,ä½†å…¶è¡Œä¸ºæœ‰ä¸€ä¸ªé‡è¦çš„å·®åˆ«(å³ä½¿åœ¨è¿™ä¸ªç‰¹æ®Šçš„ä¾‹å­æ²¡æœ‰è¡¨ç°å‡ºæ¥)ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸ºäº†åŒ¹é…åŒ…å« heavy ä½†ä¸åŒ…å«ä»»æ„ä»¥ rope å¼€å§‹çš„è¯çš„è¡Œ,å¯ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select note_text from productnotes where match(note_text) against('heavy -rope*' in boolean mode);</span><br><span class="line">+---------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| note_text                                                                                                                                               |</span><br><span class="line">+---------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Customer complaint:</span><br><span class="line">Not heavy enough to generate flying stars around head of victim. If being purchased for dropping, recommend ANV02 or ANV03 instead. |</span><br><span class="line">+---------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¬¡åªè¿”å›ä¸€è¡Œã€‚è¿™ä¸€æ¬¡ä»ç„¶åŒ¹é…è¯ <code>heavy</code> ,ä½† <code>-rope*</code> æ˜ç¡®åœ°æŒ‡ç¤º MySQLæ’é™¤ åŒ…å« <code>rope*</code> (ä»»ä½•ä»¥ <code>rope</code> å¼€å§‹ çš„è¯,åŒ… æ‹¬<code>ropes</code> )çš„è¡Œ,è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸Šä¸€ä¸ªä¾‹å­ä¸­çš„ç¬¬ä¸€è¡Œè¢«æ’é™¤çš„åŸå› ã€‚</p>
<p><strong>åœ¨MySQL 4.xä¸­æ‰€éœ€çš„ä»£ç æ›´æ”¹</strong> å¦‚æœä½ ä½¿ç”¨çš„æ˜¯MySQL4.x,åˆ™ä¸Šé¢çš„ä¾‹å­å¯èƒ½ä¸è¿”å›ä»»ä½•è¡Œã€‚è¿™æ˜¯ * æ“ä½œç¬¦å¤„ç†ä¸­çš„ä¸€ä¸ªé”™è¯¯ã€‚ä¸ºåœ¨MySQL 4.xä¸­ä½¿ç”¨è¿™ä¸ªä¾‹å­,ä½¿ç”¨ -ropes è€Œä¸æ˜¯ -rope* (æ’é™¤ ropes è€Œä¸æ˜¯æ’é™¤ä»»ä½•ä»¥ rope å¼€å§‹çš„è¯)ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å…¨æ–‡æœ¬å¸ƒå°”æ“ä½œç¬¦</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">+</td>
<td align="left">åŒ…å«,è¯å¿…é¡»å­˜åœ¨</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">æ’é™¤,è¯å¿…é¡»ä¸å‡ºç°</td>
</tr>
<tr>
<td align="left">&gt;</td>
<td align="left">åŒ…å«,è€Œä¸”å¢åŠ ç­‰çº§å€¼</td>
</tr>
<tr>
<td align="left">&lt;</td>
<td align="left">åŒ…å«,ä¸”å‡å°‘ç­‰çº§å€¼</td>
</tr>
<tr>
<td align="left">()</td>
<td align="left">æŠŠè¯ç»„æˆå­è¡¨è¾¾å¼(å…è®¸è¿™äº›å­è¡¨è¾¾å¼ä½œä¸ºä¸€ä¸ªç»„è¢«åŒ…å«ã€æ’é™¤ã€æ’åˆ—ç­‰)</td>
</tr>
<tr>
<td align="left">~</td>
<td align="left">å–æ¶ˆä¸€ä¸ªè¯çš„æ’åºå€¼</td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">è¯å°¾çš„é€šé…ç¬¦</td>
</tr>
<tr>
<td align="left">â€œâ€</td>
<td align="left">å®šä¹‰ä¸€ä¸ªçŸ­è¯­(ä¸å•ä¸ªè¯çš„åˆ—è¡¨ä¸ä¸€æ ·,å®ƒåŒ¹é…æ•´ä¸ªçŸ­è¯­ä»¥ä¾¿åŒ…å«æˆ–æ’é™¤è¿™ä¸ªçŸ­è¯­)</td>
</tr>
</tbody></table>
<p>ä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­,è¯´æ˜æŸäº›æ“ä½œç¬¦å¦‚ä½•ä½¿ç”¨:</p>
<blockquote>
<blockquote>
<p>æœç´¢åŒ¹é…åŒ…å«è¯ rabbit å’Œ bait çš„è¡Œã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select note_text from productnotes where match(note_text) against('+rabbit +bait' in boolean mode);</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| note_text                                                                                                            |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Quantity varies, sold by the sack load.</span><br><span class="line">All guaranteed to be bright and orange, and suitable for use as rabbit bait. |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>æœç´¢åŒ¹é…åŒ…å« rabbit å’Œ bait ä¸­çš„è‡³å°‘ä¸€ä¸ªè¯çš„è¡Œã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select note_text from productnotes where match(note_text) against('rabbit bait' in boolean mode);</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| note_text                                                                                                            |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Quantity varies, sold by the sack load.</span><br><span class="line">All guaranteed to be bright and orange, and suitable for use as rabbit bait. |</span><br><span class="line">| Customer complaint: rabbit has been able to detect trap, food apparently less effective now.                         |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>æœç´¢åŒ¹é…çŸ­è¯­ rabbit bait è€Œä¸æ˜¯åŒ¹é…ä¸¤ä¸ªè¯ rabbit å’Œ bait ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select note_text from productnotes where match(note_text) against('"rabbit bait"' in boolean mode);</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| note_text                                                                                                            |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Quantity varies, sold by the sack load.</span><br><span class="line">All guaranteed to be bright and orange, and suitable for use as rabbit bait. |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>æœç´¢åŒ¹é… rabbit å’Œ carrot ,å¢åŠ å‰è€…çš„ç­‰çº§,é™ä½åè€…çš„ç­‰çº§ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select note_text from productnotes where match(note_text) against('&gt;rabbit &lt;carrot' in boolean mode);</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| note_text                                                                                                            |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Quantity varies, sold by the sack load.</span><br><span class="line">All guaranteed to be bright and orange, and suitable for use as rabbit bait. |</span><br><span class="line">| Customer complaint: rabbit has been able to detect trap, food apparently less effective now.                         |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>æœç´¢åŒ¹é…è¯ safe å’Œ combination ,é™ä½åè€…çš„ç­‰çº§ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select note_text from productnotes where match(note_text) against('+safe +(&lt;combination)' in boolean mode);</span><br><span class="line">+---------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| note_text                                                                                                                                         |</span><br><span class="line">+---------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Safe is combination locked, combination not provided with safe.</span><br><span class="line">This is rarely a problem as safes are typically blown up or dropped by customers. |</span><br><span class="line">+---------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>æ’åˆ—è€Œä¸æ’åº</strong> åœ¨å¸ƒå°”æ–¹å¼ä¸­,ä¸æŒ‰ç­‰çº§å€¼é™åºæ’åºè¿”å›çš„è¡Œã€‚</p>
<p>5.å…¨æ–‡æœ¬æœç´¢çš„ä½¿ç”¨è¯´æ˜</p>
<p>åœ¨ç»“æŸæœ¬ç« ä¹‹å‰,ç»™å‡ºå…³äºå…¨æ–‡æœ¬æœç´¢çš„æŸäº›é‡è¦çš„è¯´æ˜ã€‚</p>
<ul>
<li>åœ¨ç´¢å¼•å…¨æ–‡æœ¬æ•°æ®æ—¶,çŸ­è¯è¢«å¿½ç•¥ä¸”ä»ç´¢å¼•ä¸­æ’é™¤ã€‚çŸ­è¯å®šä¹‰ä¸ºé‚£äº›å…·æœ‰3ä¸ªæˆ–3ä¸ªä»¥ä¸‹å­—ç¬¦çš„è¯(å¦‚æœéœ€è¦,è¿™ä¸ªæ•°ç›®å¯ä»¥æ›´æ”¹)ã€‚</li>
<li>MySQLå¸¦æœ‰ä¸€ä¸ªå†…å»ºçš„éç”¨è¯(stopword)åˆ—è¡¨,è¿™äº›è¯åœ¨ç´¢å¼•å…¨æ–‡æœ¬æ•°æ®æ—¶æ€»æ˜¯è¢«å¿½ç•¥ã€‚å¦‚æœéœ€è¦,å¯ä»¥è¦†ç›–è¿™ä¸ªåˆ—è¡¨(è¯·å‚é˜…MySQLæ–‡æ¡£ä»¥äº†è§£å¦‚ä½•å®Œæˆæ­¤å·¥ä½œ)ã€‚</li>
<li>è®¸å¤šè¯å‡ºç°çš„é¢‘ç‡å¾ˆé«˜,æœç´¢å®ƒä»¬æ²¡æœ‰ç”¨å¤„(è¿”å›å¤ªå¤šçš„ç»“æœ)ã€‚å› æ­¤,MySQLè§„å®šäº†ä¸€æ¡50%è§„åˆ™,å¦‚æœä¸€ä¸ªè¯å‡ºç°åœ¨50%ä»¥ä¸Šçš„è¡Œä¸­,åˆ™å°†å®ƒä½œä¸ºä¸€ä¸ªéç”¨è¯å¿½ç•¥ã€‚ 50%è§„åˆ™ä¸ç”¨äº IN BOOLEANMODE ã€‚</li>
<li>å¦‚æœè¡¨ä¸­çš„è¡Œæ•°å°‘äº3è¡Œ,åˆ™å…¨æ–‡æœ¬æœç´¢ä¸è¿”å›ç»“æœ(å› ä¸ºæ¯ä¸ªè¯æˆ–è€…ä¸å‡ºç°,æˆ–è€…è‡³å°‘å‡ºç°åœ¨50%çš„è¡Œä¸­)ã€‚</li>
<li>å¿½ç•¥è¯ä¸­çš„å•å¼•å·ã€‚ä¾‹å¦‚, donâ€™t ç´¢å¼•ä¸º dont ã€‚</li>
<li>ä¸å…·æœ‰è¯åˆ†éš”ç¬¦(åŒ…æ‹¬æ—¥è¯­å’Œæ±‰è¯­)çš„è¯­è¨€ä¸èƒ½æ°å½“åœ°è¿”å›å…¨æ–‡æœ¬æœç´¢ç»“æœã€‚</li>
<li>å¦‚å‰æ‰€è¿°,ä»…åœ¨ MyISAM æ•°æ®åº“å¼•æ“ä¸­æ”¯æŒå…¨æ–‡æœ¬æœç´¢ã€‚</li>
</ul>
<p><strong>æ²¡æœ‰é‚»è¿‘æ“ä½œç¬¦</strong> é‚»è¿‘æœç´¢æ˜¯è®¸å¤šå…¨æ–‡æœ¬æœç´¢æ”¯æŒçš„ä¸€ä¸ªç‰¹æ€§,å®ƒèƒ½æœç´¢ç›¸é‚»çš„è¯(åœ¨ç›¸åŒçš„å¥å­ä¸­ã€ç›¸åŒçš„æ®µè½ä¸­æˆ–è€…åœ¨ç‰¹å®šæ•°ç›®çš„è¯çš„éƒ¨åˆ†ä¸­,ç­‰ç­‰)ã€‚MySQLå…¨æ–‡æœ¬æœç´¢ç°åœ¨è¿˜ä¸æ”¯æŒé‚»è¿‘æ“ä½œç¬¦,ä¸è¿‡æœªæ¥çš„ç‰ˆæœ¬æœ‰æ”¯æŒè¿™ç§æ“ä½œç¬¦çš„è®¡åˆ’ã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« ä»‹ç»äº†ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å…¨æ–‡æœ¬æœç´¢,ä»¥åŠå¦‚ä½•ä½¿ç”¨MySQLçš„Match() å’Œ Against() å‡½æ•°è¿›è¡Œå…¨æ–‡æœ¬æœç´¢ã€‚æˆ‘ä»¬è¿˜å­¦ä¹ äº†æŸ¥è¯¢æ‰©å±•(å®ƒèƒ½å¢åŠ æ‰¾åˆ°ç›¸å…³åŒ¹é…çš„æœºä¼š)å’Œå¦‚ä½•ä½¿ç”¨å¸ƒå°”æ–¹å¼è¿›è¡Œæ›´ç»†è‡´çš„æŸ¥æ‰¾æ§åˆ¶ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h3 id="DDLè¯­è¨€"><a href="#DDLè¯­è¨€" class="headerlink" title="DDLè¯­è¨€"></a>DDLè¯­è¨€</h3><blockquote>
<p>DDL æ˜¯æ•°æ®å®šä¹‰è¯­è¨€çš„ç¼©å†™,ç®€å•æ¥è¯´,å°±æ˜¯å¯¹æ•°æ®åº“å†…éƒ¨çš„å¯¹è±¡è¿›è¡Œåˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹çš„æ“ä½œè¯­è¨€ã€‚å®ƒå’Œ DML è¯­è¨€çš„æœ€å¤§åŒºåˆ«æ˜¯ DML åªæ˜¯å¯¹è¡¨å†…éƒ¨æ•°æ®çš„æ“ä½œ,è€Œä¸æ¶‰åŠåˆ°è¡¨çš„å®šä¹‰ã€ç»“æ„çš„ä¿®æ”¹,æ›´ä¸ä¼šæ¶‰åŠåˆ°å…¶ä»–å¯¹è±¡ã€‚ DDL è¯­å¥æ›´å¤šçš„è¢«æ•°æ®åº“ç®¡ç†å‘˜(DBA)æ‰€ä½¿ç”¨,ä¸€èˆ¬çš„å¼€å‘äººå‘˜å¾ˆå°‘ä½¿ç”¨ã€‚</p>
</blockquote>
<h4 id="åˆ›å»ºå’Œæ“çºµè¡¨"><a href="#åˆ›å»ºå’Œæ“çºµè¡¨" class="headerlink" title="åˆ›å»ºå’Œæ“çºµè¡¨"></a>åˆ›å»ºå’Œæ“çºµè¡¨</h4><p>æœ¬ç« è®²æˆè¡¨çš„åˆ›å»ºã€æ›´æ”¹å’Œåˆ é™¤çš„åŸºæœ¬çŸ¥è¯†ã€‚</p>
<blockquote>
<p>åˆ›å»ºè¡¨</p>
</blockquote>
<p>MySQLä¸ä»…ç”¨äºè¡¨æ•°æ®æ“çºµ,è€Œä¸”è¿˜å¯ä»¥ç”¨æ¥æ‰§è¡Œæ•°æ®åº“å’Œè¡¨çš„æ‰€æœ‰æ“ä½œ,åŒ…æ‹¬è¡¨æœ¬èº«çš„åˆ›å»ºå’Œå¤„ç†ã€‚</p>
<p>ä¸€èˆ¬æœ‰ä¸¤ç§åˆ›å»ºè¡¨çš„æ–¹æ³•:</p>
<ul>
<li>ä½¿ç”¨å…·æœ‰äº¤äº’å¼åˆ›å»ºå’Œç®¡ç†è¡¨çš„å·¥å…·(å¦‚ç¬¬2ç« è®¨è®ºçš„å·¥å…·);</li>
<li>è¡¨ä¹Ÿå¯ä»¥ç›´æ¥ç”¨MySQLè¯­å¥æ“çºµã€‚</li>
</ul>
<p>ä¸ºäº†ç”¨ç¨‹åºåˆ›å»ºè¡¨,å¯ä½¿ç”¨SQLçš„ <code>CREATE TABLE</code> è¯­å¥ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯,åœ¨ä½¿ç”¨äº¤äº’å¼å·¥å…·æ—¶,å®é™…ä¸Šä½¿ç”¨çš„æ˜¯MySQLè¯­å¥ã€‚ä½†æ˜¯,è¿™äº›è¯­å¥ä¸æ˜¯ç”¨æˆ·ç¼–å†™çš„,ç•Œé¢å·¥å…·ä¼šè‡ªåŠ¨ç”Ÿæˆå¹¶æ‰§è¡Œç›¸åº”çš„MySQLè¯­å¥(æ›´æ”¹ç°æœ‰è¡¨æ—¶ä¹Ÿæ˜¯è¿™æ ·)ã€‚</p>
<p>1.è¡¨åˆ›å»ºåŸºç¡€</p>
<p>ä¸ºåˆ©ç”¨ CREATE TABLE åˆ›å»ºè¡¨,å¿…é¡»ç»™å‡ºä¸‹åˆ—ä¿¡æ¯:</p>
<ul>
<li>æ–°è¡¨çš„åå­—,åœ¨å…³é”®å­— CREATE TABLE ä¹‹åç»™å‡º;</li>
<li>è¡¨åˆ—çš„åå­—å’Œå®šä¹‰,ç”¨é€—å·åˆ†éš”ã€‚</li>
</ul>
<p>CREATE TABLE è¯­å¥ä¹Ÿå¯èƒ½ä¼šåŒ…æ‹¬å…¶ä»–å…³é”®å­—æˆ–é€‰é¡¹,ä½†è‡³å°‘è¦åŒ…æ‹¬è¡¨çš„åå­—å’Œåˆ—çš„ç»†èŠ‚ã€‚ä¸‹é¢çš„MySQLè¯­å¥åˆ›å»ºæˆ‘ä»¬æ‰€ç”¨çš„ customers è¡¨:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create table customers</span><br><span class="line">    -&gt; (</span><br><span class="line">    -&gt; cust_id int not null auto_increment,</span><br><span class="line">    -&gt; cust_name char(50) not null,</span><br><span class="line">    -&gt; cust_address char(50) null,</span><br><span class="line">    -&gt; cust_city char(50) null,</span><br><span class="line">    -&gt; cust_state char(5) null,</span><br><span class="line">    -&gt; cust_zip char(10) null,</span><br><span class="line">    -&gt; cust_country char(50) null,</span><br><span class="line">    -&gt; cust_contact char(50) null,</span><br><span class="line">    -&gt; cust_email char(255) null,</span><br><span class="line">    -&gt; primary key (cust_id)</span><br><span class="line">    -&gt; ) engine=innodb;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°,è¡¨åç´§è·Ÿåœ¨ <code>CREATE TABLE</code> å…³é”®å­—åé¢ã€‚å®é™…çš„è¡¨å®šä¹‰(æ‰€æœ‰åˆ—)æ‹¬åœ¨åœ†æ‹¬å·ä¹‹ä¸­ã€‚å„åˆ—ä¹‹é—´ç”¨é€—å·åˆ†éš”ã€‚è¿™ä¸ªè¡¨ç”±9åˆ—ç»„æˆã€‚æ¯åˆ—çš„å®šä¹‰ä»¥åˆ—å(å®ƒåœ¨è¡¨ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„)å¼€å§‹,åè·Ÿåˆ—çš„æ•°æ®ç±»å‹(å…³äºæ•°æ®ç±»å‹çš„è§£é‡Š,è¯·å‚é˜…ç¬¬1ç« ã€‚æ­¤å¤–,é™„å½•Dåˆ—å‡ºäº†MySQLæ”¯æŒçš„æ•°æ®ç±»å‹)ã€‚è¡¨çš„ä¸»é”®å¯ä»¥åœ¨åˆ›å»ºè¡¨æ—¶ç”¨<code>PRIMARY KEY</code> å…³é”®å­—æŒ‡å®šã€‚è¿™é‡Œ,åˆ— <code>cust_id</code> æŒ‡å®šä½œä¸ºä¸»é”®åˆ—ã€‚æ•´æ¡è¯­å¥ç”±å³åœ†æ‹¬å·åçš„åˆ†å·ç»“æŸã€‚( ç°åœ¨å…ˆå¿½ç•¥<code>ENGINE=InnoDB</code> å’Œ<code>AUTO_INCREMENT</code> ,åé¢ä¼šå¯¹å®ƒä»¬è¿›è¡Œä»‹ç»ã€‚)</p>
<p><strong>è¯­å¥æ ¼å¼åŒ–</strong> å¯å›å¿†ä¸€ä¸‹,ä»¥å‰è¯´è¿‡MySQLè¯­å¥ä¸­å¿½ç•¥ç©ºæ ¼ã€‚è¯­å¥å¯ä»¥åœ¨ä¸€ä¸ªé•¿è¡Œä¸Šè¾“å…¥,ä¹Ÿå¯ä»¥åˆ†æˆè®¸å¤šè¡Œã€‚å®ƒä»¬çš„ä½œç”¨éƒ½ç›¸åŒã€‚è¿™å…è®¸ä½ ä»¥æœ€é€‚åˆè‡ªå·±çš„æ–¹å¼å®‰æ’è¯­å¥çš„æ ¼å¼ã€‚å‰é¢çš„ CREATE TABLE è¯­å¥å°±æ˜¯è¯­å¥æ ¼å¼åŒ–çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­,å®ƒè¢«å®‰æ’åœ¨å¤šä¸ªè¡Œä¸Š,å…¶ä¸­çš„åˆ—å®šä¹‰è¿›è¡Œäº†æ°å½“çš„ç¼©è¿›,ä»¥ä¾¿é˜…è¯»å’Œç¼–è¾‘ã€‚ä»¥ä½•ç§ç¼©è¿›æ ¼å¼å®‰æ’SQLè¯­å¥æ²¡æœ‰è§„å®š,ä½†æˆ‘å¼ºçƒˆæ¨èé‡‡ç”¨æŸç§ç¼©è¿›æ ¼å¼ã€‚</p>
<p><strong>å¤„ç†ç°æœ‰çš„è¡¨</strong> åœ¨åˆ›å»ºæ–°è¡¨æ—¶,æŒ‡å®šçš„è¡¨åå¿…é¡»ä¸å­˜åœ¨,å¦åˆ™å°†å‡ºé”™ã€‚å¦‚æœè¦é˜²æ­¢æ„å¤–è¦†ç›–å·²æœ‰çš„è¡¨,SQLè¦æ±‚é¦–å…ˆæ‰‹å·¥åˆ é™¤è¯¥è¡¨,ç„¶åå†é‡å»ºå®ƒ,è€Œä¸æ˜¯ç®€å•åœ°ç”¨åˆ›å»ºè¡¨è¯­å¥è¦†ç›–å®ƒã€‚å¦‚æœä½ ä»…æƒ³åœ¨ä¸€ä¸ªè¡¨ä¸å­˜åœ¨æ—¶åˆ›å»ºå®ƒ,åº”è¯¥åœ¨è¡¨ååç»™å‡º <code>IF NOT EXISTS</code> ã€‚è¿™æ ·åšä¸æ£€æŸ¥å·²æœ‰è¡¨çš„æ¨¡å¼æ˜¯å¦ä¸ä½ æ‰“ç®—åˆ›å»ºçš„è¡¨æ¨¡å¼ç›¸åŒ¹é…ã€‚å®ƒåªæ˜¯æŸ¥çœ‹è¡¨åæ˜¯å¦å­˜åœ¨,å¹¶ä¸”ä»…åœ¨è¡¨åä¸å­˜åœ¨æ—¶åˆ›å»ºå®ƒã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">DROP TABLE IF EXISTS columns_priv;</span><br><span class="line">CREATE TABLE columns_priv (</span><br><span class="line">  Host char(60) COLLATE utf8_bin NOT NULL DEFAULT '',</span><br><span class="line">  Db char(64) COLLATE utf8_bin NOT NULL DEFAULT '',</span><br><span class="line">  User char(16) COLLATE utf8_bin NOT NULL DEFAULT '',</span><br><span class="line">  Table_name char(64) COLLATE utf8_bin NOT NULL DEFAULT '',</span><br><span class="line">  Column_name char(64) COLLATE utf8_bin NOT NULL DEFAULT '',</span><br><span class="line">  Timestamp timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  Column_priv set('Select','Insert','Update','References') CHARACTER SET utf8 NOT NULL DEFAULT '',</span><br><span class="line">  PRIMARY KEY (Host,Db,User,Table_name,Column_name)</span><br><span class="line">) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='Column privileges';</span><br></pre></td></tr></table></figure>
<p>2.ä½¿ç”¨ NULL å€¼</p>
<p>å‰é¢ç« èŠ‚ä¸­è¯´è¿‡, NULL å€¼å°±æ˜¯æ²¡æœ‰å€¼æˆ–ç¼ºå€¼ã€‚å…è®¸ NULL å€¼çš„åˆ—ä¹Ÿå…è®¸åœ¨æ’å…¥è¡Œæ—¶ä¸ç»™å‡ºè¯¥åˆ—çš„å€¼ã€‚ä¸å…è®¸ NULL å€¼çš„åˆ—ä¸æ¥å—è¯¥åˆ—æ²¡æœ‰å€¼çš„è¡Œ,æ¢å¥è¯è¯´,åœ¨æ’å…¥æˆ–æ›´æ–°è¡Œæ—¶,è¯¥åˆ—å¿…é¡»æœ‰å€¼ã€‚</p>
<p>æ¯ä¸ªè¡¨åˆ—æˆ–è€…æ˜¯ NULL åˆ—,æˆ–è€…æ˜¯ NOT NULL åˆ—,è¿™ç§çŠ¶æ€åœ¨åˆ›å»ºæ—¶ç”±è¡¨çš„å®šä¹‰è§„å®šã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­:</p>
<blockquote>
<blockquote>
<p>åˆ›å»º orders è¡¨</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create table orders</span><br><span class="line">    -&gt; (</span><br><span class="line">    -&gt; order_num int not null auto_increment,</span><br><span class="line">    -&gt; order_date datetime not null,</span><br><span class="line">    -&gt; cust_id int not null,</span><br><span class="line">    -&gt; primary key (order_num)</span><br><span class="line">    -&gt; ) engine=innodb;</span><br></pre></td></tr></table></figure>

<p><code>orders</code> åŒ…å«3ä¸ªåˆ—,åˆ†åˆ«æ˜¯è®¢å•å·ã€è®¢å•æ—¥æœŸå’Œå®¢æˆ·IDã€‚æ‰€æœ‰3ä¸ªåˆ—éƒ½éœ€è¦,å› æ­¤æ¯ä¸ªåˆ—çš„å®šä¹‰éƒ½å«æœ‰å…³é”®å­— <code>NOT NULL</code> ã€‚è¿™å°†ä¼šé˜»æ­¢æ’å…¥æ²¡æœ‰å€¼çš„åˆ—ã€‚å¦‚æœè¯•å›¾æ’å…¥æ²¡æœ‰å€¼çš„åˆ—,å°†è¿”å›é”™è¯¯,ä¸”æ’å…¥å¤±è´¥ã€‚</p>
<blockquote>
<blockquote>
<p>åˆ›å»º vendors è¡¨</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">CREATE TABLE vendors (</span><br><span class="line">  vend_id int NOT NULL AUTO_INCREMENT,</span><br><span class="line">  vend_name char(50) NOT NULL,</span><br><span class="line">  vend_address char(50) NULL,</span><br><span class="line">  vend_city char(50) NULL,</span><br><span class="line">  vend_state char(5) NULL,</span><br><span class="line">  vend_zip char(10) NULL,</span><br><span class="line">  vend_country char(50) NULL,</span><br><span class="line">  PRIMARY KEY (vend_id)</span><br><span class="line">) ENGINE=InnoDB;</span><br></pre></td></tr></table></figure>

<p>ä¾›åº”å•†IDå’Œä¾›åº”å•†åå­—åˆ—æ˜¯å¿…éœ€çš„,å› æ­¤æŒ‡å®šä¸º <code>NOT NULL</code> ã€‚å…¶ä½™5ä¸ªåˆ—å…¨éƒ½å…è®¸ <code>NULL</code> å€¼,æ‰€ä»¥ä¸æŒ‡å®š <code>NOT NULL</code> ã€‚<code>NULL</code> ä¸ºé»˜è®¤è®¾ç½®,å¦‚æœä¸æŒ‡å®š <code>NOT NULL</code> ,åˆ™è®¤ä¸ºæŒ‡å®šçš„æ˜¯ <code>NULL</code> ã€‚</p>
<p><strong>ç†è§£ NULL</strong> ä¸è¦æŠŠ NULL å€¼ä¸ç©ºä¸²ç›¸æ··æ·†ã€‚ NULL å€¼æ˜¯æ²¡æœ‰å€¼,å®ƒä¸æ˜¯ç©ºä¸²ã€‚å¦‚æœæŒ‡å®š â€˜â€™ (ä¸¤ä¸ªå•å¼•å·,å…¶é—´æ²¡æœ‰å­—ç¬¦),è¿™åœ¨ NOT NULL åˆ—ä¸­æ˜¯å…è®¸çš„ã€‚ç©ºä¸²æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å€¼,å®ƒä¸æ˜¯æ— å€¼ã€‚ NULL å€¼ç”¨å…³é”®å­— NULL è€Œä¸æ˜¯ç©ºä¸²æŒ‡å®šã€‚</p>
<p>3.ä¸»é”®å†ä»‹ç»</p>
<p>æ­£å¦‚æ‰€è¿°,ä¸»é”®å€¼å¿…é¡»å”¯ä¸€ã€‚å³,è¡¨ä¸­çš„æ¯ä¸ªè¡Œå¿…é¡»å…·æœ‰å”¯ä¸€çš„ä¸»é”®å€¼ã€‚å¦‚æœä¸»é”®ä½¿ç”¨å•ä¸ªåˆ—,åˆ™å®ƒçš„å€¼å¿…é¡»å”¯ä¸€ã€‚å¦‚æœä½¿ç”¨å¤šä¸ªåˆ—,åˆ™è¿™äº›åˆ—çš„ç»„åˆå€¼å¿…é¡»å”¯ä¸€ã€‚</p>
<p>è¿„ä»Šä¸ºæ­¢æˆ‘ä»¬çœ‹åˆ°çš„ CREATE TABLE ä¾‹å­éƒ½æ˜¯ç”¨å•ä¸ªåˆ—ä½œä¸ºä¸»é”®ã€‚å…¶ä¸­ä¸»é”®ç”¨ä»¥ä¸‹çš„ç±»ä¼¼çš„è¯­å¥å®šä¹‰:<code>primary key (vend_id)</code></p>
<p>ä¸ºåˆ›å»ºç”±å¤šä¸ªåˆ—ç»„æˆçš„ä¸»é”®,åº”è¯¥ä»¥é€—å·åˆ†éš”çš„åˆ—è¡¨ç»™å‡ºå„åˆ—å,å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">CREATE TABLE orderitems (</span><br><span class="line">  order_num int NOT NULL,</span><br><span class="line">  order_item int NOT NULL,</span><br><span class="line">  prod_id char(10) NOT NULL,</span><br><span class="line">  quantity int NOT NULL,</span><br><span class="line">  item_price decimal(8,2) NOT NULL,</span><br><span class="line">  PRIMARY KEY (order_num,order_item),</span><br><span class="line">  ) ENGINE=InnoDB;</span><br></pre></td></tr></table></figure>

<p><code>orderitems</code> è¡¨åŒ…å«ordersè¡¨ä¸­æ¯ä¸ªè®¢å•çš„ç»†èŠ‚ã€‚æ¯ä¸ªè®¢å•æœ‰å¤šé¡¹ç‰©å“,ä½†æ¯ä¸ªè®¢å•ä»»ä½•æ—¶å€™éƒ½åªæœ‰1ä¸ªç¬¬ä¸€é¡¹ç‰©å“,1ä¸ªç¬¬äºŒé¡¹ç‰©å“,å¦‚æ­¤ç­‰ç­‰ã€‚å› æ­¤,è®¢å•å·( <code>order_num</code> åˆ—)å’Œè®¢å•ç‰©å“( <code>order_item</code> åˆ—)çš„ç»„åˆæ˜¯å”¯ä¸€çš„,ä»è€Œé€‚åˆä½œä¸ºä¸»é”®,å…¶å®šä¹‰ä¸º:<code>RIMARY KEY (order_num,order_item)</code></p>
<p>ä¸»é”®å¯ä»¥åœ¨åˆ›å»ºè¡¨æ—¶å®šä¹‰(å¦‚è¿™é‡Œæ‰€ç¤º),æˆ–è€…åœ¨åˆ›å»ºè¡¨ä¹‹åå®šä¹‰(æœ¬ç« ç¨åè®¨è®º)ã€‚</p>
<p>4.ä½¿ç”¨ AUTO_INCREMENT</p>
<p>è®©æˆ‘ä»¬å†æ¬¡è€ƒå¯Ÿ <code>customers</code> å’Œ <code>orders</code>è¡¨ã€‚ <code>customers</code> è¡¨ä¸­çš„é¡¾å®¢ç”±åˆ—<code>cust_id</code> å”¯ä¸€æ ‡è¯†,æ¯ä¸ªé¡¾å®¢æœ‰ä¸€ä¸ªå”¯ä¸€ç¼–å·ã€‚ç±»ä¼¼, <code>orders</code> è¡¨ä¸­çš„æ¯ä¸ªè®¢å•æœ‰ä¸€ä¸ªå”¯ä¸€çš„è®¢å•å·,è¿™ä¸ªè®¢å•å·å­˜å‚¨åœ¨åˆ— <code>order_num</code> ä¸­ã€‚è¿™äº›ç¼–å·é™¤å®ƒä»¬æ˜¯å”¯ä¸€çš„ä»¥å¤–æ²¡æœ‰åˆ«çš„ç‰¹æ®Šæ„ä¹‰ã€‚åœ¨å¢åŠ ä¸€ä¸ªæ–°é¡¾å®¢æˆ–æ–°è®¢å•æ—¶,éœ€è¦ä¸€ä¸ªæ–°çš„é¡¾å®¢IDæˆ–è®¢å•å·ã€‚è¿™äº›ç¼–å·å¯ä»¥ä»»æ„,åªè¦å®ƒä»¬æ˜¯å”¯ä¸€çš„å³å¯ã€‚</p>
<p>æ˜¾ç„¶,ä½¿ç”¨çš„æœ€ç®€å•çš„ç¼–å·æ˜¯ä¸‹ä¸€ä¸ªç¼–å·,æ‰€è°“ä¸‹ä¸€ä¸ªç¼–å·æ˜¯å¤§äºå½“å‰æœ€å¤§ç¼–å·çš„ç¼–å·ã€‚ä¾‹å¦‚,å¦‚æœ <code>cust_id</code> çš„æœ€å¤§ç¼–å·ä¸º <code>10005</code> ,åˆ™æ’å…¥è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªé¡¾å®¢å¯ä»¥å…·æœ‰ç­‰äº <code>10006</code> çš„ <code>cust_id</code> ã€‚</p>
<p>ç®€å•å—?ä¸è§å¾—ã€‚ä½ æ€æ ·ç¡®å®šä¸‹ä¸€ä¸ªè¦ä½¿ç”¨çš„å€¼?å½“ç„¶,ä½ å¯ä»¥ä½¿ç”¨ <code>SELECT</code>è¯­å¥å¾—å‡ºæœ€å¤§çš„æ•°,ç„¶åå¯¹å®ƒåŠ 1ã€‚ä½†è¿™æ ·åšå¹¶ä¸å¯é (ä½ éœ€è¦æ‰¾å‡ºä¸€ç§åŠæ³•æ¥ä¿è¯,åœ¨ä½ æ‰§è¡Œ <code>SELECT</code>å’Œ <code>INSERT</code> ä¸¤æ¡è¯­å¥ä¹‹é—´æ²¡æœ‰å…¶ä»–äººæ’å…¥è¡Œ,å¯¹äºå¤šç”¨æˆ·åº”ç”¨,è¿™ç§æƒ…å†µæ˜¯å¾ˆæœ‰å¯èƒ½å‡ºç°çš„),è€Œä¸”æ•ˆç‡ä¹Ÿä¸é«˜(æ‰§è¡Œé¢å¤–çš„MySQLæ“ä½œè‚¯å®šä¸æ˜¯ç†æƒ³çš„åŠæ³•)ã€‚</p>
<p>è¿™å°±æ˜¯ <code>AUTO_INCREMENT</code> å‘æŒ¥ä½œç”¨çš„æ—¶å€™äº†ã€‚è¯·çœ‹ä»¥ä¸‹ä»£ç è¡Œ(ç”¨æ¥åˆ›å»º customers è¡¨çš„ CREATE TABLE è¯­å¥çš„ç»„æˆéƒ¨åˆ†):<code>cust_id int NOT NULL AUTO_INCREMENT</code></p>
<p><code>AUTO_INCREMENT</code> å‘Šè¯‰MySQL,æœ¬åˆ—æ¯å½“å¢åŠ ä¸€è¡Œæ—¶è‡ªåŠ¨å¢é‡ã€‚æ¯æ¬¡æ‰§è¡Œä¸€ä¸ª <code>INSERT</code> æ“ä½œæ—¶,MySQLè‡ªåŠ¨å¯¹è¯¥åˆ—å¢é‡(ä»è€Œæ‰æœ‰è¿™ä¸ªå…³é”®å­—<code>AUTO_INCREMENT</code> ),ç»™è¯¥åˆ—èµ‹äºˆä¸‹ä¸€ä¸ªå¯ç”¨çš„å€¼ã€‚è¿™æ ·ç»™æ¯ä¸ªè¡Œåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„<code>cust_id</code>,ä»è€Œå¯ä»¥ç”¨ä½œä¸»é”®å€¼ã€‚</p>
<p>æ¯ä¸ªè¡¨åªå…è®¸ä¸€ä¸ª <code>AUTO_INCREMENT</code> åˆ—,è€Œä¸”å®ƒå¿…é¡»è¢«ç´¢å¼•(å¦‚,é€šè¿‡ä½¿å®ƒæˆä¸ºä¸»é”®)</p>
<p><strong>è¦† ç›– AUTO_INCREMENT</strong> å¦‚æœä¸€ä¸ªåˆ—è¢«æŒ‡å®šä¸º AUTO_INCREMENT ,åˆ™å®ƒéœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„å€¼å—?ä½ å¯ä»¥ç®€å•åœ°åœ¨ INSERT è¯­å¥ä¸­æŒ‡å®šä¸€ä¸ªå€¼,åªè¦å®ƒæ˜¯å”¯ä¸€çš„(è‡³ä»Šå°šæœªä½¿ç”¨è¿‡)å³å¯,è¯¥å€¼å°†è¢«ç”¨æ¥æ›¿ä»£è‡ªåŠ¨ç”Ÿæˆçš„å€¼ã€‚åç»­çš„å¢é‡å°†å¼€å§‹ä½¿ç”¨è¯¥æ‰‹å·¥æ’å…¥çš„å€¼ã€‚</p>
<p><strong>ç¡®å®š AUTO_INCREMENT å€¼</strong> è®©MySQLç”Ÿæˆ(é€šè¿‡è‡ªåŠ¨å¢é‡)ä¸»é”®çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ä½ ä¸çŸ¥é“è¿™äº›å€¼éƒ½æ˜¯è°ã€‚</p>
<p>è€ƒè™‘è¿™ä¸ªåœºæ™¯:ä½ æ­£åœ¨å¢åŠ ä¸€ä¸ªæ–°è®¢å•ã€‚è¿™è¦æ±‚åœ¨ <code>orders</code> è¡¨ä¸­åˆ›å»ºä¸€è¡Œ,ç„¶ååœ¨ <code>orderitms</code> è¡¨ä¸­å¯¹è®¢è´­çš„æ¯é¡¹ç‰©å“åˆ›å»ºä¸€è¡Œã€‚ <code>order_num</code> åœ¨ <code>orderitem</code>s è¡¨ä¸­ä¸è®¢å•ç»†èŠ‚ä¸€èµ·å­˜å‚¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ <code>orders</code> è¡¨å’Œ <code>orderitems</code> è¡¨ä¸ºç›¸äº’å…³è”çš„è¡¨çš„åŸå› ã€‚è¿™æ˜¾ç„¶è¦æ±‚ä½ åœ¨æ’å…¥ <code>orders</code> è¡Œä¹‹å,æ’å…¥ <code>orderitems</code> è¡Œä¹‹å‰çŸ¥é“ç”Ÿæˆçš„ <code>order_num</code> ã€‚é‚£ä¹ˆ,å¦‚ä½•åœ¨ä½¿ç”¨ <code>AUTO_INCREMENT</code> åˆ—æ—¶è·å¾—è¿™ä¸ªå€¼å‘¢?å¯ä½¿ç”¨ <code>last_insert_id()</code> å‡½æ•°è·å¾—è¿™ä¸ªå€¼,å¦‚ä¸‹æ‰€ç¤º:<code>select last_insert_id()</code>æ­¤è¯­å¥è¿”å›æœ€åä¸€ä¸ª <code>AUTO_INCREMENT</code> å€¼,ç„¶åå¯ä»¥å°†å®ƒç”¨äºåç»­çš„MySQLè¯­å¥ã€‚</p>
<p>5.æŒ‡å®šé»˜è®¤å€¼</p>
<p>å¦‚æœåœ¨æ’å…¥è¡Œæ—¶æ²¡æœ‰ç»™å‡ºå€¼,MySQLå…è®¸æŒ‡å®šæ­¤æ—¶ä½¿ç”¨çš„é»˜è®¤å€¼ã€‚é»˜è®¤å€¼ç”¨ CREATE TABLE è¯­å¥çš„åˆ—å®šä¹‰ä¸­çš„ DEFAULT å…³é”®å­—æŒ‡å®šã€‚</p>
<p>è¯·çœ‹ä¸‹é¢çš„ä¾‹å­:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">CREATE TABLE orderitems (</span><br><span class="line">  order_num int NOT NULL,</span><br><span class="line">  order_item int NOT NULL,</span><br><span class="line">  prod_id char(10) NOT NULL,</span><br><span class="line">  quantity int NOT NULL default 1,</span><br><span class="line">  item_price decimal(8,2) NOT NULL,</span><br><span class="line">  PRIMARY KEY (order_num,order_item),</span><br><span class="line">  ) ENGINE=InnoDB;</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡è¯­å¥åˆ›å»ºåŒ…å«ç»„æˆè®¢å•çš„å„ç‰©å“çš„ <code>orderitems</code> è¡¨(è®¢å•æœ¬èº«å­˜å‚¨åœ¨ orders è¡¨ä¸­)ã€‚ <code>quantity</code> åˆ—åŒ…å«è®¢å•ä¸­æ¯é¡¹ç‰©å“çš„æ•°é‡ã€‚åœ¨æ­¤ä¾‹å­ä¸­,ç»™è¯¥åˆ—çš„æè¿°æ·»åŠ æ–‡æœ¬ <code>DEFAULT 1</code> æŒ‡ç¤ºMySQL,åœ¨æœªç»™å‡ºæ•°é‡çš„æƒ…å†µä¸‹ä½¿ç”¨æ•°é‡ 1 ã€‚</p>
<p><strong>ä¸å…è®¸å‡½æ•°</strong> ä¸å¤§å¤šæ•°DBMSä¸ä¸€æ ·,MySQLä¸å…è®¸ä½¿ç”¨å‡½æ•°ä½œä¸ºé»˜è®¤å€¼,å®ƒåªæ”¯æŒå¸¸é‡ã€‚</p>
<p><strong>ä½¿ç”¨é»˜è®¤å€¼è€Œä¸æ˜¯ NULL å€¼</strong> è®¸å¤šæ•°æ®åº“å¼€å‘äººå‘˜ä½¿ç”¨é»˜è®¤å€¼è€Œä¸æ˜¯ NULL åˆ—,ç‰¹åˆ«æ˜¯å¯¹ç”¨äºè®¡ç®—æˆ–æ•°æ®åˆ†ç»„çš„åˆ—æ›´æ˜¯å¦‚æ­¤ã€‚</p>
<p>6.å¼•æ“ç±»å‹</p>
<p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°,è¿„ä»Šä¸ºæ­¢ä½¿ç”¨çš„ CREATE TABLE è¯­å¥å…¨éƒ½ä»¥ENGINE=InnoDB è¯­å¥ç»“æŸã€‚</p>
<p>ä¸å…¶ä»–DBMSä¸€æ ·, MySQLæœ‰ä¸€ä¸ªå…·ä½“ç®¡ç†å’Œå¤„ç†æ•°æ®çš„å†…éƒ¨å¼•æ“ã€‚</p>
<p>åœ¨ä½ ä½¿ç”¨ CREATE TABLE è¯­å¥æ—¶,è¯¥å¼•æ“å…·ä½“åˆ›å»ºè¡¨,è€Œåœ¨ä½ ä½¿ç”¨ SELECTè¯­å¥æˆ–è¿›è¡Œå…¶ä»–æ•°æ®åº“å¤„ç†æ—¶,è¯¥å¼•æ“åœ¨å†…éƒ¨å¤„ç†ä½ çš„è¯·æ±‚ã€‚å¤šæ•°æ—¶å€™,æ­¤å¼•æ“éƒ½éšè—åœ¨DBMSå†…,ä¸éœ€è¦è¿‡å¤šå…³æ³¨å®ƒã€‚</p>
<p>ä½†MySQLä¸å…¶ä»–DBMSä¸ä¸€æ ·,å®ƒå…·æœ‰å¤šç§å¼•æ“ã€‚å®ƒæ‰“åŒ…å¤šä¸ªå¼•æ“,è¿™äº›å¼•æ“éƒ½éšè—åœ¨MySQLæœåŠ¡å™¨å†…,å…¨éƒ½èƒ½æ‰§è¡Œ CREATE TABLE å’Œ SELECTç­‰å‘½ä»¤ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦å‘è¡Œå¤šç§å¼•æ“å‘¢?</p>
<p>å› ä¸ºå®ƒä»¬å…·æœ‰å„è‡ªä¸åŒçš„åŠŸèƒ½å’Œç‰¹æ€§,ä¸ºä¸åŒçš„ä»»åŠ¡é€‰æ‹©æ­£ç¡®çš„å¼•æ“èƒ½è·å¾—è‰¯å¥½çš„åŠŸèƒ½å’Œçµæ´»æ€§ã€‚</p>
<p>å½“ç„¶,ä½ å®Œå…¨å¯ä»¥å¿½ç•¥è¿™äº›æ•°æ®åº“å¼•æ“ã€‚å¦‚æœçœç•¥ ENGINE= è¯­å¥,åˆ™,å¤šæ•°SQLè¯­å¥éƒ½ä¼šé»˜è®¤ä½¿ç”¨å®ƒã€‚ä½†å¹¶ä½¿ç”¨é»˜è®¤å¼•æ“(å¾ˆå¯èƒ½æ˜¯ MyISAM )ä¸æ˜¯æ‰€æœ‰è¯­å¥éƒ½é»˜è®¤ä½¿ç”¨å®ƒ,è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ ENGINE= è¯­å¥å¾ˆé‡è¦çš„åŸå› (ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæœ¬ä¹¦çš„æ ·åˆ—è¡¨ä¸­ä½¿ç”¨ä¸¤ç§å¼•æ“çš„åŸå› )ã€‚</p>
<p>ä»¥ä¸‹æ˜¯å‡ ä¸ªéœ€è¦çŸ¥é“çš„å¼•æ“:</p>
<ul>
<li>InnoDB æ˜¯ä¸€ä¸ªå¯é çš„äº‹åŠ¡å¤„ç†å¼•æ“,å®ƒä¸æ”¯æŒå…¨æ–‡æœ¬æœç´¢;</li>
<li>MEMORY åœ¨åŠŸèƒ½ç­‰åŒäº MyISAM ,ä½†ç”±äºæ•°æ®å­˜å‚¨åœ¨å†…å­˜(ä¸æ˜¯ç£ç›˜)ä¸­,é€Ÿåº¦å¾ˆå¿«(ç‰¹åˆ«é€‚åˆäºä¸´æ—¶è¡¨);</li>
<li>MyISAM æ˜¯ä¸€ä¸ªæ€§èƒ½æé«˜çš„å¼•æ“,å®ƒæ”¯æŒå…¨æ–‡æœ¬æœç´¢,ä½†ä¸æ”¯æŒäº‹åŠ¡å¤„ç†ã€‚</li>
</ul>
<p>å¼•æ“ç±»å‹å¯ä»¥æ··ç”¨ã€‚é™¤ productnotes è¡¨ä½¿ç”¨ MyISAM å¤–,æœ¬ä¹¦ä¸­çš„æ ·ä¾‹è¡¨éƒ½ä½¿ç”¨ InnoDB ã€‚åŸå› æ˜¯å¸Œæœ›æ”¯æŒäº‹åŠ¡å¤„ç†(å› æ­¤,ä½¿ç”¨ InnoDB ),ä½†ä¹Ÿéœ€è¦åœ¨ productnotes ä¸­æ”¯æŒå…¨æ–‡æœ¬æœç´¢(å› æ­¤,ä½¿ç”¨ MyISAM )ã€‚</p>
<p><strong>å¤–é”®ä¸èƒ½è·¨å¼•æ“</strong> æ··ç”¨å¼•æ“ç±»å‹æœ‰ä¸€ä¸ªå¤§ç¼ºé™·ã€‚å¤–é”®(ç”¨äºå¼ºåˆ¶å®æ–½å¼•ç”¨å®Œæ•´æ€§,å¦‚ç¬¬1ç« æ‰€è¿°)ä¸èƒ½è·¨å¼•æ“,å³ä½¿ç”¨ä¸€ä¸ªå¼•æ“çš„è¡¨ä¸èƒ½å¼•ç”¨å…·æœ‰ä½¿ç”¨ä¸åŒå¼•æ“çš„è¡¨çš„å¤–é”®ã€‚</p>
<p>é‚£ä¹ˆ,ä½ åº”è¯¥ä½¿ç”¨å“ªä¸ªå¼•æ“?è¿™æœ‰èµ–äºä½ éœ€è¦ä»€ä¹ˆæ ·çš„ç‰¹æ€§ã€‚ MyISAMç”±äºå…¶æ€§èƒ½å’Œç‰¹æ€§å¯èƒ½æ˜¯æœ€å—æ¬¢è¿çš„å¼•æ“ã€‚ä½†å¦‚æœä½ ä¸éœ€è¦å¯é çš„äº‹åŠ¡å¤„ç†,å¯ä»¥ä½¿ç”¨å…¶ä»–å¼•æ“ã€‚</p>
<blockquote>
<p>æ›´æ–°è¡¨</p>
</blockquote>
<p>ä¸ºæ›´æ–°è¡¨å®šä¹‰,å¯ä½¿ç”¨ <code>ALTER TABLE</code> è¯­å¥ã€‚ä½†æ˜¯,ç†æƒ³çŠ¶æ€ä¸‹,å½“è¡¨ä¸­å­˜å‚¨æ•°æ®ä»¥å,è¯¥è¡¨å°±ä¸åº”è¯¥å†è¢«æ›´æ–°ã€‚åœ¨è¡¨çš„è®¾è®¡è¿‡ç¨‹ä¸­éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´æ¥è€ƒè™‘,ä»¥ä¾¿åæœŸä¸å¯¹è¯¥è¡¨è¿›è¡Œå¤§çš„æ”¹åŠ¨ã€‚</p>
<p>ä¸ºäº†ä½¿ç”¨ ALTER TABLE æ›´æ”¹è¡¨ç»“æ„,å¿…é¡»ç»™å‡ºä¸‹é¢çš„ä¿¡æ¯:</p>
<ul>
<li>åœ¨ ALTER TABLE ä¹‹åç»™å‡ºè¦æ›´æ”¹çš„è¡¨å(è¯¥è¡¨å¿…é¡»å­˜åœ¨,å¦åˆ™å°†å‡ºé”™);</li>
<li>æ‰€åšæ›´æ”¹çš„åˆ—è¡¨ã€‚</li>
</ul>
<p>ä¸‹é¢çš„ä¾‹å­ç»™è¡¨æ·»åŠ ä¸€ä¸ªåˆ—:</p>
<blockquote>
<blockquote>
<p>ç»™ vendors è¡¨å¢åŠ ä¸€ä¸ªåä¸º vend_phone çš„åˆ—</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; alter table vendors add vend_phone char(20);</span><br><span class="line">Query OK, 6 rows affected (0.11 sec)</span><br><span class="line">Records: 6  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; desc vendors;</span><br><span class="line">+--------------+----------+------+-----+---------+----------------+</span><br><span class="line">| Field        | Type     | Null | Key | Default | Extra          |</span><br><span class="line">+--------------+----------+------+-----+---------+----------------+</span><br><span class="line">| vend_id      | int(11)  | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| vend_name    | char(50) | NO   |     | NULL    |                |</span><br><span class="line">| vend_address | char(50) | YES  |     | NULL    |                |</span><br><span class="line">| vend_city    | char(50) | YES  |     | NULL    |                |</span><br><span class="line">| vend_state   | char(5)  | YES  |     | NULL    |                |</span><br><span class="line">| vend_zip     | char(10) | YES  |     | NULL    |                |</span><br><span class="line">| vend_country | char(50) | YES  |     | NULL    |                |</span><br><span class="line">| vend_phone   | char(20) | YES  |     | NULL    |                |</span><br><span class="line">+--------------+----------+------+-----+---------+----------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>åˆ é™¤åˆšåˆšæ·»åŠ çš„åˆ—vend_phone</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; alter table vendors drop column vend_phone;</span><br><span class="line">Query OK, 6 rows affected (0.12 sec)</span><br><span class="line">Records: 6  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; desc vendors;</span><br><span class="line">+--------------+----------+------+-----+---------+----------------+</span><br><span class="line">| Field        | Type     | Null | Key | Default | Extra          |</span><br><span class="line">+--------------+----------+------+-----+---------+----------------+</span><br><span class="line">| vend_id      | int(11)  | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| vend_name    | char(50) | NO   |     | NULL    |                |</span><br><span class="line">| vend_address | char(50) | YES  |     | NULL    |                |</span><br><span class="line">| vend_city    | char(50) | YES  |     | NULL    |                |</span><br><span class="line">| vend_state   | char(5)  | YES  |     | NULL    |                |</span><br><span class="line">| vend_zip     | char(10) | YES  |     | NULL    |                |</span><br><span class="line">| vend_country | char(50) | YES  |     | NULL    |                |</span><br><span class="line">+--------------+----------+------+-----+---------+----------------+</span><br><span class="line">7 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>ALTER TABLE çš„ä¸€ç§å¸¸è§ç”¨é€”æ˜¯å®šä¹‰å¤–é”®ã€‚ä¸‹é¢æ˜¯ç”¨æ¥å®šä¹‰è®²ä¹‰ä¸­çš„è¡¨æ‰€ç”¨çš„å¤–é”®çš„ä»£ç :</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; alter table orderitems</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> add constraint fk_orderitems_orders</span></span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> foreign key (order_num) references orders (order_num);</span></span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; alter table orderitems</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> add constraint fk_orderitems_products</span></span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> foreign key (prod_id) references orders (prod_id);</span></span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; alter table orders</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> add constraint fk_orderitems_customers</span></span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> foreign key (cust_id) references orders (cust_id);</span></span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; alter table products</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> add constraint fk_orderitems_vendors</span></span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> foreign key (vend_id) references orders (vend_id);</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ,ç”±äºè¦æ›´æ”¹4ä¸ªä¸åŒçš„è¡¨,ä½¿ç”¨äº†4æ¡ ALTER TABLE è¯­å¥ã€‚ä¸ºäº†å¯¹å•ä¸ªè¡¨è¿›è¡Œå¤šä¸ªæ›´æ”¹,å¯ä»¥ä½¿ç”¨å•æ¡ ALTER TABLE è¯­å¥,æ¯ä¸ªæ›´æ”¹ç”¨é€—å·åˆ†éš”ã€‚</p>
<p>å¤æ‚çš„è¡¨ç»“æ„æ›´æ”¹ä¸€èˆ¬éœ€è¦æ‰‹åŠ¨åˆ é™¤è¿‡ç¨‹,å®ƒæ¶‰åŠä»¥ä¸‹æ­¥éª¤:</p>
<ul>
<li>ç”¨æ–°çš„åˆ—å¸ƒå±€åˆ›å»ºä¸€ä¸ªæ–°è¡¨;</li>
<li>ä½¿ç”¨ INSERT SELECT è¯­å¥ä»æ—§è¡¨å¤åˆ¶æ•°æ®åˆ°æ–°è¡¨ã€‚å¦‚æœæœ‰å¿…è¦,å¯ä½¿ç”¨è½¬æ¢å‡½æ•°å’Œè®¡ç®—å­—æ®µ;</li>
<li>æ£€éªŒåŒ…å«æ‰€éœ€æ•°æ®çš„æ–°è¡¨;</li>
<li>é‡å‘½åæ—§è¡¨(å¦‚æœç¡®å®š,å¯ä»¥åˆ é™¤å®ƒ);</li>
<li>ç”¨æ—§è¡¨åŸæ¥çš„åå­—é‡å‘½åæ–°è¡¨;</li>
<li>æ ¹æ®éœ€è¦,é‡æ–°åˆ›å»ºè§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹ã€ç´¢å¼•å’Œå¤–é”®ã€‚</li>
</ul>
<p><strong>å°å¿ƒä½¿ç”¨ ALTER TABLE</strong> ä½¿ç”¨ ALTER TABLE è¦æä¸ºå°å¿ƒ,åº”è¯¥åœ¨è¿›è¡Œæ”¹åŠ¨å‰åšä¸€ä¸ªå®Œæ•´çš„å¤‡ä»½(æ¨¡å¼å’Œæ•°æ®çš„å¤‡ä»½)ã€‚æ•°æ®åº“è¡¨çš„æ›´æ”¹ä¸èƒ½æ’¤é”€,å¦‚æœå¢åŠ äº†ä¸éœ€è¦çš„åˆ—,å¯èƒ½ä¸èƒ½åˆ é™¤å®ƒä»¬ã€‚ç±»ä¼¼åœ°,å¦‚æœåˆ é™¤äº†ä¸åº”è¯¥åˆ é™¤çš„åˆ—,å¯èƒ½ä¼šä¸¢å¤±è¯¥åˆ—ä¸­çš„æ‰€æœ‰æ•°æ®ã€‚</p>
<blockquote>
<p>åˆ é™¤è¡¨</p>
</blockquote>
<p>åˆ é™¤è¡¨(åˆ é™¤æ•´ä¸ªè¡¨è€Œä¸æ˜¯å…¶å†…å®¹)éå¸¸ç®€å•,ä½¿ç”¨ DROP TABLE è¯­å¥å³å¯: <code>drop table customers2;</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ariaDB [test]&gt; create table customer2 as select * from customers;</span><br><span class="line">Query OK, 15 rows affected (0.08 sec)</span><br><span class="line">Records: 15  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from customers;</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| cust_id | cust_name      | cust_address        | cust_city   | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit     | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|   10002 | Mouse House    | 333 Fromage Lane    | Columbus    | OH         | 43333    | USA          | Jerry Mouse  | NULL                |</span><br><span class="line">|   10003 | Wascals        | 1 Sunny Place       | Muncie      | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|   10004 | Yosemite Place | 829 Riverside Drive | Phoenix     | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|   10005 | The Fudds      | 4545 53rd Street    | Chicago     | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|   10007 | Pep E. LaPew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   10008 | M. Martian     | 42 Galaxy Way       | New York    | NY         | 11213    | USA          | NULL         | NULL                |</span><br><span class="line">|   20001 | Coyote Inc.    | 200 Maple Lane      | Detroit     | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|   20002 | Mouse House    | 333 Fromage Lane    | Columbus    | OH         | 43333    | USA          | Jerry Mouse  | NULL                |</span><br><span class="line">|   20003 | Wascals        | 1 Sunny Place       | Muncie      | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|   20004 | Yosemite Place | 829 Riverside Drive | Phoenix     | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|   20005 | E Fudd         | 4545 53rd Street    | Chicago     | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|   20006 | Pep E. Lapew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   20007 | Pep E. LaPew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   20008 | M. Martian     | 42 Galaxy Way       | New York    | NY         | 11213    | USA          | NULL         | NULL                |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">15 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡è¯­å¥åˆ é™¤ customers2 è¡¨(å‡è®¾å®ƒå­˜åœ¨)ä¹Ÿä¸èƒ½æ’¤é”€,æ‰§è¡Œè¿™æ¡è¯­å¥å°†æ°¸ä¹…åˆ é™¤è¯¥è¡¨ã€‚</p>
<blockquote>
<p>é‡å‘½åè¡¨</p>
</blockquote>
<p>ä½¿ç”¨ RENAME TABLE è¯­å¥å¯ä»¥é‡å‘½åä¸€ä¸ªè¡¨:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; rename table customers to customers3;</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; rename table customers3 to customers;</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br></pre></td></tr></table></figure>

<p>RENAME TABLE æ‰€åšçš„ä»…æ˜¯é‡å‘½åä¸€ä¸ªè¡¨ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¯­å¥å¯¹å¤šä¸ªè¡¨é‡å‘½å:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; rename table vendors to vendors0,products to products0,orders to orders0;</span><br><span class="line">Query OK, 0 rows affected (0.08 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; rename table vendors0 to vendors,products0 to products,orders0 to orders;</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« ä»‹ç»äº†å‡ æ¡æ–°SQLè¯­å¥ã€‚ CREATE TABLE ç”¨æ¥åˆ›å»ºæ–°è¡¨, ALTER TABLE ç”¨æ¥æ›´æ”¹è¡¨åˆ—(æˆ–å…¶ä»–è¯¸å¦‚çº¦æŸæˆ–ç´¢å¼•ç­‰å¯¹è±¡),è€Œ DROP TABLE ç”¨æ¥å®Œæ•´åœ°åˆ é™¤ä¸€ä¸ªè¡¨ã€‚è¿™äº›è¯­å¥å¿…é¡»å°å¿ƒä½¿ç”¨,å¹¶ä¸”åº”åœ¨åšäº†å¤‡ä»½åä½¿ç”¨ã€‚æœ¬ç« è¿˜ä»‹ç»äº†æ•°æ®åº“å¼•æ“ã€å®šä¹‰ä¸»é”®å’Œå¤–é”®,ä»¥åŠå…¶ä»–é‡è¦çš„è¡¨å’Œåˆ—é€‰é¡¹ã€‚</p>
</blockquote>
</blockquote>
<h3 id="DMLè¯­è¨€"><a href="#DMLè¯­è¨€" class="headerlink" title="DMLè¯­è¨€"></a>DMLè¯­è¨€</h3><p>DML(Data Manipulation Language)è¯­å¥:æ•°æ®æ“çºµè¯­å¥,ç”¨äºæ·»åŠ ã€åˆ é™¤ã€æ›´æ–°å’ŒæŸ¥è¯¢æ•°æ®åº“è®°å½•,å¹¶æ£€æŸ¥æ•°æ®å®Œæ•´æ€§,å¸¸ç”¨çš„è¯­å¥å…³é”®å­—ä¸»è¦åŒ…æ‹¬ insertã€deleteã€udpate å’Œselect ç­‰ã€‚</p>
<h4 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h4><p>æœ¬ç« ä»‹ç»å¦‚ä½•åˆ©ç”¨SQLçš„ INSERT è¯­å¥å°†æ•°æ®æ’å…¥è¡¨ä¸­ã€‚</p>
<blockquote>
<p>æ•°æ®æ’å…¥</p>
</blockquote>
<p>é¡¾åæ€ä¹‰, INSERT æ˜¯ç”¨æ¥æ’å…¥(æˆ–æ·»åŠ )è¡Œåˆ°æ•°æ®åº“è¡¨çš„ã€‚æ’å…¥å¯ä»¥ç”¨å‡ ç§æ–¹å¼ä½¿ç”¨:</p>
<ul>
<li>æ’å…¥å®Œæ•´çš„è¡Œ;</li>
<li>æ’å…¥è¡Œçš„ä¸€éƒ¨åˆ†;</li>
<li>æ’å…¥å¤šè¡Œ;</li>
<li>æ’å…¥æŸäº›æŸ¥è¯¢çš„ç»“æœã€‚</li>
</ul>
<p>ä¸‹é¢å°†ä»‹ç»è¿™äº›å†…å®¹ã€‚</p>
<p><strong>æ’å…¥åŠç³»ç»Ÿå®‰å…¨</strong> å¯é’ˆå¯¹æ¯ä¸ªè¡¨æˆ–æ¯ä¸ªç”¨æˆ·,åˆ©ç”¨MySQLçš„å®‰å…¨æœºåˆ¶ç¦æ­¢ä½¿ç”¨ INSERT è¯­å¥ã€‚</p>
<blockquote>
<p>æ’å…¥å®Œæ•´çš„è¡Œ</p>
</blockquote>
<p>æŠŠæ•°æ®æ’å…¥è¡¨ä¸­çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨åŸºæœ¬çš„ INSERT è¯­æ³•,å®ƒè¦æ±‚æŒ‡å®šè¡¨åå’Œè¢«æ’å…¥åˆ°æ–°è¡Œä¸­çš„å€¼ã€‚ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; insert into customers values(null,'Pep E. Lapew','100 Main Street','Los Angeles','CA','90046','USA',null,null);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from customers;</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| cust_id | cust_name      | cust_address        | cust_city   | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit     | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|   10002 | Mouse House    | 333 Fromage Lane    | Columbus    | OH         | 43333    | USA          | Jerry Mouse  | NULL                |</span><br><span class="line">|   10003 | Wascals        | 1 Sunny Place       | Muncie      | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|   10004 | Yosemite Place | 829 Riverside Drive | Phoenix     | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|   10005 | E Fudd         | 4545 53rd Street    | Chicago     | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|   10006 | Pep E. Lapew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>æ²¡æœ‰è¾“å‡º</strong> INSERT è¯­å¥ä¸€èˆ¬ä¸ä¼šäº§ç”Ÿè¾“å‡ºã€‚</p>
<p>æ­¤ä¾‹å­æ’å…¥ä¸€ä¸ªæ–°å®¢æˆ·åˆ° <code>customers</code> è¡¨ã€‚å­˜å‚¨åˆ°æ¯ä¸ªè¡¨åˆ—ä¸­çš„æ•°æ®åœ¨ <code>VALUES</code> å­å¥ä¸­ç»™å‡º,å¯¹æ¯ä¸ªåˆ—å¿…é¡»æä¾›ä¸€ä¸ªå€¼ã€‚å¦‚æœæŸä¸ªåˆ—æ²¡æœ‰å€¼(å¦‚ä¸Šé¢çš„ <code>cust_contact</code> å’Œ <code>cust_email</code> åˆ—),åº”è¯¥ä½¿ç”¨ NULLå€¼(å‡å®šè¡¨å…è®¸å¯¹è¯¥åˆ—æŒ‡å®šç©ºå€¼)ã€‚å„ä¸ªåˆ—å¿…é¡»ä»¥å®ƒä»¬åœ¨è¡¨å®šä¹‰ä¸­å‡ºç°çš„æ¬¡åºå¡«å……ã€‚ç¬¬ä¸€åˆ— <code>cust_id</code> ä¹Ÿä¸º NULL ã€‚è¿™æ˜¯å› ä¸ºæ¯æ¬¡æ’å…¥ä¸€ä¸ªæ–°è¡Œæ—¶,è¯¥åˆ—ç”±MySQLè‡ªåŠ¨å¢é‡ã€‚ä½ ä¸æƒ³ç»™å‡ºä¸€ä¸ªå€¼(è¿™æ˜¯MySQLçš„å·¥ä½œ),åˆä¸èƒ½çœç•¥æ­¤åˆ—(å¦‚å‰æ‰€è¿°,å¿…é¡»ç»™å‡ºæ¯ä¸ªåˆ—),æ‰€ä»¥æŒ‡å®šä¸€ä¸ª NULL å€¼(å®ƒè¢«MySQLå¿½ç•¥,MySQLåœ¨è¿™é‡Œæ’å…¥ä¸‹ä¸€ä¸ªå¯ç”¨çš„ <code>cust_id</code>å€¼)ã€‚</p>
<p>è™½ç„¶è¿™ç§è¯­æ³•å¾ˆç®€å•,ä½†å¹¶ä¸å®‰å…¨,åº”è¯¥å°½é‡é¿å…ä½¿ç”¨ã€‚ä¸Šé¢çš„SQLè¯­å¥é«˜åº¦ä¾èµ–äºè¡¨ä¸­åˆ—çš„å®šä¹‰æ¬¡åº,å¹¶ä¸”è¿˜ä¾èµ–äºå…¶æ¬¡åºå®¹æ˜“è·å¾—çš„ä¿¡æ¯ã€‚å³ä½¿å¯å¾—åˆ°è¿™ç§æ¬¡åºä¿¡æ¯,ä¹Ÿä¸èƒ½ä¿è¯ä¸‹ä¸€æ¬¡è¡¨ç»“æ„å˜åŠ¨åå„ä¸ªåˆ—ä¿æŒå®Œå…¨ç›¸åŒçš„æ¬¡åºã€‚å› æ­¤,ç¼–å†™ä¾èµ–äºç‰¹å®šåˆ—æ¬¡åºçš„SQLè¯­å¥æ˜¯å¾ˆä¸å®‰å…¨çš„ã€‚å¦‚æœè¿™æ ·åš,æœ‰æ—¶éš¾å…ä¼šå‡ºé—®é¢˜ã€‚</p>
<p>ç¼–å†™ INSERT è¯­å¥çš„æ›´å®‰å…¨(ä¸è¿‡æ›´çƒ¦ç)çš„æ–¹æ³•å¦‚ä¸‹:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; insert into customers(cust_name,cust_address,cust_city,cust_state,cust_zip,cust_country,cust_contact,cust_email)</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> values (null,<span class="string">'Pep E. Lapew'</span>,<span class="string">'100 Main Street'</span>,<span class="string">'Los Angeles'</span>,<span class="string">'CA'</span>,<span class="string">'90046'</span>,<span class="string">'USA'</span>,null,null);</span></span><br></pre></td></tr></table></figure>

<p>æ­¤ä¾‹å­å®Œæˆä¸å‰ä¸€ä¸ª <code>INSERT</code> è¯­å¥å®Œå…¨ç›¸åŒçš„å·¥ä½œ,ä½†åœ¨è¡¨ååçš„æ‹¬å·é‡Œæ˜ç¡®åœ°ç»™å‡ºäº†åˆ—åã€‚åœ¨æ’å…¥è¡Œæ—¶,MySQLå°†ç”¨ <code>VALUES</code>åˆ—è¡¨ä¸­çš„ç›¸åº”å€¼å¡«å…¥åˆ—è¡¨ä¸­çš„å¯¹åº”é¡¹ã€‚ <code>VALUES</code> ä¸­çš„ç¬¬ä¸€ä¸ªå€¼å¯¹åº”äºç¬¬ä¸€ä¸ªæŒ‡å®šçš„åˆ—åã€‚ç¬¬äºŒä¸ªå€¼å¯¹åº”äºç¬¬äºŒä¸ªåˆ—å,å¦‚æ­¤ç­‰ç­‰ã€‚</p>
<p>å› ä¸ºæä¾›äº†åˆ—å, <code>VALUES</code> å¿…é¡»ä»¥å…¶æŒ‡å®šçš„æ¬¡åºåŒ¹é…æŒ‡å®šçš„åˆ—å,ä¸ä¸€å®šæŒ‰å„ä¸ªåˆ—å‡ºç°åœ¨å®é™…è¡¨ä¸­çš„æ¬¡åºã€‚å…¶ä¼˜ç‚¹æ˜¯,å³ä½¿è¡¨çš„ç»“æ„æ”¹å˜,æ­¤ <code>INSERT</code> è¯­å¥ä»ç„¶èƒ½æ­£ç¡®å·¥ä½œã€‚ä½ ä¼šå‘ç° <code>cust_id</code> çš„<code>NULL</code> å€¼æ˜¯ä¸å¿…è¦çš„,<code>cust_id</code> åˆ—å¹¶æ²¡æœ‰å‡ºç°åœ¨åˆ—è¡¨ä¸­,æ‰€ä»¥ä¸éœ€è¦ä»»ä½•å€¼ã€‚ä¸‹é¢çš„ <code>INSERT</code> è¯­å¥å¡«å……æ‰€æœ‰åˆ—(ä¸å‰é¢çš„ä¸€æ ·),ä½†ä»¥ä¸€ç§ä¸åŒçš„æ¬¡åºå¡«å……ã€‚å› ä¸ºç»™å‡ºäº†åˆ—å,æ‰€ä»¥æ’å…¥ç»“æœä»ç„¶æ­£ç¡®:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; insert into customers(cust_contact,cust_email,cust_address,cust_city,cust_state,cust_zip,cust_country)</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> values (<span class="string">'Pep E. Lapew'</span>,null,null,<span class="string">'100 Main Street'</span>,<span class="string">'Los Angeles'</span>,<span class="string">'CA'</span>,<span class="string">'90046'</span>,<span class="string">'USA'</span>);</span></span><br></pre></td></tr></table></figure>

<p><strong>æ€»æ˜¯ä½¿ç”¨åˆ—çš„åˆ—è¡¨</strong> ä¸€èˆ¬ä¸è¦ä½¿ç”¨æ²¡æœ‰æ˜ç¡®ç»™å‡ºåˆ—çš„åˆ—è¡¨çš„INSERT è¯­å¥ã€‚ä½¿ç”¨åˆ—çš„åˆ—è¡¨èƒ½ä½¿SQLä»£ç ç»§ç»­å‘æŒ¥ä½œç”¨,å³ä½¿è¡¨ç»“æ„å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<p><strong>ä»”ç»†åœ°ç»™å‡ºå€¼</strong> ä¸ç®¡ä½¿ç”¨å“ªç§ INSERT è¯­æ³•,éƒ½å¿…é¡»ç»™å‡ºVALUES çš„æ­£ç¡®æ•°ç›®ã€‚å¦‚æœä¸æä¾›åˆ—å,åˆ™å¿…é¡»ç»™æ¯ä¸ªè¡¨åˆ—æä¾›ä¸€ä¸ªå€¼ã€‚å¦‚æœæä¾›åˆ—å,åˆ™å¿…é¡»å¯¹æ¯ä¸ªåˆ—å‡ºçš„åˆ—ç»™å‡ºä¸€ä¸ªå€¼ã€‚å¦‚æœä¸è¿™æ ·,å°†äº§ç”Ÿä¸€æ¡é”™è¯¯æ¶ˆæ¯,ç›¸åº”çš„è¡Œæ’å…¥ä¸æˆåŠŸã€‚</p>
<p>ä½¿ç”¨è¿™ç§è¯­æ³•,è¿˜å¯ä»¥çœç•¥åˆ—ã€‚è¿™è¡¨ç¤ºå¯ä»¥åªç»™æŸäº›åˆ—æä¾›å€¼,ç»™å…¶ä»–åˆ—ä¸æä¾›å€¼ã€‚</p>
<p>(äº‹å®ä¸Šä½ å·²ç»çœ‹åˆ°è¿‡è¿™æ ·çš„ä¾‹å­:å½“åˆ—åè¢«æ˜ç¡®åˆ—å‡ºæ—¶, cust_id å¯ä»¥çœç•¥)</p>
<p><strong>çœç•¥åˆ—</strong> å¦‚æœè¡¨çš„å®šä¹‰å…è®¸,åˆ™å¯ä»¥åœ¨ INSERT æ“ä½œä¸­çœç•¥æŸäº›åˆ—ã€‚çœç•¥çš„åˆ—å¿…é¡»æ»¡è¶³ä»¥ä¸‹æŸä¸ªæ¡ä»¶ã€‚</p>
<ul>
<li>è¯¥åˆ—å®šä¹‰ä¸ºå…è®¸ NULL å€¼(æ— å€¼æˆ–ç©ºå€¼)ã€‚</li>
<li>åœ¨è¡¨å®šä¹‰ä¸­ç»™å‡ºé»˜è®¤å€¼ã€‚è¿™è¡¨ç¤ºå¦‚æœä¸ç»™å‡ºå€¼,å°†ä½¿ç”¨é»˜è®¤å€¼ã€‚</li>
</ul>
<p>å¦‚æœå¯¹è¡¨ä¸­ä¸å…è®¸ NULL å€¼ä¸”æ²¡æœ‰é»˜è®¤å€¼çš„åˆ—ä¸ç»™å‡ºå€¼,åˆ™MySQLå°†äº§ç”Ÿä¸€æ¡é”™è¯¯æ¶ˆæ¯,å¹¶ä¸”ç›¸åº”çš„è¡Œæ’å…¥ä¸æˆåŠŸã€‚</p>
<p><strong>æé«˜æ•´ä½“æ€§èƒ½</strong> æ•°æ®åº“ç»å¸¸è¢«å¤šä¸ªå®¢æˆ·è®¿é—®,å¯¹å¤„ç†ä»€ä¹ˆè¯·æ±‚ä»¥åŠç”¨ä»€ä¹ˆæ¬¡åºå¤„ç†è¿›è¡Œç®¡ç†æ˜¯MySQLçš„ä»»åŠ¡ã€‚ INSERT æ“ä½œå¯èƒ½å¾ˆè€—æ—¶(ç‰¹åˆ«æ˜¯æœ‰å¾ˆå¤šç´¢å¼•éœ€è¦æ›´æ–°æ—¶),è€Œä¸”å®ƒå¯èƒ½é™ä½ç­‰å¾…å¤„ç†çš„ SELECT è¯­å¥çš„æ€§èƒ½ã€‚</p>
<p>å¦‚æœæ•°æ®æ£€ç´¢æ˜¯æœ€é‡è¦çš„(é€šå¸¸æ˜¯è¿™æ ·),åˆ™ä½ å¯ä»¥é€šè¿‡åœ¨INSERT å’Œ INTO ä¹‹é—´æ·»åŠ å…³é”®å­— LOW_PRIORITY ,æŒ‡ç¤ºMySQLé™ä½ INSERT è¯­å¥çš„ä¼˜å…ˆçº§,å¦‚ä¸‹æ‰€ç¤º:<code>insert low_priority into</code>é¡ºä¾¿è¯´ä¸€ä¸‹,è¿™ä¹Ÿé€‚ç”¨äºä¸‹ä¸€ç« ä»‹ç»çš„ UPDATE å’Œ DELETE è¯­å¥ã€‚</p>
<blockquote>
<p>æ’å…¥å¤šä¸ªè¡Œ</p>
</blockquote>
<p>INSERT å¯ä»¥æ’å…¥ä¸€è¡Œåˆ°ä¸€ä¸ªè¡¨ä¸­ã€‚ä½†å¦‚æœä½ æƒ³æ’å…¥å¤šä¸ªè¡Œæ€ä¹ˆåŠ?</p>
<p>å¯ä»¥ä½¿ç”¨å¤šæ¡ INSERT è¯­å¥,ç”šè‡³ä¸€æ¬¡æäº¤å®ƒä»¬,æ¯æ¡è¯­å¥ç”¨ä¸€ä¸ªåˆ†å·ç»“æŸ,æˆ–è€…,åªè¦æ¯æ¡ INSERT è¯­å¥ä¸­çš„åˆ—å(å’Œæ¬¡åº)ç›¸åŒ,å¯ä»¥å¦‚ä¸‹ç»„åˆå„è¯­å¥:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; insert into customers (cust_name,cust_address,cust_city,cust_state,cust_zip,cust_country)</span><br><span class="line">    -&gt; values ('Pep E. LaPew','100 Main Street','Los Angeles','CA','90046','USA'),</span><br><span class="line">    -&gt; ('M. Martian','42 Galaxy Way','New York','NY','11213','USA');</span><br><span class="line">Query OK, 2 rows affected (0.05 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from customers;</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| cust_id | cust_name      | cust_address        | cust_city   | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit     | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|   10002 | Mouse House    | 333 Fromage Lane    | Columbus    | OH         | 43333    | USA          | Jerry Mouse  | NULL                |</span><br><span class="line">|   10003 | Wascals        | 1 Sunny Place       | Muncie      | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|   10004 | Yosemite Place | 829 Riverside Drive | Phoenix     | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|   10005 | E Fudd         | 4545 53rd Street    | Chicago     | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|   10006 | Pep E. Lapew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   10007 | Pep E. LaPew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   10008 | M. Martian     | 42 Galaxy Way       | New York    | NY         | 11213    | USA          | NULL         | NULL                |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­å•æ¡ INSERT è¯­å¥æœ‰å¤šç»„å€¼,æ¯ç»„å€¼ç”¨ä¸€å¯¹åœ†æ‹¬å·æ‹¬èµ·æ¥,ç”¨é€—å·åˆ†éš”ã€‚</p>
<p><strong>æé«˜ INSERT çš„æ€§èƒ½</strong> æ­¤æŠ€æœ¯å¯ä»¥æé«˜æ•°æ®åº“å¤„ç†çš„æ€§èƒ½,å› ä¸ºMySQLç”¨å•æ¡ INSERT è¯­å¥å¤„ç†å¤šä¸ªæ’å…¥æ¯”ä½¿ç”¨å¤šæ¡ INSERTè¯­å¥å¿«ã€‚</p>
<blockquote>
<p>æ’å…¥æ£€ç´¢å‡ºçš„æ•°æ®</p>
</blockquote>
<p>INSERT ä¸€èˆ¬ç”¨æ¥ç»™è¡¨æ’å…¥ä¸€ä¸ªæŒ‡å®šåˆ—å€¼çš„è¡Œã€‚ä½†æ˜¯, INSERT è¿˜å­˜åœ¨å¦ä¸€ç§å½¢å¼,å¯ä»¥åˆ©ç”¨å®ƒå°†ä¸€æ¡ SELECT è¯­å¥çš„ç»“æœæ’å…¥è¡¨ä¸­ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ INSERT SELECT ,é¡¾åæ€ä¹‰,å®ƒæ˜¯ç”±ä¸€æ¡ INSERT è¯­å¥å’Œä¸€æ¡ SELECTè¯­å¥ç»„æˆçš„ã€‚</p>
<p>å‡å¦‚ä½ æƒ³ä»å¦ä¸€è¡¨ä¸­åˆå¹¶å®¢æˆ·åˆ—è¡¨åˆ°ä½ çš„ customers è¡¨ã€‚ä¸éœ€è¦æ¯æ¬¡è¯»å–ä¸€è¡Œ,ç„¶åå†å°†å®ƒç”¨ INSERT æ’å…¥,å¯ä»¥å¦‚ä¸‹è¿›è¡Œ:</p>
<p><strong>æ–°ä¾‹å­çš„è¯´æ˜</strong> è¿™ä¸ªä¾‹å­æŠŠä¸€ä¸ªåä¸º <code>custnew</code> çš„è¡¨ä¸­çš„æ•°æ®å¯¼å…¥ <code>customers</code> è¡¨ä¸­ã€‚ä¸ºäº†è¯•éªŒè¿™ä¸ªä¾‹å­,åº”è¯¥é¦–å…ˆåˆ›å»ºå’Œå¡«å…… <code>custnew</code> è¡¨ã€‚ <code>custnew</code> è¡¨çš„ç»“æ„ä¸é™„å½•Bä¸­æè¿°çš„ <code>customers</code>è¡¨çš„ç›¸åŒã€‚åœ¨å¡«å…… <code>custnew</code> æ—¶,ä¸åº”è¯¥ä½¿ç”¨å·²ç»åœ¨ <code>customers</code>ä¸­ä½¿ç”¨è¿‡çš„ <code>cust_id</code> å€¼(å¦‚æœä¸»é”®å€¼é‡å¤,åç»­çš„ <code>INSERT</code> æ“ä½œå°†ä¼šå¤±è´¥)æˆ–ä»…çœç•¥è¿™åˆ—å€¼è®©MySQLåœ¨å¯¼å…¥æ•°æ®çš„è¿‡ç¨‹ä¸­äº§ç”Ÿæ–°å€¼ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create table custnew as select * from customers;</span><br><span class="line">Query OK, 8 rows affected (0.33 sec)</span><br><span class="line">Records: 8  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from custnew;</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| cust_id | cust_name      | cust_address        | cust_city   | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit     | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|   10002 | Mouse House    | 333 Fromage Lane    | Columbus    | OH         | 43333    | USA          | Jerry Mouse  | NULL                |</span><br><span class="line">|   10003 | Wascals        | 1 Sunny Place       | Muncie      | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|   10004 | Yosemite Place | 829 Riverside Drive | Phoenix     | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|   10005 | E Fudd         | 4545 53rd Street    | Chicago     | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|   10006 | Pep E. Lapew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   10007 | Pep E. LaPew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   10008 | M. Martian     | 42 Galaxy Way       | New York    | NY         | 11213    | USA          | NULL         | NULL                |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; desc custnew;</span><br><span class="line">+--------------+-----------+------+-----+---------+-------+</span><br><span class="line">| Field        | Type      | Null | Key | Default | Extra |</span><br><span class="line">+--------------+-----------+------+-----+---------+-------+</span><br><span class="line">| cust_id      | int(11)   | NO   |     | 0       |       |</span><br><span class="line">| cust_name    | char(50)  | NO   |     | NULL    |       |</span><br><span class="line">| cust_address | char(50)  | YES  |     | NULL    |       |</span><br><span class="line">| cust_city    | char(50)  | YES  |     | NULL    |       |</span><br><span class="line">| cust_state   | char(5)   | YES  |     | NULL    |       |</span><br><span class="line">| cust_zip     | char(10)  | YES  |     | NULL    |       |</span><br><span class="line">| cust_country | char(50)  | YES  |     | NULL    |       |</span><br><span class="line">| cust_contact | char(50)  | YES  |     | NULL    |       |</span><br><span class="line">| cust_email   | char(255) | YES  |     | NULL    |       |</span><br><span class="line">+--------------+-----------+------+-----+---------+-------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; desc customers;</span><br><span class="line">+--------------+-----------+------+-----+---------+----------------+</span><br><span class="line">| Field        | Type      | Null | Key | Default | Extra          |</span><br><span class="line">+--------------+-----------+------+-----+---------+----------------+</span><br><span class="line">| cust_id      | int(11)   | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| cust_name    | char(50)  | NO   |     | NULL    |                |</span><br><span class="line">| cust_address | char(50)  | YES  |     | NULL    |                |</span><br><span class="line">| cust_city    | char(50)  | YES  |     | NULL    |                |</span><br><span class="line">| cust_state   | char(5)   | YES  |     | NULL    |                |</span><br><span class="line">| cust_zip     | char(10)  | YES  |     | NULL    |                |</span><br><span class="line">| cust_country | char(50)  | YES  |     | NULL    |                |</span><br><span class="line">| cust_contact | char(50)  | YES  |     | NULL    |                |</span><br><span class="line">| cust_email   | char(255) | YES  |     | NULL    |                |</span><br><span class="line">+--------------+-----------+------+-----+---------+----------------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from custnew;</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| cust_id | cust_name      | cust_address        | cust_city   | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit     | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|   10002 | Mouse House    | 333 Fromage Lane    | Columbus    | OH         | 43333    | USA          | Jerry Mouse  | NULL                |</span><br><span class="line">|   10003 | Wascals        | 1 Sunny Place       | Muncie      | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|   10004 | Yosemite Place | 829 Riverside Drive | Phoenix     | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|   10005 | E Fudd         | 4545 53rd Street    | Chicago     | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|   10006 | Pep E. Lapew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   10007 | Pep E. LaPew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   10008 | M. Martian     | 42 Galaxy Way       | New York    | NY         | 11213    | USA          | NULL         | NULL                |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; update custnew set cust_id=20001 where cust_id=10001;</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; update custnew set cust_id=20002 where cust_id=10002;</span><br><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; update custnew set cust_id=20003 where cust_id=10003;</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; update custnew set cust_id=20004 where cust_id=10004;</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; update custnew set cust_id=20005 where cust_id=10005;</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; update custnew set cust_id=20006 where cust_id=10006;</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; update custnew set cust_id=20007 where cust_id=10007;</span><br><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; update custnew set cust_id=20008 where cust_id=10008;</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from custnew;</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| cust_id | cust_name      | cust_address        | cust_city   | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|   20001 | Coyote Inc.    | 200 Maple Lane      | Detroit     | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|   20002 | Mouse House    | 333 Fromage Lane    | Columbus    | OH         | 43333    | USA          | Jerry Mouse  | NULL                |</span><br><span class="line">|   20003 | Wascals        | 1 Sunny Place       | Muncie      | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|   20004 | Yosemite Place | 829 Riverside Drive | Phoenix     | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|   20005 | E Fudd         | 4545 53rd Street    | Chicago     | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|   20006 | Pep E. Lapew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   20007 | Pep E. LaPew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   20008 | M. Martian     | 42 Galaxy Way       | New York    | NY         | 11213    | USA          | NULL         | NULL                |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†custnewè¡¨ä¸­çš„æ•°æ®å¯¼å…¥customersè¡¨</span></span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; insert into customers select * from custnew;</span><br><span class="line">Query OK, 8 rows affected (0.06 sec)</span><br><span class="line">Records: 8  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from customers;</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| cust_id | cust_name      | cust_address        | cust_city   | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit     | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|   10002 | Mouse House    | 333 Fromage Lane    | Columbus    | OH         | 43333    | USA          | Jerry Mouse  | NULL                |</span><br><span class="line">|   10003 | Wascals        | 1 Sunny Place       | Muncie      | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|   10004 | Yosemite Place | 829 Riverside Drive | Phoenix     | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|   10005 | E Fudd         | 4545 53rd Street    | Chicago     | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|   10006 | Pep E. Lapew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   10007 | Pep E. LaPew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   10008 | M. Martian     | 42 Galaxy Way       | New York    | NY         | 11213    | USA          | NULL         | NULL                |</span><br><span class="line">|   20001 | Coyote Inc.    | 200 Maple Lane      | Detroit     | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|   20002 | Mouse House    | 333 Fromage Lane    | Columbus    | OH         | 43333    | USA          | Jerry Mouse  | NULL                |</span><br><span class="line">|   20003 | Wascals        | 1 Sunny Place       | Muncie      | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|   20004 | Yosemite Place | 829 Riverside Drive | Phoenix     | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|   20005 | E Fudd         | 4545 53rd Street    | Chicago     | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|   20006 | Pep E. Lapew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   20007 | Pep E. LaPew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   20008 | M. Martian     | 42 Galaxy Way       | New York    | NY         | 11213    | USA          | NULL         | NULL                |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">16 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªä¾‹å­ä½¿ç”¨ <code>INSERT SELECT</code> ä» <code>custnew</code> ä¸­å°†æ‰€æœ‰æ•°æ®å¯¼å…¥<code>customers</code> ã€‚ <code>SELECT</code> è¯­å¥ä» <code>custnew</code> æ£€ç´¢å‡ºè¦æ’å…¥çš„å€¼,è€Œä¸æ˜¯åˆ—å‡ºå®ƒä»¬ã€‚ <code>SELECT</code> ä¸­åˆ—å‡ºçš„æ¯ä¸ªåˆ—å¯¹åº”äº <code>customers</code> è¡¨ååæ‰€è·Ÿçš„åˆ—è¡¨ä¸­çš„æ¯ä¸ªåˆ—ã€‚è¿™æ¡è¯­å¥å°†æ’å…¥å¤šå°‘è¡Œæœ‰èµ–äº <code>custnew</code> è¡¨ä¸­æœ‰å¤šå°‘è¡Œã€‚å¦‚æœè¿™ä¸ªè¡¨ä¸ºç©º,åˆ™æ²¡æœ‰è¡Œè¢«æ’å…¥(ä¹Ÿä¸äº§ç”Ÿé”™è¯¯,å› ä¸ºæ“ä½œä»ç„¶æ˜¯åˆæ³•çš„)ã€‚å¦‚æœè¿™ä¸ªè¡¨ç¡®å®å«æœ‰æ•°æ®,åˆ™æ‰€æœ‰æ•°æ®å°†è¢«æ’å…¥åˆ° <code>customers</code> ã€‚</p>
<p>è¿™ä¸ªä¾‹å­å¯¼å…¥äº† cust_id (å‡è®¾ä½ èƒ½å¤Ÿç¡®ä¿ cust_id çš„å€¼ä¸é‡å¤)ã€‚ä½ ä¹Ÿå¯ä»¥ç®€å•åœ°çœç•¥è¿™åˆ—(ä» INSERT å’Œ SELECT ä¸­),è¿™æ ·MySQLå°±ä¼šç”Ÿæˆæ–°å€¼ã€‚</p>
<p><strong>INSERT SELECT ä¸­çš„åˆ—å</strong> ä¸ºç®€å•èµ·è§,è¿™ä¸ªä¾‹å­åœ¨ INSERT å’Œ SELECT è¯­å¥ä¸­ä½¿ç”¨äº†ç›¸åŒçš„åˆ—åã€‚ä½†æ˜¯,ä¸ä¸€å®šè¦æ±‚åˆ—ååŒ¹é…ã€‚äº‹å®ä¸Š,MySQLç”šè‡³ä¸å…³å¿ƒ SELECT è¿”å›çš„åˆ—åã€‚å®ƒä½¿ç”¨çš„æ˜¯åˆ—çš„ä½ç½®,å› æ­¤ SELECT ä¸­çš„ç¬¬ä¸€åˆ—(ä¸ç®¡å…¶åˆ—å)å°†ç”¨æ¥å¡«å……è¡¨åˆ—ä¸­æŒ‡å®šçš„ç¬¬ä¸€ä¸ªåˆ—,ç¬¬äºŒåˆ—å°†ç”¨æ¥å¡«å……è¡¨åˆ—ä¸­æŒ‡å®šçš„ç¬¬äºŒä¸ªåˆ—,å¦‚æ­¤ç­‰ç­‰ã€‚è¿™å¯¹äºä»ä½¿ç”¨ä¸åŒåˆ—åçš„è¡¨ä¸­å¯¼å…¥æ•°æ®æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p>
<p>INSERT SELECT ä¸­ SELECT è¯­å¥å¯åŒ…å« WHERE å­å¥ä»¥è¿‡æ»¤æ’å…¥çš„æ•°æ®ã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« ä»‹ç»å¦‚ä½•å°†è¡Œæ’å…¥åˆ°æ•°æ®åº“è¡¨ã€‚æˆ‘ä»¬å­¦ä¹ äº†ä½¿ç”¨ INSERT çš„å‡ ç§æ–¹æ³•,ä»¥åŠä¸ºä»€ä¹ˆè¦æ˜ç¡®ä½¿ç”¨åˆ—å,å­¦ä¹ äº†å¦‚ä½•ç”¨ INSERT SELECT ä»å…¶ä»–è¡¨ä¸­å¯¼å…¥è¡Œã€‚ä¸‹ä¸€ç« è®²è¿°å¦‚ä½•ä½¿ç”¨ UPDATE å’Œ DELETE è¿›ä¸€æ­¥æ“çºµè¡¨æ•°æ®ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="æ›´æ–°å’Œåˆ é™¤æ•°æ®"><a href="#æ›´æ–°å’Œåˆ é™¤æ•°æ®" class="headerlink" title="æ›´æ–°å’Œåˆ é™¤æ•°æ®"></a>æ›´æ–°å’Œåˆ é™¤æ•°æ®</h4><p>æœ¬ç« ä»‹ç»å¦‚ä½•åˆ©ç”¨ UPDATE å’Œ DELETE è¯­å¥è¿›ä¸€æ­¥æ“çºµè¡¨æ•°æ®ã€‚</p>
<blockquote>
<p>æ›´æ–°æ•°æ®</p>
</blockquote>
<p>ä¸ºäº†æ›´æ–°(ä¿®æ”¹)è¡¨ä¸­çš„æ•°æ®,å¯ä½¿ç”¨ UPDATE è¯­å¥ã€‚å¯é‡‡ç”¨ä¸¤ç§æ–¹å¼ä½¿ç”¨ UPDATE :</p>
<ul>
<li>æ›´æ–°è¡¨ä¸­ç‰¹å®šè¡Œ;</li>
<li>æ›´æ–°è¡¨ä¸­æ‰€æœ‰è¡Œã€‚</li>
</ul>
<p>ä¸‹é¢åˆ†åˆ«å¯¹å®ƒä»¬è¿›è¡Œä»‹ç»ã€‚</p>
<p><strong>ä¸è¦çœç•¥ WHERE å­å¥</strong> åœ¨ä½¿ç”¨ UPDATE æ—¶ä¸€å®šè¦æ³¨æ„ç»†å¿ƒã€‚å› ä¸ºç¨ä¸æ³¨æ„,å°±ä¼šæ›´æ–°è¡¨ä¸­æ‰€æœ‰è¡Œã€‚åœ¨ä½¿ç”¨è¿™æ¡è¯­å¥å‰,è¯·å®Œæ•´åœ°é˜…è¯»æœ¬èŠ‚ã€‚</p>
<p><strong>UPDATE ä¸å®‰å…¨</strong> å¯ä»¥é™åˆ¶å’Œæ§åˆ¶ UPDATE è¯­å¥çš„ä½¿ç”¨</p>
<p>UPDATE è¯­å¥éå¸¸å®¹æ˜“ä½¿ç”¨,ç”šè‡³å¯ä»¥è¯´æ˜¯å¤ªå®¹æ˜“ä½¿ç”¨äº†ã€‚åŸºæœ¬çš„UPDATE è¯­å¥ç”±3éƒ¨åˆ†ç»„æˆ,åˆ†åˆ«æ˜¯:</p>
<ul>
<li>è¦æ›´æ–°çš„è¡¨;</li>
<li>åˆ—åå’Œå®ƒä»¬çš„æ–°å€¼;</li>
<li>ç¡®å®šè¦æ›´æ–°è¡Œçš„è¿‡æ»¤æ¡ä»¶ã€‚</li>
</ul>
<p>ä¸¾ä¸€ä¸ªç®€å•ä¾‹å­ã€‚</p>
<blockquote>
<blockquote>
<p>å®¢æˆ·<code>cust_id=10005</code> ç°åœ¨æœ‰äº†ç”µå­é‚®ä»¶åœ°å€<code>elmer@fudd.com</code>,å› æ­¤ä»–çš„è®°å½•éœ€è¦æ›´æ–°,è¯­å¥å¦‚ä¸‹:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; update customers set cust_email = 'elmer@fudd.com' where cust_id = 10005;</span><br><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select cust_email from customers where cust_id =10005;</span><br><span class="line">+----------------+</span><br><span class="line">| cust_email     |</span><br><span class="line">+----------------+</span><br><span class="line">| elmer@fudd.com |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><code>UPDATE</code> è¯­å¥æ€»æ˜¯ä»¥è¦æ›´æ–°çš„è¡¨çš„åå­—å¼€å§‹ã€‚åœ¨æ­¤ä¾‹å­ä¸­,è¦æ›´æ–°çš„è¡¨çš„åå­—ä¸º <code>customers</code> ã€‚ <code>SET</code> å‘½ä»¤ç”¨æ¥å°†æ–°å€¼èµ‹ç»™è¢«æ›´æ–°çš„åˆ—ã€‚å¦‚è¿™é‡Œæ‰€ç¤º, <code>SET</code> å­å¥è®¾ç½® <code>cust_email</code> åˆ—ä¸ºæŒ‡å®šçš„å€¼:<code>set cust_email = &#39;elmer@fudd.com&#39;</code></p>
<p><code>UPDATE</code>è¯­å¥ä»¥ <code>WHERE</code> å­å¥ç»“æŸ,å®ƒå‘Šè¯‰MySQLæ›´æ–°å“ªä¸€è¡Œã€‚æ²¡æœ‰<code>WHERE</code> å­å¥,MySQLå°†ä¼šç”¨è¿™ä¸ªç”µå­é‚®ä»¶åœ°å€æ›´æ–° <code>customers</code> è¡¨ä¸­æ‰€æœ‰è¡Œ,è¿™ä¸æ˜¯æˆ‘ä»¬æ‰€å¸Œæœ›çš„ã€‚</p>
<p>æ›´æ–°å¤šä¸ªåˆ—çš„è¯­æ³•ç¨æœ‰ä¸åŒ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; update customers set cust_name = 'The Fudds',cust_email = 'elmer@fudd.com' where cust_id = 10005;</span><br><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from customers where cust_id =10005;</span><br><span class="line">+---------+-----------+------------------+-----------+------------+----------+--------------+--------------+----------------+</span><br><span class="line">| cust_id | cust_name | cust_address     | cust_city | cust_state | cust_zip | cust_country | cust_contact | cust_email     |</span><br><span class="line">+---------+-----------+------------------+-----------+------------+----------+--------------+--------------+----------------+</span><br><span class="line">|   10005 | The Fudds | 4545 53rd Street | Chicago   | IL         | 54545    | USA          | E Fudd       | elmer@fudd.com |</span><br><span class="line">+---------+-----------+------------------+-----------+------------+----------+--------------+--------------+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>åœ¨æ›´æ–°å¤šä¸ªåˆ—æ—¶,åªéœ€è¦ä½¿ç”¨å•ä¸ª<code>SET</code> å‘½ä»¤,æ¯ä¸ªâ€œåˆ—=å€¼â€å¯¹ä¹‹é—´ç”¨é€—å·åˆ†éš”(æœ€åä¸€åˆ—ä¹‹åä¸ç”¨é€—å·)ã€‚åœ¨æ­¤ä¾‹å­ä¸­,æ›´æ–°å®¢æˆ· <code>10005</code> çš„<code>cust_name</code> å’Œ <code>cust_email</code> åˆ—ã€‚</p>
<p><strong>åœ¨ UPDATE è¯­å¥ä¸­ä½¿ç”¨å­æŸ¥è¯¢</strong> UPDATE è¯­å¥ä¸­å¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢,ä½¿å¾—èƒ½ç”¨ SELECT è¯­å¥æ£€ç´¢å‡ºçš„æ•°æ®æ›´æ–°åˆ—æ•°æ®ã€‚</p>
<p><strong>IGNORE å…³é”®å­—</strong> å¦‚æœç”¨ UPDATE è¯­å¥æ›´æ–°å¤šè¡Œ,å¹¶ä¸”åœ¨æ›´æ–°è¿™äº›è¡Œä¸­çš„ä¸€è¡Œæˆ–å¤šè¡Œæ—¶å‡ºä¸€ä¸ªç°é”™è¯¯,åˆ™æ•´ä¸ª UPDATE æ“ä½œè¢«å–æ¶ˆ(é”™è¯¯å‘ç”Ÿå‰æ›´æ–°çš„æ‰€æœ‰è¡Œè¢«æ¢å¤åˆ°å®ƒä»¬åŸæ¥çš„å€¼)ã€‚ä¸ºå³ä½¿æ˜¯å‘ç”Ÿé”™è¯¯,ä¹Ÿç»§ç»­è¿›è¡Œæ›´æ–°,å¯ä½¿ç”¨ IGNORE å…³é”®å­—,å¦‚ä¸‹æ‰€ç¤º:<code>UPDATE IGNORE customers...</code></p>
<blockquote>
<blockquote>
<p>ä¸ºäº†åˆ é™¤æŸä¸ªåˆ—çš„å€¼,å¯è®¾ç½®å®ƒä¸º NULL (å‡å¦‚è¡¨å®šä¹‰å…è®¸ NULL å€¼)ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; update customers set cust_email = null where cust_id = 10005;</span><br><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from customers where cust_id =10005;</span><br><span class="line">+---------+-----------+------------------+-----------+------------+----------+--------------+--------------+------------+</span><br><span class="line">| cust_id | cust_name | cust_address     | cust_city | cust_state | cust_zip | cust_country | cust_contact | cust_email |</span><br><span class="line">+---------+-----------+------------------+-----------+------------+----------+--------------+--------------+------------+</span><br><span class="line">|   10005 | The Fudds | 4545 53rd Street | Chicago   | IL         | 54545    | USA          | E Fudd       | NULL       |</span><br><span class="line">+---------+-----------+------------------+-----------+------------+----------+--------------+--------------+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>NULL</code> ç”¨æ¥å»é™¤ <code>cust_email</code> åˆ—ä¸­çš„å€¼ã€‚</p>
<blockquote>
<p>åˆ é™¤æ•°æ®</p>
</blockquote>
<p>ä¸ºäº†ä»ä¸€ä¸ªè¡¨ä¸­åˆ é™¤(å»æ‰)æ•°æ®,ä½¿ç”¨ DELETE è¯­å¥ã€‚å¯ä»¥ä¸¤ç§æ–¹å¼ä½¿ç”¨ DELETE :</p>
<ul>
<li>ä»è¡¨ä¸­åˆ é™¤ç‰¹å®šçš„è¡Œ;</li>
<li>ä»è¡¨ä¸­åˆ é™¤æ‰€æœ‰è¡Œã€‚</li>
</ul>
<p>ä¸‹é¢åˆ†åˆ«å¯¹å®ƒä»¬è¿›è¡Œä»‹ç»ã€‚</p>
<p><strong>ä¸è¦çœç•¥ WHERE å­å¥</strong> åœ¨ä½¿ç”¨ DELETE æ—¶ä¸€å®šè¦æ³¨æ„ç»†å¿ƒã€‚å› ä¸ºç¨ä¸æ³¨æ„,å°±ä¼šé”™è¯¯åœ°åˆ é™¤è¡¨ä¸­æ‰€æœ‰è¡Œã€‚åœ¨ä½¿ç”¨è¿™æ¡è¯­å¥å‰,è¯·å®Œæ•´åœ°é˜…è¯»æœ¬èŠ‚ã€‚</p>
<p><strong>DELETE ä¸å®‰å…¨</strong> å¯ä»¥é™åˆ¶å’Œæ§åˆ¶ DELETE è¯­å¥çš„ä½¿ç”¨</p>
<p>å‰é¢è¯´è¿‡, UPDATE éå¸¸å®¹æ˜“ä½¿ç”¨,è€Œ DELETE æ›´å®¹æ˜“ä½¿ç”¨ã€‚ä¸‹é¢çš„è¯­å¥ä» customers è¡¨ä¸­åˆ é™¤ä¸€è¡Œ:</p>
<blockquote>
<blockquote>
<p>åªåˆ é™¤å®¢æˆ· 10006</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; delete from customers where cust_id = 10006;</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from customers;</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| cust_id | cust_name      | cust_address        | cust_city   | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit     | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|   10002 | Mouse House    | 333 Fromage Lane    | Columbus    | OH         | 43333    | USA          | Jerry Mouse  | NULL                |</span><br><span class="line">|   10003 | Wascals        | 1 Sunny Place       | Muncie      | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|   10004 | Yosemite Place | 829 Riverside Drive | Phoenix     | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|   10005 | The Fudds      | 4545 53rd Street    | Chicago     | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|   10007 | Pep E. LaPew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   10008 | M. Martian     | 42 Galaxy Way       | New York    | NY         | 11213    | USA          | NULL         | NULL                |</span><br><span class="line">|   20001 | Coyote Inc.    | 200 Maple Lane      | Detroit     | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|   20002 | Mouse House    | 333 Fromage Lane    | Columbus    | OH         | 43333    | USA          | Jerry Mouse  | NULL                |</span><br><span class="line">|   20003 | Wascals        | 1 Sunny Place       | Muncie      | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|   20004 | Yosemite Place | 829 Riverside Drive | Phoenix     | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|   20005 | E Fudd         | 4545 53rd Street    | Chicago     | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|   20006 | Pep E. Lapew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   20007 | Pep E. LaPew   | 100 Main Street     | Los Angeles | CA         | 90046    | USA          | NULL         | NULL                |</span><br><span class="line">|   20008 | M. Martian     | 42 Galaxy Way       | New York    | NY         | 11213    | USA          | NULL         | NULL                |</span><br><span class="line">+---------+----------------+---------------------+-------------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">15 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡è¯­å¥å¾ˆå®¹æ˜“ç†è§£ã€‚ <code>DELETE FROM</code> è¦æ±‚æŒ‡å®šä»ä¸­åˆ é™¤æ•°æ®çš„è¡¨åã€‚<code>WHERE</code> å­å¥è¿‡æ»¤è¦åˆ é™¤çš„è¡Œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­,åªåˆ é™¤å®¢æˆ· <code>10006</code>ã€‚å¦‚æœçœç•¥ <code>WHERE</code> å­å¥,å®ƒå°†åˆ é™¤è¡¨ä¸­æ¯ä¸ªå®¢æˆ·ã€‚</p>
<p><code>DELETE</code> ä¸éœ€è¦åˆ—åæˆ–é€šé…ç¬¦ã€‚ <code>DELETE</code> åˆ é™¤æ•´è¡Œè€Œä¸æ˜¯åˆ é™¤åˆ—ã€‚ä¸ºäº†åˆ é™¤æŒ‡å®šçš„åˆ—,è¯·ä½¿ç”¨ <code>UPDATE</code> è¯­å¥ã€‚</p>
<p><strong>åˆ é™¤è¡¨çš„å†…å®¹è€Œä¸æ˜¯è¡¨</strong> <code>DELETE</code> è¯­å¥ä»è¡¨ä¸­åˆ é™¤è¡Œ,ç”šè‡³æ˜¯åˆ é™¤è¡¨ä¸­æ‰€æœ‰è¡Œã€‚ä½†æ˜¯, <code>DELETE</code>ä¸åˆ é™¤è¡¨æœ¬èº«ã€‚</p>
<p><strong>æ›´å¿«çš„åˆ é™¤</strong> å¦‚æœæƒ³ä»è¡¨ä¸­åˆ é™¤æ‰€æœ‰è¡Œ,ä¸è¦ä½¿ç”¨ <code>DELETE</code> ã€‚å¯ä½¿ç”¨ <code>TRUNCATE TABLE</code> è¯­å¥,å®ƒå®Œæˆç›¸åŒçš„å·¥ä½œ,ä½†é€Ÿåº¦æ›´å¿«( TRUNCATE å®é™…æ˜¯åˆ é™¤åŸæ¥çš„è¡¨å¹¶é‡æ–°åˆ›å»ºä¸€ä¸ªè¡¨,è€Œä¸æ˜¯é€è¡Œåˆ é™¤è¡¨ä¸­çš„æ•°æ®)ã€‚</p>
<blockquote>
<p>æ›´æ–°å’Œåˆ é™¤çš„æŒ‡å¯¼åŸåˆ™</p>
</blockquote>
<p>å‰ä¸€èŠ‚ä¸­ä½¿ç”¨çš„ UPDATE å’Œ DELETE è¯­å¥å…¨éƒ½å…·æœ‰ WHERE å­å¥,è¿™æ ·åšçš„ç†ç”±å¾ˆå……åˆ†ã€‚å¦‚æœçœç•¥äº† WHERE å­å¥,åˆ™ UPDATE æˆ– DELETE å°†è¢«åº”ç”¨åˆ°è¡¨ä¸­æ‰€æœ‰çš„è¡Œã€‚æ¢å¥è¯è¯´,å¦‚æœæ‰§è¡Œ UPDATE è€Œä¸å¸¦ WHERE å­å¥,åˆ™è¡¨ä¸­æ¯ä¸ªè¡Œéƒ½å°†ç”¨æ–°å€¼æ›´æ–°ã€‚ç±»ä¼¼åœ°,å¦‚æœæ‰§è¡Œ DELETE è¯­å¥è€Œä¸å¸¦ WHERE å­å¥,è¡¨çš„æ‰€æœ‰æ•°æ®éƒ½å°†è¢«åˆ é™¤ã€‚</p>
<p>ä¸‹é¢æ˜¯è®¸å¤šSQLç¨‹åºå‘˜ä½¿ç”¨ UPDATE æˆ– DELETE æ—¶æ‰€éµå¾ªçš„ä¹ æƒ¯ã€‚</p>
<ul>
<li>é™¤éç¡®å®æ‰“ç®—æ›´æ–°å’Œåˆ é™¤æ¯ä¸€è¡Œ,å¦åˆ™ç»å¯¹ä¸è¦ä½¿ç”¨ä¸å¸¦ WHEREå­å¥çš„ UPDATE æˆ– DELETE è¯­å¥ã€‚</li>
<li>ä¿è¯æ¯ä¸ªè¡¨éƒ½æœ‰ä¸»é”®,å°½å¯èƒ½åƒ WHERE å­å¥é‚£æ ·ä½¿ç”¨å®ƒ(å¯ä»¥æŒ‡å®šå„ä¸»é”®ã€å¤šä¸ªå€¼æˆ–å€¼çš„èŒƒå›´)ã€‚</li>
<li>åœ¨å¯¹ UPDATE æˆ– DELETE è¯­å¥ä½¿ç”¨ WHERE å­å¥å‰,åº”è¯¥å…ˆç”¨ SELECT è¿›è¡Œæµ‹è¯•,ä¿è¯å®ƒè¿‡æ»¤çš„æ˜¯æ­£ç¡®çš„è®°å½•,ä»¥é˜²ç¼–å†™çš„ WHERE å­å¥ä¸æ­£ç¡®ã€‚</li>
<li>ä½¿ç”¨å¼ºåˆ¶å®æ–½å¼•ç”¨å®Œæ•´æ€§çš„æ•°æ®åº“,è¿™æ ·MySQLå°†ä¸å…è®¸åˆ é™¤å…·æœ‰ä¸å…¶ä»–è¡¨ç›¸å…³è”çš„æ•°æ®çš„è¡Œã€‚</li>
</ul>
<p><strong>å°å¿ƒä½¿ç”¨</strong> MySQLæ²¡æœ‰æ’¤é”€(undo)æŒ‰é’®ã€‚åº”è¯¥éå¸¸å°å¿ƒåœ°ä½¿ç”¨ UPDATE å’Œ DELETE ,å¦åˆ™ä½ ä¼šå‘ç°è‡ªå·±æ›´æ–°æˆ–åˆ é™¤äº†é”™è¯¯çš„æ•°æ®ã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æˆ‘ä»¬åœ¨æœ¬ç« ä¸­å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ UPDATE å’Œ DELETE è¯­å¥å¤„ç†è¡¨ä¸­çš„æ•°æ®ã€‚æˆ‘ä»¬å­¦ä¹ äº†è¿™äº›è¯­å¥çš„è¯­æ³•,çŸ¥é“äº†å®ƒä»¬å›ºæœ‰çš„å±é™©æ€§ã€‚æœ¬ç« ä¸­è¿˜è®²è§£äº†ä¸ºä»€ä¹ˆ WHERE å­å¥å¯¹ UPDATE å’Œ DELETE è¯­å¥å¾ˆé‡è¦,å¹¶ä¸”ç»™å‡ºäº†åº”è¯¥éµå¾ªçš„ä¸€äº›æŒ‡å¯¼åŸåˆ™,ä»¥ä¿è¯æ•°æ®çš„å®‰å…¨ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h3 id="ä½¿ç”¨è§†å›¾"><a href="#ä½¿ç”¨è§†å›¾" class="headerlink" title="ä½¿ç”¨è§†å›¾"></a>ä½¿ç”¨è§†å›¾</h3><p>æœ¬ç« å°†ä»‹ç»è§†å›¾ç©¶ç«Ÿæ˜¯ä»€ä¹ˆ,å®ƒä»¬æ€æ ·å·¥ä½œ,ä½•æ—¶ä½¿ç”¨å®ƒä»¬ã€‚æˆ‘ä»¬è¿˜å°†çœ‹åˆ°å¦‚ä½•åˆ©ç”¨è§†å›¾ç®€åŒ–å‰é¢ç« èŠ‚ä¸­æ‰§è¡Œçš„æŸäº›SQLæ“ä½œã€‚</p>
<blockquote>
<p>è§†å›¾</p>
</blockquote>
<p><strong>éœ€è¦MySQL 5</strong> MySQL 5æ·»åŠ äº†å¯¹è§†å›¾çš„æ”¯æŒã€‚å› æ­¤,æœ¬ç« å†…å®¹é€‚ç”¨äºMySQL 5åŠä»¥åçš„ç‰ˆæœ¬ã€‚</p>
<p>è§†å›¾æ˜¯è™šæ‹Ÿçš„è¡¨ã€‚ä¸åŒ…å«æ•°æ®çš„è¡¨ä¸ä¸€æ ·,è§†å›¾åªåŒ…å«ä½¿ç”¨æ—¶åŠ¨æ€æ£€ç´¢æ•°æ®çš„æŸ¥è¯¢ã€‚</p>
<p>ç†è§£è§†å›¾çš„æœ€å¥½æ–¹æ³•æ˜¯çœ‹ä¸€ä¸ªä¾‹å­ã€‚ç”¨ä¸‹é¢çš„ SELECT è¯­å¥ä»3ä¸ªè¡¨ä¸­æ£€ç´¢æ•°æ®:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select cust_name,cust_contact from customers,orders,orderitems</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> <span class="built_in">where</span> customers.cust_id=orders.cust_id and orderitems.order_num = orders.order_num</span></span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> and prod_id=<span class="string">'TNT2'</span>;</span></span><br><span class="line">+----------------+--------------+</span><br><span class="line">| cust_name      | cust_contact |</span><br><span class="line">+----------------+--------------+</span><br><span class="line">| Coyote Inc.    | Y Lee        |</span><br><span class="line">| Yosemite Place | Y Sam        |</span><br><span class="line">+----------------+--------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ­¤æŸ¥è¯¢ç”¨æ¥æ£€ç´¢è®¢è´­äº†æŸä¸ªç‰¹å®šäº§å“çš„å®¢æˆ·ã€‚ä»»ä½•éœ€è¦è¿™ä¸ªæ•°æ®çš„äººéƒ½å¿…é¡»ç†è§£ç›¸å…³è¡¨çš„ç»“æ„,å¹¶ä¸”çŸ¥é“å¦‚ä½•åˆ›å»ºæŸ¥è¯¢å’Œå¯¹è¡¨è¿›è¡Œè”ç»“ã€‚ä¸ºäº†æ£€ç´¢å…¶ä»–äº§å“(æˆ–å¤šä¸ªäº§å“)çš„ç›¸åŒæ•°æ®,å¿…é¡»ä¿®æ”¹æœ€åçš„ WHERE å­å¥ã€‚</p>
<p>ç°åœ¨,å‡å¦‚å¯ä»¥æŠŠæ•´ä¸ªæŸ¥è¯¢åŒ…è£…æˆä¸€ä¸ªåä¸º productcustomers çš„è™š<br>æ‹Ÿè¡¨,åˆ™å¯ä»¥å¦‚ä¸‹è½»æ¾åœ°æ£€ç´¢å‡ºç›¸åŒçš„æ•°æ®:<code>select cust_name,cust_contact from productcustomers where prod_id = &#39;TNT2&#39;;</code></p>
<p>è¿™å°±æ˜¯è§†å›¾çš„ä½œç”¨ã€‚ productcustomers æ˜¯ä¸€ä¸ªè§†å›¾,ä½œä¸ºè§†å›¾,å®ƒä¸åŒ…å«è¡¨ä¸­åº”è¯¥æœ‰çš„ä»»ä½•åˆ—æˆ–æ•°æ®,å®ƒåŒ…å«çš„æ˜¯ä¸€ä¸ªSQLæŸ¥è¯¢(ä¸ä¸Šé¢ç”¨ä»¥æ­£ç¡®è”ç»“è¡¨çš„ç›¸åŒçš„æŸ¥è¯¢)ã€‚</p>
<p>1.ä¸ºä»€ä¹ˆä½¿ç”¨è§†å›¾</p>
<p>æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†è§†å›¾åº”ç”¨çš„ä¸€ä¸ªä¾‹å­ã€‚ä¸‹é¢æ˜¯è§†å›¾çš„ä¸€äº›å¸¸è§åº”ç”¨ã€‚</p>
<ul>
<li>é‡ç”¨SQLè¯­å¥ã€‚</li>
<li>ç®€åŒ–å¤æ‚çš„SQLæ“ä½œã€‚åœ¨ç¼–å†™æŸ¥è¯¢å,å¯ä»¥æ–¹ä¾¿åœ°é‡ç”¨å®ƒè€Œä¸å¿…çŸ¥é“å®ƒçš„åŸºæœ¬æŸ¥è¯¢ç»†èŠ‚ã€‚</li>
<li>ä½¿ç”¨è¡¨çš„ç»„æˆéƒ¨åˆ†è€Œä¸æ˜¯æ•´ä¸ªè¡¨ã€‚</li>
<li>ä¿æŠ¤æ•°æ®ã€‚å¯ä»¥ç»™ç”¨æˆ·æˆäºˆè¡¨çš„ç‰¹å®šéƒ¨åˆ†çš„è®¿é—®æƒé™è€Œä¸æ˜¯æ•´ä¸ªè¡¨çš„è®¿é—®æƒé™ã€‚</li>
<li>æ›´æ”¹æ•°æ®æ ¼å¼å’Œè¡¨ç¤ºã€‚è§†å›¾å¯è¿”å›ä¸åº•å±‚è¡¨çš„è¡¨ç¤ºå’Œæ ¼å¼ä¸åŒçš„æ•°æ®ã€‚</li>
</ul>
<p>åœ¨è§†å›¾åˆ›å»ºä¹‹å,å¯ä»¥ç”¨ä¸è¡¨åŸºæœ¬ç›¸åŒçš„æ–¹å¼åˆ©ç”¨å®ƒä»¬ã€‚å¯ä»¥å¯¹è§†å›¾æ‰§è¡Œ SELECT æ“ä½œ,è¿‡æ»¤å’Œæ’åºæ•°æ®,å°†è§†å›¾è”ç»“åˆ°å…¶ä»–è§†å›¾æˆ–è¡¨,ç”šè‡³èƒ½æ·»åŠ å’Œæ›´æ–°æ•°æ®(æ·»åŠ å’Œæ›´æ–°æ•°æ®å­˜åœ¨æŸäº›é™åˆ¶ã€‚å…³äºè¿™ä¸ªå†…å®¹ç¨åè¿˜è¦åšè¿›ä¸€æ­¥çš„ä»‹ç»)ã€‚</p>
<p>é‡è¦çš„æ˜¯çŸ¥é“è§†å›¾ä»…ä»…æ˜¯ç”¨æ¥æŸ¥çœ‹å­˜å‚¨åœ¨åˆ«å¤„çš„æ•°æ®çš„ä¸€ç§è®¾æ–½ã€‚è§†å›¾æœ¬èº«ä¸åŒ…å«æ•°æ®,å› æ­¤å®ƒä»¬è¿”å›çš„æ•°æ®æ˜¯ä»å…¶ä»–è¡¨ä¸­æ£€ç´¢å‡ºæ¥çš„ã€‚åœ¨æ·»åŠ æˆ–æ›´æ”¹è¿™äº›è¡¨ä¸­çš„æ•°æ®æ—¶,è§†å›¾å°†è¿”å›æ”¹å˜è¿‡çš„æ•°æ®ã€‚</p>
<p><strong>æ€§èƒ½é—®é¢˜</strong> å› ä¸ºè§†å›¾ä¸åŒ…å«æ•°æ®,æ‰€ä»¥æ¯æ¬¡ä½¿ç”¨è§†å›¾æ—¶,éƒ½å¿…é¡»å¤„ç†æŸ¥è¯¢æ‰§è¡Œæ—¶æ‰€éœ€çš„ä»»ä¸€ä¸ªæ£€ç´¢ã€‚å¦‚æœä½ ç”¨å¤šä¸ªè”ç»“å’Œè¿‡æ»¤åˆ›å»ºäº†å¤æ‚çš„è§†å›¾æˆ–è€…åµŒå¥—äº†è§†å›¾,å¯èƒ½ä¼šå‘ç°æ€§èƒ½ä¸‹é™å¾—å¾ˆå‰å®³ã€‚å› æ­¤,åœ¨éƒ¨ç½²ä½¿ç”¨äº†å¤§é‡è§†å›¾çš„åº”ç”¨å‰,åº”è¯¥è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>2.è§†å›¾çš„è§„åˆ™å’Œé™åˆ¶</p>
<p>ä¸‹é¢æ˜¯å…³äºè§†å›¾åˆ›å»ºå’Œä½¿ç”¨çš„ä¸€äº›æœ€å¸¸è§çš„è§„åˆ™å’Œé™åˆ¶ã€‚</p>
<ul>
<li>ä¸è¡¨ä¸€æ ·,è§†å›¾å¿…é¡»å”¯ä¸€å‘½å(ä¸èƒ½ç»™è§†å›¾å–ä¸åˆ«çš„è§†å›¾æˆ–è¡¨ç›¸åŒçš„åå­—)ã€‚</li>
<li>å¯¹äºå¯ä»¥åˆ›å»ºçš„è§†å›¾æ•°ç›®æ²¡æœ‰é™åˆ¶ã€‚</li>
<li>ä¸ºäº†åˆ›å»ºè§†å›¾,å¿…é¡»å…·æœ‰è¶³å¤Ÿçš„è®¿é—®æƒé™ã€‚è¿™äº›é™åˆ¶é€šå¸¸ç”±æ•°æ®åº“ç®¡ç†äººå‘˜æˆäºˆã€‚</li>
<li>è§†å›¾å¯ä»¥åµŒå¥—,å³å¯ä»¥åˆ©ç”¨ä»å…¶ä»–è§†å›¾ä¸­æ£€ç´¢æ•°æ®çš„æŸ¥è¯¢æ¥æ„é€ ä¸€ä¸ªè§†å›¾ã€‚</li>
<li>ORDER BY å¯ä»¥ç”¨åœ¨è§†å›¾ä¸­,ä½†å¦‚æœä»è¯¥è§†å›¾æ£€ç´¢æ•°æ® SELECT ä¸­ä¹Ÿå«æœ‰ ORDER BY ,é‚£ä¹ˆè¯¥è§†å›¾ä¸­çš„ ORDER BY å°†è¢«è¦†ç›–ã€‚</li>
<li>è§†å›¾ä¸èƒ½ç´¢å¼•,ä¹Ÿä¸èƒ½æœ‰å…³è”çš„è§¦å‘å™¨æˆ–é»˜è®¤å€¼ã€‚</li>
<li>è§†å›¾å¯ä»¥å’Œè¡¨ä¸€èµ·ä½¿ç”¨ã€‚ä¾‹å¦‚,ç¼–å†™ä¸€æ¡è”ç»“è¡¨å’Œè§†å›¾çš„ SELECTè¯­å¥ã€‚</li>
</ul>
<blockquote>
<p>ä½¿ç”¨è§†å›¾</p>
</blockquote>
<p>åœ¨ç†è§£ä»€ä¹ˆæ˜¯è§†å›¾(ä»¥åŠç®¡ç†å®ƒä»¬çš„è§„åˆ™åŠçº¦æŸ)å,æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è§†å›¾çš„åˆ›å»ºã€‚</p>
<ul>
<li>è§†å›¾ç”¨ CREATE VIEW è¯­å¥æ¥åˆ›å»ºã€‚</li>
<li>ä½¿ç”¨ SHOW CREATE VIEW viewname ;æ¥æŸ¥çœ‹åˆ›å»ºè§†å›¾çš„è¯­å¥ã€‚</li>
<li>ç”¨ DROP åˆ é™¤è§†å›¾,å…¶è¯­æ³•ä¸º DROP VIEW viewname;ã€‚</li>
<li>æ›´æ–°è§†å›¾æ—¶,å¯ä»¥å…ˆç”¨DROPå†ç”¨CREATE,ä¹Ÿå¯ä»¥ç›´æ¥ç”¨CREATE ORREPLACE VIEWã€‚å¦‚æœè¦æ›´æ–°çš„è§†å›¾ä¸å­˜åœ¨,åˆ™ç¬¬ 2 æ¡æ›´æ–°è¯­å¥ä¼šåˆ›å»ºä¸€ä¸ªè§†å›¾;å¦‚æœè¦æ›´æ–°çš„è§†å›¾å­˜åœ¨,åˆ™ç¬¬ 2 æ¡æ›´æ–°è¯­å¥ä¼šæ›¿æ¢åŸæœ‰è§†å›¾ã€‚</li>
</ul>
<p>1.åˆ©ç”¨è§†å›¾ç®€åŒ–å¤æ‚çš„è”ç»“</p>
<p>è§†å›¾çš„æœ€å¸¸è§çš„åº”ç”¨ä¹‹ä¸€æ˜¯éšè—å¤æ‚çš„SQL,è¿™é€šå¸¸éƒ½ä¼šæ¶‰åŠè”ç»“ã€‚</p>
<p>è¯·çœ‹ä¸‹é¢çš„ä¾‹å­:</p>
<blockquote>
<blockquote>
<p>åˆ›å»ºä¸€ä¸ªåä¸º productcustomers çš„è§†å›¾,å®ƒè”ç»“ä¸‰ä¸ªè¡¨,ä»¥è¿”å›å·²è®¢è´­äº†ä»»æ„äº§å“çš„æ‰€æœ‰å®¢æˆ·çš„åˆ—è¡¨ã€‚å¦‚æœæ‰§è¡ŒSELECT * FROM productcustomers ,å°†åˆ—å‡ºè®¢è´­äº†ä»»æ„äº§å“çš„å®¢æˆ·ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create view productcustomers as select cust_name,cust_contact,prod_id from customers,orders,orderitems where customers.cust_id=orders.cust_id and orderitems.order_num = orders.order_num ;</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from productcustomers;</span><br><span class="line">+----------------+--------------+---------+</span><br><span class="line">| cust_name      | cust_contact | prod_id |</span><br><span class="line">+----------------+--------------+---------+</span><br><span class="line">| Coyote Inc.    | Y Lee        | ANV01   |</span><br><span class="line">| Coyote Inc.    | Y Lee        | ANV02   |</span><br><span class="line">| Coyote Inc.    | Y Lee        | TNT2    |</span><br><span class="line">| Coyote Inc.    | Y Lee        | FB      |</span><br><span class="line">| Coyote Inc.    | Y Lee        | FB      |</span><br><span class="line">| Coyote Inc.    | Y Lee        | OL1     |</span><br><span class="line">| Coyote Inc.    | Y Lee        | SLING   |</span><br><span class="line">| Coyote Inc.    | Y Lee        | ANV03   |</span><br><span class="line">| Wascals        | Jim Jones    | JP2000  |</span><br><span class="line">| Yosemite Place | Y Sam        | TNT2    |</span><br><span class="line">| The Fudds      | E Fudd       | FC      |</span><br><span class="line">+----------------+--------------+---------+</span><br><span class="line">11 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>æ£€ç´¢è®¢è´­äº†äº§å“ TNT2 çš„å®¢æˆ·</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select cust_name,cust_contact from productcustomers where prod_id='TNT2';</span><br><span class="line">+----------------+--------------+</span><br><span class="line">| cust_name      | cust_contact |</span><br><span class="line">+----------------+--------------+</span><br><span class="line">| Coyote Inc.    | Y Lee        |</span><br><span class="line">| Yosemite Place | Y Sam        |</span><br><span class="line">+----------------+--------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡è¯­å¥é€šè¿‡ WHERE å­å¥ä»è§†å›¾ä¸­æ£€ç´¢ç‰¹å®šæ•°æ®ã€‚åœ¨MySQLå¤„ç†æ­¤æŸ¥è¯¢æ—¶,å®ƒå°†æŒ‡å®šçš„ WHERE å­å¥æ·»åŠ åˆ°è§†å›¾æŸ¥è¯¢ä¸­çš„å·²æœ‰WHERE å­å¥ä¸­,ä»¥ä¾¿æ­£ç¡®è¿‡æ»¤æ•°æ®ã€‚</p>
<p>å¯ä»¥çœ‹å‡º,è§†å›¾æå¤§åœ°ç®€åŒ–äº†å¤æ‚SQLè¯­å¥çš„ä½¿ç”¨ã€‚åˆ©ç”¨è§†å›¾,å¯ä¸€æ¬¡æ€§ç¼–å†™åŸºç¡€çš„SQL,ç„¶åæ ¹æ®éœ€è¦å¤šæ¬¡ä½¿ç”¨ã€‚</p>
<p><strong>åˆ›å»ºå¯é‡ç”¨çš„è§†å›¾</strong> åˆ›å»ºä¸å—ç‰¹å®šæ•°æ®é™åˆ¶çš„è§†å›¾æ˜¯ä¸€ç§å¥½åŠæ³•ã€‚ä¾‹å¦‚,ä¸Šé¢åˆ›å»ºçš„è§†å›¾è¿”å›ç”Ÿäº§æ‰€æœ‰äº§å“çš„å®¢æˆ·è€Œä¸ä»…ä»…æ˜¯ ç”Ÿäº§TNT2 çš„å®¢æˆ·ã€‚æ‰©å±•è§†å›¾çš„èŒƒå›´ä¸ä»…ä½¿å¾—å®ƒèƒ½è¢«é‡ç”¨,è€Œä¸”ç”šè‡³æ›´æœ‰ç”¨ã€‚è¿™æ ·åšä¸éœ€è¦åˆ›å»ºå’Œç»´æŠ¤å¤šä¸ªç±»ä¼¼è§†å›¾ã€‚</p>
<p>2.ç”¨è§†å›¾é‡æ–°æ ¼å¼åŒ–æ£€ç´¢å‡ºçš„æ•°æ®</p>
<p>å¦‚ä¸Šæ‰€è¿°,è§†å›¾çš„å¦ä¸€å¸¸è§ç”¨é€”æ˜¯é‡æ–°æ ¼å¼åŒ–æ£€ç´¢å‡ºçš„æ•°æ®ã€‚ä¸‹é¢çš„ SELECT è¯­å¥åœ¨å•ä¸ªç»„åˆè®¡ç®—åˆ—ä¸­è¿”å›ä¾›åº”å•†åå’Œä½ç½®:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select concat(rtrim(vend_name),' (',rtrim(vend_country),')')</span><br><span class="line">    -&gt; as vend_title</span><br><span class="line">    -&gt; from vendors</span><br><span class="line">    -&gt; order by vend_name;</span><br><span class="line">+-------------------------+</span><br><span class="line">| vend_title              |</span><br><span class="line">+-------------------------+</span><br><span class="line">| ACME (USA)              |</span><br><span class="line">| Anvils R Us (USA)       |</span><br><span class="line">| Furball Inc. (USA)      |</span><br><span class="line">| Jet Set (England)       |</span><br><span class="line">| Jouets Et Ours (France) |</span><br><span class="line">| LT Supplies (USA)       |</span><br><span class="line">+-------------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨,å‡å¦‚ç»å¸¸éœ€è¦è¿™ä¸ªæ ¼å¼çš„ç»“æœã€‚ä¸å¿…åœ¨æ¯æ¬¡éœ€è¦æ—¶æ‰§è¡Œè”ç»“,åˆ›å»ºä¸€ä¸ªè§†å›¾,æ¯æ¬¡éœ€è¦æ—¶ä½¿ç”¨å®ƒå³å¯ã€‚ä¸ºæŠŠæ­¤è¯­å¥è½¬æ¢ä¸ºè§†å›¾,å¯æŒ‰å¦‚ä¸‹è¿›è¡Œ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create view vendorlocation as</span><br><span class="line">    -&gt; select concat(rtrim(vend_name),' (',rtrim(vend_country),')')</span><br><span class="line">    -&gt; as vend_title</span><br><span class="line">    -&gt; from vendors</span><br><span class="line">    -&gt; order by vend_name;</span><br><span class="line">Query OK, 0 rows affected (0.32 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡è¯­å¥ä½¿ç”¨ä¸ä»¥å‰çš„ SELECT è¯­å¥ç›¸åŒçš„æŸ¥è¯¢åˆ›å»ºè§†å›¾ã€‚ä¸ºäº†æ£€ç´¢å‡ºä»¥åˆ›å»ºæ‰€æœ‰é‚®ä»¶æ ‡ç­¾çš„æ•°æ®,å¯å¦‚ä¸‹è¿›è¡Œ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from vendorlocation;</span><br><span class="line">+-------------------------+</span><br><span class="line">| vend_title              |</span><br><span class="line">+-------------------------+</span><br><span class="line">| ACME (USA)              |</span><br><span class="line">| Anvils R Us (USA)       |</span><br><span class="line">| Furball Inc. (USA)      |</span><br><span class="line">| Jet Set (England)       |</span><br><span class="line">| Jouets Et Ours (France) |</span><br><span class="line">| LT Supplies (USA)       |</span><br><span class="line">+-------------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>3.ç”¨è§†å›¾è¿‡æ»¤ä¸æƒ³è¦çš„æ•°æ®</p>
<p>è§†å›¾å¯¹äºåº”ç”¨æ™®é€šçš„WHEREå­å¥ä¹Ÿå¾ˆæœ‰ç”¨ã€‚</p>
<blockquote>
<blockquote>
<p>å®šä¹‰customeremaillist è§†å›¾,å®ƒè¿‡æ»¤æ²¡æœ‰ç”µå­é‚®ä»¶åœ°å€çš„å®¢æˆ·ã€‚ä¸ºæ­¤ç›®çš„,å¯ä½¿ç”¨ä¸‹é¢çš„è¯­å¥:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create view customeremaillist as</span><br><span class="line">    -&gt; select cust_id,cust_name,cust_email</span><br><span class="line">    -&gt; from customers</span><br><span class="line">    -&gt; where cust_email is not null;</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from customeremaillist;</span><br><span class="line">+---------+----------------+---------------------+</span><br><span class="line">| cust_id | cust_name      | cust_email          |</span><br><span class="line">+---------+----------------+---------------------+</span><br><span class="line">|   10001 | Coyote Inc.    | ylee@coyote.com     |</span><br><span class="line">|   10003 | Wascals        | rabbit@wascally.com |</span><br><span class="line">|   10004 | Yosemite Place | sam@yosemite.com    |</span><br><span class="line">|   20001 | Coyote Inc.    | ylee@coyote.com     |</span><br><span class="line">|   20003 | Wascals        | rabbit@wascally.com |</span><br><span class="line">|   20004 | Yosemite Place | sam@yosemite.com    |</span><br><span class="line">+---------+----------------+---------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>åœ¨å‘é€ç”µå­é‚®ä»¶åˆ°é‚®ä»¶åˆ—è¡¨æ—¶,éœ€è¦æ’é™¤æ²¡æœ‰ç”µå­é‚®ä»¶åœ°å€çš„ç”¨æˆ·ã€‚è¿™é‡Œçš„ WHERE å­å¥è¿‡æ»¤äº† cust_email åˆ—ä¸­å…·æœ‰NULL å€¼çš„é‚£äº›è¡Œ,ä½¿ä»–ä»¬ä¸è¢«æ£€ç´¢å‡ºæ¥ã€‚</p>
<p><strong>WHERE å­å¥ä¸ WHERE å­å¥</strong> å¦‚æœä»è§†å›¾æ£€ç´¢æ•°æ®æ—¶ä½¿ç”¨äº†ä¸€æ¡WHERE å­å¥,åˆ™ä¸¤ç»„å­å¥(ä¸€ç»„åœ¨è§†å›¾ä¸­,å¦ä¸€ç»„æ˜¯ä¼ é€’ç»™è§†å›¾çš„)å°†è‡ªåŠ¨ç»„åˆã€‚</p>
<p>4.ä½¿ç”¨è§†å›¾ä¸è®¡ç®—å­—æ®µ</p>
<p>è§†å›¾å¯¹äºç®€åŒ–è®¡ç®—å­—æ®µçš„ä½¿ç”¨ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢æŸä¸ªç‰¹å®šè®¢å•ä¸­çš„ç‰©å“,è®¡ç®—æ¯ç§ç‰©å“çš„æ€»ä»·æ ¼</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_id,quantity,item_price,quantity*item_price as expanded_price</span><br><span class="line">    -&gt; from orderitems</span><br><span class="line">    -&gt; where order_num = 20005;</span><br><span class="line">+---------+----------+------------+----------------+</span><br><span class="line">| prod_id | quantity | item_price | expanded_price |</span><br><span class="line">+---------+----------+------------+----------------+</span><br><span class="line">| ANV01   |       10 |       5.99 |          59.90 |</span><br><span class="line">| ANV02   |        3 |       9.99 |          29.97 |</span><br><span class="line">| TNT2    |        5 |      10.00 |          50.00 |</span><br><span class="line">| FB      |        1 |      10.00 |          10.00 |</span><br><span class="line">+---------+----------+------------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ä¸ºå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªè§†å›¾,å¦‚ä¸‹è¿›è¡Œ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create view orderitemsexpanded as</span><br><span class="line">    -&gt; select prod_id,quantity,item_price,quantity*item_price as expanded_price</span><br><span class="line">    -&gt; from orderitems;</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br></pre></td></tr></table></figure>

<p>ä¸ºæ£€ç´¢è®¢å• 20005 çš„è¯¦ç»†å†…å®¹(ä¸Šé¢çš„è¾“å‡º),å¦‚ä¸‹è¿›è¡Œ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create view orderitemsexpanded as</span><br><span class="line">    -&gt; select order_num,prod_id,quantity,item_price,quantity*item_price as expanded_price</span><br><span class="line">    -&gt; from orderitems;</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from orderitemsexpanded where order_num = 20005;</span><br><span class="line">+-----------+---------+----------+------------+----------------+</span><br><span class="line">| order_num | prod_id | quantity | item_price | expanded_price |</span><br><span class="line">+-----------+---------+----------+------------+----------------+</span><br><span class="line">|     20005 | ANV01   |       10 |       5.99 |          59.90 |</span><br><span class="line">|     20005 | ANV02   |        3 |       9.99 |          29.97 |</span><br><span class="line">|     20005 | TNT2    |        5 |      10.00 |          50.00 |</span><br><span class="line">|     20005 | FB      |        1 |      10.00 |          10.00 |</span><br><span class="line">+-----------+---------+----------+------------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°,è§†å›¾éå¸¸å®¹æ˜“åˆ›å»º,è€Œä¸”å¾ˆå¥½ä½¿ç”¨ã€‚æ­£ç¡®ä½¿ç”¨,è§†å›¾å¯æå¤§åœ°ç®€åŒ–å¤æ‚çš„æ•°æ®å¤„ç†ã€‚</p>
<p>5.æ›´æ–°è§†å›¾</p>
<p>è¿„ä»Šä¸ºæ­¢çš„æ‰€æœ‰è§†å›¾éƒ½æ˜¯å’Œ SELECT è¯­å¥ä½¿ç”¨çš„ã€‚ç„¶è€Œ,è§†å›¾çš„æ•°æ®èƒ½å¦æ›´æ–°?ç­”æ¡ˆè§†æƒ…å†µè€Œå®šã€‚</p>
<p>é€šå¸¸,è§†å›¾æ˜¯å¯æ›´æ–°çš„(å³,å¯ä»¥å¯¹å®ƒä»¬ä½¿ç”¨ INSERT ã€ UPDATE å’ŒDELETE )ã€‚æ›´æ–°ä¸€ä¸ªè§†å›¾å°†æ›´æ–°å…¶åŸºè¡¨(å¯ä»¥å›å¿†ä¸€ä¸‹,è§†å›¾æœ¬èº«æ²¡æœ‰æ•°æ®)ã€‚å¦‚æœä½ å¯¹è§†å›¾å¢åŠ æˆ–åˆ é™¤è¡Œ,å®é™…ä¸Šæ˜¯å¯¹å…¶åŸºè¡¨å¢åŠ æˆ–åˆ é™¤è¡Œã€‚</p>
<p>ä½†æ˜¯,å¹¶éæ‰€æœ‰è§†å›¾éƒ½æ˜¯å¯æ›´æ–°çš„ã€‚åŸºæœ¬ä¸Šå¯ä»¥è¯´,å¦‚æœMySQLä¸èƒ½æ­£ç¡®åœ°ç¡®å®šè¢«æ›´æ–°çš„åŸºæ•°æ®,åˆ™ä¸å…è®¸æ›´æ–°(åŒ…æ‹¬æ’å…¥å’Œåˆ é™¤)ã€‚è¿™å®é™…ä¸Šæ„å‘³ç€,å¦‚æœè§†å›¾å®šä¹‰ä¸­æœ‰ä»¥ä¸‹æ“ä½œ,åˆ™ä¸èƒ½è¿›è¡Œè§†å›¾çš„æ›´æ–°:</p>
<ul>
<li>åˆ†ç»„(ä½¿ç”¨ GROUP BY å’Œ HAVING );</li>
<li>è”ç»“;</li>
<li>å­æŸ¥è¯¢;</li>
<li>å¹¶;</li>
<li>èšé›†å‡½æ•°( Min() ã€ Count() ã€ Sum() ç­‰);</li>
<li>DISTINCT;</li>
<li>å¯¼å‡º(è®¡ç®—)åˆ—ã€‚</li>
</ul>
<p>æ¢å¥è¯è¯´,æœ¬ç« è®¸å¤šä¾‹å­ä¸­çš„è§†å›¾éƒ½æ˜¯ä¸å¯æ›´æ–°çš„ã€‚è¿™å¬ä¸Šå»å¥½åƒæ˜¯ä¸€ä¸ªä¸¥é‡çš„é™åˆ¶,ä½†å®é™…ä¸Šä¸æ˜¯,å› ä¸ºè§†å›¾ä¸»è¦ç”¨äºæ•°æ®æ£€ç´¢ã€‚</p>
<p><strong>å¯èƒ½çš„å˜åŠ¨</strong> ä¸Šé¢åˆ—å‡ºçš„é™åˆ¶è‡ªMySQL 5ä»¥æ¥æ˜¯æ­£ç¡®çš„ã€‚ä¸è¿‡,æœªæ¥çš„MySQLå¾ˆå¯èƒ½ä¼šå–æ¶ˆæŸäº›é™åˆ¶ã€‚</p>
<p><strong>å°†è§†å›¾ç”¨äºæ£€ç´¢</strong> ä¸€èˆ¬,åº”è¯¥å°†è§†å›¾ç”¨äºæ£€ç´¢( SELECT è¯­å¥)è€Œä¸ç”¨äºæ›´æ–°( INSERT ã€ UPDATE å’Œ DELETE )ã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>è§†å›¾ä¸ºè™šæ‹Ÿçš„è¡¨ã€‚å®ƒä»¬åŒ…å«çš„ä¸æ˜¯æ•°æ®è€Œæ˜¯æ ¹æ®éœ€è¦æ£€ç´¢æ•°æ®çš„æŸ¥è¯¢ã€‚è§†å›¾æä¾›äº†ä¸€ç§MySQLçš„ SELECT è¯­å¥å±‚æ¬¡çš„å°è£…,å¯ç”¨æ¥ç®€åŒ–æ•°æ®å¤„ç†ä»¥åŠé‡æ–°æ ¼å¼åŒ–åŸºç¡€æ•°æ®æˆ–ä¿æŠ¤åŸºç¡€æ•°æ®ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h3 id="ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹"><a href="#ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹"></a>ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹</h3><p>æœ¬ç« ä»‹ç»ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹,ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ä»¥åŠå¦‚ä½•ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹,å¹¶ä¸”ä»‹ç»åˆ›å»ºå’Œä½¿ç”¨å­˜å‚¨è¿‡ç¨‹çš„åŸºæœ¬è¯­æ³•ã€‚</p>
<blockquote>
<p>å­˜å‚¨è¿‡ç¨‹</p>
</blockquote>
<p><strong>éœ€è¦MySQL 5</strong> MySQL 5æ·»åŠ äº†å¯¹å­˜å‚¨è¿‡ç¨‹çš„æ”¯æŒ,å› æ­¤,æœ¬ç« å†…å®¹é€‚ç”¨äºMySQL 5åŠä»¥åçš„ç‰ˆæœ¬ã€‚</p>
<p>è¿„ä»Šä¸ºæ­¢,ä½¿ç”¨çš„å¤§å¤šæ•°SQLè¯­å¥éƒ½æ˜¯é’ˆå¯¹ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨çš„å•æ¡è¯­å¥ã€‚å¹¶éæ‰€æœ‰æ“ä½œéƒ½è¿™ä¹ˆç®€å•,ç»å¸¸ä¼šæœ‰ä¸€ä¸ªå®Œæ•´çš„æ“ä½œéœ€è¦å¤šæ¡è¯­å¥æ‰èƒ½å®Œæˆã€‚ä¾‹å¦‚,è€ƒè™‘ä»¥ä¸‹çš„æƒ…å½¢ã€‚</p>
<ul>
<li>ä¸ºäº†å¤„ç†è®¢å•,éœ€è¦æ ¸å¯¹ä»¥ä¿è¯åº“å­˜ä¸­æœ‰ç›¸åº”çš„ç‰©å“ã€‚</li>
<li>å¦‚æœåº“å­˜æœ‰ç‰©å“,è¿™äº›ç‰©å“éœ€è¦é¢„å®šä»¥ä¾¿ä¸å°†å®ƒä»¬å†å–ç»™åˆ«çš„äºº,<br>å¹¶ä¸”è¦å‡å°‘å¯ç”¨çš„ç‰©å“æ•°é‡ä»¥åæ˜ æ­£ç¡®çš„åº“å­˜é‡ã€‚</li>
<li>åº“å­˜ä¸­æ²¡æœ‰çš„ç‰©å“éœ€è¦è®¢è´­,è¿™éœ€è¦ä¸ä¾›åº”å•†è¿›è¡ŒæŸç§äº¤äº’ã€‚</li>
<li>å…³äºå“ªäº›ç‰©å“å…¥åº“(å¹¶ä¸”å¯ä»¥ç«‹å³å‘è´§)å’Œå“ªäº›ç‰©å“é€€è®¢,éœ€è¦é€šçŸ¥ç›¸åº”çš„å®¢æˆ·ã€‚</li>
</ul>
<p>è¿™æ˜¾ç„¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­,å®ƒç”šè‡³è¶…å‡ºäº†æœ¬ä¹¦ä¸­æ‰€ç”¨æ ·ä¾‹è¡¨çš„èŒƒå›´,ä½†è¶³ä»¥å¸®åŠ©è¡¨è¾¾æˆ‘ä»¬çš„æ„æ€äº†ã€‚æ‰§è¡Œè¿™ä¸ªå¤„ç†éœ€è¦é’ˆå¯¹è®¸å¤šè¡¨çš„å¤šæ¡MySQLè¯­å¥ã€‚æ­¤å¤–,éœ€è¦æ‰§è¡Œçš„å…·ä½“è¯­å¥åŠå…¶æ¬¡åºä¹Ÿä¸æ˜¯å›ºå®šçš„,å®ƒä»¬å¯èƒ½ä¼š(å’Œå°†)æ ¹æ®å“ªäº›ç‰©å“åœ¨åº“å­˜ä¸­å“ªäº›ä¸åœ¨è€Œå˜åŒ–ã€‚</p>
<p>é‚£ä¹ˆ,æ€æ ·ç¼–å†™æ­¤ä»£ç ?å¯ä»¥å•ç‹¬ç¼–å†™æ¯æ¡è¯­å¥,å¹¶æ ¹æ®ç»“æœæœ‰æ¡ä»¶åœ°æ‰§è¡Œå¦å¤–çš„è¯­å¥ã€‚åœ¨æ¯æ¬¡éœ€è¦è¿™ä¸ªå¤„ç†æ—¶(ä»¥åŠæ¯ä¸ªéœ€è¦å®ƒçš„åº”ç”¨ä¸­)éƒ½å¿…é¡»åšè¿™äº›å·¥ä½œã€‚</p>
<p>å¯ä»¥åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ã€‚å­˜å‚¨è¿‡ç¨‹ç®€å•æ¥è¯´,å°±æ˜¯ä¸ºä»¥åçš„ä½¿ç”¨è€Œä¿å­˜çš„ä¸€æ¡æˆ–å¤šæ¡MySQLè¯­å¥çš„é›†åˆã€‚å¯å°†å…¶è§†ä¸ºæ‰¹æ–‡ä»¶,è™½ç„¶å®ƒä»¬çš„ä½œç”¨ä¸ä»…é™äºæ‰¹å¤„ç†ã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹</p>
</blockquote>
<p>æ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹,é‚£ä¹ˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒä»¬å‘¢?æœ‰è®¸å¤šç†ç”±,ä¸‹é¢åˆ—å‡ºä¸€äº›ä¸»è¦çš„ç†ç”±ã€‚</p>
<ul>
<li>é€šè¿‡æŠŠå¤„ç†å°è£…åœ¨å®¹æ˜“ä½¿ç”¨çš„å•å…ƒä¸­,ç®€åŒ–å¤æ‚çš„æ“ä½œ(æ­£å¦‚å‰é¢ä¾‹å­æ‰€è¿°)ã€‚</li>
<li>ç”±äºä¸è¦æ±‚åå¤å»ºç«‹ä¸€ç³»åˆ—å¤„ç†æ­¥éª¤,è¿™ä¿è¯äº†æ•°æ®çš„å®Œæ•´æ€§ã€‚å¦‚æœæ‰€æœ‰å¼€å‘äººå‘˜å’Œåº”ç”¨ç¨‹åºéƒ½ä½¿ç”¨åŒä¸€(è¯•éªŒå’Œæµ‹è¯•)å­˜å‚¨è¿‡ç¨‹,åˆ™æ‰€ä½¿ç”¨çš„ä»£ç éƒ½æ˜¯ç›¸åŒçš„ã€‚</li>
</ul>
<p>è¿™ä¸€ç‚¹çš„å»¶ä¼¸å°±æ˜¯é˜²æ­¢é”™è¯¯ã€‚éœ€è¦æ‰§è¡Œçš„æ­¥éª¤è¶Šå¤š,å‡ºé”™çš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚é˜²æ­¢é”™è¯¯ä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
<ul>
<li>ç®€åŒ–å¯¹å˜åŠ¨çš„ç®¡ç†ã€‚å¦‚æœè¡¨åã€åˆ—åæˆ–ä¸šåŠ¡é€»è¾‘(æˆ–åˆ«çš„å†…å®¹)æœ‰å˜åŒ–,åªéœ€è¦æ›´æ”¹å­˜å‚¨è¿‡ç¨‹çš„ä»£ç ã€‚ä½¿ç”¨å®ƒçš„äººå‘˜ç”šè‡³ä¸éœ€è¦çŸ¥é“è¿™äº›å˜åŒ–ã€‚</li>
</ul>
<p>è¿™ä¸€ç‚¹çš„å»¶ä¼¸å°±æ˜¯å®‰å…¨æ€§ã€‚é€šè¿‡å­˜å‚¨è¿‡ç¨‹é™åˆ¶å¯¹åŸºç¡€æ•°æ®çš„è®¿é—®å‡å°‘äº†æ•°æ®è®¹è¯¯(æ— æ„è¯†çš„æˆ–åˆ«çš„åŸå› æ‰€å¯¼è‡´çš„æ•°æ®è®¹è¯¯)çš„æœºä¼šã€‚</p>
<ul>
<li>æé«˜æ€§èƒ½ã€‚å› ä¸ºä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ¯”ä½¿ç”¨å•ç‹¬çš„SQLè¯­å¥è¦å¿«ã€‚</li>
<li>å­˜åœ¨ä¸€äº›åªèƒ½ç”¨åœ¨å•ä¸ªè¯·æ±‚ä¸­çš„MySQLå…ƒç´ å’Œç‰¹æ€§,å­˜å‚¨è¿‡ç¨‹å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥ç¼–å†™åŠŸèƒ½æ›´å¼ºæ›´çµæ´»çš„ä»£ç (åœ¨ä¸‹ä¸€ç« çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ã€‚)</li>
</ul>
<p>æ¢å¥è¯è¯´,ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æœ‰3ä¸ªä¸»è¦çš„å¥½å¤„,å³ç®€å•ã€å®‰å…¨ã€é«˜æ€§èƒ½ã€‚æ˜¾ç„¶,å®ƒä»¬éƒ½å¾ˆé‡è¦ã€‚ä¸è¿‡,åœ¨å°†SQLä»£ç è½¬æ¢ä¸ºå­˜å‚¨è¿‡ç¨‹å‰,ä¹Ÿå¿…é¡»çŸ¥é“å®ƒçš„ä¸€äº›ç¼ºé™·ã€‚</p>
<ul>
<li>ä¸€èˆ¬æ¥è¯´,å­˜å‚¨è¿‡ç¨‹çš„ç¼–å†™æ¯”åŸºæœ¬SQLè¯­å¥å¤æ‚,ç¼–å†™å­˜å‚¨è¿‡ç¨‹éœ€è¦æ›´é«˜çš„æŠ€èƒ½,æ›´ä¸°å¯Œçš„ç»éªŒã€‚</li>
<li>ä½ å¯èƒ½æ²¡æœ‰åˆ›å»ºå­˜å‚¨è¿‡ç¨‹çš„å®‰å…¨è®¿é—®æƒé™ã€‚è®¸å¤šæ•°æ®åº“ç®¡ç†å‘˜é™<br>åˆ¶å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»ºæƒé™,å…è®¸ç”¨æˆ·ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹,ä½†ä¸å…è®¸ä»–ä»¬åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ã€‚</li>
</ul>
<p>å°½ç®¡æœ‰è¿™äº›ç¼ºé™·,å­˜å‚¨è¿‡ç¨‹è¿˜æ˜¯éå¸¸æœ‰ç”¨çš„,å¹¶ä¸”åº”è¯¥å°½å¯èƒ½åœ°ä½¿ç”¨ã€‚</p>
<p><strong>ä¸èƒ½ç¼–å†™å­˜å‚¨è¿‡ç¨‹?ä½ ä¾ç„¶å¯ä»¥ä½¿ç”¨</strong> MySQLå°†ç¼–å†™å­˜å‚¨è¿‡ç¨‹çš„å®‰å…¨å’Œè®¿é—®ä¸æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹çš„å®‰å…¨å’Œè®¿é—®åŒºåˆ†å¼€æ¥ã€‚è¿™æ˜¯å¥½äº‹æƒ…ã€‚å³ä½¿ä½ ä¸èƒ½(æˆ–ä¸æƒ³)ç¼–å†™è‡ªå·±çš„å­˜å‚¨è¿‡ç¨‹,ä¹Ÿä»ç„¶å¯ä»¥åœ¨é€‚å½“çš„æ—¶å€™æ‰§è¡Œåˆ«çš„å­˜å‚¨è¿‡ç¨‹ã€‚</p>
<blockquote>
<p>ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹</p>
</blockquote>
<p>ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹éœ€è¦çŸ¥é“å¦‚ä½•æ‰§è¡Œ(è¿è¡Œ)å®ƒä»¬ã€‚å­˜å‚¨è¿‡ç¨‹çš„æ‰§è¡Œè¿œæ¯”å…¶å®šä¹‰æ›´ç»å¸¸é‡åˆ°,å› æ­¤,æˆ‘ä»¬å°†ä»æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹å¼€å§‹ä»‹ç»ã€‚ç„¶åå†ä»‹ç»åˆ›å»ºå’Œä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ã€‚</p>
<p>1.æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹</p>
<p>MySQLç§°å­˜å‚¨è¿‡ç¨‹çš„æ‰§è¡Œä¸ºè°ƒç”¨,å› æ­¤MySQLæ‰§è¡Œå­˜å‚¨è¿‡ç¨‹çš„è¯­å¥ä¸º CALL ã€‚ CALL æ¥å—å­˜å‚¨è¿‡ç¨‹çš„åå­—ä»¥åŠéœ€è¦ä¼ é€’ç»™å®ƒçš„ä»»æ„å‚æ•°ã€‚è¯·çœ‹ä»¥ä¸‹ä¾‹å­:</p>
<blockquote>
<blockquote>
<p>æ‰§è¡Œåä¸º productpricing çš„å­˜å‚¨è¿‡ç¨‹,å®ƒè®¡ç®—å¹¶è¿”å›äº§å“çš„æœ€ä½ã€æœ€é«˜å’Œå¹³å‡ä»·æ ¼ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; call productpricing (@pricelow,@pricehigh,@priceaverage);</span><br></pre></td></tr></table></figure>

<p>2.åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</p>
<p>æ­£å¦‚æ‰€è¿°,ç¼–å†™å­˜å‚¨è¿‡ç¨‹å¹¶ä¸æ˜¯å¾®ä¸è¶³é“çš„äº‹æƒ…ã€‚ä¸ºè®©ä½ äº†è§£è¿™ä¸ªè¿‡ç¨‹,è¯·çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p>
<blockquote>
<blockquote>
<p>è¿”å›äº§å“å¹³å‡ä»·æ ¼çš„å­˜å‚¨è¿‡ç¨‹</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create procedure productpricing() begin select avg(prod_price) as priceaverage from products; end;</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'end' at line 1</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delimiter //</span><br><span class="line">MariaDB [test]&gt; create procedure productpricing() begin select avg(prod_price) as priceaverage from products; end //</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delimiter ;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç¨åä»‹ç»ç¬¬ä¸€æ¡å’Œæœ€åä¸€æ¡è¯­å¥ã€‚æ­¤å­˜å‚¨è¿‡ç¨‹åä¸º<code>productpricing</code> ,ç”¨ <code>CREATE PROCEDURE productpricing()</code> è¯­å¥å®šä¹‰ã€‚å¦‚æœå­˜å‚¨è¿‡ç¨‹æ¥å—å‚æ•°,å®ƒä»¬å°†åœ¨ <code>()</code> ä¸­åˆ—ä¸¾å‡ºæ¥ã€‚æ­¤å­˜å‚¨è¿‡ç¨‹æ²¡æœ‰å‚æ•°,ä½†åè·Ÿçš„ <code>()</code> ä»ç„¶éœ€è¦ã€‚ <code>BEGIN</code> å’Œ <code>END</code> è¯­å¥ç”¨æ¥é™å®šå­˜å‚¨è¿‡ç¨‹ä½“,è¿‡ç¨‹ä½“æœ¬èº«ä»…æ˜¯ä¸€ä¸ªç®€å•çš„ <code>SELECT</code> è¯­å¥ã€‚</p>
<p>åœ¨MySQLå¤„ç†è¿™æ®µä»£ç æ—¶,å®ƒåˆ›å»ºä¸€ä¸ªæ–°çš„å­˜å‚¨è¿‡ç¨‹ <code>product-pricing</code> ã€‚æ²¡æœ‰è¿”å›æ•°æ®,å› ä¸ºè¿™æ®µä»£ç å¹¶æœªè°ƒç”¨å­˜å‚¨è¿‡ç¨‹,è¿™é‡Œåªæ˜¯ä¸ºä»¥åä½¿ç”¨è€Œåˆ›å»ºå®ƒã€‚</p>
<p><strong>mysql å‘½ä»¤è¡Œå®¢æˆ·æœºçš„åˆ†éš”ç¬¦</strong> å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ mysql å‘½ä»¤è¡Œå®ç”¨ç¨‹åº,åº”è¯¥ä»”ç»†é˜…è¯»æ­¤è¯´æ˜ã€‚</p>
<p>é»˜è®¤çš„MySQLè¯­å¥åˆ†éš”ç¬¦ä¸º ; (æ­£å¦‚ä½ å·²ç»åœ¨è¿„ä»Šä¸ºæ­¢æ‰€ä½¿ç”¨çš„MySQLè¯­å¥ä¸­æ‰€çœ‹åˆ°çš„é‚£æ ·)ã€‚ mysql å‘½ä»¤è¡Œå®ç”¨ç¨‹åºä¹Ÿä½¿ç”¨ ; ä½œä¸ºè¯­å¥åˆ†éš”ç¬¦ã€‚å¦‚æœå‘½ä»¤è¡Œå®ç”¨ç¨‹åºè¦è§£é‡Šå­˜å‚¨è¿‡ç¨‹è‡ªèº«å†…çš„ ; å­—ç¬¦,åˆ™å®ƒä»¬æœ€ç»ˆä¸ä¼šæˆä¸ºå­˜å‚¨è¿‡ç¨‹çš„æˆåˆ†,è¿™ä¼šä½¿å­˜å‚¨è¿‡ç¨‹ä¸­çš„SQLå‡ºç°å¥æ³•é”™è¯¯ã€‚</p>
<p>è§£å†³åŠæ³•æ˜¯ä¸´æ—¶æ›´æ”¹å‘½ä»¤è¡Œå®ç”¨ç¨‹åºçš„è¯­å¥åˆ†éš”ç¬¦,å¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">delimiter//</span><br><span class="line">create procedure productpricing()</span><br><span class="line">begin</span><br><span class="line">  select avg(prod_price) as priceaverage</span><br><span class="line">  from products;</span><br><span class="line">end //</span><br><span class="line">delimiter;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­, <code>DELIMITER //</code> å‘Šè¯‰å‘½ä»¤è¡Œå®ç”¨ç¨‹åºä½¿ç”¨<code>//</code> ä½œä¸ºæ–°çš„è¯­å¥ç»“æŸåˆ†éš”ç¬¦,å¯ä»¥çœ‹åˆ°æ ‡å¿—å­˜å‚¨è¿‡ç¨‹ç»“æŸçš„ <code>END</code> å®šä¹‰ä¸º <code>END//</code> è€Œä¸æ˜¯ <code>END;</code> ã€‚è¿™æ ·,å­˜å‚¨è¿‡ç¨‹ä½“å†…çš„ <code>;</code> ä»ç„¶ä¿æŒä¸åŠ¨,å¹¶ä¸”æ­£ç¡®åœ°ä¼ é€’ç»™æ•°æ®åº“å¼•æ“ã€‚æœ€å,ä¸ºæ¢å¤ä¸ºåŸæ¥çš„è¯­å¥åˆ†éš”ç¬¦,å¯ä½¿ç”¨ <code>DELIMITER ;</code> ã€‚é™¤ <code>\</code>ç¬¦å·å¤–,ä»»ä½•å­—ç¬¦éƒ½å¯ä»¥ç”¨ä½œè¯­å¥åˆ†éš”ç¬¦ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ mysql å‘½ä»¤è¡Œå®ç”¨ç¨‹åº,åœ¨é˜…è¯»æœ¬ç« æ—¶è¯·è®°ä½è¿™é‡Œçš„å†…å®¹ã€‚</p>
<p>é‚£ä¹ˆ,å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹?å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; call productpricing();</span><br><span class="line">+--------------+</span><br><span class="line">| priceaverage |</span><br><span class="line">+--------------+</span><br><span class="line">|    16.133571 |</span><br><span class="line">+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><code>CALL productpricing();</code> æ‰§è¡Œåˆšåˆ›å»ºçš„å­˜å‚¨è¿‡ç¨‹å¹¶æ˜¾ç¤ºè¿”å›çš„ç»“æœã€‚å› ä¸ºå­˜å‚¨è¿‡ç¨‹å®é™…ä¸Šæ˜¯ä¸€ç§å‡½æ•°,æ‰€ä»¥å­˜å‚¨è¿‡ç¨‹ååéœ€è¦æœ‰ () ç¬¦å·(å³ä½¿ä¸ä¼ é€’å‚æ•°ä¹Ÿéœ€è¦)ã€‚</p>
<p>3.åˆ é™¤å­˜å‚¨è¿‡ç¨‹</p>
<p>å­˜å‚¨è¿‡ç¨‹åœ¨åˆ›å»ºä¹‹å,è¢«ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šä»¥ä¾›ä½¿ç”¨,ç›´è‡³è¢«åˆ é™¤ã€‚åˆ é™¤å‘½ä»¤ä»æœåŠ¡å™¨ä¸­åˆ é™¤å­˜å‚¨è¿‡ç¨‹ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸ºåˆ é™¤åˆšåˆ›å»ºçš„å­˜å‚¨è¿‡ç¨‹,å¯ä½¿ç”¨ä»¥ä¸‹è¯­å¥:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; drop procedure productpricing;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡è¯­å¥åˆ é™¤åˆšåˆ›å»ºçš„å­˜å‚¨è¿‡ç¨‹ã€‚è¯·æ³¨æ„æ²¡æœ‰ä½¿ç”¨åé¢çš„ <code>()</code> ,åªç»™å‡ºå­˜å‚¨è¿‡ç¨‹åã€‚</p>
<p><strong>ä»…å½“å­˜åœ¨æ—¶åˆ é™¤</strong> å¦‚æœæŒ‡å®šçš„è¿‡ç¨‹ä¸å­˜åœ¨,åˆ™ <code>DROP PROCEDURE</code>å°†äº§ç”Ÿä¸€ä¸ªé”™è¯¯ã€‚å½“è¿‡ç¨‹å­˜åœ¨æƒ³åˆ é™¤å®ƒæ—¶(å¦‚æœè¿‡ç¨‹ä¸å­˜åœ¨ä¹Ÿä¸äº§ç”Ÿé”™è¯¯)å¯ä½¿ç”¨ <code>DROP PROCEDURE IF EXISTS</code>ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; DROP PROCEDURE IF EXISTS productpricing;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>4.ä½¿ç”¨å‚æ•°</p>
<p>productpricing åªæ˜¯ä¸€ä¸ªç®€å•çš„å­˜å‚¨è¿‡ç¨‹,å®ƒç®€å•åœ°æ˜¾ç¤º SELECT è¯­å¥çš„ç»“æœã€‚ä¸€èˆ¬,å­˜å‚¨è¿‡ç¨‹å¹¶ä¸æ˜¾ç¤ºç»“æœ,è€Œæ˜¯æŠŠç»“æœè¿”å›ç»™ä½ æŒ‡å®šçš„å˜é‡ã€‚</p>
<p><strong>å˜é‡(variable)</strong> å†…å­˜ä¸­ä¸€ä¸ªç‰¹å®šçš„ä½ç½®,ç”¨æ¥ä¸´æ—¶å­˜å‚¨æ•°æ®ã€‚</p>
<blockquote>
<blockquote>
<p>ä»¥ä¸‹æ˜¯ productpricing çš„ä¿®æ”¹ç‰ˆæœ¬(å¦‚æœä¸å…ˆåˆ é™¤æ­¤å­˜å‚¨è¿‡ç¨‹,åˆ™ä¸èƒ½å†æ¬¡åˆ›å»ºå®ƒ):</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; delimiter //</span><br><span class="line">MariaDB [test]&gt; create procedure productpricing(out pl decimal (8,2),out ph decimal(8,2),out pa decimal(8,2)) begin select min(prod_price) into pl from products;select max(prod_price) into ph from products;select avg(prod_price) into pa from products;  end//</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delimiter ;</span><br></pre></td></tr></table></figure>

<p>æ­¤å­˜å‚¨è¿‡ç¨‹æ¥å—3ä¸ªå‚æ•°: pl å­˜å‚¨äº§å“æœ€ä½ä»·æ ¼, ph å­˜å‚¨äº§å“æœ€é«˜ä»·æ ¼, pa å­˜å‚¨äº§å“å¹³å‡ä»·æ ¼ã€‚æ¯ä¸ªå‚æ•°å¿…é¡»å…·æœ‰æŒ‡å®šçš„ç±»å‹,è¿™é‡Œä½¿ç”¨åè¿›åˆ¶å€¼ã€‚å…³é”®å­— OUT æŒ‡å‡ºç›¸åº”çš„å‚æ•°ç”¨æ¥ä»å­˜å‚¨è¿‡ç¨‹ä¼ å‡ºä¸€ä¸ªå€¼(è¿”å›ç»™è°ƒç”¨è€…)ã€‚MySQLæ”¯æŒ IN (ä¼ é€’ç»™å­˜å‚¨è¿‡ç¨‹)ã€ OUT (ä»å­˜å‚¨è¿‡ç¨‹ä¼ å‡º,å¦‚è¿™é‡Œæ‰€ç”¨)å’Œ INOUT (å¯¹å­˜å‚¨è¿‡ç¨‹ä¼ å…¥å’Œä¼ å‡º)ç±»å‹çš„å‚æ•°ã€‚å­˜å‚¨è¿‡ç¨‹çš„ä»£ç ä½äº BEGIN å’Œ END è¯­å¥å†…,å¦‚å‰æ‰€è§,å®ƒä»¬æ˜¯ä¸€ç³»åˆ—SELECT è¯­å¥,ç”¨æ¥æ£€ç´¢å€¼,ç„¶åä¿å­˜åˆ°ç›¸åº”çš„å˜é‡(é€šè¿‡æŒ‡å®š INTO å…³é”®å­—)ã€‚</p>
<p><strong>å‚æ•°çš„æ•°æ®ç±»å‹</strong> å­˜å‚¨è¿‡ç¨‹çš„å‚æ•°å…è®¸çš„æ•°æ®ç±»å‹ä¸è¡¨ä¸­ä½¿ç”¨çš„æ•°æ®ç±»å‹ç›¸åŒã€‚é™„å½•Dåˆ—å‡ºäº†è¿™äº›ç±»å‹ã€‚æ³¨æ„,è®°å½•é›†ä¸æ˜¯å…è®¸çš„ç±»å‹,å› æ­¤,ä¸èƒ½é€šè¿‡ä¸€ä¸ªå‚æ•°è¿”å›å¤šä¸ªè¡Œå’Œåˆ—ã€‚è¿™å°±æ˜¯å‰é¢çš„ä¾‹å­ä¸ºä»€ä¹ˆè¦ä½¿ç”¨3ä¸ªå‚æ•°(å’Œ3æ¡ SELECT è¯­å¥)çš„åŸå› ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸ºè°ƒç”¨æ­¤ä¿®æ”¹è¿‡çš„å­˜å‚¨è¿‡ç¨‹,å¿…é¡»æŒ‡å®š3ä¸ªå˜é‡å,å¦‚ä¸‹æ‰€ç¤º:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; call productpricing(@pricelow,@pricehigh,@priceaverage);</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; call productpricing(@pl,@ph,@pa);</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ç”±äºæ­¤å­˜å‚¨è¿‡ç¨‹è¦æ±‚3ä¸ªå‚æ•°,å› æ­¤å¿…é¡»æ­£å¥½ä¼ é€’3ä¸ªå‚æ•°,ä¸å¤šä¹Ÿä¸å°‘ã€‚æ‰€ä»¥,è¿™æ¡ CALL è¯­å¥ç»™å‡º3ä¸ªå‚æ•°ã€‚å®ƒä»¬æ˜¯å­˜å‚¨è¿‡ç¨‹å°†ä¿å­˜ç»“æœçš„3ä¸ªå˜é‡çš„åå­—ã€‚</p>
<p><strong>å˜é‡å</strong> æ‰€æœ‰MySQLå˜é‡éƒ½å¿…é¡»ä»¥ <code>@</code> å¼€å§‹ã€‚</p>
<p>åœ¨è°ƒç”¨æ—¶,è¿™æ¡è¯­å¥å¹¶ä¸æ˜¾ç¤ºä»»ä½•æ•°æ®ã€‚å®ƒè¿”å›ä»¥åå¯ä»¥æ˜¾ç¤º(æˆ–åœ¨å…¶ä»–å¤„ç†ä¸­ä½¿ç”¨)çš„å˜é‡ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸ºäº†æ˜¾ç¤ºæ£€ç´¢å‡ºçš„äº§å“å¹³å‡ä»·æ ¼,å¯å¦‚ä¸‹è¿›è¡Œ:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select @pl;</span><br><span class="line">+------+</span><br><span class="line">| @pl  |</span><br><span class="line">+------+</span><br><span class="line">| 2.50 |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select @pricelow;</span><br><span class="line">+-----------+</span><br><span class="line">| @pricelow |</span><br><span class="line">+-----------+</span><br><span class="line">|      2.50 |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>ä¸ºäº†è·å¾—3ä¸ªå€¼,å¯ä½¿ç”¨ä»¥ä¸‹è¯­å¥:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select @pl,@ph,@pa;</span><br><span class="line">+------+-------+-------+</span><br><span class="line">| @pl  | @ph   | @pa   |</span><br><span class="line">+------+-------+-------+</span><br><span class="line">| 2.50 | 55.00 | 16.13 |</span><br><span class="line">+------+-------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>ä¸‹é¢æ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­,è¿™æ¬¡ä½¿ç”¨ IN å’Œ OUT å‚æ•°ã€‚ ordertotal æ¥å—è®¢å•å·å¹¶è¿”å›è¯¥è®¢å•çš„åˆè®¡:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; delimiter //</span><br><span class="line">MariaDB [test]&gt; create procedure ordertotal(in onumber int,out ototal decimal(8,2)) begin select sum(item_price*quantity) from orderitems where order_num=onumber into ototal; end//</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delimiter ;</span><br></pre></td></tr></table></figure>

<p><code>onumber</code> å®šä¹‰ä¸º <code>IN</code> ,å› ä¸ºè®¢å•å·è¢«ä¼ å…¥å­˜å‚¨è¿‡ç¨‹ã€‚ <code>ototal</code> å®šä¹‰ä¸º <code>OUT</code> ,å› ä¸ºè¦ä»å­˜å‚¨è¿‡ç¨‹è¿”å›åˆè®¡ã€‚ <code>SELECT</code> è¯­å¥ä½¿ç”¨è¿™ä¸¤ä¸ªå‚æ•°, <code>WHERE</code> å­å¥ä½¿ç”¨ <code>onumber</code> é€‰æ‹©æ­£ç¡®çš„è¡Œ, <code>INTO</code> ä½¿ç”¨ <code>ototal</code> å­˜å‚¨è®¡ç®—å‡ºæ¥çš„åˆè®¡ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸ºè°ƒç”¨è¿™ä¸ªæ–°å­˜å‚¨è¿‡ç¨‹,å¯ä½¿ç”¨ä»¥ä¸‹è¯­å¥:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; call ordertotal(20005,@total);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>å¿…é¡»ç»™ ordertotal ä¼ é€’ä¸¤ä¸ªå‚æ•°;ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè®¢å•å·,ç¬¬äºŒä¸ªå‚æ•°ä¸ºåŒ…å«è®¡ç®—å‡ºæ¥çš„åˆè®¡çš„å˜é‡åã€‚</p>
<blockquote>
<blockquote>
<p>ä¸ºäº†æ˜¾ç¤ºæ­¤åˆè®¡,å¯å¦‚ä¸‹è¿›è¡Œ:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select @total;</span><br><span class="line">+--------+</span><br><span class="line">| @total |</span><br><span class="line">+--------+</span><br><span class="line">| 149.87 |</span><br><span class="line">+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>@total å·²ç”± ordertotal çš„ CALL è¯­å¥å¡«å†™, SELECT æ˜¾ç¤ºå®ƒåŒ…å«çš„å€¼ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸ºäº†å¾—åˆ°å¦ä¸€ä¸ªè®¢å•çš„åˆè®¡æ˜¾ç¤º,éœ€è¦å†æ¬¡è°ƒç”¨å­˜å‚¨è¿‡ç¨‹,ç„¶åé‡æ–°æ˜¾ç¤ºå˜é‡:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; call ordertotal(20009,@total);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select @total;</span><br><span class="line">+--------+</span><br><span class="line">| @total |</span><br><span class="line">+--------+</span><br><span class="line">|  38.47 |</span><br><span class="line">+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><code>into å˜é‡</code>çš„ä½ç½®å¯ä»¥åœ¨<code>from</code>å‰é¢ä¹Ÿå¯ä»¥åœ¨æœ€å</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; delimiter //</span><br><span class="line">MariaDB [test]&gt; create procedure ordertotal0(in onumber int,out xtotal decimal(8,2)) begin select sum(item_price*quantity) into xtotal from orderitems where order_num=onumber ; end//</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delimiter ;</span><br><span class="line">MariaDB [test]&gt; call ordertotal0;</span><br><span class="line">ERROR 1318 (42000): Incorrect number of arguments for PROCEDURE test.ordertotal0; expected 2, got 0</span><br><span class="line">MariaDB [test]&gt; call ordertotal0(20005,@total);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select @total;</span><br><span class="line">+--------+</span><br><span class="line">| @total |</span><br><span class="line">+--------+</span><br><span class="line">| 149.87 |</span><br><span class="line">+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>5.å»ºç«‹æ™ºèƒ½å­˜å‚¨è¿‡ç¨‹</p>
<p>è¿„ä»Šä¸ºæ­¢ä½¿ç”¨çš„æ‰€æœ‰å­˜å‚¨è¿‡ç¨‹åŸºæœ¬ä¸Šéƒ½æ˜¯å°è£…MySQLç®€å•çš„ SELECTè¯­å¥ã€‚è™½ç„¶å®ƒä»¬å…¨éƒ½æ˜¯æœ‰æ•ˆçš„å­˜å‚¨è¿‡ç¨‹ä¾‹å­,ä½†å®ƒä»¬æ‰€èƒ½å®Œæˆçš„å·¥ä½œä½ ç›´æ¥ç”¨è¿™äº›è¢«å°è£…çš„è¯­å¥å°±èƒ½å®Œæˆ(å¦‚æœè¯´å®ƒä»¬è¿˜èƒ½å¸¦æ¥æ›´å¤šçš„ä¸œè¥¿,é‚£å°±æ˜¯ä½¿äº‹æƒ…æ›´å¤æ‚)ã€‚åªæœ‰åœ¨å­˜å‚¨è¿‡ç¨‹å†…åŒ…å«ä¸šåŠ¡è§„åˆ™å’Œæ™ºèƒ½å¤„ç†æ—¶,å®ƒä»¬çš„å¨åŠ›æ‰çœŸæ­£æ˜¾ç°å‡ºæ¥ã€‚</p>
<p>è€ƒè™‘è¿™ä¸ªåœºæ™¯ã€‚ä½ éœ€è¦è·å¾—ä¸ä»¥å‰ä¸€æ ·çš„è®¢å•åˆè®¡,ä½†éœ€è¦å¯¹åˆè®¡å¢åŠ è¥ä¸šç¨,ä¸è¿‡åªé’ˆå¯¹æŸäº›é¡¾å®¢(æˆ–è®¸æ˜¯ä½ æ‰€åœ¨å·ä¸­é‚£äº›é¡¾å®¢)ã€‚é‚£ä¹ˆ,ä½ éœ€è¦åšä¸‹é¢å‡ ä»¶äº‹æƒ…:</p>
<ul>
<li>è·å¾—åˆè®¡(ä¸ä»¥å‰ä¸€æ ·);</li>
<li>æŠŠè¥ä¸šç¨æœ‰æ¡ä»¶åœ°æ·»åŠ åˆ°åˆè®¡;</li>
<li>è¿”å›åˆè®¡(å¸¦æˆ–ä¸å¸¦ç¨)ã€‚</li>
</ul>
<p>å­˜å‚¨è¿‡ç¨‹çš„å®Œæ•´å·¥ä½œå¦‚ä¸‹:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; delimiter //</span><br><span class="line">MariaDB [test]&gt; create procedure ordertotal(</span><br><span class="line">    -&gt; in onumber int,</span><br><span class="line">    -&gt; in taxable boolean,</span><br><span class="line">    -&gt; out ototal decimal(8,2)) comment 'Obtain order total, optionally adding tax'</span><br><span class="line">    -&gt; begin</span><br><span class="line">    -&gt; declare total decimal(8,2);</span><br><span class="line">    -&gt; declare taxrate int default 6;</span><br><span class="line">    -&gt; select sum(item_price*quantity)</span><br><span class="line">    -&gt; from orderitems</span><br><span class="line">    -&gt; where order_num = onumber</span><br><span class="line">    -&gt; into total;</span><br><span class="line">    -&gt; if taxable then</span><br><span class="line">    -&gt; select total+(total/100*taxrate) into total;</span><br><span class="line">    -&gt; end if;</span><br><span class="line">    -&gt; select total into ototal;</span><br><span class="line">    -&gt; end //</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delimiter ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@mastera0 ~]# vi procedure.mysql</span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking &lt; procedure.mysql</span><br><span class="line">[root@mastera0 ~]# cat procedure.mysql</span><br><span class="line">use test;</span><br><span class="line">delimiter //</span><br><span class="line">create procedure ordertotal(</span><br><span class="line">in onumber int,</span><br><span class="line">in taxable boolean,</span><br><span class="line">out ototal decimal(8,2)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">begin</span><br><span class="line">declare total decimal(8,2);</span><br><span class="line">declare taxrate int default 6;</span><br><span class="line"></span><br><span class="line">select sum(item_price*quantity)</span><br><span class="line">from orderitems</span><br><span class="line">where order_num = onumber</span><br><span class="line">into total;</span><br><span class="line"></span><br><span class="line">if taxable then</span><br><span class="line">select total+(total/100*taxrate) into total;</span><br><span class="line">end if;</span><br><span class="line"></span><br><span class="line">select total into ototal;</span><br><span class="line">end //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>

<p>æ­¤å­˜å‚¨è¿‡ç¨‹æœ‰å¾ˆå¤§çš„å˜åŠ¨ã€‚é¦–å…ˆ,å¢åŠ äº†æ³¨é‡Š(å‰é¢æ”¾ç½® <code>--</code>)ã€‚åœ¨å­˜å‚¨è¿‡ç¨‹å¤æ‚æ€§å¢åŠ æ—¶,è¿™æ ·åšç‰¹åˆ«é‡è¦ã€‚æ·»åŠ äº†å¦å¤–ä¸€ä¸ªå‚æ•° <code>taxable</code> ,å®ƒæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼(å¦‚æœè¦å¢åŠ ç¨åˆ™ä¸ºçœŸ,å¦åˆ™ä¸ºå‡)ã€‚åœ¨å­˜å‚¨è¿‡ç¨‹ä½“ä¸­,ç”¨ <code>DECLARE</code>è¯­å¥å®šä¹‰äº†ä¸¤ä¸ªå±€éƒ¨å˜é‡ã€‚ <code>DECLARE</code> è¦æ±‚æŒ‡å®šå˜é‡åå’Œæ•°æ®ç±»å‹,å®ƒä¹Ÿæ”¯æŒå¯é€‰çš„é»˜è®¤å€¼(è¿™ä¸ªä¾‹å­ä¸­çš„ <code>taxrate</code> çš„é»˜è®¤è¢«è®¾ç½®ä¸º 6% )ã€‚ <code>SELECT</code> è¯­å¥å·²ç»æ”¹å˜,å› æ­¤å…¶ç»“æœå­˜å‚¨åˆ° <code>total</code> (å±€éƒ¨å˜é‡)è€Œä¸æ˜¯ <code>ototal</code> ã€‚ <code>IF</code> è¯­å¥æ£€æŸ¥ <code>taxable</code> æ˜¯å¦ä¸ºçœŸ,å¦‚æœä¸ºçœŸ,åˆ™ç”¨å¦ä¸€ <code>SELECT</code>è¯­å¥å¢åŠ è¥ä¸šç¨åˆ°å±€éƒ¨å˜é‡ <code>total</code> ã€‚æœ€å,ç”¨å¦ä¸€ <code>SELECT</code> è¯­å¥å°†<code>total</code> (å®ƒå¢åŠ æˆ–è®¸ä¸å¢åŠ è¥ä¸šç¨)ä¿å­˜åˆ° <code>ototal</code>ã€‚</p>
<p><strong>COMMENT å…³é”®å­—</strong> æœ¬ä¾‹å­ä¸­çš„å­˜å‚¨è¿‡ç¨‹åœ¨ <code>CREATE PROCEDURE</code>è¯­å¥ä¸­åŒ…å«äº†ä¸€ä¸ª <code>COMMENT</code> å€¼ã€‚å®ƒä¸æ˜¯å¿…éœ€çš„,ä½†å¦‚æœç»™å‡º,å°†åœ¨ <code>SHOW PROCEDURE STATUS</code> çš„ç»“æœä¸­æ˜¾ç¤ºã€‚</p>
<p>è¿™æ˜¾ç„¶æ˜¯ä¸€ä¸ªæ›´é«˜çº§,åŠŸèƒ½æ›´å¼ºçš„å­˜å‚¨è¿‡ç¨‹ã€‚ä¸ºè¯•éªŒå®ƒ,è¯·ç”¨ä»¥ä¸‹ä¸¤æ¡è¯­å¥:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; call ordertotal(20005,0,@total);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select @total;</span><br><span class="line">+--------+</span><br><span class="line">| @total |</span><br><span class="line">+--------+</span><br><span class="line">| 149.87 |</span><br><span class="line">+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>BOOLEAN å€¼æŒ‡å®šä¸º 1 è¡¨ç¤ºçœŸ,æŒ‡å®šä¸º 0 è¡¨ç¤ºå‡(å®é™…ä¸Š,éé›¶å€¼éƒ½è€ƒè™‘ä¸ºçœŸ,åªæœ‰ 0 è¢«è§†ä¸ºå‡)ã€‚é€šè¿‡ç»™ä¸­é—´çš„å‚æ•°æŒ‡å®š 0 æˆ– 1 ,å¯ä»¥æœ‰æ¡ä»¶åœ°å°†è¥ä¸šç¨åŠ åˆ°è®¢å•åˆè®¡ä¸Šã€‚</p>
<p><strong>IF è¯­å¥</strong> è¿™ä¸ªä¾‹å­ç»™å‡ºäº†MySQLçš„ IF è¯­å¥çš„åŸºæœ¬ç”¨æ³•ã€‚ IF è¯­å¥è¿˜æ”¯æŒ ELSEIF å’Œ ELSE å­å¥(å‰è€…è¿˜ä½¿ç”¨ THEN å­å¥,åè€…ä¸ä½¿ç”¨)ã€‚åœ¨ä»¥åç« èŠ‚ä¸­æˆ‘ä»¬å°†ä¼šçœ‹åˆ° IF çš„å…¶ä»–ç”¨æ³•(ä»¥åŠå…¶ä»–æµæ§åˆ¶è¯­å¥)ã€‚</p>
<p>6.æ£€æŸ¥å­˜å‚¨è¿‡ç¨‹</p>
<blockquote>
<blockquote>
<p>ä¸ºæ˜¾ç¤ºç”¨æ¥åˆ›å»ºä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹çš„ CREATE è¯­å¥,ä½¿ç”¨ SHOW CREATE PROCEDURE è¯­å¥:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; show create procedure ordertotal\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           Procedure: ordertotal</span><br><span class="line">            sql_mode:</span><br><span class="line">    Create Procedure: CREATE DEFINER=`root`@`localhost` PROCEDURE `ordertotal`(</span><br><span class="line">in onumber int,</span><br><span class="line">in taxable boolean,</span><br><span class="line">out ototal decimal(8,2))</span><br><span class="line">    COMMENT 'Obtain order total, optionally adding tax'</span><br><span class="line">begin</span><br><span class="line">declare total decimal(8,2);</span><br><span class="line">declare taxrate int default 6;</span><br><span class="line">select sum(item_price*quantity)</span><br><span class="line">from orderitems</span><br><span class="line">where order_num = onumber</span><br><span class="line">into total;</span><br><span class="line">if taxable then</span><br><span class="line">select total+(total/100*taxrate) into total;</span><br><span class="line">end if;</span><br><span class="line">select total into ototal;</span><br><span class="line">end</span><br><span class="line">character_set_client: utf8</span><br><span class="line">collation_connection: utf8_general_ci</span><br><span class="line">  Database Collation: latin1_swedish_ci</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†è·å¾—åŒ…æ‹¬ä½•æ—¶ã€ç”±è°åˆ›å»ºç­‰è¯¦ç»†ä¿¡æ¯çš„å­˜å‚¨è¿‡ç¨‹åˆ—è¡¨,ä½¿ç”¨ <code>SHOWPROCEDURE STATUS</code> ã€‚</p>
<p><strong>é™åˆ¶è¿‡ç¨‹çŠ¶æ€ç»“æœ</strong> <code>SHOW PROCEDURE STATUS</code>åˆ—å‡ºæ‰€æœ‰å­˜å‚¨è¿‡ç¨‹ã€‚ä¸ºé™åˆ¶å…¶è¾“å‡º,å¯ä½¿ç”¨ <code>LIKE</code> æŒ‡å®šä¸€ä¸ªè¿‡æ»¤æ¨¡å¼,ä¾‹å¦‚:<code>show procedure status like &#39;ordertotal&#39;;</code></p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« ä»‹ç»äº†ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ä»¥åŠä¸ºä»€ä¹ˆè¦ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ã€‚æˆ‘ä»¬ä»‹ç»äº†å­˜å‚¨è¿‡ç¨‹çš„æ‰§è¡Œå’Œåˆ›å»ºçš„è¯­æ³•ä»¥åŠä½¿ç”¨å­˜å‚¨è¿‡ç¨‹çš„ä¸€äº›æ–¹æ³•ã€‚ä¸‹ä¸€ç« æˆ‘ä»¬å°†ç»§ç»­è¿™ä¸ªè¯é¢˜ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h3 id="ä½¿ç”¨æ¸¸æ ‡"><a href="#ä½¿ç”¨æ¸¸æ ‡" class="headerlink" title="ä½¿ç”¨æ¸¸æ ‡"></a>ä½¿ç”¨æ¸¸æ ‡</h3><p>æœ¬ç« å°†è®²æˆä»€ä¹ˆæ˜¯æ¸¸æ ‡ä»¥åŠå¦‚ä½•ä½¿ç”¨æ¸¸æ ‡ã€‚</p>
<blockquote>
<p>æ¸¸æ ‡</p>
</blockquote>
<p><strong>éœ€è¦MySQL 5</strong> MySQL 5æ·»åŠ äº†å¯¹æ¸¸æ ‡çš„æ”¯æŒ,å› æ­¤,æœ¬ç« å†…å®¹é€‚ç”¨äºMySQL 5åŠä»¥åçš„ç‰ˆæœ¬ã€‚</p>
<p>ç”±å‰å‡ ç« å¯çŸ¥,MySQLæ£€ç´¢æ“ä½œè¿”å›ä¸€ç»„ç§°ä¸ºç»“æœé›†çš„è¡Œã€‚è¿™ç»„è¿”å›çš„è¡Œéƒ½æ˜¯ä¸SQLè¯­å¥ç›¸åŒ¹é…çš„è¡Œ(é›¶è¡Œæˆ–å¤šè¡Œ)ã€‚ä½¿ç”¨ç®€å•çš„ SELECT è¯­å¥,ä¾‹å¦‚,æ²¡æœ‰åŠæ³•å¾—åˆ°ç¬¬ä¸€è¡Œã€ä¸‹ä¸€è¡Œæˆ–å‰10è¡Œ,ä¹Ÿä¸å­˜åœ¨æ¯æ¬¡ä¸€è¡Œåœ°å¤„ç†æ‰€æœ‰è¡Œçš„ç®€å•æ–¹æ³•(ç›¸å¯¹äºæˆæ‰¹åœ°å¤„ç†å®ƒä»¬)ã€‚</p>
<p>æœ‰æ—¶,éœ€è¦åœ¨æ£€ç´¢å‡ºæ¥çš„è¡Œä¸­å‰è¿›æˆ–åé€€ä¸€è¡Œæˆ–å¤šè¡Œã€‚è¿™å°±æ˜¯ä½¿ç”¨æ¸¸æ ‡çš„åŸå› ã€‚æ¸¸æ ‡(cursor)æ˜¯ä¸€ä¸ªå­˜å‚¨åœ¨MySQLæœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“æŸ¥è¯¢,å®ƒä¸æ˜¯ä¸€æ¡ SELECT è¯­å¥,è€Œæ˜¯è¢«è¯¥è¯­å¥æ£€ç´¢å‡ºæ¥çš„ç»“æœé›†ã€‚åœ¨å­˜å‚¨äº†æ¸¸æ ‡ä¹‹å,åº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®éœ€è¦æ»šåŠ¨æˆ–æµè§ˆå…¶ä¸­çš„æ•°æ®ã€‚</p>
<p>æ¸¸æ ‡ä¸»è¦ç”¨äºäº¤äº’å¼åº”ç”¨,å…¶ä¸­ç”¨æˆ·éœ€è¦æ»šåŠ¨å±å¹•ä¸Šçš„æ•°æ®,å¹¶å¯¹æ•°æ®è¿›è¡Œæµè§ˆæˆ–åšå‡ºæ›´æ”¹ã€‚</p>
<p><strong>åªèƒ½ç”¨äºå­˜å‚¨è¿‡ç¨‹</strong> ä¸åƒå¤šæ•°DBMS,MySQLæ¸¸æ ‡åªèƒ½ç”¨äºå­˜å‚¨è¿‡ç¨‹(å’Œå‡½æ•°)ã€‚</p>
<blockquote>
<p>ä½¿ç”¨æ¸¸æ ‡</p>
</blockquote>
<p>ä½¿ç”¨æ¸¸æ ‡æ¶‰åŠå‡ ä¸ªæ˜ç¡®çš„æ­¥éª¤ã€‚</p>
<ul>
<li>åœ¨èƒ½å¤Ÿä½¿ç”¨æ¸¸æ ‡å‰,å¿…é¡»å£°æ˜(å®šä¹‰)å®ƒã€‚è¿™ä¸ªè¿‡ç¨‹å®é™…ä¸Šæ²¡æœ‰æ£€ç´¢æ•°æ®,å®ƒåªæ˜¯å®šä¹‰è¦ä½¿ç”¨çš„ SELECT è¯­å¥ã€‚</li>
<li>ä¸€æ—¦å£°æ˜å,å¿…é¡»æ‰“å¼€æ¸¸æ ‡ä»¥ä¾›ä½¿ç”¨ã€‚è¿™ä¸ªè¿‡ç¨‹ç”¨å‰é¢å®šä¹‰çš„SELECT è¯­å¥æŠŠæ•°æ®å®é™…æ£€ç´¢å‡ºæ¥ã€‚</li>
<li>å¯¹äºå¡«æœ‰æ•°æ®çš„æ¸¸æ ‡,æ ¹æ®éœ€è¦å–å‡º(æ£€ç´¢)å„è¡Œã€‚</li>
<li>åœ¨ç»“æŸæ¸¸æ ‡ä½¿ç”¨æ—¶,å¿…é¡»å…³é—­æ¸¸æ ‡ã€‚</li>
</ul>
<p>åœ¨å£°æ˜æ¸¸æ ‡å,å¯æ ¹æ®éœ€è¦é¢‘ç¹åœ°æ‰“å¼€å’Œå…³é—­æ¸¸æ ‡ã€‚åœ¨æ¸¸æ ‡æ‰“å¼€å,å¯æ ¹æ®éœ€è¦é¢‘ç¹åœ°æ‰§è¡Œå–æ“ä½œã€‚</p>
<p>1.åˆ›å»ºæ¸¸æ ‡</p>
<p>æ¸¸æ ‡ç”¨ DECLARE è¯­å¥åˆ›å»ºã€‚ DECLARE å‘½åæ¸¸æ ‡,å¹¶å®šä¹‰ç›¸åº”çš„ SELECT è¯­å¥,æ ¹æ®éœ€è¦å¸¦ WHERE å’Œå…¶ä»–å­å¥ã€‚</p>
<blockquote>
<blockquote>
<p>å®šä¹‰åä¸º ordernumbers çš„æ¸¸æ ‡,ä½¿ç”¨äº†å¯ä»¥æ£€ç´¢æ‰€æœ‰è®¢å•çš„ SELECT è¯­å¥ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; delimiter //</span><br><span class="line">MariaDB [test]&gt; create procedure processorders()</span><br><span class="line">    -&gt; begin</span><br><span class="line">    -&gt; declare ordernumbers cursor</span><br><span class="line">    -&gt; for</span><br><span class="line">    -&gt; select order_num from orders;</span><br><span class="line">    -&gt; end //</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delimiter ;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹å¹¶æ²¡æœ‰åšå¾ˆå¤šäº‹æƒ…, <code>DECLARE</code> è¯­å¥ç”¨æ¥å®šä¹‰å’Œå‘½åæ¸¸æ ‡,è¿™é‡Œä¸º <code>ordernumbers</code> ã€‚ å­˜å‚¨è¿‡ç¨‹å¤„ç†å®Œæˆå,æ¸¸æ ‡å°±æ¶ˆå¤±(å› ä¸ºå®ƒå±€é™äºå­˜å‚¨è¿‡ç¨‹)ã€‚</p>
<p>åœ¨å®šä¹‰æ¸¸æ ‡ä¹‹å,å¯ä»¥æ‰“å¼€å®ƒã€‚</p>
<p>2.æ‰“å¼€å’Œå…³é—­æ¸¸æ ‡</p>
<blockquote>
<blockquote>
<p>æ¸¸æ ‡ç”¨ OPEN CURSOR è¯­å¥æ¥æ‰“å¼€:<code>open ordernumbers;</code></p>
</blockquote>
</blockquote>
<p>åœ¨å¤„ç† OPEN è¯­å¥æ—¶æ‰§è¡ŒæŸ¥è¯¢,å­˜å‚¨æ£€ç´¢å‡ºçš„æ•°æ®ä»¥ä¾›æµè§ˆå’Œæ»šåŠ¨ã€‚</p>
<blockquote>
<blockquote>
<p>æ¸¸æ ‡å¤„ç†å®Œæˆå,åº”å½“ä½¿ç”¨å¦‚ä¸‹è¯­å¥å…³é—­æ¸¸æ ‡:<code>close ordernumbers;</code></p>
</blockquote>
</blockquote>
<p>CLOSE é‡Šæ”¾æ¸¸æ ‡ä½¿ç”¨çš„æ‰€æœ‰å†…éƒ¨å†…å­˜å’Œèµ„æº,å› æ­¤åœ¨æ¯ä¸ªæ¸¸æ ‡ä¸å†éœ€è¦æ—¶éƒ½åº”è¯¥å…³é—­ã€‚</p>
<p>åœ¨ä¸€ä¸ªæ¸¸æ ‡å…³é—­å,å¦‚æœæ²¡æœ‰é‡æ–°æ‰“å¼€,åˆ™ä¸èƒ½ä½¿ç”¨å®ƒã€‚ä½†æ˜¯,ä½¿ç”¨å£°æ˜è¿‡çš„æ¸¸æ ‡ä¸éœ€è¦å†æ¬¡å£°æ˜,ç”¨ OPEN è¯­å¥æ‰“å¼€å®ƒå°±å¯ä»¥äº†ã€‚</p>
<p><strong>éšå«å…³é—­</strong> å¦‚æœä½ ä¸æ˜ç¡®å…³é—­æ¸¸æ ‡, MySQLå°†ä¼šåœ¨åˆ°è¾¾ END è¯­å¥æ—¶è‡ªåŠ¨å…³é—­å®ƒã€‚</p>
<p>ä¸‹é¢æ˜¯å‰é¢ä¾‹å­çš„ä¿®æ”¹ç‰ˆæœ¬:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; delimiter //</span><br><span class="line">MariaDB [test]&gt; create procedure processorders()</span><br><span class="line">    -&gt; begin</span><br><span class="line">    -&gt; declare ordernumbers cursor</span><br><span class="line">    -&gt; for</span><br><span class="line">    -&gt; select order_num from orders;</span><br><span class="line">    -&gt; open ordernumbers;</span><br><span class="line">    -&gt; close ordernumbers;</span><br><span class="line">    -&gt; end //</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delimiter ;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹å£°æ˜ã€æ‰“å¼€å’Œå…³é—­ä¸€ä¸ªæ¸¸æ ‡ã€‚ä½†å¯¹æ£€ç´¢å‡ºçš„æ•°æ®ä»€ä¹ˆä¹Ÿæ²¡åšã€‚</p>
<p>3.ä½¿ç”¨æ¸¸æ ‡æ•°æ®</p>
<p>åœ¨ä¸€ä¸ªæ¸¸æ ‡è¢«æ‰“å¼€å,å¯ä»¥ä½¿ç”¨ FETCH è¯­å¥åˆ†åˆ«è®¿é—®å®ƒçš„æ¯ä¸€è¡Œã€‚FETCH æŒ‡å®šæ£€ç´¢ä»€ä¹ˆæ•°æ®(æ‰€éœ€çš„åˆ—),æ£€ç´¢å‡ºæ¥çš„æ•°æ®å­˜å‚¨åœ¨ä»€ä¹ˆåœ°æ–¹ã€‚å®ƒè¿˜å‘å‰ç§»åŠ¨æ¸¸æ ‡ä¸­çš„å†…éƒ¨è¡ŒæŒ‡é’ˆ,ä½¿ä¸‹ä¸€æ¡ FETCH è¯­å¥æ£€ç´¢ä¸‹ä¸€è¡Œ(ä¸é‡å¤è¯»å–åŒä¸€è¡Œ)ã€‚</p>
<blockquote>
<blockquote>
<p>ç¬¬ä¸€ä¸ªä¾‹å­ä»æ¸¸æ ‡ä¸­æ£€ç´¢å•ä¸ªè¡Œ(ç¬¬ä¸€è¡Œ):</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; delimiter //</span><br><span class="line">MariaDB [test]&gt; create procedure processorders() begin declare o int;declare ordernumbers cursor for select order_num from orders;</span><br><span class="line">    -&gt; open ordernumbers;</span><br><span class="line">    -&gt; fetch ordernumbers into o;</span><br><span class="line">    -&gt; close ordernumbers;</span><br><span class="line">    -&gt; end //</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delimiter ;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>FETCH</code>ç”¨æ¥æ£€ç´¢å½“å‰è¡Œçš„ <code>order_num</code> åˆ—(å°†è‡ªåŠ¨ä»ç¬¬ä¸€è¡Œå¼€å§‹)åˆ°ä¸€ä¸ªåä¸º <code>o</code> çš„å±€éƒ¨å£°æ˜çš„å˜é‡ä¸­ã€‚å¯¹æ£€ç´¢å‡ºçš„æ•°æ®ä¸åšä»»ä½•å¤„ç†ã€‚</p>
<blockquote>
<blockquote>
<p>åœ¨ä¸‹ä¸€ä¸ªä¾‹å­ä¸­,å¾ªç¯æ£€ç´¢æ•°æ®,ä»ç¬¬ä¸€è¡Œåˆ°æœ€åä¸€è¡Œ:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; delimiter //</span><br><span class="line">MariaDB [test]&gt; create procedure processorders() begin declare done boolean default 0;declare o int;declare ordernumbers cursor for select order_num from orders;declare continue handler for sqlstate '02000' set done=1; open ordernumbers;repeat fetch ordernumbers into o;until done end repeat; close ordernumbers; end//</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delimiter ;</span><br></pre></td></tr></table></figure>

<p>ä¸å‰ä¸€ä¸ªä¾‹å­ä¸€æ ·,è¿™ä¸ªä¾‹å­ä½¿ç”¨ <code>FETCH</code>æ£€ç´¢å½“å‰ <code>order_num</code>åˆ°å£°æ˜çš„åä¸º <code>o</code> çš„å˜é‡ä¸­ã€‚ä½†ä¸å‰ä¸€ä¸ªä¾‹å­ä¸ä¸€æ ·çš„æ˜¯,è¿™ä¸ªä¾‹å­ä¸­çš„ <code>FETCH</code> æ˜¯åœ¨ <code>REPEAT</code> å†…,å› æ­¤å®ƒåå¤æ‰§è¡Œç›´åˆ° <code>done</code> ä¸ºçœŸ(ç”± <code>UNTIL done END REPEAT;</code> è§„å®š)ã€‚</p>
<p>ä¸ºä½¿å®ƒèµ·ä½œç”¨,ç”¨ä¸€ä¸ª <code>DEFAULT 0</code>(å‡,ä¸ç»“æŸ)å®šä¹‰å˜é‡ <code>done</code> ã€‚é‚£ä¹ˆ, <code>done</code> æ€æ ·æ‰èƒ½åœ¨ç»“æŸæ—¶è¢«è®¾ç½®ä¸ºçœŸå‘¢?</p>
<p>ç­”æ¡ˆæ˜¯ç”¨ä»¥ä¸‹è¯­å¥:<code>declare conitinue handler for sqlstate &#39;02000&#39; set done=1</code>è¿™æ¡è¯­å¥å®šä¹‰äº†ä¸€ä¸ª C<code>ONTINUE HANDLER</code> ,å®ƒæ˜¯åœ¨æ¡ä»¶å‡ºç°æ—¶è¢«æ‰§è¡Œçš„ä»£ç ã€‚è¿™é‡Œ,å®ƒæŒ‡å‡ºå½“ <code>SQLSTATE &#39;02000&#39;</code> å‡ºç°æ—¶, <code>SET done=1</code>ã€‚<code>SQLSTATE &#39;02000&#39;</code> æ˜¯ä¸€ä¸ªæœªæ‰¾åˆ°æ¡ä»¶,å½“ <code>REPEAT</code> ç”±äºæ²¡æœ‰æ›´å¤šçš„è¡Œä¾›å¾ªç¯è€Œä¸èƒ½ç»§ç»­æ—¶,å‡ºç°è¿™ä¸ªæ¡ä»¶ã€‚</p>
<p><strong>MySQLçš„é”™è¯¯ä»£ç </strong> å…³äºMySQL 5ä½¿ç”¨çš„MySQLé”™è¯¯ä»£ç åˆ—è¡¨,è¯·å‚é˜…<a href="http://dev.mysql.com/doc/mysql/en/error-handling.htmlã€‚" target="_blank" rel="noopener">http://dev.mysql.com/doc/mysql/en/error-handling.htmlã€‚</a></p>
<p><strong>DECLARE è¯­å¥çš„æ¬¡åº</strong> DECLARE è¯­å¥çš„å‘å¸ƒå­˜åœ¨ç‰¹å®šçš„æ¬¡åºã€‚ç”¨ DECLARE è¯­å¥å®šä¹‰çš„å±€éƒ¨å˜é‡å¿…é¡»åœ¨å®šä¹‰ä»»æ„æ¸¸æ ‡æˆ–å¥æŸ„ä¹‹å‰å®šä¹‰,è€Œå¥æŸ„å¿…é¡»åœ¨æ¸¸æ ‡ä¹‹åå®šä¹‰ã€‚ä¸éµå®ˆæ­¤é¡ºåºå°†äº§ç”Ÿé”™è¯¯æ¶ˆæ¯ã€‚</p>
<p>å¦‚æœè°ƒç”¨è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹,å®ƒå°†å®šä¹‰å‡ ä¸ªå˜é‡å’Œä¸€ä¸ª <code>CONTINUE HANDLER</code> ,å®šä¹‰å¹¶æ‰“å¼€ä¸€ä¸ªæ¸¸æ ‡,é‡å¤è¯»å–æ‰€æœ‰è¡Œ,ç„¶åå…³é—­æ¸¸æ ‡ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸,ä½ å¯ä»¥åœ¨å¾ªç¯å†…æ”¾å…¥ä»»æ„éœ€è¦çš„å¤„ç†(åœ¨ FETCH è¯­å¥ä¹‹å,å¾ªç¯ç»“æŸä¹‹å‰)ã€‚</p>
<p><strong>é‡å¤æˆ–å¾ªç¯?</strong> é™¤è¿™é‡Œä½¿ç”¨çš„<code>REPEAT</code> è¯­å¥å¤–,MySQLè¿˜æ”¯æŒå¾ªç¯è¯­å¥,å®ƒå¯ç”¨æ¥é‡å¤æ‰§è¡Œä»£ç ,ç›´åˆ°ä½¿ç”¨ <code>LEAVE</code> è¯­å¥æ‰‹åŠ¨é€€å‡ºä¸ºæ­¢ã€‚é€šå¸¸ <code>REPEAT</code> è¯­å¥çš„è¯­æ³•ä½¿å®ƒæ›´é€‚åˆäºå¯¹æ¸¸æ ‡è¿›è¡Œå¾ªç¯ã€‚</p>
<p>ä¸ºäº†æŠŠè¿™äº›å†…å®¹ç»„ç»‡èµ·æ¥,ä¸‹é¢ç»™å‡ºæˆ‘ä»¬çš„æ¸¸æ ‡å­˜å‚¨è¿‡ç¨‹æ ·ä¾‹çš„æ›´è¿›ä¸€æ­¥ä¿®æ”¹çš„ç‰ˆæœ¬,è¿™æ¬¡å¯¹å–å‡ºçš„æ•°æ®è¿›è¡ŒæŸç§å®é™…çš„å¤„ç†:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; delimiter //</span><br><span class="line">MariaDB [test]&gt; create procedure processorders() begin declare done boolean default 0;declare o int;declare t decimal(8,2);declare ordernumbers cursor for select order_num from orders;declare continue handler for sqlstate '02000' set done=1; create table if not exists ordertotals (order_num int,total decimal(8,2)); open ordernumbers;repeat fetch ordernumbers into o;call ordertotal(o,1,t);insert into ordertotals(order_num,total) values (o,t);until done end repeat; close ordernumbers; end//</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delimiter ;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­,æˆ‘ä»¬å¢åŠ äº†å¦ä¸€ä¸ªåä¸º <code>t</code> çš„å˜é‡(å­˜å‚¨æ¯ä¸ªè®¢å•çš„åˆè®¡)ã€‚æ­¤å­˜å‚¨è¿‡ç¨‹è¿˜åœ¨è¿è¡Œä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°è¡¨(å¦‚æœå®ƒä¸å­˜åœ¨çš„è¯),åä¸º <code>ordertotals</code> ã€‚è¿™ä¸ªè¡¨å°†ä¿å­˜å­˜å‚¨è¿‡ç¨‹ç”Ÿæˆçš„ç»“æœã€‚ <code>FETCH</code>åƒä»¥å‰ä¸€æ ·å–æ¯ä¸ª <code>order_num</code> ,ç„¶åç”¨ <code>CALL</code>æ‰§è¡Œå¦ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹(æˆ‘ä»¬åœ¨å‰ä¸€ç« ä¸­åˆ›å»º)æ¥è®¡ç®—æ¯ä¸ªè®¢å•çš„å¸¦ç¨çš„åˆè®¡(ç»“æœå­˜å‚¨åˆ° <code>t</code> )ã€‚æœ€å,ç”¨ <code>INSERT</code> ä¿å­˜æ¯ä¸ªè®¢å•çš„è®¢å•å·å’Œåˆè®¡ã€‚</p>
<p>æ­¤å­˜å‚¨è¿‡ç¨‹ä¸è¿”å›æ•°æ®,ä½†å®ƒèƒ½å¤Ÿåˆ›å»ºå’Œå¡«å……å¦ä¸€ä¸ªè¡¨,å¯ä»¥ç”¨ä¸€æ¡ç®€å•çš„ SELECT è¯­å¥æŸ¥çœ‹è¯¥è¡¨:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; call processorders();</span><br><span class="line">Query OK, 1 row affected (0.48 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from ordertotals;</span><br><span class="line">+-----------+---------+</span><br><span class="line">| order_num | total   |</span><br><span class="line">+-----------+---------+</span><br><span class="line">|     20005 |  158.86 |</span><br><span class="line">|     20009 |   40.78 |</span><br><span class="line">|     20006 |   58.30 |</span><br><span class="line">|     20007 | 1060.00 |</span><br><span class="line">|     20008 |  132.50 |</span><br><span class="line">|     20008 |  132.50 |</span><br><span class="line">+-----------+---------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·,æˆ‘ä»¬å°±å¾—åˆ°äº†å­˜å‚¨è¿‡ç¨‹ã€æ¸¸æ ‡ã€é€è¡Œå¤„ç†ä»¥åŠå­˜å‚¨è¿‡ç¨‹è°ƒç”¨å…¶ä»–å­˜å‚¨è¿‡ç¨‹çš„ä¸€ä¸ªå®Œæ•´çš„å·¥ä½œæ ·ä¾‹ã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« ä»‹ç»äº†ä»€ä¹ˆæ˜¯æ¸¸æ ‡ä»¥åŠä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¸¸æ ‡,ä¸¾äº†æ¼”ç¤ºåŸºæœ¬æ¸¸æ ‡ä½¿ç”¨çš„ä¾‹å­,å¹¶ä¸”è®²è§£äº†å¯¹æ¸¸æ ‡ç»“æœè¿›è¡Œå¾ªç¯ä»¥åŠé€è¡Œå¤„ç†çš„æŠ€æœ¯ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h3 id="ä½¿ç”¨è§¦å‘å™¨"><a href="#ä½¿ç”¨è§¦å‘å™¨" class="headerlink" title="ä½¿ç”¨è§¦å‘å™¨"></a>ä½¿ç”¨è§¦å‘å™¨</h3><p>æœ¬ç« å­¦ä¹ ä»€ä¹ˆæ˜¯è§¦å‘å™¨,ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è§¦å‘å™¨ä»¥åŠå¦‚ä½•ä½¿ç”¨è§¦å‘å™¨ã€‚</p>
<p>æœ¬ç« è¿˜ä»‹ç»åˆ›å»ºå’Œä½¿ç”¨è§¦å‘å™¨çš„è¯­æ³•ã€‚</p>
<blockquote>
<p>è§¦å‘å™¨</p>
</blockquote>
<p><strong>éœ€è¦MySQL 5</strong> å¯¹è§¦å‘å™¨çš„æ”¯æŒæ˜¯åœ¨MySQL 5ä¸­å¢åŠ çš„ã€‚å› æ­¤,æœ¬ç« å†…å®¹é€‚ç”¨äºMySQL 5æˆ–ä¹‹åçš„ç‰ˆæœ¬ã€‚</p>
<p>MySQLè¯­å¥åœ¨éœ€è¦æ—¶è¢«æ‰§è¡Œ,å­˜å‚¨è¿‡ç¨‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä½†æ˜¯,å¦‚æœä½ æƒ³è¦æŸæ¡è¯­å¥(æˆ–æŸäº›è¯­å¥)åœ¨äº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨æ‰§è¡Œ,æ€ä¹ˆåŠå‘¢?ä¾‹å¦‚:</p>
<ul>
<li>æ¯å½“å¢åŠ ä¸€ä¸ªé¡¾å®¢åˆ°æŸä¸ªæ•°æ®åº“è¡¨æ—¶,éƒ½æ£€æŸ¥å…¶ç”µè¯å·ç æ ¼å¼æ˜¯å¦æ­£ç¡®,å·çš„ç¼©å†™æ˜¯å¦ä¸ºå¤§å†™;</li>
<li>æ¯å½“è®¢è´­ä¸€ä¸ªäº§å“æ—¶,éƒ½ä»åº“å­˜æ•°é‡ä¸­å‡å»è®¢è´­çš„æ•°é‡;</li>
<li>æ— è®ºä½•æ—¶åˆ é™¤ä¸€è¡Œ,éƒ½åœ¨æŸä¸ªå­˜æ¡£è¡¨ä¸­ä¿ç•™ä¸€ä¸ªå‰¯æœ¬ã€‚</li>
</ul>
<p>æ‰€æœ‰è¿™äº›ä¾‹å­çš„å…±åŒä¹‹å¤„æ˜¯å®ƒä»¬éƒ½éœ€è¦åœ¨æŸä¸ªè¡¨å‘ç”Ÿæ›´æ”¹æ—¶è‡ªåŠ¨å¤„ç†ã€‚è¿™ç¡®åˆ‡åœ°è¯´å°±æ˜¯è§¦å‘å™¨ã€‚è§¦å‘å™¨æ˜¯MySQLå“åº”ä»¥ä¸‹ä»»æ„è¯­å¥è€Œè‡ªåŠ¨æ‰§è¡Œçš„ä¸€æ¡MySQLè¯­å¥(æˆ–ä½äº BEGIN å’Œ END è¯­å¥ä¹‹é—´çš„ä¸€ç»„è¯­å¥):</p>
<ul>
<li>DELETE ;</li>
<li>INSERT ;</li>
<li>UPDATE ã€‚</li>
</ul>
<p>å…¶ä»–MySQLè¯­å¥ä¸æ”¯æŒè§¦å‘å™¨ã€‚</p>
<blockquote>
<p>åˆ›å»ºè§¦å‘å™¨</p>
</blockquote>
<p>åœ¨åˆ›å»ºè§¦å‘å™¨æ—¶,éœ€è¦ç»™å‡º4æ¡ä¿¡æ¯:</p>
<ul>
<li>å”¯ä¸€çš„è§¦å‘å™¨å;</li>
<li>è§¦å‘å™¨å…³è”çš„è¡¨;</li>
<li>è§¦å‘å™¨åº”è¯¥å“åº”çš„æ´»åŠ¨( DELETE ã€ INSERT æˆ– UPDATE );</li>
<li>è§¦å‘å™¨ä½•æ—¶æ‰§è¡Œ(å¤„ç†ä¹‹å‰æˆ–ä¹‹å)ã€‚</li>
</ul>
<p><strong>ä¿æŒæ¯ä¸ªæ•°æ®åº“çš„è§¦å‘å™¨åå”¯ä¸€</strong> åœ¨MySQL 5ä¸­,è§¦å‘å™¨åå¿…é¡»åœ¨æ¯ä¸ªè¡¨ä¸­å”¯ä¸€,ä½†ä¸æ˜¯åœ¨æ¯ä¸ªæ•°æ®åº“ä¸­å”¯ä¸€ã€‚è¿™è¡¨ç¤ºåŒä¸€æ•°æ®åº“ä¸­çš„ä¸¤ä¸ªè¡¨å¯å…·æœ‰ç›¸åŒåå­—çš„è§¦å‘å™¨ã€‚è¿™åœ¨å…¶ä»–æ¯ä¸ªæ•°æ®åº“è§¦å‘å™¨åå¿…é¡»å”¯ä¸€çš„DBMSä¸­æ˜¯ä¸å…è®¸çš„,è€Œä¸”ä»¥åçš„MySQLç‰ˆæœ¬å¾ˆå¯èƒ½ä¼šä½¿å‘½åè§„åˆ™æ›´ä¸ºä¸¥æ ¼ã€‚å› æ­¤,ç°åœ¨æœ€å¥½æ˜¯åœ¨æ•°æ®åº“èŒƒå›´å†…ä½¿ç”¨å”¯ä¸€çš„è§¦å‘å™¨åã€‚</p>
<p>è§¦å‘å™¨ç”¨ CREATE TRIGGER è¯­å¥åˆ›å»ºã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p>
<blockquote>
<blockquote>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create trigger triggervendors after insert on vendors for each row select 'hello' into @args;</span><br><span class="line">Query OK, 0 rows affected (0.35 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; insert into vendors values (2007,'xx',null,null,null,null,null);</span><br><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select @args;</span><br><span class="line">+-------+</span><br><span class="line">| @args |</span><br><span class="line">+-------+</span><br><span class="line">| hello |</span><br><span class="line">+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><code>CREATE TRIGGER</code> ç”¨æ¥åˆ›å»ºåä¸º <code>triggervendors</code>çš„æ–°è§¦å‘å™¨ã€‚è§¦å‘å™¨å¯åœ¨ä¸€ä¸ªæ“ä½œå‘ç”Ÿä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œ,è¿™é‡Œç»™å‡ºäº† <code>AFTER INSERT</code> ,æ‰€ä»¥æ­¤è§¦å‘å™¨å°†åœ¨ <code>INSERT</code> è¯­å¥æˆåŠŸæ‰§è¡Œåæ‰§è¡Œã€‚è¿™ä¸ªè§¦å‘å™¨è¿˜æŒ‡å®š<code>FOR EACH ROW</code> ,å› æ­¤ä»£ç å¯¹æ¯ä¸ªæ’å…¥è¡Œæ‰§è¡Œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­,æ–‡æœ¬ <code>hello å°†å¯¹æ¯ä¸ªæ’å…¥çš„è¡Œæ˜¾ç¤ºä¸€æ¬¡ã€‚ä¸ºäº†æµ‹è¯•è¿™ä¸ªè§¦å‘å™¨,ä½¿ç”¨</code>INSERT<code>è¯­å¥æ·»åŠ ä¸€è¡Œæˆ–å¤šè¡Œåˆ°</code>vendors<code>ä¸­,ä½ å°†çœ‹åˆ°å¯¹æ¯ä¸ªæˆåŠŸçš„æ’å…¥,æ˜¾ç¤º</code>hello` æ¶ˆæ¯ã€‚</p>
<p><strong>ä»…æ”¯æŒè¡¨</strong> åªæœ‰è¡¨æ‰æ”¯æŒè§¦å‘å™¨,è§†å›¾ä¸æ”¯æŒ(ä¸´æ—¶è¡¨ä¹Ÿä¸æ”¯æŒ)ã€‚</p>
<p>è§¦å‘å™¨æŒ‰æ¯ä¸ªè¡¨æ¯ä¸ªäº‹ä»¶æ¯æ¬¡åœ°å®šä¹‰,æ¯ä¸ªè¡¨æ¯ä¸ªäº‹ä»¶æ¯æ¬¡åªå…è®¸ä¸€ä¸ªè§¦å‘å™¨ã€‚å› æ­¤,æ¯ä¸ªè¡¨æœ€å¤šæ”¯æŒ6ä¸ªè§¦å‘å™¨(æ¯æ¡ INSERT ã€ UPDATEå’Œ DELETE çš„ä¹‹å‰å’Œä¹‹å)ã€‚å•ä¸€è§¦å‘å™¨ä¸èƒ½ä¸å¤šä¸ªäº‹ä»¶æˆ–å¤šä¸ªè¡¨å…³è”,æ‰€ä»¥,å¦‚æœä½ éœ€è¦ä¸€ä¸ªå¯¹ INSERT å’Œ UPDATE æ“ä½œæ‰§è¡Œçš„è§¦å‘å™¨,åˆ™åº”è¯¥å®šä¹‰ä¸¤ä¸ªè§¦å‘å™¨ã€‚</p>
<p>è§¦å‘å™¨å¤±è´¥ å¦‚æœ BEFORE è§¦å‘å™¨å¤±è´¥,åˆ™MySQLå°†ä¸æ‰§è¡Œè¯·æ±‚çš„æ“ä½œã€‚æ­¤å¤–,å¦‚æœ BEFORE è§¦å‘å™¨æˆ–è¯­å¥æœ¬èº«å¤±è´¥, MySQLå°†ä¸æ‰§è¡Œ AFTER è§¦å‘å™¨(å¦‚æœæœ‰çš„è¯)ã€‚</p>
<blockquote>
<p>åˆ é™¤è§¦å‘å™¨</p>
</blockquote>
<p>ç°åœ¨,åˆ é™¤è§¦å‘å™¨çš„è¯­æ³•åº”è¯¥å¾ˆæ˜æ˜¾äº†ã€‚ä¸ºäº†åˆ é™¤ä¸€ä¸ªè§¦å‘å™¨,å¯ä½¿ç”¨ DROP TRIGGER è¯­å¥,å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; drop trigger triggervendors;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è§¦å‘å™¨ä¸èƒ½æ›´æ–°æˆ–è¦†ç›–ã€‚ä¸ºäº†ä¿®æ”¹ä¸€ä¸ªè§¦å‘å™¨,å¿…é¡»å…ˆåˆ é™¤å®ƒ,ç„¶åå†é‡æ–°åˆ›å»ºã€‚</p>
<blockquote>
<p>ä½¿ç”¨è§¦å‘å™¨</p>
</blockquote>
<p>åœ¨æœ‰äº†å‰é¢çš„åŸºç¡€çŸ¥è¯†å,æˆ‘ä»¬ç°åœ¨æ¥çœ‹æ‰€æ”¯æŒçš„æ¯ç§è§¦å‘å™¨ç±»å‹ä»¥åŠå®ƒä»¬çš„å·®åˆ«ã€‚</p>
<p>1.INSERT è§¦å‘å™¨</p>
<p>INSERT è§¦å‘å™¨åœ¨ INSERT è¯­å¥æ‰§è¡Œä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œã€‚éœ€è¦çŸ¥é“ä»¥ä¸‹å‡ ç‚¹:</p>
<ul>
<li>åœ¨ INSERT è§¦å‘å™¨ä»£ç å†…,å¯å¼•ç”¨ä¸€ä¸ªåä¸º NEW çš„è™šæ‹Ÿè¡¨,è®¿é—®è¢«æ’å…¥çš„è¡Œ;</li>
<li>åœ¨ BEFORE INSERT è§¦å‘å™¨ä¸­, NEW ä¸­çš„å€¼ä¹Ÿå¯ä»¥è¢«æ›´æ–°(å…è®¸æ›´æ”¹è¢«æ’å…¥çš„å€¼);</li>
<li>å¯¹äº AUTO_INCREMENT åˆ—, NEW åœ¨ INSERT æ‰§è¡Œä¹‹å‰åŒ…å« 0 ,åœ¨ INSERTæ‰§è¡Œä¹‹ååŒ…å«æ–°çš„è‡ªåŠ¨ç”Ÿæˆå€¼ã€‚</li>
</ul>
<blockquote>
<blockquote>
<p>ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­(ä¸€ä¸ªå®é™…æœ‰ç”¨çš„ä¾‹å­)ã€‚ AUTO_INCREMENT åˆ—å…·æœ‰MySQLè‡ªåŠ¨èµ‹äºˆçš„å€¼ã€‚ä¹‹å‰å»ºè®®äº†å‡ ç§ç¡®å®šæ–°ç”Ÿæˆå€¼çš„æ–¹æ³•,ä½†ä¸‹é¢æ˜¯ä¸€ç§æ›´å¥½çš„æ–¹æ³•:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create trigger neworder after insert on orders for each row select new.order_num into @hh;</span><br><span class="line">Query OK, 0 rows affected (0.37 sec)</span><br></pre></td></tr></table></figure>

<p>æ­¤ä»£ç åˆ›å»ºä¸€ä¸ªåä¸º <code>neworder</code> çš„è§¦å‘å™¨,å®ƒæŒ‰ç…§ <code>AFTER INSERTON orders</code> æ‰§è¡Œã€‚åœ¨æ’å…¥ä¸€ä¸ªæ–°è®¢å•åˆ°<code>orders</code>è¡¨æ—¶,MySQLç”Ÿæˆä¸€ä¸ªæ–°è®¢å•å·å¹¶ä¿å­˜åˆ° <code>order_num</code> ä¸­ã€‚è§¦å‘å™¨ä» <code>NEW. order_num</code> å–å¾—è¿™ä¸ªå€¼å¹¶è¿”å›å®ƒã€‚æ­¤è§¦å‘å™¨å¿…é¡»æŒ‰ç…§ <code>AFTER INSERT</code> æ‰§è¡Œ,å› ä¸ºåœ¨ <code>BEFOREINSERT</code> è¯­å¥æ‰§è¡Œä¹‹å‰,æ–° <code>order_num</code> è¿˜æ²¡æœ‰ç”Ÿæˆã€‚å¯¹äº <code>orders</code> çš„æ¯æ¬¡æ’å…¥ä½¿ç”¨è¿™ä¸ªè§¦å‘å™¨å°†æ€»æ˜¯è¿”å›æ–°çš„è®¢å•å·ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸ºæµ‹è¯•è¿™ä¸ªè§¦å‘å™¨,è¯•ç€æ’å…¥ä¸€ä¸‹æ–°è¡Œ,å¦‚ä¸‹æ‰€ç¤º:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; insert into orders (order_date,cust_id) values (now(),10001);</span><br><span class="line">Query OK, 1 row affected (0.60 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select @hh;</span><br><span class="line">+-------+</span><br><span class="line">| @hh   |</span><br><span class="line">+-------+</span><br><span class="line">| 20010 |</span><br><span class="line">+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from orders;</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">| order_num | order_date          | cust_id |</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">|     20005 | 2005-09-01 00:00:00 |   10001 |</span><br><span class="line">|     20006 | 2005-09-12 00:00:00 |   10003 |</span><br><span class="line">|     20007 | 2005-09-30 00:00:00 |   10004 |</span><br><span class="line">|     20008 | 2005-10-03 00:00:00 |   10005 |</span><br><span class="line">|     20009 | 2005-10-08 00:00:00 |   10001 |</span><br><span class="line">|     20010 | 2016-09-21 11:08:47 |   10001 |</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ordersåŒ…å«3ä¸ªåˆ—ã€‚order_date å’Œ cust_idå¿…é¡»ç»™å‡º,order_num ç”±MySQLè‡ªåŠ¨ç”Ÿæˆ,è€Œç°åœ¨ order_num è¿˜è‡ªåŠ¨è¢«è¿”å›ã€‚</p>
<p><strong>BEFORE æˆ– AFTER ?</strong> é€šå¸¸,å°† BEFORE ç”¨äºæ•°æ®éªŒè¯å’Œå‡€åŒ–(ç›®çš„æ˜¯ä¿è¯æ’å…¥è¡¨ä¸­çš„æ•°æ®ç¡®å®æ˜¯éœ€è¦çš„æ•°æ®)ã€‚æœ¬æç¤ºä¹Ÿé€‚ç”¨äº UPDATE è§¦å‘å™¨ã€‚</p>
<p>2.DELETE è§¦å‘å™¨</p>
<p>DELETE è§¦å‘å™¨åœ¨ DELETE è¯­å¥æ‰§è¡Œä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œã€‚éœ€è¦çŸ¥é“ä»¥ä¸‹ä¸¤ç‚¹:</p>
<ul>
<li>åœ¨ DELETE è§¦å‘å™¨ä»£ç å†…,ä½ å¯ä»¥å¼•ç”¨ä¸€ä¸ªåä¸º OLD çš„è™šæ‹Ÿè¡¨,è®¿é—®è¢«åˆ é™¤çš„è¡Œ;</li>
<li>OLD ä¸­çš„å€¼å…¨éƒ½æ˜¯åªè¯»çš„,ä¸èƒ½æ›´æ–°ã€‚</li>
</ul>
<blockquote>
<blockquote>
<p>ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºä½¿ç”¨ OLD ä¿å­˜å°†è¦è¢«åˆ é™¤çš„è¡Œåˆ°ä¸€ä¸ªå­˜æ¡£è¡¨ä¸­:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; delimiter //</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; create trigger deleteorder before delete on orders for each row  begin insert into archive_orders(order_num,order_date,cust_id) values (OLD.order_num,OLD.order_date,OLD.cust_id); end//</span><br><span class="line">Query OK, 0 rows affected (0.07 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delimiter ;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä»»æ„è®¢å•è¢«åˆ é™¤å‰å°†æ‰§è¡Œæ­¤è§¦å‘å™¨ã€‚å®ƒä½¿ç”¨ä¸€æ¡ <code>INSERT</code>è¯­å¥å°† <code>OLD</code> ä¸­çš„å€¼(è¦è¢«åˆ é™¤çš„è®¢å•)ä¿å­˜åˆ°ä¸€ä¸ªåä¸º <code>archive_orders</code> çš„å­˜æ¡£è¡¨ä¸­(ä¸ºå®é™…ä½¿ç”¨è¿™ä¸ªä¾‹å­,ä½ éœ€è¦ç”¨ä¸ <code>orders</code> ç›¸åŒçš„åˆ—åˆ›å»ºä¸€ä¸ªåä¸º <code>archive_orders</code> çš„è¡¨)ã€‚</p>
<p>ä½¿ç”¨ <code>BEFORE DELETE</code> è§¦å‘å™¨çš„ä¼˜ç‚¹(ç›¸å¯¹äº <code>AFTER DELETE</code> è§¦å‘å™¨æ¥è¯´)ä¸º,å¦‚æœç”±äºæŸç§åŸå› ,è®¢å•ä¸èƒ½å­˜æ¡£, <code>DELETE</code> æœ¬èº«å°†è¢«æ”¾å¼ƒã€‚</p>
<p><strong>å¤šè¯­å¥è§¦å‘å™¨</strong> æ­£å¦‚æ‰€è§,è§¦å‘å™¨ <code>deleteorder</code> ä½¿ç”¨ <code>BEGIN</code> å’Œ<code>END</code> è¯­å¥æ ‡è®°è§¦å‘å™¨ä½“ã€‚è¿™åœ¨æ­¤ä¾‹å­ä¸­å¹¶ä¸æ˜¯å¿…éœ€çš„,ä¸è¿‡ä¹Ÿæ²¡æœ‰å®³å¤„ã€‚ä½¿ç”¨ <code>BEGIN END</code> å—çš„å¥½å¤„æ˜¯è§¦å‘å™¨èƒ½å®¹çº³å¤šæ¡SQLè¯­å¥(åœ¨ <code>BEGIN END</code>å— ä¸­ä¸€æ¡æŒ¨ç€ä¸€æ¡)ã€‚</p>
<p>3.UPDATE è§¦å‘å™¨</p>
<p>UPDATE è§¦å‘å™¨åœ¨ UPDATE è¯­å¥æ‰§è¡Œä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œã€‚éœ€è¦çŸ¥é“ä»¥ä¸‹å‡ ç‚¹:</p>
<ul>
<li>åœ¨ UPDATE è§¦å‘å™¨ä»£ç ä¸­,ä½ å¯ä»¥å¼•ç”¨ä¸€ä¸ªåä¸º OLD çš„è™šæ‹Ÿè¡¨è®¿é—®ä»¥å‰( UPDATE è¯­å¥å‰)çš„å€¼,å¼•ç”¨ä¸€ä¸ªåä¸º NEW çš„è™šæ‹Ÿè¡¨è®¿é—®æ–°æ›´æ–°çš„å€¼;</li>
<li>åœ¨ BEFORE UPDATE è§¦å‘å™¨ä¸­, NEW ä¸­çš„å€¼å¯èƒ½ä¹Ÿè¢«æ›´æ–°(å…è®¸æ›´æ”¹å°†è¦ç”¨äº UPDATE è¯­å¥ä¸­çš„å€¼);</li>
<li>OLD ä¸­çš„å€¼å…¨éƒ½æ˜¯åªè¯»çš„,ä¸èƒ½æ›´æ–°ã€‚</li>
</ul>
<p>ä¸‹é¢çš„ä¾‹å­ä¿è¯å·åç¼©å†™æ€»æ˜¯å¤§å†™(ä¸ç®¡ UPDATE è¯­å¥ä¸­ç»™å‡ºçš„æ˜¯å¤§å†™è¿˜æ˜¯å°å†™):</p>
<p>æ˜¾ç„¶,ä»»ä½•æ•°æ®å‡€åŒ–éƒ½éœ€è¦åœ¨ UPDATE è¯­å¥ä¹‹å‰è¿›è¡Œ,å°±åƒè¿™ä¸ªä¾‹å­ä¸­ä¸€æ ·ã€‚</p>
<blockquote>
<blockquote>
<p>æ¯æ¬¡æ›´æ–°ä¸€ä¸ªè¡Œæ—¶, NEW.vend_state ä¸­çš„å€¼(å°†ç”¨æ¥æ›´æ–°è¡¨è¡Œçš„å€¼)éƒ½ç”¨ Upper(NEW.vend_state) æ›¿æ¢ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create trigger updatevendor before update on vendors for each row set New.vend_state = Upperï¼ˆnew.vend_stateï¼‰;</span><br><span class="line">Query OK, 0 rows affected (0.35 sec)</span><br></pre></td></tr></table></figure>

<p>4.å…³äºè§¦å‘å™¨çš„è¿›ä¸€æ­¥ä»‹ç»</p>
<p>åœ¨ç»“æŸæœ¬ç« ä¹‹å‰,æˆ‘ä»¬å†ä»‹ç»ä¸€äº›ä½¿ç”¨è§¦å‘å™¨æ—¶éœ€è¦è®°ä½çš„é‡ç‚¹ã€‚</p>
<ul>
<li>ä¸å…¶ä»–DBMSç›¸æ¯”,MySQL 5ä¸­æ”¯æŒçš„è§¦å‘å™¨ç›¸å½“åˆçº§ã€‚æœªæ¥çš„MySQLç‰ˆæœ¬ä¸­æœ‰ä¸€äº›æ”¹è¿›å’Œå¢å¼ºè§¦å‘å™¨æ”¯æŒçš„è®¡åˆ’ã€‚</li>
<li>åˆ›å»ºè§¦å‘å™¨å¯èƒ½éœ€è¦ç‰¹æ®Šçš„å®‰å…¨è®¿é—®æƒé™,ä½†æ˜¯,è§¦å‘å™¨çš„æ‰§è¡Œæ˜¯è‡ªåŠ¨çš„ã€‚å¦‚æœ INSERT ã€ UPDATE æˆ– DELETE è¯­å¥èƒ½å¤Ÿæ‰§è¡Œ,åˆ™ç›¸å…³çš„è§¦å‘å™¨ä¹Ÿèƒ½æ‰§è¡Œã€‚</li>
<li>åº”è¯¥ç”¨è§¦å‘å™¨æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§(å¤§å°å†™ã€æ ¼å¼ç­‰)ã€‚åœ¨è§¦å‘å™¨ä¸­æ‰§è¡Œè¿™ç§ç±»å‹çš„å¤„ç†çš„ä¼˜ç‚¹æ˜¯å®ƒæ€»æ˜¯è¿›è¡Œè¿™ç§å¤„ç†,è€Œä¸”æ˜¯é€æ˜åœ°è¿›è¡Œ,ä¸å®¢æˆ·æœºåº”ç”¨æ— å…³ã€‚</li>
<li>è§¦å‘å™¨çš„ä¸€ç§éå¸¸æœ‰æ„ä¹‰çš„ä½¿ç”¨æ˜¯åˆ›å»ºå®¡è®¡è·Ÿè¸ªã€‚ä½¿ç”¨è§¦å‘å™¨,æŠŠæ›´æ”¹(å¦‚æœéœ€è¦,ç”šè‡³è¿˜æœ‰ä¹‹å‰å’Œä¹‹åçš„çŠ¶æ€)è®°å½•åˆ°å¦ä¸€ä¸ªè¡¨éå¸¸å®¹æ˜“ã€‚</li>
<li>é—æ†¾çš„æ˜¯,MySQLè§¦å‘å™¨ä¸­ä¸æ”¯æŒ CALL è¯­å¥ã€‚è¿™è¡¨ç¤ºä¸èƒ½ä»è§¦å‘å™¨å†…è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ã€‚æ‰€éœ€çš„å­˜å‚¨è¿‡ç¨‹ä»£ç éœ€è¦å¤åˆ¶åˆ°è§¦å‘å™¨å†…ã€‚</li>
</ul>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« ä»‹ç»äº†ä»€ä¹ˆæ˜¯è§¦å‘å™¨ä»¥åŠä¸ºä»€ä¹ˆè¦ä½¿ç”¨è§¦å‘å™¨,å­¦ä¹ äº†è§¦å‘å™¨çš„ç±»å‹å’Œä½•æ—¶æ‰§è¡Œå®ƒä»¬,åˆ—ä¸¾äº†å‡ ä¸ªç”¨äº INSERT ã€ DELETE å’Œ UPDATE æ“ä½œçš„è§¦å‘å™¨ä¾‹å­ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h3 id="ç®¡ç†äº‹åŠ¡å¤„ç†"><a href="#ç®¡ç†äº‹åŠ¡å¤„ç†" class="headerlink" title="ç®¡ç†äº‹åŠ¡å¤„ç†"></a>ç®¡ç†äº‹åŠ¡å¤„ç†</h3><p>æœ¬ç« ä»‹ç»ä»€ä¹ˆæ˜¯äº‹åŠ¡å¤„ç†ä»¥åŠå¦‚ä½•åˆ©ç”¨ COMMIT å’Œ ROLLBACK è¯­å¥æ¥ç®¡ç†äº‹åŠ¡å¤„ç†ã€‚</p>
<blockquote>
<p>äº‹åŠ¡å¤„ç†</p>
</blockquote>
<p><strong>å¹¶éæ‰€æœ‰å¼•æ“éƒ½æ”¯æŒäº‹åŠ¡å¤„ç†</strong> MySQLæ”¯æŒå‡ ç§åŸºæœ¬çš„æ•°æ®åº“å¼•æ“ï¼Œå¹¶éæ‰€æœ‰å¼•æ“éƒ½æ”¯æŒæ˜ç¡®çš„äº‹åŠ¡å¤„ç†ç®¡ç†ã€‚ MyISAM å’Œ InnoDB æ˜¯ä¸¤ç§æœ€å¸¸ä½¿ç”¨çš„å¼•æ“ã€‚å‰è€…ä¸æ”¯æŒæ˜ç¡®çš„äº‹åŠ¡å¤„ç†ç®¡ç†,è€Œåè€…æ”¯æŒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ¬ä¹¦ä¸­ä½¿ç”¨çš„æ ·ä¾‹è¡¨è¢«åˆ›å»ºæ¥ä½¿ç”¨ InnoDB è€Œä¸æ˜¯æ›´ç»å¸¸ä½¿ç”¨çš„ MyISAM çš„åŸå› ã€‚å¦‚æœä½ çš„åº”ç”¨ä¸­éœ€è¦äº‹åŠ¡å¤„ç†åŠŸèƒ½,åˆ™ä¸€å®šè¦ä½¿ç”¨æ­£ç¡®çš„å¼•æ“ç±»å‹ã€‚</p>
<p>äº‹åŠ¡å¤„ç†(transaction processing)å¯ä»¥ç”¨æ¥ç»´æŠ¤æ•°æ®åº“çš„å®Œæ•´æ€§,å®ƒä¿è¯æˆæ‰¹çš„MySQLæ“ä½œè¦ä¹ˆå®Œå…¨æ‰§è¡Œ,è¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œã€‚</p>
<p>å…³ç³»æ•°æ®åº“è®¾è®¡æŠŠæ•°æ®å­˜å‚¨åœ¨å¤šä¸ªè¡¨ä¸­,ä½¿æ•°æ®æ›´å®¹æ˜“æ“çºµã€ç»´æŠ¤å’Œé‡ç”¨ã€‚ä¸ç”¨æ·±ç©¶å¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆè¿›è¡Œå…³ç³»æ•°æ®åº“è®¾è®¡,åœ¨æŸç§ç¨‹åº¦ä¸Šè¯´,è®¾è®¡è‰¯å¥½çš„æ•°æ®åº“æ¨¡å¼éƒ½æ˜¯å…³è”çš„ã€‚</p>
<p>å‰é¢ç« ä¸­ä½¿ç”¨çš„ <code>orders</code> è¡¨å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚è®¢å•å­˜å‚¨åœ¨ <code>orders</code>å’Œ <code>orderitems</code>ä¸¤ä¸ªè¡¨ä¸­: <code>orders</code> å­˜å‚¨å®é™…çš„è®¢å•,è€Œ <code>orderitems</code> å­˜å‚¨è®¢è´­çš„å„é¡¹ç‰©å“ã€‚è¿™ä¸¤ä¸ªè¡¨ä½¿ç”¨ç§°ä¸ºä¸»é”®çš„å”¯ä¸€IDäº’ç›¸å…³è”ã€‚è¿™ä¸¤ä¸ªè¡¨åˆä¸åŒ…å«å®¢æˆ·å’Œäº§å“ä¿¡æ¯çš„å…¶ä»–è¡¨ç›¸å…³è”ã€‚</p>
<p>ç»™ç³»ç»Ÿæ·»åŠ è®¢å•çš„è¿‡ç¨‹å¦‚ä¸‹ã€‚</p>
<p>(1) æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨ç›¸åº”çš„å®¢æˆ·(ä» customers è¡¨æŸ¥è¯¢),å¦‚æœä¸å­˜åœ¨,æ·»åŠ ä»–/å¥¹ã€‚<br>(2) æ£€ç´¢å®¢æˆ·çš„IDã€‚<br>(3) æ·»åŠ ä¸€è¡Œåˆ° orders è¡¨,æŠŠå®ƒä¸å®¢æˆ·IDå…³è”ã€‚<br>(4) æ£€ç´¢ orders è¡¨ä¸­èµ‹äºˆçš„æ–°è®¢å•IDã€‚<br>(5) å¯¹äºè®¢è´­çš„æ¯ä¸ªç‰©å“åœ¨ orderitems è¡¨ä¸­æ·»åŠ ä¸€è¡Œ,é€šè¿‡æ£€ç´¢å‡ºæ¥çš„IDæŠŠå®ƒä¸ orders è¡¨å…³è”(ä»¥åŠé€šè¿‡äº§å“IDä¸ products è¡¨å…³è”)ã€‚</p>
<p>ç°åœ¨,å‡å¦‚ç”±äºæŸç§æ•°æ®åº“æ•…éšœ(å¦‚è¶…å‡ºç£ç›˜ç©ºé—´ã€å®‰å…¨é™åˆ¶ã€è¡¨é”ç­‰)é˜»æ­¢äº†è¿™ä¸ªè¿‡ç¨‹çš„å®Œæˆã€‚æ•°æ®åº“ä¸­çš„æ•°æ®ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µ?</p>
<p>å¦‚æœæ•…éšœå‘ç”Ÿåœ¨æ·»åŠ äº†å®¢æˆ·ä¹‹å, orders è¡¨æ·»åŠ ä¹‹å‰,ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚æŸäº›å®¢æˆ·æ²¡æœ‰è®¢å•æ˜¯å®Œå…¨åˆæ³•çš„ã€‚åœ¨é‡æ–°æ‰§è¡Œæ­¤è¿‡ç¨‹æ—¶,æ‰€æ’å…¥çš„å®¢æˆ·è®°å½•å°†è¢«æ£€ç´¢å’Œä½¿ç”¨ã€‚å¯ä»¥æœ‰æ•ˆåœ°ä»å‡ºæ•…éšœçš„åœ°æ–¹å¼€å§‹æ‰§è¡Œæ­¤è¿‡ç¨‹ã€‚</p>
<p>ä½†æ˜¯,å¦‚æœæ•…éšœå‘ç”Ÿåœ¨ orders è¡Œæ·»åŠ ä¹‹å, orderitems è¡Œæ·»åŠ ä¹‹å‰,æ€ä¹ˆåŠå‘¢?ç°åœ¨,æ•°æ®åº“ä¸­æœ‰ä¸€ä¸ªç©ºè®¢å•ã€‚</p>
<p>æ›´ç³Ÿçš„æ˜¯,å¦‚æœç³»ç»Ÿåœ¨æ·»åŠ  orderitems è¡Œä¹‹ä¸­å‡ºç°æ•…éšœã€‚ç»“æœæ˜¯æ•°æ®åº“ä¸­å­˜åœ¨ä¸å®Œæ•´çš„è®¢å•,è€Œä¸”ä½ è¿˜ä¸çŸ¥é“ã€‚</p>
<p>å¦‚ä½•è§£å†³è¿™ç§é—®é¢˜?è¿™é‡Œå°±éœ€è¦ä½¿ç”¨äº‹åŠ¡å¤„ç†äº†ã€‚äº‹åŠ¡å¤„ç†æ˜¯ä¸€ç§æœºåˆ¶,ç”¨æ¥ç®¡ç†å¿…é¡»æˆæ‰¹æ‰§è¡Œçš„MySQLæ“ä½œ,ä»¥ä¿è¯æ•°æ®åº“ä¸åŒ…å«ä¸å®Œæ•´çš„æ“ä½œç»“æœã€‚åˆ©ç”¨äº‹åŠ¡å¤„ç†,å¯ä»¥ä¿è¯ä¸€ç»„æ“ä½œä¸ä¼šä¸­é€”åœæ­¢,å®ƒä»¬æˆ–è€…ä½œä¸ºæ•´ä½“æ‰§è¡Œ,æˆ–è€…å®Œå…¨ä¸æ‰§è¡Œ(é™¤éæ˜ç¡®æŒ‡ç¤º)ã€‚å¦‚æœæ²¡æœ‰é”™è¯¯å‘ç”Ÿ,æ•´ç»„è¯­å¥æäº¤ç»™(å†™åˆ°)æ•°æ®åº“è¡¨ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯,åˆ™è¿›è¡Œå›é€€(æ’¤é”€)ä»¥æ¢å¤æ•°æ®åº“åˆ°æŸä¸ªå·²çŸ¥ä¸”å®‰å…¨çš„çŠ¶æ€ã€‚</p>
<p>å› æ­¤,è¯·çœ‹ç›¸åŒçš„ä¾‹å­,è¿™æ¬¡æˆ‘ä»¬è¯´æ˜è¿‡ç¨‹å¦‚ä½•å·¥ä½œã€‚</p>
<ul>
<li>æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨ç›¸åº”çš„å®¢æˆ·,å¦‚æœä¸å­˜åœ¨,æ·»åŠ ä»–/å¥¹ã€‚</li>
<li>æäº¤å®¢æˆ·ä¿¡æ¯ã€‚</li>
<li>æ£€ç´¢å®¢æˆ·çš„IDã€‚</li>
<li>æ·»åŠ ä¸€è¡Œåˆ° orders è¡¨ã€‚</li>
<li>å¦‚æœåœ¨æ·»åŠ è¡Œåˆ° orders è¡¨æ—¶å‡ºç°æ•…éšœ,å›é€€ã€‚</li>
<li>æ£€ç´¢ orders è¡¨ä¸­èµ‹äºˆçš„æ–°è®¢å•IDã€‚</li>
<li>å¯¹äºè®¢è´­çš„æ¯é¡¹ç‰©å“,æ·»åŠ æ–°è¡Œåˆ° orderitems è¡¨ã€‚</li>
<li>å¦‚æœåœ¨æ·»åŠ æ–°è¡Œåˆ° orderitems æ—¶å‡ºç°æ•…éšœ,å›é€€æ‰€æœ‰æ·»åŠ çš„orderitems è¡Œå’Œ orders è¡Œã€‚</li>
<li>æäº¤è®¢å•ä¿¡æ¯ã€‚</li>
</ul>
<p>åœ¨ä½¿ç”¨äº‹åŠ¡å’Œäº‹åŠ¡å¤„ç†æ—¶,æœ‰å‡ ä¸ªå…³é”®è¯æ±‡åå¤å‡ºç°ã€‚ä¸‹é¢æ˜¯å…³äºäº‹åŠ¡å¤„ç†éœ€è¦çŸ¥é“çš„å‡ ä¸ªæœ¯è¯­:</p>
<ul>
<li>äº‹åŠ¡( transaction )æŒ‡ä¸€ç»„SQLè¯­å¥;</li>
<li>å›é€€( rollback )æŒ‡æ’¤é”€æŒ‡å®šSQLè¯­å¥çš„è¿‡ç¨‹;</li>
<li>æäº¤( commit )æŒ‡å°†æœªå­˜å‚¨çš„SQLè¯­å¥ç»“æœå†™å…¥æ•°æ®åº“è¡¨;</li>
<li>ä¿ç•™ç‚¹( savepoint )æŒ‡äº‹åŠ¡å¤„ç†ä¸­è®¾ç½®çš„ä¸´æ—¶å ä½ç¬¦(place-holder),ä½ å¯ä»¥å¯¹å®ƒå‘å¸ƒå›é€€(ä¸å›é€€æ•´ä¸ªäº‹åŠ¡å¤„ç†ä¸åŒ)ã€‚</li>
</ul>
<blockquote>
<p>æ§åˆ¶äº‹åŠ¡å¤„ç†</p>
</blockquote>
<p>æ—¢ç„¶æˆ‘ä»¬å·²ç»çŸ¥é“äº†ä»€ä¹ˆæ˜¯äº‹åŠ¡å¤„ç†,ä¸‹é¢è®¨è®ºäº‹åŠ¡å¤„ç†çš„ç®¡ç†ä¸­æ‰€æ¶‰åŠçš„é—®é¢˜ã€‚</p>
<p>ç®¡ç†äº‹åŠ¡å¤„ç†çš„å…³é”®åœ¨äºå°†SQLè¯­å¥ç»„åˆ†è§£ä¸ºé€»è¾‘å—,å¹¶æ˜ç¡®è§„å®šæ•°æ®ä½•æ—¶åº”è¯¥å›é€€,ä½•æ—¶ä¸åº”è¯¥å›é€€ã€‚</p>
<p>MySQLä½¿ç”¨ä¸‹é¢çš„è¯­å¥æ¥æ ‡è¯†äº‹åŠ¡çš„å¼€å§‹:<code>start transaction;</code></p>
<p>1.ä½¿ç”¨ ROLLBACK</p>
<p>MySQLçš„ ROLLBACK å‘½ä»¤ç”¨æ¥å›é€€(æ’¤é”€)MySQLè¯­å¥,è¯·çœ‹ä¸‹é¢çš„è¯­å¥:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from ordertotals;</span><br><span class="line">+-----------+---------+</span><br><span class="line">| order_num | total   |</span><br><span class="line">+-----------+---------+</span><br><span class="line">|     20005 |  158.86 |</span><br><span class="line">|     20009 |   40.78 |</span><br><span class="line">|     20006 |   58.30 |</span><br><span class="line">|     20007 | 1060.00 |</span><br><span class="line">|     20008 |  132.50 |</span><br><span class="line">|     20008 |  132.50 |</span><br><span class="line">+-----------+---------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; start transaction;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delete from ordertotals;</span><br><span class="line">Query OK, 6 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from ordertotals;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; rollback;</span><br><span class="line">Query OK, 0 rows affected (0.55 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from ordertotals;</span><br><span class="line">+-----------+---------+</span><br><span class="line">| order_num | total   |</span><br><span class="line">+-----------+---------+</span><br><span class="line">|     20005 |  158.86 |</span><br><span class="line">|     20009 |   40.78 |</span><br><span class="line">|     20006 |   58.30 |</span><br><span class="line">|     20007 | 1060.00 |</span><br><span class="line">|     20008 |  132.50 |</span><br><span class="line">|     20008 |  132.50 |</span><br><span class="line">+-----------+---------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªä¾‹å­ä»æ˜¾ç¤º ordertotals è¡¨çš„å†…å®¹å¼€å§‹ã€‚é¦–å…ˆæ‰§è¡Œä¸€æ¡ SELECT ä»¥æ˜¾ç¤ºè¯¥è¡¨ä¸ä¸ºç©ºã€‚ç„¶åå¼€å§‹ä¸€ä¸ªäº‹åŠ¡å¤„ç†,ç”¨ä¸€æ¡ DELETE è¯­å¥åˆ é™¤ ordertotals ä¸­çš„æ‰€æœ‰è¡Œã€‚å¦ä¸€æ¡SELECT è¯­å¥éªŒè¯ ordertotals ç¡®å®ä¸ºç©ºã€‚è¿™æ—¶ç”¨ä¸€æ¡ ROLLBACK è¯­å¥å›é€€START TRANSACTION ä¹‹åçš„æ‰€æœ‰è¯­å¥,æœ€åä¸€æ¡ SELECT è¯­å¥æ˜¾ç¤ºè¯¥è¡¨ä¸ä¸ºç©ºã€‚</p>
<p>æ˜¾ç„¶, ROLLBACK åªèƒ½åœ¨ä¸€ä¸ªäº‹åŠ¡å¤„ç†å†…ä½¿ç”¨(åœ¨æ‰§è¡Œä¸€æ¡ STARTTRANSACTION å‘½ä»¤ä¹‹å)ã€‚</p>
<p><strong>å“ªäº›è¯­å¥å¯ä»¥å›é€€?</strong> äº‹åŠ¡å¤„ç†ç”¨æ¥ç®¡ç† INSERT ã€ UPDATE å’ŒDELETE è¯­å¥ã€‚ä½ ä¸èƒ½å›é€€ SELECT è¯­å¥ã€‚(è¿™æ ·åšä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚)ä½ ä¸èƒ½å›é€€ CREATE æˆ– DROP æ“ä½œã€‚äº‹åŠ¡å¤„ç†å—ä¸­å¯ä»¥ä½¿ç”¨è¿™ä¸¤æ¡è¯­å¥,ä½†å¦‚æœä½ æ‰§è¡Œå›é€€,å®ƒä»¬ä¸ä¼šè¢«æ’¤é”€ã€‚</p>
<p>2.ä½¿ç”¨ COMMIT</p>
<p>ä¸€èˆ¬çš„MySQLè¯­å¥éƒ½æ˜¯ç›´æ¥é’ˆå¯¹æ•°æ®åº“è¡¨æ‰§è¡Œå’Œç¼–å†™çš„ã€‚è¿™å°±æ˜¯æ‰€è°“çš„éšå«æäº¤(implicit commit),å³æäº¤(å†™æˆ–ä¿å­˜)æ“ä½œæ˜¯è‡ªåŠ¨è¿›è¡Œçš„ã€‚</p>
<p>ä½†æ˜¯,åœ¨äº‹åŠ¡å¤„ç†å—ä¸­,æäº¤ä¸ä¼šéšå«åœ°è¿›è¡Œã€‚ä¸ºè¿›è¡Œæ˜ç¡®çš„æäº¤,ä½¿ç”¨ COMMIT è¯­å¥,å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; start transaction;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delete from orderitems where order_num=20010;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delete from orders where order_num=20010;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­,ä»ç³»ç»Ÿä¸­å®Œå…¨åˆ é™¤è®¢å• <code>20010</code> ã€‚å› ä¸ºæ¶‰åŠæ›´æ–°ä¸¤ä¸ªæ•°æ®åº“è¡¨ <code>orders</code> å’Œ <code>orderItems</code> ,æ‰€ä»¥ä½¿ç”¨äº‹åŠ¡å¤„ç†å—æ¥ä¿è¯è®¢å•ä¸è¢«éƒ¨åˆ†åˆ é™¤ã€‚æœ€åçš„ COMMIT è¯­å¥ä»…åœ¨ä¸å‡ºé”™æ—¶å†™å‡ºæ›´æ”¹ã€‚å¦‚æœç¬¬ä¸€æ¡ DELETE èµ·ä½œç”¨,ä½†ç¬¬äºŒæ¡å¤±è´¥,åˆ™ DELETE ä¸ä¼šæäº¤(å®é™…ä¸Š,å®ƒæ˜¯è¢«è‡ªåŠ¨æ’¤é”€çš„)ã€‚</p>
<p><strong>éšå«äº‹åŠ¡å…³é—­</strong> å½“ <code>COMMIT</code> æˆ– <code>ROLLBACK</code> è¯­å¥æ‰§è¡Œå,äº‹åŠ¡ä¼šè‡ªéšå«äº‹åŠ¡å…³é—­åŠ¨å…³é—­(å°†æ¥çš„æ›´æ”¹ä¼šéšå«æäº¤)ã€‚</p>
<p>3.ä½¿ç”¨ä¿ç•™ç‚¹</p>
<p>ç®€å•çš„ <code>ROLLBACK</code> å’Œ <code>COMMIT</code> è¯­å¥å°±å¯ä»¥å†™å…¥æˆ–æ’¤é”€æ•´ä¸ªäº‹åŠ¡å¤„ç†ã€‚ä½†æ˜¯,åªæ˜¯å¯¹ç®€å•çš„äº‹åŠ¡å¤„ç†æ‰èƒ½è¿™æ ·åš,æ›´å¤æ‚çš„äº‹åŠ¡å¤„ç†å¯èƒ½éœ€è¦éƒ¨åˆ†æäº¤æˆ–å›é€€ã€‚</p>
<p>ä¾‹å¦‚,å‰é¢æè¿°çš„æ·»åŠ è®¢å•çš„è¿‡ç¨‹ä¸ºä¸€ä¸ªäº‹åŠ¡å¤„ç†ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯,åªéœ€è¦è¿”å›åˆ°æ·»åŠ  orders è¡Œä¹‹å‰å³å¯,ä¸éœ€è¦å›é€€åˆ° customers è¡¨(å¦‚æœå­˜åœ¨çš„è¯)ã€‚</p>
<p>ä¸ºäº†æ”¯æŒå›é€€éƒ¨åˆ†äº‹åŠ¡å¤„ç†,å¿…é¡»èƒ½åœ¨äº‹åŠ¡å¤„ç†å—ä¸­åˆé€‚çš„ä½ç½®æ”¾ç½®å ä½ç¬¦ã€‚è¿™æ ·,å¦‚æœéœ€è¦å›é€€,å¯ä»¥å›é€€åˆ°æŸä¸ªå ä½ç¬¦ã€‚</p>
<p>è¿™äº›å ä½ç¬¦ç§°ä¸ºä¿ç•™ç‚¹ã€‚ä¸ºäº†åˆ›å»ºå ä½ç¬¦,å¯å¦‚ä¸‹ä½¿ç”¨ SAVEPOINTè¯­å¥:<code>savepoint delete1;</code></p>
<p>æ¯ä¸ªä¿ç•™ç‚¹éƒ½å–æ ‡è¯†å®ƒçš„å”¯ä¸€åå­—,ä»¥ä¾¿åœ¨å›é€€æ—¶,MySQLçŸ¥é“è¦å›é€€åˆ°ä½•å¤„ã€‚ä¸ºäº†å›é€€åˆ°æœ¬ä¾‹ç»™å‡ºçš„ä¿ç•™ç‚¹,å¯å¦‚ä¸‹è¿›è¡Œ:<code>rollback to delete1;</code></p>
<p><strong>ä¿ç•™ç‚¹è¶Šå¤šè¶Šå¥½</strong> å¯ä»¥åœ¨MySQLä»£ç ä¸­è®¾ç½®ä»»æ„å¤šçš„ä¿ç•™ç‚¹,è¶Šå¤šè¶Šå¥½ã€‚ä¸ºä»€ä¹ˆå‘¢?å› ä¸ºä¿ç•™ç‚¹è¶Šå¤š,ä½ å°±è¶Šèƒ½æŒ‰è‡ªå·±çš„æ„æ„¿çµæ´»åœ°è¿›è¡Œå›é€€ã€‚</p>
<p><strong>é‡Šæ”¾ä¿ç•™ç‚¹</strong> ä¿ç•™ç‚¹åœ¨äº‹åŠ¡å¤„ç†å®Œæˆ(æ‰§è¡Œä¸€æ¡ ROLLBACK æˆ–COMMIT )åè‡ªåŠ¨é‡Šæ”¾ã€‚è‡ªMySQL 5ä»¥æ¥,ä¹Ÿå¯ä»¥ç”¨ RELEASESAVEPOINT æ˜ç¡®åœ°é‡Šæ”¾ä¿ç•™ç‚¹ã€‚</p>
<p>4.æ›´æ”¹é»˜è®¤çš„æäº¤è¡Œä¸º</p>
<p>æ­£å¦‚æ‰€è¿°,é»˜è®¤çš„MySQLè¡Œä¸ºæ˜¯è‡ªåŠ¨æäº¤æ‰€æœ‰æ›´æ”¹ã€‚æ¢å¥è¯è¯´,ä»»ä½•æ—¶å€™ä½ æ‰§è¡Œä¸€æ¡MySQLè¯­å¥,è¯¥è¯­å¥å®é™…ä¸Šéƒ½æ˜¯é’ˆå¯¹è¡¨æ‰§è¡Œçš„,è€Œä¸”æ‰€åšçš„æ›´æ”¹ç«‹å³ç”Ÿæ•ˆã€‚ä¸ºæŒ‡ç¤ºMySQLä¸è‡ªåŠ¨æäº¤æ›´æ”¹,éœ€è¦ä½¿ç”¨ä»¥ä¸‹è¯­å¥:<code>set autocommit=0;</code></p>
<p><code>autocommit</code> æ ‡å¿—å†³å®šæ˜¯å¦è‡ªåŠ¨æäº¤æ›´æ”¹,ä¸ç®¡æœ‰æ²¡æœ‰ <code>COMMIT</code>è¯­å¥ã€‚è®¾ç½® <code>autocommit</code> ä¸º<code>0</code> (å‡)æŒ‡ç¤ºMySQLä¸è‡ªåŠ¨æäº¤æ›´æ”¹(ç›´åˆ° <code>autocommit</code> è¢«è®¾ç½®ä¸º <code>1</code> çœŸä¸ºæ­¢)ã€‚</p>
<p><strong>æ ‡å¿—ä¸ºè¿æ¥ä¸“ç”¨</strong> <code>autocommit</code> æ ‡å¿—æ˜¯é’ˆå¯¹æ¯ä¸ªè¿æ¥è€Œä¸æ˜¯æœåŠ¡å™¨çš„ã€‚</p>
<blockquote>
<blockquote>
<p>æŸ¥çœ‹autocommitçš„å€¼</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; show variables like '%autocommit%';</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| autocommit    | ON    |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select @@autocommit;</span><br><span class="line">+--------------+</span><br><span class="line">| @@autocommit |</span><br><span class="line">+--------------+</span><br><span class="line">|            1 |</span><br><span class="line">+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>


<blockquote>
<blockquote>
<p>è¯¾å ‚ç»ƒä¹ </p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create database db1;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; create table db1.t1 (id int primary key );</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; insert into db1.t1 values (1);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">|  1 |</span><br><span class="line">+----+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; start transaction;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; delete from db1.t1;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; savepoint delete1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; insert into db1.t1 values (10);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; savepoint insert1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">| 10 |</span><br><span class="line">+----+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; rollback to delete1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from db1.t1;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; rollback to insert1;</span><br><span class="line">ERROR 1305 (42000): SAVEPOINT insert1 does not exist</span><br><span class="line">MariaDB [test]&gt; rollback to insert1;</span><br><span class="line">ERROR 1305 (42000): SAVEPOINT insert1 does not exist</span><br><span class="line">MariaDB [test]&gt; insert into db1.t1 values (20);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">| 20 |</span><br><span class="line">+----+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; savepoint in1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; insert into db1.t1 values (30);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; savepoint in2;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">| 20 |</span><br><span class="line">| 30 |</span><br><span class="line">+----+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; rollback to in1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from db1.t1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">| 20 |</span><br><span class="line">+----+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; rollback to in2;</span><br><span class="line">ERROR 1305 (42000): SAVEPOINT in2 does not exist</span><br><span class="line">MariaDB [test]&gt; rollback to delete1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from db1.t1;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œå½“é€€å›åˆ°æŸä¸ªä¿ç•™ç‚¹æ—¶ï¼Œè¯¥ä¿ç•™ç‚¹ä¹‹åçš„ä¿ç•™ç‚¹å°±ä¼šæ¶ˆå¤±ã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« ä»‹ç»äº†äº‹åŠ¡å¤„ç†æ˜¯å¿…é¡»å®Œæ•´æ‰§è¡Œçš„SQLè¯­å¥å—ã€‚æˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ COMMIT å’Œ ROLLBACK è¯­å¥å¯¹ä½•æ—¶å†™æ•°æ®,ä½•æ—¶æ’¤é”€è¿›è¡Œæ˜ç¡®çš„ç®¡ç†ã€‚è¿˜å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ä¿ç•™ç‚¹å¯¹å›é€€æ“ä½œæä¾›æ›´å¼ºå¤§çš„æ§åˆ¶ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h3 id="å…¨çƒåŒ–å’Œæœ¬åœ°åŒ–"><a href="#å…¨çƒåŒ–å’Œæœ¬åœ°åŒ–" class="headerlink" title="å…¨çƒåŒ–å’Œæœ¬åœ°åŒ–"></a>å…¨çƒåŒ–å’Œæœ¬åœ°åŒ–</h3><p>æœ¬ç« ä»‹ç»MySQLå¤„ç†ä¸åŒå­—ç¬¦é›†å’Œè¯­è¨€çš„åŸºç¡€çŸ¥è¯†ã€‚</p>
<blockquote>
<p>å­—ç¬¦é›†å’Œæ ¡å¯¹é¡ºåº</p>
</blockquote>
<p>æ•°æ®åº“è¡¨è¢«ç”¨æ¥å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ã€‚ä¸åŒçš„è¯­è¨€å’Œå­—ç¬¦é›†éœ€è¦ä»¥ä¸åŒçš„æ–¹å¼å­˜å‚¨å’Œæ£€ç´¢ã€‚å› æ­¤,MySQLéœ€è¦é€‚åº”ä¸åŒçš„å­—ç¬¦é›†(ä¸åŒçš„å­—å’Œå­—ç¬¦),é€‚åº”ä¸åŒçš„æ’åºå’Œæ£€ç´¢æ•°æ®çš„æ–¹æ³•ã€‚</p>
<p>åœ¨è®¨è®ºå¤šç§è¯­è¨€å’Œå­—ç¬¦é›†æ—¶,å°†ä¼šé‡åˆ°ä»¥ä¸‹é‡è¦æœ¯è¯­:</p>
<ul>
<li>å­—ç¬¦é›†ä¸ºå­—æ¯å’Œç¬¦å·çš„é›†åˆ;</li>
<li>ç¼–ç ä¸ºæŸä¸ªå­—ç¬¦é›†æˆå‘˜çš„å†…éƒ¨è¡¨ç¤º;</li>
<li>æ ¡å¯¹ä¸ºè§„å®šå­—ç¬¦å¦‚ä½•æ¯”è¾ƒçš„æŒ‡ä»¤ã€‚</li>
</ul>
<p><strong>æ ¡å¯¹ä¸ºä»€ä¹ˆé‡è¦</strong> æ’åºè‹±æ–‡æ­£æ–‡å¾ˆå®¹æ˜“,å¯¹å—?æˆ–è®¸ä¸ã€‚è€ƒè™‘è¯APEã€apexå’ŒAppleã€‚å®ƒä»¬å¤„äºæ­£ç¡®çš„æ’åºé¡ºåºå—?è¿™æœ‰èµ–äºä½ æ˜¯å¦æƒ³åŒºåˆ†å¤§å°å†™ã€‚ä½¿ç”¨åŒºåˆ†å¤§å°å†™çš„æ ¡å¯¹é¡ºåº,è¿™äº›è¯æœ‰ä¸€ç§æ’åºæ–¹å¼,ä½¿ç”¨ä¸åŒºåˆ†å¤§å°å†™çš„æ ¡å¯¹é¡ºåºæœ‰å¦å¤–ä¸€ç§æ’åºæ–¹å¼ã€‚è¿™ä¸ä»…å½±å“æ’åº(å¦‚ç”¨ ORDER BY æ’åºæ•°æ®),è¿˜å½±å“æœç´¢(ä¾‹å¦‚,å¯»æ‰¾appleçš„WHEREå­å¥æ˜¯å¦èƒ½æ‰¾åˆ°APPLE)ã€‚åœ¨ä½¿ç”¨è¯¸å¦‚æ³•æ–‡Ã æˆ–å¾·æ–‡Ã¶è¿™æ ·çš„å­—ç¬¦æ—¶,æƒ…å†µæ›´å¤æ‚,åœ¨ä½¿ç”¨ä¸åŸºäºæ‹‰ä¸æ–‡çš„å­—ç¬¦é›†(æ—¥æ–‡ã€å¸Œä¼¯æ¥æ–‡ã€ä¿„æ–‡ç­‰)æ—¶,æƒ…å†µæ›´ä¸ºå¤æ‚ã€‚</p>
<p>åœ¨MySQLçš„æ­£å¸¸æ•°æ®åº“æ´»åŠ¨( SELECT ã€ INSERT ç­‰)ä¸­,ä¸éœ€è¦æ“å¿ƒå¤ªå¤šçš„ä¸œè¥¿ã€‚ä½¿ç”¨ä½•ç§å­—ç¬¦é›†å’Œæ ¡å¯¹çš„å†³å®šåœ¨æœåŠ¡å™¨ã€æ•°æ®åº“å’Œè¡¨çº§è¿›è¡Œã€‚</p>
<blockquote>
<p>ä½¿ç”¨å­—ç¬¦é›†å’Œæ ¡å¯¹é¡ºåº</p>
</blockquote>
<blockquote>
<blockquote>
<p>MySQLæ”¯æŒä¼—å¤šçš„å­—ç¬¦é›†ã€‚ä¸ºæŸ¥çœ‹æ‰€æ”¯æŒçš„å­—ç¬¦é›†å®Œæ•´åˆ—è¡¨,ä½¿ç”¨ä»¥ä¸‹è¯­å¥:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; show character set;</span><br><span class="line">+----------+-----------------------------+---------------------+--------+</span><br><span class="line">| Charset  | Description                 | Default collation   | Maxlen |</span><br><span class="line">+----------+-----------------------------+---------------------+--------+</span><br><span class="line">| big5     | Big5 Traditional Chinese    | big5_chinese_ci     |      2 |</span><br><span class="line">| dec8     | DEC West European           | dec8_swedish_ci     |      1 |</span><br><span class="line">| cp850    | DOS West European           | cp850_general_ci    |      1 |</span><br><span class="line">| hp8      | HP West European            | hp8_english_ci      |      1 |</span><br><span class="line">| koi8r    | KOI8-R Relcom Russian       | koi8r_general_ci    |      1 |</span><br><span class="line">| latin1   | cp1252 West European        | latin1_swedish_ci   |      1 |</span><br><span class="line">| latin2   | ISO 8859-2 Central European | latin2_general_ci   |      1 |</span><br><span class="line">| swe7     | 7bit Swedish                | swe7_swedish_ci     |      1 |</span><br><span class="line">| ascii    | US ASCII                    | ascii_general_ci    |      1 |</span><br><span class="line">| ujis     | EUC-JP Japanese             | ujis_japanese_ci    |      3 |</span><br><span class="line">| sjis     | Shift-JIS Japanese          | sjis_japanese_ci    |      2 |</span><br><span class="line">| hebrew   | ISO 8859-8 Hebrew           | hebrew_general_ci   |      1 |</span><br><span class="line">| tis620   | TIS620 Thai                 | tis620_thai_ci      |      1 |</span><br><span class="line">| euckr    | EUC-KR Korean               | euckr_korean_ci     |      2 |</span><br><span class="line">| koi8u    | KOI8-U Ukrainian            | koi8u_general_ci    |      1 |</span><br><span class="line">| gb2312   | GB2312 Simplified Chinese   | gb2312_chinese_ci   |      2 |</span><br><span class="line">| greek    | ISO 8859-7 Greek            | greek_general_ci    |      1 |</span><br><span class="line">| cp1250   | Windows Central European    | cp1250_general_ci   |      1 |</span><br><span class="line">| gbk      | GBK Simplified Chinese      | gbk_chinese_ci      |      2 |</span><br><span class="line">| latin5   | ISO 8859-9 Turkish          | latin5_turkish_ci   |      1 |</span><br><span class="line">| armscii8 | ARMSCII-8 Armenian          | armscii8_general_ci |      1 |</span><br><span class="line">| utf8     | UTF-8 Unicode               | utf8_general_ci     |      3 |</span><br><span class="line">| ucs2     | UCS-2 Unicode               | ucs2_general_ci     |      2 |</span><br><span class="line">| cp866    | DOS Russian                 | cp866_general_ci    |      1 |</span><br><span class="line">| keybcs2  | DOS Kamenicky Czech-Slovak  | keybcs2_general_ci  |      1 |</span><br><span class="line">| macce    | Mac Central European        | macce_general_ci    |      1 |</span><br><span class="line">| macroman | Mac West European           | macroman_general_ci |      1 |</span><br><span class="line">| cp852    | DOS Central European        | cp852_general_ci    |      1 |</span><br><span class="line">| latin7   | ISO 8859-13 Baltic          | latin7_general_ci   |      1 |</span><br><span class="line">| utf8mb4  | UTF-8 Unicode               | utf8mb4_general_ci  |      4 |</span><br><span class="line">| cp1251   | Windows Cyrillic            | cp1251_general_ci   |      1 |</span><br><span class="line">| utf16    | UTF-16 Unicode              | utf16_general_ci    |      4 |</span><br><span class="line">| cp1256   | Windows Arabic              | cp1256_general_ci   |      1 |</span><br><span class="line">| cp1257   | Windows Baltic              | cp1257_general_ci   |      1 |</span><br><span class="line">| utf32    | UTF-32 Unicode              | utf32_general_ci    |      4 |</span><br><span class="line">| binary   | Binary pseudo charset       | binary              |      1 |</span><br><span class="line">| geostd8  | GEOSTD8 Georgian            | geostd8_general_ci  |      1 |</span><br><span class="line">| cp932    | SJIS for Windows Japanese   | cp932_japanese_ci   |      2 |</span><br><span class="line">| eucjpms  | UJIS for Windows Japanese   | eucjpms_japanese_ci |      3 |</span><br><span class="line">+----------+-----------------------------+---------------------+--------+</span><br><span class="line">39 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡è¯­å¥æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„å­—ç¬¦é›†ä»¥åŠæ¯ä¸ªå­—ç¬¦é›†çš„æè¿°å’Œé»˜è®¤æ ¡å¯¹ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸ºäº†æŸ¥çœ‹æ‰€æ”¯æŒæ ¡å¯¹çš„å®Œæ•´åˆ—è¡¨,ä½¿ç”¨ä»¥ä¸‹è¯­å¥:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; show collation;</span><br><span class="line">+--------------------------+----------+-----+---------+----------+---------+</span><br><span class="line">| Collation                | Charset  | Id  | Default | Compiled | Sortlen |</span><br><span class="line">+--------------------------+----------+-----+---------+----------+---------+</span><br><span class="line">| big5_chinese_ci          | big5     |   1 | Yes     | Yes      |       1 |</span><br><span class="line">| big5_bin                 | big5     |  84 |         | Yes      |       1 |</span><br><span class="line">| dec8_swedish_ci          | dec8     |   3 | Yes     | Yes      |       1 |</span><br><span class="line">| dec8_bin                 | dec8     |  69 |         | Yes      |       1 |</span><br><span class="line">| cp850_general_ci         | cp850    |   4 | Yes     | Yes      |       1 |</span><br><span class="line">| cp850_bin                | cp850    |  80 |         | Yes      |       1 |</span><br><span class="line">| hp8_english_ci           | hp8      |   6 | Yes     | Yes      |       1 |</span><br><span class="line">| hp8_bin                  | hp8      |  72 |         | Yes      |       1 |</span><br><span class="line">| koi8r_general_ci         | koi8r    |   7 | Yes     | Yes      |       1 |</span><br><span class="line">| koi8r_bin                | koi8r    |  74 |         | Yes      |       1 |</span><br><span class="line">| latin1_german1_ci        | latin1   |   5 |         | Yes      |       1 |</span><br><span class="line">| latin1_swedish_ci        | latin1   |   8 | Yes     | Yes      |       1 |</span><br><span class="line">| latin1_danish_ci         | latin1   |  15 |         | Yes      |       1 |</span><br><span class="line">| latin1_german2_ci        | latin1   |  31 |         | Yes      |       2 |</span><br><span class="line">| latin1_bin               | latin1   |  47 |         | Yes      |       1 |</span><br><span class="line">| latin1_general_ci        | latin1   |  48 |         | Yes      |       1 |</span><br><span class="line">| latin1_general_cs        | latin1   |  49 |         | Yes      |       1 |</span><br><span class="line">| latin1_spanish_ci        | latin1   |  94 |         | Yes      |       1 |</span><br><span class="line">| latin2_czech_cs          | latin2   |   2 |         | Yes      |       4 |</span><br><span class="line">| latin2_general_ci        | latin2   |   9 | Yes     | Yes      |       1 |</span><br><span class="line">| latin2_hungarian_ci      | latin2   |  21 |         | Yes      |       1 |</span><br><span class="line">| latin2_croatian_ci       | latin2   |  27 |         | Yes      |       1 |</span><br><span class="line">| latin2_bin               | latin2   |  77 |         | Yes      |       1 |</span><br><span class="line">| swe7_swedish_ci          | swe7     |  10 | Yes     | Yes      |       1 |</span><br><span class="line">| swe7_bin                 | swe7     |  82 |         | Yes      |       1 |</span><br><span class="line">| ascii_general_ci         | ascii    |  11 | Yes     | Yes      |       1 |</span><br><span class="line">| ascii_bin                | ascii    |  65 |         | Yes      |       1 |</span><br><span class="line">| ujis_japanese_ci         | ujis     |  12 | Yes     | Yes      |       1 |</span><br><span class="line">| ujis_bin                 | ujis     |  91 |         | Yes      |       1 |</span><br><span class="line">| sjis_japanese_ci         | sjis     |  13 | Yes     | Yes      |       1 |</span><br><span class="line">| sjis_bin                 | sjis     |  88 |         | Yes      |       1 |</span><br><span class="line">| hebrew_general_ci        | hebrew   |  16 | Yes     | Yes      |       1 |</span><br><span class="line">| hebrew_bin               | hebrew   |  71 |         | Yes      |       1 |</span><br><span class="line">| tis620_thai_ci           | tis620   |  18 | Yes     | Yes      |       4 |</span><br><span class="line">| tis620_bin               | tis620   |  89 |         | Yes      |       1 |</span><br><span class="line">| euckr_korean_ci          | euckr    |  19 | Yes     | Yes      |       1 |</span><br><span class="line">| euckr_bin                | euckr    |  85 |         | Yes      |       1 |</span><br><span class="line">| koi8u_general_ci         | koi8u    |  22 | Yes     | Yes      |       1 |</span><br><span class="line">| koi8u_bin                | koi8u    |  75 |         | Yes      |       1 |</span><br><span class="line">| gb2312_chinese_ci        | gb2312   |  24 | Yes     | Yes      |       1 |</span><br><span class="line">| gb2312_bin               | gb2312   |  86 |         | Yes      |       1 |</span><br><span class="line">| greek_general_ci         | greek    |  25 | Yes     | Yes      |       1 |</span><br><span class="line">| greek_bin                | greek    |  70 |         | Yes      |       1 |</span><br><span class="line">| cp1250_general_ci        | cp1250   |  26 | Yes     | Yes      |       1 |</span><br><span class="line">| cp1250_czech_cs          | cp1250   |  34 |         | Yes      |       2 |</span><br><span class="line">| cp1250_croatian_ci       | cp1250   |  44 |         | Yes      |       1 |</span><br><span class="line">| cp1250_bin               | cp1250   |  66 |         | Yes      |       1 |</span><br><span class="line">| cp1250_polish_ci         | cp1250   |  99 |         | Yes      |       1 |</span><br><span class="line">| gbk_chinese_ci           | gbk      |  28 | Yes     | Yes      |       1 |</span><br><span class="line">| gbk_bin                  | gbk      |  87 |         | Yes      |       1 |</span><br><span class="line">| latin5_turkish_ci        | latin5   |  30 | Yes     | Yes      |       1 |</span><br><span class="line">| latin5_bin               | latin5   |  78 |         | Yes      |       1 |</span><br><span class="line">| armscii8_general_ci      | armscii8 |  32 | Yes     | Yes      |       1 |</span><br><span class="line">| armscii8_bin             | armscii8 |  64 |         | Yes      |       1 |</span><br><span class="line">| utf8_general_ci          | utf8     |  33 | Yes     | Yes      |       1 |</span><br><span class="line">| utf8_bin                 | utf8     |  83 |         | Yes      |       1 |</span><br><span class="line">| utf8_unicode_ci          | utf8     | 192 |         | Yes      |       8 |</span><br><span class="line">| utf8_icelandic_ci        | utf8     | 193 |         | Yes      |       8 |</span><br><span class="line">| utf8_latvian_ci          | utf8     | 194 |         | Yes      |       8 |</span><br><span class="line">| utf8_romanian_ci         | utf8     | 195 |         | Yes      |       8 |</span><br><span class="line">| utf8_slovenian_ci        | utf8     | 196 |         | Yes      |       8 |</span><br><span class="line">| utf8_polish_ci           | utf8     | 197 |         | Yes      |       8 |</span><br><span class="line">| utf8_estonian_ci         | utf8     | 198 |         | Yes      |       8 |</span><br><span class="line">| utf8_spanish_ci          | utf8     | 199 |         | Yes      |       8 |</span><br><span class="line">| utf8_swedish_ci          | utf8     | 200 |         | Yes      |       8 |</span><br><span class="line">| utf8_turkish_ci          | utf8     | 201 |         | Yes      |       8 |</span><br><span class="line">| utf8_czech_ci            | utf8     | 202 |         | Yes      |       8 |</span><br><span class="line">| utf8_danish_ci           | utf8     | 203 |         | Yes      |       8 |</span><br><span class="line">| utf8_lithuanian_ci       | utf8     | 204 |         | Yes      |       8 |</span><br><span class="line">| utf8_slovak_ci           | utf8     | 205 |         | Yes      |       8 |</span><br><span class="line">| utf8_spanish2_ci         | utf8     | 206 |         | Yes      |       8 |</span><br><span class="line">| utf8_roman_ci            | utf8     | 207 |         | Yes      |       8 |</span><br><span class="line">| utf8_persian_ci          | utf8     | 208 |         | Yes      |       8 |</span><br><span class="line">| utf8_esperanto_ci        | utf8     | 209 |         | Yes      |       8 |</span><br><span class="line">| utf8_hungarian_ci        | utf8     | 210 |         | Yes      |       8 |</span><br><span class="line">| utf8_sinhala_ci          | utf8     | 211 |         | Yes      |       8 |</span><br><span class="line">| utf8_croatian_ci         | utf8     | 213 |         | Yes      |       8 |</span><br><span class="line">| utf8_general_mysql500_ci | utf8     | 223 |         | Yes      |       1 |</span><br><span class="line">| ucs2_general_ci          | ucs2     |  35 | Yes     | Yes      |       1 |</span><br><span class="line">| ucs2_bin                 | ucs2     |  90 |         | Yes      |       1 |</span><br><span class="line">| ucs2_unicode_ci          | ucs2     | 128 |         | Yes      |       8 |</span><br><span class="line">| ucs2_icelandic_ci        | ucs2     | 129 |         | Yes      |       8 |</span><br><span class="line">| ucs2_latvian_ci          | ucs2     | 130 |         | Yes      |       8 |</span><br><span class="line">| ucs2_romanian_ci         | ucs2     | 131 |         | Yes      |       8 |</span><br><span class="line">| ucs2_slovenian_ci        | ucs2     | 132 |         | Yes      |       8 |</span><br><span class="line">| ucs2_polish_ci           | ucs2     | 133 |         | Yes      |       8 |</span><br><span class="line">| ucs2_estonian_ci         | ucs2     | 134 |         | Yes      |       8 |</span><br><span class="line">| ucs2_spanish_ci          | ucs2     | 135 |         | Yes      |       8 |</span><br><span class="line">| ucs2_swedish_ci          | ucs2     | 136 |         | Yes      |       8 |</span><br><span class="line">| ucs2_turkish_ci          | ucs2     | 137 |         | Yes      |       8 |</span><br><span class="line">| ucs2_czech_ci            | ucs2     | 138 |         | Yes      |       8 |</span><br><span class="line">| ucs2_danish_ci           | ucs2     | 139 |         | Yes      |       8 |</span><br><span class="line">| ucs2_lithuanian_ci       | ucs2     | 140 |         | Yes      |       8 |</span><br><span class="line">| ucs2_slovak_ci           | ucs2     | 141 |         | Yes      |       8 |</span><br><span class="line">| ucs2_spanish2_ci         | ucs2     | 142 |         | Yes      |       8 |</span><br><span class="line">| ucs2_roman_ci            | ucs2     | 143 |         | Yes      |       8 |</span><br><span class="line">| ucs2_persian_ci          | ucs2     | 144 |         | Yes      |       8 |</span><br><span class="line">| ucs2_esperanto_ci        | ucs2     | 145 |         | Yes      |       8 |</span><br><span class="line">| ucs2_hungarian_ci        | ucs2     | 146 |         | Yes      |       8 |</span><br><span class="line">| ucs2_sinhala_ci          | ucs2     | 147 |         | Yes      |       8 |</span><br><span class="line">| ucs2_croatian_ci         | ucs2     | 149 |         | Yes      |       8 |</span><br><span class="line">| ucs2_general_mysql500_ci | ucs2     | 159 |         | Yes      |       1 |</span><br><span class="line">| cp866_general_ci         | cp866    |  36 | Yes     | Yes      |       1 |</span><br><span class="line">| cp866_bin                | cp866    |  68 |         | Yes      |       1 |</span><br><span class="line">| keybcs2_general_ci       | keybcs2  |  37 | Yes     | Yes      |       1 |</span><br><span class="line">| keybcs2_bin              | keybcs2  |  73 |         | Yes      |       1 |</span><br><span class="line">| macce_general_ci         | macce    |  38 | Yes     | Yes      |       1 |</span><br><span class="line">| macce_bin                | macce    |  43 |         | Yes      |       1 |</span><br><span class="line">| macroman_general_ci      | macroman |  39 | Yes     | Yes      |       1 |</span><br><span class="line">| macroman_bin             | macroman |  53 |         | Yes      |       1 |</span><br><span class="line">| cp852_general_ci         | cp852    |  40 | Yes     | Yes      |       1 |</span><br><span class="line">| cp852_bin                | cp852    |  81 |         | Yes      |       1 |</span><br><span class="line">| latin7_estonian_cs       | latin7   |  20 |         | Yes      |       1 |</span><br><span class="line">| latin7_general_ci        | latin7   |  41 | Yes     | Yes      |       1 |</span><br><span class="line">| latin7_general_cs        | latin7   |  42 |         | Yes      |       1 |</span><br><span class="line">| latin7_bin               | latin7   |  79 |         | Yes      |       1 |</span><br><span class="line">| utf8mb4_general_ci       | utf8mb4  |  45 | Yes     | Yes      |       1 |</span><br><span class="line">| utf8mb4_bin              | utf8mb4  |  46 |         | Yes      |       1 |</span><br><span class="line">| utf8mb4_unicode_ci       | utf8mb4  | 224 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_icelandic_ci     | utf8mb4  | 225 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_latvian_ci       | utf8mb4  | 226 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_romanian_ci      | utf8mb4  | 227 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_slovenian_ci     | utf8mb4  | 228 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_polish_ci        | utf8mb4  | 229 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_estonian_ci      | utf8mb4  | 230 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_spanish_ci       | utf8mb4  | 231 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_swedish_ci       | utf8mb4  | 232 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_turkish_ci       | utf8mb4  | 233 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_czech_ci         | utf8mb4  | 234 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_danish_ci        | utf8mb4  | 235 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_lithuanian_ci    | utf8mb4  | 236 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_slovak_ci        | utf8mb4  | 237 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_spanish2_ci      | utf8mb4  | 238 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_roman_ci         | utf8mb4  | 239 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_persian_ci       | utf8mb4  | 240 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_esperanto_ci     | utf8mb4  | 241 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_hungarian_ci     | utf8mb4  | 242 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_sinhala_ci       | utf8mb4  | 243 |         | Yes      |       8 |</span><br><span class="line">| utf8mb4_croatian_ci      | utf8mb4  | 245 |         | Yes      |       8 |</span><br><span class="line">| cp1251_bulgarian_ci      | cp1251   |  14 |         | Yes      |       1 |</span><br><span class="line">| cp1251_ukrainian_ci      | cp1251   |  23 |         | Yes      |       1 |</span><br><span class="line">| cp1251_bin               | cp1251   |  50 |         | Yes      |       1 |</span><br><span class="line">| cp1251_general_ci        | cp1251   |  51 | Yes     | Yes      |       1 |</span><br><span class="line">| cp1251_general_cs        | cp1251   |  52 |         | Yes      |       1 |</span><br><span class="line">| utf16_general_ci         | utf16    |  54 | Yes     | Yes      |       1 |</span><br><span class="line">| utf16_bin                | utf16    |  55 |         | Yes      |       1 |</span><br><span class="line">| utf16_unicode_ci         | utf16    | 101 |         | Yes      |       8 |</span><br><span class="line">| utf16_icelandic_ci       | utf16    | 102 |         | Yes      |       8 |</span><br><span class="line">| utf16_latvian_ci         | utf16    | 103 |         | Yes      |       8 |</span><br><span class="line">| utf16_romanian_ci        | utf16    | 104 |         | Yes      |       8 |</span><br><span class="line">| utf16_slovenian_ci       | utf16    | 105 |         | Yes      |       8 |</span><br><span class="line">| utf16_polish_ci          | utf16    | 106 |         | Yes      |       8 |</span><br><span class="line">| utf16_estonian_ci        | utf16    | 107 |         | Yes      |       8 |</span><br><span class="line">| utf16_spanish_ci         | utf16    | 108 |         | Yes      |       8 |</span><br><span class="line">| utf16_swedish_ci         | utf16    | 109 |         | Yes      |       8 |</span><br><span class="line">| utf16_turkish_ci         | utf16    | 110 |         | Yes      |       8 |</span><br><span class="line">| utf16_czech_ci           | utf16    | 111 |         | Yes      |       8 |</span><br><span class="line">| utf16_danish_ci          | utf16    | 112 |         | Yes      |       8 |</span><br><span class="line">| utf16_lithuanian_ci      | utf16    | 113 |         | Yes      |       8 |</span><br><span class="line">| utf16_slovak_ci          | utf16    | 114 |         | Yes      |       8 |</span><br><span class="line">| utf16_spanish2_ci        | utf16    | 115 |         | Yes      |       8 |</span><br><span class="line">| utf16_roman_ci           | utf16    | 116 |         | Yes      |       8 |</span><br><span class="line">| utf16_persian_ci         | utf16    | 117 |         | Yes      |       8 |</span><br><span class="line">| utf16_esperanto_ci       | utf16    | 118 |         | Yes      |       8 |</span><br><span class="line">| utf16_hungarian_ci       | utf16    | 119 |         | Yes      |       8 |</span><br><span class="line">| utf16_sinhala_ci         | utf16    | 120 |         | Yes      |       8 |</span><br><span class="line">| utf16_croatian_ci        | utf16    | 215 |         | Yes      |       8 |</span><br><span class="line">| cp1256_general_ci        | cp1256   |  57 | Yes     | Yes      |       1 |</span><br><span class="line">| cp1256_bin               | cp1256   |  67 |         | Yes      |       1 |</span><br><span class="line">| cp1257_lithuanian_ci     | cp1257   |  29 |         | Yes      |       1 |</span><br><span class="line">| cp1257_bin               | cp1257   |  58 |         | Yes      |       1 |</span><br><span class="line">| cp1257_general_ci        | cp1257   |  59 | Yes     | Yes      |       1 |</span><br><span class="line">| utf32_general_ci         | utf32    |  60 | Yes     | Yes      |       1 |</span><br><span class="line">| utf32_bin                | utf32    |  61 |         | Yes      |       1 |</span><br><span class="line">| utf32_unicode_ci         | utf32    | 160 |         | Yes      |       8 |</span><br><span class="line">| utf32_icelandic_ci       | utf32    | 161 |         | Yes      |       8 |</span><br><span class="line">| utf32_latvian_ci         | utf32    | 162 |         | Yes      |       8 |</span><br><span class="line">| utf32_romanian_ci        | utf32    | 163 |         | Yes      |       8 |</span><br><span class="line">| utf32_slovenian_ci       | utf32    | 164 |         | Yes      |       8 |</span><br><span class="line">| utf32_polish_ci          | utf32    | 165 |         | Yes      |       8 |</span><br><span class="line">| utf32_estonian_ci        | utf32    | 166 |         | Yes      |       8 |</span><br><span class="line">| utf32_spanish_ci         | utf32    | 167 |         | Yes      |       8 |</span><br><span class="line">| utf32_swedish_ci         | utf32    | 168 |         | Yes      |       8 |</span><br><span class="line">| utf32_turkish_ci         | utf32    | 169 |         | Yes      |       8 |</span><br><span class="line">| utf32_czech_ci           | utf32    | 170 |         | Yes      |       8 |</span><br><span class="line">| utf32_danish_ci          | utf32    | 171 |         | Yes      |       8 |</span><br><span class="line">| utf32_lithuanian_ci      | utf32    | 172 |         | Yes      |       8 |</span><br><span class="line">| utf32_slovak_ci          | utf32    | 173 |         | Yes      |       8 |</span><br><span class="line">| utf32_spanish2_ci        | utf32    | 174 |         | Yes      |       8 |</span><br><span class="line">| utf32_roman_ci           | utf32    | 175 |         | Yes      |       8 |</span><br><span class="line">| utf32_persian_ci         | utf32    | 176 |         | Yes      |       8 |</span><br><span class="line">| utf32_esperanto_ci       | utf32    | 177 |         | Yes      |       8 |</span><br><span class="line">| utf32_hungarian_ci       | utf32    | 178 |         | Yes      |       8 |</span><br><span class="line">| utf32_sinhala_ci         | utf32    | 179 |         | Yes      |       8 |</span><br><span class="line">| utf32_croatian_ci        | utf32    | 214 |         | Yes      |       8 |</span><br><span class="line">| binary                   | binary   |  63 | Yes     | Yes      |       1 |</span><br><span class="line">| geostd8_general_ci       | geostd8  |  92 | Yes     | Yes      |       1 |</span><br><span class="line">| geostd8_bin              | geostd8  |  93 |         | Yes      |       1 |</span><br><span class="line">| cp932_japanese_ci        | cp932    |  95 | Yes     | Yes      |       1 |</span><br><span class="line">| cp932_bin                | cp932    |  96 |         | Yes      |       1 |</span><br><span class="line">| eucjpms_japanese_ci      | eucjpms  |  97 | Yes     | Yes      |       1 |</span><br><span class="line">| eucjpms_bin              | eucjpms  |  98 |         | Yes      |       1 |</span><br><span class="line">+--------------------------+----------+-----+---------+----------+---------+</span><br><span class="line">202 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; show collation like '%latin1%';</span><br><span class="line">+-------------------+---------+----+---------+----------+---------+</span><br><span class="line">| Collation         | Charset | Id | Default | Compiled | Sortlen |</span><br><span class="line">+-------------------+---------+----+---------+----------+---------+</span><br><span class="line">| latin1_german1_ci | latin1  |  5 |         | Yes      |       1 |</span><br><span class="line">| latin1_swedish_ci | latin1  |  8 | Yes     | Yes      |       1 |</span><br><span class="line">| latin1_danish_ci  | latin1  | 15 |         | Yes      |       1 |</span><br><span class="line">| latin1_german2_ci | latin1  | 31 |         | Yes      |       2 |</span><br><span class="line">| latin1_bin        | latin1  | 47 |         | Yes      |       1 |</span><br><span class="line">| latin1_general_ci | latin1  | 48 |         | Yes      |       1 |</span><br><span class="line">| latin1_general_cs | latin1  | 49 |         | Yes      |       1 |</span><br><span class="line">| latin1_spanish_ci | latin1  | 94 |         | Yes      |       1 |</span><br><span class="line">+-------------------+---------+----+---------+----------+---------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ­¤è¯­å¥æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„æ ¡å¯¹,ä»¥åŠå®ƒä»¬é€‚ç”¨çš„å­—ç¬¦é›†ã€‚å¯ä»¥çœ‹åˆ°æœ‰çš„å­—ç¬¦é›†å…·æœ‰ä¸æ­¢ä¸€ç§æ ¡å¯¹ã€‚ä¾‹å¦‚, <code>latin1</code> å¯¹ä¸åŒçš„æ¬§æ´²è¯­è¨€æœ‰å‡ ç§æ ¡å¯¹,è€Œä¸”è®¸å¤šæ ¡å¯¹å‡ºç°ä¸¤æ¬¡,ä¸€æ¬¡åŒºåˆ†å¤§å°å†™(ç”± <code>_cs</code> è¡¨ç¤º),ä¸€æ¬¡ä¸åŒºåˆ†å¤§å°å†™(ç”± <code>_ci</code> è¡¨ç¤º)ã€‚</p>
<p>é€šå¸¸ç³»ç»Ÿç®¡ç†åœ¨å®‰è£…æ—¶å®šä¹‰ä¸€ä¸ªé»˜è®¤çš„å­—ç¬¦é›†å’Œæ ¡å¯¹ã€‚æ­¤å¤–,ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºæ•°æ®åº“æ—¶,æŒ‡å®šé»˜è®¤çš„å­—ç¬¦é›†å’Œæ ¡å¯¹ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸ºäº†ç¡®å®šæ‰€ç”¨çš„å­—ç¬¦é›†å’Œæ ¡å¯¹,å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥:</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; show variables like &#39;character%&#39;;</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| Variable_name            | Value                      |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| character_set_client     | utf8                       |</span><br><span class="line">| character_set_connection | utf8                       |</span><br><span class="line">| character_set_database   | latin1                     |</span><br><span class="line">| character_set_filesystem | binary                     |</span><br><span class="line">| character_set_results    | utf8                       |</span><br><span class="line">| character_set_server     | latin1                     |</span><br><span class="line">| character_set_system     | utf8                       |</span><br><span class="line">| character_sets_dir       | &#x2F;usr&#x2F;share&#x2F;mysql&#x2F;charsets&#x2F; |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; show variables like &#39;collation%&#39;;</span><br><span class="line">+----------------------+-------------------+</span><br><span class="line">| Variable_name        | Value             |</span><br><span class="line">+----------------------+-------------------+</span><br><span class="line">| collation_connection | utf8_general_ci   |</span><br><span class="line">| collation_database   | latin1_swedish_ci |</span><br><span class="line">| collation_server     | latin1_swedish_ci |</span><br><span class="line">+----------------------+-------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Š,å­—ç¬¦é›†å¾ˆå°‘æ˜¯æœåŠ¡å™¨èŒƒå›´(ç”šè‡³æ•°æ®åº“èŒƒå›´)çš„è®¾ç½®ã€‚ä¸åŒçš„è¡¨,ç”šè‡³ä¸åŒçš„åˆ—éƒ½å¯èƒ½éœ€è¦ä¸åŒçš„å­—ç¬¦é›†,è€Œä¸”ä¸¤è€…éƒ½å¯ä»¥åœ¨åˆ›å»ºè¡¨æ—¶æŒ‡å®šã€‚</p>
<blockquote>
<blockquote>
<p>ä¸ºäº†ç»™è¡¨æŒ‡å®šå­—ç¬¦é›†å’Œæ ¡å¯¹,å¯ä½¿ç”¨å¸¦å­å¥çš„ CREATE TABLE :</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create table mytable (columnn1 int,colunmn2 varchar(10)) default character set hebrew collate hebrew_general_ci;</span><br><span class="line">Query OK, 0 rows affected (0.49 sec)</span><br></pre></td></tr></table></figure>

<p>æ­¤è¯­å¥åˆ›å»ºä¸€ä¸ªåŒ…å«ä¸¤åˆ—çš„è¡¨,å¹¶ä¸”æŒ‡å®šä¸€ä¸ªå­—ç¬¦é›†å’Œä¸€ä¸ªæ ¡å¯¹é¡ºåºã€‚</p>
<p>è¿™ä¸ªä¾‹å­ä¸­æŒ‡å®šäº† CHARACTER SET å’Œ COLLATE ä¸¤è€…ã€‚ä¸€èˆ¬,MySQLå¦‚ä¸‹ç¡®å®šä½¿ç”¨ä»€ä¹ˆæ ·çš„å­—ç¬¦é›†å’Œæ ¡å¯¹ã€‚</p>
<ul>
<li>å¦‚æœæŒ‡å®š <code>CHARACTER SET</code> å’Œ <code>COLLATE</code> ä¸¤è€…,åˆ™ä½¿ç”¨è¿™äº›å€¼ã€‚</li>
<li>å¦‚æœåªæŒ‡å®š <code>CHARACTER SET</code> ,åˆ™ä½¿ç”¨æ­¤å­—ç¬¦é›†åŠå…¶é»˜è®¤çš„æ ¡å¯¹(å¦‚<code>SHOW CHARACTER SET</code> çš„ç»“æœä¸­æ‰€ç¤º)ã€‚</li>
<li>å¦‚æœæ—¢ä¸æŒ‡å®š <code>CHARACTER SET</code> ,ä¹Ÿä¸æŒ‡å®š <code>COLLATE</code> ,åˆ™ä½¿ç”¨æ•°æ®åº“é»˜è®¤ã€‚</li>
</ul>
<blockquote>
<blockquote>
<p>é™¤äº†èƒ½æŒ‡å®šå­—ç¬¦é›†å’Œæ ¡å¯¹çš„è¡¨èŒƒå›´å¤–,MySQLè¿˜å…è®¸å¯¹æ¯ä¸ªåˆ—è®¾ç½®å®ƒä»¬,å¦‚ä¸‹æ‰€ç¤º:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create table mytable1 (coln1 int,coln2 varchar(10),coln3 varchar(10) character set latin1 collate latin1_general_ci) default character set hebrew collate hebrew_general_ci;</span><br><span class="line">Query OK, 0 rows affected (0.36 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯¹æ•´ä¸ªè¡¨ä»¥åŠä¸€ä¸ªç‰¹å®šçš„åˆ—æŒ‡å®šäº† <code>CHARACTER SET</code> å’Œ <code>COLLATE</code> ã€‚</p>
<p>å¦‚å‰æ‰€è¿°,æ ¡å¯¹åœ¨å¯¹ç”¨ <code>ORDER BY</code>å­å¥æ£€ç´¢å‡ºæ¥çš„æ•°æ®æ’åºæ—¶èµ·é‡è¦çš„ä½œç”¨ã€‚å¦‚æœä½ éœ€è¦ç”¨ä¸åˆ›å»ºè¡¨æ—¶ä¸åŒçš„æ ¡å¯¹é¡ºåºæ’åºç‰¹å®šçš„ <code>SELECT</code> è¯­å¥,å¯ä»¥åœ¨ <code>SELECT</code>è¯­å¥è‡ªèº«ä¸­è¿›è¡Œ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; create table db1.t2 (name varchar(10) character set latin1 collate latin1_general_ci);</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; insert into db1.t2 values ('a'),('b'),('A'),('B');</span><br><span class="line">Query OK, 4 rows affected (0.07 sec)</span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from db1.t2;</span><br><span class="line">+------+</span><br><span class="line">| name |</span><br><span class="line">+------+</span><br><span class="line">| a    |</span><br><span class="line">| b    |</span><br><span class="line">| A    |</span><br><span class="line">| B    |</span><br><span class="line">+------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from db1.t2 order by name collate latin1_general_cs;</span><br><span class="line">+------+</span><br><span class="line">| name |</span><br><span class="line">+------+</span><br><span class="line">| A    |</span><br><span class="line">| a    |</span><br><span class="line">| B    |</span><br><span class="line">| b    |</span><br><span class="line">+------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from db1.t2 order by name;</span><br><span class="line">+------+</span><br><span class="line">| name |</span><br><span class="line">+------+</span><br><span class="line">| a    |</span><br><span class="line">| A    |</span><br><span class="line">| b    |</span><br><span class="line">| B    |</span><br><span class="line">+------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ­¤ SELECT ä½¿ç”¨ COLLATE æŒ‡å®šä¸€ä¸ªå¤‡ç”¨çš„æ ¡å¯¹é¡ºåº(åœ¨è¿™ä¸ªä¾‹å­ä¸­,ä¸ºåŒºåˆ†å¤§å°å†™çš„æ ¡å¯¹)ã€‚è¿™æ˜¾ç„¶å°†ä¼šå½±å“åˆ°ç»“æœæ’åºçš„æ¬¡åºã€‚</p>
<p><strong>ä¸´æ—¶åŒºåˆ†å¤§å°å†™</strong> ä¸Šé¢çš„ SELECT è¯­å¥æ¼”ç¤ºäº†åœ¨é€šå¸¸ä¸åŒºåˆ†å¤§å°å†™çš„è¡¨ä¸Šè¿›è¡ŒåŒºåˆ†å¤§å°å†™æœç´¢çš„ä¸€ç§æŠ€æœ¯ã€‚å½“ç„¶,åè¿‡æ¥ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<p><strong>ELECT çš„å…¶ä»– COLLATE å­å¥</strong> é™¤äº†è¿™é‡Œçœ‹åˆ°çš„åœ¨ <code>ORDER BY</code>å­å¥ ä¸­ä½¿ç”¨ä»¥å¤–, <code>COLLATE</code> è¿˜å¯ä»¥ç”¨äº <code>GROUP BY</code>ã€ <code>HAVING</code> ã€èšé›†å‡½æ•°ã€åˆ«åç­‰ã€‚</p>
<p>æœ€å,å€¼å¾—æ³¨æ„çš„æ˜¯,å¦‚æœç»å¯¹éœ€è¦,ä¸²å¯ä»¥åœ¨å­—ç¬¦é›†ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ä¸ºæ­¤,ä½¿ç”¨ Cast() æˆ– Convert ()å‡½æ•°ã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« ä¸­,æˆ‘ä»¬å­¦ä¹ äº†å­—ç¬¦é›†å’Œæ ¡å¯¹çš„åŸºç¡€çŸ¥è¯†,è¿˜å­¦ä¹ äº†å¦‚ä½•å¯¹ç‰¹å®šçš„è¡¨å’Œåˆ—å®šä¹‰å­—ç¬¦é›†å’Œæ ¡å¯¹,å¦‚ä½•åœ¨éœ€è¦æ—¶ä½¿ç”¨å¤‡ç”¨çš„æ ¡å¯¹ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h3 id="DCLè¯­è¨€"><a href="#DCLè¯­è¨€" class="headerlink" title="DCLè¯­è¨€"></a>DCLè¯­è¨€</h3><ul>
<li>DCL(Data Control Language)è¯­å¥:æ•°æ®æ§åˆ¶è¯­å¥,ç”¨äºæ§åˆ¶ä¸åŒæ•°æ®æ®µç›´æ¥çš„è®¸å¯å’Œè®¿é—®çº§åˆ«çš„è¯­å¥ã€‚è¿™äº›è¯­å¥å®šä¹‰äº†æ•°æ®åº“ã€è¡¨ã€å­—æ®µã€ç”¨æˆ·çš„è®¿é—®æƒé™å’Œå®‰å…¨çº§åˆ«ã€‚ä¸»è¦çš„è¯­å¥å…³é”®å­—åŒ…æ‹¬ grantã€revoke ç­‰ã€‚</li>
</ul>
<h4 id="å®‰å…¨ç®¡ç†"><a href="#å®‰å…¨ç®¡ç†" class="headerlink" title="å®‰å…¨ç®¡ç†"></a>å®‰å…¨ç®¡ç†</h4><p>æ•°æ®åº“æœåŠ¡å™¨é€šå¸¸åŒ…å«å…³é”®çš„æ•°æ®,ç¡®ä¿è¿™äº›æ•°æ®çš„å®‰å…¨å’Œå®Œæ•´éœ€è¦åˆ©ç”¨è®¿é—®æ§åˆ¶ã€‚æœ¬ç« å°†å­¦ä¹ MySQLçš„è®¿é—®æ§åˆ¶å’Œç”¨æˆ·ç®¡ç†ã€‚</p>
<blockquote>
<p>è®¿é—®æ§åˆ¶</p>
</blockquote>
<p>MySQLæœåŠ¡å™¨çš„å®‰å…¨åŸºç¡€æ˜¯:ç”¨æˆ·åº”è¯¥å¯¹ä»–ä»¬éœ€è¦çš„æ•°æ®å…·æœ‰é€‚å½“çš„è®¿é—®æƒ,æ—¢ä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘ã€‚æ¢å¥è¯è¯´,ç”¨æˆ·ä¸èƒ½å¯¹è¿‡å¤šçš„æ•°æ®å…·æœ‰è¿‡å¤šçš„è®¿é—®æƒã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹å†…å®¹:</p>
<ul>
<li>å¤šæ•°ç”¨æˆ·åªéœ€è¦å¯¹è¡¨è¿›è¡Œè¯»å’Œå†™,ä½†å°‘æ•°ç”¨æˆ·ç”šè‡³éœ€è¦èƒ½åˆ›å»ºå’Œåˆ é™¤è¡¨;</li>
<li>æŸäº›ç”¨æˆ·éœ€è¦è¯»è¡¨,ä½†å¯èƒ½ä¸éœ€è¦æ›´æ–°è¡¨;</li>
<li>ä½ å¯èƒ½æƒ³å…è®¸ç”¨æˆ·æ·»åŠ æ•°æ®,ä½†ä¸å…è®¸ä»–ä»¬åˆ é™¤æ•°æ®;</li>
<li>æŸäº›ç”¨æˆ·(ç®¡ç†å‘˜)å¯èƒ½éœ€è¦å¤„ç†ç”¨æˆ·è´¦å·çš„æƒé™,ä½†å¤šæ•°ç”¨æˆ·ä¸éœ€è¦;</li>
<li>ä½ å¯èƒ½æƒ³è®©ç”¨æˆ·é€šè¿‡å­˜å‚¨è¿‡ç¨‹è®¿é—®æ•°æ®,ä½†ä¸å…è®¸ä»–ä»¬ç›´æ¥è®¿é—®æ•°æ®;</li>
<li>ä½ å¯èƒ½æƒ³æ ¹æ®ç”¨æˆ·ç™»å½•çš„åœ°ç‚¹é™åˆ¶å¯¹æŸäº›åŠŸèƒ½çš„è®¿é—®ã€‚</li>
</ul>
<p>è¿™äº›éƒ½åªæ˜¯ä¾‹å­,ä½†æœ‰åŠ©äºè¯´æ˜ä¸€ä¸ªé‡è¦çš„äº‹å®,å³ä½ éœ€è¦ç»™ç”¨æˆ·æä¾›ä»–ä»¬æ‰€éœ€çš„è®¿é—®æƒ,ä¸”ä»…æä¾›ä»–ä»¬æ‰€éœ€çš„è®¿é—®æƒã€‚è¿™å°±æ˜¯æ‰€è°“çš„è®¿é—®æ§åˆ¶,ç®¡ç†è®¿é—®æ§åˆ¶éœ€è¦åˆ›å»ºå’Œç®¡ç†ç”¨æˆ·è´¦å·ã€‚</p>
<p><strong>ä½¿ç”¨MySQL Administrator</strong> MySQL Administratoræä¾›äº†ä¸€ä¸ªå›¾å½¢ç”¨æˆ·ç•Œé¢,å¯ç”¨æ¥ç®¡ç†ç”¨æˆ·åŠè´¦å·æƒé™ã€‚MySQL Administratoråœ¨å†…éƒ¨åˆ©ç”¨æœ¬ç« ä»‹ç»çš„è¯­å¥,ä½¿ä½ èƒ½äº¤äº’åœ°ã€æ–¹ä¾¿åœ°ç®¡ç†è®¿é—®æ§åˆ¶ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“,ä¸ºäº†æ‰§è¡Œæ•°æ®åº“æ“ä½œ,éœ€è¦ç™»å½•MySQLã€‚MySQLåˆ›å»ºä¸€ä¸ªåä¸º <code>root</code> çš„ç”¨æˆ·è´¦å·,å®ƒå¯¹æ•´ä¸ªMySQLæœåŠ¡å™¨å…·æœ‰å®Œå…¨çš„æ§åˆ¶ã€‚ä½ å¯èƒ½å·²ç»åœ¨æœ¬ä¹¦å„ç« çš„å­¦ä¹ ä¸­ä½¿ç”¨ root è¿›è¡Œè¿‡ç™»å½•,åœ¨å¯¹éç°å®çš„æ•°æ®åº“è¯•éªŒMySQLæ—¶,è¿™æ ·åšå¾ˆå¥½ã€‚ä¸è¿‡åœ¨ç°å®ä¸–ç•Œçš„æ—¥å¸¸å·¥ä½œä¸­,å†³ä¸èƒ½ä½¿ç”¨ <code>root</code> ã€‚åº”è¯¥åˆ›å»ºä¸€ç³»åˆ—çš„è´¦å·,æœ‰çš„ç”¨äºç®¡ç†,æœ‰çš„ä¾›ç”¨æˆ·ä½¿ç”¨,æœ‰çš„ä¾›å¼€å‘äººå‘˜ä½¿ç”¨,ç­‰ç­‰ã€‚</p>
<p><strong>é˜²æ­¢æ— æ„çš„é”™è¯¯</strong> é‡è¦çš„æ˜¯æ³¨æ„åˆ°,è®¿é—®æ§åˆ¶çš„ç›®çš„ä¸ä»…ä»…æ˜¯é˜²æ­¢ç”¨æˆ·çš„æ¶æ„ä¼å›¾ã€‚æ•°æ®æ¢¦é­‡æ›´ä¸ºå¸¸è§çš„æ˜¯æ— æ„è¯†é”™è¯¯çš„ç»“æœ,å¦‚é”™æ‰“MySQLè¯­å¥,åœ¨ä¸åˆé€‚çš„æ•°æ®åº“ä¸­æ“ä½œæˆ–å…¶ä»–ä¸€äº›ç”¨æˆ·é”™è¯¯ã€‚é€šè¿‡ä¿è¯ç”¨æˆ·ä¸èƒ½æ‰§è¡Œä»–ä»¬ä¸åº”è¯¥æ‰§è¡Œçš„è¯­å¥,è®¿é—®æ§åˆ¶æœ‰åŠ©äºé¿å…è¿™äº›æƒ…å†µçš„å‘ç”Ÿã€‚</p>
<p><strong>ä¸è¦ä½¿ç”¨ root</strong> åº”è¯¥ä¸¥è‚ƒå¯¹å¾… <code>root</code> ç™»å½•çš„ä½¿ç”¨ã€‚ä»…åœ¨ç»å¯¹éœ€è¦æ—¶ä½¿ç”¨å®ƒ(æˆ–è®¸åœ¨ä½ ä¸èƒ½ç™»å½•å…¶ä»–ç®¡ç†è´¦å·æ—¶ä½¿ç”¨)ã€‚ä¸åº”è¯¥åœ¨æ—¥å¸¸çš„MySQLæ“ä½œä¸­ä½¿ç”¨ <code>root</code>ã€‚</p>
<blockquote>
<p>ç®¡ç†ç”¨æˆ·</p>
</blockquote>
<p>MySQLç”¨æˆ·è´¦å·å’Œä¿¡æ¯å­˜å‚¨åœ¨åä¸º <code>mysql</code> çš„MySQLæ•°æ®åº“ä¸­ã€‚ä¸€èˆ¬ä¸éœ€è¦ç›´æ¥è®¿é—® <code>mysql</code> æ•°æ®åº“å’Œè¡¨(ä½ ç¨åä¼šæ˜ç™½è¿™ä¸€ç‚¹),ä½†æœ‰æ—¶éœ€è¦ç›´æ¥è®¿é—®ã€‚éœ€è¦ç›´æ¥è®¿é—®å®ƒçš„æ—¶æœºä¹‹ä¸€æ˜¯åœ¨éœ€è¦è·å¾—æ‰€æœ‰ç”¨æˆ·è´¦å·åˆ—è¡¨æ—¶ã€‚ä¸ºæ­¤,å¯ä½¿ç”¨ä»¥ä¸‹ä»£ç :</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; use mysql;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MariaDB [mysql]&gt; select user from user;</span><br><span class="line">+------+</span><br><span class="line">| user |</span><br><span class="line">+------+</span><br><span class="line">| root |</span><br><span class="line">| root |</span><br><span class="line">| root |</span><br><span class="line">|      |</span><br><span class="line">| root |</span><br><span class="line">|      |</span><br><span class="line">| root |</span><br><span class="line">+------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>mysql æ•°æ®åº“æœ‰ä¸€ä¸ªåä¸º <code>user</code> çš„è¡¨,å®ƒåŒ…å«æ‰€æœ‰ç”¨æˆ·è´¦å·ã€‚ userè¡¨æœ‰ä¸€ä¸ªåä¸º <code>user</code> çš„åˆ—,å®ƒå­˜å‚¨ç”¨æˆ·ç™»å½•åã€‚æ–°å®‰è£…çš„æœåŠ¡å™¨å¯èƒ½åªæœ‰ä¸€ä¸ªç”¨æˆ·(å¦‚è¿™é‡Œæ‰€ç¤º),è¿‡å»å»ºç«‹çš„æœåŠ¡å™¨å¯èƒ½å…·æœ‰å¾ˆå¤šç”¨æˆ·ã€‚</p>
<p><strong>ç”¨å¤šä¸ªå®¢æˆ·æœºè¿›è¡Œè¯•éªŒ</strong> è¯•éªŒå¯¹ç”¨æˆ·è´¦å·å’Œæƒé™è¿›è¡Œæ›´æ”¹çš„æœ€å¥½åŠæ³•æ˜¯æ‰“å¼€å¤šä¸ªæ•°æ®åº“å®¢æˆ·æœº(å¦‚ mysql å‘½ä»¤è¡Œå®ç”¨ç¨‹åºçš„å¤šä¸ªå‰¯æœ¬),ä¸€ä¸ªä½œä¸ºç®¡ç†ç™»å½•,å…¶ä»–ä½œä¸ºè¢«æµ‹è¯•çš„ç”¨æˆ·ç™»å½•ã€‚</p>
<p>1.åˆ›å»ºç”¨æˆ·è´¦å·</p>
<blockquote>
<blockquote>
<p>ä¸ºäº†åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·è´¦å·,ä½¿ç”¨ CREATE USER è¯­å¥,å¦‚ä¸‹æ‰€ç¤º:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [mysql]&gt; create user superman identified by 'p@$$w0rd';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>CREATE USER åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·è´¦å·ã€‚åœ¨åˆ›å»ºç”¨æˆ·è´¦å·æ—¶ä¸ä¸€å®šéœ€è¦å£ä»¤,ä¸è¿‡è¿™ä¸ªä¾‹å­ç”¨ <code>IDENTIFIED BY &#39;p@$$wOrd&#39;</code> ç»™å‡ºäº†ä¸€ä¸ªå£ä»¤ã€‚</p>
<p>å¦‚æœä½ å†æ¬¡åˆ—å‡ºç”¨æˆ·è´¦å·,å°†ä¼šåœ¨è¾“å‡ºä¸­çœ‹åˆ°æ–°è´¦å·ã€‚æŒ‡å®šæ•£åˆ—å£ä»¤ <code>IDENTIFIED BY</code> æŒ‡å®šçš„å£ä»¤ä¸ºçº¯æ–‡æœ¬, MySQLå°†åœ¨ä¿å­˜åˆ° <code>user</code> è¡¨ä¹‹å‰å¯¹å…¶è¿›è¡ŒåŠ å¯†ã€‚ä¸ºäº†ä½œä¸ºæ•£åˆ—å€¼æŒ‡å®šå£ä»¤,ä½¿ç”¨ <code>IDENTIFIED BY PASSWORD</code> ã€‚</p>
<p><strong>ä½¿ç”¨ GRANT æˆ– INSERT</strong> GRANT è¯­å¥(ç¨åä»‹ç»)ä¹Ÿå¯ä»¥åˆ›å»ºç”¨æˆ·è´¦å·,ä½†ä¸€èˆ¬æ¥è¯´ <code>CREATE USER</code> æ˜¯æœ€æ¸…æ¥šå’Œæœ€ç®€å•çš„å¥å­ã€‚æ­¤å¤–,ä¹Ÿå¯ä»¥é€šè¿‡ç›´æ¥æ’å…¥è¡Œåˆ° <code>user</code> è¡¨æ¥å¢åŠ ç”¨æˆ·,ä¸è¿‡ä¸ºå®‰å…¨èµ·è§,ä¸€èˆ¬ä¸å»ºè®®è¿™æ ·åšã€‚MySQLç”¨æ¥å­˜å‚¨ç”¨æˆ·è´¦å·ä¿¡æ¯çš„è¡¨(ä»¥åŠè¡¨æ¨¡å¼ç­‰)æä¸ºé‡è¦,å¯¹å®ƒä»¬çš„ä»»ä½•æ¯åéƒ½å¯èƒ½ä¸¥é‡åœ°ä¼¤å®³åˆ°MySQLæœåŠ¡å™¨ã€‚å› æ­¤,ç›¸å¯¹äºç›´æ¥å¤„ç†æ¥è¯´,æœ€å¥½æ˜¯ç”¨æ ‡è®°å’Œå‡½æ•°æ¥å¤„ç†è¿™äº›è¡¨ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸ºé‡æ–°å‘½åä¸€ä¸ªç”¨æˆ·è´¦å·,ä½¿ç”¨ RENAME USER è¯­å¥,å¦‚ä¸‹æ‰€ç¤º:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [mysql]&gt; rename user superman@'%' to batman;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">MariaDB [mysql]&gt; rename user batman@'%' to superman@'%';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>MySQL 5ä¹‹å‰</strong> ä»…MySQL 5æˆ–ä¹‹åçš„ç‰ˆæœ¬æ”¯æŒ <code>RENAME USER</code> ã€‚ä¸ºäº†åœ¨ä»¥å‰çš„MySQLä¸­é‡å‘½åä¸€ä¸ªç”¨æˆ·,å¯ä½¿ç”¨ <code>UPDATE</code>ç›´æ¥æ›´æ–° <code>user</code> è¡¨ã€‚</p>
<p>2.åˆ é™¤ç”¨æˆ·è´¦å·</p>
<blockquote>
<blockquote>
<p>ä¸ºäº†åˆ é™¤ä¸€ä¸ªç”¨æˆ·è´¦å·(ä»¥åŠç›¸å…³çš„æƒé™),ä½¿ç”¨ DROP USER è¯­å¥,å¦‚ä¸‹æ‰€ç¤º:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [mysql]&gt; drop user superman;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>MySQL 5ä¹‹å‰</strong> è‡ªMySQL 5ä»¥æ¥, DROP USER åˆ é™¤ç”¨æˆ·è´¦å·å’Œæ‰€æœ‰ç›¸å…³çš„è´¦å·æƒé™ã€‚åœ¨MySQL 5ä»¥å‰, DROP USER åªèƒ½ç”¨æ¥åˆ é™¤ç”¨æˆ·è´¦å·,ä¸èƒ½åˆ é™¤ç›¸å…³çš„æƒé™ã€‚å› æ­¤,å¦‚æœä½¿ç”¨æ—§ç‰ˆæœ¬çš„MySQL,éœ€è¦å…ˆç”¨ REVOKE åˆ é™¤ä¸è´¦å·ç›¸å…³çš„æƒé™,ç„¶åå†ç”¨ DROP USER åˆ é™¤è´¦å·ã€‚</p>
<p>3.è®¾ç½®è®¿é—®æƒé™</p>
<p>åœ¨åˆ›å»ºç”¨æˆ·è´¦å·å,å¿…é¡»æ¥ç€åˆ†é…è®¿é—®æƒé™ã€‚æ–°åˆ›å»ºçš„ç”¨æˆ·è´¦å·æ²¡æœ‰è®¿é—®æƒé™ã€‚å®ƒä»¬èƒ½ç™»å½•MySQL,ä½†ä¸èƒ½çœ‹åˆ°æ•°æ®,ä¸èƒ½æ‰§è¡Œä»»ä½•æ•°æ®åº“æ“ä½œã€‚</p>
<blockquote>
<blockquote>
<p>ä¸ºçœ‹åˆ°èµ‹äºˆç”¨æˆ·è´¦å·çš„æƒé™,ä½¿ç”¨ SHOW GRANTS FOR ,å¦‚ä¸‹æ‰€ç¤º:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [mysql]&gt; create user 'wonderwoman'@'172.25.0.12';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; show grants for 'wonderwoman'@'172.25.0.12';</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">| Grants for wonderwoman@172.25.0.12                |</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">| GRANT USAGE ON *.* TO 'wonderwoman'@'172.25.0.12' |</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœæ˜¾ç¤ºç”¨æˆ· <code>wonderwoman</code> æœ‰ä¸€ä¸ªæƒé™ <code>USAGE ON *.*</code> ã€‚<code>USAGE</code> è¡¨ç¤ºæ ¹æœ¬æ²¡æœ‰æƒé™(æˆ‘çŸ¥é“,è¿™ä¸å¾ˆç›´è§‚),æ‰€ä»¥,æ­¤ç»“æœè¡¨ç¤ºåœ¨ä»»æ„æ•°æ®åº“å’Œä»»æ„è¡¨ä¸Šå¯¹ä»»ä½•ä¸œè¥¿æ²¡æœ‰æƒé™ã€‚</p>
<p><strong>ç”¨æˆ·å®šä¹‰ä¸º <code>user@host</code></strong> MySQLçš„æƒé™ç”¨ç”¨æˆ·åå’Œä¸»æœºåç»“åˆå®šä¹‰ã€‚å¦‚æœä¸æŒ‡å®šä¸»æœºå,åˆ™ä½¿ç”¨é»˜è®¤çš„ä¸»æœºå <code>%</code> (æˆäºˆç”¨æˆ·è®¿é—®æƒé™è€Œä¸ç®¡ä¸»æœºå)ã€‚</p>
<p>ä¸ºè®¾ç½®æƒé™,ä½¿ç”¨ GRANT è¯­å¥ã€‚ GRANT è¦æ±‚ä½ è‡³å°‘ç»™å‡ºä»¥ä¸‹ä¿¡æ¯:</p>
<ul>
<li>è¦æˆäºˆçš„æƒé™;</li>
<li>è¢«æˆäºˆè®¿é—®æƒé™çš„æ•°æ®åº“æˆ–è¡¨;</li>
<li>ç”¨æˆ·åã€‚</li>
</ul>
<blockquote>
<blockquote>
<p>ä»¥ä¸‹ä¾‹å­ç»™å‡º GRANT çš„ç”¨æ³•:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [mysql]&gt; grant select on db1.* to 'wonderwoman'@'172.25.0.12';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; show grants for 'wonderwoman'@'172.25.0.12';</span><br><span class="line">+--------------------------------------------------------+</span><br><span class="line">| Grants for wonderwoman@172.25.0.12                     |</span><br><span class="line">+--------------------------------------------------------+</span><br><span class="line">| GRANT USAGE ON *.* TO 'wonderwoman'@'172.25.0.12'      |</span><br><span class="line">| GRANT SELECT ON `db1`.* TO 'wonderwoman'@'172.25.0.12' |</span><br><span class="line">+--------------------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ­¤ <code>GRANT</code> å…è®¸ç”¨æˆ·åœ¨ <code>db1.*</code> ( db1 æ•°æ®åº“çš„æ‰€æœ‰è¡¨)ä¸Šä½¿ç”¨ <code>SELECT</code>ã€‚é€šè¿‡åªæˆäºˆ <code>SELECT</code> è®¿é—®æƒé™,ç”¨æˆ· <code>wonderwoman</code>å¯¹ <code>db1</code> æ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®å…·æœ‰åªè¯»è®¿é—®æƒé™ã€‚</p>
<p>æ¯ä¸ª <code>GRANT</code> æ·»åŠ (æˆ–æ›´æ–°)ç”¨æˆ·çš„ä¸€ä¸ªæƒé™ã€‚MySQLè¯»å–æ‰€æœ‰æˆæƒ,å¹¶æ ¹æ®å®ƒä»¬ç¡®å®šæƒé™ã€‚</p>
<blockquote>
<blockquote>
<p><code>GRANT</code> çš„åæ“ä½œä¸º <code>REVOKE</code> ,ç”¨å®ƒæ¥æ’¤é”€ç‰¹å®šçš„æƒé™ã€‚ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [mysql]&gt; revoke select on db1.* from 'wonderwoman'@'172.25.0.12';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; show grants for 'wonderwoman'@'172.25.0.12';</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">| Grants for wonderwoman@172.25.0.12                |</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">| GRANT USAGE ON *.* TO 'wonderwoman'@'172.25.0.12' |</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡ <code>REVOKE</code> è¯­å¥å–æ¶ˆåˆšèµ‹äºˆç”¨æˆ· <code>wonderwoman</code> çš„ <code>SELECT</code> è®¿é—®æƒé™ã€‚è¢«æ’¤é”€çš„è®¿é—®æƒé™å¿…é¡»å­˜åœ¨,å¦åˆ™ä¼šå‡ºé”™ã€‚</p>
<p>GRANT å’Œ REVOKE å¯åœ¨å‡ ä¸ªå±‚æ¬¡ä¸Šæ§åˆ¶è®¿é—®æƒé™:</p>
<ul>
<li>æ•´ä¸ªæœåŠ¡å™¨,ä½¿ç”¨ GRANT ALL å’Œ REVOKE ALL;</li>
<li>æ•´ä¸ªæ•°æ®åº“,ä½¿ç”¨ ON database.*;</li>
<li>ç‰¹å®šçš„è¡¨,ä½¿ç”¨ ON database.table;</li>
<li>ç‰¹å®šçš„åˆ—;</li>
<li>ç‰¹å®šçš„å­˜å‚¨è¿‡ç¨‹ã€‚</li>
</ul>
<p>ä¸‹è¡¨åˆ—å‡ºå¯ä»¥æˆäºˆæˆ–æ’¤é”€çš„æ¯ä¸ªæƒé™ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æƒé™</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ALL</td>
<td align="left">é™¤GRANT OPTIONå¤–çš„æ‰€æœ‰æƒé™</td>
</tr>
<tr>
<td align="left">ALTER</td>
<td align="left">ä½¿ç”¨ALTER TABLE</td>
</tr>
<tr>
<td align="left">ALTER ROUTINE</td>
<td align="left">ä½¿ç”¨ALTER PROCEDUREå’ŒDROP PROCEDURE</td>
</tr>
<tr>
<td align="left">CREATE</td>
<td align="left">ä½¿ç”¨CREATE TABLE</td>
</tr>
<tr>
<td align="left">CREATE ROUTINE</td>
<td align="left">ä½¿ç”¨CREATE PROCEDURE</td>
</tr>
<tr>
<td align="left">CREATE TEMPORARY TABLES</td>
<td align="left">ä½¿ç”¨CREATE TEMPORARY TABLE</td>
</tr>
<tr>
<td align="left">CREATE USER</td>
<td align="left">ä½¿ç”¨CREATE USERã€ DROP USERã€ RENAME USERå’ŒREVOKE ALL PRIVILEGES</td>
</tr>
<tr>
<td align="left">CREATE VIEW</td>
<td align="left">ä½¿ç”¨CREATE VIEW</td>
</tr>
<tr>
<td align="left">DELETE</td>
<td align="left">ä½¿ç”¨DELETE</td>
</tr>
<tr>
<td align="left">DROP</td>
<td align="left">ä½¿ç”¨DROP TABLE</td>
</tr>
<tr>
<td align="left">EXECUTE</td>
<td align="left">ä½¿ç”¨CALLå’Œå­˜å‚¨è¿‡ç¨‹</td>
</tr>
<tr>
<td align="left">FILE</td>
<td align="left">ä½¿ç”¨SELECT INTO OUTFILEå’ŒLOAD DATA INFILE</td>
</tr>
<tr>
<td align="left">GRANT OPTION</td>
<td align="left">ä½¿ç”¨GRANTå’ŒREVOKE</td>
</tr>
<tr>
<td align="left">INDEX</td>
<td align="left">ä½¿ç”¨CREATE INDEXå’ŒDROP INDEX</td>
</tr>
<tr>
<td align="left">INSERT</td>
<td align="left">ä½¿ç”¨INSERT</td>
</tr>
<tr>
<td align="left">LOCK TABLES</td>
<td align="left">ä½¿ç”¨LOCK TABLES</td>
</tr>
<tr>
<td align="left">PROCESS</td>
<td align="left">ä½¿ç”¨SHOW FULL PROCESSLIST</td>
</tr>
<tr>
<td align="left">RELOAD</td>
<td align="left">ä½¿ç”¨FLUSH</td>
</tr>
<tr>
<td align="left">REPLICATION CLIENT</td>
<td align="left">æœåŠ¡å™¨ä½ç½®çš„è®¿é—®</td>
</tr>
<tr>
<td align="left">REPLICATION SLAVE</td>
<td align="left">ç”±å¤åˆ¶ä»å±ä½¿ç”¨</td>
</tr>
<tr>
<td align="left">SELECT</td>
<td align="left">ä½¿ç”¨SELECT</td>
</tr>
<tr>
<td align="left">SHOW DATABASES</td>
<td align="left">ä½¿ç”¨SHOW DATABASES</td>
</tr>
<tr>
<td align="left">SHOW VIEW</td>
<td align="left">ä½¿ç”¨SHOW CREATE VIEW</td>
</tr>
<tr>
<td align="left">SHUTDOWN</td>
<td align="left">ä½¿ç”¨mysqladmin shutdown(ç”¨æ¥å…³é—­MySQL)</td>
</tr>
<tr>
<td align="left">SUPER</td>
<td align="left">ä½¿ç”¨CHANGE MASTERã€KILLã€LOGSã€PURGEã€MASTERå’ŒSET GLOBALã€‚è¿˜å…è®¸mysqladminè°ƒè¯•ç™»å½•</td>
</tr>
<tr>
<td align="left">UPDATE</td>
<td align="left">ä½¿ç”¨UPDATE</td>
</tr>
<tr>
<td align="left">USAGE</td>
<td align="left">æ— è®¿é—®æƒé™</td>
</tr>
</tbody></table>
<p>ä½¿ç”¨ GRANT å’Œ REVOKE ,å†ç»“åˆä¸Šè¡¨ä¸­åˆ—å‡ºçš„æƒé™,ä½ èƒ½å¯¹ç”¨æˆ·å¯ä»¥å°±ä½ çš„å®è´µæ•°æ®åšä»€ä¹ˆäº‹æƒ…å’Œä¸èƒ½åšä»€ä¹ˆäº‹æƒ…å…·æœ‰å®Œå…¨çš„æ§åˆ¶ã€‚</p>
<p><strong>æœªæ¥çš„æˆæƒ</strong> åœ¨ä½¿ç”¨ GRANT å’Œ REVOKE æ—¶,ç”¨æˆ·è´¦å·å¿…é¡»å­˜åœ¨,ä½†å¯¹æ‰€æ¶‰åŠçš„å¯¹è±¡æ²¡æœ‰è¿™ä¸ªè¦æ±‚ã€‚è¿™å…è®¸ç®¡ç†å‘˜åœ¨åˆ›å»ºæ•°æ®åº“å’Œè¡¨ä¹‹å‰è®¾è®¡å’Œå®ç°å®‰å…¨æªæ–½ã€‚</p>
<p>è¿™æ ·åšçš„å‰¯ä½œç”¨æ˜¯,å½“æŸä¸ªæ•°æ®åº“æˆ–è¡¨è¢«åˆ é™¤æ—¶(ç”¨ DROP è¯­å¥),ç›¸å…³çš„è®¿é—®æƒé™ä»ç„¶å­˜åœ¨ã€‚è€Œä¸”,å¦‚æœå°†æ¥é‡æ–°åˆ›å»ºè¯¥æ•°æ®åº“æˆ–è¡¨,è¿™äº›æƒé™ä»ç„¶èµ·ä½œç”¨ã€‚</p>
<p><strong>ç®€åŒ–å¤šæ¬¡æˆæƒ</strong> å¯é€šè¿‡åˆ—å‡ºå„æƒé™å¹¶ç”¨é€—å·åˆ†éš”,å°†å¤šæ¡GRANT è¯­å¥ä¸²åœ¨ä¸€èµ·,å¦‚ä¸‹æ‰€ç¤º:<code>grant select,insert on db1.* to &#39;wonderwoman&#39;@&#39;172.25.0.12&#39;;</code></p>
<p>4.æ›´æ”¹å£ä»¤</p>
<blockquote>
<blockquote>
<p>ä¸ºäº†æ›´æ”¹ç”¨æˆ·å£ä»¤,å¯ä½¿ç”¨ SET PASSWORD è¯­å¥ã€‚æ–°å£ä»¤å¿…é¡»å¦‚ä¸‹åŠ å¯†:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [mysql]&gt; create user bforta;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; set password for bforta = password('uplooking');</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>SET PASSWORD æ›´æ–°ç”¨æˆ·å£ä»¤ã€‚æ–°å£ä»¤å¿…é¡»ä¼ é€’åˆ° Password() å‡½æ•°è¿›è¡ŒåŠ å¯†ã€‚</p>
<p>SET PASSWORD è¿˜å¯ä»¥ç”¨æ¥è®¾ç½®ä½ è‡ªå·±çš„å£ä»¤:<code>set password = password(&#39;uplooking&#39;);</code></p>
<p>åœ¨ä¸æŒ‡å®šç”¨æˆ·åæ—¶, SET PASSWORD æ›´æ–°å½“å‰ç™»å½•ç”¨æˆ·çš„å£ä»¤ã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« å­¦ä¹ äº†é€šè¿‡èµ‹äºˆç”¨æˆ·ç‰¹æ®Šçš„æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶å’Œä¿æŠ¤MySQLæœåŠ¡å™¨ã€‚</p>
</blockquote>
</blockquote>
<h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><h4 id="MySQLè¯­å¥çš„è¯­æ³•"><a href="#MySQLè¯­å¥çš„è¯­æ³•" class="headerlink" title="MySQLè¯­å¥çš„è¯­æ³•"></a>MySQLè¯­å¥çš„è¯­æ³•</h4><blockquote>
<p>é€šè¿‡å¸®åŠ©å¯ä»¥æŸ¥çœ‹mysqlçš„è¯­æ³•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [mysql]&gt; help;</span><br><span class="line"></span><br><span class="line">General information about MariaDB can be found at</span><br><span class="line">http://mariadb.org</span><br><span class="line"></span><br><span class="line">List of all MySQL commands:</span><br><span class="line">Note that all text commands must be first on line and end with ';'</span><br><span class="line">?         (\?) Synonym for `help'.</span><br><span class="line">clear     (\c) Clear the current input statement.</span><br><span class="line">connect   (\r) Reconnect to the server. Optional arguments are db and host.</span><br><span class="line">delimiter (\d) Set statement delimiter.</span><br><span class="line">edit      (\e) Edit command with $EDITOR.</span><br><span class="line">ego       (\G) Send command to mysql server, display result vertically.</span><br><span class="line">exit      (\q) Exit mysql. Same as quit.</span><br><span class="line">go        (\g) Send command to mysql server.</span><br><span class="line">help      (\h) Display this help.</span><br><span class="line">nopager   (\n) Disable pager, print to stdout.</span><br><span class="line">notee     (\t) Don't write into outfile.</span><br><span class="line">pager     (\P) Set PAGER [to_pager]. Print the query results via PAGER.</span><br><span class="line">print     (\p) Print current command.</span><br><span class="line">prompt    (\R) Change your mysql prompt.</span><br><span class="line">quit      (\q) Quit mysql.</span><br><span class="line">rehash    (#) Rebuild completion hash.</span><br><span class="line">rehash    (#) Rebuild completion hash.</span><br><span class="line">source    (\.) Execute an SQL script file. Takes a file name as an argument.</span><br><span class="line">status    (\s) Get status information from the server.</span><br><span class="line">system    (\!) Execute a system shell command.</span><br><span class="line">tee       (\T) Set outfile [to_outfile]. Append everything into given outfile.</span><br><span class="line">use       (\u) Use another database. Takes database name as argument.</span><br><span class="line">charset   (\C) Switch to another charset. Might be needed for processing binlog with multi-byte charsets.</span><br><span class="line">warnings  (\W) Show warnings after every statement.</span><br><span class="line">nowarning (\w) Don't show warnings after every statement.</span><br><span class="line"></span><br><span class="line">For server side help, type 'help contents'</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æŸ¥çœ‹<code>create</code>å’Œ<code>create database</code>çš„å¸®åŠ©</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [mysql]&gt; help create;</span><br><span class="line">Many help items for your request exist.</span><br><span class="line">To make a more specific request, please type 'help &lt;item&gt;',</span><br><span class="line">where &lt;item&gt; is one of the following</span><br><span class="line">topics:</span><br><span class="line">   CREATE DATABASE</span><br><span class="line">   CREATE EVENT</span><br><span class="line">   CREATE FUNCTION</span><br><span class="line">   CREATE FUNCTION UDF</span><br><span class="line">   CREATE INDEX</span><br><span class="line">   CREATE PROCEDURE</span><br><span class="line">   CREATE SERVER</span><br><span class="line">   CREATE TABLE</span><br><span class="line">   CREATE TABLESPACE</span><br><span class="line">   CREATE TRIGGER</span><br><span class="line">   CREATE USER</span><br><span class="line">   CREATE VIEW</span><br><span class="line">   SHOW</span><br><span class="line">   SHOW CREATE DATABASE</span><br><span class="line">   SHOW CREATE EVENT</span><br><span class="line">   SHOW CREATE FUNCTION</span><br><span class="line">   SHOW CREATE PROCEDURE</span><br><span class="line">   SHOW CREATE TABLE</span><br><span class="line">   SPATIAL</span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; help create database;</span><br><span class="line">Name: 'CREATE DATABASE'</span><br><span class="line">Description:</span><br><span class="line">Syntax:</span><br><span class="line">CREATE &#123;DATABASE | SCHEMA&#125; [IF NOT EXISTS] db_name</span><br><span class="line">    [create_specification] ...</span><br><span class="line"></span><br><span class="line">create_specification:</span><br><span class="line">    [DEFAULT] CHARACTER SET [=] charset_name</span><br><span class="line">  | [DEFAULT] COLLATE [=] collation_name</span><br><span class="line"></span><br><span class="line">CREATE DATABASE creates a database with the given name. To use this</span><br><span class="line">statement, you need the CREATE privilege for the database. CREATE</span><br><span class="line">SCHEMA is a synonym for CREATE DATABASE.</span><br><span class="line"></span><br><span class="line">URL: http://dev.mysql.com/doc/refman/5.5/en/create-database.html</span><br></pre></td></tr></table></figure>

<p>ä¸‹è¡¨ç½—åˆ—å‡ºå¸¸è§çš„DDLã€DMLã€DCLã€DQLçš„ç”¨æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DDL	æ•°æ®åº“å®šä¹‰è¯­è¨€	create\drop\alter</span><br><span class="line"></span><br><span class="line">      create database [dbname];</span><br><span class="line">      drop database [dbname];</span><br><span class="line">      create table [tbname] (col1 type,col2 type,col3....);</span><br><span class="line">      drop table [tbname];</span><br><span class="line"></span><br><span class="line">DML	æ•°æ®åº“æ“ä½œè¯­è¨€	insert into\delete from\update</span><br><span class="line">      insert into [tbname] set col1&#x3D;value,col2&#x3D;value,col3&#x3D;value;</span><br><span class="line">      insert into [tbname] values (1,&#39;booboo&#39;),(2,&#39;batman&#39;),(3,&#39;superman&#39;);</span><br><span class="line">      insert into [tbname] (name,id) values ();</span><br><span class="line">      delete from [tbname] where id&#x3D;1 and name&#x3D;&#39;booboo&#39;;</span><br><span class="line">      update [tbname] set col&#x3D;&#39;superman&#39; where id&#x3D;2;</span><br><span class="line"></span><br><span class="line">DCL	æ•°æ®åº“æ§åˆ¶è¯­è¨€	grant revoke</span><br><span class="line">      è®¤è¯ + æˆæƒ</span><br><span class="line">      grant all on *.* to booboo@&#39;172.25.0.11&#39; identified by &#39;uplooking&#39;;</span><br><span class="line">        all æƒé™</span><br><span class="line">        *.* åº“.è¡¨</span><br><span class="line">      flush privileges; åˆ·æ–°æˆæƒè¡¨</span><br><span class="line">      revoke [æƒé™] on [åº“].[è¡¨] from booboo@&#39;172.25.0.11&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DQL	æ•°æ®åº“æŸ¥è¯¢è¯­è¨€	show databases;</span><br><span class="line">      use mysql;</span><br><span class="line">      show tables;</span><br><span class="line">      desc mysql.user;</span><br><span class="line">      select * from db1.t1;</span><br></pre></td></tr></table></figure>


<h4 id="MySQLæ•°æ®ç±»å‹"><a href="#MySQLæ•°æ®ç±»å‹" class="headerlink" title="MySQLæ•°æ®ç±»å‹"></a>MySQLæ•°æ®ç±»å‹</h4><p>æ•°æ®ç±»å‹æ˜¯å®šä¹‰åˆ—ä¸­å¯ä»¥å­˜å‚¨ä»€ä¹ˆæ•°æ®ä»¥åŠè¯¥æ•°æ®å®é™…æ€æ ·å­˜å‚¨çš„åŸºæœ¬è§„åˆ™ã€‚</p>
<p>æ•°æ®ç±»å‹ç”¨äºä»¥ä¸‹ç›®çš„ã€‚</p>
<ul>
<li>æ•°æ®ç±»å‹å…è®¸é™åˆ¶å¯å­˜å‚¨åœ¨åˆ—ä¸­çš„æ•°æ®ã€‚ä¾‹å¦‚,æ•°å€¼æ•°æ®ç±»å‹åˆ—åªèƒ½æ¥å—æ•°å€¼ã€‚</li>
<li>æ•°æ®ç±»å‹å…è®¸åœ¨å†…éƒ¨æ›´æœ‰æ•ˆåœ°å­˜å‚¨æ•°æ®ã€‚å¯ä»¥ç”¨ä¸€ç§æ¯”æ–‡æœ¬ä¸²æ›´ç®€æ´çš„æ ¼å¼å­˜å‚¨æ•°å€¼å’Œæ—¥æœŸæ—¶é—´å€¼ã€‚</li>
<li>æ•°æ®ç±»å‹å…è®¸å˜æ¢æ’åºé¡ºåºã€‚å¦‚æœæ‰€æœ‰æ•°æ®éƒ½ä½œä¸ºä¸²å¤„ç†,åˆ™1ä½äº10ä¹‹å‰,è€Œ10åˆä½äº2ä¹‹å‰(ä¸²ä»¥å­—å…¸é¡ºåºæ’åº,ä»å·¦è¾¹å¼€å§‹æ¯”è¾ƒ,ä¸€æ¬¡ä¸€ä¸ªå­—ç¬¦)ã€‚ä½œä¸ºæ•°å€¼æ•°æ®ç±»å‹,æ•°å€¼æ‰èƒ½æ­£ç¡®æ’åºã€‚</li>
</ul>
<p>åœ¨è®¾è®¡è¡¨æ—¶,åº”è¯¥ç‰¹åˆ«é‡è§†æ‰€ç”¨çš„æ•°æ®ç±»å‹ã€‚ä½¿ç”¨é”™è¯¯çš„æ•°æ®ç±»å‹å¯èƒ½ä¼šä¸¥é‡åœ°å½±å“åº”ç”¨ç¨‹åºçš„åŠŸèƒ½å’Œæ€§èƒ½ã€‚æ›´æ”¹åŒ…å«æ•°æ®çš„åˆ—ä¸æ˜¯ä¸€ä»¶å°äº‹(è€Œä¸”è¿™æ ·åšå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±)ã€‚</p>
<p>æœ¬ç« è™½ç„¶ä¸æ˜¯å…³äºæ•°æ®ç±»å‹åŠå…¶å¦‚ä½•ä½¿ç”¨çš„ä¸€ä¸ªå®Œæ•´çš„æ•™æ,ä½†ä»‹ç»äº†MySQLä¸»è¦çš„æ•°æ®ç±»å‹å’Œç”¨é€”ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸²æ•°æ®ç±»å‹</p>
</blockquote>
</blockquote>
<p>æœ€å¸¸ç”¨çš„æ•°æ®ç±»å‹æ˜¯ä¸²æ•°æ®ç±»å‹ã€‚å®ƒä»¬å­˜å‚¨ä¸²,å¦‚åå­—ã€åœ°å€ã€ç”µè¯å·ç ã€é‚®æ”¿ç¼–ç ç­‰ã€‚æœ‰ä¸¤ç§åŸºæœ¬çš„ä¸²ç±»å‹,åˆ†åˆ«ä¸ºå®šé•¿ä¸²å’Œå˜é•¿ä¸²ã€‚</p>
<ul>
<li><p>å®šé•¿ä¸²æ¥å—é•¿åº¦å›ºå®šçš„å­—ç¬¦ä¸²,å…¶é•¿åº¦æ˜¯åœ¨åˆ›å»ºè¡¨æ—¶æŒ‡å®šçš„ã€‚ä¾‹å¦‚,åå­—åˆ—å¯å…è®¸30ä¸ªå­—ç¬¦,è€Œç¤¾ä¼šå®‰å…¨å·åˆ—å…è®¸11ä¸ªå­—ç¬¦(å…è®¸çš„å­—ç¬¦æ•°ç›®ä¸­åŒ…æ‹¬ä¸¤ä¸ªç ´æŠ˜å·)ã€‚å®šé•¿åˆ—ä¸å…è®¸å¤šäºæŒ‡å®šçš„å­—ç¬¦æ•°ç›®ã€‚å®ƒä»¬åˆ†é…çš„å­˜å‚¨ç©ºé—´ä¸æŒ‡å®šçš„ä¸€æ ·å¤šã€‚å› æ­¤,å¦‚æœä¸² Ben å­˜å‚¨åˆ°30ä¸ªå­—ç¬¦çš„åå­—å­—æ®µ,åˆ™å­˜å‚¨çš„æ˜¯30ä¸ªå­—ç¬¦, CHAR å±äºå®šé•¿ä¸²ç±»å‹ã€‚</p>
</li>
<li><p>å˜é•¿ä¸²å­˜å‚¨å¯å˜é•¿åº¦çš„æ–‡æœ¬ã€‚æœ‰äº›å˜é•¿æ•°æ®ç±»å‹å…·æœ‰æœ€å¤§çš„å®šé•¿,è€Œæœ‰äº›åˆ™æ˜¯å®Œå…¨å˜é•¿çš„ã€‚ä¸ç®¡æ˜¯å“ªç§,åªæœ‰æŒ‡å®šçš„æ•°æ®å¾—åˆ°ä¿å­˜(é¢å¤–çš„æ•°æ®ä¸ä¿å­˜) TEXT å±äºå˜é•¿ä¸²ç±»å‹ã€‚</p>
</li>
</ul>
<p>æ—¢ç„¶å˜é•¿æ•°æ®ç±»å‹è¿™æ ·çµæ´»,ä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨å®šé•¿æ•°æ®ç±»å‹?å›ç­”æ˜¯å› ä¸ºæ€§èƒ½ã€‚MySQLå¤„ç†å®šé•¿åˆ—è¿œæ¯”å¤„ç†å˜é•¿åˆ—å¿«å¾—å¤šã€‚æ­¤å¤–,MySQLä¸å…è®¸å¯¹å˜é•¿åˆ—(æˆ–ä¸€ä¸ªåˆ—çš„å¯å˜éƒ¨åˆ†)è¿›è¡Œç´¢å¼•ã€‚è¿™ä¹Ÿä¼šæå¤§åœ°å½±å“æ€§èƒ½ã€‚</p>
<table>
<thead>
<tr>
<th align="left">ä¸²æ•°æ®ç±»å‹</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CHAR</td>
<td align="left">1~255ä¸ªå­—ç¬¦çš„å®šé•¿ä¸²ã€‚å®ƒçš„é•¿åº¦å¿…é¡»åœ¨åˆ›å»ºæ—¶æŒ‡å®š,å¦åˆ™MySQLå‡å®šä¸ºCHAR(1)</td>
</tr>
<tr>
<td align="left">ENUM</td>
<td align="left">æ¥å—æœ€å¤š64 Kä¸ªä¸²ç»„æˆçš„ä¸€ä¸ªé¢„å®šä¹‰é›†åˆçš„æŸä¸ªä¸²</td>
</tr>
<tr>
<td align="left">LONGTEXT</td>
<td align="left">ä¸TEXTç›¸åŒ,ä½†æœ€å¤§é•¿åº¦ä¸º4 GB</td>
</tr>
<tr>
<td align="left">MEDIUMTEXT</td>
<td align="left">ä¸TEXTç›¸åŒ,ä½†æœ€å¤§é•¿åº¦ä¸º16 K</td>
</tr>
<tr>
<td align="left">SET</td>
<td align="left">æ¥å—æœ€å¤š64ä¸ªä¸²ç»„æˆçš„ä¸€ä¸ªé¢„å®šä¹‰é›†åˆçš„é›¶ä¸ªæˆ–å¤šä¸ªä¸²</td>
</tr>
<tr>
<td align="left">TEXT</td>
<td align="left">æœ€å¤§é•¿åº¦ä¸º64 Kçš„å˜é•¿æ–‡æœ¬</td>
</tr>
<tr>
<td align="left">TINYTEXT</td>
<td align="left">ä¸TEXTç›¸åŒ,ä½†æœ€å¤§é•¿åº¦ä¸º255å­—èŠ‚</td>
</tr>
<tr>
<td align="left">VARCHAR</td>
<td align="left">é•¿åº¦å¯å˜,æœ€å¤šä¸è¶…è¿‡255å­—èŠ‚ã€‚å¦‚æœåœ¨åˆ›å»ºæ—¶æŒ‡å®šä¸ºVARCHAR(n),åˆ™å¯å­˜å‚¨0åˆ°nä¸ªå­—ç¬¦çš„å˜é•¿ä¸²(å…¶ä¸­nâ‰¤255)</td>
</tr>
</tbody></table>
<p><strong>ä½¿ç”¨å¼•å·</strong> ä¸ç®¡ä½¿ç”¨ä½•ç§å½¢å¼çš„ä¸²æ•°æ®ç±»å‹,ä¸²å€¼éƒ½å¿…é¡»æ‹¬åœ¨å¼•å·å†…(é€šå¸¸å•å¼•å·æ›´å¥½)ã€‚</p>
<p><strong>å½“æ•°å€¼ä¸æ˜¯æ•°å€¼æ—¶</strong> ä½ å¯èƒ½ä¼šè®¤ä¸ºç”µè¯å·ç å’Œé‚®æ”¿ç¼–ç åº”è¯¥å­˜å‚¨åœ¨æ•°å€¼å­—æ®µä¸­(æ•°å€¼å­—æ®µåªå­˜å‚¨æ•°å€¼æ•°æ®),ä½†æ˜¯,è¿™æ ·åšå´æ˜¯ä¸å¯å–çš„ã€‚å¦‚æœåœ¨æ•°å€¼å­—æ®µä¸­å­˜å‚¨é‚®æ”¿ç¼–ç 01234,åˆ™ä¿å­˜çš„å°†æ˜¯æ•°å€¼1234,å®é™…ä¸Šä¸¢å¤±äº†ä¸€ä½æ•°å­—ã€‚</p>
<p>éœ€è¦éµå®ˆçš„åŸºæœ¬è§„åˆ™æ˜¯:å¦‚æœæ•°å€¼æ˜¯è®¡ç®—(æ±‚å’Œã€å¹³å‡ç­‰)ä¸­ä½¿ç”¨çš„æ•°å€¼,åˆ™åº”è¯¥å­˜å‚¨åœ¨æ•°å€¼æ•°æ®ç±»å‹åˆ—ä¸­ã€‚å¦‚æœä½œä¸ºå­—ç¬¦ä¸²(å¯èƒ½åªåŒ…å«æ•°å­—)ä½¿ç”¨,åˆ™åº”è¯¥ä¿å­˜åœ¨ä¸²æ•°æ®ç±»å‹åˆ—ä¸­ã€‚</p>
<blockquote>
<p>æ•°å€¼æ•°æ®ç±»å‹</p>
</blockquote>
<p>æ•°å€¼æ•°æ®ç±»å‹å­˜å‚¨æ•°å€¼ã€‚MySQLæ”¯æŒå¤šç§æ•°å€¼æ•°æ®ç±»å‹,æ¯ç§å­˜å‚¨çš„æ•°å€¼å…·æœ‰ä¸åŒçš„å–å€¼èŒƒå›´ã€‚æ˜¾ç„¶,æ”¯æŒçš„å–å€¼èŒƒå›´è¶Šå¤§,æ‰€éœ€å­˜å‚¨ç©ºé—´è¶Šå¤šã€‚æ­¤å¤–,æœ‰çš„æ•°å€¼æ•°æ®ç±»å‹æ”¯æŒä½¿ç”¨åè¿›åˆ¶å°æ•°ç‚¹(å’Œå°æ•°),è€Œæœ‰çš„åˆ™åªæ”¯æŒæ•´æ•°ã€‚ä¸‹è¡¨åˆ—å‡ºäº†å¸¸ç”¨çš„MySQLæ•°å€¼æ•°æ®ç±»å‹ã€‚</p>
<p><strong>æœ‰ç¬¦å·æˆ–æ— ç¬¦å·</strong> æ‰€æœ‰æ•°å€¼æ•°æ®ç±»å‹(é™¤ <code>BIT</code> å’Œ <code>BOOLEAN</code> å¤–)éƒ½å¯ä»¥æœ‰ç¬¦å·æˆ–æ— ç¬¦å·ã€‚æœ‰ç¬¦å·æ•°å€¼åˆ—å¯ä»¥å­˜å‚¨æ­£æˆ–è´Ÿçš„æ•°å€¼,æ— ç¬¦å·æ•°å€¼åˆ—åªèƒ½å­˜å‚¨æ­£æ•°ã€‚é»˜è®¤æƒ…å†µä¸ºæœ‰ç¬¦å·,ä½†å¦‚æœä½ çŸ¥é“è‡ªå·±ä¸éœ€è¦å­˜å‚¨è´Ÿå€¼,å¯ä»¥ä½¿ç”¨ <code>UNSIGNED</code> å…³é”®å­—,è¿™æ ·åšå°†å…è®¸ä½ å­˜å‚¨ä¸¤å€å¤§å°çš„å€¼ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æ•°å€¼æ•°æ®ç±»å‹</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">BIT</td>
<td align="left">ä½å­—æ®µ,1~64ä½ã€‚(åœ¨MySQL 5ä¹‹å‰,BITåœ¨åŠŸèƒ½ä¸Šç­‰ä»·äºTINYINT</td>
</tr>
<tr>
<td align="left">BIGINT</td>
<td align="left">æ•´æ•°å€¼,æ”¯æŒï€­9223372036854775808<del>9223372036854775807(å¦‚æœæ˜¯UNSIGNED,ä¸º0</del>18446744073709551615)çš„æ•°</td>
</tr>
<tr>
<td align="left">BOOLEAN(æˆ–BOOL)</td>
<td align="left">å¸ƒå°”æ ‡å¿—,æˆ–è€…ä¸º0æˆ–è€…ä¸º1,ä¸»è¦ç”¨äºå¼€/å…³(on/off)æ ‡å¿—</td>
</tr>
<tr>
<td align="left">DECIMAL(æˆ–DEC)</td>
<td align="left">ç²¾åº¦å¯å˜çš„æµ®ç‚¹å€¼</td>
</tr>
<tr>
<td align="left">DOUBLE</td>
<td align="left">åŒç²¾åº¦æµ®ç‚¹å€¼</td>
</tr>
<tr>
<td align="left">FLOAT</td>
<td align="left">å•ç²¾åº¦æµ®ç‚¹å€¼</td>
</tr>
<tr>
<td align="left">INT(æˆ–INTEGER)</td>
<td align="left">æ•´æ•°å€¼,æ”¯æŒï€­2147483648<del>2147483647 (å¦‚æœæ˜¯UNSIGNED,ä¸º0</del>4294967295)çš„æ•°</td>
</tr>
<tr>
<td align="left">MEDIUMINT</td>
<td align="left">æ•´æ•°å€¼,æ”¯æŒï€­8388608<del>8388607(å¦‚æœæ˜¯UNSIGNED,ä¸º0</del>16777215)çš„æ•°</td>
</tr>
<tr>
<td align="left">REAL</td>
<td align="left">4å­—èŠ‚çš„æµ®ç‚¹å€¼</td>
</tr>
<tr>
<td align="left">SMALLINT</td>
<td align="left">æ•´æ•°å€¼,æ”¯æŒ32768<del>32767(å¦‚æœæ˜¯UNSIGNED,ä¸º0</del>65535)çš„æ•°</td>
</tr>
<tr>
<td align="left">TINYINT</td>
<td align="left">æ•´æ•°å€¼,æ”¯æŒ128<del>127(å¦‚æœä¸ºUNSIGNED,ä¸º0</del>255)çš„æ•°</td>
</tr>
</tbody></table>
<p><strong>ä¸ä½¿ç”¨å¼•å·</strong> ä¸ä¸²ä¸ä¸€æ ·,æ•°å€¼ä¸åº”è¯¥æ‹¬åœ¨å¼•å·å†…ã€‚</p>
<p><strong>å­˜å‚¨è´§å¸æ•°æ®ç±»å‹</strong> MySQLä¸­æ²¡æœ‰ä¸“é—¨å­˜å‚¨è´§å¸çš„æ•°æ®ç±»å‹,ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨ DECIMAL(8, 2)</p>
<blockquote>
<p>æ—¥æœŸå’Œæ—¶é—´æ•°æ®ç±»å‹</p>
</blockquote>
<p>MySQLä½¿ç”¨ä¸“é—¨çš„æ•°æ®ç±»å‹æ¥å­˜å‚¨æ—¥æœŸå’Œæ—¶é—´å€¼ã€‚è§ä¸‹è¡¨ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æ—¥æœŸå’Œæ—¶é—´æ•°æ®ç±»å‹</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">DATE</td>
<td align="left">è¡¨ç¤º1000-01-01~9999-12-31çš„æ—¥æœŸ,æ ¼å¼ä¸ºYYYY-MM-DD</td>
</tr>
<tr>
<td align="left">DATETIME</td>
<td align="left">DATEå’ŒTIMEçš„ç»„åˆ</td>
</tr>
<tr>
<td align="left">TIMESTAMP</td>
<td align="left">åŠŸèƒ½å’ŒDATETIMEç›¸åŒ(ä½†èŒƒå›´è¾ƒå°)</td>
</tr>
<tr>
<td align="left">TIME</td>
<td align="left">æ ¼å¼ä¸ºHH:MM:SS</td>
</tr>
<tr>
<td align="left">YEAR</td>
<td align="left">ç”¨2ä½æ•°å­—è¡¨ç¤º,èŒƒå›´æ˜¯70(1970å¹´)<del>69(2069å¹´),ç”¨4ä½æ•°å­—è¡¨ç¤º,èŒƒå›´æ˜¯1901å¹´</del>2155å¹´</td>
</tr>
</tbody></table>
<blockquote>
<p>äºŒè¿›åˆ¶æ•°æ®ç±»å‹</p>
</blockquote>
<p>äºŒè¿›åˆ¶æ•°æ®ç±»å‹å¯å­˜å‚¨ä»»ä½•æ•°æ®(ç”šè‡³åŒ…æ‹¬äºŒè¿›åˆ¶ä¿¡æ¯),å¦‚å›¾åƒã€å¤šåª’ä½“ã€å­—å¤„ç†æ–‡æ¡£ç­‰(è§ä¸‹è¡¨ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th align="left">äºŒè¿›åˆ¶æ•°æ®ç±»å‹</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">BLOB</td>
<td align="left">Blobæœ€å¤§é•¿åº¦ä¸º64 KB</td>
</tr>
<tr>
<td align="left">MEDIUMBLOB</td>
<td align="left">Blobæœ€å¤§é•¿åº¦ä¸º16 MB</td>
</tr>
<tr>
<td align="left">LONGBLOB</td>
<td align="left">Blobæœ€å¤§é•¿åº¦ä¸º4 GB</td>
</tr>
<tr>
<td align="left">TINYBLOB</td>
<td align="left">Blobæœ€å¤§é•¿åº¦ä¸º255å­—èŠ‚</td>
</tr>
</tbody></table>
<hr>
<h3 id="å®æˆ˜é¡¹ç›®"><a href="#å®æˆ˜é¡¹ç›®" class="headerlink" title="å®æˆ˜é¡¹ç›®"></a>å®æˆ˜é¡¹ç›®</h3><blockquote>
<p>å®æˆ˜é¡¹ç›®1:ç†Ÿæ‚‰SQLè¯­å¥<br>æ ¹æ®ä¸‹é¢çš„è¡¨æ ¼ç»ƒä¹ sqlè¯­å¥ï¼ˆä¹¦åº—çš„åº“å­˜æ•°æ®åº“ï¼‰</p>
</blockquote>
<p><img src="pic/22-sql.png" alt="sql"></p>
<p>åœ¨è¯¥è¡¨æ ¼ä¸­,ç¼–å·ã€ä¹¦åã€ä½œè€…ã€è¿›è´§æ—¥æœŸã€ä»·æ ¼ã€æ•°é‡å°±æ˜¯ä¸åŒçš„åˆ—,è€Œæ¯ä¸€è¡Œä¿å­˜çš„åˆ™æ˜¯å…·ä½“çš„æ•°æ®ã€‚</p>
<p>å»ºç«‹ä¸€ä¸ªåå­—ä¸º bookshop çš„åº“,åœ¨è¿™ä¸ªåº“ä¸­å»ºç«‹ä¸€å¼ å…³äºä¹¦ç±åº“å­˜åå­—ä¸º reserve çš„è¡¨,è¡¨çš„ç»“æ„å¦‚å›¾æ‰€ç¤ºã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@serverg ~]# mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MariaDB monitor. Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.41-MariaDB MariaDB Server</span><br><span class="line">Copyright (c) 2000, 2014, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"><span class="meta">#</span><span class="bash">æ˜¾ç¤ºåº“</span></span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database</span><br><span class="line">|</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql</span><br><span class="line">|</span><br><span class="line">| performance_schema |</span><br><span class="line">| test</span><br><span class="line">|</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash">å»ºåº“</span></span><br><span class="line">MariaDB [(none)]&gt; create database db1;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash">ä½¿ç”¨åº“</span></span><br><span class="line">MariaDB [(none)]&gt; use db1;</span><br><span class="line">Database changed</span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ é™¤åº“</span></span><br><span class="line">MariaDB [db1]&gt; drop database db1;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line">MariaDB [(none)]&gt; create database booboo;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash">ä½¿ç”¨åº“</span></span><br><span class="line">MariaDB [(none)]&gt; use booboo;</span><br><span class="line">Database changed</span><br><span class="line"><span class="meta">#</span><span class="bash">å»ºè¡¨</span></span><br><span class="line">MariaDB [booboo]&gt; create table bookshop (</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> id int primary key,</span></span><br><span class="line">åˆ—åä¸º id æ•´æ•°å‹ ä¸»å»º</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> bookname varchar(50) not null,</span></span><br><span class="line">åˆ—åä¸º bookname å¯å˜é•¿åº¦å­—ç¬¦ç±»å‹æœ€é•¿ä¸º 50 å­—èŠ‚ ä¸ä¸º</span><br><span class="line">ç©º</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> writer varchar(50),</span></span><br><span class="line">åˆ—åä¸º writer å¯å˜é•¿åº¦å­—ç¬¦ç±»å‹æœ€é•¿ä¸º 50 å­—èŠ‚</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> bookdate date,</span></span><br><span class="line">åˆ—åä¸º bookdate æ—¥æœŸå‹</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> price <span class="built_in">float</span>,</span></span><br><span class="line">åˆ—åä¸º price æµ®ç‚¹å‹</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> amount int</span></span><br><span class="line">åˆ—åä¸º amount æ•´æ•°å‹</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> );</span></span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash">æ˜¾ç¤ºè¡¨</span></span><br><span class="line">MariaDB [booboo]&gt; show tables ;</span><br><span class="line">+------------------+</span><br><span class="line">| Tables_in_booboo |</span><br><span class="line">+------------------+</span><br><span class="line">| bookshop</span><br><span class="line">|</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash">æ’å…¥è¡¨æ•°æ®</span></span><br><span class="line">MariaDB [booboo]&gt; insert into bookshop values (1,"Live with Linux","Tube","2007-1-25",75.00,50);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">MariaDB [booboo]&gt; insert into bookshop values (2,"Linux inside","Kevin","2008-2-15",83.00,50)</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> ;</span></span><br><span class="line">Query OK, 1 row affected (0.06 sec)</span><br><span class="line">MariaDB [booboo]&gt; insert into bookshop values</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> (3,<span class="string">"L.A.M.P"</span>,<span class="string">"Tom"</span>,<span class="string">"2008-2-5"</span>,82.5,50),</span></span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> (4,<span class="string">"My way"</span>,<span class="string">"Jam"</span>,<span class="string">"2007-12-3"</span>,45.25,130),</span></span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> (5,<span class="string">"Open your heart"</span>,<span class="string">"July"</span>,<span class="string">"2007-3-8"</span>,35,20),</span></span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> (6,<span class="string">"Pro C"</span>,<span class="string">"Todd"</span>,<span class="string">"2007-8-25"</span>,85,25),</span></span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> (7,<span class="string">"Thinking in C"</span>,<span class="string">"John"</span>,<span class="string">"2006-6-13"</span>,65,30);</span></span><br><span class="line">Query OK, 5 rows affected (0.03 sec)</span><br><span class="line">Records: 5 Duplicates: 0 Warnings: 0</span><br><span class="line"><span class="meta">#</span><span class="bash">æ˜¾ç¤ºè¡¨æ•°æ®</span></span><br><span class="line">MariaDB [booboo]&gt; select * from bookshop;</span><br><span class="line">+----+-----------------+--------+------------+-------+--------+</span><br><span class="line">| id | bookname</span><br><span class="line">| writer | bookdate | price | amount |</span><br><span class="line">+----+-----------------+--------+------------+-------+--------+</span><br><span class="line">| 1 | Live with Linux | Tube | 2007-01-25 | 75 | 50 |</span><br><span class="line">| 2 | Linux inside | Kevin | 2008-02-15 | 83 | 50 |</span><br><span class="line">| 3 | L.A.M.P</span><br><span class="line">| Tom | 2008-02-05 | 82.5 | 50 |</span><br><span class="line">| 4 | My way</span><br><span class="line">| Jam | 2007-12-03 | 45.25 | 130 |</span><br><span class="line">| 5 | Open your heart | July | 2007-03-08 | 35 | 20 |</span><br><span class="line">| 6 | Pro C</span><br><span class="line">| Todd | 2007-08-25 | 85 | 25 |</span><br><span class="line">| 7 | Thinking in C | John | 2006-06-13 | 65 | 30 |</span><br><span class="line">+----+-----------------+--------+------------+-------+--------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥è¯¢è¡¨æ•°æ®</span></span><br><span class="line">MariaDB [booboo]&gt; select bookname,writer from bookshop where id=4;</span><br><span class="line">+----------+--------+</span><br><span class="line">| bookname | writer |</span><br><span class="line">+----------+--------+</span><br><span class="line">| My way | Jam |</span><br><span class="line">+----------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">MariaDB [booboo]&gt; select bookname,writer from bookshop where id=4 or id=5;</span><br><span class="line">+-----------------+--------+</span><br><span class="line">| bookname</span><br><span class="line">| writer |</span><br><span class="line">+-----------------+--------+</span><br><span class="line">| My way</span><br><span class="line">| Jam |</span><br><span class="line">| Open your heart | July |</span><br><span class="line">+-----------------+--------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash">ä¿®æ”¹è¡¨æ•°æ®</span></span><br><span class="line">MariaDB [booboo]&gt; update bookshop set</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> writer=<span class="string">"booboo"</span></span></span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> <span class="built_in">where</span> id=1;</span></span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">Rows matched: 1 Changed: 1 Warnings: 0</span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ é™¤è¡¨æ•°æ®</span></span><br><span class="line">MariaDB [booboo]&gt; delete from bookshop where id=7;</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line">MariaDB [booboo]&gt; select * from bookshop;</span><br><span class="line">+----+-----------------+--------+------------+-------+--------+</span><br><span class="line">| id | bookname</span><br><span class="line">| writer | bookdate | price | amount |</span><br><span class="line">+----+-----------------+--------+------------+-------+--------+</span><br><span class="line">| 1 | Live with Linux | booboo | 2007-01-25 | 75 | 50 |</span><br><span class="line">| 2 | Linux inside | Kevin | 2008-02-15 | 83 | 50 |</span><br><span class="line">| 3 | L.A.M.P</span><br><span class="line">| Tom | 2008-02-05 | 82.5 | 50 |</span><br><span class="line">| 4 | My way</span><br><span class="line">| Jam | 2007-12-03 | 45.25 | 130 |</span><br><span class="line">| 5 | Open your heart | July | 2007-03-08 | 35 | 20 |</span><br><span class="line">| 6 | Pro C</span><br><span class="line">| Todd | 2007-08-25 | 85 | 25 |</span><br><span class="line">+----+-----------------+--------+------------+-------+--------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®æˆ˜é¡¹ç›®2:ç†Ÿæ‚‰mysql.userè¡¨</p>
</blockquote>
<ol>
<li>æŸ¥çœ‹mysqlåº“ä¸­userè¡¨ä¸­çš„host,user,passwordåˆ—çš„å€¼ï¼›</li>
<li>åˆ é™¤mysqlåº“ä¸­çš„userè¡¨ä¸­ï¼Œuseråˆ—ä¸ºç©ºæˆ–è€…passwordåˆ—ä¸ºç©ºçš„è¡Œï¼›</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [mysql]&gt; select host,user,password from mysql.user;</span><br><span class="line">+----------------------+------+-------------------------------------------+</span><br><span class="line">| host                 | user | password                                  |</span><br><span class="line">+----------------------+------+-------------------------------------------+</span><br><span class="line">| localhost            | root | *6FF883623B8639D08083FF411D20E6856EB7D2BF |</span><br><span class="line">| mastera0.example.com | root |                                           |</span><br><span class="line">| 127.0.0.1            | root |                                           |</span><br><span class="line">| ::1                  | root |                                           |</span><br><span class="line">| localhost            |      |                                           |</span><br><span class="line">| mastera0.example.com |      |                                           |</span><br><span class="line">+----------------------+------+-------------------------------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; delete from mysql.user where user=' ' or password=' ';</span><br><span class="line">Query OK, 5 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; select host,user,password from mysql.user;</span><br><span class="line">+-----------+------+-------------------------------------------+</span><br><span class="line">| host      | user | password                                  |</span><br><span class="line">+-----------+------+-------------------------------------------+</span><br><span class="line">| localhost | root | *6FF883623B8639D08083FF411D20E6856EB7D2BF |</span><br><span class="line">+-----------+------+-------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®æˆ˜é¡¹ç›®3ï¼šå®Œæˆæ•°æ®åº“ç”¨æˆ·æƒé™æ“ä½œé¡¹ç›®</p>
<blockquote>
<p>è¦æ±‚:æ·»åŠ æˆæƒç”¨æˆ·æµ‹è¯•å®¢æˆ·æœºä¼˜å…ˆä½¿ç”¨çš„å“ªä¸ªå¯†ç (Xä¸ºå­¦ç”Ÿæœºå·)</p>
</blockquote>
</blockquote>
<ol>
<li>user1@â€™172.25.X.%â€™ uplooking</li>
<li>user1@â€™172.25.X.12â€™ uplooking123</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> mastera:</span></span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; grant all on *.* to user1@"172.25.0.%" identified by "uplooking";</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">MariaDB [mysql]&gt; grant all on *.* to user1@"172.25.0.12" identified by "uplooking123";</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">MariaDB [mysql]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">MariaDB [mysql]&gt; \q</span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> masterb:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç¬¬ä¸€æ¬¡è¾“å…¥å¯†ç ä¸º: uplooking</span></span><br><span class="line">[root@serverb ~]# mysql -uuser1 -h172.25.0.11 -p'uplooking'</span><br><span class="line">ERROR 1045 (28000): Access denied for user 'user1'@'mastera0.example.com' (using password:YES)</span><br><span class="line"><span class="meta">#</span><span class="bash">ç¬¬äºŒæ¬¡è¾“å…¥å¯†ç ä¸º:uplooking123</span></span><br><span class="line">[root@serverb ~]# mysql -uuser1 -h172.25.0.11 -p'uplooking123'</span><br><span class="line">Welcome to the MariaDB monitor. Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 7</span><br><span class="line">Server version: 5.5.41-MariaDB MariaDB Server</span><br><span class="line">Copyright (c) 2000, 2014, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line">MariaDB [(none)]&gt;</span><br></pre></td></tr></table></figure>
<p>å®éªŒç»“è®º:uplooking2 å¯†ç è¿›å»äº† æˆæƒè¶Šç²¾ç¡®è¶Šä¼˜å…ˆ</p>
<blockquote>
<p>å®æˆ˜é¡¹ç›®4: ç ´è§£ MariaDB 5.5 çš„ root å¯†ç </p>
</blockquote>
<ol>
<li>åœæ­¢æœåŠ¡ <code>systemctl stop mariadb</code></li>
<li>è·³è¿‡æˆæƒè¡¨å¯åŠ¨æœåŠ¡ <code>mysqld_safe --skip-grant-tables &amp;</code></li>
<li>ä¿®æ”¹rootå¯†ç  <code>update mysql.user set password=password(&#39;uplooking&#39;) where user=&#39;root&#39;;</code></li>
<li>åœæ­¢è·³è¿‡æˆæƒè¡¨å¯åŠ¨æœåŠ¡ <code>kill -9</code></li>
<li>å¯åŠ¨æœåŠ¡ <code>systemctl start mariadb</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> rhel7 mariadb5.5</span></span><br><span class="line">[root@serverg ~]# systemctl stop mariadb</span><br><span class="line">[root@serverg ~]# mysqld_safe --skip-grant-tables &amp;</span><br><span class="line">[1] 3078</span><br><span class="line">[root@serverg ~]# 160304 18:36:15 mysqld_safe Logging to '/var/log/mariadb/mariadb.log'.</span><br><span class="line">160304 18:36:15 mysqld_safe Starting mysqld daemon with databases from /var/lib/mysql</span><br><span class="line">[root@serverg ~]# mysql -uxxx</span><br><span class="line">Welcome to the MariaDB monitor. Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 1</span><br><span class="line">Server version: 5.5.41-MariaDB MariaDB Server</span><br><span class="line">Copyright (c) 2000, 2014, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line">MariaDB [(none)]&gt; use mysql;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line">Database changed</span><br><span class="line">MariaDB [mysql]&gt; update user set password=password("redhat") where user="root" and</span><br><span class="line">host="localhost";</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1 Changed: 1 Warnings: 0</span><br><span class="line">MariaDB [mysql]&gt; \q</span><br><span class="line">Bye</span><br><span class="line">[root@serverg ~]# ps -ef |grep mysql</span><br><span class="line">mysql</span><br><span class="line">3221</span><br><span class="line">1 0 18:36 ?</span><br><span class="line">00:00:00 /usr/libexec/mysqld --basedir=/usr</span><br><span class="line">--datadir=/var/lib/mysql --plugin-dir=/usr/lib64/mysql/plugin --user=mysql --skip-grant-tables --log-</span><br><span class="line">error=/var/log/mariadb/mariadb.log</span><br><span class="line">--pid-file=/var/run/mariadb/mariadb.pid</span><br><span class="line">--socket=/var/lib/mysql/mysql.sock</span><br><span class="line">root</span><br><span class="line">3287 3256 0 18:40 pts/0 00:00:00 grep --color=auto mysql</span><br><span class="line">[root@serverg ~]# kill -9 3221</span><br><span class="line">[root@serverg ~]# systemctl start mariadb</span><br><span class="line">[root@serverg ~]# mysql -uroot -predhat</span><br><span class="line">Welcome to the MariaDB monitor. Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 3</span><br><span class="line">Server version: 5.5.41-MariaDB MariaDB Server</span><br><span class="line">Copyright (c) 2000, 2014, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line">MariaDB [(none)]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æœ¬ç« è¦æ±‚æŒæ¡sqlè¯­å¥çš„åŸºæœ¬ç”¨æ³•ï¼ŒåŒ…æ‹¬<code>create database</code>,<code>create table</code>,<code>drop database</code>,<code>drop table</code>,<code>insert into</code>,<code>update</code>,<code>delete from</code>,<code>grant</code>,<code>revoke</code>;å…¶ä»–sqlè¯­å¥ä½œä¸ºæ‹“å±•ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>MySQLåŸºç¡€ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬ä¸‰è¯¾ ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€SQLä»‹ç»å’ŒåŸºæœ¬æ“ä½œ1</title>
    <url>/2016/12/27/booboo_mysql/02-%E7%BB%93%E6%9E%84%E5%8C%96%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80SQL%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬ç« å°†é€šè¿‡ä¸°å¯Œçš„å®ä¾‹å¯¹ SQL è¯­è¨€çš„åŸºç¡€è¿›è¡Œè¯¦ç»†ä»‹ç»,MySQL,ä½¿å¾—è¯»è€…ä¸ä½†èƒ½å¤Ÿå­¦ä¹ åˆ°æ ‡å‡† SQL çš„ä½¿ç”¨,åˆèƒ½å¤Ÿå­¦ä¹ åˆ° MySQL ä¸­ä¸€äº›æ‰©å±• SQL çš„ä½¿ç”¨æ–¹æ³•ã€‚è¯¥æ•™æ¡ˆæ ¹æ®ã€ŠMySQLå¿…çŸ¥å¿…ä¼šã€‹æ’°å†™ã€‚</p>
</blockquote>
<h3 id="äº†è§£SQL"><a href="#äº†è§£SQL" class="headerlink" title="äº†è§£SQL"></a>äº†è§£SQL</h3><h4 id="ä»€ä¹ˆæ˜¯SQL"><a href="#ä»€ä¹ˆæ˜¯SQL" class="headerlink" title="ä»€ä¹ˆæ˜¯SQL"></a>ä»€ä¹ˆæ˜¯SQL</h4><blockquote>
<p>SQL ç®€ä»‹</p>
</blockquote>
<p>å½“é¢å¯¹ä¸€ä¸ªé™Œç”Ÿçš„æ•°æ®åº“æ—¶,é€šå¸¸éœ€è¦ä¸€ç§æ–¹å¼ä¸å®ƒè¿›è¡Œäº¤äº’,ä»¥å®Œæˆç”¨æˆ·æ‰€éœ€è¦çš„å„ç§å·¥ä½œ,è¿™ä¸ªæ—¶å€™,å°±è¦ç”¨åˆ° SQL è¯­è¨€äº†ã€‚</p>
<p>SQL æ˜¯ Structure Query Language(ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€)çš„ç¼©å†™,å®ƒæ˜¯ä½¿ç”¨å…³ç³»æ¨¡å‹çš„æ•°æ®åº“åº”ç”¨è¯­è¨€,ç”± IBM åœ¨ 20 ä¸–çºª 70 å¹´ä»£å¼€å‘å‡ºæ¥,ä½œä¸º IBM å…³ç³»æ•°æ®åº“åŸå‹ System R çš„åŸå‹å…³ç³»è¯­è¨€,å®ç°äº†å…³ç³»æ•°æ®åº“ä¸­çš„ä¿¡æ¯æ£€ç´¢ã€‚</p>
<p>20 ä¸–çºª 80 å¹´ä»£åˆ,ç¾å›½å›½å®¶æ ‡å‡†å±€(ANSI)å¼€å§‹ç€æ‰‹åˆ¶å®š SQL æ ‡å‡†,æœ€æ—©çš„ ANSI æ ‡å‡†äº1986 å¹´å®Œæˆ,å°±è¢«å«ä½œ SQL-86ã€‚æ ‡å‡†çš„å‡ºå°ä½¿ SQL ä½œä¸ºæ ‡å‡†å…³ç³»æ•°æ®åº“è¯­è¨€çš„åœ°ä½å¾—åˆ°äº†åŠ å¼ºã€‚SQL æ ‡å‡†ç›®å‰å·²å‡ ç»ä¿®æ”¹æ›´è¶‹å®Œå–„ã€‚</p>
<p>æ­£æ˜¯ç”±äº SQL è¯­è¨€çš„æ ‡å‡†åŒ–,æ‰€ä»¥å¤§å¤šæ•°å…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿéƒ½æ”¯æŒ SQL è¯­è¨€,å®ƒå·²ç»å‘å±•æˆä¸ºå¤šç§å¹³å°è¿›è¡Œäº¤äº’æ“ä½œçš„åº•å±‚ä¼šè¯è¯­è¨€ã€‚</p>
<p>è¿™é‡Œç”¨äº†(My)SQL è¿™æ ·çš„æ ‡é¢˜,ç›®çš„æ˜¯åœ¨ä»‹ç»æ ‡å‡† SQL çš„åŒæ—¶,ä¹Ÿå°†ä¸€äº› MySQL åœ¨æ ‡å‡† SQLä¸Šçš„æ‰©å±•ä¸€åŒä»‹ç»ç»™å¤§å®¶ã€‚å¸Œæœ›è¯»è€…çœ‹å®Œæœ¬èŠ‚å,èƒ½å¤Ÿå¯¹æ ‡å‡† SQL çš„åŸºæœ¬è¯­æ³•å’Œ MySQL çš„éƒ¨åˆ†æ‰©å±•è¯­æ³•æœ‰æ‰€äº†è§£ã€‚</p>
<blockquote>
<p>SQL åˆ†ç±»</p>
</blockquote>
<p>SQL è¯­å¥ä¸»è¦å¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹ 4 ä¸ªç±»åˆ«ã€‚</p>
<ul>
<li>DDL(Data Definition Languages)è¯­å¥:æ•°æ®å®šä¹‰è¯­è¨€,è¿™äº›è¯­å¥å®šä¹‰äº†ä¸åŒçš„æ•°æ®æ®µã€æ•°æ®åº“ã€è¡¨ã€åˆ—ã€ç´¢å¼•ç­‰æ•°æ®åº“å¯¹è±¡çš„å®šä¹‰ã€‚å¸¸ç”¨çš„è¯­å¥å…³é”®å­—ä¸»è¦åŒ…æ‹¬ createã€dropã€alterç­‰ã€‚</li>
<li>DML(Data Manipulation Language)è¯­å¥:æ•°æ®æ“çºµè¯­å¥,ç”¨äºæ·»åŠ ã€åˆ é™¤ã€æ›´æ–°å’ŒæŸ¥è¯¢æ•°æ®åº“è®°å½•,å¹¶æ£€æŸ¥æ•°æ®å®Œæ•´æ€§,å¸¸ç”¨çš„è¯­å¥å…³é”®å­—ä¸»è¦åŒ…æ‹¬ insertã€deleteã€udpate å’Œselect ç­‰ã€‚</li>
<li>DCL(Data Control Language)è¯­å¥:æ•°æ®æ§åˆ¶è¯­å¥,ç”¨äºæ§åˆ¶ä¸åŒæ•°æ®æ®µç›´æ¥çš„è®¸å¯å’Œè®¿é—®çº§åˆ«çš„è¯­å¥ã€‚è¿™äº›è¯­å¥å®šä¹‰äº†æ•°æ®åº“ã€è¡¨ã€å­—æ®µã€ç”¨æˆ·çš„è®¿é—®æƒé™å’Œå®‰å…¨çº§åˆ«ã€‚ä¸»è¦çš„è¯­å¥å…³é”®å­—åŒ…æ‹¬ grantã€revoke ç­‰ã€‚</li>
<li>DQL(Data Query Language)è¯­å¥:æ•°æ®æŸ¥è¯¢è¯­å¥ï¼Œç”¨äºä»ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­æ£€ç´¢ä¿¡æ¯ã€‚</li>
</ul>
<blockquote>
<p>MySQLä¸­çš„è¯­æ³•æ ¼å¼</p>
</blockquote>
<ol>
<li>SQLè¯­å¥æ˜¯ç”±ç®€å•çš„è‹±è¯­å•è¯æ„æˆçš„ã€‚è¿™äº›å•è¯ç§°ä¸ºå…³é”®å­—,æ¯ä¸ªSQLè¯­å¥éƒ½æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå…³é”®å­—æ„æˆçš„ã€‚</li>
<li>ç»“æŸSQLè¯­å¥ å¤šæ¡SQLè¯­å¥å¿…é¡»ä»¥åˆ†å·(;)åˆ†éš”ã€‚MySQLå¦‚åŒå¤šæ•°DBMSä¸€æ ·,ä¸éœ€è¦åœ¨å•æ¡SQLè¯­å¥ååŠ åˆ†å·ã€‚ä½†ç‰¹å®šçš„DBMSå¯èƒ½å¿…é¡»åœ¨å•æ¡SQLè¯­å¥ååŠ ä¸Šåˆ†å·ã€‚å½“ç„¶,å¦‚æœæ„¿æ„å¯ä»¥æ€»æ˜¯åŠ ä¸Šåˆ†å·ã€‚äº‹å®ä¸Š,å³ä½¿ä¸ä¸€å®šéœ€è¦,ä½†åŠ ä¸Šåˆ†å·è‚¯å®šæ²¡æœ‰åå¤„ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ mysqlå‘½ä»¤è¡Œ,å¿…é¡»åŠ ä¸Šåˆ†å·æ¥ç»“æŸ SQL è¯­å¥ã€‚</li>
<li>SQLè¯­å¥å’Œå¤§å°å†™ è¯·æ³¨æ„,SQLè¯­å¥ä¸åŒºåˆ†å¤§å°å†™,å› æ­¤SELECT ä¸ select æ˜¯ç›¸åŒçš„ã€‚åŒæ ·,å†™æˆ Select ä¹Ÿæ²¡æœ‰å…³ç³»ã€‚è®¸å¤šSQLå¼€å‘äººå‘˜å–œæ¬¢å¯¹æ‰€æœ‰SQLå…³é”®å­—ä½¿ç”¨å¤§å†™,è€Œå¯¹æ‰€æœ‰åˆ—å’Œè¡¨åä½¿ç”¨å°å†™,è¿™æ ·åšä½¿ä»£ç æ›´æ˜“äºé˜…è¯»å’Œè°ƒè¯•ã€‚</li>
<li>ä½¿ç”¨ç©ºæ ¼ åœ¨å¤„ç†SQLè¯­å¥æ—¶,å…¶ä¸­æ‰€æœ‰ç©ºæ ¼éƒ½è¢«å¿½ç•¥ã€‚SQLè¯­å¥å¯ä»¥åœ¨ä¸€è¡Œä¸Šç»™å‡º,ä¹Ÿå¯ä»¥åˆ†æˆè®¸å¤šè¡Œã€‚å¤šæ•°SQLå¼€å‘äººå‘˜è®¤ä¸ºå°†SQLè¯­å¥åˆ†æˆå¤šè¡Œæ›´å®¹æ˜“é˜…è¯»å’Œè°ƒè¯•ã€‚</li>
</ol>
<hr>
<blockquote>
<p>å­¦ä¹ æ ·ä¾‹è¡¨è·å–æ–¹æ³•</p>
</blockquote>
<p>å­¦ä¹ æ ·ä¾‹mysql_scripts.zipå­˜æ”¾åœ¨uplookingæ•™å®¤å…±äº«è·¯å¾„ä¸º<a href="http://classroom.example.com/content/MYSQL/04-others/mysql_scripts.zip" target="_blank" rel="noopener">http://classroom.example.com/content/MYSQL/04-others/mysql_scripts.zip</a> ã€‚</p>
<p>å¯ä»¥åœ¨è¿æ¥äº’è”ç½‘çš„æƒ…å†µä¸‹ï¼Œè®¿é—®<a href="http://www.forta.com/books/0672327120/" target="_blank" rel="noopener">http://www.forta.com/books/0672327120/</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera0 ~]# yum install -y wget vim net-tools unzip</span><br><span class="line">[root@mastera0 ~]# wget http://classroom.example.com/content/MYSQL/04-othersmysql_scripts.zip</span><br><span class="line">[root@mastera0 ~]# ls</span><br><span class="line">anaconda-ks.cfg  mysql_scripts.zip</span><br><span class="line">[root@mastera0 ~]# unzip mysql_scripts.zip</span><br><span class="line">[root@mastera0 ~]# ls</span><br><span class="line">anaconda-ks.cfg  create.sql  mysql_scripts.zip  populate.sql</span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 4</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; exit</span><br><span class="line">Bye</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å…¥create.sqlåˆ°<span class="built_in">test</span>åº“ï¼Œå°†ä¼šåˆ›å»ºä¸€äº›è¡¨</span></span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking test &lt; create.sql</span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking -e "show tables from test";</span><br><span class="line">+----------------+</span><br><span class="line">| Tables_in_test |</span><br><span class="line">+----------------+</span><br><span class="line">| customers      |</span><br><span class="line">| orderitems     |</span><br><span class="line">| orders         |</span><br><span class="line">| productnotes   |</span><br><span class="line">| products       |</span><br><span class="line">| vendors        |</span><br><span class="line">+----------------+</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å…¥populate.sqlåˆ°<span class="built_in">test</span>åº“ï¼Œå°†ä¼šå‘è¡¨ä¸­æ–°å¢æ•°æ®</span></span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking test &lt; populate.sql</span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking -e "select * from test.vendors";</span><br><span class="line">+---------+----------------+-----------------+-------------+------------+----------+--------------+</span><br><span class="line">| vend_id | vend_name      | vend_address    | vend_city   | vend_state | vend_zip | vend_country |</span><br><span class="line">+---------+----------------+-----------------+-------------+------------+----------+--------------+</span><br><span class="line">|    1001 | Anvils R Us    | 123 Main Street | Southfield  | MI         | 48075    | USA          |</span><br><span class="line">|    1002 | LT Supplies    | 500 Park Street | Anytown     | OH         | 44333    | USA          |</span><br><span class="line">|    1003 | ACME           | 555 High Street | Los Angeles | CA         | 90046    | USA          |</span><br><span class="line">|    1004 | Furball Inc.   | 1000 5th Avenue | New York    | NY         | 11111    | USA          |</span><br><span class="line">|    1005 | Jet Set        | 42 Galaxy Road  | London      | NULL       | N16 6PS  | England      |</span><br><span class="line">|    1006 | Jouets Et Ours | 1 Rue Amusement | Paris       | NULL       | 45678    | France       |</span><br><span class="line">+---------+----------------+-----------------+-------------+------------+----------+--------------+</span><br><span class="line"></span><br><span class="line">[root@mastera0 ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 15</span><br><span class="line">Server version: 5.5.44-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥è¯¢æ‰€æœ‰çš„æ•°æ®åº“</span></span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨<span class="built_in">test</span>åº“</span></span><br><span class="line">MariaDB [(none)]&gt; use test;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥è¯¢<span class="built_in">test</span>åº“ä¸­æ‰€æœ‰è¡¨</span></span><br><span class="line">MariaDB [test]&gt; show tables;</span><br><span class="line">+----------------+</span><br><span class="line">| Tables_in_test |</span><br><span class="line">+----------------+</span><br><span class="line">| customers      |</span><br><span class="line">| orderitems     |</span><br><span class="line">| orders         |</span><br><span class="line">| productnotes   |</span><br><span class="line">| products       |</span><br><span class="line">| vendors        |</span><br><span class="line">+----------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥è¯¢<span class="built_in">test</span>åº“ä¸­productsè¡¨çš„ç»“æ„ï¼Œ  describeæ˜¯show columns fromçš„åˆ«å</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> DESCRIBE tbl_name</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> SHOW [FULL] COLUMNS FROM tbl_name [FROM db_name] [like_or_where]</span></span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; desc products;</span><br><span class="line">+------------+--------------+------+-----+---------+-------+</span><br><span class="line">| Field      | Type         | Null | Key | Default | Extra |</span><br><span class="line">+------------+--------------+------+-----+---------+-------+</span><br><span class="line">| prod_id    | char(10)     | NO   | PRI | NULL    |       |</span><br><span class="line">| vend_id    | int(11)      | NO   | MUL | NULL    |       |</span><br><span class="line">| prod_name  | char(255)    | NO   |     | NULL    |       |</span><br><span class="line">| prod_price | decimal(8,2) | NO   |     | NULL    |       |</span><br><span class="line">| prod_desc  | text         | YES  |     | NULL    |       |</span><br><span class="line">+------------+--------------+------+-----+---------+-------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; show columns from test.products;</span><br><span class="line">+------------+--------------+------+-----+---------+-------+</span><br><span class="line">| Field      | Type         | Null | Key | Default | Extra |</span><br><span class="line">+------------+--------------+------+-----+---------+-------+</span><br><span class="line">| prod_id    | char(10)     | NO   | PRI | NULL    |       |</span><br><span class="line">| vend_id    | int(11)      | NO   | MUL | NULL    |       |</span><br><span class="line">| prod_name  | char(255)    | NO   |     | NULL    |       |</span><br><span class="line">| prod_price | decimal(8,2) | NO   |     | NULL    |       |</span><br><span class="line">| prod_desc  | text         | YES  |     | NULL    |       |</span><br><span class="line">+------------+--------------+------+-----+---------+-------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æœ¬æ•™æ¡ˆä¸­æ‰€æœ‰ç« èŠ‚ä¸­ä½¿ç”¨çš„æ•°æ®åº“è¡¨éƒ½æ˜¯å…³ç³»è¡¨ï¼Œå…³äºæ¯ä¸ªè¡¨åŠå…³ç³»çš„æè¿°,å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
</blockquote>
<p>æ ·ä¾‹è¡¨ä¸ºä¸€ä¸ªæƒ³è±¡çš„éšèº«ç‰©å“æ¨é”€å•†ä½¿ç”¨çš„è®¢å•å½•å…¥ç³»ç»Ÿ,è¿™äº›éšèº«ç‰©å“å¯èƒ½æ˜¯ä½ å–œæ¬¢çš„å¡é€šäººç‰©éœ€è¦çš„(æ˜¯çš„,å¡é€šäººç‰©,æ²¡äººè§„å®šå­¦ä¹ MySQLå¿…é¡»æ²‰é—·åœ°å­¦)ã€‚è¿™äº›è¡¨ç”¨æ¥å®Œæˆä»¥ä¸‹å‡ ä¸ªä»»åŠ¡:</p>
<ul>
<li>ç®¡ç†ä¾›åº”å•†;</li>
<li>ç®¡ç†äº§å“ç›®å½•;</li>
<li>ç®¡ç†é¡¾å®¢åˆ—è¡¨;</li>
<li>å½•å…¥é¡¾å®¢è®¢å•ã€‚</li>
</ul>
<p>è¦å®Œæˆè¿™å‡ ä¸ªä»»åŠ¡éœ€è¦ä½œä¸ºå…³ç³»æ•°æ®åº“è®¾è®¡æˆåˆ†çš„ç´§å¯†è”ç³»çš„6ä¸ªè¡¨ã€‚</p>
<p><strong>vendors è¡¨</strong> å­˜å‚¨é”€å”®äº§å“çš„ä¾›åº”å•†ã€‚æ¯ä¸ªä¾›åº”å•†åœ¨è¿™ä¸ªè¡¨ä¸­æœ‰ä¸€ä¸ªè®°å½•,ä¾›åº”å•†ID( vend_id )åˆ—ç”¨æ¥åŒ¹é…äº§å“å’Œä¾›åº”å•†ã€‚</p>
<table>
<thead>
<tr>
<th align="left">vendors è¡¨çš„åˆ—</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">vend_id</td>
<td align="left">å”¯ä¸€çš„ä¾›åº”å•†ID</td>
</tr>
<tr>
<td align="left">vend_name</td>
<td align="left">ä¾›åº”å•†å</td>
</tr>
<tr>
<td align="left">vend_address</td>
<td align="left">ä¾›åº”å•†çš„åœ°å€</td>
</tr>
<tr>
<td align="left">vend_city</td>
<td align="left">ä¾›åº”å•†çš„åŸå¸‚</td>
</tr>
<tr>
<td align="left">vend_state</td>
<td align="left">ä¾›åº”å•†çš„å·</td>
</tr>
<tr>
<td align="left">vend_zip</td>
<td align="left">ä¾›åº”å•†çš„é‚®æ”¿ç¼–ç </td>
</tr>
<tr>
<td align="left">vend_country</td>
<td align="left">ä¾›åº”å•†çš„å›½å®¶</td>
</tr>
</tbody></table>
<p><strong>products è¡¨</strong> åŒ…å«äº§å“ç›®å½•,æ¯è¡Œä¸€ä¸ªäº§å“ã€‚æ¯ä¸ªäº§å“æœ‰å”¯ä¸€çš„ID( prod_id åˆ—),é€šè¿‡ vend_id (ä¾›åº”å•†çš„å”¯ä¸€ID)å…³è”åˆ°å®ƒçš„ä¾›åº”å•†ã€‚</p>
<table>
<thead>
<tr>
<th align="left">products è¡¨çš„åˆ—</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">prod_id</td>
<td align="left">å”¯ä¸€çš„äº§å“ID</td>
</tr>
<tr>
<td align="left">vend_id</td>
<td align="left">äº§å“ä¾›åº”å•†ID(å…³è”åˆ°vendorsè¡¨ä¸­çš„vend_id)</td>
</tr>
<tr>
<td align="left">prod_name</td>
<td align="left">äº§å“å</td>
</tr>
<tr>
<td align="left">prod_price</td>
<td align="left">äº§å“ä»·æ ¼</td>
</tr>
<tr>
<td align="left">prod_desc</td>
<td align="left">äº§å“æè¿°</td>
</tr>
</tbody></table>
<p><strong>customers è¡¨</strong> å­˜å‚¨æ‰€æœ‰é¡¾å®¢çš„ä¿¡æ¯ã€‚æ¯ä¸ªé¡¾å®¢æœ‰å”¯ä¸€çš„ID( cust_idåˆ—)ã€‚</p>
<table>
<thead>
<tr>
<th align="left">customers è¡¨çš„åˆ—</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">cust_id</td>
<td align="left">å”¯ä¸€çš„é¡¾å®¢ID</td>
</tr>
<tr>
<td align="left">cust_name</td>
<td align="left">é¡¾å®¢å</td>
</tr>
<tr>
<td align="left">cust_address</td>
<td align="left">é¡¾å®¢çš„åœ°å€</td>
</tr>
<tr>
<td align="left">cust_city</td>
<td align="left">é¡¾å®¢çš„åŸå¸‚</td>
</tr>
<tr>
<td align="left">cust_state</td>
<td align="left">é¡¾å®¢çš„å·</td>
</tr>
<tr>
<td align="left">cust_zip</td>
<td align="left">é¡¾å®¢çš„é‚®æ”¿ç¼–ç </td>
</tr>
<tr>
<td align="left">cust_country</td>
<td align="left">é¡¾å®¢çš„å›½å®¶</td>
</tr>
<tr>
<td align="left">cust_contact</td>
<td align="left">é¡¾å®¢çš„è”ç³»å</td>
</tr>
<tr>
<td align="left">cust_email</td>
<td align="left">é¡¾å®¢çš„è”ç³»emailåœ°å€</td>
</tr>
</tbody></table>
<p><strong>orderitems è¡¨</strong> å­˜å‚¨æ¯ä¸ªè®¢å•ä¸­çš„å®é™…ç‰©å“,æ¯ä¸ªè®¢å•çš„æ¯ä¸ªç‰©å“å ä¸€è¡Œã€‚å¯¹ orders ä¸­çš„æ¯ä¸€è¡Œ, orderitems ä¸­æœ‰ä¸€è¡Œæˆ–å¤šè¡Œã€‚æ¯ä¸ªè®¢å•ç‰©å“ç”±è®¢å•å·åŠ è®¢å•ç‰©å“(ç¬¬ä¸€ä¸ªç‰©å“ã€ç¬¬äºŒä¸ªç‰©å“ç­‰)å”¯ä¸€æ ‡è¯†ã€‚è®¢å•ç‰©å“é€šè¿‡ order_num åˆ—(å…³è”åˆ° orders ä¸­è®¢å•çš„å”¯ä¸€ID)ä¸å®ƒä»¬ç›¸åº”çš„è®¢å•ç›¸å…³è”ã€‚æ­¤å¤–,æ¯ä¸ªè®¢å•é¡¹åŒ…å«è®¢å•ç‰©å“çš„äº§å“ID(å®ƒå…³è”ç‰©å“åˆ°products è¡¨)ã€‚</p>
<table>
<thead>
<tr>
<th align="left">orderitems è¡¨çš„åˆ—</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">order_num</td>
<td align="left">è®¢å•å·(å…³è”åˆ°ordersè¡¨çš„order_num)</td>
</tr>
<tr>
<td align="left">order_item</td>
<td align="left">è®¢å•ç‰©å“å·(åœ¨æŸä¸ªè®¢å•ä¸­çš„é¡ºåº)</td>
</tr>
<tr>
<td align="left">prod_id</td>
<td align="left">äº§å“ID(å…³è”åˆ°productsè¡¨çš„prod_id)</td>
</tr>
<tr>
<td align="left">quantity</td>
<td align="left">ç‰©å“æ•°é‡</td>
</tr>
<tr>
<td align="left">item_price</td>
<td align="left">ç‰©å“ä»·æ ¼</td>
</tr>
</tbody></table>
<p><strong>productnotes è¡¨</strong>å­˜å‚¨ä¸ç‰¹å®šäº§å“æœ‰å…³çš„æ³¨é‡Šã€‚å¹¶éæ‰€æœ‰äº§å“éƒ½æœ‰ç›¸<br>å…³çš„æ³¨é‡Š,è€Œæœ‰çš„äº§å“å¯èƒ½æœ‰è®¸å¤šç›¸å…³çš„æ³¨é‡Šã€‚</p>
<table>
<thead>
<tr>
<th align="left">productnotes è¡¨çš„åˆ—</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">note_id</td>
<td align="left">å”¯ä¸€æ³¨é‡ŠID</td>
</tr>
<tr>
<td align="left">prod_id</td>
<td align="left">äº§å“ID(å¯¹åº”äºproductsè¡¨ä¸­çš„prod_id)</td>
</tr>
<tr>
<td align="left">note_date</td>
<td align="left">å¢åŠ æ³¨é‡Šçš„æ—¥æœŸ</td>
</tr>
<tr>
<td align="left">note_text</td>
<td align="left">æ³¨é‡Šæ–‡æœ¬</td>
</tr>
</tbody></table>
<hr>
<h3 id="DQLè¯­è¨€"><a href="#DQLè¯­è¨€" class="headerlink" title="DQLè¯­è¨€"></a>DQLè¯­è¨€</h3><p>DQL(Data Query Language)è¯­å¥:æ•°æ®æŸ¥è¯¢è¯­å¥ï¼Œç”¨äºä»ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­æ£€ç´¢ä¿¡æ¯ã€‚æœ¬ç« ä»‹ç»å¦‚ä½•ä½¿ç”¨ SELECT è¯­å¥ä»è¡¨ä¸­æ£€ç´¢ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®åˆ—ã€‚</p>
<h4 id="æ£€ç´¢æ•°æ®"><a href="#æ£€ç´¢æ•°æ®" class="headerlink" title="æ£€ç´¢æ•°æ®"></a>æ£€ç´¢æ•°æ®</h4><ul>
<li>æ•°æ®æ’å…¥åˆ°æ•°æ®åº“ä¸­å,å°±å¯ä»¥ç”¨ SELECT å‘½ä»¤è¿›è¡Œå„ç§å„æ ·çš„æŸ¥è¯¢,ä½¿å¾—è¾“å‡ºçš„ç»“æœç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚ç”±äº SELECT çš„è¯­æ³•å¾ˆå¤æ‚,æ‰€æœ‰è¿™é‡Œåªä»‹ç»æœ€åŸºæœ¬çš„è¯­æ³•</li>
<li>å¤§æ¦‚,æœ€ç»å¸¸ä½¿ç”¨çš„SQLè¯­å¥å°±æ˜¯ SELECT è¯­å¥äº†ã€‚å®ƒçš„ç”¨é€”æ˜¯ä»ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­æ£€ç´¢ä¿¡æ¯ã€‚</li>
<li>ä¸ºäº†ä½¿ç”¨ SELECT æ£€ç´¢è¡¨æ•°æ®,å¿…é¡»è‡³å°‘ç»™å‡ºä¸¤æ¡ä¿¡æ¯â€”â€”æƒ³é€‰æ‹©ä»€ä¹ˆ,ä»¥åŠä»ä»€ä¹ˆåœ°æ–¹é€‰æ‹©ã€‚</li>
</ul>
<p>æˆ‘ä»¬å°†ä»ç®€å•çš„SQL SELECT è¯­å¥å¼€å§‹ä»‹ç»,æ­¤è¯­å¥å¦‚ä¸‹æ‰€ç¤º:</p>
<blockquote>
<p>æ£€ç´¢å•ä¸ªåˆ—</p>
<blockquote>
<p>åˆ© ç”¨ SELECT è¯­ å¥ ä» products è¡¨ ä¸­ æ£€ ç´¢ ä¸€ ä¸ª å ä¸ºprod_name çš„åˆ—ã€‚æ‰€éœ€çš„åˆ—ååœ¨ SELECT å…³é”®å­—ä¹‹åç»™å‡º, FROMå…³é”®å­—æŒ‡å‡ºä»å…¶ä¸­æ£€ç´¢æ•°æ®çš„è¡¨åã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products;</span><br><span class="line">+----------------+</span><br><span class="line">| prod_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| .5 ton anvil   |</span><br><span class="line">| 1 ton anvil    |</span><br><span class="line">| 2 ton anvil    |</span><br><span class="line">| Detonator      |</span><br><span class="line">| Bird seed      |</span><br><span class="line">| Carrots        |</span><br><span class="line">| Fuses          |</span><br><span class="line">| JetPack 1000   |</span><br><span class="line">| JetPack 2000   |</span><br><span class="line">| Oil can        |</span><br><span class="line">| Safe           |</span><br><span class="line">| Sling          |</span><br><span class="line">| TNT (1 stick)  |</span><br><span class="line">| TNT (5 sticks) |</span><br><span class="line">+----------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>æœªæ’åºæ•°æ®</strong> å¦‚æœè¯»è€…è‡ªå·±è¯•éªŒè¿™ä¸ªæŸ¥è¯¢,å¯èƒ½ä¼šå‘ç°æ˜¾ç¤ºè¾“å‡ºçš„æ•°æ®é¡ºåºä¸è¿™é‡Œçš„ä¸åŒã€‚å‡ºç°è¿™ç§æƒ…å†µå¾ˆæ­£å¸¸ã€‚å¦‚æœæ²¡æœ‰æ˜ç¡®æ’åºæŸ¥è¯¢ç»“æœ(ä¸‹ä¸€ç« ä»‹ç»),åˆ™è¿”å›çš„æ•°æ®çš„é¡ºåºæ²¡æœ‰ç‰¹æ®Šæ„ä¹‰ã€‚è¿”å›æ•°æ®çš„é¡ºåºå¯èƒ½æ˜¯æ•°æ®è¢«æ·»åŠ åˆ°è¡¨ä¸­çš„é¡ºåº,ä¹Ÿå¯èƒ½ä¸æ˜¯ã€‚åªè¦è¿”å›ç›¸åŒæ•°ç›®çš„è¡Œ,å°±æ˜¯æ­£å¸¸çš„ã€‚</p>
<p><strong>ä½¿ç”¨ç©ºæ ¼</strong> åœ¨å¤„ç†SQLè¯­å¥æ—¶,å…¶ä¸­æ‰€æœ‰ç©ºæ ¼éƒ½è¢«å¿½ç•¥ã€‚SQLè¯­å¥å¯ä»¥åœ¨ä¸€è¡Œä¸Šç»™å‡º,ä¹Ÿå¯ä»¥åˆ†æˆè®¸å¤šè¡Œã€‚å¤šæ•°SQLå¼€å‘äººå‘˜è®¤ä¸ºå°†SQLè¯­å¥åˆ†æˆå¤šè¡Œæ›´å®¹æ˜“é˜…è¯»å’Œè°ƒè¯•ã€‚</p>
<blockquote>
<p>æ£€ç´¢å¤šä¸ªåˆ—</p>
<blockquote>
<p>ä½¿ç”¨ SELECT è¯­å¥ä»è¡¨ productsä¸­é€‰æ‹©æ•°æ®,æŒ‡å®š3ä¸ªåˆ—åprod_id,prod_name,prod_price,åˆ—åä¹‹é—´ç”¨é€—å·åˆ†éš”ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_id,prod_name,prod_price from products;</span><br><span class="line">+---------+----------------+------------+</span><br><span class="line">| prod_id | prod_name      | prod_price |</span><br><span class="line">+---------+----------------+------------+</span><br><span class="line">| ANV01   | .5 ton anvil   |       5.99 |</span><br><span class="line">| ANV02   | 1 ton anvil    |       9.99 |</span><br><span class="line">| ANV03   | 2 ton anvil    |      14.99 |</span><br><span class="line">| DTNTR   | Detonator      |      13.00 |</span><br><span class="line">| FB      | Bird seed      |      10.00 |</span><br><span class="line">| FC      | Carrots        |       2.50 |</span><br><span class="line">| FU1     | Fuses          |       3.42 |</span><br><span class="line">| JP1000  | JetPack 1000   |      35.00 |</span><br><span class="line">| JP2000  | JetPack 2000   |      55.00 |</span><br><span class="line">| OL1     | Oil can        |       8.99 |</span><br><span class="line">| SAFE    | Safe           |      50.00 |</span><br><span class="line">| SLING   | Sling          |       4.49 |</span><br><span class="line">| TNT1    | TNT (1 stick)  |       2.50 |</span><br><span class="line">| TNT2    | TNT (5 sticks) |      10.00 |</span><br><span class="line">+---------+----------------+------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>å½“å¿ƒé€—å·</strong> åœ¨é€‰æ‹©å¤šä¸ªåˆ—æ—¶,ä¸€å®šè¦åœ¨åˆ—åä¹‹é—´åŠ ä¸Šé€—å·,ä½†æœ€åä¸€ä¸ªåˆ—ååä¸åŠ ã€‚å¦‚æœåœ¨æœ€åä¸€ä¸ªåˆ—åååŠ äº†é€—å·,å°†å‡ºç°é”™è¯¯ã€‚</p>
<p><strong>æ•°æ®è¡¨ç¤º</strong> ä»ä¸Šè¿°è¾“å‡ºå¯ä»¥çœ‹åˆ°,SQLè¯­å¥ä¸€èˆ¬è¿”å›åŸå§‹çš„ã€æ— æ ¼å¼çš„æ•°æ®ã€‚æ•°æ®çš„æ ¼å¼åŒ–æ˜¯ä¸€ä¸ªè¡¨ç¤ºé—®é¢˜,è€Œä¸æ˜¯ä¸€ä¸ªæ£€ç´¢é—®é¢˜ã€‚å› æ­¤,è¡¨ç¤º(å¯¹é½å’Œæ˜¾ç¤ºä¸Šé¢çš„ä»·æ ¼å€¼,ç”¨è´§å¸ç¬¦å·å’Œé€—å·è¡¨ç¤ºå…¶é‡‘é¢)ä¸€èˆ¬åœ¨æ˜¾ç¤ºè¯¥æ•°æ®çš„åº”ç”¨ç¨‹åºä¸­è§„å®šã€‚ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨å®é™…æ£€ç´¢å‡ºçš„åŸå§‹æ•°æ®(æ²¡æœ‰åº”ç”¨ç¨‹åºæä¾›çš„æ ¼å¼)ã€‚</p>
<blockquote>
<p>æ£€ç´¢æ‰€æœ‰åˆ—</p>
<blockquote>
<p>é™¤äº†æŒ‡å®šæ‰€éœ€çš„åˆ—å¤–(å¦‚ä¸Šæ‰€è¿°,ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—), SELECT è¯­å¥è¿˜å¯ä»¥æ£€ç´¢æ‰€æœ‰çš„åˆ—è€Œä¸å¿…é€ä¸ªåˆ—å‡ºå®ƒä»¬ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨å®é™…åˆ—åçš„ä½ç½®ä½¿ç”¨æ˜Ÿå·( * )é€šé…ç¬¦æ¥è¾¾åˆ°,ä½¿ç”¨ SELECT è¯­å¥ä»è¡¨ productsä¸­é€‰æ‹©æ‰€æœ‰æ•°æ®ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from products;</span><br><span class="line">+---------+---------+----------------+------------+----------------------------------------------------------------+</span><br><span class="line">| prod_id | vend_id | prod_name      | prod_price | prod_desc                                                      |</span><br><span class="line">+---------+---------+----------------+------------+----------------------------------------------------------------+</span><br><span class="line">| ANV01   |    1001 | .5 ton anvil   |       5.99 | .5 ton anvil, black, complete with handy hook                  |</span><br><span class="line">| ANV02   |    1001 | 1 ton anvil    |       9.99 | 1 ton anvil, black, complete with handy hook and carrying case |</span><br><span class="line">| ANV03   |    1001 | 2 ton anvil    |      14.99 | 2 ton anvil, black, complete with handy hook and carrying case |</span><br><span class="line">| DTNTR   |    1003 | Detonator      |      13.00 | Detonator (plunger powered), fuses not included                |</span><br><span class="line">| FB      |    1003 | Bird seed      |      10.00 | Large bag (suitable for road runners)                          |</span><br><span class="line">| FC      |    1003 | Carrots        |       2.50 | Carrots (rabbit hunting season only)                           |</span><br><span class="line">| FU1     |    1002 | Fuses          |       3.42 | 1 dozen, extra long                                            |</span><br><span class="line">| JP1000  |    1005 | JetPack 1000   |      35.00 | JetPack 1000, intended for single use                          |</span><br><span class="line">| JP2000  |    1005 | JetPack 2000   |      55.00 | JetPack 2000, multi-use                                        |</span><br><span class="line">| OL1     |    1002 | Oil can        |       8.99 | Oil can, red                                                   |</span><br><span class="line">| SAFE    |    1003 | Safe           |      50.00 | Safe with combination lock                                     |</span><br><span class="line">| SLING   |    1003 | Sling          |       4.49 | Sling, one size fits all                                       |</span><br><span class="line">| TNT1    |    1003 | TNT (1 stick)  |       2.50 | TNT, red, single stick                                         |</span><br><span class="line">| TNT2    |    1003 | TNT (5 sticks) |      10.00 | TNT, red, pack of 10 sticks                                    |</span><br><span class="line">+---------+---------+----------------+------------+----------------------------------------------------------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨é€šé…ç¬¦</strong> ä¸€èˆ¬,é™¤éä½ ç¡®å®éœ€è¦è¡¨ä¸­çš„æ¯ä¸ªåˆ—,å¦åˆ™æœ€å¥½åˆ«ä½¿ç”¨ * é€šé…ç¬¦ã€‚è™½ç„¶ä½¿ç”¨é€šé…ç¬¦å¯èƒ½ä¼šä½¿ä½ è‡ªå·±çœäº‹,ä¸ç”¨æ˜ç¡®åˆ—å‡ºæ‰€éœ€åˆ—,ä½†æ£€ç´¢ä¸éœ€è¦çš„åˆ—é€šå¸¸ä¼šé™ä½æ£€ç´¢å’Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</p>
<p><strong>æ£€ç´¢æœªçŸ¥åˆ—</strong> ä½¿ç”¨é€šé…ç¬¦æœ‰ä¸€ä¸ªå¤§ä¼˜ç‚¹ã€‚ç”±äºä¸æ˜ç¡®æŒ‡å®šåˆ—å(å› ä¸ºæ˜Ÿå·æ£€ç´¢æ¯ä¸ªåˆ—),æ‰€ä»¥èƒ½æ£€ç´¢å‡ºåå­—æœªçŸ¥çš„åˆ—ã€‚</p>
<blockquote>
<p>æ£€ç´¢ä¸åŒçš„è¡Œ</p>
<blockquote>
<p>æ­£å¦‚æ‰€è§, SELECT è¿”å›æ‰€æœ‰åŒ¹é…çš„è¡Œã€‚ä½†æ˜¯,å¦‚æœä½ ä¸æƒ³è¦æ¯ä¸ªå€¼æ¯æ¬¡éƒ½å‡ºç°,æ€ä¹ˆåŠ?ä¾‹å¦‚,å‡å¦‚ä½ æƒ³å¾—å‡º products è¡¨ä¸­äº§å“çš„æ‰€æœ‰ä¾›åº”å•†ID:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select vend_id from products;</span><br><span class="line">+---------+</span><br><span class="line">| vend_id |</span><br><span class="line">+---------+</span><br><span class="line">|    1001 |</span><br><span class="line">|    1001 |</span><br><span class="line">|    1001 |</span><br><span class="line">|    1002 |</span><br><span class="line">|    1002 |</span><br><span class="line">|    1003 |</span><br><span class="line">|    1003 |</span><br><span class="line">|    1003 |</span><br><span class="line">|    1003 |</span><br><span class="line">|    1003 |</span><br><span class="line">|    1003 |</span><br><span class="line">|    1003 |</span><br><span class="line">|    1005 |</span><br><span class="line">|    1005 |</span><br><span class="line">+---------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>SELECT è¯­å¥è¿”å›14è¡Œ(å³ä½¿è¡¨ä¸­åªæœ‰4ä¸ªä¾›åº”å•†),å› ä¸º products è¡¨ä¸­åˆ—å‡ºäº†14ä¸ªäº§å“ã€‚é‚£ä¹ˆ,å¦‚ä½•æ£€ç´¢å‡ºæœ‰ä¸åŒå€¼çš„åˆ—è¡¨å‘¢?</p>
<p><strong>DISTINCT å…³é”®å­—</strong> é¡¾åæ€ä¹‰,æ­¤å…³é”®å­—æŒ‡ç¤ºMySQLåªè¿”å›ä¸åŒçš„å€¼ã€‚</p>
<p><code>SELECT DISTINCT vend_id</code> å‘Šè¯‰MySQLåªè¿”å›ä¸åŒ(å”¯ä¸€)çš„<code>vend_id</code>è¡Œ,å› æ­¤åªè¿”å›4è¡Œ,å¦‚ä¸‹é¢çš„è¾“å‡ºæ‰€ç¤ºã€‚å¦‚æœä½¿ç”¨<code>DISTINCT</code> å…³é”®å­—,å®ƒå¿…é¡»ç›´æ¥æ”¾åœ¨åˆ—åçš„å‰é¢ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select distinct vend_id from products;</span><br><span class="line">+---------+</span><br><span class="line">| vend_id |</span><br><span class="line">+---------+</span><br><span class="line">|    1001 |</span><br><span class="line">|    1002 |</span><br><span class="line">|    1003 |</span><br><span class="line">|    1005 |</span><br><span class="line">+---------+</span><br><span class="line">4 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p><strong>ä¸èƒ½éƒ¨åˆ†ä½¿ç”¨ DISTINCT</strong> <code>DISTINCT</code> å…³é”®å­—åº”ç”¨äºæ‰€æœ‰åˆ—è€Œä¸ä»…æ˜¯å‰ç½®å®ƒçš„åˆ—ã€‚å¦‚æœç»™å‡º <code>SELECT DISTINCT vend_id,prod_price</code> ,é™¤éæŒ‡å®šçš„ä¸¤ä¸ªåˆ—éƒ½ä¸åŒ,å¦åˆ™æ‰€æœ‰è¡Œéƒ½å°†è¢«æ£€ç´¢å‡ºæ¥ã€‚</p>
<blockquote>
<p>é™åˆ¶ç»“æœ</p>
<blockquote>
<p>SELECT è¯­å¥è¿”å›æ‰€æœ‰åŒ¹é…çš„è¡Œ,å®ƒä»¬å¯èƒ½æ˜¯æŒ‡å®šè¡¨ä¸­çš„æ¯ä¸ªè¡Œã€‚ä¸ºäº†è¿”å›ç¬¬ä¸€è¡Œæˆ–å‰å‡ è¡Œ,å¯ä½¿ç”¨ <code>LIMIT</code> å­å¥ã€‚ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­:ç”¨ SELECT è¯­å¥æ£€ç´¢å•ä¸ªåˆ—è¿”å›ä¸å¤šäº5è¡Œã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products;</span><br><span class="line">+----------------+</span><br><span class="line">| prod_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| .5 ton anvil   |</span><br><span class="line">| 1 ton anvil    |</span><br><span class="line">| 2 ton anvil    |</span><br><span class="line">| Detonator      |</span><br><span class="line">| Bird seed      |</span><br><span class="line">| Carrots        |</span><br><span class="line">| Fuses          |</span><br><span class="line">| JetPack 1000   |</span><br><span class="line">| JetPack 2000   |</span><br><span class="line">| Oil can        |</span><br><span class="line">| Safe           |</span><br><span class="line">| Sling          |</span><br><span class="line">| TNT (1 stick)  |</span><br><span class="line">| TNT (5 sticks) |</span><br><span class="line">+----------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name from products limit 5;</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| .5 ton anvil |</span><br><span class="line">| 1 ton anvil  |</span><br><span class="line">| 2 ton anvil  |</span><br><span class="line">| Detonator    |</span><br><span class="line">| Bird seed    |</span><br><span class="line">+--------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>LIMIT 5, 5 æŒ‡ç¤ºMySQLè¿”å›ä»è¡Œ5å¼€å§‹çš„5è¡Œã€‚ç¬¬ä¸€ä¸ªæ•°ä¸ºå¼€å§‹ä½ç½®,ç¬¬äºŒä¸ªæ•°ä¸ºè¦æ£€ç´¢çš„è¡Œæ•°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products limit 5,5;</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| Carrots      |</span><br><span class="line">| Fuses        |</span><br><span class="line">| JetPack 1000 |</span><br><span class="line">| JetPack 2000 |</span><br><span class="line">| Oil can      |</span><br><span class="line">+--------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥,å¸¦ä¸€ä¸ªå€¼çš„ LIMIT æ€»æ˜¯ä»ç¬¬ä¸€è¡Œå¼€å§‹,ç»™å‡ºçš„æ•°ä¸ºè¿”å›çš„è¡Œæ•°ã€‚å¸¦ä¸¤ä¸ªå€¼çš„ LIMIT å¯ä»¥æŒ‡å®šä»è¡Œå·ä¸ºç¬¬ä¸€ä¸ªå€¼çš„ä½ç½®å¼€å§‹ã€‚</p>
<p><strong>è¡Œ 0</strong>  æ£€ç´¢å‡ºæ¥çš„ç¬¬ä¸€è¡Œä¸ºè¡Œ0è€Œä¸æ˜¯è¡Œ1ã€‚å› æ­¤,<code>LIMIT 1, 1</code>å°†æ£€ç´¢å‡ºç¬¬äºŒè¡Œè€Œä¸æ˜¯ç¬¬ä¸€è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products limit 1,1;</span><br><span class="line">+-------------+</span><br><span class="line">| prod_name   |</span><br><span class="line">+-------------+</span><br><span class="line">| 1 ton anvil |</span><br><span class="line">+-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name from products limit 0,1;</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| .5 ton anvil |</span><br><span class="line">+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name from products limit 1;</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| .5 ton anvil |</span><br><span class="line">+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>åœ¨è¡Œæ•°ä¸å¤Ÿæ—¶</strong> LIMIT ä¸­æŒ‡å®šè¦æ£€ç´¢çš„è¡Œæ•°ä¸ºæ£€ç´¢çš„æœ€å¤§è¡Œæ•°ã€‚å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„è¡Œ(ä¾‹å¦‚,ç»™å‡º <code>LIMIT 10, 5</code>,ä½†åªæœ‰13è¡Œ),MySQLå°†åªè¿”å›å®ƒèƒ½è¿”å›çš„é‚£ä¹ˆå¤šè¡Œã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products limit 5,10;</span><br><span class="line">+----------------+</span><br><span class="line">| prod_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| Carrots        |</span><br><span class="line">| Fuses          |</span><br><span class="line">| JetPack 1000   |</span><br><span class="line">| JetPack 2000   |</span><br><span class="line">| Oil can        |</span><br><span class="line">| Safe           |</span><br><span class="line">| Sling          |</span><br><span class="line">| TNT (1 stick)  |</span><br><span class="line">| TNT (5 sticks) |</span><br><span class="line">+----------------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>MySQL 5çš„ LIMIT è¯­æ³•</strong> <code>LIMIT 3, 4</code> çš„å«ä¹‰æ˜¯ä»è¡Œ4å¼€å§‹çš„3è¡Œè¿˜æ˜¯ä»è¡Œ3å¼€å§‹çš„4è¡Œ?å¦‚å‰æ‰€è¿°,å®ƒçš„æ„æ€æ˜¯ä»è¡Œ3å¼€å§‹çš„4è¡Œ,è¿™å®¹æ˜“æŠŠäººæç³Šæ¶‚ã€‚ç”±äºè¿™ä¸ªåŸå› , MySQL 5æ”¯æŒ LIMIT çš„å¦ä¸€ç§æ›¿ä»£è¯­æ³•ã€‚ <code>LIMIT4 OFFSET 3</code> æ„ä¸ºä»è¡Œ3å¼€å§‹å–4è¡Œ,å°±åƒ <code>LIMIT 3, 4</code> ä¸€æ ·ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products limit 3,4;</span><br><span class="line">+-----------+</span><br><span class="line">| prod_name |</span><br><span class="line">+-----------+</span><br><span class="line">| Detonator |</span><br><span class="line">| Bird seed |</span><br><span class="line">| Carrots   |</span><br><span class="line">| Fuses     |</span><br><span class="line">+-----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name from products limit 4 offset 3;</span><br><span class="line">+-----------+</span><br><span class="line">| prod_name |</span><br><span class="line">+-----------+</span><br><span class="line">| Detonator |</span><br><span class="line">| Bird seed |</span><br><span class="line">| Carrots   |</span><br><span class="line">| Fuses     |</span><br><span class="line">+-----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä½¿ç”¨å®Œå…¨é™å®šçš„è¡¨å</p>
<blockquote>
<p>è¿„ä»Šä¸ºæ­¢ä½¿ç”¨çš„SQLä¾‹å­åªé€šè¿‡åˆ—åå¼•ç”¨åˆ—ã€‚ä¹Ÿå¯èƒ½ä¼šä½¿ç”¨å®Œå…¨é™å®šçš„åå­—æ¥å¼•ç”¨åˆ—(åŒæ—¶ä½¿ç”¨è¡¨åå’Œåˆ—å­—)<br>è¯·çœ‹ä»¥ä¸‹ä¾‹å­:é€šè¿‡å®Œå…¨é™å®šçš„è¡¨åå’Œåˆ—åæŸ¥è¯¢productsè¡¨çš„prod_nameåˆ—çš„æ‰€æœ‰å€¼</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select products.prod_name from products;</span><br><span class="line">+----------------+</span><br><span class="line">| prod_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| .5 ton anvil   |</span><br><span class="line">| 1 ton anvil    |</span><br><span class="line">| 2 ton anvil    |</span><br><span class="line">| Detonator      |</span><br><span class="line">| Bird seed      |</span><br><span class="line">| Carrots        |</span><br><span class="line">| Fuses          |</span><br><span class="line">| JetPack 1000   |</span><br><span class="line">| JetPack 2000   |</span><br><span class="line">| Oil can        |</span><br><span class="line">| Safe           |</span><br><span class="line">| Sling          |</span><br><span class="line">| TNT (1 stick)  |</span><br><span class="line">| TNT (5 sticks) |</span><br><span class="line">+----------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡SQLè¯­å¥åœ¨åŠŸèƒ½ä¸Šç­‰äºæœ¬ç« æœ€å¼€å§‹ä½¿ç”¨çš„é‚£ä¸€æ¡è¯­å¥,ä½†è¿™é‡ŒæŒ‡å®šäº†ä¸€ä¸ªå®Œå…¨é™å®šçš„åˆ—åã€‚</p>
<p>è¡¨åä¹Ÿå¯ä»¥æ˜¯å®Œå…¨é™å®šçš„,å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select products.prod_name from test.products;</span><br><span class="line">+----------------+</span><br><span class="line">| prod_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| .5 ton anvil   |</span><br><span class="line">| 1 ton anvil    |</span><br><span class="line">| 2 ton anvil    |</span><br><span class="line">| Detonator      |</span><br><span class="line">| Bird seed      |</span><br><span class="line">| Carrots        |</span><br><span class="line">| Fuses          |</span><br><span class="line">| JetPack 1000   |</span><br><span class="line">| JetPack 2000   |</span><br><span class="line">| Oil can        |</span><br><span class="line">| Safe           |</span><br><span class="line">| Sling          |</span><br><span class="line">| TNT (1 stick)  |</span><br><span class="line">| TNT (5 sticks) |</span><br><span class="line">+----------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡è¯­å¥åœ¨åŠŸèƒ½ä¸Šä¹Ÿç­‰äºåˆšä½¿ç”¨çš„é‚£æ¡è¯­å¥ã€‚</p>
<p>æ­£å¦‚ä»¥åç« èŠ‚æ‰€ä»‹ç»çš„é‚£æ ·,æœ‰ä¸€äº›æƒ…å½¢éœ€è¦å®Œå…¨é™å®šåã€‚ç°åœ¨,éœ€è¦æ³¨æ„è¿™ä¸ªè¯­æ³•,ä»¥ä¾¿åœ¨é‡åˆ°æ—¶çŸ¥é“å®ƒçš„ä½œç”¨ã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨SQLçš„ SELECT è¯­å¥æ¥æ£€ç´¢å•ä¸ªè¡¨åˆ—ã€å¤šä¸ªè¡¨åˆ—ä»¥åŠæ‰€æœ‰è¡¨åˆ—ã€‚ä¸‹ä¸€ç« å°†è®²æˆå¦‚ä½•æ’åºæ£€ç´¢å‡ºæ¥çš„æ•°æ®ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="æ’åºæ£€ç´¢æ•°æ®"><a href="#æ’åºæ£€ç´¢æ•°æ®" class="headerlink" title="æ’åºæ£€ç´¢æ•°æ®"></a>æ’åºæ£€ç´¢æ•°æ®</h4><p>æœ¬ç« å°†è®²æˆå¦‚ä½•ä½¿ç”¨ SELECT è¯­å¥çš„ ORDER BY å­å¥,æ ¹æ®éœ€è¦æ’åºæ£€ç´¢å‡ºçš„æ•°æ®ã€‚</p>
<blockquote>
<p>æ’åºæ•°æ®</p>
<blockquote>
<p>åˆ© ç”¨ SELECT è¯­ å¥ ä» products è¡¨ ä¸­ æ£€ ç´¢ ä¸€ ä¸ª å ä¸ºprod_name çš„åˆ—ã€‚å¯¹ prod_name åˆ—ä»¥å­—æ¯é¡ºåºæ’åºã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products order by prod_name;</span><br><span class="line">+----------------+</span><br><span class="line">| prod_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| .5 ton anvil   |</span><br><span class="line">| 1 ton anvil    |</span><br><span class="line">| 2 ton anvil    |</span><br><span class="line">| Bird seed      |</span><br><span class="line">| Carrots        |</span><br><span class="line">| Detonator      |</span><br><span class="line">| Fuses          |</span><br><span class="line">| JetPack 1000   |</span><br><span class="line">| JetPack 2000   |</span><br><span class="line">| Oil can        |</span><br><span class="line">| Safe           |</span><br><span class="line">| Sling          |</span><br><span class="line">| TNT (1 stick)  |</span><br><span class="line">| TNT (5 sticks) |</span><br><span class="line">+----------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœä¸æ’åº</strong> æ•°æ®ä¸€èˆ¬å°†ä»¥å®ƒåœ¨åº•å±‚è¡¨ä¸­å‡ºç°çš„é¡ºåºæ˜¾ç¤ºã€‚è¿™å¯ä»¥æ˜¯æ•°æ®æœ€åˆæ·»åŠ åˆ°è¡¨ä¸­çš„é¡ºåºã€‚ä½†æ˜¯,å¦‚æœæ•°æ®åæ¥è¿›è¡Œè¿‡æ›´æ–°æˆ–åˆ é™¤,åˆ™æ­¤é¡ºåºå°†ä¼šå—åˆ°MySQLé‡ç”¨å›æ”¶å­˜å‚¨ç©ºé—´çš„å½±å“ã€‚å› æ­¤,å¦‚æœä¸æ˜ç¡®æ§åˆ¶çš„è¯,ä¸èƒ½(ä¹Ÿä¸åº”è¯¥)ä¾èµ–è¯¥æ’åºé¡ºåºã€‚å…³ç³»æ•°æ®åº“è®¾è®¡ç†è®ºè®¤ä¸º,å¦‚æœä¸æ˜ç¡®è§„å®šæ’åºé¡ºåº,åˆ™ä¸åº”è¯¥å‡å®šæ£€ç´¢å‡ºçš„æ•°æ®çš„é¡ºåºæœ‰æ„ä¹‰ã€‚</p>
<p><strong>å­å¥(clause)</strong> SQLè¯­å¥ç”±å­å¥æ„æˆ,æœ‰äº›å­å¥æ˜¯å¿…éœ€çš„,è€Œæœ‰çš„æ˜¯å¯é€‰çš„ã€‚ä¸€ä¸ªå­å¥é€šå¸¸ç”±ä¸€ä¸ªå…³é”®å­—å’Œæ‰€æä¾›çš„æ•°æ®ç»„æˆã€‚å­å¥çš„ä¾‹å­æœ‰ SELECT è¯­å¥çš„ FROM å­å¥,æˆ‘ä»¬åœ¨å‰ä¸€ç« çœ‹åˆ°è¿‡è¿™ä¸ªå­å¥ã€‚</p>
<p><strong>é€šè¿‡éé€‰æ‹©åˆ—è¿›è¡Œæ’åº</strong> é€šå¸¸, ORDER BY å­å¥ä¸­ä½¿ç”¨çš„åˆ—å°†æ˜¯ä¸ºæ˜¾ç¤ºæ‰€é€‰æ‹©çš„åˆ—ã€‚ä½†æ˜¯,å®é™…ä¸Šå¹¶ä¸ä¸€å®šè¦è¿™æ ·,ç”¨éæ£€ç´¢çš„åˆ—æ’åºæ•°æ®æ˜¯å®Œå…¨åˆæ³•çš„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products order by vend_id;</span><br><span class="line">+----------------+</span><br><span class="line">| prod_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| .5 ton anvil   |</span><br><span class="line">| 1 ton anvil    |</span><br><span class="line">| 2 ton anvil    |</span><br><span class="line">| Fuses          |</span><br><span class="line">| Oil can        |</span><br><span class="line">| TNT (1 stick)  |</span><br><span class="line">| Sling          |</span><br><span class="line">| Safe           |</span><br><span class="line">| TNT (5 sticks) |</span><br><span class="line">| Carrots        |</span><br><span class="line">| Bird seed      |</span><br><span class="line">| Detonator      |</span><br><span class="line">| JetPack 2000   |</span><br><span class="line">| JetPack 1000   |</span><br><span class="line">+----------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ç»å¸¸éœ€è¦æŒ‰ä¸æ­¢ä¸€ä¸ªåˆ—è¿›è¡Œæ•°æ®æ’åºã€‚ä¾‹å¦‚,å¦‚æœè¦æ˜¾ç¤ºé›‡å‘˜æ¸…å•,å¯èƒ½å¸Œæœ›æŒ‰å§“å’Œåæ’åº(é¦–å…ˆæŒ‰å§“æ’åº,ç„¶ååœ¨æ¯ä¸ªå§“ä¸­å†æŒ‰åæ’åº)ã€‚å¦‚æœå¤šä¸ªé›‡å‘˜å…·æœ‰ç›¸åŒçš„å§“,è¿™æ ·åšå¾ˆæœ‰ç”¨ã€‚</p>
<p>ä¸ºäº†æŒ‰å¤šä¸ªåˆ—æ’åº,åªè¦æŒ‡å®šåˆ—å,åˆ—åä¹‹é—´ç”¨é€—å·åˆ†å¼€å³å¯(å°±åƒé€‰æ‹©å¤šä¸ªåˆ—æ—¶æ‰€åšçš„é‚£æ ·)ã€‚</p>
<blockquote>
<p>æŒ‰å¤šä¸ªåˆ—æ’åº</p>
<blockquote>
<p>åˆ©ç”¨SELECTè¯­å¥ä»productsè¡¨ä¸­æ£€ç´¢3ä¸ªåˆ—(prod_id,prod_name,prod_price)ï¼Œå¹¶æŒ‰å…¶ä¸­ä¸¤ä¸ªåˆ—å¯¹ç»“æœè¿›è¡Œæ’åºâ€”â€”é¦–å…ˆæŒ‰ä»·æ ¼prod_price,ç„¶åå†æŒ‰åç§°prod_nameæ’åºã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_id,prod_name,prod_price from products order by prod_price,prod_name;</span><br><span class="line">+---------+----------------+------------+</span><br><span class="line">| prod_id | prod_name      | prod_price |</span><br><span class="line">+---------+----------------+------------+</span><br><span class="line">| FC      | Carrots        |       2.50 |</span><br><span class="line">| TNT1    | TNT (1 stick)  |       2.50 |</span><br><span class="line">| FU1     | Fuses          |       3.42 |</span><br><span class="line">| SLING   | Sling          |       4.49 |</span><br><span class="line">| ANV01   | .5 ton anvil   |       5.99 |</span><br><span class="line">| OL1     | Oil can        |       8.99 |</span><br><span class="line">| ANV02   | 1 ton anvil    |       9.99 |</span><br><span class="line">| FB      | Bird seed      |      10.00 |</span><br><span class="line">| TNT2    | TNT (5 sticks) |      10.00 |</span><br><span class="line">| DTNTR   | Detonator      |      13.00 |</span><br><span class="line">| ANV03   | 2 ton anvil    |      14.99 |</span><br><span class="line">| JP1000  | JetPack 1000   |      35.00 |</span><br><span class="line">| SAFE    | Safe           |      50.00 |</span><br><span class="line">| JP2000  | JetPack 2000   |      55.00 |</span><br><span class="line">+---------+----------------+------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>é‡è¦çš„æ˜¯ç†è§£åœ¨æŒ‰å¤šä¸ªåˆ—æ’åºæ—¶,æ’åºå®Œå…¨æŒ‰æ‰€è§„å®šçš„é¡ºåºè¿›è¡Œã€‚æ¢å¥è¯è¯´,å¯¹äºä¸Šè¿°ä¾‹å­ä¸­çš„è¾“å‡º,ä»…åœ¨å¤šä¸ªè¡Œå…·æœ‰ç›¸åŒçš„ prod_priceå€¼æ—¶æ‰å¯¹äº§å“æŒ‰ prod_name è¿›è¡Œæ’åºã€‚å¦‚æœ prod_price åˆ—ä¸­æ‰€æœ‰çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„,åˆ™ä¸ä¼šæŒ‰ prod_name æ’åºã€‚</p>
<p>æ•°æ®æ’åºä¸é™äºå‡åºæ’åº(ä» A åˆ° Z )ã€‚è¿™åªæ˜¯é»˜è®¤çš„æ’åºé¡ºåº,è¿˜å¯ä»¥ä½¿ç”¨ ORDER BY å­å¥ä»¥é™åº(ä» Z åˆ° A )é¡ºåºæ’åºã€‚ä¸ºäº†è¿›è¡Œé™åºæ’åº,å¿…é¡»æŒ‡å®š DESC å…³é”®å­—ã€‚</p>
<blockquote>
<p>æŒ‡å®šæ’åºæ–¹å‘</p>
<blockquote>
<p>åˆ©ç”¨SELECTè¯­å¥ä»productsè¡¨ä¸­æ£€ç´¢3ä¸ªåˆ—(prod_id,prod_name,prod_price)ï¼ŒæŒ‰ä»·æ ¼prod_priceä»¥é™åºæ’åºäº§å“(æœ€è´µçš„æ’åœ¨æœ€å‰é¢)</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_id,prod_name,prod_price from products order by prod_price desc;</span><br><span class="line">+---------+----------------+------------+</span><br><span class="line">| prod_id | prod_name      | prod_price |</span><br><span class="line">+---------+----------------+------------+</span><br><span class="line">| JP2000  | JetPack 2000   |      55.00 |</span><br><span class="line">| SAFE    | Safe           |      50.00 |</span><br><span class="line">| JP1000  | JetPack 1000   |      35.00 |</span><br><span class="line">| ANV03   | 2 ton anvil    |      14.99 |</span><br><span class="line">| DTNTR   | Detonator      |      13.00 |</span><br><span class="line">| TNT2    | TNT (5 sticks) |      10.00 |</span><br><span class="line">| FB      | Bird seed      |      10.00 |</span><br><span class="line">| ANV02   | 1 ton anvil    |       9.99 |</span><br><span class="line">| OL1     | Oil can        |       8.99 |</span><br><span class="line">| ANV01   | .5 ton anvil   |       5.99 |</span><br><span class="line">| SLING   | Sling          |       4.49 |</span><br><span class="line">| FU1     | Fuses          |       3.42 |</span><br><span class="line">| FC      | Carrots        |       2.50 |</span><br><span class="line">| TNT1    | TNT (1 stick)  |       2.50 |</span><br><span class="line">+---------+----------------+------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯,å¦‚æœæ‰“ç®—ç”¨å¤šä¸ªåˆ—æ’åºæ€ä¹ˆåŠ?</p>
<blockquote>
<blockquote>
<p>åˆ©ç”¨SELECTè¯­å¥ä»productsè¡¨ä¸­æ£€ç´¢3ä¸ªåˆ—(prod_id,prod_name,prod_price)ï¼ŒæŒ‰ä»·æ ¼prod_priceä»¥é™åºæ’åºäº§å“(æœ€è´µçš„æ’åœ¨æœ€å‰é¢)ï¼Œç„¶åå†å¯¹äº§å“åæ’åºprod_name</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_id,prod_name,prod_price from products order by prod_price desc,prod_name;</span><br><span class="line">+---------+----------------+------------+</span><br><span class="line">| prod_id | prod_name      | prod_price |</span><br><span class="line">+---------+----------------+------------+</span><br><span class="line">| JP2000  | JetPack 2000   |      55.00 |</span><br><span class="line">| SAFE    | Safe           |      50.00 |</span><br><span class="line">| JP1000  | JetPack 1000   |      35.00 |</span><br><span class="line">| ANV03   | 2 ton anvil    |      14.99 |</span><br><span class="line">| DTNTR   | Detonator      |      13.00 |</span><br><span class="line">| FB      | Bird seed      |      10.00 |</span><br><span class="line">| TNT2    | TNT (5 sticks) |      10.00 |</span><br><span class="line">| ANV02   | 1 ton anvil    |       9.99 |</span><br><span class="line">| OL1     | Oil can        |       8.99 |</span><br><span class="line">| ANV01   | .5 ton anvil   |       5.99 |</span><br><span class="line">| SLING   | Sling          |       4.49 |</span><br><span class="line">| FU1     | Fuses          |       3.42 |</span><br><span class="line">| FC      | Carrots        |       2.50 |</span><br><span class="line">| TNT1    | TNT (1 stick)  |       2.50 |</span><br><span class="line">+---------+----------------+------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>åœ¨å¤šä¸ªåˆ—ä¸Šé™åºæ’åº</strong> å¦‚æœæƒ³åœ¨å¤šä¸ªåˆ—ä¸Šè¿›è¡Œé™åºæ’åº,å¿…é¡»å¯¹æ¯ä¸ªåˆ—æŒ‡å®š DESC å…³é”®å­—ã€‚ä¸ DESC ç›¸åçš„å…³é”®å­—æ˜¯ ASC ( ASCENDING ),åœ¨å‡åºæ’åºæ—¶å¯ä»¥æŒ‡å®šå®ƒã€‚ä½†å®é™…ä¸Š, ASC æ²¡æœ‰å¤šå¤§ç”¨å¤„,å› ä¸ºå‡åºæ˜¯é»˜è®¤çš„(å¦‚æœæ—¢ä¸æŒ‡å®š ASC ä¹Ÿä¸æŒ‡å®š DESC ,åˆ™å‡å®šä¸º ASC )ã€‚</p>
<p><strong>åŒºåˆ†å¤§å°å†™å’Œæ’åºé¡ºåº</strong> åœ¨å¯¹æ–‡æœ¬æ€§çš„æ•°æ®è¿›è¡Œæ’åºæ—¶,Aä¸aç›¸åŒå—?aä½äºBä¹‹å‰è¿˜æ˜¯ä½äºZä¹‹å?è¿™äº›é—®é¢˜ä¸æ˜¯ç†è®ºé—®é¢˜,å…¶ç­”æ¡ˆå–å†³äºæ•°æ®åº“å¦‚ä½•è®¾ç½®ã€‚åœ¨å­—å…¸(dictionary)æ’åºé¡ºåºä¸­, Aè¢«è§†ä¸ºä¸aç›¸åŒ,è¿™æ˜¯MySQL(å’Œå¤§å¤šæ•°æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ)çš„é»˜è®¤è¡Œä¸ºã€‚ä½†æ˜¯,è®¸å¤šæ•°æ®åº“ç®¡ç†å‘˜èƒ½å¤Ÿåœ¨éœ€è¦æ—¶æ”¹å˜è¿™ç§è¡Œä¸º(å¦‚æœä½ çš„æ•°æ®åº“åŒ…å«å¤§é‡å¤–è¯­å­—ç¬¦,å¯èƒ½å¿…é¡»è¿™æ ·åš)ã€‚è¿™é‡Œ,å…³é”®çš„é—®é¢˜æ˜¯,å¦‚æœç¡®å®éœ€è¦æ”¹å˜è¿™ç§æ’åºé¡ºåº,ç”¨ç®€å•çš„ ORDER BY å­å¥åšä¸åˆ°ã€‚ä½ å¿…é¡»è¯·æ±‚æ•°æ®åº“ç®¡ç†å‘˜çš„å¸®åŠ©ã€‚</p>
<blockquote>
<blockquote>
<p>åˆ©ç”¨SELECTè¯­å¥ä»productsè¡¨ä¸­æ£€ç´¢å‡ºæœ€æ˜‚è´µç‰©å“ä»·æ ¼prod_price</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_price from products order by prod_price desc limit 1;</span><br><span class="line">+------------+</span><br><span class="line">| prod_price |</span><br><span class="line">+------------+</span><br><span class="line">|      55.00 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_price from products order by prod_price desc limit 0,1;</span><br><span class="line">+------------+</span><br><span class="line">| prod_price |</span><br><span class="line">+------------+</span><br><span class="line">|      55.00 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_price from products order by prod_price desc limit 1 offset 0;</span><br><span class="line">+------------+</span><br><span class="line">| prod_price |</span><br><span class="line">+------------+</span><br><span class="line">|      55.00 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>ORDER BY å­å¥çš„ä½ç½®</strong> åœ¨ç»™å‡º ORDER BY å­å¥æ—¶,åº”è¯¥ä¿è¯å®ƒä½äº FROM å­å¥ä¹‹åã€‚å¦‚æœä½¿ç”¨ LIMIT ,å®ƒå¿…é¡»ä½äº ORDER BYä¹‹åã€‚ä½¿ç”¨å­å¥çš„æ¬¡åºä¸å¯¹å°†äº§ç”Ÿé”™è¯¯æ¶ˆæ¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_price from products limit 1 order by prod_price desc;</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'order by prod_price desc' at line 1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« å­¦ä¹ äº†å¦‚ä½•ç”¨ SELECT è¯­å¥çš„ ORDER BY å­å¥å¯¹æ£€ç´¢å‡ºçš„æ•°æ®è¿›è¡Œæ’åºã€‚è¿™ä¸ªå­å¥å¿…é¡»ä½äº FROM å­å¥ä¹‹å,å¿…é¡»æ˜¯ SELECT è¯­å¥ä¸­çš„æœ€åä¸€æ¡å­å¥ã€‚å¯æ ¹æ®éœ€è¦,åˆ©ç”¨å®ƒåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—ä¸Šå¯¹æ•°æ®è¿›è¡Œæ’åºã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="è¿‡æ»¤æ•°æ®"><a href="#è¿‡æ»¤æ•°æ®" class="headerlink" title="è¿‡æ»¤æ•°æ®"></a>è¿‡æ»¤æ•°æ®</h4><p>æœ¬ç« å°†è®²æˆå¦‚ä½•ä½¿ç”¨ SELECT è¯­å¥çš„ WHERE å­å¥æŒ‡å®šæœç´¢æ¡ä»¶ã€‚</p>
<blockquote>
<p>ä½¿ç”¨ WHERE å­å¥</p>
</blockquote>
<p>æ•°æ®åº“è¡¨ä¸€èˆ¬åŒ…å«å¤§é‡çš„æ•°æ®,å¾ˆå°‘éœ€è¦æ£€ç´¢è¡¨ä¸­æ‰€æœ‰è¡Œã€‚é€šå¸¸åªä¼šæ ¹æ®ç‰¹å®šæ“ä½œæˆ–æŠ¥å‘Šçš„éœ€è¦æå–è¡¨æ•°æ®çš„å­é›†ã€‚åªæ£€ç´¢æ‰€éœ€æ•°æ®éœ€è¦æŒ‡ å®š æœ ç´¢ æ¡ ä»¶ ( search criteria ) , æœ ç´¢ æ¡ ä»¶ ä¹Ÿ ç§° ä¸º è¿‡ æ»¤ æ¡ ä»¶ ( filtercondition)ã€‚</p>
<p>åœ¨ SELECT è¯­å¥ä¸­,æ•°æ®æ ¹æ® WHERE å­å¥ä¸­æŒ‡å®šçš„æœç´¢æ¡ä»¶è¿›è¡Œè¿‡æ»¤ã€‚WHERE å­å¥åœ¨è¡¨å( FROM å­å¥)ä¹‹åç»™å‡ºã€‚</p>
<blockquote>
<blockquote>
<p>ä» products è¡¨ä¸­æ£€ç´¢ä¸¤ä¸ªåˆ—(prod_name,prod_price),ä½†ä¸è¿”å›æ‰€æœ‰è¡Œ,åªè¿”å› prod_price å€¼ä¸º 2.50 çš„è¡Œã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price  from products where prod_price=2.50;</span><br><span class="line">+---------------+------------+</span><br><span class="line">| prod_name     | prod_price |</span><br><span class="line">+---------------+------------+</span><br><span class="line">| Carrots       |       2.50 |</span><br><span class="line">| TNT (1 stick) |       2.50 |</span><br><span class="line">+---------------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>SQLè¿‡æ»¤ä¸åº”ç”¨è¿‡æ»¤</strong> æ•°æ®ä¹Ÿå¯ä»¥åœ¨åº”ç”¨å±‚è¿‡æ»¤ã€‚ä¸ºæ­¤ç›®çš„,SQLçš„ SELECT è¯­å¥ä¸ºå®¢æˆ·æœºåº”ç”¨æ£€ç´¢å‡ºè¶…è¿‡å®é™…æ‰€éœ€çš„æ•°æ®,ç„¶åå®¢æˆ·æœºä»£ç å¯¹è¿”å›æ•°æ®è¿›è¡Œå¾ªç¯,ä»¥æå–å‡ºéœ€è¦çš„è¡Œã€‚</p>
<p>é€šå¸¸,è¿™ç§å®ç°å¹¶ä¸ä»¤äººæ»¡æ„ã€‚å› æ­¤,å¯¹æ•°æ®åº“è¿›è¡Œäº†ä¼˜åŒ–,ä»¥ä¾¿å¿«é€Ÿæœ‰æ•ˆåœ°å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ã€‚è®©å®¢æˆ·æœºåº”ç”¨(æˆ–å¼€å‘è¯­è¨€)å¤„ç†æ•°æ®åº“çš„å·¥ä½œå°†ä¼šæå¤§åœ°å½±å“åº”ç”¨çš„æ€§èƒ½,å¹¶ä¸”ä½¿æ‰€åˆ›å»ºçš„åº”ç”¨å®Œå…¨ä¸å…·å¤‡å¯ä¼¸ç¼©æ€§ã€‚æ­¤å¤–,å¦‚æœåœ¨å®¢æˆ·æœºä¸Šè¿‡æ»¤æ•°æ®,æœåŠ¡å™¨ä¸å¾—ä¸é€šè¿‡ç½‘ç»œå‘é€å¤šä½™çš„æ•°æ®,è¿™å°†å¯¼è‡´ç½‘ç»œå¸¦å®½çš„æµªè´¹ã€‚</p>
<p><strong>WHERE å­å¥çš„ä½ç½®</strong> åœ¨åŒæ—¶ä½¿ç”¨ ORDER BY å’Œ WHERE å­å¥æ—¶,åº”è¯¥è®© ORDER BY ä½äº WHERE ä¹‹å,å¦åˆ™å°†ä¼šäº§ç”Ÿé”™è¯¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price  from products where prod_name like "T%" order by prod_price desc;</span><br><span class="line">+----------------+------------+</span><br><span class="line">| prod_name      | prod_price |</span><br><span class="line">+----------------+------------+</span><br><span class="line">| TNT (5 sticks) |      10.00 |</span><br><span class="line">| TNT (1 stick)  |       2.50 |</span><br><span class="line">+----------------+------------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name,prod_price  from products order by prod_price desc where prod_name like "T%";</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'where prod_name like "T%"' at line 1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>WHERE å­å¥æ“ä½œç¬¦</p>
</blockquote>
<p>æˆ‘ä»¬åœ¨å…³äºç›¸ç­‰çš„æµ‹è¯•æ—¶çœ‹åˆ°äº†ç¬¬ä¸€ä¸ª WHERE å­å¥,å®ƒç¡®å®šä¸€ä¸ªåˆ—æ˜¯å¦åŒ…å«ç‰¹å®šçš„å€¼ã€‚MySQLæ”¯æŒä¸‹è¡¨åˆ—å‡ºçš„æ‰€æœ‰æ¡ä»¶æ“ä½œç¬¦ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æ“ä½œç¬¦</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">=</td>
<td align="left">ç­‰äº</td>
</tr>
<tr>
<td align="left">&lt;&gt;</td>
<td align="left">ä¸ç­‰äº</td>
</tr>
<tr>
<td align="left">!=</td>
<td align="left">ä¸ç­‰äº</td>
</tr>
<tr>
<td align="left">&lt;</td>
<td align="left">å°äº</td>
</tr>
<tr>
<td align="left">&lt;=</td>
<td align="left">å°äºç­‰äº</td>
</tr>
<tr>
<td align="left">&gt;</td>
<td align="left">å¤§äº</td>
</tr>
<tr>
<td align="left">&gt;=</td>
<td align="left">å¤§äºç­‰äº</td>
</tr>
<tr>
<td align="left">between</td>
<td align="left">åœ¨æŒ‡å®šçš„ä¸¤ä¸ªå€¼ä¹‹é—´</td>
</tr>
</tbody></table>
<p>1.æ£€æŸ¥å•ä¸ªå€¼</p>
<blockquote>
<blockquote>
<p>ä» products è¡¨ä¸­æ£€ç´¢ä¸¤ä¸ªåˆ—(prod_name,prod_price),ä½†ä¸è¿”å›æ‰€æœ‰è¡Œ,åªè¿”å› prod_name çš„å€¼ä¸º Fuses çš„ä¸€è¡Œã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where prod_name='fuses';</span><br><span class="line">+-----------+------------+</span><br><span class="line">| prod_name | prod_price |</span><br><span class="line">+-----------+------------+</span><br><span class="line">| Fuses     |       3.42 |</span><br><span class="line">+-----------+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ£€æŸ¥ <code>WHERE prod_name=&#39;fuses&#39;</code> è¯­å¥,å®ƒè¿”å› prod_name çš„å€¼ä¸º Fuses çš„ä¸€è¡Œã€‚MySQLåœ¨æ‰§è¡ŒåŒ¹é…æ—¶é»˜è®¤ä¸åŒºåˆ†å¤§å°å†™,æ‰€ä»¥ fuses ä¸ Fuses åŒ¹é…ã€‚</p>
<blockquote>
<blockquote>
<p>åˆ—å‡ºä»·æ ¼å°äº10ç¾å…ƒçš„æ‰€æœ‰äº§å“</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where prod_price &lt; 10;</span><br><span class="line">+---------------+------------+</span><br><span class="line">| prod_name     | prod_price |</span><br><span class="line">+---------------+------------+</span><br><span class="line">| .5 ton anvil  |       5.99 |</span><br><span class="line">| 1 ton anvil   |       9.99 |</span><br><span class="line">| Carrots       |       2.50 |</span><br><span class="line">| Fuses         |       3.42 |</span><br><span class="line">| Oil can       |       8.99 |</span><br><span class="line">| Sling         |       4.49 |</span><br><span class="line">| TNT (1 stick) |       2.50 |</span><br><span class="line">+---------------+------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>æ£€ç´¢ä»·æ ¼å°äºç­‰äº10ç¾å…ƒçš„æ‰€æœ‰äº§å“</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where prod_price &lt;= 10;</span><br><span class="line">+----------------+------------+</span><br><span class="line">| prod_name      | prod_price |</span><br><span class="line">+----------------+------------+</span><br><span class="line">| .5 ton anvil   |       5.99 |</span><br><span class="line">| 1 ton anvil    |       9.99 |</span><br><span class="line">| Bird seed      |      10.00 |</span><br><span class="line">| Carrots        |       2.50 |</span><br><span class="line">| Fuses          |       3.42 |</span><br><span class="line">| Oil can        |       8.99 |</span><br><span class="line">| Sling          |       4.49 |</span><br><span class="line">| TNT (1 stick)  |       2.50 |</span><br><span class="line">| TNT (5 sticks) |      10.00 |</span><br><span class="line">+----------------+------------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>å®è·µæ€è€ƒ</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> MariaDB [test]&gt; select prod_name,prod_price from products where prod_name &lt;= "b";</span><br><span class="line">+--------------+------------+</span><br><span class="line">| prod_name    | prod_price |</span><br><span class="line">+--------------+------------+</span><br><span class="line">| .5 ton anvil |       5.99 |</span><br><span class="line">| 1 ton anvil  |       9.99 |</span><br><span class="line">| 2 ton anvil  |      14.99 |</span><br><span class="line">+--------------+------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where prod_name &lt;= b;</span><br><span class="line">ERROR 1054 (42S22): Unknown column 'b' in 'where clause'</span><br><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where prod_name &lt; "F";</span><br><span class="line">+--------------+------------+</span><br><span class="line">| prod_name    | prod_price |</span><br><span class="line">+--------------+------------+</span><br><span class="line">| .5 ton anvil |       5.99 |</span><br><span class="line">| 1 ton anvil  |       9.99 |</span><br><span class="line">| 2 ton anvil  |      14.99 |</span><br><span class="line">| Detonator    |      13.00 |</span><br><span class="line">| Bird seed    |      10.00 |</span><br><span class="line">| Carrots      |       2.50 |</span><br><span class="line">+--------------+------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where prod_name &lt; "f";</span><br><span class="line">+--------------+------------+</span><br><span class="line">| prod_name    | prod_price |</span><br><span class="line">+--------------+------------+</span><br><span class="line">| .5 ton anvil |       5.99 |</span><br><span class="line">| 1 ton anvil  |       9.99 |</span><br><span class="line">| 2 ton anvil  |      14.99 |</span><br><span class="line">| Detonator    |      13.00 |</span><br><span class="line">| Bird seed    |      10.00 |</span><br><span class="line">| Carrots      |       2.50 |</span><br><span class="line">+--------------+------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>ä½•æ—¶ä½¿ç”¨å¼•å·</strong> å¦‚æœä»”ç»†è§‚å¯Ÿä¸Šè¿° WHERE å­å¥ä¸­ä½¿ç”¨çš„æ¡ä»¶,ä¼šçœ‹åˆ°æœ‰çš„å€¼æ‹¬åœ¨å•å¼•å·å†…(å¦‚å‰é¢ä½¿ç”¨çš„ â€˜fusesâ€™ ),è€Œæœ‰çš„å€¼æœªæ‹¬èµ·æ¥ã€‚å•å¼•å·ç”¨æ¥é™å®šå­—ç¬¦ä¸²ã€‚å¦‚æœå°†å€¼ä¸ä¸²ç±»å‹çš„åˆ—è¿›è¡Œæ¯”è¾ƒ,åˆ™éœ€è¦é™å®šå¼•å·ã€‚ç”¨æ¥ä¸æ•°å€¼åˆ—è¿›è¡Œæ¯”è¾ƒçš„å€¼ä¸ç”¨å¼•å·ã€‚</p>
<p>2.ä¸åŒ¹é…æ£€æŸ¥</p>
<blockquote>
<blockquote>
<p>ä¸æ˜¯ç”±ä¾›åº”å•† 1003 åˆ¶é€ çš„æ‰€æœ‰äº§å“</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select vend_id,prod_name from products where vend_id &lt;&gt; 1003;</span><br><span class="line">+---------+--------------+</span><br><span class="line">| vend_id | prod_name    |</span><br><span class="line">+---------+--------------+</span><br><span class="line">|    1001 | .5 ton anvil |</span><br><span class="line">|    1001 | 1 ton anvil  |</span><br><span class="line">|    1001 | 2 ton anvil  |</span><br><span class="line">|    1002 | Fuses        |</span><br><span class="line">|    1005 | JetPack 1000 |</span><br><span class="line">|    1005 | JetPack 2000 |</span><br><span class="line">|    1002 | Oil can      |</span><br><span class="line">+---------+--------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select vend_id,prod_name from products where vend_id != 1003;</span><br><span class="line">+---------+--------------+</span><br><span class="line">| vend_id | prod_name    |</span><br><span class="line">+---------+--------------+</span><br><span class="line">|    1001 | .5 ton anvil |</span><br><span class="line">|    1001 | 1 ton anvil  |</span><br><span class="line">|    1001 | 2 ton anvil  |</span><br><span class="line">|    1002 | Fuses        |</span><br><span class="line">|    1005 | JetPack 1000 |</span><br><span class="line">|    1005 | JetPack 2000 |</span><br><span class="line">|    1002 | Oil can      |</span><br><span class="line">+---------+--------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>3.èŒƒå›´å€¼æ£€æŸ¥</p>
<p>ä¸ºäº†æ£€æŸ¥æŸä¸ªèŒƒå›´çš„å€¼,å¯ä½¿ç”¨ BETWEEN æ“ä½œç¬¦ã€‚å…¶è¯­æ³•ä¸å…¶ä»– WHERE å­å¥çš„æ“ä½œç¬¦ç¨æœ‰ä¸åŒ,å› ä¸ºå®ƒéœ€è¦ä¸¤ä¸ªå€¼,å³èŒƒå›´çš„å¼€å§‹å€¼å’Œç»“æŸå€¼ã€‚</p>
<p>ä¾‹å¦‚, BETWEEN æ“ä½œç¬¦å¯ç”¨æ¥æ£€ç´¢ä»·æ ¼åœ¨5ç¾å…ƒå’Œ10ç¾å…ƒä¹‹é—´æˆ–æ—¥æœŸåœ¨æŒ‡å®šçš„å¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸä¹‹é—´çš„æ‰€æœ‰äº§å“ã€‚</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢ä»·æ ¼åœ¨5ç¾å…ƒå’Œ10ç¾å…ƒä¹‹é—´çš„æ‰€æœ‰äº§å“</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where prod_price between 5 and 10;</span><br><span class="line">+----------------+------------+</span><br><span class="line">| prod_name      | prod_price |</span><br><span class="line">+----------------+------------+</span><br><span class="line">| .5 ton anvil   |       5.99 |</span><br><span class="line">| 1 ton anvil    |       9.99 |</span><br><span class="line">| Bird seed      |      10.00 |</span><br><span class="line">| Oil can        |       8.99 |</span><br><span class="line">| TNT (5 sticks) |      10.00 |</span><br><span class="line">+----------------+------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where prod_price between 5 and 10 order by prod_price;</span><br><span class="line">+----------------+------------+</span><br><span class="line">| prod_name      | prod_price |</span><br><span class="line">+----------------+------------+</span><br><span class="line">| .5 ton anvil   |       5.99 |</span><br><span class="line">| Oil can        |       8.99 |</span><br><span class="line">| 1 ton anvil    |       9.99 |</span><br><span class="line">| Bird seed      |      10.00 |</span><br><span class="line">| TNT (5 sticks) |      10.00 |</span><br><span class="line">+----------------+------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>4.ç©ºå€¼æ£€æŸ¥</p>
<p>åœ¨åˆ›å»ºè¡¨æ—¶,è¡¨è®¾è®¡äººå‘˜å¯ä»¥æŒ‡å®šå…¶ä¸­çš„åˆ—æ˜¯å¦å¯ä»¥ä¸åŒ…å«å€¼ã€‚åœ¨ä¸€ä¸ªåˆ—ä¸åŒ…å«å€¼æ—¶,ç§°å…¶ä¸ºåŒ…å«ç©ºå€¼ NULL ã€‚</p>
<p><strong>NULL æ— å€¼(no value)</strong> å®ƒä¸å­—æ®µåŒ…å« 0 ã€ç©ºå­—ç¬¦ä¸²æˆ–ä»…ä»…åŒ…å«ç©ºæ ¼ä¸åŒã€‚</p>
<blockquote>
<blockquote>
<p>æ£€æŸ¥productsè¡¨ä¸­prod_priceåˆ—å…·æœ‰ NULL å€¼çš„è¡Œ</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where prod_price is null;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>æ£€æŸ¥customersè¡¨ä¸­cust_emailåˆ—å…·æœ‰ NULL å€¼çš„è¡Œ</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select cust_name,cust_email from customers where cust_email is null;</span><br><span class="line">+-------------+------------+</span><br><span class="line">| cust_name   | cust_email |</span><br><span class="line">+-------------+------------+</span><br><span class="line">| Mouse House | NULL       |</span><br><span class="line">| E Fudd      | NULL       |</span><br><span class="line">+-------------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>æ£€æŸ¥customersè¡¨ä¸­cust_emailåˆ—ä¸å…·æœ‰ NULL å€¼çš„è¡Œ</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select cust_name,cust_email from customers where cust_email is not null;</span><br><span class="line">+----------------+---------------------+</span><br><span class="line">| cust_name      | cust_email          |</span><br><span class="line">+----------------+---------------------+</span><br><span class="line">| Coyote Inc.    | ylee@coyote.com     |</span><br><span class="line">| Wascals        | rabbit@wascally.com |</span><br><span class="line">| Yosemite Place | sam@yosemite.com    |</span><br><span class="line">+----------------+---------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« ä»‹ç»äº†å¦‚ä½•ç”¨ SELECT è¯­å¥çš„ WHERE å­å¥è¿‡æ»¤è¿”å›çš„æ•°æ®ã€‚æˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•å¯¹ç›¸ç­‰ã€ä¸ç›¸ç­‰ã€å¤§äºã€å°äºã€å€¼çš„èŒƒå›´ä»¥åŠ NULL å€¼ç­‰è¿›è¡Œæµ‹è¯•ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="æ•°æ®è¿‡æ»¤"><a href="#æ•°æ®è¿‡æ»¤" class="headerlink" title="æ•°æ®è¿‡æ»¤"></a>æ•°æ®è¿‡æ»¤</h4><p>æœ¬ç« è®²æˆå¦‚ä½•ç»„åˆ WHERE å­å¥ä»¥å»ºç«‹åŠŸèƒ½æ›´å¼ºçš„æ›´é«˜çº§çš„æœç´¢æ¡ä»¶ã€‚æˆ‘ä»¬è¿˜å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ NOT å’Œ IN æ“ä½œç¬¦ã€‚</p>
<p>å‰é¢ç« èŠ‚ä¸­ä»‹ç»çš„æ‰€æœ‰ WHERE å­å¥åœ¨è¿‡æ»¤æ•°æ®æ—¶ä½¿ç”¨çš„éƒ½æ˜¯å•ä¸€çš„æ¡ä»¶ã€‚ä¸ºäº†è¿›è¡Œæ›´å¼ºçš„è¿‡æ»¤æ§åˆ¶,MySQLå…è®¸ç»™å‡ºå¤šä¸ª WHERE å­å¥ã€‚è¿™äº›å­å¥å¯ä»¥ä¸¤ç§æ–¹å¼ä½¿ç”¨:ä»¥ AND å­å¥çš„æ–¹å¼æˆ– OR å­å¥çš„æ–¹å¼ä½¿ç”¨ã€‚</p>
<p><strong>æ“ä½œç¬¦(operator)</strong> ç”¨æ¥è”ç»“æˆ–æ”¹å˜ WHERE å­å¥ä¸­çš„å­å¥çš„å…³é”®å­—ã€‚ä¹Ÿç§°ä¸ºé€»è¾‘æ“ä½œç¬¦(logical operator)ã€‚</p>
<blockquote>
<p>ç»„åˆ WHERE å­å¥</p>
</blockquote>
<ol>
<li>AND æ“ä½œç¬¦</li>
</ol>
<p><code>AND</code> ç”¨åœ¨ WHERE å­å¥ä¸­çš„å…³é”®å­—,ç”¨æ¥æŒ‡ç¤ºæ£€ç´¢æ»¡è¶³æ‰€æœ‰ç»™å®šæ¡ä»¶çš„è¡Œã€‚</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢productsè¡¨ç”±ä¾›åº”å•† 1003 åˆ¶é€ ä¸”ä»·æ ¼å°äºç­‰äº10ç¾å…ƒçš„æ‰€æœ‰äº§å“çš„åç§°å’Œä»·æ ¼ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where vend_id=1003 and prod_price &lt;= 10;</span><br><span class="line">+----------------+------------+</span><br><span class="line">| prod_name      | prod_price |</span><br><span class="line">+----------------+------------+</span><br><span class="line">| Bird seed      |      10.00 |</span><br><span class="line">| Carrots        |       2.50 |</span><br><span class="line">| Sling          |       4.49 |</span><br><span class="line">| TNT (1 stick)  |       2.50 |</span><br><span class="line">| TNT (5 sticks) |      10.00 |</span><br><span class="line">+----------------+------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>OR æ“ä½œç¬¦</li>
</ol>
<p><code>OR</code> æ“ä½œç¬¦ä¸ AND æ“ä½œç¬¦ä¸åŒ,å®ƒæŒ‡ç¤ºMySQLæ£€ç´¢åŒ¹é…ä»»ä¸€æ¡ä»¶çš„è¡Œã€‚</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢productsè¡¨ç”±ä¾›åº”å•† 1002æˆ–1003 åˆ¶é€ çš„æ‰€æœ‰äº§å“çš„åç§°å’Œä»·æ ¼ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where vend_id=1002 or vend_id=1003;</span><br><span class="line">+----------------+------------+</span><br><span class="line">| prod_name      | prod_price |</span><br><span class="line">+----------------+------------+</span><br><span class="line">| Detonator      |      13.00 |</span><br><span class="line">| Bird seed      |      10.00 |</span><br><span class="line">| Carrots        |       2.50 |</span><br><span class="line">| Fuses          |       3.42 |</span><br><span class="line">| Oil can        |       8.99 |</span><br><span class="line">| Safe           |      50.00 |</span><br><span class="line">| Sling          |       4.49 |</span><br><span class="line">| TNT (1 stick)  |       2.50 |</span><br><span class="line">| TNT (5 sticks) |      10.00 |</span><br><span class="line">+----------------+------------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è®¡ç®—æ¬¡åº</li>
</ol>
<p>WHERE å¯åŒ…å«ä»»æ„æ•°ç›®çš„ AND å’Œ OR æ“ä½œç¬¦ã€‚å…è®¸ä¸¤è€…ç»“åˆä»¥è¿›è¡Œå¤æ‚å’Œé«˜çº§çš„è¿‡æ»¤ã€‚</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢productsè¡¨ï¼Œåˆ—å‡ºä»·æ ¼ä¸º10ç¾å…ƒ(å«)ä»¥ä¸Šä¸”ç”± 1002 æˆ– 1003 åˆ¶é€ çš„æ‰€æœ‰äº§å“ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price,vend_id from products where vend_id=1002 or vend_id=1003 and prod_price &gt;=10;</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">| prod_name      | prod_price | vend_id |</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">| Detonator      |      13.00 |    1003 |</span><br><span class="line">| Bird seed      |      10.00 |    1003 |</span><br><span class="line">| Fuses          |       3.42 |    1002 |</span><br><span class="line">| Oil can        |       8.99 |    1002 |</span><br><span class="line">| Safe           |      50.00 |    1003 |</span><br><span class="line">| TNT (5 sticks) |      10.00 |    1003 |</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¯·çœ‹ä¸Šé¢çš„ç»“æœã€‚è¿”å›çš„è¡Œä¸­æœ‰ä¸¤è¡Œä»·æ ¼å°äº10ç¾å…ƒ,æ˜¾ç„¶,è¿”å›çš„è¡ŒæœªæŒ‰é¢„æœŸçš„è¿›è¡Œè¿‡æ»¤ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢?åŸå› åœ¨äºè®¡ç®—çš„æ¬¡åºã€‚SQL(åƒå¤šæ•°è¯­è¨€ä¸€æ ·)åœ¨å¤„ç† OR æ“ä½œç¬¦å‰,ä¼˜å…ˆå¤„ç† AND æ“ä½œç¬¦ã€‚å½“SQLçœ‹åˆ°ä¸Šè¿° WHERE å­å¥æ—¶,å®ƒç†è§£ä¸ºç”±ä¾›åº”å•† 1003 åˆ¶é€ çš„ä»»ä½•ä»·æ ¼ä¸º10ç¾å…ƒ(å«)ä»¥ä¸Šçš„äº§å“,æˆ–è€…ç”±ä¾›åº”å•† 1002 åˆ¶é€ çš„ä»»ä½•äº§å“,è€Œä¸ç®¡å…¶ä»·æ ¼å¦‚ä½•ã€‚æ¢å¥è¯è¯´,ç”±äº AND åœ¨è®¡ç®—æ¬¡åºä¸­ä¼˜å…ˆçº§æ›´é«˜,æ“ä½œç¬¦è¢«é”™è¯¯åœ°ç»„åˆäº†ã€‚</p>
<p>æ­¤é—®é¢˜çš„è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨åœ†æ‹¬å·æ˜ç¡®åœ°åˆ†ç»„ç›¸åº”çš„æ“ä½œç¬¦ã€‚è¯·çœ‹ä¸‹é¢çš„ SELECT è¯­å¥åŠè¾“å‡º:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price,vend_id from products where (vend_id=1002 or vend_id=1003) and prod_price &gt;=10;</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">| prod_name      | prod_price | vend_id |</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">| Detonator      |      13.00 |    1003 |</span><br><span class="line">| Bird seed      |      10.00 |    1003 |</span><br><span class="line">| Safe           |      50.00 |    1003 |</span><br><span class="line">| TNT (5 sticks) |      10.00 |    1003 |</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–æ–¹æ³•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price,vend_id from products where prod_price &gt;= 10 and vend_id=1002 or prod_price &gt;=10 and vend_id=1003 ;</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">| prod_name      | prod_price | vend_id |</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">| Detonator      |      13.00 |    1003 |</span><br><span class="line">| Bird seed      |      10.00 |    1003 |</span><br><span class="line">| Safe           |      50.00 |    1003 |</span><br><span class="line">| TNT (5 sticks) |      10.00 |    1003 |</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>åœ¨WHEREå­å¥ä¸­ä½¿ç”¨åœ†æ‹¬å·</strong> ä»»ä½•æ—¶å€™ä½¿ç”¨å…·æœ‰ AND å’Œ OR æ“ä½œç¬¦çš„ WHERE å­å¥,éƒ½åº”è¯¥ä½¿ç”¨åœ†æ‹¬å·æ˜ç¡®åœ°åˆ†ç»„æ“ä½œç¬¦ã€‚ä¸è¦è¿‡åˆ†ä¾èµ–é»˜è®¤è®¡ç®—æ¬¡åº,å³ä½¿å®ƒç¡®å®æ˜¯ä½ æƒ³è¦çš„ä¸œè¥¿ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä½¿ç”¨åœ†æ‹¬å·æ²¡æœ‰ä»€ä¹ˆåå¤„,å®ƒèƒ½æ¶ˆé™¤æ­§ä¹‰ã€‚</p>
<blockquote>
<p>IN æ“ä½œç¬¦</p>
</blockquote>
<p>åœ†æ‹¬å·åœ¨ WHERE å­å¥ä¸­è¿˜æœ‰å¦å¤–ä¸€ç§ç”¨æ³•ã€‚ IN æ“ä½œç¬¦ç”¨æ¥æŒ‡å®šæ¡ä»¶èŒƒå›´,èŒƒå›´ä¸­çš„æ¯ä¸ªæ¡ä»¶éƒ½å¯ä»¥è¿›è¡ŒåŒ¹é…ã€‚ IN å–åˆæ³•å€¼çš„ç”±é€—å·åˆ†éš”çš„æ¸…å•,å…¨éƒ½æ‹¬åœ¨åœ†æ‹¬å·ä¸­ã€‚</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢productsè¡¨ï¼Œåˆ—å‡ºç”± 1002 æˆ– 1003 åˆ¶é€ çš„æ‰€æœ‰äº§å“ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price,vend_id from products where vend_id in (1002,1003);</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">| prod_name      | prod_price | vend_id |</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">| Detonator      |      13.00 |    1003 |</span><br><span class="line">| Bird seed      |      10.00 |    1003 |</span><br><span class="line">| Carrots        |       2.50 |    1003 |</span><br><span class="line">| Fuses          |       3.42 |    1002 |</span><br><span class="line">| Oil can        |       8.99 |    1002 |</span><br><span class="line">| Safe           |      50.00 |    1003 |</span><br><span class="line">| Sling          |       4.49 |    1003 |</span><br><span class="line">| TNT (1 stick)  |       2.50 |    1003 |</span><br><span class="line">| TNT (5 sticks) |      10.00 |    1003 |</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><code>IN</code> WHERE å­å¥ä¸­ç”¨æ¥æŒ‡å®šè¦åŒ¹é…å€¼çš„æ¸…å•çš„å…³é”®å­—,åŠŸèƒ½ä¸ ORç›¸å½“ ã€‚</p>
<p>IN æ“ä½œç¬¦ä¸ OR ç›¸åŒçš„åŠŸèƒ½ï¼Œä¸‹é¢ä¸€äº›å®ä¾‹å®Œæˆä¹‹å‰çš„ä¸€äº›æ“ä½œï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price,vend_id from products where vend_id in (1002,1003) and prod_price &gt;= 10;</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">| prod_name      | prod_price | vend_id |</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">| Detonator      |      13.00 |    1003 |</span><br><span class="line">| Bird seed      |      10.00 |    1003 |</span><br><span class="line">| Safe           |      50.00 |    1003 |</span><br><span class="line">| TNT (5 sticks) |      10.00 |    1003 |</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name,prod_price,vend_id from products where vend_id in (1002,1003) order by prod_price;</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">| prod_name      | prod_price | vend_id |</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">| Carrots        |       2.50 |    1003 |</span><br><span class="line">| TNT (1 stick)  |       2.50 |    1003 |</span><br><span class="line">| Fuses          |       3.42 |    1002 |</span><br><span class="line">| Sling          |       4.49 |    1003 |</span><br><span class="line">| Oil can        |       8.99 |    1002 |</span><br><span class="line">| Bird seed      |      10.00 |    1003 |</span><br><span class="line">| TNT (5 sticks) |      10.00 |    1003 |</span><br><span class="line">| Detonator      |      13.00 |    1003 |</span><br><span class="line">| Safe           |      50.00 |    1003 |</span><br><span class="line">+----------------+------------+---------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ IN æ“ä½œç¬¦?</strong> å…¶ä¼˜ç‚¹å…·ä½“å¦‚ä¸‹ã€‚</p>
<ul>
<li>åœ¨ä½¿ç”¨é•¿çš„åˆæ³•é€‰é¡¹æ¸…å•æ—¶, IN æ“ä½œç¬¦çš„è¯­æ³•æ›´æ¸…æ¥šä¸”æ›´ç›´è§‚ã€‚</li>
<li>åœ¨ä½¿ç”¨ IN æ—¶,è®¡ç®—çš„æ¬¡åºæ›´å®¹æ˜“ç®¡ç†(å› ä¸ºä½¿ç”¨çš„æ“ä½œç¬¦æ›´å°‘)ã€‚</li>
<li>IN æ“ä½œç¬¦ä¸€èˆ¬æ¯” OR æ“ä½œç¬¦æ¸…å•æ‰§è¡Œæ›´å¿«ã€‚</li>
<li>IN çš„æœ€å¤§ä¼˜ç‚¹æ˜¯å¯ä»¥åŒ…å«å…¶ä»– SELECT è¯­å¥,ä½¿å¾—èƒ½å¤Ÿæ›´åŠ¨æ€åœ°å»ºç«‹ WHERE å­å¥ã€‚ä¹‹åç« èŠ‚å°†å¯¹æ­¤è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</li>
</ul>
<blockquote>
<p>NOT æ“ä½œç¬¦</p>
</blockquote>
<p>WHERE å­å¥ä¸­çš„ NOT æ“ä½œç¬¦æœ‰ä¸”åªæœ‰ä¸€ä¸ªåŠŸèƒ½,é‚£å°±æ˜¯å¦å®šå®ƒä¹‹åæ‰€è·Ÿçš„ä»»ä½•æ¡ä»¶ã€‚</p>
<p><code>NOT</code> WHERE å­å¥ä¸­ç”¨æ¥å¦å®šåè·Ÿæ¡ä»¶çš„å…³é”®å­—ã€‚</p>
<blockquote>
<blockquote>
<p>åˆ—å‡ºé™¤ 1002å’Œ1003 ä¹‹å¤–çš„æ‰€æœ‰ä¾›åº”å•†åˆ¶é€ çš„äº§å“</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price,vend_id from products where vend_id not in (1002,1003);</span><br><span class="line">+--------------+------------+---------+</span><br><span class="line">| prod_name    | prod_price | vend_id |</span><br><span class="line">+--------------+------------+---------+</span><br><span class="line">| .5 ton anvil |       5.99 |    1001 |</span><br><span class="line">| 1 ton anvil  |       9.99 |    1001 |</span><br><span class="line">| 2 ton anvil  |      14.99 |    1001 |</span><br><span class="line">| JetPack 1000 |      35.00 |    1005 |</span><br><span class="line">| JetPack 2000 |      55.00 |    1005 |</span><br><span class="line">+--------------+------------+---------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name,prod_price,vend_id from products where vend_id != 1002 and vend_id != 1003;</span><br><span class="line">+--------------+------------+---------+</span><br><span class="line">| prod_name    | prod_price | vend_id |</span><br><span class="line">+--------------+------------+---------+</span><br><span class="line">| .5 ton anvil |       5.99 |    1001 |</span><br><span class="line">| 1 ton anvil  |       9.99 |    1001 |</span><br><span class="line">| 2 ton anvil  |      14.99 |    1001 |</span><br><span class="line">| JetPack 1000 |      35.00 |    1005 |</span><br><span class="line">| JetPack 2000 |      55.00 |    1005 |</span><br><span class="line">+--------------+------------+---------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name,prod_price,vend_id from products where vend_id &lt;&gt; 1002 and vend_id &lt;&gt; 1003;</span><br><span class="line">+--------------+------------+---------+</span><br><span class="line">| prod_name    | prod_price | vend_id |</span><br><span class="line">+--------------+------------+---------+</span><br><span class="line">| .5 ton anvil |       5.99 |    1001 |</span><br><span class="line">| 1 ton anvil  |       9.99 |    1001 |</span><br><span class="line">| 2 ton anvil  |      14.99 |    1001 |</span><br><span class="line">| JetPack 1000 |      35.00 |    1005 |</span><br><span class="line">| JetPack 2000 |      55.00 |    1005 |</span><br><span class="line">+--------------+------------+---------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ NOT ?</strong> å¯¹äºç®€å•çš„ WHERE å­å¥,ä½¿ç”¨ NOT ç¡®å®æ²¡æœ‰ä»€ä¹ˆä¼˜åŠ¿ã€‚ä½†åœ¨æ›´å¤æ‚çš„å­å¥ä¸­, NOT æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p>
<p>ä¾‹å¦‚,åœ¨ä¸ IN æ“ä½œç¬¦è”åˆä½¿ç”¨æ—¶, NOT ä½¿æ‰¾å‡ºä¸æ¡ä»¶åˆ—è¡¨ä¸åŒ¹é…çš„è¡Œéå¸¸ç®€å•ã€‚</p>
<p><strong>MySQL ä¸­çš„NOT</strong> MySQL æ”¯ æŒ ä½¿ ç”¨ NOT å¯¹ IN ã€ BETWEEN å’ŒEXISTSå­å¥å–å,è¿™ä¸å¤šæ•°å…¶ä»– DBMSå…è®¸ä½¿ç”¨ NOT å¯¹å„ç§æ¡ä»¶å–åæœ‰å¾ˆå¤§çš„å·®åˆ«ã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« è®²æˆå¦‚ä½•ç”¨ AND å’Œ OR æ“ä½œç¬¦ç»„åˆæˆ WHERE å­å¥,è€Œä¸”è¿˜è®²æˆäº†å¦‚ä½•æ˜ç¡®åœ°ç®¡ç†è®¡ç®—çš„æ¬¡åº,å¦‚ä½•ä½¿ç”¨ IN å’Œ NOT æ“ä½œç¬¦ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="ç”¨é€šé…ç¬¦è¿›è¡Œè¿‡æ»¤"><a href="#ç”¨é€šé…ç¬¦è¿›è¡Œè¿‡æ»¤" class="headerlink" title="ç”¨é€šé…ç¬¦è¿›è¡Œè¿‡æ»¤"></a>ç”¨é€šé…ç¬¦è¿›è¡Œè¿‡æ»¤</h4><p>æœ¬ç« ä»‹ç»ä»€ä¹ˆæ˜¯é€šé…ç¬¦ã€å¦‚ä½•ä½¿ç”¨é€šé…ç¬¦ä»¥åŠæ€æ ·ä½¿ç”¨ LIKE æ“ä½œç¬¦è¿›è¡Œé€šé…æœç´¢,ä»¥ä¾¿å¯¹æ•°æ®è¿›è¡Œå¤æ‚è¿‡æ»¤ã€‚</p>
<blockquote>
<p>LIKE æ“ä½œç¬¦</p>
</blockquote>
<p>å‰é¢ä»‹ç»çš„æ‰€æœ‰æ“ä½œç¬¦éƒ½æ˜¯é’ˆå¯¹å·²çŸ¥å€¼è¿›è¡Œè¿‡æ»¤çš„ã€‚ä¸ç®¡æ˜¯åŒ¹é…ä¸€ä¸ªè¿˜æ˜¯å¤šä¸ªå€¼,æµ‹è¯•å¤§äºè¿˜æ˜¯å°äºå·²çŸ¥å€¼,æˆ–è€…æ£€æŸ¥æŸä¸ªèŒƒå›´çš„å€¼,å…±åŒç‚¹æ˜¯è¿‡æ»¤ä¸­ä½¿ç”¨çš„å€¼éƒ½æ˜¯å·²çŸ¥çš„ã€‚ä½†æ˜¯,è¿™ç§è¿‡æ»¤æ–¹æ³•å¹¶ä¸æ˜¯ä»»ä½•æ—¶å€™éƒ½å¥½ç”¨ã€‚ä¾‹å¦‚,æ€æ ·æœç´¢äº§å“åä¸­åŒ…å«æ–‡æœ¬anvilçš„æ‰€æœ‰äº§å“?ç”¨ç®€å•çš„æ¯”è¾ƒæ“ä½œç¬¦è‚¯å®šä¸è¡Œ,å¿…é¡»ä½¿ç”¨é€šé…ç¬¦ã€‚åˆ©ç”¨é€šé…ç¬¦å¯åˆ›å»ºæ¯”è¾ƒç‰¹å®šæ•°æ®çš„æœç´¢æ¨¡å¼ã€‚</p>
<p><strong>é€šé…ç¬¦(wildcard)</strong> ç”¨æ¥åŒ¹é…å€¼çš„ä¸€éƒ¨åˆ†çš„ç‰¹æ®Šå­—ç¬¦ã€‚</p>
<p><strong>æœç´¢æ¨¡å¼(search pattern)</strong> ç”±å­—é¢å€¼ã€é€šé…ç¬¦æˆ–ä¸¤è€…ç»„åˆæ„æˆçš„æœç´¢æ¡ä»¶ã€‚</p>
<p>é€šé…ç¬¦æœ¬èº«å®é™…æ˜¯SQLçš„ WHERE å­å¥ä¸­æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦,SQLæ”¯æŒå‡ ç§é€šé…ç¬¦(%,_)ã€‚</p>
<p>ä¸ºåœ¨æœç´¢å­å¥ä¸­ä½¿ç”¨é€šé…ç¬¦,å¿…é¡»ä½¿ç”¨ LIKE æ“ä½œç¬¦ã€‚ LIKE æŒ‡ç¤ºMySQL,åè·Ÿçš„æœç´¢æ¨¡å¼åˆ©ç”¨é€šé…ç¬¦åŒ¹é…è€Œä¸æ˜¯ç›´æ¥ç›¸ç­‰åŒ¹é…è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p><strong>è°“è¯</strong> æ“ä½œç¬¦ä½•æ—¶ä¸æ˜¯æ“ä½œç¬¦?ç­”æ¡ˆæ˜¯åœ¨å®ƒä½œä¸ºè°“è¯(predi-cate)æ—¶ã€‚ä»æŠ€æœ¯ä¸Šè¯´, LIKE æ˜¯è°“è¯è€Œä¸æ˜¯æ“ä½œç¬¦ã€‚è™½ç„¶æœ€ç»ˆçš„ç»“æœæ˜¯ç›¸åŒçš„,ä½†åº”è¯¥å¯¹æ­¤æœ¯è¯­æœ‰æ‰€äº†è§£,ä»¥å…åœ¨SQLæ–‡æ¡£ä¸­é‡åˆ°æ­¤æœ¯è¯­æ—¶ä¸çŸ¥é“ã€‚</p>
<p>1.ç™¾åˆ†å·( % )é€šé…ç¬¦</p>
<p>æœ€å¸¸ä½¿ç”¨çš„é€šé…ç¬¦æ˜¯ç™¾åˆ†å·( % )ã€‚åœ¨æœç´¢ä¸²ä¸­, % è¡¨ç¤ºä»»ä½•å­—ç¬¦å‡ºç°ä»»æ„æ¬¡æ•°ã€‚</p>
<blockquote>
<blockquote>
<p>æ‰¾å‡ºæ‰€æœ‰ä»¥è¯ jet èµ·å¤´çš„äº§å“</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where prod_name like "jet%" ;</span><br><span class="line">+--------------+------------+</span><br><span class="line">| prod_name    | prod_price |</span><br><span class="line">+--------------+------------+</span><br><span class="line">| JetPack 1000 |      35.00 |</span><br><span class="line">| JetPack 2000 |      55.00 |</span><br><span class="line">+--------------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>é€šé…ç¬¦å¯åœ¨æœç´¢æ¨¡å¼ä¸­ä»»æ„ä½ç½®ä½¿ç”¨,å¹¶ä¸”å¯ä»¥ä½¿ç”¨å¤šä¸ªé€šé…ç¬¦ã€‚</p>
<blockquote>
<blockquote>
<p>æ‰¾å‡ºæ‰€æœ‰åŒ…å«anvilçš„äº§å“</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where prod_name like "%anvil%" ;</span><br><span class="line">+--------------+------------+</span><br><span class="line">| prod_name    | prod_price |</span><br><span class="line">+--------------+------------+</span><br><span class="line">| .5 ton anvil |       5.99 |</span><br><span class="line">| 1 ton anvil  |       9.99 |</span><br><span class="line">| 2 ton anvil  |      14.99 |</span><br><span class="line">+--------------+------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>é€šé…ç¬¦ä¹Ÿå¯ä»¥å‡ºç°åœ¨æœç´¢æ¨¡å¼çš„ä¸­é—´,è™½ç„¶è¿™æ ·åšä¸å¤ªæœ‰ç”¨ã€‚</p>
<blockquote>
<blockquote>
<p>æ‰¾å‡ºä»¥ s èµ·å¤´ä»¥ e ç»“å°¾çš„æ‰€æœ‰äº§å“</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where prod_name like "s%e" ;</span><br><span class="line">+-----------+------------+</span><br><span class="line">| prod_name | prod_price |</span><br><span class="line">+-----------+------------+</span><br><span class="line">| Safe      |      50.00 |</span><br><span class="line">+-----------+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>é‡è¦çš„æ˜¯è¦æ³¨æ„åˆ°,é™¤äº†ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦å¤–, % è¿˜èƒ½åŒ¹é…0ä¸ªå­—ç¬¦ã€‚ %ä»£è¡¨æœç´¢æ¨¡å¼ä¸­ç»™å®šä½ç½®çš„0ä¸ªã€1ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚</p>
<p><strong>æ³¨æ„å°¾ç©ºæ ¼</strong> å°¾ç©ºæ ¼å¯èƒ½ä¼šå¹²æ‰°é€šé…ç¬¦åŒ¹é…ã€‚ä¾‹å¦‚,åœ¨ä¿å­˜è¯anvil æ—¶ , å¦‚ æœ å®ƒ å é¢ æœ‰ ä¸€ ä¸ª æˆ– å¤š ä¸ª ç©º æ ¼ , åˆ™ å­ å¥ WHERE prod_name LIKE â€˜%anvilâ€™ å°†ä¸ä¼šåŒ¹é…å®ƒä»¬,å› ä¸ºåœ¨æœ€åçš„ låæœ‰å¤šä½™çš„å­—ç¬¦ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªç®€å•çš„åŠæ³•æ˜¯åœ¨æœç´¢æ¨¡å¼æœ€åé™„åŠ ä¸€ä¸ª % ã€‚ä¸€ä¸ªæ›´å¥½çš„åŠæ³•æ˜¯ä½¿ç”¨å‡½æ•°(ä¹‹åè®²è§£å°†ä¼šä»‹ç»)å»æ‰é¦–å°¾ç©ºæ ¼ã€‚</p>
<p><strong>æ³¨æ„NULL</strong> è™½ç„¶ä¼¼ä¹ % é€šé…ç¬¦å¯ä»¥åŒ¹é…ä»»ä½•ä¸œè¥¿,ä½†æœ‰ä¸€ä¸ªä¾‹å¤–,å³ NULL ã€‚å³ä½¿æ˜¯ WHERE prod_name LIKE â€˜%â€™ ä¹Ÿä¸èƒ½åŒ¹é…ç”¨å€¼ NULL ä½œä¸ºäº§å“åçš„è¡Œã€‚</p>
<p>2.ä¸‹åˆ’çº¿(_)é€šé…ç¬¦</p>
<p>å¦ä¸€ä¸ªæœ‰ç”¨çš„é€šé…ç¬¦æ˜¯ä¸‹åˆ’çº¿( _ )ã€‚ä¸‹åˆ’çº¿çš„ç”¨é€”ä¸ % ä¸€æ ·,ä½†ä¸‹åˆ’çº¿åªåŒ¹é…å•ä¸ªå­—ç¬¦è€Œä¸æ˜¯å¤šä¸ªå­—ç¬¦ã€‚</p>
<blockquote>
<blockquote>
<p>æ‰¾å‡ºä»¥ å¼€å¤´æœ‰ä¸€ä½ï¼Œä¹‹åæ˜¯ç©ºæ ¼ï¼Œç„¶åä¸ºton anvilçš„æ‰€æœ‰äº§å“</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,prod_price from products where prod_name like "_ ton anvil" ;</span><br><span class="line">+-------------+------------+</span><br><span class="line">| prod_name   | prod_price |</span><br><span class="line">+-------------+------------+</span><br><span class="line">| 1 ton anvil |       9.99 |</span><br><span class="line">| 2 ton anvil |      14.99 |</span><br><span class="line">+-------------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä½¿ç”¨é€šé…ç¬¦çš„æŠ€å·§</p>
</blockquote>
<p>æ­£å¦‚æ‰€è§,MySQLçš„é€šé…ç¬¦å¾ˆæœ‰ç”¨ã€‚ä½†è¿™ç§åŠŸèƒ½æ˜¯æœ‰ä»£ä»·çš„:é€šé…ç¬¦æœç´¢çš„å¤„ç†ä¸€èˆ¬è¦æ¯”å‰é¢è®¨è®ºçš„å…¶ä»–æœç´¢æ‰€èŠ±æ—¶é—´æ›´é•¿ã€‚</p>
<p>è¿™é‡Œç»™å‡ºä¸€äº›ä½¿ç”¨é€šé…ç¬¦è¦è®°ä½çš„æŠ€å·§ã€‚</p>
<ul>
<li>ä¸è¦è¿‡åº¦ä½¿ç”¨é€šé…ç¬¦ã€‚å¦‚æœå…¶ä»–æ“ä½œç¬¦èƒ½è¾¾åˆ°ç›¸åŒçš„ç›®çš„,åº”è¯¥ä½¿ç”¨å…¶ä»–æ“ä½œç¬¦ã€‚</li>
<li>åœ¨ç¡®å®éœ€è¦ä½¿ç”¨é€šé…ç¬¦æ—¶,é™¤éç»å¯¹æœ‰å¿…è¦,å¦åˆ™ä¸è¦æŠŠå®ƒä»¬ç”¨åœ¨æœç´¢æ¨¡å¼çš„å¼€å§‹å¤„ã€‚æŠŠé€šé…ç¬¦ç½®äºæœç´¢æ¨¡å¼çš„å¼€å§‹å¤„,æœç´¢èµ·æ¥æ˜¯æœ€æ…¢çš„ã€‚</li>
<li>ä»”ç»†æ³¨æ„é€šé…ç¬¦çš„ä½ç½®ã€‚å¦‚æœæ”¾é”™åœ°æ–¹,å¯èƒ½ä¸ä¼šè¿”å›æƒ³è¦çš„æ•°æ®ã€‚</li>
</ul>
<p>æ€»ä¹‹,é€šé…ç¬¦æ˜¯ä¸€ç§æé‡è¦å’Œæœ‰ç”¨çš„æœç´¢å·¥å…·,ä»¥åæˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°å®ƒã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« ä»‹ç»äº†ä»€ä¹ˆæ˜¯é€šé…ç¬¦ä»¥åŠå¦‚ä½•åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨SQLé€šé…ç¬¦,å¹¶ä¸”è¿˜è¯´æ˜äº†é€šé…ç¬¦åº”è¯¥ç»†å¿ƒä½¿ç”¨,ä¸è¦è¿‡åº¦ä½¿ç”¨ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢"><a href="#ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢" class="headerlink" title="ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢"></a>ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢</h4><p>æœ¬ç« å°†å­¦ä¹ å¦‚ä½•åœ¨MySQL WHERE å­å¥å†…ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æ›´å¥½åœ°æ§åˆ¶æ•°æ®è¿‡æ»¤ã€‚</p>
<blockquote>
<p>æ­£åˆ™è¡¨è¾¾å¼ä»‹ç»</p>
</blockquote>
<p>å‰ä¸¤ç« ä¸­çš„è¿‡æ»¤ä¾‹å­å…è®¸ç”¨åŒ¹é…ã€æ¯”è¾ƒå’Œé€šé…æ“ä½œç¬¦å¯»æ‰¾æ•°æ®ã€‚å¯¹äºåŸºæœ¬çš„è¿‡æ»¤(æˆ–è€…ç”šè‡³æ˜¯æŸäº›ä¸é‚£ä¹ˆåŸºæœ¬çš„è¿‡æ»¤),è¿™æ ·å°±è¶³å¤Ÿäº†ã€‚ä½†éšç€è¿‡æ»¤æ¡ä»¶çš„å¤æ‚æ€§çš„å¢åŠ , WHERE å­å¥æœ¬èº«çš„å¤æ‚æ€§ä¹Ÿæœ‰å¿…è¦å¢åŠ ã€‚è¿™ä¹Ÿå°±æ˜¯æ­£åˆ™è¡¨è¾¾å¼å˜å¾—æœ‰ç”¨çš„åœ°æ–¹ã€‚æ­£åˆ™è¡¨è¾¾å¼æ˜¯ç”¨æ¥åŒ¹é…æ–‡æœ¬çš„ç‰¹æ®Šçš„ä¸²(å­—ç¬¦é›†åˆ)ã€‚</p>
<p>å¦‚æœä½ æƒ³ä»ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­æå–ç”µè¯å·ç ,å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚å¦‚æœä½ éœ€è¦æŸ¥æ‰¾åå­—ä¸­é—´æœ‰æ•°å­—çš„æ‰€æœ‰æ–‡ä»¶,å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚å¦‚æœä½ æƒ³åœ¨ä¸€ä¸ªæ–‡æœ¬å—ä¸­æ‰¾åˆ°æ‰€æœ‰é‡å¤çš„å•è¯,å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚å¦‚æœä½ æƒ³æ›¿æ¢ä¸€ä¸ªé¡µé¢ä¸­çš„æ‰€æœ‰URLä¸ºè¿™äº›URLçš„å®é™…HTMLé“¾æ¥,ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼(å¯¹äºæœ€åè¿™ä¸ªä¾‹å­,æˆ–è€…æ˜¯ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼)ã€‚</p>
<p>æ‰€æœ‰ç§ç±»çš„ç¨‹åºè®¾è®¡è¯­è¨€ã€æ–‡æœ¬ç¼–è¾‘å™¨ã€æ“ä½œç³»ç»Ÿç­‰éƒ½æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚æœ‰è§è¯†çš„ç¨‹åºå‘˜å’Œç½‘ç»œç®¡ç†å‘˜å·²ç»å…³æ³¨ä½œä¸ºä»–ä»¬æŠ€æœ¯å·¥å…·é‡è¦å†…å®¹çš„æ­£åˆ™è¡¨è¾¾å¼å¾ˆé•¿æ—¶é—´äº†ã€‚æ­£åˆ™è¡¨è¾¾å¼ç”¨æ­£åˆ™è¡¨è¾¾å¼è¯­è¨€æ¥å»ºç«‹,æ­£åˆ™è¡¨è¾¾å¼è¯­è¨€æ˜¯ç”¨æ¥å®Œæˆåˆšè®¨è®ºçš„æ‰€æœ‰å·¥ä½œä»¥åŠæ›´å¤šå·¥ä½œçš„ä¸€ç§ç‰¹æ®Šè¯­è¨€ã€‚ä¸ä»»æ„è¯­è¨€ä¸€æ ·,æ­£åˆ™è¡¨è¾¾å¼å…·æœ‰ä½ å¿…é¡»å­¦ä¹ çš„ç‰¹æ®Šçš„è¯­æ³•å’ŒæŒ‡ä»¤ã€‚</p>
<p>å®Œå…¨è¦†ç›–æ­£åˆ™è¡¨è¾¾å¼çš„å†…å®¹è¶…å‡ºäº†MySQLæ•°æ®åº“æ•™å­¦çš„èŒƒå›´ã€‚è™½ç„¶åŸºç¡€çŸ¥è¯†éƒ½åœ¨è¿™é‡Œåšäº†ä»‹ç»,ä½†å¯¹æ­£åˆ™è¡¨è¾¾å¼æ›´ä¸ºé€å½»çš„ä»‹ç»æˆ‘ä»¬åœ¨å‰é¢shellè¯¾ç¨‹ä¸­æœ‰ã€‚æ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p>
<blockquote>
<p>ä½¿ç”¨MySQLæ­£åˆ™è¡¨è¾¾å¼</p>
</blockquote>
<p>é‚£ä¹ˆ,æ­£åˆ™è¡¨è¾¾å¼ä¸MySQLæœ‰ä½•å…³ç³»?å·²ç»è¯´è¿‡,æ­£åˆ™è¡¨è¾¾å¼çš„ä½œç”¨æ˜¯åŒ¹é…æ–‡æœ¬,å°†ä¸€ä¸ªæ¨¡å¼(æ­£åˆ™è¡¨è¾¾å¼)ä¸ä¸€ä¸ªæ–‡æœ¬ä¸²è¿›è¡Œæ¯”è¾ƒã€‚MySQLç”¨ WHERE å­å¥å¯¹æ­£åˆ™è¡¨è¾¾å¼æä¾›äº†åˆæ­¥çš„æ”¯æŒ,å…è®¸ä½ æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼,è¿‡æ»¤ SELECT æ£€ç´¢å‡ºçš„æ•°æ®ã€‚</p>
<p><strong>ä»…ä¸ºæ­£åˆ™è¡¨è¾¾å¼è¯­è¨€çš„ä¸€ä¸ªå­é›†</strong> å¦‚æœä½ ç†Ÿæ‚‰æ­£åˆ™è¡¨è¾¾å¼,éœ€è¦æ³¨æ„:MySQLä»…æ”¯æŒå¤šæ•°æ­£åˆ™è¡¨è¾¾å¼å®ç°çš„ä¸€ä¸ªå¾ˆå°çš„å­é›†ã€‚æœ¬ç« ä»‹ç»MySQLæ”¯æŒçš„å¤§å¤šæ•°å†…å®¹ã€‚</p>
<p>1.åŸºæœ¬å­—ç¬¦åŒ¹é…</p>
<blockquote>
<blockquote>
<p>äº§å“åç§°ä¸­åŒ¹é…1000çš„</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp '1000';</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| JetPack 1000 |</span><br><span class="line">+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>äº§å“åç§°ä¸­åŒ¹é…000çš„</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp '.000';</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| JetPack 1000 |</span><br><span class="line">| JetPack 2000 |</span><br><span class="line">+--------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name like '%000%';</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| JetPack 1000 |</span><br><span class="line">| JetPack 2000 |</span><br><span class="line">+--------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>LIKE åŒ¹é…æ•´ä¸ªåˆ—ã€‚å¦‚æœè¢«åŒ¹é…çš„æ–‡æœ¬åœ¨åˆ—å€¼ä¸­å‡ºç°, LIKE å°†ä¸ä¼šæ‰¾åˆ°å®ƒ,ç›¸åº”çš„è¡Œä¹Ÿä¸è¢«è¿”å›(é™¤éä½¿ç”¨é€šé…ç¬¦)ã€‚è€Œ REGEXP åœ¨åˆ—å€¼å†…è¿›è¡ŒåŒ¹é…,å¦‚æœè¢«åŒ¹é…çš„æ–‡æœ¬åœ¨åˆ—å€¼ä¸­å‡ºç°, REGEXP å°†ä¼šæ‰¾åˆ°å®ƒ,ç›¸åº”çš„è¡Œå°†è¢«è¿”å›ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å·®åˆ«ã€‚</p>
<p>é‚£ä¹ˆ, REGEXP èƒ½ä¸èƒ½ç”¨æ¥åŒ¹é…æ•´ä¸ªåˆ—å€¼(ä»è€Œèµ·ä¸ LIKE ç›¸åŒçš„ä½œç”¨)?ç­”æ¡ˆæ˜¯è‚¯å®šçš„,ä½¿ç”¨ ^ å’Œ $ å®šä½ç¬¦(anchor)å³å¯</p>
<p><strong>åŒ¹é…ä¸åŒºåˆ†å¤§å°å†™</strong> MySQLä¸­çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…(è‡ªç‰ˆæœ¬3.23.4å)ä¸åŒºåˆ†å¤§å°å†™(å³,å¤§å†™å’Œå°å†™éƒ½åŒ¹é…)ã€‚</p>
<p>ä¸ºåŒºåˆ†å¤§å°å†™,å¯ä½¿ç”¨ BINARY å…³é”®å­—,å¦‚ <code>WHERE prod_name REGEXP BINARY &#39;JetPack .000&#39;</code> ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp 'jetpack';</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| JetPack 1000 |</span><br><span class="line">| JetPack 2000 |</span><br><span class="line">+--------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp binary 'jetpack';</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp binary 'JetPack';</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| JetPack 1000 |</span><br><span class="line">| JetPack 2000 |</span><br><span class="line">+--------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>2.è¿›è¡ŒORåŒ¹é…</p>
<p>ä¸ºæœç´¢ä¸¤ä¸ªä¸²ä¹‹ä¸€(æˆ–è€…ä¸ºè¿™ä¸ªä¸²,æˆ–è€…ä¸ºå¦ä¸€ä¸ªä¸²),ä½¿ç”¨ |</p>
<blockquote>
<blockquote>
<p>äº§å“åç§°ä¸­åŒ¹é…1000æˆ–è€…2000çš„</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp '1000|2000';</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| JetPack 1000 |</span><br><span class="line">| JetPack 2000 |</span><br><span class="line">+--------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>äº§å“åç§°ä¸­åŒ¹é… 1000 æˆ– 2000 æˆ– 3000</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp '1000|2000|3000';</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| JetPack 1000 |</span><br><span class="line">| JetPack 2000 |</span><br><span class="line">+--------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>ä¸¤ä¸ªä»¥ä¸Šçš„ OR æ¡ä»¶</strong> å¯ä»¥ç»™å‡ºä¸¤ä¸ªä»¥ä¸Šçš„ OR æ¡ä»¶ã€‚</p>
<p>3.åŒ¹é…å‡ ä¸ªå­—ç¬¦ä¹‹ä¸€</p>
<p>åŒ¹é…ä»»ä½•å•ä¸€å­—ç¬¦ã€‚ä½†æ˜¯,å¦‚æœä½ åªæƒ³åŒ¹é…ç‰¹å®šçš„å­—ç¬¦,æ€ä¹ˆåŠ?å¯é€šè¿‡æŒ‡å®šä¸€ç»„ç”¨ [ å’Œ ] æ‹¬èµ·æ¥çš„å­—ç¬¦æ¥å®Œæˆ</p>
<blockquote>
<blockquote>
<p>äº§å“åç§°ä¸­åŒ¹é… 1 æˆ– 2 æˆ– 3åé¢ç©ºæ ¼ton</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp '[123] ton';</span><br><span class="line">+-------------+</span><br><span class="line">| prod_name   |</span><br><span class="line">+-------------+</span><br><span class="line">| 1 ton anvil |</span><br><span class="line">| 2 ton anvil |</span><br><span class="line">+-------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp '[1|2|3] ton';</span><br><span class="line">+-------------+</span><br><span class="line">| prod_name   |</span><br><span class="line">+-------------+</span><br><span class="line">| 1 ton anvil |</span><br><span class="line">| 2 ton anvil |</span><br><span class="line">+-------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp '[1,2,3] ton';</span><br><span class="line">+-------------+</span><br><span class="line">| prod_name   |</span><br><span class="line">+-------------+</span><br><span class="line">| 1 ton anvil |</span><br><span class="line">| 2 ton anvil |</span><br><span class="line">+-------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>4.åŒ¹é…èŒƒå›´</p>
<p>é›†åˆå¯ç”¨æ¥å®šä¹‰è¦åŒ¹é…çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚ä¾‹å¦‚,ä¸‹é¢çš„é›†åˆå°†åŒ¹é…æ•°å­—0åˆ°9:[0123456789]</p>
<p>ä¸ºç®€åŒ–è¿™ç§ç±»å‹çš„é›†åˆ,å¯ä½¿ç”¨ - æ¥å®šä¹‰ä¸€ä¸ªèŒƒå›´ã€‚</p>
<p>ä¸‹é¢çš„å¼å­åŠŸèƒ½ä¸Šç­‰åŒäºä¸Šè¿°æ•°å­—åˆ—è¡¨:</p>
<p>èŒƒå›´ä¸é™äºå®Œæ•´çš„é›†åˆ, [1-3] å’Œ [6-9] ä¹Ÿæ˜¯åˆæ³•çš„èŒƒå›´ã€‚</p>
<p>æ­¤å¤–,èŒƒå›´ä¸ä¸€å®šåªæ˜¯æ•°å€¼çš„, [a-z] åŒ¹é…ä»»æ„å­—æ¯å­—ç¬¦ã€‚</p>
<blockquote>
<blockquote>
<p>åŒ¹é… 1 åˆ° 5 åé¢ç©ºæ ¼æ¥ton</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp '[1-5] ton';</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| .5 ton anvil |</span><br><span class="line">| 1 ton anvil  |</span><br><span class="line">| 2 ton anvil  |</span><br><span class="line">+--------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>5.åŒ¹é…ç‰¹æ®Šå­—ç¬¦</p>
<p>æ­£åˆ™è¡¨è¾¾å¼è¯­è¨€ç”±å…·æœ‰ç‰¹å®šå«ä¹‰çš„ç‰¹æ®Šå­—ç¬¦æ„æˆã€‚</p>
<p>æˆ‘ä»¬å·²ç»çœ‹åˆ° . ã€[] ã€| å’Œ - ç­‰,è¿˜æœ‰å…¶ä»–ä¸€äº›å­—ç¬¦ã€‚è¯·é—®,å¦‚æœä½ éœ€è¦åŒ¹é…è¿™äº›å­—ç¬¦,åº”è¯¥æ€ä¹ˆåŠå‘¢?</p>
<p>ä¾‹å¦‚,å¦‚æœè¦æ‰¾å‡ºåŒ…å« . å­—ç¬¦çš„å€¼,æ€æ ·æœç´¢?</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select vend_name from vendors where vend_name regexp '.';</span><br><span class="line">+----------------+</span><br><span class="line">| vend_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| Anvils R Us    |</span><br><span class="line">| LT Supplies    |</span><br><span class="line">| ACME           |</span><br><span class="line">| Furball Inc.   |</span><br><span class="line">| Jet Set        |</span><br><span class="line">| Jouets Et Ours |</span><br><span class="line">+----------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select vend_name from vendors where vend_name regexp '\.';</span><br><span class="line">+----------------+</span><br><span class="line">| vend_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| Anvils R Us    |</span><br><span class="line">| LT Supplies    |</span><br><span class="line">| ACME           |</span><br><span class="line">| Furball Inc.   |</span><br><span class="line">| Jet Set        |</span><br><span class="line">| Jouets Et Ours |</span><br><span class="line">+----------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select vend_name from vendors where vend_name regexp '\\.';</span><br><span class="line">+--------------+</span><br><span class="line">| vend_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| Furball Inc. |</span><br><span class="line">+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ‰æ˜¯æœŸæœ›çš„è¾“å‡ºã€‚ <code>\\.</code> åŒ¹é… <code>.</code> ,æ‰€ä»¥åªæ£€ç´¢å‡ºä¸€è¡Œã€‚è¿™ç§å¤„ç†å°±æ˜¯æ‰€è°“çš„ <strong>è½¬ä¹‰(escaping)</strong>,</p>
<p>æ­£åˆ™è¡¨è¾¾å¼å†…å…·æœ‰ç‰¹æ®Šæ„ä¹‰çš„æ‰€æœ‰å­—ç¬¦éƒ½å¿…é¡»ä»¥è¿™ç§æ–¹å¼è½¬ä¹‰ã€‚</p>
<p>è¿™åŒ…æ‹¬ . ã€ | ã€ [] ä»¥åŠè¿„ä»Šä¸ºæ­¢ä½¿ç”¨è¿‡çš„å…¶ä»–ç‰¹æ®Šå­—ç¬¦ã€‚</p>
<p>ä¸ºäº†åŒ¹é…ç‰¹æ®Šå­—ç¬¦,å¿…é¡»ç”¨ <code>\\</code> ä¸ºå‰å¯¼ã€‚ <code>\\-</code> è¡¨ç¤ºæŸ¥æ‰¾ <code>-</code> , <code>\\.</code> è¡¨ç¤ºæŸ¥æ‰¾ <code>.</code> ã€‚</p>
<p>åŒ¹é… <code>\</code> ä¸ºäº†åŒ¹é…åæ–œæ (<code>\</code>)å­—ç¬¦æœ¬èº«,éœ€è¦ä½¿ç”¨ <code>\\\</code> ã€‚</p>
<p><code>\\</code>ä¹Ÿç”¨æ¥å¼•ç”¨å…ƒå­—ç¬¦(å…·æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦),å¦‚ä¸‹è¡¨æ‰€åˆ—ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å…ƒ å­— ç¬¦</th>
<th align="left">è¯´ æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">\f</td>
<td align="left">æ¢é¡µ</td>
</tr>
<tr>
<td align="left">\n</td>
<td align="left">æ¢è¡Œ</td>
</tr>
<tr>
<td align="left">\r</td>
<td align="left">å›è½¦</td>
</tr>
<tr>
<td align="left">\t</td>
<td align="left">åˆ¶è¡¨</td>
</tr>
<tr>
<td align="left">\v</td>
<td align="left">çºµå‘åˆ¶è¡¨</td>
</tr>
</tbody></table>
<p><strong><code>\</code> æˆ– <code>\\</code>?</strong> å¤šæ•°æ­£åˆ™è¡¨è¾¾å¼å®ç°ä½¿ç”¨å•ä¸ªåæ–œæ è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦,ä»¥ä¾¿èƒ½ä½¿ç”¨è¿™äº›å­—ç¬¦æœ¬èº«ã€‚</p>
<p>ä½†MySQLè¦æ±‚ä¸¤ä¸ªåæ–œæ (MySQLè‡ªå·±è§£é‡Šä¸€ä¸ª,æ­£åˆ™è¡¨è¾¾å¼åº“è§£é‡Šå¦ä¸€ä¸ª)ã€‚</p>
<p>6.åŒ¹é…å­—ç¬¦ç±»</p>
<p>å­˜åœ¨æ‰¾å‡ºä½ è‡ªå·±ç»å¸¸ä½¿ç”¨çš„æ•°å­—ã€æ‰€æœ‰å­—æ¯å­—ç¬¦æˆ–æ‰€æœ‰æ•°å­—å­—æ¯å­—ç¬¦ç­‰çš„åŒ¹é…ã€‚</p>
<p>ä¸ºæ›´æ–¹ä¾¿å·¥ä½œ,å¯ä»¥ä½¿ç”¨é¢„å®šä¹‰çš„å­—ç¬¦é›†,ç§°ä¸º <strong>å­—ç¬¦ç±»(character class)</strong></p>
<p>ä¸‹è¡¨åˆ—å‡ºå­—ç¬¦ç±»ä»¥åŠå®ƒä»¬çš„å«ä¹‰ï¼š</p>
<table>
<thead>
<tr>
<th align="left">ç±»</th>
<th align="left">è¯´ æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[:alnum:]</td>
<td align="left">ä»»æ„å­—æ¯å’Œæ•°å­—(åŒ[a-zA-Z0-9])</td>
</tr>
<tr>
<td align="left">[:alpha:]</td>
<td align="left">ä»»æ„å­—ç¬¦(åŒ[a-zA-Z])</td>
</tr>
<tr>
<td align="left">[:blank:]</td>
<td align="left">ç©ºæ ¼å’Œåˆ¶è¡¨(åŒ[\t])</td>
</tr>
<tr>
<td align="left">[:cntrl:]</td>
<td align="left">ASCIIæ§åˆ¶å­—ç¬¦(ASCII 0åˆ°31å’Œ127)</td>
</tr>
<tr>
<td align="left">[:digit:]</td>
<td align="left">ä»»æ„æ•°å­—(åŒ[0-9])</td>
</tr>
<tr>
<td align="left">[:graph:]</td>
<td align="left">ä¸[:print:]ç›¸åŒ,ä½†ä¸åŒ…æ‹¬ç©ºæ ¼</td>
</tr>
<tr>
<td align="left">[:lower:]</td>
<td align="left">ä»»æ„å°å†™å­—æ¯(åŒ[a-z])</td>
</tr>
<tr>
<td align="left">[:print:]</td>
<td align="left">ä»»æ„å¯æ‰“å°å­—ç¬¦</td>
</tr>
<tr>
<td align="left">[:punct:]</td>
<td align="left">æ—¢ä¸åœ¨[:alnum:]åˆä¸åœ¨[:cntrl:]ä¸­çš„ä»»æ„å­—ç¬¦</td>
</tr>
<tr>
<td align="left">[:space:]</td>
<td align="left">åŒ…æ‹¬ç©ºæ ¼åœ¨å†…çš„ä»»æ„ç©ºç™½å­—ç¬¦(åŒ[\f\n\r\t\v])</td>
</tr>
<tr>
<td align="left">[:upper:]</td>
<td align="left">ä»»æ„å¤§å†™å­—æ¯(åŒ[A-Z])</td>
</tr>
<tr>
<td align="left">[:xdigit:]</td>
<td align="left">ä»»æ„åå…­è¿›åˆ¶æ•°å­—(åŒ[a-fA-F0-9]</td>
</tr>
</tbody></table>
<p>7.åŒ¹é…å¤šä¸ªå®ä¾‹</p>
<p>ç›®å‰ä¸ºæ­¢ä½¿ç”¨çš„æ‰€æœ‰æ­£åˆ™è¡¨è¾¾å¼éƒ½è¯•å›¾åŒ¹é…å•æ¬¡å‡ºç°ã€‚</p>
<p>å¦‚æœå­˜åœ¨ä¸€ä¸ªåŒ¹é…,è¯¥è¡Œè¢«æ£€ç´¢å‡ºæ¥,å¦‚æœä¸å­˜åœ¨,æ£€ç´¢ä¸å‡ºä»»ä½•è¡Œã€‚</p>
<p>ä½†æœ‰æ—¶éœ€è¦å¯¹åŒ¹é…çš„æ•°ç›®è¿›è¡Œæ›´å¼ºçš„æ§åˆ¶ã€‚</p>
<p>ä¾‹å¦‚,ä½ å¯èƒ½éœ€è¦å¯»æ‰¾æ‰€æœ‰çš„æ•°,ä¸ç®¡æ•°ä¸­åŒ…å«å¤šå°‘æ•°å­—,æˆ–è€…ä½ å¯èƒ½æƒ³å¯»æ‰¾ä¸€ä¸ªå•è¯å¹¶ä¸”è¿˜èƒ½å¤Ÿé€‚åº”ä¸€ä¸ªå°¾éšçš„ s (å¦‚æœå­˜åœ¨),ç­‰ç­‰ã€‚</p>
<p>è¿™å¯ä»¥ç”¨ä¸‹è¡¨åˆ—å‡ºçš„æ­£åˆ™è¡¨è¾¾å¼é‡å¤å…ƒå­—ç¬¦æ¥å®Œæˆã€‚</p>
<table>
<thead>
<tr>
<th align="left">é‡å¤å…ƒå­—ç¬¦</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">*</td>
<td align="left">0ä¸ªæˆ–å¤šä¸ªåŒ¹é…</td>
</tr>
<tr>
<td align="left">+</td>
<td align="left">1ä¸ªæˆ–å¤šä¸ªåŒ¹é…(ç­‰äº{1,})</td>
</tr>
<tr>
<td align="left">?</td>
<td align="left">0ä¸ªæˆ–1ä¸ªåŒ¹é…(ç­‰äº{0,1})</td>
</tr>
<tr>
<td align="left">{n}</td>
<td align="left">æŒ‡å®šæ•°ç›®çš„åŒ¹é…</td>
</tr>
<tr>
<td align="left">{n,}</td>
<td align="left">ä¸å°‘äºæŒ‡å®šæ•°ç›®çš„åŒ¹é…</td>
</tr>
<tr>
<td align="left">{n,m}</td>
<td align="left">åŒ¹é…æ•°ç›®çš„èŒƒå›´(mä¸è¶…è¿‡255)</td>
</tr>
</tbody></table>
<blockquote>
<blockquote>
<p>prod_nameåˆ—ä¸­åŒ¹é…åŒ…æ‹¬æ‹¬å·ï¼Œå¹¶ä¸”æ‹¬å·ä¸­çš„å†…å®¹ä¾æ¬¡ä¸º ä¸€ä½æ•°å­—ï¼Œä¸€ä¸ªç©ºæ ¼ï¼Œstickï¼Œsæœ‰æˆ–è€…æ²¡æœ‰</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp '\\([0-9] sticks?\\)';</span><br><span class="line">+----------------+</span><br><span class="line">| prod_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| TNT (1 stick)  |</span><br><span class="line">| TNT (5 sticks) |</span><br><span class="line">+----------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>prod_nameåˆ—ä¸­åŒ¹é…4ä¸ªæ•°å­—</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp '[[:digit:]]&#123;4&#125;';</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| JetPack 1000 |</span><br><span class="line">| JetPack 2000 |</span><br><span class="line">+--------------+</span><br><span class="line">2 rows in set (0.00 secï¼‰</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯,åœ¨ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ—¶,ç¼–å†™æŸä¸ªç‰¹æ®Šçš„è¡¨è¾¾å¼å‡ ä¹æ€»æ˜¯æœ‰ä¸æ­¢ä¸€ç§æ–¹æ³•ã€‚ä¸Šé¢çš„ä¾‹å­ä¹Ÿå¯ä»¥å¦‚ä¸‹ç¼–å†™:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp '[0-9][0-9][0-9][0-9]';</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| JetPack 1000 |</span><br><span class="line">| JetPack 2000 |</span><br><span class="line">+--------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>8.å®šä½ç¬¦</p>
<p>ç›®å‰ä¸ºæ­¢çš„æ‰€æœ‰ä¾‹å­éƒ½æ˜¯åŒ¹é…ä¸€ä¸ªä¸²ä¸­ä»»æ„ä½ç½®çš„æ–‡æœ¬ã€‚ä¸ºäº†åŒ¹é…ç‰¹å®šä½ç½®çš„æ–‡æœ¬,éœ€è¦ä½¿ç”¨ä¸‹è¡¨åˆ—å‡ºçš„å®šä½ç¬¦ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å®šä½å…ƒå­—ç¬¦</th>
<th align="left">è¯´ æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">^</td>
<td align="left">æ–‡æœ¬çš„å¼€å§‹</td>
</tr>
<tr>
<td align="left">$</td>
<td align="left">æ–‡æœ¬çš„ç»“å°¾</td>
</tr>
<tr>
<td align="left">[[:&lt;:]]</td>
<td align="left">è¯çš„å¼€å§‹</td>
</tr>
<tr>
<td align="left">[[:&gt;:]]</td>
<td align="left">è¯çš„ç»“å°¾</td>
</tr>
</tbody></table>
<blockquote>
<blockquote>
<p>æ‰¾å‡ºä»¥ä¸€ä¸ªæ•°(åŒ…æ‹¬ä»¥å°æ•°ç‚¹å¼€å§‹çš„æ•°)å¼€å§‹çš„æ‰€æœ‰äº§å“</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp '[0-9\\.]';+----------------+</span><br><span class="line">| prod_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| .5 ton anvil   |</span><br><span class="line">| 1 ton anvil    |</span><br><span class="line">| 2 ton anvil    |</span><br><span class="line">| JetPack 1000   |</span><br><span class="line">| JetPack 2000   |</span><br><span class="line">| TNT (1 stick)  |</span><br><span class="line">| TNT (5 sticks) |</span><br><span class="line">+----------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select prod_name from products where prod_name regexp '^[0-9\\.]';</span><br><span class="line">+--------------+</span><br><span class="line">| prod_name    |</span><br><span class="line">+--------------+</span><br><span class="line">| .5 ton anvil |</span><br><span class="line">| 1 ton anvil  |</span><br><span class="line">| 2 ton anvil  |</span><br><span class="line">+--------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ç®€å•æœç´¢ [0-9\.] (æˆ– [[:digit:]\.] )ä¸è¡Œ,å› ä¸ºå®ƒå°†åœ¨æ–‡æœ¬å†…ä»»æ„ä½ç½®æŸ¥æ‰¾åŒ¹é…ã€‚è§£å†³åŠæ³•æ˜¯ä½¿ç”¨ ^ å®šä½ç¬¦</p>
<p><strong><code>^</code> çš„åŒé‡ç”¨é€”</strong> <code>^</code> æœ‰ä¸¤ç§ç”¨æ³•ã€‚åœ¨é›†åˆä¸­(ç”¨ [ å’Œ ] å®šä¹‰),ç”¨å®ƒæ¥å¦å®šè¯¥é›†åˆ,å¦åˆ™,ç”¨æ¥æŒ‡ä¸²çš„å¼€å§‹å¤„ã€‚</p>
<p><strong>ä½¿ REGEXP èµ·ç±»ä¼¼ LIKE çš„ä½œç”¨</strong> æœ¬ç« å‰é¢è¯´è¿‡, LIKE å’Œ REGEXPçš„ä¸åŒåœ¨äº, LIKE åŒ¹é…æ•´ä¸ªä¸²è€Œ REGEXP åŒ¹é…å­ä¸²ã€‚</p>
<p>åˆ©ç”¨å®šä½ç¬¦,é€šè¿‡ç”¨ ^ å¼€å§‹æ¯ä¸ªè¡¨è¾¾å¼,ç”¨ $ ç»“æŸæ¯ä¸ªè¡¨è¾¾å¼,å¯ä»¥ä½¿REGEXP çš„ä½œç”¨ä¸ LIKE ä¸€æ ·ã€‚</p>
<p><strong>ç®€å•çš„æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•</strong> å¯ä»¥åœ¨ä¸ä½¿ç”¨æ•°æ®åº“è¡¨çš„æƒ…å†µä¸‹ç”¨SELECT æ¥æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<p>REGEXP æ£€æŸ¥æ€»æ˜¯è¿”å› 0 (æ²¡æœ‰åŒ¹é…)æˆ– 1 (åŒ¹é…)ã€‚å¯ä»¥ç”¨å¸¦æ–‡å­—ä¸²çš„ REGEXP æ¥æµ‹è¯•è¡¨è¾¾å¼,å¹¶è¯•éªŒå®ƒä»¬ã€‚ç›¸åº”çš„è¯­æ³•å¦‚ä¸‹:</p>
<blockquote>
<blockquote>
<p>æµ‹è¯•æ–‡æœ¬ hello ä¸­æ˜¯å¦èƒ½åŒ¹é…åˆ°æ•°å­—</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select 'hello' regexp '[0-9]';</span><br><span class="line">+------------------------+</span><br><span class="line">| 'hello' regexp '[0-9]' |</span><br><span class="line">+------------------------+</span><br><span class="line">|                      0 |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>æµ‹è¯•æ–‡æœ¬ä¸­æ˜¯å¦èƒ½åŒ¹é…åˆ°åˆ¶å®šæ•°é‡çš„o</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select 'booboo' regexp '[o]&#123;3,&#125;';</span><br><span class="line">+---------------------------+</span><br><span class="line">| 'booboo' regexp '[o]&#123;3,&#125;' |</span><br><span class="line">+---------------------------+</span><br><span class="line">|                         0 |</span><br><span class="line">+---------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select 'boobooo' regexp '[o]&#123;3,&#125;';</span><br><span class="line">+----------------------------+</span><br><span class="line">| 'boobooo' regexp '[o]&#123;3,&#125;' |</span><br><span class="line">+----------------------------+</span><br><span class="line">|                          1 |</span><br><span class="line">+----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« ä»‹ç»äº†æ­£åˆ™è¡¨è¾¾å¼çš„åŸºç¡€çŸ¥è¯†,å­¦ä¹ äº†å¦‚ä½•åœ¨MySQLçš„ SELECTè¯­å¥ä¸­é€šè¿‡ REGEXP å…³é”®å­—ä½¿ç”¨å®ƒä»¬ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="åˆ›å»ºè®¡ç®—å­—æ®µ"><a href="#åˆ›å»ºè®¡ç®—å­—æ®µ" class="headerlink" title="åˆ›å»ºè®¡ç®—å­—æ®µ"></a>åˆ›å»ºè®¡ç®—å­—æ®µ</h4><p>æœ¬ç« ä»‹ç»ä»€ä¹ˆæ˜¯è®¡ç®—å­—æ®µ,å¦‚ä½•åˆ›å»ºè®¡ç®—å­—æ®µä»¥åŠæ€æ ·ä»åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨åˆ«åå¼•ç”¨å®ƒä»¬ã€‚</p>
<blockquote>
<p>è®¡ç®—å­—æ®µ</p>
</blockquote>
<p>å­˜å‚¨åœ¨æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®ä¸€èˆ¬ä¸æ˜¯åº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„æ ¼å¼ã€‚ä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­ã€‚</p>
<ul>
<li>å¦‚æœæƒ³åœ¨ä¸€ä¸ªå­—æ®µä¸­æ—¢æ˜¾ç¤ºå…¬å¸å,åˆæ˜¾ç¤ºå…¬å¸çš„åœ°å€,ä½†è¿™ä¸¤ä¸ªä¿¡æ¯ä¸€èˆ¬åŒ…å«åœ¨ä¸åŒçš„è¡¨åˆ—ä¸­ã€‚</li>
<li>åŸå¸‚ã€å·å’Œé‚®æ”¿ç¼–ç å­˜å‚¨åœ¨ä¸åŒçš„åˆ—ä¸­(åº”è¯¥è¿™æ ·),ä½†é‚®ä»¶æ ‡ç­¾æ‰“å°ç¨‹åºå´éœ€è¦æŠŠå®ƒä»¬ä½œä¸ºä¸€ä¸ªæ°å½“æ ¼å¼çš„å­—æ®µæ£€ç´¢å‡ºæ¥ã€‚</li>
<li>åˆ—æ•°æ®æ˜¯å¤§å°å†™æ··åˆçš„,ä½†æŠ¥è¡¨ç¨‹åºéœ€è¦æŠŠæ‰€æœ‰æ•°æ®æŒ‰å¤§å†™è¡¨ç¤ºå‡ºæ¥ã€‚</li>
<li>ç‰©å“è®¢å•è¡¨å­˜å‚¨ç‰©å“çš„ä»·æ ¼å’Œæ•°é‡,ä½†ä¸éœ€è¦å­˜å‚¨æ¯ä¸ªç‰©å“çš„æ€»ä»·æ ¼(ç”¨ä»·æ ¼ä¹˜ä»¥æ•°é‡å³å¯)ã€‚ä¸ºæ‰“å°å‘ç¥¨,éœ€è¦ç‰©å“çš„æ€»ä»·æ ¼ã€‚</li>
<li>éœ€è¦æ ¹æ®è¡¨æ•°æ®è¿›è¡Œæ€»æ•°ã€å¹³å‡æ•°è®¡ç®—æˆ–å…¶ä»–è®¡ç®—ã€‚</li>
</ul>
<p>åœ¨ä¸Šè¿°æ¯ä¸ªä¾‹å­ä¸­,å­˜å‚¨åœ¨è¡¨ä¸­çš„æ•°æ®éƒ½ä¸æ˜¯åº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ç›´æ¥ä»æ•°æ®åº“ä¸­æ£€ç´¢å‡ºè½¬æ¢ã€è®¡ç®—æˆ–æ ¼å¼åŒ–è¿‡çš„æ•°æ®;è€Œä¸æ˜¯æ£€ç´¢å‡ºæ•°æ®,ç„¶åå†åœ¨å®¢æˆ·æœºåº”ç”¨ç¨‹åºæˆ–æŠ¥å‘Šç¨‹åºä¸­é‡æ–°æ ¼å¼åŒ–ã€‚</p>
<p>è¿™å°±æ˜¯è®¡ç®—å­—æ®µå‘æŒ¥ä½œç”¨çš„æ‰€åœ¨äº†ã€‚ä¸å‰é¢å„ç« ä»‹ç»è¿‡çš„åˆ—ä¸åŒ,è®¡ç®—å­—æ®µå¹¶ä¸å®é™…å­˜åœ¨äºæ•°æ®åº“è¡¨ä¸­ã€‚è®¡ç®—å­—æ®µæ˜¯è¿è¡Œæ—¶åœ¨ SELECT è¯­å¥å†…åˆ›å»ºçš„ã€‚</p>
<p><strong>å­—æ®µ(field)</strong> åŸºæœ¬ä¸Šä¸åˆ—(column)çš„æ„æ€ç›¸åŒ,ç»å¸¸äº’æ¢ä½¿ç”¨,ä¸è¿‡æ•°æ®åº“åˆ—ä¸€èˆ¬ç§°ä¸ºåˆ—,è€Œæœ¯è¯­å­—æ®µé€šå¸¸ç”¨åœ¨è®¡ç®—å­—æ®µçš„è¿æ¥ä¸Šã€‚é‡è¦çš„æ˜¯è¦æ³¨æ„åˆ°,åªæœ‰æ•°æ®åº“çŸ¥é“ SELECT è¯­å¥ä¸­å“ªäº›åˆ—æ˜¯å®é™…çš„è¡¨åˆ—,å“ªäº›åˆ—æ˜¯è®¡ç®—å­—æ®µã€‚ä»å®¢æˆ·æœº(å¦‚åº”ç”¨ç¨‹åº)çš„è§’åº¦æ¥çœ‹,è®¡ç®—å­—æ®µçš„æ•°æ®æ˜¯ä»¥ä¸å…¶ä»–åˆ—çš„æ•°æ®ç›¸åŒçš„æ–¹å¼è¿”å›çš„ã€‚</p>
<p><strong>å®¢æˆ·æœºä¸æœåŠ¡å™¨çš„æ ¼å¼</strong> å¯åœ¨SQLè¯­å¥å†…å®Œæˆçš„è®¸å¤šè½¬æ¢å’Œæ ¼å¼åŒ–å·¥ä½œéƒ½å¯ä»¥ç›´æ¥åœ¨å®¢æˆ·æœºåº”ç”¨ç¨‹åºå†…å®Œæˆã€‚ä½†ä¸€èˆ¬æ¥è¯´,åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸Šå®Œæˆè¿™äº›æ“ä½œæ¯”åœ¨å®¢æˆ·æœºä¸­å®Œæˆè¦å¿«å¾—å¤š,å› ä¸ºDBMSæ˜¯è®¾è®¡æ¥å¿«é€Ÿæœ‰æ•ˆåœ°å®Œæˆè¿™ç§å¤„ç†çš„ã€‚</p>
<blockquote>
<p>æ‹¼æ¥å­—æ®µ</p>
</blockquote>
<p>ä¸ºäº†è¯´æ˜å¦‚ä½•ä½¿ç”¨è®¡ç®—å­—æ®µ,ä¸¾ä¸€ä¸ªåˆ›å»ºç”±ä¸¤åˆ—ç»„æˆçš„æ ‡é¢˜çš„ç®€å•ä¾‹å­ã€‚</p>
<blockquote>
<blockquote>
<p><code>vendors</code> è¡¨åŒ…å«ä¾›åº”å•†åå’Œä½ç½®ä¿¡æ¯ã€‚å‡å¦‚è¦ç”Ÿæˆä¸€ä¸ªä¾›åº”å•†æŠ¥è¡¨,éœ€è¦åœ¨ä¾›åº”å•†çš„åå­—ä¸­æŒ‰ç…§ <code>name (location)</code> è¿™æ ·çš„æ ¼å¼åˆ—å‡ºä¾›åº”å•†çš„ä½ç½®ã€‚</p>
</blockquote>
</blockquote>
<p>æ­¤æŠ¥è¡¨éœ€è¦å•ä¸ªå€¼,è€Œè¡¨ä¸­æ•°æ®å­˜å‚¨åœ¨ä¸¤ä¸ªåˆ— <code>vend_name</code> å’Œ <code>vend_country</code> ä¸­ã€‚</p>
<p>æ­¤å¤–,éœ€è¦ç”¨æ‹¬å·å°† <code>vend_country</code> æ‹¬èµ·æ¥,è¿™äº›ä¸œè¥¿éƒ½æ²¡æœ‰æ˜ç¡®å­˜å‚¨åœ¨æ•°æ®åº“è¡¨ä¸­ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æ€æ ·ç¼–å†™è¿”å›ä¾›åº”å•†åå’Œä½ç½®çš„SELECT è¯­å¥ã€‚</p>
<p><strong>æ‹¼æ¥(concatenate)</strong> å°†å€¼è”ç»“åˆ°ä¸€èµ·æ„æˆå•ä¸ªå€¼ã€‚</p>
<p>è§£å†³åŠæ³•æ˜¯æŠŠä¸¤ä¸ªåˆ—æ‹¼æ¥èµ·æ¥ã€‚åœ¨MySQLçš„ SELECT è¯­å¥ä¸­,å¯ä½¿ç”¨<code>Concat()</code> å‡½æ•°æ¥æ‹¼æ¥ä¸¤ä¸ªåˆ—ã€‚</p>
<p><strong>MySQLçš„ä¸åŒä¹‹å¤„</strong> å¤šæ•°DBMSä½¿ç”¨ + æˆ– || æ¥å®ç°æ‹¼æ¥,MySQLåˆ™ä½¿ç”¨ <code>Concat()</code> å‡½æ•°æ¥å®ç°ã€‚å½“æŠŠSQLè¯­å¥è½¬æ¢æˆMySQLè¯­å¥æ—¶ä¸€å®šè¦æŠŠè¿™ä¸ªåŒºåˆ«é“­è®°åœ¨å¿ƒã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select concat(vend_name,vend_country) from vendors;</span><br><span class="line">+--------------------------------+</span><br><span class="line">| concat(vend_name,vend_country) |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| Anvils R UsUSA                 |</span><br><span class="line">| LT SuppliesUSA                 |</span><br><span class="line">| ACMEUSA                        |</span><br><span class="line">| Furball Inc.USA                |</span><br><span class="line">| Jet SetEngland                 |</span><br><span class="line">| Jouets Et OursFrance           |</span><br><span class="line">+--------------------------------+</span><br><span class="line">6 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select concat(vend_name,' (',vend_country,')') from vendors;</span><br><span class="line">+-----------------------------------------+</span><br><span class="line">| concat(vend_name,' (',vend_country,')') |</span><br><span class="line">+-----------------------------------------+</span><br><span class="line">| Anvils R Us (USA)                       |</span><br><span class="line">| LT Supplies (USA)                       |</span><br><span class="line">| ACME (USA)                              |</span><br><span class="line">| Furball Inc. (USA)                      |</span><br><span class="line">| Jet Set (England)                       |</span><br><span class="line">| Jouets Et Ours (France)                 |</span><br><span class="line">+-----------------------------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>Concat() æ‹¼æ¥ä¸²,å³æŠŠå¤šä¸ªä¸²è¿æ¥èµ·æ¥å½¢æˆä¸€ä¸ªè¾ƒé•¿çš„ä¸²ã€‚</p>
<p>Concat() éœ€è¦ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„ä¸²,å„ä¸ªä¸²ä¹‹é—´ç”¨é€—å·åˆ†éš”ã€‚</p>
<p>ä¸Šé¢çš„ SELECT è¯­å¥è¿æ¥ä»¥ä¸‹4ä¸ªå…ƒç´ :</p>
<ul>
<li>å­˜å‚¨åœ¨ vend_name åˆ—ä¸­çš„åå­—;</li>
<li>åŒ…å«ä¸€ä¸ªç©ºæ ¼å’Œä¸€ä¸ªå·¦åœ†æ‹¬å·çš„ä¸²;</li>
<li>å­˜å‚¨åœ¨ vend_country åˆ—ä¸­çš„å›½å®¶;</li>
<li>åŒ…å«ä¸€ä¸ªå³åœ†æ‹¬å·çš„ä¸²ã€‚</li>
</ul>
<p>ä»ä¸Šè¿°è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°, SELECT è¯­å¥è¿”å›åŒ…å«ä¸Šè¿°4ä¸ªå…ƒç´ çš„å•ä¸ªåˆ—(è®¡ç®—å­—æ®µ)ã€‚</p>
<blockquote>
<blockquote>
<p>åœ¨å‰é¢æ›¾æåˆ°é€šè¿‡åˆ é™¤æ•°æ®å³ä¾§å¤šä½™çš„ç©ºæ ¼æ¥æ•´ç†æ•°æ®,è¿™å¯ä»¥ä½¿ç”¨MySQLçš„ <code>RTrim()</code> å‡½æ•°æ¥å®Œæˆ,å¦‚ä¸‹æ‰€ç¤º:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select concat(rtrim(vend_name),' (',rtrim(vend_country),')') from vendors;</span><br><span class="line">+-------------------------------------------------------+</span><br><span class="line">| concat(rtrim(vend_name),' (',rtrim(vend_country),')') |</span><br><span class="line">+-------------------------------------------------------+</span><br><span class="line">| Anvils R Us (USA)                                     |</span><br><span class="line">| LT Supplies (USA)                                     |</span><br><span class="line">| ACME (USA)                                            |</span><br><span class="line">| Furball Inc. (USA)                                    |</span><br><span class="line">| Jet Set (England)                                     |</span><br><span class="line">| Jouets Et Ours (France)                               |</span><br><span class="line">+-------------------------------------------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>Trim å‡½æ•°</strong> MySQLé™¤äº†æ”¯æŒ <code>RTrim()</code> (æ­£å¦‚åˆšæ‰æ‰€è§,å®ƒå»æ‰ä¸²å³è¾¹çš„ç©ºæ ¼),è¿˜æ”¯æŒ <code>LTrim()</code> (å»æ‰ä¸²å·¦è¾¹çš„ç©ºæ ¼)ä»¥åŠ<code>Trim()</code> (å»æ‰ä¸²å·¦å³ä¸¤è¾¹çš„ç©ºæ ¼)ã€‚</p>
<p><strong>ä½¿ç”¨åˆ«å</strong> ä»å‰é¢çš„è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°, SELECT è¯­å¥æ‹¼æ¥åœ°å€å­—æ®µå·¥ä½œå¾—å¾ˆå¥½ã€‚ä½†æ­¤æ–°è®¡ç®—åˆ—çš„åå­—æ˜¯ä»€ä¹ˆå‘¢?å®é™…ä¸Šå®ƒæ²¡æœ‰åå­—,å®ƒåªæ˜¯ä¸€ä¸ªå€¼ã€‚å¦‚æœä»…åœ¨SQLæŸ¥è¯¢å·¥å…·ä¸­æŸ¥çœ‹ä¸€ä¸‹ç»“æœ,è¿™æ ·æ²¡æœ‰ä»€ä¹ˆä¸å¥½ã€‚ä½†æ˜¯,ä¸€ä¸ªæœªå‘½åçš„åˆ—ä¸èƒ½ç”¨äºå®¢æˆ·æœºåº”ç”¨ä¸­,å› ä¸ºå®¢æˆ·æœºæ²¡æœ‰åŠæ³•å¼•ç”¨å®ƒã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜,SQLæ”¯æŒåˆ—åˆ«åã€‚</p>
<p><strong>åˆ«å(alias)</strong> æ˜¯ä¸€ä¸ªå­—æ®µæˆ–å€¼çš„æ›¿æ¢åã€‚åˆ«åç”¨ AS å…³é”®å­—èµ‹äºˆã€‚</p>
<blockquote>
<blockquote>
<p>åˆ›å»ºä¸€ä¸ªåŒ…å«æŒ‡å®šè®¡ç®—çš„åä¸º vend_title çš„è®¡ç®—å­—æ®µ</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select concat(rtrim(vend_name),' (',rtrim(vend_country),')') as vend_title from vendors order by vend_name;</span><br><span class="line">+-------------------------+</span><br><span class="line">| vend_title              |</span><br><span class="line">+-------------------------+</span><br><span class="line">| ACME (USA)              |</span><br><span class="line">| Anvils R Us (USA)       |</span><br><span class="line">| Furball Inc. (USA)      |</span><br><span class="line">| Jet Set (England)       |</span><br><span class="line">| Jouets Et Ours (France) |</span><br><span class="line">| LT Supplies (USA)       |</span><br><span class="line">+-------------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>åˆ«åçš„å…¶ä»–ç”¨é€”</strong> åˆ«åè¿˜æœ‰å…¶ä»–ç”¨é€”ã€‚å¸¸è§çš„ç”¨é€”åŒ…æ‹¬åœ¨å®é™…çš„è¡¨åˆ—ååŒ…å«ä¸ç¬¦åˆè§„å®šçš„å­—ç¬¦(å¦‚ç©ºæ ¼)æ—¶é‡æ–°å‘½åå®ƒ,åœ¨åŸæ¥çš„åå­—å«æ··æˆ–å®¹æ˜“è¯¯è§£æ—¶æ‰©å……å®ƒ,ç­‰ç­‰ã€‚</p>
<p><strong>å¯¼å‡ºåˆ—</strong> åˆ«åæœ‰æ—¶ä¹Ÿç§°ä¸ºå¯¼å‡ºåˆ—(derived column),ä¸ç®¡ç§°ä¸ºä»€ä¹ˆ,å®ƒä»¬æ‰€ä»£è¡¨çš„éƒ½æ˜¯ç›¸åŒçš„ä¸œè¥¿ã€‚</p>
<blockquote>
<p>æ‰§è¡Œç®—æœ¯è®¡ç®—</p>
</blockquote>
<p>è®¡ç®—å­—æ®µçš„å¦ä¸€å¸¸è§ç”¨é€”æ˜¯å¯¹æ£€ç´¢å‡ºçš„æ•°æ®è¿›è¡Œç®—æœ¯è®¡ç®—ã€‚</p>
<blockquote>
<blockquote>
<p><code>orders</code> è¡¨åŒ…å«æ”¶åˆ°çš„æ‰€æœ‰è®¢å•, <code>orderitems</code> è¡¨åŒ…å«æ¯ä¸ªè®¢å•ä¸­çš„å„é¡¹ç‰©å“ã€‚<br>SQLè¯­å¥æ£€ç´¢è®¢å•å· 20005 ä¸­çš„æ‰€æœ‰ç‰©å“ï¼Œå¹¶æ±‡æ€»ç‰©å“çš„ä»·æ ¼(å•ä»·ä¹˜ä»¥è®¢è´­æ•°é‡)</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select *,quantity*item_price as expanded_price from orderitems where order_num = 20005;</span><br><span class="line">+-----------+------------+---------+----------+------------+----------------+</span><br><span class="line">| order_num | order_item | prod_id | quantity | item_price | expanded_price |</span><br><span class="line">+-----------+------------+---------+----------+------------+----------------+</span><br><span class="line">|     20005 |          1 | ANV01   |       10 |       5.99 |          59.90 |</span><br><span class="line">|     20005 |          2 | ANV02   |        3 |       9.99 |          29.97 |</span><br><span class="line">|     20005 |          3 | TNT2    |        5 |      10.00 |          50.00 |</span><br><span class="line">|     20005 |          4 | FB      |        1 |      10.00 |          10.00 |</span><br><span class="line">+-----------+------------+---------+----------+------------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select *,quantity*item_price  expanded_price from orderitems where order_num = 20005;</span><br><span class="line">+-----------+------------+---------+----------+------------+----------------+</span><br><span class="line">| order_num | order_item | prod_id | quantity | item_price | expanded_price |</span><br><span class="line">+-----------+------------+---------+----------+------------+----------------+</span><br><span class="line">|     20005 |          1 | ANV01   |       10 |       5.99 |          59.90 |</span><br><span class="line">|     20005 |          2 | ANV02   |        3 |       9.99 |          29.97 |</span><br><span class="line">|     20005 |          3 | TNT2    |        5 |      10.00 |          50.00 |</span><br><span class="line">|     20005 |          4 | FB      |        1 |      10.00 |          10.00 |</span><br><span class="line">+-----------+------------+---------+----------+------------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>MySQLæ”¯æŒä¸‹è¡¨ä¸­åˆ—å‡ºçš„åŸºæœ¬ç®—æœ¯æ“ä½œç¬¦ã€‚æ­¤å¤–,åœ†æ‹¬å·å¯ç”¨æ¥åŒºåˆ†ä¼˜å…ˆé¡ºåºã€‚</p>
<table>
<thead>
<tr>
<th align="left">MySQLç®—æœ¯æ“ä½œç¬¦</th>
<th align="left">è¯´ æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">+</td>
<td align="left">åŠ </td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">å‡</td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">ä¹˜</td>
</tr>
<tr>
<td align="left">/</td>
<td align="left">é™¤</td>
</tr>
</tbody></table>
<p><strong>å¦‚ä½•æµ‹è¯•è®¡ç®—</strong> SELECT æä¾›äº†æµ‹è¯•å’Œè¯•éªŒå‡½æ•°ä¸è®¡ç®—çš„ä¸€ä¸ªå¾ˆå¥½çš„åŠæ³•ã€‚è™½ç„¶ SELECT é€šå¸¸ç”¨æ¥ä»è¡¨ä¸­æ£€ç´¢æ•°æ®,ä½†å¯ä»¥çœç•¥ FROM å­å¥ä»¥ä¾¿ç®€å•åœ°è®¿é—®å’Œå¤„ç†è¡¨è¾¾å¼ã€‚é€šè¿‡ä¸‹é¢ä¸€äº›ä¾‹å­,å¯ä»¥æ˜ç™½å¦‚ä½•æ ¹æ®éœ€è¦ä½¿ç”¨ SELECT è¿›è¡Œè¯•éªŒã€‚</p>
<blockquote>
<blockquote>
<p>SELECT3*2; å°†è¿”å› 6</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select 3*2;</span><br><span class="line">+-----+</span><br><span class="line">| 3*2 |</span><br><span class="line">+-----+</span><br><span class="line">|   6 |</span><br><span class="line">+-----+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>SELECT Trim(â€˜ abc â€˜); å°†è¿”å› abc</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select trim(' abc ');</span><br><span class="line">+---------------+</span><br><span class="line">| trim(' abc ') |</span><br><span class="line">+---------------+</span><br><span class="line">| abc           |</span><br><span class="line">+---------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>SELECT Now() åˆ©ç”¨ Now() å‡½æ•°è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select now();</span><br><span class="line">+---------------------+</span><br><span class="line">| now()               |</span><br><span class="line">+---------------------+</span><br><span class="line">| 2016-09-17 21:25:08 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« ä»‹ç»äº†è®¡ç®—å­—æ®µä»¥åŠå¦‚ä½•åˆ›å»ºè®¡ç®—å­—æ®µã€‚æˆ‘ä»¬ç”¨ä¾‹å­è¯´æ˜äº†è®¡ç®—å­—æ®µåœ¨ä¸²æ‹¼æ¥å’Œç®—æœ¯è®¡ç®—çš„ç”¨é€”ã€‚æ­¤å¤–,è¿˜å­¦ä¹ äº†å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨åˆ«å,ä»¥ä¾¿åº”ç”¨ç¨‹åºèƒ½å¼•ç”¨è®¡ç®—å­—æ®µã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="ä½¿ç”¨æ•°æ®å¤„ç†å‡½æ•°"><a href="#ä½¿ç”¨æ•°æ®å¤„ç†å‡½æ•°" class="headerlink" title="ä½¿ç”¨æ•°æ®å¤„ç†å‡½æ•°"></a>ä½¿ç”¨æ•°æ®å¤„ç†å‡½æ•°</h4><p>æœ¬ç« ä»‹ç»ä»€ä¹ˆæ˜¯å‡½æ•°, MySQLæ”¯æŒä½•ç§å‡½æ•°,ä»¥åŠå¦‚ä½•ä½¿ç”¨è¿™äº›å‡½æ•°ã€‚</p>
<blockquote>
<p>å‡½æ•°</p>
</blockquote>
<p>ä¸å…¶ä»–å¤§å¤šæ•°è®¡ç®—æœºè¯­è¨€ä¸€æ ·, SQLæ”¯æŒåˆ©ç”¨å‡½æ•°æ¥å¤„ç†æ•°æ®ã€‚å‡½æ•°ä¸€èˆ¬æ˜¯åœ¨æ•°æ®ä¸Šæ‰§è¡Œçš„,å®ƒç»™æ•°æ®çš„è½¬æ¢å’Œå¤„ç†æä¾›äº†æ–¹ä¾¿ã€‚</p>
<p>åœ¨å‰ä¸€ç« ä¸­ç”¨æ¥å»æ‰ä¸²å°¾ç©ºæ ¼çš„ RTrim() å°±æ˜¯ä¸€ä¸ªå‡½æ•°çš„ä¾‹å­ã€‚</p>
<p><strong>å‡½æ•°æ²¡æœ‰SQLçš„å¯ç§»æ¤æ€§å¼º</strong> èƒ½è¿è¡Œåœ¨å¤šä¸ªç³»ç»Ÿä¸Šçš„ä»£ç ç§°ä¸ºå¯ç§»æ¤çš„(portable)ã€‚ç›¸å¯¹æ¥è¯´,å¤šæ•°SQLè¯­å¥æ˜¯å¯ç§»æ¤çš„,åœ¨SQLå®ç°ä¹‹é—´æœ‰å·®å¼‚æ—¶,è¿™äº›å·®å¼‚é€šå¸¸ä¸é‚£ä¹ˆéš¾å¤„ç†ã€‚è€Œå‡½æ•°çš„å¯ç§»æ¤æ€§å´ä¸å¼ºã€‚å‡ ä¹æ¯ç§ä¸»è¦çš„DBMSçš„å®ç°éƒ½æ”¯æŒå…¶ä»–å®ç°ä¸æ”¯æŒçš„å‡½æ•°,è€Œä¸”æœ‰æ—¶å·®å¼‚è¿˜å¾ˆå¤§ã€‚<br>ä¸ºäº†ä»£ç çš„å¯ç§»æ¤,è®¸å¤šSQLç¨‹åºå‘˜ä¸èµæˆä½¿ç”¨ç‰¹æ®Šå®ç°çš„åŠŸèƒ½ã€‚è™½ç„¶è¿™æ ·åšå¾ˆæœ‰å¥½å¤„,ä½†ä¸æ€»æ˜¯åˆ©äºåº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚å¦‚æœä¸ä½¿ç”¨è¿™äº›å‡½æ•°,ç¼–å†™æŸäº›åº”ç”¨ç¨‹åºä»£ç ä¼šå¾ˆè‰°éš¾ã€‚å¿…é¡»åˆ©ç”¨å…¶ä»–æ–¹æ³•æ¥å®ç°DBMSéå¸¸æœ‰æ•ˆåœ°å®Œæˆçš„å·¥ä½œã€‚å¦‚æœä½ å†³å®šä½¿ç”¨å‡½æ•°,åº”è¯¥ä¿è¯åšå¥½ä»£ç æ³¨é‡Š,ä»¥ä¾¿ä»¥åä½ (æˆ–å…¶ä»–äºº)èƒ½ç¡®åˆ‡åœ°çŸ¥é“æ‰€ç¼–å†™SQLä»£ç çš„å«ä¹‰ã€‚</p>
<blockquote>
<p>ä½¿ç”¨å‡½æ•°</p>
</blockquote>
<p>å¤§å¤šæ•°SQLå®ç°æ”¯æŒä»¥ä¸‹ç±»å‹çš„å‡½æ•°ã€‚</p>
<ul>
<li>ç”¨äºå¤„ç†æ–‡æœ¬ä¸²(å¦‚åˆ é™¤æˆ–å¡«å……å€¼,è½¬æ¢å€¼ä¸ºå¤§å†™æˆ–å°å†™)çš„æ–‡æœ¬å‡½æ•°ã€‚</li>
<li>ç”¨äºåœ¨æ•°å€¼æ•°æ®ä¸Šè¿›è¡Œç®—æœ¯æ“ä½œ(å¦‚è¿”å›ç»å¯¹å€¼,è¿›è¡Œä»£æ•°è¿ç®—)çš„æ•°å€¼å‡½æ•°ã€‚</li>
<li>ç”¨äºå¤„ç†æ—¥æœŸå’Œæ—¶é—´å€¼å¹¶ä»è¿™äº›å€¼ä¸­æå–ç‰¹å®šæˆåˆ†(ä¾‹å¦‚,è¿”å›ä¸¤ä¸ªæ—¥æœŸä¹‹å·®,æ£€æŸ¥æ—¥æœŸæœ‰æ•ˆæ€§ç­‰)çš„æ—¥æœŸå’Œæ—¶é—´å‡½æ•°ã€‚</li>
<li>è¿”å›DBMSæ­£ä½¿ç”¨çš„ç‰¹æ®Šä¿¡æ¯(å¦‚è¿”å›ç”¨æˆ·ç™»å½•ä¿¡æ¯,æ£€æŸ¥ç‰ˆæœ¬ç»†èŠ‚)çš„ç³»ç»Ÿå‡½æ•°ã€‚</li>
</ul>
<p>1.æ–‡æœ¬å¤„ç†å‡½æ•°</p>
<p>ä¸Šä¸€ç« ä¸­æˆ‘ä»¬å·²ç»çœ‹è¿‡ä¸€ä¸ªæ–‡æœ¬å¤„ç†å‡½æ•°çš„ä¾‹å­,å…¶ä¸­ä½¿ç”¨ <code>RTrim()</code>å‡½æ•°æ¥å»é™¤åˆ—å€¼å³è¾¹çš„ç©ºæ ¼ã€‚ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­,è¿™æ¬¡ä½¿ç”¨ <code>Upper()</code> å‡½æ•°Upper() ï¼šå°†æ–‡æœ¬è½¬æ¢ä¸ºå¤§å†™ã€‚</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢ä¾›åº”å•†è¡¨vendorsä¸­çš„ä¾›åº”å•†åvend_nameï¼Œå¹¶éƒ½è½¬æ¢ä¸ºå¤§å†™ï¼Œæ’åºã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select vend_name,upper(vend_name) as vend_name_upcase from vendors order by vend_name;</span><br><span class="line">+----------------+------------------+</span><br><span class="line">| vend_name      | vend_name_upcase |</span><br><span class="line">+----------------+------------------+</span><br><span class="line">| ACME           | ACME             |</span><br><span class="line">| Anvils R Us    | ANVILS R US      |</span><br><span class="line">| Furball Inc.   | FURBALL INC.     |</span><br><span class="line">| Jet Set        | JET SET          |</span><br><span class="line">| Jouets Et Ours | JOUETS ET OURS   |</span><br><span class="line">| LT Supplies    | LT SUPPLIES      |</span><br><span class="line">+----------------+------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ä¸‹è¡¨åˆ—å‡ºäº†æŸäº›å¸¸ç”¨çš„æ–‡æœ¬å¤„ç†å‡½æ•°ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å¸¸ç”¨çš„æ–‡æœ¬å¤„ç†å‡½æ•°</th>
<th align="left">è¯´ æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Left()</td>
<td align="left">è¿”å›ä¸²å·¦è¾¹çš„å­—ç¬¦</td>
</tr>
<tr>
<td align="left">Right()</td>
<td align="left">è¿”å›ä¸²å³è¾¹çš„å­—ç¬¦</td>
</tr>
<tr>
<td align="left">Lower()</td>
<td align="left">å°†ä¸²è½¬æ¢ä¸ºå°å†™</td>
</tr>
<tr>
<td align="left">Upper()</td>
<td align="left">å°†ä¸²è½¬æ¢ä¸ºå¤§å†™</td>
</tr>
<tr>
<td align="left">LTrim()</td>
<td align="left">å»æ‰ä¸²å·¦è¾¹çš„ç©ºæ ¼</td>
</tr>
<tr>
<td align="left">RTrim()</td>
<td align="left">å»æ‰ä¸²å³è¾¹çš„ç©ºæ ¼</td>
</tr>
<tr>
<td align="left">Length()</td>
<td align="left">è¿”å›ä¸²çš„é•¿åº¦</td>
</tr>
<tr>
<td align="left">Soundex()</td>
<td align="left">è¿”å›ä¸²çš„SOUNDEXå€¼</td>
</tr>
<tr>
<td align="left">Locate()</td>
<td align="left">æ‰¾å‡ºä¸²çš„ä¸€ä¸ªå­ä¸²</td>
</tr>
<tr>
<td align="left">SubString()</td>
<td align="left">è¿”å›å­ä¸²çš„å­—ç¬¦</td>
</tr>
</tbody></table>
<p>ä¸Šè¡¨ä¸­çš„ SOUNDEX éœ€è¦åšè¿›ä¸€æ­¥çš„è§£é‡Šã€‚ SOUNDEX æ˜¯ä¸€ä¸ªå°†ä»»ä½•æ–‡æœ¬ä¸²è½¬æ¢ä¸ºæè¿°å…¶è¯­éŸ³è¡¨ç¤ºçš„å­—æ¯æ•°å­—æ¨¡å¼çš„ç®—æ³•ã€‚ SOUNDEX è€ƒè™‘äº†ç±»ä¼¼çš„å‘éŸ³å­—ç¬¦å’ŒéŸ³èŠ‚,ä½¿å¾—èƒ½å¯¹ä¸²è¿›è¡Œå‘éŸ³æ¯”è¾ƒè€Œä¸æ˜¯å­—æ¯æ¯”è¾ƒã€‚è™½ç„¶SOUNDEX ä¸æ˜¯SQLæ¦‚å¿µ,ä½†MySQL(å°±åƒå¤šæ•°DBMSä¸€æ ·)éƒ½æä¾›å¯¹SOUNDEX çš„æ”¯æŒã€‚</p>
<p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªä½¿ç”¨ Soundex() å‡½æ•°çš„ä¾‹å­ã€‚</p>
<blockquote>
<blockquote>
<p><code>customers</code> è¡¨ä¸­æœ‰ä¸€ä¸ªé¡¾å®¢ <code>Coyote Inc.</code> ,å…¶è”ç³»åä¸º<code>Y Lee</code>ã€‚ä½†å¦‚æœè¿™æ˜¯è¾“å…¥é”™è¯¯,æ­¤è”ç³»åå®é™…åº”è¯¥æ˜¯ <code>Y Lie</code> ,æ€ä¹ˆåŠ?æ˜¾ç„¶,æŒ‰æ­£ç¡®çš„è”ç³»åæœç´¢ä¸ä¼šè¿”å›æ•°æ®ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select cust_name,cust_contact from customers where cust_contact = 'Y Lie';</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select cust_name,cust_contact from customers where soundex(cust_contact) = soundex('Y Lie');</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| cust_name   | cust_contact |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| Coyote Inc. | Y Lee        |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>2.æ—¥æœŸå’Œæ—¶é—´å¤„ç†å‡½æ•°</p>
<p>æ—¥æœŸå’Œæ—¶é—´é‡‡ç”¨ç›¸åº”çš„æ•°æ®ç±»å‹å’Œç‰¹æ®Šçš„æ ¼å¼å­˜å‚¨,ä»¥ä¾¿èƒ½å¿«é€Ÿå’Œæœ‰æ•ˆåœ°æ’åºæˆ–è¿‡æ»¤,å¹¶ä¸”èŠ‚çœç‰©ç†å­˜å‚¨ç©ºé—´ã€‚</p>
<p>ä¸€èˆ¬,åº”ç”¨ç¨‹åºä¸ä½¿ç”¨ç”¨æ¥å­˜å‚¨æ—¥æœŸå’Œæ—¶é—´çš„æ ¼å¼,å› æ­¤æ—¥æœŸå’Œæ—¶é—´å‡½æ•°æ€»æ˜¯è¢«ç”¨æ¥è¯»å–ã€ç»Ÿè®¡å’Œå¤„ç†è¿™äº›å€¼ã€‚ç”±äºè¿™ä¸ªåŸå› ,æ—¥æœŸå’Œæ—¶é—´å‡½æ•°åœ¨MySQLè¯­è¨€ä¸­å…·æœ‰é‡è¦çš„ä½œç”¨ã€‚</p>
<p>ä¸‹è¡¨åˆ—å‡ºäº†æŸäº›å¸¸ç”¨çš„æ—¥æœŸå’Œæ—¶é—´å¤„ç†å‡½æ•°ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å¸¸ç”¨æ—¥æœŸå’Œæ—¶é—´å¤„ç†å‡½æ•°</th>
<th align="left">è¯´ æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">AddDate()</td>
<td align="left">å¢åŠ ä¸€ä¸ªæ—¥æœŸ(å¤©ã€å‘¨ç­‰)</td>
</tr>
<tr>
<td align="left">AddTime()</td>
<td align="left">å¢åŠ ä¸€ä¸ªæ—¶é—´(æ—¶ã€åˆ†ç­‰)</td>
</tr>
<tr>
<td align="left">CurDate()</td>
<td align="left">è¿”å›å½“å‰æ—¥æœŸ</td>
</tr>
<tr>
<td align="left">CurTime()</td>
<td align="left">è¿”å›å½“å‰æ—¶é—´</td>
</tr>
<tr>
<td align="left">Date()</td>
<td align="left">è¿”å›æ—¥æœŸæ—¶é—´çš„æ—¥æœŸéƒ¨åˆ†</td>
</tr>
<tr>
<td align="left">DateDiff()</td>
<td align="left">è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹å·®</td>
</tr>
<tr>
<td align="left">Date_Add()</td>
<td align="left">é«˜åº¦çµæ´»çš„æ—¥æœŸè¿ç®—å‡½æ•°</td>
</tr>
<tr>
<td align="left">Date_Format()</td>
<td align="left">è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¥æœŸæˆ–æ—¶é—´ä¸²</td>
</tr>
<tr>
<td align="left">Day()</td>
<td align="left">è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¤©æ•°éƒ¨åˆ†</td>
</tr>
<tr>
<td align="left">DayOfWeek()</td>
<td align="left">å¯¹äºä¸€ä¸ªæ—¥æœŸ,è¿”å›å¯¹åº”çš„æ˜ŸæœŸå‡ </td>
</tr>
<tr>
<td align="left">Hour()</td>
<td align="left">è¿”å›ä¸€ä¸ªæ—¶é—´çš„å°æ—¶éƒ¨åˆ†</td>
</tr>
<tr>
<td align="left">Minute()</td>
<td align="left">è¿”å›ä¸€ä¸ªæ—¶é—´çš„åˆ†é’Ÿéƒ¨åˆ†</td>
</tr>
<tr>
<td align="left">Month()</td>
<td align="left">è¿”å›ä¸€ä¸ªæ—¥æœŸçš„æœˆä»½éƒ¨åˆ†</td>
</tr>
<tr>
<td align="left">Now()</td>
<td align="left">è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´</td>
</tr>
<tr>
<td align="left">Second()</td>
<td align="left">è¿”å›ä¸€ä¸ªæ—¶é—´çš„ç§’éƒ¨åˆ†</td>
</tr>
<tr>
<td align="left">Time()</td>
<td align="left">è¿”å›ä¸€ä¸ªæ—¥æœŸæ—¶é—´çš„æ—¶é—´éƒ¨åˆ†</td>
</tr>
<tr>
<td align="left">Year()</td>
<td align="left">è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¹´ä»½éƒ¨åˆ†</td>
</tr>
</tbody></table>
<p>è¿™æ˜¯é‡æ–°å¤ä¹ ç”¨ WHERE è¿›è¡Œæ•°æ®è¿‡æ»¤çš„ä¸€ä¸ªå¥½æ—¶æœºã€‚è¿„ä»Šä¸ºæ­¢,æˆ‘ä»¬éƒ½æ˜¯ç”¨æ¯”è¾ƒæ•°å€¼å’Œæ–‡æœ¬çš„ WHERE å­å¥è¿‡æ»¤æ•°æ®,ä½†æ•°æ®ç»å¸¸éœ€è¦ç”¨æ—¥æœŸè¿›è¡Œè¿‡æ»¤ã€‚ç”¨æ—¥æœŸè¿›è¡Œè¿‡æ»¤éœ€è¦æ³¨æ„ä¸€äº›åˆ«çš„é—®é¢˜å’Œä½¿ç”¨ç‰¹æ®Šçš„MySQLå‡½æ•°ã€‚</p>
<p>é¦–å…ˆéœ€è¦æ³¨æ„çš„æ˜¯MySQLä½¿ç”¨çš„æ—¥æœŸæ ¼å¼ã€‚æ— è®ºä½ ä»€ä¹ˆæ—¶å€™æŒ‡å®šä¸€ä¸ªæ—¥æœŸ,ä¸ç®¡æ˜¯æ’å…¥æˆ–æ›´æ–°è¡¨å€¼è¿˜æ˜¯ç”¨ WHERE å­å¥è¿›è¡Œè¿‡æ»¤,æ—¥æœŸå¿…é¡»ä¸ºæ ¼å¼yyyy-mm-ddã€‚å› æ­¤,2005å¹´9æœˆ1æ—¥,ç»™å‡ºä¸º2005-09-01ã€‚è™½ç„¶å…¶ä»–çš„æ—¥æœŸæ ¼å¼å¯èƒ½ä¹Ÿè¡Œ,ä½†è¿™æ˜¯é¦–é€‰çš„æ—¥æœŸæ ¼å¼,å› ä¸ºå®ƒæ’é™¤äº†å¤šä¹‰æ€§(å¦‚,04/05/06æ˜¯2006å¹´5æœˆ4æ—¥æˆ–2006å¹´4æœˆ5æ—¥æˆ–2004å¹´5æœˆ6æ—¥æˆ–â€¦â€¦)ã€‚</p>
<p><strong>åº”è¯¥æ€»æ˜¯ä½¿ç”¨4ä½æ•°å­—çš„å¹´ä»½</strong> æ”¯æŒ2ä½æ•°å­—çš„å¹´ä»½,MySQLå¤„ç†00-69ä¸º2000-2069,å¤„ç†70-99ä¸º1970-1999ã€‚è™½ç„¶å®ƒä»¬å¯èƒ½æ˜¯æ‰“ç®—è¦çš„å¹´ä»½,ä½†ä½¿ç”¨å®Œæ•´çš„4ä½æ•°å­—å¹´ä»½æ›´å¯é ,å› ä¸ºMySQLä¸å¿…åšå‡ºä»»ä½•å‡å®šã€‚</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢å‡ºä¸€ä¸ªè®¢å•è®°å½•,è¯¥è®¢å•è®°å½•çš„ <code>order_date</code> ä¸º <code>2005-09-01</code></p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from orders where order_date='2005-09-01';</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">| order_num | order_date          | cust_id |</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">|     20005 | 2005-09-01 00:00:00 |   10001 |</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯,ä½¿ç”¨ <code>WHERE order_date = &#39;2005-09-01&#39;</code> å¯é å—? <code>order_date</code>çš„æ•°æ®ç±»å‹ä¸º <code>datetime</code> ã€‚è¿™ç§ç±»å‹å­˜å‚¨æ—¥æœŸåŠæ—¶é—´å€¼ã€‚æ ·ä¾‹è¡¨ä¸­çš„å€¼å…¨éƒ½å…·æœ‰æ—¶é—´å€¼ 00:00:00 ,ä½†å®é™…ä¸­å¾ˆå¯èƒ½å¹¶ä¸æ€»æ˜¯è¿™æ ·ã€‚å¦‚æœç”¨å½“å‰æ—¥æœŸå’Œæ—¶é—´å­˜å‚¨è®¢å•æ—¥æœŸ(å› æ­¤ä½ ä¸ä»…çŸ¥é“è®¢å•æ—¥æœŸ,è¿˜çŸ¥é“ä¸‹è®¢å•å½“å¤©çš„æ—¶é—´),æ€ä¹ˆåŠ?</p>
<p>æ¯”å¦‚,å­˜å‚¨çš„ <code>order_date</code> å€¼ä¸º<code>2005-09-01 11:30:05</code> ,åˆ™ <code>WHERE order_date = &#39;2005-09-01&#39;</code> å¤±è´¥ã€‚å³ä½¿ç»™å‡ºå…·æœ‰è¯¥æ—¥æœŸçš„ä¸€è¡Œ,ä¹Ÿä¸ä¼šæŠŠå®ƒæ£€ç´¢å‡ºæ¥,å› ä¸º WHERE åŒ¹é…å¤±è´¥ã€‚</p>
<p>è§£å†³åŠæ³•æ˜¯æŒ‡ç¤ºMySQLä»…å°†ç»™å‡ºçš„æ—¥æœŸä¸åˆ—ä¸­çš„æ—¥æœŸéƒ¨åˆ†è¿›è¡Œæ¯”è¾ƒ,è€Œä¸æ˜¯å°†ç»™å‡ºçš„æ—¥æœŸä¸æ•´ä¸ªåˆ—å€¼è¿›è¡Œæ¯”è¾ƒã€‚ä¸ºæ­¤,å¿…é¡»ä½¿ç”¨ <code>Date()</code>å‡½æ•°ã€‚ <code>Date(order_date)</code>æŒ‡ç¤ºMySQLä»…æå–åˆ—çš„æ—¥æœŸéƒ¨åˆ†,æ›´å¯é çš„SELECT è¯­å¥ä¸º:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from orders where date(order_date)='2005-09-01';</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">| order_num | order_date          | cust_id |</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">|     20005 | 2005-09-01 00:00:00 |   10001 |</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœè¦çš„æ˜¯æ—¥æœŸ,è¯·ä½¿ç”¨ Date()</strong> å¦‚æœä½ æƒ³è¦çš„ä»…æ˜¯æ—¥æœŸ,åˆ™ä½¿ç”¨ Date() æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ä¹ æƒ¯,å³ä½¿ä½ çŸ¥é“ç›¸åº”çš„åˆ—åªåŒ…å«æ—¥æœŸä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¿™æ ·,å¦‚æœç”±äºæŸç§åŸå› è¡¨ä¸­ä»¥åæœ‰æ—¥æœŸå’Œæ—¶é—´å€¼,ä½ çš„SQLä»£ç ä¹Ÿä¸ç”¨æ”¹å˜ã€‚å½“ç„¶,ä¹Ÿå­˜åœ¨ä¸€ä¸ª Time()å‡½æ•°,åœ¨ä½ åªæƒ³è¦æ—¶é—´æ—¶åº”è¯¥ä½¿ç”¨å®ƒã€‚Date() å’Œ Time() éƒ½æ˜¯åœ¨MySQL 4.1.1ä¸­ç¬¬ä¸€æ¬¡å¼•å…¥çš„ã€‚</p>
<p>åœ¨ä½ çŸ¥é“äº†å¦‚ä½•ç”¨æ—¥æœŸè¿›è¡Œç›¸ç­‰æµ‹è¯•å,å…¶ä»–æ“ä½œç¬¦çš„ä½¿ç”¨ä¹Ÿå°±å¾ˆæ¸…æ¥šäº†ã€‚ä¸è¿‡,è¿˜æœ‰ä¸€ç§æ—¥æœŸæ¯”è¾ƒéœ€è¦è¯´æ˜ã€‚</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢å‡º2005å¹´9æœˆä¸‹çš„æ‰€æœ‰è®¢å•</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from orders where date(order_date) between '2005-09-01' and '2005-09-30';</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">| order_num | order_date          | cust_id |</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">|     20005 | 2005-09-01 00:00:00 |   10001 |</span><br><span class="line">|     20006 | 2005-09-12 00:00:00 |   10003 |</span><br><span class="line">|     20007 | 2005-09-30 00:00:00 |   10004 |</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰å¦å¤–ä¸€ç§åŠæ³•(ä¸€ç§ä¸éœ€è¦è®°ä½æ¯ä¸ªæœˆä¸­æœ‰å¤šå°‘å¤©æˆ–ä¸éœ€è¦æ“å¿ƒé—°å¹´2æœˆçš„åŠæ³•)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from orders where year(order_date) = 2005 and month(order_date)= 9 ;</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">| order_num | order_date          | cust_id |</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">|     20005 | 2005-09-01 00:00:00 |   10001 |</span><br><span class="line">|     20006 | 2005-09-12 00:00:00 |   10003 |</span><br><span class="line">|     20007 | 2005-09-30 00:00:00 |   10004 |</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">3 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p><strong>MySQLçš„ç‰ˆæœ¬å·®å¼‚</strong> MySQL 4.1.1ä¸­å¢åŠ äº†è®¸å¤šæ—¥æœŸå’Œæ—¶é—´å‡½æ•°ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ›´æ—©çš„MySQLç‰ˆæœ¬,åº”è¯¥æŸ¥é˜…å…·ä½“çš„æ–‡æ¡£ä»¥ç¡®å®šå¯ä»¥ä½¿ç”¨å“ªäº›å‡½æ•°ã€‚</p>
<p>3.æ•°å€¼å¤„ç†å‡½æ•°</p>
<p>æ•°å€¼å¤„ç†å‡½æ•°ä»…å¤„ç†æ•°å€¼æ•°æ®ã€‚è¿™äº›å‡½æ•°ä¸€èˆ¬ä¸»è¦ç”¨äºä»£æ•°ã€ä¸‰è§’æˆ–å‡ ä½•è¿ç®—,å› æ­¤æ²¡æœ‰ä¸²æˆ–æ—¥æœŸâ€”æ—¶é—´å¤„ç†å‡½æ•°çš„ä½¿ç”¨é‚£ä¹ˆé¢‘ç¹ã€‚</p>
<p>å…·æœ‰è®½åˆºæ„å‘³çš„æ˜¯,åœ¨ä¸»è¦DBMSçš„å‡½æ•°ä¸­,æ•°å€¼å‡½æ•°æ˜¯æœ€ä¸€è‡´æœ€ç»Ÿä¸€çš„å‡½æ•°ã€‚ä¸‹è¡¨åˆ—å‡ºä¸€äº›å¸¸ç”¨çš„æ•°å€¼å¤„ç†å‡½æ•°ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å¸¸ç”¨æ•°å€¼å¤„ç†å‡½æ•°</th>
<th align="left">è¯´ æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Abs()</td>
<td align="left">è¿”å›ä¸€ä¸ªæ•°çš„ç»å¯¹å€¼</td>
</tr>
<tr>
<td align="left">Cos()</td>
<td align="left">è¿”å›ä¸€ä¸ªè§’åº¦çš„ä½™å¼¦</td>
</tr>
<tr>
<td align="left">Exp()</td>
<td align="left">è¿”å›ä¸€ä¸ªæ•°çš„æŒ‡æ•°å€¼</td>
</tr>
<tr>
<td align="left">Mod()</td>
<td align="left">è¿”å›é™¤æ“ä½œçš„ä½™æ•°</td>
</tr>
<tr>
<td align="left">Pi()</td>
<td align="left">è¿”å›åœ†å‘¨ç‡</td>
</tr>
<tr>
<td align="left">Rand()</td>
<td align="left">è¿”å›ä¸€ä¸ªéšæœºæ•°</td>
</tr>
<tr>
<td align="left">Sin()</td>
<td align="left">è¿”å›ä¸€ä¸ªè§’åº¦çš„æ­£å¼¦</td>
</tr>
<tr>
<td align="left">Sqrt()</td>
<td align="left">è¿”å›ä¸€ä¸ªæ•°çš„å¹³æ–¹æ ¹</td>
</tr>
<tr>
<td align="left">Tan()</td>
<td align="left">è¿”å›ä¸€ä¸ªè§’åº¦çš„æ­£åˆ‡</td>
</tr>
</tbody></table>
<blockquote>
<blockquote>
<p>æµ‹è¯•å‡½æ•°åŠŸèƒ½</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select pi();</span><br><span class="line">+----------+</span><br><span class="line">| pi()     |</span><br><span class="line">+----------+</span><br><span class="line">| 3.141593 |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select rand();</span><br><span class="line">+--------------------+</span><br><span class="line">| rand()             |</span><br><span class="line">+--------------------+</span><br><span class="line">| 0.7680412305221346 |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨SQLçš„æ•°æ®å¤„ç†å‡½æ•°,å¹¶ç€é‡ä»‹ç»äº†æ—¥æœŸå¤„ç†å‡½æ•°ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="æ±‡æ€»æ•°æ®"><a href="#æ±‡æ€»æ•°æ®" class="headerlink" title="æ±‡æ€»æ•°æ®"></a>æ±‡æ€»æ•°æ®</h4><p>æœ¬ç« ä»‹ç»ä»€ä¹ˆæ˜¯SQLçš„èšé›†å‡½æ•°ä»¥åŠå¦‚ä½•åˆ©ç”¨å®ƒä»¬æ±‡æ€»è¡¨çš„æ•°æ®ã€‚</p>
<blockquote>
<p>èšé›†å‡½æ•°</p>
</blockquote>
<p>æˆ‘ä»¬ç»å¸¸éœ€è¦æ±‡æ€»æ•°æ®è€Œä¸ç”¨æŠŠå®ƒä»¬å®é™…æ£€ç´¢å‡ºæ¥,ä¸ºæ­¤MySQLæä¾›äº†ä¸“é—¨çš„å‡½æ•°ã€‚ä½¿ç”¨è¿™äº›å‡½æ•°,MySQLæŸ¥è¯¢å¯ç”¨äºæ£€ç´¢æ•°æ®,ä»¥ä¾¿åˆ†æå’ŒæŠ¥è¡¨ç”Ÿæˆã€‚è¿™ç§ç±»å‹çš„æ£€ç´¢ä¾‹å­æœ‰ä»¥ä¸‹å‡ ç§ã€‚</p>
<ul>
<li>ç¡®å®šè¡¨ä¸­è¡Œæ•°(æˆ–è€…æ»¡è¶³æŸä¸ªæ¡ä»¶æˆ–åŒ…å«æŸä¸ªç‰¹å®šå€¼çš„è¡Œæ•°)ã€‚</li>
<li>è·å¾—è¡¨ä¸­è¡Œç»„çš„å’Œã€‚</li>
<li>æ‰¾å‡ºè¡¨åˆ—(æˆ–æ‰€æœ‰è¡Œæˆ–æŸäº›ç‰¹å®šçš„è¡Œ)çš„æœ€å¤§å€¼ã€æœ€å°å€¼å’Œå¹³å‡å€¼ã€‚</li>
</ul>
<p>ä¸Šè¿°ä¾‹å­éƒ½éœ€è¦å¯¹è¡¨ä¸­æ•°æ®(è€Œä¸æ˜¯å®é™…æ•°æ®æœ¬èº«)æ±‡æ€»ã€‚å› æ­¤,è¿”å›å®é™…è¡¨æ•°æ®æ˜¯å¯¹æ—¶é—´å’Œå¤„ç†èµ„æºçš„ä¸€ç§æµªè´¹(æ›´ä¸ç”¨è¯´å¸¦å®½äº†)ã€‚é‡å¤ä¸€é,å®é™…æƒ³è¦çš„æ˜¯æ±‡æ€»ä¿¡æ¯ã€‚</p>
<p>ä¸ºæ–¹ä¾¿è¿™ç§ç±»å‹çš„æ£€ç´¢,MySQLç»™å‡ºäº†5ä¸ªèšé›†å‡½æ•°ï¼Œè§ä¸‹è¡¨ï¼Œè¿™äº›å‡½æ•°èƒ½è¿›è¡Œä¸Šè¿°ç½—åˆ—çš„æ£€ç´¢ã€‚</p>
<p><strong>èšé›†å‡½æ•°(aggregate function)</strong> è¿è¡Œåœ¨è¡Œç»„ä¸Š,è®¡ç®—å’Œè¿”å›å•ä¸ªå€¼çš„å‡½æ•°ã€‚</p>
<table>
<thead>
<tr>
<th align="left">SQLèšé›†å‡½æ•°</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">AVG()</td>
<td align="left">è¿”å›æŸåˆ—çš„å¹³å‡å€¼</td>
</tr>
<tr>
<td align="left">COUNT()</td>
<td align="left">è¿”å›æŸåˆ—çš„è¡Œæ•°</td>
</tr>
<tr>
<td align="left">MAX()</td>
<td align="left">è¿”å›æŸåˆ—çš„æœ€å¤§å€¼</td>
</tr>
<tr>
<td align="left">MIN()</td>
<td align="left">è¿”å›æŸåˆ—çš„æœ€å°å€¼</td>
</tr>
<tr>
<td align="left">SUM()</td>
<td align="left">è¿”å›æŸåˆ—å€¼ä¹‹å’Œ</td>
</tr>
</tbody></table>
<p><strong>æ ‡å‡†åå·®</strong> MySQLè¿˜æ”¯æŒä¸€ç³»åˆ—çš„æ ‡å‡†åå·®èšé›†å‡½æ•°,ä½†è¯¥æ•™æ¡ˆå¹¶æœªæ¶‰åŠè¿™äº›å†…å®¹ã€‚</p>
<p>1.AVG() å‡½æ•°</p>
<p>AVG() é€šè¿‡å¯¹è¡¨ä¸­è¡Œæ•°è®¡æ•°å¹¶è®¡ç®—ç‰¹å®šåˆ—å€¼ä¹‹å’Œ,æ±‚å¾—è¯¥åˆ—çš„å¹³å‡å€¼ã€‚ AVG() å¯ç”¨æ¥è¿”å›æ‰€æœ‰åˆ—çš„å¹³å‡å€¼,ä¹Ÿå¯ä»¥ç”¨æ¥è¿”å›ç‰¹å®šåˆ—æˆ–è¡Œçš„å¹³å‡å€¼ã€‚</p>
<blockquote>
<blockquote>
<p>ä½¿ç”¨ <code>AVG()</code> è¿”å› <code>products</code> è¡¨ä¸­æ‰€æœ‰äº§å“çš„å¹³å‡ä»·æ ¼ <code>avg_Price</code></p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select avg(prod_price) as avg_price from products;</span><br><span class="line">+-----------+</span><br><span class="line">| avg_price |</span><br><span class="line">+-----------+</span><br><span class="line">| 16.133571 |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>ä½¿ç”¨ <code>AVG()</code> è¿”å› <code>products</code> è¡¨ä¸­äº§å“ä¾›åº”å•†1003æä¾›çš„å•†å“çš„å¹³å‡ä»·æ ¼ <code>avg_Price</code></p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select avg(prod_price) as avg_price from products where vend_id=1003;</span><br><span class="line">+-----------+</span><br><span class="line">| avg_price |</span><br><span class="line">+-----------+</span><br><span class="line">| 13.212857 |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>åªç”¨äºå•ä¸ªåˆ—</strong> AVG() åªèƒ½ç”¨æ¥ç¡®å®šç‰¹å®šæ•°å€¼åˆ—çš„å¹³å‡å€¼,è€Œä¸”åˆ—åå¿…é¡»ä½œä¸ºå‡½æ•°å‚æ•°ç»™å‡ºã€‚ä¸ºäº†è·å¾—å¤šä¸ªåˆ—çš„å¹³å‡å€¼,å¿…é¡»ä½¿ç”¨å¤šä¸ª AVG() å‡½æ•°ã€‚</p>
<p><strong>NULL å€¼</strong> AVG() å‡½æ•°å¿½ç•¥åˆ—å€¼ä¸º NULL çš„è¡Œ</p>
<p>2.COUNT() å‡½æ•°</p>
<p>COUNT() å‡½æ•°è¿›è¡Œè®¡æ•°ã€‚å¯åˆ©ç”¨ COUNT() ç¡®å®šè¡¨ä¸­è¡Œçš„æ•°ç›®æˆ–ç¬¦åˆç‰¹å®šæ¡ä»¶çš„è¡Œçš„æ•°ç›®ã€‚</p>
<p>COUNT() å‡½æ•°æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ã€‚</p>
<ul>
<li>ä½¿ç”¨ COUNT(*) å¯¹è¡¨ä¸­è¡Œçš„æ•°ç›®è¿›è¡Œè®¡æ•°,ä¸ç®¡è¡¨åˆ—ä¸­åŒ…å«çš„æ˜¯ç©ºå€¼( NULL )è¿˜æ˜¯éç©ºå€¼ã€‚</li>
<li>ä½¿ç”¨ COUNT(column) å¯¹ç‰¹å®šåˆ—ä¸­å…·æœ‰å€¼çš„è¡Œè¿›è¡Œè®¡æ•°,å¿½ç•¥NULL å€¼ã€‚</li>
</ul>
<blockquote>
<blockquote>
<p>è¿”å› customers è¡¨ä¸­å®¢æˆ·çš„æ€»æ•°</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select count(prod_name) from products;</span><br><span class="line">+------------------+</span><br><span class="line">| count(prod_name) |</span><br><span class="line">+------------------+</span><br><span class="line">|               14 |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select count(*) from products;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|       14 |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>å¯¹å…·æœ‰ç”µå­é‚®ä»¶åœ°å€çš„å®¢æˆ·è®¡æ•°,åˆ«ånum_cust</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select cust_email from customers;</span><br><span class="line">+---------------------+</span><br><span class="line">| cust_email          |</span><br><span class="line">+---------------------+</span><br><span class="line">| ylee@coyote.com     |</span><br><span class="line">| NULL                |</span><br><span class="line">| rabbit@wascally.com |</span><br><span class="line">| sam@yosemite.com    |</span><br><span class="line">| NULL                |</span><br><span class="line">+---------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select count(cust_email) from customers;</span><br><span class="line">+-------------------+</span><br><span class="line">| count(cust_email) |</span><br><span class="line">+-------------------+</span><br><span class="line">|                 3 |</span><br><span class="line">+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select count(*) from customers;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|        5 |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select count(cust_email) as num_cust from customers;</span><br><span class="line">+----------+</span><br><span class="line">| num_cust |</span><br><span class="line">+----------+</span><br><span class="line">|        3 |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>NULL å€¼</strong> å¦‚æœæŒ‡å®šåˆ—å,åˆ™æŒ‡å®šåˆ—çš„å€¼ä¸ºç©ºçš„è¡Œè¢« COUNT()å‡½æ•°å¿½ç•¥,ä½†å¦‚æœ COUNT() å‡½æ•°ä¸­ç”¨çš„æ˜¯æ˜Ÿå·( * ),åˆ™ä¸å¿½ç•¥ã€‚</p>
<p>3.MAX() å‡½æ•°</p>
<p>MAX() è¿”å›æŒ‡å®šåˆ—ä¸­çš„æœ€å¤§å€¼ã€‚ MAX() è¦æ±‚æŒ‡å®šåˆ—åã€‚</p>
<blockquote>
<blockquote>
<p>MAX() è¿”å› products è¡¨ä¸­æœ€è´µçš„ç‰©å“çš„ä»·æ ¼</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,max(prod_price) as max_price from products;</span><br><span class="line">+--------------+-----------+</span><br><span class="line">| prod_name    | max_price |</span><br><span class="line">+--------------+-----------+</span><br><span class="line">| .5 ton anvil |     55.00 |</span><br><span class="line">+--------------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>å¯¹éæ•°å€¼æ•°æ®ä½¿ç”¨ MAX()</strong> è™½ç„¶ MAX() ä¸€èˆ¬ç”¨æ¥æ‰¾å‡ºæœ€å¤§çš„æ•°å€¼æˆ–æ—¥æœŸå€¼,ä½†MySQLå…è®¸å°†å®ƒç”¨æ¥è¿”å›ä»»æ„åˆ—ä¸­çš„æœ€å¤§å€¼,åŒ…æ‹¬è¿”å›æ–‡æœ¬åˆ—ä¸­çš„æœ€å¤§å€¼ã€‚åœ¨ç”¨äºæ–‡æœ¬æ•°æ®æ—¶,å¦‚æœæ•°æ®æŒ‰ç›¸åº”çš„åˆ—æ’åº,åˆ™ MAX() è¿”å›æœ€åä¸€è¡Œã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,max(prod_name) as max_name from products;</span><br><span class="line">+--------------+----------------+</span><br><span class="line">| prod_name    | max_name       |</span><br><span class="line">+--------------+----------------+</span><br><span class="line">| .5 ton anvil | TNT (5 sticks) |</span><br><span class="line">+--------------+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>NULL å€¼</strong> MAX() å‡½æ•°å¿½ç•¥åˆ—å€¼ä¸º NULL çš„è¡Œã€‚</p>
<p>4.MIN() å‡½æ•°</p>
<p>MIN() çš„åŠŸèƒ½æ­£å¥½ä¸ MAX() åŠŸèƒ½ç›¸å,å®ƒè¿”å›æŒ‡å®šåˆ—çš„æœ€å°å€¼ã€‚ä¸MAX() ä¸€æ ·, MIN() è¦æ±‚æŒ‡å®šåˆ—åã€‚</p>
<blockquote>
<blockquote>
<p>MIN() è¿”å› products è¡¨ä¸­æœ€ä¾¿å®œç‰©å“çš„ä»·æ ¼</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,min(prod_price) as min_price from products;</span><br><span class="line">+--------------+-----------+</span><br><span class="line">| prod_name    | min_price |</span><br><span class="line">+--------------+-----------+</span><br><span class="line">| .5 ton anvil |      2.50 |</span><br><span class="line">+--------------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>å¯¹éæ•°å€¼æ•°æ®ä½¿ç”¨ MIN()</strong> MIN() å‡½æ•°ä¸ MAX() å‡½æ•°ç±»ä¼¼,MySQLå…è®¸å°†å®ƒç”¨æ¥è¿”å›ä»»æ„åˆ—ä¸­çš„æœ€å°å€¼,åŒ…æ‹¬è¿”å›æ–‡æœ¬åˆ—ä¸­çš„æœ€å°å€¼ã€‚åœ¨ç”¨äºæ–‡æœ¬æ•°æ®æ—¶,å¦‚æœæ•°æ®æŒ‰ç›¸åº”çš„åˆ—æ’åº,åˆ™ MIN() è¿”å›æœ€å‰é¢çš„è¡Œã€‚</p>
<p><strong>NULL å€¼</strong> MIN() å‡½æ•°å¿½ç•¥åˆ—å€¼ä¸º NULL çš„è¡Œã€‚</p>
<p>5.SUM() å‡½æ•°</p>
<p>SUM() ç”¨æ¥è¿”å›æŒ‡å®šåˆ—å€¼çš„å’Œ(æ€»è®¡)ã€‚</p>
<blockquote>
<blockquote>
<p><code>orderitems</code>è¡¨ åŒ…å«è®¢å•ä¸­å®é™…çš„ç‰©å“,æ¯ä¸ªç‰©å“æœ‰ç›¸åº”çš„æ•°é‡( <code>quantity</code> )ã€‚<br>æ£€ç´¢æ‰€è®¢è´­ç‰©å“çš„æ€»æ•°(æ‰€æœ‰<code>quantity</code> å€¼ä¹‹å’Œ)</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; desc orderitems;</span><br><span class="line">+------------+--------------+------+-----+---------+-------+</span><br><span class="line">| Field      | Type         | Null | Key | Default | Extra |</span><br><span class="line">+------------+--------------+------+-----+---------+-------+</span><br><span class="line">| order_num  | int(11)      | NO   | PRI | NULL    |       |</span><br><span class="line">| order_item | int(11)      | NO   | PRI | NULL    |       |</span><br><span class="line">| prod_id    | char(10)     | NO   | MUL | NULL    |       |</span><br><span class="line">| quantity   | int(11)      | NO   |     | NULL    |       |</span><br><span class="line">| item_price | decimal(8,2) | NO   |     | NULL    |       |</span><br><span class="line">+------------+--------------+------+-----+---------+-------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select sum(quantity) from orderitems;</span><br><span class="line">+---------------+</span><br><span class="line">| sum(quantity) |</span><br><span class="line">+---------------+</span><br><span class="line">|           174 |</span><br><span class="line">+---------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select sum(quantity) as items_ordered  from orderitems where order_num = 20005;</span><br><span class="line">+---------------+</span><br><span class="line">| items_ordered |</span><br><span class="line">+---------------+</span><br><span class="line">|            19 |</span><br><span class="line">+---------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p><code>SUM()</code> ä¹Ÿå¯ä»¥ç”¨æ¥åˆè®¡è®¡ç®—å€¼ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­,åˆè®¡æ¯é¡¹ç‰©å“çš„<code>item_price*quantity</code> ,å¾—å‡ºæ€»çš„è®¢å•é‡‘é¢<code>total_price</code></p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select item_price*quantity from orderitems;</span><br><span class="line">+---------------------+</span><br><span class="line">| item_price*quantity |</span><br><span class="line">+---------------------+</span><br><span class="line">|               59.90 |</span><br><span class="line">|               29.97 |</span><br><span class="line">|               50.00 |</span><br><span class="line">|               10.00 |</span><br><span class="line">|               55.00 |</span><br><span class="line">|             1000.00 |</span><br><span class="line">|              125.00 |</span><br><span class="line">|               10.00 |</span><br><span class="line">|                8.99 |</span><br><span class="line">|                4.49 |</span><br><span class="line">|               14.99 |</span><br><span class="line">+---------------------+</span><br><span class="line">11 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select sum(item_price*quantity) as total_price from orderitems;</span><br><span class="line">+-------------+</span><br><span class="line">| total_price |</span><br><span class="line">+-------------+</span><br><span class="line">|     1368.34 |</span><br><span class="line">+-------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p><strong>åœ¨å¤šä¸ªåˆ—ä¸Šè¿›è¡Œè®¡ç®—</strong> å¦‚æœ¬ä¾‹æ‰€ç¤º,åˆ©ç”¨æ ‡å‡†çš„ç®—æœ¯æ“ä½œç¬¦,æ‰€æœ‰èšé›†å‡½æ•°éƒ½å¯ç”¨æ¥æ‰§è¡Œå¤šä¸ªåˆ—ä¸Šçš„è®¡ç®—ã€‚</p>
<p><strong>NULL å€¼</strong> SUM() å‡½æ•°å¿½ç•¥åˆ—å€¼ä¸º NULL çš„è¡Œã€‚</p>
<blockquote>
<p>èšé›†ä¸åŒå€¼</p>
</blockquote>
<p><strong>MySQL 5 åŠ å æœŸ ç‰ˆ æœ¬</strong> ä¸‹é¢å°†è¦ä»‹ç»çš„èšé›†å‡½æ•°çš„DISTINCT çš„ä½¿ç”¨,å·²ç»è¢«æ·»åŠ åˆ°MySQL 5.0.3ä¸­ã€‚ä¸‹é¢æ‰€è¿°å†…å®¹åœ¨MySQL 4.xä¸­ä¸èƒ½æ­£å¸¸è¿è¡Œã€‚</p>
<p>ä»¥ä¸Š5ä¸ªèšé›†å‡½æ•°éƒ½å¯ä»¥å¦‚ä¸‹ä½¿ç”¨:</p>
<ul>
<li>å¯¹æ‰€æœ‰çš„è¡Œæ‰§è¡Œè®¡ç®—,æŒ‡å®š ALL å‚æ•°æˆ–ä¸ç»™å‚æ•°(å› ä¸º ALL æ˜¯é»˜è®¤è¡Œä¸º);</li>
<li>åªåŒ…å«ä¸åŒçš„å€¼,æŒ‡å®š DISTINCT å‚æ•°ã€‚</li>
</ul>
<p><strong>ALL ä¸ºé»˜è®¤</strong> ALL å‚æ•°ä¸éœ€è¦æŒ‡å®š,å› ä¸ºå®ƒæ˜¯é»˜è®¤è¡Œä¸ºã€‚å¦‚æœä¸æŒ‡å®š DISTINCT ,åˆ™å‡å®šä¸º ALL ã€‚</p>
<blockquote>
<blockquote>
<p>ä½¿ç”¨ AVG() å‡½æ•°è¿”å›ç‰¹å®šä¾›åº”å•†æä¾›çš„äº§å“çš„å¹³å‡ä»·æ ¼ã€‚å®ƒä¸ä¸Šé¢çš„ SELECT è¯­å¥ç›¸åŒ,ä½†ä½¿ç”¨äº† DISTINCT å‚æ•°,å› æ­¤å¹³å‡å€¼åªè€ƒè™‘å„ä¸ªä¸åŒçš„ä»·æ ¼:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_price from products order by prod_price;</span><br><span class="line">+------------+</span><br><span class="line">| prod_price |</span><br><span class="line">+------------+</span><br><span class="line">|       2.50 |</span><br><span class="line">|       2.50 |</span><br><span class="line">|       3.42 |</span><br><span class="line">|       4.49 |</span><br><span class="line">|       5.99 |</span><br><span class="line">|       8.99 |</span><br><span class="line">|       9.99 |</span><br><span class="line">|      10.00 |</span><br><span class="line">|      10.00 |</span><br><span class="line">|      13.00 |</span><br><span class="line">|      14.99 |</span><br><span class="line">|      35.00 |</span><br><span class="line">|      50.00 |</span><br><span class="line">|      55.00 |</span><br><span class="line">+------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select distinct prod_price from products order by prod_price;</span><br><span class="line">+------------+</span><br><span class="line">| prod_price |</span><br><span class="line">+------------+</span><br><span class="line">|       2.50 |</span><br><span class="line">|       3.42 |</span><br><span class="line">|       4.49 |</span><br><span class="line">|       5.99 |</span><br><span class="line">|       8.99 |</span><br><span class="line">|       9.99 |</span><br><span class="line">|      10.00 |</span><br><span class="line">|      13.00 |</span><br><span class="line">|      14.99 |</span><br><span class="line">|      35.00 |</span><br><span class="line">|      50.00 |</span><br><span class="line">|      55.00 |</span><br><span class="line">+------------+</span><br><span class="line">12 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select avg(distinct prod_price) from products where vend_id = 1003;</span><br><span class="line">+--------------------------+</span><br><span class="line">| avg(distinct prod_price) |</span><br><span class="line">+--------------------------+</span><br><span class="line">|                15.998000 |</span><br><span class="line">+--------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select avg(prod_price) from products where vend_id = 1003;</span><br><span class="line">+-----------------+</span><br><span class="line">| avg(prod_price) |</span><br><span class="line">+-----------------+</span><br><span class="line">|       13.212857 |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°,åœ¨ä½¿ç”¨äº† <code>DISTINCT</code> å,æ­¤ä¾‹å­ä¸­çš„ <code>avg_price</code> æ¯”è¾ƒé«˜,å› ä¸ºæœ‰å¤šä¸ªç‰©å“å…·æœ‰ç›¸åŒçš„è¾ƒä½ä»·æ ¼ã€‚æ’é™¤å®ƒä»¬æå‡äº†å¹³å‡ä»·æ ¼ã€‚</p>
<p><strong>æ³¨æ„</strong> å¦‚æœæŒ‡å®šåˆ—å,åˆ™ DISTINCT åªèƒ½ç”¨äº COUNT() ã€‚ DISTINCTä¸èƒ½ç”¨äº COUNT(*),å› æ­¤ä¸å…è®¸ä½¿ç”¨COUNT(DISTINCT),å¦åˆ™ä¼šäº§ç”Ÿé”™è¯¯ ã€‚ç±»ä¼¼åœ°, DISTINCT å¿…é¡»ä½¿ç”¨åˆ—å,ä¸èƒ½ç”¨äºè®¡ç®—æˆ–è¡¨è¾¾å¼ã€‚</p>
<p><strong>å°† DISTINCT ç”¨äº MIN() å’Œ MAX()</strong> è™½ç„¶ DISTINCT ä»æŠ€æœ¯ä¸Šå¯<br>ç”¨äº MIN() å’Œ MAX() ,ä½†è¿™æ ·åšå®é™…ä¸Šæ²¡æœ‰ä»·å€¼ã€‚ä¸€ä¸ªåˆ—ä¸­çš„<br>æœ€å°å€¼å’Œæœ€å¤§å€¼ä¸ç®¡æ˜¯å¦åŒ…å«ä¸åŒå€¼éƒ½æ˜¯ç›¸åŒçš„ã€‚</p>
<blockquote>
<p>ç»„åˆèšé›†å‡½æ•°</p>
</blockquote>
<p>ç›®å‰ä¸ºæ­¢çš„æ‰€æœ‰èšé›†å‡½æ•°ä¾‹å­éƒ½åªæ¶‰åŠå•ä¸ªå‡½æ•°ã€‚ä½†å®é™…ä¸Š SELECTè¯­å¥å¯æ ¹æ®éœ€è¦åŒ…å«å¤šä¸ªèšé›†å‡½æ•°ã€‚</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢products è¡¨ä¸­ç‰©å“çš„æ•°ç›®<code>num_items</code>,äº§å“ä»·æ ¼çš„æœ€é«˜<code>price_max</code>ã€æœ€ä½<code>price_min</code>ä»¥åŠå¹³å‡å€¼<code>price_avg</code></p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select count(*) as num_items,min(prod_price)as price_min,max(prod_price) as price_max,avg(prod_price) as price_avg from products;</span><br><span class="line">+-----------+-----------+-----------+-----------+</span><br><span class="line">| num_items | price_min | price_max | price_avg |</span><br><span class="line">+-----------+-----------+-----------+-----------+</span><br><span class="line">|        14 |      2.50 |     55.00 | 16.133571 |</span><br><span class="line">+-----------+-----------+-----------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>å–åˆ«å</strong> åœ¨æŒ‡å®šåˆ«åä»¥åŒ…å«æŸä¸ªèšé›†å‡½æ•°çš„ç»“æœæ—¶,ä¸åº”è¯¥ä½¿ç”¨è¡¨ä¸­å®é™…çš„åˆ—åã€‚è™½ç„¶è¿™æ ·åšå¹¶éä¸åˆæ³•,ä½†ä½¿ç”¨å”¯ä¸€çš„åå­—ä¼šä½¿ä½ çš„SQLæ›´æ˜“äºç†è§£å’Œä½¿ç”¨(ä»¥åŠå°†æ¥å®¹æ˜“æ’é™¤æ•…éšœ)ã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>èšé›†å‡½æ•°ç”¨æ¥æ±‡æ€»æ•°æ®ã€‚MySQLæ”¯æŒä¸€ç³»åˆ—èšé›†å‡½æ•°,å¯ä»¥ç”¨å¤šç§æ–¹æ³•ä½¿ç”¨å®ƒä»¬ä»¥è¿”å›æ‰€éœ€çš„ç»“æœã€‚è¿™äº›å‡½æ•°æ˜¯é«˜æ•ˆè®¾è®¡çš„,å®ƒä»¬è¿”å›ç»“æœä¸€èˆ¬æ¯”ä½ åœ¨è‡ªå·±çš„å®¢æˆ·æœºåº”ç”¨ç¨‹åºä¸­è®¡ç®—è¦å¿«å¾—å¤šã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="åˆ†ç»„æ•°æ®"><a href="#åˆ†ç»„æ•°æ®" class="headerlink" title="åˆ†ç»„æ•°æ®"></a>åˆ†ç»„æ•°æ®</h4><p>æœ¬ç« å°†ä»‹ç»å¦‚ä½•åˆ†ç»„æ•°æ®,ä»¥ä¾¿èƒ½æ±‡æ€»è¡¨å†…å®¹çš„å­é›†ã€‚è¿™æ¶‰åŠä¸¤ä¸ªæ–° SELECT è¯­å¥å­å¥,åˆ†åˆ«æ˜¯ GROUP BY å­å¥å’Œ HAVING å­å¥ã€‚</p>
<blockquote>
<p>æ•°æ®åˆ†ç»„</p>
</blockquote>
<p>ä»ä¸Šä¸€ç« çŸ¥é“, SQLèšé›†å‡½æ•°å¯ç”¨æ¥æ±‡æ€»æ•°æ®ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿå¯¹è¡Œè¿›è¡Œè®¡æ•°,è®¡ç®—å’Œä¸å¹³å‡æ•°,è·å¾—æœ€å¤§å’Œæœ€å°å€¼è€Œä¸ç”¨æ£€ç´¢æ‰€æœ‰æ•°æ®ã€‚ç›®å‰ä¸ºæ­¢çš„æ‰€æœ‰è®¡ç®—éƒ½æ˜¯åœ¨è¡¨çš„æ‰€æœ‰æ•°æ®æˆ–åŒ¹é…ç‰¹å®šçš„ WHERE å­å¥çš„æ•°æ®ä¸Šè¿›è¡Œçš„ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸‹é¢çš„ä¾‹å­è¿”å›ä¾›åº”å•†<code>vend_id</code> 1003 æä¾›çš„äº§å“æ•°ç›®</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select vend_id,count(vend_id) as num_prods from products where vend_id=1003;</span><br><span class="line">+---------+----------+</span><br><span class="line">| vend_id | num_prods |</span><br><span class="line">+---------+----------+</span><br><span class="line">|    1003 |        7 |</span><br><span class="line">+---------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ä½†å¦‚æœè¦è¿”å›æ¯ä¸ªä¾›åº”å•†æä¾›çš„äº§å“æ•°ç›®æ€ä¹ˆåŠ?æˆ–è€…è¿”å›åªæä¾›å•é¡¹äº§å“çš„ä¾›åº”å•†æ‰€æä¾›çš„äº§å“,æˆ–è¿”å›æä¾›10ä¸ªä»¥ä¸Šäº§å“çš„ä¾›åº”å•†æ€ä¹ˆåŠ?</p>
<p>è¿™å°±æ˜¯åˆ†ç»„æ˜¾èº«æ‰‹çš„æ—¶å€™äº†ã€‚åˆ†ç»„å…è®¸æŠŠæ•°æ®åˆ†ä¸ºå¤šä¸ªé€»è¾‘ç»„,ä»¥ä¾¿èƒ½å¯¹æ¯ä¸ªç»„è¿›è¡Œèšé›†è®¡ç®—ã€‚</p>
<blockquote>
<p>åˆ›å»ºåˆ†ç»„</p>
</blockquote>
<p>åˆ†ç»„æ˜¯åœ¨ SELECT è¯­å¥çš„ GROUP BY å­å¥ä¸­å»ºç«‹çš„ã€‚ç†è§£åˆ†ç»„çš„æœ€å¥½åŠæ³•æ˜¯çœ‹ä¸€ä¸ªä¾‹å­</p>
<blockquote>
<blockquote>
<p>æŒ‰ <code>vend_id</code> æ’åºå¹¶åˆ†ç»„æ•°æ®è®¡ç®—æ¯ä¸ªä¾›åº”å•†çš„å•†å“æ€»æ•° <code>num_prods</code></p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select vend_id,count(vend_id) as num_prods from products group by vend_id;</span><br><span class="line">+---------+-----------+</span><br><span class="line">| vend_id | num_prods |</span><br><span class="line">+---------+-----------+</span><br><span class="line">|    1001 |         3 |</span><br><span class="line">|    1002 |         2 |</span><br><span class="line">|    1003 |         7 |</span><br><span class="line">|    1005 |         2 |</span><br><span class="line">+---------+-----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºä½¿ç”¨äº† GROUP BY ,å°±ä¸å¿…æŒ‡å®šè¦è®¡ç®—å’Œä¼°å€¼çš„æ¯ä¸ªç»„äº†ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨å®Œæˆã€‚ GROUP BY å­å¥æŒ‡ç¤ºMySQLåˆ†ç»„æ•°æ®,ç„¶åå¯¹æ¯ä¸ªç»„è€Œä¸æ˜¯æ•´ä¸ªç»“æœé›†è¿›è¡Œèšé›†ã€‚</p>
<p>åœ¨å…·ä½“ä½¿ç”¨ GROUP BY å­å¥å‰,éœ€è¦çŸ¥é“ä¸€äº›é‡è¦çš„è§„å®šã€‚</p>
<ul>
<li>GROUP BY å­å¥å¯ä»¥åŒ…å«ä»»æ„æ•°ç›®çš„åˆ—ã€‚è¿™ä½¿å¾—èƒ½å¯¹åˆ†ç»„è¿›è¡ŒåµŒå¥—,ä¸ºæ•°æ®åˆ†ç»„æä¾›æ›´ç»†è‡´çš„æ§åˆ¶ã€‚</li>
<li>å¦‚æœåœ¨ GROUP BY å­å¥ä¸­åµŒå¥—äº†åˆ†ç»„,æ•°æ®å°†åœ¨æœ€åè§„å®šçš„åˆ†ç»„ä¸Šè¿›è¡Œæ±‡æ€»ã€‚æ¢å¥è¯è¯´,åœ¨å»ºç«‹åˆ†ç»„æ—¶,æŒ‡å®šçš„æ‰€æœ‰åˆ—éƒ½ä¸€èµ·è®¡ç®—(æ‰€ä»¥ä¸èƒ½ä»ä¸ªåˆ«çš„åˆ—å–å›æ•°æ®)ã€‚</li>
<li>GROUP BY å­å¥ä¸­åˆ—å‡ºçš„æ¯ä¸ªåˆ—éƒ½å¿…é¡»æ˜¯æ£€ç´¢åˆ—æˆ–æœ‰æ•ˆçš„è¡¨è¾¾å¼(ä½†ä¸èƒ½æ˜¯èšé›†å‡½æ•°)ã€‚å¦‚æœåœ¨ SELECT ä¸­ä½¿ç”¨è¡¨è¾¾å¼,åˆ™å¿…é¡»åœ¨GROUP BY å­å¥ä¸­æŒ‡å®šç›¸åŒçš„è¡¨è¾¾å¼ã€‚ä¸èƒ½ä½¿ç”¨åˆ«åã€‚</li>
<li>é™¤èšé›†è®¡ç®—è¯­å¥å¤–, SELECT è¯­å¥ä¸­çš„æ¯ä¸ªåˆ—éƒ½å¿…é¡»åœ¨ GROUP BY å­å¥ä¸­ç»™å‡ºã€‚</li>
<li>å¦‚æœåˆ†ç»„åˆ—ä¸­å…·æœ‰ NULL å€¼,åˆ™ NULL å°†ä½œä¸ºä¸€ä¸ªåˆ†ç»„è¿”å›ã€‚å¦‚æœåˆ—ä¸­æœ‰å¤šè¡Œ NULL å€¼,å®ƒä»¬å°†åˆ†ä¸ºä¸€ç»„ã€‚</li>
<li>GROUP BY å­å¥å¿…é¡»å‡ºç°åœ¨ WHERE å­å¥ä¹‹å, ORDER BY å­å¥ä¹‹å‰ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ ROLLUP</strong> ä½¿ç”¨ WITH ROLLUP å…³é”®å­—,å¯ä»¥å¾—åˆ°æ¯ä¸ªåˆ†ç»„ä»¥åŠæ¯ä¸ªåˆ†ç»„æ±‡æ€»çº§åˆ«(é’ˆå¯¹æ¯ä¸ªåˆ†ç»„)çš„å€¼,å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select vend_id,count(vend_id) as num_prods from products group by vend_id with rollup;</span><br><span class="line">+---------+-----------+</span><br><span class="line">| vend_id | num_prods |</span><br><span class="line">+---------+-----------+</span><br><span class="line">|    1001 |         3 |</span><br><span class="line">|    1002 |         2 |</span><br><span class="line">|    1003 |         7 |</span><br><span class="line">|    1005 |         2 |</span><br><span class="line">|    NULL |        14 |</span><br><span class="line">+---------+-----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿‡æ»¤åˆ†ç»„</p>
</blockquote>
<p>é™¤äº†èƒ½ç”¨ GROUP BY åˆ†ç»„æ•°æ®å¤–,MySQLè¿˜å…è®¸è¿‡æ»¤åˆ†ç»„,è§„å®šåŒ…æ‹¬å“ªäº›åˆ†ç»„,æ’é™¤å“ªäº›åˆ†ç»„ã€‚ä¾‹å¦‚,å¯èƒ½æƒ³è¦åˆ—å‡ºè‡³å°‘æœ‰ä¸¤ä¸ªè®¢å•çš„æ‰€æœ‰ 113é¡¾å®¢ã€‚ä¸ºå¾—å‡ºè¿™ç§æ•°æ®,å¿…é¡»åŸºäºå®Œæ•´çš„åˆ†ç»„è€Œä¸æ˜¯ä¸ªåˆ«çš„è¡Œè¿›è¡Œè¿‡æ»¤ã€‚ã€‚ä½†æ˜¯,åœ¨è¿™ä¸ªä¾‹æˆ‘ä»¬å·²ç»çœ‹åˆ°äº† WHERE å­å¥çš„ä½œç”¨(ç¬¬6ç« ä¸­å¼•å…¥)å­ä¸­ WHERE ä¸èƒ½å®Œæˆä»»åŠ¡,å› ä¸º WHERE è¿‡æ»¤æŒ‡å®šçš„æ˜¯è¡Œè€Œä¸æ˜¯åˆ†ç»„ã€‚äº‹å®ä¸Š, WHERE æ²¡æœ‰åˆ†ç»„çš„æ¦‚å¿µã€‚é‚£ä¹ˆ,ä¸ä½¿ç”¨ WHERE ä½¿ç”¨ä»€ä¹ˆå‘¢?MySQLä¸ºæ­¤ç›®çš„æä¾›äº†å¦å¤–çš„å­å¥,é‚£å°±æ˜¯ HAVING å­å¥ã€‚ HAVING éå¸¸ç±»ä¼¼äº WHERE ã€‚äº‹å®ä¸Š,ç›®å‰ä¸ºæ­¢æ‰€å­¦è¿‡çš„æ‰€æœ‰ç±»å‹çš„ WHERE å­å¥éƒ½å¯ä»¥ç”¨ HAVING æ¥æ›¿ä»£ã€‚å”¯ä¸€çš„å·®åˆ«æ˜¯WHERE è¿‡æ»¤è¡Œ,è€Œ HAVING è¿‡æ»¤åˆ†ç»„ã€‚HAVING æ”¯æŒæ‰€æœ‰ WHERE æ“ä½œç¬¦åœ¨ç¬¬6ç« å’Œç¬¬7ç« ä¸­,æˆ‘ä»¬å­¦ä¹ äº† WHERE å­å¥çš„æ¡ä»¶(åŒ…æ‹¬é€šé…ç¬¦æ¡ä»¶å’Œå¸¦å¤šä¸ªæ“ä½œç¬¦çš„å­å¥)ã€‚æ‰€å­¦è¿‡çš„æœ‰å…³ WHERE çš„æ‰€æœ‰è¿™äº›æŠ€æœ¯å’Œé€‰é¡¹éƒ½é€‚ç”¨äºHAVING ã€‚å®ƒä»¬çš„å¥æ³•æ˜¯ç›¸åŒçš„,åªæ˜¯å…³é”®å­—æœ‰å·®åˆ«ã€‚é‚£ä¹ˆ,æ€ä¹ˆè¿‡æ»¤åˆ†ç»„å‘¢?è¯·çœ‹ä»¥ä¸‹çš„ä¾‹å­:</p>
<blockquote>
<blockquote>
<p>è¿‡æ»¤ä¸¤ä¸ªä»¥ä¸Šçš„è®¢å•çš„é‚£äº›åˆ†ç»„</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select cust_id,count(*) as orders from orders group by cust_id;</span><br><span class="line">+---------+--------+</span><br><span class="line">| cust_id | orders |</span><br><span class="line">+---------+--------+</span><br><span class="line">|   10001 |      2 |</span><br><span class="line">|   10003 |      1 |</span><br><span class="line">|   10004 |      1 |</span><br><span class="line">|   10005 |      1 |</span><br><span class="line">+---------+--------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select cust_id,count(*) as orders from orders group by cust_id having count(*) &gt;= 2;</span><br><span class="line">+---------+--------+</span><br><span class="line">| cust_id | orders |</span><br><span class="line">+---------+--------+</span><br><span class="line">|   10001 |      2 |</span><br><span class="line">+---------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚æ‰€è§,è¿™é‡Œ WHERE å­å¥ä¸èµ·ä½œç”¨,å› ä¸ºè¿‡æ»¤æ˜¯åŸºäºåˆ†ç»„èšé›†å€¼è€Œä¸æ˜¯ç‰¹å®šè¡Œå€¼çš„ã€‚</p>
<p><strong>HAVING å’Œ WHERE çš„å·®åˆ«</strong> è¿™é‡Œæœ‰å¦ä¸€ç§ç†è§£æ–¹æ³•, WHERE åœ¨æ•°æ®åˆ†ç»„å‰è¿›è¡Œè¿‡æ»¤, HAVING åœ¨æ•°æ®åˆ†ç»„åè¿›è¡Œè¿‡æ»¤ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„åŒºåˆ«, WHERE æ’é™¤çš„è¡Œä¸åŒ…æ‹¬åœ¨åˆ†ç»„ä¸­ã€‚è¿™å¯èƒ½ä¼šæ”¹å˜è®¡ç®—å€¼,ä»è€Œå½±å“ HAVING å­å¥ä¸­åŸºäºè¿™äº›å€¼è¿‡æ»¤æ‰çš„åˆ†ç»„ã€‚</p>
<p>é‚£ä¹ˆ,æœ‰æ²¡æœ‰åœ¨ä¸€æ¡è¯­å¥ä¸­åŒæ—¶ä½¿ç”¨ WHERE å’Œ HAVING å­å¥çš„éœ€è¦å‘¢?äº‹å®ä¸Š,ç¡®å®æœ‰ã€‚å‡å¦‚æƒ³è¿›ä¸€æ­¥è¿‡æ»¤ä¸Šé¢çš„è¯­å¥,ä½¿å®ƒè¿”å›è¿‡å»12ä¸ªæœˆå†…å…·æœ‰ä¸¤ä¸ªä»¥ä¸Šè®¢å•çš„é¡¾å®¢ã€‚ä¸ºè¾¾åˆ°è¿™ä¸€ç‚¹,å¯å¢åŠ ä¸€æ¡ WHERE å­å¥,è¿‡æ»¤å‡ºè¿‡å»12ä¸ªæœˆå†…ä¸‹è¿‡çš„è®¢å•ã€‚ç„¶åå†å¢åŠ  HAVING å­å¥è¿‡æ»¤å‡ºå…·æœ‰ä¸¤ä¸ªä»¥ä¸Šè®¢å•çš„åˆ†ç»„ã€‚</p>
<p>ä¸ºæ›´å¥½åœ°ç†è§£,è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚</p>
<blockquote>
<blockquote>
<p>åˆ—å‡ºå…·æœ‰ 2 ä¸ª(å«)ä»¥ä¸Šã€ä»·æ ¼ä¸º 10 (å«)ä»¥ä¸Šçš„äº§å“çš„ä¾›åº”å•†:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select vend_id,count(vend_id) from products where prod_price &gt;= 10 group by vend_id ;</span><br><span class="line">+---------+----------------+</span><br><span class="line">| vend_id | count(vend_id) |</span><br><span class="line">+---------+----------------+</span><br><span class="line">|    1001 |              1 |</span><br><span class="line">|    1003 |              4 |</span><br><span class="line">|    1005 |              2 |</span><br><span class="line">+---------+----------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select vend_id,count(vend_id) from products where prod_price &gt;= 10 group by vend_id having count(vend_id) &gt;= 2 ;</span><br><span class="line">+---------+----------------+</span><br><span class="line">| vend_id | count(vend_id) |</span><br><span class="line">+---------+----------------+</span><br><span class="line">|    1003 |              4 |</span><br><span class="line">|    1005 |              2 |</span><br><span class="line">+---------+----------------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡è¯­å¥ä¸­,ä½¿ç”¨äº†èšé›†å‡½æ•°çš„åŸºæœ¬ <code>SELECT</code> ,å®ƒä¸å‰é¢çš„ä¾‹å­å¾ˆç›¸åƒã€‚ <code>WHERE</code> å­å¥è¿‡æ»¤æ‰€æœ‰ <code>prod_price</code> è‡³å°‘ä¸º 10 çš„è¡Œã€‚ç„¶åæŒ‰ <code>vend_id</code>åˆ†ç»„æ•°æ®, <code>HAVING</code> å­å¥è¿‡æ»¤è®¡æ•°ä¸º 2 æˆ– 2 ä»¥ä¸Šçš„åˆ†ç»„ã€‚å¦‚æœæ²¡æœ‰ <code>WHERE</code> å­å¥,å°†ä¼šå¤šæ£€ç´¢å‡ºä¸¤è¡Œ(ä¾›åº”å•† 1002 ,é”€å”®çš„æ‰€æœ‰äº§å“ä»·æ ¼éƒ½åœ¨ 10 ä»¥ä¸‹;ä¾›åº”å•† 1001 ,é”€å”®3ä¸ªäº§å“,ä½†åªæœ‰ä¸€ä¸ªäº§å“çš„ä»·æ ¼å¤§äºç­‰äº 10 ):</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select vend_id,count(vend_id) from products group by vend_id having count(vend_id) &gt;= 2 ;</span><br><span class="line">+---------+----------------+</span><br><span class="line">| vend_id | count(vend_id) |</span><br><span class="line">+---------+----------------+</span><br><span class="line">|    1001 |              3 |</span><br><span class="line">|    1002 |              2 |</span><br><span class="line">|    1003 |              7 |</span><br><span class="line">|    1005 |              2 |</span><br><span class="line">+---------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ†ç»„å’Œæ’åº</p>
</blockquote>
<p>è™½ç„¶ GROUP BY å’Œ ORDER BY ç»å¸¸å®Œæˆç›¸åŒçš„å·¥ä½œ,ä½†å®ƒä»¬æ˜¯éå¸¸ä¸åŒçš„ã€‚</p>
<p>ä¸‹è¡¨æ±‡æ€»äº†å®ƒä»¬ä¹‹é—´çš„å·®åˆ«</p>
<table>
<thead>
<tr>
<th align="left">ORDER BY</th>
<th align="left">GROUP BY</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ’åºäº§ç”Ÿçš„è¾“å‡º</td>
<td align="left">åˆ†ç»„è¡Œã€‚ä½†è¾“å‡ºå¯èƒ½ä¸æ˜¯åˆ†ç»„çš„é¡ºåº</td>
</tr>
<tr>
<td align="left">ä»»æ„åˆ—éƒ½å¯ä»¥ä½¿ç”¨(ç”šè‡³éé€‰æ‹©çš„åˆ—ä¹Ÿå¯ä»¥ä½¿ç”¨)</td>
<td align="left">åªå¯èƒ½ä½¿ç”¨é€‰æ‹©åˆ—æˆ–è¡¨è¾¾å¼åˆ—,è€Œä¸”å¿…é¡»ä½¿ç”¨æ¯ä¸ªé€‰æ‹©åˆ—è¡¨è¾¾å¼</td>
</tr>
<tr>
<td align="left">ä¸ä¸€å®šéœ€è¦</td>
<td align="left">å¦‚æœä¸èšé›†å‡½æ•°ä¸€èµ·ä½¿ç”¨åˆ—(æˆ–è¡¨è¾¾å¼),åˆ™å¿…é¡»ä½¿ç”¨</td>
</tr>
</tbody></table>
<p>è¡¨ä¸­åˆ—å‡ºçš„ç¬¬ä¸€é¡¹å·®åˆ«æä¸ºé‡è¦ã€‚æˆ‘ä»¬ç»å¸¸å‘ç°ç”¨ GROUP BY åˆ†ç»„çš„æ•°æ®ç¡®å®æ˜¯ä»¥åˆ†ç»„é¡ºåºè¾“å‡ºçš„ã€‚ä½†æƒ…å†µå¹¶ä¸æ€»æ˜¯è¿™æ ·,å®ƒå¹¶ä¸æ˜¯SQLè§„èŒƒæ‰€è¦æ±‚çš„ã€‚æ­¤å¤–,ç”¨æˆ·ä¹Ÿå¯èƒ½ä¼šè¦æ±‚ä»¥ä¸åŒäºåˆ†ç»„çš„é¡ºåºæ’åºã€‚ä»…å› ä¸ºä½ ä»¥æŸç§æ–¹å¼åˆ†ç»„æ•°æ®(è·å¾—ç‰¹å®šçš„åˆ†ç»„èšé›†å€¼),å¹¶ä¸è¡¨ç¤ºä½ éœ€è¦ä»¥ç›¸åŒçš„æ–¹å¼æ’åºè¾“å‡ºã€‚åº”è¯¥æä¾›æ˜ç¡®çš„ ORDER BY å­å¥,å³ä½¿å…¶æ•ˆæœç­‰åŒäº GROUP BY å­å¥ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
<p><strong>ä¸è¦å¿˜è®° ORDER BY</strong> ä¸€èˆ¬åœ¨ä½¿ç”¨ GROUP BY å­å¥æ—¶,åº”è¯¥ä¹Ÿç»™å‡º ORDER BY å­å¥ã€‚è¿™æ˜¯ä¿è¯æ•°æ®æ­£ç¡®æ’åºçš„å”¯ä¸€æ–¹æ³•ã€‚åƒä¸‡ä¸è¦ä»…ä¾èµ– GROUP BY æ’åºæ•°æ®ã€‚</p>
<p>ä¸ºè¯´æ˜ GROUP BY å’Œ ORDER BY çš„ä½¿ç”¨æ–¹æ³•,è¯·çœ‹ä¸€ä¸ªä¾‹å­ã€‚ä¸‹é¢çš„SELECT è¯­å¥ç±»ä¼¼äºå‰é¢é‚£äº›ä¾‹å­ã€‚</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢æ€»è®¡è®¢å•ä»·æ ¼å¤§äºç­‰äº 50 çš„è®¢å•çš„è®¢å•å·å’Œæ€»è®¡è®¢å•ä»·æ ¼</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from orderitems;</span><br><span class="line">+-----------+------------+---------+----------+------------+</span><br><span class="line">| order_num | order_item | prod_id | quantity | item_price |</span><br><span class="line">+-----------+------------+---------+----------+------------+</span><br><span class="line">|     20005 |          1 | ANV01   |       10 |       5.99 |</span><br><span class="line">|     20005 |          2 | ANV02   |        3 |       9.99 |</span><br><span class="line">|     20005 |          3 | TNT2    |        5 |      10.00 |</span><br><span class="line">|     20005 |          4 | FB      |        1 |      10.00 |</span><br><span class="line">|     20006 |          1 | JP2000  |        1 |      55.00 |</span><br><span class="line">|     20007 |          1 | TNT2    |      100 |      10.00 |</span><br><span class="line">|     20008 |          1 | FC      |       50 |       2.50 |</span><br><span class="line">|     20009 |          1 | FB      |        1 |      10.00 |</span><br><span class="line">|     20009 |          2 | OL1     |        1 |       8.99 |</span><br><span class="line">|     20009 |          3 | SLING   |        1 |       4.49 |</span><br><span class="line">|     20009 |          4 | ANV03   |        1 |      14.99 |</span><br><span class="line">+-----------+------------+---------+----------+------------+</span><br><span class="line">11 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select order_num,sum(quantity*item_price) from orderitems group by order_num order by sum(quantity*item_price);</span><br><span class="line">+-----------+--------------------------+</span><br><span class="line">| order_num | sum(quantity*item_price) |</span><br><span class="line">+-----------+--------------------------+</span><br><span class="line">|     20009 |                    38.47 |</span><br><span class="line">|     20006 |                    55.00 |</span><br><span class="line">|     20008 |                   125.00 |</span><br><span class="line">|     20005 |                   149.87 |</span><br><span class="line">|     20007 |                  1000.00 |</span><br><span class="line">+-----------+--------------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select order_num,sum(quantity*item_price) as ordertotal from orderitems group by order_num order by ordertotal;</span><br><span class="line">+-----------+------------+</span><br><span class="line">| order_num | ordertotal |</span><br><span class="line">+-----------+------------+</span><br><span class="line">|     20009 |      38.47 |</span><br><span class="line">|     20006 |      55.00 |</span><br><span class="line">|     20008 |     125.00 |</span><br><span class="line">|     20005 |     149.87 |</span><br><span class="line">|     20007 |    1000.00 |</span><br><span class="line">+-----------+------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select order_num,sum(quantity*item_price) as ordertotal from orderitems group by order_num having ordertotal &gt;= 50 order by ordertotal;</span><br><span class="line">+-----------+------------+</span><br><span class="line">| order_num | ordertotal |</span><br><span class="line">+-----------+------------+</span><br><span class="line">|     20006 |      55.00 |</span><br><span class="line">|     20008 |     125.00 |</span><br><span class="line">|     20005 |     149.87 |</span><br><span class="line">|     20007 |    1000.00 |</span><br><span class="line">+-----------+------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select order_num,sum(quantity*item_price) as ordertotal from orderitems group by order_num having sum(quantity*item_price) &gt;= 50 order by sum(quantity*item_price);</span><br><span class="line">+-----------+------------+</span><br><span class="line">| order_num | ordertotal |</span><br><span class="line">+-----------+------------+</span><br><span class="line">|     20006 |      55.00 |</span><br><span class="line">|     20008 |     125.00 |</span><br><span class="line">|     20005 |     149.87 |</span><br><span class="line">|     20007 |    1000.00 |</span><br><span class="line">+-----------+------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, <code>GROUP BY</code> å­å¥ç”¨æ¥æŒ‰è®¢å•å·( <code>order_num</code> åˆ—)åˆ†ç»„æ•°æ®,ä»¥ä¾¿ <code>SUM(*)</code> å‡½æ•°èƒ½å¤Ÿè¿”å›æ€»è®¡è®¢å•ä»·æ ¼ã€‚ <code>HAVING</code> å­å¥è¿‡æ»¤æ•°æ®,ä½¿å¾—åªè¿”å›æ€»è®¡è®¢å•ä»·æ ¼å¤§äºç­‰äº 50 çš„è®¢å•ã€‚æœ€å,ç”¨ <code>ORDER BY</code> å­å¥æ’åºè¾“å‡ºã€‚</p>
<blockquote>
<p>SELECT å­å¥é¡ºåº</p>
</blockquote>
<p>ä¸‹é¢å›é¡¾ä¸€ä¸‹ SELECT è¯­å¥ä¸­å­å¥çš„é¡ºåºã€‚ä¸‹è¡¨ä»¥åœ¨ SELECT è¯­å¥ä¸­ä½¿ç”¨æ—¶å¿…é¡»éµå¾ªçš„æ¬¡åº,åˆ—å‡ºè¿„ä»Šä¸ºæ­¢æ‰€å­¦è¿‡çš„å­å¥ã€‚</p>
<table>
<thead>
<tr>
<th align="left">SELECTå­å¥</th>
<th align="left">è¯´æ˜</th>
<th align="left">æ˜¯å¦å¿…é¡»ä½¿ç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">SELECT</td>
<td align="left">è¦è¿”å›çš„åˆ—æˆ–è¡¨è¾¾å¼</td>
<td align="left">æ˜¯</td>
</tr>
<tr>
<td align="left">FROM</td>
<td align="left">ä»ä¸­æ£€ç´¢æ•°æ®çš„è¡¨</td>
<td align="left">ä»…åœ¨ä»è¡¨é€‰æ‹©æ•°æ®æ—¶ä½¿ç”¨</td>
</tr>
<tr>
<td align="left">WHERE</td>
<td align="left">è¡Œçº§è¿‡æ»¤</td>
<td align="left">å¦</td>
</tr>
<tr>
<td align="left">GROUP BY</td>
<td align="left">åˆ†ç»„è¯´æ˜</td>
<td align="left">ä»…åœ¨æŒ‰ç»„è®¡ç®—èšé›†æ—¶ä½¿ç”¨</td>
</tr>
<tr>
<td align="left">HAVING</td>
<td align="left">ç»„çº§è¿‡æ»¤</td>
<td align="left">å¦</td>
</tr>
<tr>
<td align="left">ORDER BY</td>
<td align="left">è¾“å‡ºæ’åºé¡ºåº</td>
<td align="left">å¦</td>
</tr>
<tr>
<td align="left">LIMIT</td>
<td align="left">è¦æ£€ç´¢çš„è¡Œæ•°</td>
<td align="left">å¦</td>
</tr>
</tbody></table>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>åœ¨æœ¬ç« ä¸­,æˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ç”¨SQLèšé›†å‡½æ•°å¯¹æ•°æ®è¿›è¡Œæ±‡æ€»è®¡ç®—ã€‚æœ¬ç« è®²æˆäº†å¦‚ä½•ä½¿ç”¨ GROUP BY å­å¥å¯¹æ•°æ®ç»„è¿›è¡Œè¿™äº›æ±‡æ€»è®¡ç®—,è¿”å›æ¯ä¸ªç»„çš„ç»“æœã€‚æˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ HAVING å­å¥è¿‡æ»¤ç‰¹å®šçš„ç»„,è¿˜çŸ¥é“äº†ORDER BY å’Œ GROUP BY ä¹‹é—´ä»¥åŠ WHERE å’Œ HAVING ä¹‹é—´çš„å·®å¼‚ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="ä½¿ç”¨å­æŸ¥è¯¢"><a href="#ä½¿ç”¨å­æŸ¥è¯¢" class="headerlink" title="ä½¿ç”¨å­æŸ¥è¯¢"></a>ä½¿ç”¨å­æŸ¥è¯¢</h4><p>æœ¬ç« ä»‹ç»ä»€ä¹ˆæ˜¯å­æŸ¥è¯¢ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚</p>
<blockquote>
<p>å­æŸ¥è¯¢<br><strong>ç‰ˆæœ¬è¦æ±‚</strong> MySQL 4.1å¼•å…¥äº†å¯¹å­æŸ¥è¯¢çš„æ”¯æŒ,æ‰€ä»¥è¦æƒ³ä½¿ç”¨æœ¬ç« æè¿°çš„SQL,å¿…é¡»ä½¿ç”¨MySQL 4.1æˆ–æ›´é«˜çº§çš„ç‰ˆæœ¬ã€‚</p>
</blockquote>
<p><strong>SELECTè¯­å¥</strong> æ˜¯SQLçš„æŸ¥è¯¢ã€‚è¿„ä»Šä¸ºæ­¢æˆ‘ä»¬æ‰€çœ‹åˆ°çš„æ‰€æœ‰ SELECT è¯­å¥éƒ½æ˜¯ç®€å•æŸ¥è¯¢,å³ä»å•ä¸ªæ•°æ®åº“è¡¨ä¸­æ£€ç´¢æ•°æ®çš„å•æ¡è¯­å¥ã€‚</p>
<p><strong>æŸ¥è¯¢(query)</strong> ä»»ä½•SQLè¯­å¥éƒ½æ˜¯æŸ¥è¯¢ã€‚ä½†æ­¤æœ¯è¯­ä¸€èˆ¬æŒ‡ SELECTè¯­å¥ã€‚</p>
<p>SQLè¿˜å…è®¸åˆ›å»ºå­æŸ¥è¯¢(subquery),å³åµŒå¥—åœ¨å…¶ä»–æŸ¥è¯¢ä¸­çš„æŸ¥è¯¢ã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢?ç†è§£è¿™ä¸ªæ¦‚å¿µçš„æœ€å¥½æ–¹æ³•æ˜¯è€ƒå¯Ÿå‡ ä¸ªä¾‹å­ã€‚</p>
<blockquote>
<p>åˆ©ç”¨å­æŸ¥è¯¢è¿›è¡Œè¿‡æ»¤</p>
</blockquote>
<p>è®¢å•ä¿¡æ¯å­˜å‚¨åœ¨ä¸¤ä¸ªè¡¨ä¸­ã€‚å¯¹äºåŒ…å«è®¢å•å·ã€å®¢æˆ·IDã€è®¢å•æ—¥æœŸçš„æ¯ä¸ªè®¢å•, orders è¡¨å­˜å‚¨ä¸€è¡Œã€‚<br>å„è®¢å•çš„ç‰©å“å­˜å‚¨åœ¨ç›¸å…³çš„orderitems è¡¨ä¸­ã€‚ orders è¡¨ä¸å­˜å‚¨å®¢æˆ·ä¿¡æ¯ã€‚å®ƒåªå­˜å‚¨å®¢æˆ·çš„IDã€‚<br>å®é™…çš„å®¢æˆ·ä¿¡æ¯å­˜å‚¨åœ¨ customers è¡¨ä¸­ã€‚</p>
<blockquote>
<blockquote>
<p>ç°åœ¨,å‡å¦‚éœ€è¦åˆ—å‡ºè®¢è´­ç‰©å“ TNT2 çš„æ‰€æœ‰å®¢æˆ·,åº”è¯¥æ€æ ·æ£€ç´¢?ä¸‹é¢åˆ—å‡ºå…·ä½“çš„æ­¥éª¤ã€‚</p>
</blockquote>
</blockquote>
<p>(1) æ£€ç´¢åŒ…å«ç‰©å“ TNT2 çš„æ‰€æœ‰è®¢å•çš„ç¼–å·ã€‚</p>
<p>(2) æ£€ç´¢å…·æœ‰å‰ä¸€æ­¥éª¤åˆ—å‡ºçš„è®¢å•ç¼–å·çš„æ‰€æœ‰å®¢æˆ·çš„IDã€‚</p>
<p>(3) æ£€ç´¢å‰ä¸€æ­¥éª¤è¿”å›çš„æ‰€æœ‰å®¢æˆ·IDçš„å®¢æˆ·ä¿¡æ¯ã€‚</p>
<p>ä¸Šè¿°æ¯ä¸ªæ­¥éª¤éƒ½å¯ä»¥å•ç‹¬ä½œä¸ºä¸€ä¸ªæŸ¥è¯¢æ¥æ‰§è¡Œã€‚å¯ä»¥æŠŠä¸€æ¡ SELECTè¯­å¥è¿”å›çš„ç»“æœç”¨äºå¦ä¸€æ¡ SELECT è¯­å¥çš„ WHERE å­å¥ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢æ¥æŠŠ3ä¸ªæŸ¥è¯¢ç»„åˆæˆä¸€æ¡è¯­å¥</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select order_num from orderitems where prod_id='TNT2';</span><br><span class="line">+-----------+</span><br><span class="line">| order_num |</span><br><span class="line">+-----------+</span><br><span class="line">|     20005 |</span><br><span class="line">|     20007 |</span><br><span class="line">+-----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select cust_id from orders where order_num = 20005 or order_num = 20007;</span><br><span class="line">+---------+</span><br><span class="line">| cust_id |</span><br><span class="line">+---------+</span><br><span class="line">|   10001 |</span><br><span class="line">|   10004 |</span><br><span class="line">+---------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select cust_name from customers where cust_id in (10001,10004);</span><br><span class="line">+----------------+</span><br><span class="line">| cust_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| Coyote Inc.    |</span><br><span class="line">| Yosemite Place |</span><br><span class="line">+----------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select cust_name from customers where cust_id in</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> (</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> select cust_id from orders <span class="built_in">where</span> order_num <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> (select order_num from orderitems <span class="built_in">where</span> prod_id=<span class="string">'TNT2'</span>)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> );</span></span><br><span class="line">+----------------+</span><br><span class="line">| cust_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| Coyote Inc.    |</span><br><span class="line">| Yosemite Place |</span><br><span class="line">+----------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>å¯è§,åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨å­æŸ¥è¯¢èƒ½å¤Ÿç¼–å†™å‡ºåŠŸèƒ½å¾ˆå¼ºå¹¶ä¸”å¾ˆçµæ´»çš„SQLè¯­å¥ã€‚å¯¹äºèƒ½åµŒå¥—çš„å­æŸ¥è¯¢çš„æ•°ç›®æ²¡æœ‰é™åˆ¶,ä¸è¿‡åœ¨å®é™…ä½¿ç”¨æ—¶ç”±äºæ€§èƒ½çš„é™åˆ¶,ä¸èƒ½åµŒå¥—å¤ªå¤šçš„å­æŸ¥è¯¢ã€‚</p>
<p><strong>åˆ—å¿…é¡»åŒ¹é…</strong> åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨å­æŸ¥è¯¢(å¦‚è¿™é‡Œæ‰€ç¤º),åº”è¯¥ä¿è¯ SELECT è¯­å¥å…·æœ‰ä¸ WHERE å­å¥ä¸­ç›¸åŒæ•°ç›®çš„åˆ—ã€‚é€šå¸¸,å­æŸ¥è¯¢å°†è¿”å›å•ä¸ªåˆ—å¹¶ä¸”ä¸å•ä¸ªåˆ—åŒ¹é…,ä½†å¦‚æœéœ€è¦ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ªåˆ—ã€‚</p>
<p>è™½ç„¶å­æŸ¥è¯¢ä¸€èˆ¬ä¸ <code>IN</code>æ“ä½œç¬¦ç»“åˆä½¿ç”¨,ä½†ä¹Ÿå¯ä»¥ç”¨äºæµ‹è¯•ç­‰äº(<code>=</code> )ã€ä¸ç­‰äº( <code>&lt;&gt;</code> )ç­‰ã€‚</p>
<p><strong>å­æŸ¥è¯¢å’Œæ€§èƒ½</strong> è¿™é‡Œç»™å‡ºçš„ä»£ç æœ‰æ•ˆå¹¶è·å¾—æ‰€éœ€çš„ç»“æœã€‚ä½†æ˜¯,ä½¿ç”¨å­æŸ¥è¯¢å¹¶ä¸æ€»æ˜¯æ‰§è¡Œè¿™ç§ç±»å‹çš„æ•°æ®æ£€ç´¢çš„æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚æ›´å¤šçš„è®ºè¿°,è¯·å‚é˜…ä¸‹ä¸€ç« ,å…¶ä¸­å°†å†æ¬¡ç»™å‡ºè¿™ä¸ªä¾‹å­ã€‚</p>
<blockquote>
<p>ä½œä¸ºè®¡ç®—å­—æ®µä½¿ç”¨å­æŸ¥è¯¢</p>
</blockquote>
<p>ä½¿ç”¨å­æŸ¥è¯¢çš„å¦ä¸€æ–¹æ³•æ˜¯åˆ›å»ºè®¡ç®—å­—æ®µã€‚</p>
<blockquote>
<blockquote>
<p>æŸ¥è¯¢æ¯ä¸ªå®¢æˆ·çš„å§“å<code>cust_name</code>å’ŒçŠ¶æ€<code>cust_state</code>ä»¥åŠæ¯ä¸ªå®¢æˆ·çš„è®¢å•æ€»æ•°<code>orders</code>ã€‚è®¢å•ä¸ç›¸åº”çš„å®¢æˆ·IDå­˜å‚¨åœ¨ orders è¡¨ä¸­ï¼Œå®¢æˆ·ä¿¡æ¯å­˜å‚¨åœ¨customersè¡¨ä¸­ã€‚</p>
</blockquote>
</blockquote>
<p>ä¸ºäº†æ‰§è¡Œè¿™ä¸ªæ“ä½œ,éµå¾ªä¸‹é¢çš„æ­¥éª¤ã€‚</p>
<p>(1) ä» customers è¡¨ä¸­æ£€ç´¢å®¢æˆ·åˆ—è¡¨ã€‚</p>
<p>(2) å¯¹äºæ£€ç´¢å‡ºçš„æ¯ä¸ªå®¢æˆ·,ç»Ÿè®¡å…¶åœ¨ orders è¡¨ä¸­çš„è®¢å•æ•°ç›®ã€‚</p>
<p>æ­£å¦‚å‰ä¸¤ç« æ‰€è¿°,å¯ä½¿ç”¨ SELECT COUNT ( *) å¯¹è¡¨ä¸­çš„è¡Œè¿›è¡Œè®¡æ•°,å¹¶ä¸”é€šè¿‡æä¾›ä¸€æ¡ WHERE å­å¥æ¥è¿‡æ»¤æŸä¸ªç‰¹å®šçš„å®¢æˆ·ID,å¯ä»…å¯¹è¯¥å®¢æˆ·çš„è®¢å•è¿›è¡Œè®¡æ•°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select cust_name,cust_state,(select count(*) from orders where orders.cust_id=customers.cust_id) as orders from customers order by cust_name;</span><br><span class="line">+----------------+------------+--------+</span><br><span class="line">| cust_name      | cust_state | orders |</span><br><span class="line">+----------------+------------+--------+</span><br><span class="line">| Coyote Inc.    | MI         |      2 |</span><br><span class="line">| E Fudd         | IL         |      1 |</span><br><span class="line">| Mouse House    | OH         |      0 |</span><br><span class="line">| Wascals        | IN         |      1 |</span><br><span class="line">| Yosemite Place | AZ         |      1 |</span><br><span class="line">+----------------+------------+--------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><code>cust_name</code> ã€<code>cust_state</code> å’Œ <code>orders</code> ã€‚ <code>orders</code> æ˜¯ä¸€ä¸ªè®¡ç®—å­—æ®µ,å®ƒæ˜¯ç”±åœ†æ‹¬å·ä¸­çš„å­æŸ¥è¯¢å»ºç«‹çš„ã€‚è¯¥å­æŸ¥è¯¢å¯¹æ£€ç´¢å‡ºçš„æ¯ä¸ªå®¢æˆ·æ‰§è¡Œä¸€æ¬¡ã€‚åœ¨æ­¤ä¾‹å­ä¸­,è¯¥å­æŸ¥è¯¢æ‰§è¡Œäº†5æ¬¡,å› ä¸ºæ£€ç´¢å‡ºäº†5ä¸ªå®¢æˆ·ã€‚</p>
<p>åˆ†æå­æŸ¥è¯¢ä¸­çš„ WHERE å­å¥ä¸å‰é¢ä½¿ç”¨çš„ WHERE å­å¥ç¨æœ‰ä¸åŒ,å› ä¸ºå®ƒä½¿ç”¨äº†å®Œå…¨é™å®šåˆ—å(åœ¨å‰é¢æåˆ°è¿‡)ã€‚</p>
<p><strong>ç›¸å…³å­æŸ¥è¯¢(correlated subquery)</strong> æ¶‰åŠå¤–éƒ¨æŸ¥è¯¢çš„å­æŸ¥è¯¢ã€‚è¿™ç§ç±»å‹çš„å­æŸ¥è¯¢ç§°ä¸ºç›¸å…³å­æŸ¥è¯¢ã€‚ä»»ä½•æ—¶å€™åªè¦åˆ—åå¯èƒ½æœ‰å¤šä¹‰æ€§,å°±å¿…é¡»ä½¿ç”¨è¿™ç§è¯­æ³•(è¡¨åå’Œåˆ—åç”±ä¸€ä¸ªå¥ç‚¹åˆ†éš”)ã€‚ä¸ºä»€ä¹ˆè¿™æ ·?</p>
<blockquote>
<blockquote>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚æœä¸ä½¿ç”¨å®Œå…¨é™å®šçš„åˆ—åä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µ</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select cust_name,cust_state,(select count(*) from orders where cust_id=cust_id) as orders from customers order by cust_name;+----------------+------------+--------+</span><br><span class="line">| cust_name      | cust_state | orders |</span><br><span class="line">+----------------+------------+--------+</span><br><span class="line">| Coyote Inc.    | MI         |      5 |</span><br><span class="line">| E Fudd         | IL         |      5 |</span><br><span class="line">| Mouse House    | OH         |      5 |</span><br><span class="line">| Wascals        | IN         |      5 |</span><br><span class="line">| Yosemite Place | AZ         |      5 |</span><br><span class="line">+----------------+------------+--------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ˜¾ç„¶,è¿”å›çš„ç»“æœä¸æ­£ç¡®(è¯·æ¯”è¾ƒå‰é¢çš„ç»“æœ),é‚£ä¹ˆ,ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢?æœ‰ä¸¤ä¸ª <code>cust_id</code> åˆ—,ä¸€ä¸ªåœ¨ <code>customers</code> ä¸­,å¦ä¸€ä¸ªåœ¨<code>orders</code> ä¸­,éœ€è¦æ¯”è¾ƒè¿™ä¸¤ä¸ªåˆ—ä»¥æ­£ç¡®åœ°æŠŠè®¢å•ä¸å®ƒä»¬ç›¸åº”çš„é¡¾å®¢åŒ¹é…ã€‚å¦‚æœä¸å®Œå…¨é™å®šåˆ—å,MySQLå°†å‡å®šä½ æ˜¯å¯¹ <code>orders</code> è¡¨ä¸­çš„ <code>cust_id</code> è¿›è¡Œè‡ªèº«æ¯”è¾ƒã€‚è€Œ <code>SELECT COUNT(*) FROM orders WHERE cust_id = cust_id;</code>æ€»æ˜¯è¿”å› <code>orders</code> è¡¨ä¸­çš„è®¢å•æ€»æ•°(å› ä¸ºMySQLæŸ¥çœ‹æ¯ä¸ªè®¢å•çš„ <code>cust_id</code>æ˜¯å¦ä¸æœ¬èº«åŒ¹é…,å½“ç„¶,å®ƒä»¬æ€»æ˜¯åŒ¹é…çš„)ã€‚</p>
<p>è™½ç„¶å­æŸ¥è¯¢åœ¨æ„é€ è¿™ç§ SELECT è¯­å¥æ—¶ææœ‰ç”¨,ä½†å¿…é¡»æ³¨æ„é™åˆ¶æœ‰æ­§ä¹‰æ€§çš„åˆ—åã€‚</p>
<p><strong>ä¸æ­¢ä¸€ç§è§£å†³æ–¹æ¡ˆ</strong> æ­£å¦‚æœ¬ç« å‰é¢æ‰€è¿°,è™½ç„¶è¿™é‡Œç»™å‡ºçš„æ ·ä¾‹ä»£ç è¿è¡Œè‰¯å¥½,ä½†å®ƒå¹¶ä¸æ˜¯è§£å†³è¿™ç§æ•°æ®æ£€ç´¢çš„æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚åœ¨åé¢çš„ç« èŠ‚ä¸­æˆ‘ä»¬è¿˜è¦é‡åˆ°è¿™ä¸ªä¾‹å­ã€‚</p>
<p><strong>é€æ¸å¢åŠ å­æŸ¥è¯¢æ¥å»ºç«‹æŸ¥è¯¢</strong> ç”¨å­æŸ¥è¯¢æµ‹è¯•å’Œè°ƒè¯•æŸ¥è¯¢å¾ˆæœ‰æŠ€å·§æ€§,ç‰¹åˆ«æ˜¯åœ¨è¿™äº›è¯­å¥çš„å¤æ‚æ€§ä¸æ–­å¢åŠ çš„æƒ…å†µä¸‹æ›´æ˜¯å¦‚æ­¤ã€‚ç”¨å­æŸ¥è¯¢å»ºç«‹(å’Œæµ‹è¯•)æŸ¥è¯¢çš„æœ€å¯é çš„æ–¹æ³•æ˜¯é€æ¸è¿›è¡Œ,è¿™ä¸MySQLå¤„ç†å®ƒä»¬çš„æ–¹æ³•éå¸¸ç›¸åŒã€‚é¦–å…ˆ,å»ºç«‹å’Œæµ‹è¯•æœ€å†…å±‚çš„æŸ¥è¯¢ã€‚ç„¶å,ç”¨ç¡¬ç¼–ç æ•°æ®å»ºç«‹å’Œæµ‹è¯•å¤–å±‚æŸ¥è¯¢,å¹¶ä¸”ä»…åœ¨ç¡®è®¤å®ƒæ­£å¸¸åæ‰åµŒå…¥å­æŸ¥è¯¢ã€‚è¿™æ—¶,å†æ¬¡æµ‹è¯•å®ƒã€‚å¯¹äºè¦å¢åŠ çš„æ¯ä¸ªæŸ¥è¯¢,é‡å¤è¿™äº›æ­¥éª¤ã€‚è¿™æ ·åšä»…ç»™æ„é€ æŸ¥è¯¢å¢åŠ äº†ä¸€ç‚¹ç‚¹æ—¶é—´,ä½†èŠ‚çœäº†ä»¥å(æ‰¾å‡ºæŸ¥è¯¢ä¸ºä»€ä¹ˆä¸æ­£å¸¸)çš„å¤§é‡æ—¶é—´,å¹¶ä¸”æå¤§åœ°æé«˜äº†æŸ¥è¯¢ä¸€å¼€å§‹å°±æ­£å¸¸å·¥ä½œçš„å¯èƒ½æ€§ã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« å­¦ä¹ äº†ä»€ä¹ˆæ˜¯å­æŸ¥è¯¢ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚å­æŸ¥è¯¢æœ€å¸¸è§çš„ä½¿ç”¨æ˜¯åœ¨ WHERE å­å¥çš„ IN æ“ä½œç¬¦ä¸­,ä»¥åŠç”¨æ¥å¡«å……è®¡ç®—åˆ—ã€‚æˆ‘ä»¬ä¸¾äº†è¿™ä¸¤ç§æ“ä½œç±»å‹çš„ä¾‹å­ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="è”ç»“è¡¨"><a href="#è”ç»“è¡¨" class="headerlink" title="è”ç»“è¡¨"></a>è”ç»“è¡¨</h4><p>æœ¬ç« å°†ä»‹ç»ä»€ä¹ˆæ˜¯è”ç»“,ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è”ç»“,å¦‚ä½•ç¼–å†™ä½¿ç”¨è”ç»“çš„SELECT è¯­å¥ã€‚</p>
<blockquote>
<p>è”ç»“</p>
</blockquote>
<p>SQLæœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯èƒ½åœ¨æ•°æ®æ£€ç´¢æŸ¥è¯¢çš„æ‰§è¡Œä¸­è”ç»“(join)è¡¨ã€‚è”ç»“æ˜¯åˆ©ç”¨SQLçš„ SELECT èƒ½æ‰§è¡Œçš„æœ€é‡è¦çš„æ“ä½œ,å¾ˆå¥½åœ°ç†è§£è”ç»“åŠå…¶è¯­æ³•æ˜¯å­¦ä¹ SQLçš„ä¸€ä¸ªæä¸ºé‡è¦çš„ç»„æˆéƒ¨åˆ†ã€‚</p>
<p>åœ¨èƒ½å¤Ÿæœ‰æ•ˆåœ°ä½¿ç”¨è”ç»“å‰,å¿…é¡»äº†è§£å…³ç³»è¡¨ä»¥åŠå…³ç³»æ•°æ®åº“è®¾è®¡çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚ä¸‹é¢çš„ä»‹ç»å¹¶ä¸æ˜¯è¿™ä¸ªå†…å®¹çš„å…¨éƒ¨çŸ¥è¯†,ä½†ä½œä¸ºå…¥é—¨å·²ç»è¶³å¤Ÿäº†ã€‚</p>
<p>1.å…³ç³»è¡¨</p>
<p>ç†è§£å…³ç³»è¡¨çš„æœ€å¥½æ–¹æ³•æ˜¯æ¥çœ‹ä¸€ä¸ªç°å®ä¸–ç•Œä¸­çš„ä¾‹å­ã€‚å‡å¦‚æœ‰ä¸€ä¸ªåŒ…å«äº§å“ç›®å½•çš„æ•°æ®åº“è¡¨,å…¶ä¸­æ¯ç§ç±»åˆ«çš„ç‰©å“å ä¸€è¡Œã€‚å¯¹äºæ¯ç§ç‰©å“è¦å­˜å‚¨çš„ä¿¡æ¯åŒ…æ‹¬äº§å“æè¿°å’Œä»·æ ¼,ä»¥åŠç”Ÿäº§è¯¥äº§å“çš„ä¾›åº”å•†ä¿¡æ¯ã€‚</p>
<p>ç°åœ¨,å‡å¦‚æœ‰ç”±åŒä¸€ä¾›åº”å•†ç”Ÿäº§çš„å¤šç§ç‰©å“,é‚£ä¹ˆåœ¨ä½•å¤„å­˜å‚¨ä¾›åº”å•†ä¿¡æ¯(å¦‚,ä¾›åº”å•†åã€åœ°å€ã€è”ç³»æ–¹æ³•ç­‰)å‘¢?å°†è¿™äº›æ•°æ®ä¸äº§å“ä¿¡æ¯åˆ†å¼€å­˜å‚¨çš„ç†ç”±å¦‚ä¸‹ã€‚</p>
<ul>
<li>å› ä¸ºåŒä¸€ä¾›åº”å•†ç”Ÿäº§çš„æ¯ä¸ªäº§å“çš„ä¾›åº”å•†ä¿¡æ¯éƒ½æ˜¯ç›¸åŒçš„,å¯¹æ¯ä¸ªäº§å“é‡å¤æ­¤ä¿¡æ¯æ—¢æµªè´¹æ—¶é—´åˆæµªè´¹å­˜å‚¨ç©ºé—´ã€‚</li>
<li>å¦‚æœä¾›åº”å•†ä¿¡æ¯æ”¹å˜(ä¾‹å¦‚,ä¾›åº”å•†æ¬å®¶æˆ–ç”µè¯å·ç å˜åŠ¨),åªéœ€æ”¹åŠ¨ä¸€æ¬¡å³å¯ã€‚</li>
<li>å¦‚æœæœ‰é‡å¤æ•°æ®(å³æ¯ç§äº§å“éƒ½å­˜å‚¨ä¾›åº”å•†ä¿¡æ¯),å¾ˆéš¾ä¿è¯æ¯æ¬¡è¾“å…¥è¯¥æ•°æ®çš„æ–¹å¼éƒ½ç›¸åŒã€‚ä¸ä¸€è‡´çš„æ•°æ®åœ¨æŠ¥è¡¨ä¸­å¾ˆéš¾åˆ©ç”¨ã€‚</li>
</ul>
<p>å…³é”®æ˜¯,ç›¸åŒæ•°æ®å‡ºç°å¤šæ¬¡å†³ä¸æ˜¯ä¸€ä»¶å¥½äº‹,æ­¤å› ç´ æ˜¯å…³ç³»æ•°æ®åº“è®¾è®¡çš„åŸºç¡€ã€‚å…³ç³»è¡¨çš„è®¾è®¡å°±æ˜¯è¦ä¿è¯æŠŠä¿¡æ¯åˆ†è§£æˆå¤šä¸ªè¡¨,ä¸€ç±»æ•°æ®ä¸€ä¸ªè¡¨ã€‚å„è¡¨é€šè¿‡æŸäº›å¸¸ç”¨çš„å€¼(å³å…³ç³»è®¾è®¡ä¸­çš„å…³ç³»(relational))äº’ç›¸å…³è”ã€‚</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­,å¯å»ºç«‹ä¸¤ä¸ªè¡¨,ä¸€ä¸ªå­˜å‚¨ä¾›åº”å•†ä¿¡æ¯,å¦ä¸€ä¸ªå­˜å‚¨äº§å“ä¿¡æ¯ã€‚ vendors è¡¨åŒ…å«æ‰€æœ‰ä¾›åº”å•†ä¿¡æ¯,æ¯ä¸ªä¾›åº”å•†å ä¸€è¡Œ,æ¯ä¸ªä¾›åº”å•†å…·æœ‰å”¯ä¸€çš„æ ‡è¯†ã€‚æ­¤æ ‡è¯†ç§°ä¸ºä¸»é”®(primary key)(åœ¨ç¬¬1ç« ä¸­é¦–æ¬¡æåˆ°),å¯ä»¥æ˜¯ä¾›åº”å•†IDæˆ–ä»»ä½•å…¶ä»–å”¯ä¸€å€¼ã€‚</p>
<p>products è¡¨åªå­˜å‚¨äº§å“ä¿¡æ¯,å®ƒé™¤äº†å­˜å‚¨ä¾›åº”å•†ID( vendors è¡¨çš„ä¸»é”®)å¤–ä¸å­˜å‚¨å…¶ä»–ä¾›åº”å•†ä¿¡æ¯ã€‚ vendors è¡¨çš„ä¸»é”®åˆå«ä½œ products çš„å¤–é”®,å®ƒå°† vendors è¡¨ä¸ products è¡¨å…³è”,åˆ©ç”¨ä¾›åº”å•†IDèƒ½ä» vendors è¡¨ä¸­æ‰¾å‡ºç›¸åº”ä¾›åº”å•†çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<p><strong>å¤–é”®(foreign key)</strong> å¤–é”®ä¸ºæŸä¸ªè¡¨ä¸­çš„ä¸€åˆ—,å®ƒåŒ…å«å¦ä¸€ä¸ªè¡¨çš„ä¸»é”®å€¼,å®šä¹‰äº†ä¸¤ä¸ªè¡¨ä¹‹é—´çš„å…³ç³»ã€‚</p>
<p>è¿™æ ·åšçš„å¥½å¤„å¦‚ä¸‹:</p>
<ul>
<li>ä¾›åº”å•†ä¿¡æ¯ä¸é‡å¤,ä»è€Œä¸æµªè´¹æ—¶é—´å’Œç©ºé—´;</li>
<li>å¦‚æœä¾›åº”å•†ä¿¡æ¯å˜åŠ¨,å¯ä»¥åªæ›´æ–° vendors è¡¨ä¸­çš„å•ä¸ªè®°å½•,ç›¸å…³è¡¨ä¸­çš„æ•°æ®ä¸ç”¨æ”¹åŠ¨;</li>
<li>ç”±äºæ•°æ®æ— é‡å¤,æ˜¾ç„¶æ•°æ®æ˜¯ä¸€è‡´çš„,è¿™ä½¿å¾—å¤„ç†æ•°æ®æ›´ç®€å•ã€‚</li>
</ul>
<p>æ€»ä¹‹,å…³ç³»æ•°æ®å¯ä»¥æœ‰æ•ˆåœ°å­˜å‚¨å’Œæ–¹ä¾¿åœ°å¤„ç†ã€‚å› æ­¤,å…³ç³»æ•°æ®åº“çš„å¯ä¼¸ç¼©æ€§è¿œæ¯”éå…³ç³»æ•°æ®åº“è¦å¥½ã€‚</p>
<p><strong>å¯ä¼¸ç¼©æ€§(scale)</strong> èƒ½å¤Ÿé€‚åº”ä¸æ–­å¢åŠ çš„å·¥ä½œé‡è€Œä¸å¤±è´¥ã€‚è®¾è®¡è‰¯å¥½çš„æ•°æ®åº“æˆ–åº”ç”¨ç¨‹åºç§°ä¹‹ä¸ºå¯ä¼¸ç¼©æ€§å¥½(scale well)ã€‚</p>
<p>2.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è”ç»“</p>
<p>æ­£å¦‚æ‰€è¿°,åˆ†è§£æ•°æ®ä¸ºå¤šä¸ªè¡¨èƒ½æ›´æœ‰æ•ˆåœ°å­˜å‚¨,æ›´æ–¹ä¾¿åœ°å¤„ç†,å¹¶ä¸”å…·æœ‰æ›´å¤§çš„å¯ä¼¸ç¼©æ€§ã€‚ä½†è¿™äº›å¥½å¤„æ˜¯æœ‰ä»£ä»·çš„ã€‚</p>
<p>å¦‚æœæ•°æ®å­˜å‚¨åœ¨å¤šä¸ªè¡¨ä¸­,æ€æ ·ç”¨å•æ¡ SELECT è¯­å¥æ£€ç´¢å‡ºæ•°æ®?</p>
<p>ç­”æ¡ˆæ˜¯ä½¿ç”¨è”ç»“ã€‚ç®€å•åœ°è¯´,è”ç»“æ˜¯ä¸€ç§æœºåˆ¶,ç”¨æ¥åœ¨ä¸€æ¡ SELECTè¯­å¥ä¸­å…³è”è¡¨,å› æ­¤ç§°ä¹‹ä¸ºè”ç»“ã€‚ä½¿ç”¨ç‰¹æ®Šçš„è¯­æ³•,å¯ä»¥è”ç»“å¤šä¸ªè¡¨è¿”å›ä¸€ç»„è¾“å‡º,è”ç»“åœ¨è¿è¡Œæ—¶å…³è”è¡¨ä¸­æ­£ç¡®çš„è¡Œã€‚</p>
<p><strong>ç»´æŠ¤å¼•ç”¨å®Œæ•´æ€§</strong> é‡è¦çš„æ˜¯,è¦ç†è§£è”ç»“ä¸æ˜¯ç‰©ç†å®ä½“ã€‚æ¢å¥è¯è¯´,å®ƒåœ¨å®é™…çš„æ•°æ®åº“è¡¨ä¸­ä¸å­˜åœ¨ã€‚è”ç»“ç”±MySQLæ ¹æ®éœ€è¦å»ºç«‹,å®ƒå­˜åœ¨äºæŸ¥è¯¢çš„æ‰§è¡Œå½“ä¸­ã€‚åœ¨ä½¿ç”¨å…³ç³»è¡¨æ—¶,ä»…åœ¨å…³ç³»åˆ—ä¸­æ’å…¥åˆæ³•çš„æ•°æ®éå¸¸é‡è¦ã€‚å›åˆ°è¿™é‡Œçš„ä¾‹å­,å¦‚æœåœ¨ products è¡¨ä¸­æ’å…¥æ‹¥æœ‰éæ³•ä¾›åº”å•†ID(å³æ²¡æœ‰åœ¨ vendors è¡¨ä¸­å‡ºç°)çš„ä¾›åº”å•†ç”Ÿäº§çš„äº§å“,åˆ™è¿™äº›äº§å“æ˜¯ä¸å¯è®¿é—®çš„,å› ä¸ºå®ƒä»¬æ²¡æœ‰å…³è”åˆ°æŸä¸ªä¾›åº”å•†ã€‚ä¸ºé˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿ,å¯æŒ‡ç¤ºMySQLåªå…è®¸åœ¨ products è¡¨çš„ä¾›åº”å•†IDåˆ—ä¸­å‡ºç°åˆæ³•å€¼(å³å‡ºç°åœ¨ vendors è¡¨ä¸­çš„ä¾›åº”å•†)ã€‚è¿™å°±æ˜¯ç»´æŠ¤å¼•ç”¨å®Œæ•´æ€§,å®ƒæ˜¯é€šè¿‡åœ¨è¡¨çš„å®šä¹‰ä¸­æŒ‡å®šä¸»é”®å’Œå¤–é”®æ¥å®ç°çš„ã€‚</p>
<blockquote>
<p>åˆ›å»ºè”ç»“</p>
</blockquote>
<p>è”ç»“çš„åˆ›å»ºéå¸¸ç®€å•,è§„å®šè¦è”ç»“çš„æ‰€æœ‰è¡¨ä»¥åŠå®ƒä»¬å¦‚ä½•å…³è”å³å¯ã€‚</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢å‡ºæ‰€æœ‰çš„ä¾›åº”å•†å<code>vend_name</code>ï¼Œä»¥åŠä¾›åº”å•†æä¾›çš„å•†å“å<code>prod_name</code>å’Œä»·æ ¼<code>prod_price</code>ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; describe vendors;</span><br><span class="line">+--------------+----------+------+-----+---------+----------------+</span><br><span class="line">| Field        | Type     | Null | Key | Default | Extra          |</span><br><span class="line">+--------------+----------+------+-----+---------+----------------+</span><br><span class="line">| vend_id      | int(11)  | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| vend_name    | char(50) | NO   |     | NULL    |                |</span><br><span class="line">| vend_address | char(50) | YES  |     | NULL    |                |</span><br><span class="line">| vend_city    | char(50) | YES  |     | NULL    |                |</span><br><span class="line">| vend_state   | char(5)  | YES  |     | NULL    |                |</span><br><span class="line">| vend_zip     | char(10) | YES  |     | NULL    |                |</span><br><span class="line">| vend_country | char(50) | YES  |     | NULL    |                |</span><br><span class="line">+--------------+----------+------+-----+---------+----------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; describe products;</span><br><span class="line">+------------+--------------+------+-----+---------+-------+</span><br><span class="line">| Field      | Type         | Null | Key | Default | Extra |</span><br><span class="line">+------------+--------------+------+-----+---------+-------+</span><br><span class="line">| prod_id    | char(10)     | NO   | PRI | NULL    |       |</span><br><span class="line">| vend_id    | int(11)      | NO   | MUL | NULL    |       |</span><br><span class="line">| prod_name  | char(255)    | NO   |     | NULL    |       |</span><br><span class="line">| prod_price | decimal(8,2) | NO   |     | NULL    |       |</span><br><span class="line">| prod_desc  | text         | YES  |     | NULL    |       |</span><br><span class="line">+------------+--------------+------+-----+---------+-------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select vend_name,prod_name,prod_price from vendors,products where vendors.vend_id = products.vend_id order by vend_name,prod_name;</span><br><span class="line">+-------------+----------------+------------+</span><br><span class="line">| vend_name   | prod_name      | prod_price |</span><br><span class="line">+-------------+----------------+------------+</span><br><span class="line">| ACME        | Bird seed      |      10.00 |</span><br><span class="line">| ACME        | Carrots        |       2.50 |</span><br><span class="line">| ACME        | Detonator      |      13.00 |</span><br><span class="line">| ACME        | Safe           |      50.00 |</span><br><span class="line">| ACME        | Sling          |       4.49 |</span><br><span class="line">| ACME        | TNT (1 stick)  |       2.50 |</span><br><span class="line">| ACME        | TNT (5 sticks) |      10.00 |</span><br><span class="line">| Anvils R Us | .5 ton anvil   |       5.99 |</span><br><span class="line">| Anvils R Us | 1 ton anvil    |       9.99 |</span><br><span class="line">| Anvils R Us | 2 ton anvil    |      14.99 |</span><br><span class="line">| Jet Set     | JetPack 1000   |      35.00 |</span><br><span class="line">| Jet Set     | JetPack 2000   |      55.00 |</span><br><span class="line">| LT Supplies | Fuses          |       3.42 |</span><br><span class="line">| LT Supplies | Oil can        |       8.99 |</span><br><span class="line">+-------------+----------------+------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>å®Œå…¨é™å®šåˆ—å</strong> åœ¨å¼•ç”¨çš„åˆ—å¯èƒ½å‡ºç°äºŒä¹‰æ€§æ—¶,å¿…é¡»ä½¿ç”¨å®Œå…¨é™å®šåˆ—å(ç”¨ä¸€ä¸ªç‚¹åˆ†éš”çš„è¡¨åå’Œåˆ—å)ã€‚å¦‚æœå¼•ç”¨ä¸€ä¸ªæ²¡æœ‰ç”¨è¡¨åé™åˆ¶çš„å…·æœ‰äºŒä¹‰æ€§çš„åˆ—å,MySQLå°†è¿”å›é”™è¯¯ã€‚</p>
<p>1.WHEREå­å¥çš„é‡è¦æ€§</p>
<p>åˆ©ç”¨ WHERE å­å¥å»ºç«‹è”ç»“å…³ç³»ä¼¼ä¹æœ‰ç‚¹å¥‡æ€ª,ä½†å®é™…ä¸Š,æœ‰ä¸€ä¸ªå¾ˆå……åˆ†çš„ç†ç”±ã€‚è¯·è®°ä½,åœ¨ä¸€æ¡ SELECT è¯­å¥ä¸­è”ç»“å‡ ä¸ªè¡¨æ—¶,ç›¸åº”çš„å…³ç³»æ˜¯åœ¨è¿è¡Œä¸­æ„é€ çš„ã€‚åœ¨æ•°æ®åº“è¡¨çš„å®šä¹‰ä¸­ä¸å­˜åœ¨èƒ½æŒ‡ç¤ºMySQLå¦‚ä½•å¯¹è¡¨è¿›è¡Œè”ç»“çš„ä¸œè¥¿ã€‚ä½ å¿…é¡»è‡ªå·±åšè¿™ä»¶äº‹æƒ…ã€‚åœ¨è”ç»“ä¸¤ä¸ªè¡¨æ—¶,ä½ å®é™…ä¸Šåšçš„æ˜¯å°†ç¬¬ä¸€ä¸ªè¡¨ä¸­çš„æ¯ä¸€è¡Œä¸ç¬¬äºŒä¸ªè¡¨ä¸­çš„æ¯ä¸€è¡Œé…å¯¹ã€‚ WHERE å­å¥ä½œä¸ºè¿‡æ»¤æ¡ä»¶,å®ƒåªåŒ…å«é‚£äº›åŒ¹é…ç»™å®šæ¡ä»¶(è¿™é‡Œæ˜¯è”ç»“æ¡ä»¶)çš„è¡Œã€‚æ²¡æœ‰WHERE å­å¥,ç¬¬ä¸€ä¸ªè¡¨ä¸­çš„æ¯ä¸ªè¡Œå°†ä¸ç¬¬äºŒä¸ªè¡¨ä¸­çš„æ¯ä¸ªè¡Œé…å¯¹,è€Œä¸ç®¡å®ƒä»¬é€»è¾‘ä¸Šæ˜¯å¦å¯ä»¥é…åœ¨ä¸€èµ·ã€‚</p>
<p><strong>ç¬›å¡å„¿ç§¯(cartesian product)</strong> ç”±æ²¡æœ‰è”ç»“æ¡ä»¶çš„è¡¨å…³ç³»è¿”å›çš„ç»“æœä¸ºç¬›å¡å„¿ç§¯ã€‚æ£€ç´¢å‡ºçš„è¡Œçš„æ•°ç›®å°†æ˜¯ç¬¬ä¸€ä¸ªè¡¨ä¸­çš„è¡Œæ•°ä¹˜ä»¥ç¬¬äºŒä¸ªè¡¨ä¸­çš„è¡Œæ•°ã€‚</p>
<p>ä¸ºç†è§£è¿™ä¸€ç‚¹,è¯·çœ‹ä¸‹é¢çš„ SELECT è¯­å¥åŠå…¶è¾“å‡º:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select vend_name,prod_name,prod_price from vendors,products order by vend_name,prod_name;</span><br><span class="line">+----------------+----------------+------------+</span><br><span class="line">| vend_name      | prod_name      | prod_price |</span><br><span class="line">+----------------+----------------+------------+</span><br><span class="line">| ACME           | .5 ton anvil   |       5.99 |</span><br><span class="line">| ACME           | 1 ton anvil    |       9.99 |</span><br><span class="line">| ACME           | 2 ton anvil    |      14.99 |</span><br><span class="line">| ACME           | Bird seed      |      10.00 |</span><br><span class="line">| ACME           | Carrots        |       2.50 |</span><br><span class="line">| ACME           | Detonator      |      13.00 |</span><br><span class="line">| ACME           | Fuses          |       3.42 |</span><br><span class="line">| ACME           | JetPack 1000   |      35.00 |</span><br><span class="line">| ACME           | JetPack 2000   |      55.00 |</span><br><span class="line">| ACME           | Oil can        |       8.99 |</span><br><span class="line">| ACME           | Safe           |      50.00 |</span><br><span class="line">| ACME           | Sling          |       4.49 |</span><br><span class="line">| ACME           | TNT (1 stick)  |       2.50 |</span><br><span class="line">| ACME           | TNT (5 sticks) |      10.00 |</span><br><span class="line">| Anvils R Us    | .5 ton anvil   |       5.99 |</span><br><span class="line">| Anvils R Us    | 1 ton anvil    |       9.99 |</span><br><span class="line">| Anvils R Us    | 2 ton anvil    |      14.99 |</span><br><span class="line">| Anvils R Us    | Bird seed      |      10.00 |</span><br><span class="line">| Anvils R Us    | Carrots        |       2.50 |</span><br><span class="line">| Anvils R Us    | Detonator      |      13.00 |</span><br><span class="line">| Anvils R Us    | Fuses          |       3.42 |</span><br><span class="line">| Anvils R Us    | JetPack 1000   |      35.00 |</span><br><span class="line">| Anvils R Us    | JetPack 2000   |      55.00 |</span><br><span class="line">| Anvils R Us    | Oil can        |       8.99 |</span><br><span class="line">| Anvils R Us    | Safe           |      50.00 |</span><br><span class="line">| Anvils R Us    | Sling          |       4.49 |</span><br><span class="line">| Anvils R Us    | TNT (1 stick)  |       2.50 |</span><br><span class="line">| Anvils R Us    | TNT (5 sticks) |      10.00 |</span><br><span class="line">| Furball Inc.   | .5 ton anvil   |       5.99 |</span><br><span class="line">| Furball Inc.   | 1 ton anvil    |       9.99 |</span><br><span class="line">| Furball Inc.   | 2 ton anvil    |      14.99 |</span><br><span class="line">| Furball Inc.   | Bird seed      |      10.00 |</span><br><span class="line">| Furball Inc.   | Carrots        |       2.50 |</span><br><span class="line">| Furball Inc.   | Detonator      |      13.00 |</span><br><span class="line">| Furball Inc.   | Fuses          |       3.42 |</span><br><span class="line">| Furball Inc.   | JetPack 1000   |      35.00 |</span><br><span class="line">| Furball Inc.   | JetPack 2000   |      55.00 |</span><br><span class="line">| Furball Inc.   | Oil can        |       8.99 |</span><br><span class="line">| Furball Inc.   | Safe           |      50.00 |</span><br><span class="line">| Furball Inc.   | Sling          |       4.49 |</span><br><span class="line">| Furball Inc.   | TNT (1 stick)  |       2.50 |</span><br><span class="line">| Furball Inc.   | TNT (5 sticks) |      10.00 |</span><br><span class="line">| Jet Set        | .5 ton anvil   |       5.99 |</span><br><span class="line">| Jet Set        | 1 ton anvil    |       9.99 |</span><br><span class="line">| Jet Set        | 2 ton anvil    |      14.99 |</span><br><span class="line">| Jet Set        | Bird seed      |      10.00 |</span><br><span class="line">| Jet Set        | Carrots        |       2.50 |</span><br><span class="line">| Jet Set        | Detonator      |      13.00 |</span><br><span class="line">| Jet Set        | Fuses          |       3.42 |</span><br><span class="line">| Jet Set        | JetPack 1000   |      35.00 |</span><br><span class="line">| Jet Set        | JetPack 2000   |      55.00 |</span><br><span class="line">| Jet Set        | Oil can        |       8.99 |</span><br><span class="line">| Jet Set        | Safe           |      50.00 |</span><br><span class="line">| Jet Set        | Sling          |       4.49 |</span><br><span class="line">| Jet Set        | TNT (1 stick)  |       2.50 |</span><br><span class="line">| Jet Set        | TNT (5 sticks) |      10.00 |</span><br><span class="line">| Jouets Et Ours | .5 ton anvil   |       5.99 |</span><br><span class="line">| Jouets Et Ours | 1 ton anvil    |       9.99 |</span><br><span class="line">| Jouets Et Ours | 2 ton anvil    |      14.99 |</span><br><span class="line">| Jouets Et Ours | Bird seed      |      10.00 |</span><br><span class="line">| Jouets Et Ours | Carrots        |       2.50 |</span><br><span class="line">| Jouets Et Ours | Detonator      |      13.00 |</span><br><span class="line">| Jouets Et Ours | Fuses          |       3.42 |</span><br><span class="line">| Jouets Et Ours | JetPack 1000   |      35.00 |</span><br><span class="line">| Jouets Et Ours | JetPack 2000   |      55.00 |</span><br><span class="line">| Jouets Et Ours | Oil can        |       8.99 |</span><br><span class="line">| Jouets Et Ours | Safe           |      50.00 |</span><br><span class="line">| Jouets Et Ours | Sling          |       4.49 |</span><br><span class="line">| Jouets Et Ours | TNT (1 stick)  |       2.50 |</span><br><span class="line">| Jouets Et Ours | TNT (5 sticks) |      10.00 |</span><br><span class="line">| LT Supplies    | .5 ton anvil   |       5.99 |</span><br><span class="line">| LT Supplies    | 1 ton anvil    |       9.99 |</span><br><span class="line">| LT Supplies    | 2 ton anvil    |      14.99 |</span><br><span class="line">| LT Supplies    | Bird seed      |      10.00 |</span><br><span class="line">| LT Supplies    | Carrots        |       2.50 |</span><br><span class="line">| LT Supplies    | Detonator      |      13.00 |</span><br><span class="line">| LT Supplies    | Fuses          |       3.42 |</span><br><span class="line">| LT Supplies    | JetPack 1000   |      35.00 |</span><br><span class="line">| LT Supplies    | JetPack 2000   |      55.00 |</span><br><span class="line">| LT Supplies    | Oil can        |       8.99 |</span><br><span class="line">| LT Supplies    | Safe           |      50.00 |</span><br><span class="line">| LT Supplies    | Sling          |       4.49 |</span><br><span class="line">| LT Supplies    | TNT (1 stick)  |       2.50 |</span><br><span class="line">| LT Supplies    | TNT (5 sticks) |      10.00 |</span><br><span class="line">+----------------+----------------+------------+</span><br><span class="line">84 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°,ç›¸åº”çš„ç¬›å¡å„¿ç§¯ä¸æ˜¯æˆ‘ä»¬æ‰€æƒ³è¦çš„ã€‚è¿™é‡Œè¿”å›çš„æ•°æ®ç”¨æ¯ä¸ªä¾›åº”å•†åŒ¹é…äº†æ¯ä¸ªäº§å“,å®ƒåŒ…æ‹¬äº†ä¾›åº”å•†ä¸æ­£ç¡®çš„äº§å“ã€‚å®é™…ä¸Šæœ‰çš„ä¾›åº”å•†æ ¹æœ¬å°±æ²¡æœ‰äº§å“ã€‚</p>
<p>åˆ†æ</p>
<p><strong>ä¸è¦å¿˜äº† WHERE å­å¥</strong> åº”è¯¥ä¿è¯æ‰€æœ‰è”ç»“éƒ½æœ‰ WHERE å­å¥,å¦åˆ™MySQLå°†è¿”å›æ¯”æƒ³è¦çš„æ•°æ®å¤šå¾—å¤šçš„æ•°æ®ã€‚åŒç†,åº”è¯¥ä¿è¯ WHERE å­å¥çš„æ­£ç¡®æ€§ã€‚ä¸æ­£ç¡®çš„è¿‡æ»¤æ¡ä»¶å°†å¯¼è‡´MySQLè¿”å›ä¸æ­£ç¡®çš„æ•°æ®ã€‚</p>
<p><strong>å‰è”ç»“</strong> æœ‰æ—¶æˆ‘ä»¬ä¼šå¬åˆ°è¿”å›ç§°ä¸ºå‰è”ç»“(cross join)çš„ç¬›å¡å„¿ç§¯çš„è”ç»“ç±»å‹</p>
<p>2.å†…éƒ¨è”ç»“</p>
<p>ç›®å‰ä¸ºæ­¢æ‰€ç”¨çš„è”ç»“ç§°ä¸ºç­‰å€¼è”ç»“(equijoin),å®ƒåŸºäºä¸¤ä¸ªè¡¨ä¹‹é—´çš„<br>ç›¸ç­‰æµ‹è¯•ã€‚è¿™ç§è”ç»“ä¹Ÿç§°ä¸ºå†…éƒ¨è”ç»“ã€‚å…¶å®,å¯¹äºè¿™ç§è”ç»“å¯ä»¥ä½¿ç”¨ç¨<br>å¾®ä¸åŒçš„è¯­æ³•æ¥æ˜ç¡®æŒ‡å®šè”ç»“çš„ç±»å‹ã€‚ä¸‹é¢çš„ SELECT è¯­å¥è¿”å›ä¸å‰é¢ä¾‹<br>å­å®Œå…¨ç›¸åŒçš„æ•°æ®:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select vend_name,prod_name,prod_price from vendors inner join products on vendors.vend_id = products.vend_id;</span><br><span class="line">+-------------+----------------+------------+</span><br><span class="line">| vend_name   | prod_name      | prod_price |</span><br><span class="line">+-------------+----------------+------------+</span><br><span class="line">| Anvils R Us | .5 ton anvil   |       5.99 |</span><br><span class="line">| Anvils R Us | 1 ton anvil    |       9.99 |</span><br><span class="line">| Anvils R Us | 2 ton anvil    |      14.99 |</span><br><span class="line">| LT Supplies | Fuses          |       3.42 |</span><br><span class="line">| LT Supplies | Oil can        |       8.99 |</span><br><span class="line">| ACME        | Detonator      |      13.00 |</span><br><span class="line">| ACME        | Bird seed      |      10.00 |</span><br><span class="line">| ACME        | Carrots        |       2.50 |</span><br><span class="line">| ACME        | Safe           |      50.00 |</span><br><span class="line">| ACME        | Sling          |       4.49 |</span><br><span class="line">| ACME        | TNT (1 stick)  |       2.50 |</span><br><span class="line">| ACME        | TNT (5 sticks) |      10.00 |</span><br><span class="line">| Jet Set     | JetPack 1000   |      35.00 |</span><br><span class="line">| Jet Set     | JetPack 2000   |      55.00 |</span><br><span class="line">+-------------+----------------+------------+</span><br><span class="line">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ­¤è¯­å¥ä¸­çš„ <code>SELECT</code> ä¸å‰é¢çš„<code>SELECT</code> è¯­å¥ç›¸åŒ,ä½† <code>FROM</code> å­å¥ä¸åŒã€‚è¿™é‡Œ,ä¸¤ä¸ªè¡¨ä¹‹é—´çš„å…³ç³»æ˜¯ <code>FROM</code> å­å¥çš„ç»„æˆéƒ¨åˆ†,ä»¥ <code>INNER JOIN</code> æŒ‡å®šã€‚åœ¨ä½¿ç”¨è¿™ç§è¯­æ³•æ—¶,è”ç»“æ¡ä»¶ç”¨ç‰¹å®šçš„ <code>ON</code> å­å¥è€Œä¸æ˜¯ <code>WHERE</code>å­å¥ç»™å‡ºã€‚ä¼ é€’ç»™ <code>ON</code> çš„å®é™…æ¡ä»¶ä¸ä¼ é€’ç»™ <code>WHERE</code> çš„ç›¸åŒã€‚</p>
<p><strong>ä½¿ç”¨å“ªç§è¯­æ³•</strong> ANSI SQLè§„èŒƒé¦–é€‰ <code>INNER JOIN</code> è¯­æ³•ã€‚æ­¤å¤–,å°½ç®¡ä½¿ç”¨ <code>WHERE</code> å­å¥å®šä¹‰è”ç»“çš„ç¡®æ¯”è¾ƒç®€å•,ä½†æ˜¯ä½¿ç”¨æ˜ç¡®çš„è”ç»“è¯­æ³•èƒ½å¤Ÿç¡®ä¿ä¸ä¼šå¿˜è®°è”ç»“æ¡ä»¶,æœ‰æ—¶å€™è¿™æ ·åšä¹Ÿèƒ½å½±å“æ€§èƒ½ã€‚</p>
<p>3.è”ç»“å¤šä¸ªè¡¨</p>
<p>SQLå¯¹ä¸€æ¡ SELECT è¯­å¥ä¸­å¯ä»¥è”ç»“çš„è¡¨çš„æ•°ç›®æ²¡æœ‰é™åˆ¶ã€‚åˆ›å»ºè”ç»“çš„åŸºæœ¬è§„åˆ™ä¹Ÿç›¸åŒã€‚é¦–å…ˆåˆ—å‡ºæ‰€æœ‰è¡¨,ç„¶åå®šä¹‰è¡¨ä¹‹é—´çš„å…³ç³»ã€‚ä¾‹å¦‚:</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢å‡ºè®¢å•å·ä¸º20005çš„æ‰€æœ‰å•†å“çš„å•†å“åç§°ï¼Œå•†å“çš„ä¾›åº”å•†åç§°ï¼Œå•†å“çš„ä»·æ ¼ï¼Œå•†å“çš„æ•°é‡ï¼ˆ<code>prod_name,vend_name,prod_price,quantit</code>ï¼‰ã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_name,vend_name,prod_price,quantity from orderitems,products,vendors where products.vend_id = vendors.vend_id and orderitems.prod_id  = products.prod_id and order_num = 20005;</span><br><span class="line">+----------------+-------------+------------+----------+</span><br><span class="line">| prod_name      | vend_name   | prod_price | quantity |</span><br><span class="line">+----------------+-------------+------------+----------+</span><br><span class="line">| .5 ton anvil   | Anvils R Us |       5.99 |       10 |</span><br><span class="line">| 1 ton anvil    | Anvils R Us |       9.99 |        3 |</span><br><span class="line">| TNT (5 sticks) | ACME        |      10.00 |        5 |</span><br><span class="line">| Bird seed      | ACME        |      10.00 |        1 |</span><br><span class="line">+----------------+-------------+------------+----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ­¤ä¾‹å­æ˜¾ç¤ºç¼–å·ä¸º 20005 çš„è®¢å•ä¸­çš„ç‰©å“ã€‚è®¢å•ç‰©å“å­˜å‚¨åœ¨orderitems è¡¨ä¸­ã€‚æ¯ä¸ªäº§å“æŒ‰å…¶äº§å“IDå­˜å‚¨,å®ƒå¼•ç”¨ productsè¡¨ä¸­çš„äº§å“ã€‚è¿™äº›äº§å“é€šè¿‡ä¾›åº”å•†IDè”ç»“åˆ° vendors è¡¨ä¸­ç›¸åº”çš„ä¾›åº”å•†,ä¾›åº”å•†IDå­˜å‚¨åœ¨æ¯ä¸ªäº§å“çš„è®°å½•ä¸­ã€‚è¿™é‡Œçš„ FROM å­å¥åˆ—å‡ºäº†3ä¸ªè¡¨,è€ŒWHERE å­å¥å®šä¹‰äº†è¿™ä¸¤ä¸ªè”ç»“æ¡ä»¶,è€Œç¬¬ä¸‰ä¸ªè”ç»“æ¡ä»¶ç”¨æ¥è¿‡æ»¤å‡ºè®¢å•20005 ä¸­çš„ç‰©å“ã€‚</p>
<p><strong>æ€§èƒ½è€ƒè™‘</strong> MySQLåœ¨è¿è¡Œæ—¶å…³è”æŒ‡å®šçš„æ¯ä¸ªè¡¨ä»¥å¤„ç†è”ç»“ã€‚è¿™ç§å¤„ç†å¯èƒ½æ˜¯éå¸¸è€—è´¹èµ„æºçš„,å› æ­¤åº”è¯¥ä»”ç»†,ä¸è¦è”ç»“ä¸å¿…è¦çš„è¡¨ã€‚è”ç»“çš„è¡¨è¶Šå¤š,æ€§èƒ½ä¸‹é™è¶Šå‰å®³ã€‚</p>
<p>ç°åœ¨å¯ä»¥å›é¡¾ä¸€ä¸‹å‰é¢ç« ä¸­çš„ä¾‹å­äº†ã€‚è¯¥ä¾‹å­å¦‚ä¸‹æ‰€ç¤º</p>
<blockquote>
<blockquote>
<p>è¿”å›è®¢è´­äº§å“ TNT2 çš„å®¢æˆ·åˆ—è¡¨</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select cust_name from customers where cust_id in (select cust_id from orders where order_num in (select order_num from orderitems where prod_id='TNT2'));</span><br><span class="line">+----------------+</span><br><span class="line">| cust_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| Coyote Inc.    |</span><br><span class="line">| Yosemite Place |</span><br><span class="line">+----------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>å­æŸ¥è¯¢å¹¶ä¸æ€»æ˜¯æ‰§è¡Œå¤æ‚ SELECT æ“ä½œçš„æœ€æœ‰æ•ˆçš„æ–¹æ³•,ä¸‹é¢æ˜¯ä½¿ç”¨è”ç»“çš„ç›¸åŒæŸ¥è¯¢:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select cust_name from customers where cust_id in (select cust_id from orders where order_num in (select order_num from orderitems where prod_id='TNT2'));</span><br><span class="line">+----------------+</span><br><span class="line">| cust_name      |</span><br><span class="line">+----------------+</span><br><span class="line">| Coyote Inc.    |</span><br><span class="line">| Yosemite Place |</span><br><span class="line">+----------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæŸ¥è¯¢ä¸­è¿”å›æ•°æ®éœ€è¦ä½¿ç”¨3ä¸ªè¡¨ã€‚ä½†è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰åœ¨åµŒå¥—å­æŸ¥è¯¢ä¸­ä½¿ç”¨å®ƒä»¬,è€Œæ˜¯ä½¿ç”¨äº†ä¸¤ä¸ªè”ç»“ã€‚è¿™é‡Œæœ‰3ä¸ª WHERE å­å¥æ¡ä»¶ã€‚å‰ä¸¤ä¸ªå…³è”è”ç»“ä¸­çš„è¡¨,åä¸€ä¸ªè¿‡æ»¤äº§å“ TNT2çš„æ•°æ®ã€‚</p>
<p><strong>å¤šåšå®éªŒ</strong> æ­£å¦‚æ‰€è§,ä¸ºæ‰§è¡Œä»»ä¸€ç»™å®šçš„SQLæ“ä½œ,ä¸€èˆ¬å­˜åœ¨ä¸æ­¢ä¸€ç§æ–¹æ³•ã€‚å¾ˆå°‘æœ‰ç»å¯¹æ­£ç¡®æˆ–ç»å¯¹é”™è¯¯çš„æ–¹æ³•ã€‚æ€§èƒ½å¯èƒ½ä¼šå—æ“ä½œç±»å‹ã€è¡¨ä¸­æ•°æ®é‡ã€æ˜¯å¦å­˜åœ¨ç´¢å¼•æˆ–é”®ä»¥åŠå…¶ä»–ä¸€äº›æ¡ä»¶çš„å½±å“ã€‚å› æ­¤,æœ‰å¿…è¦å¯¹ä¸åŒçš„é€‰æ‹©æœºåˆ¶è¿›è¡Œå®éªŒ,ä»¥æ‰¾å‡ºæœ€é€‚åˆå…·ä½“æƒ…å†µçš„æ–¹æ³•ã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>è”ç»“æ˜¯SQLä¸­æœ€é‡è¦æœ€å¼ºå¤§çš„ç‰¹æ€§,æœ‰æ•ˆåœ°ä½¿ç”¨è”ç»“éœ€è¦å¯¹å…³ç³»æ•°æ®åº“è®¾è®¡æœ‰åŸºæœ¬çš„äº†è§£ã€‚æœ¬ç« éšç€å¯¹è”ç»“çš„ä»‹ç»è®²è¿°äº†å…³ç³»æ•°æ®åº“è®¾è®¡çš„ä¸€äº›åŸºæœ¬çŸ¥è¯†,åŒ…æ‹¬ç­‰å€¼è”ç»“(ä¹Ÿç§°ä¸ºå†…éƒ¨è”ç»“)è¿™ç§æœ€ç»å¸¸ä½¿ç”¨çš„è”ç»“å½¢å¼ã€‚ä¸‹ä¸€ç« å°†ä»‹ç»å¦‚ä½•åˆ›å»ºå…¶ä»–ç±»å‹çš„è”ç»“ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="åˆ›å»ºé«˜çº§è”ç»“"><a href="#åˆ›å»ºé«˜çº§è”ç»“" class="headerlink" title="åˆ›å»ºé«˜çº§è”ç»“"></a>åˆ›å»ºé«˜çº§è”ç»“</h4><p>æœ¬ç« å°†è®²è§£å¦å¤–ä¸€äº›è”ç»“ç±»å‹(åŒ…æ‹¬å®ƒä»¬çš„å«ä¹‰å’Œä½¿ç”¨æ–¹æ³•),ä»‹ç»å¦‚ä½•å¯¹è¢«è”ç»“çš„è¡¨ä½¿ç”¨è¡¨åˆ«åå’Œèšé›†å‡½æ•°ã€‚</p>
<blockquote>
<p>ä½¿ç”¨è¡¨åˆ«å</p>
</blockquote>
<p>å‰é¢ç« èŠ‚ä¸­ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨åˆ«åå¼•ç”¨è¢«æ£€ç´¢çš„è¡¨åˆ—ã€‚ç»™åˆ—èµ·åˆ«åçš„è¯­æ³•å¦‚ä¸‹:</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢å‡ºä¾›åº”å•†çš„åå­—å’Œå›½å®¶ï¼Œå¹¶ä»¥æŒ‡å®šæ ¼å¼æ˜¾ç¤ºã€<code>vend_name</code>(<code>vend_country</code>)ã€‘</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select concat(rtrim(vend_name),'(',rtrim(vend_country),')') as vend_tile from vendors order by vend_name;</span><br><span class="line">+------------------------+</span><br><span class="line">| vend_tile              |</span><br><span class="line">+------------------------+</span><br><span class="line">| ACME(USA)              |</span><br><span class="line">| Anvils R Us(USA)       |</span><br><span class="line">| Furball Inc.(USA)      |</span><br><span class="line">| Jet Set(England)       |</span><br><span class="line">| Jouets Et Ours(France) |</span><br><span class="line">| LT Supplies(USA)       |</span><br><span class="line">+------------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>åˆ«åé™¤äº†ç”¨äºåˆ—åå’Œè®¡ç®—å­—æ®µå¤–, SQLè¿˜å…è®¸ç»™è¡¨åèµ·åˆ«åã€‚è¿™æ ·åšæœ‰ä¸¤ä¸ªä¸»è¦ç†ç”±:</p>
<ul>
<li>ç¼©çŸ­SQLè¯­å¥;</li>
<li>å…è®¸åœ¨å•æ¡ SELECT è¯­å¥ä¸­å¤šæ¬¡ä½¿ç”¨ç›¸åŒçš„è¡¨ã€‚</li>
</ul>
<p>è¯·çœ‹ä¸‹é¢çš„ SELECT è¯­å¥ã€‚å®ƒä¸å‰ä¸€ç« çš„ä¾‹å­ä¸­æ‰€ç”¨çš„è¯­å¥åŸºæœ¬ç›¸åŒ,<br>ä½†æ”¹æˆäº†ä½¿ç”¨åˆ«å:</p>
<blockquote>
<blockquote>
<p>è¿”å›è®¢è´­äº§å“ TNT2 çš„å®¢æˆ·åˆ—è¡¨</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select cust_name,cust_contact from customers as c,orders as o,orderitems as oi where c.cust_id = o.cust_id and oi.order_num = o.order_num and prod_id = 'TNT2';</span><br><span class="line">+----------------+--------------+</span><br><span class="line">| cust_name      | cust_contact |</span><br><span class="line">+----------------+--------------+</span><br><span class="line">| Coyote Inc.    | Y Lee        |</span><br><span class="line">| Yosemite Place | Y Sam        |</span><br><span class="line">+----------------+--------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°, FROM å­å¥ä¸­3ä¸ªè¡¨å…¨éƒ½å…·æœ‰åˆ«åã€‚ customers AS c å»ºç«‹ c ä½œä¸º customers çš„åˆ«å,ç­‰ç­‰ã€‚è¿™ä½¿å¾—èƒ½ä½¿ç”¨çœå†™çš„ c è€Œä¸æ˜¯å…¨å customers ã€‚åœ¨æ­¤ä¾‹å­ä¸­,è¡¨åˆ«ååªç”¨äº WHERE å­å¥ã€‚ä½†æ˜¯,è¡¨åˆ«åä¸ä»…èƒ½ç”¨äº WHERE å­å¥,å®ƒè¿˜å¯ä»¥ç”¨äº SELECT çš„åˆ—è¡¨ã€ ORDER BY å­å¥ä»¥åŠè¯­å¥çš„å…¶ä»–éƒ¨åˆ†ã€‚</p>
<p>åº”è¯¥æ³¨æ„,è¡¨åˆ«ååªåœ¨æŸ¥è¯¢æ‰§è¡Œä¸­ä½¿ç”¨ã€‚ä¸åˆ—åˆ«åä¸ä¸€æ ·,è¡¨åˆ«åä¸è¿”å›åˆ°å®¢æˆ·æœºã€‚</p>
<blockquote>
<p>ä½¿ç”¨ä¸åŒç±»å‹çš„è”ç»“</p>
</blockquote>
<p>è¿„ä»Šä¸ºæ­¢,æˆ‘ä»¬ä½¿ç”¨çš„åªæ˜¯ç§°ä¸ºå†…éƒ¨è”ç»“æˆ–ç­‰å€¼è”ç»“(equijoin)çš„ç®€å•è”ç»“ã€‚ç°åœ¨æ¥çœ‹3ç§å…¶ä»–è”ç»“,å®ƒä»¬åˆ†åˆ«æ˜¯è‡ªè”ç»“ã€è‡ªç„¶è”ç»“å’Œå¤–éƒ¨è”ç»“ã€‚</p>
<p>1.è‡ªè”ç»“</p>
<p>å¦‚å‰æ‰€è¿°,ä½¿ç”¨è¡¨åˆ«åçš„ä¸»è¦åŸå› ä¹‹ä¸€æ˜¯èƒ½åœ¨å•æ¡ SELECT è¯­å¥ä¸­ä¸æ­¢ä¸€æ¬¡å¼•ç”¨ç›¸åŒçš„è¡¨ã€‚ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­ã€‚</p>
<p>å‡å¦‚ä½ å‘ç°æŸç‰©å“(å…¶IDä¸º DTNTR )å­˜åœ¨é—®é¢˜,å› æ­¤æƒ³çŸ¥é“ç”Ÿäº§è¯¥ç‰©å“çš„ä¾›åº”å•†ç”Ÿäº§çš„å…¶ä»–ç‰©å“æ˜¯å¦ä¹Ÿå­˜åœ¨è¿™äº›é—®é¢˜ã€‚æ­¤æŸ¥è¯¢è¦æ±‚é¦–å…ˆæ‰¾åˆ°ç”Ÿäº§IDä¸º DTNTR çš„ç‰©å“çš„ä¾›åº”å•†,ç„¶åæ‰¾å‡ºè¿™ä¸ªä¾›åº”å•†ç”Ÿäº§çš„å…¶ä»–ç‰©å“ã€‚</p>
<p>ä¸‹é¢æ˜¯è§£å†³æ­¤é—®é¢˜çš„ä¸€ç§æ–¹æ³•:</p>
<blockquote>
<blockquote>
<p>æŸ¥æ‰¾å•†å“  <code>prod_id =&#39;DTNTR&#39;</code> çš„ä¾›åº”å•†ç”Ÿäº§çš„å•†å“åå’Œidå·<code>prod_id,prod_name</code></p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select prod_id,prod_name from products where vend_id = (select vend_id from products where prod_id ='DTNTR');</span><br><span class="line">+---------+----------------+</span><br><span class="line">| prod_id | prod_name      |</span><br><span class="line">+---------+----------------+</span><br><span class="line">| DTNTR   | Detonator      |</span><br><span class="line">| FB      | Bird seed      |</span><br><span class="line">| FC      | Carrots        |</span><br><span class="line">| SAFE    | Safe           |</span><br><span class="line">| SLING   | Sling          |</span><br><span class="line">| TNT1    | TNT (1 stick)  |</span><br><span class="line">| TNT2    | TNT (5 sticks) |</span><br><span class="line">+---------+----------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆ,å®ƒä½¿ç”¨äº†å­æŸ¥è¯¢ã€‚å†…éƒ¨çš„ <code>SELECT</code> è¯­å¥åšäº†ä¸€ä¸ª ç®€å•çš„æ£€ç´¢ ,è¿”å›ç”Ÿäº§ ID<code>prod_id</code>ä¸º <code>DTNTR</code> çš„ ç‰©å“ä¾›åº”å•† çš„<code>vend_id</code> ã€‚è¯¥IDç”¨äºå¤–éƒ¨æŸ¥è¯¢çš„ <code>WHERE</code> å­å¥ä¸­,ä»¥ä¾¿æ£€ç´¢å‡ºè¿™ä¸ªä¾›åº”å•†ç”Ÿäº§çš„æ‰€æœ‰ç‰©å“</p>
<p>ç°åœ¨æ¥çœ‹ä½¿ç”¨è”ç»“çš„ç›¸åŒæŸ¥è¯¢:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select p1.prod_id,p1.prod_name from products as p1,products as p2 where p1.vend_id = p2.vend_id and p2.prod_id = 'DTNTR';</span><br><span class="line">+---------+----------------+</span><br><span class="line">| prod_id | prod_name      |</span><br><span class="line">+---------+----------------+</span><br><span class="line">| DTNTR   | Detonator      |</span><br><span class="line">| FB      | Bird seed      |</span><br><span class="line">| FC      | Carrots        |</span><br><span class="line">| SAFE    | Safe           |</span><br><span class="line">| SLING   | Sling          |</span><br><span class="line">| TNT1    | TNT (1 stick)  |</span><br><span class="line">| TNT2    | TNT (5 sticks) |</span><br><span class="line">+---------+----------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ­¤æŸ¥è¯¢ä¸­éœ€è¦çš„ä¸¤ä¸ªè¡¨å®é™…ä¸Šæ˜¯ç›¸åŒçš„è¡¨,å› æ­¤ <code>products</code> è¡¨åœ¨<code>FROM</code> å­å¥ä¸­å‡ºç°äº†ä¸¤æ¬¡ã€‚è™½ç„¶è¿™æ˜¯å®Œå…¨åˆæ³•çš„,ä½†å¯¹ <code>products</code>çš„å¼•ç”¨å…·æœ‰äºŒä¹‰æ€§,å› ä¸ºMySQLä¸çŸ¥é“ä½ å¼•ç”¨çš„æ˜¯ <code>products</code> è¡¨ä¸­çš„å“ªä¸ªå®ä¾‹ã€‚</p>
<p>ä¸ºè§£å†³æ­¤é—®é¢˜,ä½¿ç”¨äº†è¡¨åˆ«åã€‚ <code>products</code> çš„ç¬¬ä¸€æ¬¡å‡ºç°ä¸ºåˆ«å <code>p1</code> ,ç¬¬äºŒæ¬¡å‡ºç°ä¸ºåˆ«å <code>p2</code>ã€‚ç°åœ¨å¯ä»¥å°†è¿™äº›åˆ«åç”¨ä½œè¡¨åã€‚ä¾‹å¦‚, <code>SELECT</code>è¯­å¥ä½¿ç”¨ <code>p1</code> å‰ç¼€æ˜ç¡®åœ°ç»™å‡ºæ‰€éœ€åˆ—çš„å…¨åã€‚å¦‚æœä¸è¿™æ ·,<code>MySQL</code>å°†è¿”å›é”™è¯¯,å› ä¸ºåˆ†åˆ«å­˜åœ¨ä¸¤ä¸ªåä¸º<code>prod_id</code> ã€ <code>prod_name</code> çš„åˆ—ã€‚MySQLä¸çŸ¥é“æƒ³è¦çš„æ˜¯å“ªä¸€ä¸ªåˆ—(å³ä½¿å®ƒä»¬äº‹å®ä¸Šæ˜¯åŒä¸€ä¸ªåˆ—)ã€‚ <code>WHERE</code> (é€šè¿‡åŒ¹é… <code>p1</code> ä¸­çš„ <code>vend_id</code> å’Œ <code>p2</code> ä¸­çš„ <code>vend_id</code> )é¦–å…ˆè”ç»“ä¸¤ä¸ªè¡¨,ç„¶åæŒ‰ç¬¬äºŒä¸ªè¡¨ä¸­çš„<code>prod_id</code> è¿‡æ»¤æ•°æ®,è¿”å›æ‰€éœ€çš„æ•°æ®ã€‚</p>
<p><strong>ç”¨è‡ªè”ç»“è€Œä¸ç”¨å­æŸ¥è¯¢</strong> è‡ªè”ç»“é€šå¸¸ä½œä¸ºå¤–éƒ¨è¯­å¥ç”¨æ¥æ›¿ä»£ä»ç›¸åŒè¡¨ä¸­æ£€ç´¢æ•°æ®æ—¶ä½¿ç”¨çš„å­æŸ¥è¯¢è¯­å¥ã€‚è™½ç„¶æœ€ç»ˆçš„ç»“æœæ˜¯ç›¸åŒçš„,ä½†æœ‰æ—¶å€™å¤„ç†è”ç»“è¿œæ¯”å¤„ç†å­æŸ¥è¯¢å¿«å¾—å¤šã€‚åº”è¯¥è¯•ä¸€ä¸‹ä¸¤ç§æ–¹æ³•,ä»¥ç¡®å®šå“ªä¸€ç§çš„æ€§èƒ½æ›´å¥½ã€‚</p>
<p>2.è‡ªç„¶è”ç»“</p>
<p>æ— è®ºä½•æ—¶å¯¹è¡¨è¿›è¡Œè”ç»“,åº”è¯¥è‡³å°‘æœ‰ä¸€ä¸ªåˆ—å‡ºç°åœ¨ä¸æ­¢ä¸€ä¸ªè¡¨ä¸­(è¢«è”ç»“çš„åˆ—)ã€‚æ ‡å‡†çš„è”ç»“(å‰ä¸€ç« ä¸­ä»‹ç»çš„å†…éƒ¨è”ç»“)è¿”å›æ‰€æœ‰æ•°æ®,ç”šè‡³ç›¸åŒçš„åˆ—å¤šæ¬¡å‡ºç°ã€‚è‡ªç„¶è”ç»“æ’é™¤å¤šæ¬¡å‡ºç°,ä½¿æ¯ä¸ªåˆ—åªè¿”å›ä¸€æ¬¡ã€‚</p>
<p>æ€æ ·å®Œæˆè¿™é¡¹å·¥ä½œå‘¢?ç­”æ¡ˆæ˜¯,ç³»ç»Ÿä¸å®Œæˆè¿™é¡¹å·¥ä½œ,ç”±ä½ è‡ªå·±å®Œæˆå®ƒã€‚è‡ªç„¶è”ç»“æ˜¯è¿™æ ·ä¸€ç§è”ç»“,å…¶ä¸­ä½ åªèƒ½é€‰æ‹©é‚£äº›å”¯ä¸€çš„åˆ—ã€‚è¿™ä¸€èˆ¬æ˜¯é€šè¿‡å¯¹è¡¨ä½¿ç”¨é€šé…ç¬¦( SELECT * ),å¯¹æ‰€æœ‰å…¶ä»–è¡¨çš„åˆ—ä½¿ç”¨æ˜ç¡®çš„å­é›†æ¥å®Œæˆçš„ã€‚ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select c.*,o.order_num,o.order_date,oi.prod_id,oi.quantity,oi.item_price from customers as c,orders as o,orderitems as oi where c.cust_id=o.cust_id and oi.order_num=o.order_num and prod_id='FB';</span><br><span class="line">+---------+-------------+----------------+-----------+------------+----------+--------------+--------------+-----------------+-----------+---------------------+---------+----------+------------+</span><br><span class="line">| cust_id | cust_name   | cust_address   | cust_city | cust_state | cust_zip | cust_country | cust_contact | cust_email      | order_num | order_date          | prod_id | quantity | item_price |</span><br><span class="line">+---------+-------------+----------------+-----------+------------+----------+--------------+--------------+-----------------+-----------+---------------------+---------+----------+------------+</span><br><span class="line">|   10001 | Coyote Inc. | 200 Maple Lane | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com |     20005 | 2005-09-01 00:00:00 | FB      |        1 |      10.00 |</span><br><span class="line">|   10001 | Coyote Inc. | 200 Maple Lane | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com |     20009 | 2005-10-08 00:00:00 | FB      |        1 |      10.00 |</span><br><span class="line">+---------+-------------+----------------+-----------+------------+----------+--------------+--------------+-----------------+-----------+---------------------+---------+----------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­,é€šé…ç¬¦åªå¯¹ç¬¬ä¸€ä¸ªè¡¨ä½¿ç”¨ã€‚æ‰€æœ‰å…¶ä»–åˆ—æ˜ç¡®åˆ—å‡º,æ‰€ä»¥æ²¡æœ‰é‡å¤çš„åˆ—è¢«æ£€ç´¢å‡ºæ¥ã€‚</p>
<p>äº‹å®ä¸Š,è¿„ä»Šä¸ºæ­¢æˆ‘ä»¬å»ºç«‹çš„æ¯ä¸ªå†…éƒ¨è”ç»“éƒ½æ˜¯è‡ªç„¶è”ç»“,å¾ˆå¯èƒ½æˆ‘ä»¬æ°¸è¿œéƒ½ä¸ä¼šç”¨åˆ°ä¸æ˜¯è‡ªç„¶è”ç»“çš„å†…éƒ¨è”ç»“ã€‚</p>
<p>3.å¤–éƒ¨è”ç»“</p>
<p>è®¸å¤šè”ç»“å°†ä¸€ä¸ªè¡¨ä¸­çš„è¡Œä¸å¦ä¸€ä¸ªè¡¨ä¸­çš„è¡Œç›¸å…³è”ã€‚ä½†æœ‰æ—¶å€™ä¼šéœ€è¦åŒ…å«æ²¡æœ‰å…³è”è¡Œçš„é‚£äº›è¡Œã€‚ä¾‹å¦‚,å¯èƒ½éœ€è¦ä½¿ç”¨è”ç»“æ¥å®Œæˆä»¥ä¸‹å·¥ä½œ:</p>
<ul>
<li>å¯¹æ¯ä¸ªå®¢æˆ·ä¸‹äº†å¤šå°‘è®¢å•è¿›è¡Œè®¡æ•°,åŒ…æ‹¬é‚£äº›è‡³ä»Šå°šæœªä¸‹è®¢å•çš„å®¢æˆ·;</li>
<li>åˆ—å‡ºæ‰€æœ‰äº§å“ä»¥åŠè®¢è´­æ•°é‡,åŒ…æ‹¬æ²¡æœ‰äººè®¢è´­çš„äº§å“;</li>
<li>è®¡ç®—å¹³å‡é”€å”®è§„æ¨¡,åŒ…æ‹¬é‚£äº›è‡³ä»Šå°šæœªä¸‹è®¢å•çš„å®¢æˆ·ã€‚</li>
</ul>
<p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­,è”ç»“åŒ…å«äº†é‚£äº›åœ¨ç›¸å…³è¡¨ä¸­æ²¡æœ‰å…³è”è¡Œçš„è¡Œã€‚è¿™ç§ç±»å‹çš„è”ç»“ç§°ä¸ºå¤–éƒ¨è”ç»“ã€‚</p>
<p>ä¸‹é¢çš„ SELECT è¯­å¥ç»™å‡ºä¸€ä¸ªç®€å•çš„å†…éƒ¨è”ç»“ã€‚</p>
<blockquote>
<blockquote>
<p>å®ƒæ£€ç´¢æ‰€æœ‰å®¢æˆ·åŠå…¶è®¢å•</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select customers.cust_id,orders.order_num from customers inner join orders on customers.cust_id=orders.cust_id;</span><br><span class="line">+---------+-----------+</span><br><span class="line">| cust_id | order_num |</span><br><span class="line">+---------+-----------+</span><br><span class="line">|   10001 |     20005 |</span><br><span class="line">|   10001 |     20009 |</span><br><span class="line">|   10003 |     20006 |</span><br><span class="line">|   10004 |     20007 |</span><br><span class="line">|   10005 |     20008 |</span><br><span class="line">+---------+-----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>å¤–éƒ¨è”ç»“è¯­æ³•ç±»ä¼¼ã€‚ä¸ºäº†æ£€ç´¢æ‰€æœ‰å®¢æˆ·,åŒ…æ‹¬é‚£äº›æ²¡æœ‰è®¢å•çš„å®¢æˆ·,å¯å¦‚ä¸‹è¿›è¡Œ:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select customers.cust_id,orders.order_num from customers left outer join orders on customers.cust_id=orders.cust_id;</span><br><span class="line">+---------+-----------+</span><br><span class="line">| cust_id | order_num |</span><br><span class="line">+---------+-----------+</span><br><span class="line">|   10001 |     20005 |</span><br><span class="line">|   10001 |     20009 |</span><br><span class="line">|   10002 |      NULL |</span><br><span class="line">|   10003 |     20006 |</span><br><span class="line">|   10004 |     20007 |</span><br><span class="line">|   10005 |     20008 |</span><br><span class="line">+---------+-----------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼äºä¸Šä¸€ç« ä¸­æ‰€çœ‹åˆ°çš„å†…éƒ¨è”ç»“,è¿™æ¡ <code>SELECT</code> è¯­å¥ä½¿ç”¨äº†å…³é”®å­— <code>OUTER JOIN</code> æ¥æŒ‡å®šè”ç»“çš„ç±»å‹(è€Œä¸æ˜¯åœ¨ <code>WHERE</code> å­å¥ä¸­æŒ‡å®š)ã€‚ä½†æ˜¯,ä¸å†…éƒ¨è”ç»“å…³è”ä¸¤ä¸ªè¡¨ä¸­çš„è¡Œä¸åŒçš„æ˜¯,å¤–éƒ¨è”ç»“è¿˜åŒ…æ‹¬æ²¡æœ‰å…³è”è¡Œçš„è¡Œã€‚åœ¨ä½¿ç”¨ <code>OUTER JOIN</code> è¯­æ³•æ—¶,å¿…é¡»ä½¿ç”¨ <code>RIGHT</code> æˆ– <code>LEFT</code> å…³é”®å­—æŒ‡å®šåŒ…æ‹¬å…¶æ‰€æœ‰è¡Œçš„è¡¨( <code>RIGHT</code> æŒ‡å‡ºçš„æ˜¯ <code>OUTER JOIN</code> å³è¾¹çš„è¡¨,è€Œ <code>LEFT</code>æŒ‡å‡ºçš„æ˜¯ <code>OUTER JOIN</code> å·¦è¾¹çš„è¡¨)ã€‚</p>
<p>ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨ <code>LEFT OUTER JOIN</code> ä» <code>FROM</code>å­å¥çš„å·¦è¾¹è¡¨( <code>customers</code> è¡¨)ä¸­é€‰æ‹©æ‰€æœ‰è¡Œã€‚ä¸ºäº†ä»å³è¾¹çš„è¡¨ä¸­é€‰æ‹©æ‰€æœ‰è¡Œ,åº”è¯¥ä½¿ç”¨ <code>RIGHT OUTER JOIN</code> ,å¦‚ä¸‹ä¾‹æ‰€ç¤º:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select customers.cust_id,orders.order_num from customers right outer join orders on orders.cust_id = customers.cust_id;</span><br><span class="line">+---------+-----------+</span><br><span class="line">| cust_id | order_num |</span><br><span class="line">+---------+-----------+</span><br><span class="line">|   10001 |     20005 |</span><br><span class="line">|   10001 |     20009 |</span><br><span class="line">|   10003 |     20006 |</span><br><span class="line">|   10004 |     20007 |</span><br><span class="line">|   10005 |     20008 |</span><br><span class="line">+---------+-----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>æ²¡æœ‰ <code>*=</code> æ“ä½œç¬¦</strong> MySQLä¸æ”¯æŒç®€åŒ–å­—ç¬¦ <code>*=</code> å’Œ <code>=*</code> çš„ä½¿ç”¨,è¿™ä¸¤ç§æ“ä½œç¬¦åœ¨å…¶ä»–DBMSä¸­æ˜¯å¾ˆæµè¡Œçš„ã€‚</p>
<p><strong>å¤–éƒ¨è”ç»“çš„ç±»å‹</strong> å­˜åœ¨ä¸¤ç§åŸºæœ¬çš„å¤–éƒ¨è”ç»“å½¢å¼:å·¦å¤–éƒ¨è”ç»“å’Œå³å¤–éƒ¨è”ç»“ã€‚å®ƒä»¬ä¹‹é—´çš„å”¯ä¸€å·®åˆ«æ˜¯æ‰€å…³è”çš„è¡¨çš„é¡ºåºä¸åŒã€‚æ¢å¥è¯è¯´,å·¦å¤–éƒ¨è”ç»“å¯é€šè¿‡é¢ å€’ FROM æˆ– WHERE å­å¥ä¸­è¡¨çš„é¡ºåºè½¬æ¢ä¸ºå³å¤–éƒ¨è”ç»“ã€‚å› æ­¤,ä¸¤ç§ç±»å‹çš„å¤–éƒ¨è”ç»“å¯äº’æ¢ä½¿ç”¨,è€Œç©¶ç«Ÿä½¿ç”¨å“ªä¸€ç§çº¯ç²¹æ˜¯æ ¹æ®æ–¹ä¾¿è€Œå®šã€‚</p>
<blockquote>
<p>ä½¿ç”¨å¸¦èšé›†å‡½æ•°çš„è”ç»“</p>
</blockquote>
<p>æ­£å¦‚ç¬¬12ç« æ‰€è¿°,èšé›†å‡½æ•°ç”¨æ¥æ±‡æ€»æ•°æ®ã€‚è™½ç„¶è‡³ä»Šä¸ºæ­¢èšé›†å‡½æ•°çš„æ‰€æœ‰ä¾‹å­åªæ˜¯ä»å•ä¸ªè¡¨æ±‡æ€»æ•°æ®,ä½†è¿™äº›å‡½æ•°ä¹Ÿå¯ä»¥ä¸è”ç»“ä¸€èµ·ä½¿ç”¨ã€‚</p>
<p>ä¸ºè¯´æ˜è¿™ä¸€ç‚¹,è¯·çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p>
<blockquote>
<blockquote>
<p>å¦‚æœè¦æ£€ç´¢æ‰€æœ‰å®¢æˆ·åŠæ¯ä¸ªå®¢æˆ·æ‰€ä¸‹çš„è®¢å•æ•°,ä¸‹é¢ä½¿ç”¨äº† COUNT() å‡½æ•°çš„ä»£ç å¯å®Œæˆæ­¤å·¥ä½œ:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select customers.cust_name,customers.cust_id,count(orders.order_num) as num_ord from customers inner join orders on customers.cust_id = orders.cust_id group by customers.cust_id;</span><br><span class="line">+----------------+---------+---------+</span><br><span class="line">| cust_name      | cust_id | num_ord |</span><br><span class="line">+----------------+---------+---------+</span><br><span class="line">| Coyote Inc.    |   10001 |       2 |</span><br><span class="line">| Wascals        |   10003 |       1 |</span><br><span class="line">| Yosemite Place |   10004 |       1 |</span><br><span class="line">| E Fudd         |   10005 |       1 |</span><br><span class="line">+----------------+---------+---------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>æ­¤<code>SELECT</code> è¯­å¥ä½¿ç”¨ <code>INNER JOIN</code> å°† <code>customers</code> å’Œ <code>orders</code> è¡¨äº’ç›¸å…³è”ã€‚<code>GROUP BY</code> å­å¥æŒ‰å®¢æˆ·åˆ†ç»„æ•°æ®,å› æ­¤,å‡½æ•°è°ƒç”¨ <code>COUNT (orders.order_num)</code>å¯¹æ¯ä¸ªå®¢æˆ·çš„è®¢å•è®¡æ•°,å°†å®ƒä½œä¸º <code>num_ord</code> è¿”å›ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from customers;</span><br><span class="line">+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| cust_id | cust_name      | cust_address        | cust_city | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|   10002 | Mouse House    | 333 Fromage Lane    | Columbus  | OH         | 43333    | USA          | Jerry Mouse  | NULL                |</span><br><span class="line">|   10003 | Wascals        | 1 Sunny Place       | Muncie    | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|   10004 | Yosemite Place | 829 Riverside Drive | Phoenix   | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|   10005 | E Fudd         | 4545 53rd Street    | Chicago   | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select  * from orders;</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">| order_num | order_date          | cust_id |</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">|     20005 | 2005-09-01 00:00:00 |   10001 |</span><br><span class="line">|     20006 | 2005-09-12 00:00:00 |   10003 |</span><br><span class="line">|     20007 | 2005-09-30 00:00:00 |   10004 |</span><br><span class="line">|     20008 | 2005-10-03 00:00:00 |   10005 |</span><br><span class="line">|     20009 | 2005-10-08 00:00:00 |   10001 |</span><br><span class="line">+-----------+---------------------+---------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> å†…éƒ¨è”ç»“æˆ–ç­‰å€¼è”ç»“(equijoin)çš„ç®€å•è”ç»“</span></span><br><span class="line">MariaDB [test]&gt; select orders.*,customers.* from customers inner join orders on customers.cust_id = orders.cust_id;</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| order_num | order_date          | cust_id | cust_id | cust_name      | cust_address        | cust_city | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|     20005 | 2005-09-01 00:00:00 |   10001 |   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|     20006 | 2005-09-12 00:00:00 |   10003 |   10003 | Wascals        | 1 Sunny Place       | Muncie    | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|     20007 | 2005-09-30 00:00:00 |   10004 |   10004 | Yosemite Place | 829 Riverside Drive | Phoenix   | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|     20008 | 2005-10-03 00:00:00 |   10005 |   10005 | E Fudd         | 4545 53rd Street    | Chicago   | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|     20009 | 2005-10-08 00:00:00 |   10001 |   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> å†…éƒ¨è”ç»“æˆ–ç­‰å€¼è”ç»“(equijoin)çš„ç®€å•è”ç»“</span></span><br><span class="line">MariaDB [test]&gt; select orders.*,customers.* from orders inner join customers on customers.cust_id = orders.cust_id;</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| order_num | order_date          | cust_id | cust_id | cust_name      | cust_address        | cust_city | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|     20005 | 2005-09-01 00:00:00 |   10001 |   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|     20009 | 2005-10-08 00:00:00 |   10001 |   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|     20006 | 2005-09-12 00:00:00 |   10003 |   10003 | Wascals        | 1 Sunny Place       | Muncie    | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|     20007 | 2005-09-30 00:00:00 |   10004 |   10004 | Yosemite Place | 829 Riverside Drive | Phoenix   | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|     20008 | 2005-10-03 00:00:00 |   10005 |   10005 | E Fudd         | 4545 53rd Street    | Chicago   | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> å·¦å¤–éƒ¨è”ç»“</span></span><br><span class="line">MariaDB [test]&gt; select orders.*,customers.* from customers left outer join orders on customers.cust_id = orders.cust_id;</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| order_num | order_date          | cust_id | cust_id | cust_name      | cust_address        | cust_city | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|     20005 | 2005-09-01 00:00:00 |   10001 |   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|     20006 | 2005-09-12 00:00:00 |   10003 |   10003 | Wascals        | 1 Sunny Place       | Muncie    | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|     20007 | 2005-09-30 00:00:00 |   10004 |   10004 | Yosemite Place | 829 Riverside Drive | Phoenix   | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|     20008 | 2005-10-03 00:00:00 |   10005 |   10005 | E Fudd         | 4545 53rd Street    | Chicago   | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|     20009 | 2005-10-08 00:00:00 |   10001 |   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|      NULL | NULL                |    NULL |   10002 | Mouse House    | 333 Fromage Lane    | Columbus  | OH         | 43333    | USA          | Jerry Mouse  | NULL                |</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> å·¦å¤–éƒ¨è”ç»“</span></span><br><span class="line">MariaDB [test]&gt; select orders.*,customers.* from orders left outer join customers on customers.cust_id = orders.cust_id;</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| order_num | order_date          | cust_id | cust_id | cust_name      | cust_address        | cust_city | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|     20005 | 2005-09-01 00:00:00 |   10001 |   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|     20006 | 2005-09-12 00:00:00 |   10003 |   10003 | Wascals        | 1 Sunny Place       | Muncie    | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|     20007 | 2005-09-30 00:00:00 |   10004 |   10004 | Yosemite Place | 829 Riverside Drive | Phoenix   | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|     20008 | 2005-10-03 00:00:00 |   10005 |   10005 | E Fudd         | 4545 53rd Street    | Chicago   | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|     20009 | 2005-10-08 00:00:00 |   10001 |   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> å³å¤–éƒ¨è”ç»“</span></span><br><span class="line">MariaDB [test]&gt; select orders.*,customers.* from customers right outer join orders on customers.cust_id = orders.cust_id;</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| order_num | order_date          | cust_id | cust_id | cust_name      | cust_address        | cust_city | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|     20005 | 2005-09-01 00:00:00 |   10001 |   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|     20006 | 2005-09-12 00:00:00 |   10003 |   10003 | Wascals        | 1 Sunny Place       | Muncie    | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|     20007 | 2005-09-30 00:00:00 |   10004 |   10004 | Yosemite Place | 829 Riverside Drive | Phoenix   | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|     20008 | 2005-10-03 00:00:00 |   10005 |   10005 | E Fudd         | 4545 53rd Street    | Chicago   | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|     20009 | 2005-10-08 00:00:00 |   10001 |   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> å³å¤–éƒ¨è”ç»“</span></span><br><span class="line">MariaDB [test]&gt; select orders.*,customers.* from orders right outer join customers on customers.cust_id = orders.cust_id;</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">| order_num | order_date          | cust_id | cust_id | cust_name      | cust_address        | cust_city | cust_state | cust_zip | cust_country | cust_contact | cust_email          |</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">|     20005 | 2005-09-01 00:00:00 |   10001 |   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|     20006 | 2005-09-12 00:00:00 |   10003 |   10003 | Wascals        | 1 Sunny Place       | Muncie    | IN         | 42222    | USA          | Jim Jones    | rabbit@wascally.com |</span><br><span class="line">|     20007 | 2005-09-30 00:00:00 |   10004 |   10004 | Yosemite Place | 829 Riverside Drive | Phoenix   | AZ         | 88888    | USA          | Y Sam        | sam@yosemite.com    |</span><br><span class="line">|     20008 | 2005-10-03 00:00:00 |   10005 |   10005 | E Fudd         | 4545 53rd Street    | Chicago   | IL         | 54545    | USA          | E Fudd       | NULL                |</span><br><span class="line">|     20009 | 2005-10-08 00:00:00 |   10001 |   10001 | Coyote Inc.    | 200 Maple Lane      | Detroit   | MI         | 44444    | USA          | Y Lee        | ylee@coyote.com     |</span><br><span class="line">|      NULL | NULL                |    NULL |   10002 | Mouse House    | 333 Fromage Lane    | Columbus  | OH         | 43333    | USA          | Jerry Mouse  | NULL                |</span><br><span class="line">+-----------+---------------------+---------+---------+----------------+---------------------+-----------+------------+----------+--------------+--------------+---------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>èšé›†å‡½æ•°ä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°ä¸å…¶ä»–è”ç»“ä¸€èµ·ä½¿ç”¨ã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­:</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢æ‰€æœ‰å®¢æˆ·åŠæ¯ä¸ªå®¢æˆ·æ‰€ä¸‹çš„è®¢å•æ•°(åŒ…æ‹¬æ²¡æœ‰è®¢å•çš„å®¢æˆ·)</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select customers.cust_name,customers.cust_id,count(orders.order_num) as num_ord from customers left outer join orders on customers.cust_id = orders.cust_id group by customers.cust_id;</span><br><span class="line">+----------------+---------+---------+</span><br><span class="line">| cust_name      | cust_id | num_ord |</span><br><span class="line">+----------------+---------+---------+</span><br><span class="line">| Coyote Inc.    |   10001 |       2 |</span><br><span class="line">| Mouse House    |   10002 |       0 |</span><br><span class="line">| Wascals        |   10003 |       1 |</span><br><span class="line">| Yosemite Place |   10004 |       1 |</span><br><span class="line">| E Fudd         |   10005 |       1 |</span><br><span class="line">+----------------+---------+---------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªä¾‹å­ä½¿ç”¨å·¦å¤–éƒ¨è”ç»“æ¥åŒ…å«æ‰€æœ‰å®¢æˆ·,ç”šè‡³åŒ…å«é‚£äº›æ²¡æœ‰ä»»ä½•ä¸‹è®¢å•çš„å®¢æˆ·ã€‚ç»“æœæ˜¾ç¤ºä¹ŸåŒ…å«äº†å®¢æˆ· <code>Mouse House</code> ,å®ƒæœ‰ 0 ä¸ªè®¢å•ã€‚</p>
<blockquote>
<p>ä½¿ç”¨è”ç»“å’Œè”ç»“æ¡ä»¶</p>
</blockquote>
<p>åœ¨æ€»ç»“å…³äºè”ç»“çš„è¿™ä¸¤ç« å‰,æœ‰å¿…è¦æ±‡æ€»ä¸€ä¸‹å…³äºè”ç»“åŠå…¶ä½¿ç”¨çš„æŸäº›è¦ç‚¹ã€‚</p>
<ul>
<li>æ³¨æ„æ‰€ä½¿ç”¨çš„è”ç»“ç±»å‹ã€‚ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨å†…éƒ¨è”ç»“,ä½†ä½¿ç”¨å¤–éƒ¨è”ç»“ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚</li>
<li>ä¿è¯ä½¿ç”¨æ­£ç¡®çš„è”ç»“æ¡ä»¶,å¦åˆ™å°†è¿”å›ä¸æ­£ç¡®çš„æ•°æ®ã€‚</li>
<li>åº”è¯¥æ€»æ˜¯æä¾›è”ç»“æ¡ä»¶,å¦åˆ™ä¼šå¾—å‡ºç¬›å¡å„¿ç§¯ã€‚</li>
<li>åœ¨ä¸€ä¸ªè”ç»“ä¸­å¯ä»¥åŒ…å«å¤šä¸ªè¡¨,ç”šè‡³å¯¹äºæ¯ä¸ªè”ç»“å¯ä»¥é‡‡ç”¨ä¸åŒçš„è”ç»“ç±»å‹ã€‚è™½ç„¶è¿™æ ·åšæ˜¯åˆæ³•çš„,ä¸€èˆ¬ä¹Ÿå¾ˆæœ‰ç”¨,ä½†åº”è¯¥åœ¨ä¸€èµ·æµ‹è¯•å®ƒä»¬å‰,åˆ†åˆ«æµ‹è¯•æ¯ä¸ªè”ç»“ã€‚è¿™å°†ä½¿æ•…éšœæ’é™¤æ›´ä¸ºç®€å•ã€‚</li>
</ul>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« æ˜¯ä¸Šä¸€ç« å…³äºè”ç»“çš„ç»§ç»­ã€‚æœ¬ç« ä»è®²æˆå¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆè¦ä½¿ç”¨åˆ«åå¼€å§‹,ç„¶åè®¨è®ºä¸åŒçš„è”ç»“ç±»å‹åŠå¯¹æ¯ç§ç±»å‹çš„è”ç»“ä½¿ç”¨çš„å„ç§è¯­æ³•å½¢å¼ã€‚æˆ‘ä»¬è¿˜ä»‹ç»äº†å¦‚ä½•ä¸è”ç»“ä¸€èµ·ä½¿ç”¨èšé›†å‡½æ•°,ä»¥åŠåœ¨ä½¿ç”¨è”ç»“æ—¶åº”è¯¥æ³¨æ„çš„æŸäº›é—®é¢˜ã€‚</p>
</blockquote>
</blockquote>
<hr>
<h4 id="ç»„åˆæŸ¥è¯¢"><a href="#ç»„åˆæŸ¥è¯¢" class="headerlink" title="ç»„åˆæŸ¥è¯¢"></a>ç»„åˆæŸ¥è¯¢</h4><p>æœ¬ç« è®²è¿°å¦‚ä½•åˆ©ç”¨ UNION æ“ä½œç¬¦å°†å¤šæ¡ SELECT è¯­å¥ç»„åˆæˆä¸€ä¸ªç»“æœé›†ã€‚</p>
<blockquote>
<p>ç»„åˆæŸ¥è¯¢</p>
</blockquote>
<p>å¤šæ•°SQLæŸ¥è¯¢éƒ½åªåŒ…å«ä»ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­è¿”å›æ•°æ®çš„å•æ¡ SELECT è¯­å¥ã€‚MySQLä¹Ÿå…è®¸æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢(å¤šæ¡ SELECT è¯­å¥),å¹¶å°†ç»“æœä½œä¸ºå•ä¸ªæŸ¥è¯¢ç»“æœé›†è¿”å›ã€‚è¿™äº›ç»„åˆæŸ¥è¯¢é€šå¸¸ç§°ä¸º<strong>å¹¶(union)æˆ–å¤åˆæŸ¥è¯¢(compound query)</strong>ã€‚</p>
<p>æœ‰ä¸¤ç§åŸºæœ¬æƒ…å†µ,å…¶ä¸­éœ€è¦ä½¿ç”¨ç»„åˆæŸ¥è¯¢:</p>
<ul>
<li>åœ¨å•ä¸ªæŸ¥è¯¢ä¸­ä»ä¸åŒçš„è¡¨è¿”å›ç±»ä¼¼ç»“æ„çš„æ•°æ®;</li>
<li>å¯¹å•ä¸ªè¡¨æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢,æŒ‰å•ä¸ªæŸ¥è¯¢è¿”å›æ•°æ®ã€‚</li>
</ul>
<p>ç»„åˆæŸ¥è¯¢å’Œå¤šä¸ª WHERE æ¡ä»¶ å¤šæ•°æƒ…å†µä¸‹,ç»„åˆç›¸åŒè¡¨çš„ä¸¤ä¸ªæŸ¥è¯¢å®Œæˆçš„å·¥ä½œä¸å…·æœ‰å¤šä¸ª WHERE å­å¥æ¡ä»¶çš„å•æ¡æŸ¥è¯¢å®Œæˆçš„å·¥ä½œç›¸åŒã€‚æ¢å¥è¯è¯´,ä»»ä½•å…·æœ‰å¤šä¸ª WHERE å­å¥çš„ SELECT è¯­å¥éƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªç»„åˆæŸ¥è¯¢ç»™å‡º,åœ¨ä»¥ä¸‹æ®µè½ä¸­å¯ä»¥çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚è¿™ä¸¤ç§æŠ€æœ¯åœ¨ä¸åŒçš„æŸ¥è¯¢ä¸­æ€§èƒ½ä¹Ÿä¸åŒã€‚å› æ­¤,åº”è¯¥è¯•ä¸€ä¸‹è¿™ä¸¤ç§æŠ€æœ¯,ä»¥ç¡®å®šå¯¹ç‰¹å®šçš„æŸ¥è¯¢å“ªä¸€ç§æ€§èƒ½æ›´å¥½ã€‚</p>
<blockquote>
<p>åˆ›å»ºç»„åˆæŸ¥è¯¢</p>
</blockquote>
<p>å¯ç”¨ UNION æ“ä½œç¬¦æ¥ç»„åˆæ•°æ¡SQLæŸ¥è¯¢ã€‚åˆ©ç”¨ UNION ,å¯ç»™å‡ºå¤šæ¡SELECT è¯­å¥,å°†å®ƒä»¬çš„ç»“æœç»„åˆæˆå•ä¸ªç»“æœé›†ã€‚</p>
<p>1.ä½¿ç”¨ UNION</p>
<p>UNION çš„ä½¿ç”¨å¾ˆç®€å•ã€‚æ‰€éœ€åšçš„åªæ˜¯ç»™å‡ºæ¯æ¡ SELECT è¯­å¥,åœ¨å„æ¡è¯­å¥ä¹‹é—´æ”¾ä¸Šå…³é”®å­— UNION ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸¾ä¸€ä¸ªä¾‹å­,å‡å¦‚éœ€è¦ä»·æ ¼å°äºç­‰äº 5 çš„æ‰€æœ‰ç‰©å“çš„ä¸€ä¸ªåˆ—è¡¨,è€Œä¸”è¿˜æƒ³åŒ…æ‹¬ä¾›åº”å•† 1001 å’Œ 1002 ç”Ÿäº§çš„æ‰€æœ‰ç‰©å“(ä¸è€ƒè™‘ä»·æ ¼)ã€‚</p>
</blockquote>
</blockquote>
<p>å½“ç„¶,å¯ä»¥åˆ©ç”¨ WHERE å­å¥æ¥å®Œæˆæ­¤å·¥ä½œ,ä¸è¿‡è¿™æ¬¡æˆ‘ä»¬å°†ä½¿ç”¨ UNION ã€‚æ­£å¦‚æ‰€è¿°,åˆ›å»º UNION æ¶‰åŠç¼–å†™å¤šæ¡ SELECT è¯­å¥ã€‚é¦–å…ˆæ¥çœ‹å•æ¡è¯­å¥:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select vend_id,prod_id,prod_price from products where prod_price &lt;=5;</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">| vend_id | prod_id | prod_price |</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">|    1003 | FC      |       2.50 |</span><br><span class="line">|    1002 | FU1     |       3.42 |</span><br><span class="line">|    1003 | SLING   |       4.49 |</span><br><span class="line">|    1003 | TNT1    |       2.50 |</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select vend_id,prod_id,prod_price from products where vend_id in (1001,1002);</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">| vend_id | prod_id | prod_price |</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">|    1001 | ANV01   |       5.99 |</span><br><span class="line">|    1001 | ANV02   |       9.99 |</span><br><span class="line">|    1001 | ANV03   |      14.99 |</span><br><span class="line">|    1002 | FU1     |       3.42 |</span><br><span class="line">|    1002 | OL1     |       8.99 |</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ¡ SELECT æ£€ç´¢ä»·æ ¼ä¸é«˜äº 5 çš„æ‰€æœ‰ç‰©å“ã€‚ç¬¬äºŒæ¡ SELECT ä½¿ç”¨ IN æ‰¾å‡ºä¾›åº”å•† 1001 å’Œ 1002 ç”Ÿäº§çš„æ‰€æœ‰ç‰©å“ã€‚ä¸ºäº†ç»„åˆè¿™ä¸¤æ¡è¯­å¥,æŒ‰å¦‚ä¸‹è¿›è¡Œ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt;  select vend_id,prod_id,prod_price from products where prod_price &lt;=5 union select vend_id,prod_id,prod_price from products where vend_id in (1001,1002);</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">| vend_id | prod_id | prod_price |</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">|    1003 | FC      |       2.50 |</span><br><span class="line">|    1002 | FU1     |       3.42 |</span><br><span class="line">|    1003 | SLING   |       4.49 |</span><br><span class="line">|    1003 | TNT1    |       2.50 |</span><br><span class="line">|    1001 | ANV01   |       5.99 |</span><br><span class="line">|    1001 | ANV02   |       9.99 |</span><br><span class="line">|    1001 | ANV03   |      14.99 |</span><br><span class="line">|    1002 | OL1     |       8.99 |</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡è¯­å¥ç”±å‰é¢çš„ä¸¤æ¡ SELECT è¯­å¥ç»„æˆ,è¯­å¥ä¸­ç”¨ UNION å…³é”®å­—åˆ†éš”ã€‚ UNION æŒ‡ç¤ºMySQLæ‰§è¡Œä¸¤æ¡ SELECT è¯­å¥,å¹¶æŠŠè¾“å‡ºç»„åˆæˆå•ä¸ªæŸ¥è¯¢ç»“æœé›†ã€‚</p>
<p>ä½œä¸ºå‚è€ƒ,è¿™é‡Œç»™å‡ºä½¿ç”¨å¤šæ¡ WHERE å­å¥è€Œä¸æ˜¯ä½¿ç”¨ UNION çš„ç›¸åŒæŸ¥è¯¢:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select vend_id,prod_id,prod_price from products where prod_price &lt;=5 or vend_id in (1001,1002);</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">| vend_id | prod_id | prod_price |</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">|    1001 | ANV01   |       5.99 |</span><br><span class="line">|    1001 | ANV02   |       9.99 |</span><br><span class="line">|    1001 | ANV03   |      14.99 |</span><br><span class="line">|    1003 | FC      |       2.50 |</span><br><span class="line">|    1002 | FU1     |       3.42 |</span><br><span class="line">|    1002 | OL1     |       8.99 |</span><br><span class="line">|    1003 | SLING   |       4.49 |</span><br><span class="line">|    1003 | TNT1    |       2.50 |</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªç®€å•çš„ä¾‹å­ä¸­,ä½¿ç”¨ UNION å¯èƒ½æ¯”ä½¿ç”¨ WHERE å­å¥æ›´ä¸ºå¤æ‚ã€‚ä½†å¯¹äºæ›´å¤æ‚çš„è¿‡æ»¤æ¡ä»¶,æˆ–è€…ä»å¤šä¸ªè¡¨(è€Œä¸æ˜¯å•ä¸ªè¡¨)ä¸­æ£€ç´¢æ•°æ®çš„æƒ…å½¢,ä½¿ç”¨ UNION å¯èƒ½ä¼šä½¿å¤„ç†æ›´ç®€å•ã€‚</p>
<blockquote>
<blockquote>
<p>æ£€ç´¢å®¢æˆ·ä¿¡æ¯è¡¨ä¸­å®¢æˆ·ååŒ…å«Mouseçš„å®¢æˆ·idï¼Œä»¥åŠè®¢å•è¡¨ä¸­ï¼Œè®¢å•å·ä¸º20005çš„å®¢æˆ·idã€‚</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select cust_id from orders where order_num=20005 union select cust_id from customers where cust_name regexp 'Mouse';</span><br><span class="line">+---------+</span><br><span class="line">| cust_id |</span><br><span class="line">+---------+</span><br><span class="line">|   10001 |</span><br><span class="line">|   10002 |</span><br><span class="line">+---------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>2.UNION è§„åˆ™</p>
<p>æ­£å¦‚æ‰€è§,å¹¶æ˜¯éå¸¸å®¹æ˜“ä½¿ç”¨çš„ã€‚ä½†åœ¨è¿›è¡Œå¹¶æ—¶æœ‰å‡ æ¡è§„åˆ™éœ€è¦æ³¨æ„ã€‚</p>
<ul>
<li>UNION å¿…é¡»ç”±ä¸¤æ¡æˆ–ä¸¤æ¡ä»¥ä¸Šçš„ SELECT è¯­å¥ç»„æˆ,è¯­å¥ä¹‹é—´ç”¨å…³é”®å­— UNION åˆ†éš”(å› æ­¤,å¦‚æœç»„åˆ4æ¡ SELECT è¯­å¥,å°†è¦ä½¿ç”¨3ä¸ªUNION å…³é”®å­—)ã€‚</li>
<li>UNION ä¸­çš„æ¯ä¸ªæŸ¥è¯¢å¿…é¡»åŒ…å«ç›¸åŒçš„åˆ—ã€è¡¨è¾¾å¼æˆ–èšé›†å‡½æ•°(ä¸è¿‡å„ä¸ªåˆ—ä¸éœ€è¦ä»¥ç›¸åŒçš„æ¬¡åºåˆ—å‡º)ã€‚</li>
<li>åˆ—æ•°æ®ç±»å‹å¿…é¡»å…¼å®¹:ç±»å‹ä¸å¿…å®Œå…¨ç›¸åŒ,ä½†å¿…é¡»æ˜¯DBMSå¯ä»¥éšå«åœ°è½¬æ¢çš„ç±»å‹(ä¾‹å¦‚,ä¸åŒçš„æ•°å€¼ç±»å‹æˆ–ä¸åŒçš„æ—¥æœŸç±»å‹)ã€‚</li>
</ul>
<p>å¦‚æœéµå®ˆäº†è¿™äº›åŸºæœ¬è§„åˆ™æˆ–é™åˆ¶,åˆ™å¯ä»¥å°†å¹¶ç”¨äºä»»ä½•æ•°æ®æ£€ç´¢ä»»åŠ¡ã€‚</p>
<p>3.åŒ…å«æˆ–å–æ¶ˆé‡å¤çš„è¡Œ</p>
<p>æˆ‘ä»¬æ³¨æ„åˆ°,åœ¨åˆ†åˆ«æ‰§è¡Œæ—¶,ç¬¬ä¸€æ¡ SELECT è¯­å¥è¿”å›4è¡Œ,ç¬¬äºŒæ¡ SELECT è¯­å¥è¿”å›5è¡Œã€‚ä½†åœ¨ç”¨ UNION ç»„åˆä¸¤æ¡ SELECT è¯­å¥å,åªè¿”å›äº†8è¡Œè€Œä¸æ˜¯9è¡Œã€‚</p>
<p>UNION ä»æŸ¥è¯¢ç»“æœé›†ä¸­è‡ªåŠ¨å»é™¤äº†é‡å¤çš„è¡Œ(æ¢å¥è¯è¯´,å®ƒçš„è¡Œä¸ºä¸ã€‚å› ä¸ºä¾›åº”å•† 1002 ç”Ÿäº§å•æ¡ SELECT è¯­å¥ä¸­ä½¿ç”¨å¤šä¸ª WHERE å­å¥æ¡ä»¶ä¸€æ ·)çš„ä¸€ç§ç‰©å“çš„ä»·æ ¼ä¹Ÿä½äº 5 ,æ‰€ä»¥ä¸¤æ¡ SELECT è¯­å¥éƒ½è¿”å›è¯¥è¡Œã€‚åœ¨ä½¿ç”¨UNION æ—¶,é‡å¤çš„è¡Œè¢«è‡ªåŠ¨å–æ¶ˆã€‚</p>
<p>è¿™æ˜¯ UNION çš„é»˜è®¤è¡Œä¸º,ä½†æ˜¯å¦‚æœéœ€è¦,å¯ä»¥æ”¹å˜å®ƒã€‚äº‹å®ä¸Š,å¦‚æœæƒ³è¿”å›æ‰€æœ‰åŒ¹é…è¡Œ,å¯ä½¿ç”¨ UNION ALL è€Œä¸æ˜¯ UNION ã€‚</p>
<p>è¯·çœ‹ä¸‹é¢çš„ä¾‹å­:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt;  select vend_id,prod_id,prod_price from products where prod_price &lt;=5 union all select vend_id,prod_id,prod_price from products where vend_id in (1001,1002);</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">| vend_id | prod_id | prod_price |</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">|    1003 | FC      |       2.50 |</span><br><span class="line">|    1002 | FU1     |       3.42 |</span><br><span class="line">|    1003 | SLING   |       4.49 |</span><br><span class="line">|    1003 | TNT1    |       2.50 |</span><br><span class="line">|    1001 | ANV01   |       5.99 |</span><br><span class="line">|    1001 | ANV02   |       9.99 |</span><br><span class="line">|    1001 | ANV03   |      14.99 |</span><br><span class="line">|    1002 | FU1     |       3.42 |</span><br><span class="line">|    1002 | OL1     |       8.99 |</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>UNION ALL</code> ,MySQLä¸å–æ¶ˆé‡å¤çš„è¡Œã€‚å› æ­¤è¿™é‡Œçš„ä¾‹å­è¿”å›9è¡Œ,å…¶ä¸­æœ‰ä¸€è¡Œå‡ºç°ä¸¤æ¬¡ã€‚</p>
<p><strong>UNION ä¸ WHERE</strong> æœ¬ç« å¼€å§‹æ—¶è¯´è¿‡, <code>UNION</code> å‡ ä¹æ€»æ˜¯å®Œæˆä¸å¤šä¸ª<code>WHERE</code> æ¡ä»¶ç›¸åŒçš„å·¥ä½œã€‚ <code>UNION ALL</code> ä¸º <code>UNION</code> çš„ä¸€ç§å½¢å¼,å®ƒå®Œæˆ<code>WHERE</code> å­å¥å®Œæˆä¸äº†çš„å·¥ä½œã€‚å¦‚æœç¡®å®éœ€è¦æ¯ä¸ªæ¡ä»¶çš„åŒ¹é…è¡Œå…¨éƒ¨å‡ºç°(åŒ…æ‹¬é‡å¤è¡Œ),åˆ™å¿…é¡»ä½¿ç”¨ <code>UNION ALL</code> è€Œä¸æ˜¯ <code>WHERE</code> ã€‚</p>
<p>4.å¯¹ç»„åˆæŸ¥è¯¢ç»“æœæ’åº</p>
<p><code>SELECT</code> è¯­å¥çš„è¾“å‡ºç”¨ <code>ORDER BY</code> å­å¥æ’åºã€‚åœ¨ç”¨ <code>UNION</code> ç»„åˆæŸ¥è¯¢æ—¶,åªèƒ½ä½¿ç”¨ä¸€æ¡ <code>ORDER BY</code> å­å¥,å®ƒå¿…é¡»å‡ºç°åœ¨æœ€åä¸€æ¡ <code>SELECT</code> è¯­å¥ä¹‹åã€‚å¯¹äºç»“æœé›†,ä¸å­˜åœ¨ç”¨ä¸€ç§æ–¹å¼æ’åºä¸€éƒ¨åˆ†,è€Œåˆç”¨å¦ä¸€ç§æ–¹å¼æ’åºå¦ä¸€éƒ¨åˆ†çš„æƒ…å†µ,å› æ­¤ä¸å…è®¸ä½¿ç”¨å¤šæ¡ <code>ORDER BY</code> å­å¥ã€‚</p>
<blockquote>
<blockquote>
<p>ä¸‹é¢çš„ä¾‹å­æ’åºå‰é¢ UNION è¿”å›çš„ç»“æœ:</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [test]&gt; select vend_id,prod_id,prod_price from products where prod_price &lt;=5 union all select vend_id,prod_id,prod_price from products where vend_id in (1001,1002) order by vend_id,prod_price;</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">| vend_id | prod_id | prod_price |</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">|    1001 | ANV01   |       5.99 |</span><br><span class="line">|    1001 | ANV02   |       9.99 |</span><br><span class="line">|    1001 | ANV03   |      14.99 |</span><br><span class="line">|    1002 | FU1     |       3.42 |</span><br><span class="line">|    1002 | FU1     |       3.42 |</span><br><span class="line">|    1002 | OL1     |       8.99 |</span><br><span class="line">|    1003 | FC      |       2.50 |</span><br><span class="line">|    1003 | TNT1    |       2.50 |</span><br><span class="line">|    1003 | SLING   |       4.49 |</span><br><span class="line">+---------+---------+------------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡ <code>UNION</code> åœ¨æœ€åä¸€æ¡ <code>SELECT</code> è¯­å¥åä½¿ç”¨äº† <code>ORDER BY</code> å­å¥ã€‚è™½ç„¶ <code>ORDER BY</code> å­å¥ä¼¼ä¹åªæ˜¯æœ€åä¸€æ¡ <code>SELECT</code> è¯­å¥çš„ç»„æˆéƒ¨åˆ†,ä½†å®é™…ä¸ŠMySQLå°†ç”¨å®ƒæ¥æ’åºæ‰€æœ‰ <code>SELECT</code> è¯­å¥è¿”å›çš„æ‰€æœ‰ç»“æœã€‚</p>
<p><strong>ç»„åˆä¸åŒçš„è¡¨</strong> ä¸ºä½¿è¡¨è¿°æ¯”è¾ƒç®€å•,æœ¬ç« ä¾‹å­ä¸­çš„ç»„åˆæŸ¥è¯¢ä½¿ç”¨çš„å‡æ˜¯ç›¸åŒçš„è¡¨ã€‚ä½†æ˜¯å…¶ä¸­ä½¿ç”¨ UNION çš„ç»„åˆæŸ¥è¯¢å¯ä»¥åº”ç”¨ä¸åŒçš„è¡¨ã€‚</p>
<blockquote>
<p>å°ç»“</p>
<blockquote>
<p>æœ¬ç« è®²æˆå¦‚ä½•ç”¨ UNION æ“ä½œç¬¦æ¥ç»„åˆ SELECT è¯­å¥ã€‚åˆ©ç”¨ UNION ,å¯æŠŠå¤šæ¡æŸ¥è¯¢çš„ç»“æœä½œä¸ºä¸€æ¡ç»„åˆæŸ¥è¯¢è¿”å›,ä¸ç®¡å®ƒä»¬çš„ç»“æœä¸­åŒ…å«è¿˜æ˜¯ä¸åŒ…å«é‡å¤ã€‚ä½¿ç”¨ UNION å¯æå¤§åœ°ç®€åŒ–å¤æ‚çš„ WHERE å­å¥,ç®€åŒ–ä»å¤šä¸ªè¡¨ä¸­æ£€ç´¢æ•°æ®çš„å·¥ä½œã€‚</p>
</blockquote>
</blockquote>
<hr>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>MySQLåŸºç¡€ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬äºŒè¯¾ MySQLå’ŒMariaDBæ•°æ®åº“ä»‹ç»</title>
    <url>/2016/12/26/booboo_mysql/01-MySQL%E5%92%8CMariaDB%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<h3 id="æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ"><a href="#æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ" class="headerlink" title="æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ"></a>æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ</h3><p><strong>æ•°æ®åº“(database)</strong>:  ä¿å­˜æœ‰ç»„ç»‡çš„æ•°æ®çš„å®¹å™¨(é€šå¸¸æ˜¯ä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ç»„æ–‡ä»¶)ã€‚</p>
<p><strong>æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ(DBMS)</strong>: é¡¾åæ€ä¹‰ï¼Œæ—¢ç„¶æ˜¯æ•°æ®ç®¡ç†ç³»ç»Ÿï¼Œå°±æ˜¯ç”¨æ¥ç®¡ç†æ•°æ®çš„æ•°æ®åº“è½¯ä»¶</p>
<blockquote>
<p><strong>* çº¿ä¸Šç”Ÿäº§ç¯å¢ƒä¸­æœ‰å¾ˆå¤šæ•°æ®ï¼Œä¸¾ä¾‹è¯´æ˜ï¼Œè®ºå›ã€qqã€å¾®åšã€æœ‹å‹åœˆç­‰ç­‰ã€‚ *</strong><br>åœ¨æˆ‘ä»¬çº¿ä¸Šç”Ÿäº§ç¯å¢ƒå½“ä¸­æœ‰å¾ˆå¤šæ•°æ®ï¼Œé‚£ä¹ˆç”¨æˆ·æ¯”å¦‚è¯´ç™»ä¸€ä¸ªè®ºå›å‘äº†ä¸ªå¸–å­ï¼Œè¿™ä¸ªå¸–å­é‡Œçš„å†…å®¹å°±æ˜¯ä¸€ä¸ªæ•°æ®ï¼›ç”¨æˆ·ç™»é™†ä¸€ä¸ªè´­ç‰©ç½‘ç«™ï¼Œä¹°äº†ä¸€ä¸ªå•†å“ï¼Œç”¨æˆ·è´­ä¹°ä¸€ä¸ªå•†å“æ˜¯ä¸€ä¸ªè®¢å•ä¿¡æ¯ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ•°æ®ï¼Œå„ç§å„æ ·çš„ç¯å¢ƒï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œåœ¨æˆ‘ä»¬çš„çº¿ä¸Šåº”ç”¨å½“ä¸­ï¼Œå­˜åœ¨å¾ˆå¤šç”¨æˆ·ä¿¡æ¯ï¼Œä»–è´­ä¹°å•†å“ä¹Ÿå¥½ï¼Œå‘å¸–å­ä¹Ÿå¥½ï¼Œæˆ–è€…ä»–æ‰“æ¸¸æˆæ³¨å†Œå¸å·ä¹Ÿå¥½ï¼Œç­‰ç­‰ï¼Œè¿™äº›ä¸œè¥¿å…¶å®éƒ½æ˜¯ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›ä¿¡æ¯ä¿å­˜ä¸‹æ¥ï¼Œå› ä¸ºä»¥åæ¯æ¬¡ç”¨æˆ·ç™»é™†æ—¶éƒ½éœ€è¦åå¤çš„è¯»å†™ï¼Œè¯»å†™ä½ è´­ä¹°è¿‡çš„å•†å“ï¼Œè¯»å†™ä½ å‘è¿‡çš„å¸–å­ï¼Œéšç€æˆ‘ä»¬ç”¨æˆ·æ•°é‡è¶Šæ¥è¶Šå¤šï¼Œè¿™ç§ç±»ä¼¼çš„æ•°æ®ä¼šè¶Šæ¥è¶Šå¤šï¼Œä»ä¸€å¼€å§‹çš„ä¸€ä¸ªç”¨æˆ·åˆ°åé¢çš„ä¸€ä¸‡ä¸ªç”¨æˆ·ï¼Œåˆ°æˆå¹´ç´¯æœˆä¸‹æ¥ï¼Œæˆ‘ä»¬å‘ç°è®ºå›å·²ç»æœ‰äº†å‡ åƒä¸‡æ¡å¸–å­ï¼Œæ¯ä¸ªå¸–å­åˆæœ‰å¾ˆå¤šçš„å›å¤ï¼Œè¿™æ—¶å€™ä½ ä¼šå‘ç°æˆ‘ä»¬çš„æ•°æ®é‡è¶Šæ¥è¶Šå¤§ã€‚</p>
</blockquote>
<blockquote>
<p><strong>* æ•°æ®æ—©æœŸä¿å­˜çš„æ–¹å¼ï¼Œæ–‡æœ¬æ–‡ä»¶ï¼Œä»‹ç»è¯»å–æ–¹å¼ã€ä¼˜ç¼ºç‚¹ï¼Œä¸¾ä¾‹è¯´æ˜ï¼Œåšä¸€ä¸ªå°å®éªŒã€‚ *</strong><br>é‚£ä¹ˆåœ¨æ—©äº›å¹´çš„æ—¶å€™å‘¢ï¼Œæˆ‘ä»¬è¯´æœ€æ—©æ•°æ®ä¿å­˜çš„æ–¹æ³•æ˜¯æ–‡æœ¬æ–¹å¼ä¿å­˜ï¼Œæ–‡æœ¬æ–‡ä»¶ä¿å­˜ï¼Œå°±æ˜¯è¯´æˆ‘ä»¬ç½‘ç«™ä¸Šæœ‰ä¸€åƒä¸‡ä¸ªå¸–å­ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸€åƒä¸‡ä¸ªå¸–å­æ”¾åœ¨ä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£é‡Œï¼Œå½“ç”¨æˆ·ç™»é™†åè¦è¯»å¸–çš„æ—¶å€™ï¼Œå°±è¦ä»è¿™ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­å»è¯»ï¼Œåæ¥æˆ‘ä»¬å‘ç°ï¼Œå½“æ–‡æœ¬æ–‡ä»¶è¡Œæ•°æ¯”è¾ƒå°‘çš„æ—¶å€™ï¼Œå‡ ç™¾è¡Œå‡ åƒè¡Œå‡ ä¸‡è¡Œè¿˜è¡Œï¼Œè¦æ˜¯å‡ åä¸‡è¡Œå‡ ç™¾ä¸‡è¡Œçš„è¯ï¼Œä½ ä¼šå‘ç°è¯»å–çš„æ—¶å€™éå¸¸çš„æ…¢ï¼Œæ…¢çš„è¯ï¼Œæœ‰çš„æ—¶å€™éœ€è¦åŠåˆ†é’Ÿï¼Œæœ‰çš„æ—¶å€™å¯èƒ½éœ€è¦äº”åˆ†é’Ÿï¼Œç”šè‡³æœ‰æ—¶å€™åŠå°æ—¶ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾è¿™ä¸ªé€Ÿåº¦æ˜¯ä¸è¡Œçš„ï¼Œæ²¡æœ‰å“ªä¸ªç”¨æˆ·è¯´æ„¿æ„ä¸ºäº†çœ‹ä¸ªå¸–å­ï¼Œåœ¨é‚£é‡Œç­‰ä¸ªåŠå°æ—¶ã€‚çœ‹åˆ°ä½ å¸–å­å‡ºæ¥äº†ï¼Œå¥½ï¼Œå¼€å§‹å›å¸–ï¼Œç„¶åä¸€ä¸ªå›å¸–æ“ä½œå®Œæˆåˆè¦ç­‰åŠä¸ªå°æ—¶ï¼Œæ‰èƒ½çœ‹åˆ°å›å¸–çš„ç»“æœã€‚å¾ˆæ˜æ˜¾ä¸è¡Œï¼Œæ‰€ä»¥å‘¢ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ–‡æœ¬æ–‡æ¡£æ–¹å¼ä¿å­˜ä¿¡æ¯æœ‰ä¸€ä¸ªéå¸¸å¤§çš„ç¼ºç‚¹ï¼Œå°±æ˜¯æˆ‘ä»¬çš„è¯»å†™é€Ÿåº¦ï¼Œéšç€æ–‡ä»¶å†…å®¹çš„å¢åŠ ï¼Œä»–çš„è¯»å†™é€Ÿåº¦ä¼šè¶Šæ¥è¶Šæ…¢ï¼Œå…³äºè¿™ä¸€ç‚¹ï¼Œä½ ä»¬å¯ä»¥è‡ªå·±åšä¸ªå®éªŒæµ‹ä»¥ä¸‹ï¼Œå†™ä¸ªå‡ åä¸‡è¡Œçš„æ•°æ®2-3ä¸ªGï¼Œè¿‡æ»¤å‡ºæŸä¸€è¡Œï¼Œæˆ–è€…è¯»ä¸€ä¸‹ï¼Œçœ‹çœ‹è¦èŠ±å¤šä¸Šå¤šå°‘æ—¶é—´ã€‚</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">touch /tmp/a</span><br><span class="line">for i in `seq 1 500000 `</span><br><span class="line">do</span><br><span class="line">	sed -n '1,$r /var/log/messages' /tmp/a</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>* æˆ‘ä»¬å¸Œæœ›çš„æ•°æ®è¯»å–æ–¹å¼æ˜¯æ€æ ·çš„å‘¢ï¼Ÿå¼•å‡ºæ•°æ®åº“çš„æ¦‚å¿µã€‚ *</strong><br>æˆ‘ä»¬åœ¨æ“ä½œè¿‡ç¨‹çš„å½“ä¸­ï¼Œå¹¶ä¸å¸Œæœ›æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½è¯»å–å‡ºæ¥ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘å¯èƒ½åªéœ€è¦è¯»å–å…¶ä¸­çš„ä¸€è¡Œï¼Œè€Œæ–‡æœ¬æ–‡æ¡£çš„æ“ä½œå‘½ä»¤ï¼Œå±äºç‰›æ“ä½œï¼Œä»–éœ€è¦ä»å¤´éƒ¨å¼€å§‹åšï¼Œå¾ˆå¤šæ—¶å€™ä»–è¿‡æ»¤çš„è¯éƒ½ä¼šä»å¤´åˆ°å°¾å¯»æ‰¾ä¸€éï¼Œæ‰èƒ½æ‰¾åˆ°ä½ éœ€è¦çš„é‚£ä¸€è¡Œæ•°æ®ï¼Œæˆ–è€…å¤šè¡Œæ•°æ®ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šæå¤§åœ°æ¶ˆè€—æ€§èƒ½ã€‚æˆ‘ä»¬å¸Œæœ›å®ç°çš„æ•ˆæœæ˜¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å–å…¶ä¸­çš„å‡ è¡Œï¼Œåˆ™è¿…é€Ÿåœ°å®šä½åˆ°é‚£å‡ è¡Œæ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä¸å•è¦çŸ¥é“æ–‡æœ¬æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ï¼Œæˆ‘è¿˜çŸ¥é“æ–‡æœ¬æ–‡ä»¶å½“ä¸­æ¯ä¸€è¡Œæ‰€åœ¨çš„ç³»ç»Ÿçš„ä½ç½®ï¼Œä¸å•æ˜¯ç³»ç»Ÿè¿˜æœ‰ç¡¬ç›˜ä¸Šçš„ä½ç½®ï¼Œä»–åœ¨ç¡¬ç›˜çš„ç¬¬å‡ ä¸ªç£é“ï¼Œç¬¬å‡ ä¸ªæ‰‡åŒºï¼Œæˆ‘è¦ç¬¬åè¡Œåˆ°å“ªé‡Œå»æ‰¾ï¼Œå–ç¬¬1000è¡Œåˆ°å“ªé‡Œå»æ‰¾ï¼Œä¸éœ€è¦ä»å¤´éƒ¨å»æ‰¾ï¼Œè¿™æ˜¯ä¸€ç§æ–‡ä»¶çš„æ“ä½œæ–¹æ³•ï¼Œæˆ–è€…æ˜¯æ•°æ®çš„æ“ä½œæ–¹æ³•ï¼Œäºæ˜¯å°±æœ‰äº†æˆ‘ä»¬çš„æ•°æ®åº“ã€‚</p>
</blockquote>
<p>æ•°æ®åº“å¦‚æœè¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œåœ¨å‡ åGçš„æ–‡ä»¶ä¸­è¿…é€Ÿå®šä½åˆ°ä½ éœ€è¦çš„æ•°æ®ï¼Œä»–éœ€è¦** ç´¢å¼•**ï¼Œæ‰€ä»¥å°½é‡å»ä¿å­˜å¯ç´¢å¼•æ•°æ®ï¼Œè¿™æ ·æ‰ä¼šè®©è¯»å†™æ€§èƒ½æœ‰æ‰€æé«˜ã€‚ä½†æ˜¯æ€»ä¼šæœ‰äººæŠŠå›¾ç‰‡è§†é¢‘ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰æ”¾åˆ°æ•°æ®åº“ä¸­ï¼Œæ•°æ®åº“æ˜¯æ²¡åŠæ³•å¯¹äºŒè¿›åˆ¶æ–‡ä»¶å†…å®¹åšç´¢å¼•çš„ã€‚æ•°æ®åˆ†å¯ç´¢å¼•æ•°æ®å’Œä¸å¯ç´¢å¼•æ•°æ®ã€‚ä½†ä¹Ÿä¸æ˜¯è¯´äºŒè¿›åˆ¶æ•°æ®å°±ä¸èƒ½æ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œåªæ˜¯è¯´æ”¾è¿›å»å¯¹æ€§èƒ½æ²¡æœ‰æé«˜ã€‚æ¯”å¦‚è¯´åšä¸ªè®ºå›ï¼Œå¦‚æœå‘å¸–æœ‰é™„ä»¶ï¼Œé‚£ä¹ˆé™„ä»¶æ˜¯ä¸Šä¼ åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„ï¼Œåœ¨åšå¤‡ä»½çš„æ—¶å€™ï¼Œæ•°æ®åº“è¦å¤‡ä»½ï¼Œç½‘ç«™æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶è¦å¤‡ä»½ï¼Œæœ‰äººå‘¢å°±å·æ‡’å°†æ‰€æœ‰æ•°æ®éƒ½æ”¾åˆ°æ•°æ®åº“ä¸‹ï¼Œå¤‡ä»½çš„æ—¶å€™å°±åªè¦å¤‡ä»½æ•°æ®åº“äº†ï¼Œä½†æ˜¯æˆ‘ä¸å»ºè®®è¿™ä¹ˆåšï¼Œå› ä¸ºæœ¬èº«æ•°æ®åº“å·²ç»å¾ˆå¤§äº†ï¼Œä½ å†æŠŠè¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶å¾€é‡Œé¢æ”¾ä¼šå¯¼è‡´æ•°æ®åº“æ›´å¤§ï¼Œæ›´åŠ è‡ƒè‚¿ã€‚è€Œä¸”æ•°æ®åº“æœ¬èº«æœ‰å¾ˆå¤šç¼“å†²ï¼Œä½ æ”¾çš„æ–‡ä»¶å¤ªå¤§ï¼Œç¼“å†²å°±ç”¨å¾—å¤šï¼Œç¼“å†²ç”¨çš„å¤šï¼Œå†…å­˜æ¶ˆè€—å¤§ï¼Œæ•°æ®åº“çš„æ€§èƒ½æ¶ˆè€—ä¼šæ˜æ˜¾ä¸Šå‡ã€‚æ‰€ä»¥è‡ªå·±å»çœ‹ï¼Œå°½é‡ä¸è¦å»ä¿å­˜ä¸å¯ç´¢å¼•çš„æ•°æ®ã€‚</p>
<h3 id="æ•°æ®åº“çš„åˆ†ç±»"><a href="#æ•°æ®åº“çš„åˆ†ç±»" class="headerlink" title="æ•°æ®åº“çš„åˆ†ç±»"></a>æ•°æ®åº“çš„åˆ†ç±»</h3><p>|æ•°æ®åº“ç±»å‹|æè¿°|ä¸»æµäº§å“|æœ‰è°åœ¨ç”¨|é€‚ç”¨åœºæ™¯|ä¸é€‚ç”¨åœºæ™¯|<br>|:â€“|:â€“|:â€“|:â€“|:â€“|:â€“|:â€“|<br>|å…³ç³»å‹æ•°æ®åº“|å…³ç³»å‹æ•°æ®åº“å°±æ˜¯ç”±äºŒç»´è¡¨åŠå…¶ä¹‹é—´çš„è”ç³»ç»„æˆçš„ä¸€ä¸ªæ•°æ®ç»„ç»‡|Oracleã€DB2ã€PostgreSQLã€Microsoft SQL Serverã€Microsoft Accessã€MySQLã€MariaDB|alibaba,sina,ç½‘æ˜“ï¼Œyoutubeï¼Œgoogleç­‰|ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ï¼ˆäº‹åŠ¡å¤„ç†ï¼‰ï¼›ç”±äºä»¥æ ‡å‡†åŒ–ä¸ºå‰æï¼Œæ•°æ®æ›´æ–°çš„å¼€é”€å¾ˆå°ï¼ˆç›¸åŒçš„å­—æ®µåŸºæœ¬ä¸Šéƒ½åªæœ‰ä¸€å¤„ï¼‰ï¼›å¯ä»¥è¿›è¡ŒJoinç­‰å¤æ‚æŸ¥è¯¢ï¼›èƒ½å¤Ÿä¿æŒæ•°æ®çš„ä¸€è‡´æ€§æ˜¯å…³ç³»å‹æ•°æ®åº“çš„æœ€å¤§ä¼˜åŠ¿|å¤§é‡æ•°æ®çš„å†™å…¥å¤„ç†ï¼›ä¸ºæœ‰æ•°æ®æ›´æ–°çš„è¡¨åšç´¢å¼•æˆ–è¡¨ç»“æ„(schema)å˜æ›´ï¼›å­—æ®µä¸å›ºå®šæ—¶åº”ç”¨ï¼›å¯¹ç®€å•æŸ¥è¯¢éœ€è¦å¿«é€Ÿè¿”å›ç»“æœçš„å¤„ç†|<br>|é”®å€¼ï¼ˆKey-Valueï¼‰æ•°æ®åº“|é”®å€¼æ•°æ®åº“å°±åƒåœ¨ä¼ ç»Ÿè¯­è¨€ä¸­ä½¿ç”¨çš„å“ˆå¸Œè¡¨ã€‚ä½ å¯ä»¥é€šè¿‡ key æ¥æ·»åŠ ã€æŸ¥è¯¢æˆ–è€…åˆ é™¤æ•°æ®ï¼Œé‰´äºä½¿ç”¨ä¸»é”®è®¿é—®ï¼Œæ‰€ä»¥ä¼šè·å¾—ä¸é”™çš„æ€§èƒ½åŠæ‰©å±•æ€§ã€‚|Riakã€Redisã€Memcachedã€Amazonâ€™s Dynamoã€Project Voldemort|    GitHub ï¼ˆRiakï¼‰ã€BestBuy ï¼ˆRiakï¼‰ã€Twitter ï¼ˆRediså’ŒMemcachedï¼‰ã€StackOverFlow ï¼ˆRedisï¼‰ã€ Instagram ï¼ˆRedisï¼‰ã€Youtube ï¼ˆMemcachedï¼‰ã€Wikipediaï¼ˆMemcachedï¼‰|å‚¨å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯”å¦‚ä¼šè¯ã€é…ç½®æ–‡ä»¶ã€å‚æ•°ã€è´­ç‰©è½¦ç­‰ç­‰ã€‚è¿™äº›ä¿¡æ¯ä¸€èˆ¬éƒ½å’Œ IDï¼ˆé”®ï¼‰æŒ‚é’©ï¼Œè¿™ç§æƒ…æ™¯ä¸‹é”®å€¼æ•°æ®åº“æ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚    |1. å–ä»£é€šè¿‡é”®æŸ¥è¯¢ï¼Œè€Œæ˜¯é€šè¿‡å€¼æ¥æŸ¥è¯¢ã€‚Key-Value æ•°æ®åº“ä¸­æ ¹æœ¬æ²¡æœ‰é€šè¿‡å€¼æŸ¥è¯¢çš„é€”å¾„ã€‚2. éœ€è¦å‚¨å­˜æ•°æ®ä¹‹é—´çš„å…³ç³»ã€‚åœ¨ Key-Value æ•°æ®åº“ä¸­ä¸èƒ½é€šè¿‡ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„é”®æ¥å…³è”æ•°æ®ã€‚3. äº‹åŠ¡çš„æ”¯æŒã€‚åœ¨ Key-Value æ•°æ®åº“ä¸­æ•…éšœäº§ç”Ÿæ—¶ä¸å¯ä»¥è¿›è¡Œå›æ»šã€‚|<br>|é¢å‘æ–‡æ¡£ï¼ˆDocument-Orientedï¼‰æ•°æ®åº“|    é¢å‘æ–‡æ¡£æ•°æ®åº“ä¼šå°†æ•°æ®ä»¥æ–‡æ¡£çš„å½¢å¼å‚¨å­˜ã€‚æ¯ä¸ªæ–‡æ¡£éƒ½æ˜¯è‡ªåŒ…å«çš„æ•°æ®å•å…ƒï¼Œæ˜¯ä¸€ç³»åˆ—æ•°æ®é¡¹çš„é›†åˆã€‚æ¯ä¸ªæ•°æ®é¡¹éƒ½æœ‰ä¸€ä¸ªåç§°ä¸å¯¹åº”çš„å€¼ï¼Œå€¼æ—¢å¯ä»¥æ˜¯ç®€å•çš„æ•°æ®ç±»å‹ï¼Œå¦‚å­—ç¬¦ä¸²ã€æ•°å­—å’Œæ—¥æœŸç­‰ï¼›ä¹Ÿå¯ä»¥æ˜¯å¤æ‚çš„ç±»å‹ï¼Œå¦‚æœ‰åºåˆ—è¡¨å’Œå…³è”å¯¹è±¡ã€‚æ•°æ®å­˜å‚¨çš„æœ€å°å•ä½æ˜¯æ–‡æ¡£ï¼ŒåŒä¸€ä¸ªè¡¨ä¸­å­˜å‚¨çš„æ–‡æ¡£å±æ€§å¯ä»¥æ˜¯ä¸åŒçš„ï¼Œæ•°æ®å¯ä»¥ä½¿ç”¨ XMLã€JSON æˆ–è€… JSONB ç­‰å¤šç§å½¢å¼å­˜å‚¨ã€‚    |MongoDBã€CouchDBã€RavenDB|    SAP ï¼ˆMongoDBï¼‰ã€Codecademy ï¼ˆMongoDBï¼‰ã€Foursquare ï¼ˆMongoDBï¼‰ã€NBC News ï¼ˆRavenDBï¼‰    |1. æ—¥å¿—ã€‚ä¼ä¸šç¯å¢ƒä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸åŒçš„æ—¥å¿—ä¿¡æ¯ã€‚Document-Oriented æ•°æ®åº“å¹¶æ²¡æœ‰å›ºå®šçš„æ¨¡å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒå‚¨å­˜ä¸åŒçš„ä¿¡æ¯ã€‚2. åˆ†æã€‚é‰´äºå®ƒçš„å¼±æ¨¡å¼ç»“æ„ï¼Œä¸æ”¹å˜æ¨¡å¼ä¸‹å°±å¯ä»¥å‚¨å­˜ä¸åŒçš„åº¦é‡æ–¹æ³•åŠæ·»åŠ æ–°çš„åº¦é‡ã€‚|åœ¨ä¸åŒçš„æ–‡æ¡£ä¸Šæ·»åŠ äº‹åŠ¡ã€‚Document-Oriented æ•°æ®åº“å¹¶ä¸æ”¯æŒæ–‡æ¡£é—´çš„äº‹åŠ¡ï¼Œå¦‚æœå¯¹è¿™æ–¹é¢æœ‰éœ€æ±‚åˆ™ä¸åº”è¯¥é€‰ç”¨è¿™ä¸ªè§£å†³æ–¹æ¡ˆã€‚|<br>|åˆ—å­˜å‚¨ï¼ˆWide Column Store/Column-Familyï¼‰æ•°æ®åº“|    åˆ—å­˜å‚¨æ•°æ®åº“å°†æ•°æ®å‚¨å­˜åœ¨åˆ—æ—ï¼ˆcolumn familyï¼‰ä¸­ï¼Œä¸€ä¸ªåˆ—æ—å­˜å‚¨ç»å¸¸è¢«ä¸€èµ·æŸ¥è¯¢çš„ç›¸å…³æ•°æ®ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ª Person ç±»ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä¸€èµ·æŸ¥è¯¢ä»–ä»¬çš„å§“åå’Œå¹´é¾„è€Œä¸æ˜¯è–ªèµ„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå§“åå’Œå¹´é¾„å°±ä¼šè¢«æ”¾å…¥ä¸€ä¸ªåˆ—æ—ä¸­ï¼Œè€Œè–ªèµ„åˆ™åœ¨å¦ä¸€ä¸ªåˆ—æ—ä¸­ã€‚    |Cassandraã€HBase|    Ebay ï¼ˆCassandraï¼‰ã€Instagram ï¼ˆCassandraï¼‰ã€NASA ï¼ˆCassandraï¼‰ã€Twitter ï¼ˆCassandra and HBaseï¼‰ã€Facebook ï¼ˆHBaseï¼‰ã€Yahoo!ï¼ˆHBaseï¼‰|    1. æ—¥å¿—ã€‚å› ä¸ºæˆ‘ä»¬å¯ä»¥å°†æ•°æ®å‚¨å­˜åœ¨ä¸åŒçš„åˆ—ä¸­ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥å°†ä¿¡æ¯å†™å…¥è‡ªå·±çš„åˆ—æ—ä¸­ã€‚2. åšå®¢å¹³å°ã€‚æˆ‘ä»¬å‚¨å­˜æ¯ä¸ªä¿¡æ¯åˆ°ä¸åŒçš„åˆ—æ—ä¸­ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ ‡ç­¾å¯ä»¥å‚¨å­˜åœ¨ä¸€ä¸ªï¼Œç±»åˆ«å¯ä»¥åœ¨ä¸€ä¸ªï¼Œè€Œæ–‡ç« åˆ™åœ¨å¦ä¸€ä¸ªã€‚|    1. å¦‚æœæˆ‘ä»¬éœ€è¦ ACID äº‹åŠ¡ã€‚Vassandra å°±ä¸æ”¯æŒäº‹åŠ¡ã€‚2. åŸå‹è®¾è®¡ã€‚å¦‚æœæˆ‘ä»¬åˆ†æCassandra çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°ç»“æ„æ˜¯åŸºäºæˆ‘ä»¬æœŸæœ›çš„æ•°æ®æŸ¥è¯¢æ–¹å¼è€Œå®šã€‚åœ¨æ¨¡å‹è®¾è®¡ä¹‹åˆï¼Œæˆ‘ä»¬æ ¹æœ¬ä¸å¯èƒ½å»é¢„æµ‹å®ƒçš„æŸ¥è¯¢æ–¹å¼ï¼Œè€Œä¸€æ—¦æŸ¥è¯¢æ–¹å¼æ”¹å˜ï¼Œæˆ‘ä»¬å°±å¿…é¡»é‡æ–°è®¾è®¡åˆ—æ—ã€‚|<br>|å›¾ï¼ˆGraph-Orientedï¼‰æ•°æ®åº“    |å›¾æ•°æ®åº“å…è®¸æˆ‘ä»¬å°†æ•°æ®ä»¥å›¾çš„æ–¹å¼å‚¨å­˜ã€‚å®ä½“ä¼šè¢«ä½œä¸ºé¡¶ç‚¹ï¼Œè€Œå®ä½“ä¹‹é—´çš„å…³ç³»åˆ™ä¼šè¢«ä½œä¸ºè¾¹ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸‰ä¸ªå®ä½“ï¼ŒSteve Jobsã€Apple å’Œ Nextï¼Œåˆ™ä¼šæœ‰ä¸¤ä¸ªâ€œFounded byâ€çš„è¾¹å°† Apple å’Œ Next è¿æ¥åˆ° Steve Jobsã€‚    |Neo4Jã€Infinite Graphã€OrientDB    |Adobe ï¼ˆNeo4Jï¼‰ã€Cisco ï¼ˆNeo4Jï¼‰ã€T-Mobile ï¼ˆNeo4Jï¼‰    |1. åœ¨ä¸€äº›å…³ç³»æ€§å¼ºçš„æ•°æ®ä¸­2. æ¨èå¼•æ“ã€‚å¦‚æœæˆ‘ä»¬å°†æ•°æ®ä»¥å›¾çš„å½¢å¼è¡¨ç°ï¼Œé‚£ä¹ˆå°†ä¼šéå¸¸æœ‰ç›Šäºæ¨èçš„åˆ¶å®š    ä¸é€‚åˆçš„æ•°æ®æ¨¡å‹ã€‚å›¾æ•°æ®åº“çš„é€‚ç”¨èŒƒå›´å¾ˆå°ï¼Œå› ä¸ºå¾ˆå°‘æœ‰æ“ä½œæ¶‰åŠåˆ°æ•´ä¸ªå›¾ã€‚|</p>
<p>å…³ç³»æ¨¡å‹å°±æ˜¯æŒ‡äºŒç»´è¡¨æ ¼æ¨¡å‹,å› è€Œä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“å°±æ˜¯ç”±äºŒç»´è¡¨åŠå…¶ä¹‹é—´çš„è”ç³»ç»„æˆçš„ä¸€ä¸ªæ•°æ®ç»„ç»‡ã€‚å½“å‰ä¸»æµçš„å…³ç³»å‹æ•°æ®åº“æœ‰<code>Oracleã€DB2ã€PostgreSQLã€Microsoft SQL Serverã€Microsoft Accessã€MySQLã€MariaDBã€æµªæ½®K-DB</code>ç­‰ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯MySQL"><a href="#ä»€ä¹ˆæ˜¯MySQL" class="headerlink" title="ä»€ä¹ˆæ˜¯MySQL"></a>ä»€ä¹ˆæ˜¯MySQL</h3><p>ä»€ä¹ˆæ˜¯mysqlï¼Ÿæ‘˜è‡ªå®˜æ–¹çš„ä¸€ä¸ªè§£é‡Šï¼Œè¯´ ** â€œMySQL æ˜¯é‡‡ç”¨å®¢æˆ·/æœåŠ¡å™¨æ¨¡å‹çš„å¼€æ”¾æºç å…³ç³»å‹ SQL æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ,å®ƒ å¯ä»¥åœ¨å¤šç§æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œ,å®ƒæ˜¯ç”± MySQL Ab å…¬å¸å¼€å‘ã€å‘å¸ƒå¹¶æ”¯æŒçš„ï¼Œåè¢«sunæ”¶è´­ï¼Œç°åœ¨åœ¨oracleå…¬å¸æ——ä¸‹ï¼Œç°åœ¨æœ‰ä¸€ä¸ªçŸ¥åçš„åˆ†æ”¯MariaDBã€‚â€ ** ç¨å¾®æœ‰ç‚¹é•¿ï¼Œæˆ‘ä»¬ä¸€æ®µä¸€æ®µæ¥è§£é‡Šï¼Œé‡Œé¢æœ‰ä¸€äº›å…³é”®ç‚¹ï¼Œèƒ½å¤Ÿå¸®åŠ©ä½ éå¸¸æœ‰æ•ˆåœ°å»ç†è§£MySQLã€‚</p>
<p><strong>* ç¬¬ä¸€ä¸ªè¦ç‚¹ï¼Œå®¢æˆ·/æœåŠ¡å™¨æ¨¡å‹ã€‚ *</strong></p>
<blockquote>
<p>é€šè¿‡C/Så’ŒB/Sçš„å¯¹æ¯”å»ä»‹ç»ä¸ºä»€ä¹ˆmysqlé€‰æ‹©c/sæ¨¡å‹ï¼Œåˆ†åˆ«ä»æ–¹ä¾¿ã€æ€§èƒ½ã€ç¨³å®šã€å®‰å…¨å››ä¸ªæ–¹é¢æ¥è®²ã€‚</p>
</blockquote>
<p>mysqlæ˜¯ä¸€ä¸ªc/sæ¨¡å‹åœ°ä¸€å¥—åº”ç”¨ç¨‹åºï¼Œå…¶å®è®²åˆ°c/sæ¨¡å‹å¤§å®¶å°±ä¼šè”æƒ³åˆ°ï¼Œb/sæ¨¡å‹ï¼Œc/så«åšå®¢æˆ·ç«¯/æœåŠ¡å™¨ï¼Œb/så«åšæµè§ˆå™¨/æœåŠ¡å™¨ã€‚æœåŠ¡å™¨è¿˜æ˜¯æœåŠ¡å™¨ï¼Œåªä¸è¿‡å®¢æˆ·ç«¯æ˜¯è£…ä¸€ä¸ªåº”ç”¨æœåŠ¡å‘¢ï¼Œè¿˜æ˜¯ç›´æ¥ç”¨æµè§ˆå™¨ã€‚é‚£ä¹ˆä¸¤ç§æ¨¡å‹å‘¢å„æœ‰ä¼˜åŠ£ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼Œé‚£ä½¿ç”¨æµè§ˆå™¨æ˜¯æ›´æ–¹ä¾¿çš„ï¼Œå› ä¸ºä¸ç®¡ä»€ä¹ˆç³»ç»Ÿéƒ½è‡ªå¸¦æµè§ˆå™¨ï¼Œæ¯”å¦‚æ‰‹æœºè‡ªå¸¦ã€padè‡ªå¸¦ï¼Œå„ç§ç¯å¢ƒéƒ½æœ‰æµè§ˆå™¨ï¼Œè¿™ç§æƒ…å†µæ¯”è¾ƒæ–¹ä¾¿ï¼›ä½†æ˜¯æµè§ˆå™¨ä¸»è¦é€šè¿‡ç½‘ç»œï¼Œé‚£ä¹ˆæ€§èƒ½ã€ç¨³å®šã€å®‰å…¨æ€§å°±ä¼šå—åˆ°ä¸€å®šåœ°å½±å“ã€‚è€Œc/sæ¨¡å‹å°±ä¸æ˜¯ï¼Œæˆ‘è£…ä¸€ä¸ªå®¢æˆ·ç«¯è½¯ä»¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯åœ°é€šä¿¡æ˜¯èµ°è‡ªå·±ä¸“æœ‰åœ°åè®®çš„ï¼Œä»–ä»¬å¯ä»¥å®ç°ä¸€ä¸ªé«˜æ•ˆã€ç¨³å®šçš„é€šä¿¡ï¼Œæ‰€ä»¥c/sæ¨¡å‹ä»–æœ€å¤§çš„æœ‰ç‚¹æ˜¯æ€§èƒ½é«˜ã€ç¨³å®šå¥½ã€åŠŸèƒ½å¤šã€å®‰å…¨æ€§å¥½ï¼Œå„ç§å„æ ·çš„ä¼˜ç‚¹ï¼Œç›¸å¯¹äºb/sæ¨¡å‹æ¥è¯´è¦è£…ä¸€ä¸ªå®¢æˆ·ç«¯è½¯ä»¶ï¼Œç”¨èµ·æ¥æ²¡æœ‰ä»–æ–¹ä¾¿ã€‚æˆ‘ä»¬mysqlç”¨çš„æ˜¯c/sæ¨¡å‹ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ˜¯è€ƒè™‘è®©ä½ ç”¨èµ·æ¥æ–¹ä¾¿ï¼Œæˆ‘ä»¬çš„å…³æ³¨ç‚¹å°±æ˜¯æ€§èƒ½æ›´åŠ é«˜æ•ˆï¼Œå…³æ³¨çš„å°±æ˜¯å®‰å…¨ï¼Œæ•°æ®åº“é‡Œé¢çš„æ•°æ®éå¸¸çš„é‡è¦ï¼Œç»å¸¸æˆ‘ä»¬çš„ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯æ”¾åœ¨æ•°æ®åº“é‡Œé¢ï¼Œæ•°æ®åº“æ³„éœ²ä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜ã€‚å¤§å®¶å¹³æ—¶åœ¨ä¸Šç½‘è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰æ›¾ç»é‡åˆ°è¿‡ä¸€äº›æƒ…å†µï¼Œæ¯”å¦‚ç™»é™†å¾®åšã€QQï¼Œç™»é™†çš„æ—¶å€™ä»–å‘Šè¯‰ä½ ï¼Œä½ çš„å¯†ç ä¸å¤Ÿå®‰å…¨ï¼Œè¦æ±‚ä½ ä¿®æ”¹å¯†ç ï¼Œä¹‹å‰æœ‰æ²¡æœ‰é‡åˆ°è¿‡ï¼Œè«åå…¶å¦™ï¼Œç™»ä¸Šæ¥å°±å‘Šè¯‰ä½ è¦ä¿®æ”¹å¯†ç ï¼Œå‡­ä»€ä¹ˆè¯´ä½ å¯†ç ä¸å®‰å…¨ï¼Œæˆ‘å‘Šè¯‰ä½ å“ªæ€•ä½ å¯†ç è®¾å¾—å†å¤æ‚ä»–ä¹Ÿä¼šè·Ÿä½ è®²ä½ çš„å¯†ç ä¸å®‰å…¨ï¼ŒåŸå› æ˜¯å› ä¸ºä»–æ•°æ®åº“æ³„éœ²è¿‡äº†ï¼Œä»–æ•°æ®åº“æ³„éœ²äº†åˆä¸èƒ½ç›´æ¥è·Ÿä½ è®²ï¼šâ€œæˆ‘æ•°æ®åº“æ³„éœ²äº†ï¼Œä½ å¿«æ”¹å¯†ç é˜¿ï¼â€ä»–ä¸èƒ½è¯´çš„ï¼Œåªèƒ½å‘Šè¯‰ä½ ä½ çš„å¯†ç ä¸å®‰å…¨ï¼Œè®©ä½ æ”¹ã€‚å¦‚æœä½ æ²¡æœ‰ä¿®æ”¹ï¼Œå¾ˆå¯èƒ½å°±ä¼šè¢«ç›—å·äº†ã€‚ä»è¿™ä¸ªä¾‹å­æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“æ•°æ®åº“çš„å®‰å…¨æ€§é—®é¢˜çš„é‡è¦æ€§ã€‚åŒ…æ‹¬å»å¹´å¾ˆç«çš„ï¼Œéå¸¸å‡ºåçš„ä¸€ä»¶äº‹ï¼Œ12306æ•°æ®åº“æ³„éœ²ï¼Œå¤§å®¶ä¹°è¿‡çš„ç«è½¦ç¥¨ï¼Œä¹°ç«è½¦ç¥¨æ—¶ä½¿ç”¨çš„èº«ä»½è¯ã€ç”¨æˆ·åã€å¯†ç ã€é“¶è¡Œä¿¡æ¯å°±éƒ½æ³„éœ²äº†ï¼Œæ³„éœ²äº†å¤§æ¦‚åå‡ ä¸ªGçš„ç”¨æˆ·ä¿¡æ¯ï¼ŒçŸ¥é“å—ï¼Ÿåœ¨12306ä¸Šä¹°è¿‡ç«è½¦ç¥¨å—ï¼Ÿä¹°è¿‡ï¼Œé‚£å¾ˆå¯èƒ½ä½ çš„èº«ä»½è¯ä¿¡æ¯å·²ç»è¢«æ³„éœ²äº†ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œè®²æ•°æ®åº“å…³æ³¨çš„ç‚¹ï¼Œä¸æ˜¯è®©ä½ ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼Œè€Œæ˜¯è¦ä¿è¯æ€§èƒ½ã€å®‰å…¨ã€ç¨³å®šã€‚ç¨³å®šä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„åœ°æ–¹ï¼Œæ•°æ®åº“ä¸èƒ½å‡ºé”™ï¼Œä¸èƒ½è¯´è¿ç€è¿ç€ï¼Œä¸€ä¼šè¿ä¸ä¸Šäº†ã€‚ä»Šå¤©å»å­˜é’±ï¼Œå­˜å®Œé’±æ˜å¤©å»å–é’±ï¼Œå­˜äº†å¤šå°‘é’±ä¸çŸ¥é“ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ•°æ®åº“æ²¡è¿ä¸Šï¼Œä½ æ˜¨å¤©å­˜çš„é’±æˆ‘æ‰¾ä¸åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªç¨³å®šæ€§ã€‚ä½ è¦ä¿è¯æ•°æ®åº“7*24å°æ—¶åœ¨çº¿è¿è¡Œï¼Œä¸èƒ½å‡ºä»»ä½•é—®é¢˜ã€‚å¥½è¿™å°±æ˜¯æˆ‘ä»¬è®²çš„c/sæ¨¡å‹ã€‚</p>
<p><strong>* ç¬¬äºŒä¸ªè¦ç‚¹ï¼Œå¼€æ”¾æºç ã€‚ *</strong></p>
<blockquote>
<p>ä»‹ç»open sourceå’Œclosed sourceçš„æ¦‚å¿µå’ŒåŒºåˆ«ï¼Œä»‹ç»mysqlçš„å¼€æºç†å¿µä»¥åŠå†å²ï¼Œä»‹ç»â€œå»IOEâ€ä»¥åŠMariadbçš„è¯ç”Ÿã€‚</p>
</blockquote>
<p>ä»€ä¹ˆå«åšå¼€æºï¼Ÿopen sourceå’Œä»–ç›¸å¯¹åº”çš„å°±æ˜¯é—­æºclosed sourceåº”ç”¨ï¼Œé—­æºçš„ä¸œè¥¿åˆå«åšcopyrightï¼ˆç‰ˆæƒã€è‘—ä½œæƒï¼‰ï¼Œå¾®è½¯çš„ä¸œè¥¿ä¸€èˆ¬éƒ½æ˜¯copyrightï¼›è€Œå¼€æºçš„å«åšcopyleftï¼ˆéç›ˆåˆ©ç‰ˆæƒï¼Œå…¬å…±ç‰ˆæƒï¼‰ã€‚å…¬å¸èµšé’±æœ‰ä¸¤ä¸ªå¤§çš„æµæ´¾ï¼Œä¸€ä¸ªæµæ´¾å°±æ˜¯ä»¥å¾®è½¯ã€oracleä¸ºé¦–çš„é—­æºè½¯ä»¶èµ·å®¶çš„ï¼Œä»–ä»¬è®¤ä¸ºç¨‹åºå†™å®Œä¹‹åä½ å¾—æ‹¿å»å–ï¼Œå–ä»£ç æ¥èµšé’±ï¼Œæˆ‘å–ç»™ä½ ä½¿ç”¨ï¼Œä½ ç»™æˆ‘é’±ï¼Œè¿™æ ·çš„è¯å‘¢ï¼Œæˆ‘æ‰èƒ½æ´»å¾—æ›´æ»‹æ¶¦ä¸€ç‚¹ï¼›å¼€æºåº”ç”¨ä¸æ˜¯ï¼Œä»–è®¤ä¸ºæˆ‘ç¨‹åºå†™å®Œä¹‹åï¼Œå¯ä»¥å…è´¹ç»™ä½ ä½¿ç”¨ï¼Œç„¶åä½ è¦æ˜¯è§‰å¾—æœ‰é—®é¢˜ï¼Œä½ å‘Šè¯‰æˆ‘ä½ åšè¿‡çš„ä¿®æ”¹ï¼Œä½ ä¹Ÿåº”è¯¥æŠŠä»–å¼€æºå‡ºæ¥ï¼Œæˆ‘ä»¬å¼€æºçš„äººè¶Šå¤šï¼Œä¿®æ”¹çš„äººè¶Šå¤šï¼Œç¨‹åºå°±ä¼šè¶Šåšè¶Šå¥½ï¼Œä¸åå¯¹ä½ èµšé’±ï¼Œä½†æ˜¯ä½ èµšé’±çš„æ”¶å…¥ç‚¹ä¸æ˜¯åœ¨ç¨‹åºæœ¬èº«ï¼Œè€Œæ˜¯åœ¨äºä½ åæœŸæ‰€æä¾›çš„æœåŠ¡ï¼Œæä¾›çš„ä¸€äº›é¢å¤–çš„æ“ä½œï¼Œè¿™æ˜¯å¼€æºé¢†åŸŸçš„ä¸€äº›ç†å¿µï¼Œä»¥redhatä¸ºé¦–ï¼Œä»–å°±æ˜¯ä»¥å¼€æºä¸ºç›®æ ‡çš„ã€‚<br>mysqlå¼€å§‹è®¾è®¡çš„æ—¶å€™ï¼Œå°±æ˜¯ä¸€ä¸ªå¼€æºäº§å“ï¼Œå½“ç„¶è¿™æ˜¯ä»¥å‰çš„äº‹æƒ…äº†ï¼Œmysqlå½“å¹´æ˜¯å¼€æºçš„ï¼Œç„¶åè¢«æ”¶è´­äº†ï¼Œå…¶å®æˆ‘ä»¬è¯´é˜¿ï¼Œåšå¼€æºçš„äººå‘¢ï¼Œèµšé’±æœ€å¥½çš„æ–¹å¼å°±æ˜¯æ‰¾äººæŠŠä»–ç»™æ”¶äº†ï¼Œæ”¶è´­çš„è¯åŸºæœ¬ä¸Šèƒ½èµšä¸€å¤§ç¥¨ï¼Œæ”¶è´­mysqlçš„æ˜¯å½“æ—¶æ¯”è¾ƒè‘—åçš„sunå…¬å¸ï¼Œæœ‰å¾ˆå¤šéå¸¸ç»å…¸çš„äº§å“éƒ½æ˜¯sunå¼€å‘å‡ºæ¥çš„ï¼Œæ¯”å¦‚ä»–çš„javaç¼–ç¨‹è¯­è¨€ã€‚é™¤äº†javaè¯­è¨€ä»¥å¤–sunå…¬å¸è¿˜å¼€å‘è¿‡å¾ˆå¤šç»å…¸çš„æŠ€æœ¯ï¼Œé‚£ä¹ˆsunå…¬å¸çš„è¯ï¼Œæœ‰é’±æœ‰å®åŠ›ï¼Œä½†æ˜¯å‘¢ä¸å¤ªä¼šç»è¥ï¼Œæœ€åå°±å€’é—­äº†ï¼Œç„¶åè¢«å¦å¤–ä¸€å®¶æ”¶è´­ï¼Œç°åœ¨mysqlæ‰€å±äºoracleã€‚å½“å¹´æ”¶è´­å®Œmysqlä¹‹åå‘¢ï¼Œä»–è§‰å¾—ï¼Œæˆ‘çš„oracleäº§å“é¢å‘äºå¤§å‹çš„å…¬å¸ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªäº§å“æ¥å¼¥è¡¥ä¸­çš„ç«¯ä¼ä¸šçš„ç©ºç¼ºï¼Œäºæ˜¯ä»–å°±æ”¶è´­äº†mysqlï¼Œæ”¶è´­å®Œä¹‹åæœ¬èº«è§‰å¾—æ²¡ä»€ä¹ˆä½éš¾é¢˜ï¼Œåæ¥mysqlåœ¨oracleçš„å¸¦é¢†ä¸‹è¶Šåšè¶Šå¥½ï¼Œå› ä¸ºoracleåœ¨æ•°æ®åº“é¢†åŸŸç®—å¾—ä¸Šæ˜¯æ’åç¬¬ä¸€äº†ã€‚ä»–æœ‰å¾ˆå¤šä¸“æœ‰çš„æ•°æ®åº“æŠ€æœ¯ï¼Œèƒ½å¤Ÿè®©æ•°æ®åœ¨è¯»å†™è¿‡ç¨‹å½“ä¸­ï¼Œæ€§èƒ½éå¸¸é«˜ï¼Œç„¶ååˆæœ‰é«˜å¯ç”¨ï¼Œæœ‰å¾ˆå¤šçš„æœ‰ç‚¹ï¼Œmysqlè¶Šåšè¶Šå¥½ï¼Œå¥½åˆ°ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Ÿä¸å•å•æ˜¯ä¸­å°å‹ä¼ä¸šåœ¨ç”¨ï¼Œå¤§å‹ä¼ä¸šä¹Ÿå¼€å§‹ç”¨mysqlï¼Œç”¨ä¸‹æ¥è§‰å¾—æ¯”oracleè¦å¥½ï¼Œå‡ºç°è¿™ç§ç°è±¡ï¼Œä»¥è‡³äºæˆ‘ä»¬åœ¨å‰å‡ å¹´çš„æ—¶å€™æœ‰äººæå‡ºäº†ä¸€ä¸ªï¼Œä¿—ç§°ä¸ºITç•Œçš„é©å‘½ï¼Œå«åšâ€œå»IOEâ€ã€‚<br>ä»€ä¹ˆå«åšâ€œå»IOEâ€å‘¢ï¼Ÿä¸‰ä¸ªéå¸¸è‘—åçš„å…¬å¸ï¼ŒIBMã€ORACLEã€EMCï¼Œè¿™ä¸‰ä¸ªå…¬å¸æœ‰ä¸šç•Œä¸€æµçš„äº§å“ï¼ŒIBMæœ‰ä»–çš„å°å‹æœºï¼Œä»æœåŠ¡å™¨çš„æ€§èƒ½ä¸Šæ¥è®²å°å‹æœºå·²ç»ç®—æ˜¯é¡¶å°–çš„ï¼Œæ¯”ä½ çš„pc serverè¦å¥½çš„å¤šï¼›ç„¶åoracleçš„æ•°æ®ä¸šç•Œé¡¶å°–çš„ï¼›EMCçš„å­˜å‚¨è®¾å¤‡ä¹Ÿæ˜¯ä¸šç•Œé¡¶å°–çš„ã€‚ç»å¸¸å‘¢æœ‰å…¬å¸è¯´æˆ‘çš„å‹åŠ›ç‰¹åˆ«å¤§ï¼Œæˆ‘éœ€è¦å»ä¹°æœ€å¥½çš„ç¡¬ä»¶ï¼Œå°±ä¹°è¿™ä¸‰å®¶å…¬å¸çš„ï¼Œæ”¾åœ¨ä¸€èµ·ç»„æˆä¸€å¥—æ€§èƒ½éå¸¸å¼ºå¤§çš„è¿™ä¹ˆä¸€å¥—ç¡¬ä»¶ç¯å¢ƒã€‚åæ¥è¿™äº›å…¬å¸å‘ç°è¿™æ ·ä¸åˆ’ç®—ï¼Œå› ä¸ºä½ æ¯å¹´ä¹°è¿™äº›ç¡¬ä»¶è¦èŠ±å‡ åƒä¸‡ï¼Œè¿™äº›ç¡¬ä»¶éå¸¸è´µçš„é˜¿ï¼ŒåƒIBMçš„å°å‹æœºå‡ åä¸‡ä¸Šç™¾ä¸‡ï¼›å­˜å‚¨ï¼Œæ²¡æœ‰ä¸€ç™¾ä¸‡ä½ åˆ«è°ˆï¼Œè°ˆä¸äº†ï¼Œä»¥åè¦æ˜¯è€æ¿è·Ÿä½ è¯´ï¼Œè¦ä½ æ­ä¸€å¥—å•†ä¸šçš„é«˜æ€§èƒ½çš„å­˜å‚¨æ–¹æ¡ˆï¼Œç‰¹åˆ«æ˜¯æ•°æ®åº“ç”¨çš„ï¼Œä½ å…ˆé—®ä»–æœ‰æ²¡æœ‰ä¸€ç™¾ä¸‡ï¼Œä¸€ç™¾ä¸‡éƒ½ä¸ç»™æˆ‘ï¼Œæ‹¿ä»€ä¹ˆå»è°ˆï¼Œè°ˆä¸äº†ï¼›oracleä¹Ÿä¸è¯´äº†ï¼ŒæŒ‰cpuç»™ä½ å–é’±ï¼Œçœ‹ä½ çš„æœåŠ¡å™¨å‡ ä¸ªcpuæ˜¯å§ï¼Œç°åœ¨æœåŠ¡å™¨å¤šæ ¸ï¼Œå¤šæ ¸ä½ å°±å¤šä»˜é’±å§ã€‚åæ¥å…¬å¸è¯´æˆ‘ä¸€å¹´ä¹°å‡ åƒä¸‡ï¼Œéƒ½æ²¡èµšå¤šå°‘ï¼Œèµšçš„é’±ä¸€å¤§åŠç”¨æ¥ä¹°ç¡¬ä»¶äº†ï¼Œèƒ½ä¸èƒ½æˆæœ¬ä½ä¸€ç‚¹ã€‚<br>IBMçš„å°å‹æœºæ¢æˆäº†pc serverï¼Œæ¯”æˆ‘ä»¬è¿™é‡Œçš„æœåŠ¡å™¨ç¨å¾®å¥½ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ˜¯1Uçš„ï¼Œä»–ä»¬èµ·ç 2Uçš„ï¼Œä¹°ä¸€äº›pc serverï¼Œå•å°æœåŠ¡å™¨çš„æ€§èƒ½æ¯”IBMçš„å°å‹æœºè¦ä½ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨æœ‰éå¸¸æˆç†Ÿçš„é›†ç¾¤è§£å†³æ–¹æ¡ˆï¼Œæœ‰é«˜å¯ç”¨é›†ç¾¤ã€è´Ÿè½½å‡è¡¡é›†ç¾¤ã€é«˜æ€§èƒ½è®¡ç®—é›†ç¾¤ï¼Œå½“å¤šå°pc serveræ”¾åœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œä»–æ•´ä½“ä»·æ ¼è¦æ¯”IBMçš„ä¾¿å®œï¼Œè€Œä¸”æä¾›çš„æ•´ä½“æ€§èƒ½ä¹Ÿæ¯”IBMé«˜ï¼Œæ— éå°±æ˜¯æµªè´¹ä¸€äº›åœ°æ–¹ï¼Œä½†æ˜¯ä¼šå‘ç°å¾—åˆ°çš„æ˜¯æˆæœ¬é™ä½ã€æ”¶ç›Šæ›´å¥½ã€‚ä¸€å°IBMä¸Šç™¾ä¸‡ï¼Œæˆ‘ä¹°10å°pc serveræ€§èƒ½å°±è¶…è¿‡ä½ äº†ï¼Œæ‰€ä»¥pc serveråˆ’ç®—ã€‚<br>oracleè¿™é‡Œä¸è¯´äº†ï¼Œä½ è¦æ”¶é’±çš„ï¼Œæˆ‘å°±ç”¨ä¸æ”¶é’±çš„mysqlï¼Œç”¨mysqlè·‘è·‘ï¼Œå½“ç„¶äº†ï¼Œç°åœ¨æœ‰å¾ˆå¤šå¤§å…¬å¸ä¼šæŠŠoracleæ¢æˆmysqlï¼Œä¹Ÿä¸æ˜¯å…¨éƒ¨éƒ½æ¢æ‰ï¼Œæœ‰ä¸€äº›éå¸¸æ ¸å¿ƒçš„åº”ç”¨è¿˜æ˜¯è·‘åœ¨oracleä¸Šé¢ï¼Œoracleè¿˜æ˜¯æœ‰ä»–çš„æœ‰ç‚¹çš„ã€‚å­˜å‚¨è¿™é‡Œå‘¢ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰isançš„å­˜å‚¨ï¼Œä»¥åè®²åˆ°å­˜å‚¨ä¼šå»è®²ï¼Œisanå­˜å‚¨æ¯”æˆ‘ä»¬å­¦è¿‡çš„nfsã€sambaçš„æ€§èƒ½è¦é«˜ï¼Œä½†æ˜¯æˆæœ¬ä½ï¼Œä¸éœ€è¦æ‹¿ä¸ªå‡ ç™¾ä¸‡å‡ºæ¥ã€‚é’ˆå¯¹è¿™äº›æƒ…å†µï¼ŒIBMæ€ä¹ˆæƒ³çš„æˆ‘ä¸çŸ¥é“ï¼ŒEMCæ€ä¹ˆæƒ³çš„æˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œä½†æ˜¯æˆ‘çŸ¥é“oracleæ€ä¹ˆæƒ³çš„ã€‚oracleè¯´æˆ‘æ”¶è´­mysqlæ˜¯æƒ³è®©ä¸­å°å‹ä¼ä¸šç”¨çš„ï¼Œå¥½é˜¿ï¼Œä½ ä»¬ç°åœ¨éƒ½ç”¨äº†æ˜¯å§ï¼Œoracleå–ä¸å‡ºå»äº†ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿæ˜¯å¤§å®¶åˆ«ç”¨å‘¢ï¼Ÿè¿˜æ˜¯æ€ä¹ˆåšæ¯”è¾ƒå¥½ï¼ŸæŠŠmysqlææ­»ï¼Œä½ ä»¬ä¸æ˜¯è§‰å¾—mysqlå¼€æºä¸è¦é’±å—ï¼Œåæ­£ä»–æ˜¯é¢†å…»çš„å­©å­ï¼Œoracleæ‰æ˜¯æˆ‘è‡ªå·±çš„å­©å­ï¼Œé¢†å…»çš„å­©å­æŠ¢è‡ªå·±å­©å­çš„è›‹ç³•ï¼Œé‚£æˆ‘å°±ææ­»ä»–ã€‚å¥½äº†ï¼Œoracleå†³å®šæŠŠmysqlé—­æºï¼Œæ…¢æ…¢åœ°å°†mysqlçš„æŠ€æœ¯åšé€æ­¥é—­æºã€‚é‚£ä»–ä¸€åšé—­æºï¼Œç”¨æˆ·å°±å‘ç°é—®é¢˜äº†ï¼Œæˆ‘å¼€å§‹ç”¨mysqlï¼Œç»“æœä½ å…ˆåœ¨mysqlä¹Ÿè¦æ”¶é’±ï¼Œé‚£ä¹ˆæœ€å…³é”®çš„æ˜¯mysqlçš„å¼€å‘è€…ï¼Œå½“å¹´æœ€æ—©åœ°å¼€å‘è€…ï¼Œä¸€ä¸ªå¼€å§‹åœ¨mysql-ABå…¬å¸ï¼Œåæ¥è¢«sunæ”¶è´­åå»äº†sunå…¬å¸ï¼Œsunå…¬å¸ä¹Ÿæ˜¯ç§‰æŒå¼€æºç†å¿µåœ°ï¼Œæ‰€ä»¥ä¹Ÿåšåœ°æ¯”è¾ƒå¼€å¿ƒï¼Œoracleæ”¶è´­å®Œä¹‹åå‘¢ï¼Œå¼€å§‹ä¹Ÿå¼€æºï¼Œåæ¥å‘¢å˜é—­æºäº†ï¼Œè¿™äº›äººå—ä¸äº†äº†ï¼Œè¿™äº›äººä¸åœ¨ä¹èµšå¤šå°‘é’±ï¼Œåœ¨ä¹åœ°æ˜¯ä¸ªäººç†æƒ³ã€‚æˆ‘è¦å®ç°ä¸ªäººç†æƒ³ï¼Œæˆ‘çš„ç†æƒ³å°±æ˜¯æŠŠè¿™ä¸ªè½¯ä»¶è¶Šåšè¶Šå¥½ï¼Œç„¶åè®©å¤§å®¶å…è´¹ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸ªäººç†æƒ³ï¼Œè¿™äº›äººç§°ä¹‹ä¸ºé»‘å®¢ã€‚å“ªäº›äººå«é»‘å®¢ï¼Œæç ´åçš„é‚£äº›äººä¸æ˜¯é»‘å®¢ï¼Œå´‡å°šå¼€æ”¾ã€å¹³ç­‰ã€è‡ªç”±çš„ï¼Œç„¶ååˆæœ‰é«˜è¶…çš„è®¡ç®—æœºæ°´å¹³çš„è¿™äº›äººå°±æ˜¯é»‘å®¢ã€‚å°±åƒlinuxçš„åˆ›å§‹äººï¼ŒLinus Torvaldsæ—çº³æ–¯ æ‰˜ç“¦å…¹ï¼Œä»–ä»¬éƒ½æ˜¯éå¸¸è‘—åçš„é»‘å®¢ã€‚æ—¢ç„¶ä½ mysqlè¦æ”¶é’±ï¼Œé‚£æˆ‘å°±ä¸å¹²äº†ï¼Œæ‰€ä»¥å½“å¹´mysqlæœ€æ—©çš„å¼€å‘è€…å½“ä¸­çš„ä¸€ä¸ªé¢†å¤´ï¼Œä»–å°±è·³æ§½å‡ºæ¥äº†ï¼Œç„¶åå¸¦äº†ä¸€æ‰¹æ‰‹ä¸‹åšäº†ä¸€ä¸ªå¼€æºç¤¾åŒºåˆå¸æ”¶äº†ä¸€æ‰¹äººï¼Œå¼€å§‹å†™ä¸€ä¸ªæ–°çš„æ•°æ®åº“ï¼Œå°±æ˜¯æˆ‘ä»¬rhel7å½“ä¸­çš„mariadbã€‚<br>Mariadbï¼Œæœ‰å¾ˆå¤šåœ°æ–¹è·Ÿmysqlå¾ˆåƒï¼Œä½ ä¼šå‘ç°åœ¨æ“ä½œmariadbçš„è¿‡ç¨‹å½“ä¸­ç”¨åˆ°çš„éƒ½æ˜¯mysqlçš„å‘½ä»¤ï¼Œç™»é™†mysqlã€å¤‡ä»½mysqldumpï¼Œä½ ä¼šå‘ç°mariadbæ‰€æœ‰çš„æ¥å£éƒ½å’Œmysqlçš„æ¥å£ä¸€æ¨¡ä¸€æ ·ï¼Œå†…éƒ¨çš„å‡½æ•°åéƒ½å’Œmyslqçš„ä¸€æ¨¡ä¸€æ ·ã€‚æ‰€ä»¥å‘¢ï¼Œä½ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä»mysqlçš„ç¯å¢ƒè¿ç§»åˆ°mariadbä¸Šé¢ã€‚maraidbä¹Ÿåšçš„éå¸¸å¥½ï¼Œåˆšå¼€å§‹æ¯”ä¸è¿‡mysqlï¼Œä½†æ˜¯è¿‘ä¸¤å¹´mysqlæœ‰çš„ä¼˜ç‚¹ä»–éƒ½æœ‰ï¼Œç”šè‡³ä»–è¿˜æœ‰å¾ˆå¤šè‡ªå·±è½¬æœ‰çš„ä¼˜ç‚¹ï¼Œoracleè¿™æ—¶å€™åä¸ä½äº†ï¼Œæˆ‘ç°åœ¨é—­æºï¼Œé—­æºä»¥åå‘¢æ²¡äººæ¥ä¹°æˆ‘çš„oracleï¼Œå¤§å®¶æ¢æˆmariadbäº†ï¼Œé‚£æˆ‘è¿™ä¸ªé—­æºçš„æ„ä¹‰å°±æ²¡äº†ï¼Œæ‰€ä»¥æœ€è¿‘å‘¢åˆå‘è¡¨å£°æ˜ï¼Œè¯´â€œå¤§å®¶æ”¾å¿ƒï¼Œæˆ‘ä»¥åä¸ä¼šå†é—­æºäº†ï¼mysqlä»¥åè¿˜ä¼šä»¥å¼€æºçš„æ–¹å¼ä¸€ç›´å­˜åœ¨ä¸‹å»ã€‚â€ä¸ä¼šæ”¶é’±äº†ï¼Œä½†æ˜¯ä¹Ÿæ²¡ä»€ä¹ˆäººç†ä»–äº†ï¼Œæ›´å¤šçš„äººéƒ½æ„¿æ„ç›¸ä¿¡ï¼Œæ„¿æ„å»ä½¿ç”¨mariadbäº†ã€‚mysqlä¹Ÿæœ‰äººç”¨ï¼Œmariadbä¹Ÿæœ‰äººç”¨ï¼Œç°åœ¨å°±å˜æˆè¿™ä¸ªå¸‚åœºï¼Œmysqlå’Œmariadbå„å äº†ä¸€éƒ¨åˆ†æ±Ÿå±±ã€‚è¿™ä¸ªå‘¢å°±æ˜¯å¼€æ”¾æºç ã€‚</p>
<p><strong>* ç¬¬ä¸‰ä¸ªè¦ç‚¹ï¼Œå…³ç³»å‹ã€‚ *</strong></p>
<blockquote>
<p>ä»‹ç»å…³ç³»å‹å’Œéå…³ç³»å‹æ•°æ®åº“çš„æ¦‚å¿µå’Œä¼˜åŠ£ç‚¹</p>
</blockquote>
<p>æ‰€è°“å…³ç³»å‹æ˜¯æŒ‡,å°†æ•°æ®ä¿å­˜åœ¨ä¸åŒçš„è¡¨ä¸­,è¡¨ä¸è¡¨ä¹‹é—´æ”¯æŒä¸€å®šçš„å…³ç³»ï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰æ•°æ®æ”¾åœ¨ ä¸€ä¸ªå¤§çš„ä»“åº“å†…ã€‚è¿™æ ·å°±å¢åŠ äº†é€Ÿåº¦å¹¶æé«˜äº†çµæ´»æ€§ã€‚<br>ä»€ä¹ˆæ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Ÿæˆ‘ä»¬åœ¨å­˜æ”¾æ•°æ®çš„æ—¶å€™ï¼Œæ•°æ®å¾ˆå¤šï¼Œå‡ ç™¾ä¸‡å‡ åƒä¸‡è¡Œï¼Œå¦‚æœè¯´æˆ‘ä»¬æŠŠæ‰€æœ‰çš„æ•°æ®æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œè™½ç„¶æ•°æ®åº“çš„è¯»å†™æ€§èƒ½ä¼šæ¯”ä¸€èˆ¬çš„ç¨‹åºæ¥çš„é«˜ï¼Œä½†æ˜¯æ–‡ä»¶å¤ªå¤§æ€»å½’å¤šå¤šå°‘å°‘ä¼šå½±å“ä¸€äº›æ€§èƒ½ï¼Œä¸ºäº†èƒ½å¤Ÿè®©æˆ‘æ›´å¿«åœ°è¯»å–æ•°æ®ï¼Œæˆ‘ä¼šè€ƒè™‘æŠŠæ•°æ®æ‹†åˆ†å¼€æ¥ï¼Œä¸åŒçš„æ•°æ®æ”¾åœ¨ä¸åŒçš„æ–‡ä»¶å½“ä¸­ï¼Œè€Œæ•°æ®åº“é‡Œé¢åŸºæœ¬çš„å­˜å‚¨æ–¹å¼å«åšè¡¨ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„æ•°æ®æ˜¯æ”¾åœ¨ä¸åŒçš„è¡¨é‡Œé¢ã€‚æ•°æ®åº“ç®¡ç†å‘˜ç®¡ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Œç®¡è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»å¸¸æ˜¯è¿™ä¹ˆè¯´çš„ï¼Œå«æ•°æ®åº“ç®¡ç†å‘˜ï¼Œç”·çš„å«è¡¨å“¥ï¼Œå¥³çš„å«è¡¨å§ï¼Œè€å¤§å«åšå¤§è¡¨å“¥ã€‚é‚£ä¹ˆæˆ‘ç°åœ¨æŠŠæ•°æ®æ”¾åœ¨ä¸åŒçš„è¡¨é‡Œé¢ï¼Œè¡¨å’Œè¡¨ä¹‹é—´èƒ½ä¸èƒ½æ”¯æŒä¸€å®šçš„å…³ç³»ï¼Œå› ä¸ºæˆ‘ä»¬ç»å¸¸åœ¨æ“ä½œè¡¨é‡Œçš„æ•°æ®çš„æ—¶å€™æ˜¯æœ‰å…³ç³»çš„ï¼Œæ¯”å¦‚è¯´ï¼Œæˆ‘å¯èƒ½æœ‰ä¸ªè¡¨å«å‘˜å·¥è¡¨ï¼Œæœ‰ä¸ªè¡¨å«å·¥èµ„è¡¨ï¼Œå·¥èµ„è¡¨é‡Œé¢å‘é’±ï¼Œå‘é’±çš„æ—¶å€™å‘¢ï¼Œæ¯ä¸€ä¸ªå‘å·¥èµ„çš„äººåº”è¯¥åœ¨å‘˜å·¥è¡¨é‡Œé¢å­˜åœ¨ï¼Œä½ ä¸èƒ½è¯´å‘é’±å‘ç»™ä¸æ˜¯æˆ‘ä»¬å…¬å¸çš„äººï¼Œä¸è®¤è¯†çš„äººï¼Œè¿™ä¸è¡Œã€‚æ‰€ä»¥å‘¢ï¼Œè¿™æ˜¯ä¸€ä¸ªè¡¨å’Œè¡¨ä¹‹é—´çš„å…³ç³»ã€‚èƒ½å¤ŸæŠŠè¿™äº›å…³ç³»å®ç°å‡ºæ¥çš„ï¼Œæˆ‘ä»¬ä¸€èˆ¬æŠŠä»–å«åšå…³ç³»å‹æ•°æ®åº“ã€‚èƒ½å¤Ÿä»¥è¡¨æ¥å­˜å‚¨ï¼Œå¹¶åœ¨è¡¨å’Œè¡¨ä¹‹é—´æ”¯æŒä¸€å®šçš„ä¾èµ–å…³ç³»ï¼Œå„ç§å„æ ·çš„ä¾èµ–å…³ç³»ï¼Œå¯èƒ½æ˜¯å¤§å°å€¼çš„åˆ¤æ–­ï¼Œå¯èƒ½æ˜¯å­˜åœ¨çš„åˆ¤æ–­ï¼Œç­‰ç­‰ã€‚å½“ç„¶æˆ‘ä»¬é™¤äº†å…³ç³»å‹æ•°æ®åº“ä»¥å¤–å‘¢ï¼Œè¿˜æœ‰ä¸€ç§æ•°æ®åº“å«åšï¼Œé”®å€¼å‹æ•°æ®åº“ï¼Œæ¯”å¦‚memcache\redisæ•°æ®åº“ï¼Œå…¸å‹çš„ä»£è¡¨ä¾‹å­ï¼Œä¼˜ç‚¹æ˜¯æ€§èƒ½æ›´åŠ é«˜ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨å†…å­˜æ¥å­˜æ”¾æ•°æ®ï¼Œä½†æ˜¯èƒ½å®ç°çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œä»–ä¸æ˜¯åŸºäºè¡¨çš„ï¼ŒåŠŸèƒ½å¾ˆç®€å•ï¼Œä½ åªèƒ½æŸ¥aæ˜¯å¤šå°‘ï¼Œä»€ä¹ˆå€¼æ˜¯å¤šå°‘ã€‚</p>
<p><strong>* ç¬¬å››ä¸ªè¦ç‚¹ï¼ŒSQLè¯­å¥ã€‚ *</strong></p>
<blockquote>
<p>ä»‹ç»SQLè¯­å¥çš„æ¦‚å¿µ</p>
</blockquote>
<p>MySQL ä¸­çš„ SQL æŒ‡çš„æ˜¯â€œç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€â€ã€‚SQL æ˜¯è®¿é—®æ•°æ®åº“çš„æœ€å¸¸ç”¨çš„æ ‡å‡†åŒ–è¯­è¨€ã€‚ä»–æ˜¯ç»Ÿä¸€çš„æ“ä½œè¯­æ³•ï¼Œæˆ‘ä»¬è¯´çš„æ˜¯æ•°æ®åº“ç»Ÿä¸€çš„æ“ä½œè¯­æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨mysqlé‡Œé¢å­¦çš„sqlè¯­å¥ä»¥åä½ åœ¨å…¶å®ƒæ•°æ®åº“ä¸­ä¹ŸåŒæ ·é€‚ç”¨ã€‚æ¯ä¸ªæ•°æ®åº“è‡ªå·±çš„sqlè¯­å¥å¾ˆå°‘ï¼Œç™¾åˆ†ä¹‹ä¹åäº”éƒ½æ˜¯ä¸€æ ·çš„ã€‚Sqlè¯­å¥æ—¶é—´ä¸å¤Ÿå­¦æ²¡å…³ç³»ï¼Œåé¢è¿˜æœ‰oracleè¯¾ç¨‹ï¼Œä¼šå»è¯¦ç»†å­¦ä¹ sqlè¯­å¥ã€‚<br>æˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹mysqlçš„å®šä¹‰ã€‚MySQL æ˜¯é‡‡ç”¨å®¢æˆ·/æœåŠ¡å™¨æ¨¡å‹çš„å¼€æ”¾æºç å…³ç³»å‹ SQL æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ,å®ƒå¯ä»¥åœ¨å¤šç§æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œ,ä¸è¦ä»¥ä¸ºä»–åªèƒ½åœ¨linuxç³»ç»Ÿä¸Šè¿è¡Œï¼Œwindowsç³»ç»Ÿä¹Ÿèƒ½è¿è¡Œã€‚åº”è¯¥è¿™ä¹ˆè¯´ï¼ŒMysqlåœ¨linuxä¸Šè¿è¡Œæ€§èƒ½æ›´å¥½ï¼Œç¨³å®šæ€§æ›´é«˜ï¼ŒåŒ…æ‹¬oracleä¹Ÿæ˜¯ï¼Œoracleä¹Ÿèƒ½è£…åœ¨windowsä¸Šé¢ï¼Œä½†æ˜¯è·Ÿè£…åœ¨linuxä¸Šé¢æ€§èƒ½ä¸ä¸€æ ·ï¼Œoracleå®˜æ–¹æ¨èå®‰è£…åœ¨linuxä¸Šé¢ï¼Œmysqlä¹Ÿæœ‰windowsç‰ˆæœ¬ï¼Œæ•´ä¸ªå®‰è£…è¿‡ç¨‹ç›¸å½“ç®€å•ã€‚å¯ä»¥å»ä¸‹è½½ä¸€ä¸ªâ€œwamp.exeâ€è½¯ä»¶ï¼Œä¸‹è½½ä¸‹æ¥ä¸€è·¯nextå®‰è£…åˆ°åº•ï¼Œå°±ç±»ä¼¼ä¸LAMPçš„ç¯å¢ƒï¼Œå°±æ­å»ºå¥½äº†ã€‚è¿™æ˜¯å¤šå¹³å°è¿è¡Œã€‚Mysqlä»mysqlabå…¬å¸åˆ°sunå…¬å¸å†åˆ°oracleå…¬å¸ã€‚ç›®å‰æ˜¯åœ¨oracleå…¬å¸æ——ä¸‹ã€‚</p>
<h3 id="å¦‚ä½•è·å¾—MySQLç›¸å…³èµ„æº"><a href="#å¦‚ä½•è·å¾—MySQLç›¸å…³èµ„æº" class="headerlink" title="å¦‚ä½•è·å¾—MySQLç›¸å…³èµ„æº"></a>å¦‚ä½•è·å¾—MySQLç›¸å…³èµ„æº</h3><ul>
<li>ä¸ºäº†å­¦ä¹ æ›´å¤šçš„MySQLçŸ¥è¯†,è¯·è®¿é—®MySQLå®˜ç½‘ <a href="http://dev.mysql.com/ã€‚" target="_blank" rel="noopener">http://dev.mysql.com/ã€‚</a></li>
<li>ä¸ºäº†ä¸‹è½½æœåŠ¡å™¨çš„ä¸€ä¸ªå‰¯æœ¬,è¯·è®¿é—®MySQLå®˜ç½‘ <a href="http://dev.mysql.com/downloads/ã€‚" target="_blank" rel="noopener">http://dev.mysql.com/downloads/ã€‚</a></li>
</ul>
<p><img src="pic/mysqlgw.png" alt="mysqlgw.png"></p>
<h3 id="MySQLåœ¨ä¼ä¸šä¸­çš„åº”ç”¨åœºæ™¯"><a href="#MySQLåœ¨ä¼ä¸šä¸­çš„åº”ç”¨åœºæ™¯" class="headerlink" title="MySQLåœ¨ä¼ä¸šä¸­çš„åº”ç”¨åœºæ™¯"></a>MySQLåœ¨ä¼ä¸šä¸­çš„åº”ç”¨åœºæ™¯</h3><p>MySQL æ˜¯ä¸–ç•Œä¸Š ** æœ€å—æ¬¢è¿çš„å¼€æºæ•°æ®åº“ ** ,å¥¹æ‹¥æœ‰ç›¸å½“å¤§çš„è£…æœºé‡ã€‚è€Œä¸” DB-Engines çš„æ’åä¸€ç›´å¤„äºæ•°æ®åº“æ€»æ¦œç¬¬äºŒåçš„ä½ç½®,ä»…æ¬¡äº Oracleã€‚MySQL åœ¨å¼€æºé¢†åŸŸæ’åç¬¬ä¸€,è€Œç¬¬äºŒå¤§å¼€æºæ•°æ®åº“ PostgreSQL çš„åˆ†æ•°ä»…ä»…æ˜¯ MySQL çš„é›¶å¤´ã€‚</p>
<p>MySQL æ‹¥æœ‰åºå¤§çš„ç”¨æˆ·ç¾¤,å›½å¤–çš„æœ‰ ** Facebookã€Flickrã€eBay ** ç­‰,å›½å†…çš„æœ‰ ** é˜¿é‡Œã€è…¾è®¯ã€æ–°æµªã€ç™¾åº¦ç­‰ ** ã€‚è€Œè¿™äº›äº’è”ç½‘å’Œå¤§éƒ¨åˆ†ä¼ ç»Ÿå…¬å¸çš„æœåŠ¡éœ€è¦ ** 7Ã—24 ** å°æ—¶è¿ç»­å·¥ä½œã€‚å½“æ­¤ç±»å‹ç½‘ç«™çš„éƒ¨åˆ†æ•°æ®åº“æœåŠ¡å™¨å®•æœºæ—¶,å°±éœ€è¦é«˜å¯ç”¨æŠ€æœ¯å°†æµé‡ç‰µå¼•è‡³å¤‡ä»½ä¸»æœº,ä»è€Œæ­¤æ—¶è¿™äº›å…¬å¸éœ€è¦é€šè¿‡ ** å¤‡ä»½å’Œæ¢å¤ ** æ‰‹æ®µæ¥äº§ç”Ÿå¤‡æœº,å¹¶é€šè¿‡ ** å¤åˆ¶ ** æ¥åŒæ­¥ä¸»å¤‡æœºé—´çš„çŠ¶æ€,åŒæ—¶éƒ¨ç½²å„ç§ ** ç›‘æ§ ** è½¯ä»¶æ¥ç›‘æ§æœåŠ¡å™¨çŠ¶æ€ã€‚å½“å¼‚å¸¸æ•°æ®åº“æœåŠ¡å™¨å®•æœºæ—¶,é€šè¿‡æ‰‹å·¥æˆ–è‡ªåŠ¨åŒ–æ‰‹æ®µå°†ä¸»æœºæµé‡åˆ‡æ¢è‡³å¤‡æœº,è¿™ä¸ªåŠ¨ä½œå«ä½œ ** failover ** ã€‚è€Œä¸€äº›å¤§å‹å…¬å¸åœ¨é¢å¯¹æˆåƒä¸Šä¸‡å° MySQL æœåŠ¡å™¨æ—¶,é€šå¸¸ä½¿ç”¨ ** è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬ ** æˆ–ç¨‹åºå®Œæˆä¸Šè¿°ç§ç§åŠ¨ä½œã€‚</p>
<h3 id="MySQL-æ•°æ®åº“å®‰è£…"><a href="#MySQL-æ•°æ®åº“å®‰è£…" class="headerlink" title="MySQL æ•°æ®åº“å®‰è£…"></a>MySQL æ•°æ®åº“å®‰è£…</h3><p>è¯¾ç¨‹è¦æ±‚ï¼š</p>
<ul>
<li>å­¦ä¼šMariaDB 5.5çš„å®‰è£…</li>
<li>å­¦ä¼šMariaDB 10.2çš„å®‰è£…</li>
<li>å­¦ä¼šMySQL 5.6çš„å®‰è£…</li>
<li>å­¦ä¼šMySQL 5.7çš„å®‰è£…</li>
<li>MySQLè‡ªåŠ¨å®‰è£…è„šæœ¬</li>
</ul>
<p><strong>å®‰è£…æ–¹æ³•</strong></p>
<table>
<thead>
<tr>
<th align="left">num</th>
<th align="left">å®‰è£…æ–¹æ³•</th>
<th align="left">è¯´æ˜</th>
<th align="left">æ˜¯å¦ç¼–è¯‘å¥½</th>
</tr>
</thead>
<tbody><tr>
<td align="left">a</td>
<td align="left">äºŒè¿›åˆ¶æ–‡ä»¶</td>
<td align="left">è§£å‹å³å¯</td>
<td align="left">ç¼–è¯‘å¥½çš„</td>
</tr>
<tr>
<td align="left">b</td>
<td align="left">åŒ…ç®¡ç†</td>
<td align="left">rpm,deb</td>
<td align="left">ç¼–è¯‘å¥½çš„ï¼Œæœ‰ç‰ˆæœ¬(æ¨èä½¿ç”¨)</td>
</tr>
<tr>
<td align="left">c</td>
<td align="left">æºä»£ç </td>
<td align="left">ç±»ä¼¼Mplayer</td>
<td align="left">è‡ªå·±ç¼–è¯‘ï¼ˆæŒ‰éœ€é€‰æ‹©å‚æ•°ï¼›ä»£ç ä¼˜åŒ–ï¼‰</td>
</tr>
</tbody></table>
<h4 id="RHEL-7-2-RPM-åŒ…å®‰è£…-MariaDB-5-5"><a href="#RHEL-7-2-RPM-åŒ…å®‰è£…-MariaDB-5-5" class="headerlink" title="RHEL 7.2 RPM åŒ…å®‰è£… MariaDB 5.5"></a>RHEL 7.2 RPM åŒ…å®‰è£… MariaDB 5.5</h4><table>
<thead>
<tr>
<th align="left">é¡¹ç›®</th>
<th align="left">å‚æ•°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">è½¯ä»¶å</td>
<td align="left">mariadb-server 5.5</td>
</tr>
<tr>
<td align="left">service</td>
<td align="left">mariadb</td>
</tr>
<tr>
<td align="left">daemon</td>
<td align="left">mysqld</td>
</tr>
<tr>
<td align="left">é…ç½®æ–‡ä»¶</td>
<td align="left">/etc/my.cnf    /etc/my.cnf.d/*.cnf</td>
</tr>
<tr>
<td align="left">æ•°æ®æ–‡ä»¶</td>
<td align="left">/var/lib/mysql</td>
</tr>
<tr>
<td align="left">æ—¥å¿—æ–‡ä»¶</td>
<td align="left">/var/log/mariadb/mariadb.logï¼ˆé”™è¯¯æ—¥å¿—ï¼Œå¯åŠ¨æ—¥å¿—ï¼‰</td>
</tr>
<tr>
<td align="left">ç«¯å£å·</td>
<td align="left">3306</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…å¿…è¦çš„è½¯ä»¶åŒ…</span></span><br><span class="line">[root@mastera0 ~]# yum install -y vim net-tools wget</span><br><span class="line"></span><br><span class="line">[root@mastera0 ~]# yum list|grep mariadb</span><br><span class="line">Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast</span><br><span class="line">mariadb-libs.x86_64                     1:5.5.44-2.el7             @anaconda/7.2</span><br><span class="line">mariadb.x86_64                          1:5.5.44-2.el7             rhel_dvd     </span><br><span class="line">mariadb-bench.x86_64                    1:5.5.44-2.el7             rhel_dvd     </span><br><span class="line">mariadb-devel.i686                      1:5.5.44-2.el7             rhel_dvd     </span><br><span class="line">mariadb-devel.x86_64                    1:5.5.44-2.el7             rhel_dvd     </span><br><span class="line">mariadb-libs.i686                       1:5.5.44-2.el7             rhel_dvd     </span><br><span class="line">mariadb-server.x86_64                   1:5.5.44-2.el7             rhel_dvd     </span><br><span class="line">mariadb-test.x86_64                     1:5.5.44-2.el7             rhel_dvd     </span><br><span class="line">[root@mastera0 ~]# yum install -y mariadb-server</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è½¯ä»¶æ¶æ„</span></span><br><span class="line">[root@mastera0 ~]# rpm -ql mariadb-server</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨æœåŠ¡</span></span><br><span class="line">[root@mastera0 ~]# systemctl start mariadb</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å®ˆæŠ¤è¿›ç¨‹</span></span><br><span class="line">[root@mastera0 ~]# ps -ef|grep mysqld</span><br><span class="line">mysql     2496     1  0 13:56 ?        00:00:00 /bin/sh /usr/bin/mysqld_safe --basedir=/usr</span><br><span class="line">mysql     2653  2496  0 13:56 ?        00:00:00 /usr/libexec/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib64/mysql/plugin --log-error=/var/log/mariadb/mariadb.log --pid-file=/var/run/mariadb/mariadb.pid --socket=/var/lib/mysql/mysql.sock</span><br><span class="line">root      2694  2347  0 13:56 pts/0    00:00:00 grep --color=auto mysqld</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹ç›‘å¬ç«¯å£å·</span></span><br><span class="line">[root@mastera0 ~]# netstat -luntp|grep mysqld</span><br><span class="line">tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      2653/mysqld</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä»»ä½•ä¸€ä¸ªç¨‹åºå®‰è£…å®Œæˆä¹‹åéƒ½è¦å»çœ‹ä¸€ä¸‹ä»–çš„ç»„æˆ<code>rpm -ql mariadb-server</code>ï¼Œæˆ‘ä»¬çš„æ¯ä¸ªç¨‹åºéƒ½æœ‰è¿™æ ·å‡ ä¸ªéƒ¨åˆ†ï¼Œé…ç½®æ–‡ä»¶ç›®å½•ã€è„šæœ¬æ–‡ä»¶ç›®å½•ã€æ•°æ®æ–‡ä»¶ç›®å½•ã€æ—¥å¿—æ–‡ä»¶ç›®å½•ç­‰ã€‚æˆ‘ä»¬å¯ä»¥ç”¨rpm â€“ql &lt;ç¨‹åºå&gt;æ¥æŸ¥çœ‹ç¨‹åºçš„ç»„æˆã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°mariadb-serverçš„é…ç½®æ–‡ä»¶ä¸º/etc/my.cnfï¼›è„šæœ¬æ–‡ä»¶ç›®å½•ä¸º/usr/local/mysql/bin/ï¼›æ•°æ®æ–‡ä»¶ç›®å½•ä¸º/var/lib/mysql/;æ—¥å¿—æ–‡ä»¶åœ¨/var/log/mysql.logã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†ä»‹ç»æ¯ä¸€ä¸‹è„šæœ¬æ–‡ä»¶ç›®å½•ä¸­çš„è„šæœ¬ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MYSQLæœåŠ¡å™¨å’ŒæœåŠ¡å™¨å¯åŠ¨è„šæœ¬ï¼š</span><br><span class="line">Mysqld		 MySQLæœåŠ¡å™¨</span><br><span class="line">mysqld_safeã€mysql.serverå’Œmysqld_multiæ˜¯æœåŠ¡å™¨å¯åŠ¨è„šæœ¬</span><br><span class="line">mysql_install_db	åˆå§‹åŒ–æ•°æ®ç›®å½•å’Œåˆå§‹æ•°æ®åº“</span><br><span class="line"></span><br><span class="line">è®¿é—®æœåŠ¡å™¨çš„å®¢æˆ·ç¨‹åºï¼š</span><br><span class="line">mysql		æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç¨‹åºï¼Œç”¨äºäº¤äº’å¼æˆ–ä»¥æ‰¹å¤„ç†æ¨¡å¼æ‰§è¡ŒSQLè¯­å¥</span><br><span class="line">mysqladmin		æ˜¯ç”¨äºç®¡ç†åŠŸèƒ½çš„å®¢æˆ·ç¨‹åº</span><br><span class="line">mysqlcheck		æ‰§è¡Œè¡¨ç»´æŠ¤æ“ä½œ</span><br><span class="line">mysqldumpå’Œmysqlhotcopyè´Ÿè´£æ•°æ®åº“å¤‡ä»½</span><br><span class="line">mysqlimport		å¯¼å…¥æ•°æ®æ–‡ä»¶</span><br><span class="line">mysqlshow		æ˜¾ç¤ºä¿¡æ¯æ•°æ®åº“å’Œè¡¨çš„ç›¸å…³ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">ç‹¬ç«‹äºæœåŠ¡å™¨æ“ä½œçš„å·¥å…·ç¨‹åºï¼š</span><br><span class="line">myisamchk		æ‰§è¡Œè¡¨ç»´æŠ¤æ“ä½œ</span><br><span class="line">myisampack		äº§ç”Ÿå‹ç¼©ã€åªè¯»çš„è¡¨</span><br><span class="line">mysqlbinlog		æ˜¯å¤„ç†äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„å®ç”¨å·¥å…·</span><br><span class="line">perror		æ˜¾ç¤ºé”™è¯¯ä»£ç çš„å«ä¹‰</span><br></pre></td></tr></table></figure>

<p><strong>MySQLå®¢æˆ·ç«¯çš„ä½¿ç”¨</strong></p>
<table>
<thead>
<tr>
<th align="left">é¡¹ç›®</th>
<th align="left">å‚æ•°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">è½¯ä»¶åç§°</td>
<td align="left">mariadb 5.5</td>
</tr>
<tr>
<td align="left">å‘½ä»¤</td>
<td align="left">mysql ç™»é™†è¿æ¥mysqlæœåŠ¡å™¨</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">mysqladmin    ä¿®æ”¹æ•°æ®åº“æœåŠ¡å™¨ç”¨æˆ·å¯†ç </td>
</tr>
<tr>
<td align="left"></td>
<td align="left">mysqldump    å¤‡ä»½</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">mysqlbinlog    äºŒè¿›åˆ¶æ—¥å¿—çš„æŸ¥çœ‹</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å‘½ä»¤çš„ä½¿ç”¨</span><br><span class="line">mysql</span><br><span class="line">	1.æœåŠ¡å¯åŠ¨åï¼Œmariadb5.5ç›´æ¥ç™»é™†ï¼Œä¸éœ€è¦å¯†ç </span><br><span class="line">	2.é€€å‡º \q exit ctrl+d</span><br><span class="line">		-u ç”¨æˆ·å 	ç©ºæ ¼å¯æœ‰å¯æ—  -u root;-uroot</span><br><span class="line">		-p å¯†ç  	ä¸å¯ä»¥æœ‰ç©ºæ ¼ -puplooking</span><br><span class="line">				# mysql -uroot -puplooking</span><br><span class="line">				#	mysql -uroot -puplooking123</span><br><span class="line"></span><br><span class="line">mysqladmin</span><br><span class="line">	1.æ— å¯†ç æƒ…å†µä¸‹æ·»åŠ å¯†ç </span><br><span class="line">		mysqladmin -uroot password &#39;uplooking&#39;</span><br><span class="line">			-u ç”¨æˆ·å ç©ºæ ¼å¯æœ‰å¯æ—  -u root;-uroot</span><br><span class="line">			password æ–°å¯†ç 	ä¸€å®šè¦æœ‰ç©ºæ ¼</span><br><span class="line">	2.æœ‰å¯†ç æƒ…å†µä¸‹ä¿®æ”¹å¯†ç </span><br><span class="line">		mysqladmin -uroot -puplooking password &#39;uplooking123&#39;</span><br><span class="line">			-u ç”¨æˆ·å	å¯æœ‰å¯æ— </span><br><span class="line">			-p å½“å‰å¯†ç 	ä¸èƒ½æœ‰</span><br><span class="line">			password æ–°å¯†ç 	æœ‰</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera0 ~]# mysql==&gt;æœªè®¾ç½®å¯†ç ç™»é™†</span><br><span class="line">Welcome to the MariaDB monitor. Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.41-MariaDB MariaDB Server</span><br><span class="line">Copyright (c) 2000, 2014, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br><span class="line">[root@mastera0 ~]# mysqladmin -uroot password "uplooking"==&gt;è®¾ç½®å¯†ç </span><br><span class="line">[root@mastera0 ~]# mysql -uroot -p==&gt;ç™»é™†</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MariaDB monitor. Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 4</span><br><span class="line">Server version: 5.5.41-MariaDB MariaDB Server</span><br><span class="line">Copyright (c) 2000, 2014, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line">MariaDB [(none)]&gt; show databases==&gt;;åˆ†å·æäº¤å‘½ä»¤</span><br><span class="line">+--------------------+</span><br><span class="line">| Database</span><br><span class="line">|</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |==&gt;ä¸´æ—¶æ•°æ®åº“</span><br><span class="line">| mysql|==&gt;åš mysql åˆå§‹åŒ–çš„åº“</span><br><span class="line">| performance_schema |</span><br><span class="line">| test|==&gt;ä¸´æ—¶å…±äº«åº“,ä»»ä½•äººéƒ½å¯ä»¥çœ‹</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line">[root@serverg ~]# cat ~/.mysql_history==&gt;æŸ¥çœ‹ä¹‹å‰çš„å‘½ä»¤ä½†æ˜¯ä¸å…¨</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>

<h4 id="RHEL-7-2-RPM-åŒ…å®‰è£…-MariaDB-10-2"><a href="#RHEL-7-2-RPM-åŒ…å®‰è£…-MariaDB-10-2" class="headerlink" title="RHEL 7.2 RPM åŒ…å®‰è£… MariaDB 10.2"></a>RHEL 7.2 RPM åŒ…å®‰è£… MariaDB 10.2</h4><table>
<thead>
<tr>
<th align="left">é¡¹ç›®</th>
<th align="left">å‚æ•°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">è½¯ä»¶å</td>
<td align="left">MariaDB-server  10.2</td>
</tr>
<tr>
<td align="left">service</td>
<td align="left">mariadb/mysql</td>
</tr>
<tr>
<td align="left">daemon</td>
<td align="left">mysqld</td>
</tr>
<tr>
<td align="left">é…ç½®æ–‡ä»¶</td>
<td align="left">/etc/my.cnf</td>
</tr>
<tr>
<td align="left">æ•°æ®æ–‡ä»¶</td>
<td align="left">/var/lib/mysql/</td>
</tr>
<tr>
<td align="left">æ—¥å¿—æ–‡ä»¶</td>
<td align="left">é»˜è®¤æ²¡æœ‰å¼€å¯</td>
</tr>
<tr>
<td align="left">ç«¯å£å·</td>
<td align="left">3306</td>
</tr>
</tbody></table>
<blockquote>
<p>è½¯ä»¶çš„è·å–</p>
</blockquote>
<p><a href="http://classroom.example.com/materials/mariadb-10.2.repo" target="_blank" rel="noopener">http://classroom.example.com/materials/mariadb-10.2.repo</a></p>
<blockquote>
<p>å¸è½½å†²çªåŒ…mariadb-libså†å®‰è£…mariadb-10.2</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> rpm -e mariadb-libs --nodeps</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install -y MariaDB-server</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆå§‹åŒ–MariaDBæ•°æ®åº“å¹¶å¯åŠ¨MariaDBæœåŠ¡ï¼Œå¹¶ä½œå®‰å…¨åŠ å›º</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> systemctl start mysql</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql_secure_installation</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æŸ¥çœ‹MariaDBæ•°æ®åº“å®ä¾‹ç›‘å¬çš„ç«¯å£</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> netstat -ntpl|grep sql</span></span><br><span class="line">tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      12877/mysqld        </span><br><span class="line">tcp        0      0 0.0.0.0:4567            0.0.0.0:*               LISTEN      12877/mysqld</span><br></pre></td></tr></table></figure>

<p><strong>å®¢æˆ·ç«¯</strong></p>
<table>
<thead>
<tr>
<th align="left">é¡¹ç›®å</th>
<th align="left">å‚æ•°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">è½¯ä»¶å</td>
<td align="left">MariaDB-client 10.2</td>
</tr>
<tr>
<td align="left">å‘½ä»¤</td>
<td align="left">mysql,mysqladmin,mysqlbinlog,mysqldump</td>
</tr>
</tbody></table>
<h4 id="RHEL-7-2-RPM-åŒ…å®‰è£…-MySQL-5-7"><a href="#RHEL-7-2-RPM-åŒ…å®‰è£…-MySQL-5-7" class="headerlink" title="RHEL 7.2 RPM åŒ…å®‰è£… MySQL 5.7"></a>RHEL 7.2 RPM åŒ…å®‰è£… MySQL 5.7</h4><table>
<thead>
<tr>
<th align="left">é¡¹ç›®å</th>
<th align="left">å‚æ•°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">è½¯ä»¶å</td>
<td align="left">mysql-community-server 5.7</td>
</tr>
<tr>
<td align="left">service</td>
<td align="left">mysqld</td>
</tr>
<tr>
<td align="left">daemon</td>
<td align="left">mysqld</td>
</tr>
<tr>
<td align="left">é…ç½®æ–‡ä»¶</td>
<td align="left">/etc/my.cnfï¼Œ/etc/my.cnf.d/*.cnf</td>
</tr>
<tr>
<td align="left">æ•°æ®æ–‡ä»¶</td>
<td align="left">/var/lib/mysql</td>
</tr>
<tr>
<td align="left">å¯åŠ¨æ—¥å¿—</td>
<td align="left">/var/log/mysqld.log</td>
</tr>
</tbody></table>
<blockquote>
<p>è½¯ä»¶çš„è·å–</p>
</blockquote>
<p><a href="http://classroom.example.com/materials/mysql-5.7.repo" target="_blank" rel="noopener">http://classroom.example.com/materials/mysql-5.7.repo</a></p>
<blockquote>
<p>å¸è½½å†²çªåŒ…mariadb-libså†å®‰è£…mysql-5.7</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> rpm -e mariadb-libs --nodeps</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install -y  mysql-community-server</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆå§‹åŒ–MySQLæ•°æ®åº“å¹¶å¯åŠ¨mysqldæœåŠ¡ï¼Œå¹¶ä½œå®‰å…¨åŠ å›º</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> systemctl start mysqld</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql_secure_installation</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æœåŠ¡ç«¯ä¿®æ”¹åˆå§‹å¯†ç </p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> grep password /var/<span class="built_in">log</span>/mysqld.log</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysqladmin -uroot -p<span class="string">''</span> password <span class="string">'(Uploo00king)'</span></span></span><br></pre></td></tr></table></figure>

<p><strong>å®¢æˆ·ç«¯</strong></p>
<table>
<thead>
<tr>
<th align="left">é¡¹ç›®å</th>
<th align="left">å†…å®¹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">è½¯ä»¶å</td>
<td align="left">mysql-community-client 5.7</td>
</tr>
<tr>
<td align="left">å‘½ä»¤</td>
<td align="left">mysql,mysqladmin,mysqlbinlog,mysqldump</td>
</tr>
</tbody></table>
<blockquote>
<p>å®¢æˆ·ç«¯ç™»é™†æ•°æ®åº“</p>
</blockquote>
<p><code>mysql -uroot -p&#39;(Uploo00king)&#39;</code></p>
<p>mysql.userè¡¨çš„ç»“æ„å˜åŒ–äº†ï¼ŒåŸå…ˆçš„passwordåˆ—æ”¹ä¸ºäº†authentication_stringåˆ—</p>
<h4 id="RHEL-7-2-äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…-MySQL-5-6"><a href="#RHEL-7-2-äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…-MySQL-5-6" class="headerlink" title="RHEL 7.2 äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£… MySQL 5.6"></a>RHEL 7.2 äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£… MySQL 5.6</h4><table>
<thead>
<tr>
<th align="left">mysql</th>
<th align="left">è½¯ä»¶æ¶æ„</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ•°æ®ç›®å½•</td>
<td align="left">/data/mysql/data</td>
</tr>
<tr>
<td align="left">binlogç›®å½•</td>
<td align="left">/data/mysql/log-data</td>
</tr>
<tr>
<td align="left">pidæ–‡ä»¶</td>
<td align="left">/data/tmp</td>
</tr>
<tr>
<td align="left">ä¸´æ—¶ç›®å½•</td>
<td align="left">/data1/tmp/</td>
</tr>
</tbody></table>
<p>ä»¥ä¸Šç›®å½•æ‰€å±è€…å’Œæ‰€å±ç»„éƒ½éœ€è¦ä¸ºmysql.mysql</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera0 ~]# tar -xf mysql-5.6.20-linux-glibc2.5-x86_64.tar.gz </span><br><span class="line">[root@mastera0 ~]# cd mysql-5.6.20-linux-glibc2.5-x86_64</span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# ls</span><br><span class="line">bin  COPYING  data  docs  include  INSTALL-BINARY  lib  man  mysql-test  README  scripts  share  sql-bench  support-files</span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# cat INSTALL-BINARY</span><br><span class="line">... ...</span><br><span class="line"> To install and use a MySQL binary distribution, the basic command</span><br><span class="line">   sequence looks like this:</span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> groupadd mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> useradd -r -g mysql mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> <span class="built_in">cd</span> /usr/<span class="built_in">local</span></span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> tar zxvf /path/to/mysql-VERSION-OS.tar.gz</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> ln -s full-path-to-mysql-VERSION-OS mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> <span class="built_in">cd</span> mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chown -R mysql .</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chgrp -R mysql .</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> scripts/mysql_install_db --user=mysql</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chown -R root .</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> chown -R mysql data</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> bin/mysqld_safe --user=mysql &amp;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Next <span class="built_in">command</span> is optional</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> cp support-files/mysql.server /etc/init.d/mysql.server</span></span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# groupadd mysql</span><br><span class="line">[root@mastera0 mysql-5.6.20-linux-glibc2.5-x86_64]# cd ..</span><br><span class="line">[root@mastera0 ~]# useradd -r -g mysql mysql</span><br><span class="line">[root@mastera0 ~]# cd /usr/local</span><br><span class="line">[root@mastera0 local]# mv /root/mysql-5.6.20-linux-glibc2.5-x86_64 .</span><br><span class="line">[root@mastera0 local]# ls</span><br><span class="line">bin  games    lib    libexec                             sbin   src</span><br><span class="line">etc  include  lib64  mysql-5.6.20-linux-glibc2.5-x86_64  share</span><br><span class="line">[root@mastera0 local]# ln -s mysql-5.6.20-linux-glibc2.5-x86_64 mysql</span><br><span class="line">[root@mastera0 local]# ll mysql</span><br><span class="line">lrwxrwxrwx.  1 root root   34 Dec 11 12:20 mysql -&gt; mysql-5.6.20-linux-glibc2.5-x86_64</span><br><span class="line">[root@mastera0 mysql]# cd mysql</span><br><span class="line">[root@mastera0 mysql]# mkdir /data/mysql/data -p</span><br><span class="line">[root@mastera0 mysql]# chown mysql. /data/mysql/data</span><br><span class="line">[root@mastera0 mysql]# chown mysql. /data/mysql/data -R</span><br><span class="line">[root@mastera0 mysql]# ll -d /data/mysql/data</span><br><span class="line">drwxr-xr-x. 2 mysql mysql 4096 Dec 11 12:24 /data/mysql/data</span><br><span class="line">[root@mastera0 mysql]# scripts/mysql_install_db --user=mysql --datadir=/data/mysql/data --basedir=/usr/local/mysql</span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]# ll /data/mysql/data</span><br><span class="line">total 110604</span><br><span class="line">-rw-rw----. 1 mysql mysql 12582912 Dec 11 12:28 ibdata1</span><br><span class="line">-rw-rw----. 1 mysql mysql 50331648 Dec 11 12:28 ib_logfile0</span><br><span class="line">-rw-rw----. 1 mysql mysql 50331648 Dec 11 12:28 ib_logfile1</span><br><span class="line">drwx------. 2 mysql mysql     4096 Dec 11 12:28 mysql</span><br><span class="line">drwx------. 2 mysql mysql     4096 Dec 11 12:28 performance_schema</span><br><span class="line">drwx------. 2 mysql mysql     4096 Dec 11 12:28 test</span><br><span class="line">[root@mastera0 mysql]# vim /etc/my.cnf</span><br><span class="line">[client]</span><br><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœä¸è®¤è¯†è¿™ä¸ªå‚æ•°ä¼šå¿½ç•¥</span></span><br><span class="line">loose-default-character-set=utf8</span><br><span class="line">loose-prompt='\u@\h:\p [\d]&gt;'</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">basedir = /usr/local/mysql</span><br><span class="line">datadir = /data/mysql/data</span><br><span class="line">user=mysql</span><br><span class="line">port = 3306</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">pid-file=/data/tmp/mysql.pid</span><br><span class="line">tmpdir=/data1/tmp</span><br><span class="line">character_set_server=utf8</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">skip</span></span><br><span class="line">skip-external_locking=1</span><br><span class="line">skip-name-resolve=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">AB replication</span></span><br><span class="line">server-id = 1</span><br><span class="line">log-bin = /data/mysql/log-data/mastera</span><br><span class="line">binlog_format=row</span><br><span class="line">max_binlog_cache_size=2000M</span><br><span class="line">max_binlog_size=1G</span><br><span class="line">sync_binlog=1</span><br><span class="line"><span class="meta">#</span><span class="bash">expire_logs_days=7</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">semi_sync</span></span><br><span class="line">rpl_semi_sync_master_enabled=1</span><br><span class="line">rpl_semi_sync_master_timeout=1000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@mastera0 mysql]# pwd</span><br><span class="line">/usr/local/mysql</span><br><span class="line">[root@mastera0 mysql]# cp support-files/mysql.server /etc/init.d/mysql</span><br><span class="line">[root@mastera0 mysql]# echo export PATH=$PATH:/usr/local/mysql/support-files/ &gt;&gt; /etc/bashrc</span><br><span class="line">[root@mastera0 mysql]# service mysql start</span><br></pre></td></tr></table></figure>

<h5 id="è„šæœ¬å®ç°è‡ªåŠ¨å®‰è£…MySQL"><a href="#è„šæœ¬å®ç°è‡ªåŠ¨å®‰è£…MySQL" class="headerlink" title="è„šæœ¬å®ç°è‡ªåŠ¨å®‰è£…MySQL"></a>è„šæœ¬å®ç°è‡ªåŠ¨å®‰è£…MySQL</h5><p>å¦‚æœéœ€è¦åŒæ—¶å®‰è£…10å°ç”šè‡³1000å°ï¼Œé€šè¿‡è„šæœ¬æ¥å®Œæˆä¸€å®šæ˜¯æå¥½çš„ï¼</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> auto_install_mysql_5.6.20 </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‚æ•°è®¾ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --binpos=æŒ‡å®šmysqläºŒè¿›åˆ¶å®‰è£…åŒ…çš„ä½ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --basedir=æŒ‡å®šmysqlå®‰è£…ä½ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --datadir=æŒ‡å®šmysqlæ•°æ®å­˜æ”¾ä½ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --binlogdir=æŒ‡å®šmysqlbinlogå­˜æ”¾ä½ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --piddir=æŒ‡å®šmysqlè¿›ç¨‹å­˜æ”¾ä½ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --tmpdir=æŒ‡å®šmysqlä¸´æ—¶æ–‡ä»¶ä½ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --<span class="built_in">help</span> æŸ¥çœ‹å¸®åŠ©</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> eg. auto_install_mysql_5.6.20 --binpos=/tmp/mysql.tar.gz --datadir=/data/mysql/data --basedir=/usr/<span class="built_in">local</span>/mysql</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> éå†ä½ç½®å‚æ•°ï¼Œè·å–å¯¹åº”çš„å‚æ•°å€¼</span></span><br><span class="line">for i in $&#123;@&#125;</span><br><span class="line">do</span><br><span class="line">	case $&#123;i%=*&#125; in </span><br><span class="line">	--binpos)</span><br><span class="line">			binpos=$&#123;i#*=&#125;;;</span><br><span class="line">	--basedir)</span><br><span class="line">			basedir=$&#123;i#*=&#125;;;</span><br><span class="line">	--datadir)</span><br><span class="line">			datadir=$&#123;i#*=&#125;;;</span><br><span class="line">	--binlogdir)</span><br><span class="line">			binlogdir=$&#123;i#*=&#125;;;</span><br><span class="line">	--piddir)</span><br><span class="line">			piddir=$&#123;i#*=&#125;;;</span><br><span class="line">	--tmpdir)</span><br><span class="line">			tmpdir=$&#123;i#*=&#125;;;</span><br><span class="line">	esac</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">TAR()&#123;</span><br><span class="line"><span class="meta">#</span><span class="bash"> è§£å‹mysqläºŒè¿›åˆ¶å®‰è£…åŒ…åˆ°æŒ‡å®šmysqlå®‰è£…ä½ç½®</span></span><br><span class="line">tar -xf $binpos -C /tmp &amp;&gt; /dev/null</span><br><span class="line">rpm=$&#123;binpos##*/&#125;</span><br><span class="line">rm -r $basedir </span><br><span class="line">mkdir $basedir -p </span><br><span class="line">mv /tmp/$&#123;rpm%.tar.gz&#125;/* $basedir</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ADD_user_dir()&#123;</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºmysqlç”¨æˆ·å’Œç»„</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºæ•°æ®ç›®å½•ï¼ŒäºŒè¿›åˆ¶æ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œä¸´æ—¶ç›®å½•ï¼Œpidç›®å½•</span></span><br><span class="line">useradd mysql &amp;&gt; /dev/null </span><br><span class="line">for i in $datadir $binlogdir $piddir $tmpdir;do</span><br><span class="line">	rm -r $i</span><br><span class="line">	mkdir $i -p &amp;&gt; /dev/null </span><br><span class="line">	chown -R mysql:mysql $i</span><br><span class="line">done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">INIT()&#123;</span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡è„šæœ¬ç”Ÿæˆåˆå§‹åŒ–æ•°æ®</span></span><br><span class="line"><span class="meta">$</span><span class="bash">basedir/scripts/mysql_install_db --user=mysql --datadir=<span class="variable">$datadir</span> --basedir=<span class="variable">$basedir</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CONF()&#123;</span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–æœåŠ¡å™¨IPåœ°å€çš„ä¸»æœºä½ï¼Œç”¨ä½œserver-idçš„å€¼</span></span><br><span class="line">serverid=`ifconfig|grep -A 1 eno|tail -n 1|awk '&#123;print $2&#125;'|awk -F '.' '&#123;print $4&#125;'`</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/my.cnf &lt;&lt; ENDF</span><br><span class="line">[client]</span><br><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœä¸è®¤è¯†è¿™ä¸ªå‚æ•°ä¼šå¿½ç•¥</span></span><br><span class="line">loose-default-character-set=utf8</span><br><span class="line">loose-prompt='\u@\h:\p [\d]&gt;'</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">basedir = $basedir</span><br><span class="line">datadir = $datadir</span><br><span class="line">user=mysql</span><br><span class="line">port = 3306</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">pid-file=$piddir/mysql.pid</span><br><span class="line">tmpdir=$tmpdir</span><br><span class="line">character_set_server=utf8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">skip</span></span><br><span class="line">skip-external_locking=1</span><br><span class="line">skip-name-resolve=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">AB replication</span></span><br><span class="line">server-id = $serverid</span><br><span class="line">log-bin = $binlogdir/`hostname|awk -F . '&#123;print $1&#125;'`</span><br><span class="line">binlog_format=row</span><br><span class="line">max_binlog_cache_size=2000M</span><br><span class="line">max_binlog_size=1G</span><br><span class="line">sync_binlog=1</span><br><span class="line"><span class="meta">#</span><span class="bash">expire_logs_days=7</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">semi_sync</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rpl_semi_sync_master_enabled=1</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rpl_semi_sync_master_timeout=1000</span></span><br><span class="line">ENDF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†æ•°æ®åº“æœåŠ¡å¯åŠ¨è„šæœ¬å¤åˆ¶åˆ°/etc/init.d/</span></span><br><span class="line">cp $basedir/support-files/mysql.server /etc/init.d/mysql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹PATHè·¯å¾„ï¼Œå°†mysqlç›¸å…³å‘½ä»¤æ‰€åœ¨ç›®å½•åŠ å…¥</span></span><br><span class="line">echo export PATH=$PATH:$basedir/support-files/ &gt;&gt; /etc/bashrc</span><br><span class="line">source /etc/bashrc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Main()&#123;</span><br><span class="line">TAR </span><br><span class="line">ADD_user_dir </span><br><span class="line">INIT </span><br><span class="line">CONF </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Main</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“</p>
<p>ç›¸å¯¹äºrpmåŒ…å®‰è£…ï¼ŒäºŒè¿›åˆ¶å®‰è£…ç¨å¤æ‚ä¸€ç‚¹ï¼Œä½†åªéœ€è¦å®ç°è§„åˆ’å¥½basedirã€datadirã€binlogdirã€tmpdirç­‰è·¯å¾„å³å¯</p>
<p>å¦éœ€è¦æ³¨æ„ç»™mysqlä½¿ç”¨çš„ç›¸å…³ç›®å½•çš„æƒé™ä¸ºmysql:mysql</p>
<p>è¿˜æœ‰å°±æ˜¯ï¼Œå¦‚æœå·²ç»å®‰è£…è¿‡å…¶ä»–ç‰ˆæœ¬çš„æ•°æ®åº“ï¼Œè®°å¾—å¸è½½å¹²å‡€äº†ã€‚</p>
<p>æ­¤å¤„å®‰è£…çš„åªæ˜¯æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯éœ€è¦å¦å¤–å®‰è£…ã€‚</p>
<hr>
<h3 id="MySQLå®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“"><a href="#MySQLå®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“" class="headerlink" title="MySQLå®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“"></a>MySQLå®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“</h3><h4 id="MySQLå®¢æˆ·ç«¯çš„ä½¿ç”¨"><a href="#MySQLå®¢æˆ·ç«¯çš„ä½¿ç”¨" class="headerlink" title="MySQLå®¢æˆ·ç«¯çš„ä½¿ç”¨"></a>MySQLå®¢æˆ·ç«¯çš„ä½¿ç”¨</h4><p>ä¸Šä¸€èŠ‚å®‰è£…MySQLæœåŠ¡ç«¯æ—¶å·²ç»è®²è§£è¿‡å®¢æˆ·ç«¯çš„ä½¿ç”¨ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p>
<h4 id="pythonè¿æ¥MySQLæ•°æ®åº“"><a href="#pythonè¿æ¥MySQLæ•°æ®åº“" class="headerlink" title="pythonè¿æ¥MySQLæ•°æ®åº“"></a>pythonè¿æ¥MySQLæ•°æ®åº“</h4><p>Python æ ‡å‡†æ•°æ®åº“æ¥å£ä¸º Python DB-APIï¼ŒPython DB-APIä¸ºå¼€å‘äººå‘˜æä¾›äº†æ•°æ®åº“åº”ç”¨ç¼–ç¨‹æ¥å£ã€‚</p>
<p>Python æ•°æ®åº“æ¥å£æ”¯æŒéå¸¸å¤šçš„æ•°æ®åº“ï¼Œä½ å¯ä»¥é€‰æ‹©é€‚åˆä½ é¡¹ç›®çš„æ•°æ®åº“ï¼š</p>
<ul>
<li>GadFly</li>
<li>mSQL</li>
<li>MySQL</li>
<li>PostgreSQL</li>
<li>Microsoft SQL Server 2000</li>
<li>Informix</li>
<li>Interbase</li>
<li>Oracle</li>
<li>Sybase</li>
</ul>
<p>ä½ å¯ä»¥è®¿é—®Pythonæ•°æ®åº“æ¥å£åŠAPIæŸ¥çœ‹è¯¦ç»†çš„æ”¯æŒæ•°æ®åº“åˆ—è¡¨ã€‚</p>
<p>ä¸åŒçš„æ•°æ®åº“ä½ éœ€è¦ä¸‹è½½ä¸åŒçš„DB APIæ¨¡å—ï¼Œä¾‹å¦‚ä½ éœ€è¦è®¿é—®Oracleæ•°æ®åº“å’ŒMysqlæ•°æ®ï¼Œä½ éœ€è¦ä¸‹è½½Oracleå’ŒMySQLæ•°æ®åº“æ¨¡å—ã€‚</p>
<p>DB-API æ˜¯ä¸€ä¸ªè§„èŒƒ. å®ƒå®šä¹‰äº†ä¸€ç³»åˆ—å¿…é¡»çš„å¯¹è±¡å’Œæ•°æ®åº“å­˜å–æ–¹å¼, ä»¥ä¾¿ä¸ºå„ç§å„æ ·çš„åº•å±‚æ•°æ®åº“ç³»ç»Ÿå’Œå¤šç§å¤šæ ·çš„æ•°æ®åº“æ¥å£ç¨‹åºæä¾›ä¸€è‡´çš„è®¿é—®æ¥å£ ã€‚</p>
<p>Pythonçš„DB-APIï¼Œä¸ºå¤§å¤šæ•°çš„æ•°æ®åº“å®ç°äº†æ¥å£ï¼Œä½¿ç”¨å®ƒè¿æ¥å„æ•°æ®åº“åï¼Œå°±å¯ä»¥ç”¨ç›¸åŒçš„æ–¹å¼æ“ä½œå„æ•°æ®åº“ã€‚</p>
<p>Python DB-APIä½¿ç”¨æµç¨‹ï¼š</p>
<ul>
<li>å¼•å…¥ API æ¨¡å—ã€‚</li>
<li>è·å–ä¸æ•°æ®åº“çš„è¿æ¥ã€‚</li>
<li>æ‰§è¡ŒSQLè¯­å¥å’Œå­˜å‚¨è¿‡ç¨‹ã€‚</li>
<li>å…³é—­æ•°æ®åº“è¿æ¥ã€‚</li>
</ul>
<blockquote>
<h1 id="ä»€ä¹ˆæ˜¯MySQLdb"><a href="#ä»€ä¹ˆæ˜¯MySQLdb" class="headerlink" title="ä»€ä¹ˆæ˜¯MySQLdb?"></a>ä»€ä¹ˆæ˜¯MySQLdb?</h1></blockquote>
<p>MySQLdb æ˜¯ç”¨äºPythoné“¾æ¥Mysqlæ•°æ®åº“çš„æ¥å£ï¼Œå®ƒå®ç°äº† Python æ•°æ®åº“ API è§„èŒƒ V2.0ï¼ŒåŸºäº MySQL C API ä¸Šå»ºç«‹çš„ã€‚</p>
<blockquote>
<h1 id="å¦‚ä½•å®‰è£…MySQLdb"><a href="#å¦‚ä½•å®‰è£…MySQLdb" class="headerlink" title="å¦‚ä½•å®‰è£…MySQLdb?"></a>å¦‚ä½•å®‰è£…MySQLdb?</h1></blockquote>
<p>å®‰è£…MySQLdbï¼Œè¯·è®¿é—® <a href="http://sourceforge.net/projects/mysql-python" target="_blank" rel="noopener">http://sourceforge.net/projects/mysql-python</a> ï¼Œ(Linuxå¹³å°å¯ä»¥è®¿é—®ï¼š<a href="https://pypi.python.org/pypi/MySQL-python)ä»è¿™é‡Œå¯é€‰æ‹©é€‚åˆæ‚¨çš„å¹³å°çš„å®‰è£…åŒ…ï¼Œåˆ†ä¸ºé¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œæºä»£ç å®‰è£…åŒ…ã€‚" target="_blank" rel="noopener">https://pypi.python.org/pypi/MySQL-python)ä»è¿™é‡Œå¯é€‰æ‹©é€‚åˆæ‚¨çš„å¹³å°çš„å®‰è£…åŒ…ï¼Œåˆ†ä¸ºé¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œæºä»£ç å®‰è£…åŒ…ã€‚</a><br>å¦‚æœæ‚¨é€‰æ‹©äºŒè¿›åˆ¶æ–‡ä»¶å‘è¡Œç‰ˆæœ¬çš„è¯ï¼Œå®‰è£…è¿‡ç¨‹åŸºæœ¬å®‰è£…æç¤ºå³å¯å®Œæˆã€‚å¦‚æœä»æºä»£ç è¿›è¡Œå®‰è£…çš„è¯ï¼Œåˆ™éœ€è¦åˆ‡æ¢åˆ°MySQLdbå‘è¡Œç‰ˆæœ¬çš„é¡¶çº§ç›®å½•ï¼Œå¹¶é”®å…¥ä¸‹åˆ—å‘½ä»¤:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gunzip MySQL-python-1.2.2.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -xvf MySQL-python-1.2.2.tar</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> MySQL-python-1.2.2</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python setup.py build</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python setup.py install</span></span><br></pre></td></tr></table></figure>

<blockquote>
<h2 id="ä¸‹è½½å®‰è£…åŒ…"><a href="#ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="ä¸‹è½½å®‰è£…åŒ…"></a>ä¸‹è½½å®‰è£…åŒ…</h2></blockquote>
<p><a href="https://pypi.python.org/pypi/MySQL-python" target="_blank" rel="noopener">MySQL-python</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# ls</span><br><span class="line">MySQL-python-1.2.5.zip</span><br><span class="line">[root@localhost ~]# unzip MySQL-python-1.2.5.zip </span><br><span class="line">[root@localhost ~]# cd MySQL-python-1.2.5/</span><br><span class="line">[root@localhost MySQL-python-1.2.5]# ls</span><br><span class="line">oc      MANIFEST.in   _mysql_exceptions.py   README.md         setup_posix.py    site.cfg</span><br><span class="line">GPL-2.0  metadata.cfg  MySQL_python.egg-info  setup.cfg         setup_posix.pyc   tests</span><br><span class="line">HISTORY  _mysql.c      PKG-INFO               setup_common.py   setup.py</span><br><span class="line">INSTALL  MySQLdb       pymemcompat.h          setup_common.pyc  setup_windows.py</span><br><span class="line">[root@localhost MySQL-python-1.2.5]# python setup.py build</span><br><span class="line">sh: mysql_config: command not found</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File "setup.py", line 17, in &lt;module&gt;</span><br><span class="line">    metadata, options = get_config()</span><br><span class="line">  File "/root/MySQL-python-1.2.5/setup_posix.py", line 43, in get_config</span><br><span class="line">    libs = mysql_config("libs_r")</span><br><span class="line">  File "/root/MySQL-python-1.2.5/setup_posix.py", line 25, in mysql_config</span><br><span class="line">    raise EnvironmentError("%s not found" % (mysql_config.path,))</span><br><span class="line">EnvironmentError: mysql_config not found</span><br></pre></td></tr></table></figure>

<blockquote>
<h2 id="ç¼ºå°‘mysql-configå‘½ä»¤"><a href="#ç¼ºå°‘mysql-configå‘½ä»¤" class="headerlink" title="ç¼ºå°‘mysql_configå‘½ä»¤"></a>ç¼ºå°‘mysql_configå‘½ä»¤</h2></blockquote>
<p>è¯¥å‘½ä»¤æ˜¯ç”±mysql-develæˆ–è€…mariadb-develå®‰è£…ç”Ÿæˆï¼Œå› æ­¤å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…ï¼Œåœ¨æ£€è½¦site.cfgä¸­mysql_configçš„è·¯å¾„æ˜¯å¦æ­£ç¡®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost MySQL-python-1.2.5]# which mysql_config</span><br><span class="line">/usr/bin/which: no mysql_config in (/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin)</span><br><span class="line"></span><br><span class="line">[root@localhost MySQL-python-1.2.5]# yum install -y mariadb-devel</span><br><span class="line"></span><br><span class="line">[root@localhost MySQL-python-1.2.5]# which mysql_config</span><br><span class="line">/usr/bin/mysql_config</span><br><span class="line"></span><br><span class="line">[root@localhost MySQL-python-1.2.5]# vim site.cfg</span><br><span class="line">mysql_config=/usr/bin/mysql_config</span><br></pre></td></tr></table></figure>

<blockquote>
<h2 id="å¼€å§‹ç¼–è¯‘å®‰è£…"><a href="#å¼€å§‹ç¼–è¯‘å®‰è£…" class="headerlink" title="å¼€å§‹ç¼–è¯‘å®‰è£…"></a>å¼€å§‹ç¼–è¯‘å®‰è£…</h2></blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost MySQL-python-1.2.5]# python setup.py build</span><br><span class="line">[root@localhost MySQL-python-1.2.5]# python setup.py install</span><br></pre></td></tr></table></figure>

<blockquote>
<h2 id="åŠ è½½æ¨¡å—"><a href="#åŠ è½½æ¨¡å—" class="headerlink" title="åŠ è½½æ¨¡å—"></a>åŠ è½½æ¨¡å—</h2></blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> MySQLdb</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: dir(MySQLdb)</span><br><span class="line">Out[<span class="number">3</span>]: </span><br><span class="line">[<span class="string">'BINARY'</span>,</span><br><span class="line"> <span class="string">'Binary'</span>,</span><br><span class="line"> <span class="string">'Connect'</span>,</span><br><span class="line"> <span class="string">'Connection'</span>,</span><br><span class="line"> <span class="string">'DATE'</span>,</span><br><span class="line"> <span class="string">'DATETIME'</span>,</span><br><span class="line"> <span class="string">'DBAPISet'</span>,</span><br><span class="line"> <span class="string">'DataError'</span>,</span><br><span class="line"> <span class="string">'DatabaseError'</span>,</span><br><span class="line"> <span class="string">'Date'</span>,</span><br><span class="line"> <span class="string">'DateFromTicks'</span>,</span><br><span class="line"> <span class="string">'Error'</span>,</span><br><span class="line"> <span class="string">'FIELD_TYPE'</span>,</span><br><span class="line"> <span class="string">'IntegrityError'</span>,</span><br><span class="line"> <span class="string">'InterfaceError'</span>,</span><br><span class="line"> <span class="string">'InternalError'</span>,</span><br><span class="line"> <span class="string">'MySQLError'</span>,</span><br><span class="line"> <span class="string">'NULL'</span>,</span><br><span class="line"> <span class="string">'NUMBER'</span>,</span><br><span class="line"> <span class="string">'NotSupportedError'</span>,</span><br><span class="line"> <span class="string">'OperationalError'</span>,</span><br><span class="line"> <span class="string">'ProgrammingError'</span>,</span><br><span class="line"> <span class="string">'ROWID'</span>,</span><br><span class="line"> <span class="string">'STRING'</span>,</span><br><span class="line"> <span class="string">'TIME'</span>,</span><br><span class="line"> <span class="string">'TIMESTAMP'</span>,</span><br><span class="line"> <span class="string">'Time'</span>,</span><br><span class="line"> <span class="string">'TimeFromTicks'</span>,</span><br><span class="line"> <span class="string">'Timestamp'</span>,</span><br><span class="line"> <span class="string">'TimestampFromTicks'</span>,</span><br><span class="line"> <span class="string">'Warning'</span>,</span><br><span class="line"> <span class="string">'__all__'</span>,</span><br><span class="line"> <span class="string">'__author__'</span>,</span><br><span class="line"> <span class="string">'__builtins__'</span>,</span><br><span class="line"> <span class="string">'__doc__'</span>,</span><br><span class="line"> <span class="string">'__file__'</span>,</span><br><span class="line"> <span class="string">'__loader__'</span>,</span><br><span class="line"> <span class="string">'__name__'</span>,</span><br><span class="line"> <span class="string">'__package__'</span>,</span><br><span class="line"> <span class="string">'__path__'</span>,</span><br><span class="line"> <span class="string">'__revision__'</span>,</span><br><span class="line"> <span class="string">'__version__'</span>,</span><br><span class="line"> <span class="string">'_mysql'</span>,</span><br><span class="line"> <span class="string">'apilevel'</span>,</span><br><span class="line"> <span class="string">'connect'</span>,</span><br><span class="line"> <span class="string">'connection'</span>,</span><br><span class="line"> <span class="string">'constants'</span>,</span><br><span class="line"> <span class="string">'debug'</span>,</span><br><span class="line"> <span class="string">'escape'</span>,</span><br><span class="line"> <span class="string">'escape_dict'</span>,</span><br><span class="line"> <span class="string">'escape_sequence'</span>,</span><br><span class="line"> <span class="string">'escape_string'</span>,</span><br><span class="line"> <span class="string">'get_client_info'</span>,</span><br><span class="line"> <span class="string">'paramstyle'</span>,</span><br><span class="line"> <span class="string">'release'</span>,</span><br><span class="line"> <span class="string">'result'</span>,</span><br><span class="line"> <span class="string">'server_end'</span>,</span><br><span class="line"> <span class="string">'server_init'</span>,</span><br><span class="line"> <span class="string">'string_literal'</span>,</span><br><span class="line"> <span class="string">'test_DBAPISet_set_equality'</span>,</span><br><span class="line"> <span class="string">'test_DBAPISet_set_equality_membership'</span>,</span><br><span class="line"> <span class="string">'test_DBAPISet_set_inequality'</span>,</span><br><span class="line"> <span class="string">'test_DBAPISet_set_inequality_membership'</span>,</span><br><span class="line"> <span class="string">'thread_safe'</span>,</span><br><span class="line"> <span class="string">'threadsafety'</span>,</span><br><span class="line"> <span class="string">'times'</span>,</span><br><span class="line"> <span class="string">'version_info'</span></span><br></pre></td></tr></table></figure>

<blockquote>
<h1 id="æ•°æ®åº“è¿æ¥"><a href="#æ•°æ®åº“è¿æ¥" class="headerlink" title="æ•°æ®åº“è¿æ¥"></a>æ•°æ®åº“è¿æ¥</h1></blockquote>
<p>è¿æ¥æ•°æ®åº“å‰ï¼Œè¯·å…ˆç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š</p>
<ol>
<li><p>æ•°æ®åº“æœåŠ¡å·²ç»å¯åŠ¨ï¼Œå¹¶å·²åˆ›å»ºäº†æ•°æ®åº“ test1</p>
</li>
<li><p>åœ¨test1æ•°æ®åº“ä¸­æ‚¨å·²ç»åˆ›å»ºäº†è¡¨ db1</p>
</li>
<li><p>t1è¡¨å­—æ®µä¸º id,first_name,last_name,age,sex,income</p>
</li>
<li><p>è¿æ¥æ•°æ®åº“t1ä½¿ç”¨çš„ç”¨æˆ·åä¸º â€œrootâ€ ï¼Œå¯†ç ä¸º â€œuplookingâ€</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# systemctl start mariadb</span><br><span class="line">[root@localhost ~]# mysqladmin -uroot password 'uplooking'</span><br><span class="line">[root@localhost ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 4</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; create database db1;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; create table db1.t1 (id int auto_increment primary key,first_name varchar(50),last_name varchar(50),age int,sex char(1),income float);</span><br><span class="line">Query OK, 0 rows affected (0.09 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<h2 id="å®ä¾‹1ï¼šè¿æ¥æ•°æ®åº“è·å–æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯"><a href="#å®ä¾‹1ï¼šè¿æ¥æ•°æ®åº“è·å–æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="å®ä¾‹1ï¼šè¿æ¥æ•°æ®åº“è·å–æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯"></a>å®ä¾‹1ï¼šè¿æ¥æ•°æ®åº“è·å–æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯</h2></blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost python-mysql]# vim getversion.py </span><br><span class="line"><span class="meta">#</span><span class="bash">!/usr/bin/python</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line">import MySQLdb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰“å¼€æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db = MySQLdb.connect("localhost","root","uplooking","db1" )</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡ </span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨executeæ–¹æ³•æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">cursor.execute("SELECT VERSION()")</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ fetchone() æ–¹æ³•è·å–ä¸€æ¡æ•°æ®åº“ã€‚</span></span><br><span class="line">data = cursor.fetchone()</span><br><span class="line"></span><br><span class="line">print "Database version : %s " % data</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å…³é—­æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰§è¡Œç»“æœ</span></span><br><span class="line">[root@localhost python-mysql]# python getversion.py </span><br><span class="line">Database version : 5.5.44-MariaDB-log</span><br></pre></td></tr></table></figure>

<blockquote>
<h2 id="å®ä¾‹2ï¼šæŸ¥è¯¢mysqlä¸­çš„db1-t1è¡¨çš„ç»“æ„ï¼ˆæ•°æ®å­—å…¸ï¼‰ä¿¡æ¯"><a href="#å®ä¾‹2ï¼šæŸ¥è¯¢mysqlä¸­çš„db1-t1è¡¨çš„ç»“æ„ï¼ˆæ•°æ®å­—å…¸ï¼‰ä¿¡æ¯" class="headerlink" title="å®ä¾‹2ï¼šæŸ¥è¯¢mysqlä¸­çš„db1.t1è¡¨çš„ç»“æ„ï¼ˆæ•°æ®å­—å…¸ï¼‰ä¿¡æ¯"></a>å®ä¾‹2ï¼šæŸ¥è¯¢mysqlä¸­çš„db1.t1è¡¨çš„ç»“æ„ï¼ˆæ•°æ®å­—å…¸ï¼‰ä¿¡æ¯</h2></blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">sql=sys.argv[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db = MySQLdb.connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"uplooking"</span>,<span class="string">"db1"</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡ </span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨executeæ–¹æ³•æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ fetchone() æ–¹æ³•è·å–ä¸€æ¡æ•°æ®åº“ã€‚</span></span><br><span class="line">data = cursor.fetchall()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> i:</span><br><span class="line">                sys.stdout.write(str(j)+<span class="string">'\t'</span>)</span><br><span class="line">        sys.stdout.write(<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>

<p>è„šæœ¬å¸¦å‚æ•°æ‰§è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost python-mysql]# python select.py "desc db1.t1"</span><br><span class="line">id	int(11)	NO	PRI	None	auto_increment	</span><br><span class="line">first_name	varchar(50)	YES		None		</span><br><span class="line">last_name	varchar(50)	YES		None		</span><br><span class="line">age	int(11)	YES		None		</span><br><span class="line">sex	char(1)	YES		None		</span><br><span class="line">income	float	YES		None</span><br></pre></td></tr></table></figure>

<p>æ•°æ®åº“æŸ¥è¯¢æ“ä½œ</p>
<ul>
<li>PythonæŸ¥è¯¢Mysqlä½¿ç”¨ fetchone() æ–¹æ³•è·å–å•æ¡æ•°æ®, ä½¿ç”¨fetchall() æ–¹æ³•è·å–å¤šæ¡æ•°æ®ã€‚</li>
<li>fetchone(): è¯¥æ–¹æ³•è·å–ä¸‹ä¸€ä¸ªæŸ¥è¯¢ç»“æœé›†ã€‚ç»“æœé›†æ˜¯ä¸€ä¸ªå¯¹è±¡</li>
<li>fetchall():æ¥æ”¶å…¨éƒ¨çš„è¿”å›ç»“æœè¡Œ.</li>
<li>rowcount: è¿™æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ï¼Œå¹¶è¿”å›æ‰§è¡Œexecute()æ–¹æ³•åå½±å“çš„è¡Œæ•°ã€‚</li>
</ul>
<blockquote>
<h2 id="å®ä¾‹3ï¼šè·å–mysqlæ•°æ®åº“çš„å˜é‡å€¼"><a href="#å®ä¾‹3ï¼šè·å–mysqlæ•°æ®åº“çš„å˜é‡å€¼" class="headerlink" title="å®ä¾‹3ï¼šè·å–mysqlæ•°æ®åº“çš„å˜é‡å€¼"></a>å®ä¾‹3ï¼šè·å–mysqlæ•°æ®åº“çš„å˜é‡å€¼</h2></blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">key=sys.argv[<span class="number">1</span>]</span><br><span class="line">sql=<span class="string">"select @@"</span>+key</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db = MySQLdb.connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"uplooking"</span>,<span class="string">"db1"</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡ </span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨executeæ–¹æ³•æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ fetchone() æ–¹æ³•è·å–ä¸€æ¡æ•°æ®åº“ã€‚</span></span><br><span class="line">data = cursor.fetchall()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"&#123;&#125; : &#123;&#125;"</span>.format(sys.argv[<span class="number">1</span>],data[<span class="number">0</span>])</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>

<p>è·å–innodb_version\innodb_buffer_pool_size</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost python-mysql]# python Get_variables.py innodb_version</span><br><span class="line">innodb_version : 5.5.43-MariaDB-37.2</span><br><span class="line">[root@localhost python-mysql]# vim Get_variables.py </span><br><span class="line">[root@localhost python-mysql]# python Get_variables.py innodb_buffer_pool_size</span><br><span class="line">innodb_buffer_pool_size : 134217728</span><br></pre></td></tr></table></figure>


<blockquote>
<h2 id="å®ä¾‹4ï¼šåˆ›å»ºæ•°æ®åº“è¡¨"><a href="#å®ä¾‹4ï¼šåˆ›å»ºæ•°æ®åº“è¡¨" class="headerlink" title="å®ä¾‹4ï¼šåˆ›å»ºæ•°æ®åº“è¡¨"></a>å®ä¾‹4ï¼šåˆ›å»ºæ•°æ®åº“è¡¨</h2></blockquote>
<p>å¦‚æœæ•°æ®åº“è¿æ¥å­˜åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨execute()æ–¹æ³•æ¥ä¸ºæ•°æ®åº“åˆ›å»ºè¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºåˆ›å»ºè¡¨t2ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db = MySQLdb.connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"uplooking"</span>,<span class="string">"db1"</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡ </span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ•°æ®è¡¨å·²ç»å­˜åœ¨ä½¿ç”¨ execute() æ–¹æ³•åˆ é™¤è¡¨ã€‚</span></span><br><span class="line">cursor.execute(<span class="string">"DROP TABLE IF EXISTS t2"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ•°æ®è¡¨SQLè¯­å¥</span></span><br><span class="line">sql = <span class="string">"""CREATE TABLE t2 (</span></span><br><span class="line"><span class="string">         FIRST_NAME  CHAR(20) NOT NULL,</span></span><br><span class="line"><span class="string">         LAST_NAME  CHAR(20),</span></span><br><span class="line"><span class="string">         AGE INT,  </span></span><br><span class="line"><span class="string">         SEX CHAR(1),</span></span><br><span class="line"><span class="string">         INCOME FLOAT )"""</span></span><br><span class="line"></span><br><span class="line">cursor.execute(sql)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œè¯¥è„šæœ¬</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost python-mysql]# python createdb.py </span><br><span class="line">createdb.py:13: Warning: Unknown table 't2'</span><br><span class="line">  cursor.execute("DROP TABLE IF EXISTS t2")</span><br><span class="line"></span><br><span class="line">[root@localhost python-mysql]# ls</span><br><span class="line">createdb.py  Get_variables.py  getversion.py  select.py</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹è¡¨çš„ç»“æ„</span></span><br><span class="line"></span><br><span class="line">[root@localhost python-mysql]# python select.py "desc db1.t2"</span><br><span class="line">FIRST_NAME	char(20)	NO		None		</span><br><span class="line">LAST_NAME	char(20)	YES		None		</span><br><span class="line">AGE	int(11)	YES		None		</span><br><span class="line">SEX	char(1)	YES		None		</span><br><span class="line">INCOME	float	YES		None</span><br></pre></td></tr></table></figure>

<blockquote>
<h2 id="å®ä¾‹5ï¼šæ•°æ®åº“æ’å…¥æ“ä½œ"><a href="#å®ä¾‹5ï¼šæ•°æ®åº“æ’å…¥æ“ä½œ" class="headerlink" title="å®ä¾‹5ï¼šæ•°æ®åº“æ’å…¥æ“ä½œ"></a>å®ä¾‹5ï¼šæ•°æ®åº“æ’å…¥æ“ä½œ</h2></blockquote>
<p>ä»¥ä¸‹å®ä¾‹ä½¿ç”¨æ‰§è¡Œ SQL INSERT è¯­å¥å‘è¡¨ db1.t1 æ’å…¥è®°å½•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db = MySQLdb.connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"uplooking"</span>,<span class="string">"db1"</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡ </span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># SQL æ’å…¥è¯­å¥</span></span><br><span class="line">sql = <span class="string">"""INSERT INTO t1(FIRST_NAME,</span></span><br><span class="line"><span class="string">         LAST_NAME, AGE, SEX, INCOME)</span></span><br><span class="line"><span class="string">         VALUES ('Mac', 'Mohan', 20, 'M', 2000)"""</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">   <span class="comment"># æ‰§è¡Œsqlè¯­å¥</span></span><br><span class="line">   cursor.execute(sql)</span><br><span class="line">   <span class="comment"># æäº¤åˆ°æ•°æ®åº“æ‰§è¡Œ</span></span><br><span class="line">   db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">   <span class="comment"># Rollback in case there is any error</span></span><br><span class="line">   db.rollback()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œè¯¥è„šæœ¬ï¼Œå¹¶æŸ¥çœ‹db1.t1è¡¨ä¸­çš„æ‰€æœ‰å†…å®¹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost python-mysql]# python insert_table.py </span><br><span class="line">[root@localhost python-mysql]# python select.py "select * from db1.t1"</span><br><span class="line">1	Mac	Mohan	20	M	2000.0</span><br></pre></td></tr></table></figure>

<blockquote>
<h2 id="å®ä¾‹6ï¼šåˆ é™¤æ“ä½œ"><a href="#å®ä¾‹6ï¼šåˆ é™¤æ“ä½œ" class="headerlink" title="å®ä¾‹6ï¼šåˆ é™¤æ“ä½œ"></a>å®ä¾‹6ï¼šåˆ é™¤æ“ä½œ</h2></blockquote>
<p>åˆ é™¤æ“ä½œç”¨äºåˆ é™¤æ•°æ®è¡¨ä¸­çš„æ•°æ®ï¼Œä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº†åˆ é™¤æ•°æ®è¡¨ db1 ä¸­ AGE å¤§äº 20 çš„æ‰€æœ‰æ•°æ®ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æ•°æ®åº“è¿æ¥</span></span><br><span class="line">db = MySQLdb.connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"uplooking"</span>,<span class="string">"db1"</span> ))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡ </span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># SQL åˆ é™¤è¯­å¥</span></span><br><span class="line">sql = <span class="string">"DELETE FROM db1.t1 WHERE age &gt; 20"</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">   <span class="comment"># æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">   cursor.execute(sql)</span><br><span class="line">   <span class="comment"># æäº¤ä¿®æ”¹</span></span><br><span class="line">   db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">   <span class="comment"># å‘ç”Ÿé”™è¯¯æ—¶å›æ»š</span></span><br><span class="line">   db.rollback()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­è¿æ¥</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>

<blockquote>
<h2 id="å®ä¾‹7ï¼šæ‰§è¡Œäº‹åŠ¡"><a href="#å®ä¾‹7ï¼šæ‰§è¡Œäº‹åŠ¡" class="headerlink" title="å®ä¾‹7ï¼šæ‰§è¡Œäº‹åŠ¡"></a>å®ä¾‹7ï¼šæ‰§è¡Œäº‹åŠ¡</h2></blockquote>
<p>äº‹åŠ¡æœºåˆ¶å¯ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<p>äº‹åŠ¡åº”è¯¥å…·æœ‰4ä¸ªå±æ€§ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ã€‚è¿™å››ä¸ªå±æ€§é€šå¸¸ç§°ä¸ºACIDç‰¹æ€§ã€‚</p>
<ul>
<li>åŸå­æ€§ï¼ˆatomicityï¼‰ã€‚ä¸€ä¸ªäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­åŒ…æ‹¬çš„è¯¸æ“ä½œè¦ä¹ˆéƒ½åšï¼Œè¦ä¹ˆéƒ½ä¸åšã€‚</li>
<li>ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ã€‚äº‹åŠ¡å¿…é¡»æ˜¯ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚ä¸€è‡´æ€§ä¸åŸå­æ€§æ˜¯å¯†åˆ‡ç›¸å…³çš„ã€‚</li>
<li>éš”ç¦»æ€§ï¼ˆisolationï¼‰ã€‚ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ã€‚å³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å¹¶å‘çš„å…¶ä»–äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°ã€‚</li>
<li>æŒä¹…æ€§ï¼ˆdurabilityï¼‰ã€‚æŒç»­æ€§ä¹Ÿç§°æ°¸ä¹…æ€§ï¼ˆpermanenceï¼‰ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±åº”è¯¥æ˜¯æ°¸ä¹…æ€§çš„ã€‚æ¥ä¸‹æ¥çš„å…¶ä»–æ“ä½œæˆ–æ•…éšœä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</li>
</ul>
<p>Python DB API 2.0 çš„äº‹åŠ¡æä¾›äº†ä¸¤ä¸ªæ–¹æ³• commit æˆ– rollbackã€‚</p>
<p>å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># SQLåˆ é™¤è®°å½•è¯­å¥</span></span><br><span class="line">sql = <span class="string">"DELETE FROM db1.t1 WHERE age &gt; 20"</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">   <span class="comment"># æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">   cursor.execute(sql)</span><br><span class="line">   <span class="comment"># å‘æ•°æ®åº“æäº¤</span></span><br><span class="line">   db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">   <span class="comment"># å‘ç”Ÿé”™è¯¯æ—¶å›æ»š</span></span><br><span class="line">   db.rollback()</span><br></pre></td></tr></table></figure>

<p>å¯¹äºæ”¯æŒäº‹åŠ¡çš„æ•°æ®åº“ï¼Œ åœ¨Pythonæ•°æ®åº“ç¼–ç¨‹ä¸­ï¼Œå½“æ¸¸æ ‡å»ºç«‹ä¹‹æ—¶ï¼Œå°±è‡ªåŠ¨å¼€å§‹äº†ä¸€ä¸ªéšå½¢çš„æ•°æ®åº“äº‹åŠ¡ã€‚</p>
<p>commit()æ–¹æ³•æ¸¸æ ‡çš„æ‰€æœ‰æ›´æ–°æ“ä½œï¼Œrollbackï¼ˆï¼‰æ–¹æ³•å›æ»šå½“å‰æ¸¸æ ‡çš„æ‰€æœ‰æ“ä½œã€‚æ¯ä¸€ä¸ªæ–¹æ³•éƒ½å¼€å§‹äº†ä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚</p>
<blockquote>
<h1 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h1></blockquote>
<p>DB APIä¸­å®šä¹‰äº†ä¸€äº›æ•°æ®åº“æ“ä½œçš„é”™è¯¯åŠå¼‚å¸¸ï¼Œä¸‹è¡¨åˆ—å‡ºäº†è¿™äº›é”™è¯¯å’Œå¼‚å¸¸:</p>
<table>
<thead>
<tr>
<th align="left">å¼‚å¸¸</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Warning</td>
<td align="left">å½“æœ‰ä¸¥é‡è­¦å‘Šæ—¶è§¦å‘ï¼Œä¾‹å¦‚æ’å…¥æ•°æ®æ˜¯è¢«æˆªæ–­ç­‰ç­‰ã€‚å¿…é¡»æ˜¯ StandardError çš„å­ç±»ã€‚</td>
</tr>
<tr>
<td align="left">Error</td>
<td align="left">è­¦å‘Šä»¥å¤–æ‰€æœ‰å…¶ä»–é”™è¯¯ç±»ã€‚å¿…é¡»æ˜¯ StandardError çš„å­ç±»ã€‚</td>
</tr>
<tr>
<td align="left">InterfaceError</td>
<td align="left">å½“æœ‰æ•°æ®åº“æ¥å£æ¨¡å—æœ¬èº«çš„é”™è¯¯ï¼ˆè€Œä¸æ˜¯æ•°æ®åº“çš„é”™è¯¯ï¼‰å‘ç”Ÿæ—¶è§¦å‘ã€‚ å¿…é¡»æ˜¯Errorçš„å­ç±»ã€‚</td>
</tr>
<tr>
<td align="left">DatabaseError</td>
<td align="left">å’Œæ•°æ®åº“æœ‰å…³çš„é”™è¯¯å‘ç”Ÿæ—¶è§¦å‘ã€‚ å¿…é¡»æ˜¯Errorçš„å­ç±»ã€‚</td>
</tr>
<tr>
<td align="left">DataError</td>
<td align="left">å½“æœ‰æ•°æ®å¤„ç†æ—¶çš„é”™è¯¯å‘ç”Ÿæ—¶è§¦å‘ï¼Œä¾‹å¦‚ï¼šé™¤é›¶é”™è¯¯ï¼Œæ•°æ®è¶…èŒƒå›´ç­‰ç­‰ã€‚ å¿…é¡»æ˜¯DatabaseErrorçš„å­ç±»ã€‚</td>
</tr>
<tr>
<td align="left">OperationalError</td>
<td align="left">æŒ‡éç”¨æˆ·æ§åˆ¶çš„ï¼Œè€Œæ˜¯æ“ä½œæ•°æ®åº“æ—¶å‘ç”Ÿçš„é”™è¯¯ã€‚ä¾‹å¦‚ï¼šè¿æ¥æ„å¤–æ–­å¼€ã€ æ•°æ®åº“åæœªæ‰¾åˆ°ã€äº‹åŠ¡å¤„ç†å¤±è´¥ã€å†…å­˜åˆ†é…é”™è¯¯ç­‰ç­‰æ“ä½œæ•°æ®åº“æ˜¯å‘ç”Ÿçš„é”™è¯¯ã€‚ å¿…é¡»æ˜¯DatabaseErrorçš„å­ç±»ã€‚</td>
</tr>
<tr>
<td align="left">IntegrityError</td>
<td align="left">å®Œæ•´æ€§ç›¸å…³çš„é”™è¯¯ï¼Œä¾‹å¦‚å¤–é”®æ£€æŸ¥å¤±è´¥ç­‰ã€‚å¿…é¡»æ˜¯DatabaseErrorå­ç±»ã€‚</td>
</tr>
<tr>
<td align="left">InternalError</td>
<td align="left">æ•°æ®åº“çš„å†…éƒ¨é”™è¯¯ï¼Œä¾‹å¦‚æ¸¸æ ‡ï¼ˆcursorï¼‰å¤±æ•ˆäº†ã€äº‹åŠ¡åŒæ­¥å¤±è´¥ç­‰ç­‰ã€‚ å¿…é¡»æ˜¯DatabaseErrorå­ç±»ã€‚</td>
</tr>
<tr>
<td align="left">ProgrammingError</td>
<td align="left">ç¨‹åºé”™è¯¯ï¼Œä¾‹å¦‚æ•°æ®è¡¨ï¼ˆtableï¼‰æ²¡æ‰¾åˆ°æˆ–å·²å­˜åœ¨ã€SQLè¯­å¥è¯­æ³•é”™è¯¯ã€ å‚æ•°æ•°é‡é”™è¯¯ç­‰ç­‰ã€‚å¿…é¡»æ˜¯DatabaseErrorçš„å­ç±»ã€‚</td>
</tr>
<tr>
<td align="left">NotSupportedError</td>
<td align="left">ä¸æ”¯æŒé”™è¯¯ï¼ŒæŒ‡ä½¿ç”¨äº†æ•°æ®åº“ä¸æ”¯æŒçš„å‡½æ•°æˆ–APIç­‰ã€‚ä¾‹å¦‚åœ¨è¿æ¥å¯¹è±¡ä¸Š ä½¿ç”¨.rollback()å‡½æ•°ï¼Œç„¶è€Œæ•°æ®åº“å¹¶ä¸æ”¯æŒäº‹åŠ¡æˆ–è€…äº‹åŠ¡å·²å…³é—­ã€‚ å¿…é¡»æ˜¯DatabaseErrorçš„å­ç±»ã€‚</td>
</tr>
</tbody></table>
<blockquote>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1></blockquote>
<ul>
<li>å®‰è£…æ¨¡å— mysql-python</li>
<li>åŠ è½½æ¨¡å— import MySQLdb</li>
<li>æ‰“å¼€æ•°æ®åº“è¿æ¥ db = MySQLdb.connect(host,user,password,database))</li>
<li>ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡äº‹åŠ¡å¼€å§‹ cursor = db.cursor() </li>
<li>æ‰§è¡ŒSQLè¯­å¥ cursor.execute(sql)</li>
<li>å‘æ•°æ®åº“æäº¤ db.commit()</li>
<li>å‘ç”Ÿé”™è¯¯æ—¶å›æ»š db.rollback()</li>
<li>å…³é—­è¿æ¥ db.close()</li>
</ul>
<h4 id="PHPmyAdminåœ¨çº¿å·¥å…·ä½¿ç”¨"><a href="#PHPmyAdminåœ¨çº¿å·¥å…·ä½¿ç”¨" class="headerlink" title="PHPmyAdminåœ¨çº¿å·¥å…·ä½¿ç”¨"></a>PHPmyAdminåœ¨çº¿å·¥å…·ä½¿ç”¨</h4><p>PHPMYADMIN æ˜¯ä¸€ä¸ªä½¿ç”¨ PHP è¯­è¨€ç¼–å†™çš„,ä½¿ç”¨ web ç®¡ç† MYSQL çš„ç»„ä»¶ã€‚ä¸¥æ ¼æ„ä¹‰ä¸Šè¯´,å®ƒä¹Ÿæ˜¯ä¸€ç§ MYSQL çš„å®¢æˆ·ç«¯ã€‚æœ€è¿‘ä¸€æ®µæ—¶é—´,å‡ºç°çš„å¾ˆå¤šä¾é ç½‘ç«™è¿æ¥ MYSQL è¿›è¡Œç®¡ç†çš„äº§å“,åœ¨è¿™äº›â€œWEB GUIâ€ä¸­,PHPMYADMIN æ˜¯ä½¿ç”¨èŒƒå›´æœ€ä¸ºå¹¿æ³›çš„,åŒæ—¶ä¹Ÿå—åˆ°å¾ˆå¤š MYSQL æ•°æ®åº“ç®¡ç†å‘˜çš„å¥½è¯„ã€‚é€šè¿‡å®ƒ,ä½ å¯ä»¥éå¸¸è½»æ¾,éå¸¸æ–¹ä¾¿çš„ç®¡ç† MYSQL æ•°æ®åº“</p>
<ul>
<li>è·å– PHPMYADMIN</li>
</ul>
<p>ä½ å¯ä»¥åˆ° PHPMYADMIN çš„å®˜æ–¹ç½‘ç«™ <a href="http://www.phpmyadmin.net" target="_blank" rel="noopener">http://www.phpmyadmin.net</a> ä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬ã€‚</p>
<ul>
<li>å®‰è£… PHPMYADMIN</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.yum install -y httpd php php-mysql mariadb-server php-mbstring</span><br><span class="line">ftp://rpmfind.net/linux/centos/7.2.1511/os/x86_64/Packages/php-mbstring-5.4.16-36.el7_1.x86_64.rpm</span><br><span class="line"></span><br><span class="line">2.systemctl start httpd</span><br><span class="line">3.systemctl start mariadb</span><br><span class="line">4.mysqladmin -uroot password uplooking</span><br><span class="line">5.mysql -uroot -puplooking</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">create database phpmyadmin</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">grant all on phpmyadmin.* to php@localhost identified by <span class="string">'uplooking'</span>;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">flush privileges;</span></span><br><span class="line"></span><br><span class="line">6.echo hi &gt; /var/www/html/index.html</span><br><span class="line">æµ‹è¯•ä¸€ä¸‹webæœåŠ¡æ˜¯å¦æˆåŠŸ</span><br><span class="line"></span><br><span class="line">7.tar jxf /mnt/courses/db100/rhel7.2/materials/phpMyAdmin-4.4.15.5-all-languages.tar.bz2 -C /var/www/html</span><br><span class="line">8.chmod -R 755 html</span><br><span class="line">9.mv config.sample.inc.php config.sample.inc;vim config.inc.php</span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'blowfish_secret'</span>] = <span class="string">''</span>; /* YOU MUST FILL IN THIS FOR COOKIE AUTH! */</span></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * Servers configuration</span><br><span class="line"> */</span><br><span class="line"><span class="meta">$</span><span class="bash">i = 0;</span></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * First server</span><br><span class="line"> */</span><br><span class="line"><span class="meta">$</span><span class="bash">i++;</span></span><br><span class="line">/* Authentication type */</span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'user'</span>]          = <span class="string">'root'</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'password'</span>]      = <span class="string">'uplooking'</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'auth_type'</span>] = <span class="string">'config'</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">10.vim /etc/httpd/conf/httpd.conf</span><br><span class="line">&lt;IfModule dir_module&gt;</span><br><span class="line">    DirectoryIndex index.html index.php</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">11.systemctl restart httpd</span><br><span class="line">ä»æµè§ˆå™¨è¾“å…¥172.25.0.10</span><br></pre></td></tr></table></figure>


<p>é»˜è®¤å®‰è£…phpMyAdminï¼Œé€šå¸¸åªèƒ½è¿ä¸€å°MySqlæœåŠ¡å™¨ï¼Œå…¶é…ç½®ä¿¡æ¯æ˜¯ä¿å­˜åœ¨phpMyAdminçš„é…ç½®æ–‡ä»¶é‡Œçš„ï¼Œå½“æˆ‘ä»¬éœ€è¦åœ¨å¤šå°æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œåˆ‡æ¢ç™»é™†çš„æ—¶å€™ï¼Œä¿®æ”¹èµ·æ¥éå¸¸éº»çƒ¦ã€‚éµç…§ä¸‹é¢çš„é…ç½®æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨phpMyAdminè¿æ¥å¤šå°MySQLã€‚</p>
<p>ç™»é™†phpMyAdminæ—¶åªéœ€è¾“å…¥ç”¨æˆ·åã€å¯†ç ï¼ŒæœåŠ¡å™¨åœ°å€ä¸ºä¸‹æ‹‰åˆ—è¡¨å¯é€‰ï¼Œç™»é™†åä¹Ÿå¯é€‰æ‹©å…¶ä»–æœåŠ¡å™¨å¿«é€Ÿåˆ‡æ¢ã€‚ ï¼ˆæ¨èï¼‰</p>
<p>ä¼˜ç‚¹ï¼šç™»é™†æ“ä½œç®€ä¾¿ï¼Œç™»é™†ååˆ‡æ¢æœåŠ¡å™¨æ— é¡»é€€å‡ºå½“å‰è¿æ¥ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">hosts = array(</span></span><br><span class="line">'1'=&gt;array('host'=&gt;'localhost','user'=&gt;'root','password'=&gt;'uplooking'),</span><br><span class="line">'2'=&gt;array('host'=&gt;'172.25.0.11','user'=&gt;'root','password'=&gt;'uplooking')</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">for ($i=1;$i&lt;=count($hosts);$i++)&#123;</span><br><span class="line"></span><br><span class="line">/* Authentication type */</span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'user'</span>]          = <span class="variable">$hosts</span>[<span class="variable">$i</span>][<span class="string">'user'</span>];</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'password'</span>]      = <span class="variable">$hosts</span>[<span class="variable">$i</span>][<span class="string">'password'</span>];</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'auth_type'</span>] = <span class="string">'config'</span>;</span></span><br><span class="line">/* Server parameters */</span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'host'</span>] = <span class="variable">$hosts</span>[<span class="variable">$i</span>][<span class="string">'host'</span>];</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'connect_type'</span>] = <span class="string">'tcp'</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'compress'</span>] = <span class="literal">false</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'AllowNoPassword'</span>] = <span class="literal">false</span>;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="pic/15-phpmyadmin.png" alt="phpmyadmin1"></p>
<h4 id="MySQL-Workbench-è¿æ¥æ•°æ®åº“"><a href="#MySQL-Workbench-è¿æ¥æ•°æ®åº“" class="headerlink" title="MySQL Workbench è¿æ¥æ•°æ®åº“"></a>MySQL Workbench è¿æ¥æ•°æ®åº“</h4><p>MySQL Workbench æ˜¯ä¸€æ¬¾ä¸“é—¨ä¸ºç”¨æˆ·æä¾›äº†ç”¨äºåˆ›å»ºã€ä¿®æ”¹ã€æ‰§è¡Œå’Œä¼˜åŒ–SQLçš„å¯è§†åŒ–å·¥å…·ï¼Œå¼€å‘äººå‘˜å¯ä»¥å¾ˆè½»æ¾çš„ç®¡ç†æ•°æ•°æ®ã€‚è¯¥å·¥å…·å¹¶ä¸”æä¾›å¼€å‘è€…ä¸€æ•´å¥—å¯è§†åŒ–ç”¨äºåˆ›å»ºã€ç¼–è¾‘å’Œç®¡ç†SQL æŸ¥è¯¢å’Œç®¡ç†æ•°æ®åº“è¿æ¥ã€‚åœ¨å¯è§†åŒ–SQLç¼–è¾‘å·¥ä½œæ¨¡å¼ä¸‹ï¼Œç”¨æˆ·åˆ›å»ºè¡¨ï¼Œåˆ é™¤è¡¨ï¼Œä¿®æ”¹è¡¨ä¿¡æ¯ç­‰åªéœ€è¦ä½¿ç”¨ç®€å•çš„å¯ç¼–è¾‘åˆ—è¡¨ä¸­å®Œæˆã€‚</p>
<p>ç”¨æˆ·é€šå¸¸è®¤ä¸ºMySQL Workbench æ˜¯ä¸€ä¸ªMySQL æ•°æ®åº“ERæ¨¡å‹è®¾è®¡çš„å·¥å…·ï¼Œå¯ä»¥è¯´æ˜¯ä¸“é—¨ä¸ºMySQLæ•°æ®åº“æä¾›çš„æ•°æ®åº“è®¾è®¡å·¥å…·ï¼Œç”¨æˆ·ä½¿ç”¨MySQL Workbenchå¯ä»¥å¾ˆå®¹æ˜“çš„è®¾è®¡ã€ç¼–è¾‘æ•°æ®åº“ERæ¨¡å‹ã€‚è¿™ä¸€åŠŸèƒ½å¯ä»¥è¯´æ˜¯MySQL Workbenchçš„ä¸€å¤§äº®ç‚¹ã€‚</p>
<blockquote>
<p>è½¯ä»¶è·å–</p>
</blockquote>
<p><a href="https://dev.mysql.com/downloads/workbench/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/workbench/</a></p>
<blockquote>
<p>è½¯ä»¶å®‰è£…</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@workstation software]# pwd</span><br><span class="line">/software</span><br><span class="line">[root@workstation software]# ls mysql-workbench-community-6.3.8-1.el7.x86_64.rpm mysql-workbench-community-6.3.8-1.el7.x86_64.rpm</span><br><span class="line">[root@workstation software]# rpm -ivh mysql-workbench-community-6.3.8-1.el7.x86_64.rpm </span><br><span class="line">warning: mysql-workbench-community-6.3.8-1.el7.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY</span><br><span class="line">error: Failed dependencies:</span><br><span class="line">	tinyxml is needed by mysql-workbench-community-6.3.8-1.el7.x86_64</span><br><span class="line">	libzip is needed by mysql-workbench-community-6.3.8-1.el7.x86_64</span><br><span class="line">	python-paramiko &gt;= 1.15.1 is needed by mysql-workbench-community-6.3.8-1.el7.x86_64</span><br><span class="line">	proj is needed by mysql-workbench-community-6.3.8-1.el7.x86_64</span><br><span class="line">	libodbc.so.2()(64bit) is needed by mysql-workbench-community-6.3.8-1.el7.x86_64</span><br><span class="line">	libodbcinst.so.2()(64bit) is needed by mysql-workbench-community-6.3.8-1.el7.x86_64</span><br></pre></td></tr></table></figure>

<p>éœ€è¦ä¸€äº›ä¾èµ–å…³ç³»åŒ…ï¼Œå…¶ä¸­unixODBCå’Œlibzipæœ¬åœ°yumä¸­æœ‰ï¼Œè€Œtinyxml\python-paramiko\projéœ€è¦ä¸‹è½½</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@workstation workbench]# ls</span><br><span class="line">libtomcrypt-1.17-23.el7.x86_64.rpm        mysql-workbench-community-6.3.8-1.el7.x86_64.rpm</span><br><span class="line">libtomcrypt-devel-1.17-23.el7.x86_64.rpm  proj-4.8.0-4.el7.x86_64.rpm</span><br><span class="line">libtomcrypt-doc-1.17-23.el7.noarch.rpm    python2-crypto-2.6.1-13.el7.x86_64.rpm</span><br><span class="line">libtommath-0.42.0-4.el7.x86_64.rpm        python2-ecdsa-0.13-4.el7.noarch.rpm</span><br><span class="line">libtommath-devel-0.42.0-4.el7.x86_64.rpm  python2-paramiko-1.16.1-1.el7.noarch.rpm</span><br><span class="line">libtommath-doc-0.42.0-4.el7.noarch.rpm    tinyxml-2.6.2-3.el7.x86_64.rpm</span><br><span class="line">[root@workstation workbench]# rpm -ivh libtommath* libtomcrypt* python2-crypto* python2-ecdsa* python2-paramiko* tinyxml* proj* </span><br><span class="line">Preparing...                          ################################# [100%]</span><br><span class="line">	package libtommath-0.42.0-4.el7.x86_64 is already installed</span><br><span class="line">	package libtomcrypt-1.17-23.el7.x86_64 is already installed</span><br><span class="line">	package python2-crypto-2.6.1-13.el7.x86_64 is already installed</span><br><span class="line">	package python2-ecdsa-0.13-4.el7.noarch is already installed</span><br><span class="line">	package python2-paramiko-1.16.1-1.el7.noarch is already installed</span><br><span class="line">	package libtomcrypt-devel-1.17-23.el7.x86_64 is already installed</span><br><span class="line">	package libtommath-devel-0.42.0-4.el7.x86_64 is already installed</span><br><span class="line">	package proj-4.8.0-4.el7.x86_64 is already installed</span><br><span class="line">	package tinyxml-2.6.2-3.el7.x86_64 is already installed</span><br><span class="line">	package libtomcrypt-doc-1.17-23.el7.noarch is already installed</span><br><span class="line">	package libtommath-doc-0.42.0-4.el7.noarch is already installed</span><br><span class="line">[root@workstation workbench]# yum install -y unixODBC libzip</span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Package unixODBC-2.3.1-11.el7.x86_64 already installed and latest version</span><br><span class="line">Package libzip-0.10.1-8.el7.x86_64 already installed and latest version</span><br><span class="line">Nothing to do</span><br><span class="line">[root@workstation workbench]# rpm -ivh mysql-workbench-community-6.3.8-1.el7.x86_64.rpm </span><br><span class="line">warning: mysql-workbench-community-6.3.8-1.el7.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY</span><br><span class="line">Preparing...                          ################################# [100%]</span><br><span class="line">Updating / installing...</span><br><span class="line">   1:mysql-workbench-community-6.3.8-1################################# [100%]</span><br><span class="line">[root@workstation workbench]# </span><br><span class="line">[root@workstation workbench]# rpm -ql mysql-workbench-community |head </span><br><span class="line">/usr/bin/mysql-workbench</span><br><span class="line">/usr/bin/wbcopytables</span><br><span class="line">/usr/lib64/mysql-workbench</span><br><span class="line">/usr/lib64/mysql-workbench/libantlr3c_wb.so</span><br><span class="line">/usr/lib64/mysql-workbench/libcdbc.so</span><br><span class="line">/usr/lib64/mysql-workbench/libcdbc.so.6.3.8</span><br><span class="line">/usr/lib64/mysql-workbench/libctemplate.so</span><br><span class="line">/usr/lib64/mysql-workbench/libctemplate.so.3</span><br><span class="line">/usr/lib64/mysql-workbench/libctemplate.so.3.0.0</span><br><span class="line">/usr/lib64/mysql-workbench/libgdal.so.1</span><br></pre></td></tr></table></figure>

<blockquote>
<h1 id="SQL-Developmentçš„åŸºæœ¬æ“ä½œ"><a href="#SQL-Developmentçš„åŸºæœ¬æ“ä½œ" class="headerlink" title="SQL Developmentçš„åŸºæœ¬æ“ä½œ"></a>SQL Developmentçš„åŸºæœ¬æ“ä½œ</h1></blockquote>
<ul>
<li>åˆ›å»ºæ•°æ®åº“è¿æ¥</li>
<li>åˆ›å»ºæ–°çš„æ•°æ®åº“</li>
<li>åˆ›å»ºå’Œåˆ é™¤æ–°çš„æ•°æ®è¡¨</li>
<li>æ·»åŠ ã€ä¿®æ”¹è¡¨è®°å½•</li>
<li>æŸ¥è¯¢è¡¨è®°å½•</li>
<li>ä¿®æ”¹è¡¨ç»“æ„</li>
</ul>
<blockquote>
<p>å¯åŠ¨MySQL Workbench</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@workstation ~]# mysql-workbench</span><br></pre></td></tr></table></figure>

<p><img src="pic/33.png" alt="workbench"></p>
<blockquote>
<p>MySQL Workbenchå·¥ä½œç©ºé—´ä¸‹å¯¹æ•°æ®åº“æ•°æ®è¿›è¡Œç®¡ç†ä¹‹å‰ï¼Œéœ€è¦å…ˆåˆ›å»ºæ•°æ®åº“è¿æ¥</p>
</blockquote>
<p>å»ºç«‹è¿æ¥å‰ï¼Œéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šç»™MySQL Workbenchæˆæƒ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera ~]# systemctl start mariadb</span><br><span class="line">[root@mastera ~]# systemctl stop firewalld</span><br><span class="line">[root@mastera ~]# mysql</span><br><span class="line">ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)</span><br><span class="line">[root@mastera ~]# mysql -uroot -puplooking</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 3</span><br><span class="line">Server version: 5.5.44-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; grant all on *.* to root@'172.25.0.10' identified by 'uplooking';</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><img src="pic/34.png" alt="workbench"></p>
<blockquote>
<p>æˆåŠŸåˆ›å»ºæ•°æ®åº“è¿æ¥åï¼Œå¯ä»¥åˆ›å»ºæ–°çš„æ•°æ®åº“ã€‚</p>
</blockquote>
<p><img src="pic/35.png" alt="workbench"></p>
<p><img src="pic/36.png" alt="workbench"></p>
<p><img src="pic/37.png" alt="workbench"></p>
<p><img src="pic/38.png" alt="workbench"></p>
<blockquote>
<p>æˆåŠŸåˆ›å»ºæ•°æ®åº“è¿æ¥åï¼Œåœ¨å·¦ä¾§çš„SCHEMASä¸‹é¢å¯ä»¥çœ‹åˆ°testæ•°æ®åº“ã€‚ç”¨æˆ·å¯ä»¥åˆ›å»ºæ–°çš„æ•°æ®åº“ï¼Œæœ¬å°èŠ‚ä¸»è¦åˆ›å»ºå’Œåˆ é™¤æ–°çš„æ•°æ®è¡¨æ“ä½œã€‚</p>
</blockquote>
<p><img src="pic/39.png" alt="workbench"></p>
<p><img src="pic/40.png" alt="workbench"></p>
<p><img src="pic/41.png" alt="workbench"></p>
<p><img src="pic/42.png" alt="workbench"></p>
<p>ä¸‹é¢ç®€å•ä»‹ç»MySQL Workbenchåœ¨å›¾å½¢ç•Œé¢ä¸‹å¯¹æ•°æ®åº“è¡¨çš„ç»´æŠ¤æ“ä½œã€‚</p>
<blockquote>
<p>æŸ¥è¯¢t1è¡¨ä¸­çš„æ•°æ®æ“ä½œã€‚</p>
</blockquote>
<p><img src="pic/43.png" alt="workbench"></p>
<blockquote>
<p>ä½¿ç”¨WorkBenchæ“ä½œå¯ä»¥ä¿®æ”¹è¡¨çš„ç»“æ„ã€‚</p>
</blockquote>
<p><img src="pic/44.png" alt="workbench"></p>
<p><img src="pic/45.png" alt="workbench"></p>
<p><img src="pic/46.png" alt="workbench"></p>
<blockquote>
<h1 id="Data-Modelingçš„åŸºæœ¬æ“ä½œ"><a href="#Data-Modelingçš„åŸºæœ¬æ“ä½œ" class="headerlink" title="Data Modelingçš„åŸºæœ¬æ“ä½œ"></a>Data Modelingçš„åŸºæœ¬æ“ä½œ</h1></blockquote>
<ul>
<li>å»ºç«‹ERæ¨¡å‹</li>
<li>å¯¼å…¥ERæ¨¡å‹</li>
</ul>
<p><img src="pic/47.png" alt="workbench"></p>
<p><img src="pic/48.png" alt="workbench"></p>
<p><img src="pic/49.png" alt="workbench"></p>
<p><img src="pic/50.png" alt="workbench"></p>
<p>æœ€å æ‰§è¡Œ â€œFileâ€-&gt;â€Exportâ€ æŒ‰é’®ï¼Œé€‰æ‹© Forward Engineer SQL CREATE Script (ctrl+shift+G). è¿™æ ·å°±å¯ä»¥æŠŠæ¨¡å‹å¯¼å‡ºä¸ºSQLè„šæœ¬æ–‡ä»¶ã€‚ç°åœ¨æ‰§è¡Œè¿™ä¸ªSQLæ–‡ä»¶å°±OKäº†ã€‚</p>
<blockquote>
<h1 id="Server-Administrationçš„åŸºæœ¬æ“ä½œ"><a href="#Server-Administrationçš„åŸºæœ¬æ“ä½œ" class="headerlink" title="Server Administrationçš„åŸºæœ¬æ“ä½œ"></a>Server Administrationçš„åŸºæœ¬æ“ä½œ</h1></blockquote>
<ul>
<li>ç®¡ç†MySQLç”¨æˆ·</li>
<li>å¤‡ä»½MySQLæ•°æ®åº“</li>
<li>è¿˜åŸMySQLæ•°æ®åº“</li>
</ul>
<blockquote>
<p>ç®¡ç†MySQLç”¨æˆ·</p>
</blockquote>
<p><img src="pic/51.png" alt="workbench"></p>
<blockquote>
<p>å¤‡ä»½MySQLæ•°æ®åº“</p>
</blockquote>
<p><img src="pic/52.png" alt="workbench"></p>
<p><img src="pic/53.png" alt="workbench"></p>
<p>æ”¹å¤‡ä»½ä¸ºé€»è¾‘å¤‡ä»½ï¼Œä½¿ç”¨çš„æ˜¯mysqldumpå‘½ä»¤è¿›è¡Œçš„ï¼Œå¤‡ä»½æ•°æ®å­˜æ”¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@workstation ~]# ls /root/dumps/Dump20170207/</span><br><span class="line">db1_t1.sql  db1_t2.sql</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿˜åŸMySQLæ•°æ®åº“</p>
</blockquote>
<p>å°†db1åº“ä¸­çš„t1å’Œt2è¡¨åˆ é™¤ï¼Œè¿›è¡Œè¿˜åŸ</p>
<p><img src="pic/54.png" alt="workbench"></p>
<p><img src="pic/55.png" alt="workbench"></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>MySQLåŸºç¡€ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL ç®¡ç†è¯¾ç¨‹ ç¬¬ä¸€è¯¾ è¯¾ç¨‹ç®€ä»‹</title>
    <url>/2016/12/25/booboo_mysql/00-MySQL%E7%AE%A1%E7%90%86%E8%AF%BE%E7%A8%8B%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<p><img src="pic/00-mysql.png" alt="mysqlå›¾ç‰‡"></p>
<blockquote>
<ul>
<li>æ•™å­¦å¯¹è±¡ï¼šæœ‰ä¸€å®šlinuxåŸºç¡€</li>
<li>æ•°æ®åº“ç‰ˆæœ¬ï¼šmaraidb5.5 mariadb10.2 mysql5.7</li>
<li>æ“ä½œç³»ç»Ÿï¼šRHEL7.2 æœ€å°åŒ–å®‰è£…</li>
</ul>
</blockquote>
<p>MySQL ç®¡ç†è¯¾ç¨‹ï¼Œé¢„è®¡è¯¾æ—¶10å¤©ï¼Œè¯´æ˜¯è¯´æ•°æ®åº“ï¼Œå…¶å®ä¹Ÿå±äºé¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¼šå‘ç°åœ¨é¡¹ç›®çš„å½“ä¸­ï¼Œå¤šå¤šå°‘å°‘éƒ½ä¼šç”¨åˆ°æ•°æ®åº“ï¼Œè€Œä¸”æ•°æ®åº“è¿˜æ˜¯ä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œåœ¨æ•´ä¸ªé¡¹ç›®ç¯å¢ƒå½“ä¸­å‘¢ï¼Œæˆ‘ä»¬ä¼šè®²åˆ°é¡¹ç›®çš„æ­å»ºã€è¿ç§»ã€æ‹“å±•ï¼Œä¸€å°æœºå™¨å˜æˆå¤šå°æœºå™¨ï¼Œè§£å†³ç”¨æˆ·çš„æ€§èƒ½é—®é¢˜ï¼Œé‚£ä¹ˆåœ¨æ‹“å±•è¿‡ç¨‹å½“ä¸­å‘¢ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ­¥æ‹“å±•çš„éƒ½æ˜¯æ•°æ®åº“ï¼Œå› ä¸ºæ•°æ®åº“çš„å‹åŠ›æ˜¯æœ€å¤§çš„ï¼Œç¬¬ä¸€ä¸ªé‡åˆ°æ€§èƒ½ç“¶é¢ˆçš„éƒ½æ˜¯åœ¨æ•°æ®åº“ä¸Šé¢ï¼Œæ‰€ä»¥çš„è¯å‘¢ï¼Œæˆ‘ä»¬åœ¨MySQLçš„è¯¾ç¨‹å½“ä¸­ä¼šä¸»è¦ä»¥ç³»ç»Ÿç®¡ç†å‘˜çš„è§’åº¦å»è®²è®²æ•°æ®åº“çš„å¤‡ä»½ã€å†—ä½™ã€æ‰©å±•ã€é«˜å¯ç”¨ã€è´Ÿè½½å‡è¡¡ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆMySQL"><a href="#ä¸ºä»€ä¹ˆMySQL" class="headerlink" title="ä¸ºä»€ä¹ˆMySQL ?"></a>ä¸ºä»€ä¹ˆMySQL ?</h2><p>DB-Engines æœ€è¿‘å‘å¸ƒäº† 2017 å¹´ 2 æœˆä»½çš„æ•°æ®åº“æ’åã€‚</p>
<p>å‰ååä¸­ï¼ŒOracleï¼ŒMySQL å’Œ Microsoft SQL Server ä»å æ®å‰ä¸‰åï¼ŒOracle è™½ç„¶é•¿æœŸéœ¸å é¦–ä½ï¼Œä½†å¾—åˆ†å´å‘ˆä¸‹é™è¶‹åŠ¿ï¼Œä¸ 1 æœˆç›¸æ¯”å°‘äº† 12.89ï¼Œä¸å»å¹´åŒæœŸç›¸æ¯”ï¼Œå°‘äº† 72.31ã€‚ç¬¬äºŒåçš„ MySQL å¾—åˆ†å‡æœ‰æ‰€ä¸Šæ¶¨ï¼Œä¸å»å¹´åŒæœŸç›¸æ¯”ï¼Œå¢é•¿ 59.18ï¼Œç¬¬ä¸‰åçš„ Microsoft SQL Server å¾—åˆ†è¾ƒ 1 æœˆä¸‹é™äº† 17.5ï¼Œæ¯”å»å¹´åŒæœŸï¼Œå¾—åˆ†æœ‰æ¯”è¾ƒé«˜çš„æå‡ã€‚</p>
<p>å…·ä½“æƒ…å†µè¯·çœ‹å‰ 20 åæ’åæƒ…å†µï¼š</p>
<p><img src="pic/20170206-database-1.jpg" alt="20170206-database-1.jpg"></p>
<p>å®Œæ•´æ’åè¯·çœ‹è¿™é‡Œï¼š<a href="http://db-engines.com/en/ranking" target="_blank" rel="noopener">http://db-engines.com/en/ranking</a></p>
<p>DB-Engines æ’åçš„æ•°æ®ä¾æ® 5 ä¸ªä¸åŒçš„å› ç´ ï¼š</p>
<ul>
<li>Google ä»¥åŠ Bing æœç´¢å¼•æ“çš„å…³é”®å­—æœç´¢æ•°é‡</li>
<li>Google Trends çš„æœç´¢æ•°é‡</li>
<li>Indeed ç½‘ç«™ä¸­çš„èŒä½æœç´¢é‡</li>
<li>LinkedIn ä¸­æåˆ°å…³é”®å­—çš„ä¸ªäººèµ„æ–™æ•°</li>
<li>Stackoverflow ä¸Šç›¸å…³çš„é—®é¢˜å’Œå…³æ³¨è€…æ•°é‡</li>
</ul>
<p>ä¸‹å›¾æ˜¯æ¯ä¸ªæ•°æ®åº“çš„å˜åŒ–è¶‹åŠ¿ï¼š</p>
<p><img src="pic/20170206-database-2.jpg" alt="20170206-database-2.jpg"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå‰ 3 åä¸€ç›´ä¿æŒç€è¿œé«˜äºå…¶å®ƒæ•°æ®åº“çš„åœ°ä½ï¼Œå‰ä¸‰åŸºæœ¬æ²¡æœ‰æ‚¬å¿µã€‚åªæ˜¯ï¼Œç¬¬äºŒåå’Œç¬¬ä¸‰åçš„MySQL å’Œ Microsoft SQL Server å·²ç»è¶Šæ¥è¶Šæ¥è¿‘ç¬¬ä¸€åçš„Oracleï¼Œè¯´ä¸å®šåœ¨ä¸‹ä¸€æ¬¡æ’åå‘å¸ƒæ—¶ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°ä¸ä¸€æ ·çš„ä¸‰ç”²æ’åã€‚</p>
<p>è¯¦ç»†è¶‹åŠ¿è¯·çœ‹è¿™é‡Œï¼š<a href="http://db-engines.com/en/ranking_trend" target="_blank" rel="noopener">http://db-engines.com/en/ranking_trend</a></p>
<p>æœ‰äººç”¨pythonå†™äº†çˆ¬è™«æŠ“å–å›½å†…ç½‘ç«™æ•°æ®åˆ¶ä½œäº†ä¸­å›½æ•°æ®åº“æ’è¡Œæ¦œã€‚è®¡ç®—æ–¹æ³•å’Œdb-enginesç±»ä¼¼ï¼Œç„¶è€Œæ ¹æ®å›½å†…åšäº†ä¸€äº›è°ƒæ•´ï¼Œç»Ÿè®¡ç»“æœæ˜¯2017å¹´1æœˆMYSQLæ’åç¬¬ä¸€ï¼Œå¾—åˆ†ä¸º2864.75ï¼Œè€Œoracleå¾—åˆ†ä¸º2752.67ï¼Œsql serverå¾—åˆ†ä»…ä»…ä¸º981.5</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥çœ‹çœ‹å›½å†…å¯¹mysqlæ•°æ®åº“å·¥ç¨‹å¸ˆçš„æ‹›è˜ä¿¡æ¯</p>
<p><img src="pic/QQ%E6%88%AA%E5%9B%BE20170206114205.png" alt="QQæˆªå›¾20170206114205.png"></p>
<p>ä»ä¸Šå›¾çœ‹åˆ°2æœˆ6æ—¥è¿™ä¸€å¤©51jobä¸Šå¯¹mysql dbaçš„èŒä½æä¾›æœ‰316ä¸ªï¼Œæˆ‘ä»¬å†çœ‹çœ‹å¯¹å²—ä½çš„è¦æ±‚ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="pic/20170206114325.png" alt="20170206114325.png"></p>
<p>ä¸ºä»€ä¹ˆæ˜¯ MySQL ?å¯¹æ¯ä¸€ç§æŠ€æœ¯,æˆ‘ä»¬éƒ½è€ƒè™‘äº†å…¶æœ€å¤§å…³æ³¨ç‚¹,å¹¶æå‡ºåŒæ ·çš„é—®é¢˜ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¯¹ MySQL çš„è€ƒè™‘ :</p>
<p>Qï¼šå®ƒè§£å†³äº†æˆ‘ä»¬çš„å­˜å‚¨éœ€æ±‚å—? </p>
<p>Aï¼šæ²¡é”™,æˆ‘ä»¬éœ€è¦æ˜ å°„ã€ç´¢å¼•ã€æ’åºå’Œ blob å­˜å‚¨,è¿™äº›MySQL éƒ½æœ‰ã€‚</p>
<p>Qï¼šå®ƒå¸¸ç”¨å—? ä½ å¯ä»¥æ‹›è˜åˆ°ç›¸å…³å‘˜å·¥å—?</p>
<p>Aï¼šMySQL æ˜¯ç›®å‰ç”Ÿäº§çº¿ä¸Šæœ€å¸¸ä½¿ç”¨çš„æ•°æ®åº“ä¹‹ä¸€ã€‚å¾ˆå®¹æ˜“æ‹›åˆ°ä½¿ç”¨è¿‡ MySQL çš„äººã€‚</p>
<p>Qï¼šå®ƒçš„ç¤¾åŒºæ´»è·ƒå—? </p>
<p>Aï¼šéå¸¸æ´»è·ƒã€‚æœ‰å¥½å¤šéå¸¸æ£’çš„ä¹¦ç±,å’Œä¸€ä¸ªå¼ºå¤§çš„åœ¨çº¿ç¤¾åŒºã€‚</p>
<p>Qï¼šé¢å¯¹æ•…éšœ,å®ƒå¥å£®å—?</p>
<p>Aï¼šå³ä½¿åœ¨æœ€æ¶åŠ£çš„æƒ…å†µä¸‹,æˆ‘ä»¬ä¹Ÿä»æ¥æ²¡æœ‰ä¸¢å¤±è¿‡æ•°æ®ã€‚</p>
<p>Qï¼šå®ƒçš„æ‰©å±•æ€§å¦‚ä½•?</p>
<p>Aï¼šå°±å®ƒæœ¬èº«æ¥è¯´,åªæ˜¯ä¸€ä¸ªå¾ˆå°çš„ç»„ä»¶ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§ä¸Šå±‚çš„åˆ†ç‰‡æ–¹æ¡ˆ(è¿™å®Œå…¨æ˜¯å¦ä¸€ä¸ªé—®é¢˜)ã€‚</p>
<p>Qï¼šä½ ä¼šæ˜¯æœ€å¤§çš„ç”¨æˆ·å—?</p>
<p>Aï¼šä¸, ç›® å‰ ä¸ æ˜¯ã€‚ æœ€ å¤§ çš„ ç”¨ æˆ· åŒ… æ‹¬ Facebookã€Twitter å’Œ Googleã€‚é™¤éä½ èƒ½å¤Ÿæ”¹è¿›ä¸€ç§æŠ€æœ¯,å¦åˆ™ä½ ä¸ä¼šæƒ³è¦æˆä¸ºå®ƒæœ€å¤§çš„ç”¨æˆ·ã€‚å¦‚æœä½ æ˜¯æœ€å¤§çš„ç”¨æˆ·,ä½ ä¼šç¢°åˆ°ä¸€äº›æ–°çš„æ‰©å±•æ€§é—®é¢˜,è€Œå…¶ä»–äººæ ¹æœ¬æ²¡æœºä¼šé‡åˆ°ã€‚</p>
<p>Qï¼šå®ƒçš„æˆç†Ÿåº¦å¦‚ä½•? </p>
<p>Aï¼šçœŸæ­£çš„åŒºåˆ«åœ¨äºæˆç†Ÿåº¦ã€‚æ ¹æ®å¤æ‚åº¦çš„ä¸åŒ,æˆç†Ÿåº¦å°±å¥½æ¯”è¡¡é‡å®Œæˆä¸€ä¸ªç¨‹åºæ‰€éœ€çš„è¡€ã€æ±—å’Œæ³ªã€‚MySQL çš„ç¡®å¤æ‚,ä½†å¯æ¯”ä¸ä¸Šé‚£äº›ç¥å¥‡çš„è‡ªåŠ¨é›†ç¾¤ NoSQL æ–¹æ¡ˆã€‚è€Œä¸”,MySQL æ‹¥æœ‰ 30 å¹´(1996å¹´ç¬¬ä¸€ç‰ˆ)æœ€å¥½å’Œæœ€èªæ˜çš„è´¡çŒ®,æ¥è‡ªäºè¯¸å¦‚Facebook å’Œ Google é‚£æ ·å¤§è§„æ¨¡ä½¿ç”¨å®ƒçš„å…¬å¸ã€‚æ ¹æ®æˆ‘ä»¬çš„æˆç†Ÿåº¦å®šä¹‰,åœ¨æˆ‘ä»¬å®¡æŸ¥çš„æ‰€æœ‰æŠ€æœ¯ä¸­,MySQL æ˜¯ä¸€ä¸ªæ˜æ™ºçš„é€‰æ‹©ã€‚</p>
<p>Qï¼šæœ‰å¥½çš„è°ƒè¯•å·¥å…·å—? </p>
<p>Aï¼šä½œä¸ºä¸€ä¸ªæˆç†Ÿçš„äº§å“,ä½ å½“ç„¶éœ€è¦å¼ºå¤§çš„è°ƒè¯•å’Œåˆ†æå·¥å…·,å› ä¸ºäººä»¬å¾ˆå®¹æ˜“é‡åˆ°ä¸€äº›ç±»ä¼¼çš„æ£˜æ‰‹æƒ…å†µã€‚æ¯”å¦‚ä½ å¯èƒ½åœ¨å‡Œæ™¨ä¸‰ç‚¹é‡åˆ°é—®é¢˜(ä¸æ­¢ä¸€æ¬¡)ã€‚ç›¸æ¯”ç”¨å¦ä¸€ç§æŠ€æœ¯é‡å†™ä¸€éç†¬åˆ°å‡Œæ™¨å…­ç‚¹,å‘ç°é—®é¢˜çš„æ ¹æºç„¶åå›å»ç¡è§‰èˆ’æœå¤šäº†ã€‚</p>
<h2 id="Mysql-ç®¡ç†è¯¾ç¨‹ç¯å¢ƒä½¿ç”¨è¯´æ˜"><a href="#Mysql-ç®¡ç†è¯¾ç¨‹ç¯å¢ƒä½¿ç”¨è¯´æ˜" class="headerlink" title="Mysql ç®¡ç†è¯¾ç¨‹ç¯å¢ƒä½¿ç”¨è¯´æ˜"></a>Mysql ç®¡ç†è¯¾ç¨‹ç¯å¢ƒä½¿ç”¨è¯´æ˜</h2><p>DB100è¯¾ç¨‹åŸºäºRHEL7.2ç³»ç»Ÿï¼Œè¯¾ç¨‹æ•™æˆå­¦ç”Ÿå®ŒæˆåŸºäºæ­¤ç³»ç»Ÿçš„Mysql 5.7 ã€MariaDB 10.2æ•°æ®åº“ç®¡ç†è¯¾ç¨‹å’ŒåŸºç¡€è¯¾ç¨‹å†…å®¹ã€‚</p>
<h3 id="æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹"><a href="#æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹" class="headerlink" title="æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹"></a>æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹</h3><ul>
<li><p>workstationè™šæ‹Ÿæœºå‡å®‰è£…rhel7.2ç³»ç»Ÿï¼Œï¼ˆå®‰è£…å›¾å½¢åŒ–ç•Œé¢å¹¶é…ç½®runlevel 5å¯åŠ¨ï¼Œrootå¯†ç ä¸ºuplooking ï¼Œé…ç½®äº†åŸºç¡€çš„YUMæºæŒ‡å‘classroomï¼‰ï¼Œ workstationè™šæ‹Ÿæœºå‡é…ç½®äº†2å—è™šæ‹Ÿæœºç½‘å¡ï¼Œeth0æ¥å…¥ç‰©ç†æœºbr0ç½‘æ¡¥ï¼ŒåŠ¨æ€è·å¾—ipåœ°å€172.25.0.10ï¼›eth1æ¥å…¥ç‰©ç†æœºprivateç½‘æ¡¥ï¼Œä¸è·å¾—ipåœ°å€ï¼›workstationè™šæ‹Ÿæœºå‡é…ç½®2å—è™šæ‹Ÿç¡¬ç›˜ï¼ˆvdaã€vdbï¼‰ï¼Œä»¥æ–¹ä¾¿æˆè¯¾æ¼”ç¤ºã€‚workstationè™šæ‹Ÿæœºå‡é…ç½®2GBè¿è¡Œå†…å­˜ã€‚</p>
</li>
<li><p>masteraã€masterbã€slavea ã€slaveb å’Œdbproxyè™šæ‹Ÿæœºå‡å®‰è£…rhel7.2ç³»ç»Ÿï¼Œï¼ˆæ²¡æœ‰å®‰è£…å›¾å½¢åŒ–ç•Œé¢ï¼Œrootå¯†ç ä¸ºuplooking ï¼Œé…ç½®äº†åŸºç¡€çš„YUMæºæŒ‡å‘classroomï¼‰ï¼Œ masteraã€masterbã€slavea ã€slaveb å’Œdbproxyè™šæ‹Ÿæœºå‡é…ç½®äº†2å—è™šæ‹Ÿæœºç½‘å¡ï¼Œeth0æ¥å…¥ç‰©ç†æœºbr0ç½‘æ¡¥ï¼ŒåŠ¨æ€è·å¾—ipåœ°å€172.25.0.11~172.25.0.5ï¼›eth1æ¥å…¥ç‰©ç†æœºprivateç½‘æ¡¥ï¼Œä¸è·å¾—ipåœ°å€ï¼›masteraã€masterbã€slavea ã€slaveb å’Œdbproxyè™šæ‹Ÿæœºå‡é…ç½®2å—è™šæ‹Ÿç¡¬ç›˜ï¼ˆvdaã€vdbï¼‰ï¼Œä»¥æ–¹ä¾¿æˆè¯¾æ¼”ç¤ºã€‚masteraã€masterbã€slavea ã€slaveb å’Œdbproxyè™šæ‹Ÿæœºå‡é…ç½®512MBè¿è¡Œå†…å­˜ã€‚</p>
</li>
<li><p>å·²åœ¨classroomä¸Šå®ŒæˆDNSé…ç½®ï¼Œæ­£å‘å’Œæ–¹å‘åŸŸååŠé‚®ä»¶ä»£ç†åŸŸåå’Œè™šæ‹ŸæœºåŸŸåè®¾ç½®å¦‚ä¸‹ï¼š</p>
<ul>
<li>classroom.example.com 172.25.254.254</li>
<li>fN.example.com 172.25.254.N</li>
<li>workstationN.example.com 172.25.N.10</li>
<li>masteraN.example.com 172.25.N.11</li>
<li>masterbN.example.com 172.25.N.12</li>
<li>slaveaN.example.com 172.25.N.13</li>
<li>slavebN.example.com 172.25.N.14</li>
<li>dbproxyN.example.com 172.25.N.15</li>
<li>N:1~80</li>
</ul>
</li>
<li><p><a href="http://classroom.example.com/materials" target="_blank" rel="noopener">http://classroom.example.com/materials</a> ä¸ºç¬¬ä¸‰æ–¹è½¯ä»¶åŒ…å’Œèµ„æ–™ç›®å½•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<a href="http://materials.example.com" target="_blank" rel="noopener">http://materials.example.com</a> ç›´æ¥è®¿é—®ã€‚</p>
</li>
</ul>
<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>** Mariadb 10.2 å’ŒMysql 5.7 åœ¨yumå®‰è£…ä¸­ä¼šæœ‰å†²çªï¼Œä¸è¦åŒæ—¶é…ç½®MariaDBå’ŒMySQLçš„æºã€‚ **</p>
<h3 id="ç½‘ç»œæ‹“æ‰‘å›¾"><a href="#ç½‘ç»œæ‹“æ‰‘å›¾" class="headerlink" title="ç½‘ç»œæ‹“æ‰‘å›¾"></a>ç½‘ç»œæ‹“æ‰‘å›¾</h3><p><img src="pic/01-db100-classroom.png" alt="db100ç½‘ç»œæ‹“æ‰‘å›¾"></p>
<h3 id="è¯¾ç¨‹å¤§çº²"><a href="#è¯¾ç¨‹å¤§çº²" class="headerlink" title="è¯¾ç¨‹å¤§çº²"></a>è¯¾ç¨‹å¤§çº²</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MYSQL</span><br><span class="line">ä¸€ã€MySQLç®¡ç†è¯¾ç¨‹ç®€ä»‹</span><br><span class="line">1.MySQL ç®¡ç†è¯¾ç¨‹</span><br><span class="line">2.ä¸ºä»€ä¹ˆMySQL ?</span><br><span class="line">3.Mysql ç®¡ç†è¯¾ç¨‹ç¯å¢ƒä½¿ç”¨è¯´æ˜</span><br><span class="line">4.æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹</span><br><span class="line">5.æ³¨æ„äº‹é¡¹</span><br><span class="line">6.ç½‘ç»œæ‹“æ‰‘å›¾</span><br><span class="line"></span><br><span class="line">äºŒã€MySQLå’ŒMariaDBæ•°æ®åº“ä»‹ç»</span><br><span class="line">1.æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ</span><br><span class="line">2.æ•°æ®åº“çš„åˆ†ç±»</span><br><span class="line">3.ä»€ä¹ˆæ˜¯MySQL</span><br><span class="line">4.å¦‚ä½•è·å¾—MySQLç›¸å…³èµ„æº</span><br><span class="line">5.MySQLåœ¨ä¼ä¸šä¸­çš„åº”ç”¨åœºæ™¯</span><br><span class="line">6.MySQL æ•°æ®åº“å®‰è£…</span><br><span class="line">	RHEL 7.2 RPM åŒ…å®‰è£… MariaDB 5.5</span><br><span class="line">	RHEL 7.2 RPM åŒ…å®‰è£… MariaDB 10.2</span><br><span class="line">	RHEL 7.2 RPM åŒ…å®‰è£… MySQL 5.7</span><br><span class="line">	RHEL 7.2 äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£… MySQL 5.6</span><br><span class="line">7.MySQLå®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“</span><br><span class="line">	MySQLå®¢æˆ·ç«¯çš„ä½¿ç”¨</span><br><span class="line">	pythonè¿æ¥MySQLæ•°æ®åº“</span><br><span class="line">	PHPmyAdminåœ¨çº¿å·¥å…·ä½¿ç”¨</span><br><span class="line">	MySQL Workbench è¿æ¥æ•°æ®åº“</span><br><span class="line"></span><br><span class="line">ä¸‰ã€ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€SQLä»‹ç»å’ŒåŸºæœ¬æ“ä½œ</span><br><span class="line">1.sqlè¯­æ³•ï¼Œæ•°æ®ç±»å‹ï¼Œè¿ç®—ç¬¦</span><br><span class="line">2.DDL(Data Definition Languages)è¯­å¥</span><br><span class="line">3.DML(Data Manipulation Language)è¯­å¥</span><br><span class="line">4.DCL(Data Control Language)è¯­å¥</span><br><span class="line">5.DQL(Data Query Language)è¯­å¥</span><br><span class="line">6.å®æˆ˜é¡¹ç›®1:ç†Ÿæ‚‰SQLè¯­å¥</span><br><span class="line">7.å®æˆ˜é¡¹ç›®2:ç†Ÿæ‚‰mysql.userè¡¨</span><br><span class="line">8.å®æˆ˜é¡¹ç›®3:å®Œæˆæ•°æ®åº“ç”¨æˆ·æƒé™æ“ä½œé¡¹ç›®</span><br><span class="line"></span><br><span class="line">å››ã€MySQLé€»è¾‘æ¶æ„å’ŒInnodbå­˜å‚¨å¼•æ“</span><br><span class="line">1.MySQL é€»è¾‘æ¶æ„</span><br><span class="line">2.MySQL å­˜å‚¨å¼•æ“</span><br><span class="line">	å­˜å‚¨å¼•æ“æ¦‚è¿°</span><br><span class="line">	çŸ¥åçš„ä¸¤å¤§å­˜å‚¨å¼•æ“</span><br><span class="line">	äº‹åŠ¡</span><br><span class="line">	å¹¶å‘æ§åˆ¶</span><br><span class="line">	é”æœºåˆ¶</span><br><span class="line">	å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ MVCC</span><br><span class="line">	äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</span><br><span class="line">3.INNODBé”</span><br><span class="line">	è®¾ç½®INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«</span><br><span class="line">		å®è·µ1ï¼šæŸ¥çœ‹innodbé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</span><br><span class="line">		å®è·µ2ï¼šæ”¹å˜å•ä¸ªä¼šè¯çš„éš”ç¦»çº§åˆ«</span><br><span class="line">		å®è·µ3ï¼šæ”¹å˜å•ä¸ªå®ä¾‹çš„éš”ç¦»çº§åˆ«</span><br><span class="line">		å®è·µ4ï¼šæ”¹å˜æ‰€æœ‰å®ä¾‹çš„éš”ç¦»çº§åˆ«</span><br><span class="line">	åŒºåˆ†INNODBäº‹åŠ¡éš”ç¦»çº§åˆ«</span><br><span class="line">		InnoDB ä¸­çš„éš”ç¦»çº§è¯¦ç»†æè¿°</span><br><span class="line">		å®è·µ1ï¼šSERIALIZABLEéš”ç¦»çº§åˆ«æŸ¥è¯¢è‡ªåŠ¨åŠ å…±äº«é”</span><br><span class="line">		å®è·µ2ï¼šRUã€RCã€RRéš”ç¦»çº§åˆ«çš„å¯¹æ¯”</span><br><span class="line">	å®ç°ä¸€è‡´æ€§é”å®šè¯»</span><br><span class="line">		å®è·µ1ï¼šè®¾ç½®innodbç”³è¯·é”ç­‰å¾…è¶…æ—¶æ—¶é—´</span><br><span class="line">		å®è·µ2ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ å…±äº«é”æµ‹è¯•</span><br><span class="line">		å®è·µ3ï¼šè®¾ç½®ä¸€è‡´æ€§é”å®šè¯»ï¼ŒåŠ æ’ä»–é”æµ‹è¯•</span><br><span class="line">	è®¤è¯†é”çš„ç®—æ³•</span><br><span class="line">		çŸ¥è¯†ç‚¹</span><br><span class="line">		å®è·µ1ï¼š éªŒè¯nextkey</span><br><span class="line">		locké™çº§ä¸ºrecord key</span><br><span class="line">		å®è·µ2ï¼š å…³é—­GAPé”_RC</span><br><span class="line">		å®è·µ3ï¼š å…³é—­GAPé”_innodb_locks_unsafe_for_binlog</span><br><span class="line">		å®è·µ4ï¼š nextkeylockingæ˜¯å¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜çš„</span><br><span class="line"></span><br><span class="line">äº”ã€MySQLå¤‡ä»½ä¸æ¢å¤</span><br><span class="line"></span><br><span class="line">1.ä¸ºä»€ä¹ˆè¦å¤‡ä»½</span><br><span class="line">2.ä»€ä¹ˆæ˜¯å¤‡ä»½</span><br><span class="line">3.å¤‡ä»½çš„ä¸¤å¤§è¦ç´ </span><br><span class="line">4.å¤‡ä»½çš„åˆ†ç±»</span><br><span class="line">	ç‰©ç†å¤‡ä»½å’Œé€»è¾‘å¤‡ä»½</span><br><span class="line">		é€»è¾‘å¤‡ä»½</span><br><span class="line">		ç‰©ç†å¤‡ä»½</span><br><span class="line">	å¢é‡å¤‡ä»½å’Œå·®å¼‚å¤‡ä»½</span><br><span class="line">	åœ¨çº¿ï¼ˆçƒ­ï¼‰å¤‡ä»½ã€æ¸©å¤‡ä»½ã€ç¦»çº¿ï¼ˆå†·ï¼‰å¤‡ä»½</span><br><span class="line">5.å¤‡ä»½å’Œæ¢å¤å·¥å…·</span><br><span class="line">	tar</span><br><span class="line">		tarå¤‡ä»½æ­¥éª¤</span><br><span class="line">		tarè¿˜åŸæ­¥éª¤</span><br><span class="line">		è¯¾å ‚å®æˆ˜1: åˆ©ç”¨tarå®ç°ç‰©ç†å¤‡ä»½å¹¶è¿˜åŸ</span><br><span class="line">	LVM SnapShot</span><br><span class="line">		lvmå¿«ç…§çš„ä¼˜ç‚¹å’Œç¼ºç‚¹</span><br><span class="line">		osæ”¯æŒlvmæ–¹å¼ </span><br><span class="line">		lvmå¿«ç…§å¤‡ä»½æ•°æ®</span><br><span class="line">		lvmå¿«ç…§è¿˜åŸæ•°æ®</span><br><span class="line">		è¯¾å ‚å®æˆ˜2: åˆ©ç”¨LVMå¿«ç…§å®ç°ç‰©ç†å¤‡ä»½å¹¶è¿˜åŸ</span><br><span class="line">	mysqldump</span><br><span class="line">		MyISAMå’ŒINNODBè¡¨çš„å¤‡ä»½</span><br><span class="line">		mysqldumpå‘½ä»¤çš„ç”¨æ³•</span><br><span class="line">		mysqldumpå¤‡ä»½æ­¥éª¤</span><br><span class="line">		mysqldumpè¿˜åŸæ­¥éª¤</span><br><span class="line">		è¯¾å ‚å®æˆ˜3: åˆ©ç”¨mysqldumpå®ç°é€»è¾‘å¤‡ä»½å¹¶è¿˜åŸ</span><br><span class="line">	Percona Xtrabackup</span><br><span class="line">	è¯¾å ‚å®æˆ˜4ï¼šinnobackupexå®æ—¶å¢é‡å¤‡ä»½å’Œè¿˜åŸ</span><br><span class="line">6.MySQL æ—¥å¿—çš„åˆ†ç±»</span><br><span class="line">	äºŒè¿›åˆ¶æ—¥å¿—çš„ç®¡ç†å’Œå¤‡ä»½</span><br><span class="line">		å¦‚ä½•æ‰“å¼€äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">		å¦‚ä½•æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">		åŸºäºäºŒè¿›åˆ¶æ—¥å¿—çš„å®æ—¶å¢é‡è¿˜åŸ</span><br><span class="line">	æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿä¸€</span><br><span class="line">	æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹ŸäºŒ</span><br><span class="line">	æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿä¸‰</span><br><span class="line">	è¯¾å ‚å®æˆ˜5ï¼šåŸºäºäºŒè¿›åˆ¶æ—¥å¿—æ—¶é—´ç‚¹å’Œä½ç½®çš„æ•°æ®åº“å¤‡ä»½æ¢å¤æ¨¡æ‹Ÿ</span><br><span class="line"></span><br><span class="line">å…­ã€MySQLå¤åˆ¶replication </span><br><span class="line">1.å¤åˆ¶æ¦‚è¿°</span><br><span class="line">2.å¤åˆ¶è§£å†³çš„é—®é¢˜</span><br><span class="line">3.å¤åˆ¶çš„åŸç†</span><br><span class="line">	é¡¹ç›®å®æˆ˜1ï¼šmariadb server 5.5 å•ä¸»ä»æ¶æ„</span><br><span class="line">	é¡¹ç›®å®æˆ˜2ï¼šmysql server 5.7 åŸºäºGTIDçš„å•ä¸»ä»æ¶æ„</span><br><span class="line">4.å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜_é‡æ¼”å»¶è¿Ÿ</span><br><span class="line">	é¡¹ç›®å®æˆ˜3ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„</span><br><span class="line">	é¡¹ç›®å®æˆ˜4ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»æ¶æ„crash safeå‚æ•°è°ƒä¼˜</span><br><span class="line">5.å¤åˆ¶ä¸­çš„å»¶è¿Ÿé—®é¢˜_è¯»å†™åˆ†ç¦»</span><br><span class="line">	åŠåŒæ­¥å¤åˆ¶çš„æ½œåœ¨é—®é¢˜</span><br><span class="line">	æ— æ•°æ®ä¸¢å¤±çš„åŠåŒæ­¥å¤åˆ¶</span><br><span class="line">	é¡¹ç›®å®æˆ˜5ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå•ä¸»ä»åŠåŒæ­¥æ¶æ„</span><br><span class="line">6.å¤åˆ¶ä¸­çš„å•ç‚¹æ•…éšœé—®é¢˜</span><br><span class="line">	å¤åˆ¶æ‹“æ‰‘_é…ç½®MSS</span><br><span class="line">	å¤åˆ¶æ‹“æ‰‘_é…ç½®MM</span><br><span class="line">	å¤åˆ¶æ‹“æ‰‘_é…ç½®M(s)M(s)</span><br><span class="line">	å¤åˆ¶æ‹“æ‰‘_é…ç½®MMSS</span><br><span class="line">	é¡¹ç›®å®æˆ˜6ï¼šmysql server 5.7 åŸºäºGTIDçš„å¹¶è¡ŒMTSå¤šçº§ä¸»ä» Multisource åŠåŒæ­¥æ¶æ„</span><br><span class="line"></span><br><span class="line">ä¸ƒã€MySQLé«˜å¯ç”¨HA</span><br><span class="line">1.ä»€ä¹ˆæ˜¯é«˜å¯ç”¨</span><br><span class="line">2.å¯¼è‡´å®•æœºçš„åŸå› </span><br><span class="line">3.å¦‚ä½•å®ç°é«˜å¯ç”¨</span><br><span class="line">4.é¿å…å•ç‚¹æ•…éšœ</span><br><span class="line">	åŸºäºå¤åˆ¶çš„å†—ä½™</span><br><span class="line">	MySQL åŒæ­¥å¤åˆ¶</span><br><span class="line">		MySQL Cluster é›†ç¾¤</span><br><span class="line">		Galera Cluster é›†ç¾¤</span><br><span class="line">5.æ•…éšœè½¬ç§»å’Œæ•…éšœæ¢å¤</span><br><span class="line">	é—®é¢˜çš„æå‡º</span><br><span class="line">	è§£å†³æ–¹æ¡ˆ</span><br><span class="line">	ä»€ä¹ˆæ˜¯æ•°æ®åº“ä»£ç†æœåŠ¡å™¨</span><br><span class="line">	ç›®å‰å¸‚é¢ä¸Šçš„æ•°æ®åº“ä»£ç†æœåŠ¡å™¨</span><br><span class="line">		mysqlproxy (äº†è§£ï¼Œä¸è®²)</span><br><span class="line">		mycat</span><br><span class="line">6.å®æˆ˜é¡¹ç›®ï¼š æ•°æ®åº“ä¸­é—´ä»¶ Mycat å®ç° è¯»å†™åˆ†ç¦»è´Ÿè½½å‡è¡¡ï¼Œåç«¯æ•°æ®åº“æœåŠ¡å™¨ä¸º MySQL 5.7 MMSS Multisource Replication é«˜å¯ç”¨æ¶æ„</span><br><span class="line">7.å®æˆ˜é¡¹ç›®:  æ•°æ®åº“ä¸­é—´ä»¶ Mycat å®ç° è¯»å†™åˆ†ç¦»è´Ÿè½½å‡è¡¡ï¼Œåç«¯æ•°æ®åº“æœåŠ¡å™¨ä¸º Mariadb 10.2 Galera ClusteråŒæ­¥å¤åˆ¶é«˜å¯ç”¨æ¶æ„</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>MySQLåŸºç¡€ç®¡ç†æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>MySQLåŸºç¡€ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>LINUX Shell Scripts ç¬¬ä¸€è¯¾ ç®€ä»‹å’Œå˜é‡</title>
    <url>/2016/12/23/booboo_bash_shell_scripts/00_shell_variables/</url>
    <content><![CDATA[<h2 id="æ•™å­¦ç¯å¢ƒä»‹ç»"><a href="#æ•™å­¦ç¯å¢ƒä»‹ç»" class="headerlink" title="æ•™å­¦ç¯å¢ƒä»‹ç»"></a>æ•™å­¦ç¯å¢ƒä»‹ç»</h2><ul>
<li>client rhel7.2 172.25.0.10</li>
<li>server rhel7.2 172.25.0.11</li>
</ul>
<p>å¦‚æœçœŸçš„æƒ³èµ°ITè¿™æ¡è·¯ï¼Œæƒ³çœŸæ­£ç®¡ç†å¥½ä½ çš„ä¸»æœºï¼Œé‚£ä¹ˆå­¦ä¹ è‡ªåŠ¨åŒ–ç®¡ç†å·¥å…·Shell Scripts éå¸¸é‡è¦ï¼</p>
<p>å°±æ˜¯å°†ä¸€äº›å‘½ä»¤æ”¾åœ¨ä¸€èµ·å»æ‰§è¡Œï¼Œå¹¶ä¸”ä¸éœ€è¦ç¼–è¯‘å°±èƒ½æ‰§è¡Œï¼Œå¾ˆæ–¹ä¾¿ï¼Œæ‰€ä»¥åœ¨æ—¥å¸¸å·¥ä½œä¸­å¯ä»¥ç”¨shell scriptsæ¥ç®€åŒ–æˆ‘ä»¬çš„ç®¡ç†ã€‚å¯ä»¥ä½†åˆ°æˆ‘ä»¬linuxä¸­ï¼Œå¾ˆå¤šæœåŠ¡çš„å¯åŠ¨éƒ½æ˜¯é€è¿‡shellè„šæœ¬æ¥å¯åŠ¨çš„ã€‚</p>
<p>å¦‚æœä½ ä¸ä¼šè„šæœ¬ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å‡ºé—®é¢˜çš„æ—¶å€™ï¼ŒçœŸçš„ä¼šæ±‚åŠ©æ— é—¨ï¼Œæ‰€ä»¥å¥½å¥½åœ°å­¦ä¹ å§ï¼</p>
<h2 id="shell-ç®€ä»‹"><a href="#shell-ç®€ä»‹" class="headerlink" title="shell ç®€ä»‹"></a>shell ç®€ä»‹</h2><h3 id="ä»€ä¹ˆæ˜¯-shell"><a href="#ä»€ä¹ˆæ˜¯-shell" class="headerlink" title="ä»€ä¹ˆæ˜¯ shell"></a>ä»€ä¹ˆæ˜¯ shell</h3><p>Shell æ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨ , æ˜¯äººä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„æ¡¥æ¢ã€‚</p>
<p><img src="pic/03.png" alt="03.png"></p>
<p>æˆ‘ä»¬å¹³æ—¶æ— è®ºä»»ä½•æ“ä½œ , æœ€ç»ˆéƒ½è¦æ“ä½œç¡¬ä»¶ , æ¯”å¦‚è¾“å…¥ä¸€ä¸ªå­—ç¬¦ â€œ a â€, é‚£ä¹ˆä¿¡å· é¦–å…ˆä¼šä»é”®ç›˜ä¼ é€’åˆ°ä¸»æ¿ , é€šè¿‡ä¸»æ¿æ€»çº¿ä¼ é€’åˆ°å†…å­˜ ,CPU, æ˜¾å¡ç­‰ , æœ€ç»ˆç»è¿‡æ˜¾å¡çš„è¿ ç®—å®Œæˆååœ¨å±å¹•çš„æŸä¸ªä½ç½® , æ˜¾ç¤ºä¸€ä¸ªç‰¹å®šå­—ä½“çš„å­—ç¬¦ â€œa â€, è¿™ä¸€æ•´ä¸ªè¿‡ç¨‹å¯ä»¥è¯´æ˜¯ ä¸æ–­çš„å’Œç¡¬ä»¶æ‰“äº¤é“äº† , ä½†æ˜¯å¦‚æœè®©äººå»å‘é€è¿™äº›ç¡¬ä»¶æ“ä½œç æ˜¾ç„¶ä¸é€‚åˆ , å› ä¸ºè¿™ä¸æ˜¯äººå¹² çš„äº‹ , æ‰€ä»¥æˆ‘ä»¬æœ‰äº†æ“ä½œç³»ç»Ÿ , æ“ä½œç³»ç»Ÿé€šè¿‡åŠ è½½ä¸€å®šçš„ç¡¬ä»¶é©±åŠ¨ , ä»è€Œæ§åˆ¶ç¡¬ä»¶ , æ“ä½œç¡¬ ä»¶ , é‚£å‰©ä¸‹çš„äº‹å°±æ˜¯å¦‚ä½•å’Œæ“ä½œç³»ç»Ÿé€šä¿¡äº† , å¯¹äºæ™®é€šçš„ç³»ç»Ÿç®¡ç†å‘˜æ¥è¯´ , è¿™ä¹Ÿæ˜¯ä¸€ä»¶éå¸¸ å›°éš¾çš„äº‹ , ä¸ºäº†æ–¹ä¾¿äººå’Œæ“ä½œç³»ç»Ÿæ²Ÿé€š , æˆ‘ä»¬å¼€å‘äº† shell ã€‚</p>
<p>Shell å¯ä»¥å°†æˆ‘ä»¬å¹³æ—¶è¿è¡Œçš„ä¸€äº›æŒ‡ä»¤è§£é‡Šç»™æ“ä½œç³»ç»Ÿæ‰§è¡Œ , æ–¹ä¾¿ç®¡ç†å‘˜æ“ä½œç³»ç»Ÿã€‚ è€Œ Shell çš„è„šæœ¬å…¶å®æ˜¯ä¸€ç§å‘½ä»¤çš„å †ç§¯ , æˆ‘ä»¬å°†æ‰€æœ‰éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ , ä»¥ä»ä¸Šè‡³ä¸‹çš„æ–¹ å¼å†™åœ¨ä¸€ä¸ªæ–‡ä»¶å½“ä¸­ , äº¤ç»™ shell å»è‡ªåŠ¨è§£é‡Šæ‰§è¡Œã€‚</p>
<h3 id="shell-å†å²"><a href="#shell-å†å²" class="headerlink" title="shell å†å²"></a>shell å†å²</h3><p>åœ¨ AT&amp;T çš„ Dennis Ritchie å’Œ Ken Thompson è®¾è®¡ UNIXTM çš„æ—¶å€™ , ä»–ä»¬æƒ³è¦ä¸º ç”¨æˆ·åˆ›å»ºä¸€ç§ä¸ä»–ä»¬çš„æ–°ç³»ç»Ÿäº¤æµçš„æ–¹æ³•ã€‚ é‚£æ—¶çš„æ“ä½œç³»ç»Ÿå¸¦æœ‰å‘½ä»¤è§£é‡Šå™¨ã€‚å‘½ä»¤è§£é‡Šå™¨æ¥å—ç”¨æˆ·çš„å‘½ä»¤ , ç„¶åè§£é‡Šå®ƒä»¬ , å› è€Œè®¡ ç®—æœºå¯ä»¥ä½¿ç”¨è¿™äº›å‘½ä»¤ã€‚</p>
<p>ä½†æ˜¯ Ritchie å’Œ Thompson æƒ³è¦çš„ä¸åªæ˜¯è¿™äº›åŠŸèƒ½ , ä»–ä»¬æƒ³æä¾›æ¯”å½“æ—¶çš„å‘½ä»¤è§£é‡Šå™¨ å…·å¤‡æ›´ä¼˜å¼‚åŠŸèƒ½çš„å·¥å…·ã€‚è¿™å¯¼è‡´äº† Bourne shell( é€šç§°ä¸º sh) çš„å¼€å‘ , ç”± S.R. Bourne åˆ› å»ºã€‚è‡ªä» Bourne shell çš„åˆ›å»º , å…¶å®ƒ shell ä¹Ÿè¢«ä¸€ä¸€å¼€å‘ , å¦‚ C shell(csh) å’Œ Korn shell(ksh) ã€‚</p>
<p>å½“è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šæƒ³å¯»æ±‚ä¸€ç§å…è´¹çš„ shell, å¼€å‘è€…ä»¬å¼€å§‹è‡´åŠ›äº Bourne shell ä»¥åŠå½“ æ—¶å…¶å®ƒ shell ä¸­æŸäº›å¾ˆå—æ¬¢è¿çš„åŠŸèƒ½èƒŒåçš„è¯­è¨€ã€‚</p>
<p>è¿™ä¸ªå¼€å‘ç»“æœæ˜¯ Bourne Again Shell, æˆ–ç§° bash ã€‚è™½ç„¶ä½ çš„ Red Hat Linux åŒ…æ‹¬å‡  ç§ä¸åŒçš„ shell,bash æ˜¯ä¸ºäº’åŠ¨ç”¨æˆ·æä¾›çš„é»˜è®¤ shell ã€‚</p>
<h3 id="å¸¸è§çš„-shell"><a href="#å¸¸è§çš„-shell" class="headerlink" title="å¸¸è§çš„ shell"></a>å¸¸è§çš„ shell</h3><ul>
<li>Bourne shell å³ sh:AT&amp;T è´å°”å®éªŒå®¤ç¼–å†™çš„ä¸€ä¸ªäº¤æ¢å¼çš„å‘½ä»¤è§£é‡Šå™¨ã€‚</li>
<li>C Shell :Bill Joy äº 20 ä¸–çºª 80 å¹´ä»£æ—©æœŸå¼€å‘ã€‚ä¸ºäº†è®©ç”¨æˆ·æ›´å®¹æ˜“çš„ä½¿ç”¨ , ä»–æŠŠè¯­æ³• ç»“æ„å˜æˆäº† C è¯­è¨€é£æ ¼ã€‚å®ƒæ–°å¢äº†å‘½ä»¤å†å²ã€åˆ«åã€æ–‡ä»¶åæ›¿æ¢ã€ä½œä¸šæ§åˆ¶ç­‰åŠŸèƒ½ã€‚</li>
<li>korn shell (ksh) æ˜¯ä¸€ä¸ª Unix shell ã€‚å®ƒç”±è´å°”å®éªŒå®¤çš„ David Korn åœ¨äºŒåä¸–çºªå…«å å¹´ä»£æ—©æœŸç¼–å†™ã€‚å®ƒå®Œå…¨å‘ä¸Šå…¼å®¹ Bourne shell å¹¶åŒ…å«äº† C shell çš„å¾ˆå¤šç‰¹æ€§ã€‚</li>
<li>Bourne-Again Shell: bash æ˜¯ä¸€ä¸ªä¸º GNU é¡¹ç›®ç¼–å†™çš„ Unix shell ã€‚å®ƒçš„åå­—æ˜¯ä¸€ ç³»åˆ—ç¼©å†™ :Bourne-Again SHell â€” è¿™æ˜¯å…³äº Bourne shell(sh) çš„ä¸€ä¸ªåŒå…³è¯­ (Bourne again / born again) ã€‚ Bourne shell æ˜¯ä¸€ä¸ªæ—©æœŸçš„é‡è¦ shell, ç”± Stephen Bourne åœ¨ 1978 å¹´å‰åç¼–å†™ , å¹¶åŒ Version 7 Unix ä¸€èµ·å‘å¸ƒã€‚ bash åˆ™åœ¨1987 å¹´ç”± Brian Fox åˆ›é€ ã€‚ åœ¨ 1990 å¹´ ,Chet Ramey æˆä¸ºäº†ä¸»è¦çš„ç»´æŠ¤è€…ã€‚ bash æ˜¯å¤§å¤šæ•° Linux ç³»ç»Ÿä»¥åŠ Mac OS X v10.4 é»˜è®¤çš„ shell, å®ƒèƒ½è¿è¡Œäºå¤§å¤šæ•° Unix é£æ ¼çš„æ“ä½œç³»ç»Ÿä¹‹ä¸Š , ç”šè‡³è¢«ç§»æ¤åˆ°äº† MicrosoftWindows ä¸Šçš„ Cygwin å’Œ MSYS ç³»ç»Ÿä¸­ , ä»¥å®ç° windows çš„ POSIX è™šæ‹Ÿæ¥å£ã€‚æ­¤å¤– , å®ƒä¹Ÿè¢« DJGPP é¡¹ç›®ç§»æ¤åˆ°äº† MS- DOS ä¸Šã€‚</li>
<li>POSIX shell :POSIX shell ä¸ Korn shell éå¸¸çš„ç›¸ä¼¼ , å½“å‰æä¾› POSIX shell çš„æœ€ å¤§å–ä¸»æ˜¯ Hewlett-Packard ã€‚</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆ-Shell"><a href="#ä¸ºä»€ä¹ˆ-Shell" class="headerlink" title="ä¸ºä»€ä¹ˆ Shell"></a>ä¸ºä»€ä¹ˆ Shell</h3><ul>
<li>è§£å†³é‡å¤æ“ä½œçš„ä½œä¸šã€‚</li>
<li>èŠ‚çº¦æ—¶é—´ , æé«˜å·¥ä½œæ•ˆç‡ã€‚</li>
<li>åŠŸèƒ½å¼ºå¤§ , ä½¿ç”¨ç®€å•ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.æŸ¥çœ‹ç³»ç»Ÿå½“ä¸­åˆæ³•çš„shell</span></span><br><span class="line">cat /etc/shells</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># /etc/shells: valid login shells</span></span><br><span class="line">    /bin/sh</span><br><span class="line">    /bin/dash</span><br><span class="line">    /bin/bash</span><br><span class="line">    /bin/rbash</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 2.ä¿®æ”¹ç”¨æˆ·ç™»å½•æ—¶ä½¿ç”¨çš„shellç¨‹åº</span></span><br><span class="line">useradd batman</span><br><span class="line">chsh -s /bin/sh batman</span><br><span class="line">grep batman /etc/passwd</span><br></pre></td></tr></table></figure>

<pre><code>useradd: Permission denied.
useradd: cannot lock /etc/passwd; try again later.
chsh: user &apos;batman&apos; does not exist</code></pre><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 3.ç”¨æˆ·çš„ç™»å½•æµç¨‹</span></span><br><span class="line"></span><br><span class="line">![01](pic/01.png)</span><br><span class="line"></span><br><span class="line"><span class="comment">## å¯¹äºæ‰€æœ‰çš„ç”¨æˆ·HISTSIZE 500 ï¼Œå¯¹äºrootç”¨æˆ·HISTSIZE 1000</span></span><br><span class="line">/etc/profile start</span><br><span class="line">/etc/profile end</span><br><span class="line"></span><br><span class="line">~/.bash_profile start</span><br><span class="line">~/.bashrc start</span><br><span class="line">/etc/bashrc start</span><br><span class="line"></span><br><span class="line">/etc/bashrc end</span><br><span class="line">~/.bashrc end</span><br><span class="line">~/.bash_profile end</span><br></pre></td></tr></table></figure>

<h2 id="shellçš„å˜é‡åŠŸèƒ½"><a href="#shellçš„å˜é‡åŠŸèƒ½" class="headerlink" title="shellçš„å˜é‡åŠŸèƒ½"></a>shellçš„å˜é‡åŠŸèƒ½</h2><h3 id="ä»€ä¹ˆæ˜¯å˜é‡"><a href="#ä»€ä¹ˆæ˜¯å˜é‡" class="headerlink" title="ä»€ä¹ˆæ˜¯å˜é‡"></a>ä»€ä¹ˆæ˜¯å˜é‡</h3><ul>
<li>è®©ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ä»£è¡¨ä¸å›ºå®šçš„å†…å®¹ï¼Œæœ‰ç‚¹åƒy=ax+b,yå°±æ˜¯å˜é‡ï¼Œ</li>
<li>ç”¨ç®€å•çš„å­—çœ¼æ¥ä»£æ›¿æ¯”è¾ƒå¤æ‚æˆ–è€…å®¹æ˜“å˜åŠ¨çš„æ•°æ®ï¼Œå¥½å¤„å°±æ˜¯æ–¹ä¾¿ï¼</li>
</ul>
<p>æ¯”å¦‚ç³»ç»Ÿä¸­çš„MAILå’ŒUSERå˜é‡ï¼Œæ ¹æ®å½“å‰ç™»é™†çš„ç”¨æˆ·è€Œå˜åŒ–</p>
<ul>
<li>å¯¹è„šæœ¬çš„ç”¨å¤„â€”â€”ä¾‹å¦‚uleè€ƒè¯•çš„è¯„åˆ†è„šæœ¬ï¼Œæ ¹æ®ä½ ä»¬çš„æœºå™¨å·çš„ä¸åŒï¼Œå»æ£€æµ‹ä¸åŒçš„å­¦ç”Ÿè€ƒè¯•æˆç»©</li>
</ul>
<h3 id="å˜é‡çš„è®¾ç½®ã€æŸ¥çœ‹å’Œå–æ¶ˆ-echo-unset"><a href="#å˜é‡çš„è®¾ç½®ã€æŸ¥çœ‹å’Œå–æ¶ˆ-echo-unset" class="headerlink" title="å˜é‡çš„è®¾ç½®ã€æŸ¥çœ‹å’Œå–æ¶ˆ echo unset"></a>å˜é‡çš„è®¾ç½®ã€æŸ¥çœ‹å’Œå–æ¶ˆ echo unset</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">        æŸ¥çœ‹	echo $&#123;MAIL&#125;</span><br><span class="line">			echo $MAIL</span><br><span class="line">		è®¾ç½®	å˜é‡å=å˜é‡çš„å†…å®¹</span><br><span class="line">				myname=booboo</span><br><span class="line">				myname="booboo wei"</span><br><span class="line">			æ³¨æ„äº‹é¡¹</span><br><span class="line">				å˜é‡å‘½åè§„åˆ™ï¼š</span><br><span class="line">					1.ç”±æ•°å­—ï¼Œå­—æ¯ï¼Œä¸‹åˆ’çº¿_ç»„æˆ</span><br><span class="line">					2.ä¸èƒ½ä»¥æ•°å­—å¼€å¤´</span><br><span class="line">					3.å­—æ¯åŒºåˆ†å¤§å°å†™ï¼Œå¤§å°å†™æ•æ„Ÿ</span><br><span class="line">				å˜é‡å†…å®¹è‹¥æœ‰ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·</span><br><span class="line">					åŒå¼•å·ä¿ç•™ç‰¹æ®Šå­—ç¬¦åŸæœ‰å±æ€§</span><br><span class="line">					å•å¼•å·ç‰¹æ®Šå­—ç¬¦å˜ä¸€èˆ¬å­—ç¬¦ï¼ˆçº¯æ–‡æœ¬ï¼‰</span><br><span class="line">					ä¹Ÿå¯ä½¿ç”¨\è·³è„±å­—ç¬¦å°†ç‰¹æ®Šå­—ç¬¦å˜æˆä¸€èˆ¬å­—ç¬¦</span><br><span class="line">				`æŒ‡ä»¤`æˆ–$(æŒ‡ä»¤)å¯ä»¥å°†æŒ‡ä»¤çš„ç»“æœå˜æˆå˜é‡å†…å®¹</span><br><span class="line">		å–æ¶ˆ	unset å˜é‡å</span><br><span class="line">				unset myname</span><br><span class="line">```                </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### è¯¾å ‚ç»ƒä¹ </span></span></span><br><span class="line">			1. è®¾ç½®å˜é‡myname=supermanå¹¶æŸ¥çœ‹å˜é‡çš„å€¼ï¼›</span><br><span class="line">			2. è®¾ç½®å˜é‡myname1=I am superman</span><br><span class="line">				myname2="I am superman"</span><br><span class="line">				myname3='I am superman'å¹¶æŸ¥çœ‹æ‰€æœ‰å˜é‡çš„å€¼ï¼›</span><br><span class="line">			3. è®¾ç½®ä¸¤ä¸ªå˜é‡åˆ†åˆ«ä¸ºname1="$myname is myname"å’Œname2='$myname is myname';å¹¶æŸ¥çœ‹å˜é‡çš„å€¼ï¼›</span><br><span class="line">			4. è®¾ç½®å˜é‡kernelçš„å€¼ä¸ºå½“å‰ç³»ç»Ÿçš„å†…æ ¸ç‰ˆæœ¬å·ï¼›</span><br><span class="line">			5. è®¾ç½®å˜é‡numçš„å€¼ä¸º/etc/ç›®å½•ä¸‹æ‰€æœ‰ä»¥.confç»“å°¾çš„æ–‡ä»¶çš„æ€»æ•°ï¼›</span><br><span class="line">			6. å–æ¶ˆç»ƒä¹ ä¸­çš„æœ‰æ‰€å˜é‡ã€‚</span><br><span class="line"></span><br><span class="line">![02](pic/02.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## å˜é‡å†…å®¹çš„åˆ é™¤å’Œæ›¿æ¢</span></span></span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">		å˜é‡è®¾å®šæ–¹å¼		è¯´æ˜</span><br><span class="line"><span class="meta">		$</span><span class="bash">&#123;å˜é‡<span class="comment">#å…³é”®è¯&#125;		è‹¥å˜é‡å†…å®¹ä»å¤´å¼€å§‹çš„æ•°æ®ç¬¦åˆã€å…³é”®è¯ã€,åˆ™å°†ç¬¦åˆçš„æœ€çŸ­æ•°æ®åˆ é™¤</span></span></span><br><span class="line"><span class="meta">		$</span><span class="bash">&#123;å˜é‡<span class="comment">##å…³é”®è¯&#125; 		è‹¥å˜é‡å†…å®¹ä»å¤´å¼€å§‹çš„æ•°æ®ç¬¦åˆã€å…³é”®è¯ã€,åˆ™å°†ç¬¦åˆçš„æœ€é•¿æ•°æ®åˆ é™¤</span></span></span><br><span class="line"><span class="meta">		$</span><span class="bash">&#123;å˜é‡%å…³é”®è¯&#125; 		è‹¥å˜é‡å†…å®¹ä»å°¾å‘å‰çš„æ•°æ®ç¬¦åˆã€å…³é”®è¯ã€,åˆ™å°†ç¬¦åˆçš„æœ€çŸ­æ•°æ®åˆ é™¤</span></span><br><span class="line"><span class="meta">		$</span><span class="bash">&#123;å˜é‡%%å…³é”®è¯&#125;		è‹¥å˜é‡å†…å®¹ä»å°¾å‘å‰çš„æ•°æ®ç¬¦åˆã€å…³é”®è¯ã€,åˆ™å°†ç¬¦åˆçš„æœ€é•¿æ•°æ®åˆ é™¤</span></span><br><span class="line"><span class="meta">		$</span><span class="bash">&#123;å˜é‡/æ—§å­—ç¬¦ä¸²/æ–°å­—ç¬¦ä¸²&#125; 	è‹¥å˜é‡å†…å®¹ç¬¦åˆã€æ—§å­—ç¬¦ä¸²ã€åˆ™ã€ç¬¬ä¸€ä¸ªæ—§å­—ç¬¦ä¸²ä¼šè¢«æ–°å­—ç¬¦ä¸²æ›¿æ¢ã€</span></span><br><span class="line"><span class="meta">		$</span><span class="bash">&#123;å˜é‡//æ—§å­—ç¬¦ä¸²/æ–°å­—ç¬¦ä¸²&#125;	è‹¥å˜é‡å†…å®¹ç¬¦åˆã€æ—§å­—ç¬¦ä¸²ã€åˆ™ã€å…¨éƒ¨çš„æ—§å­—ç¬¦ä¸²ä¼šè¢«æ–°å­—ç¬¦ä¸²æ›¿æ¢ã€</span></span><br></pre></td></tr></table></figure>


<h4 id="è¯¾å ‚ç»ƒä¹ "><a href="#è¯¾å ‚ç»ƒä¹ " class="headerlink" title="è¯¾å ‚ç»ƒä¹ "></a>è¯¾å ‚ç»ƒä¹ </h4><ol>
<li>è®¾ç½®å˜é‡path=${PATH} å¹¶æŸ¥çœ‹ï¼›</li>
<li>è®¾ç½®å˜é‡path=/batman/bin:${path}:/superman/bin å¹¶æŸ¥çœ‹ï¼›</li>
<li>è¯»å–å˜é‡çš„æ—¶å€™å°†/batman/bin:åŠç¬¬ä¸€ä¸ªå†’å·åŠä¹‹å‰çš„åˆ é™¤ï¼›</li>
<li>è¯»å–å˜é‡çš„æ—¶å€™å°†æœ€åä¸€ä¸ªå†’å·åŠä¹‹å‰çš„éƒ½åˆ é™¤ï¼›</li>
<li>è¯»å–å˜é‡çš„æ—¶å€™å°†:/superman/binåŠæœ€åä¸€ä¸ªå†’å·åŠä¹‹åçš„åˆ é™¤ï¼›</li>
<li>è¯»å–å˜é‡çš„æ—¶å€™å°†ç¬¬ä¸€ä¸ªå†’å·åŠä¹‹åçš„éƒ½åˆ é™¤ï¼›</li>
<li>è¯»å–å˜é‡çš„æ—¶å€™å°†ç¬¬ä¸€ä¸ªsbinæ›¿æ¢æˆSBINï¼›</li>
<li>è¯»å–å˜é‡çš„æ—¶å€™å°†æ‰€æœ‰çš„sbinæ›¿æ¢æˆSBINï¼›</li>
<li>å–æ¶ˆç»ƒä¹ ä¸­çš„pathå˜é‡ã€‚</li>
</ol>
<h3 id="å˜é‡çš„åˆ†ç±»ï¼šå±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡-env-set-export"><a href="#å˜é‡çš„åˆ†ç±»ï¼šå±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡-env-set-export" class="headerlink" title="å˜é‡çš„åˆ†ç±»ï¼šå±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡ env set export"></a>å˜é‡çš„åˆ†ç±»ï¼šå±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡ env set export</h3><ul>
<li>åˆ†ç±»æ ‡å‡†    å˜é‡æ˜¯å¦ä¼šè¢«å­ç¨‹åºæ‰€ç»§ç»­å¼•ç”¨ï¼›å±€éƒ¨å˜é‡ä¸ä¼šï¼›å…¨å±€å˜é‡ä¼š</li>
<li>env     åˆ—å‡ºç›®å‰shellç¯å¢ƒä¸‹çš„æ‰€æœ‰å…¨å±€å˜é‡</li>
<li>set     æŸ¥çœ‹æ‰€æœ‰å˜é‡ï¼ŒåŒ…æ‹¬ç¯å¢ƒå˜é‡å’Œå±€éƒ¨å˜é‡</li>
<li>export    å°†å±€éƒ¨å˜é‡è½¬æˆå…¨å±€å˜é‡    export myname</li>
</ul>
<h4 id="è¯¾å ‚ç»ƒä¹ -1"><a href="#è¯¾å ‚ç»ƒä¹ -1" class="headerlink" title="è¯¾å ‚ç»ƒä¹ "></a>è¯¾å ‚ç»ƒä¹ </h4><pre><code>1. æ‰“å¼€ä¸€ä¸ªç»ˆç«¯bashï¼ŒæŸ¥çœ‹è¯¥ç»ˆç«¯çš„pidå·ï¼›
2. è®¾ç½®æœ¬åœ°å˜é‡justice1=&quot;this is local&quot;å¹¶æŸ¥çœ‹;
3. è®¾ç½®ç¯å¢ƒå˜é‡justice2=&quot;this is env&quot;å¹¶æŸ¥çœ‹;
4. æ‰“å¼€å­ç»ˆç«¯bashï¼ŒæŸ¥çœ‹è¯¥ç»ˆç«¯çš„pidå·å’Œppidå·ï¼›
5. åœ¨å­ç»ˆç«¯ä¸­åˆ†åˆ«æŸ¥çœ‹å˜é‡justice1å’Œjustice2çš„å€¼ï¼›</code></pre><h3 id="å˜é‡è¯»å–ã€æ•°ç»„ä¸å®£å‘Š-read-array-declare"><a href="#å˜é‡è¯»å–ã€æ•°ç»„ä¸å®£å‘Š-read-array-declare" class="headerlink" title="å˜é‡è¯»å–ã€æ•°ç»„ä¸å®£å‘Š read array declare"></a>å˜é‡è¯»å–ã€æ•°ç»„ä¸å®£å‘Š read array declare</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">read	ä»é”®ç›˜è¯»å–æ•°æ®å­˜å…¥å˜é‡</span><br><span class="line">	read -p "plz input yourname:" -t 30 name æŒ‰ä¸‹å›è½¦è¾“å…¥å˜é‡nameçš„å€¼ï¼Œä¼šç­‰å¾…30sç»“æŸ</span><br><span class="line">array</span><br><span class="line">	æ•°ç»„çš„è®¾å®š	A[0]=1;A[1]=2;A[2]=3</span><br><span class="line">			A=(1 2 3)</span><br><span class="line">			A=(1 2 3 [50]=4)</span><br><span class="line">			A=(1 2 3 [50]=4 5)</span><br><span class="line">	æ•°ç»„çš„è¯»å–	echo $&#123;A[0]&#125;</span><br><span class="line">			echo $&#123;A[@]&#125;</span><br><span class="line">			echo $&#123;A[*]&#125;</span><br><span class="line">			* ä»£è¡¨çš„æ˜¯ä¸€æ¬¡å–å‡ºæ‰€æœ‰çš„å€¼ ,@ ä»£è¡¨ä¾æ¬¡å–å€¼</span><br><span class="line">				for i in "$A[@]";do echo $i;done</span><br><span class="line">				for i in "$A[*]";do echo $i;done</span><br><span class="line">declare</span><br><span class="line">	declare å‚æ•°</span><br><span class="line">		-a å°†å˜é‡çœ‹æˆæ•°ç»„</span><br><span class="line">		-i å°†å˜é‡çœ‹æˆæ•´æ•°</span><br><span class="line">		-r ä½¿å˜é‡åªè¯»</span><br><span class="line">	x=1</span><br><span class="line">	y=2</span><br><span class="line">	sum=$(($x+$y))</span><br></pre></td></tr></table></figure>

<h4 id="è¯¾å ‚ç»ƒä¹ -2"><a href="#è¯¾å ‚ç»ƒä¹ -2" class="headerlink" title="è¯¾å ‚ç»ƒä¹ "></a>è¯¾å ‚ç»ƒä¹ </h4><pre><code>1. ç”¨readå‘½ä»¤ä»é”®ç›˜è¯»å–numå˜é‡çš„å€¼ï¼Œæç¤ºè¯­å¥ä¸ºâ€œè¯·è¾“å…¥ä½ çš„æœºå™¨å·ï¼šâ€ï¼Œé™æ—¶é—´20sï¼›
2. è®¾ç½®æ•°ç»„S ç¬¬ä¸€ä½ä¸º1ï¼Œç¬¬äºŒä½ä¸º2ï¼Œç¬¬ä¸‰åä½ä¸º4ï¼Œç¬¬ä¸‰åä¸€ä½ä¸º5ï¼Œè¯»å–æ•°ç»„æ‰€æœ‰çš„å€¼ï¼Œè¯»å–æ•°ç»„ç¬¬äºŒä½ï¼›
3. è®¾ç½®å˜é‡x=1ï¼Œy=2ï¼Œå˜é‡sum=$x+$yï¼ŒæŸ¥çœ‹sumçš„å€¼ï¼›
4. å®£å‘Šå˜é‡xä¸ºæ•´æ•°å‹å€¼ä¸º1ï¼Œå˜é‡yä¸ºæ•´æ•°å‹å€¼ä¸º2,å˜é‡sumä¸ºæ•´æ•°å‹=$x+$yï¼ŒæŸ¥çœ‹sumçš„å€¼ï¼›</code></pre><h2 id="æ•°æ®æµé‡å¯¼å‘redirection"><a href="#æ•°æ®æµé‡å¯¼å‘redirection" class="headerlink" title="æ•°æ®æµé‡å¯¼å‘redirection"></a>æ•°æ®æµé‡å¯¼å‘redirection</h2><h3 id="ä½•è°“æ•°æ®æµé‡å¯¼å‘"><a href="#ä½•è°“æ•°æ®æµé‡å¯¼å‘" class="headerlink" title="ä½•è°“æ•°æ®æµé‡å¯¼å‘"></a>ä½•è°“æ•°æ®æµé‡å¯¼å‘</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">æŒ‡ä»¤æ‰§è¡Œåçš„ç»“æœæœ‰ï¼š</span><br><span class="line">          exit    å‘½ä»¤æ‰§è¡Œæ˜¯å¦æ­£ç¡®çš„è¿”å›å€¼?	0æ­£ç¡®ï¼›ï¼0é”™è¯¯		ç®€ç§°	ä»£ç 	ç¬¦å·</span><br><span class="line">          return	å‘½ä»¤æ‰§è¡Œè¾“å‡ºçš„æ­£ç¡®ä¿¡æ¯	standard output		    stdout	1	&gt;æˆ–è€…&gt;&gt;</span><br><span class="line">			å‘½ä»¤æ‰§è¡Œè¾“å‡ºçš„é”™è¯¯ä¿¡æ¯	standard error output	stderr	2	2&gt;æˆ–è€…2&gt;&gt;</span><br><span class="line">æŒ‡ä»¤æ‰§è¡Œå‰çš„è¾“å…¥ï¼š		å‘½ä»¤æ‰§è¡Œè¾“å…¥çš„ä¿¡æ¯		standard in		stdin	0	&lt;æˆ–è€…&lt;&lt;</span><br><span class="line"></span><br><span class="line">ç”¨æ³•æ€»ç»“			</span><br><span class="line"><span class="meta">	1&gt;</span><span class="bash"> :ä»¥è¦†ç›–çš„æ–¹æ³•å°†ã€æ­£ç¡®çš„æ•°æ®ã€è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼›</span></span><br><span class="line"><span class="meta">	1&gt;</span><span class="bash">&gt;:ä»¥è¿½åŠ çš„æ–¹æ³•å°†ã€æ­£ç¡®çš„æ•°æ®ã€è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼›</span></span><br><span class="line"><span class="meta">	2&gt;</span><span class="bash"> :ä»¥è¦†ç›–çš„æ–¹æ³•å°†ã€é”™è¯¯çš„æ•°æ®ã€è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼›</span></span><br><span class="line"><span class="meta">	2&gt;</span><span class="bash">&gt;:ä»¥è¿½åŠ çš„æ–¹æ³•å°†ã€é”™è¯¯çš„æ•°æ®ã€è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼›</span></span><br><span class="line"></span><br><span class="line">cat	ä»é”®ç›˜è¯»å–æ•°æ®å­˜å…¥æ–‡ä»¶</span><br><span class="line">	cat &gt; /tmp/catfile ä»¥ctrl+dç»“æŸ</span><br><span class="line">	cat &gt; /tmp/catfile &lt; /tmp/passwd</span><br><span class="line">	cat &gt; /tmp/catfile &lt;&lt; ENDF</span><br><span class="line">	standard in</span><br><span class="line">	ENDF===&gt;ç»“æŸæç¤ºç¬¦</span><br></pre></td></tr></table></figure>

<h4 id="è¯¾å ‚ç»ƒä¹ -3"><a href="#è¯¾å ‚ç»ƒä¹ -3" class="headerlink" title="è¯¾å ‚ç»ƒä¹ "></a>è¯¾å ‚ç»ƒä¹ </h4><pre><code>1. æŸ¥çœ‹ç³»ç»Ÿ/ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åå’Œå±æ€§ï¼Œå¹¶è®°å½•åˆ°/tmp/fileæ–‡ä»¶ä¸­ï¼›
2. æŸ¥çœ‹ç³»ç»Ÿ/var/ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åå’Œå±æ€§ï¼Œå¹¶è¿½åŠ è®°å½•åˆ°/tmp/fileæ–‡ä»¶ä¸­ï¼›
3. åˆ‡æ¢åˆ°studentç”¨æˆ·ï¼Œåœ¨/homeç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶åä¸º.bashrcçš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼›
4. åˆ‡æ¢åˆ°studentç”¨æˆ·ï¼Œåœ¨/homeç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶åä¸º.bashrcçš„æ–‡ä»¶ï¼Œå°†è¯¥å‘½ä»¤æ‰§è¡Œè¾“å‡ºçš„æ­£ç¡®ä¿¡æ¯æ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼Œå°†è¯¥å‘½ä»¤æ‰§è¡Œè¾“å‡ºçš„é”™è¯¯ä¿¡æ¯æ”¾åˆ°é»‘æ´/dev/nullä¸­ï¼›
5. åˆ‡æ¢åˆ°studentç”¨æˆ·ï¼Œåœ¨/homeç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶åä¸º.bashrcçš„æ–‡ä»¶ï¼Œå°†è¯¥å‘½ä»¤æ‰§è¡Œè¾“å‡ºçš„æ­£ç¡®ä¿¡æ¯ä¿å­˜åˆ°/tmp/stdoutæ–‡ä»¶ä¸­å¹¶æŸ¥çœ‹ï¼Œå°†è¯¥å‘½ä»¤æ‰§è¡Œè¾“å‡ºçš„é”™è¯¯ä¿¡æ¯æ”¾åˆ°é»‘æ´/dev/nullä¸­ï¼›
6. åˆ‡æ¢åˆ°studentç”¨æˆ·ï¼Œåœ¨/homeç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶åä¸º.bashrcçš„æ–‡ä»¶ï¼Œå°†è¯¥å‘½ä»¤æ‰§è¡Œè¾“å‡ºçš„æ­£ç¡®ä¿¡æ¯ä¿å­˜åˆ°/tmp/stdoutæ–‡ä»¶ä¸­ï¼Œå°†è¯¥å‘½ä»¤æ‰§è¡Œè¾“å‡ºçš„é”™è¯¯ä¿¡æ¯ä¿å­˜åˆ°/tmp/stderræ–‡ä»¶ä¸­ï¼Œå¹¶æŸ¥çœ‹ï¼›
7. åˆ‡æ¢åˆ°studentç”¨æˆ·ï¼Œåœ¨/homeç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶åä¸º.bashrcçš„æ–‡ä»¶ï¼Œå°†è¯¥å‘½ä»¤æ‰§è¡Œè¾“å‡ºçš„æ‰€æœ‰ä¿¡æ¯ï¼ˆæ­£ç¡®å’Œé”™è¯¯ï¼‰éƒ½ä¿å­˜åˆ°/tmp/allä¸­ï¼Œå¹¶æŸ¥çœ‹ï¼›
8. ä½¿ç”¨catå‘½ä»¤ä»é”®ç›˜è¯»å–æ•°æ®hellowordå¹¶è¦†ç›–/tmp/catfileæ–‡ä»¶ï¼›
9. ä½¿ç”¨catå‘½ä»¤å°†/etc/passwd/çš„å†…å®¹è¦†ç›–/tmp/catfileæ–‡ä»¶ï¼›
10. ä½¿ç”¨catå‘½ä»¤ä»é”®ç›˜è¯»å–æ•°æ®hellowordå¹¶è¦†ç›–/tmp/catfileæ–‡ä»¶ï¼Œä»¥ç»“æŸæç¤ºç¬¦çš„æ–¹å¼ç»“æŸï¼›</code></pre><h3 id="å‘½ä»¤æ‰§è¡Œçš„åˆ¤æ–­ä¾æ®-amp-amp"><a href="#å‘½ä»¤æ‰§è¡Œçš„åˆ¤æ–­ä¾æ®-amp-amp" class="headerlink" title="å‘½ä»¤æ‰§è¡Œçš„åˆ¤æ–­ä¾æ® ; &amp;&amp; ||"></a>å‘½ä»¤æ‰§è¡Œçš„åˆ¤æ–­ä¾æ® ; &amp;&amp; ||</h3><ul>
<li>CMD1 &amp;&amp; CMD2     å¦‚æœå‰ä¸€ä¸ªå‘½ä»¤ (CMD1) èƒ½å¤Ÿæ­£ç¡®è¢«æ‰§è¡Œ , åˆ™æ‰§è¡Œåä¸€ä¸ªå‘½ä»¤ (CMD2)</li>
<li>CMD1 || CMD2     å¦‚æœå‰ä¸€ä¸ªå‘½ä»¤ (CMD1) è¢«æ­£ç¡®æ‰§è¡Œ , åˆ™ä¸æ‰§è¡Œåä¸€ä¸ªå‘½ä»¤ (CMD2), å¦‚æœå‰ä¸€ä¸ªå‘½ä»¤(CMD1) æ‰§è¡Œé”™è¯¯ , åˆ™æ‰§è¡Œåä¸€ä¸ªå‘½ä»¤ (CMD2).</li>
<li>CMD1 ; CMD2    å‘½ä»¤ä¹‹é—´æ²¡æœ‰å…³ç³»ï¼Œä»ç¬¬ä¸€ä¸ªå¼€å§‹æ‰§è¡Œï¼Œä¸ç®¡æ˜¯å¦æ­£ç¡®æ‰§è¡Œéƒ½ä¼šå»æ‰§è¡Œç¬¬äºŒä¸ªå‘½ä»¤</li>
</ul>
<h4 id="è¯¾å ‚å®éªŒ"><a href="#è¯¾å ‚å®éªŒ" class="headerlink" title="è¯¾å ‚å®éªŒ"></a>è¯¾å ‚å®éªŒ</h4><pre><code>1. åˆ›å»ºç›®å½•/tmp/cmd,å¦‚æœåˆ›å»ºæˆåŠŸé‚£ä¹ˆå°±å†åˆ›å»ºä¸€ä¸ªç›®å½•/tmp/cmd/cdm1;
2. åˆ›å»ºç›®å½•/tmp/cmd,å¦‚æœåˆ›å»ºå¤±è´¥ï¼Œé‚£ä¹ˆå°±å†èˆ¹èˆ°ä¸€ä¸ªç›®å½•/tmp/cmd/cmd2;
3. ä¸ç®¡ç›®å½•/tmp/cmdæ˜¯å¦åˆ›å»ºæˆåŠŸï¼Œéƒ½ä¼šå»å†åˆ›å»ºä¸€ä¸ªç›®å½•/tmp/tmpcmd;</code></pre><h3 id="ç®¡é“å‘½ä»¤pipe"><a href="#ç®¡é“å‘½ä»¤pipe" class="headerlink" title="ç®¡é“å‘½ä»¤pipe"></a>ç®¡é“å‘½ä»¤pipe</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">   #</span><span class="bash">æˆªå– grep cut</span></span><br><span class="line">	grep bash$ /etc/passwd</span><br><span class="line">	cut -d : -f 3 /etc/passwd</span><br><span class="line"><span class="meta">#</span><span class="bash">æ’åº sort uniq</span></span><br><span class="line">	sort -t: -k3 -n /etc/passwd</span><br><span class="line"><span class="meta">#</span><span class="bash">ç»Ÿè®¡ wc</span></span><br><span class="line">	wc -l /etc/passwd</span><br><span class="line"><span class="meta">#</span><span class="bash">æ›¿æ¢ xargs</span></span><br><span class="line">	find /sbin/ -perm +7000|wc -l</span><br><span class="line">	find /sbin/ -perm +7000|xargs wc -l</span><br><span class="line"></span><br><span class="line">	è¯¾å ‚ç»ƒä¹ ï¼š</span><br><span class="line">	1.æ‰¾å‡º/sbin/ç›®å½•ä¸‹æœ‰ç‰¹æ®Šæƒé™çš„æ–‡ä»¶ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªæ–‡ä»¶çš„è¡Œæ•°</span><br><span class="line">	2.æ‰¾å‡º/sbin/ç›®å½•ä¸‹æœ‰ç‰¹æ®Šæƒé™çš„æ–‡ä»¶ï¼Œå¹¶ç»Ÿè®¡æœ‰å‡ ä¸ª</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å‡å· -</span></span><br><span class="line">	è¯¾å ‚ç»ƒä¹ ï¼š</span><br><span class="line">	1.å°†/homeç›®å½•æ‰“åŒ…å‹ç¼©åè§£å‹åˆ°/tmpç›®å½•</span><br></pre></td></tr></table></figure>



<h3 id="shellä¸‹çš„ç‰¹æ®Šç¬¦å·"><a href="#shellä¸‹çš„ç‰¹æ®Šç¬¦å·" class="headerlink" title="shellä¸‹çš„ç‰¹æ®Šç¬¦å·"></a>shellä¸‹çš„ç‰¹æ®Šç¬¦å·</h3><pre><code>#    æ³¨é‡Šç¬¦
\    è·³è„±ç¬¦
|    ç®¡é“
;    è¿ç»­æŒ‡ä»¤çš„ä¸‹è¾¾
~    å®¶ç›®å½•
$    å–ç”¨å˜é‡ç¬¦
&amp;    è¿›ç¨‹æ§åˆ¶åå°è¿è¡Œ
!    é€»è¾‘è¿ç®—é
/    æ ¹ç›®å½•
&gt;,&gt;&gt;    æ•°æ®æµé‡å¯¼å‘ è¾“å‡º
&lt;,&lt;&lt;    æ•°æ®æµé‡å¯¼å‘ è¾“å…¥
&apos;&apos;    ç‰¹æ®Šå­—ç¬¦å¤±æ•ˆ
&quot;&quot;    ç‰¹æ®Šå­—ç¬¦æœ‰æ•ˆ
``    å‘½ä»¤æ‰§è¡Œçš„ç»“æœ
{}    å‘½ä»¤çš„ç»„åˆ</code></pre>]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>LinuxShellè„šæœ¬æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxShellè„šæœ¬</tag>
      </tags>
  </entry>
  <entry>
    <title>LINUX Shell Scripts ç¬¬äºŒè¯¾ æµç¨‹æ§åˆ¶è¯­å¥</title>
    <url>/2016/12/23/booboo_bash_shell_scripts/01_shell_flow_control_statement/</url>
    <content><![CDATA[<ol>
<li><p>shell çš„åŸºæœ¬ç»„æˆå…ƒç´ </p>
<ul>
<li>1&gt; é­”æ³•å­—ç¬¦ â€œ #! â€: å‡ºç°åœ¨è„šæœ¬ç¬¬ä¸€è¡Œ , ç”¨äºå®šä¹‰å‘½ä»¤è§£é‡Šå™¨ã€‚</li>
<li>2&gt; â€œ # â€ å·å¼€å¤´çš„è¡Œ : é™¤äº†ç¬¬ä¸€è¡Œçš„é­”æ³•å­—ç¬¦ä»¥å¤– , å…¶ä»–ä»¥ â€ # â€œ å·å¼€å¤´ çš„è¡Œæ˜¯æ³¨ç¤ºã€‚è¿™äº›è¡Œä¸ä¼šè¢«è¿è¡Œ , åªæ˜¯ç»™äººé˜…è¯»ä½¿ç”¨ã€‚</li>
<li>3&gt; ç³»ç»Ÿå‘½ä»¤ :shell è„šæœ¬ä¸­è¿è¡Œè§£é‡Šçš„ç³»ç»Ÿå‘½ä»¤ã€‚</li>
<li>4&gt; å˜é‡ : è„šæœ¬è¿è¡Œè¿‡ç¨‹ä¸­æŸäº›åå¤è°ƒç”¨çš„å€¼çš„æš‚å­˜åœ°ã€‚</li>
<li>5&gt; æµç¨‹æ§åˆ¶è¯­å¥ : åˆ¤æ–­ , å¾ªç¯ , è·³è½¬ç­‰æµç¨‹æ§åˆ¶ã€‚</li>
</ul>
</li>
<li><p>æ‰§è¡Œè„šæœ¬çš„æ–¹æ³•</p>
<ul>
<li>1&gt; bash è„šæœ¬åç§° bash -x ä»¥è°ƒè¯•æ¨¡å¼æ¥è¿è¡Œè„šæœ¬</li>
<li>2&gt; ./ è„šæœ¬åç§° â€“&gt; éœ€è¦å¯¹è„šæœ¬æœ‰å¯æ‰§è¡Œçš„æƒé™</li>
</ul>
</li>
<li><p>shellçš„åŸºæœ¬è¯­æ³•</p>
<ul>
<li>æ¡ä»¶åˆ¤æ–­è¯­å¥     if test</li>
<li>å¾ªç¯è¯­å¥    for while unitl</li>
<li>å…¶ä»–æµç¨‹æ§åˆ¶     case continue break shift function</li>
</ul>
</li>
</ol>
<h3 id="åˆ¤æ–­æ¡ä»¶"><a href="#åˆ¤æ–­æ¡ä»¶" class="headerlink" title="åˆ¤æ–­æ¡ä»¶"></a>åˆ¤æ–­æ¡ä»¶</h3><p>test åˆ¤æ–­â€”â€”â€”â€”â€”man test æŸ¥çœ‹çš„ç›¸å…³çš„åˆ¤æ–­æŒ‡ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> 	æ•°å­—çš„åˆ¤æ–­ 	å­—ç¬¦çš„åˆ¤æ–­ 	æ–‡ä»¶çš„åˆ¤æ–­</span><br><span class="line">-gt å¤§äº 	-z ç©º 		-d æ–‡ä»¶æ˜¯ä¸æ˜¯ä¸€ä¸ªç›®å½•</span><br><span class="line">-ge å¤§äºç­‰äº 	=  å­—ç¬¦ç›¸ç­‰ 	-f æ˜¯ä¸æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶</span><br><span class="line">-lt å°äº 	!= å­—ç¬¦ä¸ç›¸ç­‰ 	-e æ–‡ä»¶æ˜¯ä¸æ˜¯å­˜åœ¨</span><br><span class="line">-le å°äºç­‰äº 	-n éç©º 	</span><br><span class="line">-ne ä¸ç­‰äº 	-a é€»è¾‘ä¸</span><br><span class="line">-eq ç­‰äº 	-o é€»è¾‘æˆ–</span><br></pre></td></tr></table></figure>
<pre><code>æ³¨æ„ ï¼š
* [ ] æ‹¬å·ä¸¤è¾¹æœ‰ç©ºæ ¼
* åˆ¤æ–­ç¬¦å·ä¸¤è¾¹æœ‰ç©ºæ ¼</code></pre><h3 id="if-è¯­æ³•æ ¼å¼"><a href="#if-è¯­æ³•æ ¼å¼" class="headerlink" title="if è¯­æ³•æ ¼å¼"></a>if è¯­æ³•æ ¼å¼</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if condition	--&gt;condition æŒ‡çš„æ˜¯åˆ¤æ–­çš„æ¡ä»¶</span><br><span class="line">then		</span><br><span class="line">	CMD1	--&gt; CMD1 æŒ‡çš„æ˜¯æ»¡è¶³åˆ¤æ–­æ¡ä»¶åæ‰§è¡Œçš„è¯­å¥</span><br><span class="line">else</span><br><span class="line">	CMD2	--&gt; CMD2 æŒ‡çš„æ˜¯ä¸æ»¡è¶³åˆ¤æ–­æ¡ä»¶æ‰§è¡Œçš„è¯­å¥ then</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if condition</span><br><span class="line">then</span><br><span class="line">	CMD1</span><br><span class="line">elif condition</span><br><span class="line">	CMD2</span><br><span class="line">else</span><br><span class="line">	CMD3</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h4 id="è¯¾å ‚ç»ƒä¹ "><a href="#è¯¾å ‚ç»ƒä¹ " class="headerlink" title="è¯¾å ‚ç»ƒä¹ "></a>è¯¾å ‚ç»ƒä¹ </h4><pre><code>1. å†™ä¸€ä¸ªè„šæœ¬ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™åˆ é™¤ã€‚è‹¥ä¸å­˜åœ¨ï¼Œå°±æç¤ºä¸å­˜åœ¨ã€‚
2. ä¸‰ä¸ªæ•°å­—æ¯”å¤§å°ï¼Œè¾“å‡ºæœ€å¤§çš„
3. ä¸‰ä¸ªæ•°å­—æ¯”å¤§å°,å¹¶ä¸”æŒ‰ä»å¤§åˆ°å°æ’åˆ—</code></pre><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[<span class="comment">#74#root@client0 ~]#cat usertest.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"plz input username:"</span> user</span><br><span class="line"><span class="keyword">if</span> id <span class="variable">$user</span> &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	userdel -r <span class="variable">$user</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"student not exits"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">[<span class="comment">#75#root@client0 ~]#cat num.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$1</span> -gt <span class="variable">$2</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$1</span> -gt <span class="variable">$3</span> ]</span><br><span class="line">	<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"max is <span class="variable">$1</span>"</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"max is <span class="variable">$3</span>"</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$2</span> -gt <span class="variable">$3</span> ]</span><br><span class="line">	<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"max is <span class="variable">$2</span>"</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"max is <span class="variable">$3</span>"</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#&#125;</span></span><br><span class="line">[<span class="comment">#76#root@client0 ~]#bash num.sh 9 8 80</span></span><br><span class="line">max is 80</span><br><span class="line">3</span><br><span class="line">[<span class="comment">#99#root@client0 ~]#cat sort.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$1</span> -ge <span class="variable">$2</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	n1=<span class="variable">$1</span></span><br><span class="line">	n2=<span class="variable">$2</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	n1=<span class="variable">$2</span></span><br><span class="line">	n2=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$n1</span> -ge <span class="variable">$3</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	max=<span class="variable">$n1</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$n2</span> -ge <span class="variable">$3</span> ]</span><br><span class="line">	<span class="keyword">then</span></span><br><span class="line">		be=<span class="variable">$n2</span></span><br><span class="line">		min=<span class="variable">$3</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		be=<span class="variable">$3</span></span><br><span class="line">		min=<span class="variable">$n2</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	max=<span class="variable">$3</span></span><br><span class="line">	be=<span class="variable">$n1</span></span><br><span class="line">	min=<span class="variable">$n2</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$max</span> <span class="variable">$be</span> <span class="variable">$min</span></span><br><span class="line">[<span class="comment">#101#root@client0 ~]#bash sort.sh 3 8 1</span></span><br><span class="line">8 3 1</span><br></pre></td></tr></table></figure>


<h3 id="for-è¯­æ³•æ ¼å¼"><a href="#for-è¯­æ³•æ ¼å¼" class="headerlink" title="for è¯­æ³•æ ¼å¼"></a>for è¯­æ³•æ ¼å¼</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for å˜é‡ in å–å€¼èŒƒå›´</span><br><span class="line">do</span><br><span class="line">	CMD</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h4 id="å–å€¼èŒƒå›´"><a href="#å–å€¼èŒƒå›´" class="headerlink" title="å–å€¼èŒƒå›´"></a>å–å€¼èŒƒå›´</h4><ul>
<li><p>ä»¥ç©ºæ ¼åˆ†å‰²</p>
<pre><code>for i in 1 2 3
for i in 5 7 10
for i in a b c</code></pre><p>ä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">         for i in 10 11</span><br><span class="line">do</span><br><span class="line">	ssh root@172.25.0.$i &quot;yum install -y wget&quot;</span><br><span class="line">done</span><br><span class="line">for i in xx uu</span><br><span class="line">do</span><br><span class="line">	ls &#x2F;tmp&#x2F;$i</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä»¥{}ç½—åˆ—        {1..10}</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¯ä»¥ä½¿ç”¨seq	$(seq 1 10)&#x3D;&#x3D;&gt;1 2 3 4 5 6 7 8 9 10</span><br><span class="line">		&#96;seq 1 10&#96;</span><br><span class="line">		seq 1 2 10&#x3D;&#x3D;&gt;1 3 5 7 9</span><br><span class="line">		seq 10 -1 1&#x3D;&#x3D;&gt;10 9 8 7 6 5 4 3 2 1</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="å‘½ä»¤è¡Œæ–¹å¼"><a href="#å‘½ä»¤è¡Œæ–¹å¼" class="headerlink" title="å‘½ä»¤è¡Œæ–¹å¼"></a>å‘½ä»¤è¡Œæ–¹å¼</h4><pre><code>for i in {1..10};do echo $i;done</code></pre><h4 id="è¯¾å ‚ç»ƒä¹ -1"><a href="#è¯¾å ‚ç»ƒä¹ -1" class="headerlink" title="è¯¾å ‚ç»ƒä¹ "></a>è¯¾å ‚ç»ƒä¹ </h4><ol>
<li>ç»Ÿè®¡å½“å‰ç³»ç»Ÿä¸€å…±æœ‰å¤šå°‘ä¸ªç”¨æˆ·ï¼Œå¹¶ä¸”å‘æ¯ä¸ªç”¨æˆ·é—®å¥½ï¼Œå±å¹•è¾“å‡ºâ€œhello $username,your uid is $uidâ€</li>
<li>ä¾æ¬¡å‘/var/ç›®å½•ä¸‹çš„æ¯ä¸ªæ–‡ä»¶é—®å¥½â€œhello $fileâ€ ,ç»Ÿè®¡ä¸€å…±æœ‰å¤šå°‘ä¸ªæ–‡ä»¶</li>
<li>è¾“å…¥ç”¨æˆ·åï¼Œå½“å‰ç³»ç»Ÿä¸­å±äºè¯¥ç”¨æˆ·çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šæ‰“å°åœ¨å±å¹•ä¸Šï¼Œå¹¶ä¸”å‘Šè¯‰ä½ æ–‡ä»¶å¤§å°è¶…è¿‡$sizeçš„æ–‡ä»¶æœ‰å“ªäº›</li>
<li>è®¡ç®—æŸä¸ªå‘½ä»¤æ‰§è¡Œçš„æ—¶é—´</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@client47 ~]<span class="comment"># cat for1.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> ç³»ç»Ÿä¸­ä¸€å…±æœ‰ï¼š`cat /etc/passwd |wc -l`ä¸ªç”¨æˆ·</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `cut -d <span class="string">":"</span> -f 1 /etc/passwd 2&gt;/dev/null`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	username=<span class="variable">$i</span></span><br><span class="line">	uid=`grep ^<span class="variable">$i</span> /etc/passwd |cut -d <span class="string">":"</span> -f 3 2&gt;/dev/null`</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"hello <span class="variable">$username</span>,your uid is <span class="variable">$uid</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@client47 ~]<span class="comment"># bash for1.sh</span></span><br><span class="line">ç³»ç»Ÿä¸­ä¸€å…±æœ‰ï¼š22ä¸ªç”¨æˆ·</span><br><span class="line">hello root,your uid is 0</span><br><span class="line">hello bin,your uid is 1</span><br><span class="line">hello daemon,your uid is 2</span><br><span class="line">hello adm,your uid is 3</span><br><span class="line">hello lp,your uid is 4</span><br><span class="line">hello sync,your uid is 5</span><br><span class="line">hello shutdown,your uid is 6</span><br><span class="line">hello halt,your uid is 7</span><br><span class="line">hello mail,your uid is 8</span><br><span class="line">hello operator,your uid is 11</span><br><span class="line">hello games,your uid is 12</span><br><span class="line">hello ftp,your uid is 14</span><br><span class="line">hello nobody,your uid is 99</span><br><span class="line">hello avahi-autoipd,your uid is 170</span><br><span class="line">hello systemd-bus-proxy,your uid is 999</span><br><span class="line">hello systemd-network,your uid is 998</span><br><span class="line">hello dbus,your uid is 81</span><br><span class="line">hello polkitd,your uid is 997</span><br><span class="line">hello tss,your uid is 59</span><br><span class="line">hello postfix,your uid is 89</span><br><span class="line">hello sshd,your uid is 74</span><br><span class="line">hello student,your uid is 1000</span><br><span class="line"></span><br><span class="line">[root@client47 ~]<span class="comment"># cat for2.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `ls /var/`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> hello <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> /varç›®å½•ä¸­ä¸€å…±æœ‰`ls -l /var/|wc -l`ä¸ªæ–‡ä»¶</span><br><span class="line">[root@client47 ~]<span class="comment"># bash for2.sh</span></span><br><span class="line">hello adm</span><br><span class="line">hello cache</span><br><span class="line">hello crash</span><br><span class="line">hello db</span><br><span class="line">hello empty</span><br><span class="line">hello games</span><br><span class="line">hello gopher</span><br><span class="line">hello kerberos</span><br><span class="line">hello lib</span><br><span class="line">hello <span class="built_in">local</span></span><br><span class="line">hello lock</span><br><span class="line">hello <span class="built_in">log</span></span><br><span class="line">hello mail</span><br><span class="line">hello nis</span><br><span class="line">hello opt</span><br><span class="line">hello preserve</span><br><span class="line">hello run</span><br><span class="line">hello spool</span><br><span class="line">hello tmp</span><br><span class="line">hello yp</span><br><span class="line">/varç›®å½•ä¸­ä¸€å…±æœ‰21ä¸ªæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">[root@client47 ~]<span class="comment"># cat for3.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"è¯·è¾“å…¥ç”¨æˆ·åï¼š"</span> username</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"è¯·è¾“å…¥æ–‡ä»¶SIZEçš„æœ€å¤§å€¼ï¼š"</span> size</span><br><span class="line"></span><br><span class="line">find / -user <span class="variable">$username</span> -size +<span class="variable">$size</span> 2&gt;/dev/null</span><br><span class="line">[root@client47 ~]<span class="comment"># bash for3.sh</span></span><br><span class="line">è¯·è¾“å…¥ç”¨æˆ·åï¼šroot</span><br><span class="line">è¯·è¾“å…¥æ–‡ä»¶SIZEçš„æœ€å¤§å€¼ï¼š500M</span><br><span class="line">/proc/kcore</span><br><span class="line">[root@client47 ~]<span class="comment"># bash for3.sh</span></span><br><span class="line">è¯·è¾“å…¥ç”¨æˆ·åï¼šroot</span><br><span class="line">è¯·è¾“å…¥æ–‡ä»¶SIZEçš„æœ€å¤§å€¼ï¼š100M</span><br><span class="line">/proc/kcore</span><br><span class="line">/usr/lib/locale/locale-archive</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@client47 ~]<span class="comment"># cat for4.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"plz input CMD:"</span> cmd</span><br><span class="line">start=`date +%s`</span><br><span class="line"><span class="variable">$cmd</span> &amp;&gt; /dev/null</span><br><span class="line">end=`date +%s`</span><br><span class="line">time=$((<span class="variable">$end</span>-<span class="variable">$start</span>))</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$cmd</span> æ‰§è¡Œçš„æ—¶é—´ä¸º <span class="variable">$time</span></span><br><span class="line">[root@client47 ~]<span class="comment"># bash for4.sh</span></span><br><span class="line">plz input CMD:xz -d /tmp/big.xz</span><br><span class="line">xz -d /tmp/big.xz æ‰§è¡Œçš„æ—¶é—´ä¸º 2</span><br></pre></td></tr></table></figure>

<h4 id="æ‹“å±•é¢˜"><a href="#æ‹“å±•é¢˜" class="headerlink" title="æ‹“å±•é¢˜"></a>æ‹“å±•é¢˜</h4><ol>
<li>ç”»æ–œçº¿æ­£å<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">*</span><br><span class="line"> *</span><br><span class="line">  *</span><br><span class="line">   *</span><br></pre></td></tr></table></figure></li>
<li>å†™ä¸€ä¸ª9*9ä¹˜æ³•è¡¨</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@client0 ~]<span class="comment"># cat x1.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#è¡Œæ•°	ç©ºæ ¼	*æ•°é‡</span></span><br><span class="line"><span class="comment">#1 	0 	1</span></span><br><span class="line"><span class="comment">#2	1	1</span></span><br><span class="line"><span class="comment">#3	2	1</span></span><br><span class="line"><span class="comment">#n	n-1	1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq 1 <span class="variable">$1</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> `seq 1 $((<span class="variable">$i</span>-1))`</span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">		<span class="built_in">echo</span> -n <span class="string">' '</span></span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line">	<span class="built_in">echo</span>  <span class="string">'*'</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@client0 ~]<span class="comment"># bash x1.sh 4</span></span><br><span class="line">*</span><br><span class="line"> *</span><br><span class="line">  *</span><br><span class="line">   *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@client0 ~]<span class="comment"># cat x2.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#1*1=1</span></span><br><span class="line"><span class="comment">#2*1=2	2*2=4</span></span><br><span class="line"><span class="comment">#3*1=3	3*2	3*3</span></span><br><span class="line"><span class="comment">#9*1	9*2				9*9=</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq 1 9`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> `seq 1 <span class="variable">$i</span>`</span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">		<span class="built_in">echo</span> -n <span class="string">"<span class="variable">$i</span>*<span class="variable">$j</span>=<span class="variable">$(($i*$j)</span>) "</span></span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line">	<span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@client0 ~]<span class="comment"># bash x2.sh</span></span><br><span class="line">1*1=1</span><br><span class="line">2*1=2 2*2=4</span><br><span class="line">3*1=3 3*2=6 3*3=9</span><br><span class="line">4*1=4 4*2=8 4*3=12 4*4=16</span><br><span class="line">5*1=5 5*2=10 5*3=15 5*4=20 5*5=25</span><br><span class="line">6*1=6 6*2=12 6*3=18 6*4=24 6*5=30 6*6=36</span><br><span class="line">7*1=7 7*2=14 7*3=21 7*4=28 7*5=35 7*6=42 7*7=49</span><br><span class="line">8*1=8 8*2=16 8*3=24 8*4=32 8*5=40 8*6=48 8*7=56 8*8=64</span><br><span class="line">9*1=9 9*2=18 9*3=27 9*4=36 9*5=45 9*6=54 9*7=63 9*8=72 9*9=81</span><br></pre></td></tr></table></figure>

<h3 id="while-è¯­æ³•æ ¼å¼"><a href="#while-è¯­æ³•æ ¼å¼" class="headerlink" title="while è¯­æ³•æ ¼å¼"></a>while è¯­æ³•æ ¼å¼</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">	while condition æŒ‡çš„æ˜¯åˆ¤æ–­çš„æ¡ä»¶</span><br><span class="line">	do</span><br><span class="line">		CMD</span><br><span class="line">	done</span><br><span class="line">æ•°å­—çš„åˆ¤æ–­ 	å­—ç¬¦çš„åˆ¤æ–­ 	æ–‡ä»¶çš„åˆ¤æ–­</span><br><span class="line">	-gt å¤§äº 	-z ç©º 		-d æ–‡ä»¶æ˜¯ä¸æ˜¯ä¸€ä¸ªç›®å½•</span><br><span class="line">	-ge å¤§äºç­‰äº 	=  å­—ç¬¦ç›¸ç­‰ 	-f æ˜¯ä¸æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶</span><br><span class="line">	-lt å°äº 	!= å­—ç¬¦ä¸ç›¸ç­‰ 	-e æ–‡ä»¶æ˜¯ä¸æ˜¯å­˜åœ¨</span><br><span class="line">	-le å°äºç­‰äº 	-n éç©º 	</span><br><span class="line">	-ne ä¸ç­‰äº 	-a é€»è¾‘ä¸</span><br><span class="line">	-eq ç­‰äº 	-o é€»è¾‘æˆ–</span><br></pre></td></tr></table></figure>


<ol>
<li>å½“ä»€ä¹ˆçš„æ—¶å€™å°±åšä»€ä¹ˆ,ä½“éªŒæ— é™å¾ªç¯<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">touch /tmp/whilefile</span><br><span class="line">while [ -f /tmp/whilefile ]</span><br><span class="line">do</span><br><span class="line">	cat &gt;&gt; /tmp/whilefile &lt;&lt; ENDF</span><br><span class="line">å½“å±±å³°æ²¡æœ‰æ£±è§’çš„æ—¶å€™</span><br><span class="line">å½“æ²³æ°´ä¸å†æµ</span><br><span class="line">ã€‚ã€‚ã€‚</span><br><span class="line">æˆ‘å“ˆå“ˆishi</span><br><span class="line">ENDF</span><br><span class="line"></span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
<li>ä¸æ»¡è¶³æ¡ä»¶è·³å‡ºå¾ªç¯<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">åˆ¤æ–­/tmp/whilefile2æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨çš„æ—¶å€™æˆ‘ä»¬å»åˆ›å»º</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">while [ ! -e /tmp/whilefile2 ]</span><br><span class="line">do</span><br><span class="line">	cat &gt; /tmp/whilefile2 &lt;&lt; ENDF</span><br><span class="line">hello</span><br><span class="line">ENDF</span><br><span class="line"></span><br><span class="line">done</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h3 id="until-è¯­æ³•æ ¼å¼"><a href="#until-è¯­æ³•æ ¼å¼" class="headerlink" title="until è¯­æ³•æ ¼å¼"></a>until è¯­æ³•æ ¼å¼</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">until condition --&gt; ä¸æ»¡è¶³ condition, åˆ™æ‰§è¡Œ cmd</span><br><span class="line">do</span><br><span class="line">	CMD</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h4 id="è¯¾å ‚ç»ƒä¹ -2"><a href="#è¯¾å ‚ç»ƒä¹ -2" class="headerlink" title="è¯¾å ‚ç»ƒä¹ "></a>è¯¾å ‚ç»ƒä¹ </h4><pre><code>1. è¿ä¹˜ç®—æ³• whileå’Œuntil
2. è¦æ±‚æ ¹æ®userliståˆ›å»ºç”¨æˆ·ï¼Œè¦æ±‚æŒ‡å®šç”¨æˆ·åï¼Œç”¨æˆ·idï¼Œç”¨æˆ·çš„é™„åŠ ç»„åŠå˜æ›´ç”¨æˆ·uå¯†ç ï¼Œè‹¥å¯¹åº”ç”¨æˆ·çš„é™„åŠ ç»„ä¸å­˜åœ¨ï¼Œåˆ™å°†é™„åŠ ç»„åˆ›å»ºå‡ºæ¥åå†æ ¹æ®è¦æ±‚æ·»åŠ ç”¨æˆ·ã€‚
userlistæ–‡ä»¶çš„æ ¼å¼å¦‚ä¸‹ï¼š
carol 777 tom uplooking
natasha 778 tom uplooking
r1 779 tom uplooking
3. è¦æ±‚æ ¹æ®userliståˆ›å»ºç”¨æˆ·ï¼Œè¦æ±‚æŒ‡å®šç”¨æˆ·åï¼Œç”¨æˆ·idï¼Œç”¨æˆ·çš„é»˜è®¤ç»„å’Œé™„åŠ ç»„åŠå˜æ›´ç”¨æˆ·uå¯†ç ï¼Œè‹¥å¯¹åº”ç”¨æˆ·çš„é™„åŠ ç»„ä¸å­˜åœ¨ï¼Œåˆ™å°†é™„åŠ ç»„åˆ›å»ºå‡ºæ¥åå†æ ¹æ®è¦æ±‚æ·»åŠ ç”¨æˆ·ã€‚
[root@rhel6 ~]# cat /tmp/useraddlist1
dabao 888 xuexi,it uplooking
lucy 889 sales,it uplooking
lily 899 pro,aa uplooking</code></pre><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@client0 ~]<span class="comment"># cat useradd.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> a</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	A=(<span class="variable">$a</span>)</span><br><span class="line">	groupadd <span class="variable">$&#123;A[2]&#125;</span> &amp;&gt; /dev/null</span><br><span class="line">	useradd -u <span class="variable">$&#123;A[1]&#125;</span> -G <span class="variable">$&#123;A[2]&#125;</span> <span class="variable">$&#123;A[0]&#125;</span> &amp;&gt; /dev/null</span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$&#123;A[3]&#125;</span>|passwd --stdin <span class="variable">$&#123;A[0]&#125;</span> &amp;&gt; /dev/null</span><br><span class="line">	id <span class="variable">$&#123;A[0]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span>&lt;/root/userlist</span><br><span class="line"></span><br><span class="line">[root@client0 ~]<span class="comment"># bash useradd.sh</span></span><br><span class="line">uid=777(carol) gid=1001(carol) groups=1001(carol),1000(tom)</span><br><span class="line">uid=778(natasha) gid=1002(natasha) groups=1002(natasha),1000(tom)</span><br><span class="line">uid=779(r1) gid=1003(r1) groups=1003(r1),1000(tom)</span><br></pre></td></tr></table></figure>

<h3 id="æ™šè‡ªä¹ ä½œä¸š"><a href="#æ™šè‡ªä¹ ä½œä¸š" class="headerlink" title="æ™šè‡ªä¹ ä½œä¸š"></a>æ™šè‡ªä¹ ä½œä¸š</h3><ol>
<li>å®Œæˆä»Šå¤©è¯¾ä¸Šçš„æ‰€æœ‰ç»ƒä¹ é¢˜ç›®</li>
<li>çŸ³å­æ¸¸æˆï¼šæœ‰nçŸ³å­ï¼Œè°æ‹¿åˆ°æœ€åä¸€ä¸ªçŸ³å­è°èµ¢ï¼Œ<br>ç”¨æˆ·å¯ä»¥æŒ‡å®šä¸€å…±ç”±å¤šå°‘ä¸ªçŸ³å­ï¼Œæ¯æ¬¡æœ€å¤šå¯ä»¥æ‹¿çš„çŸ³å­æ•°æ˜¯å¯ä»¥ç»™ç”¨æˆ·æŒ‡å®šçš„</li>
<li>åˆ›å»ºä¸€ä¸ªä»¥ä»Šå¤©æ—¥æœŸä¸ºåçš„ç›®å½•20160811;<br>å°†/ç›®å½•ä¸‹æ‰€æœ‰ä»¥.shç»“å°¾çš„æ–‡ä»¶å¤åˆ¶åˆ°æ–°åˆ›å»ºçš„ç›®å½•ä¸­ï¼›<br>å°†è¯¥ç›®å½•æ‰“åŒ…å‹ç¼©å­˜åˆ°/tmpç›®å½•ä¸‹ä¿å­˜ã€‚</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@client0 ~]<span class="comment"># cat game</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"æ¸¸æˆå¼€å§‹ï¼è¯·ç©å®¶æŒ‡å®šçŸ³å­çš„ä¸ªæ•°:"</span> n1</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"è¯·ç©å®¶æŒ‡å®šæ¯æ¬¡å–çŸ³å­çš„æœ€å¤šä¸ªæ•°:"</span> n2</span><br><span class="line"></span><br><span class="line">k=$((<span class="variable">$n1</span>%(<span class="variable">$n2</span>+1)))</span><br><span class="line">j=$((<span class="variable">$n1</span>/(<span class="variable">$n2</span>+1)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">HH</span></span> () &#123;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq 1 <span class="variable">$j</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">read</span> -p <span class="string">"è¯·ç©å®¶å–çŸ³å­:"</span> w</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"æˆ‘å– <span class="variable">$((($n2+1)</span>-<span class="variable">$w</span>)) ä¸ªçŸ³å­"</span></span><br><span class="line">	q=$((<span class="variable">$q</span>-(<span class="variable">$n2</span>+1)))</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"ç›®å‰è¿˜å‰©ä¸‹ <span class="variable">$q</span> ä¸ªçŸ³å­"</span></span><br><span class="line">	[ <span class="variable">$q</span> -eq 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"ä½ è¾“äº†@.@!"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$k</span> -gt 0 ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"æˆ‘å…ˆå– <span class="variable">$k</span> ä¸ªçŸ³å­"</span></span><br><span class="line">	q=$((<span class="variable">$n1</span>-<span class="variable">$k</span>))</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"ç›®å‰è¿˜å‰©ä¸‹ <span class="variable">$q</span> ä¸ªçŸ³å­"</span></span><br><span class="line">	HH</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	q=<span class="variable">$n1</span></span><br><span class="line">	HH</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="case-è¯­æ³•æ ¼å¼"><a href="#case-è¯­æ³•æ ¼å¼" class="headerlink" title="case è¯­æ³•æ ¼å¼"></a>case è¯­æ³•æ ¼å¼</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">case å–å€¼ in</span><br><span class="line">å–å€¼ 1)</span><br><span class="line">	CMD1 ;</span><br><span class="line">	cmd11;</span><br><span class="line">	cmd12;;</span><br><span class="line">å–å€¼ 2)</span><br><span class="line">	CMD2 ;;</span><br><span class="line">å–å€¼ 3)</span><br><span class="line">	CMD3 ;;</span><br><span class="line">*)</span><br><span class="line">	CMD4 ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>
<p>* ä»£è¡¨é™¤äº†ä»¥ä¸Šæ‰€æœ‰çš„å–å€¼ , åšæŸä¸€äº›æ“ä½œ</p>
<h4 id="è¯¾å ‚ç»ƒä¹ -3"><a href="#è¯¾å ‚ç»ƒä¹ -3" class="headerlink" title="è¯¾å ‚ç»ƒä¹ "></a>è¯¾å ‚ç»ƒä¹ </h4><ol>
<li>è¯·é—®ä½ æ˜¯å¦å–œæ¬¢shellè„šæœ¬ï¼Ÿ å¦‚æœä½ å›ç­”yesï¼Œåˆ™ç¨‹åºé€€å‡ºï¼Œå¦åˆ™æ°¸è¿œä¼šé—®ä½ æ˜¯å¦å–œæ¬¢shellè„šæœ¬ï¼Ÿ</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@client0 ~]# cat 1.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">read -p "è¯·é—®ä½ æ˜¯å¦å–œæ¬¢shellè„šæœ¬ï¼Ÿ" an</span><br><span class="line">until [ $an = yes ]</span><br><span class="line">do</span><br><span class="line">case $an in</span><br><span class="line">yes)</span><br><span class="line">	exit;;</span><br><span class="line">*)</span><br><span class="line">	read -p "è¯·é—®ä½ æ˜¯å¦å–œæ¬¢shellè„šæœ¬ï¼Ÿ" an;;</span><br><span class="line"></span><br><span class="line">esac</span><br><span class="line">done</span><br><span class="line">[root@client0 ~]# bash 1.sh</span><br><span class="line">è¯·é—®ä½ æ˜¯å¦å–œæ¬¢shellè„šæœ¬ï¼Ÿyes</span><br><span class="line">[root@client0 ~]# bash 1.sh</span><br><span class="line">è¯·é—®ä½ æ˜¯å¦å–œæ¬¢shellè„šæœ¬ï¼Ÿno</span><br><span class="line">è¯·é—®ä½ æ˜¯å¦å–œæ¬¢shellè„šæœ¬ï¼Ÿlsdjflksd</span><br><span class="line">è¯·é—®ä½ æ˜¯å¦å–œæ¬¢shellè„šæœ¬ï¼Ÿlsdjflksd</span><br><span class="line">è¯·é—®ä½ æ˜¯å¦å–œæ¬¢shellè„šæœ¬ï¼Ÿiii</span><br><span class="line">è¯·é—®ä½ æ˜¯å¦å–œæ¬¢shellè„šæœ¬ï¼Ÿfuck you</span><br><span class="line">1.sh: line 4: [: too many arguments</span><br><span class="line">è¯·é—®ä½ æ˜¯å¦å–œæ¬¢shellè„šæœ¬ï¼Ÿ...</span><br><span class="line">è¯·é—®ä½ æ˜¯å¦å–œæ¬¢shellè„šæœ¬ï¼Ÿ^^^[[D</span><br><span class="line">è¯·é—®ä½ æ˜¯å¦å–œæ¬¢shellè„šæœ¬ï¼Ÿyes</span><br></pre></td></tr></table></figure>



<h3 id="continue-è¯­æ³•æ ¼å¼"><a href="#continue-è¯­æ³•æ ¼å¼" class="headerlink" title="continue è¯­æ³•æ ¼å¼"></a>continue è¯­æ³•æ ¼å¼</h3><pre><code>continue ä½œç”¨äºå¾ªç¯è¯­å¥ä¸­ ä»£è¡¨è·³å‡ºè¿™ä¸ªå¾ªç¯è¿›å…¥ä¸‹ä¸ªå¾ªç¯ .</code></pre><h4 id="è¯¾å ‚ç»ƒä¹ -4"><a href="#è¯¾å ‚ç»ƒä¹ -4" class="headerlink" title="è¯¾å ‚ç»ƒä¹ "></a>è¯¾å ‚ç»ƒä¹ </h4><ol start="2">
<li>è¦æ±‚è¾“å‡º100ä»¥ä¸‹æ‰€æœ‰èƒ½å¤Ÿè¢«7æ•´é™¤ï¼Œä½†ä¸èƒ½å¤Ÿè¢«5æ•´é™¤çš„æ•°å­—ã€‚ï¼ˆå¹¶åœ¨ä¸€è¡Œè¾“å‡ºï¼‰</li>
</ol>
<h3 id="break-è¯­æ³•æ ¼å¼"><a href="#break-è¯­æ³•æ ¼å¼" class="headerlink" title="break è¯­æ³•æ ¼å¼"></a>break è¯­æ³•æ ¼å¼</h3><pre><code>break ä½œç”¨äºå¾ªç¯è¯­å¥ä¸­ ä»£è¡¨ç›´æ¥è·³å‡ºè¯¥å¾ªç¯ .</code></pre><h4 id="è¯¾å ‚ç»ƒä¹ -5"><a href="#è¯¾å ‚ç»ƒä¹ -5" class="headerlink" title="è¯¾å ‚ç»ƒä¹ "></a>è¯¾å ‚ç»ƒä¹ </h4><ol start="3">
<li>è¦æ±‚æ‰¾å‡ºç³»ç»Ÿä¸­å±äºstudentç”¨æˆ·çš„ä¸€ä¸ªæ–‡ä»¶.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@client0 ~]<span class="comment"># cat file.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `find / -user student 2&gt;/dev/null`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">	<span class="built_in">break</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="shift-è¯­æ³•æ ¼å¼"><a href="#shift-è¯­æ³•æ ¼å¼" class="headerlink" title="shift è¯­æ³•æ ¼å¼"></a>shift è¯­æ³•æ ¼å¼</h3><pre><code>ä½ç½®å‚æ•°</code></pre><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">   $</span><span class="bash">1 ä»£è¡¨çš„æ˜¯è¾“å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"><span class="meta">$</span><span class="bash">2 ä»£è¡¨çš„æ˜¯è¾“å…¥çš„ç¬¬äºŒä¸ªå‚æ•° ....</span></span><br><span class="line"><span class="meta">$</span><span class="bash">0 ä»£è¡¨çš„æ˜¯ bash ç¨‹åºæœ¬èº«å</span></span><br><span class="line"><span class="meta">$</span><span class="bash"><span class="comment"># ä»£è¡¨çš„æ˜¯å‚æ•°çš„ä¸ªæ•°</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;10&#125; è¶…è¿‡çš„ä¸¤ä½çš„</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;*&#125;æˆ–è€…<span class="variable">$&#123;@&#125;</span> ä»£è¡¨å°†æ‰€æœ‰ä½ç½®å‚æ•°</span></span><br><span class="line">shift ä»£è¡¨ç§»èµ°ç¬¬ä¸€ä½ä½ç½®å‚æ•° , ç”±åç»­çš„ä½ç½®å‚æ•°å‰ç§»ä¸€ä½ .</span><br></pre></td></tr></table></figure>
<h4 id="è¯¾å ‚ç»ƒä¹ -6"><a href="#è¯¾å ‚ç»ƒä¹ -6" class="headerlink" title="è¯¾å ‚ç»ƒä¹ "></a>è¯¾å ‚ç»ƒä¹ </h4><ol start="4">
<li>æ˜¾ç¤ºä½ç½®å‚æ•°çš„å€¼ï¼Œä»¥åŠå¯æ‰§è¡Œè„šæœ¬åç§°ï¼Œå‚æ•°çš„æ€»æ•°</li>
</ol>
<h3 id="function-è¯­æ³•æ ¼å¼"><a href="#function-è¯­æ³•æ ¼å¼" class="headerlink" title="function è¯­æ³•æ ¼å¼"></a>function è¯­æ³•æ ¼å¼</h3><pre><code>functname ()
{
shell commands
}</code></pre><ul>
<li><p>å‡½æ•°çš„è°ƒç”¨</p>
<ol>
<li>ç›´æ¥è°ƒç”¨å‡½æ•°â€“ å‡½æ•°å</li>
<li>ä¼ å…¥å‚æ•°â€“ å‡½æ•°å å‚æ•°1 å‚æ•°2 å‚æ•°3</li>
<li>ä½¿ç”¨returnè¿”å›å‡½æ•°ç»“æŸçŠ¶æ€</li>
</ol>
</li>
<li><p>å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡</p>
</li>
</ul>
<p>é»˜è®¤ä¸ºå…¨å±€å˜é‡ï¼Œå› æ­¤ä¸åŒçš„å‡½æ•°ä¸å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªå˜é‡ï¼›<br>å¦‚æœè¦å˜æˆå±€éƒ¨å˜é‡ï¼Œéœ€è¦ä½¿ç”¨localæ¥ä¿®é¥°ï¼Œé‚£ä¹ˆä¸åŒçš„å‡½æ•°å°±ä¸èƒ½è®¿é—®åˆ°è¿™ä¸ªå±€éƒ¨å˜é‡ã€‚</p>
<ul>
<li>å‡½æ•°è¿”å›å€¼ return<br>å¯ä»¥ä½¿ç”¨returnå‘½ä»¤æ¥è®¾ç½®è¿”å›å€¼ï¼›</li>
</ul>
<p>ä¾‹å¦‚ return 0</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#### è¯¾å ‚ç»ƒä¹ </span></span><br><span class="line"></span><br><span class="line">5. åˆ›å»ºä¸€ä¸ªå‘½ä»¤boobooï¼Œå‘½ä»¤ç”¨æ³•å¦‚ä¸‹ï¼š</span><br><span class="line">booboo -t 30s 	ä»£è¡¨ç¡30sï¼›å³-tåè·Ÿæ—¶é—´</span><br><span class="line">booboo -l /tmp  ä»£è¡¨æ˜¾ç¤ºæŸä¸ªç›®å½•ä¸‹é¢çš„å†…å®¹å’Œå±æ€§ä»¥åŠç›®å½•æœ¬èº«çš„å±æ€§</span><br><span class="line">booboo -r /tmp/file ä»£è¡¨åˆ é™¤æŸä¸ªæ–‡ä»¶</span><br><span class="line">booboo --<span class="built_in">help</span>	ä»£è¡¨å¸®åŠ©ä¿¡æ¯æ˜¾ç¤ºè¯¥å‘½ä»¤çš„ç”¨æ³•</span><br><span class="line"></span><br><span class="line">6. è¾“å…¥ä½ çš„å‡ºç”Ÿæ—¥æœŸï¼Œç¨‹åºä¼šå‘Šè¯‰ä½ è·ç¦»ä½ ä¸‹ä¸€ä¸ªç”Ÿæ—¥è¿˜æœ‰å‡ å¤©ï¼Ÿ</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@client0 ~]<span class="comment"># cat booboo</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">SLEEP ()</span><br><span class="line">&#123;</span><br><span class="line">	sleep <span class="variable">$1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DIR ()</span><br><span class="line">&#123;</span><br><span class="line">	ls -l <span class="variable">$1</span></span><br><span class="line">	ls -ld <span class="variable">$1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">RM ()</span><br><span class="line">&#123;</span><br><span class="line">	rm -rf <span class="variable">$1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">-t)</span><br><span class="line">	SLEEP <span class="variable">$2</span>;;</span><br><span class="line">-l)</span><br><span class="line">	DIR <span class="variable">$2</span>;;</span><br><span class="line">-r)</span><br><span class="line">	RM <span class="variable">$2</span>;;</span><br><span class="line">--<span class="built_in">help</span>)</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Usage: ls [-t|-l|-r|--help] [values]"</span>;;</span><br><span class="line">*)</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Usage: ls [-t|-l|-r|--help] [values]"</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">[root@client0 ~]<span class="comment"># ./booboo -t 3s</span></span><br></pre></td></tr></table></figure>
<hr>
<p>ä½¿ç”¨bashå†™ä¸€ä¸ªè„šæœ¬å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<p>1) -r æŸ¥çœ‹ç³»ç»Ÿå‘è¡Œç‰ˆæœ¬<br>2) -k æŸ¥çœ‹ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬<br>3) -d æŸ¥çœ‹ç³»ç»Ÿç£ç›˜ä¿¡æ¯<br>4) -u æŸ¥çœ‹å½“å‰ç³»ç»Ÿç”¨æˆ·<br>5) -t æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œæ—¶é—´<br>6) -s æŸ¥çœ‹selinuxçŠ¶æ€<br>7) -f æŸ¥çœ‹å†…å­˜ä¿¡æ¯<br>8) -n æŸ¥çœ‹ç½‘ç»œä¿¡æ¯<br>9) -a å®ç°ä»¥ä¸Šæ‰€æœ‰åŠŸèƒ½<br>10ï¼‰â€“help æŸ¥çœ‹å¸®åŠ©</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">REL () &#123;</span><br><span class="line">cat /etc/redhat-release	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">KER () &#123;</span><br><span class="line">uname -a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DIS () &#123;</span><br><span class="line">df -h</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">USR () &#123;</span><br><span class="line">who</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">UPT () &#123;</span><br><span class="line">uptime</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SEL () &#123;</span><br><span class="line">getenforce</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">FER () &#123;</span><br><span class="line">free -m</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NET () &#123;</span><br><span class="line">ifconfig</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">-r)</span><br><span class="line">	REL;;	</span><br><span class="line">-k)</span><br><span class="line">	KER;;</span><br><span class="line">-d)</span><br><span class="line">	DIS;;</span><br><span class="line">-u)</span><br><span class="line">	USR;;</span><br><span class="line">-t)</span><br><span class="line">	UPT;;</span><br><span class="line">-s)</span><br><span class="line">	SEL;;</span><br><span class="line">-f)	</span><br><span class="line">	FER;;</span><br><span class="line">-n)</span><br><span class="line">	NET;;</span><br><span class="line">-a)</span><br><span class="line">	REL;KER;DIS;USR;UPT;SEL;FER;NET;;</span><br><span class="line">--help)</span><br><span class="line">	echo "this is help"</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>
<hr>
<p>ç”¨shellè„šæœ¬å†™ä¸€ä¸ªç—…æ¯’ï¼Œè¦æ±‚å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¯ä»¥æ„ŸæŸ“ç³»ç»Ÿä¸­çš„æ‰€æœ‰Bourne-Again shell scriptçš„è„šæœ¬,å¯æ‰§è¡Œï¼Œå¯å†™ï¼›</li>
<li>æ‰§è¡Œæ„ŸæŸ“åçš„bash shellè„šæœ¬ä¼šè¾“å‡ºâ€echo hello,I am evil!â€</li>
<li>å¦‚æœå·²ç»è¢«æ„ŸæŸ“ï¼Œå°±ä¸å†æ„ŸæŸ“</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">if [ ! -f /tmp/.mybblock ];then touch /tmp/.mybblock; for i in `find /tmp/test/*` ; do grep "mybblock" $i &amp;&gt; /dev/null &amp;&amp; continue ; file $i | grep "Bourne-Again shell script" &amp;&gt; /dev/null || continue ; [ -x $i -a -w $i ] || continue ; tail -n 1 $0 &gt;&gt; $i; done ; echo "hello,I am evil!"; rm -rf /tmp/.mybblock &amp;&gt; /dev/null ; fi</span><br></pre></td></tr></table></figure>
<hr>
<p>å¦‚æœfoo.sh çš„ç¬¬ä¸€ä¸ªä½ç½®å‚æ•°ä¸º-s ï¼Œé‚£ä¹ˆå°±æ²‰ç¡ï¼Œæ—¶é—´ç”±ç¬¬äºŒä¸ªä½ç½®å‚æ•°å†³å®š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">SLEEP ()</span><br><span class="line">&#123;</span><br><span class="line">        echo "now sleep"</span><br><span class="line">        sleep $1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">-s)</span><br><span class="line">        SLEEP $2;;</span><br><span class="line">*)</span><br><span class="line">        exit;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>






]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>LinuxShellè„šæœ¬æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxShellè„šæœ¬</tag>
      </tags>
  </entry>
  <entry>
    <title>LINUX Shell Scripts ç¬¬ä¸‰è¯¾ æ­£åˆ™è¡¨è¾¾å¼</title>
    <url>/2016/12/23/booboo_bash_shell_scripts/02_shell_regular_expression/</url>
    <content><![CDATA[<p>Regular Expression ã€ regex æˆ– regexp, ç¼©å†™ä¸º RE æ­£åˆ™è¡¨è¾¾å¼è¿™ä¸ªæ¦‚å¿µæœ€åˆæ˜¯ç”± Unix ä¸­çš„å·¥å…·è½¯ä»¶ ( ä¾‹å¦‚ sed å’Œ grep) æ™®åŠå¼€çš„ã€‚</p>
<p>é€šå¸¸è¢«ç”¨æ¥æ£€ç´¢ã€æ›¿æ¢é‚£äº›ç¬¦åˆæŸä¸ªè§„åˆ™çš„æ–‡æœ¬ã€‚</p>
<p>è®¸å¤šç¨‹åºè®¾è®¡è¯­è¨€éƒ½æ”¯æŒæ­£åˆ™è¡¨è¾¾æ˜¯è¿›è¡Œå­—ç¬¦ä¸²æ“ä½œã€‚ä¾‹å¦‚ï¼Œåœ¨perlä¸­å°±å†…å»ºäº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ­£åˆ™è¡¨è¾¾å¼å¼•æ“ï¼Œè¿˜æœ‰javaè¯­è¨€è‡ªå¸¦çš„ã€‚</p>
<p>èµ·æºäºç§‘å­¦å®¶å¯¹äººç±»ç¥ç»ç³»ç»Ÿå·¥ä½œåŸç†çš„æ—©æœŸç ”ç©¶ï¼›Ken Thompsonå°†å…¶åº”ç”¨åˆ°è®¡ç®—æœç´¢ç®—æ³• ï¼ŒUnixä¹‹çˆ¶å°†æ­¤å¼•å…¥åˆ°ç¼–è¾‘å™¨QEDï¼Œåæ¥çš„edï¼Œæœ€ç»ˆå¼•å…¥grepã€‚</p>
<p>æ¦‚å¿µï¼š</p>
<p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¯¹å­—ç¬¦ä¸²æ“ä½œçš„ä¸€ç§é€»è¾‘å…¬å¼ï¼Œå°±æ˜¯ç”¨äº‹å…ˆå®šä¹‰å¥½çš„ä¸€äº›ç‰¹å®šå­—ç¬¦ã€ä»¥åŠè¿™äº›ç‰¹å®šå­—ç¬¦çš„ç»„åˆï¼Œç»„æˆä¸€ä¸ªâ€œè§„åˆ™å­—ç¬¦ä¸²â€ï¼Œè¿™ä¸ªâ€œè§„åˆ™å­—ç¬¦ä¸²â€ç”¨æ¥è¡¨è¾¾å¯¹å­—ç¬¦ä¸²çš„ä¸€ç§è¿‡æ»¤é€»è¾‘ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼"><a href="#ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼"></a>ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼</h3><ul>
<li>æ­£åˆ™è¡¨è¾¾å¼å°±æ˜¯è®°å½•æ–‡æœ¬è§„åˆ™çš„ä»£ç </li>
<li>å’Œé€šé…ç¬¦ç±»ä¼¼,æ­£åˆ™è¡¨è¾¾å¼ä¹Ÿæ˜¯ç”¨æ¥è¿›è¡Œæ–‡æœ¬åŒ¹é…çš„å·¥å…·,åªä¸è¿‡æ¯”èµ·é€šé…ç¬¦,å®ƒèƒ½æ›´ç²¾ç¡®åœ°æè¿°ä½ çš„éœ€æ±‚</li>
</ul>
<p>å­—ç¬¦å’Œå­—ç¬¦ä¸²ï¼š</p>
<ul>
<li>å­—ç¬¦æ˜¯è®¡ç®—æœºè½¯ä»¶å¤„ç†æ–‡å­—æ—¶æœ€åŸºæœ¬çš„å•ä½,å¯èƒ½æ˜¯å­—æ¯,æ•°å­—,æ ‡ç‚¹ç¬¦å·,ç©ºæ ¼,æ¢è¡Œç¬¦,æ±‰å­—ç­‰ç­‰</li>
<li>å­—ç¬¦ä¸²æ˜¯0ä¸ªæˆ–æ›´å¤šä¸ªå­—ç¬¦çš„åºåˆ—ã€‚</li>
</ul>
<p>ç‰¹ç‚¹ï¼š</p>
<ol>
<li>çµæ´»æ€§ã€é€»è¾‘æ€§å’ŒåŠŸèƒ½æ€§éå¸¸å¼ºï¼›</li>
<li>å¯ä»¥è¿…é€Ÿåœ°ç”¨æç®€å•çš„æ–¹å¼è¾¾åˆ°å­—ç¬¦ä¸²çš„å¤æ‚æ§åˆ¶ï¼›</li>
<li>å¯¹äºåˆšæ¥è§¦çš„äººæ¥è¯´ï¼Œæ¯”è¾ƒæ™¦æ¶©éš¾æ‡‚ã€‚</li>
</ol>
<p>åº”ç”¨ç¨‹åºï¼š<br>grep,egrep,awk,mysql,vim</p>
<h3 id="ç‰¹æ®Šç¬¦å·"><a href="#ç‰¹æ®Šç¬¦å·" class="headerlink" title="ç‰¹æ®Šç¬¦å·"></a>ç‰¹æ®Šç¬¦å·</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç‰¹æ®Šå­—ç¬¦ 	ä»£è¡¨æ„ä¹‰</span><br><span class="line">[:alnum:] ä»£è¡¨è‹±æ–‡å¤§å°å†™å­—ç¬¦åŠæ•°å­— ,0-9, A-Z, a-z</span><br><span class="line">[:alpha:] ä»£è¡¨ä»»ä½•è‹±æ–‡å¤§å°å†™å­—ç¬¦ , A-Z, a-z</span><br><span class="line">[:lower:] ä»£è¡¨å°å†™å­—ç¬¦ , a-z</span><br><span class="line">[:upper:] ä»£è¡¨å¤§å†™å­—ç¬¦ ,A-Z</span><br><span class="line">[:digit:] ä»£è¡¨æ•°å­—è€Œå·² , 0-9</span><br><span class="line">[:xdigit:] ä»£è¡¨ 16 è¿›åˆ¶æ•°å­— , å› æ­¤åŒ…æ‹¬ : 0-9, A-F, a-f</span><br><span class="line">[:blank:] ä»£è¡¨ç©ºæ ¼é”®å’Œ [Tab] æŒ‰é”®</span><br><span class="line">[:space:] ä»»ä½•ä¼šäº§ç”Ÿç©ºç™½çš„å­—ç¬¦,åŒ…æ‹¬ç©ºæ ¼é”® , [Tab], CR ç­‰ç­‰</span><br><span class="line">[:graph:] é™¤äº†ç©ºæ ¼é”® ( ç©ºæ ¼é”®å’Œ [Tab] ) å¤–çš„å…¶ä»–æ‰€æœ‰æŒ‰é”®</span><br><span class="line">[:cntrl:] ä»£è¡¨é”®ç›˜ä¸Šé¢çš„æ§åˆ¶æŒ‰é”® , åŒ…æ‹¬ CR, LF, Tab, Del.. ç­‰ç­‰</span><br><span class="line">[:print:] ä»£è¡¨ä»»ä½•å¯ä»¥è¢«æ‰“å°å‡ºæ¥çš„å­—ç¬¦</span><br><span class="line">[:punct:] ä»£è¡¨æ ‡ç‚¹ç¬¦å· (punctuation symbol) :&quot; &#39; ? ! ; : # $...</span><br></pre></td></tr></table></figure>
<h3 id="éæ‰“å°å­—ç¬¦"><a href="#éæ‰“å°å­—ç¬¦" class="headerlink" title="éæ‰“å°å­—ç¬¦"></a>éæ‰“å°å­—ç¬¦</h3><p>éæ‰“å°å­—ç¬¦ä¹Ÿå¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„ç»„æˆéƒ¨åˆ†ã€‚ä¸‹è¡¨åˆ—å‡ºäº†è¡¨ç¤ºéæ‰“å°å­—ç¬¦çš„è½¬ä¹‰åºåˆ—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å­—ç¬¦ 	æè¿°</span><br><span class="line">\cx 	åŒ¹é…ç”±xæŒ‡æ˜çš„æ§åˆ¶å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ \cM åŒ¹é…ä¸€ä¸ª Control-M æˆ–å›è½¦ç¬¦ã€‚x çš„å€¼å¿…é¡»ä¸º A-Z æˆ– a-z ä¹‹ä¸€ã€‚å¦åˆ™ï¼Œå°† c è§†ä¸ºä¸€ä¸ªåŸä¹‰çš„ &#39;c&#39; å­—ç¬¦ã€‚</span><br><span class="line">\f 	åŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦ã€‚ç­‰ä»·äº \x0c å’Œ \cLã€‚</span><br><span class="line">\n 	åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ç­‰ä»·äº \x0a å’Œ \cJã€‚</span><br><span class="line">\r 	åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦ã€‚ç­‰ä»·äº \x0d å’Œ \cMã€‚</span><br><span class="line">\s 	åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äº [ \f\n\r\t\v]ã€‚</span><br><span class="line">\S 	åŒ¹é…ä»»ä½•éç©ºç™½å­—ç¬¦ã€‚ç­‰ä»·äº [^ \f\n\r\t\v]ã€‚</span><br><span class="line">\t 	åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº \x09 å’Œ \cIã€‚</span><br><span class="line">\v 	åŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº \x0b å’Œ \cK</span><br></pre></td></tr></table></figure>
<h3 id="å¸¸è§çš„æ­£åˆ™è¡¨è¾¾å¼"><a href="#å¸¸è§çš„æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="å¸¸è§çš„æ­£åˆ™è¡¨è¾¾å¼"></a>å¸¸è§çš„æ­£åˆ™è¡¨è¾¾å¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^ 	è¡Œé¦–å®šä½ç¬¦</span><br><span class="line">$ 	è¡Œå°¾å®šä½ç¬¦</span><br><span class="line">. 	åŒ¹é…é™¤æ¢è¡Œç¬¦ä¹‹å¤–çš„å•ä¸ªå­—ç¬¦</span><br><span class="line">* 	åŒ¹é… 0 ä¸ªæˆ–å¤šä¸ªå‰ä¸€å­—ç¬¦</span><br><span class="line">? 	åŒ¹é… 0 ä¸ªæˆ–1ä¸ªå‰ä¸€å­—ç¬¦</span><br><span class="line">+	åŒ¹é… 1 ä¸ªæˆ–å¤šä¸ªå‰ä¸€ä¸ªå­—ç¬¦</span><br><span class="line">[ ] 	åŒ¹é…æŒ‡å®šå­—ç¬¦ç»„å†…çš„ä»»ä¸€å­—ç¬¦</span><br><span class="line">[^] 	åŒ¹é…ä¸åœ¨æŒ‡å®šå­—ç¬¦ç»„å†…çš„ä»»ä¸€å­—ç¬¦</span><br><span class="line">\&lt; 	å•è¯èµ·å§‹è¾¹ç•ŒåŒ¹é…ç¬¦</span><br><span class="line">\&gt; 	å•è¯ç»“æŸè¾¹ç•ŒåŒ¹é…ç¬¦</span><br><span class="line">x\&#123;m\&#125;	è¿ç»­ M ä¸ªå­—ç¬¦ X</span><br><span class="line">x\&#123;m,\&#125; è‡³å°‘ M ä¸ªå­—ç¬¦ X</span><br><span class="line">x\&#123;m,n\&#125;è‡³å°‘ M ä¸ªæœ€å¤š N ä¸ªå­—ç¬¦ X</span><br></pre></td></tr></table></figure>

<h3 id="è¯¾å ‚ç»ƒä¹ "><a href="#è¯¾å ‚ç»ƒä¹ " class="headerlink" title="è¯¾å ‚ç»ƒä¹ "></a>è¯¾å ‚ç»ƒä¹ </h3><blockquote>
<p>å†™ä¸€ä¸ªæµ‹è¯•è„šæœ¬re.sh;å¸¦ä½ç½®å‚æ•°æ‰§è¡Œï¼Œä¾‹å¦‚ re.sh ab</p>
</blockquote>
<h4 id="ä»£è¡¨ä»¥aå¼€å¤´çš„"><a href="#ä»£è¡¨ä»¥aå¼€å¤´çš„" class="headerlink" title="ä»£è¡¨ä»¥aå¼€å¤´çš„"></a>ä»£è¡¨ä»¥aå¼€å¤´çš„</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">if [[ $1 =~ ^a  ]]</span><br><span class="line">then</span><br><span class="line">        echo ok</span><br><span class="line">else</span><br><span class="line">        echo no</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•ï¼š</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# bash re.sh a</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh b</span><br><span class="line">no</span><br><span class="line">[root@rhel6 ~]# bash re.sh ab</span><br><span class="line">ok</span><br></pre></td></tr></table></figure>
<h4 id="ä»£è¡¨ä»¥aç»“å°¾çš„"><a href="#ä»£è¡¨ä»¥aç»“å°¾çš„" class="headerlink" title="ä»£è¡¨ä»¥aç»“å°¾çš„"></a>ä»£è¡¨ä»¥aç»“å°¾çš„</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">if [[ $1 =~ a$  ]]</span><br><span class="line">then</span><br><span class="line">        echo ok</span><br><span class="line">else</span><br><span class="line">        echo no</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p><strong>æµ‹è¯•ï¼š</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# vim re.sh</span><br><span class="line">[root@rhel6 ~]# bash re.sh a</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh b</span><br><span class="line">no</span><br><span class="line">[root@rhel6 ~]# bash re.sh ab</span><br><span class="line">no</span><br><span class="line">[root@rhel6 ~]# bash re.sh ba</span><br><span class="line">ok</span><br></pre></td></tr></table></figure>


<h4 id="ä»£è¡¨aå­—ç¬¦åé¢ä¸€å®šæœ‰ä¸¤ä¸ªå­—ç¬¦"><a href="#ä»£è¡¨aå­—ç¬¦åé¢ä¸€å®šæœ‰ä¸¤ä¸ªå­—ç¬¦" class="headerlink" title="ä»£è¡¨aå­—ç¬¦åé¢ä¸€å®šæœ‰ä¸¤ä¸ªå­—ç¬¦"></a>ä»£è¡¨aå­—ç¬¦åé¢ä¸€å®šæœ‰ä¸¤ä¸ªå­—ç¬¦</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">if [[ $1 =~ a..  ]]</span><br><span class="line">then</span><br><span class="line">	echo ok</span><br><span class="line">else</span><br><span class="line">	echo no</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p><strong>æµ‹è¯•ï¼š</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# vim re.sh</span><br><span class="line">[root@rhel6 ~]# bash re.sh a</span><br><span class="line">no</span><br><span class="line">[root@rhel6 ~]# bash re.sh axx</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh baxx</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh baxxx</span><br><span class="line">ok</span><br></pre></td></tr></table></figure>

<h4 id="ä»£è¡¨åŒ¹é…aå­—ç¬¦åé¢å¯ä»¥æ˜¯0ä¸ªbï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªb"><a href="#ä»£è¡¨åŒ¹é…aå­—ç¬¦åé¢å¯ä»¥æ˜¯0ä¸ªbï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªb" class="headerlink" title="ä»£è¡¨åŒ¹é…aå­—ç¬¦åé¢å¯ä»¥æ˜¯0ä¸ªbï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªb"></a>ä»£è¡¨åŒ¹é…aå­—ç¬¦åé¢å¯ä»¥æ˜¯0ä¸ªbï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªb</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">if [[ $1 =~ ab*  ]]</span><br><span class="line">then</span><br><span class="line">	echo ok</span><br><span class="line">else</span><br><span class="line">	echo no</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p><strong>æµ‹è¯•ï¼š</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# bash re.sh a</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh ab</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh abbbb</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh abbbbxxx</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh accc</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh ccc</span><br><span class="line">no</span><br></pre></td></tr></table></figure>


<h4 id="åŒ¹é…-0-ä¸ªæˆ–1ä¸ªå‰ä¸€å­—ç¬¦"><a href="#åŒ¹é…-0-ä¸ªæˆ–1ä¸ªå‰ä¸€å­—ç¬¦" class="headerlink" title="åŒ¹é… 0 ä¸ªæˆ–1ä¸ªå‰ä¸€å­—ç¬¦"></a>åŒ¹é… 0 ä¸ªæˆ–1ä¸ªå‰ä¸€å­—ç¬¦</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">if [[ $1 =~ 1a?1 ]]</span><br><span class="line">then</span><br><span class="line">        echo ok</span><br><span class="line">else</span><br><span class="line">        echo no</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p><strong>æµ‹è¯•ï¼š</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# bash re.sh 11</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh 1a1</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh 1aa1</span><br><span class="line">no</span><br></pre></td></tr></table></figure>

<h4 id="ä»£è¡¨åŒ¹é…aå­—ç¬¦åé¢å¯ä»¥æ˜¯1ä¸ªbï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªb"><a href="#ä»£è¡¨åŒ¹é…aå­—ç¬¦åé¢å¯ä»¥æ˜¯1ä¸ªbï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªb" class="headerlink" title="ä»£è¡¨åŒ¹é…aå­—ç¬¦åé¢å¯ä»¥æ˜¯1ä¸ªbï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªb"></a>ä»£è¡¨åŒ¹é…aå­—ç¬¦åé¢å¯ä»¥æ˜¯1ä¸ªbï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªb</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">if [[ $1 =~ ab+ ]]</span><br><span class="line">then</span><br><span class="line">	echo ok</span><br><span class="line">else</span><br><span class="line">	echo no</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p><strong>æµ‹è¯•ï¼š</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# bash re.sh a</span><br><span class="line">no</span><br><span class="line">[root@rhel6 ~]# bash re.sh ab</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh abbb</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh ac</span><br><span class="line">no</span><br></pre></td></tr></table></figure>


<h4 id="ä»£è¡¨åŒ¹é…abå­—ç¬¦ï¼Œåé¢å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦"><a href="#ä»£è¡¨åŒ¹é…abå­—ç¬¦ï¼Œåé¢å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦" class="headerlink" title="ä»£è¡¨åŒ¹é…abå­—ç¬¦ï¼Œåé¢å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦"></a>ä»£è¡¨åŒ¹é…abå­—ç¬¦ï¼Œåé¢å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">if [[ $1 =~ ab.*  ]]</span><br><span class="line">then</span><br><span class="line">	echo ok</span><br><span class="line">else</span><br><span class="line">	echo no</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p><strong>æµ‹è¯•ï¼š</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# vim re.sh</span><br><span class="line">[root@rhel6 ~]# bash re.sh a</span><br><span class="line">no</span><br><span class="line">[root@rhel6 ~]# bash re.sh ab</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh abbbb</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh accc</span><br><span class="line">no</span><br><span class="line">[root@rhel6 ~]# bash re.sh ccc</span><br><span class="line">no</span><br></pre></td></tr></table></figure>

<h4 id="ä»£è¡¨åŒ¹é…aå’Œbå­—ç¬¦ä¹‹é—´å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦"><a href="#ä»£è¡¨åŒ¹é…aå’Œbå­—ç¬¦ä¹‹é—´å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦" class="headerlink" title="ä»£è¡¨åŒ¹é…aå’Œbå­—ç¬¦ä¹‹é—´å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦"></a>ä»£è¡¨åŒ¹é…aå’Œbå­—ç¬¦ä¹‹é—´å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">if [[ $1 =~ a.*b  ]]</span><br><span class="line">then</span><br><span class="line">	echo ok</span><br><span class="line">else</span><br><span class="line">	echo no</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p><strong>æµ‹è¯•ï¼š</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# bash re.sh a</span><br><span class="line">no</span><br><span class="line">[root@rhel6 ~]# bash re.sh b</span><br><span class="line">no</span><br><span class="line">[root@rhel6 ~]# bash re.sh ab</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh a1b</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh 1a1b1</span><br><span class="line">ok</span><br></pre></td></tr></table></figure>
<h4 id="ä»£è¡¨åŒ¹é…æŒ‡å®šå­—ç¬¦ç»„å†…çš„ä»»ä¸€å­—ç¬¦ï¼Œå¯ä»¥ç”¨é€—å·åˆ†å‰²ï¼Œæˆ–è€…ä¸ç”¨ï¼Œæ•ˆæœä¸€æ ·éƒ½ä»£è¡¨åŒ¹é…ä¸€ä¸ªå­—ç¬¦"><a href="#ä»£è¡¨åŒ¹é…æŒ‡å®šå­—ç¬¦ç»„å†…çš„ä»»ä¸€å­—ç¬¦ï¼Œå¯ä»¥ç”¨é€—å·åˆ†å‰²ï¼Œæˆ–è€…ä¸ç”¨ï¼Œæ•ˆæœä¸€æ ·éƒ½ä»£è¡¨åŒ¹é…ä¸€ä¸ªå­—ç¬¦" class="headerlink" title="ä»£è¡¨åŒ¹é…æŒ‡å®šå­—ç¬¦ç»„å†…çš„ä»»ä¸€å­—ç¬¦ï¼Œå¯ä»¥ç”¨é€—å·åˆ†å‰²ï¼Œæˆ–è€…ä¸ç”¨ï¼Œæ•ˆæœä¸€æ ·éƒ½ä»£è¡¨åŒ¹é…ä¸€ä¸ªå­—ç¬¦"></a>ä»£è¡¨åŒ¹é…æŒ‡å®šå­—ç¬¦ç»„å†…çš„ä»»ä¸€å­—ç¬¦ï¼Œå¯ä»¥ç”¨é€—å·åˆ†å‰²ï¼Œæˆ–è€…ä¸ç”¨ï¼Œæ•ˆæœä¸€æ ·éƒ½ä»£è¡¨åŒ¹é…ä¸€ä¸ªå­—ç¬¦</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">if [[ $1 =~ [Bb]ooboo ]]</span><br><span class="line">then</span><br><span class="line">        echo ok</span><br><span class="line">else</span><br><span class="line">        echo no</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p><strong>æµ‹è¯•ï¼š</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# bash re.sh booboo</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh Booboo</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh cooboo</span><br><span class="line">no</span><br></pre></td></tr></table></figure>

<h4 id="ä»£è¡¨åŒ¹é…ä¸åœ¨æŒ‡å®šå­—ç¬¦ç»„å†…çš„ä»»ä¸€å­—ç¬¦"><a href="#ä»£è¡¨åŒ¹é…ä¸åœ¨æŒ‡å®šå­—ç¬¦ç»„å†…çš„ä»»ä¸€å­—ç¬¦" class="headerlink" title="ä»£è¡¨åŒ¹é…ä¸åœ¨æŒ‡å®šå­—ç¬¦ç»„å†…çš„ä»»ä¸€å­—ç¬¦"></a>ä»£è¡¨åŒ¹é…ä¸åœ¨æŒ‡å®šå­—ç¬¦ç»„å†…çš„ä»»ä¸€å­—ç¬¦</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">if [[ $1 =~ [^Bb]ooboo ]]</span><br><span class="line">then</span><br><span class="line">        echo ok</span><br><span class="line">else</span><br><span class="line">        echo no</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p><strong>æµ‹è¯•ï¼š</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# bash re.sh booboo</span><br><span class="line">no</span><br><span class="line">[root@rhel6 ~]# bash re.sh Booboo</span><br><span class="line">no</span><br><span class="line">[root@rhel6 ~]# bash re.sh cooboo</span><br><span class="line">ok</span><br></pre></td></tr></table></figure>



<h4 id="å•è¯èµ·å§‹å’Œç»“æŸè¾¹ç•ŒåŒ¹é…ç¬¦ä¸è¡Œé¦–è¡Œå°¾çš„åŒ¹é…å¯¹æ¯”"><a href="#å•è¯èµ·å§‹å’Œç»“æŸè¾¹ç•ŒåŒ¹é…ç¬¦ä¸è¡Œé¦–è¡Œå°¾çš„åŒ¹é…å¯¹æ¯”" class="headerlink" title="å•è¯èµ·å§‹å’Œç»“æŸè¾¹ç•ŒåŒ¹é…ç¬¦ä¸è¡Œé¦–è¡Œå°¾çš„åŒ¹é…å¯¹æ¯”"></a>å•è¯èµ·å§‹å’Œç»“æŸè¾¹ç•ŒåŒ¹é…ç¬¦ä¸è¡Œé¦–è¡Œå°¾çš„åŒ¹é…å¯¹æ¯”</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# vim re.file</span><br><span class="line">booboo	tom	jack</span><br><span class="line">jack	tom	booboo</span><br><span class="line">tom tom	tom</span><br><span class="line">jack</span><br><span class="line"> jack</span><br><span class="line">jack</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# grep "^booboo" re.file</span><br><span class="line">booboo	tom	jack</span><br><span class="line">[root@rhel6 ~]# grep "\&lt;booboo" re.file</span><br><span class="line">booboo	tom	jack</span><br><span class="line">jack	tom	booboo</span><br><span class="line">[root@rhel6 ~]# grep "\&gt;booboo" re.file</span><br><span class="line">[root@rhel6 ~]# grep "\&gt;jack" re.file</span><br><span class="line">[root@rhel6 ~]# grep "jack$" re.file</span><br><span class="line">booboo	tom	jack</span><br><span class="line">jack</span><br><span class="line"> jack</span><br><span class="line">jack</span><br><span class="line">[root@rhel6 ~]# grep "jack\&gt;" re.file</span><br><span class="line">booboo	tom	jack</span><br><span class="line">jack	tom	booboo</span><br><span class="line">jack</span><br><span class="line"> jack</span><br><span class="line">jack</span><br></pre></td></tr></table></figure>
<h4 id="æŸä¸ªå­—ç¬¦æ•°é‡é™å®š"><a href="#æŸä¸ªå­—ç¬¦æ•°é‡é™å®š" class="headerlink" title="æŸä¸ªå­—ç¬¦æ•°é‡é™å®š"></a>æŸä¸ªå­—ç¬¦æ•°é‡é™å®š</h4><ul>
<li>x{m}è¿ç»­ M ä¸ªå­—ç¬¦ X       x{3} =3<ul>
<li>x{m,} è‡³å°‘ M ä¸ªå­—ç¬¦ Xx{3,} &gt;=3</li>
</ul>
</li>
<li>x{m,n} è‡³å°‘ M ä¸ªæœ€å¤š N ä¸ªå­—ç¬¦ X x{3,4} &gt;=3 &lt;=4</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# vim re.file</span><br><span class="line">booboo	tom	jack</span><br><span class="line">jack	tom	booboo</span><br><span class="line">tom tom	tom</span><br><span class="line">jack</span><br><span class="line"> jack</span><br><span class="line">jack</span><br><span class="line">f	fo	foo	fooo	foooo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# grep "o\&#123;0\&#125;" re.file</span><br><span class="line">booboo	tom	jack</span><br><span class="line">jack	tom	booboo</span><br><span class="line">tom tom	tom</span><br><span class="line">jack</span><br><span class="line"> jack</span><br><span class="line">jack</span><br><span class="line">booo</span><br><span class="line">boo</span><br><span class="line">f	fo	foo	fooo	foooo</span><br><span class="line">[root@rhel6 ~]# grep "o\&#123;1\&#125;" re.file</span><br><span class="line">booboo	tom	jack</span><br><span class="line">jack	tom	booboo</span><br><span class="line">tom tom	tom</span><br><span class="line">booo</span><br><span class="line">boo</span><br><span class="line">f	fo	foo	fooo	foooo</span><br><span class="line">[root@rhel6 ~]# grep "o\&#123;4\&#125;" re.file</span><br><span class="line">f	fo	foo	fooo	foooo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">if [[ $1 =~ o&#123;2,3&#125;$ ]]</span><br><span class="line">then</span><br><span class="line">        echo ok</span><br><span class="line">else</span><br><span class="line">        echo no</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# bash re.sh foo</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh fooo</span><br><span class="line">ok</span><br><span class="line">[root@rhel6 ~]# bash re.sh fooof</span><br><span class="line">no</span><br><span class="line">[root@rhel6 ~]# bash re.sh foof</span><br><span class="line">no</span><br></pre></td></tr></table></figure>
<h4 id="digit-ä»£è¡¨æ•°å­—è€Œå·²-0-9"><a href="#digit-ä»£è¡¨æ•°å­—è€Œå·²-0-9" class="headerlink" title="[:digit:]ä»£è¡¨æ•°å­—è€Œå·² , 0-9"></a>[:digit:]ä»£è¡¨æ•°å­—è€Œå·² , 0-9</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# cat re.file1</span><br><span class="line">45aa</span><br><span class="line">sdfsdf</span><br><span class="line">4444</span><br><span class="line">[root@rhel6 ~]# grep "[[:digit:]]" re.file1</span><br><span class="line">45aa</span><br><span class="line">4444</span><br><span class="line">[root@rhel6 ~]# grep "^[[:digit:]]" re.file1</span><br><span class="line">45aa</span><br><span class="line">4444</span><br><span class="line">[root@rhel6 ~]# grep "[^[:digit:]]" re.file1</span><br><span class="line">45aa</span><br><span class="line">sdfsdf</span><br><span class="line">[root@rhel6 ~]# grep "^[^[:digit:]]" re.file1</span><br><span class="line">sdfsdf</span><br></pre></td></tr></table></figure>
<h3 id="è¯¾å ‚ä½œä¸š"><a href="#è¯¾å ‚ä½œä¸š" class="headerlink" title="è¯¾å ‚ä½œä¸š"></a>è¯¾å ‚ä½œä¸š</h3><blockquote>
<p>1.è¯´å‡ºä¸‹é¢åŒ¹é…çš„å†…å®¹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">^a ä»¥aå¼€å¤´</span></span><br><span class="line"><span class="meta">#</span><span class="bash">b? bçš„ä¸ªæ•°0æˆ–è€…1</span></span><br><span class="line"><span class="meta">#</span><span class="bash">c+ cçš„ä¸ªæ•°&gt;=1</span></span><br><span class="line"><span class="meta">#</span><span class="bash">d.*e då’Œeä¹‹é—´å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦</span></span><br><span class="line"><span class="meta">#</span><span class="bash">f$ ä»¥fç»“å°¾</span></span><br><span class="line">if [[ $1 =~ ^ab?c+d.*ef$ ]]</span><br><span class="line">then</span><br><span class="line">        echo ok</span><br><span class="line">else</span><br><span class="line">        echo no</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h3 id="è¯¾åä½œä¸š"><a href="#è¯¾åä½œä¸š" class="headerlink" title="è¯¾åä½œä¸š"></a>è¯¾åä½œä¸š</h3><blockquote>
<p>1.ifåˆ¤æ–­åŒ¹é…ipåœ°å€</p>
</blockquote>
<blockquote>
<p>2.ifåˆ¤æ–­åŒ¹é…é‚®ä»¶åœ°å€æ ¼å¼ä¸º<a href="mailto:9aA@9aA.com">9aA@9aA.com</a></p>
</blockquote>
<blockquote>
<p>3.grep è¿‡æ»¤ç©ºç™½è¡Œ</p>
</blockquote>
<blockquote>
<p>4.grep è¿‡æ»¤ä»¥ç©ºæ ¼å¼€å¤´çš„è¡Œ</p>
</blockquote>
<blockquote>
<p>5.é’ˆå¯¹/usr/share/dict/wordsæ–‡ä»¶åšè¿‡æ»¤</p>
</blockquote>
<blockquote>
<p> 1ï¼‰åˆ—å‡ºæ–‡ä»¶ä¸­åŒ…å« å…ˆæœ‰å­—æ¯tï¼Œç„¶åä¸­é—´æœ‰ä¸€ä¸ªå…ƒéŸ³å­—æ¯ï¼Œä¹‹åæ˜¯shçš„å•è¯ï¼›</p>
</blockquote>
<blockquote>
<p> 2ï¼‰åˆ—å‡ºæ–‡ä»¶ä¸­åŒ…å« å…ˆæœ‰å­—æ¯tï¼Œç„¶åä¸­é—´æœ‰è‹¥å¹²ä¸ªå…ƒéŸ³å­—æ¯ï¼Œä¹‹åæ˜¯shçš„å•è¯ï¼›</p>
</blockquote>
<blockquote>
<p> 3ï¼‰åˆ—å‡ºæ–‡ä»¶ä¸­åˆšå¥½åŒ…å«16ä¸ªå­—æ¯çš„å•è¯ã€‚**</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">if [[ $1 =~ ^[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;$ ]]</span><br><span class="line">then</span><br><span class="line">	IP=($&#123;1//\./ &#125;)</span><br><span class="line">	[ $&#123;IP[0]&#125; -gt 0 -a $&#123;IP[0]&#125; -lt 255 ] &amp;&amp; [ $&#123;IP[1]&#125; -ge 0 -a $&#123;IP[1]&#125; -lt 255 ] &amp;&amp; [ $&#123;IP[2]&#125; -ge 0 -a $&#123;IP[2]&#125; -lt 255 ] &amp;&amp; [ $&#123;IP[3]&#125; -gt 0 -a $&#123;IP[3]&#125; -lt 255 ] &amp;&amp; echo ok || echo no</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">        echo "this is not IPADDR!"</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">if [[ $1 =~ ^[0-9a-zA-Z]+@[0-9a-zA-Z]+\.com$  ]]</span><br><span class="line">then</span><br><span class="line">	echo ok</span><br><span class="line">else</span><br><span class="line">	echo no</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# grep "^$" re.file2</span><br><span class="line"></span><br><span class="line">grep '^t[a-zA-Z]sh' /usr/share/dict/words</span><br><span class="line">grep '^t[a-zA-Z]\+sh' /usr/share/dict/words</span><br><span class="line">grep -E '^[a-zA-Z0-9]&#123;16&#125;$' /usr/share/dict/words                         </span><br><span class="line">grep '^[a-zA-Z0-9]\&#123;16\&#125;$' /usr/share/dict/words</span><br></pre></td></tr></table></figure>


<h3 id="æ™šè‡ªä¹ ä½œä¸š"><a href="#æ™šè‡ªä¹ ä½œä¸š" class="headerlink" title="æ™šè‡ªä¹ ä½œä¸š"></a>æ™šè‡ªä¹ ä½œä¸š</h3><ol>
<li>å®Œæˆæ‰€æœ‰ç»ƒä¹ </li>
<li>å¸å·æ˜¯å¦åˆæ³•ï¼ˆå­—æ¯å¼€å¤´ï¼Œå…è®¸5-16ä½ï¼Œåªèƒ½åŒ…å«å­—æ¯æ•°å­—ä¸‹åˆ’çº¿ï¼‰</li>
<li>å¯†ç æ˜¯å¦åˆæ³•ï¼ˆå­—æ¯å¼€å¤´ï¼Œå…è®¸6-18ä½ï¼Œåªèƒ½åŒ…å«å­—æ¯æ•°å­—ä¸‹åˆ’çº¿å’Œï¼@#ï¼‰</li>
<li>åŒ¹é…æ—¥æœŸ2016-10-11<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">if</span> [[ <span class="variable">$1</span> =~ ^[0-9]&#123;4&#125;-[0-9]&#123;2&#125;-[0-9]&#123;2&#125;$ ]]</span></span><br><span class="line">if [[ $1 =~ ^[0-9]&#123;4&#125;-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[1-9]|3[01])$ ]]</span><br><span class="line">then</span><br><span class="line">	echo ok</span><br><span class="line">else</span><br><span class="line">	echo no</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>LinuxShellè„šæœ¬æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxShellè„šæœ¬</tag>
      </tags>
  </entry>
  <entry>
    <title>LINUX Shell Scripts ç¬¬å››è¯¾ Sed</title>
    <url>/2016/12/23/booboo_bash_shell_scripts/03_shell_sed_awk/</url>
    <content><![CDATA[<h2 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h2><h3 id="ä»€ä¹ˆæ˜¯sed"><a href="#ä»€ä¹ˆæ˜¯sed" class="headerlink" title="ä»€ä¹ˆæ˜¯sed"></a>ä»€ä¹ˆæ˜¯sed</h3><p>sed( æ„ä¸ºæµç¼–è¾‘å™¨ , æºè‡ªè‹±è¯­ â€œ stream editorâ€ çš„ç¼©å†™ ) æ˜¯ Unix å¸¸è§çš„å‘½ä»¤è¡Œç¨‹åºã€‚ sed ç”¨æ¥æŠŠæ–‡æ¡£æˆ–å­—ç¬¦ä¸²é‡Œé¢çš„æ–‡å­—ç»è¿‡ä¸€ç³»åˆ—ç¼–è¾‘å‘½ä»¤è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼è¾“å‡ºã€‚ sed é€šå¸¸ ç”¨æ¥åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æ–‡æœ¬è¿›è¡Œå¤„ç†ã€‚ åˆ†å· (;) å¯ä»¥ç”¨ä½œåˆ†éš”å‘½ä»¤çš„æŒ‡ç¤ºç¬¦ã€‚å°½ç®¡ sed è„šæœ¬å›ºæœ‰çš„å¾ˆå¤šé™åˆ¶ , ä¸€è¿ä¸²çš„ sed æŒ‡ä»¤åŠ èµ·æ¥å¯ä»¥ç¼–ç¨‹åƒ ä»“ åº“ç•ªã€å¿«æ‰“ç –å—ã€ç”šè‡³ä¿„ç½—æ–¯æ–¹å—ç­‰ç”µè„‘æ¸¸æˆçš„å¤æ‚ç¨‹åºã€‚</p>
<h3 id="å¦‚ä½•ä½¿ç”¨sed"><a href="#å¦‚ä½•ä½¿ç”¨sed" class="headerlink" title="å¦‚ä½•ä½¿ç”¨sed"></a>å¦‚ä½•ä½¿ç”¨sed</h3><h4 id="è¯­æ³•æ¨¡å¼"><a href="#è¯­æ³•æ¨¡å¼" class="headerlink" title="è¯­æ³•æ¨¡å¼"></a>è¯­æ³•æ¨¡å¼</h4><p>â€¢ å‘½ä»¤è¡Œæ¨¡å¼<br>â€¢ è„šæœ¬æ¨¡å¼</p>
<p>å‘½ä»¤è¡Œæ¨¡å¼</p>
<p>sed æµç¼–è¾‘å™¨ é’ˆå¯¹è¡Œè¿›è¡Œæ“ä½œçš„</p>
<h4 id="sedå‘½ä»¤çš„åŸç†"><a href="#sedå‘½ä»¤çš„åŸç†" class="headerlink" title="sedå‘½ä»¤çš„åŸç†"></a>sedå‘½ä»¤çš„åŸç†</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¯»æ–‡ä»¶---ä¸€è¡Œä¸€è¡Œè¯»</span><br><span class="line">å­˜å…¥ç¼“å­˜ç©ºé—´</span><br><span class="line">åŒ¹é…è¡Œ---æ˜¯---åŠ¨ä½œ--ç»§ç»­è¯»å–</span><br><span class="line">     ---ä¸æ˜¯------ ç»§ç»­è¯»å–    </span><br><span class="line">è¯»åˆ°æœ€åä¸€è¡Œä¸ºæ­¢</span><br><span class="line">è¾“å‡º</span><br></pre></td></tr></table></figure>

<h4 id="sedå‘½ä»¤çš„ç”¨æ³•"><a href="#sedå‘½ä»¤çš„ç”¨æ³•" class="headerlink" title="sedå‘½ä»¤çš„ç”¨æ³•"></a>sedå‘½ä»¤çš„ç”¨æ³•</h4><ul>
<li>sed [-options] â€˜[cmd]â€™ filename</li>
<li>sed [-options] â€˜[å“ªäº›è¡Œ][å¹²ä»€ä¹ˆ]â€™ filename</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmd</span><br><span class="line">    æ“ä½œå®šä½ï¼ˆå“ªä¸€è¡Œï¼‰</span><br><span class="line">        1    ç¬¬ä¸€è¡Œ</span><br><span class="line">        2,3    ä»ç¬¬äºŒè¡Œåˆ°ç¬¬ä¸‰è¡Œ</span><br><span class="line">        $    æœ€åä¸€è¡Œ</span><br><span class="line">        æ­£åˆ™è¡¨è¾¾å¼</span><br><span class="line">        /^root/    ä»¥rootå¼€å¤´çš„è¡Œ</span><br><span class="line">        /bin$/    ä»¥binç»“å°¾çš„è¡Œ</span><br><span class="line"></span><br><span class="line">        1. åè¿›åˆ¶æ•°å­—</span><br><span class="line">        2. æ­£åˆ™è¡¨è¾¾å¼</span><br><span class="line">        3. é€—å·åˆ†éš”ç¬¦</span><br><span class="line">        4. ç»„åˆæ–¹å¼</span><br><span class="line">        5. ç‰¹æ®Šæ–¹å¼</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    å‡½æ•°ï¼ˆå¹²ä»€ä¹ˆï¼‰</span><br><span class="line">        p    æ‰“å°ï¼Œè¾“å‡ºåˆ°å±å¹•ä¸Š</span><br><span class="line">        d    åˆ é™¤</span><br><span class="line">        s    æ›¿æ¢                   sed '/^#/s/\/\*.*\*\///' file  </span><br><span class="line">        a    å½“å‰è¡Œçš„è¡Œåï¼Œæ·»åŠ ä¸€è¡Œ    sed '1ahello word' file</span><br><span class="line">        i    å½“å‰è¡Œçš„è¡Œå‰ï¼Œæ·»åŠ ä¸€è¡Œ    sed '1ihello word' file</span><br><span class="line">å‚æ•°options</span><br><span class="line">    -n ä¸è¾“å‡ºæ‰€æœ‰çš„è¡Œ</span><br><span class="line">    -i ç›´æ¥ä¿®æ”¹ç›®æ ‡æ–‡ä»¶</span><br><span class="line">    -e è¿æ¥å¤šä¸ªcmd</span><br><span class="line"></span><br><span class="line">ç®€å•æ§åˆ¶æµ</span><br><span class="line"></span><br><span class="line">1. ! å‘½ä»¤å–å</span><br><span class="line">    ä¾‹å¦‚:sed '/kevin/!d' file</span><br><span class="line">    åˆ é™¤ä¸åŒ…å«å­—ç¬¦ä¸²â€kevinâ€œçš„è¡Œ</span><br><span class="line">2. &#123; &#125; ç»„åˆå¤šä¸ªå‘½ä»¤</span><br><span class="line">ç»„åˆå‘½ä»¤ä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«æ‰§è¡Œ,å‡½æ•°å‘½ä»¤ä¹‹é—´ç”¨â€ ;  â€œåˆ†éš”,ç»„åˆå‘½ä»¤å¯ä»¥åµŒå¥—ã€‚</span><br><span class="line">ä¾‹å¦‚:sed '/kevin/&#123;s/1/2/; /3/d&#125;' fileã€‚</span><br><span class="line"></span><br><span class="line">3. n è¯»å–ä¸‹ä¸€è¾“å…¥è¡Œ,ä»ä¸‹ä¸€æ¡å‘½ä»¤è€Œéç¬¬ä¸€æ¡å‘½ä»¤å¼€å§‹æ“ä½œ</span><br><span class="line">ä¾‹å¦‚:sed '/kevin/&#123;n; d&#125;' file</span><br><span class="line">åˆ é™¤å¸¦å­—ç¬¦ä¸²â€kevinâ€œè¡Œçš„ä¸‹ä¸€è¡Œ</span><br></pre></td></tr></table></figure>

<h4 id="è¯¾å ‚ç»ƒä¹ "><a href="#è¯¾å ‚ç»ƒä¹ " class="headerlink" title="è¯¾å ‚ç»ƒä¹ "></a>è¯¾å ‚ç»ƒä¹ </h4><ol>
<li>ä¸‹è½½mysqlbinlog.rowæ–‡ä»¶</li>
<li>æ‰“å°ç¬¬ä¸‰è¡Œ</li>
<li>æ‰“å°1åˆ°5è¡Œ</li>
<li>æ‰“å°æœ€åä¸€è¡Œ</li>
<li>æ‰“å°30åˆ°æœ€åä¸€è¡Œ</li>
<li>æ‰“å°åŒ…å«â€œBEGINâ€çš„è¡Œ</li>
<li>æ‰“å°åŒ…å«â€œCOMMITâ€çš„è¡Œ</li>
<li>æ‰“å°ä»¥â€œ###â€å¼€å¤´çš„è¡Œ</li>
<li>åˆ é™¤æ¯ä¸€è¡Œçš„â€œ### â€</li>
<li>åˆ é™¤æ‰€æœ‰â€œ/<em>åˆ°</em>/â€</li>
<li>å°†â€œDELETE FROMâ€æ›¿æ¢ä¸ºâ€œinsert intoâ€</li>
<li>å°†â€œINSERT INTOâ€æ›¿æ¢ä¸ºâ€œdelete fromâ€</li>
<li>å°†â€œSETâ€æ›¿æ¢ä¸ºâ€œwhereâ€</li>
<li>å°†â€œWHEREâ€æ›¿æ¢ä¸ºâ€œsetâ€</li>
<li>å°†â€œ@1â€æ›¿æ¢ä¸ºâ€œidâ€</li>
<li>å°†â€œ@2â€æ›¿æ¢ä¸ºâ€œnameâ€</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@client0 ~]# sed '3p' mysqlbinlog.row</span><br><span class="line">[root@client0 ~]# sed -n '3p' mysqlbinlog.row</span><br><span class="line">[root@client0 ~]# sed -n '1,5p' mysqlbinlog.row</span><br><span class="line">[root@client0 ~]# sed -n '$p' mysqlbinlog.row</span><br><span class="line">[root@client0 ~]# sed -n '30,$p' mysqlbinlog.row</span><br><span class="line">[root@client0 ~]# sed -n '/BEGIN/p' mysqlbinlog.row</span><br><span class="line">[root@client0 ~]# sed -n '/COMMIT/p' mysqlbinlog.row</span><br><span class="line">[root@client0 ~]# sed '&#123;s/### //;s@\/\*.*\*\/@@;s/DELETE FROM/insert into/;s/INSERT INTO/delete from/;s/SET/where/;s/WHERE/set/;s/@1/id/;s/@2/name/&#125;' mysqlbinlog.row</span><br></pre></td></tr></table></figure>

<h4 id="è¯¾å ‚ç»ƒä¹ -1"><a href="#è¯¾å ‚ç»ƒä¹ -1" class="headerlink" title="è¯¾å ‚ç»ƒä¹ "></a>è¯¾å ‚ç»ƒä¹ </h4><ol>
<li>å°†192.168.1.1æ›¿æ¢æˆ192.168.2.2</li>
<li>å°†192.168.1.1æ›¿æ¢æˆ192.188.5.1</li>
<li>å°†192.168.1.1æ›¿æ¢æˆ192.192.192.1</li>
<li>å°†hello,babayä¸­babayåé¢è¿½åŠ â€,mybabayâ€</li>
<li>å°†hello,babayä¸­helloåé¢è¿½åŠ â€,mybabayâ€</li>
<li>å°†hello,babayæ›¿æ¢ä¸ºâ€hello1hello2hello3,babayâ€</li>
<li>å°†/tmp/shadowçš„å†…å®¹è¿½åŠ åˆ°/tmp/passwdä¸­ä»¥rootå¼€å¤´çš„è¡Œçš„åé¢</li>
<li>å°†/tmp/passwdä¸­ä»¥rootå¼€å¤´çš„è¡Œå’Œåé¢çš„2è¡Œå†™å…¥/tmp/shadow</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@client0 ~]<span class="comment"># echo 192.168.1.1|sed 's/\(.*\)1.1/\12.2/'</span></span><br><span class="line">192.168.2.2</span><br><span class="line">[root@client0 ~]<span class="comment"># echo 192.168.1.1|sed 's/\(.*\)168.1\(.*\)/\1188.5\2/'</span></span><br><span class="line">192.188.5.1</span><br><span class="line">[root@client0 ~]<span class="comment"># echo 192.168.1.1|sed 's/\(.*\)168.1\(.*\)/\1\1\11/'</span></span><br><span class="line">192.192.192.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@client0 ~]<span class="comment"># echo hello,babay|sed 's/babay/&amp;,mybabay/'</span></span><br><span class="line">hello,babay,mybabay</span><br><span class="line">[root@client0 ~]<span class="comment"># echo hello,babay|sed 's/hello/&amp;,mybabay/'</span></span><br><span class="line">hello,mybabay,babay</span><br><span class="line">[root@client0 ~]<span class="comment"># echo hello,babay|sed 's/hello/&amp;1&amp;2&amp;3/'</span></span><br><span class="line">hello1hello2hello3,babay</span><br><span class="line"></span><br><span class="line">[root@client0 ~]<span class="comment"># sed '/^root/r /tmp/shadow' /tmp/passwd</span></span><br><span class="line">[root@client0 ~]<span class="comment"># sed '/^root/,+2w /tmp/shadow' /tmp/passwd</span></span><br></pre></td></tr></table></figure>

<h4 id="è¯¾åä¹ é¢˜"><a href="#è¯¾åä¹ é¢˜" class="headerlink" title="è¯¾åä¹ é¢˜"></a>è¯¾åä¹ é¢˜</h4><pre><code>1. å°†selinuxè®¾ç½®æˆå¼€æœºå…³é—­çŠ¶æ€ã€‚ç”¨sedå®Œæˆ
2. è®¾ç½®å½“å‰ç”¨æˆ·çš„umaskå€¼æ°¸ä¹…ç”Ÿæ•ˆä¸º033 ~/.bashrcã€‚ç”¨sedå®Œæˆ
3. ç”¨è„šæœ¬å®ç°è‡ªåŠ¨åŒ–æ­å»ºDNSæœåŠ¡å™¨ï¼Œå¹¶è‡ªåŠ¨åŒ–é…ç½®è§£æï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</code></pre><h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>awkæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ–‡æœ¬åˆ†æå·¥å…·ï¼Œç›¸å¯¹äºgrepçš„æŸ¥æ‰¾ï¼Œsedçš„ç¼–è¾‘ï¼Œawkåœ¨å…¶å¯¹æ•°æ®åˆ†æå¹¶ç”ŸæˆæŠ¥å‘Šæ—¶ï¼Œæ˜¾å¾—å°¤ä¸ºå¼ºå¤§ã€‚ç®€å•æ¥è¯´awkå°±æ˜¯æŠŠæ–‡ä»¶é€è¡Œçš„è¯»å…¥ï¼Œä»¥ç©ºæ ¼ä¸ºé»˜è®¤åˆ†éš”ç¬¦å°†æ¯è¡Œåˆ‡ç‰‡ï¼Œåˆ‡å¼€çš„éƒ¨åˆ†å†è¿›è¡Œå„ç§åˆ†æå¤„ç†ã€‚</p>
<p>awkæœ‰3ä¸ªä¸åŒç‰ˆæœ¬: awkã€nawkå’Œgawkï¼Œæœªä½œç‰¹åˆ«è¯´æ˜ï¼Œä¸€èˆ¬æŒ‡gawkï¼Œgawk æ˜¯ AWK çš„ GNU ç‰ˆæœ¬ã€‚</p>
<p>awkå…¶åç§°å¾—è‡ªäºå®ƒçš„åˆ›å§‹äºº Alfred Aho ã€Peter Weinberger å’Œ Brian Kernighan å§“æ°çš„é¦–ä¸ªå­—æ¯ã€‚å®é™…ä¸Š AWK çš„ç¡®æ‹¥æœ‰è‡ªå·±çš„è¯­è¨€ï¼š AWK ç¨‹åºè®¾è®¡è¯­è¨€ ï¼Œ ä¸‰ä½åˆ›å»ºè€…å·²å°†å®ƒæ­£å¼å®šä¹‰ä¸ºâ€œæ ·å¼æ‰«æå’Œå¤„ç†è¯­è¨€â€ã€‚å®ƒå…è®¸æ‚¨åˆ›å»ºç®€çŸ­çš„ç¨‹åºï¼Œè¿™äº›ç¨‹åºè¯»å–è¾“å…¥æ–‡ä»¶ã€ä¸ºæ•°æ®æ’åºã€å¤„ç†æ•°æ®ã€å¯¹è¾“å…¥æ‰§è¡Œè®¡ç®—ä»¥åŠç”ŸæˆæŠ¥è¡¨ï¼Œè¿˜æœ‰æ— æ•°å…¶ä»–çš„åŠŸèƒ½ã€‚</p>
<h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><p>awk â€˜{pattern + action}â€™ {filenames}</p>
<p>å°½ç®¡æ“ä½œå¯èƒ½ä¼šå¾ˆå¤æ‚ï¼Œä½†è¯­æ³•æ€»æ˜¯è¿™æ ·ï¼Œå…¶ä¸­ pattern è¡¨ç¤º AWK åœ¨æ•°æ®ä¸­æŸ¥æ‰¾çš„å†…å®¹ï¼Œè€Œ action æ˜¯åœ¨æ‰¾åˆ°åŒ¹é…å†…å®¹æ—¶æ‰€æ‰§è¡Œçš„ä¸€ç³»åˆ—å‘½ä»¤ã€‚èŠ±æ‹¬å·ï¼ˆ{}ï¼‰ä¸éœ€è¦åœ¨ç¨‹åºä¸­å§‹ç»ˆå‡ºç°ï¼Œä½†å®ƒä»¬ç”¨äºæ ¹æ®ç‰¹å®šçš„æ¨¡å¼å¯¹ä¸€ç³»åˆ—æŒ‡ä»¤è¿›è¡Œåˆ†ç»„ã€‚ patternå°±æ˜¯è¦è¡¨ç¤ºçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æ–œæ æ‹¬èµ·æ¥ã€‚</p>
<p>awkè¯­è¨€çš„æœ€åŸºæœ¬åŠŸèƒ½æ˜¯åœ¨æ–‡ä»¶æˆ–è€…å­—ç¬¦ä¸²ä¸­åŸºäºæŒ‡å®šè§„åˆ™æµè§ˆå’ŒæŠ½å–ä¿¡æ¯ï¼ŒawkæŠ½å–ä¿¡æ¯åï¼Œæ‰èƒ½è¿›è¡Œå…¶ä»–æ–‡æœ¬æ“ä½œã€‚å®Œæ•´çš„awkè„šæœ¬é€šå¸¸ç”¨æ¥æ ¼å¼åŒ–æ–‡æœ¬æ–‡ä»¶ä¸­çš„ä¿¡æ¯ã€‚</p>
<p>é€šå¸¸ï¼Œawkæ˜¯ä»¥æ–‡ä»¶çš„ä¸€è¡Œä¸ºå¤„ç†å•ä½çš„ã€‚awkæ¯æ¥æ”¶æ–‡ä»¶çš„ä¸€è¡Œï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„å‘½ä»¤ï¼Œæ¥å¤„ç†æ–‡æœ¬ã€‚</p>
<h3 id="è°ƒç”¨awk"><a href="#è°ƒç”¨awk" class="headerlink" title="è°ƒç”¨awk"></a>è°ƒç”¨awk</h3><p>æœ‰ä¸‰ç§æ–¹å¼è°ƒç”¨awk</p>
<ol>
<li>å‘½ä»¤è¡Œæ–¹å¼<br>awk [-F  field-separator]  â€˜commandsâ€™  input-file(s)</li>
</ol>
<p>å…¶ä¸­ï¼Œcommands æ˜¯çœŸæ­£awkå‘½ä»¤ï¼Œ[-FåŸŸåˆ†éš”ç¬¦]æ˜¯å¯é€‰çš„ã€‚ input-file(s) æ˜¯å¾…å¤„ç†çš„æ–‡ä»¶ã€‚</p>
<p>åœ¨awkä¸­ï¼Œæ–‡ä»¶çš„æ¯ä¸€è¡Œä¸­ï¼Œç”±åŸŸåˆ†éš”ç¬¦åˆ†å¼€çš„æ¯ä¸€é¡¹ç§°ä¸ºä¸€ä¸ªåŸŸã€‚é€šå¸¸ï¼Œåœ¨ä¸æŒ‡å-FåŸŸåˆ†éš”ç¬¦çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„åŸŸåˆ†éš”ç¬¦æ˜¯ç©ºæ ¼ã€‚</p>
<ol start="2">
<li>shellè„šæœ¬æ–¹å¼</li>
</ol>
<p>å°†æ‰€æœ‰çš„awkå‘½ä»¤æ’å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä½¿awkç¨‹åºå¯æ‰§è¡Œï¼Œç„¶åawkå‘½ä»¤è§£é‡Šå™¨ä½œä¸ºè„šæœ¬çš„é¦–è¡Œï¼Œä¸€éé€šè¿‡é”®å…¥è„šæœ¬åç§°æ¥è°ƒç”¨ã€‚</p>
<p>ç›¸å½“äºshellè„šæœ¬é¦–è¡Œçš„ï¼š#!/bin/sh</p>
<p>å¯ä»¥æ¢æˆï¼š#!/bin/awk</p>
<ol start="3">
<li>å°†æ‰€æœ‰çš„awkå‘½ä»¤æ’å…¥ä¸€ä¸ªå•ç‹¬æ–‡ä»¶ï¼Œç„¶åè°ƒç”¨ï¼š<br>awk -f awk-script-file input-file(s)</li>
</ol>
<p>å…¶ä¸­ï¼Œ-fé€‰é¡¹åŠ è½½awk-script-fileä¸­çš„awkè„šæœ¬ï¼Œinput-file(s)è·Ÿä¸Šé¢çš„æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>æœ¬ç« é‡ç‚¹ä»‹ç»å‘½ä»¤è¡Œæ–¹å¼ã€‚</p>
<h3 id="å…¥é—¨å®ä¾‹"><a href="#å…¥é—¨å®ä¾‹" class="headerlink" title="å…¥é—¨å®ä¾‹"></a>å…¥é—¨å®ä¾‹</h3><p>å‡è®¾last -n 5çš„è¾“å‡ºå¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@www ~]# last -n 5 &lt;==ä»…å–å‡ºå‰äº”è¡Œ</span><br><span class="line">root     pts/1   192.168.1.100  Tue Feb 10 11:21   still logged in</span><br><span class="line">root     pts/1   192.168.1.100  Tue Feb 10 00:46 - 02:28  (01:41)</span><br><span class="line">root     pts/1   192.168.1.100  Mon Feb  9 11:41 - 18:30  (06:48)</span><br><span class="line">dmtsai   pts/1   192.168.1.100  Mon Feb  9 11:41 - 11:41  (00:00)</span><br><span class="line">root     tty1                   Fri Sep  5 14:09 - 14:10  (00:01)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœåªæ˜¯æ˜¾ç¤ºæœ€è¿‘ç™»å½•çš„5ä¸ªå¸å·</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">last -n 5 | awk  <span class="string">'&#123;print $1&#125;'</span></span></span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">dmtsai</span><br><span class="line">root</span><br></pre></td></tr></table></figure>
<p>awkå·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼šè¯»å…¥æœ‰â€™\nâ€™æ¢è¡Œç¬¦åˆ†å‰²çš„ä¸€æ¡è®°å½•ï¼Œç„¶åå°†è®°å½•æŒ‰æŒ‡å®šçš„åŸŸåˆ†éš”ç¬¦åˆ’åˆ†åŸŸï¼Œå¡«å……åŸŸï¼Œ$0åˆ™è¡¨ç¤ºæ‰€æœ‰åŸŸ,$1è¡¨ç¤ºç¬¬ä¸€ä¸ªåŸŸ,$nè¡¨ç¤ºç¬¬nä¸ªåŸŸã€‚é»˜è®¤åŸŸåˆ†éš”ç¬¦æ˜¯â€ç©ºç™½é”®â€ æˆ– â€œ[tab]é”®â€,æ‰€ä»¥$1è¡¨ç¤ºç™»å½•ç”¨æˆ·ï¼Œ$3è¡¨ç¤ºç™»å½•ç”¨æˆ·ip,ä»¥æ­¤ç±»æ¨ã€‚</p>
<p>å¦‚æœåªæ˜¯æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">cat /etc/passwd |awk  -F <span class="string">':'</span>  <span class="string">'&#123;print $1&#125;'</span>  </span></span><br><span class="line">root</span><br><span class="line">daemon</span><br><span class="line">bin</span><br><span class="line">sys</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ˜¯awk+actionçš„ç¤ºä¾‹ï¼Œæ¯è¡Œéƒ½ä¼šæ‰§è¡Œaction{print $1}ã€‚</p>
<p>-FæŒ‡å®šåŸŸåˆ†éš”ç¬¦ä¸ºâ€™:â€™ã€‚</p>
<p>å¦‚æœåªæ˜¯æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·å’Œè´¦æˆ·å¯¹åº”çš„shell,è€Œè´¦æˆ·ä¸shellä¹‹é—´ä»¥tabé”®åˆ†å‰²</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">cat /etc/passwd |awk  -F <span class="string">':'</span>  <span class="string">'&#123;print $1"\t"$7&#125;'</span></span></span><br><span class="line">root    /bin/bash</span><br><span class="line">daemon  /bin/sh</span><br><span class="line">bin     /bin/sh</span><br><span class="line">sys     /bin/sh</span><br></pre></td></tr></table></figure>


<p>å¦‚æœåªæ˜¯æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·å’Œè´¦æˆ·å¯¹åº”çš„shell,è€Œè´¦æˆ·ä¸shellä¹‹é—´ä»¥é€—å·åˆ†å‰²,è€Œä¸”åœ¨æ‰€æœ‰è¡Œæ·»åŠ åˆ—åname,shell,åœ¨æœ€åä¸€è¡Œæ·»åŠ â€blue,/bin/noshâ€ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd |awk  -F ':'  'BEGIN &#123;print "name,shell"&#125;  &#123;print $1","$7&#125; END &#123;print "blue,/bin/nosh"&#125;'</span><br><span class="line">name,shell</span><br><span class="line">root,/bin/bash</span><br><span class="line">daemon,/bin/sh</span><br><span class="line">bin,/bin/sh</span><br><span class="line">sys,/bin/sh</span><br><span class="line">....</span><br><span class="line">blue,/bin/nosh</span><br></pre></td></tr></table></figure>


<p>awkå·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼šå…ˆæ‰§è¡ŒBEGINGï¼Œç„¶åè¯»å–æ–‡ä»¶ï¼Œè¯»å…¥æœ‰/næ¢è¡Œç¬¦åˆ†å‰²çš„ä¸€æ¡è®°å½•ï¼Œç„¶åå°†è®°å½•æŒ‰æŒ‡å®šçš„åŸŸåˆ†éš”ç¬¦åˆ’åˆ†åŸŸï¼Œå¡«å……åŸŸï¼Œ$0åˆ™è¡¨ç¤ºæ‰€æœ‰åŸŸ,$1è¡¨ç¤ºç¬¬ä¸€ä¸ªåŸŸ,$nè¡¨ç¤ºç¬¬nä¸ªåŸŸ,éšåå¼€å§‹æ‰§è¡Œæ¨¡å¼æ‰€å¯¹åº”çš„åŠ¨ä½œactionã€‚æ¥ç€å¼€å§‹è¯»å…¥ç¬¬äºŒæ¡è®°å½•Â·Â·Â·Â·Â·Â·ç›´åˆ°æ‰€æœ‰çš„è®°å½•éƒ½è¯»å®Œï¼Œæœ€åæ‰§è¡ŒENDæ“ä½œã€‚</p>
<p>æœç´¢/etc/passwdæœ‰rootå…³é”®å­—çš„æ‰€æœ‰è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">awk -F: <span class="string">'/root/'</span> /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ˜¯patternçš„ä½¿ç”¨ç¤ºä¾‹ï¼ŒåŒ¹é…äº†pattern(è¿™é‡Œæ˜¯root)çš„è¡Œæ‰ä¼šæ‰§è¡Œaction(æ²¡æœ‰æŒ‡å®šactionï¼Œé»˜è®¤è¾“å‡ºæ¯è¡Œçš„å†…å®¹)ã€‚</p>
<p>æœç´¢æ”¯æŒæ­£åˆ™ï¼Œä¾‹å¦‚æ‰¾rootå¼€å¤´çš„: awk -F: â€˜/^root/â€˜ /etc/passwd</p>
<p>æœç´¢/etc/passwdæœ‰rootå…³é”®å­—çš„æ‰€æœ‰è¡Œï¼Œå¹¶æ˜¾ç¤ºå¯¹åº”çš„shell</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> awk -F: <span class="string">'/root/&#123;print $7&#125;'</span> /etc/passwd             </span></span><br><span class="line">/bin/bash</span><br></pre></td></tr></table></figure>

<p>è¿™é‡ŒæŒ‡å®šäº†action{print $7}</p>
<h3 id="awkå†…ç½®å˜é‡"><a href="#awkå†…ç½®å˜é‡" class="headerlink" title="awkå†…ç½®å˜é‡"></a>awkå†…ç½®å˜é‡</h3><p>awkæœ‰è®¸å¤šå†…ç½®å˜é‡ç”¨æ¥è®¾ç½®ç¯å¢ƒä¿¡æ¯ï¼Œè¿™äº›å˜é‡å¯ä»¥è¢«æ”¹å˜ï¼Œä¸‹é¢ç»™å‡ºäº†æœ€å¸¸ç”¨çš„ä¸€äº›å˜é‡ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ARGC               å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°</span><br><span class="line">ARGV               å‘½ä»¤è¡Œå‚æ•°æ’åˆ—</span><br><span class="line">ENVIRON            æ”¯æŒé˜Ÿåˆ—ä¸­ç³»ç»Ÿç¯å¢ƒå˜é‡çš„ä½¿ç”¨</span><br><span class="line">FILENAME           awkæµè§ˆçš„æ–‡ä»¶å</span><br><span class="line">FNR                æµè§ˆæ–‡ä»¶çš„è®°å½•æ•°</span><br><span class="line">FS                 è®¾ç½®è¾“å…¥åŸŸåˆ†éš”ç¬¦ï¼Œç­‰ä»·äºå‘½ä»¤è¡Œ -Fé€‰é¡¹</span><br><span class="line">NF                 æµè§ˆè®°å½•çš„åŸŸçš„ä¸ªæ•°</span><br><span class="line">NR                 å·²è¯»çš„è®°å½•æ•°</span><br><span class="line">OFS                è¾“å‡ºåŸŸåˆ†éš”ç¬¦</span><br><span class="line">ORS                è¾“å‡ºè®°å½•åˆ†éš”ç¬¦</span><br><span class="line">RS                 æ§åˆ¶è®°å½•åˆ†éš”ç¬¦</span><br></pre></td></tr></table></figure>



<p>æ­¤å¤–,$0å˜é‡æ˜¯æŒ‡æ•´æ¡è®°å½•ã€‚$1è¡¨ç¤ºå½“å‰è¡Œçš„ç¬¬ä¸€ä¸ªåŸŸ,$2è¡¨ç¤ºå½“å‰è¡Œçš„ç¬¬äºŒä¸ªåŸŸ,â€¦â€¦ä»¥æ­¤ç±»æ¨ã€‚</p>
<p>ç»Ÿè®¡/etc/passwd:æ–‡ä»¶åï¼Œæ¯è¡Œçš„è¡Œå·ï¼Œæ¯è¡Œçš„åˆ—æ•°ï¼Œå¯¹åº”çš„å®Œæ•´è¡Œå†…å®¹:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">awk  -F <span class="string">':'</span>  <span class="string">'&#123;print "filename:" FILENAME ",linenumber:" NR ",columns:" NF ",linecontent:"$0&#125;'</span> /etc/passwd</span></span><br><span class="line">filename:/etc/passwd,linenumber:1,columns:7,linecontent:root:x:0:0:root:/root:/bin/bash</span><br><span class="line">filename:/etc/passwd,linenumber:2,columns:7,linecontent:daemon:x:1:1:daemon:/usr/sbin:/bin/sh</span><br><span class="line">filename:/etc/passwd,linenumber:3,columns:7,linecontent:bin:x:2:2:bin:/bin:/bin/sh</span><br><span class="line">filename:/etc/passwd,linenumber:4,columns:7,linecontent:sys:x:3:3:sys:/dev:/bin/sh</span><br></pre></td></tr></table></figure>


<p>ä½¿ç”¨printfæ›¿ä»£print,å¯ä»¥è®©ä»£ç æ›´åŠ ç®€æ´ï¼Œæ˜“è¯»</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">awk  -F ':'  '&#123;printf("filename:%10s,linenumber:%s,columns:%s,linecontent:%s\n",FILENAME,NR,NF,$0)&#125;' /etc/passwd</span><br></pre></td></tr></table></figure>

<h3 id="printå’Œprintf"><a href="#printå’Œprintf" class="headerlink" title="printå’Œprintf"></a>printå’Œprintf</h3><p>awkä¸­åŒæ—¶æä¾›äº†printå’Œprintfä¸¤ç§æ‰“å°è¾“å‡ºçš„å‡½æ•°ã€‚</p>
<p>å…¶ä¸­printå‡½æ•°çš„å‚æ•°å¯ä»¥æ˜¯å˜é‡ã€æ•°å€¼æˆ–è€…å­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²å¿…é¡»ç”¨åŒå¼•å·å¼•ç”¨ï¼Œå‚æ•°ç”¨é€—å·åˆ†éš”ã€‚å¦‚æœæ²¡æœ‰é€—å·ï¼Œå‚æ•°å°±ä¸²è”åœ¨ä¸€èµ·è€Œæ— æ³•åŒºåˆ†ã€‚è¿™é‡Œï¼Œé€—å·çš„ä½œç”¨ä¸è¾“å‡ºæ–‡ä»¶çš„åˆ†éš”ç¬¦çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯åè€…æ˜¯ç©ºæ ¼è€Œå·²ã€‚</p>
<p>printfå‡½æ•°ï¼Œå…¶ç”¨æ³•å’Œcè¯­è¨€ä¸­printfåŸºæœ¬ç›¸ä¼¼,å¯ä»¥æ ¼å¼åŒ–å­—ç¬¦ä¸²,è¾“å‡ºå¤æ‚æ—¶ï¼Œprintfæ›´åŠ å¥½ç”¨ï¼Œä»£ç æ›´æ˜“æ‡‚ã€‚</p>
<h3 id="awkç¼–ç¨‹"><a href="#awkç¼–ç¨‹" class="headerlink" title="awkç¼–ç¨‹"></a>awkç¼–ç¨‹</h3><h4 id="å˜é‡å’Œèµ‹å€¼"><a href="#å˜é‡å’Œèµ‹å€¼" class="headerlink" title="å˜é‡å’Œèµ‹å€¼"></a>å˜é‡å’Œèµ‹å€¼</h4><p>é™¤äº†awkçš„å†…ç½®å˜é‡ï¼Œawkè¿˜å¯ä»¥è‡ªå®šä¹‰å˜é‡ã€‚</p>
<p>ä¸‹é¢ç»Ÿè®¡/etc/passwdçš„è´¦æˆ·äººæ•°</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">awk '&#123;count++;print $0;&#125; END&#123;print "user count is ", count&#125;' /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">......</span><br><span class="line">user count is  40</span><br></pre></td></tr></table></figure>
<p>countæ˜¯è‡ªå®šä¹‰å˜é‡ã€‚ä¹‹å‰çš„action{}é‡Œéƒ½æ˜¯åªæœ‰ä¸€ä¸ªprint,å…¶å®printåªæ˜¯ä¸€ä¸ªè¯­å¥ï¼Œè€Œaction{}å¯ä»¥æœ‰å¤šä¸ªè¯­å¥ï¼Œä»¥;å·éš”å¼€ã€‚</p>
<p>è¿™é‡Œæ²¡æœ‰åˆå§‹åŒ–countï¼Œè™½ç„¶é»˜è®¤æ˜¯0ï¼Œä½†æ˜¯å¦¥å½“çš„åšæ³•è¿˜æ˜¯åˆå§‹åŒ–ä¸º0:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">awk 'BEGIN &#123;count=0;print "[start]user count is ", count&#125; &#123;count=count+1;print $0;&#125; END&#123;print "[end]user count is ", count&#125;' /etc/passwd</span><br><span class="line">[start]user count is  0</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">...</span><br><span class="line">[end]user count is  40</span><br></pre></td></tr></table></figure>

<p>ç»Ÿè®¡æŸä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶å ç”¨çš„å­—èŠ‚æ•°</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls -l |awk 'BEGIN &#123;size=0;&#125; &#123;size=size+$5;&#125; END&#123;print "[end]size is ", size&#125;'</span><br><span class="line">[end]size is  8657198</span><br></pre></td></tr></table></figure>


<p>å¦‚æœä»¥Mä¸ºå•ä½æ˜¾ç¤º:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls -l |awk 'BEGIN &#123;size=0;&#125; &#123;size=size+$5;&#125; END&#123;print "[end]size is ", size/1024/1024,"M"&#125;'</span><br><span class="line">[end]size is  8.25889 M</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œç»Ÿè®¡ä¸åŒ…æ‹¬æ–‡ä»¶å¤¹çš„å­ç›®å½•ã€‚</p>
<h4 id="æ¡ä»¶è¯­å¥"><a href="#æ¡ä»¶è¯­å¥" class="headerlink" title="æ¡ä»¶è¯­å¥"></a>æ¡ä»¶è¯­å¥</h4><p>awkä¸­çš„æ¡ä»¶è¯­å¥æ˜¯ä»Cè¯­è¨€ä¸­å€Ÿé‰´æ¥çš„ï¼Œè§å¦‚ä¸‹å£°æ˜æ–¹å¼ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if (expression) &#123;</span><br><span class="line">    statement;</span><br><span class="line">    statement;</span><br><span class="line">    ... ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (expression) &#123;</span><br><span class="line">    statement;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    statement2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (expression) &#123;</span><br><span class="line">    statement1;</span><br><span class="line">&#125; else if (expression1) &#123;</span><br><span class="line">    statement2;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    statement3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>ç»Ÿè®¡æŸä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶å ç”¨çš„å­—èŠ‚æ•°,è¿‡æ»¤4096å¤§å°çš„æ–‡ä»¶(ä¸€èˆ¬éƒ½æ˜¯æ–‡ä»¶å¤¹):</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls -l |awk 'BEGIN &#123;size=0;print "[start]size is ", size&#125; &#123;if($5!=4096)&#123;size=size+$5;&#125;&#125; END&#123;print "[end]size is ", size/1024/1024,"M"&#125;'</span><br><span class="line">[end]size is  8.22339 M</span><br></pre></td></tr></table></figure>


<h4 id="å¾ªç¯è¯­å¥"><a href="#å¾ªç¯è¯­å¥" class="headerlink" title="å¾ªç¯è¯­å¥"></a>å¾ªç¯è¯­å¥</h4><p>awkä¸­çš„å¾ªç¯è¯­å¥åŒæ ·å€Ÿé‰´äºCè¯­è¨€ï¼Œæ”¯æŒwhileã€do/whileã€forã€breakã€continueï¼Œè¿™äº›å…³é”®å­—çš„è¯­ä¹‰å’ŒCè¯­è¨€ä¸­çš„è¯­ä¹‰å®Œå…¨ç›¸åŒã€‚</p>
<h4 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h4><p>å› ä¸ºawkä¸­æ•°ç»„çš„ä¸‹æ ‡å¯ä»¥æ˜¯æ•°å­—å’Œå­—æ¯ï¼Œæ•°ç»„çš„ä¸‹æ ‡é€šå¸¸è¢«ç§°ä¸ºå…³é”®å­—(key)ã€‚å€¼å’Œå…³é”®å­—éƒ½å­˜å‚¨åœ¨å†…éƒ¨çš„ä¸€å¼ é’ˆå¯¹key/valueåº”ç”¨hashçš„è¡¨æ ¼é‡Œã€‚ç”±äºhashä¸æ˜¯é¡ºåºå­˜å‚¨ï¼Œå› æ­¤åœ¨æ˜¾ç¤ºæ•°ç»„å†…å®¹æ—¶ä¼šå‘ç°ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯æŒ‰ç…§ä½ é¢„æ–™çš„é¡ºåºæ˜¾ç¤ºå‡ºæ¥çš„ã€‚æ•°ç»„å’Œå˜é‡ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨ä½¿ç”¨æ—¶è‡ªåŠ¨åˆ›å»ºçš„ï¼Œawkä¹ŸåŒæ ·ä¼šè‡ªåŠ¨åˆ¤æ–­å…¶å­˜å‚¨çš„æ˜¯æ•°å­—è¿˜æ˜¯å­—ç¬¦ä¸²ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œawkä¸­çš„æ•°ç»„ç”¨æ¥ä»è®°å½•ä¸­æ”¶é›†ä¿¡æ¯ï¼Œå¯ä»¥ç”¨äºè®¡ç®—æ€»å’Œã€ç»Ÿè®¡å•è¯ä»¥åŠè·Ÿè¸ªæ¨¡æ¿è¢«åŒ¹é…çš„æ¬¡æ•°ç­‰ç­‰ã€‚</p>
<p>æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">awk -F ':' 'BEGIN &#123;count=0;&#125; &#123;name[count] = $1;count++;&#125;; END&#123;for (i = 0; i &lt; NR; i++) print i, name[i]&#125;' /etc/passwd</span><br><span class="line">0 root</span><br><span class="line">1 daemon</span><br><span class="line">2 bin</span><br><span class="line">3 sys</span><br><span class="line">4 sync</span><br><span class="line">5 games</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä½¿ç”¨forå¾ªç¯éå†æ•°ç»„</p>
<p>awkç¼–ç¨‹çš„å†…å®¹æå¤šï¼Œè¿™é‡Œåªç½—åˆ—ç®€å•å¸¸ç”¨çš„ç”¨æ³•ï¼Œæ›´å¤šè¯·å‚è€ƒ <a href="http://www.gnu.org/software/gawk/manual/gawk.html" target="_blank" rel="noopener">http://www.gnu.org/software/gawk/manual/gawk.html</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>LinuxShellè„šæœ¬æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxShellè„šæœ¬</tag>
      </tags>
  </entry>
  <entry>
    <title>LINUX Shell Scripts ç¬¬äº”è¯¾ å„ç§æ‹¬å·çš„ä½œç”¨</title>
    <url>/2016/12/23/booboo_bash_shell_scripts/04_shell_brackets/</url>
    <content><![CDATA[<h3 id="ä¸€ã€å°æ‹¬å·-åœ†æ‹¬å·"><a href="#ä¸€ã€å°æ‹¬å·-åœ†æ‹¬å·" class="headerlink" title="ä¸€ã€å°æ‹¬å·,åœ†æ‹¬å·()"></a>ä¸€ã€å°æ‹¬å·,åœ†æ‹¬å·()</h3><h4 id="1ã€å•å°æ‹¬å·"><a href="#1ã€å•å°æ‹¬å·" class="headerlink" title="1ã€å•å°æ‹¬å· ()"></a>1ã€å•å°æ‹¬å· ()</h4><p>1 å‘½ä»¤ç»„ã€‚æ‹¬å·ä¸­çš„å‘½ä»¤å°†ä¼šæ–°å¼€ä¸€ä¸ªå­shellé¡ºåºæ‰§è¡Œ,æ‰€ä»¥æ‹¬å·ä¸­çš„å˜é‡ä¸èƒ½å¤Ÿè¢«è„šæœ¬ä½™ä¸‹çš„éƒ¨åˆ†ä½¿ç”¨ã€‚æ‹¬å·ä¸­å¤šä¸ªå‘½ä»¤ä¹‹é—´ç”¨åˆ†å·éš”å¼€,æœ€åä¸€ä¸ªå‘½ä»¤å¯ä»¥æ²¡æœ‰åˆ†å·,å„å‘½ä»¤å’Œæ‹¬å·ä¹‹é—´ä¸å¿…æœ‰ç©ºæ ¼ã€‚</p>
<p>2 å‘½ä»¤æ›¿æ¢ã€‚ç­‰åŒäº<code>cmd</code>,shellæ‰«æä¸€éå‘½ä»¤è¡Œ,å‘ç°äº†$(cmd)ç»“æ„,ä¾¿å°†$(cmd)ä¸­çš„cmdæ‰§è¡Œä¸€æ¬¡,å¾—åˆ°å…¶æ ‡å‡†è¾“å‡º,å†å°†æ­¤è¾“å‡ºæ”¾åˆ°åŸæ¥å‘½ä»¤ã€‚æœ‰äº›shellä¸æ”¯æŒ,å¦‚tcshã€‚</p>
<p>3 ç”¨äºåˆå§‹åŒ–æ•°ç»„ã€‚å¦‚:array=(a b c d)</p>
<h4 id="2ã€åŒå°æ‹¬å·"><a href="#2ã€åŒå°æ‹¬å·" class="headerlink" title="2ã€åŒå°æ‹¬å· (( ))"></a>2ã€åŒå°æ‹¬å· (( ))</h4><p>1 æ•´æ•°æ‰©å±•ã€‚è¿™ç§æ‰©å±•è®¡ç®—æ˜¯æ•´æ•°å‹çš„è®¡ç®—,ä¸æ”¯æŒæµ®ç‚¹å‹ã€‚((exp))ç»“æ„æ‰©å±•å¹¶è®¡ç®—ä¸€ä¸ªç®—æœ¯è¡¨è¾¾å¼çš„å€¼,å¦‚æœè¡¨è¾¾å¼çš„ç»“æœä¸º0,é‚£ä¹ˆè¿”å›çš„é€€å‡ºçŠ¶æ€ç ä¸º1,æˆ–è€… æ˜¯â€å‡â€,è€Œä¸€ä¸ªéé›¶å€¼çš„è¡¨è¾¾å¼æ‰€è¿”å›çš„é€€å‡ºçŠ¶æ€ç å°†ä¸º0,æˆ–è€…æ˜¯â€trueâ€ã€‚è‹¥æ˜¯é€»è¾‘åˆ¤æ–­,è¡¨è¾¾å¼expä¸ºçœŸåˆ™ä¸º1,å‡åˆ™ä¸º0ã€‚</p>
<p>2 åªè¦æ‹¬å·ä¸­çš„è¿ç®—ç¬¦ã€è¡¨è¾¾å¼ç¬¦åˆCè¯­è¨€è¿ç®—è§„åˆ™,éƒ½å¯ç”¨åœ¨$((exp))ä¸­,ç”šè‡³æ˜¯ä¸‰ç›®è¿ç®—ç¬¦ã€‚ä½œä¸åŒè¿›ä½(å¦‚äºŒè¿›åˆ¶ã€å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶)è¿ç®—æ—¶,è¾“å‡ºç»“æœå…¨éƒ½è‡ªåŠ¨è½¬åŒ–æˆäº†åè¿›åˆ¶ã€‚å¦‚:echo $((16#5f)) ç»“æœä¸º95(16è¿›ä½è½¬åè¿›åˆ¶)</p>
<p>3 å•çº¯ç”¨ (( )) ä¹Ÿå¯é‡å®šä¹‰å˜é‡å€¼,æ¯”å¦‚ a=5; ((a++)) å¯å°† $a é‡å®šä¹‰ä¸º6</p>
<p>4 å¸¸ç”¨äºç®—æœ¯è¿ç®—æ¯”è¾ƒ,åŒæ‹¬å·ä¸­çš„å˜é‡å¯ä»¥ä¸ä½¿ç”¨$ç¬¦å·å‰ç¼€ã€‚æ‹¬å·å†…æ”¯æŒå¤šä¸ªè¡¨è¾¾å¼ç”¨é€—å·åˆ†å¼€ã€‚ åªè¦æ‹¬å·ä¸­çš„è¡¨è¾¾å¼ç¬¦åˆCè¯­è¨€è¿ç®—è§„åˆ™,æ¯”å¦‚å¯ä»¥ç›´æ¥ä½¿ç”¨for((i=0;i&lt;5;i++)), å¦‚æœä¸ä½¿ç”¨åŒæ‹¬å·, åˆ™ä¸ºfor i in <code>seq 04</code>æˆ–è€…for i in {0..4}ã€‚å†å¦‚å¯ä»¥ç›´æ¥ä½¿ç”¨if (($i&lt;5)), å¦‚æœä¸ä½¿ç”¨åŒæ‹¬å·, åˆ™ä¸ºif [ $i -lt 5 ]ã€‚</p>
<h3 id="äºŒã€ä¸­æ‹¬å·-æ–¹æ‹¬å·"><a href="#äºŒã€ä¸­æ‹¬å·-æ–¹æ‹¬å·" class="headerlink" title="äºŒã€ä¸­æ‹¬å·,æ–¹æ‹¬å·[]"></a>äºŒã€ä¸­æ‹¬å·,æ–¹æ‹¬å·[]</h3><h4 id="1ã€å•ä¸­æ‹¬å·"><a href="#1ã€å•ä¸­æ‹¬å·" class="headerlink" title="1ã€å•ä¸­æ‹¬å· []"></a>1ã€å•ä¸­æ‹¬å· []</h4><p>1 bash çš„å†…éƒ¨å‘½ä»¤,[å’Œtestæ˜¯ç­‰åŒçš„ã€‚å¦‚æœæˆ‘ä»¬ä¸ç”¨ç»å¯¹è·¯å¾„æŒ‡æ˜,é€šå¸¸æˆ‘ä»¬ç”¨çš„éƒ½æ˜¯bashè‡ªå¸¦çš„å‘½ä»¤ã€‚if/testç»“æ„ä¸­çš„å·¦ä¸­æ‹¬å·æ˜¯è°ƒç”¨testçš„å‘½ä»¤æ ‡è¯†,å³ä¸­æ‹¬å·æ˜¯å…³é—­æ¡ä»¶åˆ¤æ–­çš„ã€‚è¿™ä¸ªå‘½ä»¤æŠŠå®ƒçš„å‚æ•°ä½œä¸ºæ¯”è¾ƒè¡¨è¾¾å¼æˆ–è€…ä½œä¸ºæ–‡ä»¶æµ‹è¯•,å¹¶ä¸”æ ¹æ®æ¯”è¾ƒçš„ç»“æœæ¥è¿”å›ä¸€ä¸ªé€€å‡ºçŠ¶æ€ç ã€‚if/testç»“æ„ä¸­å¹¶ä¸æ˜¯å¿…é¡»å³ä¸­æ‹¬å·,ä½†æ˜¯æ–°ç‰ˆçš„Bashä¸­è¦æ±‚å¿…é¡»è¿™æ ·ã€‚</p>
<p>2 Testå’Œ[]ä¸­å¯ç”¨çš„æ¯”è¾ƒè¿ç®—ç¬¦åªæœ‰==å’Œ!=,ä¸¤è€…éƒ½æ˜¯ç”¨äºå­—ç¬¦ä¸²æ¯”è¾ƒçš„,ä¸å¯ç”¨äºæ•´æ•°æ¯”è¾ƒ,æ•´æ•°æ¯”è¾ƒåªèƒ½ä½¿ç”¨-eq,-gtè¿™ç§å½¢å¼ã€‚æ— è®ºæ˜¯å­—ç¬¦ä¸²æ¯”è¾ƒè¿˜æ˜¯æ•´æ•°æ¯”è¾ƒéƒ½ä¸æ”¯æŒå¤§äºå·å°äºå·ã€‚å¦‚æœå®åœ¨æƒ³ç”¨,å¯¹äºå­—ç¬¦ä¸²æ¯”è¾ƒå¯ä»¥ä½¿ç”¨è½¬ä¹‰å½¢å¼,å¦‚æœæ¯”è¾ƒâ€abâ€å’Œâ€bcâ€:[ ab &lt; bc ],ç»“æœä¸ºçœŸ,ä¹Ÿå°±æ˜¯è¿”å›çŠ¶æ€ä¸º0ã€‚[ ]ä¸­çš„é€»è¾‘ä¸å’Œé€»è¾‘æˆ–ä½¿ç”¨-a å’Œ-o è¡¨ç¤ºã€‚</p>
<p>3 å­—ç¬¦èŒƒå›´ã€‚ç”¨ä½œæ­£åˆ™è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†,æè¿°ä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦èŒƒå›´ã€‚ä½œä¸ºtestç”¨é€”çš„ä¸­æ‹¬å·å†…ä¸èƒ½ä½¿ç”¨æ­£åˆ™ã€‚</p>
<p>4 åœ¨ä¸€ä¸ªarray ç»“æ„çš„ä¸Šä¸‹æ–‡ä¸­,ä¸­æ‹¬å·ç”¨æ¥å¼•ç”¨æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„ç¼–å·ã€‚</p>
<h4 id="2ã€åŒä¸­æ‹¬å·"><a href="#2ã€åŒä¸­æ‹¬å·" class="headerlink" title="2ã€åŒä¸­æ‹¬å·[[ ]]"></a>2ã€åŒä¸­æ‹¬å·[[ ]]</h4><p>1 [[æ˜¯ bash ç¨‹åºè¯­è¨€çš„å…³é”®å­—ã€‚å¹¶ä¸æ˜¯ä¸€ä¸ªå‘½ä»¤,[[ ]] ç»“æ„æ¯”[ ]ç»“æ„æ›´åŠ é€šç”¨ã€‚åœ¨[[å’Œ]]ä¹‹é—´æ‰€æœ‰çš„å­—ç¬¦éƒ½ä¸ä¼šå‘ç”Ÿæ–‡ä»¶åæ‰©å±•æˆ–è€…å•è¯åˆ†å‰²,ä½†æ˜¯ä¼šå‘ç”Ÿå‚æ•°æ‰©å±•å’Œå‘½ä»¤æ›¿æ¢ã€‚</p>
<p>2 æ”¯æŒå­—ç¬¦ä¸²çš„æ¨¡å¼åŒ¹é…,ä½¿ç”¨=~æ“ä½œç¬¦æ—¶ç”šè‡³æ”¯æŒshellçš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å­—ç¬¦ä¸²æ¯”è¾ƒæ—¶å¯ä»¥æŠŠå³è¾¹çš„ä½œä¸ºä¸€shellä¸­å„ç§æ‹¬å·çš„ä½œç”¨()ã€ä¸ªæ¨¡å¼,è€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,æ¯”å¦‚[[ hello == hell? ]],ç»“æœä¸ºçœŸã€‚[[ ]] ä¸­åŒ¹é…å­—ç¬¦ä¸²æˆ–é€šé…ç¬¦,ä¸éœ€è¦å¼•å·ã€‚</p>
<p>3 ä½¿ç”¨[[ â€¦ ]]æ¡ä»¶åˆ¤æ–­ç»“æ„,è€Œä¸æ˜¯[ â€¦ ],èƒ½å¤Ÿé˜²æ­¢è„šæœ¬ä¸­çš„è®¸å¤šé€»è¾‘é”™è¯¯ã€‚æ¯”å¦‚,&amp;&amp;ã€||ã€&lt;å’Œ&gt; æ“ä½œç¬¦èƒ½linux shellä¸‹é™¤äº†æŸä¸ªæ–‡ä»¶å¤–çš„å…¶ä»–æ–‡ä»¶å…¨éƒ¨åˆ é™¤å¤Ÿæ­£å¸¸å­˜åœ¨äº[[ ]]æ¡ä»¶åˆ¤æ–­ç»“æ„ä¸­,ä½†æ˜¯å¦‚æœå‡ºç°åœ¨[ ]ç»“æ„ä¸­çš„è¯,ä¼šæŠ¥é”™ã€‚æ¯”å¦‚å¯ä»¥ç›´æ¥ä½¿ç”¨if [[ $a != 1 &amp;&amp;$a != 2 ]], å¦‚æœä¸é€‚ç”¨åŒæ‹¬å·, åˆ™ä¸ºif [ $a -ne 1] &amp;&amp; [ $a != 2 ]æˆ–è€…if [ $a -ne 1 -a $a != 2 ]ã€‚</p>
<p>4 bashæŠŠåŒä¸­æ‹¬å·ä¸­çš„è¡¨è¾¾å¼çœ‹ä½œä¸€ä¸ªå•ç‹¬çš„å…ƒç´ ,å¹¶è¿”å›ä¸€ä¸ªé€€å‡ºçŠ¶æ€ç ã€‚</p>
<h3 id="ä¸‰ã€å¤§æ‹¬å·ã€èŠ±æ‹¬å·"><a href="#ä¸‰ã€å¤§æ‹¬å·ã€èŠ±æ‹¬å·" class="headerlink" title="ä¸‰ã€å¤§æ‹¬å·ã€èŠ±æ‹¬å· {}"></a>ä¸‰ã€å¤§æ‹¬å·ã€èŠ±æ‹¬å· {}</h3><h4 id="1ã€å¸¸è§„ç”¨æ³•"><a href="#1ã€å¸¸è§„ç”¨æ³•" class="headerlink" title="1ã€å¸¸è§„ç”¨æ³•"></a>1ã€å¸¸è§„ç”¨æ³•</h4><p>1 å¤§æ‹¬å·æ‹“å±•ã€‚(é€šé…(globbing))å°†å¯¹å¤§æ‹¬å·ä¸­çš„æ–‡ä»¶ååšæ‰©å±•ã€‚åœ¨å¤§æ‹¬å·ä¸­,ä¸å…è®¸æœ‰ç©ºç™½,é™¤éè¿™ä¸ªç©ºç™½è¢«å¼•ç”¨æˆ–è½¬ä¹‰ã€‚ç¬¬ä¸€ç§:å¯¹å¤§æ‹¬å·ä¸­çš„ä»¥é€—å·åˆ†å‰²çš„æ–‡ä»¶åˆ—è¡¨è¿›è¡Œæ‹“å±•ã€‚å¦‚ touch {a,b}.txt ç»“æœä¸ºa.txt b.txtã€‚ç¬¬äºŒç§:å¯¹å¤§æ‹¬å·ä¸­ä»¥ç‚¹ç‚¹(..)åˆ†å‰²çš„é¡ºåºæ–‡ä»¶åˆ—è¡¨èµ·æ‹“å±•ä½œç”¨,å¦‚:touch {a..d}.txt ç»“æœä¸ºa.txt b.txt c.txtd.txt</p>
<p>2 ä»£ç å—,åˆè¢«ç§°ä¸ºå†…éƒ¨ç»„,è¿™ä¸ªç»“æ„äº‹å®ä¸Šåˆ›å»ºäº†ä¸€ä¸ªåŒ¿åå‡½æ•° ã€‚ä¸å°æ‹¬å·ä¸­çš„å‘½ä»¤ä¸åŒ,å¤§æ‹¬å·å†…çš„å‘½ä»¤ä¸ä¼šæ–°å¼€ä¸€ä¸ªå­shellè¿è¡Œ,å³è„šæœ¬ä½™ä¸‹éƒ¨åˆ†ä»å¯ä½¿ç”¨æ‹¬å·å†…å˜é‡ã€‚æ‹¬å·å†…çš„å‘½ä»¤é—´ç”¨åˆ†å·éš”å¼€,æœ€åä¸€ä¸ªä¹Ÿå¿…é¡»æœ‰åˆ†å·ã€‚{}çš„ç¬¬ä¸€ä¸ªå‘½ä»¤å’Œå·¦æ‹¬å·ä¹‹é—´å¿…é¡»è¦æœ‰ä¸€ä¸ªç©ºæ ¼</p>
<h4 id="2ã€å‡ ç§ç‰¹æ®Šçš„æ›¿æ¢ç»“æ„"><a href="#2ã€å‡ ç§ç‰¹æ®Šçš„æ›¿æ¢ç»“æ„" class="headerlink" title="2ã€å‡ ç§ç‰¹æ®Šçš„æ›¿æ¢ç»“æ„"></a>2ã€å‡ ç§ç‰¹æ®Šçš„æ›¿æ¢ç»“æ„</h4><p>${var:-string},${var:+string},${var:=string},${var:?string}</p>
<p>1 ${var:-string}å’Œ${var:=string}:è‹¥å˜é‡varä¸ºç©º,åˆ™ç”¨åœ¨å‘½ä»¤è¡Œä¸­ç”¨stringæ¥æ›¿æ¢${var:-string},å¦åˆ™å˜é‡varä¸ä¸ºç©ºæ—¶,åˆ™ç”¨å˜é‡varçš„å€¼æ¥æ›¿æ¢${var:-string};å¯¹äº${var:=string}çš„æ›¿æ¢è§„åˆ™å’Œ${var:-string}æ˜¯ä¸€æ ·çš„,æ‰€ä¸åŒä¹‹å¤„æ˜¯${var:=string}è‹¥varä¸ºç©ºæ—¶,ç”¨stringæ›¿æ¢${var:=string}çš„åŒæ—¶,æŠŠstringèµ‹ç»™å˜é‡var:${var:=string}å¾ˆå¸¸ç”¨çš„ä¸€ç§ç”¨æ³•æ˜¯,åˆ¤æ–­æŸä¸ªå˜é‡æ˜¯å¦èµ‹å€¼,æ²¡æœ‰çš„è¯åˆ™ç»™å®ƒèµ‹ä¸Šä¸€ä¸ªé»˜è®¤å€¼ã€‚</p>
<p>2 ${var:+string}çš„æ›¿æ¢è§„åˆ™å’Œä¸Šé¢çš„ç›¸å,å³åªæœ‰å½“varä¸æ˜¯ç©ºçš„æ—¶å€™æ‰æ›¿æ¢æˆstring,è‹¥varä¸ºç©ºæ—¶åˆ™ä¸æ›¿æ¢æˆ–è€…è¯´æ˜¯æ›¿æ¢æˆå˜é‡ varçš„å€¼,å³ç©ºå€¼ã€‚(å› ä¸ºå˜é‡varæ­¤æ—¶ä¸ºç©º,æ‰€ä»¥è¿™ä¸¤ç§è¯´æ³•æ˜¯ç­‰ä»·çš„)</p>
<p>3 ${var:?string}æ›¿æ¢è§„åˆ™ä¸º:è‹¥å˜é‡varä¸ä¸ºç©º,åˆ™ç”¨å˜é‡varçš„å€¼æ¥æ›¿æ¢${var:?string};è‹¥å˜é‡varä¸ºç©º,åˆ™æŠŠstringè¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯ä¸­,å¹¶ä»è„šæœ¬ä¸­é€€å‡ºã€‚æˆ‘ä»¬å¯åˆ©ç”¨æ­¤ç‰¹æ€§æ¥æ£€æŸ¥æ˜¯å¦è®¾ç½®äº†å˜é‡çš„å€¼ã€‚</p>
<p>è¡¥å……æ‰©å±•:åœ¨ä¸Šé¢è¿™äº”ç§æ›¿æ¢ç»“æ„ä¸­stringä¸ä¸€å®šæ˜¯å¸¸å€¼çš„,å¯ç”¨å¦å¤–ä¸€ä¸ªå˜é‡çš„å€¼æˆ–æ˜¯ä¸€ç§å‘½ä»¤çš„è¾“å‡ºã€‚</p>
<h4 id="3ã€å››ç§æ¨¡å¼åŒ¹é…æ›¿æ¢ç»“æ„"><a href="#3ã€å››ç§æ¨¡å¼åŒ¹é…æ›¿æ¢ç»“æ„" class="headerlink" title="3ã€å››ç§æ¨¡å¼åŒ¹é…æ›¿æ¢ç»“æ„"></a>3ã€å››ç§æ¨¡å¼åŒ¹é…æ›¿æ¢ç»“æ„</h4><p>æ¨¡å¼åŒ¹é…è®°å¿†æ–¹æ³•:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å»æ‰å·¦è¾¹(åœ¨é”®ç›˜ä¸Š<span class="comment">#åœ¨$ä¹‹å·¦è¾¹)</span></span></span><br><span class="line"><span class="meta">%</span><span class="bash"> æ˜¯å»æ‰å³è¾¹(åœ¨é”®ç›˜ä¸Š%åœ¨$ä¹‹å³è¾¹)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">å’Œ%ä¸­çš„å•ä¸€ç¬¦å·æ˜¯æœ€å°åŒ¹é…,ä¸¤ä¸ªç›¸åŒç¬¦å·æ˜¯æœ€å¤§åŒ¹é…ã€‚</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;var%pattern&#125;,<span class="variable">$&#123;var%%pattern&#125;</span>,<span class="variable">$&#123;var#pattern&#125;</span>,<span class="variable">$&#123;var##pattern&#125;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="4ã€å­—ç¬¦ä¸²æå–å’Œæ›¿æ¢"><a href="#4ã€å­—ç¬¦ä¸²æå–å’Œæ›¿æ¢" class="headerlink" title="4ã€å­—ç¬¦ä¸²æå–å’Œæ›¿æ¢"></a>4ã€å­—ç¬¦ä¸²æå–å’Œæ›¿æ¢</h4><p>${var:num},${var:num1:num2},${var/pattern/pattern},${var//pattern/pattern}</p>
<ul>
<li>ç¬¬ä¸€ç§æ¨¡å¼:${var:num},è¿™ç§æ¨¡å¼æ—¶,shellåœ¨varä¸­æå–ç¬¬numä¸ªå­—ç¬¦åˆ°æœ«å°¾çš„æ‰€æœ‰å­—ç¬¦ã€‚è‹¥numä¸ºæ­£æ•°,ä»å·¦è¾¹0å¤„å¼€å§‹;è‹¥numä¸ºè´Ÿæ•°,ä»å³è¾¹å¼€å§‹æå–å­—ä¸²,ä½†å¿…é¡»ä½¿ç”¨åœ¨å†’å·åé¢åŠ ç©ºæ ¼æˆ–ä¸€ä¸ªæ•°å­—æˆ–æ•´ä¸ªnumåŠ ä¸Šæ‹¬å·,å¦‚${var: -2}ã€${var:1-3}æˆ–${var:(-2)}ã€‚</li>
<li>ç¬¬äºŒç§æ¨¡å¼:${var:num1:num2},num1æ˜¯ä½ç½®,num2æ˜¯é•¿åº¦ã€‚è¡¨ç¤ºä»$varå­—ç¬¦ä¸²çš„ç¬¬$num1ä¸ªä½ç½®å¼€å§‹æå–é•¿åº¦ä¸º$num2çš„å­ä¸²ã€‚ä¸èƒ½ä¸ºè´Ÿæ•°ã€‚</li>
<li>ç¬¬ä¸‰ç§æ¨¡å¼:${var/pattern/pattern}è¡¨ç¤ºå°†varå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªåŒ¹é…çš„patternæ›¿æ¢ä¸ºå¦ä¸€ä¸ªpatternã€‚ ã€‚</li>
<li>ç¬¬å››ç§æ¨¡å¼:${var//pattern/pattern}è¡¨ç¤ºå°†varå­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰èƒ½åŒ¹é…çš„patternæ›¿æ¢ä¸ºå¦ä¸€ä¸ªpatternã€‚</li>
</ul>
<h3 id="å››ã€ç¬¦å·-åçš„æ‹¬å·"><a href="#å››ã€ç¬¦å·-åçš„æ‹¬å·" class="headerlink" title="å››ã€ç¬¦å·$åçš„æ‹¬å·"></a>å››ã€ç¬¦å·$åçš„æ‹¬å·</h3><ul>
<li>(1) ${a} å˜é‡açš„å€¼, åœ¨ä¸å¼•èµ·æ­§ä¹‰çš„æƒ…å†µä¸‹å¯ä»¥çœç•¥å¤§æ‹¬å·ã€‚</li>
<li>(2) $(cmd) å‘½ä»¤æ›¿æ¢,å’Œ<code>cmd</code>æ•ˆæœç›¸åŒ,ç»“æœä¸ºshellå‘½ä»¤cmdçš„è¾“,è¿‡æŸäº›Shellç‰ˆæœ¬ä¸æ”¯æŒ$()å½¢å¼çš„å‘½ä»¤æ›¿æ¢, å¦‚tcshã€‚</li>
<li>(3) $((expression)) å’Œ<code>exprexpression</code>æ•ˆæœç›¸åŒ, è®¡ç®—æ•°å­¦è¡¨è¾¾å¼expçš„æ•°å€¼, å…¶ä¸­expåªè¦ç¬¦åˆCè¯­è¨€çš„è¿ç®—è§„åˆ™å³å¯, ç”šè‡³ä¸‰ç›®è¿ç®—ç¬¦å’Œé€»è¾‘è¡¨è¾¾å¼éƒ½å¯ä»¥è®¡ç®—ã€‚</li>
</ul>
<h3 id="äº”ã€ä½¿ç”¨å¤šæ¡å‘½ä»¤æ‰§è¡Œ"><a href="#äº”ã€ä½¿ç”¨å¤šæ¡å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="äº”ã€ä½¿ç”¨å¤šæ¡å‘½ä»¤æ‰§è¡Œ"></a>äº”ã€ä½¿ç”¨å¤šæ¡å‘½ä»¤æ‰§è¡Œ</h3><ul>
<li>(1)å•å°æ‹¬å·,(cmd1;cmd2;cmd3) æ–°å¼€ä¸€ä¸ªå­shellé¡ºåºæ‰§è¡Œå‘½ä»¤cmd1,cmd2,cmd3, å„å‘½ä»¤ä¹‹é—´ç”¨åˆ†å·éš”å¼€,æœ€åä¸€ä¸ªå‘½ä»¤åå¯ä»¥æ²¡æœ‰åˆ†å·ã€‚</li>
<li>(2)å•å¤§æ‹¬å·,{ cmd1;cmd2;cmd3;} åœ¨å½“å‰shellé¡ºåºæ‰§è¡Œå‘½ä»¤cmd1,cmd2,cmd3, å„å‘½ä»¤ä¹‹é—´ç”¨åˆ†å·éš”å¼€, æœ€åä¸€ä¸ªå‘½ä»¤åå¿…é¡»æœ‰åˆ†å·, ç¬¬ä¸€æ¡å‘½ä»¤å’Œå·¦æ‹¬å·ä¹‹é—´å¿…é¡»ç”¨ç©ºæ ¼éš”å¼€ã€‚å¯¹{}å’Œ()è€Œè¨€, æ‹¬å·ä¸­çš„é‡å®šå‘ç¬¦åªå½±å“è¯¥æ¡å‘½ä»¤, è€Œæ‹¬å·å¤–çš„é‡å®šå‘ç¬¦å½±å“åˆ°æ‹¬å·ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>LinuxShellè„šæœ¬æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxShellè„šæœ¬</tag>
      </tags>
  </entry>
  <entry>
    <title>LINUX Shell Scripts ç¬¬å…­è¯¾ ä¸Šæœºè€ƒè¯•</title>
    <url>/2016/12/23/booboo_bash_shell_scripts/shell%E4%B8%8A%E6%9C%BA/</url>
    <content><![CDATA[<blockquote>
<p>è¯·å°†è„šæœ¬ä¿å­˜ï¼Œå­˜æ”¾è·¯å¾„ä¸º/home/kiosk/Desktop/stux/,å…¶ä¸­xä¸ºä½ çš„æœºå·<br>test.sh num.sh checkip.sh dns.sh useradd.sh æ¯é¢˜20åˆ†</p>
</blockquote>
<h2 id="1-æµç¨‹æ§åˆ¶è¯­å¥åº”ç”¨æµ‹è¯•ï¼š"><a href="#1-æµç¨‹æ§åˆ¶è¯­å¥åº”ç”¨æµ‹è¯•ï¼š" class="headerlink" title="1.æµç¨‹æ§åˆ¶è¯­å¥åº”ç”¨æµ‹è¯•ï¼š"></a>1.æµç¨‹æ§åˆ¶è¯­å¥åº”ç”¨æµ‹è¯•ï¼š</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œè„šæœ¬åä¸ºtest.sh</span><br><span class="line">åˆ¤æ–­&#x2F;tmp&#x2F;test1è‡³&#x2F;tmp&#x2F;test50å’Œ&#x2F;etc&#x2F;passwd &#x2F;etc&#x2F;hostsæ–‡ä»¶å­˜åœ¨ä¸å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™å°†è¯¥æ–‡ä»¶åˆ›å»ºå‡ºæ¥ã€‚</span><br></pre></td></tr></table></figure>
<h2 id="2-æŒ‰ç…§è¿è¡Œç»“æœç¼–å†™Shellè„šæœ¬ï¼š"><a href="#2-æŒ‰ç…§è¿è¡Œç»“æœç¼–å†™Shellè„šæœ¬ï¼š" class="headerlink" title="2.æŒ‰ç…§è¿è¡Œç»“æœç¼–å†™Shellè„šæœ¬ï¼š"></a>2.æŒ‰ç…§è¿è¡Œç»“æœç¼–å†™Shellè„šæœ¬ï¼š</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¦æ±‚ï¼š1ï¼‰è„šæœ¬åä¸ºnum.sh</span><br><span class="line">      2ï¼‰è¦æ±‚æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š</span><br><span class="line"> ç¬¬ä¸€è¡Œ0ï¼Œç¬¬äºŒè¡Œ01ï¼Œç¬¬ä¸‰è¡Œ012ï¼Œä»¥æ­¤ç±»æ¨ï¼Œè¾“å‡ºå¦‚ä¸Š0åˆ°9çš„ç»“æœå³å¯ã€‚</span><br><span class="line">0</span><br><span class="line">01</span><br><span class="line">012</span><br><span class="line">0123</span><br><span class="line">01234</span><br><span class="line">012345</span><br><span class="line">0123456</span><br><span class="line">01234567</span><br><span class="line">012345678</span><br><span class="line">0123456789</span><br></pre></td></tr></table></figure>

<h3 id="3-æ­£åˆ™è¡¨è¾¾å¼åº”ç”¨æµ‹è¯•ï¼š"><a href="#3-æ­£åˆ™è¡¨è¾¾å¼åº”ç”¨æµ‹è¯•ï¼š" class="headerlink" title="3.æ­£åˆ™è¡¨è¾¾å¼åº”ç”¨æµ‹è¯•ï¼š"></a>3.æ­£åˆ™è¡¨è¾¾å¼åº”ç”¨æµ‹è¯•ï¼š</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç¼–å†™ä¸€ä¸ªIPæ£€æµ‹è„šæœ¬</span><br><span class="line">1ï¼‰ è„šæœ¬åä¸ºcheckip.sh</span><br><span class="line">2ï¼‰ è¾“å…¥å‚æ•°ä¸º$1ï¼Œ$1 ä¸ºè¦åˆ¤æ–­çš„è¾“å…¥ï¼Œå¦‚æœ$1 ä¸ºip åœ°å€ï¼Œåˆ™è¾“å‡ºâ€This is ip addressâ€,</span><br><span class="line">å¦‚æœ$1 ä¸ºéip åœ°å€ï¼Œåˆ™è¾“å‡ºâ€This is not ip addressâ€</span><br><span class="line">3ï¼‰ æ‰§è¡Œæ–¹æ³•ä¸ºcheckip.sh 192.168.1.1</span><br><span class="line">4ï¼‰ æµ‹è¯•å¦‚ä¸‹è¾“å…¥å€¼</span><br><span class="line">192.168.0.199  192.a.12.0  24.235.299.1  192.168.3</span><br></pre></td></tr></table></figure>
<h3 id="4-å®é™…åº”ç”¨æµ‹è¯•1"><a href="#4-å®é™…åº”ç”¨æµ‹è¯•1" class="headerlink" title="4.å®é™…åº”ç”¨æµ‹è¯•1"></a>4.å®é™…åº”ç”¨æµ‹è¯•1</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œè„šæœ¬åä¸ºdns.sh,é€šè¿‡è„šæœ¬æ­å»ºdnsã€‚</span><br><span class="line">è¦æ±‚ï¼š	è§£æuplooking.comåŸŸå</span><br><span class="line">	Aè®°å½•æœ‰www.uplooking.com 10.2.2.2</span><br><span class="line">	PTRè®°å½•æœ‰ç›¸åº”çš„åå‘è§£æ</span><br></pre></td></tr></table></figure>
<h3 id="5-å®é™…åº”ç”¨æµ‹è¯•2"><a href="#5-å®é™…åº”ç”¨æµ‹è¯•2" class="headerlink" title="5.å®é™…åº”ç”¨æµ‹è¯•2"></a>5.å®é™…åº”ç”¨æµ‹è¯•2</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œè„šæœ¬åä¸ºuseradd.sh</span><br><span class="line">è¦æ±‚æ ¹æ®userliståˆ›å»ºç”¨æˆ·ï¼Œè¦æ±‚æŒ‡å®šç”¨æˆ·åï¼Œç”¨æˆ·idï¼Œç”¨æˆ·çš„é»˜è®¤ç»„å’Œé™„åŠ ç»„åŠå˜æ›´ç”¨æˆ·uå¯†ç ï¼Œè‹¥å¯¹åº”ç”¨æˆ·çš„é™„åŠ ç»„ä¸å­˜åœ¨ï¼Œåˆ™å°†é™„åŠ ç»„åˆ›å»ºå‡ºæ¥åå†æ ¹æ®è¦æ±‚æ·»åŠ ç”¨æˆ·ã€‚</span><br><span class="line">	[root@rhel6 ~]# cat &#x2F;tmp&#x2F;useraddlist1</span><br><span class="line">	dabao 888 xuexi,it uplooking</span><br><span class="line">	lucy 889 sales,it uplooking</span><br><span class="line">	lily 899 pro,aa uplooking</span><br></pre></td></tr></table></figure>

<h3 id="6-ç—…æ¯’è‡ªæˆ‘å¤åˆ¶è„šæœ¬"><a href="#6-ç—…æ¯’è‡ªæˆ‘å¤åˆ¶è„šæœ¬" class="headerlink" title="6.ç—…æ¯’è‡ªæˆ‘å¤åˆ¶è„šæœ¬"></a>6.ç—…æ¯’è‡ªæˆ‘å¤åˆ¶è„šæœ¬</h3><h3 id="7-è·å–apacheè®¿é—®æ—¥å¿—ä¸­è®¿é—®æ¬¡æ•°æœ€å¤šçš„å‰5ä¸ªipåœ°å€"><a href="#7-è·å–apacheè®¿é—®æ—¥å¿—ä¸­è®¿é—®æ¬¡æ•°æœ€å¤šçš„å‰5ä¸ªipåœ°å€" class="headerlink" title="7.è·å–apacheè®¿é—®æ—¥å¿—ä¸­è®¿é—®æ¬¡æ•°æœ€å¤šçš„å‰5ä¸ªipåœ°å€"></a>7.è·å–apacheè®¿é—®æ—¥å¿—ä¸­è®¿é—®æ¬¡æ•°æœ€å¤šçš„å‰5ä¸ªipåœ°å€</h3>]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>LinuxShellè„šæœ¬æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxShellè„šæœ¬</tag>
      </tags>
  </entry>
  <entry>
    <title>LINUX Shell Scripts ç¬¬ä¸ƒè¯¾ ç¬”è¯•</title>
    <url>/2016/12/23/booboo_bash_shell_scripts/shell%E7%AC%94%E8%AF%95/</url>
    <content><![CDATA[<h2 id="ä¸€ï¼šçº é”™é¢˜ï¼šè¯·æ‰¾å‡ºä»¥ä¸‹ä»£ç æœ‰é”™è¯¯çš„åœ°æ–¹å¹¶æ›´æ­£ã€‚ï¼ˆ3-20ï¼‰"><a href="#ä¸€ï¼šçº é”™é¢˜ï¼šè¯·æ‰¾å‡ºä»¥ä¸‹ä»£ç æœ‰é”™è¯¯çš„åœ°æ–¹å¹¶æ›´æ­£ã€‚ï¼ˆ3-20ï¼‰" class="headerlink" title="ä¸€ï¼šçº é”™é¢˜ï¼šè¯·æ‰¾å‡ºä»¥ä¸‹ä»£ç æœ‰é”™è¯¯çš„åœ°æ–¹å¹¶æ›´æ­£ã€‚ï¼ˆ3*20ï¼‰"></a>ä¸€ï¼šçº é”™é¢˜ï¼šè¯·æ‰¾å‡ºä»¥ä¸‹ä»£ç æœ‰é”™è¯¯çš„åœ°æ–¹å¹¶æ›´æ­£ã€‚ï¼ˆ3*20ï¼‰</h2><h3 id="1-ä¸¤ä¸ªæ•°å­—ç›¸åŠ "><a href="#1-ä¸¤ä¸ªæ•°å­—ç›¸åŠ " class="headerlink" title="1. ä¸¤ä¸ªæ•°å­—ç›¸åŠ "></a>1. ä¸¤ä¸ªæ•°å­—ç›¸åŠ </h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin.bash</span></span><br><span class="line">read -p "input number1" : num1</span><br><span class="line">read -p "input number2" : num2</span><br><span class="line">echo $(num1+num2)</span><br></pre></td></tr></table></figure>
<p>è¯·å°†æ›´æ­£è„šæœ¬ä¿å­˜ï¼Œåä¸º1.shï¼Œå­˜æ”¾è·¯å¾„ä¸º/home/kiosk/Desktop/stux/1.sh ,å…¶ä¸­xä¸ºä½ çš„æœºå·<br>;åœ¨è„šæœ¬ä¸­ç”¨#æ³¨é‡Šå‡ºé¢˜ç›®ä¸­é”™è¯¯çš„åœ°æ–¹</p>
<h3 id="2-å°†å¼€æœºselinuxçŠ¶æ€è®¾ç½®ä¸ºdisabled"><a href="#2-å°†å¼€æœºselinuxçŠ¶æ€è®¾ç½®ä¸ºdisabled" class="headerlink" title="2. å°†å¼€æœºselinuxçŠ¶æ€è®¾ç½®ä¸ºdisabled"></a>2. å°†å¼€æœºselinuxçŠ¶æ€è®¾ç½®ä¸ºdisabled</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">sed 'SELINUXs/disabled/enforcing/' /etc/selinux/config</span><br></pre></td></tr></table></figure>
<p>è¯·å°†æ›´æ­£è„šæœ¬ä¿å­˜ï¼Œåä¸º2.shï¼Œå­˜æ”¾è·¯å¾„ä¸º/home/kiosk/Desktop/stux/2.sh ,å…¶ä¸­xä¸ºä½ çš„æœºå·<br>;åœ¨è„šæœ¬ä¸­ç”¨#æ³¨é‡Šå‡ºé¢˜ç›®ä¸­é”™è¯¯çš„åœ°æ–¹</p>
<h3 id="3-åˆ¤æ–­100ä»¥å†…è¢«5æ•´é™¤ä½†æ˜¯ä¸èƒ½è¢«7æ•´é™¤çš„æ•°å­—"><a href="#3-åˆ¤æ–­100ä»¥å†…è¢«5æ•´é™¤ä½†æ˜¯ä¸èƒ½è¢«7æ•´é™¤çš„æ•°å­—" class="headerlink" title="3. åˆ¤æ–­100ä»¥å†…è¢«5æ•´é™¤ä½†æ˜¯ä¸èƒ½è¢«7æ•´é™¤çš„æ•°å­—"></a>3. åˆ¤æ–­100ä»¥å†…è¢«5æ•´é™¤ä½†æ˜¯ä¸èƒ½è¢«7æ•´é™¤çš„æ•°å­—</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">for i in (seq 1 100)</span><br><span class="line">A=$(($i % 5))</span><br><span class="line">B=$(($i%7))</span><br><span class="line">if [ $A -eq 0 ] -a [ $B -ne 0 ]</span><br><span class="line">then</span><br><span class="line">echo $i</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>è¯·å°†æ›´æ­£è„šæœ¬ä¿å­˜ï¼Œåä¸º3.shï¼Œå­˜æ”¾è·¯å¾„ä¸º/home/kiosk/Desktop/stux/3.sh ,å…¶ä¸­xä¸ºä½ çš„æœºå·<br>;åœ¨è„šæœ¬ä¸­ç”¨#æ³¨é‡Šå‡ºé¢˜ç›®ä¸­é”™è¯¯çš„åœ°æ–¹</p>
<h2 id="äºŒï¼šå¡«ç©ºé¢˜ï¼ˆ2-10ï¼‰"><a href="#äºŒï¼šå¡«ç©ºé¢˜ï¼ˆ2-10ï¼‰" class="headerlink" title="äºŒï¼šå¡«ç©ºé¢˜ï¼ˆ2*10ï¼‰"></a>äºŒï¼šå¡«ç©ºé¢˜ï¼ˆ2*10ï¼‰</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. é€šè¿‡ä»€ä¹ˆç¬¦å·è®¡ç®—ä¼ é€’è¿›æ¥çš„ä½ç½®å‚æ•°ï¼Ÿ__________</span><br><span class="line">2. å¦‚ä½•æ£€æŸ¥ä¹‹å‰çš„å‘½ä»¤æ˜¯å¦è¿è¡ŒæˆåŠŸï¼Ÿ__________</span><br><span class="line">3. å¦‚ä½•è·å–ä¸€ä¸ªæ–‡ä»¶æ¯ä¸€è¡Œä»¥ç©ºæ ¼ä¸ºåˆ†éš”çš„ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼Ÿ__________</span><br><span class="line">4. è°ƒè¯•bashè„šæœ¬çš„å‚æ•°ä¸ºï¼Ÿ__________</span><br><span class="line">5.    A&#x3D;a:b:c:d    echo $&#123;A&#x2F;&#x2F;:&#x2F;&#125;	     ç»“æœæ˜¯__________</span><br><span class="line">6. awkçš„NRå˜é‡ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ___________________</span><br><span class="line">7. å¦‚ä½•è·å–æ•°ç»„çš„é•¿åº¦?   ____________</span><br><span class="line">8. å¦‚ä½•å¼•ç”¨ä¼ é€’ç»™è„šæœ¬çš„ç¬¬åä¸ªä½ç½®å‚æ•°ï¼Ÿ_______________</span><br><span class="line">9. $$çš„å«ä¹‰ï¼Ÿ_____________________</span><br><span class="line">10. å‘½ä»¤ â€œexportâ€ æœ‰ä»€ä¹ˆç”¨ï¼Ÿ ____________________________</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ï¼šé€‰æ‹©é¢˜ï¼ˆ2-10ï¼‰"><a href="#ä¸‰ï¼šé€‰æ‹©é¢˜ï¼ˆ2-10ï¼‰" class="headerlink" title="ä¸‰ï¼šé€‰æ‹©é¢˜ï¼ˆ2*10ï¼‰"></a>ä¸‰ï¼šé€‰æ‹©é¢˜ï¼ˆ2*10ï¼‰</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. Awké‡Œçš„å†…ç½®å˜é‡NFæŒ‡çš„æ˜¯ï¼ˆ    ï¼‰</span><br><span class="line">Aï¼‰  æ‰€æœ‰è¾“å…¥æ–‡ä»¶è®°å½•çš„è¡Œæ•°         Bï¼‰ å•ä¸ªè¾“å…¥æ–‡ä»¶è®°å½•çš„è¡Œæ•°</span><br><span class="line">Cï¼‰ ä»¥æŒ‡å®šåˆ†éš”ç¬¦å·ä½œä¸ºåˆ†éš”çš„åˆ—æ•°   Dï¼‰ AWKå¤„ç†æ–‡ä»¶çš„ä¸ªæ•°</span><br><span class="line"></span><br><span class="line">2. è·³å‡ºå½“å‰å¾ªç¯ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯ä½¿ç”¨çš„è¯­å¥æ˜¯ï¼ˆ   ï¼‰</span><br><span class="line">Aï¼‰ continue		Bï¼‰break     Cï¼‰exit    Dï¼‰return</span><br><span class="line"></span><br><span class="line">3. ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„è¯­å¥sed -n &#39;&#x2F;^\&lt;[^0-9a-d]*\&gt;$&#x2F;p&#39; &#x2F;tmp&#x2F;listè¾“å‡ºçš„å¯èƒ½æ˜¯ä»¥ä¸‹å“ªä¸ªï¼ˆ   ï¼‰</span><br><span class="line">Aï¼‰kevin alice     Bï¼‰selena</span><br><span class="line">Cï¼‰peter         Dï¼‰23naive</span><br><span class="line"></span><br><span class="line">4. ä»¥ä¸‹å“ªä¸ªé€‰é¡¹å…³äºæ•°ç»„èµ‹å€¼æ˜¯é”™è¯¯çš„ï¼ˆ    ï¼‰</span><br><span class="line">Aï¼‰ A[1]&#x3D;3       Bï¼‰A&#x3D;([15]&#x3D;1 a d e)</span><br><span class="line">Cï¼‰A&#x3D;((6 7 0 2))   Dï¼‰A&#x3D;(15 3 47 a)</span><br><span class="line"></span><br><span class="line">5. ä»¥ä¸‹å“ªä¸ªè¡¨è¾¾å¼å¯ä»¥ç®—å‡º8+3çš„ç»“æœï¼ˆ    ï¼‰</span><br><span class="line">Aï¼‰ echo $((8+3))</span><br><span class="line">Bï¼‰ echo $(8+3)</span><br><span class="line">Cï¼‰ echo $&#123;8+3&#125;</span><br><span class="line">Dï¼‰ echo $[[8+3]]</span><br><span class="line"></span><br><span class="line">6. ä»¥ä¸‹å“ªä¸ªæµç¨‹è¯­å¥æ˜¯åˆ¤æ–­ä¸ºçœŸåˆ™åšå¾ªç¯ï¼ˆ    ï¼‰</span><br><span class="line">Aï¼‰ until   Bï¼‰while</span><br><span class="line">Cï¼‰case   Dï¼‰for</span><br><span class="line">7. é˜…è¯»ä»¥ä¸‹ä»£ç ï¼Œè¯¥ä»£ç è¾“å‡ºç»“æœæ˜¯ï¼ˆ    ï¼‰</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">i&#x3D;0</span><br><span class="line">sum&#x3D;0</span><br><span class="line">while [ $i -le 5 ]</span><br><span class="line">do</span><br><span class="line">        sum&#x3D;$(($sum+$i))</span><br><span class="line">        i&#x3D;$(($i+1))</span><br><span class="line">done</span><br><span class="line">        echo $sum</span><br><span class="line">Aï¼‰10    Bï¼‰21    Cï¼‰15     Dï¼‰è¯¥ä»£ç æ‰§è¡Œä¼šäº§ç”Ÿæ­»å¾ªç¯</span><br><span class="line"></span><br><span class="line">8. å‡½æ•°å†…å¦‚ä½•è®¾ç½®å±€éƒ¨å˜é‡ï¼ˆ    ï¼‰</span><br><span class="line">Aï¼‰ local    Bï¼‰export</span><br><span class="line">Cï¼‰source  Dï¼‰function</span><br><span class="line"></span><br><span class="line">9. ä»¥ä¸‹å“ªä¸€ç§æŒ‡ä»¤æ˜¾ç¤ºçš„ç»“æœä¸º$testï¼ˆ   ï¼‰</span><br><span class="line">Aï¼‰\echo $test      Bï¼‰echo &quot;$test&quot;</span><br><span class="line">Cï¼‰echo &#39;$test&#39;      Dï¼‰echo &quot;$&#123;test&#125;&quot;</span><br><span class="line"></span><br><span class="line">10. shiftçš„ä½œç”¨æ˜¯ï¼ˆ    ï¼‰</span><br><span class="line">Aï¼‰ å®šä¹‰è¿”å›å€¼     Bï¼‰ç§»åŠ¨ä½ç½®å‚æ•°</span><br><span class="line">Cï¼‰è·³å‡ºè„šæœ¬    	Dï¼‰è·³å‡ºå¾ªç¯</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>LinuxShellè„šæœ¬æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxShellè„šæœ¬</tag>
      </tags>
  </entry>
  <entry>
    <title>LINUX åŸºç¡€æœåŠ¡è¯¾ç¨‹ç¯å¢ƒä½¿ç”¨è¯´æ˜</title>
    <url>/2016/12/23/booboo_easy_service/00_linux_classroom_env/</url>
    <content><![CDATA[<p>UP100 è¯¾ç¨‹åŸºäºRHEL6.5ã€RHEL7.0ã€ubuntu1604ã€WindowsXPå’ŒWindows2012R2ç³»ç»Ÿ</p>
<p>éœ€è¦å¼€å¯è™šæ‹Ÿæœºå¯ä»¥ç›´æ¥åŒå‡»å›¾æ ‡ï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶å°†ä»è®²å¸ˆæœºä¸‹è½½æ˜ åƒæ–‡ä»¶ï¼Œå¯èƒ½ä¼šæ¯”è¾ƒæ…¢ã€‚</p>
<p>æ§åˆ¶è™šæ‹Ÿæœºå¯ä»¥ä½¿ç”¨kioskç”¨æˆ·ï¼Œæ‰§è¡Œrht-vmctlå‘½ä»¤ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹å‘½ä»¤ä½¿ç”¨ã€‚</p>
<h3 id="æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹"><a href="#æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹" class="headerlink" title="æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹"></a>æˆè¯¾ç½‘ç»œç¯å¢ƒé…ç½®å¦‚ä¸‹</h3><p><strong>f0~fN</strong>ä¸ºæ•™å®¤ç‰©ç†æœºï¼Œå…¶åŸŸåä¸º<code>foundationN.ilt.example.com</code> ,å¯ç®€å†™ä¸º<code>fN</code>ã€‚å…¶IPä¸º<code>172.25.N.250</code>ï¼Œ<code>f0</code>ç‰¹æ®Šä¸º<code>172.25.254.250</code>ã€‚</p>
<p><code>classroom</code>è™šæ‹Ÿæœºä¸ºæ‰€æœ‰ç‰©ç†æœºå’Œè™šæ‹Ÿæœºçš„é»˜è®¤ç½‘å…³ï¼Œé…ç½®äº†å¤šä¸ªç½‘å¡è®¾ç½®äº†æ‰€æœ‰<code>172.25.N.254</code>çš„åœ°å€ï¼Œä¿è¯è™šæ‹Ÿæœºã€ç‰©ç†æœºå’Œå„ä¸ªå­¦ç”Ÿæœºä¹‹é—´çš„è·¯ç”±ã€‚é…ç½®äº†<code>DHCP</code>ã€<code>DNS</code>å’Œ<code>HTTP</code>æœåŠ¡ï¼Œå…¶åŸŸåä¸º<code>classroom.example.com</code>å¯ç®€å†™ä¸º<code>classroom</code>ã€‚</p>
<p>rhel6è™šæ‹Ÿæœºå‡å®‰è£…RHEL6.5ç³»ç»Ÿï¼Œrhel7è™šæ‹Ÿæœºå‡å®‰è£…RHEL7.0ç³»ç»Ÿï¼Œubuntu1604è™šæ‹Ÿæœºå‡å®‰è£…Ubuntu1604ç³»ç»Ÿï¼Œå‡å®‰è£…å›¾å½¢åŒ–ç•Œé¢å¹¶é…ç½®runlevel 5å¯åŠ¨ï¼Œrootå¯†ç ä¸ºuplooking ï¼Œé…ç½®äº†åŸºç¡€çš„YUMæºæŒ‡å‘classroomï¼Œ rhel6ã€rhel7ã€ubuntu1604ã€winxpå’Œwin2012r2è™šæ‹Ÿæœºå‡é…ç½®äº†1å—è™šæ‹Ÿæœºç½‘å¡ï¼Œeth0æ¥å…¥ç‰©ç†æœºbr0ç½‘æ¡¥ï¼ŒåŠ¨æ€è·å¾—ipåœ°å€:</p>
<table>
<thead>
<tr>
<th align="left">hostname</th>
<th align="left">ipaddr</th>
</tr>
</thead>
<tbody><tr>
<td align="left">rhel7</td>
<td align="left">172.25.N.10</td>
</tr>
<tr>
<td align="left">rhel6</td>
<td align="left">172.25.N.11</td>
</tr>
<tr>
<td align="left">winxp</td>
<td align="left">172.25.N.12</td>
</tr>
<tr>
<td align="left">ubuntu</td>
<td align="left">172.25.N.14</td>
</tr>
<tr>
<td align="left">win2012r2</td>
<td align="left">172.25.N.15</td>
</tr>
</tbody></table>
<p>rhel6ã€rhel7ã€ubuntu1604è™šæ‹Ÿæœºå‡é…ç½®ä¸¤å—è™šæ‹Ÿç¡¬ç›˜vdaå’Œvdbï¼Œä»¥æ–¹ä¾¿æˆè¯¾æ¼”ç¤ºã€‚é™¤winxpå’Œwin2012r2ä¹‹å¤–å…¶å®ƒè™šæ‹Ÿæœºå‡é…ç½®2GBè¿è¡Œå†…å­˜ï¼Œwinxpé…ç½®1GBè¿è¡Œå†…å­˜ï¼Œwin2012r2é…ç½®4GBè¿è¡Œå†…å­˜ã€‚</p>
<p>winxpè™šæ‹Ÿæœºä¸»æœºä¸Šå®‰è£…äº†å¦‚ä¸‹è½¯ä»¶ï¼š</p>
<ul>
<li>Cisco Packet Tracer</li>
<li>Putty</li>
<li>Winscp</li>
<li>Xshell</li>
<li>Wireshark</li>
<li>Navicat for Mysql</li>
<li>Microsoft Visio 2010</li>
<li>7-zip</li>
</ul>
<p>å·²åœ¨classroomä¸Šå®ŒæˆDNSé…ç½®ï¼Œæ­£å‘å’Œæ–¹å‘åŸŸååŠé‚®ä»¶ä»£ç†åŸŸåå’Œè™šæ‹ŸæœºåŸŸåè®¾ç½®å¦‚ä¸‹ï¼š</p>
<p>rhel7ä¸»æœºï¼š172.25.N.10</p>
<ul>
<li>rhel7-fN.example.com</li>
<li>dN.example.com</li>
<li>imapN.example.com</li>
<li>smtpN.example.com (MX)</li>
</ul>
<p>rhel6ä¸»æœºï¼š 172.25.N.11</p>
<ul>
<li>rhel6-fN.example.com</li>
<li>sN.example.com</li>
<li>wwwN.example.com</li>
<li>webapp-fN.example.com</li>
</ul>
<p>winxpä¸»æœºï¼š 172.25.N.12</p>
<ul>
<li>winxp-fN.example.com</li>
<li>install ä¸»æœºï¼š172.25.N.13</li>
<li>install-fN.example.com</li>
<li>ubuntuä¸»æœºï¼š172.25.N.14</li>
<li>ubuntu-fN.example.com</li>
</ul>
<p>win2012r2ä¸»æœºï¼š172.25.N.15</p>
<ul>
<li>win2012r2-fN.example.com</li>
</ul>
<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>rhel6.5 SElinuxæœ‰bugï¼Œå…‰ç›˜ä¸­é»˜è®¤æ²¡æœ‰selinuxç›¸å…³manpageï¼Œçœ‹manpageéœ€è¦å®‰è£…selinux-policy-docåŒ…ï¼Œä½†è¿™ä¸ªåŒ…éœ€è¦ä»RHNä¸‹è½½ã€‚</p>
<h3 id="ç½‘ç»œæ‹“æ‰‘å›¾"><a href="#ç½‘ç»œæ‹“æ‰‘å›¾" class="headerlink" title="ç½‘ç»œæ‹“æ‰‘å›¾"></a>ç½‘ç»œæ‹“æ‰‘å›¾</h3><p><img src="pic/01-up100.png" alt="up100"></p>
<hr>
<h2 id="åŸºç¡€æœåŠ¡ç®€ä»‹"><a href="#åŸºç¡€æœåŠ¡ç®€ä»‹" class="headerlink" title="åŸºç¡€æœåŠ¡ç®€ä»‹"></a>åŸºç¡€æœåŠ¡ç®€ä»‹</h2><p>æœ¬ç« å°†è®²è§£ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>RHEL6 ä¸­Linuxç³»ç»ŸæœåŠ¡çš„åŸºç¡€çŸ¥è¯†ã€System Vä¸Xinetdçš„æ¦‚å¿µï¼Œä»¥åŠé€šè¿‡ servcie å‘½ä»¤æ¥å¯åŠ¨æŸä¸€æœåŠ¡ï¼Œé€šè¿‡ chkconfig å‘½ä»¤æ¥è®¾ç½®æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨</li>
<li>RHEL7 ä¸­ å·²ç»æ›¿æ¢æ‰ System V initï¼Œå¹¶æ­£å¼é‡‡ç”¨å…¨æ–°çš„åˆå§‹åŒ–è¿›ç¨‹ Systemdï¼Œä»¥åŠé€šè¿‡systemctl å‘½ä»¤æ¥å¯åŠ¨æŸä¸€æœåŠ¡å’Œè®¾ç½®è¯¥æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨</li>
</ul>
<blockquote>
<p>é‡ç‚¹ç®€ä»‹rhel6ï¼Œrhel7åªåšå‘½ä»¤çš„ä»‹ç»ï¼Œå…·ä½“å†…å®¹è¯·å‚è€ƒã€Šsystemdè¯´æ˜ã€‹</p>
</blockquote>
<h3 id="ç³»ç»ŸæœåŠ¡çš„åŸºæœ¬æ¦‚å¿µ"><a href="#ç³»ç»ŸæœåŠ¡çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ç³»ç»ŸæœåŠ¡çš„åŸºæœ¬æ¦‚å¿µ"></a>ç³»ç»ŸæœåŠ¡çš„åŸºæœ¬æ¦‚å¿µ</h3><p>æœåŠ¡ï¼Œå…¶å®å°±æ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿåå°çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œä¸ºè®¡ç®—æœºç³»ç»Ÿæˆ–ç”¨æˆ·æä¾›æŸé¡¹ç‰¹å®šçš„æœåŠ¡ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œå…¶åœ¨åå°ä¹Ÿè¿è¡Œäº†è®¸è®¸å¤šå¤šçš„æœåŠ¡ã€‚ä¾‹å¦‚æˆ‘ä»¬è£…çš„æ€æ¯’è½¯ä»¶ï¼Œå…¶åœ¨åå°è¿è¡Œäº†è®¸å¤šæˆ‘ä»¬çœ‹ä¸è§çš„æœåŠ¡ç¨‹åºï¼Œé€šè¿‡è¿™äº›æœåŠ¡æ¥ä¸ºç”¨æˆ·æˆ–è€…è®¡ç®—æœºç³»ç»Ÿæ¥æé«˜ç‰¹å®šçš„åŠŸèƒ½ã€‚</p>
<p>æœåŠ¡é€šå¸¸æ˜¯ä¸ä¸­æ–­è¿è¡Œçš„ï¼Œéšæ—¶å‡†å¤‡æ¥å—è¯·æ±‚ï¼Œä»è€Œæä¾›æŸé¡¹æœåŠ¡ã€‚ä¾‹å¦‚æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„ç½‘é¡µæœåŠ¡ï¼Œå…¶å°±æ˜¯ç”±ä¸€ä¸ªè¿è¡Œåœ¨æ‰€è®¿é—®ç½‘ç«™çš„æœåŠ¡å™¨ä¸Šçš„httpdæœåŠ¡æä¾›çš„æœåŠ¡ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨æµè§ˆå™¨è¾“å…¥éœ€è¦è®¿é—®ç½‘ç«™çš„åŸŸåï¼ŒæœåŠ¡å™¨ç«¯çš„httpdæœåŠ¡å°±ä¼šéšæ—¶çš„æ¥æ”¶æˆ‘ä»¬å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œå¹¶å“åº”å›ç»™æˆ‘ä»¬çš„ç”¨æˆ·ã€‚</p>
<p>æˆ‘ä»¬Linuxç³»ç»Ÿç»å¤§å¤šæ•°æœåŠ¡éƒ½æ˜¯ç½‘ç»œæœåŠ¡ï¼Œä¾‹å¦‚é‚®ä»¶æœåŠ¡ã€FTPæœåŠ¡ã€httpdæœåŠ¡ç­‰ç­‰ï¼Œç½‘ç»œæœåŠ¡å¯ä»¥ä½¿ä¸ºå…¶ä»–ç”¨æˆ·ã€å…¶ä»–è®¡ç®—æœºæä¾›ç‰¹å®šçš„æœåŠ¡ã€‚</p>
<h3 id="services-å’Œ-daemons"><a href="#services-å’Œ-daemons" class="headerlink" title="services å’Œ daemons"></a>services å’Œ daemons</h3><table>
<thead>
<tr>
<th align="left">æœåŠ¡å</th>
<th align="left">å®ˆæŠ¤è¿›ç¨‹å</th>
</tr>
</thead>
<tbody><tr>
<td align="left">rsyslog</td>
<td align="left">rsyslogd</td>
</tr>
<tr>
<td align="left">atd</td>
<td align="left">atd</td>
</tr>
<tr>
<td align="left">crond</td>
<td align="left">crond</td>
</tr>
</tbody></table>
<p><strong>æœåŠ¡çš„åˆ†ç±»</strong> æœåŠ¡åé€šå¸¸æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªè¿™ä¸ªåŸºäºç¨‹åºçš„æœåŠ¡åç§°ï¼Œæˆ‘ä»¬æŠŠå®ƒå«åšserviceï¼Œæ¯”å¦‚è¯´ftpæœåŠ¡ï¼ŒsambaæœåŠ¡ç­‰ç­‰ã€‚<br>è¿˜æœ‰ä¸€ä¸ªæ˜¯åŸºäºè¿›ç¨‹çš„æœåŠ¡åç§°ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠå®ƒå«åšdaemonï¼Œå®ˆæŠ¤è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨pså‘½ä»¤æ—¶å€™çœ‹åˆ°çš„åç§°ï¼Œæ¯”å¦‚httpdï¼Œæ¯”å¦‚namedä¹‹ç±»çš„ç­‰ç­‰ï¼Œä¸€èˆ¬æœåŠ¡çš„è¿›ç¨‹åéƒ½æ˜¯ç¨‹åºåç§°ååŠ ä¸Šä¸€ä¸ªdï¼Œå½“ç„¶ä¹Ÿæœ‰ä¸å°‘çš„ç‰¹ä¾‹ã€‚ä¹‹åæˆ‘ä»¬éƒ½ä¼šä¸€ä¸€å»è¯´è¿™äº›æœåŠ¡ã€‚</p>
<h3 id="åŸºäº-daemon-åˆ†ç±»"><a href="#åŸºäº-daemon-åˆ†ç±»" class="headerlink" title="åŸºäº daemon åˆ†ç±»"></a>åŸºäº daemon åˆ†ç±»</h3><p>é‚£ä¹ˆæ ¹æ®daemonï¼Œä¹Ÿå°±æ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæœåŠ¡åˆ†æˆä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ç‹¬ç«‹å¯åŠ¨çš„æœåŠ¡ï¼Œå«åšstand alone daemonï¼Œæˆ‘ä»¬ä¹‹åå­¦çš„æœåŠ¡åŸºæœ¬ä¸Šéƒ½æ˜¯ç‹¬ç«‹å¯åŠ¨çš„æœåŠ¡ã€‚å¦å¤–ä¸€ç§å«åšsuper daemonã€‚æˆ‘ä»¬åˆ†å¼€æ¥æ¥è¯´ä¸€ä¸‹è¿™ä¸¤ç§æœåŠ¡çš„ç‰¹å¾ã€‚</p>
<ul>
<li>1&gt; stand alone daemon ç‹¬ç«‹å¯åŠ¨æœåŠ¡</li>
<li>2&gt; super daemon è¶…çº§æœåŠ¡ xinted</li>
</ul>
<h4 id="System-V"><a href="#System-V" class="headerlink" title="System V"></a>System V</h4><p>æ€»çš„æ¥è¯´ï¼ŒLinuxç³»ç»Ÿé€šå¸¸ä½œä¸ºæœåŠ¡å™¨ç«¯çš„æ“ä½œç³»ç»Ÿæ¥ç”¨çš„ï¼Œæ‰€ä»¥Linuxç³»ç»Ÿæä¾›äº†è®¸è®¸å¤šçš„çš„æœåŠ¡ï¼Œæœ‰äº›æœåŠ¡éœ€è¦æˆ‘ä»¬è‡ªå·±æ¥è¿›è¡Œé…ç½®ï¼Œè¿™äº›æœåŠ¡çš„ç›®çš„å°±æ˜¯ä¸ºäº†ç»™æˆ‘ä»¬çš„è®¡ç®—æœºã€ç”¨æˆ·æä¾›æŸé¡¹ç‰¹å®šçš„åŠŸèƒ½ã€‚é‚£ä¹ˆå¯¹äºå„ç§ä¸åŒçš„æœåŠ¡ï¼ŒLinuxç³»ç»Ÿæ˜¯æ€ä¹ˆæ ·æ¥ç»Ÿä¸€è¿›è¡Œç®¡ç†çš„å‘¢ï¼Ÿ</p>
<p>åœ¨Linuxæ“ä½œç³»ç»Ÿä¸­ï¼ŒLinuxå¯¹äºæœåŠ¡çš„ç®¡ç†ä½“ç³»æ˜¯æ²¿ç”¨äº†System Vçš„æœåŠ¡ç®¡ç†ä½“ç³»ï¼ŒSystem VåŸæ¥æ˜¯æ—©æœŸAT&amp;Tçš„ä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚</p>
<p>å¯¹äºLinuxç³»ç»Ÿï¼ŒSystem Væä¾›äº†è¿è¡Œçº§åˆ«çš„æ¦‚å¿µï¼Œè¿˜è®°å¾—ä¹‹å‰ä¸€ç›´æåˆ°è¿‡çš„Linuxçš„å¯åŠ¨è¿è¡Œçº§åˆ«å—ï¼Ÿæ²¡é”™ï¼ŒSystem Vä¸€å…±æä¾›äº†7ç§è¿è¡Œçº§åˆ«</p>
<p>0   å…³æœº</p>
<p>1   å•ç”¨æˆ·æ¨¡å¼</p>
<p>2   ä¸å¸¦ç½‘ç»œçš„å¤šç”¨æˆ·æ¨¡å¼</p>
<p>3   å¸¦ç½‘ç»œçš„å¤šç”¨æˆ·æ¨¡å¼ï¼Œçº¯æ–‡æœ¬ç•Œé¢</p>
<p>4   æœªä½¿ç”¨</p>
<p>5   å¸¦ç½‘ç»œçš„å¤šç”¨æˆ·æ¨¡å¼ï¼Œå›¾å½¢ç•Œé¢</p>
<p>6   é‡å¯</p>
<p>å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œé€šå¸¸ä½¿ç”¨çš„æ˜¯çº§åˆ«3å’Œçº§åˆ«5ï¼Œæ¯ä¸ªçº§åˆ«ä¸‹éƒ½æœ‰å¯¹åº”çš„å¯åŠ¨ã€ä¸å¯åŠ¨çš„æœåŠ¡ï¼Œæ¯”å¦‚å•ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½æ˜¯ä¸å¯åŠ¨ï¼Œè¿™äº›éƒ½æ˜¯é€šè¿‡System Vè¿™ä¸ªæœåŠ¡ç®¡ç†ä½“ç³»æ¥å†³å®šçš„</p>
<p>System Vå®šä¹‰äº†initä¸ºç³»ç»Ÿå¯åŠ¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹PID=1ï¼Œè¿™ä¸ªè¿›ç¨‹çš„ç›®çš„å°±æ˜¯å»æŸ¥çœ‹ /etc/inittab ä¸­çš„ç³»ç»Ÿå¯åŠ¨çº§åˆ«ä»è€Œæ¥å¯åŠ¨å¯¹åº”çš„æœåŠ¡</p>
<p>å¯¹äºä¸åŒçš„æœåŠ¡ï¼Œå› ä¸ºå…¶æä¾›è¯¥æœåŠ¡çš„å‚å®¶ä¸åŒï¼Œæ‰€ä»¥è¿™äº›çš„æœåŠ¡çš„å¯åŠ¨ã€å…³é—­æœºåˆ¶é€šå¸¸ä¸åŒï¼Œåœ¨Linuxç³»ç»Ÿä¸­ï¼Œä¸ºäº†æ–¹ä¾¿çš„ç®¡ç†è¿™äº›æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡çš„å¯åŠ¨ã€ç»“æŸã€é‡å¯ç­‰æ“ä½œéƒ½ç”±ä¸€ä¸ªSystem Vè„šæœ¬æ¥è¿›è¡Œæ§åˆ¶ï¼Œæ‹¥æœ‰å›ºå®šçš„æ ¼å¼ã€‚</p>
<p>å¯¹äºLinuxç³»ç»Ÿä¸Šçš„æœåŠ¡ï¼Œè¿™äº›æœåŠ¡çš„System Vè„šæœ¬æ–‡ä»¶éƒ½æ˜¯å­˜æ”¾åœ¨ /etc/rc.d/init.d è¿™ä¸ªç›®å½•ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# cd /etc/rc.d/init.d/</span><br><span class="line">[root@rhel6 ~]# ls</span><br><span class="line">abrt-ccpp         firstboot     messagebus      quota_nld    snmptrapd</span><br><span class="line">abrtd             functions     mysqld          rdisc        spice-vdagentd</span><br><span class="line">abrt-oops         haldaemon     netconsole      restorecond  sshd</span><br><span class="line">acpid             halt          netfs           rngd         sssd</span><br><span class="line">atd               htcacheclean  network         rpcbind      sysstat</span><br><span class="line">auditd            httpd         NetworkManager  rpcgssd      udev-post</span><br><span class="line">autofs            ip6tables     nfs             rpcidmapd    vboxadd</span><br><span class="line">blk-availability  iptables      nfslock         rpcsvcgssd   vboxadd-service</span><br><span class="line">bluetooth         irqbalance    ntpd            rsyslog      vboxadd-x11</span><br><span class="line">certmonger        kdump         ntpdate         sandbox      vncserver</span><br><span class="line">cpuspeed          killall       oddjobd         saslauthd    wdaemon</span><br><span class="line">crond             lvm2-lvmetad  portreserve     single       winbind</span><br><span class="line">cups              lvm2-monitor  postfix         smartd       wpa_supplicant</span><br><span class="line">dnsmasq           mdmonitor     psacct          snmpd        ypbind</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çœ‹åˆ°åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œå­˜åœ¨äº†è®¸å¤šçº¯æ–‡æœ¬æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶éƒ½æ˜¯ç³»ç»Ÿæ¯ä¸€ä¸ªæœåŠ¡çš„System Vçš„è„šæœ¬æ–‡ä»¶ï¼Œå¯¹äºè¯¥è„šæœ¬æ–‡ä»¶ï¼Œæˆ‘ä»¬è¦å¯åŠ¨ä»€ä¹ˆæœåŠ¡ï¼Œéƒ½æ˜¯é€šè¿‡è¿™äº›è„šæœ¬æ–‡ä»¶æ¥å¯åŠ¨çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç¼–å†™System Vè„šæœ¬æ–‡ä»¶æ¥æ‰‹å·¥åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„ç”±System Væ¥æ§åˆ¶çš„æœåŠ¡ã€‚</p>
<p>å¯¹äºLinuxçš„æ‰€æœ‰çš„è¿™äº›æœåŠ¡ï¼Œæˆ‘ä»¬é€šè¿‡ service è¿™ä¸ªå‘½ä»¤æ¥è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†</p>
<p>å‘½ä»¤ service å¯ä»¥è°ƒç”¨æŒ‡å®šæœåŠ¡çš„System Vè„šæœ¬ï¼Œå¹¶æ‰§è¡ŒæŒ‡å®šçš„åŠ¨ä½œ</p>
<p><code>service æœåŠ¡å [start | stop | restart | status]</code></p>
<p>å¯¹äºLinuxç³»ç»Ÿçš„è¿™äº›æœåŠ¡ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ service è¿™ä¸ªå‘½ä»¤å»è°ƒç”¨è¯¥æœåŠ¡å¯¹åº”çš„System Vè„šæœ¬ï¼Œå¹¶æ‰§è¡Œå…¶æŒ‡å®šçš„åŠ¨ä½œ</p>
<p>åˆšæ‰æˆ‘ä»¬ä¹Ÿè¯´åˆ°äº†ï¼ŒSystem Vå®šä¹‰äº†è¿è¡Œçº§åˆ«çš„æ¦‚å¿µï¼Œæ¯ä¸ªè¿è¡Œçº§åˆ«å¯¹åº”æœ‰å¯åŠ¨ã€ä¸å¯åŠ¨çš„æœåŠ¡ï¼Œåœ¨ <code>/etc/rc.d</code> è¿™ä¸ªç›®å½•ä¸‹ï¼Œé™¤äº†æˆ‘ä»¬åˆšæ‰çš„ init.d è¿™ä¸ªç›®å½•ï¼Œæˆ‘ä»¬è¿˜å‘ç°è¿˜æœ‰å…¶å®ƒçš„ä¸€äº›ç›®å½•ï¼Œè¯¸å¦‚ rc0.dã€rc1.dç­‰è¿™äº›ç›®å½•å°±åˆ†åˆ«å¯¹åº”äº†ç³»ç»Ÿçš„7ä¸­å¯åŠ¨çº§åˆ«ï¼Œæ¯ä¸ªç›®å½•é‡Œé¢éƒ½å­˜æ”¾äº†è®¸å¤šçš„<br>æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”ç€ä¸€ä¸ªç‰¹å®šçš„æœåŠ¡ï¼Œå¹¶æ ‡å¿—æœ‰æ˜¯å¦å¼€æœºå¯åŠ¨ä»¥åŠå¯åŠ¨é¡ºåºã€‚</p>
<p>æˆ‘ä»¬å‘ç°ï¼Œåœ¨è¿™äº›ç›®å½•é‡Œé¢ï¼Œå­˜æ”¾çš„éƒ½æ˜¯é“¾æ¥æ–‡ä»¶ï¼Œä¸è¿‡è¿™æ¯ä¸€ä¸ªé“¾æ¥æ–‡ä»¶çš„åå­—éƒ½æœ‰ç€ä¸¥æ ¼çš„è§„å®šã€‚æ¯ä¸€ä¸ªé“¾æ¥æ–‡ä»¶éƒ½ç”±3éƒ¨åˆ†ç»„æˆ</p>
<p><code>K15httpd -&gt; ../init.d/httpdã€€ã€€ã€€ã€€S55sshd -&gt; ../init.d/sshd</code></p>
<ul>
<li>â‘ ç¬¬ä¸€ä¸ªéƒ¨åˆ†æ˜¯ç¬¬ä¸€ä¸ªå­—æ¯Kæˆ–è€…Sï¼Œè¡¨ç¤ºè¯¥æœåŠ¡æ˜¯ä¸æ˜¯æ˜¯ä¸æ˜¯å¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼ŒKè¡¨ç¤ºå¼€æœºä¸å¯åŠ¨ï¼ŒSè¡¨ç¤ºå¼€æœºå°±å¯åŠ¨</li>
<li>â‘¡ç¬¬äºŒä¸ªéƒ¨åˆ†æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¿™ä¸ªæ•°å­—ä»£è¡¨çš„æ˜¯è¯¥æœåŠ¡çš„å¯åŠ¨é¡ºåºï¼ŒæœåŠ¡å¯åŠ¨çš„é¡ºåºéå¸¸çš„é‡è¦ï¼Œä¾‹å¦‚æˆ‘ä»¬çš„ç½‘ç»œæœåŠ¡éœ€è¦åœ¨é‚®ä»¶æœåŠ¡ä¹‹å‰å¯åŠ¨</li>
<li>â‘¢ç¬¬ä¸‰ä¸ªéƒ¨åˆ†å°±æ˜¯å¯¹åº”æœåŠ¡çš„åå­—ï¼Œè¯¥é“¾æ¥æ–‡ä»¶å…¶å®éƒ½æ˜¯æŒ‡å‘çš„æ˜¯ init.d è¿™ä¸ªç›®å½•ä¸‹çš„System Vè„šæœ¬æ–‡ä»¶</li>
</ul>
<p>æˆ‘ä»¬å¦‚æœå¸Œæœ›æŸæœåŠ¡å¼€æœºå°±å¯åŠ¨ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ rc5.d ç›®å½•ä¸‹çš„é“¾æ¥æ–‡ä»¶ï¼Œä¸è¿‡è¿™æ ·åšå¾ˆéº»çƒ¦ï¼ŒLinuxç³»ç»Ÿæä¾›äº†ä¸€ä¸ª <code>chkconfig</code> å‘½ä»¤å¯ä»¥æ¥è®¾ç½®æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨</p>
<p>æˆ‘ä»¬é€šè¿‡ <code>chkconfig --list</code> å‘½ä»¤æ¥æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„å¼€æœºå¯åŠ¨æƒ…å†µ</p>
<p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦è®¾ç½® network æœåŠ¡å¼€å¯è‡ªåŠ¨å¯åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>chkconfig httpd on</code> å‘½ä»¤å³å¯</p>
<p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦è®¾ç½® network æœåŠ¡å¼€å¯ä¸å¯åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>chkconfig httpd off</code> å‘½ä»¤å³å¯</p>
<h4 id="xinetd"><a href="#xinetd" class="headerlink" title="xinetd"></a>xinetd</h4><p>å…¶å®å¯¹äºä¸Šé¢é€šè¿‡ System Væ¥ç®¡ç†çš„ä¸€äº›æœåŠ¡éƒ½å±äºLinuxç³»ç»Ÿçš„å¸¸é©»è¿è¡Œçš„æœåŠ¡ï¼Œå…¶å®åœ¨Linuxç³»ç»Ÿä¸­è¿˜æœ‰è®¸å¤šä¸å¸¸é©»çš„ä¸€äº›æœåŠ¡ï¼Œä¾‹å¦‚ telnetã€rsyncæœåŠ¡ï¼Œè¿™äº›æœåŠ¡åˆ™æ˜¯é€šè¿‡ xinetd è¿™ä¸ªæœåŠ¡æ¥è¿›è¡Œç®¡ç†çš„ã€‚</p>
<p>xinetd æ§åˆ¶çš„å°±æ˜¯é‚£äº›ä¸å¸¸é©»çš„æœåŠ¡ï¼ŒåŠŸèƒ½è¾ƒä¸ºç®€å•çš„æœåŠ¡</p>
<p>xinetdå…¶å®è‡ªå·±æœ¬èº«å°±æ˜¯ä½œä¸ºä¸€ä¸ªç³»ç»Ÿçš„å¸¸é©»çš„æœåŠ¡è¿è¡Œåœ¨åå°ï¼Œè€Œxinetdæ‰€æ§åˆ¶çš„æœåŠ¡åœ¨æ²¡æœ‰è¿æ¥è¯·æ±‚çš„æ—¶å€™æ˜¯ä¸è¿è¡Œçš„ï¼Œæ‰€æœ‰xinetdæ§åˆ¶çš„æœåŠ¡çš„è¿æ¥è¯·æ±‚éƒ½ä¼šæäº¤ç»™xinetdæ¥è¿›è¡Œä»£ç†</p>
<p>xinetdåœ¨æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚åï¼Œä¼šæ ¹æ®è¯·æ±‚çš„åè®®åŠæœåŠ¡å¯åŠ¨ç›¸åº”çš„æœåŠ¡è¿›ç¨‹ï¼Œè¿›ç¨‹å¤„ç†å®Œåè¯·æ±‚å°±ä¼šç»“æŸ</p>
<p>xinetdæœ¬èº«å°±æ˜¯ä¸€ä¸ªç³»ç»ŸæœåŠ¡ï¼Œé€šè¿‡ System Væ¥å¯¹å…¶è¿›è¡Œç®¡ç†ï¼Œåœ¨CentOS6/RHEL6ä¸­ï¼ŒxinetdæœåŠ¡é»˜è®¤æ˜¯æ²¡æœ‰å®‰è£…çš„ï¼Œæˆ‘ä»¬è‹¥è¦ä½¿ç”¨è¯¥æœåŠ¡ï¼Œé¦–å…ˆéœ€è¦å®‰è£…å®ƒ<code>yum install xinetd</code></p>
<p>åœ¨æˆ‘ä»¬å®‰è£…å¥½æˆ‘ä»¬çš„<code>xinetd</code>æœåŠ¡ä»¥åï¼Œæˆ‘ä»¬è¿™æ—¶å†é€šè¿‡ <code>chkconfig --list</code> å‘½ä»¤æ¥æŸ¥çœ‹æ‰€æœ‰çš„æœåŠ¡å¯åŠ¨è®¾ç½®</p>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨å®‰è£…äº†xinetdæœåŠ¡ä»¥åï¼Œå…¶ä¸‹é¢å‡ºç°äº†ä¸€äº›å…¶ä»–çš„æœåŠ¡é€‰é¡¹ï¼Œä¾‹å¦‚<code>rsync</code>ï¼Œ<code>chargen-dgram</code>ç­‰è¿™äº›æœåŠ¡ï¼Œè¿™äº›æœåŠ¡éƒ½æ˜¯ç³»ç»Ÿçš„ä¸€äº›ä¸å¸¸é©»æœåŠ¡ï¼Œéƒ½æ˜¯é€šè¿‡xinetdè¿™ä¸ªæœåŠ¡æ¥å¯¹å…¶è¿›è¡Œç®¡ç†çš„</p>
<p><code>xinetd</code>æœåŠ¡çš„é…ç½®æ–‡ä»¶æ˜¯ <code>/etc/xinetd.conf</code></p>
<h3 id="ç«¯å£å·"><a href="#ç«¯å£å·" class="headerlink" title="ç«¯å£å·"></a>ç«¯å£å·</h3><ul>
<li>æŸ¥çœ‹ <code>netstat -luntp</code></li>
<li>è½¯ä»¶å    <code>net-tools</code></li>
</ul>
<h3 id="åŸºç¡€æœåŠ¡æ€»ç»“"><a href="#åŸºç¡€æœåŠ¡æ€»ç»“" class="headerlink" title="åŸºç¡€æœåŠ¡æ€»ç»“"></a>åŸºç¡€æœåŠ¡æ€»ç»“</h3><p><strong>RHEL 6</strong></p>
<p>æœåŠ¡çš„å¯åŠ¨ åœæ­¢ é‡å¯ çŠ¶æ€    <code>service æœåŠ¡å [start | stop | restart | status]</code></p>
<p>æœåŠ¡å¼€æœºå¯åŠ¨çŠ¶æ€        <code>chkconfig --list</code></p>
<p>è®¾ç½®æœåŠ¡å¼€æœºå¯åŠ¨        <code>chkconfig æœåŠ¡å on</code></p>
<p>è®¾ç½®æœåŠ¡å¼€æœºä¸å¯åŠ¨        <code>chkconfig æœåŠ¡å off</code></p>
<p><strong>RHEL 7</strong></p>
<p>æœåŠ¡çš„å¯åŠ¨ åœæ­¢ é‡å¯ çŠ¶æ€    <code>systemctl [start | stop | restart | status] æœåŠ¡å</code></p>
<p>è®¾ç½®æœåŠ¡å¼€æœºå¯åŠ¨        <code>systemctl enable æœåŠ¡å</code></p>
<p>è®¾ç½®æœåŠ¡å¼€æœºä¸å¯åŠ¨        <code>systemctl disable æœåŠ¡å</code></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxåŸºç¡€æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>DNSåŸŸåè§£ææœåŠ¡</title>
    <url>/2016/12/23/booboo_easy_service/01_dns/</url>
    <content><![CDATA[<blockquote>
<p>è¯¾ç¨‹è¦æ±‚</p>
</blockquote>
<ol>
<li>åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸€å°åŸŸåè§£ææœåŠ¡å™¨DNSæ­£åè§£æ</li>
<li>åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸¤å°åŸŸåè§£ææœåŠ¡å™¨åšDNSä¸»è¾…åŒæ­¥</li>
</ol>
<h3 id="DNSæœåŠ¡"><a href="#DNSæœåŠ¡" class="headerlink" title="DNSæœåŠ¡"></a>DNSæœåŠ¡</h3><p>å…¨ç§°æ˜¯domain name serveråŸŸåè§£ææœåŠ¡ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“æ¯ä¸ªè”ç½‘çš„è®¡ç®—æœºéƒ½æœ‰ä¸€ä¸ªipåœ°å€å§ï¼ŸIpåœ°å€æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„å‘¢ï¼ŸIpåœ°å€æ˜¯ç”¨æ¥å’Œäº’è”ç½‘ä¸Šåˆ«çš„æœºå™¨è¿›è¡Œé€šè®¯çš„ã€‚ä½†æ˜¯ipåœ°å€å¾ˆéš¾è®°å§ï¼Ÿä¸€ä¸¤ä¸ªipåœ°å€å¯èƒ½è¿˜å¥½ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬æ¯å¤©è¦è®¿é—®çš„ç½‘é¡µä¸ä»…ä»…åªæœ‰ä¸€ä¸¤ä¸ªå§ï¼Ÿ</p>
<p>æˆ‘ä»¬è®°å¾—éƒ½æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a>. <a href="http://www.sina.comã€‚æˆ‘ä»¬è®°ä½çš„å…¶å®éƒ½æ˜¯å­—ç¬¦ï¼Œéƒ½æ˜¯åŸŸåã€‚å°±åƒæˆ‘ä»¬çš„ç”µè¯å·ç ï¼Œå¾ˆéš¾è®°ï¼Œäºæ˜¯æˆ‘ä»¬æŠŠç”µè¯å·ç å­˜åˆ°æ‰‹æœºé‡Œï¼Œç»™ä»–èµ·ä¸ªæ˜µç§°æˆ–è€…ç›´æ¥è¾“å…¥äººåå¯¹å§ï¼ŒæŠŠç”µè¯å·ç å¯¹åº”æˆäººåå§ï¼Ÿç„¶åæ‰“ç”µè¯çš„æ—¶å€™å°±ç›´æ¥æ‰¾åˆ°è¿™ä¸ªäººåå°±å¥½äº†ã€‚">www.sina.comã€‚æˆ‘ä»¬è®°ä½çš„å…¶å®éƒ½æ˜¯å­—ç¬¦ï¼Œéƒ½æ˜¯åŸŸåã€‚å°±åƒæˆ‘ä»¬çš„ç”µè¯å·ç ï¼Œå¾ˆéš¾è®°ï¼Œäºæ˜¯æˆ‘ä»¬æŠŠç”µè¯å·ç å­˜åˆ°æ‰‹æœºé‡Œï¼Œç»™ä»–èµ·ä¸ªæ˜µç§°æˆ–è€…ç›´æ¥è¾“å…¥äººåå¯¹å§ï¼ŒæŠŠç”µè¯å·ç å¯¹åº”æˆäººåå§ï¼Ÿç„¶åæ‰“ç”µè¯çš„æ—¶å€™å°±ç›´æ¥æ‰¾åˆ°è¿™ä¸ªäººåå°±å¥½äº†ã€‚</a></p>
<p>æ‰€ä»¥æˆ‘ä»¬ç³»ç»Ÿä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¼šæŠŠipåœ°å€å¯¹åº”æˆä¸€ä¸ªä¸»æœºåã€‚åœ¨æˆ‘ä»¬ç³»ç»Ÿé‡Œæœ‰è¿™ä¹ˆä¸€ä¸ªæ–‡ä»¶ï¼Œå°±æ˜¯ä¸“é—¨ç”¨æ¥åšå¯¹åº”å…³ç³»çš„ï¼Œè¿™ä¸ªæ–‡ä»¶å«<code>/etc/hosts/</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€æ¥çœ‹ä¸€ä¸‹ï¼Œä¸€æ¡è®°å½•ä¸€è¡Œï¼Œè¡Œé‡Œé¢å°±æ˜¯ä¸»æœºåå’Œipåœ°å€ï¼Œå½“ç„¶ä¸€ä¸ªipåœ°å€å¯ä»¥å¯¹åº”å¤šä¸ªä¸»æœºåï¼Œå°±åƒäººæœ‰å¾ˆå¤šçš„æ˜µç§°ä¸€æ ·ã€‚</p>
<p>é‚£ä¹ˆè¿™æ ·æ˜¯ä¸æ˜¯å°±è§£å†³é—®é¢˜äº†ï¼Œå½“æˆ‘ä»¬æƒ³è¦è®¿é—®ä¸€ä¸ªç½‘ç«™çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¸ç”¨è¾“å…¥ipåœ°å€ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥è¾“å…¥ä¸»æœºåå°±è¡Œäº†ï¼Œæœºå™¨ä¼šå¸®æˆ‘ä»¬åšä¸€ä¸ªè§£æï¼ŒæŠŠä¸»æœºåå¯¹åº”æˆipåœ°å€è¿›è¡Œé€šä¿¡ã€‚æ—©æœŸè¿™æ ·åšçš„ç¡®æ²¡é—®é¢˜ï¼Œä½†æ˜¯éšç€äº’è”ç½‘æ„ˆå‘çš„å£®å¤§ï¼Œè¿™ä¸ªæ–‡ä»¶å°±ä¸é‚£ä¹ˆå®ç”¨äº†ã€‚æˆ‘ä»¬è¦åœ¨æœºå™¨ä¸Šé…ç½®å¤§é‡çš„å¯¹åº”å…³ç³»ï¼Œæ˜¯éå¸¸è€—æ—¶ï¼Œéå¸¸éº»çƒ¦çš„ï¼Œè€Œä¸”è¦é…ç½®çš„æœºå™¨å¯ä¸æ­¢ä¸€å°ã€‚æ¯”å¦‚è¯´æˆ‘æ˜¯ç™¾åº¦ï¼Œæˆ‘å¸Œæœ›ä¸–ç•Œä¸Šæ‰€æœ‰çš„äººéƒ½è¦æ¥è®¿é—®æˆ‘çš„ç½‘é¡µï¼Œé‚£ä¹ˆï¼Œæˆ‘æ˜¯ä¸æ˜¯éœ€è¦è®©ä¸–ç•Œä¸Šæ‰€æœ‰çš„äººéƒ½å»æ·»åŠ æˆ‘çš„ipåœ°å€å’Œä¸»æœºåçš„å¯¹åº”å…³ç³»ã€‚è¿™ä¸ªæ˜¯éå¸¸éš¾åšåˆ°çš„äº‹æƒ…ï¼Œå·¥ä½œé‡å¤ªå¤§ã€‚äºæ˜¯æˆ‘ä»¬å°±å¼•å…¥äº†ä¸€ç§æ–°çš„æœºåˆ¶ã€‚</p>
<h3 id="DNSçš„å®ç°åŸç†"><a href="#DNSçš„å®ç°åŸç†" class="headerlink" title="DNSçš„å®ç°åŸç†"></a>DNSçš„å®ç°åŸç†</h3><p>è¿™ç§æœºåˆ¶çš„ä½œç”¨å’Œhostsæ–‡ä»¶ä¸€æ ·ï¼Œä½†æ˜¯å®ç°æ–¹æ³•å´ä¸ä¸€æ ·ï¼Œè¿™ä¸ªæœºåˆ¶å°±å«DNS (Domain name server)ã€‚é€šè¿‡dnsï¼Œæˆ‘ä»¬å¯ä»¥è§£å†³è¿™ä¸ªå¤§æ‰¹é‡åŸŸåè§£æçš„é—®é¢˜ã€‚é‚£å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿè¿™å°±æ˜¯dnsçš„ç»“æ„æ–¹é¢çš„é—®é¢˜äº†ã€‚</p>
<p>æˆ‘ä»¬ä¹‹å‰è¯´æˆ‘ä»¬çš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„ç»“æ„ï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸ªåˆ†å±‚å¼çš„ç»“æ„ï¼Œè¿™ä¸ªç»“æ„çš„ä½“ç°æ–¹å¼å°±æ˜¯ç›®å½•å§ï¼Ÿå¯¹ä¸å¯¹ã€‚Dnsä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå®ƒä¹Ÿé‡‡ç”¨äº†åˆ†å±‚å¸‚ç®¡ç†çš„æ–¹å¼ã€‚</p>
<p>ä¸è¿‡ä¸åŒäºç›®å½•ï¼Œæˆ‘ä»¬çš„ç›®å½•æ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”¨æ¥å¸®åŠ©æˆ‘ä»¬ç†è§£æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ç§æ–¹å¼ã€‚è€Œdnsï¼Œä»–æ˜¯å®å®åœ¨åœ¨çš„ä¸€ç§ç®¡ç†ç»“æ„ã€‚</p>
<p>é‚£æˆ‘ä»¬æ¥çœ‹ï¼Œç›®å½•çš„è‡³é«˜ç‚¹æ˜¯ä»€ä¹ˆã€‚æ˜¯æ ¹å§ï¼Œå¯¹ä¸å¯¹ï¼Œé‚£ä¹ˆå¯¹äºæˆ‘ä»¬dnsæ¥è¯´ï¼Œæ—¢ç„¶æ˜¯åˆ†å±‚å¼ç®¡ç†ç»“æ„ï¼Œå®ƒä¹Ÿéœ€è¦æœ‰ä¸€ä¸ªè‡³é«˜ç‚¹å§ã€‚è¿™ä¸ªè‡³é«˜ç‚¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æŠŠå®ƒç§°ä½œæ ¹åŸŸï¼Œä»¥ç‚¹ä»£è¡¨æ ¹åŸŸã€‚å…¨ä¸–ç•Œæ€»å…±æœ‰13å°æ ¹åŸŸï¼Œæ˜¯å¤„äºè‡³é«˜æ— ä¸Šçš„ä½ç½®çš„ï¼Œåªæœ‰13å°æœºå™¨ã€‚</p>
<p>é‚£ä¹ˆæ ¹åŸŸä¸‹é¢å°±æ˜¯é¡¶çº§åŸŸäº†ï¼Œé€šå¸¸æˆ‘ä»¬çœ‹åˆ°çš„é¡¶çº§åŸŸæœ‰è¿™ä¸ªcomã€‚æœ‰orgï¼Œæœ‰cnè¿˜æœ‰eduç­‰ç­‰ï¼Œè¿™äº›éƒ½æ˜¯é¡¶çº§åŸŸã€‚é¡¶çº§åŸŸä¸‹é¢ç®¡ç†äºŒçº§åŸŸï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p>FQDNï¼šä¸»æœºååŠ ä¸ŠåŸŸåï¼Œè¢«ç§°ä½œå®Œå…¨åˆæ ¼çš„åŸŸåï¼Œfqdnã€‚å…¶å®comåé¢åº”è¯¥æœ‰ä¸ªç‚¹çš„ï¼Œä»£è¡¨æ ¹åŸŸã€‚åªä¸è¿‡æˆ‘ä»¬ç°åœ¨ä¹ æƒ¯æ€§çš„å°†å…¶çœç•¥äº†ã€‚å°±å¥½åƒå›½å®¶ç®¡ç†çœï¼Œçœç®¡ç†å¸‚ï¼Œå¸‚ç®¡ç†å¿ç­‰ç­‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å®Œæ•´çš„åŸŸå	www.baidu.com.</span><br><span class="line">.	æ ¹åŸŸ	å…¨çƒä¸€å…±13ä¸ªæ ¹åŸŸ</span><br><span class="line">.com	è¶…çº§åŸŸï¼Œä¸€çº§åŸŸ</span><br><span class="line">.baidu	äºŒçº§åŸŸ</span><br><span class="line">www	ä¸»æœºå</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>ä¸¾ä¾‹ï¼šå¯»æ‰¾æ–°æµªçš„æ–¹å¼ã€‚</p>
</blockquote>
</blockquote>
<ol>
<li>å…ˆçœ‹æœ¬åœ°<code>/etc/hosts</code>æœ‰æ²¡æœ‰è®°å½•ã€‚</li>
<li>æ‰¾å¦å¤–ä¸€ä¸ªäººé—®ï¼Œâ€“&gt;æ‰¾DNSæœåŠ¡å™¨å»é—®ã€‚ åœ¨<code>/etc/resolv.conf</code>æ–‡ä»¶ä¸­æŒ‡å®šäº†æ‰¾è°å»é—®ã€‚</li>
</ol>
<p>å½“ç„¶ï¼Œè¿™å…ˆåé¡ºåºä¹Ÿæ˜¯ç”±æŸä¸ªæ–‡ä»¶å†³å®šçš„ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯<code>/etc/nsswitch.conf</code>.</p>
<p>Windowsä¸Šé¢ä¹Ÿæœ‰</p>
<p>ç½‘ä¸Šé‚»å±…&gt;å±æ€§&gt;æœ¬åœ°è¿æ¥ã€‚</p>
<p><strong>DNSçš„ä¸¤ç§æŸ¥è¯¢æ–¹å¼</strong> å¯¹äºDNSæœåŠ¡å™¨ï¼Œä»–å¯èƒ½çŸ¥é“ä¹Ÿå¯èƒ½ä¸çŸ¥é“ï¼Œ</p>
<p>çŸ¥é“çš„æƒ…å†µæœ‰ä¸¤ç§ï¼š</p>
<ol>
<li>æœ¬åœ°æœ‰è¿™ä¸ªåŸŸï¼Œèƒ½å¤Ÿè§£æåˆ°</li>
<li>æœ¬åœ°æœ‰ç¼“å­˜ï¼Œå…¶ä»–äººå·²ç»æ¥é—®è¿‡sinaæ˜¯è°ï¼Œé‚£ä¹ˆDNSæœåŠ¡å™¨å¯ä»¥å°†è¯¥ç»“æœç›´æ¥è¿”å›ç»™å®¢æˆ·ã€‚</li>
</ol>
<p>ä¸çŸ¥é“çš„è¯å°±ä¼šå»æ‰¾è‡ªå·±çš„ä¸Šçº§åŸŸï¼Œç„¶åé€šè¿‡ç­‰å¾…ä¸Šçº§åŸŸçš„åé¦ˆï¼Œå°†åé¦ˆä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™ç§æ–¹å¼å«åšé€’å½’æŸ¥è¯¢ã€‚</p>
<p>é‚£ä¹ˆè¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯ï¼ŒDNSå»è¯¢é—®ä¸Šçº§åŸŸï¼Œç„¶åä¸Šçº§åŸŸå°†å¯¹åº”çš„åŒçº§DNSæœåŠ¡å™¨åé¦ˆå›æ¥ï¼Œç”±å®¢æˆ·ç«¯å»è¯¢é—®æ–°çš„DNSæœåŠ¡å™¨æ¥æ‰¾å¯»ç½‘â€â€å€å¯¹åº”çš„IPåœ°å€ã€‚è¿™ç§å«åšè¿­ä»£æŸ¥è¯¢</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www.sina.com.</span><br><span class="line">1)æ‰¾æ ¹åŸŸ.</span><br><span class="line">2)æ‰¾è¶…çº§åŸŸ.com</span><br><span class="line">3)æ‰¾äºŒçº§åŸŸ.sina</span><br><span class="line">4)æˆåŠŸæ‰¾åˆ°www</span><br></pre></td></tr></table></figure>


<h3 id="å®æˆ˜é¡¹ç›®1-åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸€å°åŸŸåè§£ææœåŠ¡å™¨DNSæ­£åè§£æ"><a href="#å®æˆ˜é¡¹ç›®1-åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸€å°åŸŸåè§£ææœåŠ¡å™¨DNSæ­£åè§£æ" class="headerlink" title="å®æˆ˜é¡¹ç›®1:åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸€å°åŸŸåè§£ææœåŠ¡å™¨DNSæ­£åè§£æ"></a>å®æˆ˜é¡¹ç›®1:åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸€å°åŸŸåè§£ææœåŠ¡å™¨DNSæ­£åè§£æ</h3><blockquote>
<p>1)åœ¨rhel6ä¸Šé…ç½®dnsåŸŸåè§£ææœåŠ¡ï¼Œè§£æuplooking.comåŸŸåï¼Œè¦æ±‚å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">        NS      @</span><br><span class="line">        A       172.25.0.11</span><br><span class="line">www     A       172.25.0.10</span><br><span class="line">        MX 5    mail</span><br><span class="line">mail    A       172.25.0.10</span><br><span class="line">ftp     A       172.25.0.10</span><br><span class="line">bbs	CNAME	ftp</span><br></pre></td></tr></table></figure>
<blockquote>
<p>2)é…ç½®åå‘è§£æ172.25.0.10å’Œ172.25.0.11ï¼›</p>
</blockquote>
<blockquote>
<p>3)è¦æ±‚rhel6å’Œrhel7è¿™ä¸¤å°æœåŠ¡å™¨çš„åŸŸåè§£ææœåŠ¡å™¨ä¸º172.25.0.11è¿™å°æœåŠ¡å™¨ã€‚</p>
</blockquote>
<h4 id="å®éªŒå‡†å¤‡é˜¶æ®µ"><a href="#å®éªŒå‡†å¤‡é˜¶æ®µ" class="headerlink" title="å®éªŒå‡†å¤‡é˜¶æ®µ"></a>å®éªŒå‡†å¤‡é˜¶æ®µ</h4><ol>
<li>ç”»å‡ºç½‘ç»œæ‹“æ‰‘å›¾</li>
<li>è§„åˆ’ä¸åŒæœåŠ¡å™¨éœ€è¦å®‰è£…çš„è½¯ä»¶(osâ€“softç‰ˆæœ¬)</li>
<li>å¼€å§‹å®‰è£…</li>
<li>é…ç½®æœåŠ¡</li>
<li>å¯åŠ¨æœåŠ¡</li>
<li>æµ‹è¯•æ’é”™</li>
</ol>
<blockquote>
<p>è¯¦ç»†æ­¥éª¤æ¦‚è§ˆ</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">num</th>
<th align="left">step</th>
<th align="left">man</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1)</td>
<td align="left">å®‰è£…è½¯ä»¶</td>
<td align="left">bind bind-chroot</td>
</tr>
<tr>
<td align="left">2)</td>
<td align="left">æŸ¥çœ‹è½¯ä»¶æ¶æ„</td>
<td align="left">rpm -ql</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">æ—¥å¿—</td>
<td align="left">/var/log/named.log</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">æ•°æ®</td>
<td align="left">/var/named/</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">é…ç½®</td>
<td align="left">/etc/named.conf</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left">/etc/named.rfc1912.zones</td>
</tr>
<tr>
<td align="left">3)</td>
<td align="left">ä¿®æ”¹é…ç½®æ–‡ä»¶</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">4)</td>
<td align="left">å¯åŠ¨æœåŠ¡</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">service</td>
<td align="left">named</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">daemon</td>
<td align="left">named</td>
</tr>
<tr>
<td align="left">4.1ï¼‰</td>
<td align="left">æ’é™¤é”™è¯¯</td>
<td align="left">çœ‹æ—¥å¿—</td>
</tr>
<tr>
<td align="left">5)</td>
<td align="left">æµ‹è¯•</td>
<td align="left">nslookup</td>
</tr>
<tr>
<td align="left">5.1ï¼‰</td>
<td align="left">æ’é”™</td>
<td align="left">çœ‹æ—¥å¿—</td>
</tr>
</tbody></table>
<blockquote>
<p>ç½‘ç»œæ‹“æ‰‘å›¾</p>
</blockquote>
<p><img src="pic/12.png" alt="12"></p>
<blockquote>
<p>è§„åˆ’æœåŠ¡å™¨è½¯ä»¶</p>
</blockquote>
<p><img src="pic/11.png" alt="11"></p>
<blockquote>
<p>å¼€å§‹å®‰è£…</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# yum install -y bind bind-chroot</span><br><span class="line">Loaded plugins: product-id, refresh-packagekit, security, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">server                                                   | 3.9 kB     00:00     </span><br><span class="line">Setting up Install Process</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package bind.x86_64 32:9.8.2-0.17.rc1.el6_4.6 will be installed</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package <span class="built_in">bind</span>-chroot.x86_64 32:9.8.2-0.17.rc1.el6_4.6 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line"> Package          Arch        Version                         Repository   Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> bind             x86_64      32:9.8.2-0.17.rc1.el6_4.6       server      4.0 M</span><br><span class="line"> bind-chroot      x86_64      32:9.8.2-0.17.rc1.el6_4.6       server       71 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install       2 Package(s)</span><br><span class="line"></span><br><span class="line">Total download size: 4.0 M</span><br><span class="line">Installed size: 7.3 M</span><br><span class="line">Downloading Packages:</span><br><span class="line">(1/2): bind-9.8.2-0.17.rc1.el6_4.6.x86_64.rpm            | 4.0 MB     00:00     </span><br><span class="line">(2/2): bind-chroot-9.8.2-0.17.rc1.el6_4.6.x86_64.rpm     |  71 kB     00:00     </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                            23 MB/s | 4.0 MB     00:00     </span><br><span class="line">Running rpm_check_debug</span><br><span class="line">Running Transaction Test</span><br><span class="line">Transaction Test Succeeded</span><br><span class="line">Running Transaction</span><br><span class="line">  Installing : 32:bind-9.8.2-0.17.rc1.el6_4.6.x86_64                        1/2</span><br><span class="line">  Installing : 32:bind-chroot-9.8.2-0.17.rc1.el6_4.6.x86_64                 2/2</span><br><span class="line">  Verifying  : 32:bind-9.8.2-0.17.rc1.el6_4.6.x86_64                        1/2</span><br><span class="line">  Verifying  : 32:bind-chroot-9.8.2-0.17.rc1.el6_4.6.x86_64                 2/2</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  bind.x86_64 32:9.8.2-0.17.rc1.el6_4.6                                         </span><br><span class="line">  bind-chroot.x86_64 32:9.8.2-0.17.rc1.el6_4.6                                  </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@rhel6 ~]# rpm -ql bind</span><br><span class="line">/etc/NetworkManager/dispatcher.d/13-named</span><br><span class="line">/etc/logrotate.d/named</span><br><span class="line">/etc/named</span><br><span class="line">/etc/named.conf</span><br><span class="line">/etc/named.iscdlv.key</span><br><span class="line">/etc/named.rfc1912.zones</span><br><span class="line">/etc/named.root.key</span><br><span class="line">/etc/portreserve/named</span><br><span class="line">/etc/rc.d/init.d/named</span><br><span class="line">/etc/rndc.conf</span><br><span class="line">/etc/rndc.key</span><br><span class="line">/etc/sysconfig/named</span><br><span class="line">/usr/lib64/bind</span><br><span class="line">/usr/sbin/arpaname</span><br><span class="line">/usr/sbin/ddns-confgen</span><br><span class="line">/usr/sbin/dnssec-dsfromkey</span><br><span class="line">/usr/sbin/dnssec-keyfromlabel</span><br><span class="line">/usr/sbin/dnssec-keygen</span><br><span class="line">/usr/sbin/dnssec-revoke</span><br><span class="line">/usr/sbin/dnssec-settime</span><br><span class="line">/usr/sbin/dnssec-signzone</span><br><span class="line">/usr/sbin/genrandom</span><br><span class="line">/usr/sbin/isc-hmac-fixup</span><br><span class="line">/usr/sbin/lwresd</span><br><span class="line">/usr/sbin/named</span><br><span class="line">/usr/sbin/named-checkconf</span><br><span class="line">/usr/sbin/named-checkzone</span><br><span class="line">/usr/sbin/named-compilezone</span><br><span class="line">/usr/sbin/named-journalprint</span><br><span class="line">/usr/sbin/nsec3hash</span><br><span class="line">/usr/sbin/rndc</span><br><span class="line">/usr/sbin/rndc-confgen</span><br><span class="line">/usr/share/doc/bind-9.8.2</span><br><span class="line">... ...</span><br><span class="line">/var/log/named.log</span><br><span class="line">/var/named</span><br><span class="line">/var/named/data</span><br><span class="line">/var/named/dynamic</span><br><span class="line">/var/named/named.ca</span><br><span class="line">/var/named/named.empty</span><br><span class="line">/var/named/named.localhost</span><br><span class="line">/var/named/named.loopback</span><br><span class="line">/var/named/slaves</span><br><span class="line">/var/run/named</span><br><span class="line">[root@rhel6 ~]# rpm -ql bind-chroot</span><br><span class="line">/var/named/chroot</span><br><span class="line">/var/named/chroot/dev</span><br><span class="line">/var/named/chroot/dev/null</span><br><span class="line">/var/named/chroot/dev/random</span><br><span class="line">/var/named/chroot/dev/zero</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é…ç½®æ–‡ä»¶</p>
</blockquote>
<blockquote>
<blockquote>
<p>/etc/named.conf</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">listen-on port 53 &#123; any; &#125;;</span><br><span class="line">listen-on-v6 port 53 &#123; any; &#125;;</span><br><span class="line">directory 	"/var/named";</span><br><span class="line">dump-file 	"/var/named/data/cache_dump.db";</span><br><span class="line">       statistics-file "/var/named/data/named_stats.txt";</span><br><span class="line">       memstatistics-file "/var/named/data/named_mem_stats.txt";</span><br><span class="line">allow-query     &#123; any; &#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>/etc/named.rfc1912.zones</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ­£è§£æ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åŸŸå--&gt;ip</span></span><br><span class="line">zone "uplooking.com" IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file "named.uplooking";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#</span><span class="bash"> åè§£æ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ip---&gt;åŸŸå</span></span><br><span class="line">zone "0.25.172.in-addr.arpa" IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file "named.arpa.uplooking";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>/var/named/named.uplooking</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">TTL 1D</span></span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">	                                       3H )    ; minimum</span><br><span class="line">ä¸»æœºå	ä¸»è¦è®°å½•	ip</span><br><span class="line">        NS      @</span><br><span class="line">        A       172.25.0.11</span><br><span class="line">www     A       172.25.0.10</span><br><span class="line">        MX 5    mail</span><br><span class="line">mail    A       172.25.0.10</span><br><span class="line">ftp     A       172.25.0.10</span><br><span class="line">bbs	CNAME	ftp</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„</strong> æ–‡ä»¶çš„æ‰€å±è€…å’Œæ‰€å±ç»„ä»¥åŠæ–‡ä»¶çš„ugoæƒé™</p>
<blockquote>
<blockquote>
<p>named.arpa.uplooking</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">TTL 1D</span></span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      uplooking.com.</span><br><span class="line">11      PTR     uplooking.com.</span><br><span class="line">10      PTR     www.uplooking.com.</span><br><span class="line">10      PTR     mail.uplooking.com.</span><br><span class="line">10      PTR     ftp.uplooking.com.</span><br><span class="line">10      PTR     bbs.uplooking.com.</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼š</strong>    NSåé¢æ­¤æ—¶ä¸€å®šè¦å°†@æ¢æˆåŸŸåuplooking.com.åŸŸåå¿…é¡»å†™å®Œæ•´çš„åŸŸåï¼Œå¸¦æ ¹åŸŸçš„</p>
<blockquote>
<p>æœåŠ¡çš„å¯åŠ¨</p>
</blockquote>
<ul>
<li>rhel6    <code>service named start</code></li>
<li>rhel7    <code>systemctl start named</code></li>
</ul>
<blockquote>
<p>é˜²ç«å¢™çš„å…³é—­</p>
</blockquote>
<ul>
<li>rhel6    <code>service iptables stop</code></li>
<li>rhel7    <code>systemctl stop firewalld</code></li>
</ul>
<p><strong>å¦‚æœæœåŠ¡å¯åŠ¨ä¸äº†</strong> é‚£ä¹ˆå°è¯•æ‰§è¡Œä»¥ä¸‹è¯­å¥<code>rndc-confgen -a -r /etc/named.conf</code></p>
<blockquote>
<p>æµ‹è¯•</p>
</blockquote>
<ol>
<li><code>/etc/hosts</code>        ç³»ç»Ÿç®¡ç†å‘˜æ‰‹åŠ¨å†™</li>
<li><code>/etc/resolv.conf</code>â€”-ã€‹æŒ‡å®šæ‰¾å“ªä¸ªåŸŸåè§£ææœåŠ¡å™¨<code>nameserver 172.25.0.11</code></li>
<li>é€šè¿‡<code>nslookup</code>å‘½ä»¤</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[root@rhel6 named]# nslookup</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> www.uplooking.com</span></span><br><span class="line">Server:		172.25.0.11</span><br><span class="line">Address:	172.25.0.11#53</span><br><span class="line"></span><br><span class="line">Name:	www.uplooking.com</span><br><span class="line">Address: 172.25.0.10</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> mail.uplooking.com</span></span><br><span class="line">Server:		172.25.0.11</span><br><span class="line">Address:	172.25.0.11#53</span><br><span class="line"></span><br><span class="line">Name:	mail.uplooking.com</span><br><span class="line">Address: 172.25.0.10</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> ftp.uplooking.com</span></span><br><span class="line">Server:		172.25.0.11</span><br><span class="line">Address:	172.25.0.11#53</span><br><span class="line"></span><br><span class="line">Name:	ftp.uplooking.com</span><br><span class="line">Address: 172.25.0.10</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> uplooking.com</span></span><br><span class="line">Server:		172.25.0.11</span><br><span class="line">Address:	172.25.0.11#53</span><br><span class="line"></span><br><span class="line">Name:	uplooking.com</span><br><span class="line">Address: 172.25.0.11</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> bbs.uplooking.com</span></span><br><span class="line">Server:		172.25.0.11</span><br><span class="line">Address:	172.25.0.11#53</span><br><span class="line"></span><br><span class="line">bbs.uplooking.com	canonical name = ftp.uplooking.com.</span><br><span class="line">Name:	ftp.uplooking.com</span><br><span class="line">Address: 172.25.0.10</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 172.25.0.10</span></span><br><span class="line">Server:		172.25.0.11</span><br><span class="line">Address:	172.25.0.11#53</span><br><span class="line"></span><br><span class="line">10.0.25.172.in-addr.arpa	name = bbs.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpa	name = www.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpa	name = mail.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpa	name = ftp.uplooking.com.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 172.25.0.11</span></span><br><span class="line">Server:		172.25.0.11</span><br><span class="line">Address:	172.25.0.11#53</span><br><span class="line"></span><br><span class="line">11.0.25.172.in-addr.arpa	name = uplooking.com.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">exit</span></span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="å®æˆ˜é¡¹ç›®2-åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸¤å°åŸŸåè§£ææœåŠ¡å™¨åšDNSä¸»è¾…åŒæ­¥"><a href="#å®æˆ˜é¡¹ç›®2-åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸¤å°åŸŸåè§£ææœåŠ¡å™¨åšDNSä¸»è¾…åŒæ­¥" class="headerlink" title="å®æˆ˜é¡¹ç›®2:åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸¤å°åŸŸåè§£ææœåŠ¡å™¨åšDNSä¸»è¾…åŒæ­¥"></a>å®æˆ˜é¡¹ç›®2:åœ¨ä¼ä¸šå†…éƒ¨æ­å»ºä¸¤å°åŸŸåè§£ææœåŠ¡å™¨åšDNSä¸»è¾…åŒæ­¥</h3><p>ä¸»è¾…åŒæ­¥ï¼šå¦‚æœæœ‰æ•°ä¸‡å°å®¢æˆ·æœºåœ¨åŒä¸€æ—¶é—´æ¥è®¿é—®DNSæœåŠ¡å™¨ï¼Œä¼šå¯¼è‡´æœåŠ¡å™¨æ‰¿å—å¾ˆå¤§çš„å‹åŠ›ï¼Œè¿™æ—¶å€™æˆ‘å¯èƒ½éœ€è¦å¦å¤–ä¸€ä¸ªäººæ¥å¸®æˆ‘åˆ†æ‹…å‹åŠ›ï¼Œæˆ–è€…è¯´å¦‚æœä¸»æœåŠ¡å™¨é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘èƒ½æœ‰å¦å¤–ä¸€ä¸ªäººç›´æ¥é¡¶ä¸Šæˆ‘çš„å·¥ä½œï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç”¨åˆ°ä¸€ä¸ªè¾…åŠ©æœåŠ¡å™¨äº†ã€‚</p>
<p>é‚£ä¹ˆå¾ˆæ˜¾ç„¶ï¼Œè¾…åŠ©æœåŠ¡å™¨éœ€è¦å’Œä¸»æœåŠ¡å™¨ç”¨ä¸€æ ·çš„é…ç½®ï¼Œé…ç½®é‡Œå†™çš„æ•°æ®ä¹ŸåŸºæœ¬ç›¸åŒã€‚å¯¹äºæˆ‘ä»¬DNSæœåŠ¡å™¨æ¥è¯´ï¼Œå…¶å®å®ƒçš„æ•°æ®æ–‡ä»¶å¹¶ä¸å›ºå®šï¼Œå¯¹åº”çš„IPå’Œä¸»æœºåéƒ½å¯èƒ½ä¼šç»å¸¸å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå½“é‚£ä¸ªæ—¶å€™ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿä¿®æ”¹ä¸»æœºä¸Šçš„æŸä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œä»æœºä¸Šçš„æ–‡ä»¶ä¹Ÿèƒ½å¤Ÿè¢«è‡ªåŠ¨è¢«ä¿®æ”¹ï¼Œä¿æŒä¸¤å°æœºå™¨å®Œå…¨åŒæ­¥ä¸€è‡´ã€‚</p>
<p>è¿™æ—¶å€™å°±æœ‰äº†ä¸€ç§é…ç½®æ–¹æ³•ï¼Œå«åšä¸»è¾…åŒæ­¥ã€‚</p>
<h4 id="å®éªŒå‡†å¤‡é˜¶æ®µ-1"><a href="#å®éªŒå‡†å¤‡é˜¶æ®µ-1" class="headerlink" title="å®éªŒå‡†å¤‡é˜¶æ®µ"></a>å®éªŒå‡†å¤‡é˜¶æ®µ</h4><ol>
<li>ç½‘ç»œæ‹“æ‰‘å›¾</li>
<li>è§„åˆ’è½¯ä»¶å®‰è£…bind bind-chroot</li>
<li>ä¿®æ”¹é…ç½®æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#ä¸»æœåŠ¡å™¨	&#x2F;etc&#x2F;named.rfc1912.zones	å…è®¸ä¼ è¾“ç»™ä»æœº</span><br><span class="line">		&#x2F;var&#x2F;named&#x2F;named.uplooking	åºåˆ—å·ä»0æ”¹æˆæ—¥æœŸ</span><br><span class="line">		&#x2F;var&#x2F;named&#x2F;named.arpa.uplooking åºåˆ—å·ä»0æ”¹æˆæ—¥æœŸ</span><br><span class="line">#ä»æœåŠ¡å™¨	&#x2F;etc&#x2F;named.conf			any</span><br><span class="line">		&#x2F;etc&#x2F;named.rfc1912.zones	slave;masters;file</span><br></pre></td></tr></table></figure></li>
<li>å¯åŠ¨ä»æœºæœåŠ¡</li>
<li>æŸ¥çœ‹ä»æœºç¼“å†²/var/named/slaves/</li>
<li>æ³¨æ„é˜²ç«å¢™å…³é—­</li>
<li>å®¢æˆ·ç«¯æµ‹è¯•æœåŠ¡        </li>
</ol>
<h4 id="å…·ä½“æ­¥éª¤"><a href="#å…·ä½“æ­¥éª¤" class="headerlink" title="å…·ä½“æ­¥éª¤"></a>å…·ä½“æ­¥éª¤</h4><blockquote>
<p>ç½‘ç»œæ‹“æ‰‘å›¾</p>
</blockquote>
<p><img src="pic/14.png" alt="14"></p>
<blockquote>
<p>è§„åˆ’è½¯ä»¶å®‰è£…</p>
</blockquote>
<p><img src="pic/13.png" alt="13"></p>
<blockquote>
<p>ä¸»æœåŠ¡å™¨ï¼š</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 named]# vim /etc/named.rfc1912.zones</span><br><span class="line">zone "uplooking.com" IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file "named.uplooking";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">        allow-transfer &#123; 172.25.0.10; &#125;;    	===&gt;å…è®¸ä»æœº172.25.0.10æ¥è¯»å–</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone "0.25.172.in-addr.arpa" IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file "named.arpa.uplooking";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">        allow-transfer &#123; 172.25.0.10; &#125;;	===&gt;å…è®¸ä»æœº172.25.0.10æ¥è¯»å–</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[root@rhel6 named]# pwd</span><br><span class="line">/var/named</span><br><span class="line">[root@rhel6 named]# ll</span><br><span class="line">total 40</span><br><span class="line">drwxr-x---. 6 root  named 4096 Aug  2 10:30 chroot</span><br><span class="line">drwxrwx---. 2 named named 4096 Aug  2 11:03 data</span><br><span class="line">drwxrwx---. 2 named named 4096 Aug  2 15:06 dynamic</span><br><span class="line">-rw-r-----. 1 root  named  271 Aug  2 13:59 named.arpa.uplooking</span><br><span class="line">-rw-r-----. 1 root  named 1892 Feb 18  2008 named.ca</span><br><span class="line">-rw-r-----. 1 root  named  152 Dec 15  2009 named.empty</span><br><span class="line">-rw-r-----. 1 root  named  152 Jun 21  2007 named.localhost</span><br><span class="line">-rw-r-----. 1 root  named  168 Dec 15  2009 named.loopback</span><br><span class="line">-rw-r-----. 1 root  named  224 Aug  2 11:34 named.uplooking</span><br><span class="line">drwxrwx---. 2 named named 4096 Aug 14  2013 slaves</span><br><span class="line">[root@rhel6 named]# vim named.uplooking</span><br><span class="line"><span class="meta">$</span><span class="bash">TTL 1D</span></span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line">                                        20160802        ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      @</span><br><span class="line">        A       172.25.0.11</span><br><span class="line">www     A       172.25.0.10</span><br><span class="line">        MX 5    mail</span><br><span class="line">mail    A       172.25.0.10</span><br><span class="line">ftp     A       172.25.0.10</span><br><span class="line">bbs     CNAME   ftp</span><br><span class="line">~                        </span><br><span class="line"></span><br><span class="line">[root@rhel6 named]# vim named.arpa.uplooking</span><br><span class="line"><span class="meta">$</span><span class="bash">TTL 1D</span></span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line">                                        20160802        ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      uplooking.com.</span><br><span class="line">11      PTR     uplooking.com.</span><br><span class="line">10      PTR     www.uplooking.com.</span><br><span class="line">10      PTR     mail.uplooking.com.</span><br><span class="line">10      PTR     ftp.uplooking.com.</span><br><span class="line">10      PTR     bbs.uplooking.com.</span><br><span class="line"></span><br><span class="line">[root@rhel6 named]# service named restart</span><br><span class="line">Stopping named: .                                          [  OK  ]</span><br><span class="line">Starting named:                                            [  OK  ]</span><br><span class="line">[root@rhel6 named]# service iptables stop</span><br><span class="line">iptables: Firewall is not running.</span><br><span class="line">[root@rhel6 named]# getenforce</span><br><span class="line">Enforcing</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä»æœåŠ¡å™¨</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# cat /etc/resolv.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> Generated by NetworkManager</span></span><br><span class="line">domain example.com</span><br><span class="line">search example.com</span><br><span class="line">nameserver 172.25.254.254</span><br><span class="line">[root@rhel7 ~]# yum install -y bind*</span><br><span class="line">[root@rhel7 ~]# vim /etc/named.conf</span><br><span class="line">[root@rhel7 ~]# vim /etc/named.rfc1912.zones</span><br><span class="line">zone "uplooking.com" IN &#123;</span><br><span class="line">        type slave;				&lt;== å®šä¹‰ç±»å‹ä¸ºå¥´éš¶ slave</span><br><span class="line">        masters &#123; 172.25.0.11; &#125;;		&lt;== å‘Šè¯‰è®¡ç®—æœºæˆ‘çš„ä¸»äºº master æ˜¯è°</span><br><span class="line">        file "slaves/uploooking.com.zone";	&lt;== å‘Šè¯‰è®¡ç®—æœº zone æ•°æ®åº“åœ°å€åœ¨å“ªé‡Œ,å¥´éš¶æœ‰ä¸“é—¨çš„ç›®å½•</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone "0.25.172.in-addr.arpa" IN &#123;</span><br><span class="line">        type slave;</span><br><span class="line">        masters &#123; 172.25.0.11; &#125;;</span><br><span class="line">        file "slaves/arpa.uplooking.zone";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æœåŠ¡å¯åŠ¨ä¸å…³é—­</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# systemctl stop firewalld</span><br><span class="line">[root@rhel7 ~]# getenforce</span><br><span class="line">Enforcing</span><br><span class="line">[root@rhel7 ~]# systemctl start named</span><br><span class="line">[root@rhel7 ~]# ll /var/named/slaves</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r--. 1 named named 381 Aug  2 03:54 arpa.uplooking.zone</span><br><span class="line">-rw-r--r--. 1 named named 463 Aug  2 03:54 uploooking.com.zone</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æµ‹è¯•</p>
</blockquote>
<p>å®¢æˆ·ç«¯ rhel7</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# vim /etc/resolv.conf</span><br><span class="line">nameserver 172.25.0.11</span><br><span class="line">[root@rhel7 ~]# nslookup</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> www.uplooking.com</span></span><br><span class="line">Server:		172.25.0.11</span><br><span class="line">Address:	172.25.0.11#53</span><br><span class="line"></span><br><span class="line">Name:	www.uplooking.com</span><br><span class="line">Address: 172.25.0.10</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 172.25.0.10</span></span><br><span class="line">Server:		172.25.0.11</span><br><span class="line">Address:	172.25.0.11#53</span><br><span class="line"></span><br><span class="line">10.0.25.172.in-addr.arpa	name = www.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpa	name = mail.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpa	name = ftp.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpa	name = bbs.uplooking.com.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 172.25.0.11</span></span><br><span class="line">Server:		172.25.0.11</span><br><span class="line">Address:	172.25.0.11#53</span><br><span class="line"></span><br><span class="line">11.0.25.172.in-addr.arpa	name = uplooking.com.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">exit</span></span></span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# vim /etc/resolv.conf</span><br><span class="line">nameserver 172.25.0.10</span><br><span class="line">[root@rhel7 ~]# nslookup</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> www.uplooking.com</span></span><br><span class="line">Server:		172.25.0.10</span><br><span class="line">Address:	172.25.0.10#53</span><br><span class="line"></span><br><span class="line">Name:	www.uplooking.com</span><br><span class="line">Address: 172.25.0.10</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 172.25.0.11</span></span><br><span class="line">Server:		172.25.0.10</span><br><span class="line">Address:	172.25.0.10#53</span><br><span class="line"></span><br><span class="line">11.0.25.172.in-addr.arpa	name = uplooking.com.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 172.25.0.10</span></span><br><span class="line">Server:		172.25.0.10</span><br><span class="line">Address:	172.25.0.10#53</span><br><span class="line"></span><br><span class="line">10.0.25.172.in-addr.arpa	name = bbs.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpa	name = www.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpa	name = ftp.uplooking.com.</span><br><span class="line">10.0.25.172.in-addr.arpa	name = mail.uplooking.com.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">exit</span></span></span><br></pre></td></tr></table></figure>

<h3 id="æ’é”™è®°å½•"><a href="#æ’é”™è®°å½•" class="headerlink" title="æ’é”™è®°å½•"></a>æ’é”™è®°å½•</h3><h4 id="æœåŠ¡å¯åŠ¨ä¸äº†"><a href="#æœåŠ¡å¯åŠ¨ä¸äº†" class="headerlink" title="æœåŠ¡å¯åŠ¨ä¸äº†"></a>æœåŠ¡å¯åŠ¨ä¸äº†</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# systemctl start named</span><br><span class="line">Job for named.service failed. See 'systemctl status named.service' and 'journalctl -xn' for details.</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# systemctl status named.service</span><br><span class="line">named.service - Berkeley Internet Name Domain (DNS)</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/named.service; disabled)</span><br><span class="line">   Active: failed (Result: exit-code) since Tue 2016-08-02 04:19:20 EDT; 23s ago</span><br><span class="line">  Process: 2297 ExecStartPre=/usr/sbin/named-checkconf -z /etc/named.conf (code=exited, status=1/FAILURE)</span><br><span class="line"></span><br><span class="line">Aug 02 04:19:20 rhel7 systemd[1]: Starting Berkeley Internet Name Domain (DNS)...</span><br><span class="line">Aug 02 04:19:20 rhel7 named-checkconf[2297]: /etc/named.rfc1912.zones:51: missing ';' before '&#125;'</span><br><span class="line">Aug 02 04:19:20 rhel7 systemd[1]: named.service: control process exited, code=exited status=1</span><br><span class="line">Aug 02 04:19:20 rhel7 systemd[1]: Failed to start Berkeley Internet Name Domain (DNS).</span><br><span class="line">Aug 02 04:19:20 rhel7 systemd[1]: Unit named.service entered failed state.</span><br></pre></td></tr></table></figure>

<p>psï¼šå½“æœåŠ¡å¯åŠ¨ä¸äº†çš„æ—¶å€™ï¼ŒæŠ¥é”™å†…å®¹ä¸­è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹ï¼Œ<code>systemctl status named.service</code> æˆ–è€… <code>journalctl -xn</code>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å»æ‰§è¡Œä»¥ä¸‹ä¸Šé¢å‘½ä»¤ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œéƒ½å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„æŠ¥é”™ä¿¡æ¯ã€‚</p>
<p><code>Aug 02 04:19:20 rhel7 named-checkconf[2297]: /etc/named.rfc1912.zones:51: missing &#39;;&#39; before &#39;}&#39;</code></p>
<p>è¿™æ¡æ—¥å¿—å‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨é…ç½®æ–‡ä»¶<code>/etc/named.rfc1912.zones</code>çš„ç¬¬51è¡Œä¸­ï¼Œ<code>&#39;}&#39;</code>å‰å°‘äº†ä¸€ä¸ª<code>&#39;;&#39;</code>ã€‚å› æ­¤æˆ‘ä»¬æ ¹æ®æ—¥å¿—ä¸­çš„æç¤ºå»ä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯ã€‚</p>
<h4 id="æœåŠ¡å¯åŠ¨ä¸äº†-1"><a href="#æœåŠ¡å¯åŠ¨ä¸äº†-1" class="headerlink" title="æœåŠ¡å¯åŠ¨ä¸äº†"></a>æœåŠ¡å¯åŠ¨ä¸äº†</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# systemctl status named</span><br><span class="line">named.service - Berkeley Internet Name Domain (DNS)</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/named.service; disabled)</span><br><span class="line">   Active: failed (Result: exit-code) since Tue 2016-08-02 04:50:39 EDT; 1min 42s ago</span><br><span class="line">  Process: 6541 ExecStartPre=/usr/sbin/named-checkconf -z /etc/named.conf (code=exited, status=1/FAILURE)</span><br><span class="line"></span><br><span class="line">Aug 02 04:50:39 rhel7 named-checkconf[6541]: zone 1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0...al 0</span><br><span class="line">Aug 02 04:50:39 rhel7 named-checkconf[6541]: zone 1.0.0.127.in-addr.arpa/IN: loaded serial 0</span><br><span class="line">Aug 02 04:50:39 rhel7 named-checkconf[6541]: zone 0.in-addr.arpa/IN: loaded serial 0</span><br><span class="line">Aug 02 04:50:39 rhel7 named-checkconf[6541]: zone uplooking.com/IN: loaded serial 20160802</span><br><span class="line">Aug 02 04:50:39 rhel7 named-checkconf[6541]: zone 19.25.172.in-addr.arpa/IN: loading from master file nam...ound</span><br><span class="line">Aug 02 04:50:39 rhel7 named-checkconf[6541]: zone 19.25.172.in-addr.arpa/IN: not loaded due to errors.</span><br><span class="line">Aug 02 04:50:39 rhel7 named-checkconf[6541]: _default/19.25.172.in-addr.arpa/IN: file not found</span><br><span class="line">Aug 02 04:50:39 rhel7 systemd[1]: named.service: control process exited, code=exited status=1</span><br><span class="line">Aug 02 04:50:39 rhel7 systemd[1]: Failed to start Berkeley Internet Name Domain (DNS).</span><br><span class="line">Aug 02 04:50:39 rhel7 systemd[1]: Unit named.service entered failed state.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# tail -n 15 /etc/named.rfc1912.zones</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone  "uplooking.com" IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file "named.uplooking";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">	allow-transfer &#123; 172.25.19.10;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone "19.25.172.in-addr.arpa" IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file "named.uplooking.arpa";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">	allow-transfer &#123; 172.25.19.10; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# ll /var/named/named*</span><br><span class="line">-rw-r-----. 1 root named  330 Aug  2 04:50 /var/named/named.arpa.uplooking</span><br><span class="line">-rw-r-----. 1 root named 2076 Jan 28  2013 /var/named/named.ca</span><br><span class="line">-rw-r-----. 1 root named  152 Dec 15  2009 /var/named/named.empty</span><br><span class="line">-rw-r-----. 1 root named  152 Jun 21  2007 /var/named/named.localhost</span><br><span class="line">-rw-r-----. 1 root named  168 Dec 15  2009 /var/named/named.loopback</span><br><span class="line">-rw-r-----. 1 root named  295 Aug  2 04:50 /var/named/named.uplooking</span><br></pre></td></tr></table></figure>

<p>ps:é—®é¢˜å‡ºåœ¨æ•°æ®æ–‡ä»¶åå’Œé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„æ•°æ®æ–‡ä»¶åä¸ä¸€è‡´ã€‚</p>
<p><code>file &quot;named.uplooking.arpa&quot;;</code></p>
<p><code>/var/named/named.arpa.uplooking</code></p>
<h4 id="ä¸»è¾…åŒæ­¥ç¼“å†²æ–‡ä»¶åªæœ‰ä¸€ä¸ª"><a href="#ä¸»è¾…åŒæ­¥ç¼“å†²æ–‡ä»¶åªæœ‰ä¸€ä¸ª" class="headerlink" title="ä¸»è¾…åŒæ­¥ç¼“å†²æ–‡ä»¶åªæœ‰ä¸€ä¸ª"></a>ä¸»è¾…åŒæ­¥ç¼“å†²æ–‡ä»¶åªæœ‰ä¸€ä¸ª</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# ll /var/named/slaves/</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 named named 386 Jan  1 02:46 uplooking123.zoo</span><br></pre></td></tr></table></figure>

<p>ps:åŸå› æ˜¯<code>/etc/named.rfc1912.zones</code>ä¸­çš„é…ç½®æœ‰é—®é¢˜ï¼ŒæŒ‡å®šç¼“å†²çš„ç›®å½•å†™å°‘äº†ä¸€ä¸ª<code>s</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zone \"uplooking.com\" IN &#123;</span><br><span class="line">        type slave;</span><br><span class="line">        masters &#123; 172.25.33.11; &#125;;</span><br><span class="line">        file \"slave/uplooking.zone\";</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">      &#125;;</span><br></pre></td></tr></table></figure>

<h4 id="ä¸»è¾…åŒæ­¥å°†ä»æœºçš„æ•°æ®æ–‡ä»¶æŒ‡å®šä½ç½®æ”¾åœ¨éslavesç›®å½•"><a href="#ä¸»è¾…åŒæ­¥å°†ä»æœºçš„æ•°æ®æ–‡ä»¶æŒ‡å®šä½ç½®æ”¾åœ¨éslavesç›®å½•" class="headerlink" title="ä¸»è¾…åŒæ­¥å°†ä»æœºçš„æ•°æ®æ–‡ä»¶æŒ‡å®šä½ç½®æ”¾åœ¨éslavesç›®å½•"></a>ä¸»è¾…åŒæ­¥å°†ä»æœºçš„æ•°æ®æ–‡ä»¶æŒ‡å®šä½ç½®æ”¾åœ¨éslavesç›®å½•</h4><p>ä»æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶æ”¾ç½®çš„ä½ç½®ä¸åœ¨slavesç›®å½•ä¸‹ï¼Œè€Œåœ¨å…¶ä»–ç›®å½•ä¸‹ï¼Œåˆ™åŒæ­¥ä¸æˆåŠŸã€‚<br>åŸå› ä»ä¸‰å¤„æ’æŸ¥</p>
<ul>
<li>é…ç½®æ–‡ä»¶</li>
<li>UGOæƒé™</li>
<li>selinuxæƒé™</li>
</ul>
<p>æ­¤å¤„æ˜¯ç”±äºselinuxçš„é—®é¢˜ï¼Œæˆ‘ä»¬å®‰è£…ä¸€ä¸ªå·¥å…·<code>setroubleshoot</code>å¸®åŠ©æˆ‘ä»¬åˆ†æ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Yum search setroubleshoot</span><br><span class="line">Yum -y install setroubleshoot</span><br><span class="line">Sealert -a audit.log</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°å…³äºå¸ƒå°”å€¼çš„ä¿¡æ¯å’Œå…³äºå®‰å…¨ä¸Šä¸‹æ–‡çš„ä¿¡æ¯:</p>
<ul>
<li>1ï¼‰è®¾ç½®å¸ƒå°”å€¼setsebool -P named_write_master_zones 1</li>
<li>2ï¼‰è®¾ç½®å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œé€šè¿‡man named_selinuxæˆ–è€…çœ‹ä¸€ä¸‹slavesç›®å½•çš„å®‰å…¨ä¸Šä¸‹æ–‡æ˜¯ä»€ä¹ˆ<br>æ ¹æ®slavesçš„å®‰å…¨ä¸Šä¸‹æ–‡å»æ”¹ã€‚<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Chcon -t named_zone_t test</span><br><span class="line">Chcon -u system_u  -r object_r  test</span><br></pre></td></tr></table></figure>
ç„¶åå°†selinuxæ‰“å¼€ï¼Œå°†testä¸‹çš„ç›®å½•çš„åŒæ­¥è¿‡æ¥çš„æ–‡ä»¶ç»™åˆ é™¤ï¼Œé‡å¯æœåŠ¡ï¼Œçœ‹æ˜¯å¦è¢«åŒæ­¥è¿‡æ¥ã€‚</li>
</ul>
<p>åŒæ­¥æˆåŠŸã€‚</p>
<h4 id="å¦‚æœå¯åŠ¨æœåŠ¡æ—¶å€™å¤ªæ…¢"><a href="#å¦‚æœå¯åŠ¨æœåŠ¡æ—¶å€™å¤ªæ…¢" class="headerlink" title="å¦‚æœå¯åŠ¨æœåŠ¡æ—¶å€™å¤ªæ…¢"></a>å¦‚æœå¯åŠ¨æœåŠ¡æ—¶å€™å¤ªæ…¢</h4><p>å¯ä»¥ä½¿ç”¨<code>/usr/sbin/rndc-confgen -a -r /etc/named.conf</code></p>
<p>è¿™æ˜¯ä¸€ä¸ªç§˜é’¥åŠ å¯†äº§ç”Ÿçš„bug</p>
<h4 id="æœ‰é¡ºåºçš„æ‰¹é‡é…ç½®çš„å†™æ³•ï¼šï¼ˆç®€å•äº†è§£ä¸€ä¸‹ï¼‰"><a href="#æœ‰é¡ºåºçš„æ‰¹é‡é…ç½®çš„å†™æ³•ï¼šï¼ˆç®€å•äº†è§£ä¸€ä¸‹ï¼‰" class="headerlink" title="æœ‰é¡ºåºçš„æ‰¹é‡é…ç½®çš„å†™æ³•ï¼šï¼ˆç®€å•äº†è§£ä¸€ä¸‹ï¼‰"></a>æœ‰é¡ºåºçš„æ‰¹é‡é…ç½®çš„å†™æ³•ï¼šï¼ˆç®€å•äº†è§£ä¸€ä¸‹ï¼‰</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">GENERATE 1-100 stu$   A   172.25.0.$</span></span><br><span class="line"><span class="meta">$</span><span class="bash">GENERATE 1-200 $ PTR foundation$.ilt.example.com</span></span><br></pre></td></tr></table></figure>

<h4 id="ä»æœºæ•°æ®æ–‡ä»¶çš„æŸ¥çœ‹"><a href="#ä»æœºæ•°æ®æ–‡ä»¶çš„æŸ¥çœ‹" class="headerlink" title="ä»æœºæ•°æ®æ–‡ä»¶çš„æŸ¥çœ‹"></a>ä»æœºæ•°æ®æ–‡ä»¶çš„æŸ¥çœ‹</h4><p><strong>7ç‰ˆæœ¬ä¸Šæ— æ³•æŸ¥çœ‹</strong>ï¼šå› ä¸ºä»æœºåœ¨slavesç›®å½•ä¸‹ç”Ÿæˆçš„é…ç½®æ–‡ä»¶æ˜¯dataç±»å‹çš„ã€‚<br><strong>6ç‰ˆæœ¬ä¸Šå¯ä»¥æŸ¥çœ‹</strong>ï¼šè€ç‰ˆæœ¬æ˜¯å¯ä»¥æŸ¥çœ‹çš„ã€‚</p>
<hr>
<h3 id="é…ç½®æ–‡ä»¶è¯¦ç»†è§£æ"><a href="#é…ç½®æ–‡ä»¶è¯¦ç»†è§£æ" class="headerlink" title="é…ç½®æ–‡ä»¶è¯¦ç»†è§£æ"></a>é…ç½®æ–‡ä»¶è¯¦ç»†è§£æ</h3><h4 id="ä¸»é…ç½®æ–‡ä»¶-etc-named-conf"><a href="#ä¸»é…ç½®æ–‡ä»¶-etc-named-conf" class="headerlink" title="ä¸»é…ç½®æ–‡ä»¶/etc/named.conf"></a>ä¸»é…ç½®æ–‡ä»¶/etc/named.conf</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Options å…¨å±€çš„é…ç½®è¡Œ   </span><br><span class="line">options &#123;Â //æœåŠ¡å™¨çš„å…¨å±€é…ç½®é€‰é¡¹åŠä¸€äº›é»˜è®¤è®¾ç½®</span><br><span class="line">Â  Â Â  Â Â Â listen-on port 53 &#123; any; &#125;;Â //ç›‘å¬ç«¯å£é»˜è®¤ç›‘å¬53å·ç«¯å£ï¼Œä¹Ÿå¯å†™ä¸º &#123; 127.0.0.1; 192.168.139.46; &#125;</span><br><span class="line">Â  Â Â  Â Â Â listen-on-v6 port 53 &#123; ::1; &#125;;Â //å¯¹ip6æ”¯æŒ</span><br><span class="line">Â  Â Â  Â Â Â directoryÂ  Â Â  Â  "/var/named";Â Â //åŒºåŸŸæ–‡ä»¶å­˜å‚¨ç›®å½•</span><br><span class="line">Â  Â Â  Â Â Â dump-fileÂ  Â Â  Â  "/var/named/data/cache_dump.db";Â //ç¼“å­˜çš„ç›®å½•directory</span><br><span class="line">Â  Â Â  Â Â Â statistics-file "/var/named/data/named_stats.txt";  // çŠ¶æ€ä¿¡æ¯æ–‡ä»¶</span><br><span class="line">Â  Â Â  Â Â Â memstatistics-file "/var/named/data/named_mem_stats.txt";   //å†…å­˜ä¿¡æ¯æ–‡ä»¶</span><br><span class="line">Â  Â Â  Â Â Â pid-fileÂ  Â Â  Â Â Â "/var/run/named/named.pid";Â //å­˜ç€namedçš„pid</span><br><span class="line">Â  Â Â  Â Â Â forwardersÂ  Â Â Â &#123; 168.95.1.1; 139.175.10.20; &#125;;Â // å¦‚æœåŸŸåæœåŠ¡å™¨æ— æ³•è§£ææ—¶ï¼Œå°†è¯·æ±‚äº¤ç”±168.95.1.1; 139.175.10.20æ¥è§£æ</span><br><span class="line">Â  Â Â  Â Â Â allow-queryÂ  Â  &#123; any; &#125;;Â  Â //æŒ‡å®šå…è®¸è¿›è¡ŒæŸ¥è¯¢çš„ä¸»æœºï¼Œå½“ç„¶æ˜¯è¦æ‰€æœ‰çš„ç”µè„‘éƒ½å¯ä»¥æŸ¥å•¦</span><br><span class="line">Â  Â Â  Â Â Â allow-transfer &#123; none; &#125;;Â //æŒ‡å®šå…è®¸æ¥å—åŒºåŸŸä¼ é€è¯·æ±‚çš„ä¸»æœºï¼Œè¯´æ˜ç™½ä¸€ç‚¹å°±æ˜¯è¾…dnså®šä¹‰ï¼Œæ¯”å¦‚è¾…dnsçš„ipæ˜¯192.168.139.5ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·å®šä¹‰&#123; 192.168.139.5; &#125;ï¼Œè¦ä¸ç„¶ä¸»è¾…dnsä¸èƒ½åŒæ­¥ï¼Œå½“ç„¶ï¼Œ&#123;&#125;é‡Œçš„ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢æåˆ°çš„aclã€‚</span><br><span class="line">Â  Â Â  Â Â Â // those options should be used carefully because they disable port</span><br><span class="line">Â  Â Â  Â Â Â // randomization</span><br><span class="line">Â  Â Â  Â Â Â // query-sourceÂ  Â  port 53;Â  Â Â Â </span><br><span class="line">Â  Â Â  Â Â Â // query-source-v6 port 53;</span><br><span class="line">Dnssecå¼€å¤´çš„æ˜¯ä¸€äº›åŠ å¯†æ–‡ä»¶</span><br><span class="line">Xxxx.keyæ˜¯ä¸€äº›ç§˜é’¥æ–‡ä»¶</span><br><span class="line">&#125;;</span><br><span class="line">logging &#123;Â //æŒ‡å®šæœåŠ¡å™¨æ—¥å¿—è®°å½•çš„å†…å®¹å’Œæ—¥å¿—ä¿¡æ¯æ¥æº</span><br><span class="line">Â  Â Â  Â Â Â channel default_debug &#123;</span><br><span class="line">Â  Â Â  Â Â  Â Â  Â Â  Â  file "data/named.run";</span><br><span class="line">Â  Â Â  Â Â  Â Â  Â Â  Â  severity dynamic;</span><br><span class="line">Â  Â Â  Â Â Â &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">zone "." IN &#123;Â //åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ˜¯ç”¨zoneå…³é”®å­—æ¥å®šä¹‰åŸŸåŒºçš„ï¼Œä¸€ä¸ªzoneå…³é”®å­—å®šä¹‰ä¸€ä¸ªåŸŸåŒºÂ </span><br><span class="line">type hint;Â </span><br><span class="line">/*åœ¨è¿™é‡Œtypeç±»å‹æœ‰ä¸‰ç§ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯master,slaveå’Œhintå®ƒä»¬çš„å«ä¹‰åˆ†åˆ«æ˜¯ï¼šÂ </span><br><span class="line">master:è¡¨ç¤ºå®šä¹‰çš„æ˜¯ä¸»åŸŸåæœåŠ¡å™¨Â </span><br><span class="line">slave :è¡¨ç¤ºå®šä¹‰çš„æ˜¯è¾…åŠ©åŸŸåæœåŠ¡å™¨Â </span><br><span class="line">hint:è¡¨ç¤ºæ˜¯äº’è”ç½‘ä¸­æ ¹åŸŸåæœåŠ¡å™¨Â </span><br><span class="line">*/Â </span><br><span class="line">Include  "/etc/named.rfc1912.conf"</span><br><span class="line">Include  "/etc/named.root.key"  //ä¸¤ä¸ªincludeå­—æ®µä»£è¡¨è¯»å–æœ¬é…ç½®æ–‡ä»¶æ—¶å€™åŒæ—¶è¯»å–/etc/named.rfc1912.confå’Œ/etc/named.root.keyæ–‡ä»¶ï¼Œè¿™é‡Œä¸»è¦å…³æ³¨ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯ä¸“é—¨ç”¨äºå®šä¹‰åŸŸçš„æ–‡ä»¶ã€‚</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>allow-query-cache</code>ä¸»è¾…åŒæ­¥æ—¶:</strong></p>
<ul>
<li>6ç‰ˆæœ¬ä¸Šå¿…é¡»åŠ ä¸Š ä¸ç„¶ä¼šæŠ¥é”™</li>
<li>7ç‰ˆæœ¬ä¸ç”¨</li>
</ul>
<p><strong><code>recursion</code>ä¸»è¾…åŒæ­¥æ—¶</strong> å¿…é¡»æ˜¯yesï¼Œå…³æ‰ä¹‹åä¼šé˜»æ­¢æ–°çºªå½•è¿›å…¥åˆ°ç¼“å†²ã€‚</p>
<h4 id="named-rfc1912-conf"><a href="#named-rfc1912-conf" class="headerlink" title="named.rfc1912.conf"></a>named.rfc1912.conf</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Zone "åŸŸå "IN &#123;</span><br><span class="line">File ;åŸŸå¯¹åº”çš„æ•°æ®æ–‡ä»¶</span><br><span class="line">Allow-update ;æ˜¯å¦éœ€è¦æ›´æ–°</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„</strong></p>
<ol>
<li>æ‰€æœ‰è¯­å¥ç»“æŸåéƒ½éœ€è¦ä¸€ä¸ªåˆ†å·ä»£è¡¨ç»“æŸç¬¦</li>
<li>æ‹¬å·å¿…é¡»æˆå¯¹å‡ºç°</li>
<li>fileæŒ‡å‘çš„æ•°æ®æ–‡ä»¶å†™çš„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œç›¸å¯¹äºä¸»é…ç½®æ–‡ä»¶çš„dirctoryé…ç½®å­—æ®µï¼Œå³ç›¸å¯¹äº/var/namedç›®å½•ã€‚</li>
</ol>
<p><strong>ä¸»è¾…åŒæ­¥ä¸­slaveéœ€è¦çš„é…ç½®</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Zone "åŸŸå" IN &#123;</span><br><span class="line">Type slave;</span><br><span class="line">Masters &#123; 172.25.0.11;&#125; ;</span><br><span class="line">File "slaves/test.com.zone";</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ•°æ®æ–‡ä»¶-var-named-named-localhost"><a href="#æ•°æ®æ–‡ä»¶-var-named-named-localhost" class="headerlink" title="æ•°æ®æ–‡ä»¶/var/named/named.localhost"></a>æ•°æ®æ–‡ä»¶/var/named/named.localhost</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">TTL //ä»£è¡¨å‘¨æœŸï¼Œç¼“å­˜æ—¶é—´ï¼ŒDNSä¼šè‡ªå·±åšç¼“å­˜ï¼Œ1Då°±ä»£è¡¨ä¸€å¤©ï¼Œç¼“å­˜æ—¶é—´ä¸ºä¸€å¤©ã€‚</span><br><span class="line">SOA //è®°å½•  --&gt;èµ·å§‹æˆæƒè®°å½•  @ä»£è¡¨ç»§æ‰¿åŸŸå  </span><br><span class="line">IN  SOA @ ç”¨æˆ·å.åŸŸå  &#123;</span><br><span class="line">     0;serial    //åºåˆ—å·ï¼›ä¸€èˆ¬å†™ä¿®æ”¹å½“å¤©æ—¥æœŸï¼Œä»æœåŠ¡å™¨æ ¹æ®è¯¥åºåˆ—å·æ¥åˆ¤å®šæ–‡ä»¶æ˜¯å¦ä¿®æ”¹è¿‡ã€‚</span><br><span class="line">     1Dï¼›refresh  // å¤šä¹…åšä¸€æ¬¡åŒæ­¥</span><br><span class="line">     1Hï¼›retry    //é‡ç½®æ—¶é—´ï¼ŒåŒæ­¥ä¸æˆåŠŸæ—¶ï¼Œé—´éš”å¤šä¹…é‡æ–°åšä¸€æ¬¡åŒæ­¥</span><br><span class="line">     1Wï¼›expire   //å½“é‡å¤åŒæ­¥ä¸æˆåŠŸæ—¶ï¼Œå¤šä¹…ä¸å†åšåŒæ­¥ã€‚</span><br><span class="line">	 3Hï¼›minimun  //æœ€å°ç¼“å­˜æ—¶é—´ï¼Œä¸€èˆ¬æ˜¯é”™è¯¯ç¼“å­˜ã€‚å‡è®¾æœ‰ä¸€ä¸ªäººï¼Œä¸€ç›´é—®æˆ‘ä¸€ä¸ªé”™è¯¯çš„åŸŸåï¼Œé‚£æˆ‘å°±ä¼šå°†è¯¥é”™è¯¯çš„åŸŸåç¼“å­˜ä¸‹æ¥ï¼Œ</span><br><span class="line">å½“äººå†æ¥é—®æˆ‘æ—¶ï¼Œæˆ‘å°±ä¸å†æœå¯»ï¼Œè€Œå°†è¯¥ç»“æœåé¦ˆç»™ä»–ã€‚</span><br><span class="line"></span><br><span class="line">è¿™é‡Œå°†serialä¸€åˆ—æ”¹ä¸ºå½“å‰æ—¥æœŸã€‚</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NSä»£è¡¨çš„æ˜¯æ­£å‘è®°å½•  ï¼Œè§£æè¿˜åˆ†æˆæ­£å‘è§£æå’Œåå‘è§£æï¼Œæ­£å‘è§£æå°±æ˜¯çŸ¥é“ä¸»æœºåï¼Œæƒ³è¦æœå¯»IPåœ°å€ã€‚è¿™é‡Œå…ˆæ¥çœ‹æ­£å‘è§£æ</span><br><span class="line"></span><br><span class="line">@ä»£è¡¨ç»§æ‰¿åŸŸå</span><br><span class="line">   NS    @</span><br><span class="line">   A    127.0.0.1    </span><br><span class="line">è¿™å¥è¯ä»£è¡¨ï¼Œæˆ‘çš„åŸŸåæ˜¯localhostï¼ŒlocalhostæŒ‡å‘çš„æ˜¯127.0.0.1</span><br><span class="line">å¦‚æœä¸å†™@è€Œå†™æˆåŸŸåï¼Œå°±åº”è¯¥å†™æˆtest.com.   Comåé¢å¿…é¡»æœ‰ä¸ªç‚¹ï¼Œä»£è¡¨æ ¹åŸŸçš„æ„æ€ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æŒæ¡å®è·µé¡¹ç›®<br><img src="pic/02.png" alt="02"></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxåŸºç¡€æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>NFSæ–‡ä»¶å…±äº«æœåŠ¡</title>
    <url>/2016/12/23/booboo_easy_service/03_nfs/</url>
    <content><![CDATA[<h3 id="NFSæ˜¯ä»€ä¹ˆ"><a href="#NFSæ˜¯ä»€ä¹ˆ" class="headerlink" title="NFSæ˜¯ä»€ä¹ˆ"></a>NFSæ˜¯ä»€ä¹ˆ</h3><p>NFSï¼ˆNetwork File Systemï¼‰å³ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ŒSUNå…¬å¸å¼€å‘çš„,æ˜¯FreeBSDæ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ç§ï¼Œå®ƒå…è®¸ç½‘ç»œä¸­çš„è®¡ç®—æœºä¹‹é—´é€šè¿‡TCP/IPç½‘ç»œå…±äº«èµ„æºã€‚åœ¨NFSçš„åº”ç”¨ä¸­ï¼Œæœ¬åœ°NFSçš„å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥é€æ˜åœ°è¯»å†™ä½äºè¿œç«¯NFSæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œå°±åƒè®¿é—®æœ¬åœ°æ–‡ä»¶ä¸€æ ·ã€‚</p>
<h3 id="NFSçš„åŸç†"><a href="#NFSçš„åŸç†" class="headerlink" title="NFSçš„åŸç†"></a>NFSçš„åŸç†</h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä¸¤ä¸ªå®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å¯ä»¥å°†ç½‘ç»œä¸­çš„NFSæœåŠ¡å™¨å…±äº«çš„ç›®å½•æŒ‚è½½åˆ°æœ¬åœ°ç«¯çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè€Œåœ¨æœ¬åœ°ç«¯çš„ç³»ç»Ÿä¸­çœ‹æ¥ï¼Œé‚£ä¸ªè¿œç¨‹ä¸»æœºçš„ç›®å½•å°±å¥½åƒè‡ªå·±çš„ä¸€ä¸ªç£ç›˜åˆ†åŒºä¸€æ ·ã€‚</p>
<p>æ¯”å¦‚å°†é…ç½®å¥½çš„NFSæœåŠ¡å™¨ä¸Šçš„<code>/var/share/student1</code>ç›®å½•æŒ‚åœ¨åˆ°Aå®¢æˆ·ç«¯çš„<code>/home/share/student1</code>ä¸Šé¢ï¼Œé‚£åœ¨å®¢æˆ·ç«¯Aä¸Šé¢è¿›å…¥<code>/home/share/student1</code>å†…ï¼Œå°±å¯ä»¥çœ‹åˆ°NFSæœåŠ¡å™¨ç³»ç»Ÿä¸­<code>/var/share/student1</code>ç›®å½•ä¸‹æ‰€æœ‰çš„å†…å®¹äº†ï¼Œå¹¶ä¸”å¯ä»¥æ‰§è¡Œ<code>cdï¼Œcpï¼Œmvï¼Œrm</code>ç­‰å‘½ä»¤ã€‚å½“ç„¶ï¼Œæƒé™è¦è¶³å¤Ÿã€‚è¿™ä¸ª<code>/var/share/student1</code>å°±å¥½åƒNFSå®¢æˆ·ç«¯çš„ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸€æ ·ã€‚æ‰€ä»¥ï¼ŒNFSä¹Ÿå¯ä»¥ç®€å•çš„çœ‹åšæ˜¯ä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨ï¼ˆfile systemï¼‰</p>
<p>åªè¦æƒé™è¶³å¤Ÿï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥å¯¹è¯¥ç›®å½•ä¸‹çš„å†…å®¹è¿›è¡Œè¯»å†™æ“ä½œç­‰ç­‰ã€‚</p>
<p><strong>NFSæŒ‡çš„æ˜¯ä¸€ç§æœåŠ¡</strong> æ—¢ç„¶æ˜¯æœåŠ¡ï¼Œè‚¯å®šä¼šç”¨åˆ°ä¸€äº›ç›‘å¬ç«¯å£ï¼Œé‚£NFSç”¨çš„æ˜¯ä»€ä¹ˆç«¯å£è¿›è¡Œæ•°æ®ä¼ è¾“çš„ï¼Ÿæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œè°éƒ½ä¸çŸ¥é“ã€‚åŸºæœ¬ä¸ŠNFSè¿™ä¸ªæœåŠ¡çš„ç«¯å£å¼€åœ¨2049ç«¯å£ï¼Œä½†ç”±äºæ–‡ä»¶ç³»ç»Ÿéå¸¸å¤æ‚ï¼ŒNFSæ”¯æŒçš„åŠŸèƒ½åˆç›¸å½“çš„å¤šï¼Œæ¯ä¸€ä¸ªåŠŸèƒ½å°±ä¼šå¯ç”¨ä¸€äº›ç«¯å£æ¥ä¼ è¾“æ•°æ®ï¼Œæ‰€ä»¥ï¼ŒNFSéœ€è¦è°ƒç”¨é¢å¤–çš„ç«¯å£ï¼Œé‚£é¢å¤–çš„ç«¯å£å·åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé¢å¤–çš„ç«¯å£å·å¹¶ä¸å›ºå®šã€‚å› ä¸ºNFSé»˜è®¤ä¼ è¾“çš„ç«¯å£æ˜¯éšæœºå–ç”¨æœªè¢«ä½¿ç”¨çš„å°äº1024çš„ç«¯å£ç”¨äºä¼ è¾“ã€‚ä½†å¦‚æ­¤ä¸€æ¥ï¼Œå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨åˆæˆäº†é—®é¢˜ï¼Œå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“æˆ‘è¦é“¾æ¥é‚£äº›ç«¯å£ã€‚è¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨RPCæœåŠ¡äº† remote procedure callã€‚</p>
<p>RPCå°±æ˜¯æŒ‡å®šNFSå„åŠŸèƒ½å¯¹åº”çš„ç«¯å£å·ï¼Œç„¶åé€šçŸ¥ç»™å®¢æˆ·ç«¯ï¼Œè®©å®¢æˆ·ç«¯å¯ä»¥è¿æ¥åˆ°æ­£ç¡®çš„ç«¯å£ä¸Šã€‚</p>
<p><img src="pic/20.png" alt="20"></p>
<p>å¯¹äºæœåŠ¡ç«¯æ¥è¯´ï¼Œåœ¨NFSå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å‘RPCæ³¨å†Œå…¶å„ä¸ªåŠŸèƒ½æ‰€éœ€è¦çš„éšæœºç«¯å£å·ï¼Œè®©RPCäº†è§£NFSå„é¡¹åŠŸèƒ½çš„ç«¯å£å·ï¼ŒPIDï¼ŒNFSæ‰€ç›‘å¬çš„IPç­‰ç­‰ã€‚å½“å®¢æˆ·ç«¯é€šè¿‡111ç«¯å£å·å‘serverç«¯RPCå‘å‡ºNFSè®¿é—®è¯·æ±‚æ—¶å€™ï¼ŒRPCå°±ä¼šæ‰¾åˆ°å¯¹åº”å·²æ³¨å†Œçš„ç«¯å£å·ï¼Œå¹¶è¿”è¿˜ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥é€šè¿‡è¿™äº›ç«¯å£å·ä¸NFSå‘èµ·é“¾æ¥ã€‚æ¯”å¦‚è¯´æˆ‘æ˜¯NFSï¼Œæˆ‘åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šå‘Šè¯‰RPCï¼Œæˆ‘çš„Aç«¯å£ç”¨äºåšä»€ä¹ˆäº‹æƒ…ï¼Œæˆ‘çš„Bç«¯å£ç”¨äºåšä»€ä¹ˆäº‹æƒ…ï¼ŒRPCå°±ä¼šå°†å…¶ç«¯å£æ³¨å†Œä¿¡æ¯ç™»è®°ï¼Œç­‰å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥æ‰¾åˆ°RPCï¼Œè€Œä¸æ˜¯ç›´æ¥æ‰¾æˆ‘NFSï¼ŒRPCå¯ä»¥ç›´æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯æ‰€éœ€è¯·æ±‚å¯¹åº”çš„æ­£ç¡®çš„ç«¯å£å·ã€‚</p>
<p>å½“å®¢æˆ·ç«¯æ‰§è¡Œæ“ä½œæ–‡ä»¶ç³»ç»Ÿçš„å„é¡¹å‘½ä»¤æ—¶å€™ï¼Œä¼šè½¬äº¤ç»™å®¢æˆ·ç«¯çš„RPCï¼Œå®¢æˆ·ç«¯RPCè´Ÿè´£æ¥å—å„ä¸ªç¨‹åºä¸å¯¹åº”çš„ç«¯å£åè´Ÿè´£å¯¹ä¸»æœºè¿›è¡Œè§£æã€‚æ‰€ä»¥è¦ä½¿ç”¨NFSæ—¶ï¼Œæ— è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯ï¼Œéƒ½éœ€è¦å¯åŠ¨RPCã€‚</p>
<p>å¯åŠ¨NFSä¹‹å‰ï¼ŒRPCå°±è¦å…ˆå¯åŠ¨äº†ï¼Œä¸ç„¶NFSæ— æ³•å‘RPCæ³¨å†Œï¼Œå¹¶ä¸”ï¼ŒRPCé‡å¯ä»¥åï¼ŒåŸæ¥æ³¨å†Œçš„æ•°æ®å°±æ²¡æœ‰äº†ï¼Œæ‰€ä»¥RPCé‡æ–°å¯åŠ¨åï¼ŒNFSä¹Ÿè¦é‡å¯ï¼Œé‡æ–°æƒ³RPCæ³¨å†Œæ‰è¡Œã€‚</p>
<p>åŒæ ·ï¼ŒAå®¢æˆ·ç«¯å¯¹NFSæœåŠ¡å™¨ä¸Šçš„å…±äº«æ–‡ä»¶è¿›è¡Œäº†ä¿®æ”¹åï¼ŒBæœåŠ¡å™¨èƒ½çœ‹åˆ°æ”¹åçš„æ–‡ä»¶ï¼Œä¹Ÿå°±å®Œæˆäº†å„ä¸ªä¸»æœºä¹‹é—´æ–‡ä»¶çš„å…±äº«ã€‚æ‰€ä»¥å¦‚æœé‡å¯äº†rpcï¼Œnfsä¹Ÿå¿…é¡»è¦é‡æ–°å¯åŠ¨ï¼Œä»¥ä¾¿äºé‡æ–°åƒrpcæ³¨å†Œç›¸åº”çš„ç«¯å£å·ã€‚</p>
<ul>
<li>NFSï¼šå¤„ç†å®¢æˆ·ç«¯æ•°æ®è¯·æ±‚ï¼Œ</li>
<li>RPCï¼šå¤„ç†å®¢æˆ·ç«¯é“¾æ¥è¯·æ±‚ã€‚</li>
</ul>
<h3 id="NFSçš„ç”¨å¤„"><a href="#NFSçš„ç”¨å¤„" class="headerlink" title="NFSçš„ç”¨å¤„"></a>NFSçš„ç”¨å¤„</h3><ul>
<li>å­˜å‚¨å…±äº«æ–¹æ¡ˆ</li>
<li>ç½‘ç»œå…±äº«æ–‡ä»¶ç³»ç»Ÿ</li>
</ul>
<h3 id="é¡¹ç›®å®è·µ1ï¼šé…ç½®NFSç½‘ç»œå…±äº«æ–‡ä»¶æœåŠ¡å™¨"><a href="#é¡¹ç›®å®è·µ1ï¼šé…ç½®NFSç½‘ç»œå…±äº«æ–‡ä»¶æœåŠ¡å™¨" class="headerlink" title="é¡¹ç›®å®è·µ1ï¼šé…ç½®NFSç½‘ç»œå…±äº«æ–‡ä»¶æœåŠ¡å™¨"></a>é¡¹ç›®å®è·µ1ï¼šé…ç½®NFSç½‘ç»œå…±äº«æ–‡ä»¶æœåŠ¡å™¨</h3><p>è¦æ±‚rhel7 172.25.X.10 ä½œä¸ºNFSç½‘ç»œå…±äº«æ–‡ä»¶æœåŠ¡å™¨ï¼š</p>
<ol>
<li>å…è®¸172.25.X.11è¿™ä¸ªå®¢æˆ·ç«¯æ¥æŒ‚æ¥ä½¿ç”¨/tmpç›®å½•ï¼Œæœ‰è¯»å†™æƒé™ã€‚</li>
<li>å°†è¯»å†™æƒé™æ”¹æˆåªè¯»æƒé™ï¼›(ro)</li>
<li>å…è®¸172.25.X.0/24ç½‘æ®µæŒ‚æ¥/tmpç›®å½•ï¼Œæœ‰è¯»å†™æƒé™ï¼›</li>
<li>æœåŠ¡å™¨ä¸Šåˆ›å»ºuid=1200çš„ç”¨æˆ·tomï¼Œå¹¶ä½¿ç”¨tomç”¨æˆ·åˆ›å»º/tmp/tomfileï¼›åœ¨å®¢æˆ·ç«¯åˆ›å»ºuid=1200çš„ç”¨æˆ·jackï¼Œå°è¯•å»åˆ é™¤tomfileç›®å½•;</li>
<li>ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨(rw,no_root_squash)</li>
</ol>
<h5 id="å®éªŒå‡†å¤‡é˜¶æ®µ"><a href="#å®éªŒå‡†å¤‡é˜¶æ®µ" class="headerlink" title="å®éªŒå‡†å¤‡é˜¶æ®µ"></a>å®éªŒå‡†å¤‡é˜¶æ®µ</h5><ol>
<li>ç½‘ç»œæ‹“æ‰‘å›¾</li>
<li>è§„åˆ’è½¯ä»¶å®‰è£…</li>
<li>ä¿®æ”¹é…ç½®æ–‡ä»¶</li>
<li>å¯åŠ¨æœåŠ¡</li>
<li>å®¢æˆ·ç«¯æµ‹è¯•æœåŠ¡        </li>
</ol>
<blockquote>
<p>ç½‘ç»œæ‹“æ‰‘å›¾</p>
</blockquote>
<p><img src="pic/12.png" alt="12"></p>
<blockquote>
<p>è§„åˆ’è½¯ä»¶å®‰è£…</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">ä¸»æœºå</th>
<th align="left">ipåœ°å€</th>
<th align="left">è½¯ä»¶</th>
<th align="left">åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td align="left">rhel6</td>
<td align="left">172.25.0.11</td>
<td align="left">rpcbind nfs-utils</td>
<td align="left">æœåŠ¡ç«¯</td>
</tr>
<tr>
<td align="left">rhel7</td>
<td align="left">172.25.0.10</td>
<td align="left">rpcbind nfs-utils</td>
<td align="left">å®¢æˆ·ç«¯</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# yum install -y nfs-utils rpcbind</span><br><span class="line">Loaded plugins: product-id, refresh-packagekit, security, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">server                                                                                    | 3.9 kB     00:00     </span><br><span class="line">server/primary_db                                                                         | 3.1 MB     00:00     </span><br><span class="line">Setting up Install Process</span><br><span class="line">Package 1:nfs-utils-1.2.3-39.el6.x86_64 already installed and latest version</span><br><span class="line">Package rpcbind-0.2.0-11.el6.x86_64 already installed and latest version</span><br><span class="line">Nothing to do</span><br></pre></td></tr></table></figure>
<p>rpcbind</p>
<ul>
<li>rpc:ç®¡ç†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ipå’Œç«¯å£å·â€”è¿æ¥</li>
<li>remote    procedure callâ€”â€”è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®</li>
</ul>
<p>nfs-utils</p>
<ul>
<li>nfs:ä¼ è¾“æ•°æ®</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# rpm -qf /etc/exports</span><br><span class="line">setup-2.8.14-20.el6_4.1.noarch</span><br><span class="line">[root@rhel6 ~]# rpm -ql rpcbind</span><br><span class="line">/etc/rc.d/init.d/rpcbind</span><br><span class="line">/sbin/rpcbind</span><br><span class="line">/usr/sbin/rpcinfo</span><br><span class="line">/usr/share/doc/rpcbind-0.2.0</span><br><span class="line">/usr/share/doc/rpcbind-0.2.0/AUTHORS</span><br><span class="line">/usr/share/doc/rpcbind-0.2.0/ChangeLog</span><br><span class="line">/usr/share/doc/rpcbind-0.2.0/README</span><br><span class="line">/usr/share/man/man8/rpcbind.8.gz</span><br><span class="line">/usr/share/man/man8/rpcinfo.8.gz</span><br><span class="line">/var/cache/rpcbind</span><br><span class="line">[root@rhel6 ~]# rpm -ql nfs-utils</span><br><span class="line">/etc/nfsmount.conf</span><br><span class="line">/etc/rc.d/init.d/nfs</span><br><span class="line">/etc/rc.d/init.d/nfslock</span><br><span class="line">/etc/rc.d/init.d/rpcgssd</span><br><span class="line">/etc/rc.d/init.d/rpcidmapd</span><br><span class="line">/etc/rc.d/init.d/rpcsvcgssd</span><br><span class="line">/etc/request-key.d/id_resolver.conf</span><br><span class="line">/etc/sysconfig/nfs</span><br><span class="line">/sbin/mount.nfs</span><br><span class="line">/sbin/mount.nfs4</span><br><span class="line">/sbin/nfs_cache_getent</span><br><span class="line">/sbin/rpc.statd</span><br><span class="line">/sbin/umount.nfs</span><br><span class="line">/sbin/umount.nfs4</span><br><span class="line">/usr/sbin/exportfs</span><br><span class="line">/usr/sbin/mountstats</span><br><span class="line">/usr/sbin/nfsidmap</span><br><span class="line">/usr/sbin/nfsiostat</span><br><span class="line">/usr/sbin/nfsstat</span><br><span class="line">/usr/sbin/rpc.gssd</span><br><span class="line">/usr/sbin/rpc.idmapd</span><br><span class="line">/usr/sbin/rpc.mountd</span><br><span class="line">/usr/sbin/rpc.nfsd</span><br><span class="line">/usr/sbin/rpc.svcgssd</span><br><span class="line">/usr/sbin/rpcdebug</span><br><span class="line">/usr/sbin/showmount</span><br><span class="line">/usr/sbin/sm-notify</span><br><span class="line">/usr/sbin/start-statd</span><br><span class="line">/usr/share/doc/n7/nfsd.7.gz</span><br><span class="line">... ...</span><br><span class="line">/var/lib/nfs</span><br><span class="line">/var/lib/nfs/etab</span><br><span class="line">/var/lib/nfs/rmtab</span><br><span class="line">/var/lib/nfs/rpc_pipefs</span><br><span class="line">/var/lib/nfs/statd</span><br><span class="line">/var/lib/nfs/statd/sm</span><br><span class="line">/var/lib/nfs/statd/sm.bak</span><br><span class="line">/var/lib/nfs/state</span><br><span class="line">/var/lib/nfs/v4recovery</span><br><span class="line">/var/lib/nfs/xtab</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
</blockquote>
<p><strong>ä¸»é…ç½®æ–‡ä»¶</strong> <code>/etc/exports</code></p>
<p><strong>æœåŠ¡å</strong> <code>rpcbind</code> <code>nfs</code></p>
<p>æ ¹æ®è¦æ±‚ï¼Œå…è®¸172.25.X.10è¿™ä¸ªå®¢æˆ·ç«¯æ¥æŒ‚æ¥ä½¿ç”¨/tmpç›®å½•ï¼Œæœ‰è¯»å†™æƒé™ã€‚é…ç½®<code>/etc/exports</code>å†…å®¹ä¸º<code>/tmp 172.25.0.10(rw)</code>åï¼Œæ ¹æ®æœåŠ¡åæ¥æ‰“å¼€ç›¸åº”çš„æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# vim /etc/exports</span><br><span class="line">[root@rhel6 ~]# cat /etc/exports</span><br><span class="line">/tmp 172.25.0.10(rw)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯åŠ¨æœåŠ¡</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# service rpcbind start</span><br><span class="line">[root@rhel6 ~]# service nfs start</span><br><span class="line">Starting NFS services:                                     [  OK  ]</span><br><span class="line">Starting NFS quotas:                                       [  OK  ]</span><br><span class="line">Starting NFS mountd:                                       [  OK  ]</span><br><span class="line">Starting NFS daemon:                                       [  OK  ]</span><br><span class="line">Starting RPC idmapd:                                       [  OK  ]</span><br><span class="line">[root@rhel6 ~]# netstat -luntp |grep rpcbind</span><br><span class="line">tcp        0      0 0.0.0.0:111                 0.0.0.0:*                   LISTEN      1174/rpcbind        </span><br><span class="line">tcp        0      0 :::111                      :::*                        LISTEN      1174/rpcbind        </span><br><span class="line">udp        0      0 0.0.0.0:111                 0.0.0.0:*                               1174/rpcbind        </span><br><span class="line">udp        0      0 0.0.0.0:925                 0.0.0.0:*                               1174/rpcbind        </span><br><span class="line">udp        0      0 :::111                      :::*                                    1174/rpcbind        </span><br><span class="line">udp        0      0 :::925                      :::*                                    1174/rpcbind        </span><br><span class="line">[root@rhel6 ~]# netstat -luntp |grep nfs</span><br><span class="line">[root@rhel6 ~]# ps -ef|grep nfs</span><br><span class="line">root      1888     2  0 15:20 ?        00:00:00 [nfsd4]</span><br><span class="line">root      1889     2  0 15:20 ?        00:00:00 [nfsd4_callbacks]</span><br><span class="line">root      1890     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1891     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1892     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1893     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1894     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1895     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1896     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1897     2  0 15:20 ?        00:00:00 [nfsd]</span><br><span class="line">root      1928  1745  0 15:20 pts/0    00:00:00 grep nfs</span><br><span class="line">[root@rhel6 ~]# service iptables stop</span><br><span class="line">iptables: Setting chains to policy ACCEPT: filter          [  OK  ]</span><br><span class="line">iptables: Flushing firewall rules:                         [  OK  ]</span><br><span class="line">iptables: Unloading modules:                               [  OK  ]</span><br></pre></td></tr></table></figure>

<p><strong>å®ˆæŠ¤è¿›ç¨‹daemon</strong> <code>rpcbind</code> <code>nfsd</code></p>
<p><strong>ç›‘å¬ç«¯å£å·</strong> 111 925</p>
<blockquote>
<p>å®¢æˆ·ç«¯æµ‹è¯•ä½¿ç”¨</p>
</blockquote>
<p>æŸ¥çœ‹æœåŠ¡å™¨å…±äº«ç›®å½•çš„æƒ…å†µ <code>showmount -e 172.25.0.11</code></p>
<p>è¿œç¨‹æŒ‚è½½ <code>mount 172.25.0.10:/tmp /mnt</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# yum install -y nfs-utils rpcbind</span><br><span class="line">Loaded plugins: langpacks, product-id, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Package 1:nfs-utils-1.3.0-0.el7.x86_64 already installed and latest version</span><br><span class="line">Package rpcbind-0.2.0-23.el7.x86_64 already installed and latest version</span><br><span class="line">Nothing to do</span><br><span class="line">[root@rhel7 ~]# showmount -e 172.25.0.11</span><br><span class="line">Export list for 172.25.0.11:</span><br><span class="line">/tmp 172.25.0.10</span><br><span class="line">[root@rhel7 ~]# mount 172.25.0.11:/tmp /mnt</span><br><span class="line">[root@rhel7 ~]# mount |tail -n 1</span><br><span class="line">172.25.0.11:/tmp on /mnt type nfs4 (rw,relatime,vers=4.0,rsize=131072,wsize=131072,namlen=255,hard,proto=tcp,port=0,timeo=600,retrans=2,sec=sys,clientaddr=172.25.0.10,local_lock=none,addr=172.25.0.11)</span><br><span class="line">[root@rhel7 mnt]# touch rhel7test</span><br><span class="line">[root@rhel7 mnt]# ll</span><br><span class="line">total 12</span><br><span class="line">drwx------. 2 gdm       gdm       4096 Sep 25 02:59 orbit-gdm</span><br><span class="line">drwx------. 2 root      root      4096 Jul  2  2015 pulse-oCBy0hGD1JT6</span><br><span class="line">drwx------. 2 gdm       gdm       4096 Sep 25 02:59 pulse-q5sECpImz7Ju</span><br><span class="line">-rw-r--r--. 1 nfsnobody nfsnobody    0 Sep 25  2016 rhel7test</span><br><span class="line">[root@rhel7 mnt]# cd</span><br><span class="line">[root@rhel7 ~]# umount /mnt</span><br></pre></td></tr></table></figure>
<p><strong>nfsnobody</strong> ä»¥ root ç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶è¢«æ˜ å°„æˆ nfsnobody ç”¨æˆ· , å› ä¸ºåœ¨æœåŠ¡å™¨ä¸Šæ²¡æœ‰æŒ‡å®š no_root_squash</p>
<blockquote>
<p>å°†è¯»å†™æƒé™æ”¹æˆåªè¯»æƒé™ï¼›(ro)</p>
</blockquote>
<p>æœåŠ¡å™¨ç«¯ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# vim /etc/exports</span><br><span class="line">[root@rhel6 ~]# cat /etc/exports</span><br><span class="line">/tmp 172.25.0.10(ro)</span><br><span class="line">[root@rhel6 ~]# service rpcbind restart</span><br><span class="line">Stopping rpcbind:                                          [  OK  ]</span><br><span class="line">Starting rpcbind:                                          [  OK  ]</span><br><span class="line">[root@rhel6 ~]# service nfs restart</span><br><span class="line">Shutting down NFS daemon:                                  [  OK  ]</span><br><span class="line">Shutting down NFS mountd:                                  [  OK  ]</span><br><span class="line">Shutting down NFS quotas:                                  [  OK  ]</span><br><span class="line">Shutting down NFS services:                                [  OK  ]</span><br><span class="line">Shutting down RPC idmapd:                                  [  OK  ]</span><br><span class="line">Starting NFS services:                                     [  OK  ]</span><br><span class="line">Starting NFS quotas:                                       [  OK  ]</span><br><span class="line">Starting NFS mountd:                                       [  OK  ]</span><br><span class="line">Starting NFS daemon:                                       [  OK  ]</span><br><span class="line">Starting RPC idmapd:                                       [  OK  ]</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯rhel7</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# mount 172.25.0.11:/tmp /mnt</span><br><span class="line">[root@rhel7 ~]# touch /mnt/rhel7test2</span><br><span class="line">touch: cannot touch â€˜/mnt/rhel7test2â€™: Read-only file system</span><br><span class="line">[root@rhel7 ~]# umount /mnt</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å…è®¸172.25.X.0/24ç½‘æ®µæŒ‚æ¥/tmpç›®å½•ï¼Œæœ‰è¯»å†™æƒé™ï¼›</p>
</blockquote>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸º <code>/tmp 172.25.0.0/24(rw)</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# vim /etc/exports</span><br><span class="line">[root@rhel6 ~]# cat /etc/exports</span><br><span class="line">/tmp 172.25.0.0/24(rw)</span><br><span class="line">[root@rhel6 ~]# service rpcbind restart</span><br><span class="line">Stopping rpcbind:                                          [  OK  ]</span><br><span class="line">Starting rpcbind:                                          [  OK  ]</span><br><span class="line">[root@rhel6 ~]# service nfs restart</span><br><span class="line">Shutting down NFS daemon:                                  [  OK  ]</span><br><span class="line">Shutting down NFS mountd:                                  [  OK  ]</span><br><span class="line">Shutting down NFS quotas:                                  [  OK  ]</span><br><span class="line">Shutting down NFS services:                                [  OK  ]</span><br><span class="line">Shutting down RPC idmapd:                                  [  OK  ]</span><br><span class="line">Starting NFS services:                                     [  OK  ]</span><br><span class="line">Starting NFS quotas:                                       [  OK  ]</span><br><span class="line">Starting NFS mountd:                                       [  OK  ]</span><br><span class="line">Starting NFS daemon:                                       [  OK  ]</span><br><span class="line">Starting RPC idmapd:                                       [  OK  ]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ†åˆ«åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šéƒ½åˆ›å»ºä¸€ä¸ªid=1200çš„ç”¨æˆ·tomï¼Œåœ¨å®¢æˆ·ç«¯ç”¨tomç”¨æˆ·æ–°å»ºä¸€ä¸ªæ–‡ä»¶rhel7tomfileï¼Œå¹¶æŸ¥çœ‹å±æ€§ï¼Œå†åˆ°æœåŠ¡å™¨ä¸Šå»æŸ¥çœ‹è¯¥æ–‡ä»¶çš„å±æ€§ï¼›åœ¨æœåŠ¡å™¨ä¸Šç”¨tomç”¨æˆ·å»åˆ›å»ºrhel6tomfileï¼ŒæŸ¥çœ‹å±æ€§ï¼Œå†åˆ°å®¢æˆ·ç«¯ä¸ŠæŸ¥çœ‹å±æ€§ã€‚</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡ç«¯rhel6</span></span><br><span class="line">[root@rhel6 ~]# useradd -u 1200 tom</span><br><span class="line">[root@rhel6 ~]# echo uplooking|passwd --stdin tom</span><br><span class="line">Changing password for user tom.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">[root@rhel6 ~]# su - tom</span><br><span class="line">[tom@rhel6 ~]$ touch /tmp/tomfile</span><br><span class="line">[tom@rhel6 ~]$ ll /tmp/tomfile</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Sep 25 15:55 /tmp/tomfile</span><br><span class="line">[tom@rhel6 tmp]$ touch rhel6tomfile</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯rhel7</span></span><br><span class="line">[tom@rhel7 mnt]$ touch rhel7tomfile</span><br><span class="line">[tom@rhel7 mnt]$ ll</span><br><span class="line">total 12</span><br><span class="line">-rw-rw-r--. 1 nobody nobody    0 Sep 25 04:03 4913</span><br><span class="line">drwx------. 2 gdm    gdm    4096 Sep 25 02:59 orbit-gdm</span><br><span class="line">drwx------. 2 root   root   4096 Jul  2  2015 pulse-oCBy0hGD1JT6</span><br><span class="line">drwx------. 2 gdm    gdm    4096 Sep 25 02:59 pulse-q5sECpImz7Ju</span><br><span class="line">-rw-rw-r--. 1 nobody nobody    0 Sep 25 04:07 rhel7tomfile</span><br><span class="line">-rw-rw-r--. 1 nobody nobody    0 Sep 25 04:06 tomfile</span><br><span class="line">[tom@rhel7 mnt]$ rm -rf rhel7tomfile</span><br><span class="line">rm: cannot remove â€˜rhel7tomfileâ€™: Operation not permitted</span><br><span class="line">[tom@rhel7 mnt]$ rm -rf rhel6tomfile</span><br><span class="line">rm: cannot remove â€˜rhel6tomfileâ€™: Operation not permitted</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡ç«¯rhel6</span></span><br><span class="line">[tom@rhel6 tmp]$ ll</span><br><span class="line">total 12</span><br><span class="line">-rw-rw-r--. 1 tom  tom     0 Sep 25 16:03 4913</span><br><span class="line">drwx------. 2 gdm  gdm  4096 Sep 25 14:59 orbit-gdm</span><br><span class="line">drwx------. 2 root root 4096 Jul  2  2015 pulse-oCBy0hGD1JT6</span><br><span class="line">drwx------. 2 gdm  gdm  4096 Sep 25 14:59 pulse-q5sECpImz7Ju</span><br><span class="line">-rw-rw-r--. 1 tom  tom     0 Sep 25 16:10 rhel6tomfile</span><br><span class="line">-rw-rw-r--. 1 tom  tom     0 Sep 25 16:07 rhel7tomfile</span><br></pre></td></tr></table></figure>

<p>ä¸¤ä¸ªæ–°æ–‡ä»¶åœ¨å®¢æˆ·ç«¯å‡æ˜¾ç¤ºå±äºnobodyï¼Œè€Œåœ¨æœåŠ¡å™¨ç«¯æ˜¾ç¤ºå±äºtomç”¨æˆ·ï¼Œå¹¶ä¸”ä¼šå‘ç°åœ¨å®¢æˆ·ç«¯ç”±tomç”¨æˆ·åˆ›å»ºå‡ºæ¥çš„æ–‡ä»¶ä¹Ÿæ²¡æœ‰åŠæ³•åˆ é™¤ã€‚</p>
<p>è¿™æ˜¯ç”±äºå½“å‰æœåŠ¡å™¨ç‰ˆæœ¬æ¯”å®¢æˆ·ç«¯ä½çš„ç¼˜æ•…ã€‚</p>
<p>å¦‚æœå°†rhel7ä½œä¸ºæœåŠ¡ç«¯ï¼Œrhel6ä½œä¸ºå®¢æˆ·ç«¯ï¼Œå°±ä¸ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜äº†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th align="left">ä¸»æœºå</th>
<th align="left">ipåœ°å€</th>
<th align="left">è½¯ä»¶</th>
<th align="left">åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td align="left">rhel6</td>
<td align="left">172.25.0.11</td>
<td align="left">rpcbind nfs-utils</td>
<td align="left">å®¢æˆ·ç«¯</td>
</tr>
<tr>
<td align="left">rhel7</td>
<td align="left">172.25.0.10</td>
<td align="left">rpcbind nfs-utils</td>
<td align="left">æœåŠ¡ç«¯</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡ç«¯rhel7</span></span><br><span class="line">[root@rhel7 ~]# vim /etc/exports</span><br><span class="line">[root@rhel7 ~]# systemctl stop firewalld</span><br><span class="line">[root@rhel7 ~]# systemctl start rpcbind</span><br><span class="line">[root@rhel7 ~]# systemctl start nfs</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯rhel6</span></span><br><span class="line">[root@rhel6 tmp]# mount 172.25.0.10:/tmp /mnt</span><br><span class="line">[root@rhel6 tmp]# cd /mnt</span><br><span class="line">[tom@rhel6 mnt]$ touch rhel6tomfile</span><br><span class="line">[tom@rhel6 mnt]$ ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 tom  tom   0 Sep 25 16:22 rhel6tomfile</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:58 systemd-private-jFcaMN</span><br><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡ç«¯rhel7</span></span><br><span class="line">[tom@rhel7 tmp]$ touch rhel7tomfile</span><br><span class="line">[tom@rhel7 tmp]$ ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 tom  tom   0 Sep 25 04:22 rhel6tomfile</span><br><span class="line">-rw-rw-r--. 1 tom  tom   0 Sep 25 04:24 rhel7tomfile</span><br><span class="line">drwx------. 3 root root 16 Sep 25 02:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 02:58 systemd-private-jFcaMN</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯rhel6</span></span><br><span class="line">[tom@rhel6 mnt]$ ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 tom  tom   0 Sep 25 16:22 rhel6tomfile</span><br><span class="line">-rw-rw-r--. 1 tom  tom   0 Sep 25 16:24 rhel7tomfile</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:58 systemd-private-jFcaMN</span><br><span class="line">[tom@rhel6 mnt]$ rm -rf rhel6tomfile</span><br><span class="line">[tom@rhel6 mnt]$ rm -rf rhel7tomfile</span><br><span class="line">[tom@rhel6 mnt]$ ll</span><br><span class="line">total 0</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:58 systemd-private-jFcaMN</span><br></pre></td></tr></table></figure>

<p><strong>æ–‡ä»¶æ‰€å±è€…å’Œæ‰€å±ç»„æ˜¯æ ¹æ®uidå’Œgidæ¥åŒ¹é…çš„ã€‚</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡å™¨rhel7</span></span><br><span class="line">[root@rhel7 ~]# useradd -u 1003 batman</span><br><span class="line">[root@rhel7 ~]# echo uplooking|passwd --stdin batman</span><br><span class="line">Changing password for user batman.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">[root@rhel7 ~]# id batman</span><br><span class="line">uid=1003(batman) gid=1003(batman) groups=1003(batman)</span><br><span class="line">[root@rhel7 ~]# su batman</span><br><span class="line">[batman@rhel7 root]$ cd /tmp</span><br><span class="line">[batman@rhel7 tmp]$ ll</span><br><span class="line">total 0</span><br><span class="line">drwx------. 3 root root 16 Sep 25 02:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 02:58 systemd-private-jFcaMN</span><br><span class="line">[batman@rhel7 tmp]$ touch rhel7batmanfile</span><br><span class="line">[batman@rhel7 tmp]$ ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 batman batman  0 Sep 25 04:27 rhel7batmanfile</span><br><span class="line">drwx------. 3 root   root   16 Sep 25 02:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root   root   16 Sep 25 02:58 systemd-private-jFcaMN</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rhel6 mnt]# ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 1003 1003  0 Sep 25 16:27 rhel7batmanfile</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:58 systemd-private-jFcaMN</span><br><span class="line">[root@rhel6 mnt]# useradd -u 1003 superman</span><br><span class="line">[root@rhel6 mnt]# echo uplooking|passwd --stdin superman</span><br><span class="line">Changing password for user superman.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">[root@rhel6 mnt]# ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 superman superman  0 Sep 25 16:27 rhel7batmanfile</span><br><span class="line">drwx------. 3 root     root     16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root     root     16 Sep 25 14:58 systemd-private-jFcaMN</span><br><span class="line">[root@rhel6 mnt]# su  superman</span><br><span class="line">[superman@rhel6 mnt]$ ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 superman superman  0 Sep 25 16:27 rhel7batmanfile</span><br><span class="line">drwx------. 3 root     root     16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root     root     16 Sep 25 14:58 systemd-private-jFcaMN</span><br><span class="line">[superman@rhel6 mnt]$ rm -rf rhel7batmanfile</span><br><span class="line">[superman@rhel6 mnt]$ ll</span><br><span class="line">total 0</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:58 systemd-private-jFcaMN</span><br></pre></td></tr></table></figure>

<p>åœ¨æœåŠ¡å™¨ä¸Šä»¥ batman ç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶è¢«æ˜ å°„æˆå®¢æˆ·ç«¯çš„ superman ç”¨æˆ· , å› ä¸ºåœ¨æœåŠ¡å™¨ä¸Š batman çš„ id ä¸ superman çš„ id ç›¸åŒ</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨(rw,no_root_squash)</p>
</blockquote>
<p><strong>é¢è¯•é¢˜</strong></p>
<ol>
<li>å®¢æˆ·è¯´ä¸ºä»€ä¹ˆæˆ‘æ˜¯rootï¼Œå´ä¸èƒ½åˆ é™¤rootçš„æ–‡ä»¶å‘¢ï¼ˆå‰ææ˜¯è¯¥æ–‡ä»¶æ˜¯nfsæœåŠ¡æŒ‚æ¥ä½¿ç”¨çš„ï¼‰ï¼Ÿ</li>
</ol>
<ul>
<li>1ï¼‰è€ƒè™‘åˆ°å®‰å…¨ï¼Œå½“å‰æˆ‘ä»¬nfsçš„é…ç½®ä¸­å°±è®¾ç½®ä¸ºæœ¬åœ°çš„rootç”¨æˆ·æ˜¯æ²¡æœ‰æƒé™åˆ é™¤æœåŠ¡å™¨ç«¯çš„rootç”¨æˆ·æ–‡ä»¶çš„ã€‚</li>
<li>2ï¼‰å¦‚æœå®¢æˆ·ä½ ä¸€å®šè¦å»æœ‰è¿™ä¸ªæƒé™ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä¿®æ”¹é…ç½®ï¼Œæ·»åŠ ä¸€ä¸ªno_root_squashï¼›ä¸å»ºè®®è¿™ä¹ˆåšã€‚</li>
</ul>
<ol start="2">
<li>å®¢æˆ·ç”µè¯å’¨è¯¢è¯´æœåŠ¡å™¨å‡ºæ•…éšœäº†ï¼Œ</li>
</ol>
<ul>
<li>1ï¼‰æŒ‚æ¥ç›®å½•æ‰§è¡Œä»»ä½•æ“ä½œå°±å¡æ­»äº†ï¼Œç„¶åæˆ‘é‡å¯ï¼Œå°±å¡åœ¨å“ªé‡Œäº†ï¼Œ/mnt</li>
<li>2ï¼‰å‰ä¸€å¤©è¿˜æ­£å¸¸ï¼Œä»Šå¤©ä¸Šç­å¼€ä¸äº†æœºäº†</li>
<li>3ï¼‰mountæŸ¥çœ‹å½“å‰æŒ‚æ¥ç›®å½•ï¼Œå¡åœ¨å“ªé‡Œï¼Œæ€æ‰è¿›ç¨‹ï¼Œå†mountè¿˜æ˜¯å¡åœ¨é‚£é‡Œ</li>
</ul>
<p>ä»¥ä¸Šéƒ½æœ‰å¯èƒ½æ˜¯nfsæœåŠ¡å™¨è¿æ¥å‡ºç°é—®é¢˜äº†ï¼Œåº”è¯¥å»æ£€æŸ¥ä¸€ä¸‹nfsæœåŠ¡å™¨çš„è¿è¡Œæƒ…å†µã€‚å†æ’é”™ã€‚</p>
<h3 id="é…ç½®æ–‡ä»¶è¯¦è§£"><a href="#é…ç½®æ–‡ä»¶è¯¦è§£" class="headerlink" title="é…ç½®æ–‡ä»¶è¯¦è§£"></a>é…ç½®æ–‡ä»¶è¯¦è§£</h3><h4 id="ä¸»é…ç½®æ–‡ä»¶-etc-exports"><a href="#ä¸»é…ç½®æ–‡ä»¶-etc-exports" class="headerlink" title="ä¸»é…ç½®æ–‡ä»¶/etc/exports"></a>ä¸»é…ç½®æ–‡ä»¶/etc/exports</h4><p>å…³äºexportsçš„å†™æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡  <code>man 5 exports</code> æ¥æŸ¥çœ‹ <code>EXAMPLES</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> sample /etc/exports file</span></span><br><span class="line"><span class="meta">#</span><span class="bash">      å…±äº«ç›®å½•             å®¢æˆ·ç«¯åˆ—è¡¨ï¼ˆæƒé™ï¼‰</span></span><br><span class="line">       /               master(rw) trusty(rw,no_root_squash)</span><br><span class="line">       /projects       proj*.local.domain(rw)</span><br><span class="line">       /usr            *.local.domain(ro) @trusted(rw)</span><br><span class="line">       /home/joe       pc001(rw,all_squash,anonuid=150,anongid=100)</span><br><span class="line">       /pub            *(ro,insecure,all_squash)</span><br><span class="line">       /srv/www        -sync,rw server @trusted @external(ro)</span><br><span class="line">       /foo            2001:db8:9:e54::/64(rw) 192.0.2.0/24(rw)</span><br><span class="line">       /build          buildhost[0-9].local.domain(rw)</span><br></pre></td></tr></table></figure>

<p>è¯¦ç»†å‚æ•°è§£é‡Šå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">rw</td>
<td align="left">å¯è¯»å¯å†™</td>
</tr>
<tr>
<td align="left">ro</td>
<td align="left">åªè¯»</td>
</tr>
<tr>
<td align="left">sync</td>
<td align="left">æ•°æ®åŒæ­¥å†™å…¥å†…å­˜ç¼“å†²åŒºä¸ç£ç›˜ä¸­ï¼Œè™½ç„¶è¿™æ ·åšæ•ˆç‡è¾ƒä½ï¼Œä½†å¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼ˆé€‚åˆäºå°æ–‡ä»¶ä¼ è¾“ï¼‰</td>
</tr>
<tr>
<td align="left">async</td>
<td align="left">æ•°æ®å…ˆæš‚æ—¶æ”¾äºå†…å­˜ï¼Œè€Œéç›´æ¥å†™å…¥ç¡¬ç›˜ï¼Œç­‰åˆ°å¿…è¦æ—¶æ‰å†™å…¥ç£ç›˜ï¼ˆé€‚åˆäºå¤§æ–‡ä»¶ä¼ è¾“ï¼‰</td>
</tr>
<tr>
<td align="left">no_root_squash</td>
<td align="left">ä½¿ç”¨nfsæ—¶ï¼Œå¦‚æœç”¨æˆ·æ˜¯rootï¼Œä¸è¿›è¡Œæƒé™å‹ç¼©ï¼Œå³rootç”¨æˆ·åœ¨nfsä¸Šåˆ›å»ºçš„æ–‡ä»¶   å±ç»„å’Œå±ä¸»ä»ç„¶æ˜¯rootï¼ˆä¸å®‰å…¨ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼‰</td>
</tr>
<tr>
<td align="left">root_squash</td>
<td align="left">ä½¿ç”¨nfsæ—¶ï¼Œå¦‚æœç”¨æˆ·æ˜¯rootï¼Œåˆ™è¿›è¡Œæƒé™å‹ç¼©ï¼Œå³æŠŠrootç”¨æˆ·åœ¨nfsä¸Šåˆ›å»ºçš„æ–‡ä»¶   å±ç»„å’Œå±ä¸»ä¿®æ”¹ä¸ºnfsnobody</td>
</tr>
<tr>
<td align="left">all_squash</td>
<td align="left">æ‰€æœ‰çš„æ™®é€šç”¨æˆ·ä½¿ç”¨nfséƒ½å°†ä½¿ç”¨æƒé™å‹ç¼©ï¼Œå³ï¼šå°†è¿œç¨‹è®¿é—®çš„æ‰€æœ‰æ™®é€šç”¨æˆ·åŠæ‰€å±ç”¨æˆ·ç»„éƒ½æ˜ å°„ä¸ºåŒ¿åç”¨æˆ·æˆ–è€…ç”¨æˆ·ç»„ï¼ˆä¸€èˆ¬å‡ä¸ºnfsnobodyï¼‰</td>
</tr>
<tr>
<td align="left">no_all_squash</td>
<td align="left">æ‰€æœ‰çš„æ™®é€šç”¨æˆ·ä½¿ç”¨nfséƒ½ä¸ä½¿ç”¨æƒé™å‹ç¼©ï¼Œå³ï¼šä¸å°†è¿œç¨‹è®¿é—®çš„æ‰€æœ‰æ™®é€šç”¨æˆ·åŠæ‰€å±ç”¨æˆ·ç»„éƒ½æ˜ å°„ä¸ºåŒ¿åç”¨æˆ·æˆ–è€…ç”¨æˆ·ç»„ï¼ˆé»˜è®¤è®¾ç½®ï¼‰</td>
</tr>
<tr>
<td align="left">anonuid=XXX</td>
<td align="left">anonå³anonymous(åŒ¿åè€…)ï¼Œå‰é¢å…³äº*_squashæåˆ°çš„åŒ¿åç”¨æˆ·çš„uidçš„è®¾ç½®å€¼ï¼Œé€šå¸¸ä¸ºnobodyæˆ–è€…nfsnobodyï¼Œä½¿ç”¨è¿™ä¸ªå‚æ•°å¯ä»¥è‡ªè¡Œè®¾å®šè¿™ä¸ªuidå€¼ï¼Œè¿™ä¸ªuidå¿…é¡»å­˜åœ¨ äº/etc/passwd</td>
</tr>
<tr>
<td align="left">anongid=XXX</td>
<td align="left">å°†è¿œç¨‹è®¿é—®çš„æ‰€æœ‰ç”¨æˆ·ç»„éƒ½æ˜ èº«ä¸ºåŒ¿åç”¨æˆ·ç»„è´¦æˆ·ï¼Œå¹¶æŒ‡å®šè¯¥åŒ¿åç”¨æˆ·ç»„è´¦æˆ·ä¸ºæœ¬åœ°ç”¨æˆ·ç»„è´¦æˆ·ï¼ˆGID=XXXï¼‰</td>
</tr>
<tr>
<td align="left">insecure</td>
<td align="left">å…è®¸å®¢æˆ·ç«¯ä»å¤§äº1024çš„TCP/IPç«¯å£è¿NFSæœåŠ¡å™¨</td>
</tr>
<tr>
<td align="left">secure</td>
<td align="left">é™åˆ¶å®¢æˆ·ç«¯åªèƒ½ä»å°äº1024çš„TCP/IPç«¯å£è¿æ¥NFSæœåŠ¡å™¨(é»˜è®¤è®¾ç½®)</td>
</tr>
<tr>
<td align="left">wdelay</td>
<td align="left">æ£€æŸ¥æ˜¯å¦æœ‰ç›¸å…³çš„å†™æ“ä½œï¼Œå¦‚æœæœ‰åˆ™å°†è¿™äº›å†™æ“ä½œä¸€èµ·æ‰§è¡Œï¼Œè¿™æ ·å¯æé«˜æ•ˆç‡(é»˜è®¤è®¾ç½®)</td>
</tr>
<tr>
<td align="left">no_wdelay</td>
<td align="left">è‹¥æœ‰å†™æ“ä½œåˆ™ç«‹å³æ‰§è¡Œï¼ˆåº”ä¸syncé…ç½®ï¼‰</td>
</tr>
<tr>
<td align="left">subtree_check</td>
<td align="left">è‹¥è¾“å‡ºç›®å½•æ˜¯ä¸€ä¸ªå­ç›®å½•ï¼Œåˆ™NFSW:åŠ¡å™¨å°†æ£€æŸ¥å…¶çˆ¶ç›®å½•çš„æƒé™(é»˜è®¤è®¾ç½®)</td>
</tr>
<tr>
<td align="left">no_subtree_check</td>
<td align="left">å³ä½¿è¾“å‡ºç›®å½•æ˜¯ä¸€ä¸ªå­ç›®å½•ï¼ŒNFSæœåŠ¡å™¨ä¹Ÿä¸æ£€æŸ¥å…¶çˆ¶ç›®å½•çš„æƒé™ï¼Œè¿™æ ·åšå¯æé«˜æ•ˆç‡</td>
</tr>
</tbody></table>
<p><strong>è®¾ç½®å®ä¾‹</strong></p>
<p><code>/tmp *(rw,no_root_squash)</code></p>
<p>åœ¨æ‰€æœ‰çš„IPï¼ˆä¸»æœºï¼‰ä¸Šç™»å½•çš„ç”¨æˆ·éƒ½å¯å¯¹NFSæœåŠ¡å™¨ä¸Šçš„å…±äº«ç›®å½•/tmpæ‹¥æœ‰rwæ“ä½œæƒé™ï¼ŒåŒæ—¶å¦‚æœæ˜¯rootç”¨æˆ·è®¿é—®è¯¥å…±äº«ç›®å½•ï¼Œé‚£ä¹ˆä¸å°†rootç”¨æˆ·åŠæ‰€å±ç”¨æˆ·ç»„éƒ½æ˜ å°„ä¸ºåŒ¿åç”¨æˆ·æˆ–ç”¨æˆ·ç»„ï¼ˆ*è¡¨ç¤ºæ‰€æœ‰çš„ä¸»æœºæˆ–è€…IPï¼‰</p>
<p><code>/tmp *(rw)</code></p>
<p>åœ¨æ‰€æœ‰çš„IPï¼ˆä¸»æœºï¼‰ç™»å½•çš„ç”¨æˆ·éƒ½å¯å¯¹NFSæœåŠ¡å™¨ä¸Šçš„å…±äº«ç›®å½•/tmpæ‹¥æœ‰rwæ“ä½œæƒé™</p>
<p><code>/home/public 192.168.0.*(rw)   *(ro)</code>  æˆ–è€… <code>/home/public 192.168.0.0/24(rw) *(ro)</code></p>
<p>é™¤äº†åœ¨<code>192. 168. 0.0/24</code>è¿™ä¸ªç½‘æ®µå†…çš„ä¸»æœºä¸Šç™»å½•çš„ç”¨æˆ·ï¼Œå¯å¯¹NFSæœåŠ¡å™¨å…±äº«ç›®å½•<code>/home/public</code>è¿›è¡Œ<code>rw</code>æ“ä½œæƒé™ï¼Œè€Œå…¶å®ƒç½‘æ®µçš„ä¸»æœºä¸Šç™»å½•çš„ç”¨æˆ·ï¼Œå¯¹NFSæœåŠ¡å™¨å…±äº«ç›®å½•<code>/home/public</code>åªèƒ½è¿›è¡Œ<code>r</code>æ“ä½œ</p>
<p><code>/home/test 192.168.0.100(rw)</code></p>
<p>åªå¯¹<code>192.168.0.100</code>è¯¥å°ä¸»æœºè®¾ç½®æƒé™ï¼Œå³ï¼šä½¿åœ¨è¯¥å°ä¸»æœºç™»å½•çš„ç”¨æˆ·éƒ½å¯å¯¹NFSæœåŠ¡å™¨ä¸Šçš„å…±äº«ç›®å½•<code>/home/test</code>æ‹¥æœ‰è¯»ä¸å†™çš„æ“ä½œ</p>
<p><code>/home/linux *.linux.org(rw,all_squash,anonuid=40,anongid=40)</code></p>
<p>å½“<code>*.linux.org</code>ï¼ˆåŠ å…¥åŸŸ<code>linux.org</code>çš„æ‰€æœ‰ä¸»æœºï¼‰ ç™»é™†æ­¤NFSä¸»æœºï¼Œå¹¶ä¸”åœ¨<code>/home/linux</code>ä¸‹é¢å†™å…¥æ¡£æ¡ˆæ—¶ï¼Œè¯¥æ¡£æ¡ˆçš„æ‰€æœ‰äººä¸æ‰€æœ‰ç»„ï¼Œå°±ä¼šå˜æˆNFSæœåŠ¡å™¨ä¸Šçš„<code>/etc/passwd</code>æ–‡ä»¶é‡Œé¢å¯¹åº”çš„<code>UID</code>ä¸º40çš„é‚£ä¸ªèº«ä»½çš„ä½¿ç”¨è€…äº†ï¼ˆå› ä¸ºæŒ‡å®šäº†å‚æ•°ï¼š<code>all_squashï¼Œanonuid=40ï¼Œanongid=40</code>ï¼‰</p>
<hr>
<h3 id="é¡¹ç›®å®è·µ2ï¼šè‡ªåŠ¨æŒ‚æ¥NFS"><a href="#é¡¹ç›®å®è·µ2ï¼šè‡ªåŠ¨æŒ‚æ¥NFS" class="headerlink" title="é¡¹ç›®å®è·µ2ï¼šè‡ªåŠ¨æŒ‚æ¥NFS"></a>é¡¹ç›®å®è·µ2ï¼šè‡ªåŠ¨æŒ‚æ¥NFS</h3><p>è¦æ±‚åˆ†åˆ«é€šè¿‡ä¸‹é¢ä¸‰ç§æ–¹æ³•å®ç°è‡ªåŠ¨æŒ‚æ¥<br>    *    /etc/fstabï¼ˆå®¹æ˜“å‡ºé—®é¢˜ï¼‰<br>    * /etc/bashrc<br>    * autofsæœåŠ¡</p>
<h4 id="etc-fstab"><a href="#etc-fstab" class="headerlink" title="/etc/fstab"></a>/etc/fstab</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# vim /etc/fstab</span><br><span class="line">172.25.0.10:/tmp        /mnt                    nfs     defaults        0 0</span><br><span class="line">[root@rhel6 ~]# mount -a</span><br><span class="line">[root@rhel6 ~]# mount |tail -n 1</span><br><span class="line">172.25.0.10:/tmp on /mnt type nfs (rw,vers=4,addr=172.25.0.10,clientaddr=172.25.0.11)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœnfsæœåŠ¡å™¨å‡ºç°é—®é¢˜ï¼Œå¯¼è‡´å®¢æˆ·ç«¯æ— æ³•æŒ‚æ¥ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°å¼€æœºå¯åŠ¨å¤±è´¥çš„æƒ…å†µã€‚å› æ­¤ä¸å»ºè®®è¿™ä¹ˆåšã€‚</p>
<h4 id="etc-bashrc"><a href="#etc-bashrc" class="headerlink" title="/etc/bashrc"></a>/etc/bashrc</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# vim /etc/bashrc</span><br><span class="line">[root@rhel6 ~]# grep mount /etc/bashrc</span><br><span class="line">mount 172.25.0.10:/tmp /mnt</span><br><span class="line">[root@rhel6 ~]# reboot</span><br><span class="line"></span><br><span class="line">Broadcast message from root@rhel6</span><br><span class="line">	(/dev/pts/0) at 16:53 ...</span><br><span class="line"></span><br><span class="line">The system is going down for reboot NOW!</span><br><span class="line">[root@rhel6 ~]# Connection to 172.25.0.11 closed by remote host.</span><br><span class="line">Connection to 172.25.0.11 closed.</span><br><span class="line">[root@foundation0 ~]# ssh root@172.25.0.11</span><br><span class="line">Last login: Sun Sep 25 16:52:03 2016 from 172.25.0.250</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mount.nfs: Connection timed out</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå°†æŒ‚æ¥çš„å‘½ä»¤æ”¾åœ¨å¼€æœºå¯åŠ¨åçš„ç»ˆç«¯å¯åŠ¨è„šæœ¬ä¸­ï¼Œé‚£ä¹ˆåªä¼šæœ‰ä¸€ä¸ªæŠ¥é”™è€Œå·²ã€‚</p>
<h4 id="autofs-è‡ªåŠ¨æŒ‚æ¥æœåŠ¡"><a href="#autofs-è‡ªåŠ¨æŒ‚æ¥æœåŠ¡" class="headerlink" title="autofs è‡ªåŠ¨æŒ‚æ¥æœåŠ¡"></a>autofs è‡ªåŠ¨æŒ‚æ¥æœåŠ¡</h4><p>ä½¿ç”¨çš„æ—¶å€™æŒ‚æ¥ï¼Œä¸ä½¿ç”¨ç­‰å¾…5åˆ†é’Ÿåå¸è½½ï¼Œè€Œç­‰å¾…çš„æ—¶é—´æ—¶å¯ä»¥è°ƒæ•´çš„ï¼Œåœ¨<code>/etc/sysconfig/autofs</code>é…ç½®æ–‡ä»¶ä¸­é€šè¿‡<code>TIMEOUT</code>å‚æ•°è°ƒæ•´ï¼Œä¾‹å¦‚<code>TIMEOUT=300</code>ã€‚</p>
<ol>
<li><p>è½¯ä»¶        autofs</p>
</li>
<li><p>service        autofs</p>
</li>
<li><p>daemon        automount        </p>
</li>
<li><p>é…ç½®æ–‡ä»¶</p>
<ul>
<li>/etc/auto.master    çˆ¶æŒ‚æ¥ç‚¹</li>
<li>/etc/auto.booboo    å­æŒ‚æ¥ç‚¹<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">172.25.0.10:&#x2F;tmp &#x2F;mnt&#x2F;share</span><br><span class="line">		&#x2F;mnt	çˆ¶æŒ‚æ¥ç‚¹</span><br><span class="line">		share	å­æŒ‚æ¥ç‚¹</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>é…ç½®æ–‡ä»¶æ ¼å¼</p>
</li>
</ol>
<p>å¯ä»¥é€šè¿‡<code>man 5 autofs</code>æŸ¥çœ‹é…ç½®æ–‡ä»¶çš„æ ¼å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;etc&#x2F;auto.master</span><br><span class="line">&#x2F;mnt	&#x2F;etc&#x2F;auto.booboo</span><br><span class="line"></span><br><span class="line">&#x2F;etc&#x2F;auto.booboo</span><br><span class="line">share	-rw	172.25.0.10:&#x2F;tmp</span><br></pre></td></tr></table></figure>

<p><strong>è‡ªåŠ¨æŒ‚æ¥autofsåœºæ™¯</strong></p>
<p>rhel7 ä½œä¸ºnfsç½‘ç»œå…±äº«æ–‡ä»¶ç³»ç»ŸæœåŠ¡ï¼›rhel6ä½œä¸ºnfsçš„å®¢æˆ·ç«¯ç°åœ¨æƒ³è‡ªåŠ¨æŒ‚æ¥rhel7çš„/tmpç›®å½•ä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡autofsã€‚</p>
<table>
<thead>
<tr>
<th align="left">ä¸»æœºå</th>
<th align="left">ipåœ°å€</th>
<th align="left">è½¯ä»¶</th>
<th align="left">åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td align="left">rhel6</td>
<td align="left">172.25.0.11</td>
<td align="left">rpcbind nfs-utils</td>
<td align="left">nfså®¢æˆ·ç«¯ï¼›autofsæœåŠ¡ç«¯</td>
</tr>
<tr>
<td align="left">rhel7</td>
<td align="left">172.25.0.10</td>
<td align="left">rpcbind nfs-utils</td>
<td align="left">nfsæœåŠ¡ç«¯</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# yum install -y autofs</span><br><span class="line">Loaded plugins: product-id, refresh-packagekit, security, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Setting up Install Process</span><br><span class="line">Package 1:autofs-5.0.5-88.el6.x86_64 already installed and latest version</span><br><span class="line">Nothing to do</span><br><span class="line">[root@rhel6 ~]# rpm -ql autofs</span><br><span class="line">/etc/auto.master</span><br><span class="line">/etc/auto.misc</span><br><span class="line">/etc/auto.net</span><br><span class="line">/etc/auto.smb</span><br><span class="line">/etc/autofs_ldap_auth.conf</span><br><span class="line">/etc/rc.d/init.d/autofs</span><br><span class="line">/etc/sysconfig/autofs</span><br><span class="line">/misc</span><br><span class="line">/net</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# vim /etc/auto.master</span><br><span class="line">/mnt    /etc/auto.booboo</span><br><span class="line">[root@rhel6 ~]# vim /etc/auto.booboo</span><br><span class="line">share   -rw     172.25.0.10:/tmp</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# mkdir /mnt/share</span><br><span class="line">[root@rhel6 ~]# service autofs start</span><br><span class="line">Starting automount:                                        [  OK  ]</span><br><span class="line">[root@rhel6 ~]# ll /mnt/share</span><br><span class="line">total 0</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:59 systemd-private-hPL7GQ</span><br><span class="line">drwx------. 3 root root 16 Sep 25 14:58 systemd-private-jFcaMN</span><br></pre></td></tr></table></figure>


<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><img src="pic/06.png" alt="06"></p>
<p><img src="pic/07.png" alt="07"></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxåŸºç¡€æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>FTPæ–‡ä»¶å…±äº«æœåŠ¡</title>
    <url>/2016/12/23/booboo_easy_service/02_ftp/</url>
    <content><![CDATA[<blockquote>
<p>è¯¾ç¨‹è¦æ±‚</p>
</blockquote>
<ol>
<li>è®¾ç½®vsftpdæœåŠ¡åŒ¿åç”¨æˆ·èƒ½å¤Ÿå¯¹/var/ftp/pub/ç›®å½•æœ‰ä¸Šä¼ ä¸‹è½½çš„æƒé™ã€‚</li>
<li>ç³»ç»Ÿç”¨æˆ·èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œä¸Šä¼ ä¸‹è½½åˆ é™¤</li>
<li>é™¤äº†ç³»ç»Ÿç”¨æˆ·studentæœ‰chrootçš„æƒé™ï¼Œå…¶ä»–ç³»ç»Ÿç”¨æˆ·æ²¡æœ‰chrootçš„æƒé™</li>
</ol>
<h3 id="FTPæœåŠ¡"><a href="#FTPæœåŠ¡" class="headerlink" title="FTPæœåŠ¡"></a>FTPæœåŠ¡</h3><p>FTP æ˜¯File Transfer Protocolï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰çš„è‹±æ–‡ç®€ç§°ï¼Œè€Œä¸­æ–‡ç®€ç§°ä¸ºâ€œæ–‡ä¼ åè®®â€ã€‚ç”¨äº<br>Internetä¸Šçš„æ§åˆ¶æ–‡ä»¶çš„åŒå‘ä¼ è¾“ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ˆApplicationï¼‰ã€‚åŸºäºä¸åŒçš„æ“ä½œç³»ç»Ÿæœ‰<br>ä¸åŒçš„FTPåº”ç”¨ç¨‹åºï¼Œè€Œæ‰€æœ‰è¿™äº›åº”ç”¨ç¨‹åºéƒ½éµå®ˆåŒä¸€ç§åè®®ä»¥ä¼ è¾“æ–‡ä»¶ã€‚åœ¨FTPçš„ä½¿ç”¨å½“ä¸­ï¼Œç”¨æˆ·ç»å¸¸é‡åˆ°ä¸¤<br>ä¸ªæ¦‚å¿µï¼šâ€ä¸‹è½½â€ï¼ˆDownloadï¼‰å’Œâ€ä¸Šä¼ â€ï¼ˆUploadï¼‰ã€‚â€ä¸‹è½½â€æ–‡ä»¶å°±æ˜¯ä»è¿œç¨‹ä¸»æœºæ‹·è´æ–‡ä»¶è‡³è‡ªå·±çš„è®¡ç®—æœº<br>ä¸Šï¼›â€ä¸Šä¼ â€æ–‡ä»¶å°±æ˜¯å°†æ–‡ä»¶ä»è‡ªå·±çš„è®¡ç®—æœºä¸­æ‹·è´è‡³è¿œç¨‹ä¸»æœºä¸Šã€‚ç”¨Internetè¯­è¨€æ¥è¯´ï¼Œç”¨æˆ·å¯é€šè¿‡å®¢æˆ·æœºç¨‹<br>åºå‘ï¼ˆä»ï¼‰è¿œç¨‹ä¸»æœºä¸Šä¼ ï¼ˆä¸‹è½½ï¼‰æ–‡ä»¶ã€‚</p>
<h3 id="FTPåŸç†"><a href="#FTPåŸç†" class="headerlink" title="FTPåŸç†"></a>FTPåŸç†</h3><p>FTPåªé€šè¿‡TCPè¿æ¥,æ²¡æœ‰ç”¨äºFTPçš„UDPç»„ä»¶ã€‚</p>
<p>FTPä¸åŒäºå…¶ä»–æœåŠ¡çš„æ˜¯å®ƒä½¿ç”¨äº†ä¸¤ä¸ªç«¯å£, ä¸€ä¸ªæ•°æ®ç«¯å£å’Œä¸€ä¸ªå‘½ä»¤ç«¯å£(æˆ–ç§°ä¸ºæ§åˆ¶ç«¯å£)ã€‚</p>
<p>é€šå¸¸21ç«¯å£æ˜¯å‘½ä»¤ç«¯å£ï¼Œ20ç«¯å£æ˜¯æ•°æ®ç«¯å£ã€‚å½“æ··å…¥ä¸»åŠ¨/è¢«åŠ¨æ¨¡å¼çš„æ¦‚å¿µæ—¶ï¼Œæ•°æ®ç«¯å£å°±æœ‰å¯èƒ½ä¸æ˜¯20äº†ã€‚</p>
<p><strong>å·¥ä½œæ¨¡å¼</strong> FTPæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š</p>
<ul>
<li>Standard (PORTæ–¹å¼ï¼Œä¸»åŠ¨æ–¹å¼)</li>
<li>Passive (PASVï¼Œè¢«åŠ¨æ–¹å¼)ã€‚</li>
</ul>
<p><strong>Portæ¨¡å¼</strong></p>
<p>ä¸»åŠ¨æ¨¡å¼ä¸‹ï¼ŒFTPå®¢æˆ·ç«¯ä»ä»»æ„çš„éç‰¹æ®Šçš„ç«¯å£ï¼ˆN &gt; 1023ï¼‰è¿å…¥åˆ°FTPæœåŠ¡å™¨çš„å‘½ä»¤ç«¯å£â€“21ç«¯å£ã€‚ç„¶åå®¢æˆ·ç«¯åœ¨N+1ï¼ˆN+1 &gt;= 1024ï¼‰ç«¯å£ç›‘å¬ï¼Œå¹¶ä¸”é€šè¿‡N+1ï¼ˆN+1 &gt;= 1024ï¼‰ç«¯å£å‘é€å‘½ä»¤ç»™FTPæœåŠ¡å™¨ã€‚æœåŠ¡å™¨ä¼šåè¿‡æ¥è¿æ¥ç”¨æˆ·æœ¬åœ°æŒ‡å®šçš„æ•°æ®ç«¯å£ï¼Œæ¯”å¦‚20ç«¯å£ã€‚</p>
<p>ä»¥æœåŠ¡å™¨ç«¯é˜²ç«å¢™ä¸ºç«‹è¶³ç‚¹ï¼Œè¦æ”¯æŒä¸»åŠ¨æ¨¡å¼FTPéœ€è¦æ‰“å¼€å¦‚ä¸‹äº¤äº’ä¸­ä½¿ç”¨åˆ°çš„ç«¯å£ï¼š</p>
<ul>
<li>FTPæœåŠ¡å™¨å‘½ä»¤ï¼ˆ21ï¼‰ç«¯å£æ¥å—å®¢æˆ·ç«¯ä»»æ„ç«¯å£ï¼ˆå®¢æˆ·ç«¯åˆå§‹è¿æ¥ï¼‰</li>
<li>FTPæœåŠ¡å™¨å‘½ä»¤ï¼ˆ21ï¼‰ç«¯å£åˆ°å®¢æˆ·ç«¯ç«¯å£ï¼ˆ&gt;1023ï¼‰ï¼ˆæœåŠ¡å™¨å“åº”å®¢æˆ·ç«¯å‘½ä»¤ï¼‰</li>
<li>FTPæœåŠ¡å™¨æ•°æ®ï¼ˆ20ï¼‰ç«¯å£åˆ°å®¢æˆ·ç«¯ç«¯å£ï¼ˆ&gt;1023ï¼‰ï¼ˆæœåŠ¡å™¨åˆå§‹åŒ–æ•°æ®è¿æ¥åˆ°å®¢æˆ·ç«¯æ•°æ®ç«¯å£ï¼‰</li>
<li>FTPæœåŠ¡å™¨æ•°æ®ï¼ˆ20ï¼‰ç«¯å£æ¥å—å®¢æˆ·ç«¯ç«¯å£ï¼ˆ&gt;1023ï¼‰ï¼ˆå®¢æˆ·ç«¯å‘é€ACKåŒ…åˆ°æœåŠ¡å™¨çš„æ•°æ®ç«¯å£ï¼‰</li>
</ul>
<p>ç”¨å›¾è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="pic/15.jpg" alt="15"></p>
<p>åœ¨ç¬¬1æ­¥ä¸­ï¼Œå®¢æˆ·ç«¯çš„å‘½ä»¤ç«¯å£ä¸FTPæœåŠ¡å™¨çš„å‘½ä»¤ç«¯å£å»ºç«‹è¿æ¥ï¼Œå¹¶å‘é€å‘½ä»¤â€œPORT 1027â€ã€‚ç„¶ååœ¨ç¬¬2æ­¥ä¸­ï¼ŒFTPæœåŠ¡å™¨ç»™å®¢æˆ·ç«¯çš„å‘½ä»¤ç«¯å£è¿”å›ä¸€ä¸ªâ€ACKâ€ã€‚åœ¨ç¬¬3æ­¥ä¸­ï¼ŒFTPæœåŠ¡å™¨å‘èµ·ä¸€ä¸ªä»å®ƒè‡ªå·±çš„æ•°æ®ç«¯å£ï¼ˆ20ï¼‰åˆ°å®¢æˆ·ç«¯å…ˆå‰æŒ‡å®šçš„æ•°æ®ç«¯å£ï¼ˆ1027ï¼‰çš„è¿æ¥ï¼Œæœ€åå®¢æˆ·ç«¯åœ¨ç¬¬4æ­¥ä¸­ç»™æœåŠ¡å™¨ç«¯è¿”å›ä¸€ä¸ªâ€ACKâ€ã€‚</p>
<p>ä¸»åŠ¨æ–¹å¼FTPçš„ä¸»è¦é—®é¢˜å®é™…ä¸Šåœ¨äºå®¢æˆ·ç«¯ã€‚FTPçš„å®¢æˆ·ç«¯å¹¶æ²¡æœ‰å®é™…å»ºç«‹ä¸€ä¸ªåˆ°æœåŠ¡å™¨æ•°æ®ç«¯å£çš„è¿æ¥ï¼Œå®ƒåªæ˜¯ç®€å•çš„å‘Šè¯‰æœåŠ¡å™¨è‡ªå·±ç›‘å¬çš„ç«¯å£å·ï¼ŒæœåŠ¡å™¨å†å›æ¥è¿æ¥å®¢æˆ·ç«¯è¿™ä¸ªæŒ‡å®šçš„ç«¯å£ã€‚å¯¹äºå®¢æˆ·ç«¯çš„é˜²ç«å¢™æ¥è¯´ï¼Œè¿™æ˜¯ä»å¤–éƒ¨ç³»ç»Ÿå»ºç«‹åˆ°å†…éƒ¨å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œè¿™æ˜¯é€šå¸¸ä¼šè¢«é˜»å¡çš„ã€‚</p>
<p><strong>Passiveæ¨¡å¼</strong></p>
<p>ä¸ºäº†è§£å†³æœåŠ¡å™¨å‘èµ·åˆ°å®¢æˆ·çš„è¿æ¥çš„é—®é¢˜ï¼Œäººä»¬å¼€å‘äº†ä¸€ç§ä¸åŒçš„FTPè¿æ¥æ–¹å¼ã€‚è¿™å°±æ˜¯æ‰€è°“çš„è¢«åŠ¨æ–¹å¼ï¼Œæˆ–è€…å«åšPASVï¼Œå½“å®¢æˆ·ç«¯é€šçŸ¥æœåŠ¡å™¨å®ƒå¤„äºè¢«åŠ¨æ¨¡å¼æ—¶æ‰å¯ç”¨ã€‚</p>
<p>åœ¨è¢«åŠ¨æ–¹å¼FTPä¸­ï¼Œå‘½ä»¤è¿æ¥å’Œæ•°æ®è¿æ¥éƒ½ç”±å®¢æˆ·ç«¯ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³ä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„æ•°æ®ç«¯å£çš„å…¥æ–¹å‘è¿æ¥è¢«é˜²ç«å¢™è¿‡æ»¤æ‰çš„é—®é¢˜ã€‚å½“å¼€å¯ä¸€ä¸ªFTPè¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯æ‰“å¼€ä¸¤ä¸ªä»»æ„çš„éç‰¹æƒæœ¬åœ°ç«¯å£ï¼ˆN &gt;; 1024å’ŒN+1ï¼‰ã€‚ç¬¬ä¸€ä¸ªç«¯å£è¿æ¥æœåŠ¡å™¨çš„21ç«¯å£ï¼Œä½†ä¸ä¸»åŠ¨æ–¹å¼çš„FTPä¸åŒï¼Œå®¢æˆ·ç«¯ä¸ä¼šæäº¤PORTå‘½ä»¤å¹¶å…è®¸æœåŠ¡å™¨æ¥å›è¿å®ƒçš„æ•°æ®ç«¯å£ï¼Œè€Œæ˜¯æäº¤PASVå‘½ä»¤ã€‚è¿™æ ·åšçš„ç»“æœæ˜¯æœåŠ¡å™¨ä¼šå¼€å¯ä¸€ä¸ªä»»æ„çš„éç‰¹æƒç«¯å£ï¼ˆP &gt;; 1024ï¼‰ï¼Œå¹¶å‘é€PORT På‘½ä»¤ç»™å®¢æˆ·ç«¯ã€‚ç„¶åå®¢æˆ·ç«¯å‘èµ·ä»æœ¬åœ°ç«¯å£N+1åˆ°æœåŠ¡å™¨çš„ç«¯å£Pçš„è¿æ¥ç”¨æ¥ä¼ é€æ•°æ®ã€‚</p>
<p>å¯¹äºæœåŠ¡å™¨ç«¯çš„é˜²ç«å¢™æ¥è¯´ï¼Œå¿…é¡»å…è®¸ä¸‹é¢çš„é€šè®¯æ‰èƒ½æ”¯æŒè¢«åŠ¨æ–¹å¼çš„FTP:</p>
<ul>
<li>FTPæœåŠ¡å™¨å‘½ä»¤ï¼ˆ21ï¼‰ç«¯å£æ¥å—å®¢æˆ·ç«¯ä»»æ„ç«¯å£ï¼ˆå®¢æˆ·ç«¯åˆå§‹è¿æ¥ï¼‰</li>
<li>FTPæœåŠ¡å™¨å‘½ä»¤ï¼ˆ21ï¼‰ç«¯å£åˆ°å®¢æˆ·ç«¯ç«¯å£ï¼ˆ&gt;1023ï¼‰ï¼ˆæœåŠ¡å™¨å“åº”å®¢æˆ·ç«¯å‘½ä»¤ï¼‰</li>
<li>FTPæœåŠ¡å™¨æ•°æ®ç«¯å£ï¼ˆ&gt;1023ï¼‰æ¥å—å®¢æˆ·ç«¯ç«¯å£ï¼ˆ&gt;1023ï¼‰ï¼ˆå®¢æˆ·ç«¯åˆå§‹åŒ–æ•°æ®è¿æ¥åˆ°æœåŠ¡å™¨æŒ‡å®šçš„ä»»æ„ç«¯å£ï¼‰</li>
<li>FTPæœåŠ¡å™¨æ•°æ®ç«¯å£ï¼ˆ&gt;1023ï¼‰åˆ°å®¢æˆ·ç«¯ç«¯å£ï¼ˆ&gt;1023ï¼‰ï¼ˆæœåŠ¡å™¨å‘é€ACKå“åº”å’Œæ•°æ®åˆ°å®¢æˆ·ç«¯çš„æ•°æ®ç«¯å£ï¼‰</li>
</ul>
<p>ç”¨å›¾è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="pic/16.jpg" alt="16"></p>
<p>åœ¨ç¬¬1æ­¥ä¸­ï¼Œå®¢æˆ·ç«¯çš„å‘½ä»¤ç«¯å£ä¸æœåŠ¡å™¨çš„å‘½ä»¤ç«¯å£å»ºç«‹è¿æ¥ï¼Œå¹¶å‘é€å‘½ä»¤â€œPASVâ€ã€‚ç„¶ååœ¨ç¬¬2æ­¥ä¸­ï¼ŒæœåŠ¡å™¨è¿”å›å‘½ä»¤â€PORT 2024â€ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯ï¼ˆæœåŠ¡å™¨ï¼‰ç”¨å“ªä¸ªç«¯å£ä¾¦å¬æ•°æ®è¿æ¥ã€‚åœ¨ç¬¬3æ­¥ä¸­ï¼Œå®¢æˆ·ç«¯åˆå§‹åŒ–ä¸€ä¸ªä»è‡ªå·±çš„æ•°æ®ç«¯å£åˆ°æœåŠ¡å™¨ç«¯æŒ‡å®šçš„æ•°æ®ç«¯å£çš„æ•°æ®è¿æ¥ã€‚æœ€åæœåŠ¡å™¨åœ¨ç¬¬4 æ­¥ä¸­ç»™å®¢æˆ·ç«¯çš„æ•°æ®ç«¯å£è¿”å›ä¸€ä¸ªâ€ACKâ€å“åº”ã€‚</p>
<p>è¢«åŠ¨æ–¹å¼çš„FTPè§£å†³äº†å®¢æˆ·ç«¯çš„è®¸å¤šé—®é¢˜ï¼Œä½†åŒæ—¶ç»™æœåŠ¡å™¨ç«¯å¸¦æ¥äº†æ›´å¤šçš„é—®é¢˜ã€‚æœ€å¤§çš„é—®é¢˜æ˜¯éœ€è¦å…è®¸ä»ä»»æ„è¿œç¨‹ç»ˆç«¯åˆ°æœåŠ¡å™¨é«˜ä½ç«¯å£çš„è¿æ¥ã€‚å¹¸è¿çš„æ˜¯ï¼Œè®¸å¤šFTPå®ˆæŠ¤ç¨‹åºï¼ŒåŒ…æ‹¬æµè¡Œçš„WU-FTPDå…è®¸ç®¡ç†å‘˜æŒ‡å®šFTPæœåŠ¡å™¨ä½¿ç”¨çš„ç«¯å£èŒƒå›´ã€‚è¯¦ç»†å†…å®¹å‚çœ‹é™„å½•1ã€‚</p>
<p>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯å®¢æˆ·ç«¯æœ‰çš„æ”¯æŒè¢«åŠ¨æ¨¡å¼ï¼Œæœ‰çš„ä¸æ”¯æŒè¢«åŠ¨æ¨¡å¼ï¼Œå¿…é¡»è€ƒè™‘å¦‚ä½•èƒ½æ”¯æŒè¿™äº›å®¢æˆ·ç«¯ï¼Œä»¥åŠä¸ºä»–ä»¬æä¾›è§£å†³åŠæ³•ã€‚ä¾‹å¦‚ï¼ŒSolarisæä¾›çš„FTPå‘½ä»¤è¡Œå·¥å…·å°±ä¸æ”¯æŒè¢«åŠ¨æ¨¡å¼ï¼Œéœ€è¦ç¬¬ä¸‰æ–¹çš„FTPå®¢æˆ·ç«¯ï¼Œæ¯”å¦‚ncftpã€‚</p>
<p>éšç€WWWçš„å¹¿æ³›æµè¡Œï¼Œè®¸å¤šäººä¹ æƒ¯ç”¨webæµè§ˆå™¨ä½œä¸ºFTPå®¢æˆ·ç«¯ã€‚å¤§å¤šæ•°æµè§ˆå™¨åªåœ¨è®¿é—®ftp://è¿™æ ·çš„URLæ—¶æ‰æ”¯æŒè¢«åŠ¨æ¨¡å¼ã€‚è¿™åˆ°åº•æ˜¯å¥½è¿˜æ˜¯åå–å†³äºæœåŠ¡å™¨å’Œé˜²ç«å¢™çš„é…ç½®ã€‚</p>
<p>ä¸‹é¢çš„å›¾è¡¨ä¼šå¸®åŠ©ç®¡ç†å‘˜ä»¬è®°ä½æ¯ç§FTPæ–¹å¼æ˜¯æ€æ ·å·¥ä½œçš„ï¼š</p>
<p><strong>ä¸»åŠ¨FTPï¼š</strong></p>
<ol>
<li>å‘½ä»¤è¿æ¥ï¼šå®¢æˆ·ç«¯ &gt;1023ç«¯å£ -&gt; æœåŠ¡å™¨ 21ç«¯å£</li>
<li>æ•°æ®è¿æ¥ï¼šå®¢æˆ·ç«¯ &gt;1023ç«¯å£ &lt;- æœåŠ¡å™¨ 20ç«¯å£</li>
</ol>
<p><strong>è¢«åŠ¨FTPï¼š</strong></p>
<ol>
<li>å‘½ä»¤è¿æ¥ï¼šå®¢æˆ·ç«¯ &gt;1023ç«¯å£ -&gt; æœåŠ¡å™¨ 21ç«¯å£</li>
<li>æ•°æ®è¿æ¥ï¼šå®¢æˆ·ç«¯ &gt;1023ç«¯å£ -&gt; æœåŠ¡å™¨ &gt;1023ç«¯å£</li>
</ol>
<p>ä¸‹é¢æ˜¯ä¸»åŠ¨ä¸è¢«åŠ¨FTPä¼˜ç¼ºç‚¹çš„ç®€è¦æ€»ç»“ï¼š</p>
<p>ä¸»åŠ¨FTPå¯¹FTPæœåŠ¡å™¨çš„ç®¡ç†æœ‰åˆ©ï¼Œä½†å¯¹å®¢æˆ·ç«¯çš„ç®¡ç†ä¸åˆ©ã€‚å› ä¸ºFTPæœåŠ¡å™¨ä¼å›¾ä¸å®¢æˆ·ç«¯çš„é«˜ä½éšæœºç«¯å£å»ºç«‹è¿æ¥ï¼Œè€Œè¿™ä¸ªç«¯å£å¾ˆæœ‰å¯èƒ½è¢«å®¢æˆ·ç«¯çš„é˜²ç«å¢™é˜»å¡æ‰ã€‚è¢«åŠ¨FTPå¯¹FTPå®¢æˆ·ç«¯çš„ç®¡ç†æœ‰åˆ©ï¼Œä½†å¯¹æœåŠ¡å™¨ç«¯çš„ç®¡ç†ä¸åˆ©ã€‚å› ä¸ºå®¢æˆ·ç«¯è¦ä¸æœåŠ¡å™¨ç«¯å»ºç«‹ä¸¤ä¸ªè¿æ¥ï¼Œå…¶ä¸­ä¸€ä¸ªè¿åˆ°ä¸€ä¸ªé«˜ä½éšæœºç«¯å£ï¼Œè€Œè¿™ä¸ªç«¯å£å¾ˆæœ‰å¯èƒ½è¢«æœåŠ¡å™¨ç«¯çš„é˜²ç«å¢™é˜»å¡æ‰ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œæœ‰æŠ˜è¡·çš„åŠæ³•ã€‚æ—¢ç„¶FTPæœåŠ¡å™¨çš„ç®¡ç†å‘˜éœ€è¦ä»–ä»¬çš„æœåŠ¡å™¨æœ‰æœ€å¤šçš„å®¢æˆ·è¿æ¥ï¼Œé‚£ä¹ˆå¿…é¡»å¾—æ”¯æŒè¢«åŠ¨FTPã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºFTPæœåŠ¡å™¨æŒ‡å®šä¸€ä¸ªæœ‰é™çš„ç«¯å£èŒƒå›´æ¥å‡å°æœåŠ¡å™¨é«˜ä½ç«¯å£çš„æš´éœ²ã€‚è¿™æ ·ï¼Œä¸åœ¨è¿™ä¸ªèŒƒå›´çš„ä»»ä½•ç«¯å£ä¼šè¢«æœåŠ¡å™¨çš„é˜²ç«å¢™é˜»å¡ã€‚è™½ç„¶è¿™æ²¡æœ‰æ¶ˆé™¤æ‰€æœ‰é’ˆå¯¹æœåŠ¡å™¨çš„å±é™©ï¼Œä½†å®ƒå¤§å¤§å‡å°‘äº†å±é™©ã€‚</p>
<h3 id="VSFTPD-è½¯ä»¶"><a href="#VSFTPD-è½¯ä»¶" class="headerlink" title="VSFTPD è½¯ä»¶"></a>VSFTPD è½¯ä»¶</h3><p>å¦‚æœä½ æƒ³åœ¨ä½ çš„Linux/UnixæœåŠ¡å™¨ä¸Šæ­å»ºä¸€ä¸ªå®‰å…¨ã€é«˜æ€§èƒ½ã€ç¨³å®šæ€§å¥½çš„FTPæœåŠ¡å™¨ï¼Œé‚£ä¹ˆvsftpdå¯èƒ½æ˜¯ä½ çš„é¦–é€‰åº”ç”¨ã€‚vsftpdæ„æ€ä¸ºâ€œvery secure FTP daemon(éå¸¸å®‰å…¨çš„FTPè¿›ç¨‹)â€ï¼Œæ˜¯ä¸€ä¸ªåŸºäºGPLå‘å¸ƒçš„ç±»UNIXç±»æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œçš„æœåŠ¡å™¨çš„åå­—ï¼ˆæ˜¯ä¸€ç§å®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼Œå¯ä»¥è¿è¡Œåœ¨è¯¸å¦‚Linuxã€BSDã€Solarisã€HP-UXä»¥åŠIrixç­‰ç³»ç»Ÿä¸Šé¢ã€‚vsftpdæ”¯æŒå¾ˆå¤šå…¶ä»–ä¼ ç»Ÿçš„FTPæœåŠ¡å™¨ä¸æ”¯æŒçš„è‰¯å¥½ç‰¹æ€§ã€‚</p>
<p>æœ€æ–°çš„vsftpdç‰ˆæœ¬å¯åœ¨å…¶å®˜ç½‘è·å–ï¼š<a href="www.vsftpd.org">www.vsftpd.org</a></p>
<p>vsftpd æ˜¯â€œvery secure FTP daemonâ€çš„ç¼©å†™ï¼Œå®‰å…¨æ€§æ˜¯å®ƒçš„ä¸€ä¸ªæœ€å¤§çš„ç‰¹ç‚¹ã€‚vsftpd æ˜¯ä¸€ä¸ª UNIX ç±»æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œçš„æœåŠ¡å™¨çš„åå­—ï¼Œå®ƒå¯ä»¥è¿è¡Œåœ¨è¯¸å¦‚ Linuxã€BSDã€Solarisã€ HP-UNIXç­‰ç³»ç»Ÿä¸Šé¢ï¼Œæ˜¯ä¸€ä¸ªå®Œå…¨å…è´¹çš„ã€å¼€å‘æºä»£ç çš„ftpæœåŠ¡å™¨è½¯ä»¶ï¼Œæ”¯æŒå¾ˆå¤šå…¶ä»–çš„ FTP æœåŠ¡å™¨æ‰€ä¸æ”¯æŒçš„ç‰¹å¾ã€‚æ¯”å¦‚ï¼šéå¸¸é«˜çš„å®‰å…¨æ€§éœ€æ±‚ã€å¸¦å®½é™åˆ¶ã€è‰¯å¥½çš„å¯ä¼¸ç¼©æ€§ã€å¯åˆ›å»ºè™šæ‹Ÿç”¨æˆ·ã€æ”¯æŒIPv6ã€é€Ÿç‡é«˜ç­‰ã€‚</p>
<p>çœ‹çœ‹éƒ½æœ‰å“ªäº›ç½‘ç«™åœ¨ä½¿ç”¨vsftpdå§ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ftp.RedHat.com</span><br><span class="line">ftp.SUSE.com</span><br><span class="line">ftp.debian.org</span><br><span class="line">ftp.openbsd.org</span><br><span class="line">ftp.freebsd.org</span><br><span class="line">ftp.gnu.org</span><br><span class="line">ftp.gnome.org</span><br><span class="line">ftp.kde.org</span><br><span class="line">ftp.kernel.org</span><br><span class="line">rpmfind.net</span><br><span class="line">ftp.linux.org.uk</span><br><span class="line">ftp.gimp.org</span><br><span class="line">ftp-stud.fht-esslingen.de</span><br><span class="line">gd.tuwien.ac.at</span><br><span class="line">ftp.sunet.se</span><br><span class="line">ftp.ximian.com</span><br><span class="line">ftp.engardelinux.org</span><br><span class="line">ftp.sunsite.org.uk</span><br><span class="line">ftp.isc.org</span><br></pre></td></tr></table></figure>

<h4 id="ä»€ä¹ˆæ˜¯vsftpd"><a href="#ä»€ä¹ˆæ˜¯vsftpd" class="headerlink" title="ä»€ä¹ˆæ˜¯vsftpd"></a>ä»€ä¹ˆæ˜¯vsftpd</h4><p>Vsftpdæ˜¯ä¸€ç§åœ¨GPLè®¸å¯ä¸‹å¼€æ”¾æºä»£ç çš„FTPæœåŠ¡å™¨ï¼Œç”¨äºå¤šç§UNIXç³»ç»Ÿå’ŒLinuxç³»ç»Ÿã€‚Vsftpdä¹Ÿç§°ä¸ºVery Secure FTP Daemonï¼Œå®ƒæ˜¯ä¸€ç§å®‰å…¨ã€å¿«é€Ÿã€ç¨³å®šçš„FTPæœåŠ¡å™¨ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥ã€‚</p>
<p>Vsftpdçš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p>
<ul>
<li>æä¾›å®‰å…¨çš„ä½“ç³»ç»“æ„ï¼Œæ ¹æ®ä»»åŠ¡çš„æœ€ä½ç‰¹æƒéœ€æ±‚å•ç‹¬æ‰§è¡Œæ¯ä¸ªä»»åŠ¡ã€‚</li>
<li>æ”¯æŒè™šæ‹ŸIPé…ç½®ï¼Œå¯ä»¥åœ¨æä¾›ä¸€ä¸ªIPåœ°å€çš„æƒ…å†µä¸‹ï¼Œåœ¨åŸŸä¸­ç”¨è¯¥åœ°å€å»ºç«‹å¤šä¸ªFTPæœåŠ¡å™¨ã€‚</li>
<li>å…è®¸é…ç½®å¹¶ä½¿ç”¨è™šæ‹Ÿç”¨æˆ·ï¼Œä»è€Œä¸ç³»ç»Ÿç”¨æˆ·è´¦æˆ·åˆ†ç¦»ã€‚</li>
<li>æ”¯æŒTCPå°è£…ã€‚</li>
<li>å…è®¸é…ç½®åŒ¿åæœåŠ¡å™¨ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸éœ€è¦èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ã€‚</li>
<li>æ€§èƒ½ç¨³å®šï¼Œå¯ä»¥å¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥ã€‚</li>
<li>å¯ä»¥é…ç½®ä¸ºç‹¬ç«‹çš„æœåŠ¡å™¨ã€‚</li>
<li>VsftpdæœåŠ¡å™¨æ”¯æŒå¸¦å®½æ§åˆ¶ã€‚</li>
</ul>
<blockquote>
<p>ç”¨æˆ·ç±»å‹</p>
</blockquote>
<p><strong>r çœŸå®ç”¨æˆ·</strong></p>
<p>è¿™ç±»ç”¨æˆ·æ˜¯æŒ‡åœ¨FTPæœåŠ¡ä¸Šæ‹¥æœ‰å¸å·ï¼Œå³/etc/passwdé‡Œçš„ç”¨æˆ·ã€‚å½“è¿™ç±»ç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨çš„æ—¶å€™ï¼Œå…¶é»˜è®¤çš„ä¸»ç›®å½•å°±æ˜¯å…¶å¸å·å‘½åçš„ç›®å½•ã€‚ä½†æ˜¯ï¼Œå…¶è¿˜å¯ä»¥å˜æ›´åˆ°å…¶ä»–ç›®å½•ä¸­å»ã€‚å¦‚ç³»ç»Ÿçš„ä¸»ç›®å½•ç­‰ç­‰ã€‚</p>
<p><strong>g æ¥å®¾ç”¨æˆ·</strong></p>
<p>åœ¨vsFTPè½¯ä»¶é‡Œæ²¡æœ‰è¿™ç±»ç”¨æˆ·ï¼Œä½†æ˜¯åœ¨FTPæœåŠ¡å™¨ä¸­æœ‰ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šç»™ä¸åŒçš„éƒ¨é—¨æˆ–è€…æŸä¸ªç‰¹å®šçš„ç”¨æˆ·è®¾ç½®ä¸€ä¸ªå¸æˆ·ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªè´¦æˆ·æœ‰ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯å…¶åªèƒ½å¤Ÿè®¿é—®è‡ªå·±çš„ä¸»ç›®å½•ã€‚æœåŠ¡å™¨é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¿éšœFTPæœåŠ¡ä¸Šå…¶ä»–æ–‡ä»¶çš„å®‰å…¨æ€§ã€‚è¿™ç±»å¸æˆ·ï¼Œåœ¨Vsftpdè½¯ä»¶ä¸­å°±å«åšGuestç”¨æˆ·ã€‚æ‹¥æœ‰è¿™ç±»ç”¨æˆ·çš„å¸æˆ·ï¼Œåªèƒ½å¤Ÿè®¿é—®å…¶ä¸»ç›®å½•ä¸‹çš„ç›®å½•ï¼Œè€Œä¸å¾—è®¿é—®ä¸»ç›®å½•ä»¥å¤–çš„æ–‡ä»¶ã€‚</p>
<p><strong>a åŒ¿åç”¨æˆ·</strong></p>
<p>Anonymousï¼ˆåŒ¿åï¼‰ç”¨æˆ·ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„åŒ¿åè®¿é—®ã€‚è¿™ç±»ç”¨æˆ·æ˜¯æŒ‡åœ¨FTPæœåŠ¡å™¨ä¸­æ²¡æœ‰æŒ‡å®šå¸æˆ·ï¼Œä½†æ˜¯å…¶ä»ç„¶å¯ä»¥è¿›è¡ŒåŒ¿åè®¿é—®æŸäº›å…¬å¼€çš„èµ„æºã€‚<br>åœ¨ç»„å»ºFTPæœåŠ¡å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦æ ¹æ®ç”¨æˆ·çš„ç±»å‹ï¼Œå¯¹ç”¨æˆ·è¿›è¡Œå½’ç±»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒVsftpdæœåŠ¡å™¨ä¼šæŠŠå»ºç«‹çš„æ‰€æœ‰å¸æˆ·éƒ½å½’å±ä¸ºRealç”¨æˆ·ã€‚ä½†æ˜¯ï¼Œè¿™å¾€å¾€ä¸ç¬¦åˆä¼ä¸šå®‰å…¨çš„éœ€è¦ã€‚å› ä¸ºè¿™ç±»ç”¨æˆ·ä¸ä»…å¯ä»¥è®¿é—®è‡ªå·±çš„ä¸»ç›®å½•ï¼Œè€Œä¸”ï¼Œè¿˜å¯ä»¥è®¿é—®å…¶ä»–ç”¨æˆ·çš„ç›®å½•ã€‚è¿™å°±ç»™å…¶ä»–ç”¨æˆ·æ‰€åœ¨çš„ç©ºé—´å¸¦æ¥ä¸€å®šçš„å®‰å…¨éšæ‚£ã€‚æ‰€ä»¥ï¼Œä¼ä¸šè¦æ ¹æ®å®é™…æƒ…å†µï¼Œä¿®æ”¹ç”¨æˆ·æ‰€åœ¨çš„ç±»åˆ«ã€‚</p>
<hr>
<h4 id="é¡¹ç›®å®è·µ1-è®¾ç½®vsftpdæœåŠ¡åŒ¿åç”¨æˆ·èƒ½å¤Ÿå¯¹-var-ftp-pub-ç›®å½•æœ‰ä¸Šä¼ ä¸‹è½½çš„æƒé™"><a href="#é¡¹ç›®å®è·µ1-è®¾ç½®vsftpdæœåŠ¡åŒ¿åç”¨æˆ·èƒ½å¤Ÿå¯¹-var-ftp-pub-ç›®å½•æœ‰ä¸Šä¼ ä¸‹è½½çš„æƒé™" class="headerlink" title="é¡¹ç›®å®è·µ1: è®¾ç½®vsftpdæœåŠ¡åŒ¿åç”¨æˆ·èƒ½å¤Ÿå¯¹/var/ftp/pub/ç›®å½•æœ‰ä¸Šä¼ ä¸‹è½½çš„æƒé™"></a>é¡¹ç›®å®è·µ1: è®¾ç½®vsftpdæœåŠ¡åŒ¿åç”¨æˆ·èƒ½å¤Ÿå¯¹/var/ftp/pub/ç›®å½•æœ‰ä¸Šä¼ ä¸‹è½½çš„æƒé™</h4><h5 id="å®éªŒå‡†å¤‡é˜¶æ®µ"><a href="#å®éªŒå‡†å¤‡é˜¶æ®µ" class="headerlink" title="å®éªŒå‡†å¤‡é˜¶æ®µ"></a>å®éªŒå‡†å¤‡é˜¶æ®µ</h5><ol>
<li>ç½‘ç»œæ‹“æ‰‘å›¾</li>
<li>è§„åˆ’è½¯ä»¶å®‰è£…</li>
<li>ä¿®æ”¹é…ç½®æ–‡ä»¶</li>
<li>å¯åŠ¨æœåŠ¡</li>
<li>æ³¨æ„é˜²ç«å¢™å…³é—­</li>
<li>å®¢æˆ·ç«¯æµ‹è¯•æœåŠ¡        </li>
</ol>
<blockquote>
<p>ç½‘ç»œæ‹“æ‰‘å›¾</p>
</blockquote>
<p><img src="pic/17.png" alt="17"></p>
<blockquote>
<p>è§„åˆ’è½¯ä»¶å®‰è£…</p>
</blockquote>
<p><img src="pic/18.png" alt="18"></p>
<h5 id="å…·ä½“æ­¥éª¤"><a href="#å…·ä½“æ­¥éª¤" class="headerlink" title="å…·ä½“æ­¥éª¤"></a>å…·ä½“æ­¥éª¤</h5><p>Linuxå‡ ä¹æ‰€æœ‰çš„å‘è¡Œç‰ˆæœ¬éƒ½å†…ç½®äº†VsftpdæœåŠ¡ã€‚</p>
<p><strong>æœåŠ¡å™¨ç«¯rhel6</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# yum install -y vsftpd</span><br><span class="line">Loaded plugins: product-id, refresh-packagekit, security, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Setting up Install Process</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package vsftpd.x86_64 0:2.2.2-11.el6_4.1 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">=============================================================================================</span><br><span class="line"> Package            Arch               Version                      Repository          Size</span><br><span class="line">=============================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> vsftpd             x86_64             2.2.2-11.el6_4.1             server             151 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">=============================================================================================</span><br><span class="line">Install       1 Package(s)</span><br><span class="line"></span><br><span class="line">Total download size: 151 k</span><br><span class="line">Installed size: 331 k</span><br><span class="line">Downloading Packages:</span><br><span class="line">vsftpd-2.2.2-11.el6_4.1.x86_64.rpm                                    | 151 kB     00:00     </span><br><span class="line">Running rpm_check_debug</span><br><span class="line">Running Transaction Test</span><br><span class="line">Transaction Test Succeeded</span><br><span class="line">Running Transaction</span><br><span class="line">  Installing : vsftpd-2.2.2-11.el6_4.1.x86_64                                            1/1</span><br><span class="line">  Verifying  : vsftpd-2.2.2-11.el6_4.1.x86_64                                            1/1</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  vsftpd.x86_64 0:2.2.2-11.el6_4.1                                                           </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# service iptables stop</span><br><span class="line">iptables: Setting chains to policy ACCEPT: filter          [  OK  ]</span><br><span class="line">iptables: Flushing firewall rules:                         [  OK  ]</span><br><span class="line">iptables: Unloading modules:                               [  OK  ]</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# getenforce</span><br><span class="line">Enforcing</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# rpm -q vsftpd</span><br><span class="line">vsftpd-2.2.2-11.el6_4.1.x86_64</span><br><span class="line">[root@rhel6 ~]# rpm -ql vsftpd</span><br><span class="line">/etc/logrotate.d/vsftpd</span><br><span class="line">/etc/pam.d/vsftpd</span><br><span class="line">/etc/rc.d/init.d/vsftpd</span><br><span class="line">/etc/vsftpd</span><br><span class="line">/etc/vsftpd/ftpusers</span><br><span class="line">/etc/vsftpd/user_list</span><br><span class="line">/etc/vsftpd/vsftpd.conf</span><br><span class="line">/etc/vsftpd/vsftpd_conf_migrate.sh</span><br><span class="line">/usr/sbin/vsftpd</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/AUDIT</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/BENCHMARKS</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/BUGS</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/COPYING</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/Changelog</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE/README.configuration</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE/vsftpd.conf</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE/vsftpd.xinetd</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE_NOINETD</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE_NOINETD/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE_NOINETD/README.configuration</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/INTERNET_SITE_NOINETD/vsftpd.conf</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/PER_IP_CONFIG</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/PER_IP_CONFIG/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/PER_IP_CONFIG/README.configuration</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/PER_IP_CONFIG/hosts.allow</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_HOSTS</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_HOSTS/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/README.configuration</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/logins.txt</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.conf</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.pam</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS_2</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS_2/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/FAQ</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/INSTALL</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/LICENSE</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/README</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/README.security</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/REWARD</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/SECURITY</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/SECURITY/DESIGN</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/SECURITY/IMPLEMENTATION</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/SECURITY/OVERVIEW</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/SECURITY/TRUST</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/SIZE</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/SPEED</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/TODO</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/TUNING</span><br><span class="line">/usr/share/doc/vsftpd-2.2.2/vsftpd.xinetd</span><br><span class="line">/usr/share/man/man5/vsftpd.conf.5.gz</span><br><span class="line">/usr/share/man/man8/vsftpd.8.gz</span><br><span class="line">/var/ftp</span><br><span class="line">/var/ftp/pub</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# service vsftpd start</span><br><span class="line">Starting vsftpd for vsftpd:                                [  OK  ]</span><br><span class="line">[root@rhel6 ~]# netstat -luntp|grep vsftpd</span><br><span class="line">tcp        0      0 0.0.0.0:21                  0.0.0.0:*                   LISTEN      2940/vsftpd</span><br></pre></td></tr></table></figure>

<p><strong>å®¢æˆ·ç«¯ rhel7</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# yum install -y lftp</span><br><span class="line">Loaded plugins: langpacks, product-id, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">server                                                                | 4.1 kB  00:00:00     </span><br><span class="line">(1/2): server/group_gz                                                | 134 kB  00:00:00     </span><br><span class="line">(2/2): server/primary_db                                              | 3.4 MB  00:00:00     </span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package lftp.x86_64 0:4.4.8-3.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">=============================================================================================</span><br><span class="line"> Package           Arch                Version                     Repository           Size</span><br><span class="line">=============================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> lftp              x86_64              4.4.8-3.el7                 server              749 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">=============================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 749 k</span><br><span class="line">Installed size: 2.4 M</span><br><span class="line">Downloading packages:</span><br><span class="line">lftp-4.4.8-3.el7.x86_64.rpm                                           | 749 kB  00:00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : lftp-4.4.8-3.el7.x86_64                                                   1/1</span><br><span class="line">server/productid                                                      | 1.6 kB  00:00:00     </span><br><span class="line">  Verifying  : lftp-4.4.8-3.el7.x86_64                                                   1/1</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  lftp.x86_64 0:4.4.8-3.el7                                                                  </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@rhel7 ~]# systemctl stop firewalld</span><br><span class="line">[root@rhel7 ~]# getenforce</span><br><span class="line">Enforcing</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# rpm -ql lftp</span><br><span class="line">/etc/lftp.conf</span><br><span class="line">/usr/bin/lftp</span><br><span class="line">/usr/bin/lftpget</span><br><span class="line">/usr/lib64/lftp</span><br><span class="line">/usr/lib64/lftp/4.4.8</span><br><span class="line">/usr/lib64/lftp/4.4.8/cmd-mirror.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/cmd-sleep.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/cmd-torrent.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/liblftp-network.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/liblftp-pty.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/proto-file.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/proto-fish.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/proto-ftp.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/proto-http.so</span><br><span class="line">/usr/lib64/lftp/4.4.8/proto-sftp.so</span><br><span class="line">/usr/lib64/liblftp-jobs.so.0</span><br><span class="line">/usr/lib64/liblftp-jobs.so.0.0.0</span><br><span class="line">/usr/lib64/liblftp-tasks.so.0</span><br><span class="line">/usr/lib64/liblftp-tasks.so.0.0.0</span><br><span class="line">/usr/share/doc/lftp-4.4.8</span><br><span class="line">/usr/share/doc/lftp-4.4.8/BUGS</span><br><span class="line">/usr/share/doc/lftp-4.4.8/COPYING</span><br><span class="line">/usr/share/doc/lftp-4.4.8/ChangeLog</span><br><span class="line">/usr/share/doc/lftp-4.4.8/FAQ</span><br><span class="line">/usr/share/doc/lftp-4.4.8/FEATURES</span><br><span class="line">/usr/share/doc/lftp-4.4.8/NEWS</span><br><span class="line">/usr/share/doc/lftp-4.4.8/README</span><br><span class="line">/usr/share/doc/lftp-4.4.8/README.debug-levels</span><br><span class="line">/usr/share/doc/lftp-4.4.8/README.dnssec</span><br><span class="line">/usr/share/doc/lftp-4.4.8/README.modules</span><br><span class="line">/usr/share/doc/lftp-4.4.8/THANKS</span><br><span class="line">/usr/share/doc/lftp-4.4.8/TODO</span><br><span class="line">/usr/share/locale/cs/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/de/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/es/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/fr/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/it/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/ja/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/ko/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/pl/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/pt_BR/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/ru/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/zh_CN/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/zh_HK/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/locale/zh_TW/LC_MESSAGES/lftp.mo</span><br><span class="line">/usr/share/man/man1/lftp.1.gz</span><br><span class="line">/usr/share/man/man1/lftpget.1.gz</span><br><span class="line">/usr/share/man/man5/lftp.conf.5.gz</span><br></pre></td></tr></table></figure>

<blockquote>
<p>1.ä»å®¢æˆ·ç«¯ä»¥åŒ¿åç”¨æˆ·æ¥è®¿é—®ftpæœåŠ¡</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# lftp 172.25.0.11</span><br><span class="line">lftp 172.25.0.11:~&gt; cd pub</span><br><span class="line">cd ok, cwd=/pub</span><br><span class="line">lftp 172.25.0.11:/pub&gt; ls</span><br><span class="line">lftp 172.25.0.11:/pub&gt; put rhel7</span><br><span class="line">put: Access failed: 550 Permission denied. (rhel7)</span><br></pre></td></tr></table></figure>

<p><strong>å½“å‰çš„æƒ…å†µ</strong></p>
<p>åŒ¿åç”¨æˆ·èƒ½å¤Ÿè®¿é—®/var/ftp/pubï¼Œèƒ½å¤ŸæŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œèƒ½å¤Ÿä¸‹è½½ï¼›ä¸èƒ½ä¸Šä¼ æ–‡ä»¶,ä¸èƒ½åˆ é™¤æ–‡ä»¶ã€‚</p>
<p><strong>é—®é¢˜çš„è§£å†³</strong></p>
<p>æŠ¥é”™550ï¼Œæ²¡æœ‰æƒé™ä¸Šä¼ æ–‡ä»¶</p>
<p>æˆ‘ä»¬è¦åˆ†ææƒé™æœ‰å“ªäº›ï¼Ÿ</p>
<ol>
<li>vsftpdçš„é…ç½®æ–‡ä»¶</li>
<li>UGOã€ç‰¹æ®Šã€éšè—ã€ACLã€</li>
<li>SELINUX</li>
</ol>
<p><strong>1.ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/vsftpd/vsftpd.conf</span><br><span class="line">anon_upload_enable=YES</span><br></pre></td></tr></table></figure>

<p><strong>2./var/ftp/pub ç›®å½•o-rwx</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 pub]# ll -d /var/ftp/pub</span><br><span class="line">drwxr-xrwx. 2 root root 4096 Aug  3 10:35 /var/ftp/pub</span><br></pre></td></tr></table></figure>

<p><strong>3.æµ‹è¯•</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lftp 172.25.0.11:/pub&gt; put rhel7</span><br><span class="line">put: Access failed: 553 Could not create file. (rhel7)</span><br></pre></td></tr></table></figure>

<p>ç›®å‰ä¿®æ”¹äº†é…ç½®æ–‡ä»¶å’Œugoæƒé™è¿˜æ˜¯æŠ¥é”™553ï¼Œä¸èƒ½create file</p>
<p>æˆ‘ä»¬åˆ†æä¸€ä¸‹ï¼Œåªæœ‰selinuxçš„æƒé™é—®é¢˜äº†</p>
<p><strong>4.SELINUX</strong></p>
<p>å¦‚ä½•ç¡®å®šæ˜¯å¦æ˜¯selinuxçš„åŸå› ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>1)å…ˆå…³é—­selinuxï¼Œæµ‹è¯•okçš„</li>
<li>2)å¼€å¯selinuxï¼Œæµ‹è¯•noçš„</li>
</ul>
<p>æˆ‘ä»¬éœ€è¦å»åˆ†æselinuxçš„è®°å½•ï¼Œåˆ†æå·¥å…·æ˜¯<code>sealert</code>,ç”±<code>setroubleshoot</code>è½¯ä»¶å®‰è£…ã€‚</p>
<ol>
<li>æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æ˜¯å¦æœ‰sealertå·¥å…·    <code>which sealert</code></li>
<li>å®‰è£…setroubleshoot        <code>yum install -y setroubleshoot</code></li>
<li>åˆ†æselinuxè®°å½•        <code>sealert -a /var/log/audit/audit.log</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">*****  Plugin allow_anon_write (53.1 confidence) suggests  *******************</span><br><span class="line"></span><br><span class="line">If you want to allow /usr/sbin/vsftpd to be able to write to shared public content</span><br><span class="line">Then you need to change the label on pub to public_content_rw_t, and potentially turn on the</span><br><span class="line">allow_httpd_sys_script_anon_write boolean.</span><br><span class="line">Do</span><br><span class="line"><span class="meta">#</span><span class="bash"> semanage fcontext -a -t public_content_rw_t pub</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> restorecon -R -v pub</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> setsebool -P allow_ftpd_anon_write 1</span></span><br><span class="line"></span><br><span class="line">[root@rhel6 pub]# semanage fcontext -a -t public_content_rw_t /var/ftp/pub</span><br><span class="line">[root@rhel6 pub]# restorecon -R -v /var/ftp/pub</span><br><span class="line">[root@rhel6 pub]# ll -Zd /var/ftp/pub</span><br><span class="line">drwxr-xrwx. root root system_u:object_r:public_content_rw_t:s0 /var/ftp/pub</span><br></pre></td></tr></table></figure>

<p><strong>5.å†æµ‹è¯•</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lftp 172.25.0.11:/pub&gt; put rhel7</span><br><span class="line">lftp 172.25.0.11:/pub&gt; ls</span><br><span class="line">-rw-------    1 14       50              0 Aug 03 05:53 rhel7</span><br><span class="line">lftp 172.25.0.11:/pub&gt; exit</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å‘ç°åŒ¿åç”¨æˆ·å·²ç»å¯ä»¥æˆåŠŸåœ°å¯¹/var/ftp/pubç›®å½•è¿›è¡Œä¸Šä¼ ä¸‹è½½äº†ï¼</p>
<hr>
<h4 id="é¡¹ç›®å®è·µ2-çœŸå®ç”¨æˆ·ï¼ˆç³»ç»Ÿç”¨æˆ·ï¼‰èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œä¸Šä¼ ä¸‹è½½åˆ é™¤"><a href="#é¡¹ç›®å®è·µ2-çœŸå®ç”¨æˆ·ï¼ˆç³»ç»Ÿç”¨æˆ·ï¼‰èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œä¸Šä¼ ä¸‹è½½åˆ é™¤" class="headerlink" title="é¡¹ç›®å®è·µ2: çœŸå®ç”¨æˆ·ï¼ˆç³»ç»Ÿç”¨æˆ·ï¼‰èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œä¸Šä¼ ä¸‹è½½åˆ é™¤"></a>é¡¹ç›®å®è·µ2: çœŸå®ç”¨æˆ·ï¼ˆç³»ç»Ÿç”¨æˆ·ï¼‰èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œä¸Šä¼ ä¸‹è½½åˆ é™¤</h4><p>åœ¨é¡¹ç›®å®è·µ1çš„åŸºç¡€ä¸Šå®Œæˆã€‚</p>
<p><strong>æœåŠ¡ç«¯ rhel6</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ftp]# id student</span><br><span class="line">uid=500(student) gid=500(student) groups=500(student)</span><br><span class="line">[root@rhel6 ftp]# passwd student</span><br><span class="line">Changing password for user student.</span><br><span class="line">New password:</span><br><span class="line">BAD PASSWORD: it is based on a dictionary word</span><br><span class="line">Retype new password:</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line"></span><br><span class="line">[root@rhel6 ftp]# su - student</span><br><span class="line">[student@rhel6 ~]$ pwd</span><br><span class="line">/home/student</span><br><span class="line">[student@rhel6 ~]$ touch file1</span><br><span class="line">[student@rhel6 ~]$ echo aaa &gt; file1</span><br></pre></td></tr></table></figure>

<p><strong>å®¢æˆ·ç«¯ rhel7</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# lftp student@172.25.0.11</span><br><span class="line">Password:</span><br><span class="line">lftp student@172.25.0.11:~&gt; ls      </span><br><span class="line">ls: Login failed: 500 OOPS: cannot change directory:/home/student</span><br></pre></td></tr></table></figure>

<p><strong>å½“å‰çš„æƒ…å†µ</strong> ç³»ç»Ÿç”¨æˆ·studentä¸èƒ½è®¿é—®å®¶ç›®å½•ã€‚</p>
<p><strong>é—®é¢˜çš„è§£å†³</strong></p>
<p>æŠ¥é”™500ï¼Œæ²¡æœ‰æƒé™è¿›å…¥ç”¨æˆ·å®¶ç›®å½•</p>
<p>é…ç½®æ–‡ä»¶æ²¡æœ‰é—®é¢˜ï¼Œugoæƒé™æ²¡æœ‰é—®é¢˜ï¼Œåªå‰©ä¸‹selinuxï¼Œéœ€è¦åˆ†æ</p>
<p><strong>1.åˆ†æselinux</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡å™¨ç«¯</span></span><br><span class="line">[root@rhel6 ftp]# sealert -a /var/log/audit/audit.log</span><br><span class="line"></span><br><span class="line">*****  Plugin catchall_boolean (47.5 confidence) suggests  *******************</span><br><span class="line"></span><br><span class="line">If you want to allow ftp to read and write files in the user home directories</span><br><span class="line">Then you must tell SELinux about this by enabling the 'ftp_home_dir'boolean.</span><br><span class="line">Do</span><br><span class="line">setsebool -P ftp_home_dir 1</span><br></pre></td></tr></table></figure>

<p><strong>2.ä¿®æ”¹å¸ƒå°”å€¼</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ftp]# setsebool -P ftp_home_dir 1</span><br></pre></td></tr></table></figure>

<p><strong>3.æµ‹è¯•</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯</span></span><br><span class="line">lftp student@172.25.0.11:~&gt; ls</span><br><span class="line">lftp student@172.25.0.11:~&gt; pwd  </span><br><span class="line">ftp://student@172.25.0.11/%2Fhome/student</span><br><span class="line">lftp student@172.25.0.11:~&gt; ls</span><br><span class="line">-rw-rw-r--    1 500      500             4 Aug 03 07:13 file1</span><br><span class="line">lftp student@172.25.0.11:~&gt; cat file1</span><br><span class="line">aaa</span><br><span class="line">4 bytes transferred</span><br><span class="line">lftp student@172.25.0.11:~&gt; get file1</span><br><span class="line">4 bytes transferred</span><br><span class="line">lftp student@172.25.0.11:~&gt; put</span><br><span class="line">.ICEauthority  .bashrc	 .dbus/     .tcshrc	Music/	    Videos/		  rhel7</span><br><span class="line">.bash_history  .cache/	 .esd_auth  Desktop/	Pictures/   anaconda-ks.cfg	  test1</span><br><span class="line">.bash_logout   .config/  .local/    Documents/	Public/     file1</span><br><span class="line">.bash_profile  .cshrc	 .ssh/	    Downloads/	Templates/  initial-setup-ks.cfg</span><br><span class="line">lftp student@172.25.0.11:~&gt; put rhel7</span><br><span class="line">lftp student@172.25.0.11:~&gt; ls</span><br><span class="line">-rw-rw-r--    1 500      500             4 Aug 03 07:13 file1</span><br><span class="line">-rw-r--r--    1 500      500             0 Aug 03 07:13 rhel7</span><br><span class="line">lftp student@172.25.0.11:~&gt; rm file1</span><br><span class="line">rm ok, \`file1\' removed</span><br><span class="line">lftp student@172.25.0.11:~&gt; ls</span><br><span class="line">-rw-r--r--    1 500      500             0 Aug 03 07:13 rhel7</span><br></pre></td></tr></table></figure>

<p>ç³»ç»Ÿç”¨æˆ·å·²ç»å¯ä»¥å®ç°èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¸‹è½½ã€ä¸Šä¼ ã€åˆ é™¤äº†ï¼</p>
<hr>
<h4 id="é¡¹ç›®å®è·µ3-é™¤äº†ç³»ç»Ÿç”¨æˆ·studentæœ‰chrootçš„æƒé™ï¼Œå…¶ä»–ç³»ç»Ÿç”¨æˆ·æ²¡æœ‰chrootçš„æƒé™"><a href="#é¡¹ç›®å®è·µ3-é™¤äº†ç³»ç»Ÿç”¨æˆ·studentæœ‰chrootçš„æƒé™ï¼Œå…¶ä»–ç³»ç»Ÿç”¨æˆ·æ²¡æœ‰chrootçš„æƒé™" class="headerlink" title="é¡¹ç›®å®è·µ3: é™¤äº†ç³»ç»Ÿç”¨æˆ·studentæœ‰chrootçš„æƒé™ï¼Œå…¶ä»–ç³»ç»Ÿç”¨æˆ·æ²¡æœ‰chrootçš„æƒé™"></a>é¡¹ç›®å®è·µ3: é™¤äº†ç³»ç»Ÿç”¨æˆ·studentæœ‰chrootçš„æƒé™ï¼Œå…¶ä»–ç³»ç»Ÿç”¨æˆ·æ²¡æœ‰chrootçš„æƒé™</h4><ul>
<li>åŒ¿åç”¨æˆ·çš„æ ¹ç›®å½•    /var/ftp/</li>
<li>ç³»ç»Ÿç”¨æˆ·çš„æ ¹ç›®å½•    /home/student/</li>
</ul>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">chroot_local_user=YES</th>
<th align="left">chroot_local_user=NO</th>
</tr>
</thead>
<tbody><tr>
<td align="left">chroot_list_enable=YES</td>
<td align="left">ä¸èƒ½æ¢æ ¹ï¼Œæœ‰ä¾‹å¤–</td>
<td align="left">éƒ½èƒ½æ¢æ ¹ï¼Œæœ‰ä¾‹å¤–</td>
</tr>
<tr>
<td align="left">chroot_list_enable=NO</td>
<td align="left">ä¸èƒ½æ¢æ ¹ï¼Œæ²¡ä¾‹å¤–</td>
<td align="left">éƒ½èƒ½æ¢æ ¹ï¼Œæ²¡ä¾‹å¤–</td>
</tr>
</tbody></table>
<p>å¦‚æœæŒ‡å®š <code>chroot_list_enable=YES</code> åˆ™éœ€è¦æŒ‡å®šæ–‡ä»¶ä½ç½® <code>chroot_list_file=/etc/vsftpd/chroot_list</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# lftp batman@172.25.0.11</span><br><span class="line">Password:</span><br><span class="line">lftp batman@172.25.0.11:~&gt; ls       </span><br><span class="line">lftp batman@172.25.0.11:~&gt; cd /tmp</span><br><span class="line">cd ok, cwd=/tmp</span><br><span class="line">lftp batman@172.25.0.11:/tmp&gt; pwd</span><br><span class="line">ftp://batman@172.25.0.11/%2Ftmp</span><br><span class="line">lftp batman@172.25.0.11:/tmp&gt; exit</span><br></pre></td></tr></table></figure>

<p><strong>å½“å‰çš„æƒ…å†µ</strong> æ‰€æœ‰çš„ç³»ç»Ÿç”¨æˆ·éƒ½èƒ½å¤Ÿchrootï¼Œè€Œè¦æ±‚é™¤äº†studentç”¨æˆ·ä¹‹å¤–çš„æ‰€æœ‰ç³»ç»Ÿç”¨æˆ·éƒ½ä¸èƒ½chrootã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong></p>
<p>å¯ä»¥é€‰æ‹©<code>ä¸èƒ½æ¢æ ¹ï¼Œæœ‰ä¾‹å¤–</code></p>
<p><strong>1.ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡å™¨ç«¯</span></span><br><span class="line">[root@rhel6 ~]# vim /etc/vsftpd/vsftpd.conf</span><br><span class="line">chroot_local_user=YES</span><br><span class="line">chroot_list_enable=YES</span><br><span class="line">chroot_list_file=/etc/vsftpd/chroot_list</span><br></pre></td></tr></table></figure>

<p><strong>2.åˆ›å»ºchroot_list</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# vim /etc/vsftpd/chroot_list</span><br><span class="line">[root@rhel6 ~]# cat /etc/vsftpd/chroot_list</span><br><span class="line">student</span><br></pre></td></tr></table></figure>

<p><strong>3.é‡å¯æœåŠ¡</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# service vsftpd restart</span><br><span class="line">Shutting down vsftpd:                                      [  OK  ]</span><br><span class="line">Starting vsftpd for vsftpd:                                [  OK  ]</span><br></pre></td></tr></table></figure>

<p><strong>2.æµ‹è¯•</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯    </span></span><br><span class="line">[root@rhel7 ~]# lftp batman@172.25.0.11</span><br><span class="line">Password:</span><br><span class="line">lftp batman@172.25.0.11:~&gt; cd /etc/</span><br><span class="line">cd: Access failed: 550 Failed to change directory. (/etc)</span><br><span class="line">lftp batman@172.25.0.11:/&gt; exit</span><br><span class="line">[root@rhel7 ~]# lftp student@172.25.0.11</span><br><span class="line">Password:</span><br><span class="line">lftp student@172.25.0.11:~&gt; cd /etc</span><br><span class="line">cd ok, cwd=/etc                  </span><br><span class="line">lftp student@172.25.0.11:/etc&gt; exit</span><br></pre></td></tr></table></figure>

<p><strong>å½“å‰çš„æƒ…å†µ</strong></p>
<p>ç³»ç»Ÿç”¨æˆ·studentå¯ä»¥åˆ‡æ¢æ ¹ç›®å½•ï¼Œè€Œbatmanä¸åœ¨chroot_listæ–‡ä»¶ä¸­æ‰€ä»¥ä¸èƒ½åˆ‡æ¢æ ¹ç›®å½•ã€‚</p>
<h5 id="æ‹“å±•å†…å®¹"><a href="#æ‹“å±•å†…å®¹" class="headerlink" title="æ‹“å±•å†…å®¹"></a>æ‹“å±•å†…å®¹</h5><p><strong>ä¸ºä»€ä¹ˆrootç”¨æˆ·ä¸èƒ½é€šè¿‡ftpåè®®è®¿é—®æœåŠ¡å™¨ï¼Ÿ</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# lftp root@172.25.0.11</span><br><span class="line">Password:</span><br><span class="line">lftp root@172.25.0.11:~&gt; ls         </span><br><span class="line">ls: Login failed: 530 Permission denied.</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæœ‰ç”¨æˆ·è®¿é—®æ§åˆ¶åˆ—è¡¨<code>/etc/vsftpd/user_list</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# grep userlist_enable /etc/vsftpd/vsftpd.conf</span><br><span class="line">userlist_enable=YES</span><br><span class="line"></span><br><span class="line">[root@rhel6 ftp]# cat /etc/vsftpd/user_list</span><br><span class="line"><span class="meta">#</span><span class="bash"> vsftpd userlist</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If userlist_deny=NO, only allow users <span class="keyword">in</span> this file</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If userlist_deny=YES (default), never allow users <span class="keyword">in</span> this file, and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">do</span> not even prompt <span class="keyword">for</span> a password.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that the default vsftpd pam config also checks /etc/vsftpd/ftpusers</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> users that are denied.</span></span><br><span class="line">root</span><br><span class="line">bin</span><br><span class="line">daemon</span><br><span class="line">adm</span><br><span class="line">lp</span><br><span class="line">sync</span><br><span class="line">shutdown</span><br><span class="line">halt</span><br><span class="line">mail</span><br><span class="line">news</span><br><span class="line">uucp</span><br><span class="line">operator</span><br><span class="line">games</span><br><span class="line">nobody</span><br></pre></td></tr></table></figure>


<hr>
<h4 id="äº†è§£vsftpdçš„é…ç½®æ–‡ä»¶"><a href="#äº†è§£vsftpdçš„é…ç½®æ–‡ä»¶" class="headerlink" title="äº†è§£vsftpdçš„é…ç½®æ–‡ä»¶"></a>äº†è§£vsftpdçš„é…ç½®æ–‡ä»¶</h4><table>
<thead>
<tr>
<th align="left">é…ç½®æ–‡ä»¶</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">/etc/vsftpd/vsftpd.conf</td>
<td align="left">ä¸»é…ç½®æ–‡ä»¶</td>
</tr>
<tr>
<td align="left">/usr/sbin/vsftpd</td>
<td align="left">Vsftpdçš„ä¸»ç¨‹åº</td>
</tr>
<tr>
<td align="left">/etc/rc.d/init.d/vsftpd</td>
<td align="left">å¯åŠ¨è„šæœ¬</td>
</tr>
<tr>
<td align="left">/etc/pam.d/vsftpd</td>
<td align="left">PAMè®¤è¯æ–‡ä»¶ï¼ˆæ­¤æ–‡ä»¶ä¸­file=/etc/vsftpd/ftpuserså­—æ®µï¼ŒæŒ‡æ˜é˜»æ­¢è®¿é—®çš„ç”¨æˆ·æ¥è‡ª/etc/vsftpd/ftpusersæ–‡ä»¶ä¸­çš„ç”¨æˆ·ï¼‰</td>
</tr>
<tr>
<td align="left">/etc/vsftpd/ftpusers</td>
<td align="left">ç¦æ­¢ä½¿ç”¨vsftpdçš„ç”¨æˆ·åˆ—è¡¨æ–‡ä»¶ã€‚è®°å½•ä¸å…è®¸è®¿é—®FTPæœåŠ¡å™¨çš„ç”¨æˆ·åå•ï¼Œç®¡ç†å‘˜å¯ä»¥æŠŠä¸€äº›å¯¹ç³»ç»Ÿå®‰å…¨æœ‰å¨èƒçš„ç”¨æˆ·è´¦å·è®°å½•åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œä»¥å…ç”¨æˆ·ä»FTPç™»å½•åè·å¾—å¤§äºä¸Šä¼ ä¸‹è½½æ“ä½œçš„æƒåˆ©ï¼Œè€Œå¯¹ç³»ç»Ÿé€ æˆæŸåã€‚</td>
</tr>
<tr>
<td align="left">/etc/vsftpd/user_list</td>
<td align="left">ç¦æ­¢æˆ–å…è®¸ä½¿ç”¨vsftpdçš„ç”¨æˆ·åˆ—è¡¨æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶ä¸­æŒ‡å®šçš„ç”¨æˆ·ç¼ºçœæƒ…å†µï¼ˆå³åœ¨/etc/vsftpd/vsftpd.confä¸­è®¾ç½®userlist_deny=YESï¼‰ä¸‹ä¹Ÿä¸èƒ½è®¿é—®FTPæœåŠ¡å™¨ï¼Œåœ¨è®¾ç½®äº†userlist_deny=NOæ—¶,ä»…å…è®¸user_listä¸­æŒ‡å®šçš„ç”¨æˆ·è®¿é—®FTPæœåŠ¡å™¨ã€‚</td>
</tr>
<tr>
<td align="left">/var/ftp</td>
<td align="left">åŒ¿åç”¨æˆ·ä¸»ç›®å½•ï¼›æœ¬åœ°ç”¨æˆ·ä¸»ç›®å½•ä¸ºï¼š/home/ç”¨æˆ·ä¸»ç›®å½•ï¼Œå³ç™»å½•åè¿›å…¥è‡ªå·±å®¶ç›®å½•</td>
</tr>
<tr>
<td align="left">/var/ftp/pub</td>
<td align="left">åŒ¿åç”¨æˆ·çš„ä¸‹è½½ç›®å½•ï¼Œæ­¤ç›®å½•éœ€èµ‹æƒæ ¹chmod 1777 pubï¼ˆ1ä¸ºç‰¹æ®Šæƒé™ï¼Œä½¿ä¸Šè½½åæ— æ³•åˆ é™¤ï¼‰</td>
</tr>
<tr>
<td align="left">/etc/logrotate.d/vsftpd.log</td>
<td align="left">Vsftpdçš„æ—¥å¿—æ–‡ä»¶</td>
</tr>
</tbody></table>
<h5 id="vsftpdçš„ä¸»é…ç½®æ–‡ä»¶-etc-vsftpd-vsftpd-confè¯´æ˜"><a href="#vsftpdçš„ä¸»é…ç½®æ–‡ä»¶-etc-vsftpd-vsftpd-confè¯´æ˜" class="headerlink" title="vsftpdçš„ä¸»é…ç½®æ–‡ä»¶/etc/vsftpd/vsftpd.confè¯´æ˜"></a>vsftpdçš„ä¸»é…ç½®æ–‡ä»¶/etc/vsftpd/vsftpd.confè¯´æ˜</h5><p>å’ŒLinuxç³»ç»Ÿä¸­çš„å¤§å¤šæ•°é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œvsftpdçš„é…ç½®æ–‡ä»¶ä¸­ä»¥#å¼€å§‹æ³¨é‡Šã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">æ˜¯å¦å…è®¸åŒ¿åç™»å½•FTPæœåŠ¡å™¨ï¼Œé»˜è®¤è®¾ç½®ä¸ºYESå…è®¸</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç”¨æˆ·å¯ä½¿ç”¨ç”¨æˆ·åftpæˆ–anonymousè¿›è¡Œftpç™»å½•ï¼Œå£ä»¤ä¸ºç”¨æˆ·çš„E-mailåœ°å€ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚ä¸å…è®¸åŒ¿åè®¿é—®åˆ™è®¾ç½®ä¸ºNO</span></span><br><span class="line">anonymous_enable=YES</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å…è®¸æœ¬åœ°ç”¨æˆ·(å³linuxç³»ç»Ÿä¸­çš„ç”¨æˆ·å¸å·)ç™»å½•FTPæœåŠ¡å™¨ï¼Œé»˜è®¤è®¾ç½®ä¸ºYESå…è®¸</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ¬åœ°ç”¨æˆ·ç™»å½•åä¼šè¿›å…¥ç”¨æˆ·ä¸»ç›®å½•ï¼Œè€ŒåŒ¿åç”¨æˆ·ç™»å½•åè¿›å…¥åŒ¿åç”¨æˆ·çš„ä¸‹è½½ç›®å½•/var/ftp/pub</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è‹¥åªå…è®¸åŒ¿åç”¨æˆ·è®¿é—®ï¼Œå‰é¢åŠ ä¸Š<span class="comment">#æ³¨é‡Šæ‰å³å¯é˜»æ­¢æœ¬åœ°ç”¨æˆ·è®¿é—®FTPæœåŠ¡å™¨</span></span></span><br><span class="line">local_enable=YES</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å…è®¸æœ¬åœ°ç”¨æˆ·å¯¹FTPæœåŠ¡å™¨æ–‡ä»¶å…·æœ‰å†™æƒé™ï¼Œé»˜è®¤è®¾ç½®ä¸ºYESå…è®¸</span></span><br><span class="line">write_enable=YES</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ©ç ï¼Œæœ¬åœ°ç”¨æˆ·é»˜è®¤æ©ç ä¸º077</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½ å¯ä»¥è®¾ç½®æœ¬åœ°ç”¨æˆ·çš„æ–‡ä»¶æ©ç ä¸ºç¼ºçœ022ï¼Œä¹Ÿå¯æ ¹æ®ä¸ªäººå–œå¥½å°†å…¶è®¾ç½®ä¸ºå…¶ä»–å€¼</span></span><br><span class="line"><span class="meta">#</span><span class="bash">local_umask=022</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ï¼Œé¡»å°†å…¨å±€çš„write_enable=YESã€‚é»˜è®¤ä¸ºYES</span></span><br><span class="line"><span class="meta">#</span><span class="bash">anon_upload_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·åˆ›å»ºæ–°æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="meta">#</span><span class="bash">anon_mkdir_write_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦æ¿€æ´»ç›®å½•æ¬¢è¿ä¿¡æ¯åŠŸèƒ½</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å½“ç”¨æˆ·ç”¨CMDæ¨¡å¼é¦–æ¬¡è®¿é—®æœåŠ¡å™¨ä¸ŠæŸä¸ªç›®å½•æ—¶ï¼ŒFTPæœåŠ¡å™¨å°†æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¬¢è¿ä¿¡æ¯æ˜¯é€šè¿‡è¯¥ç›®å½•ä¸‹çš„.messageæ–‡ä»¶è·å¾—çš„</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ­¤æ–‡ä»¶ä¿å­˜è‡ªå®šä¹‰çš„æ¬¢è¿ä¿¡æ¯ï¼Œç”±ç”¨æˆ·è‡ªå·±å»ºç«‹</span></span><br><span class="line"><span class="meta">#</span><span class="bash">dirmessage_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦è®©ç³»ç»Ÿè‡ªåŠ¨ç»´æŠ¤ä¸Šä¼ å’Œä¸‹è½½çš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤æƒ…å†µè¯¥æ—¥å¿—æ–‡ä»¶ä¸º/var/<span class="built_in">log</span>/vsftpd.log,ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„xferlog_fileé€‰é¡¹å¯¹å…¶è¿›è¡Œè®¾å®š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤å€¼ä¸ºNO</span></span><br><span class="line">xferlog_enable=YES</span><br><span class="line"><span class="meta">#</span><span class="bash"> Make sure PORT transfer connections originate from port 20 (ftp-data).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦è®¾å®šFTPæœåŠ¡å™¨å°†å¯ç”¨FTPæ•°æ®ç«¯å£çš„è¿æ¥è¯·æ±‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ftp-dataæ•°æ®ä¼ è¾“ï¼Œ21ä¸ºè¿æ¥æ§åˆ¶ç«¯å£</span></span><br><span class="line">connect_from_port_20=YES</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾å®šæ˜¯å¦å…è®¸æ”¹å˜ä¸Šä¼ æ–‡ä»¶çš„å±ä¸»ï¼Œä¸ä¸‹é¢ä¸€ä¸ªè®¾å®šé¡¹é…åˆä½¿ç”¨</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ³¨æ„ï¼Œä¸æ¨èä½¿ç”¨rootç”¨æˆ·ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash">chown_uploads=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®æƒ³è¦æ”¹å˜çš„ä¸Šä¼ æ–‡ä»¶çš„å±ä¸»ï¼Œå¦‚æœéœ€è¦ï¼Œåˆ™è¾“å…¥ä¸€ä¸ªç³»ç»Ÿç”¨æˆ·å</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ä»¥æŠŠä¸Šä¼ çš„æ–‡ä»¶éƒ½æ”¹æˆrootå±ä¸»ã€‚whoeverï¼šä»»ä½•äºº</span></span><br><span class="line"><span class="meta">#</span><span class="bash">chown_username=whoever</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾å®šç³»ç»Ÿç»´æŠ¤è®°å½•FTPæœåŠ¡å™¨ä¸Šä¼ å’Œä¸‹è½½æƒ…å†µçš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /var/<span class="built_in">log</span>/vsftpd.logæ˜¯é»˜è®¤çš„ï¼Œä¹Ÿå¯ä»¥å¦è®¾å…¶å®ƒ</span></span><br><span class="line"><span class="meta">#</span><span class="bash">xferlog_file=/var/<span class="built_in">log</span>/vsftpd.log</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦ä»¥æ ‡å‡†xferlogçš„æ ¼å¼ä¹¦å†™ä¼ è¾“æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤ä¸º/var/<span class="built_in">log</span>/xferlogï¼Œä¹Ÿå¯ä»¥é€šè¿‡xferlog_fileé€‰é¡¹å¯¹å…¶è¿›è¡Œè®¾å®š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤å€¼ä¸ºNO</span></span><br><span class="line"><span class="meta">#</span><span class="bash">xferlog_std_format=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»¥ä¸‹æ˜¯é™„åŠ é…ç½®ï¼Œæ·»åŠ ç›¸åº”çš„é€‰é¡¹å°†å¯ç”¨ç›¸åº”çš„è®¾ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦ç”Ÿæˆä¸¤ä¸ªç›¸ä¼¼çš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤åœ¨/var/<span class="built_in">log</span>/xferlogå’Œ/var/<span class="built_in">log</span>/vsftpd.logç›®å½•ä¸‹</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‰è€…æ˜¯wu_ftpdç±»å‹çš„ä¼ è¾“æ—¥å¿—ï¼Œå¯ä»¥åˆ©ç”¨æ ‡å‡†æ—¥å¿—å·¥å…·å¯¹å…¶è¿›è¡Œåˆ†æï¼›åè€…æ˜¯vsftpdç±»å‹çš„æ—¥å¿—</span></span><br><span class="line"><span class="meta">#</span><span class="bash">dual_log_enable</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å°†åŸæœ¬è¾“å‡ºåˆ°/var/<span class="built_in">log</span>/vsftpd.logä¸­çš„æ—¥å¿—ï¼Œè¾“å‡ºåˆ°ç³»ç»Ÿæ—¥å¿—</span></span><br><span class="line"><span class="meta">#</span><span class="bash">syslog_enable</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®æ•°æ®ä¼ è¾“ä¸­æ–­é—´éš”æ—¶é—´ï¼Œæ­¤è¯­å¥è¡¨ç¤ºç©ºé—²çš„ç”¨æˆ·ä¼šè¯ä¸­æ–­æ—¶é—´ä¸º600ç§’</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å³å½“æ•°æ®ä¼ è¾“ç»“æŸåï¼Œç”¨æˆ·è¿æ¥FTPæœåŠ¡å™¨çš„æ—¶é—´ä¸åº”è¶…è¿‡600ç§’ã€‚å¯ä»¥æ ¹æ®å®é™…æƒ…å†µå¯¹è¯¥å€¼è¿›è¡Œä¿®æ”¹</span></span><br><span class="line"><span class="meta">#</span><span class="bash">idle_session_timeout=600</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®æ•°æ®è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œè¯¥è¯­å¥è¡¨ç¤ºæ•°æ®è¿æ¥è¶…æ—¶æ—¶é—´ä¸º120ç§’ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µå¯¹å…¶ä¸ªä¿®æ”¹</span></span><br><span class="line"><span class="meta">#</span><span class="bash">data_connection_timeout=120</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿è¡Œvsftpdéœ€è¦çš„éç‰¹æƒç³»ç»Ÿç”¨æˆ·ï¼Œç¼ºçœæ˜¯nobody</span></span><br><span class="line"><span class="meta">#</span><span class="bash">nopriv_user=ftpsecure</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦è¯†åˆ«å¼‚æ­¥ABORè¯·æ±‚ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœFTP clientä¼šä¸‹è¾¾â€œasync ABORâ€è¿™ä¸ªæŒ‡ä»¤æ—¶ï¼Œè¿™ä¸ªè®¾å®šæ‰éœ€è¦å¯ç”¨</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è€Œä¸€èˆ¬æ­¤è®¾å®šå¹¶ä¸å®‰å…¨ï¼Œæ‰€ä»¥é€šå¸¸å°†å…¶å–æ¶ˆ</span></span><br><span class="line"><span class="meta">#</span><span class="bash">async_abor_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦ä»¥ASCIIæ–¹å¼ä¼ è¾“æ•°æ®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šå¿½ç•¥ASCIIæ–¹å¼çš„è¯·æ±‚ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ç”¨æ­¤é€‰é¡¹å°†å…è®¸æœåŠ¡å™¨ä»¥ASCIIæ–¹å¼ä¼ è¾“æ•°æ®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸è¿‡ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´ç”±<span class="string">"SIZE /big/file"</span>æ–¹å¼å¼•èµ·çš„DoSæ”»å‡»</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ascii_upload_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ascii_download_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç™»å½•FTPæœåŠ¡å™¨æ—¶æ˜¾ç¤ºçš„æ¬¢è¿ä¿¡æ¯</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœ‰éœ€è¦ï¼Œå¯åœ¨æ›´æ”¹ç›®å½•æ¬¢è¿ä¿¡æ¯çš„ç›®å½•ä¸‹åˆ›å»ºåä¸º.messageçš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥æ¬¢è¿ä¿¡æ¯ä¿å­˜å</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ftpd_banner=Welcome to blah FTP service.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»‘åå•è®¾ç½®ã€‚å¦‚æœå¾ˆè®¨åŒæŸäº›email addressï¼Œå°±å¯ä»¥ä½¿ç”¨æ­¤è®¾å®šæ¥å–æ¶ˆä»–çš„ç™»å½•æƒé™</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ä»¥å°†æŸäº›ç‰¹æ®Šçš„email addressæŠµæŒ¡ä½ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash">deny_email_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å½“ä¸Šé¢çš„deny_email_enable=YESæ—¶ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªè®¾å®šé¡¹æ¥è§„å®šå“ªäº›é‚®ä»¶åœ°å€ä¸å¯ç™»å½•vsftpdæœåŠ¡å™¨</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ­¤æ–‡ä»¶éœ€ç”¨æˆ·è‡ªå·±åˆ›å»ºï¼Œä¸€è¡Œä¸€ä¸ªemail addresså³å¯</span></span><br><span class="line"><span class="meta">#</span><span class="bash">banned_email_file=/etc/vsftpd/banned_emails</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨åæ˜¯å¦å…·æœ‰è®¿é—®è‡ªå·±ç›®å½•ä»¥å¤–çš„å…¶ä»–æ–‡ä»¶çš„æƒé™</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®ä¸ºYESæ—¶ï¼Œç”¨æˆ·è¢«é”å®šåœ¨è‡ªå·±çš„homeç›®å½•ä¸­ï¼Œvsftpdå°†åœ¨ä¸‹é¢chroot_list_fileé€‰é¡¹å€¼çš„ä½ç½®å¯»æ‰¾chroot_listæ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¿…é¡»ä¸ä¸‹é¢çš„è®¾ç½®é¡¹é…åˆ</span></span><br><span class="line"><span class="meta">#</span><span class="bash">chroot_list_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¢«åˆ—å…¥æ­¤æ–‡ä»¶çš„ç”¨æˆ·ï¼Œåœ¨ç™»å½•åå°†ä¸èƒ½åˆ‡æ¢åˆ°è‡ªå·±ç›®å½•ä»¥å¤–çš„å…¶ä»–ç›®å½•</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»è€Œæœ‰åˆ©äºFTPæœåŠ¡å™¨çš„å®‰å…¨ç®¡ç†å’Œéšç§ä¿æŠ¤ã€‚æ­¤æ–‡ä»¶éœ€è‡ªå·±å»ºç«‹</span></span><br><span class="line"><span class="meta">#</span><span class="bash">chroot_list_file=/etc/vsftpd/chroot_list</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å…è®¸é€’å½’æŸ¥è¯¢ã€‚é»˜è®¤ä¸ºå…³é—­ï¼Œä»¥é˜²æ­¢è¿œç¨‹ç”¨æˆ·é€ æˆè¿‡é‡çš„I/O</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ls_recurse_enable=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å…è®¸ç›‘å¬ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœè®¾ç½®ä¸ºYESï¼Œåˆ™vsftpdå°†ä»¥ç‹¬ç«‹æ¨¡å¼è¿è¡Œï¼Œç”±vsftpdè‡ªå·±ç›‘å¬å’Œå¤„ç†IPv4ç«¯å£çš„è¿æ¥è¯·æ±‚</span></span><br><span class="line">listen=YES</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾å®šæ˜¯å¦æ”¯æŒIPV6ã€‚å¦‚è¦åŒæ—¶ç›‘å¬IPv4å’ŒIPv6ç«¯å£ï¼Œ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ™å¿…é¡»è¿è¡Œä¸¤å¥—vsftpdï¼Œé‡‡ç”¨ä¸¤å¥—é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åŒæ—¶ç¡®ä¿å…¶ä¸­æœ‰ä¸€ä¸ªç›‘å¬é€‰é¡¹æ˜¯è¢«æ³¨é‡Šæ‰çš„</span></span><br><span class="line"><span class="meta">#</span><span class="bash">listen_ipv6=YES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®PAMå¤–æŒ‚æ¨¡å—æä¾›çš„è®¤è¯æœåŠ¡æ‰€ä½¿ç”¨çš„é…ç½®æ–‡ä»¶åï¼Œå³/etc/pam.d/vsftpdæ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ­¤æ–‡ä»¶ä¸­file=/etc/vsftpd/ftpuserså­—æ®µï¼Œè¯´æ˜äº†PAMæ¨¡å—èƒ½æŠµæŒ¡çš„å¸å·å†…å®¹æ¥è‡ªæ–‡ä»¶/etc/vsftpd/ftpusersä¸­</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pam_service_name=vsftpd</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦å…è®¸ftpusersæ–‡ä»¶ä¸­çš„ç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨ï¼Œé»˜è®¤ä¸ºNO</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è‹¥æ­¤é¡¹è®¾ä¸ºYESï¼Œåˆ™user_listæ–‡ä»¶ä¸­çš„ç”¨æˆ·å…è®¸ç™»å½•FTPæœåŠ¡å™¨</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è€Œå¦‚æœåŒæ—¶è®¾ç½®äº†userlist_deny=YESï¼Œåˆ™user_listæ–‡ä»¶ä¸­çš„ç”¨æˆ·å°†ä¸å…è®¸ç™»å½•FTPæœåŠ¡å™¨ï¼Œç”šè‡³è¿è¾“å…¥å¯†ç æç¤ºä¿¡æ¯éƒ½æ²¡æœ‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash">userlist_enable=YES/NO</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®æ˜¯å¦é˜»æ‰¯user_listæ–‡ä»¶ä¸­çš„ç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨ï¼Œé»˜è®¤ä¸ºYES</span></span><br><span class="line"><span class="meta">#</span><span class="bash">userlist_deny=YES/NO</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¦ä½¿ç”¨tcp_wrappersä½œä¸ºä¸»æœºè®¿é—®æ§åˆ¶æ–¹å¼ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tcp_wrapperså¯ä»¥å®ç°linuxç³»ç»Ÿä¸­ç½‘ç»œæœåŠ¡çš„åŸºäºä¸»æœºåœ°å€çš„è®¿é—®æ§åˆ¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨/etcç›®å½•ä¸­çš„hosts.allowå’Œhosts.denyä¸¤ä¸ªæ–‡ä»¶ç”¨äºè®¾ç½®tcp_wrappersçš„è®¿é—®æ§åˆ¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‰è€…è®¾ç½®å…è®¸è®¿é—®è®°å½•ï¼Œåè€…è®¾ç½®æ‹’ç»è®¿é—®è®°å½•ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æƒ³é™åˆ¶æŸäº›ä¸»æœºå¯¹FTPæœåŠ¡å™¨192.168.57.2çš„åŒ¿åè®¿é—®ï¼Œç¼–ç¼‰/etc/hosts.allowæ–‡ä»¶ï¼Œå¦‚åœ¨ä¸‹é¢å¢åŠ ä¸¤è¡Œå‘½ä»¤ï¼š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> vsftpd:192.168.57.1:DENY å’Œvsftpd:192.168.57.9:DENY</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¡¨æ˜é™åˆ¶IPä¸º192.168.57.1/192.168.57.9ä¸»æœºè®¿é—®IPä¸º192.168.57.2çš„FTPæœåŠ¡å™¨</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ­¤æ—¶FTPæœåŠ¡å™¨è™½å¯ä»¥PINGé€šï¼Œä½†æ— æ³•è¿æ¥</span></span><br><span class="line">tcp_wrappers=YES</span><br></pre></td></tr></table></figure>

<p>é™¤äº†ä¸Šè¿°é‚£äº›åŸºæœ¬è®¾å®šï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨vsftpd.confæ–‡ä»¶ä¸­æ·»åŠ æ›´å¤šçš„å®‰å…¨é€‰é¡¹ã€‚å…¶ä¸­å‡ ä¸ªå¸¸ç”¨çš„å¦‚ä¸‹ï¼š</p>
<p>é™åˆ¶æœ€å¤§è¿æ¥æ•°å’Œä¼ è¾“é€Ÿç‡</p>
<p>åœ¨FTPæœåŠ¡å™¨çš„ç®¡ç†ä¸­ï¼Œæ— è®ºå¯¹æœ¬åœ°ç”¨æˆ·è¿˜æ˜¯åŒ¿åç”¨æˆ·ï¼Œå¯¹äºFTPæœåŠ¡å™¨èµ„æºçš„ä½¿ç”¨éƒ½éœ€è¦è¿›è¡Œæ§æ§åˆ¶ï¼Œé¿å…ç”±äºè´Ÿæ‹…è¿‡å¤§é€ æˆFTPæœåŠ¡å™¨è¿è¡Œå¼‚å¸¸ï¼Œå¯ä»¥æ·»åŠ ä»¥ä¸‹é…ç½®é¡¹å¯¹FTPå®¢æˆ·æœºä½¿ç”¨FTPæœåŠ¡å™¨èµ„æºè¿›è¡Œæ§åˆ¶ï¼š</p>
<ul>
<li><code>max_client</code>è®¾ç½®é¡¹ ç”¨äºè®¾ç½®FTPæœåŠ¡å™¨æ‰€å…è®¸çš„æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œå€¼ä¸º0æ—¶è¡¨ç¤ºä¸é™åˆ¶ã€‚ä¾‹å¦‚<code>max_client=100</code>è¡¨ç¤ºFTPæœåŠ¡å™¨çš„æ‰€æœ‰å®¢æˆ·ç«¯æœ€å¤§è¿æ¥æ•°ä¸è¶…è¿‡100ä¸ªã€‚</li>
<li><code>max_per_ip</code>è®¾ç½®é¡¹ ç”¨äºè®¾ç½®å¯¹äºåŒä¸€IPåœ°å€å…è®¸çš„æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œå€¼ä¸º0æ—¶è¡¨ç¤ºä¸é™åˆ¶ã€‚ä¾‹å¦‚<code>max_per_ip=5</code>è¡¨ç¤ºåŒä¸€IPåœ°å€çš„FTPå®¢æˆ·æœºä¸FTPæœåŠ¡å™¨å»ºç«‹çš„æœ€å¤§è¿æ¥æ•°ä¸è¶…è¿‡5ä¸ªã€‚</li>
<li><code>local_max_rate</code>è®¾ç½®é¡¹ ç”¨äºè®¾ç½®æœ¬åœ°ç”¨æˆ·çš„æœ€å¤§ä¼ è¾“é€Ÿç‡ï¼Œå•ä½ä¸ºB/sï¼Œå€¼ä¸º0æ—¶è¡¨ç¤ºä¸é™åˆ¶ã€‚ä¾‹å¦‚<code>local_max_rate=500000</code>è¡¨ç¤ºFTPæœåŠ¡å™¨çš„æœ¬åœ°ç”¨æˆ·æœ€å¤§ä¼ è¾“é€Ÿç‡è®¾ç½®ä¸º500KB/s.</li>
<li><code>anon_max_rate</code>è®¾ç½®é¡¹ ç”¨äºè®¾ç½®åŒ¿åç”¨æˆ·çš„æœ€å¤§ä¼ è¾“é€Ÿç‡ï¼Œå•ä½ä¸ºB/s,å€¼ä¸º0è¡¨ç¤ºä¸é™åˆ¶ã€‚ä¾‹å¦‚<code>ano_max_rate=200000</code>ï¼Œè¡¨ç¤ºFTPæœåŠ¡å™¨çš„åŒ¿åç”¨æˆ·æœ€å¤§ä¼ è¾“é€Ÿç‡è®¾ç½®ä¸º200KB/s.</li>
</ul>
<p>æŒ‡å®šç”¨æˆ·çš„æƒé™è®¾ç½®</p>
<p><code>vsftpd.user_list</code>æ–‡ä»¶éœ€è¦ä¸<code>vsftpd.conf</code>æ–‡ä»¶ä¸­çš„é…ç½®é¡¹ç»“åˆæ¥å®ç°å¯¹äº<code>vsftpd.user_list</code>æ–‡ä»¶ä¸­æŒ‡å®šç”¨æˆ·è´¦å·çš„è®¿é—®æ§åˆ¶ï¼š</p>
<p>ï¼ˆ1ï¼‰è®¾ç½®ç¦æ­¢ç™»å½•çš„ç”¨æˆ·è´¦å·</p>
<p>å½“<code>vsftpd.conf</code>é…ç½®æ–‡ä»¶ä¸­åŒ…æ‹¬ä»¥ä¸‹è®¾ç½®æ—¶ï¼Œ<code>vsftpd.user_list</code>æ–‡ä»¶ä¸­çš„ç”¨æˆ·è´¦å·è¢«ç¦æ­¢è¿›è¡ŒFTPç™»å½•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">userlist_enable=YES</span><br><span class="line">userlist_deny=YES</span><br></pre></td></tr></table></figure>

<p><code>userlist_enable</code>è®¾ç½®é¡¹è®¾ç½®ä½¿ç”¨<code>vsftpd.user_list</code>æ–‡ä»¶ï¼Œ<code>userlist_deny</code>è®¾ç½®ä¸º<code>YES</code>è¡¨ç¤º<code>vsftpd.user_list</code>æ–‡ä»¶ç”¨äºè®¾ç½®ç¦æ­¢çš„ç”¨æˆ·è´¦å·ã€‚</p>
<p>ï¼ˆ2ï¼‰è®¾ç½®åªå…è®¸ç™»å½•çš„ç”¨æˆ·è´¦å·</p>
<p>å½“vsftpd.confé…ç½®æ–‡ä»¶ä¸­åŒ…æ‹¬ä»¥ä¸‹è®¾ç½®æ—¶ï¼Œåªæœ‰<code>vsftpd.user_list</code>æ–‡ä»¶ä¸­çš„ç”¨æˆ·è´¦å·èƒ½å¤Ÿè¿›è¡ŒFTPç™»å½•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">userlist_enable=YES</span><br><span class="line">userlist_deny=NO</span><br></pre></td></tr></table></figure>

<p><code>userlist_enable</code>è®¾ç½®é¡¹è®¾ç½®ä½¿ç”¨vsftpd.user_listæ–‡ä»¶ï¼Œ<code>userlist _deny</code>è®¾ç½®ä¸º<code>NO</code>è¡¨ç¤º<code>vsftpd.usre_list</code>æ–‡ä»¶ç”¨äºè®¾ç½®åªå…è®¸ç™»å½•çš„ç”¨æˆ·è´¦å·ï¼Œæ–‡ä»¶ä¸­æœªåŒ…æ‹¬çš„ç”¨æˆ·è´¦å·è¢«ç¦æ­¢FTPç™»å½•ã€‚</p>
<p><code>userlist_deny</code>å’Œ<code>userlist_enable</code>é€‰é¡¹é™åˆ¶ç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨ï¼ˆä½¿ç”¨<code>userlist_deny</code>é€‰é¡¹å’Œ<code>user_list</code>æ–‡ä»¶ä¸€èµ·èƒ½æœ‰æ•ˆé˜»æ­¢<code>root,apache,www</code>ç­‰ç³»ç»Ÿç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨ï¼Œä»è€Œä¿è¯FTPæœåŠ¡å™¨çš„åˆ†çº§å®‰å…¨æ€§ï¼‰ã€‚ä»¥ä¸‹æ˜¯ä¸¤ä¸ªé€‰é¡¹çš„å…·ä½“è¡¨ç°å½¢å¼å’Œä¸¤ç§æ­é…ä½¿ç”¨æ–¹å¼çš„æ•ˆæœï¼š</p>
<table>
<thead>
<tr>
<th align="left">é…ç½®</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Userlist_enable=YES</td>
<td align="left">Ftpusersä¸­ç”¨æˆ·å…è®¸è®¿é—®;User_listä¸­ç”¨æˆ·å…è®¸è®¿é—®</td>
</tr>
<tr>
<td align="left">Userlist_enable=NO</td>
<td align="left">Ftpusersä¸­ç”¨æˆ·ç¦æ­¢è®¿é—®;User_listä¸­ç”¨æˆ·å…è®¸è®¿é—®</td>
</tr>
<tr>
<td align="left">Userlist_deny=YES</td>
<td align="left">Ftpusersä¸­ç”¨æˆ·ç¦æ­¢è®¿é—®ï¼ˆç™»å½•æ—¶å¯ä»¥çœ‹åˆ°å¯†ç è¾“å…¥æç¤ºï¼Œä½†ä»æ— æ³•è®¿é—®ï¼‰;user_list ä¸­ç”¨æˆ·ç¦æ­¢è®¿é—®</td>
</tr>
<tr>
<td align="left">Userlist_deny=NO</td>
<td align="left">ftpusersä¸­ç”¨æˆ·ç¦æ­¢è®¿é—®;user_listä¸­ç”¨æˆ·å…è®¸è®¿</td>
</tr>
<tr>
<td align="left">Userlist_enable=YES å¹¶ä¸”Userlist_deny=YES</td>
<td align="left">Ftpusersä¸­ç”¨æˆ·ç¦æ­¢è®¿é—®;User_listä¸­ç”¨æˆ·ç¦æ­¢è®¿é—®ï¼ˆç™»å½•æ—¶ä¸ä¼šå‡ºç°å¯†ç æç¤ºï¼Œç›´æ¥è¢«æœåŠ¡å™¨æ‹’ç»ï¼‰</td>
</tr>
<tr>
<td align="left">Userlist_enable=YES å¹¶ä¸”Userlist_deny=NO</td>
<td align="left">Ftpusersä¸­ç”¨æˆ·ç¦æ­¢è®¿é—®;User_listä¸­ç”¨æˆ·å…è®¸è®¿é—®</td>
</tr>
</tbody></table>
<p>ä¿®æ”¹é»˜è®¤ç«¯å£</p>
<p>é»˜è®¤FTPæœåŠ¡å™¨ç«¯å£å·æ˜¯21ï¼Œå‡ºäºå®‰å…¨ç›®çš„ï¼Œæœ‰æ—¶éœ€ä¿®æ”¹é»˜è®¤ç«¯å£å·ï¼Œä¿®æ”¹/etc/vsftpd/vsftpd.confï¼Œæ·»åŠ è¯­å¥(ä¾‹)ï¼š</p>
<p><code>listen_port=4449</code></p>
<p>è¯­å¥æŒ‡å®šäº†ä¿®æ”¹åFTPæœåŠ¡å™¨çš„ç«¯å£å·ï¼Œåº”å°½é‡å¤§äº4000ã€‚ä¿®æ”¹åè®¿é—®</p>
<p><code>#ftp 192.168.57.2 4449</code></p>
<p>æ³¨æ„è¿™é‡Œéœ€åŠ ä¸Šæ­£ç¡®çš„ç«¯å£å·äº†ï¼Œå¦åˆ™ä¸èƒ½æ­£å¸¸è¿æ¥ã€‚</p>
<p>è®¾ç½®ç”¨æˆ·ç»„</p>
<p>æœ‰å…³FTPç”¨æˆ·å’Œç”¨æˆ·ç»„çš„é‡è¦æ€§ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰ä»‹ç»vsftpdçš„æ—¶å€™ä¾¿å·²ç»æåˆ°è¿‡ã€‚è¿™é‡Œä¸»è¦æ˜¯ç®€å•çš„è¯´æ˜ç”¨æˆ·ç»„çš„æŠ€æœ¯å®ç°ï¼Œè‡³äºå…·ä½“å¦‚ä½•åº”ç”¨ï¼Œè¿˜æ˜¯å…·ä½“éœ€æ±‚å…·ä½“å¯¹å¾…ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /home/try  é€’å½’åˆ›å»ºæ–°ç›®å½•</span><br><span class="line">groupadd try        æ–°å»ºç»„</span><br><span class="line">useradd -g try -d /home/try try1 æ–°å»ºç”¨æˆ·try1å¹¶æŒ‡å®šå®¶ç›®å½•å’Œå±ç»„</span><br><span class="line">useradd -g try -d /home/try try2 æ–°å»ºç”¨æˆ·try2å¹¶æŒ‡å®šå®¶ç›®å½•å’Œå±ç»„</span><br><span class="line">useradd -g try -d /home/try try3 æ–°å»ºç”¨æˆ·try3å¹¶æŒ‡å®šå®¶ç›®å½•å’Œå±ç»„</span><br><span class="line">passwd try1  ä¸ºæ–°ç”¨æˆ·è®¾å¯†ç </span><br><span class="line">passwd try2  ä¸ºæ–°ç”¨æˆ·è®¾å¯†ç </span><br><span class="line">passwd try3  ä¸ºæ–°ç”¨æˆ·è®¾å¯†ç </span><br><span class="line">chown try1 /home/try è®¾ç½®ç›®å½•å±ä¸»ä¸ºç”¨æˆ·try1</span><br><span class="line">chown .try /home/try è®¾ç½®ç›®å½•å±ç»„ä¸ºç»„try</span><br><span class="line">chmod 750 /home/try  è®¾ç½®ç›®å½•è®¿é—®æƒé™try1ä¸ºè¯»ï¼Œå†™ï¼Œæ‰§è¡Œï¼›try2ï¼Œtry3ä¸ºè¯»ï¼Œæ‰§è¡Œ</span><br></pre></td></tr></table></figure>

<p>ç”±äºæœ¬åœ°ç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨åè¿›å…¥è‡ªå·±ä¸»ç›®å½•ï¼Œè€Œtry1,try2 try3å¯¹ä¸»ç›®å½•/home/tryåˆ†é…çš„æƒé™ä¸åŒï¼Œæ‰€ä»¥é€šè¿‡FTPè®¿é—®çš„æƒé™ä¹Ÿä¸åŒï¼Œtry1è®¿é—®æƒé™ä¸ºï¼šä¸Šä¼ ï¼Œä¸‹è½½ï¼Œå»ºç›®å½•ï¼›try2ï¼Œtry3è®¿é—®æƒé™ä¸ºä¸‹è½½ï¼Œæµè§ˆï¼Œä¸èƒ½å»ºç›®å½•å’Œä¸Šä¼ ã€‚å®ç°äº†ç¾¤ç»„ä¸­ç”¨æˆ·ä¸åŒè®¿é—®çº§åˆ«ï¼ŒåŠ å¼ºäº†å¯¹FTPæœåŠ¡å™¨çš„åˆ†çº§å®‰å…¨ç®¡ç†ã€‚</p>
<p>è¿æ¥è¶…æ—¶ï¼ˆæœ¬éƒ¨åˆ†å†…å®¹ç”±ææ´‹æä¾›ï¼‰</p>
<p>é…ç½®ç©ºé—²çš„ç”¨æˆ·ä¼šè¯çš„ä¸­æ–­æ—¶é—´ï¼šå¦‚ä¸‹é…ç½®å°†åœ¨ç”¨æˆ·ä¼šè¯ç©ºé—²5åˆ†é’Ÿåè¢«ä¸­æ–­ï¼Œä»¥é‡Šæ”¾æœåŠ¡å™¨çš„èµ„æº</p>
<p><code>Idle_session_timeout=300</code></p>
<p>é…ç½®ç©ºé—²çš„æ•°æ®è¿æ¥çš„ä¸­æ–­æ—¶é—´ï¼šå¦‚ä¸‹é…ç½®å°†åœ¨æ•°æ®ç©ºé—²è¿æ¥1åˆ†é’Ÿåè¢«ä¸­æ–­ï¼ŒåŒæ ·ä¹Ÿæ˜¯ä¸ºäº†é‡Šæ”¾æœåŠ¡å™¨çš„èµ„æº</p>
<p><code>Data_connection_timeout=60</code></p>
<p>é…ç½®å®¢æˆ·ç«¯ç©ºé—²æ—¶çš„è‡ªåŠ¨ä¸­æ–­å’Œæ¿€æ´»è¿æ¥çš„æ—¶é—´ï¼šå¦‚ä¸‹é…ç½®å°†ä½¿å®¢æˆ·ç«¯ç©ºé—²1åˆ†é’Ÿåè‡ªåŠ¨ä¸­æ–­è¿æ¥ï¼Œå¹¶åœ¨30ç§’åè‡ªåŠ¨æ¿€æ´»è¿æ¥</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Accept_timeout=60</span><br><span class="line">Connect_timeout=30</span><br></pre></td></tr></table></figure>

<h5 id="vsftpdçš„æ—¥å¿—"><a href="#vsftpdçš„æ—¥å¿—" class="headerlink" title="vsftpdçš„æ—¥å¿—"></a>vsftpdçš„æ—¥å¿—</h5><p>å¸¸è§çš„vsftpdæ—¥å¿—è§£å†³æ–¹æ¡ˆ</p>
<p>åœ¨vsftpd.confä¸­æœ‰å¦‚ä¸‹å†…å®¹å®šä¹‰äº†æ—¥å¿—çš„è®°å½•æ–¹å¼ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¡¨æ˜FTPæœåŠ¡å™¨è®°å½•ä¸Šä¼ ä¸‹è½½çš„æƒ…å†µ</span></span><br><span class="line">xferlog_enable=YES</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¡¨æ˜å°†è®°å½•çš„ä¸Šä¼ ä¸‹è½½æƒ…å†µå†™åœ¨xferlog_fileæ‰€æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œå³xferlog_fileé€‰é¡¹æŒ‡å®šçš„æ–‡ä»¶ä¸­</span></span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">xferlog_file=/var/log/xferlog</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ç”¨åŒä»½æ—¥å¿—ã€‚åœ¨ç”¨xferlogæ–‡ä»¶è®°å½•æœåŠ¡å™¨ä¸Šä¼ ä¸‹è½½æƒ…å†µçš„åŒæ—¶ï¼Œ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> vsftpd_log_fileæ‰€æŒ‡å®šçš„æ–‡ä»¶ï¼Œå³/var/<span class="built_in">log</span>/vsftpd.logä¹Ÿå°†ç”¨æ¥è®°å½•æœåŠ¡å™¨çš„ä¼ è¾“æƒ…å†µ</span></span><br><span class="line">dual_log_enable=YES</span><br><span class="line">vsftpd_log_file=/var/log/vsftpd.log</span><br></pre></td></tr></table></figure>

<p>vsftpdçš„ä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶åˆ†æå¦‚ä¸‹ï¼š</p>
<p>/var/log/xferlog</p>
<p>è®°å½•å†…å®¹ä¸¾ä¾‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Thu Sep 6 09:07:48 2007 7 192.168.57.1 4323279 /home/student/phpMyadmin-2.11.0-all-languages.tar.gz b -i r student ftp 0 * c</span><br></pre></td></tr></table></figure>

<p>/var/log/vsftpd.log</p>
<p>è®°å½•å†…å®¹ä¸¾ä¾‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Tue Sep 11 14:59:03 2007 [pid 3460]    CONNECT: Client "127.0.0.1"</span><br><span class="line">Tue Sep 11 14:59:24 2007 [pid 3459] [ftp] OK LOGIN;Client "127.0.0.1" ,anon password â€</span><br></pre></td></tr></table></figure>

<p>/var/log/xferlogæ—¥å¿—æ–‡ä»¶ä¸­æ•°æ®çš„åˆ†æå’Œå‚æ•°è¯´æ˜</p>
<p>|è®°å½•æ•°æ®|å‚æ•°åç§°|å‚æ•°è¯´æ˜|<br>|Thu Sep 6 09:07:48 2007|å½“å‰æ—¶é—´|å½“å‰æœåŠ¡å™¨æœ¬åœ°æ—¶é—´ï¼Œæ ¼å¼ä¸ºï¼š DDD MMM dd hh:mm:ss YYY|<br>|7|ä¼ è¾“æ—¶é—´|ä¼ é€æ–‡ä»¶æ‰€ç”¨æ—¶é—´ï¼Œå•ä½ä¸ºç§’|<br>|192.168.57.1|è¿œç¨‹ä¸»æœºåç§°/IP|è¿œç¨‹ä¸»æœºåç§°/IP|<br>|4323279|æ–‡ä»¶å¤§å°|ä¼ é€æ–‡ä»¶çš„å¤§å°ï¼Œå•ä½ä¸ºbyte|<br>|/home/student/phpMyadmin-2.11.0-all-languages.tar.gz|æ–‡ä»¶å|ä¼ è¾“æ–‡ä»¶åï¼ŒåŒ…æ‹¬è·¯å¾„|<br>|b|ä¼ è¾“ç±»å‹|ä¼ è¾“æ–¹å¼çš„ç±»å‹ï¼ŒåŒ…æ‹¬ä¸¤ç§ï¼šaä»¥ASCIIä¼ è¾“ bä»¥äºŒè¿›åˆ¶æ–‡ä»¶ä¼ è¾“|<br>|â€“|ç‰¹æ®Šå¤„ç†æ ‡å¿—|ç‰¹æ®Šå¤„ç†çš„æ ‡å¿—ä½ï¼Œå¯èƒ½çš„å€¼åŒ…æ‹¬ï¼š_ ä¸åšä»»ä½•ç‰¹æ®Šå¤„ç†ï¼›C æ–‡ä»¶æ˜¯å‹ç¼©æ ¼å¼ï¼›U æ–‡ä»¶æ˜¯éå‹ç¼©æ ¼å¼ï¼›T æ–‡ä»¶æ˜¯taræ ¼å¼|<br>|i|ä¼ è¾“æ–¹å‘|æ–‡ä»¶ä¼ è¾“æ–¹å‘ï¼ŒåŒ…æ‹¬ä¸¤ç§ï¼šo ä»FTPæœåŠ¡å™¨å‘å®¢æˆ·ç«¯ä¼ è¾“ï¼›i ä»å®¢æˆ·ç«¯å‘FTPæœåŠ¡å™¨ä¼ è¾“|<br>|r|è®¿é—®æ¨¡å¼|ç”¨æˆ·è®¿é—®æ¨¡å¼ï¼ŒåŒ…æ‹¬ï¼ša åŒ¿åç”¨æˆ·ï¼›g æ¥å®¾ç”¨æˆ·ï¼›r çœŸå®ç”¨æˆ·ï¼Œå³ç³»ç»Ÿä¸­çš„ç”¨æˆ·|<br>|student|ç”¨æˆ·å|ç”¨æˆ·åç§°|<br>|ftp|æœåŠ¡å|æ‰€ä½¿ç”¨çš„æœåŠ¡åç§°ï¼Œä¸€èˆ¬ä¸ºFTP|<br>|0|è®¤è¯æ–¹å¼|è®¤è¯æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼š0 æ— ï¼›1 RFC931è®¤è¯|<br>|<em>|è®¤è¯ç”¨æˆ·id|è®¤è¯ç”¨æˆ·çš„idï¼Œå¦‚æœä½¿ç”¨</em>ï¼Œåˆ™è¡¨ç¤ºæ— æ³•è·å¾—è¯¥id|<br>|c|å®ŒæˆçŠ¶æ€|ä¼ è¾“çš„çŠ¶æ€ï¼šc è¡¨ç¤ºä¼ è¾“å·²å®Œæˆï¼›i è¡¨ç¤ºä¼ è¾“ç¤ºå®Œæˆ|</p>
<h5 id="å¸¸è§çš„FTPå‘½ä»¤ï¼Œä»¥åŠFTPæ•°å­—ä»£ç çš„æ„ä¹‰"><a href="#å¸¸è§çš„FTPå‘½ä»¤ï¼Œä»¥åŠFTPæ•°å­—ä»£ç çš„æ„ä¹‰" class="headerlink" title="å¸¸è§çš„FTPå‘½ä»¤ï¼Œä»¥åŠFTPæ•°å­—ä»£ç çš„æ„ä¹‰"></a>å¸¸è§çš„FTPå‘½ä»¤ï¼Œä»¥åŠFTPæ•°å­—ä»£ç çš„æ„ä¹‰</h5><p>å‘½ä»¤æ ¼å¼å¦‚ä¸‹æ˜¾ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FTPå‘½ä»¤</span><br><span class="line">  	åŠŸèƒ½</span><br><span class="line">  	FTPå‘½ä»¤</span><br><span class="line">  	åŠŸèƒ½</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls</span><br><span class="line">	æ˜¾ç¤ºæœåŠ¡å™¨ä¸Šçš„ç›®å½•</span><br><span class="line">  	ls [remote-dir][local-file]</span><br><span class="line">  	æ˜¾ç¤ºè¿œç¨‹ç›®å½•remote-dirï¼Œå¹¶å­˜å…¥æœ¬åœ°æ–‡ä»¶local-file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">get remote-file [local-file]</span><br><span class="line">	ä»æœåŠ¡å™¨ä¸‹è½½æŒ‡å®šæ–‡ä»¶åˆ°å®¢æˆ·ç«¯</span><br><span class="line">  	mget remote-files</span><br><span class="line">  	ä¸‹è½½å¤šä¸ªè¿œç¨‹æ–‡ä»¶(mgetå‘½ä»¤å…è®¸ç”¨é€šé…ç¬¦ä¸‹è½½å¤šä¸ªæ–‡ä»¶)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">put local-file [remote-file]</span><br><span class="line">	ä»å®¢æˆ·ç«¯ä¸Šä¼ æŒ‡å®šæ–‡ä»¶åˆ°æœåŠ¡å™¨</span><br><span class="line">  	mput local-file</span><br><span class="line">  	å°†å¤šä¸ªæ–‡ä»¶ä¸Šä¼ è‡³è¿œç¨‹ä¸»æœº(mputå‘½ä»¤å…è®¸ç”¨é€šé…ç¬¦ä¸Šä¼ å¤šä¸ªæ–‡ä»¶)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">open</span><br><span class="line">	è¿æ¥FTPæœåŠ¡å™¨</span><br><span class="line">  	mdelete [remote-file]</span><br><span class="line">  	åˆ é™¤è¿œç¨‹ä¸»æœºæ–‡ä»¶</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">close</span><br><span class="line">	ä¸­æ–­ä¸è¿œç¨‹æœåŠ¡å™¨çš„ftpä¼šè¯ï¼ˆä¸openå¯¹åº”ï¼‰</span><br><span class="line">  	mkdir dir-name</span><br><span class="line">  	åœ¨è¿œç¨‹ä¸»æœºä¸­åˆ›å»ºç›®å½•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">open host[port]</span><br><span class="line">	å»ºç«‹æŒ‡å®šçš„ftpæœåŠ¡å™¨è¿æ¥ï¼Œå¯æŒ‡å®šè¿æ¥ç«¯å£</span><br><span class="line">  	newer file-name</span><br><span class="line">  	å¦‚æœè¿œç¨‹ä¸»æœºä¸­file-nameçš„ä¿®æ”¹æ—¶é—´æ¯”æœ¬åœ°ç¡¬ç›˜åŒåæ–‡ä»¶çš„æ—¶é—´æ›´è¿‘ï¼Œåˆ™é‡ä¼ è¯¥æ–‡ä»¶</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd directory</span><br><span class="line">	æ”¹å˜æœåŠ¡å™¨çš„å·¥ä½œç›®å½•</span><br><span class="line">  	rename [from][to]</span><br><span class="line">  	æ›´æ”¹è¿œç¨‹ä¸»æœºçš„æ–‡ä»¶å</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lcd directory</span><br><span class="line">	åœ¨å®¢æˆ·ç«¯ä¸Š(æœ¬åœ°)æ”¹å˜å·¥ä½œç›®å½•</span><br><span class="line">  	pwd</span><br><span class="line">  	æ˜¾ç¤ºè¿œç¨‹ä¸»æœºçš„å½“å‰å·¥ä½œç›®å½•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bye</span><br><span class="line">	é€€å‡ºFTPå‘½ä»¤çŠ¶æ€</span><br><span class="line">  	quit</span><br><span class="line">  	åŒbye,é€€å‡ºftpä¼šè¯</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ascii</span><br><span class="line">	è®¾ç½®æ–‡ä»¶ä¼ è¾“æ–¹å¼ä¸ºASCIIæ¨¡å¼</span><br><span class="line">  	reget remote-file [local-file]</span><br><span class="line">  	ç±»ä¼¼äºget,ä½†è‹¥local-fileå­˜åœ¨ï¼Œåˆ™ä»ä¸Šæ¬¡ä¼ è¾“ä¸­æ–­å¤„ç»­ä¼ </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">binary</span><br><span class="line">	è®¾ç½®æ–‡ä»¶ä¼ è¾“æ–¹å¼ä¸ºäºŒè¿›åˆ¶æ¨¡å¼</span><br><span class="line">  	rhelp [cmd-name]</span><br><span class="line">  	è¯·æ±‚è·å¾—è¿œç¨‹ä¸»æœºçš„å¸®åŠ©</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![cmd [args]]</span><br><span class="line">	åœ¨æœ¬åœ°ä¸»æœºä¸­äº¤äº’shellåé€€å›åˆ°ftpç¯å¢ƒï¼Œå¦‚:!ls *.zip</span><br><span class="line">  	rstatus [file-name]</span><br><span class="line">  	è‹¥æœªæŒ‡å®šæ–‡ä»¶åï¼Œåˆ™æ˜¾ç¤ºè¿œç¨‹ä¸»æœºçš„çŠ¶æ€ï¼Œå¦åˆ™æ˜¾ç¤ºæ–‡ä»¶çŠ¶æ€</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">accout [password]</span><br><span class="line">	æä¾›ç™»å½•è¿œç¨‹ç³»ç»ŸæˆåŠŸåè®¿é—®ç³»ç»Ÿèµ„æºæ‰€éœ€çš„å¯†ç </span><br><span class="line">  	hash</span><br><span class="line">  	æ¯ä¼ è¾“1024å­—èŠ‚ï¼Œæ˜¾ç¤ºä¸€ä¸ªhashç¬¦å·ï¼ˆ#ï¼‰</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">append local-file [remote-file]</span><br><span class="line">	å°†æœ¬åœ°æ–‡ä»¶è¿½åŠ åˆ°è¿œç¨‹ç³»ç»Ÿä¸»æœºï¼Œè‹¥æœªæŒ‡å®šè¿œç¨‹ç³»ç»Ÿæ–‡ä»¶åï¼Œåˆ™ä½¿ç”¨æœ¬åœ°æ–‡ä»¶å</span><br><span class="line">  	restart marker</span><br><span class="line">  	ä»æŒ‡å®šçš„æ ‡å¿—markerå¤„ï¼Œé‡æ–°å¼€å§‹getæˆ–putï¼Œå¦‚restart 130</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bye</span><br><span class="line">	é€€å‡ºftpä¼šè¯è¿‡ç¨‹</span><br><span class="line">  	rmdir dir-name</span><br><span class="line">  	åˆ é™¤è¿œç¨‹ä¸»æœºç›®å½•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">case</span><br><span class="line">	åœ¨ä½¿ç”¨mgetå‘½ä»¤æ—¶ï¼Œå°†è¿œç¨‹ä¸»æœºæ–‡ä»¶åä¸­çš„å¤§å†™è½¬ä¸ºå°å†™å­—æ¯</span><br><span class="line">  	size file-name</span><br><span class="line">  	æ˜¾ç¤ºè¿œç¨‹ä¸»æœºæ–‡ä»¶å¤§å°ï¼Œå¦‚ï¼š</span><br><span class="line">size idle 7200</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd remote-dir</span><br><span class="line">	è¿›å…¥è¿œç¨‹ä¸»æœºç›®å½•</span><br><span class="line">  	status</span><br><span class="line">  	æ˜¾ç¤ºå½“å‰ftpçŠ¶æ€</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cdup</span><br><span class="line">	è¿›å…¥è¿œç¨‹ä¸»æœºç›®å½•çš„çˆ¶ç›®å½•</span><br><span class="line">  	system</span><br><span class="line">  	æ˜¾ç¤ºè¿œç¨‹ä¸»æœºçš„æ“ä½œç³»ç»Ÿ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">delete remote-file</span><br><span class="line">	åˆ é™¤è¿œç¨‹ä¸»æœºæ–‡ä»¶</span><br><span class="line">  	user user-name [password][account]</span><br><span class="line">  	å‘è¿œç¨‹ä¸»æœºè¡¨æ˜è‡ªå·±çš„èº«ä»½ï¼Œéœ€è¦å¯†ç æ—¶ï¼Œå¿…é¡»è¾“å…¥å¯†ç ï¼Œå¦‚:user anonymous my@email</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dir [remote-dir][local-file]</span><br><span class="line">	æ˜¾ç¤ºè¿œç¨‹ä¸»æœºç›®å½•ï¼Œå¹¶å°†ç»“æœå­˜å…¥æœ¬åœ°æ–‡ä»¶</span><br><span class="line">  	help [cmd]</span><br><span class="line">  	æ˜¾ç¤ºftpå†…éƒ¨å‘½ä»¤cmdçš„å¸®åŠ©ä¿¡æ¯ï¼Œå¦‚help get</span><br></pre></td></tr></table></figure>

<p><strong>FTPæ•°å­—ä»£ç çš„æ„ä¹‰</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">110 é‡æ–°å¯åŠ¨æ ‡è®°åº”ç­”ã€‚</span><br><span class="line">120 æœåŠ¡åœ¨å¤šä¹…æ—¶é—´å†…readyã€‚</span><br><span class="line">125 æ•°æ®é“¾è·¯ç«¯å£å¼€å¯ï¼Œå‡†å¤‡ä¼ é€ã€‚</span><br><span class="line">150 æ–‡ä»¶çŠ¶æ€æ­£å¸¸ï¼Œå¼€å¯æ•°æ®è¿æ¥ç«¯å£ã€‚</span><br><span class="line">200 å‘½ä»¤æ‰§è¡ŒæˆåŠŸã€‚</span><br><span class="line">202 å‘½ä»¤æ‰§è¡Œå¤±è´¥ã€‚</span><br><span class="line">211 ç³»ç»ŸçŠ¶æ€æˆ–æ˜¯ç³»ç»Ÿæ±‚åŠ©å“åº”ã€‚</span><br><span class="line">212 ç›®å½•çš„çŠ¶æ€ã€‚</span><br><span class="line">213 æ–‡ä»¶çš„çŠ¶æ€ã€‚</span><br><span class="line">214 æ±‚åŠ©çš„è®¯æ¯ã€‚</span><br><span class="line">215 åç§°ç³»ç»Ÿç±»å‹ã€‚</span><br><span class="line">220 æ–°çš„è”æœºæœåŠ¡readyã€‚</span><br><span class="line">221 æœåŠ¡çš„æ§åˆ¶è¿æ¥ç«¯å£å…³é—­ï¼Œå¯ä»¥æ³¨é”€ã€‚</span><br><span class="line">225 æ•°æ®è¿ç»“å¼€å¯ï¼Œä½†æ— ä¼ è¾“åŠ¨ä½œã€‚</span><br><span class="line">226 å…³é—­æ•°æ®è¿æ¥ç«¯å£ï¼Œè¯·æ±‚çš„æ–‡ä»¶æ“ä½œæˆåŠŸã€‚</span><br><span class="line">227 è¿›å…¥passive modeã€‚</span><br><span class="line">230 ä½¿ç”¨è€…ç™»å…¥ã€‚</span><br><span class="line">250 è¯·æ±‚çš„æ–‡ä»¶æ“ä½œå®Œæˆã€‚</span><br><span class="line">257 æ˜¾ç¤ºç›®å‰çš„è·¯å¾„åç§°ã€‚</span><br><span class="line">331 ç”¨æˆ·åç§°æ­£ç¡®ï¼Œéœ€è¦å¯†ç ã€‚</span><br><span class="line">332 ç™»å…¥æ—¶éœ€è¦è´¦å·ä¿¡æ¯ã€‚</span><br><span class="line">350 è¯·æ±‚çš„æ“ä½œéœ€è¦è¿›ä¸€éƒ¨çš„å‘½ä»¤ã€‚</span><br><span class="line">421 æ— æ³•æä¾›æœåŠ¡ï¼Œå…³é—­æ§åˆ¶è¿ç»“ã€‚</span><br><span class="line">425 æ— æ³•å¼€å¯æ•°æ®é“¾è·¯ã€‚</span><br><span class="line">426 å…³é—­è”æœºï¼Œç»ˆæ­¢ä¼ è¾“ã€‚</span><br><span class="line">450 è¯·æ±‚çš„æ“ä½œæœªæ‰§è¡Œã€‚</span><br><span class="line">451 å‘½ä»¤ç»ˆæ­¢:æœ‰æœ¬åœ°çš„é”™è¯¯ã€‚</span><br><span class="line">452 æœªæ‰§è¡Œå‘½ä»¤:ç£ç›˜ç©ºé—´ä¸è¶³ã€‚</span><br><span class="line">500 æ ¼å¼é”™è¯¯ï¼Œæ— æ³•è¯†åˆ«å‘½ä»¤ã€‚</span><br><span class="line">501 å‚æ•°è¯­æ³•é”™è¯¯ã€‚</span><br><span class="line">502 å‘½ä»¤æ‰§è¡Œå¤±è´¥ã€‚</span><br><span class="line">503 å‘½ä»¤é¡ºåºé”™è¯¯ã€‚</span><br><span class="line">504 å‘½ä»¤æ‰€æ¥çš„å‚æ•°ä¸æ­£ç¡®ã€‚</span><br><span class="line">530 æœªç™»å…¥ã€‚</span><br><span class="line">532 å‚¨å­˜æ–‡ä»¶éœ€è¦è´¦æˆ·ç™»å…¥ã€‚</span><br><span class="line">550 æœªæ‰§è¡Œè¯·æ±‚çš„æ“ä½œã€‚</span><br><span class="line">551 è¯·æ±‚çš„å‘½ä»¤ç»ˆæ­¢ï¼Œç±»å‹æœªçŸ¥ã€‚</span><br><span class="line">552 è¯·æ±‚çš„æ–‡ä»¶ç»ˆæ­¢ï¼Œå‚¨å­˜ä½æº¢å‡ºã€‚  </span><br><span class="line">553 æœªæ‰§è¡Œè¯·æ±‚çš„çš„å‘½ä»¤ï¼Œåç§°ä¸æ­£ç¡®ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="é¡¹ç›®å®è·µ"><a href="#é¡¹ç›®å®è·µ" class="headerlink" title="é¡¹ç›®å®è·µ"></a>é¡¹ç›®å®è·µ</h3><ol>
<li>è®¾ç½®vsftpdæœåŠ¡åŒ¿åç”¨æˆ·èƒ½å¤Ÿå¯¹/var/ftp/test/ç›®å½•æœ‰ä¸Šä¼ ä¸‹è½½çš„æƒé™ã€‚</li>
<li>ç³»ç»Ÿç”¨æˆ·èƒ½å¤Ÿè®¿é—®å®¶ç›®å½•ï¼Œä¸Šä¼ ä¸‹è½½åˆ é™¤</li>
<li>é™¤äº†ç³»ç»Ÿç”¨æˆ·batmanæœ‰chrootçš„æƒé™ï¼Œå…¶ä»–ç³»ç»Ÿç”¨æˆ·æ²¡æœ‰chrootçš„æƒé™</li>
</ol>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><img src="pic/05.png" alt="05"></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxåŸºç¡€æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>SAMBAæ–‡ä»¶å…±äº«æœåŠ¡</title>
    <url>/2016/12/23/booboo_easy_service/04_samba/</url>
    <content><![CDATA[<h3 id="Sambaçš„å†å²åŠåŸç†"><a href="#Sambaçš„å†å²åŠåŸç†" class="headerlink" title="Sambaçš„å†å²åŠåŸç†"></a>Sambaçš„å†å²åŠåŸç†</h3><p>åœ¨æ—©æœŸçš„ç½‘ç»œä¸–ç•Œä¸­ï¼Œæ–‡ä»¶æ•°æ®åœ¨ä¸åŒä¸»æœºä¹‹é—´çš„ä¼ è¾“å¤§å¤šæ˜¯ä½¿ç”¨FTPè¿™ä¸ªå¥½ç”¨çš„æœåŠ¡å™¨è½¯ä»¶è¿›è¡Œçš„ã€‚ä¸è¿‡ï¼Œä½¿ç”¨FTPä¼ è¾“æ–‡ä»¶å´æœ‰ä¸ªå°å°çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯æ‚¨æ— æ³•ç›´æ¥ä¿®æ”¹ä¸»æœºä¸Šé¢çš„æ–‡ä»¶æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨æƒ³è¦æ›´æ”¹Linuxä¸»æœºä¸Šé¢çš„æŸä¸ªæ–‡ä»¶æ—¶ï¼Œå¿…é¡»è¦ç”±æœåŠ¡å™¨ç«¯å°†è¯¥æ–‡ä»¶ä¸‹è½½åˆ°æ‚¨å·¥ä½œçš„å®¢æˆ·ç«¯åæ‰èƒ½ä¿®æ”¹ï¼Œå› æ­¤è¯¥æ–‡ä»¶åœ¨æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯éƒ½ä¼šå­˜åœ¨ã€‚è¿™æ—¶ï¼Œå¦‚æœæœ‰ä¸€å¤©æ‚¨ä¿®æ”¹äº†æŸä¸ªæ–‡ä»¶ï¼Œå´å¿˜è®°å°†æ•°æ®ä¸Šä¼ å›ä¸»æœºï¼Œé‚£ä¹ˆç­‰è¿‡äº†ä¸€é˜µå­ä¹‹åï¼Œæ‚¨å¦‚ä½•çŸ¥é“å“ªæ—¢ç„¶æœ‰è¿™æ ·çš„é—®é¢˜ï¼Œé‚£å¥½å§ï¼Œæˆ‘å¯ä¸å¯ä»¥åœ¨å®¢æˆ·ç«¯çš„æœºå™¨ä¸Šé¢ç›´æ¥å–ç”¨æœåŠ¡å™¨ä¸Šé¢çš„æ–‡ä»¶ï¼Ÿå¦‚æœå¯ä»¥åœ¨å®¢æˆ·ç«¯ç›´æ¥è¿›è¡ŒæœåŠ¡å™¨ç«¯æ–‡ä»¶çš„è®¿é—®ï¼Œé‚£ä¹ˆæˆ‘åœ¨å®¢æˆ·ç«¯å°±ä¸éœ€è¦å­˜åœ¨è¯¥æ–‡ä»¶æ•°æ®äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘åªè¦æœ‰æœåŠ¡å™¨ä¸Šé¢çš„æ–‡ä»¶æ•°æ®å­˜åœ¨å°±å¯ä»¥äº†ã€‚æœ‰æ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆFile Systemï¼‰å‘¢ï¼Ÿå‰é¢æˆ‘ä»¬æåˆ°è¿‡çš„Network File Systemï¼ˆNFSï¼‰å°±æ˜¯è¿™æ ·çš„æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸€ã€‚åªè¦åœ¨å®¢æˆ·ç«¯å°†æœåŠ¡å™¨ç«¯æ‰€æä¾›çš„å…±äº«ç›®å½•æŒ‚è½½è¿›æ¥ï¼Œé‚£ä¹ˆåœ¨æˆ‘çš„å®¢æˆ·ç«¯å°±å¯ä»¥ç›´æ¥å–ç”¨æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶æ•°æ®ï¼Œè€Œä¸”ï¼Œè¯¥æ•°æ®å°±åƒæ˜¯å®¢æˆ·ç«¯ä¸Šçš„åˆ†åŒºä¸€æ ·ï¼Œéå¸¸å¥½ç”¨ï¼è€Œé™¤äº†å¯ä»¥è®©Unix Likeçš„æœºå™¨äº’ç›¸åˆ†äº«æ–‡ä»¶çš„NFSæœåŠ¡å™¨ä¹‹å¤–ï¼Œåœ¨å¾®è½¯ï¼ˆMicrosoftï¼‰ä¸Šé¢ä¹Ÿæœ‰ç±»ä¼¼çš„æ–‡ä»¶ç³»ç»Ÿï¼Œé‚£å°±æ˜¯Common Internet File Systemï¼ˆCIFSï¼‰ã€‚CIFSæœ€ç®€å•çš„ç”¨é€”å°±æ˜¯ç›®å‰å¸¸è§çš„â€œç½‘ä¸Šé‚»å±…â€ã€‚Windowsç³»ç»Ÿçš„è®¡ç®—æœºå¯ä»¥é€šè¿‡æ¡Œé¢ä¸Šçš„â€œç½‘ä¸Šé‚»å±…â€æ¥è®¿é—®åˆ«äººæ‰€æä¾›çš„æ–‡ä»¶æ•°æ®ã€‚ä¸è¿‡ï¼ŒNFSä»…èƒ½è®©Unixæœºå™¨æ²Ÿé€šï¼ŒCIFSåªèƒ½è®©Windowsæœºå™¨æ²Ÿé€šã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰è®©Windowsä¸Unix Likeè¿™ä¸¤ä¸ªä¸åŒçš„å¹³å°ç›¸äº’åˆ†äº«æ–‡ä»¶æ•°æ®çš„æ–‡ä»¶ç³»ç»Ÿå‘¢ï¼Ÿä¸ªæ–‡ä»¶æ‰æ˜¯æœ€æ–°çš„ï¼Ÿ</p>
<p>åœ¨1991å¹´ï¼Œä¸€ä¸ªåå«Andrew Tridgwellçš„å¤§å­¦ç”Ÿå°±æœ‰è¿™æ ·çš„å›°æ‰°ï¼Œä»–æ‰‹ä¸Šæœ‰ä¸‰å°æœºå™¨ï¼Œåˆ†åˆ«æ˜¯è¿è¡ŒDOSçš„ä¸ªäººè®¡ç®—æœºã€DECå…¬å¸çš„Digital Unixç³»ç»Ÿä»¥åŠSunçš„Unixç³»ç»Ÿã€‚åœ¨å½“æ—¶ï¼ŒDEC å…¬å¸å¼€å‘å‡ºä¸€å¥—ç§°ä¸ºPATHWORKSçš„è½¯ä»¶ï¼Œè¿™å¥—è½¯ä»¶å¯ä»¥ç”¨æ¥åˆ†äº«DECçš„Unixä¸ä¸ªäººè®¡ç®—æœºçš„DOSè¿™ä¸¤ä¸ªæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æ•°æ®ï¼Œå¯æƒœè®©Tridgwellè§‰å¾—è¾ƒå›°æ‰°çš„æ˜¯Sunçš„Unixæ— æ³•é€šè¿‡è¿™ä¸ªè½¯ä»¶æ¥è¾¾åˆ°æ–‡ä»¶å…±äº«çš„ç›®çš„ã€‚è¿™ä¸ªæ—¶å€™Tridgwellå°±æƒ³ï¼šâ€œå’¦ï¼æ—¢ç„¶è¿™ä¸¤å°ç³»ç»Ÿå¯ä»¥å…±äº«ï¼Œæ²¡é“ç†Sunå°±å¿…é¡»è¿™ä¹ˆè‹¦å‘½å§ï¼Ÿå¯ä¸å¯ä»¥å°†è¿™ä¸¤ä¸ªç³»ç»Ÿçš„å·¥ä½œåŸç†æ‰¾å‡ºæ¥ï¼Œç„¶åè®©Sunæœºå™¨ä¹Ÿèƒ½å¤Ÿå…±äº«æ–‡ä»¶æ•°æ®å‘¢ï¼Ÿâ€ï¼Œä¸ºäº†è§£å†³è¿™æ ·çš„çš„é—®é¢˜ï¼ŒTridgwellå°±è‡ªè¡Œç¼–å†™äº†ä¸€ä¸ªç¨‹åºå»æ£€æµ‹å½“DOSä¸DECçš„Unixç³»ç»Ÿåœ¨è¿›è¡Œæ–‡ä»¶åˆ†äº«ä¼ è¾“æ—¶æ‰€ä½¿ç”¨åˆ°çš„é€šä¿¡åè®®ä¿¡æ¯ï¼Œç„¶åè·å–è¿™äº›é‡è¦çš„ä¿¡æ¯ï¼Œå¹¶ä¸”åŸºäºä¸Šè¿°æ‰€æ‰¾åˆ°çš„é€šä¿¡åè®®è€Œå¼€å‘å‡ºServer Message Blockï¼ˆSMBï¼‰è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè€Œå°±æ˜¯è¿™å¥—SMBè½¯ä»¶å°±èƒ½å¤Ÿè®©Unixä¸DOSäº’ç›¸å…±äº«æ–‡ä»¶ã€‚</p>
<p>æ—¢ç„¶å†™æˆäº†è½¯ä»¶ï¼Œæ€»éœ€è¦æ³¨å†Œå•†æ ‡ï¼Œå› æ­¤Tridgwellå°±ç”³è¯·SMB Serverä½œä¸ºè¯¥è½¯ä»¶çš„å•†æ ‡ã€‚å¯æƒœå› ä¸ºSMBæ˜¯æ²¡æœ‰æ„ä¹‰çš„æ–‡å­—ï¼Œæ²¡æœ‰åŠæ³•è¾¾æˆæ³¨å†Œã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œèƒ½ä¸èƒ½åœ¨å­—å…¸é‡Œé¢æ‰¾åˆ°ç›¸å…³çš„å­—è¯å¯ä»¥ä½œä¸ºå•†æ ‡æ¥æ³¨å†Œå‘¢ï¼Ÿç¿»äº†è€åŠå¤©ï¼Œå‘ç°SAMBAåˆšå¥½å«æœ‰SMBï¼Œåˆæ˜¯çƒ­æƒ…æœ‰åŠ²çš„æ‹‰ä¸èˆè¹ˆçš„åç§°ï¼Œä¸ç„¶å°±ç”¨è¿™ä¸ªåå­—æ¥ä½œä¸ºå•†æ ‡å¥½äº†ã€‚è¿™æˆä¸ºæˆ‘ä»¬ä»Šå¤©æ‰€ä½¿ç”¨çš„SAMBAçš„åç§°çš„ç”±æ¥ã€‚</p>
<h3 id="Sambaçš„ä½œç”¨"><a href="#Sambaçš„ä½œç”¨" class="headerlink" title="Sambaçš„ä½œç”¨"></a>Sambaçš„ä½œç”¨</h3><p>ä½œç”¨ï¼šwindowså’Œç±»unixç³»ç»Ÿæ–‡ä»¶å…±äº«æœåŠ¡</p>
<h3 id="Sambaçš„è½¯ä»¶ç»“æ„"><a href="#Sambaçš„è½¯ä»¶ç»“æ„" class="headerlink" title="Sambaçš„è½¯ä»¶ç»“æ„"></a>Sambaçš„è½¯ä»¶ç»“æ„</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡ç«¯linux</span></span><br><span class="line"></span><br><span class="line">è½¯ä»¶		samba samba-common</span><br><span class="line">service		nmb	smb</span><br><span class="line">daemon		nmbd	smbd</span><br><span class="line">ç«¯å£		137 138|139 445</span><br><span class="line">é…ç½®æ–‡ä»¶		/etc/samba/smb.conf</span><br><span class="line">æ•°æ®æ–‡ä»¶		/var/lib/samba</span><br><span class="line">æ—¥å¿—æ–‡ä»¶		/var/log/samba</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯linux</span></span><br><span class="line">è½¯ä»¶		samba-client</span><br><span class="line">å‘½ä»¤		smbclient</span><br><span class="line">		smbclient -L ip -U username</span><br><span class="line">		smbpasswd -a username</span><br><span class="line">		smbpasswd username</span><br><span class="line">		smbclient //172.25.0.11/å…±äº«å</span><br><span class="line">		smbclient //172.25.0.11/å…±äº«å -U student</span><br><span class="line">		mount -t cifs //172.25.15.11/å…±äº«å /mnt -o guest</span><br><span class="line">		mount -t cifs //172.25.15.11/å…±äº«å /mnt -o username=student</span><br></pre></td></tr></table></figure>
<h3 id="é¡¹ç›®å®è·µ1ï¼šé…ç½®sambaå…±äº«"><a href="#é¡¹ç›®å®è·µ1ï¼šé…ç½®sambaå…±äº«" class="headerlink" title="é¡¹ç›®å®è·µ1ï¼šé…ç½®sambaå…±äº«"></a>é¡¹ç›®å®è·µ1ï¼šé…ç½®sambaå…±äº«</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ç³»ç»Ÿç”¨æˆ·</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line">æœåŠ¡å™¨ç«¯rhel6</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line">[root@rhel6 ~]# yum install -y samba samba-common</span><br><span class="line">[root@rhel6 ~]# service iptables stop</span><br><span class="line">iptables: Setting chains to policy ACCEPT: filter          [  OK  ]</span><br><span class="line">iptables: Flushing firewall rules:                         [  OK  ]</span><br><span class="line">iptables: Unloading modules:                               [  OK  ]</span><br><span class="line">[root@rhel6 ~]#</span><br><span class="line">[root@rhel6 ~]# service smb start</span><br><span class="line">Starting SMB services:                                     [  OK  ]</span><br><span class="line">[root@rhel6 ~]# service nmb start</span><br><span class="line">Starting NMB services:                                     [  OK  ]</span><br><span class="line">[root@rhel6 ~]# id student</span><br><span class="line">uid=500(student) gid=500(student) groups=500(student)</span><br><span class="line">[root@rhel6 ~]# which smbpasswd</span><br><span class="line">/usr/bin/smbpasswd</span><br><span class="line">[root@rhel6 ~]# smbpasswd -a student</span><br><span class="line">New SMB password:</span><br><span class="line">Retype new SMB password:</span><br><span class="line">Added user student.</span><br><span class="line">[root@rhel6 ~]# getsebool -a|grep samba</span><br><span class="line">samba_create_home_dirs --&gt; off</span><br><span class="line">samba_domain_controller --&gt; off</span><br><span class="line">samba_enable_home_dirs --&gt; off</span><br><span class="line">samba_export_all_ro --&gt; off</span><br><span class="line">samba_export_all_rw --&gt; off</span><br><span class="line">samba_portmapper --&gt; off</span><br><span class="line">samba_run_unconfined --&gt; off</span><br><span class="line">samba_share_fusefs --&gt; off</span><br><span class="line">samba_share_nfs --&gt; off</span><br><span class="line">sanlock_use_samba --&gt; off</span><br><span class="line">use_samba_home_dirs --&gt; off</span><br><span class="line">virt_use_samba --&gt; off</span><br><span class="line">[root@rhel6 ~]# setsebool -P samba_enable_home_dirs 1</span><br><span class="line">[root@rhel6 ~]# getsebool -a|grep samba</span><br><span class="line">samba_create_home_dirs --&gt; off</span><br><span class="line">samba_domain_controller --&gt; off</span><br><span class="line">samba_enable_home_dirs --&gt; on</span><br><span class="line">samba_export_all_ro --&gt; off</span><br><span class="line">samba_export_all_rw --&gt; off</span><br><span class="line">samba_portmapper --&gt; off</span><br><span class="line">samba_run_unconfined --&gt; off</span><br><span class="line">samba_share_fusefs --&gt; off</span><br><span class="line">samba_share_nfs --&gt; off</span><br><span class="line">sanlock_use_samba --&gt; off</span><br><span class="line">use_samba_home_dirs --&gt; off</span><br><span class="line">virt_use_samba --&gt; off</span><br><span class="line">-----------------------------------</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯linuxâ€”â€”ç±»ä¼¼ftpçš„æ–¹å¼è®¿é—®</span></span><br><span class="line">[root@rhel7 ~]# systemctl stop firewalld</span><br><span class="line">[root@rhel7 ~]# yum install -y samba-client</span><br><span class="line">[root@rhel7 ~]# smbclient -L 172.25.0.11</span><br><span class="line">Enter root\'s password:</span><br><span class="line">Anonymous login successful</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line"></span><br><span class="line">	Sharename       Type      Comment</span><br><span class="line">	---------       ----      -------</span><br><span class="line"><span class="meta">	IPC$</span><span class="bash">            IPC       IPC Service (Samba Server Version 3.6.9-164.el6)</span></span><br><span class="line">Anonymous login successful</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line"></span><br><span class="line">	Server               Comment</span><br><span class="line">	---------            -------</span><br><span class="line">	RHEL6                Samba Server Version 3.6.9-164.el6</span><br><span class="line"></span><br><span class="line">	Workgroup            Master</span><br><span class="line">	---------            -------</span><br><span class="line">	MYGROUP              RHEL6</span><br><span class="line">[root@rhel7 ~]# smbclient -L 172.25.0.11 -U student</span><br><span class="line">Enter student\'s password:</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line"></span><br><span class="line">	Sharename       Type      Comment</span><br><span class="line">	---------       ----      -------</span><br><span class="line"><span class="meta">	IPC$</span><span class="bash">            IPC       IPC Service (Samba Server Version 3.6.9-164.el6)</span></span><br><span class="line">	student         Disk      Home Directories</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line"></span><br><span class="line">	Server               Comment</span><br><span class="line">	---------            -------</span><br><span class="line">	RHEL6                Samba Server Version 3.6.9-164.el6</span><br><span class="line"></span><br><span class="line">	Workgroup            Master</span><br><span class="line">	---------            -------</span><br><span class="line">	MYGROUP              RHEL6</span><br><span class="line">[root@rhel7 ~]# smbclient //172.25.0.11/student -U student</span><br><span class="line">Enter student\'s password:</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line">smb: \&gt;</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">NT_STATUS_ACCESS_DENIED listing \*</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        0  Thu Jul  2 04:01:16 2015</span><br><span class="line">  ..                                  D        0  Thu Jul  2 03:57:29 2015</span><br><span class="line">  .ssh                               DH        0  Thu Jul  2 04:01:07 2015</span><br><span class="line">  .bashrc                             H      124  Tue Jul  9 09:24:50 2013</span><br><span class="line">  .bash_logout                        H       18  Tue Jul  9 09:24:50 2013</span><br><span class="line">  .mozilla                           DH        0  Thu Jul  2 03:36:20 2015</span><br><span class="line">  .bash_history                       H        5  Thu Jul  2 04:01:16 2015</span><br><span class="line">  .gnome2                            DH        0  Wed Jul 14 11:55:40 2010</span><br><span class="line">  .bash_profile                       H      176  Tue Jul  9 09:24:50 2013</span><br><span class="line"></span><br><span class="line">		49584 blocks of size 8192. 45708 blocks available</span><br><span class="line">smb: \&gt; exit</span><br><span class="line">-------------------------------------------------------------</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯windows</span></span><br><span class="line">æ‰“å¼€æµè§ˆå™¨è¾“å…¥\\172.25.0.11\</span><br><span class="line">è¾“å…¥studentå’Œuplookingå¯†ç åå°±å¯ä»¥è¿›å…¥æœåŠ¡å™¨ä¸­çš„ç”¨æˆ·å®¶ç›®å½•ï¼Œåˆ›å»ºç›®å½•aaï¼Œä»¥åŠæ–‡ä»¶aaä¸‹çš„dd.txt</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯linux</span></span><br><span class="line">[root@rhel7 ~]# smbclient //172.25.0.11/student -U student</span><br><span class="line">Enter student\'s password:</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        0  Thu Aug  4 04:30:31 2016</span><br><span class="line">  ..                                  D        0  Thu Jul  2 03:57:30 2015</span><br><span class="line">  .ssh                               DH        0  Thu Jul  2 04:01:07 2015</span><br><span class="line">  aa                                  D        0  Thu Aug  4 04:30:28 2016</span><br><span class="line">  .bashrc                             H      124  Tue Jul  9 09:24:50 2013</span><br><span class="line">  .bash_logout                        H       18  Tue Jul  9 09:24:50 2013</span><br><span class="line">  .mozilla                           DH        0  Thu Jul  2 03:36:20 2015</span><br><span class="line">  .bash_history                       H        5  Thu Jul  2 04:01:16 2015</span><br><span class="line">  .gnome2                            DH        0  Wed Jul 14 11:55:40 2010</span><br><span class="line">  .bash_profile                       H      176  Tue Jul  9 09:24:50 2013</span><br><span class="line"></span><br><span class="line">		49584 blocks of size 8192. 45707 blocks available</span><br><span class="line">smb: \&gt; get aa</span><br><span class="line">NT_STATUS_FILE_IS_A_DIRECTORY opening remote file \aa</span><br><span class="line">smb: \&gt; cd aa</span><br><span class="line">smb: \aa\&gt; ls</span><br><span class="line">  .                                   D        0  Thu Aug  4 04:30:28 2016</span><br><span class="line">  ..                                  D        0  Thu Aug  4 04:30:31 2016</span><br><span class="line">  dd.txt                              A        2  Thu Aug  4 04:31:01 2016</span><br><span class="line"></span><br><span class="line">		49584 blocks of size 8192. 45707 blocks available</span><br><span class="line">smb: \aa\&gt; get dd.txt</span><br><span class="line">getting file \aa\dd.txt of size 2 as dd.txt (1.0 KiloBytes/sec) (average 1.0 KiloBytes/sec)</span><br><span class="line">å¯ä»¥æŸ¥çœ‹åˆ°äº†ã€‚</span><br><span class="line"></span><br><span class="line">********************************************************************</span><br><span class="line">=====================================================================</span><br><span class="line">åŒ¿åç”¨æˆ·</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line">æœåŠ¡å™¨ç«¯rhel6</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line"></span><br><span class="line">1.åˆ›å»ºå…±äº«ç›®å½•/var/lib/samba/share</span><br><span class="line">[root@rhel6 ~]# mkdir /var/lib/samba/share</span><br><span class="line">2.ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@rhel6 ~]# vim /etc/samba/smb.conf</span><br><span class="line">[public]</span><br><span class="line">       comment = Public Stuff</span><br><span class="line">       path = /var/lib/samba/share</span><br><span class="line">       public = yes</span><br><span class="line">       writable = yes</span><br><span class="line">3.é‡å¯æœåŠ¡</span><br><span class="line">[root@rhel6 ~]# service smb restart</span><br><span class="line">Shutting down SMB services:                                [  OK  ]</span><br><span class="line">Starting SMB services:                                     [  OK  ]</span><br><span class="line">[root@rhel6 ~]# service nmb restart</span><br><span class="line">Shutting down NMB services:                                [  OK  ]</span><br><span class="line">Starting NMB services:                                     [  OK  ]</span><br><span class="line">4.ä¿®æ”¹å…±äº«ç›®å½•çš„UGOæƒé™</span><br><span class="line">[root@rhel6 ~]# ll -d /var/lib/samba/share</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Aug  5 10:27 /var/lib/samba/share</span><br><span class="line">[root@rhel6 ~]# grep nobody /etc/passwd</span><br><span class="line">nobody:x:99:99:Nobody:/:/sbin/nologin</span><br><span class="line">nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin</span><br><span class="line">[root@rhel6 ~]# chown nobody. /var/lib/samba/share</span><br><span class="line">[root@rhel6 ~]# ll -d /var/lib/samba/share</span><br><span class="line">drwxr-xr-x. 2 nobody nobody 4096 Aug  5 10:27 /var/lib/samba/share</span><br><span class="line">[root@rhel6 ~]# touch /var/lib/samba/share</span><br><span class="line">[root@rhel6 ~]# touch /var/lib/samba/share/smb-file&#123;1..5&#125;</span><br><span class="line">[root@rhel6 ~]# chown nobody. /var/lib/samba/share -R</span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# service smb stop</span><br><span class="line">Shutting down SMB services:                                [  OK  ]</span><br><span class="line">[root@rhel6 ~]# service smb start</span><br><span class="line">Starting SMB services:                                     [  OK  ]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line">å®¢æˆ·ç«¯rhel7</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line">[root@rhel7 ~]# smbclient -L 172.25.0.11</span><br><span class="line">Enter root\'s password:</span><br><span class="line">Anonymous login successful</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line"></span><br><span class="line">	Sharename       Type      Comment</span><br><span class="line">	---------       ----      -------</span><br><span class="line">	public          Disk      Public Stuff</span><br><span class="line"><span class="meta">	IPC$</span><span class="bash">            IPC       IPC Service (Samba Server Version 3.6.9-164.el6)</span></span><br><span class="line">Anonymous login successful</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line"></span><br><span class="line">	Server               Comment</span><br><span class="line">	---------            -------</span><br><span class="line">	RHEL6                Samba Server Version 3.6.9-164.el6</span><br><span class="line"></span><br><span class="line">	Workgroup            Master</span><br><span class="line">	---------            -------</span><br><span class="line">	MYGROUP              RHEL6</span><br><span class="line">[root@rhel7 ~]# smbclient //172.25.0.11/public</span><br><span class="line">Enter root\'s password:</span><br><span class="line">Anonymous login successful</span><br><span class="line">Domain=[MYGROUP] OS=[Unix] Server=[Samba 3.6.9-164.el6]</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  ..                                  D        0  Thu Aug  4 22:30:52 2016</span><br><span class="line">  smb-file4                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  smb-file2                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  smb-file5                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  smb-file1                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  smb-file3                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line"></span><br><span class="line">		34505 blocks of size 524288. 26941 blocks available</span><br><span class="line">smb: \&gt; get smb-file1</span><br><span class="line">getting file \smb-file1 of size 0 as smb-file1 (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)</span><br><span class="line">smb: \&gt; put rhel7</span><br><span class="line">putting file rhel7 as \rhel7 (0.0 kb/s) (average 0.0 kb/s)</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        0  Thu Aug  4 22:34:46 2016</span><br><span class="line">  ..                                  D        0  Thu Aug  4 22:30:52 2016</span><br><span class="line">  smb-file4                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  rhel7                               A        0  Thu Aug  4 22:34:46 2016</span><br><span class="line">  smb-file2                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  smb-file5                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  smb-file1                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line">  smb-file3                           N        0  Thu Aug  4 22:32:12 2016</span><br><span class="line"></span><br><span class="line">		34505 blocks of size 524288. 26941 blocks available</span><br><span class="line">smb: \&gt; exit</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line">å®¢æˆ·ç«¯windows</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########</span></span></span><br><span class="line">æ‰“å¼€æµè§ˆå™¨è¾“å…¥\\172.25.0.11\</span><br><span class="line">å°±èƒ½çœ‹åˆ°publicäº†</span><br><span class="line"></span><br><span class="line">=================================================================</span><br><span class="line">ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½ï½</span><br><span class="line">ä»¥ç±»ä¼¼nfsæŒ‚æ¥çš„æ–¹å¼æ¥å…±äº«samba</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##</span></span></span><br><span class="line">å®¢æˆ·ç«¯</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##</span></span></span><br><span class="line">mount -t cifs //172.25.0.11/student /mnt -o username=student</span><br><span class="line">uplooking</span><br><span class="line"></span><br><span class="line">1.å®‰è£…è½¯ä»¶cifs-utils</span><br><span class="line">[root@rhel7 ~]# yum install -y cifs-utils</span><br><span class="line">2.mountæŒ‚è½½</span><br><span class="line">[root@rhel7 ~]# mount -t cifs //172.25.0.11/student /mnt -o username=student</span><br><span class="line">Password for student@//172.25.0.11/student:  *********</span><br><span class="line">[root@rhel7 ~]# mount|tail -n 1</span><br><span class="line">//172.25.0.11/student on /mnt type cifs (rw,relatime,vers=1.0,cache=strict,username=student,domain=RHEL6,uid=0,noforceuid,gid=0,noforcegid,addr=172.25.0.11,unix,posixpaths,serverino,acl,rsize=1048576,wsize=65536,actimeo=1)</span><br><span class="line">[root@rhel7 ~]# cd /mnt</span><br><span class="line">[root@rhel7 mnt]# ll</span><br><span class="line">total 1024</span><br><span class="line">-rwxrw-r--. 1 500 500 8 Aug  4 22:15 file-student.txt</span><br><span class="line">drwxr-xr-x. 2 500 500 0 Aug  4 22:19 windows</span><br><span class="line"></span><br><span class="line">3.å¯ä»¥è®¾ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ï¼Œ/etc/bashrcæˆ–è€…/etc/profileä¸­</span><br></pre></td></tr></table></figure>


<h3 id="Sambaçš„ä¸»é…ç½®æ–‡ä»¶-etc-samba-smb-confè¯¦ç»†è§£æ"><a href="#Sambaçš„ä¸»é…ç½®æ–‡ä»¶-etc-samba-smb-confè¯¦ç»†è§£æ" class="headerlink" title="Sambaçš„ä¸»é…ç½®æ–‡ä»¶/etc/samba/smb.confè¯¦ç»†è§£æ"></a>Sambaçš„ä¸»é…ç½®æ–‡ä»¶/etc/samba/smb.confè¯¦ç»†è§£æ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">é¦–å…ˆæ˜¯å…¨å±€é…ç½®</span><br><span class="line">ã€globalã€‘</span><br><span class="line">        workgroup = MYGROUP     --&gt;å·¥ä½œç»„ï¼Œå·¥ä½œç»„æ˜¯windowsä¸Šçš„æ¦‚å¿µ</span><br><span class="line">        server string = Samba Server Version %v   --&gt;å…³äºsambaçš„è¯´æ˜</span><br><span class="line"></span><br><span class="line">        netbios name = MYSERVER   --&gt;ç½‘ç»œåç§°</span><br><span class="line"></span><br><span class="line">;       interfaces = lo eth0 192.168.12.2/24 192.168.13.2/24   --&gt;æ¥å£ç½‘æ®µä¿¡æ¯</span><br><span class="line">;       hosts allow = 127. 192.168.12. 192.168.13.    --&gt;å…è®¸å“ªäº›æœºå™¨æ¥è®¿é—®å…±äº«</span><br><span class="line"></span><br><span class="line">;       max protocol = SMB2</span><br><span class="line">ã€logging optionsã€‘  å…³äºæ—¥å¿—çš„é…ç½®</span><br><span class="line"> 	log file = /var/log/samba/log.%m    	æ—¥å¿—å­˜æ”¾çš„ä½ç½®ï¼Œ%mä»£è¡¨æ—¥æœŸ</span><br><span class="line"> 	max log size = 50			æ—¥å¿—çš„å¤§å°é™åˆ¶ä¸º50K</span><br><span class="line">ã€ Standalone Server Options ã€‘ å…³äºå®‰å…¨çº§åˆ«çš„ç›¸å…³é…ç½®</span><br><span class="line">        security = user    --&gt; userä»£è¡¨éœ€è¦ç”¨æˆ·åå’Œå¯†ç ï¼Œå¯†ç ä¸ä¸‹é¢çš„passdb backendæœ‰å…³ï¼Œshareä»£è¡¨ä»»ä½•æ¥éƒ½å¯ä»¥ç›´æ¥è®¿é—®ï¼ŒserveræŒ‡çš„æ˜¯ä½¿ç”¨å¤–éƒ¨çš„å¯†ç ï¼Œéœ€è¦æä¾›password server = IPçš„è®¾ç½®å€¼æ‰è¡Œã€‚</span><br><span class="line">        passdb backend = tdbsam   --&gt;æ•°æ®åº“æ ¼å¼ï¼Œé»˜è®¤çš„æ ¼å¼æ˜¯tdbsamï¼Œæ–‡èŒè¢«æ”¾ç½®åˆ°/var/lib/samba/private/passwd.tdb</span><br><span class="line"></span><br><span class="line">ã€ Share Definitions ã€‘</span><br><span class="line">[homes]    --&gt;é»˜è®¤æƒ…å†µç”¨æˆ·å®¶ç›®å½•çš„å…±äº«ä¿¡æ¯</span><br><span class="line">        comment = Home Directories</span><br><span class="line">        browseable = no</span><br><span class="line">        writable = yes</span><br><span class="line">;       valid users = %S</span><br><span class="line">;       valid users = MYDOMAIN\%S</span><br><span class="line">[printers]  --&gt;å…³äºæ‰“å°æœºçš„é…ç½®ï¼Œè¿™æ˜¯ä¸€äº›ä¾‹å­ã€‚ä¸‹é¢è·Ÿä¸Šäº†ä¸€äº›é€‰é¡¹ã€‚</span><br><span class="line">        path = /var/spool/samba</span><br><span class="line">        browseable = no</span><br><span class="line">        guest ok = no</span><br><span class="line">        writable = no</span><br><span class="line">        printable = yes</span><br><span class="line">[sharesmb]        --&gt;å…±äº«ç›®å½•å</span><br><span class="line">        comment = è¯´æ˜</span><br><span class="line">        path = /test    --&gt;å…±äº«è·¯å¾„</span><br><span class="line">        public = yes    --&gt;æ˜¯å¦æ‰€æœ‰äººéƒ½èƒ½å¤Ÿè®¿é—®</span><br><span class="line">        writable = yes  --&gt;æ˜¯å¦å¯ä»¥å†™</span><br><span class="line">        printable = no  --&gt;æ˜¯å¦æ‰“å°ï¼Œé»˜è®¤æ˜¯noï¼Œå†™äº†yesä¼šç›´æ¥è¢«ä¼ é€’åˆ°æ‰“å°æœºï¼Œå¯ä»¥çœç•¥è¯¥è¡Œ</span><br><span class="line">        write list = +staff  --&gt;å¯å†™ç”¨æˆ·åˆ—è¡¨ã€‚æˆ‘ä»¬è¿™é‡Œå…ˆæŠŠè¿™è¡Œåˆ æ‰ã€‚</span><br><span class="line">        browsable=no    --&gt;æ˜¯å¦å¯æµè§ˆï¼Œå¦‚æœæ˜¯yesåˆ™é»˜è®¤éšè—ã€‚</span><br><span class="line">     	  hosts allow= ç”¨æ¥é™åˆ¶ä¸»æœºå’Œç½‘æ®µã€‚è°å¯ä»¥è®¿é—®ã€‚</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxåŸºç¡€æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>APACHE WEBæœåŠ¡</title>
    <url>/2016/12/23/booboo_easy_service/05_apache/</url>
    <content><![CDATA[<h3 id="WebåŸºç¡€"><a href="#WebåŸºç¡€" class="headerlink" title="WebåŸºç¡€"></a>WebåŸºç¡€</h3><p>æˆ‘ä»¬å¹³æ—¶ä¸Šç½‘çš„æ—¶å€™ï¼Œè¾“å…¥ç½‘å€çš„æ—¶å€™éƒ½ä¼šè¾“å…¥ä»€ä¹ˆï¼Œ<a href="http://www.baidu.comï¼Œå¯¹ä¸å¯¹ï¼Œé‚£ä¹ˆè¿™ä¸ªwwwæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªwwwä»£è¡¨çš„æ˜¯world">www.baidu.comï¼Œå¯¹ä¸å¯¹ï¼Œé‚£ä¹ˆè¿™ä¸ªwwwæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªwwwä»£è¡¨çš„æ˜¯world</a> wide webï¼ŒWWWå¯ä»¥è®©Webå®¢æˆ·ç«¯ï¼ˆå¸¸ç”¨æµè§ˆå™¨ï¼‰è®¿é—®æµè§ˆWebæœåŠ¡å™¨ä¸Šçš„é¡µé¢ã€‚ å®ƒæ˜¯ä¸€ä¸ªç”±è®¸å¤šäº’ç›¸é“¾æ¥çš„è¶…æ–‡æœ¬ç»„æˆçš„ç³»ç»Ÿï¼Œé€šè¿‡äº’è”ç½‘è®¿é—®ï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæœ‰ç”¨çš„äº‹ç‰©ï¼Œç§°ä¸ºä¸€æ ·â€œèµ„æºâ€ï¼›å¹¶ä¸”ç”±ä¸€ä¸ªå…¨å±€â€œç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦â€ï¼ˆURLï¼‰æ ‡è¯†ï¼›è¿™äº›èµ„æºé€šè¿‡è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHypertext Transfer Protocolï¼‰ä¼ é€ç»™ç”¨æˆ·ï¼Œè€Œåè€…é€šè¿‡ç‚¹å‡»é“¾æ¥æ¥è·å¾—èµ„æºã€‚</p>
<p>HTTPæ˜¯Hypertext Transfer Protocolçš„ç¼©å†™ï¼Œå³è¶…æ–‡æœ¬ä¼ è¾“åè®®ã€‚ é¡¾åæ€ä¹‰ï¼ŒHTTPæä¾›äº†è®¿é—®è¶…æ–‡æœ¬ä¿¡æ¯çš„åŠŸèƒ½ï¼Œæ˜¯WWWæµè§ˆå™¨å’ŒWWWæœåŠ¡å™¨ä¹‹é—´çš„åº”ç”¨å±‚é€šä¿¡åè®®ã€‚HTTPåè®®æ˜¯ç”¨äºåˆ†å¸ƒå¼åä½œè¶…æ–‡æœ¬ä¿¡æ¯ç³»ç»Ÿçš„ã€é€šç”¨çš„ã€é¢å‘å¯¹è±¡çš„åè®®ã€‚é€šè¿‡æ‰©å±•å‘½ä»¤ï¼Œå®ƒå¯ç”¨äºç±»ä¼¼çš„ä»»åŠ¡ï¼Œå¦‚åŸŸåæœåŠ¡æˆ–åˆ†å¸ƒå¼é¢å‘å¯¹è±¡ç³»ç»Ÿã€‚WWWä½¿ç”¨HTTPåè®®ä¼ è¾“å„ç§è¶…æ–‡æœ¬é¡µé¢å’Œæ•°æ®ã€‚</p>
<p>ç½‘é¡µæ–‡ä»¶æ˜¯ç”¨HTMLï¼ˆæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€ä¸‹çš„ä¸€ä¸ªåº”ç”¨ï¼‰ç¼–å†™çš„ï¼Œå¯åœ¨WWWä¸Šä¼ è¾“ï¼Œèƒ½è¢«æµè§ˆå™¨è¯†åˆ«æ˜¾ç¤ºçš„æ–‡æœ¬æ–‡ä»¶ã€‚å…¶æ‰©å±•åæ˜¯.htmå’Œ.htmlã€‚</p>
<p>Webçš„æœåŠ¡å™¨æœ€å¸¸è§çš„æœ‰windowsä¸Šçš„IISï¼Œè¿˜æœ‰linuxä¸Šçš„apacheã€‚å¦å¤–è¿˜æœ‰ä¾‹å¦‚nginxç­‰çš„è½»é‡çº§æœåŠ¡å™¨ã€‚éƒ½æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ä¸€äº›æœåŠ¡å™¨ã€‚æˆ‘ä»¬åŸºç¡€è¯¾ä¸»è¦ç®€å•ä»‹ç»ä¸€äº›apacheçš„ä¸€ä¸ªç®€å•æ­å»ºã€‚</p>
<h3 id="Apacheçš„ç®€ä»‹"><a href="#Apacheçš„ç®€ä»‹" class="headerlink" title="Apacheçš„ç®€ä»‹"></a>Apacheçš„ç®€ä»‹</h3><ul>
<li>HTTP (Web) serverã€å¼€æºã€1995å¹´</li>
<li>å®˜ç½‘ï¼š <a href="http://httpd.apache.org/" target="_blank" rel="noopener">http://httpd.apache.org/</a></li>
</ul>
<p>Apache èµ·åˆç”± Illinois å¤§å­¦ Urbana-Champaign çš„å›½å®¶é«˜çº§è®¡ç®—ç¨‹åºä¸­å¿ƒå¼€å‘ã€‚æ­¤åï¼ŒApache è¢«å¼€æ”¾æºä»£ç å›¢ä½“çš„æˆå‘˜ä¸æ–­çš„å‘å±•å’ŒåŠ å¼ºã€‚Apache æœåŠ¡å™¨æ‹¥æœ‰ç‰¢é å¯ä¿¡çš„ç¾èª‰ï¼Œå·²ç”¨åœ¨è¶…è¿‡åŠæ•°çš„å› ç‰¹ç½‘ç«™ä¸­ï¼ç‰¹åˆ«æ˜¯å‡ ä¹æ‰€æœ‰æœ€çƒ­é—¨å’Œè®¿é—®é‡æœ€å¤§çš„ç½‘ç«™ã€‚</p>
<p>å¼€å§‹ï¼ŒApacheåªæ˜¯Netscapeç½‘é¡µæœåŠ¡å™¨ï¼ˆç°åœ¨æ˜¯Sun ONEï¼‰çš„ä¹‹å¤–çš„å¼€æ”¾æºä»£ç é€‰æ‹©ã€‚æ¸æ¸çš„ï¼Œå®ƒå¼€å§‹åœ¨åŠŸèƒ½å’Œé€Ÿåº¦ã€‚è¶…è¶Šå…¶ä»–çš„åŸºäºUnixçš„HTTPæœåŠ¡å™¨ã€‚1996å¹´4æœˆä»¥æ¥ï¼ŒApacheä¸€ç›´æ˜¯Internetä¸Šæœ€æµè¡Œçš„HTTPæœåŠ¡å™¨: 1999å¹´5æœˆå®ƒåœ¨ 57% çš„ç½‘é¡µæœåŠ¡å™¨ä¸Šè¿è¡Œï¼›åˆ°äº†2005å¹´7æœˆè¿™ä¸ªæ¯”ä¾‹ä¸Šå‡åˆ°äº†69%ã€‚</p>
<p>ä½œè€…å®£ç§°å› ä¸ºè¿™ä¸ªåå­—å¥½è®°æ‰åœ¨æœ€åˆé€‰æ‹©å®ƒï¼Œä½†æ˜¯æµä¼ æœ€å¹¿çš„è§£é‡Šæ˜¯ï¼ˆä¹Ÿæ˜¯æœ€æ˜¾è€Œæ˜“è§çš„ï¼‰:è¿™ä¸ªåå­—æ¥è‡ªè¿™ä¹ˆä¸€ä¸ªäº‹å®:å½“Apacheåœ¨1995å¹´åˆå¼€å‘çš„æ—¶å€™ï¼Œå®ƒæ˜¯ç”±å½“æ—¶æœ€æµè¡Œçš„HTTPæœåŠ¡å™¨NCSA HTTPd 1.3 çš„ä»£ç ä¿®æ”¹è€Œæˆçš„ï¼Œå› æ­¤æ˜¯â€œä¸€ä¸ªä¿®è¡¥çš„ï¼ˆa patchyï¼‰â€æœåŠ¡å™¨ã€‚ç„¶è€Œåœ¨æœåŠ¡å™¨å®˜æ–¹ç½‘ç«™çš„FAQä¸­æ˜¯è¿™ä¹ˆè§£é‡Šçš„:â€œâ€˜Apacheâ€™è¿™ä¸ªåå­—æ˜¯ä¸ºäº†çºªå¿µåä¸ºApache(å°åœ°è¯­)çš„ç¾æ´²å°ç¬¬å®‰äººåœŸè‘—çš„ä¸€æ”¯ï¼Œä¼—æ‰€å‘¨çŸ¥ä»–ä»¬æ‹¥æœ‰é«˜è¶…çš„ä½œæˆ˜ç­–ç•¥å’Œæ— ç©·çš„è€æ€§â€ã€‚</p>
<p>Apacheçš„è½¯ä»¶åç§°å°±å«åšhttpdï¼Œè¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥el6ä½œä¸ºæœåŠ¡å™¨ï¼Œel7ä½œä¸ºå®¢æˆ·ç«¯ã€‚</p>
<h3 id="Apacheçš„è½¯ä»¶ç»“æ„"><a href="#Apacheçš„è½¯ä»¶ç»“æ„" class="headerlink" title="Apacheçš„è½¯ä»¶ç»“æ„"></a>Apacheçš„è½¯ä»¶ç»“æ„</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apache</span><br><span class="line">è½¯ä»¶			 httpd</span><br><span class="line">					rhel6	httpd-2.2.15-29.el6_4.x86_64</span><br><span class="line">					rhel7	httpd-2.4.6-17.el7.x86_64</span><br><span class="line">service		httpd</span><br><span class="line">daemon		httpd</span><br><span class="line">ç«¯å£			80</span><br><span class="line">é…ç½®æ–‡ä»¶	/etc/httpd/conf/httpd.conf</span><br><span class="line">				/etc/httpd/conf.d/*.conf</span><br><span class="line">æ•°æ®æ–‡ä»¶	/var/www/</span><br><span class="line">				/var/www/uplooking/	www.uplooking.com----ç½‘ç«™æ ¹ç›®å½•</span><br><span class="line">æ—¥å¿—æ–‡ä»¶	/var/log/httpd</span><br></pre></td></tr></table></figure>

<h3 id="Apacheè™šæ‹Ÿä¸»æœºæ–¹æ¡ˆ"><a href="#Apacheè™šæ‹Ÿä¸»æœºæ–¹æ¡ˆ" class="headerlink" title="Apacheè™šæ‹Ÿä¸»æœºæ–¹æ¡ˆ"></a>Apacheè™šæ‹Ÿä¸»æœºæ–¹æ¡ˆ</h3><ol>
<li>åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">www.uplooking.com:80	----&gt;	/var/www/uplooking.com/</span><br><span class="line">www.uplooking.com:8080	----&gt;	/var/www/abc.com/</span><br></pre></td></tr></table></figure></li>
<li>åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">www.uplooking.com----/var/www/uplooking.com/</span><br><span class="line">www.abc.com----/var/www/abc.com/</span><br></pre></td></tr></table></figure>
<h3 id="Apacheå®è·µ"><a href="#Apacheå®è·µ" class="headerlink" title="Apacheå®è·µ"></a>Apacheå®è·µ</h3></li>
</ol>
<h4 id="é¡¹ç›®å®è·µ1ï¼šé…ç½®åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº"><a href="#é¡¹ç›®å®è·µ1ï¼šé…ç½®åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº" class="headerlink" title="é¡¹ç›®å®è·µ1ï¼šé…ç½®åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº"></a>é¡¹ç›®å®è·µ1ï¼šé…ç½®åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">	8080---&gt;</span><span class="bash">/var/www/8080.com/</span></span><br><span class="line">*******************************************</span><br><span class="line">1)ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶ï¼Œæ‰“å¼€è¦ç›‘å¬çš„ç«¯å£å·</span><br><span class="line">[root@rhel6 ~]# vim /etc/httpd/conf/httpd.conf</span><br><span class="line">Listen 80</span><br><span class="line">Listen 8080</span><br><span class="line">2)ä¸ºä¸åŒçš„è™šæ‹Ÿä¸»æœºåˆ›å»ºé…ç½®æ–‡ä»¶</span><br><span class="line">[root@rhel6 conf.d]# pwd</span><br><span class="line">/etc/httpd/conf.d</span><br><span class="line">[root@rhel6 conf.d]# vim 8080.conf</span><br><span class="line">&lt;VirtualHost *:8080&gt;</span><br><span class="line">    ServerAdmin booboo@8080.com</span><br><span class="line">    DocumentRoot /var/www/8080.com</span><br><span class="line">    ServerName www.8080.com</span><br><span class="line">    ErrorLog logs/8080.com-error_log</span><br><span class="line">    CustomLog logs/8080.com-access_log common</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">3.åˆ›å»ºç½‘ç«™æ ¹ç›®å½•ï¼Œå¹¶åˆ›å»ºç½‘ç«™é»˜è®¤é¦–é¡µ</span><br><span class="line">[root@rhel6 conf.d]# mkdir /var/www/8080.com</span><br><span class="line">[root@rhel6 conf.d]# echo 8080.com &gt; /var/www/8080.com/index.html</span><br><span class="line">4.é‡å¯æœåŠ¡</span><br><span class="line">[root@rhel6 conf.d]# service httpd start</span><br></pre></td></tr></table></figure>

<p>æ‹“å±•8081å’Œ8082ç«¯å£</p>
<ol>
<li>å…³é—­selinux</li>
<li>é…ç½®selinuxå®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå…è®¸httpdç›‘å¬8081å’Œ8082ç«¯å£<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 conf.d]# semanage port -l|grep http</span><br><span class="line">http_cache_port_t              tcp      3128, 8080, 8118, 8123, 10001-10010</span><br><span class="line">http_cache_port_t              udp      3130</span><br><span class="line">http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000</span><br><span class="line">pegasus_http_port_t            tcp      5988</span><br><span class="line">pegasus_https_port_t           tcp      5989</span><br><span class="line"></span><br><span class="line">[root@rhel6 conf.d]# semanage port -a -t http_port_t -p tcp 8081</span><br><span class="line">[root@rhel6 conf.d]# semanage port -a -t http_port_t -p tcp 8082</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="é¡¹ç›®å®è·µ2ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº"><a href="#é¡¹ç›®å®è·µ2ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº" class="headerlink" title="é¡¹ç›®å®è·µ2ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº"></a>é¡¹ç›®å®è·µ2ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">	www.taobao.com		/var/www/taobao.com/</span><br><span class="line">	www.abc.com		/var/www/abc.com/</span><br><span class="line">*******************************************************</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####</span></span></span><br><span class="line">æœåŠ¡ç«¯</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####</span></span></span><br><span class="line">1.ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶</span><br><span class="line">[root@rhel6 conf.d]# vim /etc/httpd/conf/httpd.conf</span><br><span class="line">NameVirtualHost *:80</span><br><span class="line">2.åˆ›å»ºæ‹“å±•é…ç½®æ–‡ä»¶</span><br><span class="line">[root@rhel6 conf.d]# vim taobao.conf</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerAdmin booboo@taobao.com</span><br><span class="line">    DocumentRoot /var/www/taobao.com</span><br><span class="line">    ServerName www.taobao.com</span><br><span class="line">    ErrorLog logs/taobao.com-error_log</span><br><span class="line">    CustomLog logs/taobao.com-access_log common</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory "/var/www/taobao.com/"&gt;</span><br><span class="line">    Options Indexes ==&gt;å¦‚æœæ²¡æœ‰å¯¹åº”çš„indexæ–‡ä»¶ï¼Œå°±å°†è¯¥ç›®å½•ä¸‹çš„å…¶ä»–æ–‡ä»¶ç½—åˆ—å‡ºæ¥ã€‚</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">[root@rhel6 conf.d]# vim abc.conf</span><br><span class="line">[root@rhel6 conf.d]# cat abc.conf</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerAdmin booboo@abc.com</span><br><span class="line">    DocumentRoot /var/www/abc.com</span><br><span class="line">    ServerName www.abc.com</span><br><span class="line">    ErrorLog logs/abc.com-error_log</span><br><span class="line">    CustomLog logs/abc.com-access_log common</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory "/var/www/abc.com/"&gt;</span><br><span class="line">    Options Indexes</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">[root@rhel6 conf.d]# mkdir /var/www/taobao.com</span><br><span class="line">[root@rhel6 conf.d]# mkdir /var/www/abc.com</span><br><span class="line">[root@rhel6 conf.d]# echo www.taobao.com &gt; /var/www/taobao.com/index.html</span><br><span class="line">[root@rhel6 conf.d]# echo www.abc.com &gt; /var/www/abc.com/index.html</span><br><span class="line">[root@rhel6 conf.d]# service httpd restart</span><br><span class="line">==================================================================================================</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####</span></span></span><br><span class="line">å®¢æˆ·ç«¯</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####</span></span></span><br><span class="line">1.å®‰è£…elinksè½¯ä»¶ï¼Œbashä¸‹çš„ä¸€ä¸ªç½‘ç«™æµè§ˆè½¯ä»¶</span><br><span class="line">[root@rhel7 mnt]# yum install -y elinks</span><br><span class="line">2.æ·»åŠ åŸŸåè§£æ</span><br><span class="line">[root@rhel7 mnt]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">172.25.0.11	www.taobao.com</span><br><span class="line">172.25.0.11	www.abc.com</span><br><span class="line">3.é€šè¿‡linkså‘½ä»¤è®¿é—®www.taobao.comå’Œwww.abc.com</span><br><span class="line">[root@rhel7 mnt]# links www.taobao.com</span><br><span class="line">[root@rhel7 mnt]# links www.abc.com</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####</span></span></span><br><span class="line">-X å¸¦å›¾å½¢åŒ–ç•Œé¢çš„è¿œç¨‹ç™»å½•</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####</span></span></span><br><span class="line">[kiosk@foundation0 Desktop]$ ssh root@172.25.0.10 -X</span><br><span class="line">Last login: Fri Aug  5 03:14:10 2016</span><br><span class="line">/usr/bin/xauth:  file /root/.Xauthority does not exist</span><br><span class="line">[root@rhel7 ~]# firefox</span><br></pre></td></tr></table></figure>


<h4 id="é¡¹ç›®å®è·µ3ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºé’ˆå¯¹æŸä¸€ä¸ªç›®å½•åšé™åˆ¶"><a href="#é¡¹ç›®å®è·µ3ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºé’ˆå¯¹æŸä¸€ä¸ªç›®å½•åšé™åˆ¶" class="headerlink" title="é¡¹ç›®å®è·µ3ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºé’ˆå¯¹æŸä¸€ä¸ªç›®å½•åšé™åˆ¶"></a>é¡¹ç›®å®è·µ3ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºé’ˆå¯¹æŸä¸€ä¸ªç›®å½•åšé™åˆ¶</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Directoryæ˜¯é’ˆå¯¹æŸä¸€ä¸ªç›®å½•åšé™åˆ¶çš„æ„æ€ã€‚</span><br><span class="line">	Options</span><br><span class="line">		Indexesçš„æ„æ€ä»£è¡¨å¦‚æœæ²¡æœ‰å¯¹åº”çš„indexæ–‡ä»¶ï¼Œå°±å°†è¯¥ç›®å½•ä¸‹çš„å…¶ä»–æ–‡ä»¶ç½—åˆ—å‡ºæ¥ã€‚</span><br><span class="line">		Multiviewä»£è¡¨çš„æ˜¯å¤šè§†å›¾</span><br><span class="line">		Follow sysmlinkä»£è¡¨å…è®¸è¿æ¥åˆ°å…¶ä»–ç›®å½•ã€‚</span><br><span class="line">	AllowOverride None</span><br><span class="line">	æœ€å¸¸ç”¨çš„æ˜¯ï¼š</span><br><span class="line">	Order allow,deny</span><br><span class="line">	Allow from All</span><br><span class="line">	deny from 172.25.0.10==&gt;è¯¥ç›®å½•å…è®¸æ‰€æœ‰äººï¼Œé™¤äº†172.25.0.11</span><br><span class="line">	æˆ–è€…</span><br><span class="line">	Order deny,allow</span><br><span class="line">	deny from All</span><br><span class="line">	allow from 172.25.0.10==&gt;è¯¥ç›®å½•ä¸å…è®¸æ‰€æœ‰äººï¼Œé™¤äº†172.25.0.11</span><br></pre></td></tr></table></figure>

<h4 id="é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº-åˆ«å"><a href="#é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº-åˆ«å" class="headerlink" title="é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº_åˆ«å"></a>é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº_åˆ«å</h4><ul>
<li>åˆ«å        alias<ul>
<li>ä½œç”¨åœ¨è®¿é—®è¯¥ç›®å½•çš„æ—¶å€™,æ— è®ºä¹‹å‰çš„è™šæ‹Ÿä¸»æœºç«™ç‚¹åæ˜¯ä»€ä¹ˆ,ä¼šç»Ÿä¸€è½¬åˆ°æŸä¸€ä¸ªæŒ‡å®šçš„ç›®å½•ã€‚</li>
</ul>
</li>
</ul>
<p><code>Alias /download/ /&quot;var/www/soft/&quot;</code></p>
<p>è®¿é—® download ç›®å½•æ—¶,æ— è®ºç«™ç‚¹åæ˜¯ä»€ä¹ˆ,éƒ½ä¼šäº¤ç»™ var/www/soft/ å»å¤„ç†,æ³¨æ„:ä»£è¡¨ç›®å½•æ—¶,æœ€åä¸€ä¸ª / ä¸èƒ½çœç•¥</p>
<h4 id="é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº-ç”¨æˆ·åå’Œå¯†ç è®¿é—®"><a href="#é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº-ç”¨æˆ·åå’Œå¯†ç è®¿é—®" class="headerlink" title="é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº_ç”¨æˆ·åå’Œå¯†ç è®¿é—®"></a>é¡¹ç›®å®è·µ4ï¼šé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº_ç”¨æˆ·åå’Œå¯†ç è®¿é—®</h4><ul>
<li>1ï¼‰é…ç½®æ–‡ä»¶ä¸­æ·»åŠ è®¤è¯    AllowOverride AuthConfig<ul>
<li>2ï¼‰åˆ›å»ºè®¤è¯æ–‡ä»¶å’Œç”¨æˆ·å¯†ç     htpasswd -cmb /etc/httpd/test booboo uplooking</li>
<li>3ï¼‰æ–°å¢ç”¨æˆ·å’Œå¯†ç         htpasswd -bm /etc/httpd/test tom uplooking</li>
<li>4ï¼‰åˆ é™¤ç”¨æˆ·        htpasswd -D /etc/httpd/test jack</li>
<li>5ï¼‰ä¿®æ”¹å¯†ç         å…ˆåˆ é™¤å†åˆ›å»º</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è®¾ç½®ç”¨æˆ·å’Œå¯†ç </span><br><span class="line">&lt;Directory "/var/www/booboo.com/football/"&gt;</span><br><span class="line">Options Indexes MultiViews FollowSymLinks</span><br><span class="line">AllowOverride AuthConfig</span><br><span class="line"><span class="meta">#</span><span class="bash">ä»…æœ‰ç½‘é¡µè®¤è¯ ( è´¦å·å¯†ç  ) å¯è¦†å†™ ;</span></span><br><span class="line">AuthName "student"</span><br><span class="line"><span class="meta">#</span><span class="bash">åœ¨è¦ä½ è¾“å…¥è´¦å·ä¸å¯†ç çš„å¯¹è¯çª—å£ä¸­ , å‡ºç°çš„ã€æç¤ºå­—ç¬¦ã€</span></span><br><span class="line">AuthType basic</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¤è¯çš„ç±»å‹</span></span><br><span class="line">AuthUserFile "/etc/httpd/test"</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿™ä¸ªç›®å½•æ‰€ä½¿ç”¨çš„è´¦å·å¯†ç é…ç½®æ–‡ä»¶</span></span><br><span class="line">Require valid-user</span><br><span class="line"><span class="meta">#</span><span class="bash"> åé¢æ¥å¯ä»¥ä½¿ç”¨çš„è´¦å· , æ­¤å¤„æ˜¯è®©è¯¥å¯†ç æ–‡ä»¶å†…çš„ç”¨æˆ·éƒ½èƒ½å¤Ÿç™»å…¥</span></span><br><span class="line">Order allow,deny</span><br><span class="line">Allow from all</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡htpasswdæ·»åŠ ç”¨æˆ·å’Œå¯†ç </span></span><br><span class="line">[root@rhel6 conf.d]# htpasswd -cmb /etc/httpd/test booboo uplooking</span><br><span class="line">Adding password for user student</span><br><span class="line"><span class="meta">#</span><span class="bash"> å†æ·»åŠ ä¸€ä¸ªç”¨æˆ·å’Œå¯†ç </span></span><br><span class="line">[root@rhel6 www]# htpasswd -bm /etc/httpd/test tom uplooking</span><br><span class="line">Adding password for user tom</span><br><span class="line">[root@rhel6 www]# htpasswd -bm /etc/httpd/test jack uplooking</span><br><span class="line">Adding password for user jack</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹ä¿å­˜apacheç”¨æˆ·åå’Œå¯†ç çš„æ–‡ä»¶å†…å®¹</span></span><br><span class="line">[root@rhel6 www]# cat /etc/httpd/test</span><br><span class="line">booboo:$apr1$y6g/XYrn$eEOR4WeAPfONSLExj7x2D1</span><br><span class="line">tom:$apr1$epxVgzER$Or7.R0.5s3z8FbPKrOS1e1</span><br><span class="line">jack:$apr1$Alo3.7mf$3CmcCG9mXp7eEALUsa3YY1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤ç”¨æˆ·</span></span><br><span class="line">[root@rhel6 www]# htpasswd -D /etc/httpd/test jack</span><br><span class="line">Deleting password for user jack</span><br><span class="line">[root@rhel6 www]# cat /etc/httpd/test</span><br><span class="line">booboo:$apr1$y6g/XYrn$eEOR4WeAPfONSLExj7x2D1</span><br><span class="line">tom:$apr1$epxVgzER$Or7.R0.5s3z8FbPKrOS1e1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹ç”¨æˆ·å¯†ç åªèƒ½å…ˆåˆ é™¤å†åˆ›å»º</span></span><br><span class="line">[root@rhel6 abc.com]# htpasswd --help</span><br><span class="line">Usage:</span><br><span class="line">	htpasswd [-cmdpsD] passwordfile username</span><br><span class="line">	htpasswd -b[cmdpsD] passwordfile username password</span><br><span class="line"></span><br><span class="line">	htpasswd -n[mdps] username</span><br><span class="line">	htpasswd -nb[mdps] username password</span><br><span class="line"> -c  Create a new file.</span><br><span class="line"> -n  Don\'t update file; display results on stdout.</span><br><span class="line"> -m  Force MD5 encryption of the password.</span><br><span class="line"> -d  Force CRYPT encryption of the password (default).</span><br><span class="line"> -p  Do not encrypt the password (plaintext).</span><br><span class="line"> -s  Force SHA encryption of the password.</span><br><span class="line"> -b  Use the password from the command line rather than prompting for it.</span><br><span class="line"> -D  Delete the specified user.</span><br><span class="line">On Windows, NetWare and TPF systems the '-m' flag is used by default.</span><br><span class="line">On all other systems, the '-p' flag will probably not work.</span><br></pre></td></tr></table></figure>
<h4 id="é¡¹ç›®å®è·µ5ï¼šåœ¨rhel7ä¸­æ­å»ºapahceï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½"><a href="#é¡¹ç›®å®è·µ5ï¼šåœ¨rhel7ä¸­æ­å»ºapahceï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½" class="headerlink" title="é¡¹ç›®å®è·µ5ï¼šåœ¨rhel7ä¸­æ­å»ºapahceï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½"></a>é¡¹ç›®å®è·µ5ï¼šåœ¨rhel7ä¸­æ­å»ºapahceï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½</h4><ul>
<li><p>é…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº <a href="http://www.abc.com" target="_blank" rel="noopener">www.abc.com</a> å’Œ <a href="http://www.uplooking.com" target="_blank" rel="noopener">www.uplooking.com</a></p>
</li>
<li><p>åªå…è®¸rhel6 172.25.0.11 èƒ½å¤Ÿè®¿é—® <a href="http://www.uplooking.com" target="_blank" rel="noopener">www.uplooking.com</a> </p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rhel6	rhel7</span><br><span class="line">2.2	2.4</span><br><span class="line">order	require</span><br><span class="line"></span><br><span class="line">ã€‹eg1:æ‰€æœ‰è¯·æ±‚éƒ½è¢«æ‹’ç»</span><br><span class="line">order deny,allow //å…ˆæ‹’ç»ï¼Œåå…è®¸</span><br><span class="line">deny from all	//æ‹’ç»æ‰€æœ‰</span><br><span class="line">------------------------------</span><br><span class="line">require all denied //æ‹’ç»æ‰€æœ‰</span><br><span class="line"></span><br><span class="line">ã€‹eg2ï¼šæ‰€æœ‰è¯·æ±‚éƒ½å…è®¸</span><br><span class="line">order allowï¼Œdeny //å…ˆå…è®¸ï¼Œåæ‹’ç»</span><br><span class="line">allow from all</span><br><span class="line">------------------------------------</span><br><span class="line">require all granted</span><br><span class="line"></span><br><span class="line">ã€‹æ‹’ç»172.25.0.10/test.uplooking.com çš„è¯·æ±‚</span><br><span class="line">order allowï¼Œdeny //å…ˆå…è®¸ï¼Œåæ‹’ç»</span><br><span class="line">allow from all</span><br><span class="line">deny from 172.25.0.10</span><br><span class="line">-------------------------------------</span><br><span class="line">require  all granted</span><br><span class="line">require no ip 172.25.0.10</span><br><span class="line">require no host test.uplooking.com</span><br><span class="line"></span><br><span class="line">ã€‹åªå…è®¸172.25.3.10å’Œ172.25.0.0/24 uplooking.com çš„è¯·æ±‚</span><br><span class="line">order denyï¼Œallow //å…ˆå†³ç»ï¼Œåå…è®¸</span><br><span class="line">deny from all</span><br><span class="line">allow from 172.25.3.10</span><br><span class="line">allow from 172.25.0.0/24</span><br><span class="line">-------------------------------------</span><br><span class="line">require all denied</span><br><span class="line">require ip 172.25.3.10 172.25.0</span><br><span class="line">require host  uplooking.com</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Apacheé…ç½®æ–‡ä»¶-etc-httpd-conf-httpd-conf"><a href="#Apacheé…ç½®æ–‡ä»¶-etc-httpd-conf-httpd-conf" class="headerlink" title="Apacheé…ç½®æ–‡ä»¶/etc/httpd/conf/httpd.conf"></a>Apacheé…ç½®æ–‡ä»¶/etc/httpd/conf/httpd.conf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1ï¼‰</span><br><span class="line"><span class="meta">#</span><span class="bash"> ServerRoot â€œ/etc/httpdâ€œ</span></span><br><span class="line">	ServerRootç”¨äºæŒ‡å®šå®ˆæŠ¤è¿›ç¨‹httpdçš„è¿è¡Œç›®å½•ï¼Œhttpdåœ¨å¯åŠ¨ä¹‹åå°†è‡ªåŠ¨å°†è¿›ç¨‹çš„å½“å‰ç›®å½•æ”¹å˜ä¸ºè¿™ä¸ªç›®å½•ï¼Œå› æ­¤å¦‚æœè®¾ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆçœŸå®è·¯å¾„å°±ä½äºè¿™ä¸ªServerR ootå®šä¹‰çš„è·¯å¾„ä¹‹ä¸‹ã€‚</span><br><span class="line"></span><br><span class="line">2ï¼‰</span><br><span class="line">hhhidFile /var/run/httpd.pid</span><br><span class="line">	PidFileæŒ‡å®šçš„æ–‡ä»¶å°†è®°å½•httpdå®ˆæŠ¤è¿›ç¨‹çš„è¿›ç¨‹å·ï¼Œç”±äºhttpdèƒ½è‡ªåŠ¨å¤åˆ¶å…¶è‡ªèº«ï¼Œå› æ­¤ç³»ç»Ÿä¸­æœ‰å¤šä¸ªhttpdè¿›ç¨‹ï¼Œä½†åªæœ‰ä¸€ä¸ªè¿›ç¨‹ä¸ºæœ€åˆå¯åŠ¨çš„è¿›ç¨‹ï¼Œå®ƒä¸ºå…¶ä»–è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œå¯¹è¿™ä¸ªè¿›ç¨‹å‘é€ä¿¡å·å°†å½±å“æ‰€æœ‰çš„httpdè¿›ç¨‹ã€‚PidFILEå®šä¹‰çš„æ–‡ä»¶ä¸­å°±è®°å½•httpdçˆ¶è¿›ç¨‹çš„è¿›ç¨‹å·ã€‚</span><br><span class="line">ã€€ã€€</span><br><span class="line"><span class="meta">#</span><span class="bash"> Timeout 300</span></span><br><span class="line">	Timeoutå®šä¹‰å®¢æˆ·ç¨‹åºå’ŒæœåŠ¡å™¨è¿æ¥çš„è¶…æ—¶é—´éš”ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´é—´éš”ï¼ˆç§’ï¼‰åæœåŠ¡å™¨å°†æ–­å¼€ä¸å®¢æˆ·æœºçš„è¿æ¥ã€‚</span><br><span class="line"><span class="meta">#</span><span class="bash"> KeepAlive On</span></span><br><span class="line">	åœ¨HTTP 1.0ä¸­ï¼Œä¸€æ¬¡è¿æ¥åªèƒ½ä½œä¼ è¾“ä¸€æ¬¡HTTPè¯·æ±‚ï¼Œè€ŒKeepAliveå‚æ•°ç”¨äºæ”¯æŒHTTP 1.1ç‰ˆæœ¬çš„ä¸€æ¬¡è¿æ¥ã€å¤šæ¬¡ä¼ è¾“åŠŸèƒ½ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸€æ¬¡è¿æ¥ä¸­ä¼ é€’å¤šä¸ªHTTPè¯·æ±‚ã€‚ä¸è¿‡åªæœ‰è¾ƒæ–°çš„æµè§ˆå™¨æ‰æ”¯æŒè¿™ä¸ªåŠŸèƒ½</span><br><span class="line"><span class="meta">#</span><span class="bash"> MaxKeepAliveRequests 100</span></span><br><span class="line">	MaxKeepAliveRequestsä¸ºä¸€æ¬¡è¿æ¥å¯ä»¥è¿›è¡Œçš„HTTPè¯·æ±‚çš„æœ€å¤§è¯·æ±‚æ¬¡æ•°ã€‚å°†å…¶å€¼è®¾ä¸º0å°†æ”¯æŒåœ¨ä¸€æ¬¡è¿æ¥å†…è¿›è¡Œæ— é™æ¬¡çš„ä¼ è¾“è¯·æ±‚ã€‚äº‹å®ä¸Šæ²¡æœ‰å®¢æˆ·ç¨‹åºåœ¨ä¸€æ¬¡è¿æ¥ä¸­è¯·æ±‚å¤ªå¤šçš„é¡µé¢ï¼Œé€šå¸¸è¾¾ä¸åˆ°è¿™ä¸ªä¸Šé™å°±å®Œæˆè¿æ¥äº†ã€‚</span><br><span class="line"><span class="meta">#</span><span class="bash"> KeepAliveTimeout 15</span></span><br><span class="line">	KeepAliveTimeoutæµ‹è¯•ä¸€æ¬¡è¿æ¥ä¸­çš„å¤šæ¬¡è¯·æ±‚ä¼ è¾“ä¹‹é—´çš„æ—¶é—´ï¼Œå¦‚æœæœåŠ¡å™¨å·²ç»å®Œæˆäº†ä¸€æ¬¡è¯·æ±‚ï¼Œä½†ä¸€ç›´æ²¡æœ‰æ¥æ”¶åˆ°å®¢æˆ·ç¨‹åºçš„ä¸‹ä¸€æ¬¡è¯·æ±‚ï¼Œåœ¨é—´éš”è¶…è¿‡äº†è¿™ä¸ªå‚æ•°è®¾ç½®çš„å€¼ä¹‹åï¼ŒæœåŠ¡å™¨å°±æ–­å¼€è¿æ¥ã€‚</span><br><span class="line"><span class="meta">#</span><span class="bash"> ThreadsPerChild 50</span></span><br><span class="line">	è®¾ç½®æœåŠ¡å™¨ä½¿ç”¨è¿›ç¨‹çš„æ•°ç›®ã€‚è¿™æ˜¯ä»¥æœåŠ¡å™¨çš„å“åº”é€Ÿåº¦ä¸ºå‡†çš„, æ•°ç›®å¤ªå¤§åˆ™ä¼šå˜æ…¢</span><br><span class="line"><span class="meta">#</span><span class="bash"> MaxRequestsPerChild 30</span></span><br><span class="line">	ä½¿ç”¨å­è¿›ç¨‹çš„æ–¹å¼æä¾›æœåŠ¡çš„WebæœåŠ¡ï¼Œå¸¸ç”¨çš„æ–¹å¼æ˜¯ä¸€ä¸ªå­è¿›ç¨‹ä¸ºä¸€æ¬¡è¿æ¥æœåŠ¡ï¼Œè¿™æ ·é€ æˆçš„é—®é¢˜å°±æ˜¯æ¯æ¬¡è¿æ¥éƒ½éœ€è¦ç”Ÿæˆã€é€€å‡ºå­è¿›ç¨‹çš„ç³»ç»Ÿæ“ä½œï¼Œä½¿å¾—è¿™äº›é¢å¤–çš„å¤„ç†è¿‡ç¨‹å æ®äº†è®¡ç®—æœºçš„å¤§é‡å¤„ç†èƒ½åŠ›ã€‚å› æ­¤æœ€å¥½çš„æ–¹å¼æ˜¯ä¸€ä¸ªå­è¿›ç¨‹å¯ä»¥ä¸ºå¤šæ¬¡è¿æ¥è¯·æ±‚æœåŠ¡ï¼Œè¿™æ ·å°±ä¸éœ€è¦è¿™äº›ç”Ÿæˆã€é€€å‡ºè¿›ç¨‹çš„ç³»ç»Ÿæ¶ˆè€—ï¼ŒApacheå°±é‡‡ç”¨äº†è¿™æ ·çš„æ–¹å¼ï¼Œä¸€æ¬¡è¿æ¥ç»“æŸåï¼Œå­è¿›ç¨‹å¹¶ä¸é€€å‡ºï¼Œè€Œæ˜¯åœç•™åœ¨ç³»ç»Ÿä¸­ç­‰å¾…ä¸‹ä¸€æ¬¡æœåŠ¡è¯·æ±‚ï¼Œè¿™æ ·å°±æå¤§çš„æé«˜äº†æ€§èƒ½ã€‚ä½†ç”±äºåœ¨å¤„ç†è¿‡ç¨‹ä¸­å­è¿›ç¨‹è¦ä¸æ–­çš„ç”³è¯·å’Œé‡Šæ”¾å†…å­˜ï¼Œæ¬¡æ•°å¤šäº†å°±ä¼šé€ æˆä¸€äº›å†…å­˜åƒåœ¾ï¼Œå°±ä¼šå½±å“ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œå¹¶ä¸”å½±å“ç³»ç»Ÿèµ„æºçš„æœ‰æ•ˆåˆ©ç”¨ã€‚å› æ­¤åœ¨ä¸€ä¸ªå‰¯æœ¬å¤„ç†è¿‡ä¸€å®šæ¬¡æ•°çš„è¯·æ±‚ä¹‹åï¼Œå°±å¯ä»¥è®©è¿™ä¸ªå­è¿›ç¨‹å‰¯æœ¬é€€å‡ºï¼Œå†ä»åŸå§‹çš„htt pdè¿›ç¨‹ä¸­é‡æ–°å¤åˆ¶ä¸€ä¸ªå¹²å‡€çš„å‰¯æœ¬ï¼Œè¿™æ ·å°±èƒ½æé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚è¿™æ ·ï¼Œæ¯ä¸ªå­è¿›ç¨‹å¤„ç†æœåŠ¡è¯·æ±‚æ¬¡æ•°ç”±MaxRe questPerChildå®šä¹‰ã€‚ ç¼ºçœçš„è®¾ç½®å€¼ä¸º30ï¼Œè¿™ä¸ªå€¼å¯¹äºå…·å¤‡é«˜ç¨³å®šæ€§ç‰¹ç‚¹çš„FreeBSDç³»ç»Ÿæ¥è®²æ˜¯è¿‡äºä¿å®ˆçš„è®¾ç½®ï¼Œå¯ä»¥è®¾ç½®ä¸º1000ç”šè‡³æ›´é«˜ï¼Œè®¾ç½®ä¸º0æ”¯æŒæ¯ä¸ªå‰¯æœ¬è¿›è¡Œæ— é™æ¬¡çš„æœåŠ¡å¤„ç†ã€‚ã€€ã€€ã€€ã€€</span><br><span class="line"><span class="meta">#</span><span class="bash"> ServerAdmin root@localhost</span></span><br><span class="line">	é…ç½®æ–‡ä»¶ä¸­åº”è¯¥æ”¹å˜çš„ä¹Ÿè®¸åªæœ‰ServerAdminï¼Œ è¿™ä¸€é¡¹ç”¨äºé…ç½®WWWæœåŠ¡å™¨çš„ç®¡ç†å‘˜çš„emailåœ°å€ï¼Œè¿™å°†åœ¨HTTPæœåŠ¡å‡ºç°é”™è¯¯çš„æ¡ä»¶ä¸‹è¿”å›ç»™æµè§ˆå™¨ï¼Œä»¥ä¾¿è®©Webä½¿ç”¨è€…å’Œç®¡ç†å‘˜è”ç³»ï¼ŒæŠ¥å‘Šé”™è¯¯ã€‚ä¹ æƒ¯ä¸Šä½¿ç”¨æœåŠ¡å™¨ä¸Šçš„webmasterä½œä¸ºWWWæœåŠ¡å™¨çš„ç®¡ç†å‘˜ï¼Œé€šè¿‡é‚®ä»¶æœåŠ¡å™¨çš„åˆ«åæœºåˆ¶ï¼Œå°†å‘é€åˆ°webmaster çš„ç”µå­é‚®ä»¶å‘é€ç»™çœŸæ­£çš„Webç®¡ç†å‘˜ã€‚</span><br><span class="line"><span class="meta">#</span><span class="bash"> ServerName localhost</span></span><br><span class="line">	ç¼ºçœæƒ…å†µä¸‹ï¼Œå¹¶ä¸éœ€è¦æŒ‡å®šè¿™ä¸ªServerNameå‚æ•°ï¼ŒæœåŠ¡å™¨å°†è‡ªåŠ¨é€šè¿‡åå­—è§£æè¿‡ç¨‹æ¥è·å¾—è‡ªå·±çš„åå­—ï¼Œä½†å¦‚æœæœåŠ¡å™¨çš„åå­—è§£ææœ‰é—®é¢˜ï¼ˆé€šå¸¸ä¸ºåå‘è§£æä¸æ­£ç¡®ï¼‰ï¼Œæˆ–è€…æ²¡æœ‰æ­£å¼çš„DNSåå­—ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™é‡ŒæŒ‡å®šI Påœ°å€ã€‚å½“ServerNameè®¾ç½®ä¸æ­£ç¡®çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¸èƒ½æ­£å¸¸å¯åŠ¨ã€‚</span><br><span class="line">é€šå¸¸ä¸€ä¸ªWebæœåŠ¡å™¨å¯ä»¥å…·æœ‰å¤šä¸ªåå­—ï¼Œå®¢æˆ·æµè§ˆå™¨å¯ä»¥ä½¿ç”¨æ‰€æœ‰è¿™äº›åå­—æˆ–IPåœ°å€æ¥è®¿é—®è¿™å°æœåŠ¡å™¨ï¼Œä½†åœ¨æ²¡æœ‰å®šä¹‰è™šæ‹Ÿä¸»æœºçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨æ€»æ˜¯ä»¥è‡ªå·±çš„æ­£å¼åå­—å›åº”æµè§ˆå™¨ã€‚ServerNameå°±å®šä¹‰äº†WebæœåŠ¡å™¨è‡ªå·±æ‰¿è®¤çš„æ­£å¼åå­—ï¼Œä¾‹å¦‚ä¸€å°æœåŠ¡å™¨åå­—ï¼ˆåœ¨DNSä¸­å®šä¹‰äº†Aç±»å‹ï¼‰ä¸ºfreebsd.exmaple.org.cnï¼ŒåŒæ—¶ä¸ºäº†æ–¹ä¾¿è®°å¿†è¿˜å®šä¹‰äº†ä¸€ä¸ªåˆ«åï¼ˆCNAMEè®°å½•ï¼‰ä¸ºwww.exmaple.org.cnï¼Œé‚£ä¹ˆApacheè‡ªåŠ¨è§£æå¾—åˆ°çš„åå­—å°±ä¸ºfreebsd.example.org.cnï¼Œè¿™æ ·ä¸ç®¡å®¢æˆ·æµè§ˆå™¨ä½¿ç”¨å“ªä¸ªåå­—å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ€»æ˜¯å‘Šè¯‰å®¢æˆ·ç¨‹åºè‡ªå·±ä¸ºfreebsd.example.org.cnã€‚è™½ç„¶è¿™ä¸€èˆ¬å¹¶ä¸ä¼šé€ æˆä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æŸä¸€å¤©æœåŠ¡å™¨å¯èƒ½è¿ç§»åˆ°å…¶ä»–è®¡ç®—æœºä¸Šï¼Œè€Œåªæƒ³é€šè¿‡æ›´æ”¹DNSä¸­çš„wwwåˆ«åé…ç½®å°±å®Œæˆè¿ç§»ä»»åŠ¡ï¼Œæ‰€ä»¥ä¸æƒ³è®©å®¢æˆ·åœ¨å…¶ä¹¦ç­¾ä¸­ä½¿ç”¨ freebsdè®°å½•ä¸‹è¿™ä¸ªæœåŠ¡å™¨çš„åœ°å€ï¼Œå°±å¿…é¡»ä½¿ç”¨ServerNameæ¥é‡æ–°æŒ‡å®šæœåŠ¡å™¨çš„æ­£å¼åå­—ã€‚</span><br><span class="line">ã€€ã€€</span><br><span class="line">3ï¼‰</span><br><span class="line"><span class="meta">#</span><span class="bash"> DocumentRoot â€œ/var/www/htmlâ€œ</span></span><br><span class="line">	DocumentRootå®šä¹‰è¿™ä¸ªæœåŠ¡å™¨å¯¹å¤–å‘å¸ƒçš„è¶…æ–‡æœ¬æ–‡æ¡£å­˜æ”¾çš„è·¯å¾„ï¼Œå®¢æˆ·ç¨‹åºè¯·æ±‚çš„UR Lå°±è¢«æ˜ å°„ä¸ºè¿™ä¸ªç›®å½•ä¸‹çš„ç½‘é¡µæ–‡ä»¶ã€‚è¿™ä¸ªç›®å½•ä¸‹çš„å­ç›®å½•ï¼Œä»¥åŠä½¿ç”¨ç¬¦å·è¿æ¥æŒ‡å‡ºçš„æ–‡ä»¶å’Œç›®å½•éƒ½èƒ½è¢«æµè§ˆå™¨è®¿é—®ï¼Œåªæ˜¯è¦åœ¨URLä¸Šä½¿ç”¨åŒæ ·çš„ç›¸å¯¹ç›®å½•åã€‚æ³¨æ„ï¼Œç¬¦å·è¿æ¥è™½ç„¶é€»è¾‘ä¸Šä½äºæ ¹æ–‡æ¡£ç›®å½•ä¹‹ä¸‹ï¼Œä½†å®é™…ä¸Šå¯ä»¥ä½äºè®¡ç®—æœºä¸Šçš„ä»»æ„ç›®å½•ä¸­ï¼Œå› æ­¤å¯ä»¥ä½¿å®¢æˆ·ç¨‹åºèƒ½è®¿é—®é‚£äº›æ ¹æ–‡æ¡£ç›®å½•ä¹‹å¤–çš„ç›®å½•ï¼Œè¿™åœ¨å¢åŠ äº†çµæ´»æ€§çš„åŒæ—¶ä½†å‡å°‘äº†å®‰å…¨æ€§ã€‚Apacheåœ¨ç›®å½•çš„è®¿é—®æ§åˆ¶ä¸­æä¾›äº†FollowSymLinksé€‰é¡¹æ¥æ‰“å¼€æˆ–å…³é—­æ”¯æŒç¬¦å·è¿æ¥çš„ç‰¹æ€§ã€‚</span><br><span class="line">4ï¼‰</span><br><span class="line"><span class="meta">#</span><span class="bash"> &lt;Directory /&gt;</span></span><br><span class="line">ã€€ã€€ Options FollowSymLinks</span><br><span class="line">ã€€ã€€ AllowOverride None</span><br><span class="line">ã€€ã€€&lt;/Directory&gt;</span><br><span class="line">	ApacheæœåŠ¡å™¨å¯ä»¥é’ˆå¯¹ç›®å½•è¿›è¡Œæ–‡æ¡£çš„è®¿é—®æ§åˆ¶ï¼Œç„¶è€Œè®¿é—®æ§åˆ¶å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å®ç°ï¼Œä¸€ä¸ªæ˜¯åœ¨è®¾ç½®æ–‡ä»¶ httpd.confï¼ˆæˆ–access.confï¼‰ä¸­é’ˆå¯¹æ¯ä¸ªç›®å½•è¿›è¡Œè®¾ç½®ï¼Œå¦ä¸€ä¸ªæ–¹æ³•æ˜¯åœ¨æ¯ä¸ªç›®å½•ä¸‹è®¾ç½®è®¿é—®æ§åˆ¶æ–‡ä»¶ï¼Œé€šå¸¸è®¿é—®æ§åˆ¶æ–‡ä»¶åå­—ä¸º.htaccessã€‚è™½ç„¶ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹å¼éƒ½èƒ½ç”¨äºæ§åˆ¶æµè§ˆå™¨çš„è®¿é—®ï¼Œç„¶è€Œä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹æ³•è¦æ±‚æ¯æ¬¡æ”¹åŠ¨åé‡æ–°å¯åŠ¨httpdå®ˆæŠ¤è¿›ç¨‹ï¼Œæ¯”è¾ƒä¸çµæ´»ï¼Œå› æ­¤ä¸»è¦ç”¨äºé…ç½®æœåŠ¡å™¨ç³»ç»Ÿçš„æ•´ä½“å®‰å…¨æ§åˆ¶ç­–ç•¥ï¼Œè€Œä½¿ç”¨æ¯ä¸ªç›®å½•ä¸‹çš„.htaccessæ–‡ä»¶è®¾ç½®å…·ä½“ç›®å½•çš„è®¿é—®æ§åˆ¶æ›´ä¸ºçµæ´»æ–¹ä¾¿.</span><br><span class="line">ã€€	ç”±äºApacheå¯¹ä¸€ä¸ªç›®å½•çš„è®¿é—®æ§åˆ¶è®¾ç½®æ˜¯èƒ½å¤Ÿè¢«ä¸‹ä¸€çº§ç›®å½•ç»§æ‰¿çš„ï¼Œå› æ­¤å¯¹æ ¹ç›®å½•çš„è®¾ç½®å°†å½±å“åˆ°å®ƒçš„ä¸‹çº§ç›®å½•ã€‚æ³¨æ„ç”±äºAllowOverride Noneçš„è®¾ç½®ï¼Œä½¿å¾—ApacheæœåŠ¡å™¨ä¸éœ€è¦æŸ¥çœ‹æ ¹ç›®å½•ä¸‹çš„è®¿é—®æ§åˆ¶æ–‡ä»¶ï¼Œä¹Ÿä¸éœ€è¦æŸ¥çœ‹ä»¥ä¸‹å„çº§ç›®å½•ä¸‹çš„è®¿é—®æ§åˆ¶æ–‡ä»¶ï¼Œç›´è‡³httpd.confï¼ˆæˆ–access.conf ï¼‰ä¸­ä¸ºæŸä¸ªç›®å½•æŒ‡å®šäº†å…è®¸Alloworrideï¼Œå³å…è®¸æŸ¥çœ‹è®¿é—®æ§åˆ¶æ–‡ä»¶ã€‚ç”±äºApacheå¯¹ç›®å½•è®¿é—®æ§åˆ¶æ˜¯é‡‡ç”¨çš„ç»§æ‰¿æ–¹å¼ï¼Œå¦‚æœä»æ ¹ç›®å½•å°±å…è®¸æŸ¥çœ‹è®¿é—®æ§åˆ¶æ–‡ä»¶ï¼Œé‚£ä¹ˆApacheå°±å¿…é¡»ä¸€çº§ä¸€çº§çš„æŸ¥çœ‹è®¿é—®æ§åˆ¶æ–‡ä»¶ï¼Œå¯¹ç³»ç»Ÿæ€§èƒ½ä¼šé€ æˆå½±å“ã€‚è€Œç¼ºçœå…³é—­äº†æ ¹ç›®å½•çš„è¿™ä¸ªç‰¹æ€§ï¼Œå°±ä½¿å¾—Apacheä»httpd.confä¸­å…·ä½“æŒ‡å®šçš„ç›®å½•å‘ä¸‹æœå¯»ï¼Œå‡å°‘äº†æœå¯»çš„çº§æ•°ï¼Œå¢åŠ äº†ç³»ç»Ÿæ€§èƒ½ã€‚å› æ­¤å¯¹äºç³»ç»Ÿæ ¹ç›®å½•è®¾ç½®AllowOverride Noneä¸ä½†å¯¹äºç³»ç»Ÿå®‰å…¨æœ‰å¸®åŠ©ï¼Œä¹Ÿæœ‰ç›Šäºç³»ç»Ÿæ€§èƒ½ã€‚</span><br><span class="line">ã€€ã€€&lt;Directory /&gt;</span><br><span class="line">   Options Indexes FollowSymLinks</span><br><span class="line">ã€€ã€€ AllowOverride None</span><br><span class="line">ã€€ã€€ Order allow,deny</span><br><span class="line">ã€€ã€€ Allow from all</span><br><span class="line">ã€€ã€€&lt;/Directory&gt;</span><br><span class="line">	è¿™é‡Œå®šä¹‰çš„æ˜¯ç³»ç»Ÿå¯¹å¤–å‘å¸ƒæ–‡æ¡£çš„ç›®å½•çš„è®¿é—®è®¾ç½®ï¼Œè®¾ç½®ä¸åŒçš„AllowOverrideé€‰é¡¹ï¼Œä»¥å®šä¹‰é…ç½®æ–‡ä»¶ä¸­çš„ç›®å½•è®¾ç½®å’Œç”¨æˆ·ç›®å½•ä¸‹çš„å®‰å…¨æ§åˆ¶æ–‡ä»¶çš„å…³ç³»ï¼Œè€ŒOptionsé€‰é¡¹ç”¨äºå®šä¹‰è¯¥ç›®å½•çš„ç‰¹æ€§ã€‚</span><br><span class="line"><span class="meta">#</span><span class="bash">  ErrorLog /var/<span class="built_in">log</span>/httpd-error.log</span></span><br><span class="line">ã€€ã€€LogLevel warn</span><br><span class="line">ã€€ã€€LogFormat â€œ%h %l %u %t \â€œ%r\â€œ %&gt;s %b \â€œ%&#123;Referer&#125;i\â€œ \â€œ%&#123;User-Agent&#125;i\â€œâ€œ combined</span><br><span class="line">ã€€ã€€LogFormat â€œ%h %l %u %t \â€œ%r\â€œ %&gt;s %bâ€œ common</span><br><span class="line">ã€€ã€€LogFormat â€œ%&#123;Referer&#125;i -&gt; %Uâ€œ referer</span><br><span class="line">ã€€ã€€LogFormat â€œ%&#123;User-agent&#125;iâ€œ agent</span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash">CustomLog /var/<span class="built_in">log</span>/httpd-access.log common</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash">CustomLog /var/<span class="built_in">log</span>/httpd-referer.log referer</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash">CustomLog /var/<span class="built_in">log</span>/httpd-agent.log agent</span></span><br><span class="line">ã€€ã€€CustomLog /var/log/httpd-access.log combined</span><br><span class="line">	è¿™é‡Œå®šä¹‰äº†ç³»ç»Ÿæ—¥å¿—çš„å½¢å¼ï¼Œå¯¹äºæœåŠ¡å™¨é”™è¯¯è®°å½•ï¼Œç”±ErrorLogã€LogLevel æ¥å®šä¹‰ä¸åŒçš„é”™è¯¯æ—¥å¿—æ–‡ä»¶åŠå…¶è®°å½•å†…å®¹ã€‚ è¿™æ˜¯é€šè¿‡åœ¨ CustomLogä¸­æŒ‡å®šä¸åŒçš„è®°å½•ç±»å‹æ¥å®Œæˆçš„ã€‚commonè¡¨ç¤ºæ™®é€šçš„å¯¹å•é¡µé¢è¯·æ±‚è®¿é—®è®°å½•ï¼Œrefererè¡¨ç¤ºæ¯ä¸ªé¡µé¢çš„å¼•ç”¨è®°å½•ï¼Œå¯ä»¥çœ‹å‡ºä¸€ä¸ªé¡µé¢ä¸­åŒ…å«çš„è¯·æ±‚æ•°ï¼Œagentè¡¨ç¤ºå¯¹å®¢æˆ·æœºçš„ç±»å‹è®°å½•ï¼Œæ˜¾ç„¶å¯ä»¥å°†ç°æœ‰çš„combined å®šä¹‰çš„è®¾ç½®è¡Œæ³¨é‡Šæ‰ï¼Œå¹¶ä½¿ç”¨commonã€refererå’Œagentä½œä¸ºCustomLogçš„å‚æ•°ï¼Œæ¥ä¸ºä¸åŒç§ç±»çš„æ—¥å¿—åˆ†åˆ«æŒ‡å®šæ—¥å¿—è®°å½•æ–‡ä»¶ã€‚æ˜¾ç„¶ï¼ŒLogFormatæ˜¯ç”¨äºå®šä¹‰ä¸åŒç±»å‹çš„æ—¥å¿—è¿›è¡Œè®°å½•æ—¶ä½¿ç”¨çš„æ ¼å¼ï¼Œ è¿™é‡Œä½¿ç”¨äº†ä»¥%å¼€å¤´çš„å®å®šä¹‰ï¼Œä»¥è®°å½•ä¸åŒçš„å†…å®¹ã€‚</span><br><span class="line">å¦‚æœè¿™äº›å‚æ•°æŒ‡å®šçš„æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆå°±æ˜¯ç›¸å¯¹äºServerRootçš„è·¯å¾„ã€‚</span><br><span class="line"><span class="meta">#</span><span class="bash"> Alias /icons/ â€œ/usr/<span class="built_in">local</span>/www/icons/â€œ</span></span><br><span class="line">ã€€ã€€ Options Indexes MultiViews</span><br><span class="line">ã€€ã€€ AllowOverride None</span><br><span class="line">ã€€ã€€ Order allow,deny</span><br><span class="line">ã€€ã€€ Allow from all</span><br><span class="line">	Aliaså‚æ•°ç”¨äºå°†URLä¸æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„çœŸå®ä½ç½®è¿›è¡Œç›´æ¥æ˜ å°„ï¼Œä¸€èˆ¬çš„æ–‡æ¡£å°†åœ¨DocumentRoot ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶è€Œä½¿ç”¨Aliaså®šä¹‰çš„è·¯å¾„å°†ç›´æ¥æ˜ å°„åˆ°ç›¸åº”ç›®å½•ä¸‹ï¼Œè€Œä¸å†åˆ°DocumentRoot ä¸‹é¢è¿›è¡ŒæŸ¥è¯¢ã€‚å› æ­¤Aliaså¯ä»¥ç”¨æ¥æ˜ å°„ä¸€äº›å…¬ç”¨æ–‡ä»¶çš„è·¯å¾„ï¼Œä¾‹å¦‚ä¿å­˜äº†å„ç§å¸¸ç”¨å›¾æ ‡çš„iconsè·¯å¾„ã€‚è¿™æ ·ä½¿å¾—é™¤äº†ä½¿ç”¨ç¬¦å·è¿æ¥ä¹‹å¤–ï¼Œæ–‡æ¡£æ ¹ç›®å½•ï¼ˆDocumentRootï¼‰å¤–çš„ç›®å½•ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨äº†Aliasæ˜ å°„ï¼Œæä¾›ç»™æµè§ˆå™¨è®¿é—®ã€‚</span><br><span class="line">å®šä¹‰å¥½æ˜ å°„çš„è·¯å¾„ä¹‹åï¼Œåº”è¯¥éœ€è¦ä½¿ç”¨Directoryè¯­å¥è®¾ç½®è®¿é—®é™åˆ¶ã€‚</span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash">NameVirtualHost 12.34.56.78:80</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash">NameVirtualHost 12.34.56.78</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash"> ServerAdmin webmaster@host.some_domain.com</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash"> DocumentRoot /www/docs/host.some_domain.com</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash"> ServerName host.some_domain.com</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash"> ErrorLog logs/host.some_domain.com-error_log</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span><span class="bash"> CustomLog logs/host.some_domain.com-access_log common</span></span><br><span class="line"><span class="meta">ã€€ã€€#</span></span><br><span class="line">	è¿™ä¸ªå­—æ®µæ˜¯è™šæ‹Ÿä¸»æœºçš„ç›¸å…³å†…å®¹ï¼Œè™šæ‹Ÿä¸»æœºæ˜¯åœ¨ä¸€å°WebæœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥ä¸ºå¤šä¸ªå•ç‹¬åŸŸåæä¾›WebæœåŠ¡ï¼Œå¹¶ä¸”æ¯ä¸ªåŸŸåéƒ½å®Œå…¨ç‹¬ç«‹ï¼ŒåŒ…æ‹¬å…·æœ‰å®Œå…¨ç‹¬ç«‹çš„æ–‡æ¡£ç›®å½•ç»“æ„åŠè®¾ç½®ï¼Œè¿™æ ·åŸŸåä¹‹é—´å®Œå…¨ç‹¬ç«‹ï¼Œä¸ä½†ä½¿ç”¨æ¯ä¸ªåŸŸåè®¿é—®åˆ°çš„å†…å®¹å®Œå…¨ç‹¬ç«‹ï¼Œå¹¶ä¸”ä½¿ç”¨å¦ä¸€ä¸ªåŸŸåæ— æ³•è®¿é—®å…¶ä»–åŸŸåæä¾›çš„ç½‘é¡µå†…å®¹ã€‚</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxåŸºç¡€æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>æ—¶é—´åŒæ­¥æœåŠ¡NTPå’ŒChony</title>
    <url>/2016/12/23/booboo_easy_service/06_ntp_chrony/</url>
    <content><![CDATA[<table>
<thead>
<tr>
<th align="left">æœåŠ¡</th>
<th align="left">åŸŸåè§£ææœåŠ¡</th>
<th align="left">æ–‡ä»¶å…±äº«æœåŠ¡</th>
<th align="left"></th>
<th align="left"></th>
<th align="left">webæœåŠ¡</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
<td align="left">DNS</td>
<td align="left">FTP</td>
<td align="left">NFS</td>
<td align="left">SAMBA</td>
<td align="left">APACHE</td>
</tr>
<tr>
<td align="left">è½¯ä»¶</td>
<td align="left">bind    bind-chroot</td>
<td align="left">vsftpd</td>
<td align="left">rpcbind nfs-utils</td>
<td align="left">samba    samba-common</td>
<td align="left">httpd</td>
</tr>
<tr>
<td align="left">æœåŠ¡</td>
<td align="left">named</td>
<td align="left">vsftpd</td>
<td align="left">rpcbind nfs</td>
<td align="left">smb nmb</td>
<td align="left">httpd</td>
</tr>
<tr>
<td align="left">daemon</td>
<td align="left">named</td>
<td align="left">vsftpd</td>
<td align="left">rpcbind nfs</td>
<td align="left">smbd nmbd</td>
<td align="left">httpd</td>
</tr>
<tr>
<td align="left">ç«¯å£å·</td>
<td align="left">53</td>
<td align="left">21</td>
<td align="left">111 2049</td>
<td align="left">137 138 139 445</td>
<td align="left">80 8080</td>
</tr>
<tr>
<td align="left">é…ç½®æ–‡ä»¶</td>
<td align="left">/etc/named.conf /etc/named.rfc1912.zones</td>
<td align="left">/etc/vsftpd/vsftpd.conf</td>
<td align="left">/etc/exports</td>
<td align="left">/etc/samba/smb.conf</td>
<td align="left">/etc/httpd/conf/httpd.conf</td>
</tr>
<tr>
<td align="left">æ•°æ®æ–‡ä»¶</td>
<td align="left">/var/named/</td>
<td align="left">/var/ftp/</td>
<td align="left"></td>
<td align="left">/var/lib/samba</td>
<td align="left">/var/www</td>
</tr>
<tr>
<td align="left">å®¢æˆ·ç«¯</td>
<td align="left"></td>
<td align="left">lftp</td>
<td align="left">rpcbind</td>
<td align="left">samba-client</td>
<td align="left">elinks</td>
</tr>
<tr>
<td align="left">å‘½ä»¤</td>
<td align="left">nslookup</td>
<td align="left">lftp</td>
<td align="left">nfs-utils mount</td>
<td align="left">smbclient</td>
<td align="left">links</td>
</tr>
</tbody></table>
<h3 id="NtpæœåŠ¡çš„ä½œç”¨"><a href="#NtpæœåŠ¡çš„ä½œç”¨" class="headerlink" title="NtpæœåŠ¡çš„ä½œç”¨"></a>NtpæœåŠ¡çš„ä½œç”¨</h3><p>å¤§å®¶è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çš„ä¸»æœºæ—¶é—´ä¸å‡†ï¼Œå¯ä»¥æ€ä¹ˆåšï¼Ÿæœ‰å°†ç¡¬ä»¶æ—¶é—´å’Œè½¯ä»¶æ—¶é—´åŒæ­¥çš„åŠæ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>date -s</code>å»è®¾ç½®ä¸€ä¸ªæ—¶é—´ï¼Œä½†æ˜¯ä½ æ€ä¹ˆçŸ¥é“ä½ è®¾ç½®çš„æ—¶é—´å°±ä¸€å®šå‡†äº†ï¼Œæˆ–è€…è¯´ä½ èƒ½ç¡®å®šç¡¬ä»¶æ—¶é—´ä¸€å®šå‡†ä¹ˆï¼Ÿä¸èƒ½ä¿è¯å§ï¼Ÿé‚£è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æ‰¾å¤©æ–‡å°æˆ–è€…ä¸€äº›ç½‘ç»œä¸Šçš„æ—¶é—´æœåŠ¡å™¨å»åšåŒæ­¥ï¼Œé‚£è¿™æ—¶å€™æ€ä¹ˆå»åšå‘¢ï¼Ÿ</p>
<p>è¿™é‡Œå°±ç”¨åˆ°ä¸€ç§æœåŠ¡äº†ï¼Œè¿™ç§æœåŠ¡å«åšntpæœåŠ¡ï¼Œå®ƒæ˜¯ä¸€ç§é’ˆå¯¹æ—¶é—´åŒæ­¥çš„æœåŠ¡ã€‚</p>
<h3 id="NtpæœåŠ¡çš„åŸç†"><a href="#NtpæœåŠ¡çš„åŸç†" class="headerlink" title="NtpæœåŠ¡çš„åŸç†"></a>NtpæœåŠ¡çš„åŸç†</h3><p>å…¶å®æ›´ç»†åŒ–æ¥è¯´ï¼ŒNTPæœåŠ¡å™¨ï¼ˆNetwork Time Protocolï¼‰æ˜¯ç”¨æ¥ä½¿è®¡ç®—æœºæ—¶é—´åŒæ­¥åŒ–çš„ä¸€ç§åè®®ï¼Œå®ƒå¯ä»¥ä½¿è®¡ç®—æœºå¯¹å…¶æœåŠ¡å™¨æˆ–æ—¶é’Ÿæºï¼ˆå¦‚çŸ³è‹±é’Ÿï¼ŒGPSç­‰ç­‰)åšåŒæ­¥åŒ–ï¼Œå®ƒå¯ä»¥æä¾›é«˜ç²¾å‡†åº¦çš„æ—¶é—´æ ¡æ­£ï¼ˆLANä¸Šä¸æ ‡å‡†é—´å·®å°äº1æ¯«ç§’ï¼ŒWANä¸Šå‡ åæ¯«ç§’ï¼‰ï¼Œä¸”å¯ä»‹ç”±åŠ å¯†ç¡®è®¤çš„æ–¹å¼æ¥é˜²æ­¢æ¶æ¯’çš„åè®®æ”»å‡»ã€‚æ—¶é—´æŒ‰NTPæœåŠ¡å™¨çš„ç­‰çº§ä¼ æ’­ã€‚æŒ‰ç…§ç¦»å¤–éƒ¨UTCæºçš„è¿œè¿‘æŠŠæ‰€æœ‰æœåŠ¡å™¨å½’å…¥ä¸åŒçš„Stratumï¼ˆå±‚ï¼‰ä¸­ã€‚</p>
<p>Stratumå±‚ä¹Ÿæ˜¯ä¸€ä¸ªåˆ†å±‚å¼çš„ç»“æ„ï¼Œä¸‹ä¸€å±‚æ‰¾ä¸Šä¸€å±‚åšåŒæ­¥ï¼Œä¸Šä¸€å±‚è¿˜æœ‰ä¸Šä¸€å±‚ã€‚ä»¥æ­¤ç±»æ¨ã€‚</p>
<h3 id="æ—¶é—´åŒæ­¥æœåŠ¡é…ç½®"><a href="#æ—¶é—´åŒæ­¥æœåŠ¡é…ç½®" class="headerlink" title="æ—¶é—´åŒæ­¥æœåŠ¡é…ç½®"></a>æ—¶é—´åŒæ­¥æœåŠ¡é…ç½®</h3><p>æœåŠ¡ç«¯</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">rhel6</th>
<th align="left">rhel7</th>
</tr>
</thead>
<tbody><tr>
<td align="left">è½¯ä»¶</td>
<td align="left">ntp</td>
<td align="left">chrony</td>
</tr>
<tr>
<td align="left">service</td>
<td align="left">ntpd</td>
<td align="left">chronyd</td>
</tr>
<tr>
<td align="left">daemon</td>
<td align="left">ntpd</td>
<td align="left">chronyd</td>
</tr>
<tr>
<td align="left">é…ç½®æ–‡ä»¶</td>
<td align="left">/etc/ntp.conf</td>
<td align="left">/etc/chrony.conf</td>
</tr>
<tr>
<td align="left">æ•°æ®æ–‡ä»¶</td>
<td align="left">/var/lib/ntp</td>
<td align="left">/var/lib/chrony</td>
</tr>
<tr>
<td align="left">æ—¥å¿—æ–‡ä»¶</td>
<td align="left">/var/log/ntpstats</td>
<td align="left">/var/log/chrony</td>
</tr>
</tbody></table>
<p>å®¢æˆ·ç«¯</p>
<table>
<thead>
<tr>
<th align="left">å‘½ä»¤</th>
<th align="left">ntpdate</th>
<th align="left">timedatectl</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
<td align="left">ntpdate 172.25.0.11</td>
<td align="left">timedatectl set-ntp 1</td>
</tr>
</tbody></table>
<h3 id="é¡¹ç›®å®è·µ1ï¼šé…ç½®ntpæ—¶é—´åŒæ­¥æœåŠ¡å™¨"><a href="#é¡¹ç›®å®è·µ1ï¼šé…ç½®ntpæ—¶é—´åŒæ­¥æœåŠ¡å™¨" class="headerlink" title="é¡¹ç›®å®è·µ1ï¼šé…ç½®ntpæ—¶é—´åŒæ­¥æœåŠ¡å™¨"></a>é¡¹ç›®å®è·µ1ï¼šé…ç½®ntpæ—¶é—´åŒæ­¥æœåŠ¡å™¨</h3><p>rhel6 è½¯ä»¶</p>
<p>ntp-4.2.6p5-1.el6.x86_64</p>
<h4 id="é…ç½®è¯¦è§£"><a href="#é…ç½®è¯¦è§£" class="headerlink" title="é…ç½®è¯¦è§£"></a>é…ç½®è¯¦è§£</h4><p>NTPå®‰å…¨è®¾ç½®(restrict)</p>
<p>è¿è¡Œä¸€ä¸ªNTP Serverä¸éœ€è¦å ç”¨å¾ˆå¤šçš„ç³»ç»Ÿèµ„æº,æ‰€ä»¥ä¹Ÿä¸ç”¨ä¸“é—¨é…ç½®ç‹¬ç«‹çš„æœåŠ¡å™¨,å°±å¯ä»¥ç»™è®¸å¤šclientæä¾›æ—¶é—´åŒæ­¥æœåŠ¡, ä½†æ˜¯ä¸€äº›åŸºæœ¬çš„å®‰å…¨è®¾ç½®è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„é‚£ä¹ˆè¿™é‡Œä¸€ä¸ªå¾ˆç®€å•çš„æ€è·¯å°±æ˜¯ç¬¬ä¸€æˆ‘ä»¬åªå…è®¸å±€åŸŸç½‘å†…ä¸€éƒ¨åˆ†çš„ç”¨æˆ·è¿æ¥åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨. ç¬¬äºŒä¸ªå°±æ˜¯è¿™äº›clientä¸èƒ½ä¿®æ”¹æˆ‘ä»¬æœåŠ¡å™¨ä¸Šçš„æ—¶é—´</p>
<p>driftfile /var/lib/ntp/drift  #ä¾¦æµ‹BIOSæ—¶é’Ÿä¸Linuxç³»ç»Ÿæ—¶é—´çš„å·®å¼‚å†™å…¥æ¬¡æ–‡ä»¶ã€‚</p>
<p>åˆ©ç”¨restrict æ¥ç®¡ç†æƒé™æ§åˆ¶</p>
<p>Restrict [IP]  mask [netmask_IP] [parameter]</p>
<p>Parameter çš„å‚æ•°ä¸»è¦å¦‚ä¸‹ï¼š</p>
<ul>
<li>ignore :æ‹’ç»æ‰€æœ‰ç±»å‹çš„NTPè”æœºã€‚</li>
<li>nomodify: å®¢æˆ·ç«¯ä¸èƒ½ä½¿ç”¨ntpc ä¸ntpq è¿™ä¸¤ä¸ªç¨‹åºæ¥ä¿®æ”¹æœåŠ¡å™¨çš„æ—¶é—´å‚æ•°ï¼Œä½†å®¢æˆ·ç«¯å¯é€è¿‡è¿™éƒ¨ä¸»æœºæ¥è¿›è¡Œç½‘ç»œæ ¡æ—¶ï¼›</li>
<li>noquery:å®¢æˆ·ç«¯ä¸èƒ½å¤Ÿä½¿ç”¨ntpc ä¸ntpq ç­‰æŒ‡ä»¤æ¥æŸ¥è¯¢æ—¶é—´æœåŠ¡å™¨ï¼Œä¸æä¾›NTPçš„ç½‘ç»œæ ¡æ—¶ã€‚</li>
<li>notrap:ä¸æä¾›trap è¿™ä¸ªè¿ç¨‹äº‹ä»¶ç™»å…¥çš„åŠŸèƒ½ã€‚</li>
<li>notrust:æ‹’ç»æ²¡æœ‰è®¤è¯çš„å®¢æˆ·ç«¯ã€‚</li>
<li>Kod:kodæŠ€æœ¯å¯ä»¥é˜»æ­¢â€œKiss of Death â€œåŒ…å¯¹æœåŠ¡å™¨çš„ç ´åã€‚æ‹’ç»æœåŠ¡æ”»å‡»</li>
<li>Nopeer:ä¸ä¸å…¶ä»–åŒä¸€å±‚çš„NTPæœåŠ¡å™¨è¿›è¡Œæ—¶é—´åŒæ­¥ã€‚</li>
</ul>
<p>åˆ©ç”¨server è®¾å®šä¸Šå±‚NTPæœåŠ¡å™¨ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<p>server [IP or hostname] [prefer]</p>
<ul>
<li><p>perfer:è¡¨ç¤ºä¼˜å…ˆçº§æœ€é«˜</p>
</li>
<li><p>burst ï¼šå½“ä¸€ä¸ªè¿ç¨‹NTPæœåŠ¡å™¨å¯ç”¨æ—¶ï¼Œå‘å®ƒå‘é€ä¸€ç³»åˆ—çš„å¹¶å‘åŒ…è¿›è¡Œæ£€æµ‹ã€‚</p>
</li>
<li><p>iburst ï¼šå½“ä¸€ä¸ªè¿ç¨‹NTPæœåŠ¡å™¨ä¸å¯ç”¨æ—¶ï¼Œå‘å®ƒå‘é€ä¸€ç³»åˆ—çš„å¹¶å‘åŒ…è¿›è¡Œæ£€æµ‹ã€‚</p>
<p>æ³¨ï¼šé»˜è®¤æƒ…å†µå°15åˆ†é’Ÿåæ‰ä¼šä¸ä¸Šå±‚NTPæœåŠ¡å™¨è¿›è¡Œæ—¶é—´æ ¡å¯¹ã€‚</p>
</li>
</ul>
<blockquote>
<p>è°èƒ½æ¥åŒæ­¥æˆ‘çš„æ—¶é—´ï¼Ÿ</p>
</blockquote>
<p>é¦–å…ˆæˆ‘ä»¬å¯¹äºé»˜è®¤çš„clientæ‹’ç»æ‰€æœ‰çš„æ“ä½œ</p>
<p>ä»£ç :<br><code>restrict default kod nomodify notrap nopeer noquery</code></p>
<p>ç„¶åå…è®¸æœ¬æœºåœ°å€ä¸€åˆ‡çš„æ“ä½œ</p>
<p>ä»£ç :<br><code>restrict 127.0.0.1</code></p>
<p>æœ€åæˆ‘ä»¬å…è®¸å±€åŸŸç½‘å†…æ‰€æœ‰clientè¿æ¥åˆ°è¿™å°æœåŠ¡å™¨åŒæ­¥æ—¶é—´.ä½†æ˜¯æ‹’ç»è®©ä»–ä»¬ä¿®æ”¹æœåŠ¡å™¨ä¸Šçš„æ—¶é—´</p>
<p>ä»£ç :<br><code>restrict 172.25.0.0 mask 255.255.255.0 nomodify</code></p>
<blockquote>
<p>æˆ‘å»åŒæ­¥è°çš„æ—¶é—´ï¼Ÿ</p>
</blockquote>
<p>server     æ—¶é—´åŒæ­¥æœåŠ¡å™¨    å±‚æ•°æ¯”æˆ‘é«˜çš„ï¼ŒåŠæ•°å­—æ¯”æˆ‘å°çš„</p>
<p>ä»£ç :</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server  127.127.1.0     # local clock</span><br><span class="line">fudge   127.127.1.0 stratum 10</span><br></pre></td></tr></table></figure>

<p>####ã€€è¯¦ç»†æ­¥éª¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœåŠ¡å™¨ç«¯</span></span><br><span class="line"></span><br><span class="line">[root@rhel6 ~]# yum install -y ntp</span><br><span class="line">[root@rhel6 ~]# vim /etc/ntp.conf</span><br><span class="line">[root@rhel6 ~]# grep -v "^#" /etc/ntp.conf|grep -v "^$"</span><br><span class="line">driftfile /var/lib/ntp/drift</span><br><span class="line">restrict default kod nomodify notrap nopeer noquery</span><br><span class="line">restrict -6 default kod nomodify notrap nopeer noquery</span><br><span class="line">restrict 127.0.0.1</span><br><span class="line">restrict -6 ::1</span><br><span class="line">restrict 172.25.0.0 mask 255.255.255.0 nomodify</span><br><span class="line">server 172.25.0.11</span><br><span class="line">server  127.127.1.0     </span><br><span class="line">fudge   127.127.1.0 stratum 10</span><br><span class="line">includefile /etc/ntp/crypto/pw</span><br><span class="line">keys /etc/ntp/keys</span><br><span class="line">[root@rhel6 ~]# service ntpd start</span><br><span class="line">Starting ntpd:                                             [  OK  ]</span><br><span class="line">[root@rhel6 ~]# service iptables stop</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯</span></span><br><span class="line">[root@rhel7 ~]# which ntpdate</span><br><span class="line">/usr/sbin/ntpdate</span><br><span class="line">[root@rhel7 ~]# rpm -qf /usr/sbin/ntpdate</span><br><span class="line">ntpdate-4.2.6p5-18.el7.x86_64</span><br><span class="line">[root@rhel7 ~]# systemctl stop firewalld</span><br><span class="line">[root@rhel7 ~]# ntpdate 172.25.0.11</span><br><span class="line"> 2 Aug 06:36:51 ntpdate[8128]: step time server 172.25.0.11 offset -0.691491 sec</span><br><span class="line">[root@rhel7 ~]# date -s "2016-08-01"</span><br><span class="line">Mon Aug  1 00:00:00 EDT 2016</span><br><span class="line">[root@rhel7 ~]# date</span><br><span class="line">Mon Aug  1 00:00:01 EDT 2016</span><br><span class="line">[root@rhel7 ~]# ntpdate 172.25.0.11</span><br><span class="line"> 2 Aug 06:37:35 ntpdate[8140]: step time server 172.25.0.11 offset 110240.425235 sec</span><br><span class="line">[root@rhel7 ~]# date</span><br><span class="line">Tue Aug  2 06:37:37 EDT 2016</span><br></pre></td></tr></table></figure>

<h4 id="ä¸€äº›è¡¥å……å’Œæ‹¾é—ï¼ˆæŒºé‡è¦ï¼‰"><a href="#ä¸€äº›è¡¥å……å’Œæ‹¾é—ï¼ˆæŒºé‡è¦ï¼‰" class="headerlink" title="ä¸€äº›è¡¥å……å’Œæ‹¾é—ï¼ˆæŒºé‡è¦ï¼‰"></a>ä¸€äº›è¡¥å……å’Œæ‹¾é—ï¼ˆæŒºé‡è¦ï¼‰</h4><ol>
<li><p>é…ç½®æ–‡ä»¶ä¸­çš„driftfileæ˜¯ä»€ä¹ˆ?<br>æˆ‘ä»¬æ¯ä¸€ä¸ªsystem clockçš„é¢‘ç‡éƒ½æœ‰å°å°çš„è¯¯å·®,è¿™ä¸ªå°±æ˜¯ä¸ºä»€ä¹ˆæœºå™¨è¿è¡Œä¸€æ®µæ—¶é—´åä¼šä¸ç²¾ç¡®.NTPä¼šè‡ªåŠ¨æ¥ç›‘æµ‹æˆ‘ä»¬æ—¶é’Ÿçš„è¯¯å·®å€¼å¹¶äºˆä»¥è°ƒæ•´.ä½†é—®é¢˜æ˜¯è¿™æ˜¯ä¸€ä¸ªå†—é•¿çš„è¿‡ç¨‹,æ‰€ä»¥å®ƒä¼šæŠŠè®°å½•ä¸‹æ¥çš„è¯¯å·®å…ˆå†™å…¥driftfile.è¿™æ ·å³ä½¿ä½ é‡æ–°å¼€æœºä»¥åä¹‹å‰çš„è®¡ç®—ç»“æœä¹Ÿå°±ä¸ä¼šä¸¢å¤±äº†</p>
</li>
<li><p>å¦‚ä½•åŒæ­¥ç¡¬ä»¶æ—¶é’Ÿ?<br>NTPä¸€èˆ¬åªä¼šåŒæ­¥system clock. ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¹Ÿè¦åŒæ­¥RTC(hwclock)çš„è¯é‚£ä¹ˆåªéœ€è¦æŠŠä¸‹é¢çš„é€‰é¡¹æ‰“å¼€å°±å¯ä»¥äº†</p>
</li>
</ol>
<p>ä»£ç :</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vi /etc/sysconfig/ntpd</span></span><br><span class="line">SYNC_HWCLOCK=yes</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è®©rhel6è¿è¡Œntpdateæ›´æ–°æ—¶é—´æ—¶ï¼Œrhel6åŒæ­¥å¤±è´¥ï¼Œä¼šæç¤ºç«¯å£è¢«å ç”¨ï¼šå¦‚ä¸‹<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# ntpdate 172.25.0.11</span><br><span class="line"> 2 Aug 18:39:16 ntpdate[4831]: the NTP socket is in use, exiting</span><br></pre></td></tr></table></figure></li>
<li>åˆ©ç”¨crontabè®©rhel7 NTPå®šæ—¶æ›´æ–°æ—¶é—´<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">0 8 * * * /usr/sbin/ntpdate 172.25.0.11</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="chrony"><a href="#chrony" class="headerlink" title="chrony"></a>chrony</h3><p>chrony-1.29.1-1.el7.x86_64</p>
<p>RHELä»7.0å¼€å§‹æ”¹ç”¨chronyåŒæ­¥æ—¶é—´ï¼ŒåŸntpåŒæ­¥æ–¹å¼ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†è¦å®‰è£…ntpæœåŠ¡ã€‚</p>
<p>chronydæ˜¯ä¸€ä¸ªåœ¨ç³»ç»Ÿåå°è¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹ã€‚ä»–æ ¹æ®ç½‘ç»œä¸Šå…¶ä»–æ—¶é—´æœåŠ¡å™¨æ—¶é—´æ¥æµ‹é‡æœ¬æœºæ—¶é—´çš„åç§»é‡ä»è€Œè°ƒæ•´ç³»ç»Ÿæ—¶é’Ÿã€‚å¯¹äºå­¤ç«‹ç³»ç»Ÿï¼Œç”¨æˆ·å¯ä»¥æ‰‹åŠ¨å‘¨æœŸæ€§çš„è¾“å…¥æ­£ç¡®æ—¶é—´ï¼ˆé€šè¿‡chronycï¼‰ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œchronydå†³å®šè®¡ç®—æœºå¿«æ…¢çš„æ¯”ä¾‹ï¼Œå¹¶åŠ ä»¥çº æ­£ã€‚chronydå®ç°äº†NTPåè®®å¹¶ä¸”å¯ä»¥ä½œä¸ºæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ã€‚</p>
<h4 id="é¡¹ç›®å®è·µ2ï¼šé…ç½®chronyæ—¶é—´åŒæ­¥æœåŠ¡å™¨"><a href="#é¡¹ç›®å®è·µ2ï¼šé…ç½®chronyæ—¶é—´åŒæ­¥æœåŠ¡å™¨" class="headerlink" title="é¡¹ç›®å®è·µ2ï¼šé…ç½®chronyæ—¶é—´åŒæ­¥æœåŠ¡å™¨"></a>é¡¹ç›®å®è·µ2ï¼šé…ç½®chronyæ—¶é—´åŒæ­¥æœåŠ¡å™¨</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# yum install -y chrony</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# vim /etc/chrony.conf</span><br><span class="line">[root@rhel7 ~]# grep -v "^#" /etc/chrony.conf |grep -v "^$"</span><br><span class="line">server 172.25.0.10</span><br><span class="line">allow 172.25.0.0/24</span><br><span class="line">stratumweight 0</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">rtcsync</span><br><span class="line">makestep 10 3</span><br><span class="line">bindcmdaddress 127.0.0.1</span><br><span class="line">bindcmdaddress ::1</span><br><span class="line">keyfile /etc/chrony.keys</span><br><span class="line">commandkey 1</span><br><span class="line">generatecommandkey</span><br><span class="line">noclientlog</span><br><span class="line">logchange 0.5</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line">[root@rhel7 ~]# timedatectl</span><br><span class="line">      Local time: Tue 2016-08-02 07:24:15 EDT</span><br><span class="line">  Universal time: Tue 2016-08-02 11:24:15 UTC</span><br><span class="line">        RTC time: Tue 2016-08-02 11:24:15</span><br><span class="line">        Timezone: America/New_York (EDT, -0400)</span><br><span class="line">     NTP enabled: yes</span><br><span class="line">NTP synchronized: yes</span><br><span class="line"> RTC in local TZ: no</span><br><span class="line">      DST active: yes</span><br><span class="line"> Last DST change: DST began at</span><br><span class="line">                  Sun 2016-03-13 01:59:59 EST</span><br><span class="line">                  Sun 2016-03-13 03:00:00 EDT</span><br><span class="line"> Next DST change: DST ends (the clock jumps one hour backwards) at</span><br><span class="line">                  Sun 2016-11-06 01:59:59 EDT</span><br><span class="line">                  Sun 2016-11-06 01:00:00 EST</span><br></pre></td></tr></table></figure>

<h3 id="é¡¹ç›®æ±‡æ€»"><a href="#é¡¹ç›®æ±‡æ€»" class="headerlink" title="é¡¹ç›®æ±‡æ€»"></a>é¡¹ç›®æ±‡æ€»</h3><p><img src="sides/ntp-lab_Page_1.jpg" alt="ntp-lab_Page_1"></p>
<p><img src="sides/ntp-lab_Page_2.jpg" alt="ntp-lab_Page_2"></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxåŸºç¡€æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>é˜²ç«å¢™ iptables</title>
    <url>/2016/12/23/booboo_easy_service/07_iptables_firewalld/</url>
    <content><![CDATA[<h3 id="é˜²ç«å¢™çš„ä½œç”¨"><a href="#é˜²ç«å¢™çš„ä½œç”¨" class="headerlink" title="é˜²ç«å¢™çš„ä½œç”¨"></a>é˜²ç«å¢™çš„ä½œç”¨</h3><p>é˜²ç«å¢™æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå·¥ä½œåœ¨ç½‘ç»œè¾¹ç¼˜ï¼ˆä¸»æœºè¾¹ç¼˜ï¼‰ï¼Œå¯¹è¿›å‡ºç½‘ç»œæ•°æ®åŒ…åŸºäºä¸€å®šçš„è§„åˆ™æ£€æŸ¥ï¼Œå¹¶åœ¨åŒ¹é…æŸè§„åˆ™æ—¶ç”±è§„åˆ™å®šä¹‰çš„å¤„ç†è¿›è¡Œå¤„ç†çš„ä¸€ç»„åŠŸèƒ½çš„ç»„ä»¶ã€‚</p>
<h3 id="é˜²ç«å¢™ç±»å‹"><a href="#é˜²ç«å¢™ç±»å‹" class="headerlink" title="é˜²ç«å¢™ç±»å‹"></a>é˜²ç«å¢™ç±»å‹</h3><p>æ ¹æ®å·¥ä½œçš„å±‚æ¬¡çš„ä¸åŒæ¥åˆ’åˆ†ï¼Œå¸¸è§çš„é˜²ç«å¢™å·¥ä½œåœ¨OSIç¬¬ä¸‰å±‚ï¼Œå³ç½‘ç»œå±‚é˜²ç«å¢™ï¼Œå·¥ä½œåœ¨OSIç¬¬ä¸ƒå±‚çš„ç§°ä¸ºåº”ç”¨å±‚é˜²ç«å¢™ï¼Œæˆ–è€…ä»£ç†æœåŠ¡å™¨ï¼ˆä»£ç†ç½‘å…³ï¼‰ã€‚</p>
<p>ç½‘ç»œå±‚é˜²ç«å¢™åˆç§°åŒ…è¿‡æ»¤é˜²ç«å¢™ï¼Œåœ¨ç½‘ç»œå±‚å¯¹æ•°æ®åŒ…è¿›è¡Œé€‰æ‹©ï¼Œé€‰æ‹©çš„ä¾æ®æ˜¯ç³»ç»Ÿå†…è®¾ç½®çš„è¿‡æ»¤é€»è¾‘ï¼Œé€šè¿‡æ£€æŸ¥æ•°æ®æµä¸­æ¯ä¸ªæ•°æ®çš„æºåœ°å€ï¼Œç›®çš„åœ°å€ï¼Œæ‰€ç”¨ç«¯å£å·å’Œåè®®çŠ¶æ€ç­‰å› ç´ æ¥ç¡®å®šæ˜¯å¦å…è®¸è¯¥æ•°æ®åŒ…çš„é€šè¿‡ï¼Œä»¥åŠæ•°æ®åŒ…çš„æµå‘ç­‰ã€‚</p>
<p>è¿˜å¯ä»¥åˆ†ä¸ºç¡¬ä»¶é˜²ç«å¢™å’Œè½¯ä»¶é˜²ç«å¢™</p>
<h3 id="è½¯ä»¶é˜²ç«å¢™"><a href="#è½¯ä»¶é˜²ç«å¢™" class="headerlink" title="è½¯ä»¶é˜²ç«å¢™"></a>è½¯ä»¶é˜²ç«å¢™</h3><ul>
<li>EL6ä¸Šçš„é˜²ç«å¢™å«åšiptablesã€‚</li>
<li>EL7ä¸Šçš„é˜²ç«å¢™å«åšfirewalldã€‚</li>
</ul>
<h3 id="iptablesè¯­æ³•"><a href="#iptablesè¯­æ³•" class="headerlink" title="iptablesè¯­æ³•"></a>iptablesè¯­æ³•</h3><p>iptables -t table CMD chain rule-matcher -j target</p>
<pre><code>è¡¨      åŠ¨ä½œ é“¾    è§„åˆ™åŒ¹é…       æ‰§è¡Œæ“ä½œ</code></pre><h4 id="è¡¨table"><a href="#è¡¨table" class="headerlink" title="è¡¨table"></a>è¡¨table</h4><p>ä½¿ç”¨ -t æ¥æŒ‡å®šè¡¨,å¦‚æœçœç•¥,åˆ™ä»£è¡¨å¯¹ filter è¡¨è¿›è¡Œæ“ä½œ</p>
<ul>
<li>filter è¡¨:ç”¨äºè¿‡æ»¤æ•°æ®åŒ…</li>
<li>nat è¡¨:ç”¨äºä¿®æ”¹æ•°æ®åŒ…çš„æ¥æºå’Œç›®çš„åœ°</li>
<li>mangle è¡¨:ç”¨æˆ·ä¿®æ”¹æ•°æ®åŒ…çš„ç”Ÿå­˜å‘¨æœŸç­‰ç­‰</li>
<li>raw è¡¨:è·Ÿè¸ªæœºåˆ¶</li>
</ul>
<h4 id="CMDåŠ¨ä½œ"><a href="#CMDåŠ¨ä½œ" class="headerlink" title="CMDåŠ¨ä½œ"></a>CMDåŠ¨ä½œ</h4><ul>
<li>A è¿½åŠ </li>
<li>I æ’å…¥</li>
<li>D åˆ é™¤</li>
<li>L ç½—åˆ—</li>
<li>F æ¸…ç©º</li>
</ul>
<h4 id="è¡¨å½“ä¸­åŒ…å«é“¾chain"><a href="#è¡¨å½“ä¸­åŒ…å«é“¾chain" class="headerlink" title="è¡¨å½“ä¸­åŒ…å«é“¾chain"></a>è¡¨å½“ä¸­åŒ…å«é“¾chain</h4><p>é“¾æ˜¯ç”¨æ¥åŒºåˆ†æ•°æ®åŒ…çš„æµå‘çŠ¶æ€</p>
<ul>
<li>INPUT å…¥ç«™çš„æ•°æ®åŒ…</li>
<li>OUTPUT å‡ºç«™çš„æ•°æ®åŒ…</li>
<li>PREROUTING è·¯ç”±åˆ¤æ–­ä¹‹å‰çš„æ•°æ®åŒ…</li>
<li>POSTROUTING è·¯ç”±åˆ¤æ–­ä¹‹åçš„æ•°æ®åŒ…</li>
<li>FORWARD ç¬¬ä¸€æ¬¡è·¯ç”±åˆ¤æ–­ä¹‹å,åˆ°æœ€åä¸€è¯è·¯ç”±åˆ¤æ–­ä¹‹å‰</li>
</ul>
<h4 id="è§„åˆ™rule"><a href="#è§„åˆ™rule" class="headerlink" title="è§„åˆ™rule"></a>è§„åˆ™rule</h4><p>æ˜¯ç”¨æ¥åˆ¤æ–­æ•°æ®åŒ…çš„å…·ä½“æƒ…å†µ</p>
<ul>
<li>-p åè®®</li>
<li>-s æ¥æº</li>
<li>-d ç›®çš„åœ°</li>
<li>â€“sport æ¥æºç«¯å£</li>
<li>â€“dport ç›®çš„ç«¯å£</li>
<li>-i å…¥ç«™ç½‘ç»œæ¥å£</li>
<li>-o å‡ºç«™ç½‘ç»œæ¥å£</li>
<li>! å–å</li>
</ul>
<h4 id="æ‰§è¡Œæ“ä½œtarget"><a href="#æ‰§è¡Œæ“ä½œtarget" class="headerlink" title="æ‰§è¡Œæ“ä½œtarget"></a>æ‰§è¡Œæ“ä½œtarget</h4><ul>
<li>ACCEPT æ¥å—</li>
<li>DROP ä¸¢å¼ƒ</li>
<li>REJECT æ‹’ç»</li>
<li>DNAT ç›®æ ‡åœ°å€è½¬æ¢</li>
<li>SNAT æºåœ°å€è½¬æ¢</li>
</ul>
<h3 id="åº”ç”¨å®ä¾‹"><a href="#åº”ç”¨å®ä¾‹" class="headerlink" title="åº”ç”¨å®ä¾‹"></a>åº”ç”¨å®ä¾‹</h3><ol start="0">
<li>æŸ¥çœ‹è§„åˆ™    <code>iptables -L</code></li>
<li>è§„åˆ™æ¸…ç©º    <code>iptables -F</code></li>
<li>é¢„é€‰ç­–ç•¥    <code>iptables -P INPUT ACCEPT</code></li>
<li>ä¿å­˜ç­–ç•¥    <code>service iptables save</code> or <code>iptables-save &gt; /etc/sysconfig/iptables</code></li>
<li>å¼€æœºåé‡æ–°å¯¼å…¥    <code>iptables-restore &lt; /etc/sysconfig/iptables</code></li>
</ol>
<blockquote>
<p>åªå…è®¸172.25.0.250å’Œä½ è‡ªå·±çš„æœåŠ¡å™¨èƒ½å¤Ÿè®¿é—®ftpæœåŠ¡ï¼ˆrhel6ï¼‰</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -s 172.25.0.250 -p tcp --dport 21 -j  ACCEPT</span><br><span class="line">iptables -A INPUT -s 172.25.0.11 -p tcp --dport 21 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 21 -j DROP</span><br></pre></td></tr></table></figure>


<blockquote>
<p>ç¦æ­¢pingåŒ…</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p icmp -j DROP</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä»…å…è®¸172.25.0.0/24ç½‘æ®µå’Œ172.25.15.0/24ç½‘æ®µç”¨æˆ·èƒ½å¤Ÿè®¿é—®æˆ‘çš„é‚®ä»¶æœåŠ¡å™¨</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -s 172.25.0.0/24 -p tcp --dport 25 -j ACCEPT</span><br><span class="line">iptables -A INPUT -s 172.25.15.0/24 -p tcp --dport 25 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 25 -j DROP</span><br></pre></td></tr></table></figure>

<h3 id="è¯¾å ‚ç»ƒä¹ é¢˜ç›®"><a href="#è¯¾å ‚ç»ƒä¹ é¢˜ç›®" class="headerlink" title="è¯¾å ‚ç»ƒä¹ é¢˜ç›®"></a>è¯¾å ‚ç»ƒä¹ é¢˜ç›®</h3><p>rhel6 172.25.x.11</p>
<ol>
<li><p>æ¸…ç©ºè§„åˆ™</p>
</li>
<li><p>é¢„è®¾filterè¡¨INPUTæ˜¯ACCEPT</p>
</li>
<li><p>ä»…å…è®¸172.25.254.250å’Œ172.25.254.X èƒ½å¤Ÿsshåˆ°æˆ‘çš„æœåŠ¡å™¨ï¼ˆrhel6 172.25.X.11ï¼‰ä¸Š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -s 172.25.254.250 -p tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -A INPUT -s 172.25.254.16 -p tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 22 -j DROP</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä»…å…è®¸172.25.254.0/24å’Œ172.25.X.0/24èƒ½å¤Ÿpingæˆ‘çš„æœåŠ¡å™¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -s 172.25.254.0/24 -p icmp -j ACCEPT</span><br><span class="line">iptables -A INPUT -s 172.25.16.0/24 -p icmp -j ACCEPT</span><br><span class="line">iptables -A INPUT -p icpm -j DROP</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸å…è®¸172.25.254.254è®¿é—®æˆ‘çš„é‚®ä»¶æœåŠ¡å™¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -s 172.25.254.254 -p tcp --dport 25 -j DROP</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿å­˜è§„åˆ™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rhel6</span><br><span class="line">servcie iptables save</span><br><span class="line">iptables-save &gt; /etc/sysconfig/iptables</span><br></pre></td></tr></table></figure></li>
<li><p>æŸ¥çœ‹è§„åˆ™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iptables -L</span><br></pre></td></tr></table></figure>
</li>
<li><p>å…³æœºé‡å¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iptables-restore &lt; /etc/sysconfig/iptables</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Firewalldçš„ç”¨æ³•"><a href="#Firewalldçš„ç”¨æ³•" class="headerlink" title="Firewalldçš„ç”¨æ³•"></a>Firewalldçš„ç”¨æ³•</h3><p>Firewalldæ˜¯el7é»˜è®¤çš„é˜²ç«å¢™ï¼Œå’Œiptableså†²çªï¼Œå¦‚æœè¦ä½¿ç”¨å…¶ä¸­ä¹‹ä¸€ï¼Œéœ€è¦å…³é—­å¦å¤–ä¸€ä¸ª</p>
<p>è¿è¡Œã€åœæ­¢ã€ç¦ç”¨firewalld:</p>
<ul>
<li>å¯åŠ¨ï¼š<code>systemctl start  firewalld</code></li>
<li>æŸ¥çœ‹çŠ¶æ€ï¼š<code>systemctl status firewalld</code> æˆ–è€… <code>firewall-cmd --state</code></li>
<li>åœæ­¢ï¼š<code>systemctl disable firewalld</code></li>
<li>ç¦ç”¨ï¼š<code>systemctl stop firewalld</code></li>
</ul>
<p>å¯ä»¥é€šè¿‡</p>
<ol>
<li>firewall-configå›¾å½¢åŒ–å·¥å…· æ¥æ§åˆ¶</li>
<li>firewall-cmd  å‘½ä»¤è¡Œå·¥å…·</li>
</ol>
<h4 id="Firewall-config"><a href="#Firewall-config" class="headerlink" title="Firewall-config"></a>Firewall-config</h4><ol>
<li>Configuration    runtimeå’Œpermanent  åˆ†åˆ«æ˜¯è¿è¡Œæ—¶å’Œæ°¸ä¹…</li>
<li>zone é»˜è®¤åŒºåŸŸé…ç½®</li>
</ol>
<ul>
<li>Trustedï¼šå…è®¸æ‰€æœ‰ä¼ å…¥æ•°æ®åŒ…</li>
<li>dropï¼šé»˜è®¤ä¸¢å¼ƒæ‰€æœ‰åŒ…</li>
<li>blockï¼šæ‹’ç»æ‰€æœ‰å¤–éƒ¨è¿æ¥ï¼Œå…è®¸å†…éƒ¨å‘èµ·çš„è¿æ¥</li>
<li>publicï¼šæŒ‡å®šå¤–éƒ¨è¿æ¥å¯ä»¥è¿›å…¥</li>
<li>externalï¼šè¿™ä¸ªä¸å¤ªæ˜ç™½ï¼ŒåŠŸèƒ½ä¸Šå’Œä¸Šé¢ç›¸åŒï¼Œå…è®¸æŒ‡å®šçš„å¤–éƒ¨è¿æ¥</li>
<li>dmzï¼šå’Œç¡¬ä»¶é˜²ç«å¢™ä¸€æ ·ï¼Œå—é™åˆ¶çš„å…¬å…±è¿æ¥å¯ä»¥è¿›å…¥</li>
<li>workï¼šå·¥ä½œåŒºï¼Œæ¦‚å¿µå’Œworkgoupä¸€æ ·ï¼Œä¹Ÿæ˜¯æŒ‡å®šçš„å¤–éƒ¨è¿æ¥å…è®¸</li>
<li>homeï¼šç±»ä¼¼å®¶åº­ç»„</li>
<li>internalï¼šä¿¡ä»»æ‰€æœ‰è¿æ¥</li>
</ul>
<ol start="3">
<li>å¯Œè§„åˆ™ï¼šå¯ç”¨äºè¡¨è¾¾åŸºæœ¬çš„å…è®¸å’Œæ‹’ç»è§„åˆ™ã€‚<br>Configuration  permenent</li>
</ol>
<p><img src="pic/21.png" alt="21"></p>
<p>å·¦ä¸Šè§’ï¼šOption  reloade firewall<br>Sshå°±æ— æ³•ç™»é™†äº†</p>
<h4 id="firewall-cmd"><a href="#firewall-cmd" class="headerlink" title="firewall-cmd"></a>firewall-cmd</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family=ipv4 service name="ssh" source address=192.168.137.11 log prefix="ssh" level="notice" limit value="3/m" reject\'</span><br></pre></td></tr></table></figure>

<p>å°†æ¥è‡ªäº192.168.137.11çš„sshæ‹’ç»æ‰ï¼Œå¹¶ä¸”å°†noticeä»¥ä¸Šçš„æ—¥å¿—å†™å…¥åˆ°sshæ—¥å¿—å½“ä¸­ï¼Œé™åˆ¶æ¯åˆ†é’Ÿæœ€å¤šä¸‰æ¡è®°å½•ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxåŸºç¡€æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxç®€æ˜“æœåŠ¡ä¸Šæœºè€ƒè¯•</title>
    <url>/2016/12/23/booboo_easy_service/ule-online/</url>
    <content><![CDATA[<p>##ã€€æ³¨æ„äº‹é¡¹</p>
<ol>
<li>ç¡®ä¿åœ¨é‡å¯ä¸»æœºåæ‰€æœ‰é…ç½®ä»ç„¶ç”Ÿæ•ˆã€‚</li>
<li>selinuxå¿…é¡»ä¸ºEnforingæ¨¡å¼ï¼Œé˜²ç«å¢™å¿…é¡»å¼€å§‹ã€‚é»˜è®¤ç­–ç•¥å¿…é¡»æ¸…ç©ºã€‚</li>
<li>è®¾ç½®ä¸»æœºåä¸º stuXXXï¼ˆâ€œXâ€ä¸ºä½ çš„ foundation æœºå™¨ ip åœ°å€æœ€åä¸€ä½ã€‚ä¾‹å¦‚ï¼šä½ çš„ ip åœ°å€ä¸º172.25.254.30ï¼Œåˆ™ä½ çš„ä¸»æœºåä¸ºstu30ï¼‰</li>
<li>ä¸å…è®¸sshç™»å½•åˆ°å…¶ä»–ä¸»æœºï¼Œå·²ç»å‘ç°æŒ‰0åˆ†è®¡ç®—è€ƒè¯•å¾—åˆ†ã€‚</li>
<li>è€ƒè¯•æ»¡åˆ†ä¸º100åˆ†åˆ¶ï¼Œ70åˆ†ä¸ºåŠæ ¼ï¼Œ90åˆ†ä¸ºä¼˜ç§€ï¼Œæ‰€æœ‰è€ƒé¢˜éœ€è¦æŒ‰ç…§è¦æ±‚å®Œæˆã€‚</li>
</ol>
<h2 id="è€ƒè¯•å†…å®¹"><a href="#è€ƒè¯•å†…å®¹" class="headerlink" title="è€ƒè¯•å†…å®¹"></a>è€ƒè¯•å†…å®¹</h2><h3 id="findæŸ¥æ‰¾æ–‡ä»¶"><a href="#findæŸ¥æ‰¾æ–‡ä»¶" class="headerlink" title="findæŸ¥æ‰¾æ–‡ä»¶"></a>findæŸ¥æ‰¾æ–‡ä»¶</h3><p>ä½¿ç”¨findæŸ¥æ‰¾/etcç›®å½•ä¸‹æ–‡ä»¶åä»¥.confç»“å°¾çš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°/tmp/etcç›®å½•ä¸‹ã€‚ï¼ˆ10åˆ†ï¼‰</p>
<p>###ã€€autofsè‡ªåŠ¨æŒ‚è½½ã€€</p>
<p>é…ç½®autofsï¼Œå½“æ‰§è¡Œcd /opt/server æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨å°†172.25.254.250:/content æŒ‚è½½åˆ°æ­¤ç›®å½•ã€‚ï¼ˆ10åˆ†ï¼‰</p>
<h3 id="ç”¨æˆ·å’Œç»„çš„ç®¡ç†"><a href="#ç”¨æˆ·å’Œç»„çš„ç®¡ç†" class="headerlink" title="ç”¨æˆ·å’Œç»„çš„ç®¡ç†"></a>ç”¨æˆ·å’Œç»„çš„ç®¡ç†</h3><p>åˆ›å»ºtest1 test2 test3ç”¨æˆ·ï¼Œuid=gidåˆ†åˆ«ä¸º801 802 803ï¼Œå°†ä»–ä»¬åŠ å…¥åˆ°testç»„ï¼ˆæœ¬æœºæ— testç”¨æˆ·ï¼‰ï¼Œç»„testä¸ºè¿™äº›ç”¨æˆ·çš„é™„åŠ ç»„ã€‚åˆ›å»º/tmp/testç›®å½•ï¼Œè¯¥ç›®å½•åªæœ‰test1 test2 test3ç”¨æˆ·å¯è¯»å†™ï¼Œï¼ˆrootä¸å—é™åˆ¶ï¼‰ã€‚è¯¥ç›®å½•ä¸‹æ‰€åˆ›å»ºæ–‡ä»¶groupå°†è‡ªåŠ¨æ”¹å˜ä¸ºtestç»„ï¼Œè¯¥ç›®å½•ä¸‹æ–‡ä»¶åªæœ‰ownerå¯åˆ é™¤ã€‚ï¼ˆ10åˆ†ï¼‰</p>
<h3 id="Apacheæ­å»ºç½‘ç«™æœåŠ¡"><a href="#Apacheæ­å»ºç½‘ç«™æœåŠ¡" class="headerlink" title="Apacheæ­å»ºç½‘ç«™æœåŠ¡"></a>Apacheæ­å»ºç½‘ç«™æœåŠ¡</h3><h4 id="åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº"><a href="#åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº" class="headerlink" title="åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº"></a>åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº</h4><p>åˆ›å»ºä¸¤ä¸ªåŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºç½‘ç«™<a href="http://www.test.comå’Œwww.stuXXX.com" target="_blank" rel="noopener">www.test.comå’Œwww.stuXXX.com</a></p>
<h4 id="DNSåŸŸåè§£ææœåŠ¡"><a href="#DNSåŸŸåè§£ææœåŠ¡" class="headerlink" title="DNSåŸŸåè§£ææœåŠ¡"></a>DNSåŸŸåè§£ææœåŠ¡</h4><p>é…ç½®ç›¸åº”çš„DNSæ­£ã€åè§£æ,ç½‘ç«™çš„é»˜è®¤é¦–é¡µå†…å®¹åˆ†åˆ«ä¸º <a href="http://www.test.com" target="_blank" rel="noopener">www.test.com</a> å’Œ<a href="http://www.stuXXX.comã€‚ï¼ˆ10åˆ†ï¼‰" target="_blank" rel="noopener">www.stuXXX.comã€‚ï¼ˆ10åˆ†ï¼‰</a></p>
<h4 id="LVMé€»è¾‘å·ç®¡ç†"><a href="#LVMé€»è¾‘å·ç®¡ç†" class="headerlink" title="LVMé€»è¾‘å·ç®¡ç†"></a>LVMé€»è¾‘å·ç®¡ç†</h4><p>åˆ¶ä½œä¸¤ä¸ªlvï¼Œ/dev/vg_web/lv_test å’Œ/dev/vg_web/lv_stuã€‚æ¯ä¸ªé€»è¾‘å·200Mã€‚åˆ†åˆ«ä½œä¸ºä»¥/var/www/test.com å’Œ /var/www/stuXXX.comä¸Šä¸¤ä¸ªè™šæ‹Ÿä¸»æœºçš„ä¸»ç›®å½•(Document root)(10åˆ†)</p>
<h4 id="webé¡µé¢èº«ä»½è®¤è¯"><a href="#webé¡µé¢èº«ä»½è®¤è¯" class="headerlink" title="webé¡µé¢èº«ä»½è®¤è¯"></a>webé¡µé¢èº«ä»½è®¤è¯</h4><p>é…ç½®é¡µé¢èº«ä»½è®¤è¯ï¼Œä½¿<a href="http://www.stuXXX.com" target="_blank" rel="noopener">www.stuXXX.com</a> å¿…é¡»é€šè¿‡ç”¨æˆ·åjackï¼Œå¯†ç uplookingéªŒè¯æ‰èƒ½è®¿é—®ã€‚ï¼ˆ10åˆ†ï¼‰</p>
<h3 id="Sambaæ–‡ä»¶å…±äº«æœåŠ¡"><a href="#Sambaæ–‡ä»¶å…±äº«æœåŠ¡" class="headerlink" title="Sambaæ–‡ä»¶å…±äº«æœåŠ¡"></a>Sambaæ–‡ä»¶å…±äº«æœåŠ¡</h3><p>é…ç½®sambaï¼Œä½¿user1ï¼ˆè‡ªå·±æ–°å»ºï¼‰ç”¨æˆ·å¯†ç ä¸ºredhatï¼Œå¯ä»¥é€šè¿‡smbclientä¸Šä¼ ä¸‹è½½æ–‡ä»¶åˆ°è‡ªå·±çš„å®¶ç›®å½•å’Œ/sambaï¼ˆè‡ªå·±æ–°å»ºï¼‰ç›®å½•ï¼Œ/sambaå…±äº«åä¸ºpubã€‚ï¼ˆ10åˆ†</p>
<h3 id="FTPæ–‡ä»¶å…±äº«æœåŠ¡"><a href="#FTPæ–‡ä»¶å…±äº«æœåŠ¡" class="headerlink" title="FTPæ–‡ä»¶å…±äº«æœåŠ¡"></a>FTPæ–‡ä»¶å…±äº«æœåŠ¡</h3><p>é…ç½®vsftpdä½¿studentç”¨æˆ·å¯ä»¥é€šè¿‡ftpä¸Šä¼ ä¸‹è½½æ–‡ä»¶è‡ªå·±å®¶ç›®å½•ä¸­çš„æ–‡ä»¶ï¼ŒåŒæ—¶å¯¹studentç”¨æˆ·å¯ç”¨chrootåŠŸèƒ½ï¼Œå¹¶ä¸”å…è®¸åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶åˆ°/var/ftp/testç›®å½•ä¸‹ã€‚ï¼ˆ10åˆ†ï¼‰</p>
<h3 id="å‘¨æœŸæ€§è®¡åˆ’ä»»åŠ¡"><a href="#å‘¨æœŸæ€§è®¡åˆ’ä»»åŠ¡" class="headerlink" title="å‘¨æœŸæ€§è®¡åˆ’ä»»åŠ¡"></a>å‘¨æœŸæ€§è®¡åˆ’ä»»åŠ¡</h3><p>å¯¹ natasha ç”¨æˆ·é…ç½®è®¡åˆ’ä»»åŠ¡,è¦æ±‚åœ¨æœ¬åœ°æ—¶é—´çš„æ¯å¤© 14:23 åˆ†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ ï¼ˆ10åˆ†ï¼‰</p>
<p>/bin/echo â€œhi uplookingâ€</p>
<h3 id="iptablesé˜²ç«å¢™"><a href="#iptablesé˜²ç«å¢™" class="headerlink" title="iptablesé˜²ç«å¢™"></a>iptablesé˜²ç«å¢™</h3><p>iptablesï¼ˆ10åˆ†ï¼‰</p>
<ol>
<li>æ¸…ç©ºiptables filterè¡¨çš„é»˜è®¤ç­–ç•¥ï¼ˆ2åˆ†ï¼‰</li>
<li>åªå…è®¸172.25.0.250å’Œä½ ä½¿ç”¨è‡ªå·±æ­å»ºçš„çš„ftpæœåŠ¡ï¼ˆ2åˆ†ï¼‰</li>
<li>ç¦æ­¢pingåŒ…ï¼ˆ2åˆ†ï¼‰</li>
<li>ä»…å…è®¸172.25.0.0/24ç½‘æ®µå’Œä½ è‡ªå·±çš„ç½‘æ®µç”¨æˆ·è®¿é—®ä½ çš„webæœåŠ¡å™¨ï¼ˆ2åˆ†ï¼‰</li>
<li>ä¿å­˜iptablesé…ç½®ï¼ˆ2åˆ†ï¼‰</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç®€æ˜“æœåŠ¡æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>LinuxåŸºç¡€æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>LINUX HISTORY</title>
    <url>/2016/12/22/booboo_linux_base/00-linux_history/</url>
    <content><![CDATA[<p>å¦‚æœä½ å–œæ¬¢æŠ€æœ¯ï¼Œé‚£ä¹ˆLinuxçš„å­¦ä¹ ä¼šä¸ºä½ æ‰“å¼€ä¸€ä¸ªæ–°çš„ä¸–ç•Œã€‚</p>
<p>å…¥é—¨éš¾ï¼Œä½†æ˜¯ä¸€æ—¦å…¥é—¨ï¼Œå°±ç®€å•äº†ï¼ŒåŠ æ²¹ï¼</p>
<p>å¼€æºä¸‡å²ï½</p>
<h2 id="ç¡¬ä»¶å‘å±•ç®€ä»‹"><a href="#ç¡¬ä»¶å‘å±•ç®€ä»‹" class="headerlink" title="ç¡¬ä»¶å‘å±•ç®€ä»‹"></a>ç¡¬ä»¶å‘å±•ç®€ä»‹</h2><h3 id="x86-æ¶æ„"><a href="#x86-æ¶æ„" class="headerlink" title="x86 æ¶æ„"></a>x86 æ¶æ„</h3><p>1978å¹´6æœˆ8æ—¥ï¼ŒIntelå‘å¸ƒäº†æ–°æ¬¾16ä½å¾®å¤„ç†å™¨â€œ8086â€ï¼Œä¹ŸåŒæ—¶å¼€åˆ›äº†ä¸€ä¸ªæ–°æ—¶ä»£ï¼šx86æ¶æ„è¯ç”Ÿäº†ã€‚X86æŒ‡ä»¤é›†æ˜¯ç¾å›½Intelå…¬å¸ä¸ºå…¶ç¬¬ä¸€å—16ä½CPU(i8086)ä¸“é—¨å¼€å‘çš„ï¼Œç¾å›½IBMå…¬å¸1981å¹´æ¨å‡ºçš„ä¸–<br>ç•Œç¬¬ä¸€å° PCæœºä¸­çš„CPUâ€”i8088(i8086ç®€åŒ–ç‰ˆ)ä½¿ç”¨çš„ä¹Ÿæ˜¯X86æŒ‡ä»¤ï¼ŒåŒæ—¶ç”µè„‘ä¸­ä¸ºæé«˜æµ®ç‚¹æ•°æ®å¤„ç†èƒ½åŠ›è€Œå¢åŠ çš„X87èŠ¯ç‰‡ç³»åˆ—æ•°å­¦åå¤„ç†å™¨åˆ™å¦å¤–ä½¿ç”¨X87æŒ‡ä»¤ï¼Œä»¥åå°±å°†X86æŒ‡ä»¤é›†å’ŒX87 æŒ‡ä»¤é›†ç»Ÿç§°ä¸º<br>X86æŒ‡ä»¤é›†ã€‚è™½ç„¶éšç€CPUæŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒIntelé™†ç»­ç ”åˆ¶å‡ºæ›´æ–°å‹çš„i80386ã€i80486ç›´åˆ°ä»Šå¤©çš„Pentium 4(ä»¥ä¸‹ç®€ä¸ºP4)ç³»åˆ—ï¼Œä½†ä¸ºäº†ä¿è¯ç”µè„‘èƒ½ç»§ç»­è¿è¡Œä»¥å¾€å¼€å‘çš„å„ç±»åº”ç”¨ç¨‹åºä»¥ä¿æŠ¤å’Œç»§æ‰¿ä¸°å¯Œçš„è½¯ä»¶èµ„æºï¼Œ æ‰€ä»¥Intelå…¬å¸æ‰€ç”Ÿäº§çš„æ‰€æœ‰CPUä»ç„¶ç»§ç»­ä½¿ç”¨X86æŒ‡ä»¤é›†ï¼Œæ‰€ä»¥å®ƒçš„CPUä»å±äºX86ç³»åˆ—ã€‚</p>
<h3 id="Altair-8800"><a href="#Altair-8800" class="headerlink" title="Altair 8800"></a>Altair 8800</h3><p>ä¸–ç•Œä¸Šçš„ç¬¬ä¸€å°ä¸ªäººç”µè„‘â€“â€œç‰µç‰›æ˜Ÿâ€ã€€ã€€</p>
<p>çˆ±å¾·Â·ç½—ä¼¯å…¹ï¼ˆEd Robertsï¼‰çš„æ¢¦æƒ³æ˜¯åšä¸€åå„¿ç§‘åŒ»ç”Ÿã€‚ä½†æ˜¯å‘½è¿å´è®©ä»–åŠ å…¥äº†ç¾å›½ç©ºå†›ï¼Œåšä¸€åå·¥ç¨‹å¸ˆã€‚é€€ä¼åï¼Œä»–åœ¨æ–°å¢¨è¥¿å“¥å·çš„é˜¿ä¼¯å…‹åŸºå¸‚æœºåœºé™„è¿‘çš„è’æ¼ ä¸Šåˆ›åŠäº†ä¸€å®¶ç§°ä¸ºç±³å…¹ï¼ˆMITSï¼‰çš„å…¬å¸ï¼Œç”Ÿäº§å„ç§ç”µå­éƒ¨ä»¶å’Œè®¾å¤‡ã€‚å…¬å¸æœ‰ä¸€æ®µæ—¶é—´çš„ç»è¥è¿˜ç®—é¡ºåˆ©ã€‚å½“å¸‚åœºä¸Šçš„æ‰‹æŒè®¡ç®—å™¨å–åˆ°395ç¾å…ƒæ—¶ï¼Œç±³å…¹å…¬å¸æ¨å‡ºäº†<br>ä¸åˆ°100ç¾å…ƒçš„åŒç±»äº§å“ã€‚ä½†æ˜¯ä¸ä¹…ä¹‹åï¼Œå¾·å·ä»ªå™¨ç­‰å¤§å…¬å¸è¿…é€Ÿè¿›å…¥æ‰‹æŒè®¡ç®—å™¨çš„å¸‚åœºï¼Œäº§å“ä»·æ ¼å¤§å¹…åº¦ä¸‹é™ï¼Œä½åˆ°äº†ç±³å…¹å…¬å¸çš„æˆæœ¬ä»·ä»¥ä¸‹ã€‚ç±³å…¹å…¬å¸çš„å…¶ä»–äº§å“é”€å”®æƒ…å†µä¹Ÿå¾ˆç³Ÿã€‚åˆ°äº†1974å¹´ï¼Œç±³å…¹å…¬å¸å·²æ¿’ä¸´ç ´äº§è¾¹ç¼˜ã€‚ã€€ã€€</p>
<p>ç½—ä¼¯å…¹ç»å°½è„‘æ±æ€è€ƒå¦‚ä½•æ‰­è½¬å…¬å¸çš„å›°å¢ƒã€‚ä»–æœ‰äº†ä¸€ä¸ªæƒ³æ³•ï¼šèƒ½ä¸èƒ½åˆ›é€ ä¸€ç§å¾ˆä¾¿å®œã€èƒ½è®©ä¸ªäººä½¿ç”¨çš„ç”µè„‘å‘¢ï¼Ÿå…¨å›½å·²ç»æœ‰å¾ˆå¤šç”µè„‘çˆ±å¥½è€…ï¼Œä»–ä»¬éƒ½æ€¥åˆ‡å¸Œæœ›è‡ªå·±èƒ½æ‹¥æœ‰ä¸€å°ç”µè„‘ï¼Œä¾›ä¸ªäººç©å¼„ï¼Œå°±åƒå¾ˆå¤šäººåœ¨é¼“æ£è‡ªåˆ¶çš„æ— çº¿ç”µæ”¶éŸ³æœºä¸€æ ·ã€‚å¸‚é¢ä¸Šç°åœ¨è¿˜æ²¡æœ‰è¿™æ ·çš„ä¸œè¥¿ã€‚å¸¦ç€è¿™ä¸ªæƒ³æ³•ï¼Œä»–å»è¯´æœæœ¬åœ°é“¶è¡Œå†ç»™ä»–çš„å…¬å¸è´·<br>ä¸€ç¬”æ¬¾ã€‚ç±³å…¹å…¬å¸å¿…é¡»è‡³å°‘å†è´·å°†è¿‘7ä¸‡ç¾å…ƒæ‰èƒ½ä¸è‡´äºç ´äº§ã€‚é“¶è¡Œå¯¹ç½—ä¼¯å…¹çš„æƒ³æ³•å¾ˆæ€€ç–‘ã€‚åŒæ–¹ä¸€ç›´è°ˆåˆ°æ·±å¤œã€‚ä¸è¿‡ï¼Œé“¶è¡Œé¢ä¸´ä¸€ä¸ªä¸¤éš¾çš„é€‰æ‹©ï¼šè¦ä¹ˆä¸å†è´·æ¬¾ç»™ç±³å…¹å…¬å¸ï¼Œè®©å®ƒå€’é—­ï¼Œé“¶è¡Œä»¥å‰çš„æŠ•èµ„ä¹Ÿå°±å…¨å®Œäº†ã€‚<br>è¦ä¹ˆå†æ”¾ä¸€ç¬”è´·æ¬¾ï¼Œä½†è¿™ç¬”æ–°è´·æ¬¾å¾ˆå¯èƒ½åˆä¼šæ‰“æ°´æ¼‚ã€‚æœ€åï¼Œé“¶è¡Œå†æ¬¡è®©ç½—ä¼¯å…¹ç¡®åˆ‡å‘Šè¯‰ä»–ä»¬ï¼Œè¿™ç§ä¸ªäººç”µè„‘ä»€ä¹ˆæ—¶å€™èƒ½å¼€å‘å‡ºæ¥ï¼Œç¬¬ä¸€å¹´èƒ½å–å¤šå°‘å¥—ã€‚ç½—ä¼¯å…¹å¯¹ä»€ä¹ˆæ—¶å€™èƒ½åšå‡ºæ¥æ˜¯æœ‰æŠŠæ¡çš„ï¼Œåªè¦å‡ ä¸ªæœˆçš„æ—¶é—´ã€‚<br>èƒ½å–å¤šå°‘å¥—ä»–å°±å®Œå…¨æ²¡æœ‰è°±äº†ã€‚äºæ˜¯ä»–è¯´äº†ä¸€ä¸ªéå¸¸ä¹è§‚çš„æ•°å­—ï¼šç¬¬ä¸€å¹´èƒ½å–800å¥—ï¼Œè¿™æ ·é”€å”®æ”¶å…¥å¯ä»¥æœ‰30ä¸‡ç¾å…ƒã€‚æ‹¿åˆ°è´·æ¬¾åï¼Œç±³å…¹å…¬å¸å…¨åŠ›å¼€å‘ä¸ªäººç”µè„‘äº§å“ã€‚å…¬å¸å¿…é¡»åœ¨æœ€çŸ­æ—¶é—´å†…æŠŠäº§å“å¼€å‘å‡ºæ¥å¹¶ä¸”å–å‡º<br>å»ï¼Œä¸ç„¶ç ´äº§å°±éš¾ä»¥é¿å…ã€‚ä¸ºäº†ç¼©çŸ­å¼€å‘æ—¶é—´å’Œé™ä½æˆæœ¬ï¼Œç½—ä¼¯å…¹å†³å®šå°½é‡é‡‡ç”¨ç°æˆçš„éƒ¨ä»¶ï¼Œåšå‡ºæ¥äº§å“ä¸æ˜¯ä¸€å°ç°æˆçš„è®¡ç®—æœºï¼Œè€Œæ˜¯ä¸€å¥—é›¶éƒ¨ä»¶ï¼Œéœ€è¦ç”¨æˆ·è‡ªå·±è£…é…ã€‚æ‰€æœ‰å¹¶éå¿…éœ€çš„äº§å“ç‰¹å¾éƒ½è¢«å»æ‰äº†ã€‚äº§å“æ ¹<br>æœ¬æ²¡æœ‰ä»Šå¤©çš„å¾®æœºä¸å¯å¿½ç¼ºçš„é”®ç›˜ã€é¼ æ ‡ã€æ˜¾ç¤ºå™¨ã€è½¯ç›˜ç­‰ç­‰è®¾å¤‡ã€‚äº§å“ä¹Ÿæ²¡æœ‰è½¯ä»¶ï¼Œæ‰€æœ‰è½¯ä»¶(åŒ…æ‹¬æ‰€è°“çš„ç³»ç»Ÿè½¯ä»¶)éƒ½éœ€è¦ç”¨æˆ·ç”¨è®¾ç½®å¼€å…³çš„æ–¹å¼ä¸€æ¡æŒ‡ä»¤ä¸€æ¡æŒ‡ä»¤åœ°æ‰‹å·¥è¾“å…¥è®¡ç®—æœºã€‚<br>ã€€ã€€<br>ä¸ç®¡å¤šä¹ˆç®€é™‹ï¼Œè¿™æ¯•ç«Ÿæ˜¯ä¸–ç•Œä¸Šçš„ç¬¬ä¸€å°ä¸ªäººç”µè„‘ï¼Œåˆç§°å¾®æœºã€‚ç±³å…¹å…¬å¸çš„å¾®æœºäº§å“æœ‰ä¸¤ä¸ªåœ¨å½“æ—¶æ— å¯æ¯”æ‹Ÿçš„ä¼˜ç‚¹ã€‚å®ƒå¾ˆä¾¿å®œï¼Œå”®ä»·åªæœ‰ä¸åˆ°500ç¾å…ƒï¼Œè€Œå½“æ—¶ä¸€äº›å¤§å…¬å¸çš„å®éªŒå®¤ä¹Ÿåšäº†ç±»ä¼¼å¾®æœºçš„ç³»ç»Ÿï¼Œæˆæœ¬åœ¨5<br>ä¸‡ç¾å…ƒå·¦å³ã€‚å¦å¤–ï¼Œç±³å…¹çš„å¾®æœºè®¾è®¡å…·æœ‰æ‰€è°“çš„å¯æ‰©å±•èƒ½åŠ›ã€‚ç”¨æˆ·å¯ä»¥å°†ç±³å…¹çš„å¾®æœºä¹°å›æ¥åï¼Œè‡ªå·±å†æƒ³æ³•é…ä¸Šæ›´å¤šçš„å†…å­˜æ¿å­å’Œå¤–éƒ¨è®¾å¤‡ã€‚æœ‰ä¸€ä¸ªç”¨æˆ·èŠ±äº†è¿‘500ç¾å…ƒä¹°äº†ä¸€å°å¾®æœºï¼Œå†èŠ±äº†3000ç¾å…ƒæŠŠå†…å­˜æ‰©å±•<br>åˆ°12KBã€‚ã€Šç”µå­ç§‘æ™®ã€‹ï¼ˆPopular Electronicsï¼‰æ‚å¿—å¬åˆ°è¿™ä¸ªæ¶ˆæ¯åï¼Œæ•é”åœ°æ„Ÿè§‰åˆ°è¿™æ˜¯ä¸€ä¸ªå†å²æ€§çš„äº‹ä»¶ï¼Œé©¬ä¸Šå†³å®šåœ¨1975å¹´1æœˆæœŸä½œä¸ºå°é¢æ–‡ç« æŠ¥é“ã€‚ä½†è¿™ä¸ªä¸ªäººç”µè„‘äº§å“å´è¿åå­—éƒ½è¿˜æ²¡æœ‰ã€‚ç½—ä¼¯å…¹åœ¨<br>æ‚å¿—çš„è´£ä»»ç¼–è¾‘å®¶é‡Œè®¨è®ºäº†å„ç§åå­—ã€‚åˆšå¥½ï¼Œç¼–è¾‘çš„å®¶äººæ­£åœ¨çœ‹ã€Šæ˜Ÿé™…æ—…è¡Œã€‹çš„ç”µè§†èŠ‚ç›®ã€‚é‚£ä¸€èŠ‚åˆšå¥½è®²åˆ°äº†ç‰µç‰›æ˜Ÿåº§ã€‚äºæ˜¯ï¼Œä¸–ç•Œä¸Šç¬¬ä¸€å°å¾®æœºå°±è¢«å‘½åä¸ºâ€œç‰µç‰›æ˜Ÿâ€ï¼Œå…¨ç§°æ˜¯â€œç‰µç‰›æ˜Ÿ8800ï¼ˆAltair 8800ï¼‰â€ã€‚</p>
<p>ç½—ä¼¯å…¹åšæ¢¦ä¹Ÿæ²¡æƒ³åˆ°çš„æ˜¯ï¼Œå…¨ç¾æœ‰è¿™ä¹ˆå¤šçš„ç”µè„‘çˆ±å¥½è€…ï¼Œäººäººéƒ½æƒ³æ‹¥æœ‰ä¸€å°å¾®æœºã€‚ã€Šç”µå­ç§‘æ™®ã€‹æ‚å¿—çš„æŠ¥é“å‘è¡¨åä¸€ä¸ªæœˆï¼Œç±³å…¹å…¬å¸æ¯å¤©éƒ½è¦æ”¶åˆ°200å¤šå°â€œç‰µç‰›æ˜Ÿâ€ç”µè„‘çš„è®¢å•ã€‚ç”Ÿäº§çº¿æ ¹æœ¬æ¥ä¸åŠæ»¡è¶³é”€å”®éœ€æ±‚ã€‚æœ‰<br>äº›ç”¨æˆ·å¹²è„†ä½åˆ°å…¬å¸å¤–é¢çš„è’æ¼ ä¸Šï¼Œç­‰ç€è‡ªå·±çš„å¾®æœºç”Ÿäº§å‡ºæ¥ã€‚å¤§å¤šæ•°ç”¨æˆ·åªæ˜¯è´­ä¹°åŸºæœ¬ç³»ç»Ÿã€‚ä¹Ÿæœ‰ç”¨æˆ·æ„¿æ„å‡º495ç¾å…ƒï¼Œè®©ç±³å…¹å…¬å¸ç”Ÿäº§ä¸€å°å·²ç»è£…é…å¥½çš„ç³»ç»Ÿã€‚ã€€ã€€</p>
<p>ä»Šå¤©ï¼Œç½—ä¼¯å…¹å·²ç»ç¦»å¼€äº†ç”µè„‘ç•Œã€‚ä»–å›åˆ°ä¹”æ²»äºšçš„è€å®¶ï¼Œè·å¾—äº†åŒ»å­¦åšå£«å­¦ä½ï¼Œä¸ºå„¿ç«¥æ²»ç—…ã€‚ä»–ä¸ºè‡ªå·±åˆ›é€ äº†è®¡ç®—æœºé¢†åŸŸçš„ä¸€ä¸ªé©å‘½è€Œè‡ªè±ªï¼Œä½†ä¸€ç‚¹ä¹Ÿä¸åæ‚”æ”¾å¼ƒç”µè„‘ä¸šï¼Œæ”¾å¼ƒäº†æˆä¸ºå¤§å¯Œç¿çš„æœºä¼šã€‚ä»–è§‰å¾—ä¸ºå„¿ç«¥æ²»ç—…æ›´æœ‰æ„ä¹‰ã€‚çˆ±å¾·Â·ç½—ä¼¯å…¹æ˜¯ä¸ªå¾ˆå¹¸ç¦çš„äººï¼Œä»–å®ç°äº†å„¿æ—¶çš„æ¢¦æƒ³ã€‚</p>
<h3 id="IBM5150"><a href="#IBM5150" class="headerlink" title="IBM5150"></a>IBM5150</h3><p>IBMæ¨å‡ºä¸–ç•Œä¸Šç¬¬ä¸€å°ä¸ªäººç”µè„‘ </p>
<p>1981å¹´8æœˆ12æ—¥ï¼Œæ€»éƒ¨è®¾åœ¨ç¾å›½çº½çº¦å·é˜¿è’™å…‹çš„å›½é™…å•†ç”¨æœºå™¨å…¬å¸ï¼ˆIBMï¼‰æ¨å‡º5150çš„æ–°æ¬¾ç”µè„‘ï¼Œâ€œä¸ªäººç”µè„‘â€è¿™ä¸ªæ–°ç”Ÿå¸‚åœºéšä¹‹è¯ç”Ÿã€‚IBM5150çœ‹èµ·æ¥åƒä¸ªç±³è‰²çš„â€œå¤§ç›’å­â€ï¼Œå”®ä»·1565ç¾å…ƒï¼Œåªæœ‰16Kå­—èŠ‚çš„å†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨ç›’å¼å½•éŸ³ç£å¸¦æ¥ä¸‹è½½å’Œå­˜å‚¨æ•°æ®ï¼Œæ­¤å¤–ä¹Ÿå¯é…å¤‡5.25è‹±å¯¸çš„è½¯ä»¶ç›˜é©±åŠ¨å™¨ã€‚</p>
<h3 id="MOS-Technology-6502"><a href="#MOS-Technology-6502" class="headerlink" title="MOS Technology 6502"></a>MOS Technology 6502</h3><p>å½“ä¸€ä¸ªæ»¡è„¸æ¨ªè‚‰çš„æ€ªäººå°†è¿™ä¸ªå¾®èŠ¯ç‰‡è£…åœ¨ç”µè„‘ä¸Šï¼Œå¹¶å¯åŠ¨ç”µè„‘æ—¶ï¼Œæ•´ä¸ªå®‡å®™éƒ½éœ‡æƒŠäº†ã€‚è¿™ä¸ªæ€ªäººå°±æ˜¯è‹¹æœå…¬å¸åˆ›å§‹äººä¹‹ä¸€â€”â€”æ–¯è’‚èŠ¬Â·æ²ƒå…¹å°¼å…‹ï¼Œé‚£å°ç”µè„‘å°±æ˜¯Apple Iï¼Œå¤„ç†å™¨ç”¨çš„æ˜¯ç”±æ‘©æ–¯å¤ªå…‹å…¬å¸ç ”å‘çš„8ä½å¾®å¤„ç†å™¨6502ã€‚</p>
<p>è¿™ä¸€å¤„ç†å™¨åŒæ—¶ä¹Ÿæ˜¯Apple IIã€the Commodore PETã€BBC Microç­‰ç»å…¸ç”µè„‘ä»¥åŠè¯¸å¦‚ä»»å¤©å ‚å’ŒAtariç­‰æ¸¸æˆç³»ç»Ÿçš„å¤§è„‘ã€‚è¯¥å¤„ç†å™¨çš„è®¾è®¡è€…ä¹‹ä¸€Chuck Peddleå›å¿†ç§°ï¼Œä»–ä»¬æ˜¯åœ¨1975å¹´çš„ä¸€ä¸ªè´¸æ˜“å±•ç¤ºä¼šä¸Šæ¨å‡ºè¿™æ¬¾å¤„ç†å™¨çš„ã€‚ä»–ç§°ï¼šâ€œæˆ‘ä»¬ç”¨èŠ¯ç‰‡è£…æ»¡äº†ä¸¤ä¸ªç»ç’ƒã€‚æˆ‘å’Œæˆ‘çš„å¦»å­å°±ååœ¨é‚£é‡Œå–è¿™äº›èŠ¯ç‰‡ã€‚â€æ‘©æ–¯å¤ªå…‹å…¬å¸6502å¾®å¤„ç†å™¨ç»ˆäºè„±é¢–è€Œå‡ºï¼Œå…¶åŸå› æ˜¯ï¼Œ6502çš„é€Ÿåº¦å¹¶ä¸æ¯”å®ƒçš„ç«äº‰å¯¹æ‰‹å¿«å¤šå°‘ï¼Œä½†æ˜¯å®ƒçš„ä»·æ ¼ä¾¿å®œï¼Œæ¯éƒ¨å”®ä»·ä¸º25ç¾å…ƒï¼Œè€Œè‹±ç‰¹å°”çš„8080å’Œæ‘©æ‰˜ç½—æ‹‰çš„6800å”®ä»·å¤§çº¦åœ¨200ç¾å…ƒã€‚</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="pic/001.jpg" alt="001"></h2><h2 id="æ“ä½œç³»ç»Ÿç®€ä»‹"><a href="#æ“ä½œç³»ç»Ÿç®€ä»‹" class="headerlink" title="æ“ä½œç³»ç»Ÿç®€ä»‹"></a>æ“ä½œç³»ç»Ÿç®€ä»‹</h2><h3 id="Unix"><a href="#Unix" class="headerlink" title="Unix"></a>Unix</h3><h4 id="Unix-ç®€å²"><a href="#Unix-ç®€å²" class="headerlink" title="Unix ç®€å²"></a>Unix ç®€å²</h4><p>1965å¹´æ—¶ï¼Œè´å°”å®éªŒå®¤(Bell Labs)åŠ å…¥ä¸€é¡¹ç”±å¥‡å¼‚ç”µå­(General Electric)å’Œéº»çœç†å·¥å­¦é™¢(MIT)åˆä½œçš„è®¡åˆ’ï¼›è¯¥è®¡åˆ’è¦å»ºç«‹ä¸€å¥—å¤šä½¿ç”¨è€…ã€å¤šä»»åŠ¡ã€å¤šå±‚æ¬¡(multi-userã€multiprocessorã€multi-level)çš„MULTICSæ“ä½œç³»ç»Ÿã€‚ç›´åˆ°1969å¹´ï¼Œå› MULTICSè®¡åˆ’çš„å·¥ä½œè¿›åº¦å¤ªæ…¢ï¼Œè¯¥è®¡åˆ’å°±è¢«åœäº†ä¸‹æ¥ã€‚å½“æ—¶ï¼ŒKen Thompsonï¼ˆåè¢«ç§°ä¸ºUnixä¹‹çˆ¶ï¼‰å·²ç»æœ‰ä¸€ä¸ªç§°ä¸ºã€Œæ˜Ÿé™…æ—…è¡Œã€çš„ç¨‹åºåœ¨GE-635çš„æœºå™¨ä¸Šè·‘ï¼Œä½†æ˜¯ååº”éå¸¸çš„æ…¢ï¼Œæ­£å·§ä¹Ÿè¢«ä»–å‘ç°äº†ä¸€éƒ¨è¢«é—²ç½®çš„PDP-7(Digitalçš„ä¸»æœº)ï¼ŒKen Thompsonå’ŒDernis Ritchieå°±å°†ã€Œæ˜Ÿé™…æ—…è¡Œã€çš„ç¨‹åºç§»æ¤åˆ°PDP-7ä¸Šã€‚è€Œè¿™éƒ¨PDP-7å°±æ­¤åœ¨æ•´ä¸ªè®¡ç®—æœºå†å²ä¸Šç•™ä¸‹äº†èŠ³åã€‚</p>
<p>MULTICS å…¶å®æ˜¯â€MULTiplexed Information and Computing Systemâ€çš„ç¼©å†™ï¼Œåœ¨1970å¹´æ—¶ï¼Œé‚£éƒ¨PDP-7å´åªèƒ½æ”¯æŒä¸¤ä¸ªä½¿ç”¨è€…ï¼Œå½“æ—¶ï¼ŒBrian Kernighan å°±å¼€ç©ç¬‘åœ°æˆç§°ä»–ä»¬çš„ç³»ç»Ÿå…¶å®æ˜¯ï¼šâ€UNiplexed Information and Computing Systemâ€ï¼Œç¼©å†™ä¸ºâ€UNICSâ€ï¼Œåæ¥ï¼Œå¤§å®¶å–å…¶è°éŸ³ï¼Œå°±ç§°å…¶ä¸ºâ€Unixâ€äº†ã€‚1970å¹´å¯ç§°ä¸ºæ˜¯Unixå…ƒå¹´ã€‚</p>
<p>1971å¹´ï¼Œä»–ä»¬ç”³è¯·äº†ä¸€éƒ¨PDP-11/20ï¼Œç”³è¯·çš„åä¹‰æ˜¯ï¼šè¦å‘å±•æ–‡ä¹¦å¤„ç†ç³»ç»Ÿã€‚è¯¥ææ¡ˆè¢«è·é‡‡çº³ï¼Œä»–ä»¬ä¹Ÿå‘å±•å‡ºäº†ä¸€å¥—æ–‡ä¹¦å¤„ç†ç³»ç»Ÿ â”€ å°±æ˜¯ç°åœ¨Unixæ“ä½œç³»ç»Ÿé‡Œé¢æ–‡ä¹¦å¤„ç†ç³»ç»Ÿ(nroff/troff)çš„å‰èº«ã€‚æœ‰è¶£çš„æ˜¯ï¼Œæ²¡æœ‰å¤šä¹…ï¼Œè´å°”å®éªŒå®¤çš„ä¸“åˆ©éƒ¨é—¨çœŸçš„é‡‡ç”¨äº†è¿™å¥—ç³»ç»Ÿä½œä¸ºä»–ä»¬å¤„ç†æ–‡ä»¶çš„å·¥å…·ï¼Œè€Œè´å°”å®éªŒå®¤çš„ä¸“åˆ©éƒ¨é—¨ä¹Ÿå°±é¡ºç†æˆç« åœ°æˆä¸ºUnixçš„ç¬¬ä¸€ä¸ªæ­£å¼ä½¿ç”¨è€…ã€‚å½“æ—¶ï¼Œé‚£éƒ¨PDP-11ï¼20åªæœ‰0.5MBç£ç›˜ç©ºé—´ã€‚è€Œæè¿°è¿™æ•´ä¸ªç³»ç»Ÿçš„æ–‡ä»¶è¢«æ ‡ç¤ºä¸ºï¼šâ€First Editionâ€ï¼Œç‰ˆæœ¬æ—¥æœŸæ˜¯1970å¹´11æœˆã€‚ä»æ­¤ä»¥åï¼ŒUnixçš„ç‰ˆæœ¬å°±ä»¥ç³»ç»Ÿæ–‡ä»¶çš„ç‰ˆåˆ«æ¥ç§°å‘¼ã€‚</p>
<h4 id="UNIXå®¶è°±"><a href="#UNIXå®¶è°±" class="headerlink" title="UNIXå®¶è°±"></a>UNIXå®¶è°±</h4><p>UNIXçš„å†å²å¼€å§‹äº1969å¹´ken Thompsonï¼ŒDennis Ritchieï¼ˆå³è‘—åçš„K&amp;Gï¼ŒCè¯­è¨€çš„å‘æ˜äººï¼‰ä¸ä¸€ç¾¤äººåœ¨ä¸€éƒ¨PDP-7ä¸Šè¿›è¡Œçš„ä¸€äº›å·¥ä½œï¼Œåæ¥è¿™ä¸ªç³»ç»Ÿå˜æˆäº†UNIXã€‚å®ƒä¸»è¦çš„å‡ ä¸ªç‰ˆæœ¬ä¸ºï¼š</p>
<ul>
<li>V1ï¼ˆ1971ï¼‰ï¼šç¬¬ä¸€ç‰ˆçš„UNIXï¼Œä»¥PDP-11/20çš„æ±‡ç¼–è¯­è¨€å†™æˆã€‚åŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿï¼Œforkã€roffã€edç­‰è½¯ä»¶ã€‚</li>
<li>V4ï¼ˆ1973ï¼‰ï¼šä»¥Cè¯­è¨€ä»å¤´å†™è¿‡ï¼Œè¿™ä½¿å¾—UNIXä¿®æ”¹å®¹æ˜“ï¼Œå¯ä»¥åœ¨å‡ ä¸ªæœˆå†…ç§»æ¤åˆ°æ–°çš„ç¡¬ä»¶å¹³å°ä¸Šã€‚æœ€åˆCè¯­è¨€æ˜¯ä¸ºUNIXè®¾è®¡çš„ï¼Œæ‰€ä»¥Cä¸UNIXé—´æœ‰ç´§å¯†çš„å…³ç³»ã€‚</li>
<li>V6ï¼ˆ1975ï¼‰ï¼šç¬¬ä¸€ä¸ªåœ¨è´å°”å®éªŒå®¤å¤–ï¼ˆå°¤å…¶æ˜¯å¤§å­¦ä¸­ï¼‰å¹¿ä¸ºæµä¼ çš„UNIXç‰ˆæœ¬ã€‚è¿™ä¹Ÿæ˜¯UNIXåˆ†æ”¯çš„èµ·ç‚¹ä¸å¹¿å—æ¬¢è¿çš„å¼€å§‹ã€‚1.xBSD ï¼ˆPDP-IIï¼‰å°±æ˜¯ç”±è¿™ä¸ªç‰ˆæœ¬è¡ç”Ÿå‡ºæ¥çš„ã€‚</li>
<li>V7ï¼ˆ1979ï¼‰ï¼šåœ¨è®¸å¤šUNIXç©å®¶çš„å¿ƒç›®ä¸­ï¼Œè¿™æ˜¯â€œæœ€åä¸€ä¸ªçœŸæ­£çš„UNIXï¼Œâ€è¿™ä¸ªç‰ˆæœ¬åŒ…æ‹¬ä¸€ä¸ªå®Œæ•´çš„K&amp;RCç¼–è¯‘å™¨ï¼ŒBourne shellã€‚V7ç§»æ¤åˆ°VAXæœºå™¨åç§°ä¸º32Vã€‚</li>
</ul>
<p>ç›®å‰å¼€å‘UNIXï¼ˆSystem Vï¼‰çš„å…¬å¸æ˜¯Unix System Laboratories (USL)ã€‚USLæœ¬ä¸ºAT&amp;Tæ‰€æœ‰ï¼Œ1993å¹´åˆè¢«Novellæ”¶è´­ã€‚Novelläº1993å¹´æœ«å°†UNIXè¿™ä¸ªæ³¨å†Œå•†æ ‡è½¬è®©ç»™X/Openç»„ç»‡ã€‚</p>
<p>ç›®å‰ä¸ºæ­¢ï¼ŒUNIXæœ‰ä¸¤å¤§æµæ´¾ï¼šé‚£å°±æ˜¯AT&amp;Tå‘å¸ƒçš„UNIXæ“ä½œç³»ç»ŸSystem Vä¸ç¾å›½åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡å‘å¸ƒçš„UNIXç‰ˆBSDï¼ˆBerkeley Software Distributionï¼‰ã€‚SVR4æ˜¯ä¸¤å¤§æµæ´¾èåˆåçš„äº§ç‰©ã€‚1991å¹´åº•ï¼Œä¸System Vé’ˆé”‹ç›¸å¯¹çš„å¼€æ”¾è½¯ä»¶åŸºé‡‘ä¼š(Open Software Foundation)æ¨å‡ºäº†OSF/1ã€‚</p>
<p>ç°åœ¨å‡ ç§ä¸»è¦çš„UNIXç‰ˆæœ¬:</p>
<ul>
<li>AIXï¼šIBMçš„UNIXï¼Œæ˜¯æ ¹æ®SVR2ï¼ˆæœ€è¿‘å·²ç»å‡ºåˆ°SVR3.2ï¼‰ä»¥åŠä¸€éƒ¨åˆ†BSDå»¶ä¼¸è€Œæ¥ï¼ŒåŠ ä¸Šå„ç§ç¡¬ä»¶çš„æ”¯æŒã€‚å…·å¤‡ç‰¹æœ‰çš„ç³»ç»Ÿç®¡ç†ï¼ˆSMITï¼‰ã€‚</li>
<li>386BSDï¼šJolitzä»Net/2 softwareç§»æ¤è¿‡æ¥çš„ã€‚æ”¯æŒPosixï¼Œ32ä½ã€‚</li>
<li>FreeBSDï¼š1.xä»386BSD 0.1è€Œæ¥ï¼ŒFreeBSD 2.xç‰ˆæ˜¯ç”¨4.4BSD liteæ”¹å†™ã€‚</li>
<li>HP-UXï¼ˆHPï¼‰ï¼šæ—§ç³»ç»Ÿæ˜¯ä»S IIIï¼ˆSVRxï¼‰å‘å±•é¢æ¥ï¼Œç°åœ¨æ˜¯ç”±SVR2ï¼ˆ4.2BSDï¼‰å‘å±•è€Œæ¥ï¼Œç›®å‰æ˜¯10.xç‰ˆã€‚</li>
<li>Linux(x86)ï¼šéµä»POSIXï¼ŒSYSVåŠBSDçš„æ‰©å±•ï¼Œè¿™ä¸€ç‚¹ä»ä¸Šé¡µè¡¨ä¸­å³å¯çœ‹å‡ºã€‚</li>
<li>OSF/1ï¼ˆDECï¼‰ï¼šDECå¯¹OSF/1çš„ç§»æ¤ã€‚</li>
<li>SCO UNIXï¼ˆx86ï¼‰ï¼šSVR3.2ï¼Œç›®å‰å½±å“è¾ƒå¤§çš„PC UNIXã€‚</li>
<li>SunOSï¼ˆ680x0ï¼ŒSparcï¼Œi386ï¼‰ï¼šæ ¹æ®4.3BSDï¼ŒåŒ…å«è®¸å¤šæ¥è‡ªSystem Vçš„ä¸œè¥¿ã€‚Sunçš„ä¸»è¦æˆæœåœ¨äºï¼šNFSï¼ŒOpenLook GUIæ ‡å‡†ï¼Œåæ¥æ¼”å˜ä¸ºSolaris ã€‚è¿™ä¹Ÿæ˜¯ç›®å‰æœ€è‘—åçš„UNIXç‰ˆæœ¬ä¹‹ä¸€ã€‚</li>
<li>Ultrix(DEC)ï¼šæ ¹æ®4.2BSDå†åŠ ä¸Šè®¸å¤š4.3BSDçš„ä¸œè¥¿ã€‚</li>
<li>Xenix(x86)ï¼šIntelç¡¬ä»¶å¹³å°ä¸Šçš„UNIXï¼Œä»¥SVR2ä¸ºåŸºç¡€ï¼Œç”±å¾®è½¯æ¨å‡ºã€‚åœ¨ä¸­å›½ä½¿ç”¨è¾ƒå¹¿æ³›ã€‚</li>
</ul>
<h4 id="é»‘æš—å²"><a href="#é»‘æš—å²" class="headerlink" title="é»‘æš—å²"></a>é»‘æš—å²</h4><p>Unixä¸Linuxï¼ŒSCOä¸IBMã€å¾®è½¯ï¼Œä»–ä»¬æ˜¯æ€æ ·çº ç»“åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€å›¢è§£ä¸å¼€çš„ä¹±éº»ï¼Ÿ</p>
<h5 id="é£èµ·Unix"><a href="#é£èµ·Unix" class="headerlink" title="é£èµ·Unix"></a>é£èµ·Unix</h5><p>1969å¹´â€œé˜¿æ³¢ç½—11å·â€ç™»æœˆæˆåŠŸã€‚è´å°”å®éªŒå®¤ä¸­ä¸€ä¸ªå«Ken Thompsonçš„å¹´è½»äººä¸ºäº†ä¸€åœ†ç¿±æ¸¸å¤ªç©ºçš„æ¢¦æƒ³ï¼Œåœ¨å½“æ—¶çš„Multicsç³»ç»Ÿä¸Šå†™äº†ä¸€ä¸ªå«ã€Šæ˜Ÿé™…ä¹‹æ—…ã€‹çš„æ¸¸æˆã€‚ä½†å½“æ—¶å¤§å‹æœºçš„æœºæ—¶è´¹å¾ˆè´µï¼Œæ¯ç©ä¸€æ¬¡å…¬å¸å°±è¦ä¸ºæ­¤æ”¯ä»˜75ç¾é‡‘ï¼Œäºæ˜¯Thompsonæ‰“èµ·äº†å°å‹æœºPDP-7çš„ä¸»æ„ã€‚ä½†å½“æ—¶çš„PDP-7åªæœ‰ä¸€ä¸ªç®€é™‹çš„è¿è¡Œæ—¶ç³»ç»Ÿï¼Œä¸æ”¯æŒå¤šç”¨æˆ·ï¼Œä¸ºäº†èƒ½åŒäººå¯¹æˆ˜ï¼ŒThompsonæ‰¾æ¥Dennis Ritchieä¸€èµ·å¼€å‘æ–°çš„ä½œç³»ç»Ÿã€‚ä»–ä»¬åªèŠ±äº†ä¸€ä¸ªæœˆçš„æ—¶é—´å°±ç”¨æ±‡ç¼–è¯­è¨€å†™å‡ºäº†ä½œç³»ç»Ÿçš„åŸå‹ã€‚â€œä½ å†™çš„ç³»ç»Ÿå¤ªå·®åŠ²ï¼Œå¹²è„†å°±å«Unicsç®—äº†ã€‚â€60å¹´ä»£æœ«çš„ä¸€å¤©ï¼Œè´å°”å®éªŒå®¤çš„ä¸€ä½åŒäº‹å¯¹è‚¯Â·æ±¤æ™®ç”Ÿè¿™æ ·è¯´ã€‚åŒäº‹å¸ƒè±æ©Â·ç§‘å°”å°¼å¹² Brian W.Kernighançœ‹åˆ°åï¼Œæˆç§°è¿™ä¸ªç³»ç»Ÿä¸ºUnicsâ‘¡ã€‚Unixè¿™ä¸ªåå­—å…¸å‡ºäºæ­¤ã€‚</p>
<p>åœ¨è‹±æ–‡é‡Œï¼ŒUnicså‘éŸ³ä¸Eunuchsä¸€æ ·ï¼Œè€Œåè€…çš„æ„æ€æ˜¯â€œå¤ªç›‘â€ã€‚æ±¤æ™®ç”Ÿæ¥ä¸‹åŒäº‹çš„å˜²å¼„ï¼Œç¨ä½œä¿®æ”¹ï¼ŒæŠŠè‡ªå·±ç ”å‘çš„ç³»ç»Ÿå«åšUnixã€‚</p>
<p>1971å¹´ï¼ŒUnixå·²ç»èƒ½å¤Ÿæ”¯æŒä¸¤åç”¨æˆ·åœ¨PDP-11ä¸Šç©ã€Šæ˜Ÿé™…ä¹‹æ—…ã€‹äº†ï¼Œä½†å› ä¸ºå½“æ—¶çš„Unixæ˜¯ç”¨æ±‡ç¼–è¯­è¨€å†™çš„ï¼Œæ— æ³•ç§»æ¤åˆ°å…¶ä»–æœºå™¨ä¸Šï¼Œæ‰€ä»¥ä»–ä»¬å†³å®šç”¨é«˜çº§è¯­è¨€é‡å†™Unixï¼Œå¯å½“æ—¶çš„é«˜çº§è¯­è¨€æ— è®ºä»è¿è¡Œæ•ˆç‡è¿˜æ˜¯åŠŸèƒ½ä¸Šéƒ½æ— æ³•æ»¡è¶³ä»–ä»¬çš„éœ€è¦ã€‚Thompsonå…ˆæ˜¯åœ¨BCPLçš„åŸºç¡€ä¸Šèƒå–å‡ºäº†Bè¯­è¨€ï¼ŒRitchieåˆåœ¨Bçš„åŸºç¡€ä¸Šè¿›è¡Œäº†é‡æ–°è®¾è®¡ï¼Œè¿™æ‰æœ‰äº†ä»Šå¤©å¤§åé¼é¼çš„Cè¯­è¨€ã€‚</p>
<p>60å¹´ä»£çš„è®¡ç®—æœºè™½ç„¶å·²ä¸æ˜¯åºç„¶å¤§ç‰©äº†ï¼Œä½†ä½“ç§¯ä»ç„¶ä¸å°ï¼Œè€Œä¸”çˆ±å‡ºæ•…éšœã€‚æ±¤æ™®ç”Ÿå›å¿†ï¼šâ€œè®¡ç®—è®©äººç€è¿·ï¼Œç”µå­ä¹Ÿè®©äººç€è¿·ï¼Œåªæ˜¯ä¸å¤ªå¹²å‡€ï¼Œå¾ˆè„ï¼Œå› ä¸ºç»å¸¸æœ‰ä¸œè¥¿è¢«çƒ§åã€‚â€</p>
<p>æ“ä½œè¿™äº›åˆæ…¢ã€åˆç¬¨çš„å¤§å®¶ä¼™éœ€è¦ä¸“ä¸šçš„è®¡ç®—æœºç¨‹åºå‘˜ï¼Œä¸ºäº†æé«˜æ•ˆç‡ï¼Œæ€¥éœ€æ–°ç³»ç»Ÿã€‚åœ¨è¿™ç§èƒŒæ™¯ä¸‹ï¼Œæ±¤æ™®ç”Ÿå’Œä¸¹å°¼æ–¯Â·åˆ©å¥‡ç ”å‘äº†Unixæ“ä½œç³»ç»Ÿã€‚æ­¤æ—¶ï¼Œä¹”å¸ƒæ–¯å’Œç›–èŒ¨è¿˜åœ¨ä¸­å­¦é‡Œææ¶ä½œå‰§ï¼ŒPCå’Œå¾®è½¯æ“ä½œç³»ç»Ÿè¦åœ¨10å¹´åæ‰åˆéœ²ç«¯å€ªã€‚</p>
<p>Unixä¸¤ä½åˆ›å§‹äººå’Œè´å°”å®éªŒå®¤ä¹Ÿæ²¡æŠŠè¿™å¥—æ“ä½œç³»ç»Ÿå¤ªå½“å›äº‹ï¼Œåªæ˜¯åœ¨å†…éƒ¨ä½¿ç”¨ï¼Œåæ¥å¤§å­¦ã€ç ”ç©¶æœºæ„ä¹Ÿå¯ä»¥å…è´¹ä½¿ç”¨ï¼Œè€Œä¸”è¿˜æä¾›ç»™ä»–ä»¬æºä»£ç ï¼Œå› æ­¤Unixæºä»£ç è¢«å¹¿ä¸ºæ‰©æ•£ã€‚åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œå®ƒæ²¡æœ‰åƒåæ¥çš„å•†ä¸šè½¯ä»¶é‚£æ ·æ€¥åŠŸè¿‘åˆ©ï¼Œç•™ä¸‹ä¸€å †çªŸçª¿å’Œè¡¥ä¸ï¼Œå› æ­¤ï¼ŒUnixåœ¨è¯ç”Ÿåçš„10å¹´é‡Œâ€œå…»åœ¨æ·±é—ºäººæœªè¯†â€ï¼Œåœ¨å®éªŒå®¤è¿›è¡Œç€å……åˆ†çš„ä½¿ç”¨å’Œè®ºè¯ï¼Œè¿™ä¹Ÿæ˜¯å®ƒåæ¥åœ¨è¦æ±‚ç¨³å®šæ€§ã€å®‰å…¨æ€§è¾ƒé«˜çš„ä¼ä¸šçº§å®¢æˆ·ä¸­å¾—åˆ°æ¨å´‡çš„ä¸»è¦åŸå› ã€‚</p>
<p>åˆ°äº†1980å¹´ï¼ŒUnixå¼€å§‹èµ°å‡ºå®éªŒå®¤ï¼Œæœ‰æ•°ä»¥åƒè®¡çš„æŠ€æœ¯é«˜æ‰‹æƒ³æŠŠUnixè£…åœ¨å®¶é‡Œçš„æœºå™¨ä¸Šã€‚</p>
<p>æ­¤æ—¶ï¼ŒåçŸ¥åè§‰çš„è´å°”å®éªŒå®¤å¼€å§‹è®¤è¯†åˆ°Unixçš„ä»·å€¼ï¼Œä½†ç”±äºæºä»£ç æ—©å·²å¤–æ•£ï¼Œæ— æ³•å°†å…¶æ‹¢èµ·æ¥è¿›è¡Œç²¾ç»†çš„å•†ä¸šå¼€å‘ï¼Œäºæ˜¯å¹²è„†é‡‡å–å¯¹å¤–æˆæƒçš„æ¨¡å¼ï¼Œç ”ç©¶æœºæ„ä½¿ç”¨å…è´¹ï¼Œä¼ä¸šä½¿ç”¨è¦äº¤æˆæƒè´¹ï¼Œè¿™æœ‰äº›é‡‘çŸ¿å½“åšé“œçŸ¿å–çš„å‘³é“ã€‚ä¸€ä½è´å°”é«˜çº§ä¸»ç®¡æ›¾æ„Ÿæ…¨ï¼šâ€œUnixæ˜¯ç»§æ™¶ä½“ç®¡ä»¥åçš„ç¬¬äºŒä¸ªæœ€é‡è¦å‘æ˜ã€‚â€ä½†è´å°”å®éªŒå®¤é”™å¤±å•†ä¸šå‘å±•æœºé‡ã€‚</p>
<p>â€œå¹¸è¿çš„æ—¶æœºå¥½æ¯”å¸‚åœºä¸Šçš„äº¤æ˜“ï¼Œåªè¦ä½ ç¨æœ‰å»¶è¯¯ï¼Œå®ƒå°±æ‰ä»·äº†ã€‚â€åŸ¹æ ¹åœ¨ã€Šè®ºæ—¶æœºã€‹ä¸­è¿™æ ·å†™åˆ°ã€‚å½“æ—¶æœ‰å¤šå®¶å¤§å­¦ã€ç ”ç©¶æœºæ„å’Œå…¬å¸è·å¾—äº†Unixæˆæƒï¼Œå¹¶ç”±æ­¤å¼€å§‹äº†å„è‡ªä¸åŒçš„ç‰ˆæœ¬æ¼”åŒ–ä¹‹è·¯ã€‚1993å¹´ï¼Œæ‹¥æœ‰è´å°”å®éªŒå®¤çš„ç¾å›½ç”µè¯ç”µæŠ¥å…¬å¸ï¼ˆAT&amp;Tï¼‰å°†è‡ªå·±æ‰€æ‹¥æœ‰çš„Unixæƒåˆ©å–ç»™Novellï¼Œåè€…æˆä¸ºæ¥å—Unixè¡£é’µçš„åˆæ³•ç»§æ‰¿äººã€‚å½“ç„¶æ­¤æ—¶çš„IBMã€DECã€HPå’ŒSunå› ä¸ºæ—©å¹´çš„æˆæƒç¼˜æ•…ï¼Œæœ‰æƒç»§ç»­è¿›è¡Œå„è‡ªçš„Unixç‰ˆæœ¬çš„ç ”å‘ã€‚</p>
<p>1995å¹´ï¼ŒNovellåˆå°†Unixç›¸å…³èµ„äº§å–ç»™SCOã€‚å’Œä¸¤å¹´å‰AT&amp;TæŠŠUnixå–ç»™Novellä¸€æŠŠæ¸…çš„å±€é¢æœ‰æ‰€ä¸åŒï¼ŒSCOå½“æ—¶æ²¡æœ‰è¶³å¤Ÿçš„ç°é‡‘ä¸€æ¬¡æ€§ä»˜æ¸…ï¼Œå› æ­¤NovellåˆæœŸåªæ˜¯æŠŠUnixæºä»£ç äº¤ç»™äº†SCOï¼Œå¯¹äºUnixè‘—ä½œæƒçš„å½’å±åè®®å­˜åœ¨ç€è¯­ç„‰ä¸è¯¦å’Œæ¨¡æ£±ä¸¤å¯çš„åœ°æ–¹ã€‚</p>
<p>èŠ±äº†é’±çš„SCOå®£ä¼ è‡ªå·±æ˜¯Unixæ­£å®—ä¼ äººï¼ŒNovellå½“æ—¶è§†Unixä¸ºé¸¡è‚‹ï¼Œæ²¡æœ‰å¼‚è®®ï¼Œè€Œä¸”æ­¤æ—¶SCOæ²¡æœ‰å¯¹åˆ«çš„è·å¾—è¿‡Unixæˆæƒçš„å‚å•†ç½®å–™ï¼Œäºæ˜¯å¤§å®¶è¿›å…¥äº†ä¸€æ®µç›¸å®‰æ— äº‹çš„æ—¶æœŸã€‚</p>
<h5 id="å¾®è½¯çš„è¿›è¿›å‡ºå‡º"><a href="#å¾®è½¯çš„è¿›è¿›å‡ºå‡º" class="headerlink" title="å¾®è½¯çš„è¿›è¿›å‡ºå‡º"></a>å¾®è½¯çš„è¿›è¿›å‡ºå‡º</h5><p>å…«åå¹´ä»£æœ«ï¼Œæœ‰äººé—®æ¯”å°”Â·ç›–èŒ¨æ€ä¹ˆçœ‹å¾…Unixä¸å¾®è½¯æ„æˆçš„ç«äº‰ï¼Œä»–ç¬‘ç€é—®é“ï¼šâ€œå“ªä¸ªUnixï¼Ÿâ€å¾®è½¯ä¸Unixçš„å…³ç³»æºè¿œæµé•¿ï¼Œå¹¶å¯¹SCOçš„æ¼”å˜èµ·äº†é‡è¦çš„å‚¬åŒ–ä½œç”¨ã€‚1979å¹´ï¼Œå¾®è½¯ä»ç¾å›½ç”µè¯ç”µæŠ¥å…¬å¸è·å¾—æˆæƒï¼Œä¸ºIntelå¤„ç†å™¨æ‰€å¼€å‘ä¸€ç§Unixæ“ä½œç³»ç»Ÿï¼Œç”±äºå®ƒè´­ä¹°çš„æˆæƒæ— æ³•ç›´æ¥è®©è¯¥æ“ä½œç³»ç»Ÿä»¥â€œUnixâ€ä¸ºåï¼Œäºæ˜¯è¯¥ç³»ç»Ÿå‘½åä¸ºXenixï¼Œå¯ç”¨åœ¨ä¸ªäººç”µè„‘åŠå¾®å‹è®¡ç®—æœºä¸Šä½¿ç”¨ã€‚å¾®è½¯å¹¶ä¸ç›´æ¥æŠŠXenixé”€å”®ç»™ç»ˆç«¯å®¢æˆ·ï¼Œè€Œæ˜¯ä»¥OEMçš„å½¢å¼å†æˆæƒç»™Intelã€Tandyã€æ–½ä¹AltosåŠSCOå…¬å¸ã€‚</p>
<p>å¯¹äºå¾®è½¯æ¥è¯´ï¼Œç”±äºéœ€è¦ä»ç¾å›½ç”µè¯ç”µæŠ¥å…¬å¸è·å¾—æˆæƒï¼Œå› è€Œè¿™æ˜¯ä¸€ç§è‡ªå·±éš¾ä»¥æŠŠæ¡å…¶æœªæ¥å‘å±•å‘½è¿çš„æ“ä½œç³»ç»Ÿï¼Œè€Œä¸”å½“æ—¶å…¶ä»–å‚å•†ä¸åŒçš„ç‰ˆæœ¬åœ¨æ…æµ‘è¿™ä¸ªå¸‚åœºï¼Œæ‰€ä»¥ï¼Œç›–èŒ¨åœ¨å¯»æ‰¾æœºä¼šé€€å‡ºè¿™ä¸ªé¢†åŸŸã€‚å½“å¾®è½¯å’ŒIBMè¾¾æˆå¼€å‘OS/2æ“ä½œç³»ç»Ÿçš„åè®®åï¼Œç›–èŒ¨ä¾¿å¤±å»äº†æ¨å¹¿Xenixçš„å…´è¶£ã€‚</p>
<p>å¤šå¹´åçš„å†å²èµ„æ–™æ­ç§˜æ˜¾ç¤ºï¼Œå¾®è½¯å½“æ—¶è„šè¸©å¤šæ¡èˆ¹ï¼Œé™¤å’ŒIBMè”æ‰‹å¼€å‘OS/2æ“ä½œç³»ç»Ÿå¤–ï¼Œå¾®è½¯è¿˜åœ¨ç´§é”£å¯†é¼“åœ°è¿›è¡Œç€Windows 3.0ç³»ç»Ÿçš„ç ”å‘ã€‚å¾®è½¯ä¸å¯èƒ½åœ¨ä¸‰æ¡çº¿ä¸ŠåŒæ—¶æŠ•å…¥ç²¾åŠ›ï¼Œäºæ˜¯å†³å®šèˆå¼ƒXenixæ“ä½œç³»ç»Ÿã€‚</p>
<p>â€œèµ›è½¦å’Œåšäººä¸€æ ·ï¼Œæœ‰æ—¶å€™è¦åœï¼Œæœ‰æ—¶å€™è¦å†²ã€‚â€è¿™æ˜¯ç”µè§†å‰§ã€Šæé€Ÿä¼ è¯´ã€‹ä¸­çš„ä¸€å¥å°è¯ã€‚1987å¹´ï¼Œå¾®è½¯ä¸SCOè¾¾æˆäº†ä¸€é¡¹åè®®ï¼Œä»¥æŒæœ‰åè€…è‚¡ç¥¨25%çš„æ¡ä»¶è½¬è®©äº†Xenixçš„æ‰€æœ‰æƒã€‚ä»å¾®è½¯æ¥ç›˜çš„SCOï¼Œå°†è¿™ç§æ“ä½œç³»ç»Ÿä»¥æœ€å¿«é€Ÿåº¦ç§»æ¤åˆ°386ç”µè„‘ï¼Œæˆä¸ºé¦–æ¬¾æ”¯æŒIntel386èŠ¯ç‰‡çš„æ“ä½œç³»ç»Ÿï¼ŒæŠ“ä½äº†å¸‚åœºçš„å…ˆæœºã€‚</p>
<p>å½“æ—¶çš„å¸‚åœºæ ¼å±€æ˜¯è¿™æ ·ï¼Œå°å‹æœºåŠ äº”èŠ±å…«é—¨çš„Unixæ“ä½œç³»ç»ŸæŠŠæŒäº†é«˜ç«¯çš„ä¼ä¸šçº§ç”¨æˆ·å¸‚åœºï¼Œå…¶ä¸­çš„ä»£è¡¨å‚å•†æ˜¯IBMã€DECã€æƒ æ™®ã€SUNã€SGIç­‰ï¼›IntelèŠ¯ç‰‡åŠ å¾®è½¯æ“ä½œç³»ç»Ÿï¼Œæ­£åœ¨å…¨é¢æ§åˆ¶ä¸ªäººç”µè„‘å¸‚åœºï¼Œå…¶ä¸­çš„ä»£è¡¨å‚å•†åŒ…æ‹¬åº·æŸã€ASTã€ä½°å¾·ç­‰ã€‚å°å‹æœºåŠ Unixæ“ä½œç³»ç»Ÿçš„é˜µè¥é„™è§†IntelèŠ¯ç‰‡åŠ å¾®è½¯æ“ä½œç³»ç»Ÿå½¢æˆçš„Wintelè”ç›Ÿï¼Œå‰è€…è®¤ä¸ºåè€…ç®€é™‹ï¼Œè€Œåè€…åˆ™è®¤ä¸ºå‰è€…æ˜¯è€åŒ–é¡½å›ºã€‚</p>
<p>SCOæ­¤æ—¶æ‰®æ¼”çš„è§’è‰²æœ‰ç‚¹åƒâ€œè™è â€ï¼Œéé¸Ÿéå…½ï¼Œå®ƒçš„è¿è¥æ¨¡å¼æ˜¯IntelèŠ¯ç‰‡åŠ Unixæ“ä½œç³»ç»Ÿï¼Œåœ¨ä¸¤å¤§é˜µè¥é—´ç¿©ç¿©é£ã€‚éšç€è£…æœ‰IntelèŠ¯ç‰‡ç”µè„‘çš„æ”»åŸç•¥åœ°ï¼ŒSCOä¹Ÿè·Ÿç€åˆ†åˆ°ä¸€æ¯ç¾¹ã€‚80å¹´ä»£æœ«ï¼Œæœ‰åª’ä½“ç§°Xenixä¸ºâ€œå¯èƒ½æ˜¯ä¼ æ’­æœ€å¹¿çš„UNIXæ“ä½œç³»ç»Ÿâ€ã€‚</p>
<p>SCOè¿›å…¥äº†å…¶å‘å±•å²ä¸Šæœ€è¾‰ç…Œçš„æ—¶æœŸã€‚å½“ç„¶è¿™æ®µæ—¶é—´ï¼ŒUnixçš„å‘å±•ä¹Ÿè¿›å…¥äº†é»„é‡‘æœŸã€‚1984å¹´9æœˆã€Šè´¢å¯Œã€‹æ‚å¿—ç§°ï¼Œå…¨çƒèŒƒå›´å†…750æ‰€å¤§å­¦ä¸­80ï¼…çš„è®¡ç®—æœºé¢†åŸŸçš„æ•™æˆæ˜¯Unixç”¨æˆ·ï¼Œå› æ­¤å½“æ—¶è®¡ç®—æœºä¸“ä¸šæ¯•ä¸šçš„å­¦ç”Ÿéƒ½æ¥è§¦è¿‡Unixï¼Œä»–ä»¬æ¯•ä¸šåæˆä¸ºITé¢†åŸŸçš„éª¨å¹²ã€‚</p>
<p>ç›–èŒ¨æŠ›å¼ƒäº†Unixï¼Œä½†æ²¡æ‰“ç®—æŠ›å¼ƒè¿™å—ä¸°é¥¶çš„å¸‚åœºï¼Œè€Œä¸”SCOçš„æˆåŠŸä¹Ÿåˆºæ¿€äº†ä»–ï¼šè‡ªå·±æ‰”æ‰çš„ä¸€å—é¸¡è‚‹ç«Ÿç„¶æˆäº†è¿™ä¸ªå°è·Ÿç­çš„è‚¥ç¾ç‰›æ’ã€‚æ¢è°ä¸æµå£æ°´å•Šï¼Ÿæœ‰å¥è°šè¯­æ˜¯â€œåˆ«è®©å£é¦‹çš„äººçœ‹è§ä½ çš„å¤§ç¢—â€ã€‚</p>
<p>Unixæœ‰ä¸ªè‡´å‘½ç¼ºé™·ï¼šä»æ¥å°±æ²¡æœ‰é€šç”¨ç‰ˆå­˜åœ¨ã€‚å¤šå¹´ä»¥æ¥ï¼Œç”±äºæ—©æœŸæ··ä¹±çš„æˆæƒï¼Œäº”èŠ±å…«é—¨ã€ä¸åŒç‰ˆæœ¬çš„Unixéåœ°å¼€èŠ±ï¼Œæ‰€ä»¥ä¸ºå…¶ä¸­ä¸€ä¸ªç‰ˆæœ¬å†™çš„åº”ç”¨ç¨‹åºï¼Œå¸¸å¸¸è¦ä¿®æ”¹åæ‰èƒ½è¿ç”¨åˆ°å¦ä¸€ä¸ªä¸Šï¼Œè¿™å¯¹äºä¸“ä¸šçš„ç¨‹åºå‘˜æ¥è¯´ä¹Ÿè®¸ä¸æ˜¯å¤ªå¤§é—®é¢˜ï¼Œä½†å¯¹æŠ€æœ¯å®åŠ›è¾ƒå¼±çš„ç”¨æˆ·æ¥è¯´ï¼Œåˆ™å¹³æ·»äº†è®¸å¤šéº»çƒ¦ã€‚</p>
<p>ä»Unixè„±èº«è€Œå‡ºçš„ç›–èŒ¨æ·±çŸ¥å…¶æ”¯ç¦»ç ´ç¢çš„å¼±ç‚¹ï¼Œä»–ä¸‹ä»¤å¾®è½¯æ‰“é€ ä¸€æ¬¾â€œå¯ç§»æ¤çš„â€çš„æ“ä½œç³»ç»Ÿâ€”â€”â€œUnixæ€æ‰‹â€ã€‚è¿™å°±æ˜¯å¾®è½¯çš„Windows NTï¼ŒåŒ…æ‹¬SCOåœ¨å†…çš„Unixé˜µè¥å°†æ„Ÿå—åˆ°å®ƒå¸¦æ¥çš„å·¨å¤§å‹åŠ›ã€‚</p>
<p>æ­Œæ‰‹é²å‹ƒÂ·è¿ªä¼¦åœ¨ã€Šæ—¶ä»£åœ¨è½¬å˜ã€‹ä¸€è¯—ä¸­å†™åˆ°ï¼šâ€œåŠ¨ç¬”é¢„è¨€ä¸–äº‹çš„ä½œå®¶ä¸è¯„è®ºå®¶ä»¬ï¼Œå¼ å¤§ä½ ä»¬çš„åŒçœ¼ï¼Œæœºä¼šä¸ä¼šå†æ¥ç¬¬äºŒéï¼Œè½®ç›˜è¿˜åœ¨æ—‹è½¬ï¼Œå…ˆåˆ«è¨€ä¹‹è¿‡å…ˆï¼Œçœ‹ä¸å‡ºæ¥è°ä¼šè¢«é€‰ï¼Œå› ä¸ºç›®å‰çš„è¾“å®¶æœªæ¥ä¼šé¢†å…ˆï¼Œå› ä¸ºæ—¶ä»£æ­£åœ¨æ”¹å˜ã€‚â€</p>
<h5 id="å¼ºæ‚å¯¹æ‰‹é€†è¢­"><a href="#å¼ºæ‚å¯¹æ‰‹é€†è¢­" class="headerlink" title="å¼ºæ‚å¯¹æ‰‹é€†è¢­"></a>å¼ºæ‚å¯¹æ‰‹é€†è¢­</h5><p>â€œæˆ‘ä¸ä¼šç”¨ç‹—å±å»æ±¡æŸ“ï¼ˆNTï¼‰â€ã€‚Windows NTç ”å‘è´Ÿè´£äººå¤§å«Â·å¡ç‰¹å‹’è¿™æ ·é«˜å£°åœ°åš·ç€ï¼Œä»–æ‹’ç»å…è¯ºæ–°ä¸€ä»£çš„æ“ä½œç³»ç»Ÿå…¼å®¹å·²æœ‰çš„DOSå’ŒWindowsã€‚åŸæ¥ï¼Œå®šä¸‹â€œUnixæ€æ‰‹â€è®¡åˆ’åï¼Œç›–èŒ¨å‡†å¤‡ç»„ç»‡ä¸€ä¸ªå›¢é˜Ÿæ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚â€œæˆ‘å¤ªæƒ³è¦ä¸€ä¸ªå¯ç§»æ¤çš„æ“ä½œç³»ç»Ÿäº†ï¼Œâ€ç›–èŒ¨è¯´ï¼Œâ€œé—®é¢˜ä¸åœ¨äºæˆ‘ä»¬æ˜¯å¦åº”è¯¥ç»„æˆå›¢é˜Ÿï¼Œè€Œåœ¨äºä½•æ—¶èƒ½ç»„æˆå›¢é˜Ÿå»å¼€å‘å®ƒã€‚â€</p>
<p>éšåæœºä¼šæ¥äº†ï¼ŒDECçš„æ ¸å¿ƒå·¥ç¨‹å¸ˆå¡ç‰¹å‹’å› åœ¨å…¬å¸åå†·æ¿å‡³è€ŒèŒç”Ÿå»æ„ã€‚â€œå¤§å¤šæ•°äººå­¦ä¼šå¦‚ä½•æŠŠä¸€ä»¶äº‹åšå¾—å¾ˆæ¼‚äº®ä»¥åï¼Œä¾¿ä¸€ç”Ÿä¸€ç›´åšè¿™ä¸ªï¼Œâ€å¡ç‰¹å‹’ä¸€ä¸ªåŒäº‹è¯„ä»·ä»–ï¼šâ€œå¡ç‰¹å‹’ä¼šä»è‡ªå·±çš„æˆåŠŸä¸­å­¦ä¹ ã€‚ä¸‹ä¸€æ¬¡ï¼Œä»–ä¼šåšå¾—æ›´å¥½ã€‚æ‰€ä»¥æ¯æ¬¡ï¼Œä»–éƒ½ä¸Šå‡åˆ°ä¸€ä¸ªæ–°çš„é«˜åº¦ã€‚â€</p>
<p>å¡ç‰¹å‹’å…¨èº«å¿ƒåœ°æŠ•å…¥ç¨‹åºå¼€å‘ï¼Œè€Œå†·è½äº†ä¸¤ä»»å¦»å­ï¼Œåæ¥ä»–å‘èª“å†ä¹Ÿä¸ä¼šç»“å©šï¼Œâ€œç»“å©šæ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œä½ åªèƒ½çŠ¯ä¸¤æ¬¡é”™â€ã€‚å¡ç‰¹å‹’åœ¨ç¨‹åºå¼€å‘ä¸Šç²¾ç›Šæ±‚ç²¾ï¼Œâ€œå¯¹å¯èƒ½å¹²æ‰°ä»–çš„ä»»ä½•äººå’Œäº‹ï¼Œä»–ä¸ä»…ç½®ä¹‹ä¸ç†ï¼Œè€Œä¸”è¿˜ä¼šå¯¹å…¶è¿›è¡Œæ”»å‡»å’Œè¯‹æ¯â€ï¼Œå› æ­¤ï¼Œä»–ä¸DECå…¬å¸é«˜ç®¡ä»¬ç›¸å¤„å¾—å¾ˆä¸æ„‰å¿«ã€‚</p>
<p>ç›–èŒ¨äº²è‡ªæ‹œä¼šå¡ç‰¹å‹’ï¼Œæƒ³è®©ä»–åŠ ç›Ÿå¾®è½¯ã€‚åˆæ¬¡è§é¢ï¼Œå¡ç‰¹å‹’å°±ç»™ç›–èŒ¨ä¸€ä¸ªä¸‹é©¬å¨ï¼Œç›´è¨€ä¸è®³åœ°ç§°å¾®è½¯çš„ä»£ç å†™å¾—å¾ˆâ€œçƒ‚â€ï¼Œè®¤ä¸ºç›–èŒ¨å½“æ—¶æ§åœ¨æ‰‹å¿ƒé‡Œçš„ã€æ·±ä»¥ä¸ºå‚²çš„DOSï¼Œåœ¨ä»–çš„çœ¼é‡Œå°±æ˜¯ä¸€ä¸ªç©å…·ã€‚å¡ç‰¹å‹’è¯´åªæœ‰è‡ªå·±æ‰æœ‰èƒ½åŠ›å¼€å‘å‡ºä¸€ä¸ªèƒ½é¢å‘æœªæ¥è¿›è¡Œç½‘ç»œç®¡ç†ã€å…·æœ‰é«˜å¯é æ€§çš„æ“ä½œç³»ç»Ÿã€‚</p>
<p>æ­¤æ—¶çš„ç›–èŒ¨å·²èµ°è¿‡åˆ›ä¸šæœŸï¼Œæ‹¥æœ‰æµ·é‡çš„è´¢å¯Œä¸å¼ºåŠ¿çš„æƒåŠ›ï¼Œè€³è¾¹å¹è¿‡çš„éƒ½æ˜¯â€œè½¯ä»¶ç¥ç«¥â€çš„æ‚¦è€³ä¹‹éŸ³ã€‚ä¸è¿‡ï¼Œå¡ç‰¹å‹’çš„åˆºè€³ä¹‹éŸ³å’Œè½»è”‘æ€åº¦åè€Œåšå®šäº†ç›–èŒ¨è˜è¯·ä»–çš„å†³å¿ƒï¼Œç›–èŒ¨å‘å¯¹æ–¹è¡¨ç¤ºå°†ç»™äºˆå……åˆ†çš„å‘å±•ç©ºé—´å’Œè‡ªç”±ã€‚åŠ±å¿—å¤§å¸ˆæˆ´å°”Â·è‚¯è€åŸºè¯´ï¼šâ€œåœ¨ä¸–ç•Œä¸Šï¼Œè¦å½±å“åˆ«äººçš„æƒŸä¸€åŠæ³•å°±æ˜¯è°ˆè®ºä»–ä»¬çš„éœ€è¦ï¼Œå¹¶å‘Šè¯‰ä»–ä»¬å»å¦‚ä½•æ»¡è¶³è¿™äº›éœ€è¦ã€‚â€</p>
<p>å¡ç‰¹å‹’åˆ°å¾®è½¯ä¹‹åï¼Œç›–èŒ¨å°½å¯èƒ½åœ°æ»¡è¶³ä»–çš„è¦æ±‚ï¼Œæœ‰äº›ç”šè‡³æ˜¯æ‰“ç ´å¾®è½¯æƒ¯ä¾‹çš„ã€‚è­¬å¦‚å¡ç‰¹å‹’ä¸è¦å¾®è½¯åŸæ¥çš„å·¥ç¨‹å¸ˆå‚ä¸ä»–çš„å›¢é˜Ÿï¼Œä»–æŠŠè‡ªå·±åœ¨DECå·¥ä½œæ—¶çš„å›¢é˜Ÿå¸¦äº†è¿‡æ¥ï¼Œå…¶ä¸­æœ‰äº›æ˜¯ç¡¬ä»¶å·¥ç¨‹å¸ˆï¼Œæ˜¯å¡ç‰¹å‹’çš„å¥½å‹ã€‚ç›–èŒ¨åŸæ¥ä¸æ‰“ç®—è¦ï¼Œä½†å¡ç‰¹å‹’å¨èƒä¸è®©ä»–ä»¬æ¥ï¼Œè‡ªå·±å°±ä¸æ¥ã€‚</p>
<p>ç›–èŒ¨è®©æ­¥ï¼Œæ»¡è¶³äº†å¡ç‰¹å‹’æ‰€éœ€è¦çš„ä¸€åˆ‡ã€‚æ­¤å‰ï¼Œæ§åˆ¶æ¬²æå¼ºçš„ç›–èŒ¨ä¼šäº²è‡ªæ£€æŸ¥å¾®è½¯çš„å¤§éƒ¨åˆ†ä»£ç ï¼Œåœ¨ä»–åˆ¨æ ¹æ­åº•åœ°ç©·é—®ä¸‹ï¼Œç¨‹åºå‘˜æœ‰æ—¶ä¼šéœ²å‡ºç ´ç»½ï¼Œè¿™æ—¶ç›–èŒ¨ä¼šä¸ç•™æƒ…é¢åœ°ç—›æ–¥ï¼Œå¸¦æœ‰æ”»å‡»æ€§è¨€è¯­ï¼Œè­¬å¦‚â€œè¿™æ˜¯æœ‰å²ä»¥æ¥æœ€æ„šè ¢çš„ä»£ç â€ä¼šåŠˆå¤´ç›–è„¸åœ°ç ¸è¿‡å»ã€‚ä½†ç›–èŒ¨å¯¹å¡ç‰¹å‹’çš„é¡¹ç›®åˆ™æ”¾æ‰‹åˆ°å‡ ä¹â€œæ”¾ä»»è‡ªæµâ€çš„åœ°æ­¥ã€‚Airbnbè”åˆåˆ›å§‹äººå…¼CEOå¸ƒè±æ©Â·åˆ‡æ–¯åŸºè¯´è¿‡ï¼šâ€œä½ æœ‰æ—¶å€™å¿…é¡»é è¾¹ç«™ï¼Œå¦‚æœä½ è¦æ’æ‰‹ç»†èŠ‚ï¼Œä½ ä¼šå¾ˆç—›è‹¦ã€‚ä½†æ˜¯ä½ è¦æ˜¯ç«™å¾—è¿œä¸€ç‚¹ï¼Œä½ å°±èƒ½çœ‹æ¸…å¤§å±€ã€‚â€</p>
<p>ç›–èŒ¨è¯†æ‰çš„çœ¼å…‰å’Œç”¨äººä¸ç–‘çš„æ€åº¦ï¼Œæœ€ç»ˆå¾—åˆ°äº†ä¸°åšçš„å›æŠ¥ï¼Œ1993å¹´ï¼ŒWindows NTå®Œç¾äº®ç›¸ï¼Œæˆä¸ºå¾®è½¯æ’¬åŠ¨Unixå¸‚åœºçš„ä¸€æŠŠåˆ©å™¨ã€‚å¡ç‰¹å‹’ä¹Ÿè·å¾—äº†Windows NTä¹‹çˆ¶çš„èµèª‰ï¼Œåœ¨å¾®è½¯å‘å±•å²ä¸Šå æœ‰ä¸€å¸­ä¹‹åœ°ã€‚ç½—æ°â€¢ç¦å°”å…‹åœ¨ã€Šæ¼«è°ˆä¼ä¸šç®¡ç†ã€‹ä¸­æåˆ°ï¼šâ€œä¸€ä¸ªäººåªæœ‰å¤„åœ¨æœ€èƒ½å‘æŒ¥å…¶æ‰èƒ½çš„å²—ä½ä¸Šï¼Œä»–æ‰ä¼šå¹²å¾—æœ€å¥½ã€‚â€ç›–èŒ¨è‡ªå·±åœ¨è¿™ä¸€æ—¶æœŸè¯´è¿‡ï¼šâ€œå¯¹æˆ‘æ¥è¯´ï¼Œè·Ÿä¸€ä¼™èªæ˜çš„å·¥ç¨‹å¸ˆä¸€èµ·å·¥ä½œï¼Œç ”å‘å‡ºäº§å“ï¼Œç„¶åä½ èµ°å‡ºå»çœ‹åˆ°äººä»¬ç¡®å®åœ¨ä½¿ç”¨å®ƒä»¬ï¼Œè¿™æ‰æ˜¯æ›´å¤§çš„ä¹è¶£æ‰€åœ¨ã€‚â€</p>
<p>åœ¨åŒ…æ‹¬SCOåœ¨å†…çš„Unixé˜µè¥å¼€è¶³é©¬åŠ›è´¬ä½Windows NTä¹‹æ—¶ï¼ŒWindows NTå´åœ¨é«˜ç«¯å¸‚åœºä¸Šå¤§æ­¥å‰è¿›ï¼ŒSCOåˆ™å¼€å§‹èµ°ä¸‹å¡è·¯ã€‚</p>
<p>â€œèŠ‚ç‰©é£å…‰ä¸ç›¸å¾…ï¼Œæ¡‘ç”°ç¢§æµ·é¡»è‡¾æ”¹ã€‚â€åœ¨å¾®è½¯ä¸Unixé˜µè¥çš„å¯¹æ‰‹è¿›è¡Œè½¦è½®æˆ˜çš„åŒæ—¶ï¼Œä¸€è‚¡æ–°çš„åŠ›é‡åœ¨ç”Ÿæˆå¹¶å˜å¾—å¼ºå¤§èµ·æ¥ï¼Œå·¦å³äº†æˆ˜å±€çš„å‘å±•æ–¹å‘ã€‚è¿™å°±æ˜¯Linuxã€‚</p>
<p>èµ·åˆç›–èŒ¨è®¤ä¸ºLinuxæ— è¶³è½»é‡ï¼Œä½†å¤§é‡çš„ç”¨æˆ·ä¸è¿™æ ·è®¤ä¸ºï¼Œä»–ä»¬å¯¹LinuxæŠ•å»é’ççš„ç›®å…‰ï¼Œå› ä¸ºLinuxå…¬å¼€æˆæƒï¼Œå…è®¸ç”¨æˆ·é”€å”®ã€æ‹·è´å¹¶ä¸”æ”¹åŠ¨ç¨‹åºï¼Œåªä¸è¿‡è¦æ±‚ä¿®æ”¹åçš„ä»£ç ä¹Ÿå…è´¹å…¬å¼€ï¼Œè¿™äº›ä¸¾æªæˆäº†Linuxè”“å»¶çš„å¼ºå¤§æ¨åŠ›ï¼Œå¹¶ç»™å¾®è½¯å¸¦æ¥äº†å¼ºçƒˆçš„å†²å‡»ã€‚</p>
<p>Linuxçš„å­˜åœ¨ç»™äº†å¯¹å¾®è½¯ä¸€ç›´å¿ƒå­˜æ•Œæ„çš„å¯¹æ‰‹ä»¬ä¸€æŠŠé›ªè€»çš„åˆ©åˆƒï¼ŒåŒ…æ‹¬IBMã€Oracleã€Sunç­‰ä¸šç•Œå¤§é³„ï¼Œçº·çº·è¡¨ç¤ºæ‰¶æŒLinuxï¼Œå¹¶ä»¥å„ç§æ–¹å¼æ”¯æŒLinuxï¼Œå‘é™·ä½å¾®è½¯æˆ˜é´çš„æ³¥æ½­çŒè¿›å»æ›´å¤šçš„æ°´ã€‚å¾®è½¯ä¸€åº¦é™·å…¥äº†è¢«åŠ¨çš„å±€é¢ã€‚ä½†éšç€Linuxçš„å‘å±•ï¼Œæˆ˜å±€å‘ç”Ÿäº†å¾®å¦™çš„å˜åŒ–ã€‚</p>
<p>åœ¨ä¸€ä¸ªå…¬å¼€åœºåˆï¼Œç›–èŒ¨è¡¨ç¤ºï¼šâ€œå—åˆ°Linuxèš•é£Ÿçš„æ˜¯Unixï¼Œè€Œä¸æ˜¯Windowsã€‚â€ä»–è¯´ï¼šâ€œæˆ‘ä»¬ç¡®å®åœ¨ä¸Linuxç«äº‰ï¼Œä½†è½¬æ¢åˆ°Linuxçš„Unixå¸‚åœºæ˜¯ç›¸å½“å¯è§‚çš„ã€‚Windowså’ŒLinuxå°†å…±åŒä¸»å¯¼å¸‚åœºã€‚â€</p>
<p>å¸‚åœºåˆ†ææœºæ„Gartnerä¹Ÿå®£ç§°ï¼ŒLinuxå’Œå¼€æ”¾æºä»£ç ä¼šç»§ç»­å‘å±•ï¼Œä½†å®ƒä»¬æ‰€æ å¤ºçš„æ˜¯Unixè€Œä¸æ˜¯å¾®è½¯çš„é¢†åœ°ã€‚ä¸Unixæœ‰ç€åƒä¸ä¸‡ç¼•è”ç³»çš„Linuxï¼Œç«Ÿç„¶æ‰®æ¼”äº†Unixç»ˆç»“è€…çš„è§’è‰²ï¼Ÿ</p>
<p>è¿™æ˜¯å› ä¸ºUnixæ“ä½œç³»ç»Ÿä»·æ ¼æ¯”å¾®è½¯çš„äº§å“æ›´é«˜ï¼Œå¸‚åœºä»½é¢ä¹Ÿæ›´å°‘ï¼Œå—åˆ°Linuxçš„å†²å‡»ä¹Ÿæ›´å¤§ï¼Œé ç€Unixåƒé¥­çš„SCOå¯¹æ­¤æ„ŸåŒèº«å—ã€‚ä¸€ä½Linuxå‚å•†æŠ€æœ¯æ€»ç›‘æ›¾æ”¾è¯ï¼šâ€œSCO Unixçš„ç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸäº†ï¼Œç³»ç»Ÿç§»æ¤æ˜¯å¿…ç„¶çš„ã€‚â€</p>
<p>ä¸å…¶åä»¥å¾…æ¯™ï¼Œä¸å¦‚å¥‹åŠ›ä¸€å‡»ã€‚è¿›å…¥21ä¸–çºªåï¼Œæ—¥æ¸å¼å¾®çš„SCOå¼€å§‹ç­–åˆ’ä¸€å‡ºéœ‡æƒŠITä¸šç•Œçš„å¤§æˆã€‚</p>
<h5 id="è½¦è½®è¯‰è®¼å¤§æˆ˜"><a href="#è½¦è½®è¯‰è®¼å¤§æˆ˜" class="headerlink" title="è½¦è½®è¯‰è®¼å¤§æˆ˜"></a>è½¦è½®è¯‰è®¼å¤§æˆ˜</h5><p>â€œåœ¨è¿‡å»çš„18ä¸ªæœˆï¼Œæˆ‘ä»¬å‘ç°IBMæŠŠä¸€äº›æå…¶é«˜ç«¯çš„ä¼ä¸šè¿ç®—æŠ€æœ¯çš„æºä»£ç å…¬å¼€äº†ã€‚å…¶ä¸­éƒ¨åˆ†çœ‹ä¸Šå»ä¸æˆ‘ä»¬æ‹¥æœ‰çŸ¥è¯†äº§æƒçš„æŠ€æœ¯éå¸¸ç›¸ä¼¼ï¼Œè¿åäº†æˆ‘ä»¬ä¸IBMä¹‹é—´çš„åè®®ã€‚ä»–ä»¬çš„è¡Œä¸ºä¹‹é—´ç ´åäº†æˆ‘ä»¬ä¹‹é—´ä¸å…¬å¼€è¿™éƒ¨åˆ†æŠ€æœ¯çš„åè®®ï¼Œå•æ–¹é¢å…¬å¼€äº†æºä»£ç ã€‚æˆ‘ä»¬æœ‰è¯æ®è¡¨æ˜éƒ¨åˆ†ä»£ç æ˜¯é€å­—çš„æŠ„è¢­ã€‚â€2003å¹´5æœˆï¼ŒSCOçš„CEOè¾¾å°”Â·éº¦å…‹å¸ƒè±å¾·è¿™æ ·è¯´ã€‚</p>
<p>SCOæ§å‘ŠIBMçš„Linuxç ´åäº†åŒæ–¹ä¹‹å‰ç­¾è®¢çš„è½¯ä»¶ä»£ç æˆæƒåè®®ï¼Œå£°ç§°IBMå…è´¹æ•£å‘æœ‰çŸ¥è¯†äº§æƒçš„ä»£ç ï¼ŒæŠŠä¸€äº›Unixçš„ä»£ç æ”¹å¤´æ¢é¢ååŠ å…¥Linuxäº§å“ä¸­ï¼Œå› æ­¤è¦æ±‚è“è‰²å·¨äººèµ”å¿è‡ªå·±10äº¿ç¾å…ƒã€‚â€œåˆå¯’å†»å·¨æµ·ï¼Œæ€æ°”æµå¤§è’ã€‚â€æ­¤ä¸¾åœ¨Linuxé˜µè¥ç‚¸å¼€äº†é”…ï¼Œä»–ä»¬è®¤ä¸ºSCOæ­¤ä¸¾ä¸ºâ€œé¡¹åº„èˆå‰‘ï¼Œæ„åœ¨æ²›å…¬â€ï¼Œæœ€ç»ˆç›®æ ‡æ˜¯æŒŸåˆ¶æ•´ä¸ªLinuxé˜µè¥ã€‚</p>
<p>éšåï¼Œå¾®è½¯çš„åŠ¨ä½œè®©è¿™ä¸ªå±€é¢å˜å¾—æ··ä¹±èµ·æ¥ã€‚èµ·è¯‰IBMåä¸ä¹…ï¼ŒSCOå®£å¸ƒå‘å¾®è½¯å‘æ”¾UnixæŠ€æœ¯è®¸å¯ï¼ŒåŒ…æ‹¬ä¸“åˆ©æƒå’Œæºä»£ç ã€‚å°±æ˜¯è¯´ï¼Œå¾®è½¯ä»¥èŠ±é’±ä¹°è´­ä¹°SCOçš„UnixæŠ€æœ¯è®¸å¯æƒçš„æ–¹å¼ï¼Œæ‰¿è®¤äº†å¯¹æ–¹Unixåˆæ³•ä¼ äººçš„åœ°ä½ã€‚</p>
<p>å¸ƒé²æ–¯Â·ä½©ä¼¦æ–¯ç§°ï¼šâ€œå¯¹äºå¾®è½¯æ¥è¯´ï¼Œè´­ä¹°SCOçš„æºä»£ç æˆæƒå‡ ä¹æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚èŠ±é’±è´­ä¹°SCOå…¬å¸çš„æˆæƒï¼Œåªä¸è¿‡æ˜¯å¯¹ä¸€ç§â€˜è¡Œè´¿â€™è¡Œä¸ºçš„ç²‰é¥°ï¼Œé¡ºä¾¿è¿˜å¯¹æœªæ¥çš„Linuxç”¨æˆ·è¿›è¡Œæ«å“ã€‚å¯è°“ä¸€çŸ³åŒé¸Ÿï¼å¾ˆéš¾æƒ³è±¡å¾®è½¯çš„å‰å¯¹æ‰‹SCOèƒ½ä¸ºæ¯”å°”Â·ç›–èŒ¨å†²é”‹é™·é˜µï¼Œä½†æ˜¯ï¼Œå¾®è½¯çš„é’±æ”¹å˜äº†ä¸€åˆ‡ã€‚â€</p>
<p>Linuxé˜µè¥æ‹…å¿ƒçš„å°±æ˜¯è¿™ä¸€ç‚¹ï¼Œå¾®è½¯æ­¤ä¸¾å¼ºåŒ–äº†SCOçš„Unixâ€œæƒå¨åœ°ä½â€ï¼Œå¢å¼ºäº†SCOæŒ‘æˆ˜IBMçš„å†³å¿ƒã€‚ä¸€æ—¦SCOæ‹¿ä¸‹IBMï¼Œå°±æ‰“å¼€äº†ä¸€ä¸ªæ”¶é’±å£è¢‹ï¼Œå…¶ä»–æ¨è¡ŒLinuxçš„å‚å•†åªæœ‰ä¹–ä¹–çº³è´¡ã€‚</p>
<p>è€Œä¸”ä½¿ç”¨Linuxçš„å¹¿å¤§å•†ä¸šç”¨æˆ·ä¹Ÿé¢ä¸´ç€è¢«è¿½ç´¢çš„å±æœºï¼Œæ›´å¤šçš„æ½œåœ¨ç”¨æˆ·å°†ä¼šå¯¹Linuxæœ›è€Œç”Ÿç•ï¼Œè¿™éå¸¸ç¬¦åˆå¾®è½¯ä¸€ç›´é’ˆå¯¹Linuxå®æ–½çš„å¿ƒç†æˆ˜æˆ˜æœ¯ï¼Œè®©ç”¨æˆ·åœ¨ææƒ§ã€ä¸ç¡®å®šã€æ€€ç–‘çš„çŠ¶æ€ä¸‹å¯¹Linuxæ•¬è€Œè¿œä¹‹ã€‚è€ƒè™‘åˆ°å†å²ä¸Šå¾®è½¯ä¸SCOå¤æ‚çš„å…³ç³»ï¼Œäººä»¬æ€€ç–‘äºŒè€…åœ¨å¯†è°‹ï¼Œè®¤ä¸ºSCOåœ¨æ‰®æ¼”ä¸ºå¾®è½¯ç«ä¸­å–æ —çš„è§’è‰²ã€‚2004å¹´åˆï¼Œéº¦å…‹å¸ƒè±å¾·è­¦å‘Šï¼šå…¨çƒä¸€äº›å¤§å…¬å¸ç”±äºä½¿ç”¨äº†Linuxå°†å¯èƒ½å¾ˆå¿«é¢ä¸´è¯‰è®¼ï¼Œå…¶ä¸­åŒ…æ‹¬è‹±å›½çŸ³æ²¹ã€è¥¿é—¨å­å’Œå¯Œå£«é€šã€‚å°±æ˜¯è¯´ï¼ŒSCOçš„è¯‰è®¼é£æš´å³å°†å¸­å·å…¨çƒã€‚</p>
<p>å€Ÿç€SCOå¯¹Linuxé˜µè¥çš„å‹åŠ›ï¼Œ2004å¹´11æœˆï¼Œå¾®è½¯CEOé²å°”é»˜åœ¨æ–°åŠ å¡ä¸¾è¡Œçš„ä¸€ä¸ªé«˜çº§åˆ«æ”¿åºœè®ºå›ä¸Šè¡¨ç¤ºï¼ŒLinuxä¾µçŠ¯äº†è‡³å°‘228é¡¹ä¸“åˆ©ï¼Œä¸è¿‡ä»–å¹¶æ²¡æœ‰æ˜ç¡®è¡¨ç¤ºä¾µçŠ¯äº†å“ªäº›ä¸“åˆ©ã€‚ä»–è¯´ï¼šâ€œå¯¹äºé‚£äº›å·²ç»åŠ å…¥ä¸–ç•Œè´¸æ˜“ç»„ç»‡çš„å›½å®¶è€Œè¨€ï¼Œä½¿ç”¨Linuxå°±æ„å‘³ç€æœ‰ä¸€å¤©ä¼šæœ‰äººè¿‡æ¥å‘ä½ æ”¶å–ä¸“åˆ©è´¹ã€‚â€</p>
<p>2005å¹´1æœˆï¼Œç¾å›½æ³•é™¢åˆ¤å†³IBMäº¤å‡º20äº¿è¡Œçš„ç¨‹åºä»£ç ç»™SCOï¼Œæ¶ˆæ¯ä¼ å‡ºåï¼ŒSCOè‚¡ä»·æš´æ¶¨20%ã€‚</p>
<p>SCOä¼¼ä¹å¯ä»¥åŠ¨æ‰‹æ•›é’±äº†ï¼Œç„¶è€Œé£äº‘åˆå˜ï¼ŒåŠè·¯æ€å‡ºä¸€ä¸ªç¨‹å’¬é‡‘ã€‚Novellå…¬å¸ç«™äº†å‡ºæ¥ï¼Œç§°è‡ªå·±æ‰æ˜¯Unixç‰ˆæƒçš„åˆæ³•æ‹¥æœ‰è€…ï¼Œè¯´è‡ªå·±å½“å¹´æ²¡æœ‰æŠŠUnixç‰ˆæƒå–ç»™SCOï¼ŒSCOä¹Ÿåªæ˜¯ä¸ªæˆæƒä½¿ç”¨è€…ï¼Œå¹¶ä¸”è¦å¯¹æ–¹æŠŠä»å¾®è½¯å’ŒSunæ”¶åˆ°çš„æˆæƒè®¸å¯è´¹ç»™åå‡ºæ¥ã€‚</p>
<p>äºæ˜¯ï¼ŒSCOåˆå’ŒNovellå…¬å¸å¹²ä¸Šäº†ï¼Œå¼€å§‹äº†æ³•åº­ä¸Šçš„äº’æœ‰èƒœè´Ÿçš„å¯¹å³™ã€‚</p>
<h5 id="æ ‘æ•Œè¿‡å¤šåçš„ç ´äº§"><a href="#æ ‘æ•Œè¿‡å¤šåçš„ç ´äº§" class="headerlink" title="æ ‘æ•Œè¿‡å¤šåçš„ç ´äº§"></a>æ ‘æ•Œè¿‡å¤šåçš„ç ´äº§</h5><p>â€œSCOå…¬å¸åœ¨è¯‰è®¼è¿‡ç¨‹ä¸­æ ‘æ•Œè¿‡å¤šã€‚â€ä¸šå†…äººå£«æ¸©ä¼¯æ ¼è¿™æ ·è¡¨ç¤ºã€‚è¿å¹´è¯‰è®¼è€—å°½äº†SCOèµ„æºï¼Œå…¬å¸é‡ç‚¹ä¹Ÿæ²¡æœ‰æ”¾åœ¨ä¸šåŠ¡ä¸Šï¼Œè¯åˆè¯´å›æ¥ï¼Œå…¶Unixä¸šåŠ¡å·²æ—¥è–„è¥¿å±±ï¼Œä¹Ÿæ²¡å•¥å¥½ç»§ç»­å¼€å±•çš„äº†ã€‚</p>
<p>2007å¹´8æœˆï¼Œç¾å›½çŠ¹ä»–å·åœ°æ–¹æ³•é™¢ä¸€åæ³•å®˜è£å®šï¼ŒUnixæ“ä½œç³»ç»Ÿçš„ç‰ˆæƒå½’å±äºNovellï¼Œè€Œä¸æ˜¯SCOã€‚è¿™æ„å‘³ç€SCOéœ€è¦å‘Novellæ”¯ä»˜æ•°ç™¾ä¸‡ç¾å…ƒçš„èµ”å¿ã€‚</p>
<p>æ­¤ä¸¾ä¹Ÿæ„å‘³ç€ï¼ŒSCOåœ¨ä¸IBMè¿›è¡Œçš„æ³•å¾‹å¤§æˆ˜ä¸­å¤±å»èƒœç®—ã€‚Linuxé˜µè¥å¤´é¡¶çš„ä¹Œäº‘ä¹Ÿéšå³æ•£å»ã€‚è¿™å¹´12æœˆ27æ—¥ï¼ŒSCOæ­£å¼è¢«çº³æ–¯è¾¾å…‹æ‘˜ç‰Œã€‚</p>
<p>èŠ¥å·é¾™ä¹‹ä»‹è¯´è¿‡ï¼šäººç”Ÿå¥½æ¯”ä¸€ç›’ç«æŸ´ï¼Œä¸¥ç¦ä½¿ç”¨æ˜¯æ„šè ¢çš„ï¼Œæ»¥ç”¨åˆ™æ˜¯å±é™©çš„ã€‚</p>
<p><img src="pic/002.jpg" alt="002"></p>
<h3 id="Minix"><a href="#Minix" class="headerlink" title="Minix"></a>Minix</h3><p>MinixåŸæ¥æ˜¯è·å…°é˜¿å§†æ–¯ç‰¹ä¸¹çš„Vrijeå¤§å­¦è®¡ç®—æœºç§‘å­¦ç³»çš„Andrew S. Tanenbaumæ•™æˆæ‰€å‘å±•çš„ä¸€ä¸ªç±»Unixæ“ä½œç³»ç»Ÿã€‚å…¨éƒ¨çš„ç¨‹åºç å…±çº¦12,000è¡Œï¼Œå¹¶ç½®äºä»–çš„è‘—ä½œOperating Systems: Design andImplementation(ISBN 0-13-637331-3)çš„é™„å½•é‡Œä½œä¸ºèŒƒä¾‹ã€‚Minixçš„ç³»ç»Ÿè¦æ±‚åœ¨å½“æ—¶æ¥è¯´éå¸¸ç®€å•ï¼Œåªè¦ä¸‰ç‰‡ç£ç‰‡å°±å¯ä»¥å¯åŠ¨ã€‚MinixåŸå§‹æ˜¯è®¾è®¡ç»™1980å¹´ä»£åˆ°1990å¹´ä»£çš„IBM PCå’ŒIBM PC/ATå…¼å®¹ç”µè„‘ä¸Šæ‰§è¡Œã€‚1.5ç‰ˆä¹Ÿæœ‰ç§»æ¤åˆ°ä»¥Motorola 68000ç³»åˆ—CPUä¸ºåŸºç¡€çš„ç”µè„‘ä¸Šï¼ˆå¦‚Atari STï¼ŒAmigaï¼Œå’Œæ—©æœŸçš„Apple Macintoshï¼‰å’Œä»¥SPARCä¸ºåŸºç¡€çš„æœºå™¨ï¼ˆå¦‚å‡é˜³sunå…¬å¸çš„å·¥ä½œç«™ï¼‰ã€‚2.0ç‰ˆåˆ™åªæœ‰x86æ¶æ„çš„ç‰ˆæœ¬ã€‚</p>
<p>å› ä¸ºAT&amp;Tçš„æ”¿ç­–æ”¹å˜ï¼Œåœ¨Version 7 Unixæ¨å‡ºä¹‹åï¼Œå‘å¸ƒæ–°çš„ä½¿ç”¨æ¡æ¬¾ï¼Œå°†UNIXæºä»£ç ç§æœ‰åŒ–ï¼Œåœ¨å¤§å­¦ä¸­ä¸å†èƒ½ä½¿ç”¨UNIXæºä»£ç ã€‚å¡”èƒ½é²å§†æ•™æˆä¸ºäº†èƒ½åœ¨è¯¾å ‚ä¸Šæ•™æˆå­¦ç”Ÿæ“ä½œç³»ç»Ÿè¿ä½œçš„å®åŠ¡ç»†èŠ‚ï¼Œå†³å®šåœ¨ä¸ä½¿ç”¨ä»»ä½•AT&amp;Tçš„æºä»£ç å‰æä¸‹ï¼Œè‡ªè¡Œå¼€å‘ä¸UNIXå…¼å®¹çš„æ“ä½œç³»ç»Ÿï¼Œä»¥é¿å…ç‰ˆæƒä¸Šçš„äº‰è®®ã€‚ä»–ä»¥å°å‹UNIXï¼ˆmini-UNIXï¼‰ä¹‹æ„ï¼Œå°†å®ƒç§°ä¸ºMINIXã€‚</p>
<p>å…¨å¥—Minixé™¤äº†èµ·åŠ¨çš„éƒ¨ä»½ä»¥æ±‡ç¼–è¯­è¨€ç¼–å†™ä»¥å¤–ï¼Œå…¶ä»–å¤§éƒ¨ä»½éƒ½æ˜¯çº¯ç²¹ç”¨Cè¯­è¨€ç¼–å†™ã€‚åˆ†ä¸ºï¼šå†…æ ¸ã€å†…å­˜ç®¡ç†åŠæ¡£æ¡ˆç®¡ç†ä¸‰éƒ¨ä»½ã€‚</p>
<h4 id="ä¸Linuxçš„å…³ç³»"><a href="#ä¸Linuxçš„å…³ç³»" class="headerlink" title="ä¸Linuxçš„å…³ç³»"></a>ä¸Linuxçš„å…³ç³»</h4><p>å¦‚æœæƒ³äº†è§£ç±»Unixç³»ç»Ÿçš„å†…éƒ¨å·¥ä½œæƒ…å†µï¼Œå­¦ç”Ÿå¯ä»¥åœ¨ä»–ä»¬è‡ªå·±çš„ç”µè„‘ä¸Šè¿è¡ŒMinixã€‚æ®æŠ¥é“ï¼Œå³ä½¿æ˜¯æ¯«æ— ç»éªŒçš„å­¦ç”Ÿä¹Ÿèƒ½åœ¨å‡ ä¸ªæœˆçš„å…¸å‹åŸ¹è®­è¯¾ç¨‹çš„å­¦ä¹ ä¸­è·å¾—å¯¹æ•´ä¸ªç³»ç»Ÿçš„å¾ˆå¥½çš„äº†è§£ã€‚Minixæœ€æœ‰åçš„å­¦ç”Ÿç”¨æˆ·æ˜¯Linus Torvaldsï¼Œä»–åœ¨èŠ¬å…°çš„èµ«å°”è¾›åŸºå¤§å­¦ç”¨Minixæ“ä½œå¹³å°å»ºç«‹äº†ä¸€ä¸ªæ–°çš„æ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼Œä»–æŠŠå®ƒå«åšLinuxã€‚</p>
<p>Linuxæ˜¯å…¶ä½œè€…å—åˆ°Minixçš„å½±å“è€Œä½œæˆçš„ï¼ˆLinus Torvaldsä¸å–œæ¬¢ä»–çš„386ç”µè„‘ä¸Šçš„MS-DOSæ“ä½œç³»ç»Ÿï¼Œå®‰è£…äº†Minixï¼Œå¹¶ä»¥å®ƒä¸ºæ ·æœ¬å¼€å‘äº†åŸå§‹çš„Linuxå†…æ ¸ï¼‰ã€‚ä½†åœ¨è®¾è®¡å“²å­¦ä¸Šï¼ŒLinuxåˆ™å’ŒMinixå¤§ç›¸è¿³åº­ã€‚Minixåœ¨å†…æ ¸è®¾è®¡ä¸Šé‡‡ç”¨å¾®å†…æ ¸çš„åŸåˆ™ï¼Œä½†Linuxåˆ™å’ŒåŸå§‹çš„Unixç›¸åŒéƒ½é‡‡ç”¨å®å†…æ ¸çš„æ¦‚å¿µã€‚åœ¨Linuxå‘å±•ä¹‹åˆï¼ŒåŒæ–¹è¿˜äº1992å¹´åœ¨æ–°é—»ç»„ä¸Šæœ‰è¿‡ä¸€åœºç²¾å½©çš„ç†å¿µäº‰è®ºã€‚Minixçš„ä½œè€…å’Œæ”¯æŒè€…è®¤ä¸ºLinuxçš„å•å†…æ ¸æ„é€ æ˜¯â€œå‘ä¸ƒåå¹´ä»£çš„å¤§å€’é€€â€ï¼Œè€ŒLinuxçš„æ”¯æŒè€…è®¤ä¸ºMinixæœ¬èº«æ²¡æœ‰å®ç”¨æ€§ã€‚</p>
<h4 id="æˆæƒæ–¹å¼"><a href="#æˆæƒæ–¹å¼" class="headerlink" title="æˆæƒæ–¹å¼"></a>æˆæƒæ–¹å¼</h4><p>åœ¨æˆæƒæ–¹å¼ä¸Šï¼ŒMinixçš„ç‰ˆæƒå®£å‘Šåœ¨æ—©æœŸè¢«è®¤ä¸ºæ˜¯ç›¸å½“è‡ªç”±çš„ï¼Œåœ¨ä½œè€…Andrew S. Tanenbaumå¸Œæœ›æ‹¿Minixä½œä¸ºä¸€ä¸ªå…¬å¼€çš„æ•™æä¸å‡ºç‰ˆç¤¾å¸Œæœ›ä¿æŠ¤ç¨‹åºç è‘—ä½œè´¢äº§æƒçš„å¹³è¡¡ä¸‹ï¼Œå®ƒåªè¦æ±‚ä¸€ä¸ªç›¸å½“ä½çš„æˆæƒè´¹ã€‚ä½†å› ä¸ºå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå¼€æ”¾æºç çš„æˆæƒæ–¹æ¡ˆï¼Œæ‰€ä»¥å¿—æ„¿å·¥ä½œè€…åœ¨ä»¥GPLæ–¹å¼æ•£å¸ƒçš„Linuxæ ¸å¿ƒå‡ºç°åå°±å¤šè½¬å‘Linuxå¹³å°ã€‚è€ŒUnixä¹Ÿåœ¨æŸå…‹è±ç³»ç»Ÿä¸AT&amp;Tè¾¾æˆåè®®åï¼Œå‡ºç°äº†ä»¥BSD æˆæƒæ•£å¸ƒçš„FreeBSDå¼€æ”¾å¹³å°ã€‚Minixè™½ç„¶åœ¨2000å¹´æ”¹ç”¨BSD æˆæƒï¼Œä½†è¿™æ—¶å…¶å®ƒçš„æ“ä½œç³»ç»Ÿåœ¨åŠŸèƒ½ä¸Šå¤§å¹…è¶…è¶Šäº†å®ƒï¼Œè€Œå®ƒå¤±å»äº†å‘å±•æˆä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿçš„æœºä¼šï¼Œåªç•™ä¸‹ï¼Œå¦‚å®ƒçš„ä½œè€…Andrew S. Tanenbaumï¼ŒåŸæ¥æœŸæœ›çš„ï¼Œä½œä¸ºä¸€ä¸ªå¼€æ”¾çš„æ•™æçš„ç”¨é€”ã€‚</p>
<p><img src="pic/003.jpg" alt="003"></p>
<h3 id="GUN"><a href="#GUN" class="headerlink" title="GUN"></a>GUN</h3><p>GNUè®¡åˆ’ï¼Œåˆç§°é©å¥´è®¡åˆ’ï¼Œæ˜¯ç”±Richard Stallmanåœ¨1983å¹´9æœˆ27æ—¥å…¬å¼€å‘èµ·çš„ã€‚å®ƒçš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€å¥—å®Œå…¨è‡ªç”±çš„æ“ä½œç³»ç»Ÿã€‚Richard Stallmanæœ€æ—©æ˜¯åœ¨net.unix-wizardsæ–°é—»ç»„ä¸Šå…¬å¸ƒè¯¥æ¶ˆæ¯ï¼Œå¹¶é™„å¸¦ã€ŠGNUå®£è¨€ã€‹ç­‰è§£é‡Šä¸ºä½•å‘èµ·è¯¥è®¡åˆ’çš„æ–‡ç« ï¼Œå…¶ä¸­ä¸€ä¸ªç†ç”±å°±æ˜¯è¦â€œé‡ç°å½“å¹´è½¯ä»¶ç•Œåˆä½œäº’åŠ©çš„å›¢ç»“ç²¾ç¥â€ã€‚ä¸ºä¿è¯GNUè½¯ä»¶å¯ä»¥è‡ªç”±åœ°â€œä½¿ç”¨ã€å¤åˆ¶ã€ä¿®æ”¹å’Œå‘å¸ƒâ€ï¼Œæ‰€æœ‰GNUè½¯ä»¶éƒ½æœ‰ä¸€ä»½åœ¨ç¦æ­¢å…¶ä»–äººæ·»åŠ ä»»ä½•é™åˆ¶çš„æƒ…å†µä¸‹æˆæƒæ‰€æœ‰æƒåˆ©ç»™ä»»ä½•äººçš„åè®®æ¡æ¬¾ï¼ŒGNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼ˆGNU General PublicLicenseï¼ŒGPLï¼‰ã€‚å³â€œåç‰ˆæƒâ€ï¼ˆæˆ–ç§°Copyleftï¼‰æ¦‚å¿µã€‚</p>
<h4 id="å†å²"><a href="#å†å²" class="headerlink" title="å†å²"></a>å†å²</h4><p>1985å¹´Richard Stallmanåˆåˆ›ç«‹äº†è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šï¼ˆFree Software Foundationï¼‰æ¥ä¸ºGNUè®¡åˆ’æä¾›æŠ€æœ¯ã€æ³•å¾‹ä»¥åŠè´¢æ”¿æ”¯æŒã€‚å°½ç®¡GNUè®¡åˆ’å¤§éƒ¨åˆ†æ—¶å€™æ˜¯ç”±ä¸ªäººè‡ªæ„¿æ— å¿è´¡çŒ®ï¼Œä½†FSFæœ‰æ—¶è¿˜æ˜¯ä¼šè˜è¯·ç¨‹åºå‘˜å¸®åŠ©ç¼–å†™ã€‚å½“GNUè®¡åˆ’å¼€å§‹é€æ¸è·å¾—æˆåŠŸæ—¶ï¼Œä¸€äº›å•†ä¸šå…¬å¸å¼€å§‹ä»‹å…¥å¼€å‘å’ŒæŠ€æœ¯æ”¯æŒã€‚å½“ä¸­æœ€è‘—åçš„å°±æ˜¯ä¹‹åè¢«Red Hatå…¼å¹¶çš„Cygnus Solutionsã€‚</p>
<p>åˆ°äº†1990å¹´ï¼ŒGNUè®¡åˆ’å·²ç»å¼€å‘å‡ºçš„è½¯ä»¶åŒ…æ‹¬äº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ–‡å­—ç¼–è¾‘å™¨Emacs[1] ã€‚GCCï¼ˆGNUCompiler Collectionï¼ŒGNUç¼–è¯‘å™¨é›†åˆï¼‰ï¼Œæ˜¯ä¸€å¥—ç”± GNU å¼€å‘çš„ç¼–ç¨‹è¯­è¨€ç¼–è¯‘å™¨ã€‚ä»¥åŠå¤§éƒ¨åˆ†UNIXç³»ç»ŸGNUæ“ä½œç³»ç»Ÿçš„å†…æ ¸Linuxçš„ç¨‹åºåº“å’Œå·¥å…·ã€‚å”¯ä¸€ä¾ç„¶æ²¡æœ‰å®Œæˆçš„é‡è¦ç»„ä»¶å°±æ˜¯æ“ä½œç³»ç»Ÿçš„å†…æ ¸(ç§°ä¸ºHURD)ã€‚</p>
<p>1991å¹´Linus Torvaldsç¼–å†™å‡ºäº†ä¸UNIXå…¼å®¹çš„Linuxæ“ä½œç³»ç»Ÿå†…æ ¸å¹¶åœ¨GPLæ¡æ¬¾ä¸‹å‘å¸ƒã€‚Linuxä¹‹ååœ¨ç½‘ä¸Šå¹¿æ³›æµä¼ ï¼Œè®¸å¤šç¨‹åºå‘˜å‚ä¸äº†å¼€å‘ä¸ä¿®æ”¹ã€‚1992å¹´Linuxä¸å…¶ä»–GNUè½¯ä»¶ç»“åˆï¼Œå®Œå…¨è‡ªç”±çš„æ“ä½œç³»ç»Ÿæ­£å¼è¯ç”Ÿã€‚è¯¥æ“ä½œç³»ç»Ÿå¾€å¾€è¢«ç§°ä¸ºâ€œGNU/Linuxâ€æˆ–ç®€ç§°Linuxã€‚ï¼ˆå°½ç®¡å¦‚æ­¤GNUè®¡åˆ’è‡ªå·±çš„å†…æ ¸Hurdä¾ç„¶åœ¨å¼€å‘ä¸­ï¼Œå·²ç»å‘å¸ƒBetaç‰ˆæœ¬ã€‚ï¼‰</p>
<p>è®¸å¤šUNIXç³»ç»Ÿä¸Šä¹Ÿå®‰è£…äº†GNUè½¯ä»¶ï¼Œå› ä¸ºGNUè½¯ä»¶çš„è´¨é‡æ¯”ä¹‹å‰UNIXçš„è½¯ä»¶è¿˜è¦å¥½ã€‚GNUå·¥å…·è¿˜è¢«å¹¿æ³›åœ°ç§»æ¤åˆ°Windowså’ŒMac OSä¸Šã€‚</p>
<h4 id="åè®®æ¡æ¬¾"><a href="#åè®®æ¡æ¬¾" class="headerlink" title="åè®®æ¡æ¬¾"></a>åè®®æ¡æ¬¾</h4><p>GNU åŒ…å«3ä¸ªåè®®æ¡æ¬¾:</p>
<ol>
<li>GPLï¼šGNUé€šç”¨å…¬å…±è®¸å¯è¯ï¼ˆGNU General Public Licenseï¼‰</li>
<li>LGPLï¼šGNUè¾ƒå®½æ¾å…¬å…±è®¸å¯è¯ (GNU Lesser General Public Licenseï¼‰, ) ï¼Œæ—§ç§° GNU Library General Public License (GNU åº“é€šç”¨å…¬å…±è®¸å¯è¯)ï¼›</li>
<li>GFDL ï¼š GNUè‡ªç”±æ–‡æ¡£è®¸å¯è¯ï¼ˆGNU Free Documentation License ï¼‰çš„ç¼©å†™å½¢å¼ã€‚</li>
</ol>
<p>è¿™é‡ŒæŒ‡çš„è‡ªç”±ï¼Œå¹¶ä¸æ˜¯ä»·æ ¼å…è´¹ï¼Œè¿™å’Œä»·æ ¼æ— å…³è€Œæ˜¯ä½¿ç”¨è½¯ä»¶å¯¹æ‰€æœ‰çš„ç”¨æˆ·æ¥è¯´æ˜¯è‡ªç”±çš„ã€‚</p>
<p>é€šè¿‡å¦‚ä¸‹é€”å¾„å®ç°è¿™ä¸€ç›®æ ‡ï¼š</p>
<ol>
<li>å®ƒè¦æ±‚è½¯ä»¶ä»¥æºä»£ç çš„å½¢å¼å‘å¸ƒï¼Œå¹¶è§„å®šä»»ä½•ç”¨æˆ·èƒ½å¤Ÿä»¥æºä»£ç çš„å½¢å¼å°†è½¯ä»¶å¤åˆ¶æˆ–å‘å¸ƒç»™åˆ«çš„ç”¨æˆ·ã€‚</li>
<li>å¦‚æœç”¨æˆ·çš„è½¯ä»¶ä½¿ç”¨äº†å— GPL ä¿æŠ¤çš„ä»»ä½•è½¯ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆè¯¥è½¯ä»¶å°±ç»§æ‰¿äº† GPL è½¯ä»¶ï¼Œå¹¶å› æ­¤è€Œæˆä¸º GPL è½¯ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»éšåº”ç”¨ç¨‹åºä¸€èµ·å‘å¸ƒæºä»£ç ã€‚</li>
<li>GPL å¹¶ä¸æ’æ–¥å¯¹è‡ªç”±è½¯ä»¶è¿›è¡Œå•†ä¸šæ€§è´¨çš„åŒ…è£…å’Œå‘è¡Œï¼Œä¹Ÿä¸é™åˆ¶åœ¨è‡ªç”±è½¯ä»¶çš„åŸºç¡€ä¸Šæ‰“åŒ…å‘è¡Œå…¶ä»–éè‡ªç”±è½¯ä»¶ã€‚</li>
</ol>
<p>ç”±äºGPLå¾ˆéš¾è¢«å•†ä¸šè½¯ä»¶æ‰€åº”ç”¨ï¼Œå®ƒè¦æ±‚è°ƒç”¨å®ƒçš„åº“çš„ä»£ç ä¹Ÿå¾—GPLï¼Œå…¨éƒ¨å¼€æ”¾ï¼Œå¹¶ä¸”ä¸€åŒå‘å¸ƒï¼Œä¸èƒ½ç›´æ¥è¿æ¥ã€‚æ‰€ä»¥åæ¥GNUæ¨å‡ºäº†LGPLè®¸å¯è¯</p>
<p>åœ¨GPLä¸LGPLè®¸å¯è¯ä¿æŠ¤ä¸‹å‘å¸ƒæºä»£ç çš„ç»“æœå¾ˆç›¸ä¼¼ï¼Œå¯¹æ—§ä»£ç æ‰€åšçš„ä»»ä½•ä¿®æ”¹å¯¹äºæƒ³çŸ¥é“è¿™äº›ä»£ç çš„äººå¿…é¡»æ˜¯å…¬å¼€çš„ï¼Œå”¯ä¸€çœŸæ­£çš„ä¸åŒä¹‹å¤„åœ¨äºç§äººç‰ˆæƒä»£ç æ˜¯å¦å¯ä»¥ä¸å¼€æ”¾æºä»£ç ç›¸äº’è¿æ¥ï¼ŒLGPLå…è®¸å®ä½“è¿æ¥ç§äººä»£ç åˆ°å¼€æ”¾æºä»£ç ï¼Œå¹¶å¯ä»¥åœ¨ä»»ä½•å½¢å¼ä¸‹å‘å¸ƒè¿™äº›åˆæˆçš„äºŒè¿›åˆ¶ä»£ç ã€‚åªè¦è¿™äº›ä»£ç æ˜¯åŠ¨æ€è¿æ¥çš„å°±æ²¡æœ‰é™åˆ¶ã€‚ï¼ˆä½¿ç”¨åŠ¨æ€é“¾æ¥æ—¶ï¼Œå³ä½¿æ˜¯ç¨‹åºåœ¨è¿è¡Œä¸­è°ƒç”¨å‡½æ•°åº“ä¸­çš„å‡½æ•°æ—¶ï¼Œåº”ç”¨ç¨‹åºæœ¬èº«å’Œå‡½æ•°åº“ä¹Ÿæ˜¯ä¸åŒçš„å®ä½“ï¼‰</p>
<h4 id="è‡ªç”±è½¯ä»¶"><a href="#è‡ªç”±è½¯ä»¶" class="headerlink" title="è‡ªç”±è½¯ä»¶"></a>è‡ªç”±è½¯ä»¶</h4><p>â€œè‡ªç”±è½¯ä»¶â€ æ˜¯æƒåˆ©é—®é¢˜ï¼Œä¸æ˜¯ä»·æ ¼é—®é¢˜ã€‚è¦ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œè‡ªç”±åº”è¯¥æ˜¯â€œè¨€è®ºè‡ªç”±â€ä¸­çš„â€œè‡ªç”±â€ï¼Œè€Œä¸æ˜¯â€œå…è´¹å•¤é…’â€ä¸­çš„â€œå…è´¹â€ã€‚</p>
<p>è‡ªç”±è½¯ä»¶å…³ä¹ä½¿ç”¨è€…è¿è¡Œã€å¤åˆ¶ã€å‘å¸ƒã€ç ”ç©¶ã€ä¿®æ”¹å’Œæ”¹è¿›è¯¥è½¯ä»¶çš„è‡ªç”±ã€‚ æ›´ç²¾ç¡®åœ°è¯´ï¼Œè‡ªç”±è½¯ä»¶èµ‹äºˆè½¯ä»¶ä½¿ç”¨è€…å››ç§è‡ªç”±ï¼š</p>
<ol>
<li>ä¸è®ºç›®çš„ä¸ºä½•ï¼Œæœ‰è¿è¡Œè¯¥è½¯ä»¶çš„è‡ªç”±ï¼ˆè‡ªç”±ä¹‹é›¶ï¼‰ã€‚</li>
<li>æœ‰ç ”ç©¶è¯¥è½¯ä»¶å¦‚ä½•è¿è¡Œï¼Œä»¥åŠæŒ‰éœ€æ”¹å†™è¯¥è½¯ä»¶çš„è‡ªç”±ï¼ˆè‡ªç”±ä¹‹ä¸€ï¼‰ã€‚å–å¾—è¯¥è½¯ä»¶æºä»£ç ä¸ºè¾¾æˆæ­¤ç›®çš„ä¹‹å‰æã€‚</li>
<li>æœ‰é‡æ–°å‘å¸ƒæ‹·è´çš„è‡ªç”±ï¼Œè¿™æ ·ä½ å¯ä»¥å€Ÿæ­¤æ¥æ•¦äº²ç¦é‚»ï¼ˆè‡ªç”±ä¹‹äºŒï¼‰ã€‚</li>
<li>æœ‰æ”¹è¿›è¯¥è½¯ä»¶ï¼Œä»¥åŠå‘å…¬ä¼—å‘å¸ƒæ”¹è¿›çš„è‡ªç”±ï¼Œè¿™æ ·æ•´ä¸ªç¤¾ç¾¤éƒ½å¯å—æƒ ï¼ˆè‡ªç”±ä¹‹ä¸‰ï¼‰ã€‚å–å¾—è¯¥è½¯ä»¶æºç ä¸ºè¾¾æˆæ­¤ç›®çš„ä¹‹å‰æã€‚</li>
</ol>
<p><img src="pic/006.jpg" alt="004"></p>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>Linuxæ˜¯ä¸€å¥—å…è´¹ä½¿ç”¨å’Œè‡ªç”±ä¼ æ’­çš„ç±»Unixæ“ä½œç³»ç»Ÿï¼Œæ˜¯ä¸€ä¸ªåŸºäºPOSIXå’ŒUNIXçš„å¤šç”¨æˆ·ã€å¤šä»»åŠ¡ã€æ”¯æŒå¤šçº¿ç¨‹å’Œå¤šCPUçš„æ“ä½œç³»ç»Ÿã€‚å®ƒèƒ½è¿è¡Œä¸»è¦çš„UNIXå·¥å…·è½¯ä»¶ã€åº”ç”¨ç¨‹åºå’Œç½‘ç»œåè®®ã€‚å®ƒæ”¯æŒ32ä½å’Œ64ä½ç¡¬ä»¶ã€‚Linuxç»§æ‰¿äº†Unixä»¥ç½‘ç»œä¸ºæ ¸å¿ƒçš„è®¾è®¡æ€æƒ³ï¼Œæ˜¯ä¸€ä¸ªæ€§èƒ½ç¨³å®šçš„å¤šç”¨æˆ·ç½‘ç»œæ“ä½œç³»ç»Ÿã€‚Linuxæ“ä½œç³»ç»Ÿè¯ç”Ÿäº1991 å¹´10 æœˆ5 æ—¥ï¼ˆè¿™æ˜¯ç¬¬ä¸€æ¬¡æ­£å¼å‘å¤–å…¬å¸ƒæ—¶é—´ï¼‰ã€‚Linuxå­˜åœ¨ç€è®¸å¤šä¸åŒçš„Linuxç‰ˆæœ¬ï¼Œä½†å®ƒä»¬éƒ½ä½¿ç”¨äº†Linuxå†…æ ¸ã€‚Linuxå¯å®‰è£…åœ¨å„ç§è®¡ç®—æœºç¡¬ä»¶è®¾å¤‡ä¸­ï¼Œæ¯”å¦‚æ‰‹æœºã€å¹³æ¿ç”µè„‘ã€è·¯ç”±å™¨ã€è§†é¢‘æ¸¸æˆæ§åˆ¶å°ã€å°å¼è®¡ç®—æœºã€å¤§å‹æœºå’Œè¶…çº§è®¡ç®—æœºã€‚</p>
<p>ä¸¥æ ¼æ¥è®²ï¼ŒLinuxè¿™ä¸ªè¯æœ¬èº«åªè¡¨ç¤ºLinuxå†…æ ¸ï¼Œä½†å®é™…ä¸Šäººä»¬å·²ç»ä¹ æƒ¯äº†ç”¨Linuxæ¥å½¢å®¹æ•´ä¸ªåŸºäºLinuxå†…æ ¸ï¼Œå¹¶ä¸”ä½¿ç”¨GNU å·¥ç¨‹å„ç§å·¥å…·å’Œæ•°æ®åº“çš„æ“ä½œç³»ç»Ÿã€‚</p>
<h4 id="Linuxç®€å²"><a href="#Linuxç®€å²" class="headerlink" title="Linuxç®€å²"></a>Linuxç®€å²</h4><p>Linux æ“ä½œç³»ç»Ÿçš„è¯ç”Ÿã€å‘å±•å’Œæˆé•¿è¿‡ç¨‹å§‹ç»ˆä¾èµ–ç€äº”ä¸ªé‡è¦æ”¯æŸ±ï¼šUNIX æ“ä½œç³»ç»Ÿã€MINIX æ“ä½œç³»ç»Ÿã€GNUè®¡åˆ’ã€POSIX æ ‡å‡†å’ŒInternet ç½‘ç»œã€‚</p>
<p>1981 å¹´IBMå…¬å¸æ¨å‡ºå¾®å‹è®¡ç®—æœºIBM PCã€‚</p>
<p>1991å¹´ï¼ŒGNUè®¡åˆ’å·²ç»å¼€å‘å‡ºäº†è®¸å¤šå·¥å…·è½¯ä»¶ï¼Œæœ€å—æœŸç›¼çš„GNU Cç¼–è¯‘å™¨å·²ç»å‡ºç°ï¼ŒGNUçš„æ“ä½œç³»ç»Ÿæ ¸å¿ƒHURDä¸€ç›´å¤„äºå®éªŒé˜¶æ®µï¼Œæ²¡æœ‰ä»»ä½•å¯ç”¨æ€§ï¼Œå®è´¨ä¸Šä¹Ÿæ²¡èƒ½å¼€å‘å‡ºå®Œæ•´çš„GNUæ“ä½œç³»ç»Ÿï¼Œä½†æ˜¯GNUå¥ å®šäº†Linuxç”¨æˆ·åŸºç¡€å’Œå¼€å‘ç¯å¢ƒã€‚</p>
<p>1991å¹´åˆï¼Œæ—çº³æ–¯Â·æ‰˜ç“¦å…¹å¼€å§‹åœ¨ä¸€å°386sxå…¼å®¹å¾®æœºä¸Šå­¦ä¹ minixæ“ä½œç³»ç»Ÿã€‚1991å¹´4æœˆï¼Œæ—çº³æ–¯Â·æ‰˜ç“¦å…¹å¼€å§‹é…é…¿å¹¶ç€æ‰‹ç¼–åˆ¶è‡ªå·±çš„æ“ä½œç³»ç»Ÿã€‚</p>
<p>1991 å¹´4 æœˆ13 æ—¥åœ¨comp.os.minix ä¸Šå‘å¸ƒè¯´è‡ªå·±å·²ç»æˆåŠŸåœ°å°†bash ç§»æ¤åˆ°äº†minix ä¸Šï¼Œè€Œä¸”å·²ç»çˆ±ä¸é‡Šæ‰‹ã€ä¸èƒ½ç¦»å¼€è¿™ä¸ªshell è½¯ä»¶äº†ã€‚</p>
<p>1991å¹´7æœˆ3æ—¥ï¼Œç¬¬ä¸€ä¸ªä¸Linuxæœ‰å…³çš„æ¶ˆæ¯æ˜¯åœ¨comp.os.minixä¸Šå‘å¸ƒçš„ï¼ˆå½“ç„¶æ­¤æ—¶è¿˜ä¸å­˜åœ¨Linuxè¿™ä¸ªåç§°ï¼Œå½“æ—¶æ—çº³æ–¯Â·æ‰˜ç“¦å…¹çš„è„‘å­é‡Œæƒ³çš„å¯èƒ½æ˜¯FREAXï¼ŒFREAXçš„è‹±æ–‡å«ä¹‰æ˜¯æ€ªè¯çš„ã€æ€ªç‰©ã€å¼‚æƒ³å¤©å¼€ç­‰ï¼‰ã€‚</p>
<p>1991å¹´çš„10æœˆ5æ—¥ï¼Œæ—çº³æ–¯Â·æ‰˜ç“¦å…¹åœ¨comp.os.minixæ–°é—»ç»„ä¸Šå‘å¸ƒæ¶ˆæ¯ï¼Œæ­£å¼å‘å¤–å®£å¸ƒLinuxå†…æ ¸çš„è¯ç”Ÿï¼ˆFreeminix-like kernel sources for 386-ATï¼‰ã€‚</p>
<p>1993å¹´ï¼Œå¤§çº¦æœ‰100ä½™åç¨‹åºå‘˜å‚ä¸äº†Linuxå†…æ ¸ä»£ç ç¼–å†™/ä¿®æ”¹å·¥ä½œï¼Œå…¶ä¸­æ ¸å¿ƒç»„ç”±5äººç»„æˆï¼Œæ­¤æ—¶Linux 0.99çš„ä»£ç å¤§çº¦æœ‰åä¸‡è¡Œï¼Œç”¨æˆ·å¤§çº¦æœ‰10ä¸‡å·¦å³ã€‚</p>
<p>1994å¹´3æœˆï¼ŒLinux1.0å‘å¸ƒï¼Œä»£ç é‡17ä¸‡è¡Œï¼Œå½“æ—¶æ˜¯æŒ‰ç…§å®Œå…¨è‡ªç”±å…è´¹çš„åè®®å‘å¸ƒï¼Œéšåæ­£å¼é‡‡ç”¨GPLåè®®ã€‚</p>
<p>1995å¹´1æœˆï¼ŒBob Youngåˆ›åŠäº†RedHatï¼ˆå°çº¢å¸½ï¼‰ï¼Œä»¥GNU/Linuxä¸ºæ ¸å¿ƒï¼Œé›†æˆäº†400å¤šä¸ªæºä»£ç å¼€æ”¾çš„ç¨‹åºæ¨¡å—ï¼Œæå‡ºäº†ä¸€ç§å† ä»¥å“ç‰Œçš„Linuxï¼Œå³RedHat Linux,ç§°ä¸ºLinuxâ€å‘è¡Œç‰ˆâ€ï¼Œåœ¨å¸‚åœºä¸Šå‡ºå”®ã€‚è¿™åœ¨ç»è¥æ¨¡å¼ä¸Šæ˜¯ä¸€ç§åˆ›ä¸¾ã€‚</p>
<p>1996å¹´6æœˆï¼ŒLinux 2.0å†…æ ¸å‘å¸ƒï¼Œæ­¤å†…æ ¸æœ‰å¤§çº¦40ä¸‡è¡Œä»£ç ï¼Œå¹¶å¯ä»¥æ”¯æŒå¤šä¸ªå¤„ç†å™¨ã€‚æ­¤æ—¶çš„Linuxå·²ç»è¿›å…¥äº†å®ç”¨é˜¶æ®µï¼Œå…¨çƒå¤§çº¦æœ‰350ä¸‡äººä½¿ç”¨ã€‚</p>
<p>1998å¹´2æœˆï¼Œä»¥Eric Raymondä¸ºé¦–çš„ä¸€æ‰¹å¹´è½»çš„â€è€ç‰›ç¾šéª¨å¹²åˆ†å­â€ç»ˆäºè®¤è¯†åˆ°GNU/Linuxä½“ç³»çš„äº§ä¸šåŒ–é“è·¯çš„æœ¬è´¨ï¼Œå¹¶éæ˜¯ä»€ä¹ˆè‡ªç”±å“²å­¦ï¼Œè€Œæ˜¯å¸‚åœºç«äº‰çš„é©±åŠ¨ï¼Œåˆ›åŠäº†â€Open Source Intiativeâ€ï¼ˆå¼€æ”¾æºä»£ç ä¿ƒè¿›ä¼šï¼‰â€å¤å…´â€çš„å¤§æ——ï¼Œåœ¨äº’è”ç½‘ä¸–ç•Œé‡Œå±•å¼€äº†ä¸€åœºå†å²æ€§çš„Linuxäº§ä¸šåŒ–è¿åŠ¨ã€‚</p>
<p>2001å¹´1æœˆï¼ŒLinux 2.4å‘å¸ƒï¼Œå®ƒè¿›ä¸€æ­¥åœ°æå‡äº†SMPç³»ç»Ÿçš„æ‰©å±•æ€§ï¼ŒåŒæ—¶å®ƒä¹Ÿé›†æˆäº†å¾ˆå¤šç”¨äºæ”¯æŒæ¡Œé¢ç³»ç»Ÿçš„ç‰¹æ€§ï¼šUSBï¼ŒPCå¡ï¼ˆPCMCIAï¼‰çš„æ”¯æŒï¼Œå†…ç½®çš„å³æ’å³ç”¨ï¼Œç­‰ç­‰åŠŸèƒ½ã€‚</p>
<p>2003å¹´12æœˆï¼ŒLinux 2.6ç‰ˆå†…æ ¸å‘å¸ƒï¼Œç›¸å¯¹äº2.4ç‰ˆå†…æ ¸2.6åœ¨å¯¹ç³»ç»Ÿçš„æ”¯æŒéƒ½æœ‰å¾ˆå¤§çš„å˜åŒ–ã€‚</p>
<p>2004å¹´çš„ç¬¬1æœˆï¼ŒSuSEå«åˆ°äº†Novellï¼ŒSCOç»§ç»­é¡¶ç€éª‚åå››å¤„å¼ºè¡Œâ€œåŒ–ç¼˜â€ï¼Œ Asianuxï¼ŒMandrakeSoftä¹Ÿåœ¨äº”å¹´ä¸­é¦–æ¬¡å®£å¸ƒå­£åº¦èµ¢åˆ©ã€‚3æœˆï¼ŒSGIå®£å¸ƒæˆåŠŸå®ç°äº†Linuxæ“ä½œç³»ç»Ÿæ”¯æŒ256ä¸ªItanium 2å¤„ç†å™¨ã€‚</p>
<p><img src="pic/004.jpg" alt="005"></p>
<p><img src="pic/005.jpg" alt="006"></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç³»ç»ŸåŸºç¡€åŸ¹è®­</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux åŸºç¡€å‘½ä»¤</title>
    <url>/2016/12/22/booboo_linux_base/01-Linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<ul>
<li><p>åœ¨æ•™å®¤ç‰©ç†æœºåŒ…æ‹¬rhel7å’Œrhel6ä¸¤å°å®éªŒè™šæ‹Ÿæœºï¼Œä¸Šæ‰“å¼€è™šæ‹Ÿæœºå‘½ä»¤: <em>rht-vmctl start rhel7</em> </p>
<ul>
<li>åœ¨ç‰©ç†æœºä¸Šè¿œç¨‹ç™»é™†åˆ°è™šæ‹Ÿæœºrhel7 <em>ssh root@rhel7-fN</em> ï¼Œ<em>N</em> ä¸ºä½ çš„æœºå™¨ç¼–å·ï¼Œ <em>root</em>å¯†ç éƒ½æ˜¯<em>uplooking</em>ï¼Œç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªæ™®é€šç”¨æˆ·<em>student</em>ï¼Œå…¶å¯†ç ä¸º<em>student</em>ã€‚</li>
<li>åœ¨è™šæ‹Ÿæœºä¸­å…³é—­è™šæ‹Ÿæœºçš„å‘½ä»¤ä¸º<em>shutdown -h now</em>ï¼Œä¹Ÿå¯ä»¥åœ¨ç‰©ç†æœºä¸Šæ‰§è¡Œ<em>rht-vmctl poweroff rhel7</em>ã€‚</li>
</ul>
</li>
<li><p>åœ¨ç‰©ç†æœºä¸Šè®¾ç½®å½•å±è§†é¢‘ï¼Œç”±äºGnome3çš„bugä¼šæœ‰30ç§’æ—¶é—´é™åˆ¶ï¼Œä¿®æ­£æ—¶é—´é™åˆ¶çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[kiosk@fundation0 ~]$ gsettings set org.gnome.settings-daemon.plugins.media-keys max-screencast-length "uint32 0"</span><br></pre></td></tr></table></figure>

<h2 id="å‘½ä»¤ç®€ä»‹"><a href="#å‘½ä»¤ç®€ä»‹" class="headerlink" title="å‘½ä»¤ç®€ä»‹"></a>å‘½ä»¤ç®€ä»‹</h2><h3 id="å‘½ä»¤çš„æ„æˆ"><a href="#å‘½ä»¤çš„æ„æˆ" class="headerlink" title="å‘½ä»¤çš„æ„æˆ"></a>å‘½ä»¤çš„æ„æˆ</h3><p>å‘½ä»¤å­— é€‰é¡¹ å‚æ•°</p>
<ul>
<li>å‘½ä»¤åˆ†:å†…éƒ¨å‘½ä»¤ã€å¤–éƒ¨å‘½ä»¤;</li>
<li>é€‰é¡¹: - å•ä¸ªå­—ç¬¦ â€“ å¤šä¸ªå­—ç¬¦</li>
<li>å‚æ•°:å¯¹è°æ‰§è¡Œè¿™ä¸ªå‘½ä»¤,å¯ä»¥æœ‰å¤šä¸ª,é€‰é¡¹å’Œå‚æ•°å¯ä»¥äº’æ¢ä½ç½®</li>
</ul>
<h3 id="å‘½ä»¤ä½¿ç”¨çš„åŸå› "><a href="#å‘½ä»¤ä½¿ç”¨çš„åŸå› " class="headerlink" title="å‘½ä»¤ä½¿ç”¨çš„åŸå› "></a>å‘½ä»¤ä½¿ç”¨çš„åŸå› </h3><p>Shellæ˜¯ç³»ç»Ÿçš„ç”¨æˆ·ç•Œé¢ï¼Œæä¾›äº†ç”¨æˆ·ä¸å†…æ ¸è¿›è¡Œäº¤äº’æ“ä½œçš„ä¸€ç§æ¥å£ã€‚å®ƒæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤å¹¶æŠŠå®ƒé€å…¥å†…æ ¸å»æ‰§è¡Œã€‚å®é™…ä¸ŠShellæ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨ï¼Œå®ƒè§£é‡Šç”±ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤å¹¶ä¸”æŠŠå®ƒä»¬é€åˆ°å†…æ ¸ã€‚ä»è¿™é‡Œå¼€å§‹å­¦ä¹ Linuxå‘½ä»¤ï¼Œæœ¬è¯¾ç¨‹è®©ä½ æ›´æ¸…æ¥šåœ°äº†è§£å’ŒæŒæ¡å®ƒï¼Œåœ¨Linuxä¸­å‘½ä»¤æ˜¯è®²ç©¶å¤§å°å†™çš„ã€‚ä½¿ç”¨å‘½ä»¤å³å¿«é€Ÿåˆèƒ½å‡å°‘æœºå™¨çš„æ€§èƒ½æ¶ˆè€—ã€‚</p>
<h3 id="å‘½ä»¤æç¤ºç¬¦"><a href="#å‘½ä»¤æç¤ºç¬¦" class="headerlink" title="å‘½ä»¤æç¤ºç¬¦"></a>å‘½ä»¤æç¤ºç¬¦</h3><ul>
<li># root ç”¨æˆ·</li>
<li>$ ä¸€èˆ¬ç”¨æˆ·</li>
<li>[ ç”¨æˆ·çš„èº«ä»½ @ ä¸»æœºå å½“å‰ä½ç½® ]</li>
</ul>
<p>å½“å‰ä½ç½®æ˜¾ç¤ºçš„æ˜¯ç›®å½•å</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# hostname</span><br><span class="line">www.dabao.com</span><br><span class="line">[root@rhel7 ~]# groupadd tom</span><br><span class="line">[root@rhel7 ~]# useradd -g tom tom</span><br><span class="line">[root@rhel7 ~]# id tom</span><br><span class="line">uid=501(tom) gid=501(tom) groups=501(tom)</span><br><span class="line">[root@rhel7 ~]# su - tom</span><br><span class="line">[tom@rhel7 ~]$ who</span><br><span class="line">root tty1</span><br><span class="line">2016-03-20 23:56 (:0)</span><br><span class="line">root pts/0</span><br><span class="line">2016-03-21 00:39 (:0.0)</span><br></pre></td></tr></table></figure>

<h2 id="å¸¸ç”¨çš„å‘½ä»¤"><a href="#å¸¸ç”¨çš„å‘½ä»¤" class="headerlink" title="å¸¸ç”¨çš„å‘½ä»¤"></a>å¸¸ç”¨çš„å‘½ä»¤</h2><h3 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h3><table>
<thead>
<tr>
<th align="left">å¸¸ç”¨å‚æ•°</th>
<th align="left">å«ä¹‰åŠç”¨æ³•</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-l</td>
<td align="left">long çš„ç¼©å†™ è¯¦ç»†åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å±æ€§     ä¸ƒåˆ— æ–‡ä»¶å &lt;=255 ä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td align="left">-d</td>
<td align="left">directory çš„ç¼©å†™ æŸ¥çœ‹å½“å‰ç›®å½•æœ¬èº«çš„ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">-h</td>
<td align="left">ä»¥äººæ€§åŒ–çš„æ–¹å¼æ˜¾ç¤ºæ–‡ä»¶å¤§å°,å½•çš„å¤§å°å¹¶ä¸ä»£è¡¨ç›®å½•å†…æ‰€æœ‰æ–‡ä»¶çš„å¤§å° du -sh /etc&lt;== æŸ¥çœ‹ etc ç›®å½•çœŸæ­£çš„å¤§å°</td>
</tr>
<tr>
<td align="left">-a</td>
<td align="left">æŸ¥çœ‹éšè—æ–‡ä»¶ ä»¥ . å¼€å¤´çš„æ–‡ä»¶</td>
</tr>
<tr>
<td align="left">-R</td>
<td align="left">æŸ¥çœ‹å¤šå±‚ç›®å½•</td>
</tr>
<tr>
<td align="left">-b</td>
<td align="left">ç‰¹æ®Šå­—ç¬¦å°†ä»¥ \ åˆ†å‰² ls æŸ¥çœ‹æœ‰ç‰¹æ®Šå­—ç¬¦çš„æ–‡ä»¶</td>
</tr>
</tbody></table>
<h4 id="lså®éªŒ"><a href="#lså®éªŒ" class="headerlink" title="lså®éªŒ"></a>lså®éªŒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[tom@rhel7 tmp]$ ls -hl</span><br><span class="line">total 68K</span><br><span class="line">srwxr-xr-x. 1 root root 0 Mar 20 23:59 gedit.root.3177893063</span><br><span class="line">drwx------. 2 root root 4.0K Feb 5 18:24 keyring-JL7MKY</span><br><span class="line">[tom@rhel7 tmp]$ ls -ld /tmp</span><br><span class="line">drwxrwxrwt. 22 root root 4096 Mar 21 00:43 /tmp</span><br><span class="line">[tom@rhel7 tmp]$ ls -la /tmp</span><br><span class="line">total 96</span><br><span class="line">drwxrwxrwt. 22 root root 4096 Mar 21 00:43 .</span><br><span class="line">dr-xr-xr-x. 29 root root 4096 Mar 20 23:55 ..</span><br><span class="line">drwx------. 2 root root 4096 Mar 20 23:56 .esd-0</span><br><span class="line">drwx------. 2 cong cong 4096 Jan 1 18:33 .esd-500</span><br><span class="line">[tom@rhel7 tmp]$ ls -bl</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 00:48 a\ b.txt</span><br><span class="line">[tom@rhel7 tmp]$ ls -l</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 00:48 a b.txt</span><br><span class="line">[tom@rhel7 tmp]$ mkdir -p a/b/c</span><br><span class="line">[tom@rhel7 tmp]$ ls -lR a/</span><br><span class="line">a/:</span><br><span class="line">total 4</span><br><span class="line">drwxrwxr-x. 3 tom tom 4096 Mar 21 00:50 b</span><br><span class="line">a/b:</span><br><span class="line">total 4</span><br><span class="line">drwxrwxr-x. 2 tom tom 4096 Mar 21 00:50 c</span><br><span class="line">a/b/c:</span><br><span class="line">total 0</span><br></pre></td></tr></table></figure>

<h3 id="cd"><a href="#cd" class="headerlink" title="cd"></a>cd</h3><table>
<thead>
<tr>
<th align="left">cd</th>
<th align="left">change directory åˆ‡æ¢å·¥ä½œç›®å½•</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ç»å¯¹è·¯å¾„</td>
<td align="left">ä»¥æ ¹ä¸ºèµ·å§‹çš„è·¯å¾„</td>
</tr>
<tr>
<td align="left">ç›¸å¯¹è·¯å¾„</td>
<td align="left">~å½“å‰ç”¨æˆ·çš„å®¶ç›®å½• ;. å½“å‰ç›®å½• ;.. ä¸Šä¸€å±‚ç”¨æˆ· ;- å›åˆ°ä¸Šä¸€æ¬¡æ‰€åœ¨ä½ç½®</td>
</tr>
</tbody></table>
<h4 id="cdå®éªŒ"><a href="#cdå®éªŒ" class="headerlink" title="cdå®éªŒ"></a>cdå®éªŒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[tom@rhel7 tmp]$ cd /etc/</span><br><span class="line">[tom@rhel7 etc]$ cd ~</span><br><span class="line">[tom@rhel7 ~]$ cd .</span><br><span class="line">[tom@rhel7  ~]$ cd ..</span><br><span class="line">[tom@rhel7  home]$ cd -</span><br><span class="line">/home/tom</span><br></pre></td></tr></table></figure>

<h3 id="pwd"><a href="#pwd" class="headerlink" title="pwd"></a>pwd</h3><p>pwd:print working directory æ˜¾ç¤ºå½“å‰æ‰€åœ¨ä½ç½®çš„ç»å¯¹è·¯å¾„</p>
<h4 id="pwdå®éªŒ"><a href="#pwdå®éªŒ" class="headerlink" title="pwdå®éªŒ"></a>pwdå®éªŒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[tom@rhel7 tmp]$ cd /etc/nginx</span><br><span class="line">[tom@rhel7 nginx]$ cd conf.d</span><br><span class="line">[tom@rhel7 conf.d]$ pwd</span><br><span class="line">/etc/nginx/conf.d</span><br></pre></td></tr></table></figure>

<h2 id="ç¬¦å·"><a href="#ç¬¦å·" class="headerlink" title="ç¬¦å·"></a>ç¬¦å·</h2><h3 id="é€šé…ç¬¦"><a href="#é€šé…ç¬¦" class="headerlink" title="é€šé…ç¬¦ *"></a>é€šé…ç¬¦ *</h3><p>åŒ¹é…ä»»æ„å¤šä¸ªå­—ç¬¦</p>
<p>ä¾‹å¦‚ï¼ša* åŒ…æ‹¬aa*ã€ab*ã€ac* ç­‰ç­‰ </p>
<h3 id="é€šé…ç¬¦-1"><a href="#é€šé…ç¬¦-1" class="headerlink" title="é€šé…ç¬¦ ?"></a>é€šé…ç¬¦ ?</h3><p>åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦<br>ä¾‹å¦‚ï¼š a? å¯ä»¥æ˜¯abã€acã€adã€a1ã€a9ã€a#ç­‰ç­‰</p>
<h4 id="ï¼Ÿå®éªŒ"><a href="#ï¼Ÿå®éªŒ" class="headerlink" title="*ï¼Ÿå®éªŒ"></a>*ï¼Ÿå®éªŒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rm -f *1</span><br><span class="line">rm -f 1*</span><br><span class="line">rm -f 1*1</span><br><span class="line">rm -f test?</span><br><span class="line">æƒ³åˆ é™¤ test åé¢æœ‰ä¸€ä¸ªå­—ç¬¦çš„æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h3 id="ç®¡é“"><a href="#ç®¡é“" class="headerlink" title="| ç®¡é“"></a>| ç®¡é“</h3><p>output | input</p>
<p>å¯¹æŸäº›å‘½ä»¤æ‰§è¡Œçš„ç»“æœå»ä½œæ“ä½œ,ä¼šç”¨åˆ°ç®¡é“ï¼›ç”¨äºå‘½ä»¤ä¸å‘½ä»¤ä¹‹é—´çš„è¿æ¥ï¼Œå‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºæ˜¯åä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥</p>
<h4 id="ç®¡é“å®éªŒ"><a href="#ç®¡é“å®éªŒ" class="headerlink" title="| ç®¡é“å®éªŒ"></a>| ç®¡é“å®éªŒ</h4><p>è¯¦ç»†åˆ—å‡º /tmp ç›®å½•ä¸‹çš„æ–‡ä»¶,å¹¶æˆªå–ä»¥ç©ºæ ¼ä¸ºåˆ†å‰²çš„ç¬¬ä¸‰åˆ—</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[tom@rhel7 ~]$ ls -l /tmp|cut -d" " -f3</span><br><span class="line">tom</span><br><span class="line">tom</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">è¯¦ç»†åˆ—å‡º /tmp ç›®å½•ä¸‹çš„æ–‡ä»¶,æˆªå–å«æœ‰å…³é”®å­— tom çš„è¡Œ,å†æˆªå–ä»¥ç©ºæ ¼ä¸ºåˆ†å‰²çš„ç¬¬ä¸€åˆ—å†…å®¹</span><br><span class="line">[tom@rhel7 ~]$ ls -l /tmp|grep tom|cut -d" " -f1</span><br><span class="line">drwxrwxr-x.</span><br><span class="line">-rw-rw-r--.</span><br></pre></td></tr></table></figure>

<h2 id="é’ˆå¯¹æ–‡ä»¶çš„çš„åŸºæœ¬æ“ä½œ"><a href="#é’ˆå¯¹æ–‡ä»¶çš„çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="é’ˆå¯¹æ–‡ä»¶çš„çš„åŸºæœ¬æ“ä½œ"></a>é’ˆå¯¹æ–‡ä»¶çš„çš„åŸºæœ¬æ“ä½œ</h2><h3 id="touch"><a href="#touch" class="headerlink" title="touch"></a>touch</h3><p>touch [filename] </p>
<p>åˆ›å»ºæ–‡ä»¶,å‚æ•°å¯ä»¥è·Ÿå¤šä¸ª</p>
<p>å¦‚æœè¦åˆ›å»º 50 ä¸ªæœ‰è§„å¾‹çš„æ–‡ä»¶,ä¾‹å¦‚ text1-text50</p>
<p>åˆ©ç”¨å‚æ•°æ‰©å±•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">touch test&#123;1..50&#125;</span><br><span class="line">touch test&#123;a..e&#125;</span><br><span class="line">touch test&#123;a..e&#125;_&#123;1..3&#125;---&gt; ä¼šåˆ›å»º a_1 a_2 a_3...</span><br></pre></td></tr></table></figure>

<p>ä¸Šå¸ä¹‹æ‰‹,æœ¬æ¥æ˜¯ç”¨æ¥ä¿®æ”¹æ–‡ä»¶æ—¶é—´æˆ³çš„ã€‚æ–‡ä»¶çš„ä¸‰ä¸ªæ—¶é—´ ctime\mtime\atime</p>
<p>æ‹“å±•å†…å®¹ï¼šå¯ä»¥é€šè¿‡â€œstatâ€å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶çš„ä¸‰ä¸ªæ—¶é—´</p>
<p>touch â€œ â€œ å¯ä»¥æ”¾ä¸€äº›ç‰¹æ®Šå­—ç¬¦</p>
<h4 id="touchå®éªŒ"><a href="#touchå®éªŒ" class="headerlink" title="touchå®éªŒ"></a>touchå®éªŒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[tom@rhel7 ~]$ touch test&#123;a..c&#125;_&#123;1..4&#125;</span><br><span class="line">[tom@rhel7 ~]$ ls</span><br><span class="line">testa_1 testa_4 testb_3 testc_2</span><br><span class="line">testa_2 testb_1 testb_4 testc_3</span><br><span class="line">testa_3 testb_2 testc_1 testc_4</span><br><span class="line"></span><br><span class="line">--full-timeå¯ä»¥æŸ¥çœ‹mtimeçš„å®Œæ•´æ—¶é—´</span><br><span class="line"></span><br><span class="line">[tom@rhel7 ~]$ ls -l --full-time</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 2016-03-21 01:31:22.853039590 +0800 testa_1</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 2016-03-21 01:31:22.853039590 +0800 testa_2</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 2016-03-21 01:31:22.853039590 +0800 testa_3</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 2016-03-21 01:31:22.853039590 +0800 testa_4</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 2016-03-21 01:31:22.853039590 +0800 testb_1</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 2016-03-21 01:31:22.853039590 +0800 testb_2</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 2016-03-21 01:31:22.853039590 +0800 testb_3</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 2016-03-21 01:31:22.853039590 +0800 testb_4</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 2016-03-21 01:31:22.854039544 +0800 testc_1</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 2016-03-21 01:31:22.854039544 +0800 testc_2</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 2016-03-21 01:31:22.854039544 +0800 testc_3</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 2016-03-21 01:31:22.854039544 +0800 testc_4</span><br><span class="line"></span><br><span class="line">[tom@rhel7 ~]$ touch "ab cd"</span><br><span class="line"></span><br><span class="line">[tom@rhel7 ~]$ ls -b</span><br><span class="line">ab\ \ \ cd testa_3 testb_2 testc_1 testc_4</span><br><span class="line">testa_1 testa_4 testb_3 testc_2</span><br><span class="line">testa_2 testb_1 testb_4 testc_3</span><br></pre></td></tr></table></figure>

<h4 id="touchæ‹“å±•å®éªŒ"><a href="#touchæ‹“å±•å®éªŒ" class="headerlink" title="touchæ‹“å±•å®éªŒ"></a>touchæ‹“å±•å®éªŒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[booboo@rhel7 ~]$ touch booboo</span><br><span class="line">[booboo@rhel7 ~]$ ll</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 booboo booboo 0 Jun 15 23:28 booboo</span><br><span class="line">[booboo@rhel7 ~]$ stat booboo</span><br><span class="line">  File: â€˜boobooâ€™</span><br><span class="line">  Size: 0         	Blocks: 0          IO Block: 4096   regular empty file</span><br><span class="line">Device: fd01h/64769d	Inode: 143         Links: 1</span><br><span class="line">Access: (0664/-rw-rw-r--)  Uid: ( 1001/  booboo)   Gid: ( 1001/  booboo)</span><br><span class="line">Context: unconfined_u:object_r:user_home_t:s0</span><br><span class="line">Access: 2016-06-15 23:28:55.041578819 -0400     #atime æ–‡ä»¶æœ€è¿‘ä¸€æ¬¡è¢«è®¿é—®çš„æ—¶é—´</span><br><span class="line">Modify: 2016-06-15 23:28:55.041578819 -0400    #mtime æ–‡ä»¶å†…å®¹æœ€è¿‘ä¸€æ¬¡ä¿®æ”¹çš„æ—¶é—´</span><br><span class="line">Change: 2016-06-15 23:28:55.041578819 -0400    #ctime æ–‡ä»¶å±æ€§æœ€è¿‘ä¸€æ¬¡ä¿®æ”¹çš„æ—¶é—´</span><br><span class="line"> Birth: -</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨catå»è®¿é—®boobooæ–‡ä»¶ï¼Œå¯ä»¥å‘ç°atimeè¢«ä¿®æ”¹äº†</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[booboo@rhel7 ~]$ cat booboo</span><br><span class="line">[booboo@rhel7 ~]$ stat booboo</span><br><span class="line">  File: â€˜boobooâ€™</span><br><span class="line">  Size: 0         	Blocks: 0          IO Block: 4096   regular empty file</span><br><span class="line">Device: fd01h/64769d	Inode: 143         Links: 1</span><br><span class="line">Access: (0664/-rw-rw-r--)  Uid: ( 1001/  booboo)   Gid: ( 1001/  booboo)</span><br><span class="line">Context: unconfined_u:object_r:user_home_t:s0</span><br><span class="line">Access: 2016-06-15 23:32:35.898724748 -0400</span><br><span class="line">Modify: 2016-06-15 23:28:55.041578819 -0400</span><br><span class="line">Change: 2016-06-15 23:28:55.041578819 -0400</span><br><span class="line"> Birth: -</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡chmodä¿®æ”¹æ–‡ä»¶æƒé™åï¼Œä¼šçœ‹åˆ°ctimeæ—¶é—´æ”¹å˜ï¼Œé€šè¿‡llå‘½ä»¤çœ‹åˆ°çš„æ—¶é—´ä¸ºmtime</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[booboo@rhel7 ~]$ chmod 777 booboo</span><br><span class="line">[booboo@rhel7 ~]$ ll</span><br><span class="line">total 0</span><br><span class="line">-rwxrwxrwx. 1 booboo booboo 0 Jun 15 23:28 booboo  </span><br><span class="line">[booboo@rhel7 ~]$ stat booboo</span><br><span class="line">  File: â€˜boobooâ€™</span><br><span class="line">  Size: 0         	Blocks: 0          IO Block: 4096   regular empty file</span><br><span class="line">Device: fd01h/64769d	Inode: 143         Links: 1</span><br><span class="line">Access: (0777/-rwxrwxrwx)  Uid: ( 1001/  booboo)   Gid: ( 1001/  booboo)</span><br><span class="line">Context: unconfined_u:object_r:user_home_t:s0</span><br><span class="line">Access: 2016-06-15 23:32:35.898724748 -0400</span><br><span class="line">Modify: 2016-06-15 23:28:55.041578819 -0400</span><br><span class="line">Change: 2016-06-15 23:33:49.195445761 -0400</span><br><span class="line"> Birth: -</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡echoå‘½ä»¤å‘boobooæ–‡ä»¶è¿½åŠ ä¸€äº›å†…å®¹ï¼Œä¼šçœ‹åˆ°mtimeæ—¶é—´å˜äº†ï¼Œå¹¶ä¸”ctimeä¹Ÿå˜äº†ï¼Œæ€è€ƒä¸ºä»€ä¹ˆï¼Ÿ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[booboo@rhel7 ~]$ echo hi &gt;&gt; booboo</span><br><span class="line">[booboo@rhel7 ~]$ ll</span><br><span class="line">total 4</span><br><span class="line">-rwxrwxrwx. 1 booboo booboo 3 Jun 15 23:34 booboo</span><br><span class="line">[booboo@rhel7 ~]$ stat booboo</span><br><span class="line">  File: â€˜boobooâ€™</span><br><span class="line">  Size: 3         	Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: fd01h/64769d	Inode: 143         Links: 1</span><br><span class="line">Access: (0777/-rwxrwxrwx)  Uid: ( 1001/  booboo)   Gid: ( 1001/  booboo)</span><br><span class="line">Context: unconfined_u:object_r:user_home_t:s0</span><br><span class="line">Access: 2016-06-15 23:32:35.898724748 -0400</span><br><span class="line">Modify: 2016-06-15 23:34:53.251332183 -0400</span><br><span class="line">Change: 2016-06-15 23:34:53.251332183 -0400</span><br><span class="line"> Birth: -</span><br></pre></td></tr></table></figure>

<h3 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h3><table>
<thead>
<tr>
<th align="left">rm</th>
<th align="left">[filename] remove åˆ é™¤æ–‡ä»¶,å¯¹ root ç”¨æˆ·æœ‰æç¤º,æ™®é€šç”¨æˆ·æ²¡æœ‰æç¤º</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-f</td>
<td align="left">force å¼ºåˆ¶åˆ é™¤, root æ— æç¤º</td>
</tr>
<tr>
<td align="left">-i</td>
<td align="left">æ™®é€šç”¨æˆ·æœ‰æç¤ºçš„åˆ é™¤</td>
</tr>
<tr>
<td align="left">-r</td>
<td align="left">é€’å½’åˆ é™¤,æ…é‡ä½¿ç”¨ -rf</td>
</tr>
</tbody></table>
<h4 id="rmå®éªŒ"><a href="#rmå®éªŒ" class="headerlink" title="rmå®éªŒ"></a>rmå®éªŒ</h4><p>æ™®é€šç”¨æˆ· tom</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[tom@rhel7 ~]$ rm testa_1</span><br><span class="line">[tom@rhel7 ~]$ rm -i testa_2</span><br><span class="line">rm: remove regular empty file `testa_2'? Y</span><br></pre></td></tr></table></figure>

<p>root ç”¨æˆ·</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# rm a.test</span><br><span class="line">rm: remove regular empty file `a.test'? Y</span><br><span class="line">[root@rhel7 ~]# rm -f b.test</span><br></pre></td></tr></table></figure>

<p>æ™®é€šç”¨æˆ· tom</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[tom@rhel7 ~]$ mkdir -p a/b/c</span><br><span class="line">[tom@rhel7 ~]$ rm a/</span><br><span class="line">rm: cannot remove `a/': Is a directory</span><br><span class="line">[tom@rhel7 ~]$ rm -r a/</span><br></pre></td></tr></table></figure>

<h3 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h3><p>mkdir:make directory åˆ›å»ºç›®å½•</p>
<p><code>mkdir -p /test/test1</code></p>
<p>é€’å½’åˆ›å»ºç›®å½•</p>
<p><code>mkdir {a..e}</code></p>
<p>åˆ›å»º a-e çš„ç›®å½•</p>
<p><code>touch {a..e}/file{1..4}</code></p>
<p> åœ¨ a-e çš„ç›®å½•ä¸‹æ–°å»º file1-file4 æ–‡ä»¶</p>
<h4 id="mkdirå®éªŒ"><a href="#mkdirå®éªŒ" class="headerlink" title="mkdirå®éªŒ"></a>mkdirå®éªŒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[tom@rhel7 ~]$ mkdir -p test/test1</span><br><span class="line">[tom@rhel7 ~]$ ls</span><br><span class="line">ab cd testa_3 testb_2 testc_1 testc_4</span><br><span class="line">p        testa_4 testb_3 testc_2</span><br><span class="line">test    testb_1 testb_4 testc_3</span><br><span class="line">[tom@rhel7 ~]$ mkdir &#123;a..f&#125;</span><br><span class="line">[tom@rhel7 ~]$ ls</span><br><span class="line">a d test testb_2 testc_2</span><br><span class="line">ab cd e testa_3 testb_3 testc_3</span><br><span class="line">b f testa_4 testb_4 testc_4 c p testb_1 testc_1</span><br><span class="line">[tom@rhel7 ~]$ touch &#123;a..f&#125;/file&#123;1..4&#125;</span><br><span class="line">[tom@rhel7 ~]$ ls</span><br><span class="line">a d test testb_2 testc_2</span><br><span class="line">ab cd e testa_3 testb_3 testc_3</span><br><span class="line">b f testa_4 testb_4 testc_4 c p testb_1 testc_1</span><br><span class="line">[tom@rhel7 ~]$ ls -rR</span><br><span class="line">.:</span><br><span class="line">testc_4 testb_4 testa_4 f b</span><br><span class="line">testc_3 testb_3 testa_3 e ab cd</span><br><span class="line">testc_2 testb_2 test d a</span><br><span class="line">testc_1 testb_1 p c</span><br><span class="line">./test:</span><br><span class="line">test1</span><br><span class="line">./test/test1:</span><br><span class="line">./p:</span><br><span class="line">./f:</span><br><span class="line">file4 file3 file2 file1</span><br><span class="line">./e:</span><br><span class="line">file4 file3 file2 file1</span><br><span class="line">./d:</span><br><span class="line">file4 file3 file2 file1</span><br><span class="line">./c:</span><br><span class="line">file4 file3 file2 file1</span><br><span class="line">./b:</span><br><span class="line">file4 file3 file2 file1</span><br><span class="line">./a:</span><br><span class="line">file4 file3 file2 file1</span><br></pre></td></tr></table></figure>

<h3 id="rmdir"><a href="#rmdir" class="headerlink" title="rmdir"></a>rmdir</h3><p>rmdir:remove directory åˆ é™¤ç›®å½•</p>
<p>åªèƒ½åˆ é™¤ç©ºç›®å½•,å‡ºäºå®‰å…¨æ€§çš„è€ƒè™‘</p>
<p><code>rm -rf [d_name]</code></p>
<p>å¯ä»¥åˆ é™¤éç©ºç›®å½•</p>
<h4 id="rmdir-å®éªŒ"><a href="#rmdir-å®éªŒ" class="headerlink" title="rmdir å®éªŒ"></a>rmdir å®éªŒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[booboo@rhel7 ~]$ mkdir aa</span><br><span class="line">[booboo@rhel7 ~]$ mkdir -p cc/bb</span><br><span class="line">[booboo@rhel7 ~]$ rmdir aa</span><br><span class="line">[booboo@rhel7 ~]$ ll</span><br><span class="line">total 4</span><br><span class="line">-rwxrwxrwx. 1 booboo booboo  3 Jun 15 23:34 booboo</span><br><span class="line">drwxrwxr-x. 3 booboo booboo 15 Jun 16 00:08 cc</span><br><span class="line">[booboo@rhel7 ~]$ rmdir cc</span><br><span class="line">rmdir: failed to remove â€˜ccâ€™: Directory not empty</span><br><span class="line">[booboo@rhel7 ~]$ rm -rf cc</span><br><span class="line">[booboo@rhel7 ~]$ ll</span><br><span class="line">total 4</span><br><span class="line">-rwxrwxrwx. 1 booboo booboo 3 Jun 15 23:34 booboo</span><br></pre></td></tr></table></figure>

<h3 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h3><p>cp:copy å¤åˆ¶æ–‡ä»¶</p>
<p>cp æºæ–‡ä»¶ ç›®çš„åœ°(ç›®å½•)</p>
<p>-p ä¿ç•™æ–‡ä»¶åŸå±æ€§</p>
<p>-r å¤åˆ¶ç›®å½•</p>
<h4 id="cpå®éªŒ"><a href="#cpå®éªŒ" class="headerlink" title="cpå®éªŒ"></a>cpå®éªŒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">ä½¿ç”¨ root ç”¨æˆ·,è¿›å…¥ tom çš„å®¶ç›®å½•</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# cd /home/tom</span><br><span class="line"></span><br><span class="line">ä¿ç•™åŸæ–‡ä»¶å±æ€§å¤åˆ¶ testa_3 æ–‡ä»¶åˆ° /tmp ç›®å½•ä¸‹</span><br><span class="line"></span><br><span class="line">[root@rhel7 tom]# cp -p testa_3 /tmp</span><br><span class="line">[root@rhel7 tom]# ll /tmp/testa_3</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 01:31 /tmp/testa_3</span><br><span class="line">[root@rhel7 tom]# cp testa_4 /tmp</span><br><span class="line">[root@rhel7 tom]# ll /tmp/testa_4</span><br><span class="line">-rw-r--r--. 1 root root 0 Mar 21 01:55 /tmp/testa_4</span><br><span class="line"></span><br><span class="line">æ‹·è´ç›®å½• a åˆ° /tmp ä¸‹,å¿…é¡»åŠ ä¸Š -r ,å› ä¸º a ç›®å½•ä¸‹è¿˜æœ‰ b/c ç›®å½•</span><br><span class="line"></span><br><span class="line">[root@rhel7 tom]# cp a /tmp</span><br><span class="line">cp: omitting directory `a'</span><br><span class="line">[root@rhel7 tom]# cp -r a /tmp</span><br></pre></td></tr></table></figure>

<h3 id="mv"><a href="#mv" class="headerlink" title="mv"></a>mv</h3><p>mv:move ç§»åŠ¨ ç§»åŠ¨å’Œé‡å‘½å</p>
<p>mv æºæ–‡ä»¶ ç›®çš„åœ°(ç›®å½•)</p>
<h4 id="mvå®éªŒ"><a href="#mvå®éªŒ" class="headerlink" title="mvå®éªŒ"></a>mvå®éªŒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[tom@rhel7 ~]$ mv testa_3 test</span><br><span class="line">[tom@rhel7 ~]$ ls</span><br><span class="line">a</span><br><span class="line">c f testa_4 testb_3 testc_2</span><br><span class="line">ab cd d p testb_1 testb_4 testc_3</span><br><span class="line">b</span><br><span class="line">e test testb_2 testc_1 testc_4</span><br><span class="line">[tom@rhel7 ~]$ mv test??? f/</span><br><span class="line">[tom@rhel7 ~]$ ll -R f</span><br><span class="line">f:</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 01:47 file1</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 01:47 file2</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 01:47 file3</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 01:47 file4</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 01:31 testa_4</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 01:31 testb_1</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 01:31 testb_2</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 01:31 testb_3</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 01:31 testb_4</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 01:31 testc_1</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 01:31 testc_2</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 01:31 testc_3</span><br><span class="line">-rw-rw-r--. 1 tom tom 0 Mar 21 01:31 testc_4</span><br></pre></td></tr></table></figure>


<h2 id="é’ˆå¯¹æ–‡ä»¶å†…å®¹çš„åŸºæœ¬æ“ä½œ"><a href="#é’ˆå¯¹æ–‡ä»¶å†…å®¹çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="é’ˆå¯¹æ–‡ä»¶å†…å®¹çš„åŸºæœ¬æ“ä½œ"></a>é’ˆå¯¹æ–‡ä»¶å†…å®¹çš„åŸºæœ¬æ“ä½œ</h2><h3 id="æ–‡ä»¶çš„æŸ¥çœ‹"><a href="#æ–‡ä»¶çš„æŸ¥çœ‹" class="headerlink" title="æ–‡ä»¶çš„æŸ¥çœ‹"></a>æ–‡ä»¶çš„æŸ¥çœ‹</h3><table>
<thead>
<tr>
<th align="left">æ–‡ä»¶</th>
<th align="left">å‘½ä»¤</th>
<th align="left">è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å°æ–‡ä»¶</td>
<td align="left">cat</td>
<td align="left">ä»¥æ­£åºæŸ¥çœ‹ è°ƒç”¨å†…å­˜æ¯”è¾ƒå¤š -n æ˜¾ç¤ºè¡Œå·</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">tac</td>
<td align="left">ä»¥å€’åºæŸ¥çœ‹ è°ƒç”¨å†…å­˜æ¯”è¾ƒå¤š</td>
</tr>
<tr>
<td align="left">å¤§æ–‡ä»¶</td>
<td align="left">head</td>
<td align="left">æŸ¥çœ‹æ–‡ä»¶é¦–éƒ¨ï¼Œé»˜è®¤10è¡Œ ï¼Œ-n æŒ‡å®šè¡Œå·</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">tail</td>
<td align="left">æŸ¥çœ‹æ–‡ä»¶å°¾éƒ¨ï¼Œé»˜è®¤10è¡Œï¼Œ-næŒ‡å®šè¡Œå·</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">more</td>
<td align="left">æŒ‰ç©ºæ ¼ space ä¸‹ä¸€é¡µ b å‘ä¸Šç¿»é¡µ enter ä¸‹ä¸€è¡Œ</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">less</td>
<td align="left">æ¯” more å¤šäº†ä¸€ä¸ªæœç´¢åŠŸèƒ½ /[ éœ€æœç´¢çš„å­æ®µ ]N å‘ä¸ŠæŸ¥æ‰¾ n å‘ä¸‹æŸ¥ q é€€å‡º</td>
</tr>
</tbody></table>
<h4 id="æ–‡ä»¶æŸ¥çœ‹å®éªŒ"><a href="#æ–‡ä»¶æŸ¥çœ‹å®éªŒ" class="headerlink" title="æ–‡ä»¶æŸ¥çœ‹å®éªŒ"></a>æ–‡ä»¶æŸ¥çœ‹å®éªŒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[tom@rhel7 ~]$ cat -n passwd</span><br><span class="line">1 root:x:0:0:root:/root:/bin/bash</span><br><span class="line">2 bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">3 daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">4 adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">5 lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">6 sync:x:5:0:sync:/sbin:/bin/sync</span><br><span class="line">7 shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">8 halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">9 mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line">10 cong:x:500:500:cong:/home/cong:/bin/bash</span><br><span class="line">11 nginx:x:496:491:Nginx web server:/var/lib/nginx:/sbin/nologin</span><br><span class="line">12 tom:x:501:501::/home/tom:/bin/bash</span><br><span class="line">[tom@rhel7 ~]$ tac passwd</span><br><span class="line">tom:x:501:501::/home/tom:/bin/bash</span><br><span class="line">nginx:x:496:491:Nginx web server:/var/lib/nginx:/sbin/nologin</span><br><span class="line">cong:x:500:500:cong:/home/cong:/bin/bash</span><br><span class="line">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">sync:x:5:0:sync:/sbin:/bin/sync</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="æ–‡ä»¶çš„ä¿®æ”¹"><a href="#æ–‡ä»¶çš„ä¿®æ”¹" class="headerlink" title="æ–‡ä»¶çš„ä¿®æ”¹"></a>æ–‡ä»¶çš„ä¿®æ”¹</h3><table>
<thead>
<tr>
<th align="left">è½¯ä»¶</th>
<th align="left">è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td align="left">LibreOffice</td>
<td align="left">.odt ç»“å°¾ ç±»ä¼¼äº windows office</td>
</tr>
<tr>
<td align="left">gedit</td>
<td align="left">ç±»ä¼¼äº windows è®°äº‹æœ¬</td>
</tr>
<tr>
<td align="left">vim</td>
<td align="left">æ’å…¥æ¨¡å¼ åé¢ä¼šä¸“é—¨è®²åˆ° vim ç¼–è¾‘å™¨çš„ä½¿ç”¨ é€€å‡ºæ¨¡å¼ å‘½ä»¤æ¨¡å¼</td>
</tr>
<tr>
<td align="left">echo</td>
<td align="left">æœ¬èº«ä»£è¡¨å›æ˜¾ echo xxx &gt; file å°† xxx å†™å…¥ file æ–‡ä»¶,å¹¶è¦†ç›–åŸæœ‰å†…å®¹ echo xxx &gt;&gt; file åœ¨ file æ–‡ä»¶è¿½åŠ </td>
</tr>
</tbody></table>
<h4 id="echoå®éªŒ"><a href="#echoå®éªŒ" class="headerlink" title="echoå®éªŒ"></a>echoå®éªŒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[booboo@rhel7 ~]$ echo hi &gt; file1</span><br><span class="line">[booboo@rhel7 ~]$ cat file1</span><br><span class="line">hi</span><br><span class="line">[booboo@rhel7 ~]$ echo booboo &gt; file1</span><br><span class="line">[booboo@rhel7 ~]$ cat file1</span><br><span class="line">booboo</span><br><span class="line">[booboo@rhel7 ~]$ echo hihihihi &gt;&gt; file1</span><br><span class="line">[booboo@rhel7 ~]$ cat file1</span><br><span class="line">booboo</span><br><span class="line">hihihihi</span><br></pre></td></tr></table></figure>

<h3 id="æ–‡ä»¶çš„è¿‡æ»¤"><a href="#æ–‡ä»¶çš„è¿‡æ»¤" class="headerlink" title="æ–‡ä»¶çš„è¿‡æ»¤"></a>æ–‡ä»¶çš„è¿‡æ»¤</h3><p>grep</p>
<p>æˆªå–è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">grep [OPTIONS] PATTERN [FILE...]</span><br><span class="line">è¿‡æ»¤å¸¦æœ‰ [ å­—ç¬¦ä¸² ] çš„è¡Œ</span><br><span class="line">grep [ å­—ç¬¦ä¸² ] [ æ–‡ä»¶ ]	</span><br><span class="line">è¿‡æ»¤ä»¥ [ å­—ç¬¦ä¸² ] ä¸ºå¼€å§‹çš„è¡Œ</span><br><span class="line">grep [^ å­—ç¬¦ä¸² ] [ æ–‡ä»¶ ]</span><br><span class="line">è¿‡æ»¤ä»¥ [ å­—ç¬¦ä¸² ] ä¸ºç»“å°¾çš„è¡Œ</span><br><span class="line">grep [ å­—ç¬¦ä¸² $] [ æ–‡ä»¶ ]</span><br><span class="line">è¿‡æ»¤åé€‰</span><br><span class="line">grep -v [ å­—ç¬¦ä¸² ] [ æ–‡ä»¶ ]</span><br><span class="line"></span><br><span class="line">eg.</span><br><span class="line">è¿‡æ»¤ä»¥ root ä¸ºå¼€å§‹çš„è¡Œ</span><br><span class="line"> grep ^root /etc/passwd</span><br><span class="line">è¿‡æ»¤ä»¥ bash ä¸ºç»“å°¾çš„è¡Œ</span><br><span class="line">grep bash$ /etc/passwd</span><br></pre></td></tr></table></figure>

<p>cut</p>
<p>æˆªå–åˆ—</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cut -d" åˆ†å‰²ç¬¦ "( ä»¥ä»€ä¹ˆä¸ºåˆ†éš”ç¬¦ ) -fn( ç¬¬å‡ åˆ— ) [ æ–‡ä»¶ ]</span><br><span class="line">eg. cut -d":" -f2 /etc/resolv.conf</span><br></pre></td></tr></table></figure>

<p>wc</p>
<p>ç»Ÿè®¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wc è¡Œæ•° å•è¯æ•° å­—ç¬¦æ•° æ–‡ä»¶å</span><br><span class="line">-l åªæ˜¾ç¤ºè¡Œæ•°</span><br><span class="line">-w, --words æ˜¾ç¤ºå•è¯æ•°</span><br><span class="line">-c, -m,--bytes æ˜¾ç¤ºå­—èŠ‚</span><br><span class="line">eg.</span><br><span class="line">[root@stu15 ~]# wc /etc/resolv.conf ã€</span><br><span class="line">4 11 98 /etc/resolv.conf</span><br></pre></td></tr></table></figure>

<p>sort</p>
<p>æ’åº</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">é»˜è®¤æŒ‰ç…§é¦–å­—æ¯ ACII ç </span><br><span class="line">-n æŒ‰ç…§æ•°å­—å¤§å°æ’åº</span><br><span class="line">-u å‰”é™¤é‡å¤çš„è¡Œ</span><br><span class="line">-r é™åºæ’åˆ—</span><br><span class="line">-k æŒ‡å®šæŸä¸€åˆ—</span><br><span class="line">-t åˆ†éš”ç¬¦</span><br><span class="line">eg.sort -n -k 2 -t : file1 </span><br><span class="line">å°† file1 ä»¥ç¬¬äºŒåˆ—çš„æ•°å­—æ’åº,åˆ—ä»¥:åˆ†å‰²</span><br></pre></td></tr></table></figure>

<p>uniq</p>
<p>å‰”é™¤é‡å¤è¡Œ</p>
<p><code>uniq [file_name]</code></p>
<h4 id="æ–‡ä»¶è¿‡æ»¤å®éªŒ"><a href="#æ–‡ä»¶è¿‡æ»¤å®éªŒ" class="headerlink" title="æ–‡ä»¶è¿‡æ»¤å®éªŒ"></a>æ–‡ä»¶è¿‡æ»¤å®éªŒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">grep</span><br><span class="line"></span><br><span class="line">[booboo@rhel7 ~]$ grep root passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">[booboo@rhel7 ~]$ grep ^booboo passwd</span><br><span class="line">booboo:x:1001:1001::/home/booboo:/bin/bash</span><br><span class="line">[booboo@rhel7 ~]$ grep ^root passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">[booboo@rhel7 ~]$ grep bash$ passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">student:x:1000:1000:student:/home/student:/bin/bash</span><br><span class="line">booboo:x:1001:1001::/home/booboo:/bin/bash</span><br><span class="line">[booboo@rhel7 ~]$ grep -v nologin passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">sync:x:5:0:sync:/sbin:/bin/sync</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">student:x:1000:1000:student:/home/student:/bin/bash</span><br><span class="line">booboo:x:1001:1001::/home/booboo:/bin/bash</span><br><span class="line"></span><br><span class="line">cut</span><br><span class="line"></span><br><span class="line">[booboo@rhel7 ~]$ cut -d":" -f1 passwd</span><br><span class="line">root</span><br><span class="line">bin</span><br><span class="line">daemon</span><br><span class="line">adm</span><br><span class="line">lp</span><br><span class="line">sync</span><br><span class="line">shutdown</span><br><span class="line">halt</span><br><span class="line">mail</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wc</span><br><span class="line"></span><br><span class="line">[booboo@rhel7 ~]$ wc passwd</span><br><span class="line">  42   72 2121 passwd</span><br><span class="line">[booboo@rhel7 ~]$ wc -l passwd</span><br><span class="line">42 passwd</span><br><span class="line">[booboo@rhel7 ~]$ wc -w passwd</span><br><span class="line">72 passwd</span><br><span class="line">[booboo@rhel7 ~]$ wc -c passwd</span><br><span class="line">2121 passwd</span><br><span class="line"></span><br><span class="line">sort</span><br><span class="line"></span><br><span class="line">[booboo@rhel7 ~]$ vi num</span><br><span class="line">[booboo@rhel7 ~]$ cat num</span><br><span class="line">booboo 20 100</span><br><span class="line">tom 21 100</span><br><span class="line">tom 21 100</span><br><span class="line">kevin 19 200</span><br><span class="line">booboo 20 100</span><br><span class="line">mark 20 200</span><br><span class="line">[booboo@rhel7 ~]$ sort num</span><br><span class="line">booboo 20 100</span><br><span class="line">booboo 20 100</span><br><span class="line">kevin 19 200</span><br><span class="line">mark 20 200</span><br><span class="line">tom 21 100</span><br><span class="line">tom 21 100</span><br><span class="line">[booboo@rhel7 ~]$ sort -r num</span><br><span class="line">tom 21 100</span><br><span class="line">tom 21 100</span><br><span class="line">mark 20 200</span><br><span class="line">kevin 19 200</span><br><span class="line">booboo 20 100</span><br><span class="line">booboo 20 100</span><br><span class="line">[booboo@rhel7 ~]$ sort -u num</span><br><span class="line">booboo 20 100</span><br><span class="line">kevin 19 200</span><br><span class="line">mark 20 200</span><br><span class="line">tom 21 100</span><br><span class="line">[booboo@rhel7 ~]$ sort -n -k 2 -t " " num |sort -u</span><br><span class="line">booboo 20 100</span><br><span class="line">kevin 19 200</span><br><span class="line">mark 20 200</span><br><span class="line">tom 21 100</span><br><span class="line"></span><br><span class="line">uniq</span><br><span class="line"></span><br><span class="line">[booboo@rhel7 ~]$ uniq num</span><br><span class="line">booboo 20 100</span><br><span class="line">tom 21 100</span><br><span class="line">kevin 19 200</span><br><span class="line">booboo 20 100</span><br><span class="line">mark 20 200</span><br></pre></td></tr></table></figure>

<h2 id="å¸®åŠ©å‘½ä»¤"><a href="#å¸®åŠ©å‘½ä»¤" class="headerlink" title="å¸®åŠ©å‘½ä»¤"></a>å¸®åŠ©å‘½ä»¤</h2><table>
<thead>
<tr>
<th align="left">å‘½ä»¤</th>
<th align="left">è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td align="left">type [ å‘½ä»¤ ]</td>
<td align="left">åˆ¤æ–­æ˜¯å†…éƒ¨å‘½ä»¤ or å¤–éƒ¨å‘½ä»¤</td>
</tr>
<tr>
<td align="left">â€“help</td>
<td align="left">å¤–éƒ¨å‘½ä»¤</td>
</tr>
<tr>
<td align="left">help</td>
<td align="left">åªé’ˆå¯¹ç³»ç»Ÿå†…éƒ¨å‘½ä»¤</td>
</tr>
<tr>
<td align="left">man []</td>
<td align="left">å†…å®¹æ¸…æ™°ã€è¯¦ç»†,åœ¨çº¿æ–‡æ¡£,æ”¯æŒæœç´¢( /name ) <code>man [ ç« èŠ‚ ] [name]</code></td>
</tr>
<tr>
<td align="left">info []</td>
<td align="left">å¤ªè¯¦ç»†</td>
</tr>
<tr>
<td align="left">/usr/share/doc</td>
<td align="left">å­˜æ”¾å¸®åŠ©æ–‡æ¡£,åœ¨ä¸è½¯ä»¶åŒåçš„ç›®å½•ä¸‹æœ‰æ‰€æœ‰è½¯ä»¶çš„ä½¿ç”¨æ–‡æ¡£</td>
</tr>
</tbody></table>
<p><strong>manå’Œâ€”helpä»¥åŠhelpçš„åŒºåˆ«</strong></p>
<p>manå‘½ä»¤</p>
<p>ç³»ç»Ÿä¸­ä¼šæœ‰å•ç‹¬çš„manæ–‡ä»¶ï¼Œå°±æ˜¯è¯´ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰å®‰è£…å¯¹åº”manæ–‡ä»¶ï¼Œå“ªæ€•å‘½ä»¤å®Œå…¨æ­£å¸¸ï¼Œmanéƒ½æ²¡ç»“æœï¼ˆåŒæ ·ï¼Œåªè¦å®‰è£…äº†manæ–‡ä»¶ï¼Œå“ªæ€•æ²¡å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥å¾—åˆ°ä¸€å¤§å †ä¸œè¥¿ï¼‰ã€‚</p>
<p>â€“helpå‚æ•°<br>å°†ä¼šæ˜¾ç¤ºå¯æ‰§è¡Œç¨‹åºè‡ªå¸¦çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ˜¯åµŒå…¥åˆ°ç¨‹åºæœ¬èº«çš„ï¼Œæ‰€ä»¥â€“helpä¿¡æ¯è¾ƒç®€çŸ­ã€‚</p>
<p>helpå‘½ä»¤<br>æ˜¯é€‰é¡¹å¸®åŠ©å‘½ä»¤ï¼Œé¡¾åæ€ä¹‰  ä½ å¯ä»¥æŠŠå•ç‹¬æŸä¸ªå‘½ä»¤çš„æŸä¸ªé€‰é¡¹åˆ—å‡ºæ¥ï¼Œæ–¹ä¾¿å¿«æ·å¾ˆå¤šï¼Œçœå»äº†manå½“ä¸­æŸ¥æ‰¾çš„ç¹çï¼Œä½†æ˜¯helpåªæ”¯æŒshellçš„å†…éƒ¨å‘½ä»¤ã€‚å†…éƒ¨å‘½ä»¤å³å­˜å‚¨åœ¨shellå†…éƒ¨å¯ä»¥ç›´æ¥è°ƒç”¨çš„ä¸€äº›ç®€å•å‘½ä»¤ï¼Œæ¯”å¦‚è¯´echoï¼Œcdï¼Œpwdç­‰ã€‚</p>
<h3 id="type"><a href="#type" class="headerlink" title="type"></a>type</h3><p>typeå‘½ä»¤ç”¨æ¥æ˜¾ç¤ºæŒ‡å®šå‘½ä»¤çš„ç±»å‹ï¼Œåˆ¤æ–­ç»™å‡ºçš„æŒ‡ä»¤æ˜¯å†…éƒ¨æŒ‡ä»¤è¿˜æ˜¯å¤–éƒ¨æŒ‡ä»¤ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¯­æ³•</span><br><span class="line">type(é€‰é¡¹)(å‚æ•°)</span><br><span class="line">é€‰é¡¹</span><br><span class="line">-tï¼šè¾“å‡ºâ€œfileâ€ã€â€œaliasâ€æˆ–è€…â€œbuiltinâ€ï¼Œåˆ†åˆ«è¡¨ç¤ºç»™å®šçš„æŒ‡ä»¤ä¸ºâ€œå¤–éƒ¨æŒ‡ä»¤â€ã€â€œå‘½ä»¤åˆ«åâ€æˆ–è€…â€œå†…éƒ¨æŒ‡ä»¤â€ï¼›</span><br><span class="line">-pï¼šå¦‚æœç»™å‡ºçš„æŒ‡ä»¤ä¸ºå¤–éƒ¨æŒ‡ä»¤ï¼Œåˆ™æ˜¾ç¤ºå…¶ç»å¯¹è·¯å¾„ï¼›</span><br><span class="line">-aï¼šåœ¨ç¯å¢ƒå˜é‡â€œPATHâ€æŒ‡å®šçš„è·¯å¾„ä¸­ï¼Œæ˜¾ç¤ºç»™å®šæŒ‡ä»¤çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å‘½ä»¤åˆ«åã€‚ å‚æ•° æŒ‡ä»¤ï¼šè¦æ˜¾ç¤ºç±»å‹çš„æŒ‡ä»¤ã€‚</span><br><span class="line">å‚æ•°</span><br><span class="line">å…³é”®å­—ï¼šæŒ‡å®šè¦æœç´¢å¸®åŠ©çš„å…³é”®å­—</span><br><span class="line">å‘½ä»¤ç±»å‹</span><br><span class="line">aliasï¼šåˆ«å</span><br><span class="line">keywordï¼šå…³é”®å­—ï¼ŒShellä¿ç•™å­—</span><br><span class="line">functionï¼šå‡½æ•°ï¼ŒShellå‡½æ•°</span><br><span class="line">builtinï¼šå†…å»ºå‘½ä»¤ï¼ŒShellå†…å»ºå‘½ä»¤</span><br><span class="line">fileï¼šæ–‡ä»¶ï¼Œç£ç›˜æ–‡ä»¶ï¼Œå¤–éƒ¨å‘½ä»¤</span><br><span class="line">unfoundï¼šæ²¡æœ‰æ‰¾åˆ°</span><br><span class="line"></span><br><span class="line">å°è¯•å‡ ä¸ªå‘½ä»¤man,ls,touch,echo,cat</span><br><span class="line"></span><br><span class="line">[booboo@rhel7 ~]$ type man</span><br><span class="line">man is /bin/man</span><br><span class="line">[booboo@rhel7 ~]$ type ls</span><br><span class="line">ls is aliased to `ls â€“color=auto'</span><br><span class="line">[booboo@rhel7 ~]$ which ls</span><br><span class="line">alias ls='ls --color=auto'</span><br><span class="line">	/bin/ls</span><br><span class="line">[booboo@rhel7 ~]$ type touch</span><br><span class="line">touch is hashed (/bin/touch)</span><br><span class="line">[booboo@rhel7 ~]$ type echo</span><br><span class="line">echo is a shell builtin</span><br><span class="line">[booboo@rhel7 ~]$ type cat</span><br><span class="line">cat is hashed (/bin/cat)</span><br></pre></td></tr></table></figure>
<p>å†…ç½®å‘½ä»¤ä¸€èˆ¬æ˜¾ç¤ºä¸ºâ€œis a shell builtin â€</p>
<p>é™¤äº†å†…ç½®å‘½ä»¤å¤–ï¼Œå…¶ä»–å‘½ä»¤éƒ½æ˜¯é€šè¿‡æŸä¸ªå®‰è£…åŒ…å®‰è£…ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹è¿™äº›å‘½ä»¤éƒ½æ˜¯ä»€ä¹ˆè½¯ä»¶ç”Ÿæˆçš„</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[booboo@rhel7 ~]$ rpm -qf /bin/man</span><br><span class="line">man-db-2.6.3-9.el7.x86_64</span><br><span class="line">[booboo@rhel7 ~]$ rpm -qf /bin/ls</span><br><span class="line">coreutils-8.22-11.el7.x86_64</span><br><span class="line">[booboo@rhel7 ~]$ rpm -qf /bin/touch</span><br><span class="line">coreutils-8.22-11.el7.x86_64</span><br><span class="line">[booboo@rhel7 ~]$ rpm -qf /bin/cat</span><br><span class="line">coreutils-8.22-11.el7.x86_64</span><br><span class="line">[booboo@rhel7 ~]$ type if</span><br><span class="line">if is a shell keyword</span><br></pre></td></tr></table></figure>

<h3 id="â€“help-å‚æ•°"><a href="#â€“help-å‚æ•°" class="headerlink" title="â€“help å‚æ•°"></a>â€“help å‚æ•°</h3><p>â€“helpå‚æ•°æ˜¯å¤§æ‰€æ•°å‘½ä»¤è‡ªå¸¦çš„é€‰é¡¹ï¼Œç”¨äºæŸ¥çœ‹ä½¿ç”¨å¸®åŠ©ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[booboo@rhel7 ~]$ ls --help</span><br><span class="line">Usage: ls [OPTION]... [FILE]...</span><br><span class="line">List information about the FILEs (the current directory by default).</span><br><span class="line">Sort entries alphabetically if none of -cftuvSUX nor --sort is specified.</span><br><span class="line"></span><br><span class="line">Mandatory arguments to long options are mandatory for short options too.</span><br><span class="line">  -a, --all                  do not ignore entries starting with .</span><br><span class="line">  -A, --almost-all           do not list implied . and ..</span><br><span class="line">      --author               with -l, print the author of each file</span><br><span class="line">  -b, --escape               print C-style escapes for nongraphic characters</span><br><span class="line">      --block-size=SIZE      scale sizes by SIZE before printing them; e.g.,</span><br><span class="line">                               '--block-size=M' prints sizes in units of</span><br><span class="line">                               1,048,576 bytes; see SIZE format below</span><br><span class="line">  -B, --ignore-backups       do not list implied entries ending with ~</span><br><span class="line">  -c                         with -lt: sort by, and show, ctime (time of last</span><br><span class="line">                               modification of file status information);</span><br><span class="line">                               with -l: show ctime and sort by name;</span><br><span class="line">                               otherwise: sort by ctime, newest first</span><br><span class="line">  -C                         list entries by columns</span><br><span class="line">      --color[=WHEN]         colorize the output; WHEN can be 'never', 'auto',</span><br><span class="line">                               or 'always' (the default); more info below</span><br><span class="line">  -d, --directory            list directories themselves, not their contents</span><br><span class="line">  -D, --dired                generate output designed for Emacs' dired mode</span><br><span class="line">  -f                         do not sort, enable -aU, disable -ls --color</span><br></pre></td></tr></table></figure>

<h3 id="help"><a href="#help" class="headerlink" title="help"></a>help</h3><p>helpåªæ”¯æŒshellçš„å†…éƒ¨å‘½ä»¤ã€‚å†…éƒ¨å‘½ä»¤å³å­˜å‚¨åœ¨shellå†…éƒ¨å¯ä»¥ç›´æ¥è°ƒç”¨çš„ä¸€äº›ç®€å•å‘½ä»¤,ä¾‹å¦‚cd,echo,helpç­‰ã€‚</p>
<p>help(é€‰é¡¹)(å‚æ•°)<br>-sï¼šè¾“å‡ºçŸ­æ ¼å¼çš„å¸®åŠ©ä¿¡æ¯ã€‚ä»…åŒ…æ‹¬å‘½ä»¤æ ¼å¼ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[booboo@rhel7 ~]$ type cd</span><br><span class="line">cd is a shell builtin</span><br><span class="line">[booboo@rhel7 ~]$ help cd</span><br><span class="line">cd: cd [-L|[-P [-e]]] [dir]</span><br><span class="line">    Change the shell working directory.</span><br><span class="line"></span><br><span class="line">    Change the current directory to DIR.  The default DIR is the value of the</span><br><span class="line">    HOME shell variable.</span><br><span class="line"></span><br><span class="line">    The variable CDPATH defines the search path for the directory containing</span><br><span class="line">    DIR.  Alternative directory names in CDPATH are separated by a colon (:).</span><br><span class="line">    A null directory name is the same as the current directory.  If DIR begins</span><br><span class="line">    with a slash (/), then CDPATH is not used.</span><br><span class="line"></span><br><span class="line">    If the directory is not found, and the shell option `cdable_vars' is set,</span><br><span class="line">    the word is assumed to be  a variable name.  If that variable has a value,</span><br><span class="line">    its value is used for DIR.</span><br><span class="line"></span><br><span class="line">    Options:</span><br><span class="line">        -L	force symbolic links to be followed</span><br><span class="line">        -P	use the physical directory structure without following symbolic</span><br><span class="line">    	links</span><br><span class="line">        -e	if the -P option is supplied, and the current working directory</span><br><span class="line">    	cannot be determined successfully, exit with a non-zero status</span><br><span class="line"></span><br><span class="line">    The default is to follow symbolic links, as if `-L' were specified.</span><br><span class="line"></span><br><span class="line">    Exit Status:</span><br><span class="line">    Returns 0 if the directory is changed, and if $PWD is set successfully when</span><br><span class="line">    -P is used; non-zero otherwise.</span><br><span class="line">[booboo@rhel7 ~]$ type touch</span><br><span class="line">touch is hashed (/bin/touch)</span><br><span class="line">[booboo@rhel7 ~]$ type echo</span><br><span class="line">echo is a shell builtin</span><br><span class="line">[booboo@rhel7 ~]$ help echo</span><br><span class="line">echo: echo [-neE] [arg ...]</span><br></pre></td></tr></table></figure>

<h3 id="man"><a href="#man" class="headerlink" title="man"></a>man</h3><p>manå‘½ä»¤æ˜¯Linuxä¸‹çš„å¸®åŠ©æŒ‡ä»¤ï¼Œé€šè¿‡manæŒ‡ä»¤å¯ä»¥æŸ¥çœ‹Linuxä¸­çš„æŒ‡ä»¤å¸®åŠ©ã€é…ç½®æ–‡ä»¶å¸®åŠ©å’Œç¼–ç¨‹å¸®åŠ©ç­‰ä¿¡æ¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯­æ³•</span><br><span class="line">man(é€‰é¡¹)(å‚æ•°)</span><br><span class="line">é€‰é¡¹</span><br><span class="line">-aï¼šåœ¨æ‰€æœ‰çš„manå¸®åŠ©æ‰‹å†Œä¸­æœç´¢ï¼›</span><br><span class="line">-fï¼šç­‰ä»·äºwhatisæŒ‡ä»¤ï¼Œæ˜¾ç¤ºç»™å®šå…³é”®å­—çš„ç®€çŸ­æè¿°ä¿¡æ¯ï¼›</span><br><span class="line">-Pï¼šæŒ‡å®šå†…å®¹æ—¶ä½¿ç”¨åˆ†é¡µç¨‹åºï¼›</span><br><span class="line">-Mï¼šæŒ‡å®šmanæ‰‹å†Œæœç´¢çš„è·¯å¾„ã€‚</span><br><span class="line">å‚æ•°</span><br><span class="line">æ•°å­—ï¼šæŒ‡å®šä»å“ªæœ¬manæ‰‹å†Œä¸­æœç´¢å¸®åŠ©</span><br><span class="line">å…³é”®å­—ï¼šæŒ‡å®šè¦æœç´¢å¸®åŠ©çš„å…³é”®å­—</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚è¾“å…¥man lsï¼Œå®ƒä¼šåœ¨å·¦ä¸Šè§’æ˜¾ç¤ºâ€œECHO(1)â€â€œECHOâ€ä»£è¡¨æ‰‹å†Œåç§°ï¼›â€œ(1)â€ä»£è¡¨ è¡¨ç¤ºè¯¥æ‰‹å†Œä½äºç¬¬ä¸€èŠ‚ç« 1ï¼‰â€è¡¨ç¤ºè¯¥æ‰‹å†Œä½äºç¬¬ä¸€èŠ‚ç« ï¼ŒåŒæ ·ï¼Œæˆ‘ä»¬è¾“man ifconfigå®ƒä¼šåœ¨æœ€å·¦ä¸Šè§’æ˜¾ç¤ºâ€œIFCONFIGï¼ˆ8ï¼‰â€ã€‚ä¹Ÿå¯ä»¥è¿™æ ·è¾“å…¥å‘½ä»¤ï¼šâ€œman [ç« èŠ‚å·] æ‰‹å†Œåç§°â€ã€‚ manæ˜¯æŒ‰ç…§æ‰‹å†Œçš„ç« èŠ‚å·çš„é¡ºåºè¿›è¡Œæœç´¢çš„ï¼Œæ¯”å¦‚ï¼š man sleep åªä¼šæ˜¾ç¤ºsleepå‘½ä»¤çš„æ‰‹å†Œ,å¦‚æœæƒ³æŸ¥çœ‹åº“å‡½æ•°sleepï¼Œå°±è¦è¾“å…¥: man 3 sleep</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[booboo@rhel7 ~]$ man echo|cat</span><br><span class="line">ECHO(1)                         User Commands                         ECHO(1)</span><br><span class="line"><span class="meta">#</span><span class="bash">æ­¤å¤„â€œECHOâ€ä»£è¡¨æ‰‹å†Œåç§°ï¼›â€œï¼ˆ1ï¼‰â€ä»£è¡¨ è¡¨ç¤ºè¯¥æ‰‹å†Œä½äºç¬¬ä¸€èŠ‚ç« </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">       echo - display a line of text</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">       echo [SHORT-OPTION]... [STRING]...</span><br><span class="line">       echo LONG-OPTION</span><br><span class="line"></span><br><span class="line">DESCRIPTION</span><br><span class="line">       Echo the STRING(s) to standard output.</span><br><span class="line"></span><br><span class="line">       -n     do not output the trailing newline</span><br><span class="line"></span><br><span class="line">       -e     enable interpretation of backslash escapes</span><br><span class="line"></span><br><span class="line">       -E     disable interpretation of backslash escapes (default)</span><br><span class="line"></span><br><span class="line">       --help display this help and exit</span><br><span class="line"></span><br><span class="line">       --version</span><br><span class="line">              output version information and exit</span><br><span class="line"></span><br><span class="line">       If -e is in effect, the following sequences are recognized:</span><br><span class="line"></span><br><span class="line">       \\     backslash</span><br><span class="line"></span><br><span class="line">       \a     alert (BEL)</span><br><span class="line"></span><br><span class="line">       \b     backspace</span><br><span class="line"></span><br><span class="line">       \c     produce no further output</span><br><span class="line"></span><br><span class="line">       \e     escape</span><br><span class="line"></span><br><span class="line">       \f     form feed</span><br><span class="line"></span><br><span class="line">       \n     new line</span><br><span class="line"></span><br><span class="line">       \r     carriage return</span><br><span class="line"></span><br><span class="line">       \t     horizontal tab</span><br><span class="line"></span><br><span class="line">       \v     vertical tab</span><br><span class="line"></span><br><span class="line">       \0NNN  byte with octal value NNN (1 to 3 digits)</span><br><span class="line"></span><br><span class="line">       \xHH   byte with hexadecimal value HH (1 to 2 digits)</span><br><span class="line"></span><br><span class="line">       NOTE:  your  shell  may  have  its  own version of echo, which usually</span><br><span class="line">       supersedes the version described here.  Please refer to  your  shell's</span><br><span class="line">       documentation for details about the options it supports.</span><br><span class="line"></span><br><span class="line">       GNU  coreutils  online  help: &lt;http://www.gnu.org/software/coreutils/&gt;</span><br><span class="line">       Report echo translation bugs to &lt;http://translationproject.org/team/&gt;</span><br><span class="line">AUTHOR</span><br><span class="line">       Written by Brian Fox and Chet Ramey.</span><br><span class="line">COPYRIGHT</span><br><span class="line">       Copyright Â© 2013 Free Software Foundation, Inc.  License  GPLv3+:  GNU</span><br><span class="line">       GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;.</span><br><span class="line">       This  is  free  software:  you are free to change and redistribute it.</span><br><span class="line">       There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line">SEE ALSO</span><br><span class="line">       The full documentation for echo is maintained as a Texinfo manual.  If</span><br><span class="line">       the  info  and  echo programs are properly installed at your site, the</span><br><span class="line">       command</span><br><span class="line">             info coreutils 'echo invocation'</span><br><span class="line">      should give you access to the complete manual.</span><br><span class="line"></span><br><span class="line">GNU coreutils 8.22               January 2014                         ECHO(1)</span><br></pre></td></tr></table></figure>

<h3 id="infoï¼ˆä½œä¸ºæ‹“å±•å†…å®¹ï¼‰"><a href="#infoï¼ˆä½œä¸ºæ‹“å±•å†…å®¹ï¼‰" class="headerlink" title="infoï¼ˆä½œä¸ºæ‹“å±•å†…å®¹ï¼‰"></a>infoï¼ˆä½œä¸ºæ‹“å±•å†…å®¹ï¼‰</h3><p>infoå‘½ä»¤æ˜¯Linuxä¸‹infoæ ¼å¼çš„å¸®åŠ©æŒ‡ä»¤ã€‚ å°±å†…å®¹æ¥è¯´ï¼Œinfoé¡µé¢æ¯”man pageç¼–å†™å¾—è¦æ›´å¥½ã€æ›´å®¹æ˜“ç†è§£ï¼Œä¹Ÿæ›´å‹å¥½ï¼Œä½†man pageä½¿ç”¨èµ·æ¥ç¡®å®è¦æ›´å®¹æ˜“å¾—å¤šã€‚ä¸€ä¸ªman pageåªæœ‰ä¸€é¡µï¼Œè€Œinfoé¡µé¢å‡ ä¹æ€»æ˜¯å°†å®ƒä»¬çš„å†…å®¹ç»„ç»‡æˆå¤šä¸ªåŒºæ®µï¼ˆç§°ä¸ºèŠ‚ç‚¹ï¼‰ï¼Œæ¯ä¸ªåŒºæ®µä¹Ÿå¯èƒ½åŒ…å«å­åŒºæ®µï¼ˆç§°ä¸ºå­èŠ‚ç‚¹ï¼‰ã€‚ç†è§£è¿™ä¸ªå‘½ä»¤çš„çªé—¨å°±æ˜¯ä¸ä»…è¦å­¦ä¹ å¦‚ä½•åœ¨å•ç‹¬çš„Infoé¡µé¢ä¸­æµè§ˆå¯¼èˆªï¼Œè¿˜è¦å­¦ä¹ å¦‚ä½•åœ¨èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹ä¹‹é—´åˆ‡æ¢ã€‚å¯èƒ½åˆšå¼€å§‹ä¼šä¸€æ—¶å¾ˆéš¾åœ¨infoé¡µé¢çš„èŠ‚ç‚¹ä¹‹é—´ç§»åŠ¨å’Œæ‰¾åˆ°ä½ è¦çš„ä¸œè¥¿ï¼ŒçœŸæ˜¯å…·æœ‰è®½åˆºæ„å‘³ï¼šåŸæœ¬ä»¥ä¸ºå¯¹äºæ–°æ‰‹æ¥è¯´ï¼ŒæŸä¸ªä¸œè¥¿æ¯”manå‘½ä»¤ä¼šæ›´å¥½äº›ï¼Œä½†å®é™…ä¸Šå­¦ä¹ å’Œä½¿ç”¨èµ·æ¥æ›´å›°éš¾ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¯­æ³•</span><br><span class="line">info(é€‰é¡¹)(å‚æ•°)</span><br><span class="line">é€‰é¡¹</span><br><span class="line">-dï¼šæ·»åŠ åŒ…å«infoæ ¼å¼å¸®åŠ©æ–‡æ¡£çš„ç›®å½•ï¼›</span><br><span class="line"> -fï¼šæŒ‡å®šè¦è¯»å–çš„infoæ ¼å¼çš„å¸®åŠ©æ–‡æ¡£ï¼›</span><br><span class="line">-nï¼šæŒ‡å®šé¦–å…ˆè®¿é—®çš„infoå¸®åŠ©æ–‡ä»¶çš„èŠ‚ç‚¹ï¼›</span><br><span class="line"> -oï¼šè¾“å‡ºè¢«é€‰æ‹©çš„èŠ‚ç‚¹å†…å®¹åˆ°æŒ‡å®šæ–‡ä»¶ã€‚</span><br><span class="line">å‚æ•°</span><br><span class="line"> å¸®åŠ©ä¸»é¢˜ï¼šæŒ‡å®šéœ€è¦è·å¾—å¸®åŠ©çš„ä¸»é¢˜ï¼Œå¯ä»¥æ˜¯æŒ‡ä»¤ã€å‡½æ•°ä»¥åŠé…ç½®æ–‡ä»¶ã€‚</span><br><span class="line">å¸¸ç”¨å¿«æ·é”®</span><br><span class="line">?é”®ï¼šå®ƒå°±ä¼šæ˜¾ç¤ºinfoçš„å¸¸ç”¨å¿«æ·é”®ã€‚</span><br><span class="line">Né”®ï¼šæ˜¾ç¤ºï¼ˆç›¸å¯¹äºæœ¬èŠ‚ç‚¹çš„ï¼‰ä¸‹ä¸€èŠ‚ç‚¹çš„æ–‡æ¡£å†…å®¹ã€‚</span><br><span class="line">Pé”®ï¼šæ˜¾ç¤ºï¼ˆç›¸å¯¹äºæœ¬èŠ‚ç‚¹çš„ï¼‰å‰ä¸€èŠ‚ç‚¹çš„æ–‡æ¡£å†…å®¹ã€‚</span><br><span class="line">Ué”®ï¼šè¿›å…¥å½“å‰å‘½ä»¤æ‰€åœ¨çš„ä¸»é¢˜ã€‚</span><br><span class="line">Mé”®ï¼šæ•²Mé”®åè¾“å…¥å‘½ä»¤çš„åç§°å°±å¯ä»¥æŸ¥çœ‹è¯¥å‘½ä»¤çš„å¸®åŠ©æ–‡æ¡£äº†ã€‚</span><br><span class="line">Gé”®ï¼šæ•²Gé”®åè¾“å…¥ä¸»é¢˜åç§°ï¼Œè¿›å…¥è¯¥ä¸»é¢˜ã€‚</span><br><span class="line">Lé”®ï¼šå›åˆ°ä¸Šä¸€ä¸ªè®¿é—®çš„é¡µé¢ã€‚ SPACEé”®ï¼šå‘å‰æ»šåŠ¨ä¸€é¡µã€‚</span><br><span class="line">BACKUPæˆ–DELé”®ï¼šå‘åæ»šåŠ¨ä¸€é¡µã€‚</span><br><span class="line">Qï¼šé€€å‡ºinfoã€‚</span><br><span class="line">å‘½ä»¤</span><br><span class="line">ï¼Ÿ æ˜¾ç¤ºå¸®åŠ©çª—å£</span><br><span class="line">åœ¨å¸®åŠ©çª—å£ä¸­ï¼š</span><br><span class="line">Ctrl-x 0 å…³é—­å¸®åŠ©çª—å£</span><br><span class="line">Ctrl-x Ctrl-c å…³é—­æ•´ä¸ª Info</span><br><span class="line">q é€€å‡º info</span><br><span class="line">n æ‰“å¼€ä¸æœ¬ Node å…³è”çš„ä¸‹ä¸€ä¸ª Node</span><br><span class="line">p æ‰“å¼€ä¸æœ¬ Node å…³è”çš„å‰ä¸€ä¸ª Node</span><br><span class="line">u æ‰“å¼€ä¸æœ¬ Node å…³è”çš„ä¸Šä¸€ä¸ª Node</span><br><span class="line">l å›åˆ°ä¸Šä¸€æ¬¡è®¿é—®çš„ Node</span><br><span class="line">mæˆ–g é€‰æ‹©ä¸€ä¸ªèœå•é¡¹ï¼ˆNode çš„åå­—ï¼‰</span><br><span class="line">           è¾“å…¥æŒ‡å®šèœå•çš„åå­—åæŒ‰å›è½¦ï¼Œæ‰“å¼€æŒ‡å®šèœå•é¡¹å…³è”çš„ Node</span><br><span class="line">ç©ºæ ¼é”® ä¸‹ä¸€é¡µï¼ˆPageDown ä¹Ÿå¯ä»¥ï¼Œä¸‹ä¸€é¡µä»å½“å‰é¡µçš„æœ€åä¸¤è¡Œå¼€å§‹ç®—èµ·ï¼‰</span><br><span class="line">           ä¸‹ä¸€ä¸ª Node ï¼ˆè‹¥å½“å‰é¡µåœ¨ Node æ–‡æ¡£çš„æœ«å°¾ï¼‰</span><br><span class="line">Del é”® ä¸Šä¸€é¡µï¼ˆPageUp ä¹Ÿå¯ä»¥ï¼Œä¸Šä¸€é¡µä»å½“å‰é¡µçš„å¼€å§‹ä¸¤è¡Œå¼€å§‹ç®—èµ·ï¼‰</span><br><span class="line">       ä¸Šä¸€ä¸ª Node ï¼ˆè‹¥å½“å‰é¡µ Node æ–‡æ¡£çš„å¼€å§‹ï¼‰</span><br><span class="line">b æˆ– t æˆ– Home æ–‡æ¡£çš„å¼€å§‹ï¼ˆb æ˜¯ begining çš„æ„æ€ï¼‰</span><br><span class="line">e æˆ– End æ–‡æ¡£çš„æœ«å°¾ï¼ˆb æ˜¯ ending çš„æ„æ€ï¼‰</span><br><span class="line">Ctrl-l åˆ·æ–°å½“å‰é¡µï¼Œè‹¥å½“å‰æ–‡æ¡£æ˜¾ç¤ºæƒ…å†µæœ‰é—®é¢˜æ—¶</span><br><span class="line">Ctrl-g å–æ¶ˆæ‰€é”®å…¥çš„æŒ‡ä»¤</span><br></pre></td></tr></table></figure>

<h2 id="å…³äºæ—¶é—´çš„å‘½ä»¤"><a href="#å…³äºæ—¶é—´çš„å‘½ä»¤" class="headerlink" title="å…³äºæ—¶é—´çš„å‘½ä»¤"></a>å…³äºæ—¶é—´çš„å‘½ä»¤</h2><h3 id="date"><a href="#date" class="headerlink" title="date"></a>date</h3><p>dateå‘½ä»¤æ˜¯æ˜¾ç¤ºæˆ–è®¾ç½®ç³»ç»Ÿæ—¶é—´ä¸æ—¥æœŸã€‚ å¾ˆå¤šshellè„šæœ¬é‡Œé¢éœ€è¦æ‰“å°ä¸åŒæ ¼å¼çš„æ—¶é—´æˆ–æ—¥æœŸï¼Œä»¥åŠè¦æ ¹æ®æ—¶é—´å’Œæ—¥æœŸæ‰§è¡Œæ“ä½œã€‚å»¶æ—¶é€šå¸¸ç”¨äºè„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­æä¾›ä¸€æ®µç­‰å¾…çš„æ—¶é—´ã€‚æ—¥æœŸå¯ä»¥ä»¥å¤šç§æ ¼å¼å»æ‰“å°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è®¾ç½®å›ºå®šçš„æ ¼å¼ã€‚åœ¨ç±»UNIXç³»ç»Ÿä¸­ï¼Œæ—¥æœŸè¢«å­˜å‚¨ä¸ºä¸€ä¸ªæ•´æ•°ï¼Œå…¶å¤§å°ä¸ºè‡ªä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼ˆUTCï¼‰1970å¹´1æœˆ1æ—¥0æ—¶0åˆ†0ç§’èµ·æµé€çš„ç§’æ•°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯­æ³•</span><br><span class="line">date(é€‰é¡¹)(å‚æ•°)</span><br><span class="line">é€‰é¡¹</span><br><span class="line">-d&lt;å­—ç¬¦ä¸²&gt;ï¼šæ˜¾ç¤ºå­—ç¬¦ä¸²æ‰€æŒ‡çš„æ—¥æœŸä¸æ—¶é—´ã€‚å­—ç¬¦ä¸²å‰åå¿…é¡»åŠ ä¸ŠåŒå¼•å·ï¼›</span><br><span class="line">-s&lt;å­—ç¬¦ä¸²&gt;ï¼šæ ¹æ®å­—ç¬¦ä¸²æ¥è®¾ç½®æ—¥æœŸä¸æ—¶é—´ã€‚å­—ç¬¦ä¸²å‰åå¿…é¡»åŠ ä¸ŠåŒå¼•å·ï¼›</span><br><span class="line"> -uï¼šæ˜¾ç¤ºGMTï¼›</span><br><span class="line">--helpï¼šåœ¨çº¿å¸®åŠ©ï¼›</span><br><span class="line">--versionï¼šæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚</span><br><span class="line">å‚æ•°</span><br><span class="line">&lt;+æ—¶é—´æ—¥æœŸæ ¼å¼&gt;ï¼šæŒ‡å®šæ˜¾ç¤ºæ—¶ä½¿ç”¨çš„æ—¥æœŸæ—¶é—´æ ¼å¼ã€‚</span><br></pre></td></tr></table></figure>

<p>æ—¥æœŸæ ¼å¼å­—ç¬¦ä¸²åˆ—è¡¨<br>| æ ¼å¼    | è¯´æ˜                              |<br>| :â€”- | :â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |<br>| %H    | å°æ—¶ï¼Œ24å°æ—¶åˆ¶ï¼ˆ00<del>23ï¼‰                 |<br>| %I    | å°æ—¶ï¼Œ12å°æ—¶åˆ¶ï¼ˆ01</del>12ï¼‰                 |<br>| %k    | å°æ—¶ï¼Œ24å°æ—¶åˆ¶ï¼ˆ0<del>23ï¼‰                  |<br>| %l    | å°æ—¶ï¼Œ12å°æ—¶åˆ¶ï¼ˆ1</del>12ï¼‰                  |<br>| %M    | åˆ†é’Ÿï¼ˆ00<del>59ï¼‰                       |<br>| %p    | æ˜¾ç¤ºå‡ºAMæˆ–PM                        |<br>| %r    | æ˜¾ç¤ºæ—¶é—´ï¼Œ12å°æ—¶åˆ¶ï¼ˆhh:mm:ss %pï¼‰         |<br>| %s    | ä»1970å¹´1æœˆ1æ—¥00:00:00åˆ°ç›®å‰ç»å†çš„ç§’æ•°      |<br>| %S    | æ˜¾ç¤ºç§’ï¼ˆ00</del>59ï¼‰                      |<br>| %T    | æ˜¾ç¤ºæ—¶é—´ï¼Œ24å°æ—¶åˆ¶ï¼ˆhh:mm:ssï¼‰            |<br>| %X    | æ˜¾ç¤ºæ—¶é—´çš„æ ¼å¼ï¼ˆ%H:%M:%Sï¼‰               |<br>| %Z    | æ˜¾ç¤ºæ—¶åŒºï¼Œæ—¥æœŸåŸŸï¼ˆCSTï¼‰                   |<br>| %a    | æ˜ŸæœŸçš„ç®€ç§°ï¼ˆSun<del>Satï¼‰                  |<br>| %A    | æ˜ŸæœŸçš„å…¨ç§°ï¼ˆSunday</del>Saturdayï¼‰          |<br>| %h,%b | æœˆçš„ç®€ç§°ï¼ˆJan<del>Decï¼‰                   |<br>| %B    | æœˆçš„å…¨ç§°ï¼ˆJanuary</del>Decemberï¼‰          |<br>| %c    | æ—¥æœŸå’Œæ—¶é—´ï¼ˆTue Nov 20 14:12:58 2012ï¼‰ |<br>| %d    | ä¸€ä¸ªæœˆçš„ç¬¬å‡ å¤©ï¼ˆ01<del>31ï¼‰                  |<br>| %x,%D | æ—¥æœŸï¼ˆmm/dd/yyï¼‰                    |<br>| %j    | ä¸€å¹´çš„ç¬¬å‡ å¤©ï¼ˆ001</del>366ï¼‰                 |<br>| %m    | æœˆä»½ï¼ˆ01<del>12ï¼‰                       |<br>| %w    | ä¸€ä¸ªæ˜ŸæœŸçš„ç¬¬å‡ å¤©ï¼ˆ0ä»£è¡¨æ˜ŸæœŸå¤©ï¼‰                |<br>| %W    | ä¸€å¹´çš„ç¬¬å‡ ä¸ªæ˜ŸæœŸï¼ˆ00</del>53ï¼Œæ˜ŸæœŸä¸€ä¸ºç¬¬ä¸€å¤©ï¼‰         |<br>| %y    | å¹´çš„æœ€åä¸¤ä¸ªæ•°å­—ï¼ˆ1999åˆ™æ˜¯99ï¼‰              |<br>| %Y    | å¹´1999                           |</p>
<h4 id="date-å®éªŒ"><a href="#date-å®éªŒ" class="headerlink" title="date å®éªŒ"></a>date å®éªŒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">æ ¼å¼åŒ–è¾“å‡º</span><br><span class="line">[booboo@rhel7 ~]$ date +"%y/%m/%d"</span><br><span class="line">16/06/16</span><br><span class="line">[booboo@rhel7 ~]$ date +"%Y/%m/%d"</span><br><span class="line">2016/06/16</span><br><span class="line">è¾“å‡ºæ˜¨å¤©æˆ–åå¤©çš„æ—¥æœŸ</span><br><span class="line">[booboo@rhel7 ~]$ date -d "1 day ago" +"%Y-%m-%d"</span><br><span class="line">2016-06-15</span><br><span class="line">[booboo@rhel7 ~]$ date -d "-1 day" +%Y%m%d</span><br><span class="line">20160615</span><br><span class="line">[booboo@rhel7 ~]$ date -d "+1 day" +%Y%m%d</span><br><span class="line">20160617</span><br><span class="line">è¾“å‡º50ç§’åçš„æ—¶é—´</span><br><span class="line">[booboo@rhel7 ~]$ date -d "50 second" +"%Y-%m-%d %H:%M:%S"</span><br><span class="line">2016-06-16 02:52:41</span><br><span class="line">ä¼ è¯´ä¸­çš„1234567890ç§’</span><br><span class="line">[booboo@rhel7 ~]$ date -d "1970-01-01 1234567890 seconds" +"%Y-%m-%d %H:%M:%S"</span><br><span class="line">2009-02-13 23:31:30</span><br><span class="line">2009å¹´2æœˆ13æ—¥æ˜ŸæœŸäº”ï¼Œåè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼‰æ™šä¸Š11:31:30ï¼ŒUNIXæ—¶é—´å°†æŠµè¾¾1234567890ç§’ã€‚</span><br><span class="line">UNIXæ—¶é—´æ˜¯UNIXæˆ–ç±»UNIXç³»ç»Ÿä½¿ç”¨çš„æ—¶é—´è¡¨ç¤ºæ–¹å¼ï¼šä»åè°ƒä¸–ç•Œæ—¶1970å¹´1æœˆ1æ—¥0æ—¶0åˆ†0ç§’èµ·è‡³ç°åœ¨çš„æ€»ç§’æ•°ï¼Œä¸åŒ…æ‹¬é—°ç§’ã€‚ç”±äºå¤§éƒ¨åˆ†UNIXçš„ç³»ç»Ÿéƒ½æ˜¯32ä½ï¼Œå› æ­¤åˆ°2038å¹´æ—¶é—´è®¡æ•°å°±å¯èƒ½æº¢å‡ºï¼Œè§£å†³æ–¹æ³•æ˜¯æ›´æ¢ä¸º64ä½æ¨¡å¼ã€‚Linuxå†…æ ¸å¼€å‘è€…Alan Coxè¡¨ç¤ºï¼ŒLinuxç°åœ¨éƒ½è¿è¡Œ64ä½æ—¶é—´æ¨¡å¼ï¼Œå®ƒå¯ä»¥è®°å½•åˆ°2900äº¿å¹´åï¼Œå› æ­¤å³ä½¿å¤ªé˜³ç‡ƒæ–™ç”¨å°½ä¹Ÿä¸ä¼šå‡ºé—®é¢˜ã€‚</span><br><span class="line">æ™®é€šæ ¼å¼è½¬åŒ–</span><br><span class="line">[booboo@rhel7 ~]$ date -d "2016-06-16" +"%Y/%m/%d %H:%M:%S"</span><br><span class="line">2016/06/16 00:00:00</span><br><span class="line">è®¾å®šæ—¶é—´éœ€è¦rootç”¨æˆ·æƒé™ï¼Œæ­¤å¤„ç”¨boobooç”¨æˆ·æ¨¡æ‹Ÿï¼Œæ²¡æœ‰çœŸçš„ä¿®æ”¹æ—¶é—´</span><br><span class="line">[booboo@rhel7 ~]$ date</span><br><span class="line">Thu Jun 16 03:01:19 EDT 2016</span><br><span class="line">[booboo@rhel7 ~]$ date -s "02:03:08 2018-05-09"</span><br><span class="line">date: cannot set date: Operation not permitted</span><br><span class="line">Wed May  9 02:03:08 EDT 2018</span><br><span class="line">[booboo@rhel7 ~]$ date -s "02:03:08 20180509"</span><br><span class="line">date: cannot set date: Operation not permitted</span><br><span class="line">Wed May  9 02:03:08 EDT 2018</span><br><span class="line">[booboo@rhel7 ~]$ date -s "20180509 15:02:02"</span><br><span class="line">date: cannot set date: Operation not permitted</span><br><span class="line">Wed May  9 15:02:02 EDT 2018</span><br><span class="line">[booboo@rhel7 ~]$ date -s "2018-05-09 15:02:02"</span><br><span class="line">date: cannot set date: Operation not permitted</span><br><span class="line">Wed May  9 15:02:02 EDT 2018</span><br><span class="line">[booboo@rhel7 ~]$ date -s "2019/05/09 15:02:02"</span><br><span class="line">date: cannot set date: Operation not permitted</span><br><span class="line">Thu May  9 15:02:02 EDT 2019</span><br></pre></td></tr></table></figure>

<h4 id="date-æ‹“å±•å®éªŒ"><a href="#date-æ‹“å±•å®éªŒ" class="headerlink" title="date æ‹“å±•å®éªŒ"></a>date æ‹“å±•å®éªŒ</h4><p>1) æœ‰æ—¶éœ€è¦æ£€æŸ¥ä¸€ç»„å‘½ä»¤èŠ±è´¹çš„æ—¶é—´ æ¯”å¦‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pingæ‰§è¡Œçš„æ—¶é—´</span><br><span class="line">[root@rhel7 ~]# vi a.sh</span><br><span class="line">[root@rhel7 ~]# cat a.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">start=$(date +%s)</span><br><span class="line">ping -c 10 172.25.0.11 &amp;&gt; /dev/null</span><br><span class="line">end=$(date +%s)</span><br><span class="line">difference=$(( $end - $start ))</span><br><span class="line">echo $difference seconds.</span><br><span class="line">[root@rhel7 ~]# bash a.sh</span><br><span class="line">9 seconds.</span><br><span class="line">sqlè„šæœ¬è¿è¡Œçš„æ˜¯æ—¶é—´</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">start=$(date +%s)</span><br><span class="line"><span class="meta">$</span><span class="bash">mysql&lt; mysql.all.sql &amp;&gt; /dev/null</span></span><br><span class="line">end=$(date +%s)</span><br><span class="line">difference=$(( $end - $start ))</span><br><span class="line">echo $difference seconds.</span><br></pre></td></tr></table></figure>

<p>2) åˆ›å»ºä»¥å½“å‰æ—¶é—´ä¸ºæ–‡ä»¶åçš„ç›®å½•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# mkdir `date +%Y%m%d`</span><br><span class="line">[root@rhel7 ~]# ls</span><br><span class="line">20160616</span><br></pre></td></tr></table></figure>

<p>3ï¼‰å¤‡ä»½ä»¥æ—¶é—´åšä¸ºæ–‡ä»¶åçš„</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# tar -cvf `date +%Y%m%d`.tar ./`date +%Y%m%d`</span><br><span class="line">./20160616/</span><br><span class="line">[root@rhel7 ~]# ls</span><br><span class="line">20160616         Documents                         Pictures</span><br><span class="line">20160616.tar</span><br></pre></td></tr></table></figure>

<p>4ï¼‰ç¼–å†™shellè„šæœ¬è®¡ç®—ç¦»è‡ªå·±ç”Ÿæ—¥è¿˜æœ‰å¤šå°‘å¤©ï¼Ÿ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# cat bb.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">read -p "Input your birthday(YYYYmmdd):" date1</span><br><span class="line">m=`date -d "$date1" +%m`    #å¾—åˆ°ç”Ÿæ—¥çš„æœˆ</span><br><span class="line">d=`date -d "$date1" +%d`    #å¾—åˆ°ç”Ÿæ—¥çš„æ—¥</span><br><span class="line">date_now=`date +%s`             #å¾—åˆ°å½“å‰æ—¶é—´çš„ç§’å€¼</span><br><span class="line">y=`date +%Y`                    #å¾—åˆ°å½“å‰æ—¶é—´çš„å¹´</span><br><span class="line">birth=`date -d "$y$m$d" +%s`      #å¾—åˆ°ä»Šå¹´çš„ç”Ÿæ—¥æ—¥æœŸçš„ç§’å€¼</span><br><span class="line">internal=$(($birth-$date_now))        #è®¡ç®—ä»Šæ—¥åˆ°ç”Ÿæ—¥æ—¥æœŸçš„é—´éš”æ—¶é—´</span><br><span class="line">if [ "$internal" -lt "0" ]; then             #åˆ¤æ–­ä»Šå¤©çš„ç”Ÿæ—¥æ˜¯å¦å·²è¿‡</span><br><span class="line">       	birth=`date --date="$(($y+1))$m$d" +%s`      #å¾—åˆ°æ˜å¹´çš„ç”Ÿæ—¥æ—¥æœŸç§’å€¼</span><br><span class="line">       	internal=$(($birth-$date_now))               #è®¡ç®—ä»Šå¤©åˆ°ä¸‹ä¸€ä¸ªç”Ÿæ—¥çš„é—´éš”æ—¶é—´</span><br><span class="line">fi</span><br><span class="line">        echo "There is :$(($internal/60/60/24)) days."       #è¾“å‡ºç»“æœï¼Œç§’æ¢ç®—ä¸ºå¤©</span><br><span class="line">Input your birthday(YYYYmmdd):19960506</span><br><span class="line">There is :323 days.</span><br><span class="line">[root@rhel7 ~]# bash bb.sh</span><br><span class="line">Input your birthday(YYYYmmdd):19960902</span><br><span class="line">There is :77 days.</span><br></pre></td></tr></table></figure>

<h3 id="hwclock"><a href="#hwclock" class="headerlink" title="hwclock"></a>hwclock</h3><p>hwclockå‘½ä»¤æ˜¯ä¸€ä¸ªç¡¬ä»¶æ—¶é’Ÿè®¿é—®å·¥å…·ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå½“å‰æ—¶é—´ã€è®¾ç½®ç¡¬ä»¶æ—¶é’Ÿçš„æ—¶é—´å’Œè®¾ç½®ç¡¬ä»¶æ—¶é’Ÿä¸ºç³»ç»Ÿæ—¶é—´ï¼Œä¹Ÿå¯è®¾ç½®ç³»ç»Ÿæ—¶é—´ä¸ºç¡¬ä»¶æ—¶é’Ÿçš„æ—¶é—´ã€‚ åœ¨Linuxä¸­æœ‰ç¡¬ä»¶æ—¶é’Ÿä¸ç³»ç»Ÿæ—¶é’Ÿç­‰ä¸¤ç§æ—¶é’Ÿã€‚ç¡¬ä»¶æ—¶é’Ÿæ˜¯æŒ‡ä¸»æœºæ¿ä¸Šçš„æ—¶é’Ÿè®¾å¤‡ï¼Œä¹Ÿå°±æ˜¯é€šå¸¸å¯åœ¨BIOSç”»é¢è®¾å®šçš„æ—¶é’Ÿã€‚ç³»ç»Ÿæ—¶é’Ÿåˆ™æ˜¯æŒ‡kernelä¸­çš„æ—¶é’Ÿã€‚å½“Linuxå¯åŠ¨æ—¶ï¼Œç³»ç»Ÿæ—¶é’Ÿä¼šå»è¯»å–ç¡¬ä»¶æ—¶é’Ÿçš„è®¾å®šï¼Œä¹‹åç³»ç»Ÿæ—¶é’Ÿå³ç‹¬ç«‹è¿ä½œã€‚æ‰€æœ‰Linuxç›¸å…³æŒ‡ä»¤ä¸å‡½æ•°éƒ½æ˜¯è¯»å–ç³»ç»Ÿæ—¶é’Ÿçš„è®¾å®šã€‚</p>
<p>æŸ¥çœ‹ BIOS æ—¶é—´</p>
<p>ä¿®æ”¹ BIOS æ—¶é—´</p>
<p><code>hwclock --systohc</code> å°†ç¡¬ä»¶æ—¶é—´ä¸ç³»ç»Ÿæ—¶é—´åŒæ­¥,ä»¥ç³»ç»Ÿä¸ºåŸºå‡†</p>
<p><code>hwclock --hctosys</code> å°†ç³»ç»Ÿæ—¶é—´ä¸ç¡¬ä»¶æ—¶é—´åŒæ­¥,ä»¥ç¡¬ä»¶ä¸ºåŸºå‡†</p>
<h3 id="timedatectl"><a href="#timedatectl" class="headerlink" title="timedatectl"></a>timedatectl</h3><p>æ¯” date å¤šäº†æ—¶åŒºçš„åŠŸèƒ½</p>
<p>rhel6ä¿®æ”¹æ—¶åŒº</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[booboo@rhel7 ~]$ tzselect</span><br><span class="line">Please identify a location so that time zone rules can be set correctly.</span><br><span class="line">Please select a continent or ocean.</span><br><span class="line"> 1) Africa</span><br><span class="line"> 2) Americas</span><br><span class="line"> 3) Antarctica</span><br><span class="line"> 4) Arctic Ocean</span><br><span class="line"> 5) Asia</span><br><span class="line"> 6) Atlantic Ocean</span><br><span class="line"> 7) Australia</span><br><span class="line"> 8) Europe</span><br><span class="line"> 9) Indian Ocean</span><br><span class="line">10) Pacific Ocean</span><br><span class="line">11) none - I want to specify the time zone using the Posix TZ format.</span><br><span class="line">\#? 5</span><br><span class="line">Please select a country.</span><br><span class="line"> 1) Afghanistan		  18) Israel		    35) Palestine</span><br><span class="line"> 2) Armenia		  19) Japan		    36) Philippines</span><br><span class="line"> 3) Azerbaijan		  20) Jordan		    37) Qatar</span><br><span class="line"> 4) Bahrain		  21) Kazakhstan	    38) Russia</span><br><span class="line"> 5) Bangladesh		  22) Korea (North)	    39) Saudi Arabia</span><br><span class="line"> 6) Bhutan		  23) Korea (South)	    40) Singapore</span><br><span class="line"> 7) Brunei		  24) Kuwait		    41) Sri Lanka</span><br><span class="line"> 8) Cambodia		  25) Kyrgyzstan	    42) Syria</span><br><span class="line"> 9) China		  26) Laos		    43) Taiwan</span><br><span class="line">10) Cyprus		  27) Lebanon		    44) Tajikistan</span><br><span class="line">11) East Timor		  28) Macau		    45) Thailand</span><br><span class="line">12) Georgia		  29) Malaysia		    46) Turkmenistan</span><br><span class="line">13) Hong Kong		  30) Mongolia		    47) United Arab Emirates</span><br><span class="line">14) India		  31) Myanmar (Burma)	    48) Uzbekistan</span><br><span class="line">15) Indonesia		  32) Nepal		    49) Vietnam</span><br><span class="line">16) Iran		  33) Oman		    50) Yemen</span><br><span class="line">17) Iraq		  34) Pakistan</span><br><span class="line">\#? 9</span><br><span class="line">Please select one of the following time zone regions.</span><br><span class="line">1) east China - Beijing, Guangdong, Shanghai, etc.</span><br><span class="line">2) Heilongjiang (except Mohe), Jilin</span><br><span class="line">3) central China - Sichuan, Yunnan, Guangxi, Shaanxi, Guizhou, etc.</span><br><span class="line">4) most of Tibet &amp; Xinjiang</span><br><span class="line">5) west Tibet &amp; Xinjiang</span><br><span class="line">\#? 1</span><br><span class="line"></span><br><span class="line">The following information has been given:</span><br><span class="line"></span><br><span class="line">	China</span><br><span class="line">	east China - Beijing, Guangdong, Shanghai, etc.</span><br><span class="line"></span><br><span class="line">Therefore TZ='Asia/Shanghai' will be used.</span><br><span class="line">Local time is now:	Thu Jun 16 15:08:57 CST 2016.</span><br><span class="line">Universal Time is now:	Thu Jun 16 07:08:57 UTC 2016.</span><br><span class="line">Is the above information OK?</span><br><span class="line">1) Yes</span><br><span class="line">2) No</span><br><span class="line">\#? 1</span><br><span class="line"></span><br><span class="line">You can make this change permanent for yourself by appending the line</span><br><span class="line">	TZ='Asia/Shanghai'; export TZ</span><br><span class="line">to the file '.profile' in your home directory; then log out and log in again.</span><br><span class="line"></span><br><span class="line">Here is that TZ value again, this time on standard output so that you</span><br><span class="line">can use the /bin/tzselect command in shell scripts:</span><br><span class="line">Asia/Shanghai</span><br></pre></td></tr></table></figure>

<p>rhel7 ç‰ˆæœ¬</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[kiosk@foundation0 Desktop]$ timedatectl</span><br><span class="line">      Local time: Wed 2016-06-15 16:47:40 CST</span><br><span class="line">  Universal time: Wed 2016-06-15 08:47:40 UTC</span><br><span class="line">        RTC time: Wed 2016-06-15 16:47:40</span><br><span class="line">       Time zone: Asia/Shanghai (CST, +0800)</span><br><span class="line">     NTP enabled: yes</span><br><span class="line">NTP synchronized: yes</span><br><span class="line"> RTC in local TZ: yes</span><br><span class="line">      DST active: n/a</span><br></pre></td></tr></table></figure>

<p>å…³é”®è¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">UTC	åè°ƒä¸–ç•Œæ—¶ Coordinated Universal Time</span><br><span class="line">	åˆç§°ä¸–ç•Œç»Ÿä¸€æ—¶é—´ï¼Œä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼Œå›½é™…åè°ƒæ—¶é—´ã€‚1972 å¹´1 æœˆ1æ—¥ï¼ŒUTCï¼ˆåè°ƒä¸–ç•Œæ—¶ï¼‰æˆä¸ºæ–°çš„ä¸–ç•Œæ ‡å‡†æ—¶é—´ã€‚</span><br><span class="line">CST	æ—¶åŒºç¼©å†™</span><br><span class="line">	CSTå¯ä»¥ä¸ºå¦‚ä¸‹4ä¸ªä¸åŒçš„æ—¶åŒºçš„ç¼©å†™ï¼š</span><br><span class="line">ã€€ã€€	ç¾å›½ä¸­éƒ¨æ—¶é—´ï¼šCentral Standard Time (USA) UT-6:00</span><br><span class="line">	æ¾³å¤§åˆ©äºšä¸­éƒ¨æ—¶é—´ï¼šCentral Standard Time (Australia) UT+9:30</span><br><span class="line">	ä¸­å›½æ ‡å‡†æ—¶é—´ï¼šChina Standard Time UT+8:00 ä¾‹å¦‚ï¼ŒUTCæ˜¯0ç‚¹ï¼Œé‚£ä¹ˆCSTä¸­å›½ä¸ºæ—©æ™¨8ç‚¹</span><br><span class="line">	å¤å·´æ ‡å‡†æ—¶é—´ï¼šCuba Standard Time UT-4:00</span><br><span class="line">RTC Time</span><br><span class="line">	ç¡¬ä»¶æ—¶é’Ÿæ—¶é—´</span><br><span class="line">	set-local-rtc 1 æœ¬åœ°æ—¶åŒº</span><br><span class="line">	set-local-rtc 0	UTC</span><br><span class="line">DST	Daylight Saving Timeæ—¥å…‰èŠ‚çº¦æ—¶é—´ã€å¤ä»¤æ—¶</span><br><span class="line">	æ˜¯ä¸€ç§ä¸ºèŠ‚çº¦èƒ½æºè€Œäººä¸ºè§„å®šåœ°æ–¹æ—¶é—´çš„åˆ¶åº¦ï¼Œåœ¨è¿™ä¸€åˆ¶åº¦å®è¡ŒæœŸé—´æ‰€é‡‡ç”¨çš„ç»Ÿä¸€æ—¶é—´ç§°ä¸ºâ€œå¤ä»¤æ—¶é—´â€ã€‚</span><br><span class="line">	ä¸€èˆ¬åœ¨å¤©äº®æ—©çš„å¤å­£äººä¸ºå°†æ—¶é—´æå‰ä¸€å°æ—¶ï¼Œå¯ä»¥ä½¿äººæ—©èµ·æ—©ç¡ï¼Œå‡å°‘ç…§æ˜é‡ï¼Œä»¥å……åˆ†åˆ©ç”¨å…‰ç…§èµ„æºï¼Œä»è€ŒèŠ‚çº¦ç…§æ˜ç”¨ç”µã€‚</span><br><span class="line">	å„ä¸ªé‡‡çº³å¤æ—¶åˆ¶çš„å›½å®¶å…·ä½“è§„å®šä¸åŒã€‚ç›®å‰å…¨ä¸–ç•Œæœ‰è¿‘110ä¸ªå›½å®¶æ¯å¹´è¦å®è¡Œå¤ä»¤æ—¶ã€‚</span><br><span class="line">	1986å¹´è‡³1991å¹´ï¼Œä¸­å›½åœ¨å…¨å›½èŒƒå›´å®è¡Œäº†å…­å¹´å¤ä»¤æ—¶ï¼Œ1992å¹´4æœˆ5æ—¥åä¸å†å®è¡Œã€‚</span><br></pre></td></tr></table></figure>

<h3 id="cal"><a href="#cal" class="headerlink" title="cal"></a>cal</h3><p>calå‘½ä»¤ç”¨äºæ˜¾ç¤ºå½“å‰æ—¥å†ï¼Œæˆ–è€…æŒ‡å®šæ—¥æœŸçš„æ—¥å†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cal [-smjy13] [[[day] month] year]</span><br><span class="line">-1 æ˜¾ç¤ºå½“æœˆæ—¥å†å¹¶å°†ä»Šæ—¥æ ‡é»‘</span><br><span class="line">-3 æ˜¾ç¤ºä¸Šä¸ªæœˆã€å½“æœˆã€ä¸‹ä¸ªæœˆã€‚</span><br><span class="line">-s å‘¨æ—¥ä½œä¸ºç¬¬ä¸€åˆ—</span><br><span class="line">-m å‘¨ä¸€ä½œä¸ºç¬¬ä¸€åˆ—</span><br><span class="line">-j åˆ—å‡ºä»Šå¤©æ˜¯ä¸€å¹´çš„ç¬¬å‡ å¤©</span><br><span class="line">-y åˆ—å‡ºä»Šå¹´æ‰€æœ‰çš„æœˆ</span><br><span class="line">[root@rhel7 ~]# cal</span><br><span class="line">      June 2016     </span><br><span class="line">Su Mo Tu We Th Fr Sa</span><br><span class="line">          1  2  3  4</span><br><span class="line"> 5  6  7  8  9 10 11</span><br><span class="line">12 13 14 15 16 17 18</span><br><span class="line">19 20 21 22 23 24 25</span><br><span class="line">26 27 28 29 30</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# cal -3</span><br><span class="line">      May 2016              June 2016             July 2016     </span><br><span class="line">Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa</span><br><span class="line"> 1  2  3  4  5  6  7            1  2  3  4                  1  2</span><br><span class="line"> 8  9 10 11 12 13 14   5  6  7  8  9 10 11   3  4  5  6  7  8  9</span><br><span class="line">15 16 17 18 19 20 21  12 13 14 15 16 17 18  10 11 12 13 14 15 16</span><br><span class="line">22 23 24 25 26 27 28  19 20 21 22 23 24 25  17 18 19 20 21 22 23</span><br><span class="line">29 30 31              26 27 28 29 30        24 25 26 27 28 29 30</span><br><span class="line">                                            31                  </span><br><span class="line">[root@rhel7 ~]# cal -j</span><br><span class="line">         June 2016         </span><br><span class="line">Sun Mon Tue Wed Thu Fri Sat</span><br><span class="line">            153 154 155 156</span><br><span class="line">157 158 159 160 161 162 163</span><br><span class="line">164 165 166 167 168 169 170</span><br><span class="line">171 172 173 174 175 176 177</span><br><span class="line">178 179 180 181 182</span><br></pre></td></tr></table></figure>

<h2 id="Linux-åŸºç¡€å‘½ä»¤ä½œä¸š"><a href="#Linux-åŸºç¡€å‘½ä»¤ä½œä¸š" class="headerlink" title="Linux åŸºç¡€å‘½ä»¤ä½œä¸š"></a>Linux åŸºç¡€å‘½ä»¤ä½œä¸š</h2><ol>
<li>åœ¨/tmp ç›®å½•ä¸‹åˆ›å»º testdir ç›®å½•,åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»º file1 åˆ° file30 çš„ 30 ä¸ªæ–‡ä»¶ã€‚</li>
<li>åˆ é™¤æ‰€æœ‰ä»¥ file1 èµ·å§‹çš„æ–‡ä»¶ã€‚</li>
<li>åˆ é™¤ file2 ååŒ¹é…ä¸€ä¸ªå­—ç¬¦çš„æ‰€æœ‰æ–‡ä»¶ã€‚</li>
<li>åœ¨/home/student ç›®å½•ä¸‹é€’å½’åˆ›å»ºä¸€ä¸ª/home/student/a/b/c/d/e ç›® å½•,å¹¶ä¸”å°†è¯¥ a ç›®å½•ä¿ç•™åŸå±æ€§çš„å¤åˆ¶åˆ°/tmp ç›®å½•ä¸‹ã€‚</li>
<li>å°†/tmp ä¸‹çš„ a ç›®å½•é‡å‘½åä¸º test ç›®å½•ã€‚</li>
<li>ç»Ÿè®¡ä¸€ä¸‹/etc/passwd æ–‡ä»¶æ€»å…±æœ‰å‡ è¡Œã€‚</li>
<li>åœ¨/tmp ä¸‹åˆ›å»ºä¸€ä¸ªç›®å½•,ç›®å½•åä¸º study</li>
<li>åœ¨ study ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶, æ–‡ä»¶åä»»æ„, å¹¶å‘è¿™ä¸ªæ–‡ä»¶é‡Œå†™ hello å­—æ®µ</li>
<li>å¾€è¯¥æ–‡ä»¶é‡Œè¿½åŠ  study å­—æ®µã€‚</li>
<li>æŸ¥çœ‹è¯¥æ–‡ä»¶å†…å®¹ã€‚</li>
<li>ç»Ÿè®¡ä¸€ä¸‹è¯¥æ–‡ä»¶å…±æœ‰å‡ è¡Œ,å‡ ä¸ªå•è¯,å‡ ä¸ªå­—èŠ‚ã€‚</li>
<li>å°†/etc/passwd é‡Œä»¥ bash ç»“å°¾çš„è¡Œè¿‡æ»¤å‡ºæ¥,å¹¶ä»ä¸­æˆªå–ç¬¬ä¸€åˆ—å­—<br>æ®µå†…å®¹ã€‚</li>
<li>ç»Ÿè®¡/boot/ä¸‹æ‰€æœ‰æ–‡ä»¶çš„å±æ€§ä¸­å« root å­—æ®µçš„æ–‡ä»¶å…±æœ‰å‡ ä¸ªã€‚</li>
<li>ç†Ÿæ‚‰ä¸€ä¸‹ vim ç¼–è¾‘å™¨,åˆ©ç”¨ vim ç¼–è¾‘å™¨ä¹¦å†™æ•´ç†ä¸€ä¸‹ä»Šå¤©æ‰€å­¦çš„ çŸ¥è¯†ç‚¹ã€‚</li>
<li>åˆ¤æ–­ä¸€ä¸‹ boot ç›®å½•ä¸‹æ–‡ä»¶çš„å†…å®¹ç±»å‹,å¹¶å°†å±äº ASCII ç æ–‡ä»¶å†…å®¹ ç±»å‹çš„æ–‡ä»¶åæ˜¾ç¤ºåˆ°å±å¹•ä¸Š</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç³»ç»ŸåŸºç¡€åŸ¹è®­</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux ç”¨æˆ·å’Œç»„</title>
    <url>/2016/12/22/booboo_linux_base/02-Linux%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84/</url>
    <content><![CDATA[<h2 id="è¯¾å ‚ä½œä¸š"><a href="#è¯¾å ‚ä½œä¸š" class="headerlink" title="è¯¾å ‚ä½œä¸š"></a>è¯¾å ‚ä½œä¸š</h2><ol>
<li>æ·»åŠ 2ä¸ªç»„ï¼Œä¸€ä¸ªç»„åä¸ºjusticeï¼Œå¦å¤–ä¸€ä¸ªç»„åä¸ºninjaã€‚</li>
<li>æ·»åŠ 4ä¸ªæ–°ç”¨æˆ·ï¼Œåˆ†åˆ«ä¸º supermanã€batmanã€wonderwomanã€greenlanternï¼Œå¯†ç å‡ä¸ºuplookingï¼›å…¶é™„åŠ ç»„ä¸ºjusticeã€‚</li>
<li>æ·»åŠ 4ä¸ªæ–°ç”¨æˆ·ï¼Œåˆ†åˆ«ä¸º leoã€raphã€mikeyã€don ï¼Œå¯†ç å‡ä¸ºuplookingï¼Œå…¶é™„åŠ ç»„ä¸ºninjaã€‚</li>
<li>mikeyç”¨æˆ·æ€»æ˜¯åœ¨ç³»ç»Ÿé‡Œæç ´åï¼Œrootå†³å®šå°ä»–çš„å·ï¼Œè®©ä»–ä¸èƒ½ç™»é™†ã€‚è¿‡äº†å‡ å¤©ï¼Œå†è§£å°ã€‚</li>
<li>leoæƒ³åŠ å…¥justiceï¼ŒrootåŒæ„äº†ï¼Œå°†justiceä½œä¸ºé™„åŠ ç»„æ·»åŠ ç»™leoã€‚</li>
<li>donæ•´å¤©æåˆ›é€ ï¼Œrootè¦æ±‚ä»–çš„å¯†ç è¦æ›´å®‰å…¨ï¼Œæ‰€ä»¥å°†ä»–çš„å¯†ç è®¾ç½®æˆ7å¤©ä¹‹åè¦æ¢å¯†ç ï¼Œå¹¶ä¸”å¯†ç è¿‡æœŸå‰3å¤©è¦æé†’ä»–ï¼Œå¦‚æœå¯†ç è¿‡æœŸå2å¤©è¿˜æ²¡æœ‰è®¾ç½®æ–°å¯†ç ï¼Œé‚£ä¹ˆå°±å°é”donè´¦æˆ·ã€‚</li>
<li>batmanæ€»æ˜¯å–œæ¬¢ä¿®æ”¹å¯†ç ï¼Œæ²¡äº‹å°±åœ¨ä¿®æ”¹å¯†ç ï¼Œè€Œä½¿ç”¨è¯¥batmanè´¦æˆ·çš„äººæœ‰å¥½å‡ ä¸ªï¼Œæ¯”å¦‚è™è ä¾ ï¼Œè™è ä¾ çš„ç®¡å®¶ï¼Œè™è ä¾ çš„åŠ©æ‰‹ç½—å®¾ç­‰ç­‰ã€‚æ‰€ä»¥rootå†³å®šå°†batmanè´¦æˆ·çš„å¯†ç çš„æœ€å°å­˜æ´»æœŸæ”¹ä¸º10å¤©ã€‚ä¹Ÿå°±æ˜¯è¯´10å¤©ä¹‹å†…batmanè´¦æˆ·ä¸èƒ½ä¿®æ”¹å¯†ç ã€‚</li>
<li>leoæƒ³é€€å‡ºjustice,rootå¸®ä»–è®¾ç½®ä¸€ä¸‹ã€‚</li>
<li>supermanæƒ³æŠŠå¯†ç æ”¹ä¸ºuplooking123ï¼Œè®©ä»–è‡ªå·±æ”¹ã€‚å‘ç°æ”¹ä¸äº†ï¼Œå¯†ç å¤ªç®€å•äº†ï¼Œè‡ªå·±å»æƒ³ä¸€ä¸ªå¤æ‚çš„å¯†ç ã€‚</li>
<li>è®©supermanèƒ½å¤Ÿä¿®æ”¹rootç”¨æˆ·çš„å¯†ç ã€‚</li>
</ol>
<h2 id="ç”¨æˆ·å’Œç»„çš„ç›¸å…³æ–‡ä»¶"><a href="#ç”¨æˆ·å’Œç»„çš„ç›¸å…³æ–‡ä»¶" class="headerlink" title="ç”¨æˆ·å’Œç»„çš„ç›¸å…³æ–‡ä»¶"></a>ç”¨æˆ·å’Œç»„çš„ç›¸å…³æ–‡ä»¶</h2><table>
<thead>
<tr>
<th align="left">æ–‡ä»¶å</th>
<th align="left">ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">/etc/passwd</td>
<td align="left">ç³»ç»Ÿä¸­çš„è´¦å·ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">etc/shadow</td>
<td align="left">å­˜æ”¾å¯†ç åŠå…¶ç­–ç•¥ç›¸å…³ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">/etc/group</td>
<td align="left">å­˜æ”¾ç”¨æˆ·ç»„çš„ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">/etc/gshadow</td>
<td align="left">å­˜æ”¾ç”¨æˆ·ç»„çš„å¯†ç åŠå…¶ç­–ç•¥ç›¸å…³ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">/etc/default/useradd</td>
<td align="left">åˆ›å»ºæ–°ç”¨æˆ·æ—¶é»˜è®¤çš„é…ç½®ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">/etc/skel/*</td>
<td align="left">Directory containing default files.</td>
</tr>
<tr>
<td align="left">/etc/login.defs</td>
<td align="left">ç”¨æˆ·å’Œç»„é»˜è®¤çš„é…ç½®ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">/etc/shells</td>
<td align="left">è¯¥æ–‡ä»¶è®°å½•ç€åˆæ³•çš„ shell ç‰ˆæœ¬</td>
</tr>
</tbody></table>
<h3 id="etc-passwd"><a href="#etc-passwd" class="headerlink" title="/etc/passwd"></a>/etc/passwd</h3><p>æ¯ä¸€è¡Œéƒ½ä»£è¡¨ä¸€ä¸ªè´¦å· , æœ‰å‡ è¡Œå°±ä»£è¡¨æœ‰å‡ ä¸ªè´¦å·åœ¨ä½ çš„ç³»ç»Ÿä¸­</p>
<p>ç³»ç»Ÿç»Ÿè´¦å·: bin, daemon, adm, nobody</p>
<p>ä»¥â€œï¼šâ€ä½œä¸ºåˆ†éš”ç¬¦,ä¸ƒä¸ªå­—æ®µ</p>
<p><code>root:x:0:0:root:/root:/bin/bash</code> </p>
<ol>
<li><p>è´¦å·åç§° :root</p>
</li>
<li><p>å¯†ç  :X</p>
</li>
<li><p>UID: ä½¿ç”¨è€…æ ‡è¯†ç¬¦<br>rhel6 root_uid=0 sys_uid=1-499 user_uid=500-65535 ( 2^32-1 )<br>rhel7 root_uid=0 sys_uid=201-999 user_uid=1000-65535</p>
</li>
<li><p>GID: ç”¨æˆ·ç»„æ ‡è¯†ç¬¦ root_guid=0</p>
</li>
<li><p>ç”¨æˆ·ä¿¡æ¯è¯´æ˜æ  </p>
</li>
<li><p>å®¶ç›®å½• : ç”¨æˆ·çš„å®¶ç›®å½• root çš„å®¶ç›®å½•åœ¨ /root, é»˜è®¤ç”¨æˆ·çš„å®¶ç›®å½•åœ¨ /home/yourname</p>
</li>
<li><p>Shell: å‘½ä»¤è§£é‡Šå™¨</p>
<ul>
<li>ç³»ç»Ÿé»˜è®¤ä¸º /bin/bash</li>
</ul>
</li>
</ol>
<ul>
<li>/sbin/nologin ä¸å¯é€šè¿‡ç»ˆç«¯ç™»å½•ç³»ç»Ÿ</li>
</ul>
<h3 id="etc-shadow"><a href="#etc-shadow" class="headerlink" title="/etc/shadow"></a>/etc/shadow</h3><p>å­˜æ”¾å¯†ç åŠå…¶ç­–ç•¥ç›¸å…³ä¿¡æ¯</p>
<p>ä»¥â€œï¼šâ€ä½œä¸ºåˆ†éš”ç¬¦ä¹ä¸ªå­—æ®µ</p>
<p><code>root:$1$/30QpE5e$y9N/D0bh6rAACBEz.hqo00:14126:0:99999:7:::</code></p>
<ol>
<li>è´¦å·åç§° :root</li>
<li>å¯†ç  : åŠ å¯†åçš„å­—ç¬¦ä¸²ï¼Œä»¥$N$ å¼€å¤´</li>
<li>æœ€è¿‘å˜æ›´å¯†ç çš„æ—¥æœŸ : å¤©æ•°,ä»¥ 1970 å¹´ 1 æœˆ 1 æ—¥ä½œä¸º 1 è€Œç´¯åŠ çš„æ—¥æœŸ<br>echo $(($(date â€“date=â€2008/09/04â€ +%s)/86400+1))<br>14126</li>
<li>å¯†ç ä¸å¯è¢«æ›´æ”¹çš„å¤©æ•° :0 : è¡¨ç¤ºå¯†ç éšæ—¶å¯ä»¥æ›´æ”¹ï¼Œ 20 :è¡¨ç¤º è·æœ€è¿‘ä¸€æ¬¡ä¿®æ”¹å¯†ç 20 å¤©ä¹‹å†…éƒ½ä¸èƒ½ä¿®æ”¹å¯†ç </li>
<li>å¯†ç éœ€è¦é‡æ–°å˜æ›´çš„å¤©æ•° :99999 ( è®¡ç®—ä¸º 273 å¹´ ) è¡¨ç¤ºå¯†ç çš„å˜æ›´æ²¡æœ‰å¼ºåˆ¶æ€§ã€‚</li>
<li>å¯†ç éœ€è¦å˜æ›´æœŸé™å‰çš„è­¦å‘Šå¤©æ•° : åœ¨å¯†ç åˆ°æœŸä¹‹å‰å‡ å¤©æé†’</li>
<li>å¯†ç è¿‡æœŸåçš„è´¦å·å®½é™æ—¶é—´ ( å¯†ç å¤±æ•ˆæ—¥ ): å¯†ç è¿‡æœŸç‰¹æ€§ã€‚</li>
<li>è´¦å·å¤±æ•ˆæ—¥æœŸ : å¤©æ•°ï¼Œä»¥ 1970 å¹´ 1 æœˆ 1 æ—¥ä½œä¸º 1 è€Œç´¯åŠ çš„æ—¥æœŸ</li>
<li>ä¿ç•™ : ä¿ç•™æ®µ</li>
</ol>
<h3 id="etc-group"><a href="#etc-group" class="headerlink" title="/etc/group"></a>/etc/group</h3><p>å­˜æ”¾ç”¨æˆ·ç»„çš„ä¿¡æ¯</p>
<p>æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªç¾¤ç»„ä»¥â€œï¼šâ€ä½œä¸ºåˆ†éš”ç¬¦å››ä¸ªå­—æ®µ</p>
<p><code>root:x:0:root</code></p>
<ol>
<li>ç»„å :root</li>
<li>ç¾¤ç»„å¯†ç  :x ä¸€èˆ¬ä¸è®¾å®š,é€šå¸¸æ˜¯ç»™ã€ç¾¤ç»„ç®¡ç†å‘˜ã€ä½¿ç”¨</li>
<li>GID: ç¾¤ç»„çš„ ID</li>
<li>æ­¤ç¾¤ç»„æ”¯æŒçš„è´¦å·åç§° : ä¸€ä¸ªè´¦å·å¯ä»¥åŠ å…¥å¤šä¸ªç¾¤ç»„</li>
</ol>
<p>ä¾‹å¦‚,å°† dabao åŠ å…¥ root ç¾¤ç»„å :</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root:x:0:root,dmtsai</span><br></pre></td></tr></table></figure>

<h3 id="etc-gshadow"><a href="#etc-gshadow" class="headerlink" title="/etc/gshadow"></a>/etc/gshadow</h3><p>å­˜æ”¾ç”¨æˆ·ç»„çš„å¯†ç åŠå…¶ç­–ç•¥ç›¸å…³ä¿¡æ¯</p>
<p>æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªç¾¤ç»„ â€œ: â€ ä½œä¸ºåˆ†éš”ç¬¦å››ä¸ªå­—æ®µ</p>
<p><code>newgroup:!::redhat</code></p>
<ol>
<li>ç»„å :newgroup</li>
<li>å¯†ç æ  : å¼€å¤´ä¸º ! è¡¨ç¤ºæ— åˆæ³•å¯†ç  , æ‰€ä»¥æ— ç¾¤ç»„ç®¡ç†å‘˜</li>
<li>ç¾¤ç»„ç®¡ç†å‘˜çš„è´¦å·</li>
<li>æ­¤ç¾¤ç»„æ”¯æŒçš„è´¦å·åç§° : ä¸ /etc/group ç›¸åŒ</li>
</ol>
<h3 id="etc-default-useradd"><a href="#etc-default-useradd" class="headerlink" title="/etc/default/useradd"></a>/etc/default/useradd</h3><p>åˆ›å»ºæ–°ç”¨æˆ·æ—¶é»˜è®¤çš„é…ç½®ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GROUP=100 &lt;== é¢„è®¾çš„ç¾¤ç»„ï¼Œç°å·²ä¸ç”Ÿæ•ˆï¼Œå¦‚æœåˆ›å»ºç”¨æˆ·æ—¶ä¸æŒ‡å®šç¾¤ç»„ï¼Œåˆ™ä½¿ç”¨ä¸ç”¨æˆ·åŒåçš„ç¾¤ç»„</span><br><span class="line">HOME=/home &lt;== é»˜è®¤çš„å®¶ç›®å½•æ‰€åœ¨ç›®å½•</span><br><span class="line">INACTIVE=-1 &lt;== å¯†ç å¤±æ•ˆæ—¥ , åœ¨ shadow ç¬¬ 7 æ </span><br><span class="line">EXPIRE= &lt;== è´¦å·å¤±æ•ˆæ—¥ , åœ¨ shadow ç¬¬ 8 æ </span><br><span class="line">SHELL=/bin/bash &lt;== é¢„è®¾çš„ shell /sbin/nologin å°†æ— æ³•ç™»é™†</span><br><span class="line">SKEL=/etc/skel&lt;== ç”¨æˆ·å®¶ç›®å½•çš„å†…å®¹æ•°æ®å‚è€ƒç›®å½•</span><br><span class="line">CREATE_MAIL_SPOOL=yes &lt;== æ˜¯å¦ä¸»åŠ¨å¸®åŠ©ä½¿ç”¨è€…å»ºç«‹é‚®ä»¶ä¿¡ç®± (mailbox)</span><br></pre></td></tr></table></figure>


<h3 id="etc-skel"><a href="#etc-skel" class="headerlink" title="/etc/skel/"></a>/etc/skel/</h3><p>Directory containing default files.</p>
<p>.bash_logout .bash_profile .bashrc .gnome2 .mozilla</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 skel]# ll -a /etc/skel</span><br><span class="line">total 40</span><br><span class="line">drwxr-xr-x. 4 root root 4096 Jan 2 01:58 .</span><br><span class="line">drwxr-xr-x. 125 root root 12288 Mar 21 03:09 ..</span><br><span class="line">-rw-r--r--. 1 root root 18 Jul 9 2013 .bash_logout</span><br><span class="line">-rw-r--r--. 1 root root 176 Jul 9 2013 .bash_profile</span><br><span class="line">-rw-r--r--. 1 root root 124 Jul 9 2013 .bashrc</span><br><span class="line">-rw-r--r--. 1 root root 500 May 7 2013 .emacs</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Jul 14 2010 .gnome2</span><br><span class="line">drwxr-xr-x. 4 root root 4096 Jan 2 01:52 .mozilla</span><br></pre></td></tr></table></figure>

<h3 id="etc-login-defs"><a href="#etc-login-defs" class="headerlink" title="/etc/login.defs"></a>/etc/login.defs</h3><p>é»˜è®¤çš„é…ç½®ä¿¡æ¯ rhel6 ä¸‹çš„ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MAIL_DIR           /var/spool/mail ç”¨æˆ·é»˜è®¤é‚®ä»¶ä¿¡ç®±æ”¾ç½®ç›®å½•</span><br><span class="line">PASS_MAX_DAYS      99999 /etc/shadow ç¬¬ 5 æ  , å¯†ç éœ€è¦é‡æ–°å˜æ›´çš„å¤©æ•°</span><br><span class="line">PASS_MIN_DAYS      0 /etc/shadow ç¬¬ 4 æ  , å¯†ç ä¸å¯è¢«æ›´åŠ¨çš„å¤©æ•°</span><br><span class="line">PASS_MIN_LEN       5 å¯†ç æœ€çŸ­çš„å­—ç¬¦é•¿åº¦ , å·²è¢« pam æ¨¡å—å–ä»£ , å¤±å»æ•ˆç”¨ !</span><br><span class="line">PASS_WARN_AGE      7 /etc/shadow ç¬¬ 6 æ  , è¿‡æœŸå‰ä¼šè­¦å‘Šå¤©æ•°</span><br><span class="line">UID_MIN            500 ä½¿ç”¨è€…æœ€å°çš„ UID ä¸èƒ½ &lt;500</span><br><span class="line">UID_MAX            60000  ä½¿ç”¨è€…æœ€å¤§çš„ UID ä¸èƒ½ &gt;60000</span><br><span class="line">GID_MIN            500  è‡ªå®šä¹‰ç»„æœ€å°çš„ UID ä¸èƒ½ &lt;500</span><br><span class="line">GID_MAX            60000  è‡ªå®šä¹‰ç»„æœ€å¤§çš„ UID ä¸èƒ½ &gt;60000</span><br><span class="line">CREATE_HOME     yes  åœ¨ username å‘½ä»¤ä¸åŠ  -M åŠ -m æ—¶ , æ˜¯å¦ä¸»åŠ¨å»ºç«‹ç”¨æˆ·å®¶ç›®å½•</span><br><span class="line">UMASK        077  ç”¨æˆ·å®¶ç›®å½•å»ºç«‹çš„ umask , å› æ­¤æƒé™ä¼šæ˜¯ 700 ã€ drwx------ ã€</span><br><span class="line">USERGROUPS_ENAB  yes  ä½¿ç”¨ userdel æ—¶ , æ˜¯å¦ä¼šåˆ é™¤åˆå§‹ç¾¤ç»„(å¦‚æœä½¿ç”¨ userdel å»åˆ é™¤ä¸€ä¸ªè´¦å·æ—¶ , è¯¥è´¦å·æ‰€å±çš„åˆå§‹ç¾¤ç»„å·²ç»æ²¡æœ‰äººéš¶å±äºè¯¥ç¾¤ç»„äº† , é‚£ä¸¾å°±åˆ æ‰è¯¥ç¾¤ç»„)</span><br><span class="line">ENCRYPT_METHOD    SHA512  ç»è¿‡ SHA512 è¿›è¡ŒåŠ å¯†å¤„ç†</span><br></pre></td></tr></table></figure>

<h3 id="etc-shells"><a href="#etc-shells" class="headerlink" title="/etc/shells"></a>/etc/shells</h3><p>è¯¥æ–‡ä»¶è®°å½•ç€åˆæ³•çš„ shell ç‰ˆæœ¬</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 skel]# cat /etc/shells</span><br><span class="line">/bin/sh</span><br><span class="line">/bin/bash</span><br><span class="line">/sbin/nologin</span><br><span class="line">/bin/dash</span><br><span class="line">/bin/tcsh</span><br><span class="line">/bin/csh</span><br></pre></td></tr></table></figure>

<h2 id="ç”¨æˆ·å’Œç»„çš„ç›¸å…³å‘½ä»¤"><a href="#ç”¨æˆ·å’Œç»„çš„ç›¸å…³å‘½ä»¤" class="headerlink" title="ç”¨æˆ·å’Œç»„çš„ç›¸å…³å‘½ä»¤"></a>ç”¨æˆ·å’Œç»„çš„ç›¸å…³å‘½ä»¤</h2><table>
<thead>
<tr>
<th align="left">ç”¨æˆ·å’Œç»„</th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ–°å»ºç»„</td>
<td align="left">groupadd</td>
</tr>
<tr>
<td align="left">æ–°å»ºç”¨æˆ·</td>
<td align="left">useradd</td>
</tr>
<tr>
<td align="left">ä¿®æ”¹å¯†ç </td>
<td align="left">passwd å¯†ç  &gt;8 ä½å­—ç¬¦ã€å°å†™ / å¤§å†™ / æ•°å­— / ç‰¹æ®Šç¬¦å·ä¹‹é—´ä»»é€‰ 3 ä½</td>
</tr>
<tr>
<td align="left">ä¿®æ”¹ç”¨æˆ·å±æ€§</td>
<td align="left">usermod</td>
</tr>
<tr>
<td align="left">ä¿®æ”¹ç»„å±æ€§</td>
<td align="left">groupmod</td>
</tr>
<tr>
<td align="left">ä¿®æ”¹å¯†ç å±æ€§</td>
<td align="left">chage</td>
</tr>
<tr>
<td align="left">ä¿®æ”¹ shell</td>
<td align="left">chsh</td>
</tr>
<tr>
<td align="left">åˆ é™¤ç”¨æˆ·</td>
<td align="left">userdel</td>
</tr>
<tr>
<td align="left">åˆ é™¤ç»„</td>
<td align="left">groupdel</td>
</tr>
<tr>
<td align="left">æŸ¥çœ‹å·²å­˜åœ¨ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯</td>
<td align="left">id</td>
</tr>
<tr>
<td align="left">æŸ¥çœ‹å½“å‰ç”¨æˆ·æ”¯æŒçš„ç¾¤ç»„ä¿¡æ¯</td>
<td align="left">groups</td>
</tr>
</tbody></table>
<p>é€šè¿‡æ–‡ä»¶æŸ¥çœ‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/etc/passwd</span><br><span class="line">/etc/shadow</span><br><span class="line">/etc/group</span><br><span class="line">/etc/gshadow</span><br></pre></td></tr></table></figure>

<h3 id="æ–°å»ºç”¨æˆ·å’Œç»„"><a href="#æ–°å»ºç”¨æˆ·å’Œç»„" class="headerlink" title="æ–°å»ºç”¨æˆ·å’Œç»„"></a>æ–°å»ºç”¨æˆ·å’Œç»„</h3><h4 id="groupadd"><a href="#groupadd" class="headerlink" title="groupadd"></a>groupadd</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">groupadd åˆ›å»ºç»„</span><br><span class="line">-g, --gid GID</span><br><span class="line">-r, --system  Create a system group</span><br><span class="line"></span><br><span class="line"> æ–°å»ºç»„ test åˆ¶å®š gid ä¸º 888</span><br><span class="line">[root@rhel7 ~]# groupadd -g 888 test</span><br><span class="line"> æ–°å»ºä¸€ä¸ªç³»ç»Ÿç»„ baby</span><br><span class="line">[root@rhel7 ~]# groupadd -r baby</span><br><span class="line"> æŸ¥çœ‹ä¸€ä¸‹åˆšåˆšæ–°å»ºçš„ç»„çš„ä¿¡æ¯</span><br><span class="line">[root@rhel7 ~]# tail -n 2 /etc/group</span><br><span class="line">test:x:888:</span><br><span class="line">baby:x:490:</span><br></pre></td></tr></table></figure>

<h4 id="useradd"><a href="#useradd" class="headerlink" title="useradd"></a>useradd</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºæ–°ç”¨æˆ·</span><br><span class="line">useradd [-u UID] [-g åˆå§‹ç¾¤ç»„ ] [-G æ¬¡è¦ç¾¤ç»„ ] [-mM] [-c è¯´æ˜æ  ] [-d å®¶ç›®å½•ç»å¯¹è·¯å¾„ ] [-s shell] è´¦å·å</span><br><span class="line">æ‹“å±•: -e : æ¥æ—¥æœŸã€ YYYY-MM-DD ã€ shadow ç¬¬å…«å­—æ®µè´¦å·å¤±æ•ˆæ—¥æœŸ</span><br><span class="line"> 	-f : æ¥å¤©æ•° shadow ç¬¬ä¸ƒå­—æ®µå¯†ç å¤±æ•ˆæ—¥ 0 :ç«‹åˆ»å¤±æ•ˆ -1 :æ°¸ä¸å¤±æ•ˆ</span><br><span class="line">		å¤±æ•ˆåå¯ç™»é™†,ä½†æ˜¯ä¼šå¼ºåˆ¶ä½ é‡æ–°è®¾ç½®å¯†ç </span><br><span class="line">[root@rhel7 ~]# useradd -u 888 -g 888 -f 0 -e 2016-03-21 t1</span><br><span class="line">[root@rhel7 ~]# id t1</span><br><span class="line">uid=888(t1) gid=888(test) groups=888(test)</span><br><span class="line">[root@rhel7 ~]# tail -n 1 /etc/passwd</span><br><span class="line">t1:x:888:888::/home/t1:/bin/bash</span><br><span class="line">[root@rhel7 ~]# tail -n 1 /etc/shadow</span><br><span class="line">t1:!!:16880:0:99999:7:0:16881:</span><br></pre></td></tr></table></figure>

<h4 id="passwd"><a href="#passwd" class="headerlink" title="passwd"></a>passwd</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç»™ç”¨æˆ·è®¾ç½®å¯†ç </span><br><span class="line">passwd [--sdtin] &lt;&#x3D;&#x3D; æ‰€æœ‰äººå‡å¯ä½¿ç”¨æ›´æ”¹è‡ªå·±çš„å¯†ç </span><br><span class="line">passwd [-l] [-u] [--sdtin] [-S] [-n æ—¥æ•° ] [-x æ—¥æ•° ] [-w æ—¥æ•° ] [-i æ—¥æœŸ ] è´¦å· &lt;&#x3D;&#x3D;root åŠŸèƒ½</span><br><span class="line">é€‰é¡¹ä¸å‚æ•° :</span><br><span class="line">--stdin : å¯ä»¥é€è¿‡æ¥è‡ªå‰ä¸€ä¸ªç®¡çº¿çš„æ•°æ® , ä½œä¸ºå¯†ç è¾“å…¥ echo 123 | passwd --stdin dabao</span><br><span class="line">-l : æ˜¯ Lock çš„ç¼©å†™ , ä¼šå°† &#x2F;etc&#x2F;shadow ç¬¬äºŒæ æœ€å‰é¢åŠ ä¸Š ! ä½¿å¯†ç å¤±æ•ˆ</span><br><span class="line">-u : ä¸ -l ç›¸å¯¹ , æ˜¯ Unlock çš„ç¼©å†™</span><br><span class="line">-S : åˆ—å‡ºå¯†ç ç›¸å…³å‚æ•° shadow å¤§éƒ¨åˆ†ä¿¡æ¯ã€‚</span><br><span class="line">-n : åé¢æ¥å¤©æ•° ,shadow ç¬¬ 4 å­—æ®µ , å¯†ç ä¸å¯è¢«æ›´åŠ¨çš„å¤©æ•°</span><br><span class="line">-x : åé¢æ¥å¤©æ•° ,shadow ç¬¬ 5 å­—æ®µ , å¯†ç éœ€è¦é‡æ–°å˜æ›´çš„å¤©æ•°</span><br><span class="line">-w : åé¢æ¥å¤©æ•° ,shadow ç¬¬ 6 å­—æ®µ , å¯†ç éœ€è¦å˜æ›´æœŸé™å‰çš„è­¦å‘Šå¤©æ•°</span><br><span class="line">-i : åé¢æ¥å¤©æ•° ,shadow ç¬¬ 7 å­—æ®µ , å¯†ç å¤±æ•ˆæ—¥æœŸ</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# passwd t1</span><br><span class="line">Changing password for user t1.</span><br><span class="line">New password:</span><br><span class="line">BAD PASSWORD: it is based on a dictionary word</span><br><span class="line">Retype new password:</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line"></span><br><span class="line"> è®¾ç½®å¯†ç å¤±æ•ˆæ—¥æœŸä¸º 7 å¤©</span><br><span class="line">[root@rhel7 ~]# passwd -i 7 t1</span><br><span class="line">Adjusting aging data for user t1.</span><br><span class="line">passwd: Success</span><br><span class="line"></span><br><span class="line"> æŸ¥çœ‹è®°å½•ç”¨æˆ·å¯†ç å±æ€§çš„æ–‡ä»¶ /etc/shadow ,æˆªå– t1 ç”¨æˆ·çš„é‚£ä¸€è¡Œ</span><br><span class="line">[root@rhel7 ~]# sed -n '/t1/p' /etc/shadow</span><br><span class="line">t1:$6$TDnycU/C$0AmM5AoZmoHZQMex.dQCoroH2JxdSnDhLnBMorcUPlWgshYrlstZJmH.Q.fT</span><br><span class="line">OTV.pECGEuqFqugj8YccRqcdD/:16880:0:99999:7:7:16881:</span><br><span class="line"></span><br><span class="line"> æˆªå– t1 ç”¨æˆ·å¯†ç å±æ€§,ä»¥ : ä¸ºåˆ†å‰²çš„ç¬¬ 7 å­—æ®µ</span><br><span class="line">[root@rhel7 ~]# sed -n '/t1/p' /etc/shadow|cut -d":" -f 7</span><br><span class="line">7</span><br><span class="line">[root@rhel7 ~]# sed -n '/t1/p' /etc/shadow|awk -F: '&#123;print 7&#125;'</span><br><span class="line">7</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹ç”¨æˆ·å’Œç»„å±æ€§"><a href="#ä¿®æ”¹ç”¨æˆ·å’Œç»„å±æ€§" class="headerlink" title="ä¿®æ”¹ç”¨æˆ·å’Œç»„å±æ€§"></a>ä¿®æ”¹ç”¨æˆ·å’Œç»„å±æ€§</h3><h4 id="groupmod"><a href="#groupmod" class="headerlink" title="groupmod"></a>groupmod</h4><p>ä¿®æ”¹ç»„å±æ€§</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">groupmod -g gid [gname] ä¿®æ”¹ gid</span><br><span class="line">groupmod -n new_gname [gname] ä¿®æ”¹ç»„çš„åå­—</span><br><span class="line">[root@rhel7 ~]# groupmod -g 999 test</span><br><span class="line">[root@rhel7 ~]# grep test /etc/group</span><br><span class="line">test:x:999:</span><br><span class="line">[root@rhel7 ~]# groupmod -n test1 test</span><br><span class="line">[root@rhel7 ~]# grep test /etc/group</span><br><span class="line">test1:x:999:</span><br></pre></td></tr></table></figure>

<h4 id="usermod"><a href="#usermod" class="headerlink" title="usermod"></a>usermod</h4><p>ä¿®æ”¹ç”¨æˆ·å±æ€§</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">usermod [-cdegGlsuLU] username</span><br><span class="line">é€‰é¡¹ä¸å‚æ•° :</span><br><span class="line">-c : åé¢æ¥è´¦å·çš„è¯´æ˜ ä¿®æ”¹ &#x2F;etc&#x2F;passwd ç¬¬ 5 å­—æ®µ</span><br><span class="line">-d : åé¢æ¥è´¦å·çš„å®¶ç›®å½• ä¿®æ”¹ &#x2F;etc&#x2F;passwd ç¬¬ 6 å­—æ®µ</span><br><span class="line">-e : åé¢æ¥æ—¥æœŸ , æ ¼å¼æ˜¯ YYYY-MM-DD ä¿®æ”¹ shadow ç¬¬ 8 å­—æ®µ ( è´¦å·å¤±æ•ˆæ—¥ )</span><br><span class="line">-f : åé¢æ¥å¤©æ•° ä¿®æ”¹ shadow ç¬¬ 7 å­—æ®µ ( å¯†ç å¤±æ•ˆæ—¥æœŸ )</span><br><span class="line">-g : åé¢æ¥åˆå§‹ç¾¤ç»„ ä¿®æ”¹ &#x2F;etc&#x2F;passwd ç¬¬ 4 å­—æ®µ GID</span><br><span class="line">-G : åé¢æ¥æ¬¡è¦ç¾¤ç»„ , ä¿®æ”¹è¿™ä¸ªä½¿ç”¨è€…èƒ½å¤Ÿæ”¯æŒçš„ç¾¤ç»„ ä¿®æ”¹ &#x2F;etc&#x2F;group</span><br><span class="line">-aG : ã€å¢åŠ æ¬¡è¦ç¾¤ç»„çš„æ”¯æŒã€è€Œéã€è®¾å®šã€</span><br><span class="line">-l : åé¢æ¥è´¦å·åç§° ä¿®æ”¹è´¦å·åç§° ä¿®æ”¹ &#x2F;etc&#x2F;passwd ç¬¬ 1 å­—æ®µ</span><br><span class="line">-s : åé¢æ¥ Shell çš„å®é™…æ¡£æ¡ˆ , ä¾‹å¦‚ &#x2F;bin&#x2F;bash &#x2F;bin&#x2F;csh ç­‰ç­‰</span><br><span class="line">-u : åé¢æ¥ UID æ•°å­—å•¦ ! å² &#x2F;etc&#x2F;passwd ç¬¬ä¸‰æ çš„èµ„æ–™ ;</span><br><span class="line">-L : æš‚æ—¶å°†ç”¨æˆ·çš„å¯†ç å†»ç»“ , è®©ä»–æ— æ³•ç™»å…¥ã€‚ä¿®æ”¹ &#x2F;etc&#x2F;shadow å¯†ç æ </span><br><span class="line">-U : å°† &#x2F;etc&#x2F;shadow å¯†ç æ çš„ ! æ‹¿æ‰ , è§£å†»</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# usermod -g test2 -G test3 t1</span><br><span class="line">[root@rhel7 ~]# id t1</span><br><span class="line">uid=888(t1) gid=1000(test2) groups=1000(test2),1001(test3)</span><br><span class="line">[root@rhel7 ~]# usermod -s /sbin/nologin t1</span><br><span class="line">[root@rhel7 ~]# grep t1 /etc/passwd</span><br><span class="line">t1:x:888:1000::/home/t1:/sbin/nologin</span><br><span class="line">[root@rhel7 ~]# su - t1</span><br><span class="line">This account is currently not available.</span><br></pre></td></tr></table></figure>

<h4 id="chage"><a href="#chage" class="headerlink" title="chage"></a>chage</h4><p>ä¿®æ”¹ç”¨æˆ·å¯†ç å±æ€§</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chage [-ldEImMW] è´¦å·å</span><br><span class="line">é€‰é¡¹ä¸å‚æ•° :</span><br><span class="line">-l : åˆ—å‡ºè¯¥è´¦å·çš„è¯¦ç»†å¯†ç å‚æ•° ;</span><br><span class="line">-d : åé¢æ¥æ—¥æœŸ , ä¿®æ”¹ shadow ç¬¬ 3 å­—æ®µ ( æœ€è¿‘ä¸€æ¬¡æ›´æ”¹å¯†ç çš„æ—¥æœŸ ), æ ¼å¼ YYYY-MM-DD</span><br><span class="line">-m : åé¢æ¥å¤©æ•° , ä¿®æ”¹ shadow ç¬¬ 4 å­—æ®µ ( å¯†ç ä¸å¯è¢«æ›´åŠ¨çš„å¤©æ•° )</span><br><span class="line">-M : åé¢æ¥å¤©æ•° , ä¿®æ”¹ shadow ç¬¬ 5 å­—æ®µ ( å¯†ç éœ€è¦é‡æ–°å˜æ›´çš„å¤©æ•° )</span><br><span class="line">-W : åé¢æ¥å¤©æ•° , ä¿®æ”¹ shadow ç¬¬ 6 å­—æ®µ ( å¯†ç éœ€è¦å˜æ›´æœŸé™å‰çš„è­¦å‘Šå¤©æ•° )</span><br><span class="line">-I : åé¢æ¥å¤©æ•° , ä¿®æ”¹ shadow ç¬¬ 7 å­—æ®µ ( å¯†ç å¤±æ•ˆæ—¥æœŸ )</span><br><span class="line">-E : åé¢æ¥æ—¥æœŸ , ä¿®æ”¹ shadow ç¬¬ 8 å­—æ®µ ( è´¦å·å¤±æ•ˆæ—¥ ), æ ¼å¼ YYYY-MM-DD</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# chage t1</span><br><span class="line">Changing the aging information for t1</span><br><span class="line">Enter the new value, or press ENTER for the default</span><br><span class="line">Minimum Password Age [0]:</span><br><span class="line">Maximum Password Age [99999]:</span><br><span class="line">Last Password Change (YYYY-MM-DD) [2016-03-20]:</span><br><span class="line">Password Expiration Warning [7]:</span><br><span class="line">Password Inactive [7]:</span><br><span class="line">Account Expiration Date (YYYY-MM-DD) [2016-03-21]:</span><br></pre></td></tr></table></figure>

<h4 id="chsh"><a href="#chsh" class="headerlink" title="chsh"></a>chsh</h4><p>change shell çš„ç®€å†™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chsh [-ls]</span><br><span class="line">é€‰é¡¹ä¸å‚æ•° :</span><br><span class="line">-l : åˆ—å‡ºç›®å‰ç³»ç»Ÿä¸Šé¢å¯ç”¨çš„ shell /etc/shells é‡Œå†…å®¹</span><br><span class="line">-s : ä¿®æ”¹è‡ªå·±çš„ Shell</span><br><span class="line">[root@rhel7 ~]# chsh -s /bin/bash t1</span><br><span class="line">Changing shell for t1.</span><br><span class="line">Shell changed.</span><br><span class="line">[root@rhel7 ~]# grep t1 /etc/passwd</span><br><span class="line">t1:x:888:1000::/home/t1:/bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤ç”¨æˆ·å’Œç»„"><a href="#åˆ é™¤ç”¨æˆ·å’Œç»„" class="headerlink" title="åˆ é™¤ç”¨æˆ·å’Œç»„"></a>åˆ é™¤ç”¨æˆ·å’Œç»„</h3><h4 id="groupdel"><a href="#groupdel" class="headerlink" title="groupdel"></a>groupdel</h4><p>åˆ é™¤ç»„</p>
<p>groupdel groupname</p>
<h4 id="userdel"><a href="#userdel" class="headerlink" title="userdel"></a>userdel</h4><p>åˆ é™¤ç”¨æˆ·</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">userdel [-r] username</span><br><span class="line">é€‰é¡¹ä¸å‚æ•° :</span><br><span class="line">-r æ²¡æœ‰è¿™ä¸ªé€‰é¡¹åˆ é™¤ä¼šä¸å½»åº•,å…³äºç”¨æˆ·çš„ç›®å½•ã€æ–‡æ¡£å…¨éƒ¨åˆ é™¤</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# tail -3 /etc/group</span><br><span class="line">test:x:999:</span><br><span class="line">test2:x:1000:</span><br><span class="line">test3:x:1001:t1</span><br><span class="line">[root@rhel7 ~]# groupdel test3</span><br><span class="line">[root@rhel7 ~]# tail -3 /etc/group</span><br><span class="line">baby:x:490:</span><br><span class="line">test:x:999:</span><br><span class="line">test2:x:1000:</span><br><span class="line">[root@rhel7 ~]# userdel -r t1</span><br><span class="line">[root@rhel7 ~]# ll /home</span><br><span class="line">total 12</span><br><span class="line">drwx------. 27 cong cong 4096 Jan 1 18:40 cong</span><br><span class="line">drwx------. 4 g2</span><br><span class="line">888 4096 Mar 21 03:56 g2</span><br><span class="line">drwx------. 12 tom tom 4096 Mar 21 02:14 tom</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹ç”¨æˆ·å’Œç»„ä¿¡æ¯"><a href="#æŸ¥çœ‹ç”¨æˆ·å’Œç»„ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ç”¨æˆ·å’Œç»„ä¿¡æ¯"></a>æŸ¥çœ‹ç”¨æˆ·å’Œç»„ä¿¡æ¯</h3><h4 id="id"><a href="#id" class="headerlink" title="id"></a>id</h4><p>æŸ¥çœ‹å·²å­˜åœ¨ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# id root</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">[root@rhel7 ~]# id -g root</span><br><span class="line">0</span><br><span class="line">[root@rhel7 ~]# id -u root</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h4 id="groups"><a href="#groups" class="headerlink" title="groups"></a>groups</h4><p>æŸ¥çœ‹å½“å‰ç”¨æˆ·æ”¯æŒçš„ç¾¤ç»„ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# groups</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<p>æ€è€ƒé¢˜: root å’Œæ™®é€šç”¨æˆ·éƒ½å¯ä»¥ä¿®æ”¹ /etc/passwd æ–‡æ¡£,é‚£ä¹ˆè¿™ä¸ªæ–‡æ¡£çš„æƒé™æ˜¯ä»€ä¹ˆå‘¢?<br>SUID</p>
<h2 id="ç”¨æˆ·èº«ä»½åˆ‡æ¢-sudo-su"><a href="#ç”¨æˆ·èº«ä»½åˆ‡æ¢-sudo-su" class="headerlink" title="ç”¨æˆ·èº«ä»½åˆ‡æ¢ sudo / su"></a>ç”¨æˆ·èº«ä»½åˆ‡æ¢ sudo / su</h2><h3 id="su"><a href="#su" class="headerlink" title="su"></a>su</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">su [-lm] [-c æŒ‡ä»¤ ] [username]</span><br><span class="line">é€‰é¡¹ä¸å‚æ•° :</span><br><span class="line">- : å•çº¯ä½¿ç”¨ - å¦‚ã€ su - ã€ ä»¥ login-shell å˜é‡æ¡£æ¡ˆè¯»å–æ–¹å¼ç™»å…¥ç³»ç»Ÿ ; é»˜è®¤åˆ‡æ¢ä¸º root</span><br><span class="line">-l : ä¸ - ç±»ä¼¼ login-shell</span><br><span class="line">-m :-m ä¸ -p ä¸€æ · , è¡¨ç¤ºã€ä½¿ç”¨ç›®å‰çš„ç¯å¢ƒè®¾å®š , è€Œä¸è¯»å–æ–°ä½¿ç”¨è€…çš„é…ç½®æ–‡ä»¶ã€</span><br><span class="line">-c : æ¥æŒ‡ä»¤</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“:</p>
<ol>
<li>su - username æˆ– su -l username<br>å®Œæ•´åˆ‡æ¢æˆæ–°ä½¿ç”¨è€…çš„ç¯å¢ƒ ç”¨ env æŸ¥çœ‹ç¯å¢ƒå˜é‡<br>PATH/USER/MAIL</li>
<li>su - -c â€œ æŒ‡ä»¤ â€œ<br>ä»…æƒ³è¦æ‰§è¡Œä¸€æ¬¡ root çš„æŒ‡ä»¤</li>
<li>ä½¿ç”¨ root åˆ‡æ¢æˆä¸ºä»»ä½•ä½¿ç”¨è€…æ—¶ , ä¸éœ€è¦è¾“å…¥æ–°ç”¨æˆ·å¯†ç </li>
<li>ç¼ºç‚¹:å½“ä¸»æœºå¤šäººç®¡ç†æ—¶, su åˆ‡æ¢æˆ root ,é‚£æ¯ä¸ªäººéƒ½éœ€è¦çŸ¥é“ root å¯†ç ,ä¸å®‰å…¨ã€‚</li>
</ol>
<h3 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h3><p>sudo [-u user name | #uid] [command]</p>
<h4 id="sudo-æ‰§è¡Œæµç¨‹"><a href="#sudo-æ‰§è¡Œæµç¨‹" class="headerlink" title="sudo æ‰§è¡Œæµç¨‹"></a>sudo æ‰§è¡Œæµç¨‹</h4><ol>
<li>åœ¨ /etc/sudoers æ¡£æ¡ˆä¸­æŸ¥çœ‹ user æ˜¯å¦æœ‰ sudo æ‰§è¡Œæƒé™</li>
<li>è‹¥æœ‰ sudo æ‰§è¡Œæƒé™ , ã€è¾“å…¥ç”¨æˆ·çš„å¯†ç ã€</li>
<li>å¯†ç æ­£ç¡® , å¼€å§‹æ‰§è¡Œ sudo åç»­æ¥çš„æŒ‡ä»¤</li>
<li>root æ— éœ€å¯†ç ,è‡ªå·±åˆ‡æ¢è‡ªå·±ä¹Ÿæ— éœ€å¯†ç </li>
</ol>
<h4 id="æ·»åŠ ç”¨æˆ·-sudo-æ‰§è¡Œæƒé™çš„æ–¹æ³•"><a href="#æ·»åŠ ç”¨æˆ·-sudo-æ‰§è¡Œæƒé™çš„æ–¹æ³•" class="headerlink" title="æ·»åŠ ç”¨æˆ· sudo æ‰§è¡Œæƒé™çš„æ–¹æ³•"></a>æ·»åŠ ç”¨æˆ· sudo æ‰§è¡Œæƒé™çš„æ–¹æ³•</h4><p>(å¦‚ä½•è®©ç”¨æˆ·å¯ä»¥ä½¿ç”¨ sudo ?)</p>
<ol>
<li>visudo å¯ä»¥è®©ç³»ç»Ÿæ£€éªŒ /etc/sudoers çš„è¯­æ³•æ˜¯å¦æ­£ç¡®</li>
<li>ä¿®æ”¹ /etc/sudoers ä¸­çš„è¯­æ³•</li>
</ol>
<p>1 )å•ä¸€ç”¨æˆ·å¯ä½¿ç”¨ root æ‰€æœ‰æŒ‡ä»¤æˆ–æŸäº›æŒ‡ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root 		ALL=(ALL) 	ALL &lt;== æ‰¾åˆ°è¿™ä¸€è¡Œ ,rh6 åœ¨ 98 è¡Œ</span><br><span class="line">username 	ALL=(ALL) 	ALL &lt;== æ–°å¢è¿™ä¸€è¡Œ</span><br><span class="line">username 	ALL=(root) 	/bin/touch&lt;== æ–°å¢è¿™ä¸€è¡Œ</span><br></pre></td></tr></table></figure>

<p>è¯­æ³•è§£é‡Š:</p>
<p>ä½¿ç”¨è€…è´¦å· ç™»å…¥è€…çš„æ¥æºä¸»æœºå =( å¯åˆ‡æ¢çš„èº«ä»½ )     å¯ä¸‹è¾¾çš„æŒ‡ä»¤</p>
<p>root             ALL=(ALL)                 ALL &lt;== è¿™æ˜¯é»˜è®¤å€¼</p>
<ol>
<li>ä½¿ç”¨è€…å¸å·:ç³»ç»Ÿå“ªä¸ªå¸å·å¯ä»¥ä½¿ç”¨ sudo</li>
<li>ç™»å…¥è€…çš„æ¥æºä¸»æœºå:ä¿¡ä»»ç”¨æˆ· é»˜è®¤ root å¯æ¥è‡ªä»»ä½•ä¸€éƒ¨ç½‘ç»œä¸»æœº</li>
<li>å¯åˆ‡æ¢çš„èº«ä»½:è¯¥è´¦å·å¯ä»¥åˆ‡æ¢æˆè°æ¥ä¸‹å‘½ä»¤ , æœ«æ—¥ root å¯ä»¥åˆ‡æ¢æˆä»»ä½•äºº</li>
<li>å¯ä¸‹è¾¾çš„æŒ‡ä»¤:å¯ç”¨è¯¥èº«ä»½ä¸‹è¾¾ä»€ä¹ˆæŒ‡ä»¤ã€‚å¿…éœ€ä½¿ç”¨ç»å¯¹è·¯å¾„ ( å¯é€šè¿‡ which\whereis æŸ¥è¯¢ )</li>
<li>ALL : æ˜¯ç‰¹æ®Šå…³é”®è¯ , ä»£è¡¨ä»»ä½•èº«ä»½ã€ä»»ä½•ä¸»æœºã€ä»»ä½•å‘½ä»¤</li>
</ol>
<p>2 )ç¾¤ç»„å’Œå…å¯†ç çš„åŠŸèƒ½å¤„ç†</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash">wheel ALL=(ALL) ALL&lt;== æ‰¾åˆ°è¿™ä¸€è¡Œ ,rh6 åœ¨ 105 è¡Œ</span></span><br><span class="line"><span class="meta">%</span><span class="bash">wheel ALL=(ALL) NOPASSWD: ALL&lt;== æ‰¾åˆ°è¿™ä¸€è¡Œ ,rh6 åœ¨ 108 è¡Œ</span></span><br></pre></td></tr></table></figure>

<p>è¯­æ³•è§£é‡Š:</p>
<ol>
<li>% æ¥ç¾¤ç»„</li>
<li>wheel ç¾¤ç»„å†…çš„ç”¨æˆ·æœ‰ä½¿ç”¨ sudo çš„æƒé™,å¹¶å¯ä»¥åˆ‡æ¢æˆä»»ä½•äºº,æ‰§è¡Œåˆ‡æ¢åèº«ä»½çš„ä»»ä½•å‘½ä»¤</li>
<li>wheel ç¾¤ç»„å†…çš„ç”¨æˆ·åˆ‡æ¢ç”¨æˆ·æ—¶ä¸éœ€è¦è¾“å…¥è‡ªå·±çš„å¯†ç </li>
</ol>
<p>3ï¼‰æœ‰é™çš„æƒé™æ“ä½œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dabao ALL=(root) /usr/bin/passwd &lt;== æœ‰ bug , dabao èƒ½ä¿®æ”¹ root å¯†ç </span><br><span class="line">dabao ALL=(root) !/usr/bin/passwd, /usr/bin/passwd [A-Za-z]*,!/usr/bin/passwd root&lt;== å¯ä»¥æ‰§</span><br><span class="line">è¡Œã€ passwd ä»»æ„å­—ç¬¦ã€ , ä½†æ˜¯ã€ passwd ã€å’Œã€ passwd root ã€è¿™ä¸¤ä¸ªå‘½ä»¤ä¸å¯æ‰§è¡Œ</span><br></pre></td></tr></table></figure>

<p>4 )åˆ«åè®¾ç½® visudo</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">User_Alias DABAO=dabao,jerry,tom,g1,g2,g3</span><br><span class="line">Cmnd_Alias DABAOCOM = !/usr/bin/passwd,/usr/bin/passwd [A-Za-z]*,!/usr/bin/passwd root</span><br><span class="line">DABAO ALL=(root) DABAOCOM</span><br></pre></td></tr></table></figure>

<p>5) sudo æ­é… su ä½¿ç”¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">username ALL=(root) /bin/su -</span><br><span class="line">sudo su - &lt;==sudo -u root su -l root</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ç›´æ¥åˆ‡æ¢æˆ root ç”¨æˆ·,è€Œä¸”ä¸éœ€è¦è¾“å…¥ root å¯†ç </p>
<p>6 ) 5 åˆ†é’Ÿå†…å¯ä»¥ä¸ç”¨å†è¾“å…¥å¯†ç ã€‚</p>
<h2 id="Linuxç”¨æˆ·å’Œç»„è¯¾åä½œä¸š"><a href="#Linuxç”¨æˆ·å’Œç»„è¯¾åä½œä¸š" class="headerlink" title="Linuxç”¨æˆ·å’Œç»„è¯¾åä½œä¸š"></a>Linuxç”¨æˆ·å’Œç»„è¯¾åä½œä¸š</h2><ol>
<li>æ–°å»ºä¸€ä¸ªç”¨æˆ·åä¸º redhatã€‚å¯†ç ä¸º password ï¼Œé…ç½®ä»¥ä¸‹ä¿¡æ¯,ä»¥è¾¾åˆ°è¦æ±‚:</li>
</ol>
<ul>
<li>å¯†ç çš„æœ€å°å­˜æ´»æœŸä¸º:1 å¤©</li>
<li>å¯†ç çš„æœ€å¤§å­˜æ´»æœŸä¸º:10 å¤©</li>
<li>å¯†ç è¿‡æœŸå‰ 5 å¤©æé†’</li>
<li>å¯†ç è¿‡æœŸåå¦‚ 15 å¤©ä»æœªè®¾ç½®æ–°å¯†ç ,åˆ™å°é”è¯¥å¸æˆ·ã€‚</li>
</ul>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæ–°ç»„ newgroupã€å°† redhat ä»¥é™„åŠ ç»„æˆå‘˜çš„èº«ä»½åŠ å…¥ åˆ° newgroup ä¸­ã€‚</li>
<li>æ·»åŠ  3 ä¸ªç”¨æˆ·,ç”¨æˆ· harry,natasha,tom,å’Œä¸€ä¸ªç»„ ,ç»„åä¸º admin ç»„ ï¼Œ<br>è¦æ±‚ ï¼š</li>
</ol>
<ul>
<li>harry,natasha ç”¨æˆ·çš„é™„åŠ ç»„ä¸º admin ç»„ï¼›</li>
<li>tom ç”¨æˆ·çš„ç™»é™† shell ä¸ºéäº¤äº’å¼ shellï¼›</li>
<li>ç”¨æˆ·å¯†ç éƒ½ä¸º uplooking</li>
</ul>
<ol>
<li>ä½¿ç”¨ harry ç”¨æˆ·ç™»é™†ç³»ç»Ÿ,å°è¯•ä¿®æ”¹è‡ªå·±çš„å¯†ç ,å¯†ç è‡ªå·±è®¾ å®šã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªå«åš alex ç”¨æˆ·,ç”¨æˆ· uid ä¸º 1234,ä¸èƒ½ç™»é™†ç³»ç»Ÿã€‚</li>
<li>ä»¥ root ç”¨æˆ·èº«ä»½ç»™ natasha ç”¨æˆ·ä¿®æ”¹å¯†ç ,å¯†ç ä¿®æ”¹ä¸º abc12345ã€‚</li>
<li>ç»™ tom ç”¨æˆ·è¿½åŠ é™„åŠ ç»„,è¿½åŠ çš„é™„åŠ ç»„ä¸º alex,åŒæ—¶ç»™ tom ç”¨æˆ·ä¿®æ”¹ uid,ä¿®æ”¹ä¸º 2222ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç³»ç»ŸåŸºç¡€åŸ¹è®­</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux æ–‡ä»¶å’Œç›®å½•</title>
    <url>/2016/12/22/booboo_linux_base/03-Linux%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95/</url>
    <content><![CDATA[<h2 id="Linux-ç›®å½•"><a href="#Linux-ç›®å½•" class="headerlink" title="Linux ç›®å½•"></a>Linux ç›®å½•</h2><h3 id="Linux-ç›®å½•é…ç½®çš„ä¾æ®-â€“FHS"><a href="#Linux-ç›®å½•é…ç½®çš„ä¾æ®-â€“FHS" class="headerlink" title="Linux ç›®å½•é…ç½®çš„ä¾æ® â€“FHS"></a>Linux ç›®å½•é…ç½®çš„ä¾æ® â€“FHS</h3><p>å› ä¸ºåˆ©ç”¨ Linux æ¥å¼€å‘äº§å“æˆ– distributions çš„ç¤¾åŒº / å…¬å¸æˆ–ä¸ªäººå®åœ¨å¤ªå¤šäº† , å¦‚æœæ¯ä¸ªäººéƒ½ç”¨è‡ªå·±çš„æƒ³æ³•æ¥é…ç½®æ–‡ä»¶æ”¾ç½®çš„ç›®å½• , é‚£å°†å¯èƒ½é€ æˆå¾ˆå¤šç®¡ç†ä¸Šçš„å›°æ‰°ã€‚ ä½ èƒ½æƒ³è±¡ , ä½ è¿›å…¥ä¸€ä¸ªä¼ä¸šä¹‹å , æ‰€ æ¥è§¦åˆ°çš„ Linux ç›®å½•é…ç½®æ–¹æ³•ç«Ÿç„¶è·Ÿä½ ä»¥å‰å­¦çš„å®Œå…¨ä¸åŒå— ? å¾ˆéš¾æƒ³è±¡å§ ~ æ‰€ä»¥ , åæ¥å°±æœ‰æ‰€è°“çš„Filesystem Hierarchy Standard (FHS) æ ‡å‡†çš„å‡ºç‚‰äº† !</p>
<p>æ ¹æ® FHS(<a href="http://www.pathname.com/fhs/" target="_blank" rel="noopener">http://www.pathname.com/fhs/</a>) çš„å®˜æ–¹æ–‡ä»¶æŒ‡å‡º , ä»–ä»¬çš„ä¸»è¦ç›®çš„æ˜¯å¸Œæœ›è®©ä½¿ç”¨è€…å¯ä»¥äº†è§£åˆ°å·²å®‰è£…è½¯ä»¶é€šå¸¸æ”¾ç½®åœ¨å“ªä¸ªç›®å½•ä¸‹ , æ‰€ä»¥ä»–ä»¬å¸Œæœ›ç‹¬ç«‹çš„è½¯ä»¶å¼€å‘å•†ã€æ“ä½œç³»ç»Ÿåˆ¶ä½œè€…ã€ä»¥åŠæƒ³è¦ç»´æŠ¤ç³»ç»Ÿçš„ç”¨æˆ· , éƒ½èƒ½å¤Ÿéµå¾ª FHS çš„æ ‡å‡†ã€‚ ä¹Ÿå°±æ˜¯è¯´ ,FHS çš„é‡ç‚¹åœ¨äºè§„èŒƒæ¯ä¸ªç‰¹å®šçš„ç›®å½•ä¸‹åº”è¯¥å­˜æ”¾ä»€ä¹ˆæ ·å­çš„æ•°æ®è€Œå·²ã€‚</p>
<p>äºŠå®ä¸Š ,FHS æ˜¯æ ¹æ®è¿‡å»çš„ç»éªŒä¸€ç›´å†æŒç»­çš„æ”¹ç‰ˆçš„ ,FHS ä¾æ®æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨çš„é¢‘ç¹ä¸å¦å…è®¸ä½¿ç”¨è€…éšæ„æ›´åŠ¨ , è€Œå°†ç›®å½•å®šä¹‰æˆä¸ºå››ç§äº¤äº’ä½œç”¨çš„å½¢æ€ , ç”¨è¡¨æ ¼æ¥è¯´æœ‰ç‚¹åƒåº•ä¸‹è¿™æ · ï¼š</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">å¯åˆ†äº«çš„ (shareable)</th>
<th align="left">ä¸å¯åˆ†äº«çš„ (unshareable)</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ä¸å˜çš„ (static)</td>
<td align="left">/usr ( è½¯ä»¶æ”¾ç½®å¤„ )</td>
<td align="left">/etc ( é…ç½®æ–‡ä»¶ )</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">/opt ( ç¬¬ä¸‰æ–¹ååŠ›è½¯ä»¶ )</td>
<td align="left">/boot ( å¼€æœºä¸æ ¸å¿ƒæ¡£ )</td>
</tr>
<tr>
<td align="left">å¯å˜åŠ¨çš„ (variable)</td>
<td align="left">/var/mail ( ä½¿ç”¨è€…é‚®ä»¶ä¿¡ç®± )</td>
<td align="left">/var/run ( ç¨‹åºç›¸å…³ )</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">/var/spool/news ( æ–°é—»ç»„ )</td>
<td align="left">/var/lock ( ç¨‹åºç›¸å…³ )</td>
</tr>
</tbody></table>
<p><img src="pic/02.png" alt="02"></p>
<h3 id="ç›®å½•æ ‘"><a href="#ç›®å½•æ ‘" class="headerlink" title="ç›®å½•æ ‘"></a>ç›®å½•æ ‘</h3><p>åœ¨ç±» Unix ç³»ç»Ÿä¸­å¹¶ä¸å­˜åœ¨ C/D/E/F ç›˜ç¬¦,ä¸€åˆ‡çš„æ–‡ä»¶éƒ½æ˜¯ä» â€œ æ ¹ (/)â€ ç›®å½•å¼€å§‹çš„å¹¶æŒ‰ç…§æ–‡ä»¶ç³»ç»Ÿç›®å½•æ ‡å‡† FHS é‡‡ç”¨æ ‘å½¢ç»“æ„æ¥å­˜æ”¾æ–‡ä»¶å¹¶å®šä¹‰äº†æ¯ä¸ªåŒºåŸŸçš„ç”¨é€”ã€‚</p>
<p>ç›®å½•åç§°ä¸¥æ ¼çš„åŒºåˆ†å¤§å°å†™,ä¾‹å¦‚ root ã€ rOOt ã€ Root ã€ rooT ç­‰ç­‰å‡ä»£è¡¨æ˜¯ä¸åŒçš„ç‹¬ç«‹ç›®å½•,å¹¶ä¸”åç§°ä¸­ä¸å¾—åŒ…å«åæ–œæ  (/) ã€‚</p>
<p><img src="pic/04.png" alt="04"></p>
<p>ä¸»è¦å¸¸è§çš„ç›®å½•å®šä¹‰:</p>
<table>
<thead>
<tr>
<th align="left">ç›®å½•åç§°</th>
<th align="left">åº”æ”¾ç½®æ–‡ä»¶çš„å†…å®¹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">/boot</td>
<td align="left">å¼€æœºæ‰€éœ€æ–‡ä»¶ â€”â€” å†…æ ¸,å¼€æœºèœå•åŠæ‰€éœ€é…ç½®æ–‡ä»¶ç­‰</td>
</tr>
<tr>
<td align="left">/dev</td>
<td align="left">ä»»ä½•è®¾å¤‡ä¸æ¥å£éƒ½ä»¥æ–‡ä»¶å½¢å¼å­˜æ”¾åœ¨æ­¤ç›®å½•</td>
</tr>
<tr>
<td align="left">/etc</td>
<td align="left">é…ç½®æ–‡ä»¶</td>
</tr>
<tr>
<td align="left">/home</td>
<td align="left">ç”¨æˆ·ä¸»ç›®å½•</td>
</tr>
<tr>
<td align="left">/bin</td>
<td align="left">å•ç”¨æˆ·ç»´æŠ¤æ¨¡å¼ä¸‹è¿˜èƒ½å¤Ÿè¢«æ“ä½œçš„å‘½ä»¤</td>
</tr>
<tr>
<td align="left">/lib</td>
<td align="left">å¼€æœºæ—¶ç”¨åˆ°çš„å‡½æ•°åº“åŠ/bin ä¸/sbin ä¸‹é¢å‘½ä»¤è¦è°ƒç”¨çš„å‡½æ•°</td>
</tr>
<tr>
<td align="left">/sbin</td>
<td align="left">å¼€æœºè¿‡ç¨‹ä¸­éœ€è¦çš„</td>
</tr>
<tr>
<td align="left">/media</td>
<td align="left">ä¸€èˆ¬æŒ‚è½½æˆ–åˆ é™¤çš„è®¾å¤‡</td>
</tr>
<tr>
<td align="left">/opt</td>
<td align="left">æ”¾ç½®ç¬¬ä¸‰æ–¹çš„è½¯ä»¶</td>
</tr>
<tr>
<td align="left">/root</td>
<td align="left">ç³»ç»Ÿç®¡ç†å‘˜çš„ä¸»æ–‡ä»¶å¤¹</td>
</tr>
<tr>
<td align="left">/srv</td>
<td align="left">ä¸€äº›ç½‘ç»œæœåŠ¡çš„æ•°æ®ç›®å½•</td>
</tr>
<tr>
<td align="left">/tmp</td>
<td align="left">ä»»ä½•äººå‡å¯ä½¿ç”¨çš„ â€œ å…±äº« â€ ä¸´æ—¶ç›®å½•</td>
</tr>
<tr>
<td align="left">/proc</td>
<td align="left">è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ,ä¾‹å¦‚ç³»ç»Ÿå†…æ ¸,è¿›ç¨‹,å¤–éƒ¨è®¾å¤‡åŠç½‘ç»œçŠ¶æ€ç­‰</td>
</tr>
<tr>
<td align="left">/usr/local</td>
<td align="left">ç”¨æˆ·è‡ªè¡Œå®‰è£…çš„è½¯ä»¶</td>
</tr>
<tr>
<td align="left">/usr/sbin</td>
<td align="left">éç³»ç»Ÿå¼€æœºæ—¶éœ€è¦çš„è½¯ä»¶/å‘½ä»¤/è„šæœ¬</td>
</tr>
<tr>
<td align="left">/usr/share</td>
<td align="left">å¸®åŠ©ä¸è¯´æ˜æ–‡ä»¶,ä¹Ÿå¯æ”¾ç½®å…±äº«æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td align="left">/var</td>
<td align="left">ä¸»è¦å­˜æ”¾ç»å¸¸å˜åŒ–çš„æ–‡ä»¶,å¦‚æ—¥å¿—ã€‚</td>
</tr>
<tr>
<td align="left">/lost+found</td>
<td align="left">å½“æ–‡ä»¶ç³»ç»Ÿå‘ç”Ÿé”™è¯¯æ—¶,å°†ä¸€äº›ä¸¢å¤±çš„æ–‡ä»¶ç‰‡æ®µå­˜æ”¾åœ¨è¿™é‡Œ1.3 è·¯å¾„</td>
</tr>
</tbody></table>
<p>å¦å¤–ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µ â€œ è·¯å¾„ â€ ,è¿™ä¸ªè·¯å¾„æŒ‡çš„æ˜¯å¦‚ä½•æ‰¾åˆ°æŸä¸ªæ–‡ä»¶,åˆ†ä¸º â€œ ç»å¯¹è·¯å¾„ â€ ä¸ â€œ ç›¸å¯¹è·¯å¾„ â€ :</p>
<ul>
<li>ç»å¯¹è·¯å¾„ (absolute): ç”±æ ¹ç›®å½• (/) å¼€å§‹å†™èµ·çš„ç›®å½•æˆ–æ–‡ä»¶å</li>
<li>ç›¸å¯¹è·¯å¾„ (relative): ç›¸å¯¹äºå½“å‰è·¯å¾„çš„å†™æ³•</li>
</ul>
<p>ä¸¾ä¾‹æ¥è¯´ä¸€ä¸ªå®¢äººæƒ³æ‰¾ä¸‹å•æ‰€,ä½ æœ‰ä¸¤ç§å›ç­”çš„æ–¹æ³•ã€‚</p>
<ul>
<li>ç»å¯¹è·¯å¾„:é¦–å…ˆåè½¦æ¥åˆ°ä½ å®¶,åˆ°äº†ä½ å®¶åï¼Œå³æ‰‹è¾¹ç¬¬ä¸€ä¸ªæˆ¿é—´å°±æ˜¯å•æ‰€ã€‚</li>
<li>ç›¸å¯¹è·¯å¾„:å‰é¢å³æ‹ç¬¬ä¸€ä¸ªæˆ¿é—´ã€‚</li>
</ul>
<p>å¦‚æœä½ è¯´çš„æ˜¯ç»å¯¹è·¯å¾„,é‚£ä¹ˆä»»ä½•å®¢äººéƒ½å¯ä»¥æŒ‰ç…§è¿™ä¸ªæç¤ºæ‰¾åˆ°ä½ å®¶çš„å•æ‰€,ä½†ç¼ºç‚¹æ˜¯è¿‡äºç¹ç,å¦‚æœè¯´çš„æ˜¯ç›¸å¯¹è·¯å¾„,é‚£ä¹ˆè¿™ä¸ªäººå¹¶ä¸æ˜¯åœ¨æ¯ä¸ªè·¯å£å³è½¬éƒ½èƒ½æ‰¾åˆ°å•æ‰€,ç¼ºç‚¹æ˜¯ä¸å…·å¤‡æ™®éæ€§ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# cd /etc/sysconfig/network-scripts/</span><br><span class="line">[root@rhel7 network-scripts]# pwd</span><br><span class="line">/etc/sysconfig/network-scripts</span><br><span class="line">[root@rhel7 network-scripts]# cd ../modules</span><br><span class="line">[root@rhel7 modules]# pwd</span><br><span class="line">/etc/sysconfig/modules</span><br></pre></td></tr></table></figure>

<h2 id="æ–‡ä»¶å±æ€§"><a href="#æ–‡ä»¶å±æ€§" class="headerlink" title="æ–‡ä»¶å±æ€§"></a>æ–‡ä»¶å±æ€§</h2><p>ç±» Unix ç³»ç»Ÿçš„è®¾è®¡åˆè¡·å°±æ˜¯ä¸ºè®©å¤šç”¨æˆ·åŒæ—¶å·¥ä½œ,æ‰€ä»¥ä¹Ÿè¿«ä½¿ Linux ç³»ç»Ÿæœ‰äº†æå¼ºçš„å®‰å…¨æ€§ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ linux ç³»ç»Ÿç¤ºå¦‚ä½•å®ç°å®‰å…¨æ€§çš„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 tmp]# ll /</span><br><span class="line">total 4148</span><br><span class="line">lrwxrwxrwx.   1 root root        7 May  5 17:28 bin -&gt; usr/bin</span><br><span class="line">dr-xr-xr-x.   4 root root     4096 May  5 17:40 boot</span><br><span class="line">drwxr-xr-x.  15 root root     4096 Aug 19 13:19 content</span><br><span class="line">-rw-------    1 root root  2166784 Aug  8 05:24 core.2052</span><br><span class="line">-rw-------    1 root root 19017728 Aug  8 05:27 core.2488</span><br><span class="line">drwxr-xr-x   19 root root     3380 Oct 26 12:22 dev</span><br><span class="line">drwxr-xr-x. 138 root root    12288 Oct 26 12:22 etc</span><br><span class="line">drwxr-xr-x.   4 root root       31 Aug 23 17:32 home</span><br><span class="line">lrwxrwxrwx.   1 root root        7 May  5 17:28 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx.   1 root root        9 May  5 17:28 lib64 -&gt; usr/lib64</span><br><span class="line">drwxr-xr-x.   2 root root        6 May 25  2015 media</span><br><span class="line">drwxr-xr-x.   2 root root        6 May 25  2015 mnt</span><br><span class="line">drwxr-xr-x.   4 root root       36 May  6 13:19 opt</span><br><span class="line">dr-xr-xr-x  229 root root        0 Oct 26  2016 proc</span><br><span class="line">dr-xr-x---.  26 root root     4096 Oct 12 14:11 root</span><br><span class="line">drwxr-xr-x   39 root root     1200 Oct 26 12:24 run</span><br><span class="line">lrwxrwxrwx.   1 root root        8 May  5 17:28 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x.   2 root root        6 May 25  2015 srv</span><br><span class="line">dr-xr-xr-x   13 root root        0 Oct 26  2016 sys</span><br><span class="line">drwxrwxrwt.  31 root root     4096 Oct 26 12:42 tmp</span><br><span class="line">drwxr-xr-x.  13 root root     4096 May  5 17:28 usr</span><br><span class="line">drwxr-xr-x.  23 root root     4096 Oct 26  2016 var</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒå­—æ®µ,æ–‡ä»¶ç¡¬é“¾æ¥æ•°æˆ–ç›®å½•å­ç›®å½•æ•°</p>
<h3 id="æ–‡ä»¶çš„åˆ†ç±»"><a href="#æ–‡ä»¶çš„åˆ†ç±»" class="headerlink" title="æ–‡ä»¶çš„åˆ†ç±»"></a>æ–‡ä»¶çš„åˆ†ç±»</h3><table>
<thead>
<tr>
<th align="left">æ–‡ä»¶</th>
<th align="left"></th>
<th align="left">æ“ä½œ</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ™®é€šæ–‡ä»¶</td>
<td align="left">çº¯æ–‡æœ¬æ¡£ (ASCII)</td>
<td align="left">touch file</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">äºŒè¿›åˆ¶æ–‡ä»¶ (binary)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">æ•°æ®æ ¼å¼æ–‡ä»¶ (data)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">ç›®å½•</td>
<td align="left">(directory)</td>
<td align="left">mkdir dire</td>
</tr>
<tr>
<td align="left">è¿ç»“æ¡£</td>
<td align="left">(link)</td>
<td align="left">ln file hfile</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left">ln -s file sfile</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left">ln -s â€˜pwdâ€™/file ssfile ç»å¯¹è·¯å¾„çš„è½¯é“¾æ¥æ–‡ä»¶</td>
</tr>
<tr>
<td align="left">è®¾å¤‡ä¸è£…ç½®æ–‡ä»¶</td>
<td align="left">(device)</td>
<td align="left">mknod bfile b 252 0 å—è®¾å¤‡</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left">mknod cfile c 4 2 å­—ç¬¦è®¾å¤‡</td>
</tr>
<tr>
<td align="left">æ•°æ®è¾“é€æ–‡ä»¶</td>
<td align="left">(FIFO, pipe)</td>
<td align="left">mkfifo pfile ç®¡é“æ–‡ä»¶</td>
</tr>
<tr>
<td align="left">èµ„æ–™æ¥å£æ–‡ä»¶</td>
<td align="left">(sockets)</td>
<td align="left">mksock sfile sock æ–‡ä»¶</td>
</tr>
</tbody></table>
<p>-: æ™®é€šæ–‡ä»¶, d: ç›®å½•æ–‡ä»¶, l: é“¾æ¥æ–‡ä»¶, b: å—è®¾å¤‡æ–‡ä»¶, c: å­—ç¬¦è®¾å¤‡æ–‡ä»¶, p: ç®¡é“æ–‡ä»¶</p>
<h3 id="ä¸€èˆ¬æƒé™-UGO"><a href="#ä¸€èˆ¬æƒé™-UGO" class="headerlink" title="ä¸€èˆ¬æƒé™ UGO"></a>ä¸€èˆ¬æƒé™ UGO</h3><p>Linux ç³»ç»Ÿä¸­ä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶,æ–‡ä»¶å’Œç›®å½•çš„æ‰€å±ä¸æƒé™ â€”â€” æ¥åˆ†åˆ«è§„å®šæ‰€æœ‰è€…ã€æ‰€æœ‰ç»„ã€å…¶ä½™äººçš„è¯»,å†™,æ‰§è¡Œæƒé™ã€‚</p>
<p>è¯» (read) ,å†™ (write) ,æ‰§è¡Œ (execute )ç®€å†™å³ä¸º (r,w,x) ,äº¦å¯ç”¨æ•°å­— (4,2,1) è¡¨ç¤º</p>
<table>
<thead>
<tr>
<th align="left">æƒé™</th>
<th align="left">è¯»</th>
<th align="left">å†™</th>
<th align="left">æ‰§è¡Œ</th>
<th align="left">è¯»</th>
<th align="left">å†™</th>
<th align="left">æ‰§è¡Œ</th>
<th align="left">è¯»</th>
<th align="left">å†™</th>
<th align="left">æ‰§è¡Œ</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å­—ç¬¦è¡¨ç¤º</td>
<td align="left">r</td>
<td align="left">w</td>
<td align="left">x</td>
<td align="left">r</td>
<td align="left">w</td>
<td align="left">x</td>
<td align="left">r</td>
<td align="left">w</td>
<td align="left">x</td>
</tr>
<tr>
<td align="left">æ•°å­—è¡¨ç¤º</td>
<td align="left">4</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">4</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">4</td>
<td align="left">2</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">æƒé™åˆ†é…</td>
<td align="left">æ–‡ä»¶æ‰€æœ‰è€…</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">æ–‡ä»¶æ‰€å±ç»„</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">å…¶ä»–ç”¨æˆ·</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<p>ä¸¾ä¾‹ : å¦‚æœæŸæ–‡ä»¶æƒé™ä¸º 7 åˆ™ä»£è¡¨å¯è¯»,å¯å†™,å¯æ‰§è¡Œ (4+2+1) ã€‚è‹¥æƒé™ä¸º 6(4+2) åˆ™ä»£è¡¨å¯è¯»,å¯å†™ã€‚é‚£ä¹ˆæƒé™ä¸º 5 ä¸ 3 æ—¶åˆ†åˆ«ä»£è¡¨äº†ä»€ä¹ˆ?</p>
<p>ç­”æ¡ˆ:æƒé™ä¸º 5 ä»£è¡¨å¯è¯» (4) å’Œå¯æ‰§è¡Œ (1) ã€‚è€Œæƒé™ä¸º 3 ä»£è¡¨å¯å†™ (2) å’Œå¯æ‰§è¡Œ (1) ã€‚</p>
<hr>
<p>æ–‡ä»¶çš„æƒé™ä¸º rw-râ€“râ€“ ä¹Ÿå°±æ˜¯åˆ†åˆ«è¡¨ç¤ºæ‰€æœ‰è€… ( å±ä¸» ) æœ‰è¯»å†™æƒé™,æ‰€æœ‰ç»„ ( å±ç»„ ) æœ‰è¯»æƒé™,å…¶ä½™äººä¹Ÿä»…æœ‰è¯»æƒé™ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™å‘ç°é—®é¢˜äº†å—?å¯¹äºç›®å½•æ–‡ä»¶çš„è¯»å’Œå†™æƒé™æˆ‘ä»¬è¿˜å¯ä»¥ç†è§£,ç›®å½•è¦èƒ½æ‰§è¡Œæ“ä½œ?</p>
<p>æ™®é€šæ–‡ä»¶å³å®é™…ä¿å­˜æ•°æ®çš„åœ°æ–¹,å…¶å¹¶ä¸å…·å¤‡åˆ é™¤è‡ªèº«çš„æƒé™:</p>
<ul>
<li>r: å¯è¯»å–æ–‡ä»¶çš„å®é™…å†…å®¹</li>
<li>w: å¯ç¼–è¾‘ / æ–°å¢ / ä¿®æ”¹è¯¥æ–‡ä»¶çš„å®é™…å†…å®¹</li>
<li>x: å¯è¢«æ‰§è¡Œ</li>
</ul>
<p>ç›®å½•æ–‡ä»¶å³ä¿å­˜æœ‰ç›®å½•ç»“æ„å’Œæ–‡ä»¶æƒé™:</p>
<ul>
<li>r: å¯è¯»å–ç›®å½•ç»“æ„å’Œæƒé™</li>
<li>w: å¯æ›´æ”¹ç›®å½•ç»“æ„åˆ—è¡¨ã€æ–°å»º / åˆ é™¤ / é‡å‘½å / è½¬ç§»å­æ–‡ä»¶ / ç›®å½•ã€‚</li>
<li>x: è¡¨ç¤ºç”¨æˆ·å¯è¿›å…¥åˆ°è¯¥ç›®å½•ä¸­</li>
</ul>
<h3 id="ç‰¹æ®Šæƒé™-suid-sgid-sticky"><a href="#ç‰¹æ®Šæƒé™-suid-sgid-sticky" class="headerlink" title="ç‰¹æ®Šæƒé™ suid\sgid\sticky"></a>ç‰¹æ®Šæƒé™ suid\sgid\sticky</h3><p>å•çº¯å¯¹æ–‡ä»¶ä½ç½®çš„ rwx æƒé™è‚¯å®šä¸èƒ½æ»¡è¶³æˆ‘ä»¬å¯¹å®‰å…¨ã€ä¾¿æ·å·¥ä½œçš„éœ€æ±‚,æ‰€ä»¥ä¾¿æœ‰äº† SUID ä¸ SGID çš„ç‰¹æ®Šæƒé™æœºåˆ¶ã€‚</p>
<p>SUID</p>
<ul>
<li>èŒƒå›´ : äºŒè¿›åˆ¶çš„å¯æ‰§è¡Œçš„æ–‡ä»¶</li>
<li>ä½œç”¨ : ä¸´æ—¶æ‹¥æœ‰æ‰€æœ‰è€…çš„æƒé™</li>
</ul>
<p>SGID</p>
<ul>
<li>èŒƒå›´ : ç›®å½•æˆ–è€…æ‹¥æœ‰å¯æ‰§è¡Œæƒé™çš„æ–‡ä»¶</li>
<li>ä½œç”¨ : ç»§æ‰¿ç›®å½•æ‰€å±ç»„</li>
</ul>
<p>SBIT ( STICKY )</p>
<ul>
<li>èŒƒå›´ : ç›®å½•</li>
<li>ä½œç”¨ : åªæœ‰ root ç”¨æˆ·å’Œæ–‡ä»¶æ‹¥æœ‰è€…æœ‰æƒåˆ é™¤ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚</li>
</ul>
<p>SUID</p>
<p>æ¯”å¦‚:<br><code>-rwsr-xr-x. 1 root root 27832 Jan 30 2014 /usr/bin/passwd</code></p>
<p>æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥æ‰§è¡Œç”¨äºä¿®æ”¹ç”¨æˆ·å¯†ç çš„ passwd å‘½ä»¤,ä½†ç”¨æˆ·å¯†ç ä¿å­˜åœ¨ /etc/shadow æ–‡ä»¶ä¸­,é»˜è®¤æƒé™æ˜¯ 000 å³é™¤äº†è¶…çº§ç”¨æˆ· root å¤–çš„æ‰€æœ‰ç”¨æˆ·éƒ½æ²¡æœ‰æŸ¥çœ‹æˆ–ç¼–è¾‘è¯¥æ–‡ä»¶çš„æƒé™,æ‰€ä»¥å¯¹ passwd å‘½ä»¤åŠ ä¸ŠSUID æƒé™ä½,åˆ™å¯è®©æ™®é€šç”¨æˆ·ä¸´æ—¶è·å¾—ç¨‹åºæ‰€æœ‰è€…çš„èº«ä»½,å³ä»¥ root ç”¨æˆ·çš„èº«ä»½å°†å˜æ›´çš„å¯†ç ä¿¡æ¯å†™å…¥åˆ° shadow æ–‡ä»¶ä¸­ã€‚</p>
<p><code>---s--x--x. 1 root root 130712 Sep 1 2015 sudo</code></p>
<p>SGID:</p>
<p>åŠŸèƒ½ä¸€:è®©æ‰§è¡Œè€…ä¸´æ—¶æ‹¥æœ‰å±ç»„çš„æƒé™(å¯¹æ‹¥æœ‰æ‰§è¡Œæƒé™çš„äºŒè¿›åˆ¶ç¨‹åºè®¾ç½®)</p>
<p>ä¸¾ä¾‹:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-r-xr-sr-x. 1 root tty</span><br><span class="line">-rwxr-sr-x. 1 root tty</span><br><span class="line">15344 Jan 27 2014 wall</span><br><span class="line">19536 Aug 21 2015 write</span><br></pre></td></tr></table></figure>

<p>åŠŸèƒ½äºŒ:åœ¨è¯¥ç›®å½•ä¸­åˆ›å»ºçš„æ–‡ä»¶è‡ªåŠ¨ç»§æ‰¿æ­¤ç›®å½•çš„ç”¨æˆ·ç»„(åªå¯ä»¥å¯¹ç›®å½•è®¾ç½®)</p>
<p>æ¯”å¦‚:æˆ‘ä»¬å°†æŸä¸ªéƒ¨é—¨çš„å·¥ä½œç›®å½•ç»™äºˆäº† SGID æƒé™,è¿™æ ·æ‰€æœ‰äººåˆ›å»ºçš„æ–‡ä»¶éƒ½å½’ç›¸åŒçš„å·¥ä½œç»„,è¿™æ ·æ–¹ä¾¿ä»¥åçš„ç®¡ç†ã€‚</p>
<p>SBIT(Sticky Bit):</p>
<p>æ¯”å¦‚:<br><code>drwxrwxrwt. 7 root root 4096 Jun 22 13:20 /tmp</code></p>
<p>ä¸€èˆ¬è€å¸ˆå¸Œæœ›å­¦ç”Ÿå¯ä»¥å°†ä½œä¸šä¸Šä¼ åˆ°æŸä¸ªç‰¹å®šç›®å½• â€”â€” ä½†ä¸ºäº†é¿å…æŸäº›å°ç ´åä»½å­,æƒ³é™åˆ¶åˆ é™¤å…¶ä»–äººæ–‡ä»¶çš„è¯,é‚£å°±è¦è®¾ç½® SBIT ä½äº†,å½“ç„¶ä¹Ÿå¯ä»¥å«åšç‰¹æ®Šæƒé™ä½ä¹‹ç²˜æ»ä½ã€‚</p>
<h3 id="éšè—å±æ€§-ATTR"><a href="#éšè—å±æ€§-ATTR" class="headerlink" title="éšè—å±æ€§ ATTR"></a>éšè—å±æ€§ ATTR</h3><p>æ–‡ä»¶æƒé™é™¤äº† UGO è¯»å†™æ‰§è¡Œä¸ SUID ã€ SGID ã€ SBIT å¤–è¿˜æœ‰ä¸€ç§éšè—æƒé™,ä¾‹å¦‚æ˜æ˜æœ‰æƒé™åˆ é™¤æŸä¸ªæ–‡ä»¶å´æŠ¥é”™äº†,æˆ–è€…ä»…èƒ½ä¸ºæŸä¸ªæ–‡ä»¶è¿½åŠ å†…å®¹è€Œä¸èƒ½å‡å°‘å†…å®¹,é‡åˆ°è¿™ç§å¾ˆ â€œ å¥‡æ€ª â€ çš„æ–‡ä»¶,å°±è¦æ€€ç–‘æ˜¯æ–‡ä»¶è¢«è®¾ç½®éšè—æƒé™äº†ã€‚</p>
<p>chattr å‘½ä»¤ç”¨äºè®¾ç½®æ–‡ä»¶çš„éšè—æƒé™,æ ¼å¼ä¸º: â€œ chattr [ å‚æ•° ] æ–‡ä»¶ â€ ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">i</td>
<td align="left">å°†æ— æ³•å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹,è‹¥å¯¹ç›®å½•è®¾ç½®ååˆ™ä»…èƒ½ä¿®æ”¹å­æ–‡ä»¶è€Œä¸èƒ½æ–°å»ºæˆ–åˆ é™¤ã€‚</td>
</tr>
<tr>
<td align="left">a</td>
<td align="left">ä»…å…è®¸è¡¥å……(è¿½åŠ )å†…å®¹.æ— æ³•è¦†ç›–/åˆ é™¤(Append Only)ã€‚</td>
</tr>
<tr>
<td align="left">S</td>
<td align="left">æ–‡ä»¶å†…å®¹å˜æ›´åç«‹å³åŒæ­¥åˆ°ç¡¬ç›˜(sync)ã€‚</td>
</tr>
<tr>
<td align="left">s</td>
<td align="left">å½»åº•ä»ç¡¬ç›˜ä¸­åˆ é™¤,ä¸å¯æ¢å¤(ç”¨ 0 å¡«å……åŸæ–‡ä»¶æ‰€åœ¨ç¡¬ç›˜åŒºåŸŸ)ã€‚</td>
</tr>
<tr>
<td align="left">A</td>
<td align="left">ä¸å†ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶çš„æœ€åè®¿é—®æ—¶é—´(atime)ã€‚</td>
</tr>
<tr>
<td align="left">b</td>
<td align="left">ä¸å†ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„å­˜å–æ—¶é—´ã€‚</td>
</tr>
<tr>
<td align="left">D</td>
<td align="left">æ£€æŸ¥å‹ç¼©æ–‡ä»¶ä¸­çš„é”™è¯¯ã€‚</td>
</tr>
<tr>
<td align="left">d</td>
<td align="left">å½“ä½¿ç”¨ dump å‘½ä»¤å¤‡ä»½æ—¶å¿½ç•¥æœ¬æ–‡ä»¶/ç›®å½•ã€‚</td>
</tr>
<tr>
<td align="left">c</td>
<td align="left">é»˜è®¤å°†æ–‡ä»¶æˆ–ç›®å½•è¿›è¡Œå‹ç¼©ã€‚</td>
</tr>
<tr>
<td align="left">u</td>
<td align="left">å½“åˆ é™¤æ­¤æ–‡ä»¶åä¾ç„¶ä¿ç•™å…¶åœ¨ç¡¬ç›˜ä¸­çš„æ•°æ®,æ–¹ä¾¿æ—¥åæ¢å¤ã€‚</td>
</tr>
<tr>
<td align="left">t</td>
<td align="left">è®©æ–‡ä»¶ç³»ç»Ÿæ”¯æŒå°¾éƒ¨åˆå¹¶(tail-merging)ã€‚</td>
</tr>
<tr>
<td align="left">X</td>
<td align="left">å¯ä»¥ç›´æ¥è®¿é—®å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚</td>
</tr>
</tbody></table>
<p>lsattr å‘½ä»¤ç”¨äºæ˜¾ç¤ºæ–‡ä»¶çš„éšè—æƒé™,æ ¼å¼ä¸º: â€œ lsattr [ å‚æ•° ] æ–‡ä»¶ â€ ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">a</td>
<td align="left">æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ã€‚</td>
</tr>
<tr>
<td align="left">l</td>
<td align="left">æ˜¾ç¤ºéšè—å±æ€§çš„å…¨ç§°(é»˜è®¤ç®€å†™æˆä¸€ä¸ªå­—æ¯)ã€‚</td>
</tr>
<tr>
<td align="left">R</td>
<td align="left">é€’å½’å¤„ç†,å°†æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åŠå­ç›®å½•ä¸€å¹¶å¤„ç†ã€‚</td>
</tr>
<tr>
<td align="left">d</td>
<td align="left">è‹¥ç›®æ ‡æ–‡ä»¶ä¸ºç›®å½•,è¯·åŠ æ­¤å‚æ•°ã€‚</td>
</tr>
</tbody></table>
<p>å…·ä½“ç”¨æ³•è§ç¬¬ä¸‰ç« èŠ‚</p>
<h3 id="æ–‡ä»¶è®¿é—®æ§åˆ¶åˆ—è¡¨-ACL"><a href="#æ–‡ä»¶è®¿é—®æ§åˆ¶åˆ—è¡¨-ACL" class="headerlink" title="æ–‡ä»¶è®¿é—®æ§åˆ¶åˆ—è¡¨ ACL"></a>æ–‡ä»¶è®¿é—®æ§åˆ¶åˆ—è¡¨ ACL</h3><p>ä¸çŸ¥å¤§å®¶æœ‰æ²¡æœ‰å‘ç°å…¶å®ä¸Šé¢è®²è§£çš„ rwx æƒé™ã€ç‰¹æ®Šæƒé™ã€éšè—æƒé™éƒ½æ˜¯å¯¹æŸä¸€ç±»ç”¨æˆ·è®¾ç½®çš„,è€Œå¦‚æœå¸Œæœ›å¯¹æŸä¸ªæŒ‡å®šçš„ç”¨æˆ·è¿›è¡Œå•ç‹¬çš„æƒé™è®¾ç½®,é‚£ä¹ˆå°±éœ€è¦ç”¨æ–‡ä»¶çš„è®¿é—®æ§åˆ¶åˆ—è¡¨æ¥å®ç°å•¦ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åŸºäºæ™®é€šæ–‡ä»¶æˆ–ç›®å½•è®¾ç½®è¿›è¡Œè®¾ç½® ACL ,é€šä¿—æ¥è¯´ ACL å°±æ˜¯è®¾ç½®æŒ‡å®šçš„ç‰¹å®šç”¨æˆ·æˆ–ç”¨æˆ·ç»„å¯¹æŸä¸ªæ–‡ä»¶çš„æ“ä½œæƒé™ã€‚å¹¶ä¸”å¦‚æœå¯¹æŸä¸ªç›®å½•è®¾ç½®äº†è®¿é—®æ§åˆ¶ç­–ç•¥,é‚£ä¹ˆå­æ–‡ä»¶åˆ™ç»§æ‰¿å…¶è®¿é—®ç­–ç•¥,è€Œè‹¥å¯¹æ–‡ä»¶è®¾ç½®äº†è®¿é—®æ§åˆ¶ç­–ç•¥åˆ™ä¸å†ç»§æ‰¿ä¸Šçº§ç›®å½•çš„æ§åˆ¶ç­–ç•¥ã€‚</p>
<p>ACL:Access Control List ç¼©å†™ ,UGO çš„ rwx æƒé™ä»¥å¤–çš„ç»†éƒ¨æƒé™è®¾ç½®ã€‚</p>
<ul>
<li>setfacl å‘½ä»¤ç”¨äºå¢åŠ æˆ–è€…ä¿®æ”¹ ACL è§„åˆ™,æ ¼å¼ä¸º: â€ setfacl [ å‚æ•° ] æ–‡ä»¶ â€ ã€‚</li>
<li>getfacl å‘½ä»¤ç”¨äºæ˜¾ç¤ºæ–‡ä»¶çš„ ACL è§„åˆ™,æ ¼å¼ä¸º: â€ getfacl æ–‡ä»¶ â€ ã€‚</li>
</ul>
<p>è¯¦ç»†å‘½ä»¤ç”¨æ³•è¯·çœ‹ç¬¬ä¸‰ç« èŠ‚ã€‚</p>
<h2 id="æ–‡ä»¶ç›¸å…³çš„å‘½ä»¤"><a href="#æ–‡ä»¶ç›¸å…³çš„å‘½ä»¤" class="headerlink" title="æ–‡ä»¶ç›¸å…³çš„å‘½ä»¤"></a>æ–‡ä»¶ç›¸å…³çš„å‘½ä»¤</h2><table>
<thead>
<tr>
<th align="left">æ–‡ä»¶</th>
<th align="left">å‘½ä»¤</th>
<th align="left">è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ–‡ä»¶çš„ç®¡ç†</td>
<td align="left">ls ,cd, pwd, touch,mkdir, rmdir</td>
<td align="left">æ–°å»ºã€åˆ é™¤</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">cp, rm, mv</td>
<td align="left">å¤åˆ¶ã€åˆ é™¤ã€ç§»åŠ¨</td>
</tr>
<tr>
<td align="left">æ–‡ä»¶å†…å®¹çš„æŸ¥çœ‹</td>
<td align="left">cat, tac, nl</td>
<td align="left">ç›´æ¥æŸ¥çœ‹å†…å®¹</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">more, less</td>
<td align="left">å¯ç¿»é¡µæŸ¥çœ‹</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">head, tail</td>
<td align="left">èµ„æ–™æ’·å–</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">od</td>
<td align="left">éçº¯æ–‡æœ¬æ¡£</td>
</tr>
<tr>
<td align="left">æ–‡ä»¶çš„æƒé™</td>
<td align="left">chmod chown</td>
<td align="left">æ–‡ä»¶çš„æ‹¥æœ‰è€…å’Œæ‰€å±ç»„ ugo æƒé™</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">umask</td>
<td align="left">æ–‡ä»¶é¢„è®¾</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">chattr, lsattr</td>
<td align="left">æ–‡ä»¶éšè—å±æ€§</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">SUID, SGID, SBIT</td>
<td align="left">æ–‡ä»¶ç‰¹æ®Šæƒé™</td>
</tr>
<tr>
<td align="left">æ–‡ä»¶ç±»å‹</td>
<td align="left">file</td>
<td align="left">æ–‡ä»¶ç±»å‹æŸ¥çœ‹</td>
</tr>
<tr>
<td align="left">æ–‡ä»¶çš„æœç´¢</td>
<td align="left">which</td>
<td align="left">æŒ‡ä»¤æ–‡ä»¶çš„æœç´¢</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">whereis, locate, find</td>
<td align="left">æ–‡ä»¶çš„æœç´¢</td>
</tr>
</tbody></table>
<h3 id="æƒé™çš„ä¿®æ”¹-chmod-chown-chgrp-umask"><a href="#æƒé™çš„ä¿®æ”¹-chmod-chown-chgrp-umask" class="headerlink" title="æƒé™çš„ä¿®æ”¹ chmod chown chgrp umask"></a>æƒé™çš„ä¿®æ”¹ chmod chown chgrp umask</h3><h4 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h4><p>chmod [ u g o a æ‰€æœ‰ç”¨æˆ· ] [ + - = ] [ rwx] /[ 777]</p>
<ul>
<li>w ç»“åˆ x æƒé™å¯ä»¥å¯¹ç›®å½•ä¸‹çš„æ–‡ä»¶è¿›è¡Œä»¥ä¸‹æ“ä½œ : cd rm touch cp</li>
<li>r ç»“åˆ x æƒé™å¯ä»¥å¯¹ç›®å½•ä¸‹çš„æ–‡ä»¶è¿›è¡Œ ls æ“ä½œ</li>
<li>x å†³å®šäº†èƒ½å¦è¿›å…¥ç›®å½•</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ root@www tmp]# ll dabao</span><br><span class="line">-rw-r--r--. 1 root root 0 Mar 21 06:09 dabao</span><br><span class="line">[ root@www tmp]# chmod 777 dabao</span><br><span class="line">[ root@www tmp]# ll dabao</span><br><span class="line">-rwxrwxrwx. 1 root root 0 Mar 21 06:09 dabao3.1.2 chown</span><br></pre></td></tr></table></figure>

<p>chown user:group ç›®å½• / æ–‡ä»¶</p>
<p>-R é’ˆå¯¹ç›®å½•é€’å½’ä¿®æ”¹æ‹¥æœ‰è€…</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ root@www tmp]# chown dabao. dabao</span><br><span class="line">[ root@www tmp]# ll dabao</span><br><span class="line">-rwxrwxrwx. 1 dabao dabao 0 Mar 21 06:09 dabao</span><br><span class="line">[ root@www tmp]# chown -R dabao dabao1</span><br><span class="line">[ root@www tmp]# ll -R dabao1</span><br><span class="line">dabao1:</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x. 3 dabao root 4096 Mar 21 06:11 1</span><br><span class="line">dabao1/1:</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x. 2 dabao root 4096 Mar 21 06:11 2</span><br><span class="line">dabao1/1/2:</span><br><span class="line">total 0</span><br></pre></td></tr></table></figure>

<h4 id="chgrp"><a href="#chgrp" class="headerlink" title="chgrp"></a>chgrp</h4><p>ä¿®æ”¹æ–‡ä»¶ç›®å½•çš„æ‰€å±ç»„</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ root@www tmp]# chgrp -R dabao dabao1</span><br><span class="line">[ root@www tmp]# ll -R dabao1</span><br><span class="line">dabao1:</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x. 3 dabao dabao 4096 Mar 21 06:11 1</span><br><span class="line">dabao1/1:</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x. 2 dabao dabao 4096 Mar 21 06:11 2</span><br><span class="line">dabao1/1/2:</span><br><span class="line">total 0</span><br></pre></td></tr></table></figure>

<h4 id="umask"><a href="#umask" class="headerlink" title="umask"></a>umask</h4><p>umask åˆ›å»ºæ–‡ä»¶ / ç›®å½•çš„é»˜è®¤æƒé™</p>
<p>å…¬å¼</p>
<p>æœ€å¤§æƒé™ -umask= é»˜è®¤æƒé™</p>
<ul>
<li>user æ–‡ä»¶ 666 -002 = 644 rw-rw-râ€“</li>
<li>root æ–‡ä»¶ 666 -022 = 664 rw-râ€“râ€“</li>
<li>user ç›®å½• 777 -002 = 755 rwxrwxr-x</li>
<li>root ç›®å½• 777 -022 = 775 rwxr-xr-x</li>
</ul>
<p>umask 777 åªé’ˆå¯¹å½“å‰ç¯å¢ƒä¸´æ—¶ç”Ÿæ•ˆ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ root@www tmp]# umask</span><br><span class="line">0022</span><br></pre></td></tr></table></figure>

<h4 id="ç›¸å…³æ–‡æ¡£-etc-profile-bash-profile"><a href="#ç›¸å…³æ–‡æ¡£-etc-profile-bash-profile" class="headerlink" title="ç›¸å…³æ–‡æ¡£ /etc/profile ~/.bash_profile"></a>ç›¸å…³æ–‡æ¡£ /etc/profile ~/.bash_profile</h4><ul>
<li>/etc/profile å®šä¹‰äº†æ™®é€šç”¨æˆ·å’Œ root ç”¨æˆ·çš„ umask å€¼ , å¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆ</li>
<li>~/.bash_profile å¯ä»¥å®šä¹‰å½“å‰ç”¨æˆ·çš„ umask å€¼ , åªå¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆ , éœ€è¦é‡æ–°ç™»é™†ç”¨æˆ·åç”Ÿæ•ˆã€‚</li>
</ul>
<p>é»˜è®¤å±æ€§ç›¸åŠ å‡ , åˆ™æ¡£æ¡ˆå˜æˆ :666-003=663, æ˜¯ -rw-rwâ€“wx , é”™ !!</p>
<h3 id="ATTR-æƒé™å‘½ä»¤-chattr-lsattr"><a href="#ATTR-æƒé™å‘½ä»¤-chattr-lsattr" class="headerlink" title="ATTR æƒé™å‘½ä»¤ chattr lsattr"></a>ATTR æƒé™å‘½ä»¤ chattr lsattr</h3><h4 id="chattr"><a href="#chattr" class="headerlink" title="chattr"></a>chattr</h4><p>é…ç½®æ–‡ä»¶æ¡ˆéšè—å±æ€§</p>
<p>å±æ€§è®¾ç½®å¸¸è§çš„æ˜¯ a å’Œ i çš„è®¾å®š , å¿…é¡»è¦ root èº«ä»½</p>
<p>chattr [ +-= ][ ASacdistu] æ–‡ä»¶ / ç›®å½•</p>
<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">+</td>
<td align="left">å¢åŠ </td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">ç§»é™¤</td>
</tr>
<tr>
<td align="left">=</td>
<td align="left">è®¾å®šä¸º</td>
</tr>
<tr>
<td align="left">A</td>
<td align="left">è®¿é—®æ—¶é—´ atime ä¸ä¿®æ”¹ , å¯¹é€Ÿåº¦è¾ƒæ…¢è®¡ç®—æœºæœ‰å¸®åŠ©</td>
</tr>
<tr>
<td align="left">S</td>
<td align="left">ã€åŒæ­¥ã€å†™å…¥ç£ç›˜</td>
</tr>
<tr>
<td align="left">a</td>
<td align="left">åªèƒ½å¢åŠ æ•°æ® , ä¸èƒ½åˆ é™¤ / ä¿®æ”¹æ•°æ® (root)</td>
</tr>
<tr>
<td align="left">c</td>
<td align="left">è‡ªåŠ¨ã€å‹ç¼©ã€ , è¯»å–æ—¶è‡ªåŠ¨è§£å‹ç¼©</td>
</tr>
<tr>
<td align="left">d</td>
<td align="left">ä¸è¢« dump å¤‡ä»½</td>
</tr>
<tr>
<td align="left">i</td>
<td align="left">ä»¥ä¸‹æ“ä½œä¸å¯æ‰§è¡Œ : ã€åˆ é™¤ã€æ”¹åã€è®¾ç½®è¿ç»“ã€å†™å…¥ã€æ–°å¢èµ„æ–™ã€ ( root )</td>
</tr>
<tr>
<td align="left">s</td>
<td align="left">å½»åº•åˆ é™¤ , æ— æ³•æŒ½å›</td>
</tr>
<tr>
<td align="left">u</td>
<td align="left">ä¸ s ç›¸å , åˆ é™¤å¯æŒ½å›</td>
</tr>
</tbody></table>
<h4 id="lsattr"><a href="#lsattr" class="headerlink" title="lsattr"></a>lsattr</h4><p>lsattr [ -adR] æ–‡ä»¶ / ç›®å½•</p>
<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-a</td>
<td align="left">æ˜¾ç¤ºéšè—æ–‡ä»¶çš„å±æ€§</td>
</tr>
<tr>
<td align="left">-d</td>
<td align="left">ä»…åˆ—å‡ºç›®å½•æœ¬èº«å±æ€§</td>
</tr>
<tr>
<td align="left">-R</td>
<td align="left">è¿åŒå­ç›®å½•</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">A è®¿é—®æ—¶é—´ atime ä¸ä¿®æ”¹</span><br><span class="line">[root@rhel7 tmp]# chattr +A file1</span><br><span class="line">[root@rhel7 tmp]# lsattr file1</span><br><span class="line">-------A-------- file1</span><br><span class="line">[root@rhel7 tmp]# cat file1</span><br><span class="line">hi</span><br><span class="line">[root@rhel7 tmp]# stat file1</span><br><span class="line">File: â€˜file1â€™</span><br><span class="line">Size: 3</span><br><span class="line">Blocks: 8</span><br><span class="line">IO Block: 4096 regular file</span><br><span class="line">Device: fd00h/64768d</span><br><span class="line">Inode: 52973916 Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--) Uid: ( 0/ root) Gid: ( 0/ root)</span><br><span class="line">Context: unconfined_u:object_r:user_tmp_t:s0Access: 2016-06-22 14:49:50.221000000 +0800</span><br><span class="line">Modify: 2016-06-22 14:49:48.025000000 +0800</span><br><span class="line">Change: 2016-06-22 14:50:14.621000000 +0800</span><br><span class="line">Birth: -</span><br><span class="line">[root@rhel7 tmp]# cat file1</span><br><span class="line">hi</span><br><span class="line">[root@rhel7 tmp]# stat file1</span><br><span class="line">File: â€˜file1â€™</span><br><span class="line">Size: 3</span><br><span class="line">Blocks: 8</span><br><span class="line">IO Block: 4096 regular file</span><br><span class="line">Device: fd00h/64768d</span><br><span class="line">Inode: 52973916 Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--) Uid: ( 0/ root) Gid: ( 0/ root)</span><br><span class="line">Context: unconfined_u:object_r:user_tmp_t:s0</span><br><span class="line">Access: 2016-06-22 14:49:50.221000000 +0800</span><br><span class="line">Modify: 2016-06-22 14:49:48.025000000 +0800</span><br><span class="line">Change: 2016-06-22 14:50:14.621000000 +0800</span><br><span class="line">Birth: -</span><br><span class="line">[root@rhel7 tmp]# chattr -A file1</span><br><span class="line">a åªèƒ½å¢åŠ æ•°æ® , ä¸èƒ½åˆ é™¤ / ä¿®æ”¹æ•°æ® (root)</span><br><span class="line">[root@rhel7 tmp]# chattr +a file1</span><br><span class="line">[root@rhel7 tmp]# lsattr file1</span><br><span class="line">-----a---------- file1</span><br><span class="line">[root@rhel7 tmp]# echo 99 &gt; file1</span><br><span class="line">-bash: file1: Operation not permitted</span><br><span class="line">[root@rhel7 tmp]# echo 99 &gt;&gt; file1</span><br><span class="line">[root@rhel7 tmp]# cat file1</span><br><span class="line">hi</span><br><span class="line">99</span><br><span class="line">i ä»¥ä¸‹æ“ä½œä¸å¯æ‰§è¡Œ : ã€åˆ é™¤ã€æ”¹åã€è®¾ç½®è¿ç»“ã€å†™å…¥ã€æ–°å¢èµ„æ–™ã€ ( root )</span><br><span class="line">[root@rhel7 tmp]# chattr +i file1</span><br><span class="line">[root@rhel7 tmp]# rm -rf file1</span><br><span class="line">rm: cannot remove â€˜file1â€™: Operation not permitted</span><br><span class="line">[root@rhel7 tmp]# mv file1 file100</span><br><span class="line">mv: cannot move â€˜file1â€™ to â€˜file100â€™: Operation not permitted</span><br><span class="line">[root@rhel7 tmp]# link file1 file1h</span><br><span class="line">link: cannot create link â€˜file1hâ€™ to â€˜file1â€™: Operation not permitted</span><br><span class="line">[root@rhel7 tmp]# echo nini&gt;&gt;file1</span><br><span class="line">-bash: file1: Permission denied</span><br><span class="line">[root@rhel7 tmp]# chattr -i file1</span><br><span class="line">[root@rhel7 tmp]# lsattr file1</span><br><span class="line">---------------- file1</span><br></pre></td></tr></table></figure>


<h3 id="ACL-æƒé™å‘½ä»¤"><a href="#ACL-æƒé™å‘½ä»¤" class="headerlink" title="ACL æƒé™å‘½ä»¤"></a>ACL æƒé™å‘½ä»¤</h3><h4 id="ACL-æƒé™æ¦‚å¿µ"><a href="#ACL-æƒé™æ¦‚å¿µ" class="headerlink" title="ACL æƒé™æ¦‚å¿µ"></a>ACL æƒé™æ¦‚å¿µ</h4><p>ACL:Access Control List ç¼©å†™ ,UGO çš„ rwx æƒé™ä»¥å¤–çš„ç»†éƒ¨æƒé™è®¾ç½®ã€‚</p>
<p>ACL å¯ä»¥é’ˆå¯¹å•ä¸€ç”¨æˆ· , å•ä¸€æ–‡ä»¶ , å•ä¸€ç›®å½• r,w,x çš„æƒé™è§„èŒƒ</p>
<p>é’ˆå¯¹å‡ ä¸ªé¡¹ç›® :</p>
<ol>
<li>ä½¿ç”¨è€… (user): å¯ä»¥é’ˆå¯¹ä½¿ç”¨è€…è®¾å®šæƒé™</li>
<li>ç¾¤ç»„ (group): é’ˆå¯¹ç¾¤ç»„ä¸ºå¯¹è±¡è®¾å®šæƒé™</li>
<li>é»˜è®¤å±æ€§ (mask): è¿˜å¯ä»¥é’ˆå¯¹åœ¨è¯¥ç›®å½•ä¸‹åœ¨å»ºç«‹æ–°æ¡£æ¡ˆæˆ–ç›®å½•æ—¶ , è§„èŒƒæ–°æ•°æ®çš„é»˜è®¤æƒé™</li>
</ol>
<h4 id="getfacl"><a href="#getfacl" class="headerlink" title="getfacl"></a>getfacl</h4><p>å–å¾—æ–‡ä»¶ / ç›®å½•çš„ ACL è®¾å®šå†…å®¹</p>
<p>getfacl filename</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@www tmp]# getfacl dabao</span><br><span class="line"> file: dabao</span><br><span class="line"> owner: dabao</span><br><span class="line"> group: dabao</span><br><span class="line">user::rwx</span><br><span class="line">group::rwx</span><br><span class="line">other::rwx</span><br></pre></td></tr></table></figure>

<h4 id="setfacl"><a href="#setfacl" class="headerlink" title="setfacl"></a>setfacl</h4><p>è®¾ç½®æ–‡ä»¶ / ç›®å½•çš„ ACL è§„èŒƒ</p>
<p>setfacl [-bkRd] [{-m|-x} acl å‚æ•° ] ç›®æ ‡æ–‡ä»¶å</p>
<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-m</td>
<td align="left">è®¾ç½® acl å‚æ•°</td>
</tr>
<tr>
<td align="left">-x</td>
<td align="left">åˆ é™¤ acl å‚æ•°</td>
</tr>
<tr>
<td align="left">-b</td>
<td align="left">åˆ é™¤æ‰€æœ‰ acl å‚æ•°</td>
</tr>
<tr>
<td align="left">-k</td>
<td align="left">åˆ é™¤é¢„è®¾çš„ acl å‚æ•°</td>
</tr>
<tr>
<td align="left">-R</td>
<td align="left">é€’å½’è®¾ç½® acl å‚æ•°</td>
</tr>
<tr>
<td align="left">-d</td>
<td align="left">è®¾ç½®ã€é¢„è®¾ acl å‚æ•°ã€åªå¯¹ç›®å½•æœ‰æ•ˆ , åœ¨è¯¥ç›®å½•æ–°å»ºçš„æ•°æ®ä¼šå¼•ç”¨</td>
</tr>
</tbody></table>
<p>å‘½ä»¤æ ¼å¼ :</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ã€ u:[ ä½¿ç”¨è€…è´¦å·åˆ—è¡¨ ]:[ rwx] ã€ &lt;= = é’ˆå¯¹ç‰¹å®šç”¨æˆ·</span><br><span class="line">ã€ g:[ ç¾¤ç»„åˆ—è¡¨ ]:[rwx] ã€ &lt;= = é’ˆå¯¹ç‰¹å®šç”¨æˆ·ç»„</span><br><span class="line">ã€ m:[ rwx] ã€ &lt;= = é’ˆå¯¹æœ‰æ•ˆæƒé™ mask</span><br><span class="line">ã€ d:[ ug]: ä½¿ç”¨è€…åˆ—è¡¨ :[ rwx] ã€ é’ˆå¯¹é¢„è®¾æƒé™ , å±æ€§å°†ç»§æ‰¿åˆ°æ¬¡ç›®å½•</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 tmp]# setfacl -m u:student:rwx file1</span><br><span class="line">[root@rhel7 tmp]# setfacl -m g:student:rw file1</span><br><span class="line">[root@rhel7 tmp]# getfacl file1</span><br><span class="line"> file: file1</span><br><span class="line"> owner: root</span><br><span class="line"> group: root</span><br><span class="line">user::rw-</span><br><span class="line">user:student:rwx</span><br><span class="line">group::r--</span><br><span class="line">group:student:rw-</span><br><span class="line">mask::rwx</span><br><span class="line">other::r--</span><br><span class="line">-d é’ˆå¯¹é¢„è®¾æƒé™ , å±æ€§å°†ç»§æ‰¿åˆ°æ¬¡ç›®å½•</span><br><span class="line">[root@rhel7 tmp]# mkdir dabao</span><br><span class="line">[root@rhel7 tmp]# setfacl -d -m u:student:rwx dabao</span><br><span class="line">[root@rhel7 tmp]# getfacl dabao</span><br><span class="line"> file: dabao</span><br><span class="line"> owner: root</span><br><span class="line"> group: root</span><br><span class="line">user::rwx</span><br><span class="line">group::r-x</span><br><span class="line">other::r-x</span><br><span class="line">default:user::rwx</span><br><span class="line">default:user:student:rwx</span><br><span class="line">default:group::r-x</span><br><span class="line">default:mask::rwx</span><br><span class="line">default:other::r-x</span><br><span class="line">[root@rhel7 tmp]# ll dabao -d</span><br><span class="line">drwxr-xr-x+ 2 root root 6 Jun 22 15:09 dabao</span><br><span class="line">[root@rhel7 tmp]# touch dabao/kk</span><br><span class="line">[root@rhel7 tmp]# ll dabao</span><br><span class="line">total 4</span><br><span class="line">-rw-rw-r--+ 1 root root 0 Jun 22 15:10 kk</span><br><span class="line">[root@rhel7 tmp]# getfacl dabao/kk</span><br><span class="line"> file: dabao/kk</span><br><span class="line"> owner: root</span><br><span class="line"> group: root</span><br><span class="line">user::rw-</span><br><span class="line">user:student:rwx</span><br><span class="line">effective:rw-</span><br><span class="line">group::r-x</span><br><span class="line">effective:r--</span><br><span class="line">mask::rw-</span><br><span class="line">other::r--</span><br><span class="line"> åˆ‡æ¢ä¸º student ç”¨æˆ·</span><br><span class="line">[student@rhel7 tmp]$ cd dabao</span><br><span class="line">[student@rhel7 dabao]$ ll</span><br><span class="line">total 4</span><br><span class="line">-rw-rw-r--+ 1 root root 0 Jun 22 15:10 kk</span><br><span class="line">[student@rhel7 dabao]$ cat kk</span><br></pre></td></tr></table></figure>

<h2 id="æ–‡ä»¶å­˜å‚¨ç»“æ„"><a href="#æ–‡ä»¶å­˜å‚¨ç»“æ„" class="headerlink" title="æ–‡ä»¶å­˜å‚¨ç»“æ„"></a>æ–‡ä»¶å­˜å‚¨ç»“æ„</h2><p>Linux æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æƒé™ (rwx) ä¸æ–‡ä»¶å±æ€§ ( æ‹¥æœ‰è€…ã€ç¾¤ç»„ã€ æ—¶é—´å‚æ•°ç­‰ ) , æ–‡ä»¶ç³»ç»Ÿä¼šå°†è¿™ä¸¤éƒ¨åˆ†<br>çš„æ•°æ®åˆ†åˆ«å­˜æ”¾åœ¨ä¸åŒçš„åŒºå— , æƒé™ä¸å±æ€§æ”¾ç½®åˆ° inode ä¸­ , å®é™…æ•°æ®åˆ™æ”¾ç½®åˆ° data block åŒºå—ä¸­ã€‚<br>å¦å¤– , è¿˜æœ‰ä¸€ä¸ªè¶…çº§åŒºå— (superblock) ä¼šè®°å½•æ•´ä¸ª æ–‡ä»¶ç³»ç»Ÿçš„æ•´ä½“ä¿¡æ¯ , åŒ…æ‹¬ inode å’Œ block<br>çš„æ€»é‡ã€ä½¿ç”¨é‡ã€å‰©ä½™é‡ç­‰ã€‚</p>
<p><img src="pic/07.png" alt="07"></p>
<ul>
<li>æ–‡ä»¶çš„å±æ€§å’Œæƒé™æ•°æ® â€“&gt; æ”¾ç½®åˆ° inode 4 å·</li>
<li>æ–‡ä»¶æ•°æ®çš„å®é™…æ”¾ç½®ç‚¹ä¸º 2, 7, 13, 15 è¿™å››ä¸ª block å·ç </li>
</ul>
<p>å¯¹äºç›®å½•: inode è®°å½•è¯¥ç›®å½•çš„ç›¸å…³æƒé™ä¸å±æ€§ , å¹¶è®°å½•åˆ†é…åˆ°çš„é‚£å— block å·ç  ; è€Œ block åˆ™<br>æ˜¯è®°å½•åœ¨è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶æˆ–ç›®å½•çš„æ–‡ä»¶åå’Œå¯¹åº”çš„ inode å·çš„æ•°æ®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p><img src="pic/08.png" alt="08"></p>
<h2 id="è½¯ç¡¬æ–¹å¼é“¾æ¥"><a href="#è½¯ç¡¬æ–¹å¼é“¾æ¥" class="headerlink" title="è½¯ç¡¬æ–¹å¼é“¾æ¥"></a>è½¯ç¡¬æ–¹å¼é“¾æ¥</h2><p>åœ¨ Linux ç³»ç»Ÿä¸­çš„ ln å‘½ä»¤èƒ½å¤Ÿè®©ç”¨æˆ·åˆ›å»ºå‡ºä¸¤ç§ä¸åŒç±»å‹çš„æ–‡ä»¶å¿«æ·æ–¹å¼,ä¸€å®šè¦æ³¨æ„åŒºåˆ†:</p>
<p>ç¡¬é“¾æ¥ (hard link) å¯ä»¥è¢«ç†è§£ä¸ºä¸€ä¸ª â€œ æŒ‡å‘åŸå§‹æ–‡ä»¶ inode çš„æŒ‡é’ˆ â€ ,ç³»ç»Ÿä¸ä¸ºå®ƒåˆ†é…ç‹¬ç«‹çš„ inode<br>ä¸æ–‡ä»¶,æ‰€ä»¥å®é™…ä¸Šæ¥è®²ç¡¬é“¾æ¥æ–‡ä»¶ä¸åŸå§‹æ–‡ä»¶å…¶å®æ˜¯åŒä¸€ä¸ªæ–‡ä»¶,åªæ˜¯åå­—ä¸åŒã€‚äºæ˜¯æ¯æ·»åŠ ä¸€ä¸ªç¡¬é“¾æ¥,<br>è¯¥æ–‡ä»¶çš„ inode è¿æ¥æ•°å°±ä¼šå¢åŠ  1 ,ç›´åˆ°è¯¥æ–‡ä»¶çš„ inode è¿æ¥æ•°å½’ 0 æ‰æ˜¯å½»åº•åˆ é™¤ã€‚æ¦‚æ‹¬æ¥è¯´å› ä¸ºç¡¬é“¾<br>æ¥å®é™…å°±æ˜¯æŒ‡å‘åŸæ–‡ä»¶ inode çš„æŒ‡é’ˆ,å³ä¾¿åŸå§‹æ–‡ä»¶è¢«åˆ é™¤ä¾ç„¶å¯ä»¥é€šè¿‡é“¾æ¥æ–‡ä»¶è®¿é—®,ä½†æ˜¯ä¸èƒ½è·¨æ–‡ä»¶<br>ç³»ç»Ÿä¹Ÿä¸èƒ½é“¾æ¥ç›®å½•æ–‡ä»¶ã€‚</p>
<p>è½¯é“¾æ¥ä¹Ÿç§°ä¸ºç¬¦å·é“¾æ¥( symbolic link )å³ â€œ ä»…ä»…åŒ…å«å®ƒç´¢è¦é“¾æ¥æ–‡ä»¶çš„è·¯å¾„å â€ å› æ­¤èƒ½åšç›®å½•é“¾æ¥ä¹Ÿ<br>å¯ä»¥è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿ,ä½†åŸå§‹æ–‡ä»¶è¢«åˆ é™¤åé“¾æ¥æ–‡ä»¶ä¹Ÿå°†å¤±æ•ˆ,å¦‚åŒ WinodwTM ä¸­çš„ â€œ å¿«æ·æ–¹å¼ â€ ã€‚</p>
<p>ln å‘½ä»¤ç”¨äºåˆ›å»ºé“¾æ¥æ–‡ä»¶,æ ¼å¼ä¸º: â€œ ln [ é€‰é¡¹ ] ç›®æ ‡ â€ ã€‚</p>
<ul>
<li>åˆ›å»ºç¡¬é“¾æ¥ :â€œln æ–‡ä»¶å é“¾æ¥å â€</li>
<li>åˆ›å»ºè½¯é“¾æ¥ :â€œln -s æ–‡ä»¶å è¿æ¥å â€</li>
</ul>
<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-s</td>
<td align="left">åˆ›å»ºâ€ç¬¦å·é“¾æ¥â€(é»˜è®¤æ˜¯ç¡¬é“¾æ¥)</td>
</tr>
<tr>
<td align="left">-f</td>
<td align="left">å¼ºåˆ¶åˆ›å»ºæ–‡ä»¶æˆ–ç›®å½•çš„é“¾æ¥</td>
</tr>
<tr>
<td align="left">-i</td>
<td align="left">è¦†ç›–å‰å…ˆè¯¢é—®</td>
</tr>
<tr>
<td align="left">-v</td>
<td align="left">æ˜¾ç¤ºåˆ›å»ºé“¾æ¥çš„è¿‡ç¨‹</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 tmp]# echo this is a &gt; file</span><br><span class="line">[root@rhel7 tmp]# cat file</span><br><span class="line">this is a</span><br><span class="line">[root@rhel7 tmp]# ll file</span><br><span class="line">-rw-r--r--. 1 root root 10 Jun 22 16:02 file</span><br><span class="line">[root@rhel7 tmp]# ln file fileh</span><br><span class="line">[root@rhel7 tmp]# ll file fileh</span><br><span class="line">[root@rhel7 tmp]# ll file fileh files -i</span><br><span class="line">52973928 -rw-r--r--. 2 root root 10 Jun 22 16:02 file</span><br><span class="line">52973928 -rw-r--r--. 2 root root 10 Jun 22 16:02 fileh</span><br><span class="line">52973930 lrwxrwxrwx. 1 root root 4 Jun 22 16:03 files -&gt; filefile</span><br></pre></td></tr></table></figure>

<p><img src="pic/09.png" alt="09"></p>
<h2 id="æŒ‡ä»¤å’Œæ–‡ä»¶çš„æœç´¢"><a href="#æŒ‡ä»¤å’Œæ–‡ä»¶çš„æœç´¢" class="headerlink" title="æŒ‡ä»¤å’Œæ–‡ä»¶çš„æœç´¢"></a>æŒ‡ä»¤å’Œæ–‡ä»¶çš„æœç´¢</h2><p>which     whereis         locate     find </p>
<h3 id="è‚‰çœ¼æŸ¥æ‰¾-ls-R"><a href="#è‚‰çœ¼æŸ¥æ‰¾-ls-R" class="headerlink" title="è‚‰çœ¼æŸ¥æ‰¾ : ls -R"></a>è‚‰çœ¼æŸ¥æ‰¾ : ls -R</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ root@www ~]# ls -R /tmp</span><br><span class="line">/tmp:</span><br><span class="line">dabao</span><br><span class="line">dabao1</span><br><span class="line">/tmp/dabao1:</span><br><span class="line">1</span><br><span class="line">/tmp/dabao1/1:</span><br><span class="line">2</span><br><span class="line">/tmp/dabao1/1/2:</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## æŒ‡ä»¤çš„æœå¯» :which</span></span></span><br><span class="line"></span><br><span class="line">which [ -a] command</span><br><span class="line"></span><br><span class="line">é€‰é¡¹ä¸å‚æ•° :</span><br><span class="line"></span><br><span class="line">-a</span><br><span class="line">- : å°†æ‰€æœ‰ç”± PATH ç›®å½•ä¸­å¯ä»¥æ‰¾åˆ°çš„æŒ‡ä»¤å‡åˆ—å‡º</span><br><span class="line">- : åªæ˜¾ç¤ºç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„</span><br><span class="line"></span><br><span class="line">æ³¨æ„ :</span><br><span class="line">1. ç³»ç»Ÿå†…å»ºå‘½ä»¤æ‰¾ä¸åˆ° , type æŸ¥çœ‹</span><br><span class="line">2. alias å‘½ä»¤åˆ«å</span><br><span class="line"></span><br><span class="line">â€‹```shell</span><br><span class="line">[ root@www ~]# which cat</span><br><span class="line">/bin/cat</span><br><span class="line">[ root@www ~]# which postfix</span><br><span class="line">/usr/sbin/postfix</span><br></pre></td></tr></table></figure>

<h3 id="æ–‡ä»¶åçš„æœå¯»-whereis-locate-find"><a href="#æ–‡ä»¶åçš„æœå¯»-whereis-locate-find" class="headerlink" title="æ–‡ä»¶åçš„æœå¯» :whereis, locate, find"></a>æ–‡ä»¶åçš„æœå¯» :whereis, locate, find</h3><h4 id="whereis"><a href="#whereis" class="headerlink" title="whereis"></a>whereis</h4><p>whereis [ -bmsu] [ -BMS directoryâ€¦-f] filename..</p>
<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-b</td>
<td align="left">åªå¯»æ‰¾ binary äºŒè¿›åˆ¶ æ ¼å¼çš„æ–‡ä»¶</td>
</tr>
<tr>
<td align="left">-m</td>
<td align="left">åªå¯»æ‰¾åœ¨ è¯´æ˜æ–‡ä»¶ manual è·¯å¾„ä¸‹çš„æ–‡ä»¶</td>
</tr>
<tr>
<td align="left">-s</td>
<td align="left">åªå¯»æ‰¾ source æ¥æºçš„æ–‡ä»¶</td>
</tr>
<tr>
<td align="left">-u</td>
<td align="left">æœå¯»ä¸åœ¨ä¸Šè¿°ä¸‰ä¸ªé¡¹ç›®å½“ä¸­çš„å…¶ä»–ç‰¹æ®Šæ–‡ä»¶</td>
</tr>
<tr>
<td align="left">-l</td>
<td align="left">æŸ¥çœ‹ whereis å¯æœå¯»çš„è·¯å¾„</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ root@www ~]# whereis /etc/passwd</span><br><span class="line">passwd: /usr/bin/passwd /etc/passwd.OLD /etc/passwd /usr/share/man/man1/passwd.1.gz</span><br><span class="line">/usr/share/man/man5/passwd.5.gz</span><br><span class="line">[ root@www ~]# whereis man</span><br><span class="line">man: /usr/bin/man /etc/man.config /usr/share/man /usr/share/man/man7/man.7.gz</span><br><span class="line">/usr/share/man/man1p/man.1p.gz /usr/share/man/man1/man.1.gz</span><br></pre></td></tr></table></figure>

<h4 id="locate"><a href="#locate" class="headerlink" title="locate"></a>locate</h4><p>locate [ -ir] keyword</p>
<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-i</td>
<td align="left">å¿½ç•¥å¤§å°å†™çš„å·®å¼‚ ;</td>
</tr>
<tr>
<td align="left">-r</td>
<td align="left">åé¢å¯æ¥æ­£è§„è¡¨ç¤ºæ³•çš„æ˜¾ç¤ºæ–¹å¼</td>
</tr>
</tbody></table>
<ul>
<li>å®‰è£…è½¯ä»¶ <code>mlocate</code> ä¹‹åæ‰ä¼šæœ‰ <code>updatedb</code> å‘½ä»¤å’Œ <code>locate</code> å‘½ä»¤,æœ€å°åŒ–å®‰è£…çš„ rhel ç³»ç»Ÿé»˜è®¤ä¸å®‰è£…ã€‚</li>
<li><code>locate</code> å¯»æ‰¾çš„æ•°æ®æ˜¯ç”±ã€å·²å»ºç«‹çš„æ•°æ®åº“ <code>/var/lib/mlocate/mlocate.db</code> é‡Œé¢çš„æ•°æ®æ‰€æœ<br>å¯»åˆ° , æ‰€ä»¥ä¸ç”¨ç›´æ¥åœ¨å»ç¡¬ç›˜ä¸­å­˜å–æ•°æ® , é€Ÿåº¦å¿«</li>
<li><code>updatedb</code>: æ ¹æ® <code>/etc/updatedb.conf</code> çš„è®¾å®šå»æœå¯»ç³»ç»Ÿç¡¬ç›˜å†…çš„æ–‡ä»¶å , å¹¶æ›´æ–°<code>/var/lib/mlocate.mlocate.db</code></li>
<li><code>PRUNEPATHS = &quot;/afs /media /net /sfs /tmp /udev /var/cache/ccache /var/spool/cups /var/spool/squid /var/tmp&quot;</code> &lt;== è®¾å®šäº†ä¸æœå¯»çš„ç›®å½•</li>
</ul>
<h4 id="find"><a href="#find" class="headerlink" title="find"></a>find</h4><p>find [ PATH] [ option] [ action]</p>
<p>é€‰é¡¹ä¸å‚æ•° :</p>
<ol>
<li>ä¸æ—¶é—´æœ‰å…³ :-atime, -ctime ,-mtime , ä»¥ -mtime è¯´æ˜</li>
</ol>
<ul>
<li>-mtime n</li>
<li>-mtime +n</li>
<li>-mtime -n</li>
<li>-newer file : åˆ—å‡ºæ¯” file è¿˜è¦æ–°çš„æ¡£æ¡ˆ</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if n= 2 now= 2015/12/24</span><br><span class="line">then</span><br><span class="line">-mtime 2:  2015/12/22 å½“å¤©å†…å®¹æ”¹è¿‡çš„æ–‡ä»¶</span><br><span class="line">-mtime +2: 2 å¤©ä¹‹å‰ , 2015/12/22 ä¹‹å‰è¢«å®¹è¢«æ”¹è¿‡çš„æ–‡ä»¶ , åŠ 21\20\19...</span><br><span class="line">-mtime -2: 2 å¤©ä»¥å†… , 2015/12/24 å’Œ 2015/12/23 å·ä¿®æ”¹è¿‡çš„æ–‡ä»¶</span><br><span class="line">&lt;--|--|--|--|--|--|--|--|--|--|--|2-|--|--|</span><br><span class="line">&lt;----------------------------+2-&gt;|--|--|--|</span><br><span class="line">&lt;--|--|--|--|--|--|--|--|--|--|--|--|&lt;-2-&gt;|</span><br><span class="line">11 12 13 14 15 16 17 18 19 20 21 22 23 24 ç°åœ¨</span><br></pre></td></tr></table></figure>

<ol>
<li>ä¸ç”¨æˆ·å’Œç»„æœ‰å…³</li>
</ol>
<ul>
<li>-uid n</li>
<li>-gid n</li>
<li>-user name</li>
<li>-group name</li>
<li>-nouser</li>
<li>-nogroup</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ root@www ~]# find /tmp -user dabao</span><br><span class="line">/tmp/dabao</span><br><span class="line">/tmp/dabao1</span><br><span class="line">/tmp/dabao1/1</span><br><span class="line">/tmp/dabao1/1/2</span><br></pre></td></tr></table></figure>

<ol>
<li>ä¸æ¡£æ¡ˆçš„æƒé™åŠåç§°æœ‰å…³</li>
</ol>
<ul>
<li>-name filename: æœå¯»æ–‡ä»¶åä¸º filename çš„æ–‡ä»¶ ;</li>
<li>-size [ +-]SIZE: SIZE çš„è§„æ ¼æœ‰</li>
<li>c: ä»£è¡¨ byte</li>
<li>k: ä»£è¡¨ 1024bytes w: å­—æ•° , å ä¸¤ä¸ªå­—ç¬¦ M\G</li>
<li>-type TYPE:f æ™®é€šæ–‡ä»¶ d ç›®å½• l é“¾æ¥æ–‡ä»¶</li>
<li>-perm mode : æ–‡ä»¶æƒé™ã€åˆšå¥½ç­‰äºã€ mode çš„æ¡£æ¡ˆ mode èŒƒå›´ : 7777 ~ 0000</li>
<li>-perm -mode: æ–‡ä»¶æƒé™ã€å¿…é¡»è¦å…¨éƒ¨å›Šæ‹¬ mode æƒé™ã€</li>
<li>-perm +mode: æ–‡ä»¶æƒé™ã€åŒ…å« mode æƒé™ã€çš„æ–‡ä»¶</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ root@www ~]# find /tmp -name "*da*"</span><br><span class="line">/tmp/dabao</span><br><span class="line">/tmp/orbit-root/linc-bd3-0-5dc8fa181da</span><br><span class="line">/tmp/orbit-root/linc-da1-0-76ab0a1c521dd</span><br><span class="line">/tmp/orbit-root/linc-cc4-0-c0fda335ced5</span><br><span class="line">/tmp/dabao1</span><br><span class="line">[ root@www ~]# find /tmp -type f</span><br><span class="line">/tmp/pulse-BzLrQ7uHulwz/pid</span><br><span class="line">/tmp/.X0-lock</span><br><span class="line">/tmp/dabao</span><br><span class="line">/tmp/orbit-root/bonobo-activation-server-23d28d39cfff8983f6cac2ca00000055-ior</span><br><span class="line">/tmp/orbit-root/bonobo-activation-register-23d28d39cfff8983f6cac2ca00000055.lock</span><br><span class="line">/tmp/lurakm9.tmp/luraktg.tmp</span><br><span class="line">/tmp/lurakm9.tmp/lurakt2.tmp</span><br><span class="line">/tmp/lurakm9.tmp/lurakvs.tmp</span><br></pre></td></tr></table></figure>

<ol>
<li>é¢å¤–åŠ¨ä½œ</li>
</ol>
<p>-exec [ å‘½ä»¤ ] : åé¢å¯å†æ¥é¢å¤–çš„å‘½ä»¤æ¥å¤„ç†æœå¯»åˆ°çš„ç»“æœ</p>
<p><code>find / -perm +7000 -exec ls -l {} \;</code><br>&lt;= = å›ºå®šæ ¼å¼ : <code>find [ è·¯å¾„ å‚æ•° ] -exec [ å‘½ä»¤ ] {} \;</code></p>
<p>-ok        æ ¼å¼åŒ-execï¼ŒåŒºåˆ«okä¼šå¸¦æç¤ºï¼ˆäº¤äº’å¼çš„æ‰¾åˆ°åæ˜¯å¦æ‰§è¡Œè¯¥å‘½ä»¤ï¼‰</p>
<p>-print: å°†ç»“æœè¾“å‡ºå±å¹•ä¸Š , é¢„è®¾åŠ¨ä½œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ root@www ~]# find /tmp -name "dabao*" -exec ls -l &#123;&#125; \;</span><br><span class="line">-rwxrwxrwx+ 1 dabao dabao 0 Mar 21 06:09 /tmp/dabao</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x. 3 dabao dabao 4096 Mar 21 06:11 1</span><br></pre></td></tr></table></figure>

<h2 id="Linux-æ–‡ä»¶å’Œç›®å½•ä½œä¸š"><a href="#Linux-æ–‡ä»¶å’Œç›®å½•ä½œä¸š" class="headerlink" title="Linux æ–‡ä»¶å’Œç›®å½•ä½œä¸š"></a>Linux æ–‡ä»¶å’Œç›®å½•ä½œä¸š</h2><h3 id="UGO-æƒé™ä½œä¸š"><a href="#UGO-æƒé™ä½œä¸š" class="headerlink" title="UGO æƒé™ä½œä¸š"></a>UGO æƒé™ä½œä¸š</h3><ol>
<li>æŸ¥çœ‹ /var/spool/mail ä¸‹æ‰€æœ‰æ–‡ä»¶ , å¹¶æŒ‡å‡ºå…¶æ‹¥æœ‰è€…å’Œæ‰€å±ç»„åˆ† åˆ«æ˜¯è° , å…¶æ‹¥æœ‰è€…å’Œæ‰€å±ç»„å¯¹åº”çš„<br>æƒé™åˆ†åˆ«æ˜¯ä»€ä¹ˆ ?</li>
<li>åœ¨ /tmp/ ç›®å½•ä¸‹åˆ›å»º 7 ä¸ªç›®å½• , ç›®å½•ååˆ†åˆ«ä¸º test1 åˆ° test7</li>
</ol>
<ul>
<li>1) å°†è¯¥ 7 ä¸ªç›®å½•çš„æ‹¥æœ‰è€…æ”¹ä¸º student ç”¨æˆ·ã€‚</li>
<li>2) åœ¨è¿™ 7 ä¸ªç›®å½•ä¸‹åˆ†åˆ«åˆ›å»º file1 å’Œ file2</li>
<li>3) é’ˆå¯¹è¿™ 7 ä¸ªç›®å½•çš„ student ç”¨æˆ·åˆ†åˆ«è®¾ç½®æ•°å­—ä¸º 1 åˆ° 7 çš„æƒé™ã€‚</li>
<li>4) åˆ†åˆ«å¯¹è¿™ä¸ª 7 ä¸ªç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ :<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls file1</span><br><span class="line">ls -l file1</span><br><span class="line">cd testx</span><br><span class="line">touch file3</span><br><span class="line">rm file2</span><br><span class="line">chmod 777 file1</span><br></pre></td></tr></table></figure>
å¹¶æ€»ç»“ç»“è®ºã€‚</li>
</ul>
<ol>
<li>æ–°å»ºä¸€ä¸ªç»„ , ç»„åä¸º group, è¦æ±‚å°† test1 ç›®å½•çš„æ‰€å±ç»„æ”¹ä¸º group ç»„ , å¹¶å°† test1 ç›®å½•ä¸‹çš„<br>æ‰€æœ‰æ–‡ä»¶çš„æ‰€å±ç»„éƒ½æ”¹ä¸º group ç»„ã€‚</li>
</ol>
<h3 id="ç‰¹æ®Šæƒé™ä½œä¸š"><a href="#ç‰¹æ®Šæƒé™ä½œä¸š" class="headerlink" title="ç‰¹æ®Šæƒé™ä½œä¸š"></a>ç‰¹æ®Šæƒé™ä½œä¸š</h3><ol>
<li>åœ¨ /tmp/ ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª testdir ç›®å½• , è¦æ±‚ä»»ä½•äººåœ¨è¯¥ç›®å½•ä¸‹ åˆ›å»ºçš„æ–‡ä»¶éƒ½åªèƒ½ç”±è‡ªå·±æˆ–è€…ç›®å½•<br>æ‹¥æœ‰è€…å»åˆ é™¤ , å…¶ä½™äººä¸èƒ½å¤Ÿ å»åˆ é™¤ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ , è®©ä»»ä½•äººæ‰§è¡Œè¿™ä¸ªæ–‡ä»¶æ—¶å€™ , ä¸´æ—¶æ‹¥æœ‰æ–‡ä»¶æ‹¥ æœ‰è€…çš„æƒé™ã€‚</li>
</ol>
<h3 id="ATTR-æƒé™ä½œä¸š"><a href="#ATTR-æƒé™ä½œä¸š" class="headerlink" title="ATTR æƒé™ä½œä¸š"></a>ATTR æƒé™ä½œä¸š</h3><ol>
<li>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ , æ–‡ä»¶åä»»æ„ , è¦æ±‚ , è¯¥æ–‡ä»¶çš„è®¿é—®æ—¶é—´ä¸è¢« ä¿®æ”¹ , åŒæ—¶ , è¯¥æ–‡ä»¶åªèƒ½è¢«è¿½åŠ å†…å®¹ , ä¸å…è®¸è¢«<br>ä¿®æ”¹å’Œåˆ é™¤ã€‚ å–æ¶ˆè¯¥æ–‡ä»¶çš„ Attr æƒé™ã€‚</li>
</ol>
<h3 id="ACL-æƒé™ä½œä¸š"><a href="#ACL-æƒé™ä½œä¸š" class="headerlink" title="ACL æƒé™ä½œä¸š"></a>ACL æƒé™ä½œä¸š</h3><ol>
<li>åœ¨ /tmp ä¸‹åˆ›å»ºä¸€ä¸ª file æ–‡ä»¶ , è¦æ±‚ student ç”¨æˆ·å¯¹ file æœ‰å®Œæ•´ çš„æƒé™ ,kevin ç”¨æˆ·å¯¹<br>file æœ‰ rw- çš„æƒé™ ,carol ç”¨æˆ·å¯¹ file æœ‰ -wx çš„æƒé™ ,natasha ç”¨æˆ·å¯¹è¯¥æ–‡ä»¶æœ‰ râ€“ çš„æƒé™ã€‚</li>
<li>æ¸…ç©º file çš„ attr æƒé™ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç³»ç»ŸåŸºç¡€åŸ¹è®­</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux è½¯ä»¶å®‰è£…</title>
    <url>/2016/12/22/booboo_linux_base/05-Linux%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h2 id="æºä»£ç å®‰è£…"><a href="#æºä»£ç å®‰è£…" class="headerlink" title="æºä»£ç å®‰è£…"></a>æºä»£ç å®‰è£…</h2><ul>
<li>ä¼˜åŠ¿ : å¯å®šåˆ¶ï¼Œç´§è·Ÿå‘å¸ƒï¼ŒåŠæ—¶ä¿®æ­£Bug</li>
<li>ç¼ºç‚¹ : æ“ä½œå¤æ‚ , ç¼–è¯‘æ—¶é—´é•¿ , ææ˜“å‡ºç°é”™è¯¯ï¼Œå¤§é¢ç§¯éƒ¨ç½²å¤æ‚ä¸”ä½æ•ˆï¼Œå®‰å…¨æ€§éšæ‚£å¤§</li>
</ul>
<h3 id="æºä»£ç å®‰è£…æ­¥éª¤"><a href="#æºä»£ç å®‰è£…æ­¥éª¤" class="headerlink" title="æºä»£ç å®‰è£…æ­¥éª¤"></a>æºä»£ç å®‰è£…æ­¥éª¤</h3><ul>
<li>ä¸‹è½½è§£å‹,é˜…è¯»è½¯ä»¶åŒ…é™„å¸¦çš„ install æ–‡ä»¶å’Œ readme æ–‡ä»¶,è·å–è½¯ä»¶çš„ç›¸å…³ä¿¡æ¯ã€‚</li>
<li>è¿›å…¥è§£åŒ…ä¹‹åçš„ç›®å½•,æ‰§è¡Œ â€œ ./configureâ€ å‘½ä»¤ï¼Œä½¿ç”¨å‚æ•°è®¾ç½®ç¼–è¯‘ç¯å¢ƒå’Œç¼–è¯‘æ¨¡å—ï¼Œä¾‹å¦‚<code>--prefix</code>ä¸ºç¼–è¯‘åšå¥½å…³äºæœ¬åœ°ç¯å¢ƒçš„é…ç½®ã€‚</li>
<li>é…ç½®æˆåŠŸå,æ‰§è¡Œ â€œ makeâ€ å‘½ä»¤è¿›è¡Œè½¯ä»¶ç¼–è¯‘ã€‚</li>
<li>ç¼–è¯‘æˆåŠŸå,æ‰§è¡Œ â€œ make installâ€ å‘½ä»¤å®Œæˆå®‰è£…ã€‚</li>
<li>æœ€å,æ‰§è¡Œ â€œ make cleanâ€ å‘½ä»¤åˆ é™¤å®‰è£…æ—¶äº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶</li>
</ul>
<h3 id="å¸è½½æ­¥éª¤"><a href="#å¸è½½æ­¥éª¤" class="headerlink" title="å¸è½½æ­¥éª¤"></a>å¸è½½æ­¥éª¤</h3><ul>
<li>å…ˆè¿›å…¥è½¯ä»¶çš„å®‰è£…ç›®å½•,ç„¶åæ‰§è¡Œå¸è½½å‘½ä»¤å³å¯:<code>make uninstall</code></li>
<li>å¦‚æœæœ‰çš„è½¯ä»¶åŒ…ä¸æä¾› uninstall åŠŸèƒ½,åˆ™å¿…é¡»è¿›è¡Œæ‰‹åŠ¨åˆ é™¤ã€‚å› æ­¤ä½ éœ€è¦é˜…è¯»å®‰è£…ç›®å½•é‡Œé¢çš„readme æ–‡ä»¶,æˆ–è€…åœ¨å®‰è£…çš„è¿‡ç¨‹ä¸­æŒ‡å®šå®‰è£…ç›®å½•,å³åœ¨ ./configure å‘½ä»¤åé¢æ·»åŠ å‚æ•° â€“prefix ,ä¾‹å¦‚:<code>./configure --prefix=/usr/local/dir</code></li>
<li>è¯¥å‘½ä»¤å°†æŠŠè½¯ä»¶å®‰è£…åœ¨ /usr/local/ è·¯å¾„çš„ dir ç›®å½•é‡Œã€‚é€šå¸¸æƒ…å†µä¸‹,å¤§å¤šæ•°è½¯ä»¶éƒ½é»˜è®¤å®‰è£…åœ¨ /usr/local ç›®å½•é‡Œã€‚</li>
</ul>
<h3 id="MPlayeræºç å®‰è£…å®éªŒ"><a href="#MPlayeræºç å®‰è£…å®éªŒ" class="headerlink" title="MPlayeræºç å®‰è£…å®éªŒ"></a>MPlayeræºç å®‰è£…å®éªŒ</h3><blockquote>
<p>ä¸‹è½½è½¯ä»¶åŒ…åˆ°ç³»ç»ŸæŸä¸ªç›®å½•ä¸‹ï¼Œæœ¬æ¬¡æ¼”ç¤ºä¸­ä½¿ç”¨/tmp/mplayer/ç›®å½•ï¼Œè½¯ä»¶åŒ…åŒ…æ‹¬ä¸»ç¨‹åºã€åº“å‡½æ•°ã€çš®è‚¤</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget ....</span><br><span class="line">all-20071007.tar.bz2	åº“å‡½æ•°</span><br><span class="line">Blue-1.7.tar.bz2	çš®è‚¤</span><br><span class="line">MPlayer-1.0rc2.tar.bz2	ä¸»ç¨‹åº</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å°†å‹ç¼©åŒ…è§£å‹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -jxf</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ›å»ºç›®å½•ç”¨æ¥å­˜æ”¾åº“å‡½æ•°</p>
</blockquote>
<p><code>mkdir  /usr/local/lib/codes</code></p>
<blockquote>
<p>å°†/tmp/mplayer/all/ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°/usr/local/lib/codes</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp all-20071007/* /usr/local/lib/codes</span><br><span class="line">ll /usr/local/lib/codes</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®‰è£…ä¾èµ–åŒ…</p>
</blockquote>
<p><code>yum install -y kernel-devel gcc  zlib-devel  gtk2-devel</code></p>
<blockquote>
<p>æ£€æŸ¥å®‰è£…ç¯å¢ƒ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /tmp/mplayer/MPlayer-1.0rc2</span><br><span class="line">./configure --enable-gui --codecsdir=/usr/local/lib/codes --enable-x11  --enable-xshape  --language=zh_CN --disable-ivtv --disable-png</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç¼–è¯‘make</p>
</blockquote>
<p><code>make</code></p>
<blockquote>
<p>å®‰è£…</p>
</blockquote>
<p><code>make install</code></p>
<blockquote>
<p>è£…çš®è‚¤</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¿™éƒ¨åˆ†ä¸æ˜¯ä»£ç ï¼Œè€Œæ˜¯ç¨‹åºè£…åœ¨äº†å“ªé‡Œ</span><br><span class="line">  Install prefix: /usr/local</span><br><span class="line">  Data directory: /usr/local/share/mplayer</span><br><span class="line">  Config direct.: /usr/local/etc/mplayer</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ›å»ºç›®å½•<code>mkdir /usr/local/share/mplayer/skins/default/</code></li>
<li>å°†çš®è‚¤æ–‡ä»¶å¤åˆ¶åˆ°/usr/local/share/mplayer/default/ç›®å½•ä¸­<br><code>cp /tmp/mplayer/Blue/* /usr/local/share/mplayer/skins/default/</code></li>
</ul>
<blockquote>
<p>ä»çœŸæœºæ¡Œé¢ç”¨é¼ æ ‡åŒå‡»æ‰“å¼€å›¾å½¢åŒ–ç•Œé¢çš„rhel6ï¼Œå»æµ‹è¯•ï¼Œæ˜¯å¦å®‰è£…æˆåŠŸã€‚</p>
</blockquote>
<p><code>applications---&gt;sound&amp;video----&gt;mplayer</code></p>
<hr>
<h2 id="äºŒè¿›åˆ¶å®‰è£…"><a href="#äºŒè¿›åˆ¶å®‰è£…" class="headerlink" title="äºŒè¿›åˆ¶å®‰è£…"></a>äºŒè¿›åˆ¶å®‰è£…</h2><p>ç›´æ¥è§£å‹ç¼©å³å¯ä½¿ç”¨</p>
<p>ä¾‹å¦‚ mycat æ•°æ®åº“ä»£ç†æœåŠ¡å™¨<br>å®‰è£… mycat ,ç›´æ¥è§£å‹ç¼©å³å¯ä½¿ç”¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar xf Mycat-server-1.5.1-RELEASE-20160328130228-linux.tar.gz -C /usr/local</span><br><span class="line">cd /usr/local;ls</span><br><span class="line">cd mycat;ll</span><br><span class="line">chmod 755 * -R</span><br><span class="line">vim conf/schema.xml</span><br><span class="line">vim conf/server.xml</span><br><span class="line">bin/mycat start</span><br></pre></td></tr></table></figure>

<h2 id="RPM"><a href="#RPM" class="headerlink" title="RPM"></a>RPM</h2><p>RPM : redhat package management</p>
<p>rpm å‘½ä»¤æ˜¯ RPM è½¯ä»¶åŒ…çš„ç®¡ç†å·¥å…·ã€‚ rpm åŸæœ¬æ˜¯ Red Hat Linux å‘è¡Œç‰ˆä¸“é—¨ç”¨æ¥ç®¡ç† Linux å„é¡¹å¥—ä»¶çš„ç¨‹åº,ç”±äºå®ƒéµå¾ª GPL è§„åˆ™ä¸”åŠŸèƒ½å¼ºå¤§æ–¹ä¾¿,å› è€Œå¹¿å—æ¬¢è¿ã€‚é€æ¸å—åˆ°å…¶ä»–å‘è¡Œç‰ˆçš„é‡‡ç”¨ã€‚ RPM å¥—ä»¶ç®¡ç†æ–¹å¼çš„å‡ºç°,è®© Linux æ˜“äºå®‰è£…,å‡çº§,é—´æ¥æå‡äº† Linux çš„é€‚ç”¨åº¦ã€‚</p>
<p>rpm çš„å‘½åè§„èŒƒ : è½¯ä»¶å - ç‰ˆæœ¬å· - æ“ä½œç³»ç»Ÿå¹³å°</p>
<p>libreoffice4.1-calc-4.1.6.2-1.x86_64.rpm</p>
<p>zlib-1.2.3-29.el6.x86_64.rpm</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¯­æ³• rpm ( é€‰é¡¹ )( å‚æ•° )</span><br><span class="line"></span><br><span class="line">é€‰é¡¹</span><br><span class="line"></span><br><span class="line">-a :æŸ¥è¯¢æ‰€æœ‰å¥—ä»¶;</span><br><span class="line">-b&lt; å®Œæˆé˜¶æ®µ &gt;&lt; å¥—ä»¶æ¡£ &gt;+ æˆ– -t &lt; å®Œæˆé˜¶æ®µ &gt;&lt; å¥—ä»¶æ¡£ &gt;+ :è®¾ç½®åŒ…è£…å¥—ä»¶çš„å®Œæˆé˜¶æ®µ,å¹¶æŒ‡å®šå¥—ä»¶æ¡£çš„æ–‡ä»¶åç§°;</span><br><span class="line">-c :åªåˆ—å‡ºç»„æ€é…ç½®æ–‡ä»¶,æœ¬å‚æ•°éœ€é…åˆ "-l" å‚æ•°ä½¿ç”¨;</span><br><span class="line">-d :åªåˆ—å‡ºæ–‡æœ¬æ–‡ä»¶,æœ¬å‚æ•°éœ€é…åˆ "-l" å‚æ•°ä½¿ç”¨;</span><br><span class="line">-e&lt; å¥—ä»¶æ¡£ &gt; æˆ– --erase&lt; å¥—ä»¶æ¡£ &gt; :åˆ é™¤æŒ‡å®šçš„å¥—ä»¶;</span><br><span class="line">-f&lt; æ–‡ä»¶ &gt;+ :æŸ¥è¯¢æ‹¥æœ‰æŒ‡å®šæ–‡ä»¶çš„å¥—ä»¶;</span><br><span class="line">-h æˆ– --hash :å¥—ä»¶å®‰è£…æ—¶åˆ—å‡ºæ ‡è®°;</span><br><span class="line">-i :æ˜¾ç¤ºå¥—ä»¶çš„ç›¸å…³ä¿¡æ¯;</span><br><span class="line">-i&lt; å¥—ä»¶æ¡£ &gt; æˆ– --install&lt; å¥—ä»¶æ¡£ &gt; :å®‰è£…æŒ‡å®šçš„å¥—ä»¶æ¡£;</span><br><span class="line">-l :æ˜¾ç¤ºå¥—ä»¶çš„æ–‡ä»¶åˆ—è¡¨;</span><br><span class="line">-p&lt; å¥—ä»¶æ¡£ &gt;+ :æŸ¥è¯¢æŒ‡å®šçš„ RPM å¥—ä»¶æ¡£;</span><br><span class="line">-q :ä½¿ç”¨è¯¢é—®æ¨¡å¼,å½“é‡åˆ°ä»»ä½•é—®é¢˜æ—¶, rpm æŒ‡ä»¤ä¼šå…ˆè¯¢é—®ç”¨æˆ·;</span><br><span class="line">-R :æ˜¾ç¤ºå¥—ä»¶çš„å…³è”æ€§ä¿¡æ¯;</span><br><span class="line">-s :æ˜¾ç¤ºæ–‡ä»¶çŠ¶æ€,æœ¬å‚æ•°éœ€é…åˆ "-l" å‚æ•°ä½¿ç”¨;</span><br><span class="line">-U&lt; å¥—ä»¶æ¡£ &gt; æˆ– --upgrade&lt; å¥—ä»¶æ¡£ &gt; :å‡çº§æŒ‡å®šçš„å¥—ä»¶æ¡£;</span><br><span class="line">-v :æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹;</span><br><span class="line">-vv :è¯¦ç»†æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹,ä¾¿äºæ’é”™ã€‚</span><br><span class="line"></span><br><span class="line">å‚æ•° è½¯ä»¶åŒ…:æŒ‡å®šè¦æ“çºµçš„ rpm è½¯ä»¶åŒ…ã€‚</span><br><span class="line"></span><br><span class="line">å®ä¾‹</span><br><span class="line">install å®‰è£…</span><br><span class="line">1)rpm -ivh [x.rpm] å®‰è£… v\h æ˜¾ç¤ºå®‰è£…è¿‡ç¨‹ä¸­çš„è¿›åº¦æ¡ verbose\hash</span><br><span class="line">query æŸ¥è¯¢</span><br><span class="line">2)rpm -q [ è½¯ä»¶åç§° ] æŸ¥çœ‹è½¯ä»¶æ˜¯å¦å®‰è£…</span><br><span class="line">3)rpm -qi [ è½¯ä»¶åç§° ] æŸ¥çœ‹è½¯ä»¶çš„è¯¦ç»†ä¿¡æ¯</span><br><span class="line">4)rpm -ql [ è½¯ä»¶åç§° ] æŸ¥çœ‹è½¯ä»¶åœ¨ç³»ç»Ÿä¸­å®‰è£…è¿‡çš„æ–‡ä»¶</span><br><span class="line">5)rpm -qf [ æ–‡ä»¶åç§° ] æŸ¥çœ‹æ–‡ä»¶æ˜¯ç”±å“ªä¸ªè½¯ä»¶åŒ…å®‰è£…å‡ºæ¥çš„</span><br><span class="line">6)rpm -qa æŸ¥çœ‹ç³»ç»Ÿé‡Œæ‰€æœ‰å·²ç»å®‰è£…è¿‡çš„è½¯ä»¶åŒ…</span><br><span class="line">å¸è½½ remove</span><br><span class="line">6)rpm -e [ è½¯ä»¶åç§° ] å¸è½½è½¯ä»¶</span><br><span class="line">rpm -e --nodeps ä¸å¸è½½ä¾èµ–å…³ç³»</span><br><span class="line">update å‡çº§</span><br><span class="line">7)rpm -U [ è½¯ä»¶åç§° ] å‡çº§ , è‹¥æ²¡æœ‰è¯¥è½¯ä»¶åˆ™å®‰è£…</span><br><span class="line">8)rpm -F [ è½¯ä»¶åç§° ] å‡çº§ , è‹¥æ²¡æœ‰è¯¥è½¯ä»¶åˆ™ä¸å®‰è£…</span><br></pre></td></tr></table></figure>


<h2 id="YUM"><a href="#YUM" class="headerlink" title="YUM"></a>YUM</h2><h3 id="yum-çš„ä½œç”¨"><a href="#yum-çš„ä½œç”¨" class="headerlink" title="yum çš„ä½œç”¨"></a>yum çš„ä½œç”¨</h3><p>ä½œç”¨ : ä¸ºäº†è§£å†³åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»è€Œå­˜åœ¨çš„ä¸€ç§ç®¡ç†æœºåˆ¶ , åŸºäº rpm ä¸ºå‰ç«¯çš„åŒ…ç®¡ç†æœºåˆ¶ .<br>ä¸ºäº†è§£å†³ä¾èµ–å…³ç³» , å¼•å…¥äº†ä¸€ç§ä»“åº“çš„æœºåˆ¶ .</p>
<h3 id="yum-ä»“åº“"><a href="#yum-ä»“åº“" class="headerlink" title="yum ä»“åº“"></a>yum ä»“åº“</h3><p>ä»“åº“ : ç”¨æ¥å­˜æ”¾è½¯ä»¶å’Œè½¯ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³» , å½“æˆ‘ä»¬éœ€è¦å®‰è£…è½¯ä»¶çš„æ—¶å€™ , å°±å¯ä»¥é€šè¿‡è¯¥ä¾èµ–å…³ç³» , æ¥å°†ç›¸åº”çš„ä¾èµ–åŒ…éƒ½è£…ä¸Š .repodata ç›®å½•å°±æ˜¯ yum çš„ä»“åº“ , å­˜æ”¾è½¯ä»¶å’Œè½¯ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»æ•°æ® .</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 dvd]# ll repodata/ -d</span><br><span class="line">dr-xr-xr-x. 2 root root 4096 Nov 12</span><br><span class="line">[root@rhel6 dvd]#pwd</span><br><span class="line">/mnt/rhel6.5/x86_64/dvd</span><br></pre></td></tr></table></figure>

<h3 id="ä¾èµ–å…³ç³»"><a href="#ä¾èµ–å…³ç³»" class="headerlink" title="ä¾èµ–å…³ç³»"></a>ä¾èµ–å…³ç³»</h3><p>å®‰è£…ç³»ç»Ÿçš„å…‰ç›˜ä¸­å·²ç»æœ‰å»ºå·çš„ä¾èµ–å…³ç³»äº†,å³ repodata/ ç›®å½•,å¦‚æœè¦è‡ªå·±æ‰‹åŠ¨åˆ¶ä½œ rpm åŒ…ä¾èµ–å…³ç³»ç›®å½•,è¯¥æ€ä¹ˆåšå‘¢?</p>
<h4 id="å®‰è£…è½¯ä»¶-createrepo"><a href="#å®‰è£…è½¯ä»¶-createrepo" class="headerlink" title="å®‰è£…è½¯ä»¶ createrepo"></a>å®‰è£…è½¯ä»¶ createrepo</h4><p>rhel7 é»˜è®¤å·²ç»å®‰è£…</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# yum install -y createrepo</span><br><span class="line">Loaded plugins: langpacks, product-id, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager</span><br><span class="line">to register.</span><br><span class="line">server</span><br><span class="line">| 4.1 kB 00:00:00</span><br><span class="line">(1/2): server/group_gz</span><br><span class="line">| 134 kB 00:00:00</span><br><span class="line">(2/2): server/primary_db</span><br><span class="line">| 3.4 MB 00:00:00</span><br><span class="line">Package createrepo-0.9.9-23.el7.noarch already installed and latest version</span><br><span class="line">Nothing to do</span><br></pre></td></tr></table></figure>
<p>rhel6 è¦è‡ªå·±å®‰è£…</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 rc.d]# yum install -y createrepo</span><br><span class="line">Loaded plugins: product-id, refresh-packagekit, security, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager</span><br><span class="line">to register.</span><br><span class="line">server</span><br><span class="line">Running Transaction</span><br><span class="line">Installing : deltarpm-3.5-0.5.20090913git.el6.x86_64</span><br><span class="line">1/3</span><br><span class="line">Installing : python-deltarpm-3.5-0.5.20090913git.el6.x86_64</span><br><span class="line">2/3</span><br><span class="line">Installing : createrepo-0.9.9-18.el6.noarch</span><br><span class="line">3/3</span><br><span class="line">Verifying : createrepo-0.9.9-18.el6.noarch</span><br><span class="line">1/3</span><br><span class="line">Verifying : python-deltarpm-3.5-0.5.20090913git.el6.x86_64</span><br><span class="line">2/3</span><br><span class="line">Verifying : deltarpm-3.5-0.5.20090913git.el6.x86_64</span><br><span class="line">3/3</span><br><span class="line">Installed:</span><br><span class="line">createrepo.noarch 0:0.9.9-18.el6</span><br><span class="line">Dependency Installed:</span><br><span class="line">deltarpm.x86_64 0:3.5-0.5.20090913git.el6</span><br><span class="line">Complete!</span><br><span class="line">python-deltarpm.x86_64 0:3.5-0.5.20090913git.el64.3.2 åˆ¶ä½œ rpm åŒ…ä¾èµ–å…³ç³»ç›®å½•</span><br></pre></td></tr></table></figure>

<p>ä»¥ rhel7 ä¸ºä¾‹ä»å­¦æ ¡æœåŠ¡å™¨ä¸Šæ‹·è´ä¸€äº›è½¯ä»¶åˆ° /tmp/dvd7.1/ ç›®å½•ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 tmp]# cp /mnt/rhel7.1/x86_64/dvd/Packages/* /tmp/dvd7.1</span><br><span class="line">[root@rhel7 tmp]# cd /tmp/dvd7.1</span><br></pre></td></tr></table></figure>

<p>åˆ¶ä½œ rpm åŒ…ä¾èµ–å…³ç³»</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 dvd7.1]# createrepo /tmp/dvd7.1/</span><br><span class="line">Spawning worker 0 with 4371 pkgs</span><br><span class="line">Workers Finished</span><br><span class="line">Saving Primary metadata</span><br><span class="line">Saving file lists metadata</span><br><span class="line">Saving other metadata</span><br><span class="line">Generating sqlite DBs</span><br><span class="line">Sqlite DBs complete</span><br></pre></td></tr></table></figure>

<p>å·²ç»æˆåŠŸåˆ›å»º</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 tmp]# ll dvd7.1/ |grep repodata</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Mar 18 07:42 repodata</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®ä»“åº“"><a href="#é…ç½®ä»“åº“" class="headerlink" title="é…ç½®ä»“åº“"></a>é…ç½®ä»“åº“</h3><p>ä¸ºæ­¤ , æˆ‘ä»¬éœ€è¦ä¼˜å…ˆå»é…ç½®ä¸€ä¸ªä»“åº“æŒ‡å‘æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶çš„ä½ç½®åœ¨ /etc/yum.repos.d/ ç›®å½•ä¸‹ , ä»¥ .repo ç»“å°¾</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 tmp]# cd /etc/yum.repos.d/</span><br><span class="line">[root@rhel7 yum.repos.d]# ls</span><br><span class="line">server.repo</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ ä»“åº“å ]</span><br><span class="line">name = è¯´æ˜ä¿¡æ¯</span><br><span class="line">baseurl = æŒ‡å‘ repodata ç›®å½•çš„ä¸Šä¸€çº§ .</span><br><span class="line">enable = æ˜¯å¦å¯ç”¨è¯¥ä»“åº“ 0 ä»£è¡¨ä¸å¯ç”¨ ,1 ä»£è¡¨å¯ç”¨</span><br><span class="line">gpgcheck = æ˜¯å¦éœ€è¦æ£€æµ‹</span><br><span class="line">å…¶ä¸­ baseurl</span><br><span class="line">1. æœ¬åœ°è·¯å¾„ file:///content/rhel6.5..... ä»¥ä¸‹çœç•¥ ç¬¬ä¸‰ä¸ª / ä»£è¡¨çš„æ˜¯æ ¹ .</span><br><span class="line">2. è¿œç¨‹è·¯å¾„ åè®® :// ä½ç½®</span><br><span class="line">      ä¾‹:   http://</span><br><span class="line">       		ftp://</span><br><span class="line">       		nfs://</span><br><span class="line">       		</span><br><span class="line">[server]</span><br><span class="line">name = rhel7.1 repos</span><br><span class="line">baseurl = http://classroom.example.com/content/rhel6.5/x86_64/dvd/</span><br><span class="line">enable=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">[test]</span><br><span class="line">name = info</span><br><span class="line">baseurl=file:///tmp/dvd7.1/</span><br><span class="line">enable=1</span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></table></figure>

<p>é…ç½®å®Œä»“åº“å , éœ€è¦ä½¿ç”¨</p>
<ul>
<li>yum clean all æ¥æ¸…ç†ç¼“å­˜</li>
<li>yum makecache æ¥é‡æ–°ç”Ÿæˆç¼“å­˜ .4.5 yum å®‰è£…</li>
</ul>
<p>å®‰è£…</p>
<ul>
<li>yum install è½¯ä»¶å å®‰è£…æŒ‡å®šè½¯ä»¶</li>
<li>yum groupinstall ç»„å ç”¨æ¥å®‰è£…ä¸€ç³»åˆ—çš„è½¯ä»¶åŒ… ,</li>
<li>yum reinstall è½¯ä»¶å é‡æ–°å®‰è£…æŒ‡å®šè½¯ä»¶</li>
</ul>
<p>-y é€‰é¡¹ , å¿½ç•¥å®‰è£…è¿‡ç¨‹å‡ºç°çš„ is this okçš„äº¤äº’ä¿¡æ¯</p>
<ul>
<li>yum localinstall è½¯ä»¶å æœ¬åœ°å®‰è£…æŒ‡å®šè½¯ä»¶</li>
</ul>
<p>æŸ¥è¯¢</p>
<ul>
<li>yum list ç”¨æ¥æŸ¥è¯¢æ‰€æœ‰çš„è½¯ä»¶åŒ…</li>
<li>yum list installed ç”¨æ¥æŸ¥çœ‹å·²ç»å®‰è£…è¿‡çš„è½¯ä»¶åŒ…</li>
<li>yum search å­—ç¬¦ä¸² èƒ½å¤Ÿå°†è¯´æ˜ä¿¡æ¯é‡Œå«è¯¥å­—ç¬¦ä¸²çš„ç›¸å…³è½¯ä»¶åŒ…ç½—åˆ—å‡ºæ¥</li>
<li>yum info è½¯ä»¶åŒ…å ç”¨æ¥æŸ¥çœ‹è½¯ä»¶åŒ…çš„è¯¦ç»†ä¿¡æ¯</li>
<li>yum grouplist ç»„å ç”¨æ¥æŸ¥è¯¢ç³»ç»Ÿé‡Œæ‰€æœ‰çš„ç»„åŒ…</li>
<li>yum groupinfo ç»„å ç”¨æ¥æŸ¥è¯¢æŒ‡å®šç»„çš„ç›¸å…³ä¿¡æ¯</li>
</ul>
<p>å‡çº§</p>
<ul>
<li>yum update è½¯ä»¶å</li>
<li>yum upgrade è½¯ä»¶å</li>
</ul>
<p>ä¸¤ç§å†™æ³•æ‰§è¡Œæ•ˆæœæ²¡æœ‰åŒºåˆ«</p>
<p>å¸è½½</p>
<ul>
<li>yum remove è½¯ä»¶å</li>
</ul>
<p>ä¸è¦ä½¿ç”¨ yum å»å¸è½½ , ä¼šå°†è½¯ä»¶çš„ä¾èµ–å…³ç³»ä¸€å¹¶å¸è½½æ‰ .</p>
<h2 id="Linux-è½¯ä»¶å®‰è£…è¯¾åä½œä¸š"><a href="#Linux-è½¯ä»¶å®‰è£…è¯¾åä½œä¸š" class="headerlink" title="Linux è½¯ä»¶å®‰è£…è¯¾åä½œä¸š"></a>Linux è½¯ä»¶å®‰è£…è¯¾åä½œä¸š</h2><ol>
<li>é…ç½®ä¸€ä¸ª yum ä»“åº“ã€‚ç†Ÿæ‚‰ä¸€ä¸‹é…ç½®çš„å‡ ä¸ªå­—æ®µå†…å®¹ã€‚</li>
<li>å®‰è£… vsftpd è½¯ä»¶ã€‚</li>
<li>æŸ¥çœ‹ vsftpd è½¯ä»¶çš„å®‰è£…æ–‡ä»¶æœ‰å“ªäº›</li>
<li>æŸ¥çœ‹ä¸€ä¸‹ touch å‘½ä»¤æ˜¯ç”±å“ªä¸ªè½¯ä»¶åŒ…å®‰è£…å‡ºæ¥çš„</li>
<li>æœç´¢ä¸€ä¸‹å« bind å­—ç¬¦ä¸²çš„è½¯ä»¶åŒ…ã€‚</li>
<li>æŸ¥è¯¢ä¸€ä¸‹ httpd è½¯ä»¶æœ‰æ²¡æœ‰å®‰è£… , æ²¡æœ‰åˆ™å°†è¯¥è½¯ä»¶è£…ä¸Šã€‚</li>
<li>æŸ¥çœ‹ä¸€ä¸‹ httpd è½¯ä»¶çš„ç‰ˆæœ¬å·åŠè¯•ç”¨å¹³å°ã€‚</li>
<li>å¸è½½ vsftpd è½¯ä»¶ã€‚</li>
<li>å¸è½½ httpd è½¯ä»¶ , ä¸è¦å¸è½½ä¸å…¶æœ‰ä¾èµ–å…³ç³»çš„è½¯ä»¶åŒ…</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç³»ç»ŸåŸºç¡€åŸ¹è®­</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux Vim ç¼–è¾‘å™¨</title>
    <url>/2016/12/22/booboo_linux_base/06-Vim%E7%BC%96%E8%BE%91%E5%99%A8/</url>
    <content><![CDATA[<h2 id="Vim-ç®€ä»‹"><a href="#Vim-ç®€ä»‹" class="headerlink" title="Vim ç®€ä»‹"></a>Vim ç®€ä»‹</h2><p><img src="pic/10.png" alt="10.png"></p>
<p>Vim æ˜¯ Linux ç³»ç»Ÿä¸Šçš„æœ€è‘—åçš„æ–‡æœ¬/ ä»£ç ç¼–è¾‘å™¨,ä¹Ÿæ˜¯æ—©å¹´çš„ Viç¼–è¾‘å™¨çš„åŠ å¼ºç‰ˆï¼Œè€Œ gVim åˆ™æ˜¯å…¶ Windows ç‰ˆã€‚å®ƒçš„æœ€å¤§ç‰¹è‰²æ˜¯å®Œå…¨ä½¿ç”¨é”®ç›˜å‘½ä»¤è¿›è¡Œç¼–è¾‘ï¼Œè„±ç¦»äº†é¼ æ ‡æ“ä½œè™½ç„¶ä½¿å¾—å…¥é—¨å˜å¾—å›°éš¾,ä½†ä¸Šæ‰‹ä¹‹åé”®ç›˜æµçš„å„ç§å·§å¦™ç»„åˆæ“ä½œå´èƒ½å¸¦æ¥æä¸ºå¤§å¹…çš„æ•ˆç‡æå‡ã€‚</p>
<p>å› æ­¤ Vim å’Œç°ä»£çš„ç¼–è¾‘å™¨(å¦‚ Sublime Text)æœ‰ç€éå¸¸å·¨å¤§çš„å·®å¼‚,è€Œä¸”å…¥é—¨å­¦ä¹ æ›²çº¿é™¡å³­,éœ€è¦è®°ä½å¾ˆå¤šæŒ‰é”®ç»„åˆå’Œå‘½ä»¤,å¦‚ä»Šè¢«çœ‹ä½œæ˜¯é«˜æ‰‹ã€Geek ä»¬ä¸“ç”¨çš„ç¼–è¾‘å™¨ã€‚å°½ç®¡ Vim å·²ç»æ˜¯å¤è‘£çº§çš„è½¯ä»¶,ä½†è¿˜æ˜¯æœ‰æ— æ•°æ–°äººè¿ç€å›°éš¾å»å­¦ä¹ ä½¿ç”¨,å¯è§å…¶ç»å…¸ä¸å—æ¬¢è¿ç¨‹åº¦ã€‚</p>
<p>å¦å¤–,ç”±äº Vim çš„å¯é…ç½®æ€§éå¸¸å¼º,å„ç§æ’ä»¶ã€è¯­æ³•é«˜äº®é…è‰²æ–¹æ¡ˆç­‰å¤šä¸èƒœæ•°,æ— è®ºä½œä¸ºä»£ç ç¼–è¾‘å™¨æˆ–æ˜¯æ–‡ç¨¿æ’°å†™å·¥å…·éƒ½éå¸¸ç»™åŠ›ï¼</p>
<p>åœ¨ Linux ç³»ç»Ÿä¸­é…ç½®åº”ç”¨æœåŠ¡,å®é™…ä¸Šå°±æ˜¯åœ¨ä¿®æ”¹å®ƒçš„é…ç½®æ–‡ä»¶(é…ç½®æ–‡ä»¶å¯èƒ½æœ‰å¤šä¸ª,å…¶ä¸­åŒ…å«ä¸åŒçš„å‚æ•°), è€Œä¸”æ—¥å¸¸å·¥ä½œä¸­ä¹Ÿä¸€å®šå…ä¸äº†ç¼–å†™æ–‡æ¡£çš„äº‹æƒ…å§, è¿™äº›éƒ½æ˜¯è¦é€šè¿‡æ–‡æœ¬ç¼–è¾‘å™¨æ¥å®Œæˆçš„ã€‚</p>
<p>åœ¨çƒ­é—¨ Linux æ“ä½œç³»ç»Ÿä¸­éƒ½ä¼šé»˜è®¤å®‰è£…vimã€‚</p>
<h3 id="Vim-éš¾ä»¥é©¾é©­çš„ç¥å™¨"><a href="#Vim-éš¾ä»¥é©¾é©­çš„ç¥å™¨" class="headerlink" title="Vim - éš¾ä»¥é©¾é©­çš„ç¥å™¨"></a>Vim - éš¾ä»¥é©¾é©­çš„ç¥å™¨</h3><p>ç¥å™¨æ€»æ˜¯å¾ˆéš¾é©¾é©­çš„,ä¸»è§’æ€»å¾—ä»˜å‡ºä¸€äº›åŠªåŠ›æ‰èƒ½æ”¶è·åˆ°æ›´åŠ å¼ºå¤§çš„åŠ›é‡,å¯¹äº Vim è¿™ç§ä¸Šå¤ç¥å™¨æ¥è¯´æ›´æ˜¯å¦‚æ­¤ã€‚ç”±äºå®ƒå…¨ç¨‹ä½¿ç”¨é”®ç›˜æ“ä½œ,ä½ å¿…é¡»è®°ä½ä¸€å †å¿«æ·é”®ã€æŒ‰é”®ç»„åˆä»¥åŠå„ç§å‘½ä»¤æ‰èƒ½å¼€å§‹ä½¿ç”¨,å¾ˆå¤šé¦–æ¬¡æ¥è§¦ Vim çš„äººä¼šè§‰å¾—è¶Šå­¦è¶Šå¤æ‚è€Œä¸­é€”æ”¾å¼ƒã€‚ç„¶è€Œ,åšæŒä¸‹æ¥çš„æœ‹å‹å°±ä¼šæ¸æ¸åœ°å‘ç°è¿™ç§é”®ç›˜æµæ“ä½œçš„è®¾è®¡ç»å¦™ä¹‹å¤„!</p>
<p>å¦‚æœä½ æ˜¯ä¸€ä½ IT ç•Œäººå£«,éœ€è¦æˆ–å°†è¦ä¸ Linux ç³»ç»Ÿæ‰“äº¤é“,é‚£ä¹ˆå­¦ä¹ å¥½ Vim çš„æ“ä½œç»å¯¹èƒ½è®©ä½ çš„å·¥ä½œè½»æ¾ç™¾å€!!</p>
<p>å› ä¸ºå¾ˆå¤šæ—¶å€™, Linux ä½œä¸ºæœåŠ¡å™¨æ˜¯ä¸ä¼šå¼€å¯å›¾å½¢ç•Œé¢,å½“éœ€è¦è¿œç¨‹æ“ä½œæ—¶,ä½ åªèƒ½åˆ©ç”¨SSHâ€œ å‘½ä»¤å­—ç¬¦å¼ â€ çš„ Shell ç•Œé¢å¯¹å…¶è¿›è¡Œæ“ä½œ,è¿™æ—¶å¦‚æœä½ éœ€è¦ä¿®æ”¹æœåŠ¡å™¨ä¸Šçš„ç½‘é¡µä»£ç æˆ–é…ç½®æ–‡ä»¶,VIæˆ– VIM å‘½ä»¤å°±æ˜¯ä½ æœ€ä½³æœ€æ–¹ä¾¿ä¹Ÿæ˜¯æœ€å¼ºå¤§çš„ä¼™ä¼´äº†!ç›¸ä¿¡æˆ‘,å­¦å¥½ æ•°ç†åŒ– VIM ,èµ°éå¤©ä¸‹ä¹Ÿä¸æ€•ï¼</p>
<h3 id="Vim-å…¥é—¨å¸®åŠ©"><a href="#Vim-å…¥é—¨å¸®åŠ©" class="headerlink" title="Vim å…¥é—¨å¸®åŠ©"></a>Vim å…¥é—¨å¸®åŠ©</h3><p><img src="pic/11.png" alt="11.png"></p>
<p>ä¸‹é¢é¦–å…ˆå¯¹ Vim åšä¸€ä¸‹æœ€åŸºæœ¬çš„ä»‹ç»,å¹¶ç»™å‡ºä¸€äº›å‚è€ƒä¿¡æ¯,ä»¥æ–¹ä¾¿å¯¹ Vim ä¸ç†Ÿæ‚‰çš„è¯»è€…ä¹Ÿèƒ½å¤Ÿç†è§£å¹¶è‡ª<br>å·±æŸ¥é˜…è¿›ä¸€æ­¥ä¿¡æ¯ã€‚</p>
<p>Vim å¸¦æœ‰å®Œæ•´çš„å¸®åŠ©æ–‡æ¡£ã€‚</p>
<ol>
<li>è¿›å…¥ Vim åè¾“å…¥ â€œ :helpâ€å³å¯è®¿é—®</li>
<li>æ–°æ‰‹åœ¨æ“ä½œç³»ç»Ÿçš„å‘½ä»¤è¡Œä¸Šè¾“å…¥ vimtutor å‘½ä»¤å³å¯å¼€å§‹å­¦ä¹ ä¸€ä¸ªç®€å•çš„ 30 åˆ†é’Ÿçš„ Vim æ•™ç¨‹2 Vim å‘½ä»¤</li>
</ol>
<h3 id="Vim-æ¨¡å¼ä»‹ç»"><a href="#Vim-æ¨¡å¼ä»‹ç»" class="headerlink" title="Vim æ¨¡å¼ä»‹ç»"></a>Vim æ¨¡å¼ä»‹ç»</h3><p><img src="pic/12.png" alt="12.png"></p>
<p>ä¸å¤§éƒ¨åˆ†å…¶å®ƒç¼–è¾‘å™¨ä¸åŒ,è¿›å…¥ Vim å,ç¼ºçœçŠ¶æ€ä¸‹é”®å…¥çš„å­—ç¬¦å¹¶ä¸ä¼šæ’å…¥åˆ°æ‰€ç¼–è¾‘çš„æ–‡ä»¶ä¹‹ä¸­ã€‚Vim çš„<br>æ¨¡å¼(mode ,å¯ä»¥ç®€å•åœ°ç†è§£ä¸º â€œ çŠ¶æ€ â€ )æ¦‚å¿µéå¸¸é‡è¦ã€‚éœ€è¦çŸ¥é“,Vim æœ‰ä»¥ä¸‹å‡ ä¸ªæ¨¡å¼:</p>
<ul>
<li>æ­£å¸¸(normal)æ¨¡å¼,ç¼ºçœçš„ç¼–è¾‘æ¨¡å¼;ä¸‹é¢å¦‚æœä¸åŠ ç‰¹æ®Šè¯´æ˜,æåˆ°çš„å‘½ä»¤éƒ½ç›´æ¥åœ¨æ­£å¸¸æ¨¡å¼ä¸‹<br>è¾“å…¥;ä»»ä½•å…¶å®ƒæ¨¡å¼ä¸­éƒ½å¯ä»¥é€šè¿‡é”®ç›˜ä¸Šçš„ Esc é”®å›åˆ°æ­£å¸¸æ¨¡å¼ã€‚</li>
<li>å‘½ä»¤(command)æ¨¡å¼ ,ç”¨äºæ‰§è¡Œè¾ƒé•¿ã€è¾ƒå¤æ‚çš„å‘½ä»¤;åœ¨æ­£å¸¸æ¨¡å¼ä¸‹è¾“å…¥ â€œ :â€ (ä¸€èˆ¬å‘½ä»¤)ã€ â€œ /â€<br>(æ­£å‘æœç´¢)æˆ– â€œ ?â€(åå‘æœç´¢)å³å¯è¿›å…¥è¯¥æ¨¡å¼;å‘½ä»¤æ¨¡å¼ä¸‹çš„å‘½ä»¤è¦è¾“å…¥å›è½¦é”®(Enter)æ‰ç®—å®Œæˆã€‚</li>
<li>æ’å…¥(insert)æ¨¡å¼ ,è¾“å…¥æ–‡æœ¬æ—¶ä½¿ç”¨;åœ¨æ­£å¸¸æ¨¡å¼ä¸‹é”®å…¥ â€œ iâ€(insert )æˆ– â€œ aâ€(append)å³å¯<br>è¿›å…¥æ’å…¥æ¨¡å¼(ä¹Ÿæœ‰å¦å¤–ä¸€äº›å‘½ä»¤,å¦‚ â€œ câ€,ä¹Ÿå¯ä»¥è¿›å…¥æ’å…¥æ¨¡å¼,ä½†è¿™äº›å‘½ä»¤æœ‰å…¶å®ƒçš„ä½œç”¨)ã€‚</li>
<li>å¯è§†(visual)æ¨¡å¼ ,ç”¨äºé€‰å®šæ–‡æœ¬å—;å¯ä»¥åœ¨æ­£å¸¸æ¨¡å¼ä¸‹è¾“å…¥ â€œ vâ€(å°å†™)æ¥æŒ‰å­—ç¬¦é€‰å®š,è¾“å…¥<br>â€œVâ€ (å¤§å†™)æ¥æŒ‰è¡Œé€‰å®š,æˆ–è¾“å…¥ â€œ Ctrl-Vâ€æ¥æŒ‰æ–¹å—é€‰å®šã€‚</li>
<li>é€‰æ‹©(select)æ¨¡å¼ ,ä¸æ™®é€šçš„ Windows ç¼–è¾‘å™¨è¾ƒä¸ºæ¥è¿‘çš„é€‰æ‹©æ–‡æœ¬å—çš„æ–¹å¼;åœ¨ä»¥å¯è§†æ¨¡å¼å’Œ<br>é€‰æ‹©æ¨¡å¼ä¹‹ä¸€é€‰å®šæ–‡æœ¬å—ä¹‹å,å¯ä»¥ä½¿ç”¨ â€œ Ctrl-Gâ€ åˆ‡æ¢åˆ°å¦ä¸€æ¨¡å¼ â€”â€” è¯¥æ¨¡å¼å¾ˆå°‘åœ¨ Linux ä¸Šä½¿ç”¨,æœ¬<br>æ–‡ä¸­å°±ä¸å†ä»‹ç»äº†ã€‚</li>
</ul>
<h3 id="æ­£å¸¸æ¨¡å¼"><a href="#æ­£å¸¸æ¨¡å¼" class="headerlink" title="æ­£å¸¸æ¨¡å¼"></a>æ­£å¸¸æ¨¡å¼</h3><p><img src="pic/13.png" alt="13.png"></p>
<h3 id="å‘½ä»¤æ¨¡å¼"><a href="#å‘½ä»¤æ¨¡å¼" class="headerlink" title="å‘½ä»¤æ¨¡å¼"></a>å‘½ä»¤æ¨¡å¼</h3><p><img src="pic/14.png" alt="14.png"></p>
<h3 id="æ’å…¥æ¨¡å¼"><a href="#æ’å…¥æ¨¡å¼" class="headerlink" title="æ’å…¥æ¨¡å¼"></a>æ’å…¥æ¨¡å¼</h3><ul>
<li>i å…‰æ ‡æ‰€åœ¨ä½ç½®æ’å…¥</li>
<li>I å…‰æ ‡æ‰€åœ¨ä½ç½®è¡Œé¦–æ’å…¥</li>
<li>o å…‰æ ‡æ‰€åœ¨ä½ç½®ä¸‹æ–¹æ–°å¼€ä¸€è¡Œæ’å…¥</li>
<li>O å…‰æ ‡æ‰€åœ¨ä½ç½®ä¸Šæ–¹æ–°å¼€ä¸€è¡Œæ’å…¥</li>
<li>a å…‰æ ‡æ‰€åœ¨ä½ç½®ä¸‹ä¸€ä¸ªå­—ç¬¦çš„ä½ç½®æ’å…¥</li>
<li>A å…‰æ ‡æ‰€åœ¨ä½ç½®è¡Œè¡Œå°¾æ’å…¥</li>
</ul>
<h2 id="Vim-å®ä¾‹"><a href="#Vim-å®ä¾‹" class="headerlink" title="Vim å®ä¾‹"></a>Vim å®ä¾‹</h2><p>æœ¬å®ä¾‹ä½œä¸ºåŸºç¡€æ•™ç¨‹,æ‹“å±•éƒ¨åˆ†è§é™„å½•ã€ŠVim ç”¨æˆ·æ‰‹å†Œä¸­æ–‡ç‰ˆ 7.2ã€‹</p>
<p><img src="pic/15.png" alt="15.png"></p>
<h3 id="Vim-ç¬¬ä¸€æ­¥"><a href="#Vim-ç¬¬ä¸€æ­¥" class="headerlink" title="Vim ç¬¬ä¸€æ­¥"></a>Vim ç¬¬ä¸€æ­¥</h3><h4 id="é¦–æ¬¡è¿è¡Œ-Vim"><a href="#é¦–æ¬¡è¿è¡Œ-Vim" class="headerlink" title="é¦–æ¬¡è¿è¡Œ Vim"></a>é¦–æ¬¡è¿è¡Œ Vim</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera0 ~]# ll file1</span><br><span class="line">-rw-r--r--. 1 root root 274 Jun 24 12:19 file1</span><br><span class="line">[root@mastera0 ~]# vim file1</span><br></pre></td></tr></table></figure>

<p>ä½¿ Vim å¼€å§‹ç¼–è¾‘ä¸€ä¸ªåä¸º file1 çš„æ–‡ä»¶ã€‚å±å¹•ä¸Šçœ‹èµ·æ¥å¤§è‡´æ˜¯è¿™æ ·:</p>
<ul>
<li>â€œé»‘è‰²å—â€ ä»£è¡¨å½“å‰å…‰æ ‡ä½ç½®;</li>
<li>ä¸Šæ³¢æµªçº¿(~)è¡¨ç¤ºæ‰€åœ¨è¡Œå¹¶ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ä¸€éƒ¨åˆ†ã€‚æ¢å¥è¯è¯´,Vim å°† æ–‡ä»¶ä¹‹å¤–çš„éƒ¨åˆ†æ˜¾ç¤ºä¸ºæ³¢æµªçº¿;</li>
<li>åœ¨çª—å£çš„åº•éƒ¨, ä¸€ä¸ªæ¶ˆæ¯è¡Œæ˜¾ç¤ºè¯´å½“å‰æ­£ åœ¨ç¼–è¾‘çš„æ–‡ä»¶å« file1,å®ƒæœ‰ 16 è¡Œ,274 ä¸ªå­—ç¬¦ã€‚ä½†å‰å…‰<br>æ ‡æ‰€åœ¨ä½ç½®ä¸ºç¬¬ä¸€è¡Œçš„ç¬¬ä¸€ä½</li>
</ul>
<p><img src="pic/16.png" alt="16.png"></p>
<p>å¦‚æœæ˜¯æ–°æ–‡ä»¶å‘¢?</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera0 ~]# vim file</span><br></pre></td></tr></table></figure>

<p><img src="pic/17.png" alt="17.png"></p>
<p>åœ¨çª—å£çš„åº•éƒ¨, ä¸€ä¸ªæ¶ˆæ¯è¡Œæ˜¾ç¤ºè¯´å½“å‰æ­£ åœ¨ç¼–è¾‘çš„æ–‡ä»¶å« file,å¹¶ä¸”å®ƒæ˜¯ä¸€ä¸ªæ–°æ–‡ä»¶ã€‚</p>
<h4 id="æ’å…¥æ–‡æœ¬"><a href="#æ’å…¥æ–‡æœ¬" class="headerlink" title="æ’å…¥æ–‡æœ¬"></a>æ’å…¥æ–‡æœ¬</h4><p>Vim ç¼–è¾‘å™¨æ˜¯ä¸€ä¸ªæ¨¡å¼ç¼–è¾‘å™¨ã€‚è¿™æ„å‘³ç€åœ¨ä¸åŒçŠ¶æ€ä¸‹ç¼–è¾‘å™¨æœ‰ä¸åŒ çš„è¡Œä¸ºæ¨¡å¼ã€‚ä¸¤ä¸ªåŸºæœ¬çš„æ¨¡å¼ Normal<br>æ¨¡å¼å’Œ Insert æ¨¡å¼ã€‚åœ¨ Normal æ¨¡å¼ä¸‹ä½ é”®å…¥çš„æ¯ä¸€ä¸ªå­—ç¬¦éƒ½è¢«è§†ä¸ºä¸€ä¸ªå‘½ä»¤ã€‚è€Œåœ¨ Insert æ¨¡å¼ä¸‹é”®å…¥<br>çš„å­—ç¬¦ éƒ½ä½œä¸ºå®é™…è¦è¾“å…¥çš„æ–‡æœ¬å†…å®¹ã€‚ åˆšå¯åŠ¨æ—¶ Vim å·¥ä½œäº Normal æ¨¡å¼ã€‚è¦è¿›å…¥ Insert æ¨¡å¼ä½ éœ€è¦ä½¿<br>ç”¨â€iâ€ å‘½ ä»¤(i æ„ä¸º Insert)ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥è¾“å…¥äº†ã€‚åˆ«æ€•å‡ºé”™, é”™äº†è¿˜å¯ä»¥ä¿® æ”¹ã€‚æ¯”å¦‚ä¸‹é¢è¿™é¦–ç¨‹åº<br>å‘˜çš„æ‰“æ²¹è¯—:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">A very intelligent turtle</span><br><span class="line">Found programming UNIX a hurdle</span><br></pre></td></tr></table></figure>
<p>â€œturtleâ€ ä¹‹åä½ æŒ‰ä¸‹å›è½¦é”®å¦èµ·ä¸€è¡Œã€‚æœ€åæŒ‰ä¸‹ <Esc> é”®é€€å‡º Insert æ¨¡å¼ ,å›åˆ° Normal æ¨¡å¼ã€‚ç°åœ¨ä½ çš„Vim çª—å£ä¸­æœ‰äº†è¿™æ ·çš„ä¸¤è¡Œå†…å®¹ :</p>
<p><img src="pic/18.png" alt="18.png"></p>
<p>ç°åœ¨æ˜¯ä»€ä¹ˆæ¨¡å¼?</p>
<p>è¦çŸ¥é“ä½ ç°åœ¨æ‰€å¤„çš„å·¥ä½œæ¨¡å¼æ˜¯ä»€ä¹ˆ,æ‰“å¼€æ˜¾ç¤ºæ¨¡å¼çš„å¼€å…³:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">:set showmode</span><br><span class="line">:set noshowmode å…³é—­æ˜¾ç¤ºæ¨¡å¼</span><br></pre></td></tr></table></figure>

<p><img src="pic/19.png" alt="19.png"></p>
<p>ä½ ä¼šçœ‹åˆ°æŒ‰ä¸‹å†’å·é”®ä¹‹åå½“å‰å…‰æ ‡è·‘åˆ°çª—å£çš„æœ€åä¸€è¡Œå»äº†ã€‚é‚£æ˜¯ä½¿ç”¨å†’ å·å‘½ä»¤çš„åœ°æ–¹(é¡¾åæ€ä¹‰,å†’å·å‘½<br>ä»¤å°±æ˜¯æ€»æ˜¯ä»¥å†’å·æ‰“å¤´çš„å‘½ä»¤) ã€‚æœ€åæŒ‰ ä¸‹å›è½¦é”®ç»“æŸæ•´ä¸ªå‘½ä»¤(æ‰€æœ‰çš„å†’å·å‘½ä»¤éƒ½ä»¥è¿™ç§æ–¹å¼è¡¨æ˜å‘½ä»¤çš„<br>ç»“æŸ).</p>
<p>ç°åœ¨,å¦‚æœä½ é”®å…¥äº†â€iâ€å‘½ä»¤ Vim å°±ä¼šåœ¨çª—å£åº•éƒ¨æ˜¾ç¤ºâ€“INSERTâ€“ ã€‚è¿™ è¡¨æ˜ä½ ç›®å‰å¤„äº Insert æ¨¡å¼ã€‚<br>å¦‚ æœ æŒ‰ ä¸‹<Esc> é”® è¿” å› åˆ° Normal æ¨¡ å¼ åˆš æ‰ æ˜¾ ç¤º å‡º æ¥ çš„ æ¨¡ å¼â€â€“INSERTâ€“ å°±ä¼šæ¶ˆå¤± ;Normalæ¨¡å¼å¹¶ä¸ä¼šæ˜¾ç¤º â€” NORMALâ€“,ä½œä¸ºé»˜è®¤çš„å·¥ä½œæ¨¡å¼å®ƒä¸æ˜¾ç¤ºä»»ä½•å­—ä¸²ã€‚</p>
<p>Vim æ–°æ‰‹æœ€å¤´ç—›çš„é—®é¢˜å°±æ˜¯æ¨¡å¼â€”ç»å¸¸å¿˜è®°è‡ªå·±ç½®èº«äºä½•ç§æ¨¡å¼, æˆ–è€…ä¸ç»æ„æ•²äº†å“ªä¸ªå­—ç¬¦å°±åˆ‡æ¢åˆ°åˆ«çš„<br>æ¨¡å¼å»äº†ã€‚</p>
<p>ä¸ç®¡ä½ å½“å‰æ‰€å¤„çš„æ¨¡ å¼æ˜¯ä»€ä¹ˆ,æŒ‰ä¸‹<Esc>éƒ½ä¼šè®©ä½ å›åˆ° Normal æ¨¡å¼(å³ä½¿å·²ç»åœ¨ Normal æ¨¡å¼ ä¸‹)ã€‚æœ‰æ—¶<br>éœ€è¦æŒ‰ä¸¤æ¬¡<Esc>,å¦‚æœ Vim ä»¥ä¸€å£°èœ‚é¸£å›ç­”ä½ , é‚£è¯´æ˜ä½ å·²ç» æ˜¯åœ¨ Normal æ¨¡å¼äº†ã€‚</p>
<h4 id="ç§»åŠ¨å…‰æ ‡"><a href="#ç§»åŠ¨å…‰æ ‡" class="headerlink" title="ç§»åŠ¨å…‰æ ‡"></a>ç§»åŠ¨å…‰æ ‡</h4><p>å›åˆ° Normal æ¨¡å¼å , ä½ å°±å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥ç§»åŠ¨å…‰æ ‡ :</p>
<ul>
<li>h å·¦</li>
<li>j ä¸‹</li>
<li>k ä¸Š</li>
<li>l å³</li>
</ul>
<p>äººä»¬ä¸€å¼€å§‹ä¼šè®¤ä¸ºè¿™äº›å­—ç¬¦æ˜¯éšæ„é€‰å–çš„ã€‚æ¯•ç«Ÿæœ‰è° l æ¥ä»£ è¡¨ right å‘¢ ? ä½†äº‹å®ä¸Š , è¿™äº›å­—ç¬¦éƒ½æ˜¯ç²¾å¿ƒæŒ‘é€‰çš„ :</p>
<p>åœ¨ç¼–è¾‘å™¨ä¸­ç§»åŠ¨å…‰ æ ‡æ˜¯ååˆ†å¸¸ç”¨çš„æ“ä½œ , è¿™äº›å­—ç¬¦åœ¨é”®ç›˜ä¸Šéƒ½åˆ†å¸ƒåœ¨ä½ å³æ‰‹å‘¨å›´ã€‚è¿™æ ·çš„å®‰ æ’å¯ä»¥ä½¿ä½ æœ€å¿«<br>æœ€æ–¹ä¾¿åœ°ä½¿ç”¨å®ƒä»¬ ( å°¤å…¶æ˜¯å¯¹é‚£äº›ç”¨åä¸ªæ‰‹æŒ‡è€Œä¸æ˜¯äºŒæŒ‡ ç¦…ç”¨æˆ·è€Œè¨€ ) ã€‚</p>
<p>å¤‡æ³¨ : åŒæ—¶ä½ è¿˜å¯ä»¥ç”¨ç®­å¤´é”®æ¥ç§»åŠ¨å…‰æ ‡ã€‚ä¸è¿‡è¿™æ ·åšå® é™…ä¸Šä¼šå¤§å¤§é™ä½ä½ çš„æ•ˆç‡ã€‚å› ä¸ºç”¨è¿™äº›é”®ä½ éœ€è¦ä¸<br>åœåœ°åœ¨ å­—æ¯åŒºå’Œç®­å¤´é”®ä¹‹é—´é¢‘ç¹è½¬æ¢ã€‚æƒ³è±¡ä¸€ä¸‹è¦æ˜¯ä½ åœ¨ä¸€å°æ—¶ å†…è¿™æ ·åšä¸€ç™¾æ¬¡ä¼šå ç”¨ä½ å¤šå°‘æ—¶é—´ ? å¦å¤– , å¹¶<br>ä¸æ˜¯æ¯ä¸ªé”® ç›˜ä¸Šéƒ½å®‰æ’æœ‰ç®­å¤´é”® , æˆ–è€…éƒ½æŠŠå®ƒä»¬æ”¾åœ¨æœ€å¸¸è§çš„ä½ç½® ; æ‰€ä»¥ä½¿ç”¨ hjkl è¿˜æ˜¯å¤§æœ‰å¥½å¤„ã€‚</p>
<p>ç»ƒä¹ æ–‡ä»¶åä½ hjkl ,æ”¾åœ¨å…±äº«å½“ä¸­ã€‚å¦‚æœè¿›å…¥äº†æ’å…¥æ¨¡å¼ä¸è¦å¿˜äº†è¦ç”¨ <Esc> å›åˆ° Normal æ¨¡ å¼ã€‚ |<br>vimtutor| ä¹Ÿæ˜¯å­¦ä¹ è¿™äº›å‘½ä»¤çš„ä¸€ä¸ªå¥½å»å¤„ã€‚</p>
<p>è®°ä½:å­¦ä¹ è¿™äº›å‘½ä»¤çš„æœ€å¥½åŠæ³•ä¸æ˜¯ä½¿ç”¨ä»€ä¹ˆè®°å¿†æ³• , è€Œæ˜¯ç»ƒä¹ ã€‚</p>
<h4 id="åˆ é™¤å­—ç¬¦"><a href="#åˆ é™¤å­—ç¬¦" class="headerlink" title="åˆ é™¤å­—ç¬¦"></a>åˆ é™¤å­—ç¬¦</h4><p>è¦åˆ é™¤ä¸€ä¸ªå­—ç¬¦,åªéœ€è¦å°†å…‰æ ‡ç§»åˆ°è¯¥å­—ç¬¦ä¸ŠæŒ‰ä¸‹â€xâ€. ( è¿™æ˜¯åœ¨è¿½ å¿†å¤è€çš„æ‰“å­—æœºæ—¶ä»£,åœ¨æ‰“å­—æœºä¸Šåˆ é™¤å­—<br>ç¬¦å°±æ˜¯ç”¨ xxxx æ¥è¦†ç›–å®ƒ) æŠŠå…‰æ ‡ ç§»åˆ°ä¸Šé¢ä¾‹å­ä¸­çš„ç¬¬ä¸€è¡Œ,é”®å…¥ xxxxxxx(7 ä¸ª x) æ¥åˆ é™¤â€A very â€œã€‚</p>
<p>è¾“å…¥å…¶å®ƒå†…å®¹<br>æ¯”å¦‚:é¦–å…ˆé”®å…¥çš„å‘½ä»¤æ˜¯ i( è¿› å…¥ Insert æ¨¡ å¼), æ¥ç€æ’å…¥â€A youngâ€, ç„¶å é€€ å‡º Insert æ¨¡å¼(æœ€åçš„<Esc>)ã€‚</p>
<p>åˆ é™¤ä¸€è¡Œ</p>
<p>åˆ é™¤ä¸€æ•´è¡Œå†…å®¹ä½¿ç”¨â€ddâ€å‘½ä»¤ã€‚åˆ é™¤åä¸‹é¢çš„è¡Œä¼šç§»ä¸Šæ¥å¡«è¡¥ç©ºç¼º:2.1.5 æ’¤æ¶ˆä¸é‡åš</p>
<p>æ’¤é”€ä¸€æ¬¡æ“ä½œ</p>
<p>å¦‚æœä½ è¯¯åˆ äº†è¿‡å¤šçš„å†…å®¹ã€‚æ˜¾ç„¶ä½ å¯ä»¥å†è¾“å…¥ä¸€é,ä½†æ˜¯å‘½ä»¤â€uâ€ æ›´ ç®€ä¾¿, å®ƒå¯ä»¥æ’¤æ¶ˆä¸Šä¸€æ¬¡çš„æ“ä½œ 1 ã€‚<br>å®é™…çœ‹ä¸€ä¸‹å®ƒçš„æ•ˆæœ,ç”¨â€ddâ€ å‘½ä»¤æ¥ åˆ é™¤å‰é¢ä¾‹å­ä¸­çš„ç¬¬ä¸€è¡Œå†…å®¹,â€uâ€å‘½ä»¤ä¼šæŠŠå®ƒæ‰¾å›æ¥ã€‚</p>
<p>é‡åš<br>å¦‚æœä½ æ’¤æ¶ˆäº†å¤šæ¬¡,ä½ è¿˜å¯ä»¥ç”¨ CTRL-R(é‡åš) æ¥åè½¬æ’¤æ¶ˆçš„åŠ¨ä½œã€‚æ¢ å¥è¯è¯´,å®ƒæ˜¯å¯¹æ’¤æ¶ˆçš„æ’¤æ¶ˆã€‚</p>
<p>æ’¤é”€ä¸€è¡Œæ“ä½œ</p>
<p>æ’¤æ¶ˆå‘½ä»¤è¿˜æœ‰å¦ä¸€ç§å½¢å¼,â€Uâ€å‘½ä»¤, å®ƒä¸€æ¬¡æ’¤æ¶ˆå¯¹ä¸€è¡Œçš„å…¨éƒ¨æ“ä½œã€‚ç¬¬ äºŒæ¬¡ä½¿ç”¨è¯¥å‘½ä»¤åˆ™ä¼šæ’¤æ¶ˆå‰ä¸€<br>ä¸ªâ€Uâ€çš„æ“ä½œã€‚</p>
<ul>
<li>åˆ é™¤ very</li>
<li>åˆ é™¤ turtle</li>
<li>ç”¨â€uâ€æ’¤æ¶ˆâ€Uâ€</li>
<li>ç”¨â€Uâ€ æ¢å¤è¯¥è¡Œ</li>
</ul>
<p>â€œUâ€å‘½ä»¤æœ¬èº«ä¹Ÿé€ æˆäº†ä¸€æ¬¡æ”¹å˜,è¿™ç§æ”¹å˜åŒæ ·å¯ä»¥ç”¨â€uâ€ å‘½ä»¤ å’Œ CTRL-R æ¥æ’¤æ¶ˆå’Œé‡åšã€‚çœ‹èµ·æ¥è¿™å¾ˆå®¹æ˜“<br>æŠŠäººæç³Šæ¶‚,ä¸è¿‡åˆ«æ‹…å¿ƒ, ç”¨â€uâ€å’Œ CTRL-R ä½ å¯ä»¥æ‰¾å›ä»»ä½•ä¸€ä¸ªæ“ä½œçŠ¶æ€ã€‚</p>
<h4 id="å…¶å®ƒç¼–è¾‘å‘½ä»¤"><a href="#å…¶å®ƒç¼–è¾‘å‘½ä»¤" class="headerlink" title="å…¶å®ƒç¼–è¾‘å‘½ä»¤"></a>å…¶å®ƒç¼–è¾‘å‘½ä»¤</h4><p>Vim æœ‰ä¸€å¤§å †å‘½ä»¤æ¥æ”¹å˜æ–‡æœ¬ã€‚è¿™é‡Œä»…åˆ— å‡ºä¸€äº›æœ€å¸¸ç”¨çš„ã€‚</p>
<p>è¿½åŠ  a</p>
<p>â€œiâ€ å‘½ä»¤å¯ä»¥åœ¨å½“å‰å…‰æ ‡ä¹‹å‰æ’å…¥æ–‡æœ¬ã€‚ä½†å¦‚æœä½ æƒ³åœ¨å½“å‰è¡Œçš„æœ«å°¾ æ·»åŠ ä¸€äº›å†…å®¹æ—¶æ€ä¹ˆåŠå‘¢?ä½ å¿…éœ€åœ¨å…‰<br>æ ‡ä¹‹åæ’å…¥æ–‡æœ¬ã€‚ç­”æ¡ˆæ˜¯ç”¨â€aâ€ å‘½ ä»¤æ¥ä»£æ›¿â€iâ€ã€‚</p>
<p>å¦èµ·ä¸€è¡Œ o\O</p>
<ol>
<li>â€œoâ€å‘½ä»¤å¯ä»¥åœ¨å½“å‰è¡Œçš„ä¸‹é¢å¦èµ·ä¸€è¡Œ,å¹¶ä½¿å½“å‰æ¨¡å¼è½¬ä¸º Insert æ¨¡ å¼ã€‚è¿™æ ·ä½ å¯ä»¥åœ¨è¯¥å‘½ä»¤ä¹‹åç›´æ¥è¾“<br>å…¥å†…å®¹ã€‚å‡è®¾å…‰æ ‡ä½äºä¸‹é¢ä¸¤è¡Œä¸­ç¬¬ ä¸€è¡Œçš„æŸå¤„:</li>
<li>â€œOâ€å‘½ä»¤(æ³¨æ„æ˜¯å¤§å†™çš„å­—æ¯ O)å°†åœ¨å½“å‰è¡Œçš„ä¸Šé¢å¦èµ·ä¸€è¡Œã€‚</li>
</ol>
<p>ä½¿ç”¨å‘½ä»¤è®¡æ•°</p>
<p>å‡è®¾ä½ è¦å‘ä¸Šç§»åŠ¨ 9 è¡Œã€‚è¿™å¯ä»¥ç”¨â€kkkkkkkkkâ€æˆ–â€9kâ€ æ¥å®Œæˆã€‚äº‹å® ä¸Š,å¾ˆå¤šå‘½ä»¤éƒ½å¯ä»¥æ¥å—ä¸€ä¸ªæ•°å­—ä½œ<br>ä¸ºé‡å¤æ‰§è¡ŒåŒä¸€å‘½ä»¤çš„æ¬¡æ•°ã€‚æ¯”å¦‚åˆš æ‰çš„ä¾‹å­,è¦åœ¨è¡Œå°¾è¿½åŠ ä¸‰ä¸ªæ„Ÿå¹å·,å½“æ—¶ç”¨çš„å‘½ä»¤æ˜¯â€a!!!<Esc>â€œã€‚<br>å¦ ä¸€ä¸ªåŠæ³•æ˜¯ç”¨â€3a!<Esc>â€œå‘½ä»¤ã€‚</p>
<p>3 è¯´æ˜è¯¥å‘½ä»¤å°†è¢«é‡å¤æ‰§è¡Œ 3 æ¬¡ã€‚åŒæ ·, åˆ  é™¤ 3 ä¸ªå­—ç¬¦å¯ä»¥ç”¨â€3xâ€ã€‚æŒ‡<br>å®šçš„æ•°å­—è¦ç´§æŒ¨åœ¨å®ƒæ‰€è¦ä¿®é¥°çš„å‘½ä»¤å‰é¢ã€‚</p>
<h4 id="é€€å‡º"><a href="#é€€å‡º" class="headerlink" title="é€€å‡º"></a>é€€å‡º</h4><p>è¦é€€å‡º Vim,ç”¨å‘½ä»¤â€ZZâ€ã€‚è¯¥å‘½ä»¤ä¿å­˜å½“å‰æ–‡ä»¶å¹¶é€€å‡º Vim.</p>
<p>æ”¾å¼ƒç¼–è¾‘ :q!</p>
<p>æœ‰æ—¶ä½ ä¼šåœ¨åšäº†ä¸€è¿ä¸²ä¿®æ”¹ä¹‹åçªç„¶æ„è¯†åˆ°æœ€å¥½æ˜¯æ”¾å¼ƒæ‰€æœ‰çš„ä¿®æ”¹é‡ æ–°æ¥è¿‡ã€‚åˆ«æ‹…å¿ƒã€‚Vim ä¸­æœ‰ä¸€ä¸ªå‘½ä»¤å¯<br>ä»¥ä¸¢å¼ƒæ‰€æœ‰çš„ä¿®æ”¹å¹¶é€€å‡º:<br>:q!<br>åˆ«å¿˜äº†åœ¨å‘½ä»¤ä¹‹ååŠ å›è½¦ã€‚</p>
<p>æ”¾å¼ƒç¼–è¾‘å¹¶é‡æ–°è½½å…¥ :e!</p>
<p>å¦‚æœä½ åœ¨æ”¾å¼ƒæ‰€æœ‰ä¿®æ”¹åè¿˜æƒ³ä»¥è¯¥æ–‡ä»¶çš„åˆå§‹å†…å®¹ä½œä¸ºå¼€å§‹ç»§ç»­ç¼– è¾‘,è¿˜å¯ä»¥ç”¨â€:e!â€å‘½ä»¤æ”¾å¼ƒæ‰€æœ‰ä¿®æ”¹å¹¶<br>é‡æ–°è½½å…¥è¯¥æ–‡ä»¶çš„åŸå§‹å†…å®¹ã€‚</p>
<p>ä¿å­˜å¹¶é€€å‡º:wq :wq!</p>
<p>ä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯éœ€è¦ä¿å­˜å¹¶é€€å‡ºçš„,æœ‰ä¸€äº›æ–‡ä»¶ä¿å­˜çš„æ—¶å€™éœ€è¦å¼ºåˆ¶ä¿å­˜é€€å‡º,è¿™æ—¶åŠ ä¸Š!å³å¯ã€‚æ¯”<br>å¦‚/etc/shadow2.1.8 æ±‚åŠ©</p>
<p>ä½ æƒ³åšçš„ä»»ä½•æ“ä½œéƒ½å¯ä»¥åœ¨ Vim çš„å¸®åŠ©æ–‡ä»¶é‡Œæ‰¾åˆ°ç­”æ¡ˆ, åˆ«æ€•é—®é—® é¢˜!<br>:help</p>
<p>ä¼šå¸¦ä½ åˆ°å¸®åŠ©æ–‡ä»¶çš„èµ·å§‹ç‚¹ã€‚</p>
<p>å¦‚æœä½ æ²¡æœ‰æŒ‡å®šä¸€ä¸ªå…·ä½“çš„å¸®åŠ©ä¸»é¢˜,â€:helpâ€ å‘½ä»¤ä¼šæ˜¾ç¤ºä¸Šé¢æåˆ° çš„å¸®åŠ©æ–‡ä»¶çš„èµ·ç‚¹ã€‚Vim çš„ä½œè€…èªæ˜åœ°<br>(ä¹Ÿè®¸æ˜¯æ‡’æƒ°åœ°) è®¾è®¡äº†å®ƒçš„å¸®åŠ©ç³» ç»Ÿ: å¸®åŠ©çª—å£ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„ç¼–è¾‘çª—å£ã€‚ä½ å¯ä»¥ä½¿ç”¨è·Ÿç¼–è¾‘å…¶å®ƒæ–‡ä»¶æ—¶ä¸€<br>æ ·çš„å‘½ä»¤æ¥æ“ä½œå¸®åŠ©æ–‡ä»¶ã€‚æ¯”å¦‚ç”¨ hljk ç§»åŠ¨å…‰æ ‡ã€‚</p>
<p>é€€å‡ºå¸®åŠ©çª—å£ä¹Ÿè·Ÿé€€å‡ºå…¶å®ƒæ–‡ä»¶ç¼–è¾‘çª—å£ä¸€æ ·,ä½¿ç”¨â€ZZâ€ å³å¯ã€‚è¿™åª ä¼šå…³é—­å¸®åŠ©çª—å£,è€Œä¸æ˜¯é€€å‡º Vim.<br>æµè§ˆå¸®åŠ©æ–‡ä»¶æ—¶,ä½ ä¼šæ³¨æ„åˆ°æœ‰ä¸€äº›å†…å®¹ç”¨ä¸¤ä¸ªå°æ …æ å›´äº†èµ·æ¥( æ¯” å¦‚|help|)ã€‚è¿™è¡¨æ˜æ­¤å¤„æ˜¯ä¸€ä¸ªè¶…é“¾æ¥ã€‚<br>å¦‚æœä½ æŠŠå…‰æ ‡ç½®äºä¸¤ä¸ªå°æ …æ ä¹‹é—´çš„ä»»ä½•ä½ç½®ç„¶åæŒ‰ä¸‹ CTRL-](è·³è½¬åˆ°ä¸€ä¸ªæ ‡ç­¾çš„å‘½ä»¤),å¸®åŠ©ç³»ç»Ÿå°±ä¼šå¸¦<br>ä½  åˆ°é‚£ä¸ªæŒ‡å®šçš„ä¸»é¢˜ã€‚(å› ä¸ºä¸€äº›æ­¤å¤„ä¸ä¾¿è®¨è®ºçš„åŸå› ,åœ¨ Vim çš„æœ¯è¯­ä¸­è¿™ç§ è¶…é“¾æ¥å«æ ‡ç­¾ã€‚æ‰€ä»¥ CTRL-]<br>å¯ä»¥è·³è½¬åˆ°å½“å‰å…‰æ ‡ä¹‹ä¸‹çš„é‚£ä¸ª word æ‰€å¯¹åº”çš„ é“¾æ¥ä¸­ 1 ã€‚</p>
<p>å‡ æ¬¡è·³è½¬ä¹‹å,ä½ å¯èƒ½æƒ³å›åˆ°åŸæ¥çš„æŸä¸ªåœ°æ–¹,CTRL-T(å¼¹å‡ºæ ‡ç­¾) å¯ ä»¥å›åˆ°å‰ä¸€ä¸ªä½ç½®ã€‚ç”¨å‘½ä»¤ CTRL-<br>O(è·³è½¬åˆ°è¾ƒæ—©çš„ä½ç½®) ä¹Ÿå¯ä»¥ã€‚ å¸®åŠ©çª—å£çš„å¼€å§‹æœ‰ä¸€ä¸ªå…³äº<em>help.txt*çš„è¯´æ˜ã€‚åœ¨æ˜Ÿå·â€</em>â€œ ä¹‹é—´çš„å­— ç¬¦è¢«<br>å¸®åŠ©ç³»ç»Ÿå®šä¹‰ä¸ºä¸€ä¸ªæ ‡ç­¾çš„ç›®çš„åœ°(è¶…é“¾æ¥çš„ç›®çš„åœ°).</p>
<p>è¦æŸ¥çœ‹å…³äºæŸä¸ªç‰¹æ®Šä¸»é¢˜çš„å¸®åŠ©,ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å½¢å¼:<br><code>:help {subject}</code></p>
<p>ä¾‹å¦‚,æŸ¥çœ‹å…³äº showmode çš„å¸®åŠ©<br><code>:help showmode3.2 æ”¹åŠ¨</code></p>
<h4 id="å…‰æ ‡çš„æŒ‡å®šç§»åŠ¨"><a href="#å…‰æ ‡çš„æŒ‡å®šç§»åŠ¨" class="headerlink" title="å…‰æ ‡çš„æŒ‡å®šç§»åŠ¨"></a>å…‰æ ‡çš„æŒ‡å®šç§»åŠ¨</h4><p>â€œGâ€å‘½ä»¤ æŒ‡å®šä¸€ ä¸ªå‘½ä»¤è®¡æ•°, è¿™ä¸ªå‘½ä»¤å°±ä¼šæŠŠå…‰æ ‡å®šä½åˆ°ç”±å‘½ä»¤è®¡æ•°æŒ‡å®šçš„è¡Œä¸Šã€‚æ¯” å¦‚â€33Gâ€å°±ä¼šæŠŠå…‰æ ‡<br>ç½®äºç¬¬ 33 è¡Œä¸Šã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera0 ~]# cp /var/log/messages messages</span><br><span class="line">[root@mastera0 ~]# vim messages</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰æŒ‡å®šå‘½ä»¤è®¡æ•°ä½œä¸ºå‚æ•°çš„è¯ :</p>
<ul>
<li>â€œGâ€ ä¼š æŠŠ å…‰ æ ‡ å®š ä½ åˆ° æœ€ å ä¸€ è¡Œ ä¸Š</li>
<li>â€œggâ€å‘½ä»¤æ˜¯è·³è½¬åˆ°ç¬¬ä¸€è¡Œçš„å¿«æ·çš„æ–¹æ³•ã€‚â€1Gâ€æ•ˆæœä¹Ÿæ˜¯ä¸€æ ·, ä½†æ˜¯æ•² èµ·æ¥å°±æ²¡é‚£ä¹ˆé¡ºæ‰‹äº†ã€‚</li>
<li>â€œ%â€å‘½ä»¤ å¦ä¸€ä¸ªç§»åŠ¨åˆ°æŸè¡Œçš„æ–¹æ³•æ˜¯åœ¨å‘½ä»¤â€%â€ ä¹‹å‰æŒ‡å®šä¸€ä¸ªå‘½ä»¤è®¡æ•° ã€‚ å¦‚â€50%â€å°†ä¼šæŠŠå…‰æ ‡å®šä½åœ¨æ–‡ä»¶çš„ä¸­é—´;æ¯”â€90%â€ è·³åˆ°æ¥æ–‡ä»¶å°¾çš„åœ° æ–¹ ã€‚</li>
</ul>
<h4 id="ç®€å•æœç´¢"><a href="#ç®€å•æœç´¢" class="headerlink" title="ç®€å•æœç´¢"></a>ç®€å•æœç´¢</h4><p>â€œ/stringâ€å‘½ä»¤</p>
<p>â€œ/stringâ€å‘½ä»¤å¯ç”¨äºæœç´¢ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚æ¯”å¦‚è¦æ‰¾åˆ°å•è¯â€mysqlâ€, ä½¿ç”¨å‘½ä»¤:<br><code>/mysql</code></p>
<p>è¦æŸ¥æ‰¾ä¸Šæ¬¡æŸ¥æ‰¾çš„å­—ç¬¦ä¸²çš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚ä½¿ç”¨â€nâ€ å‘½ä»¤ã€‚å¦‚æœä½ çŸ¥ é“ä½ è¦æ‰¾çš„ç¡®åˆ‡ä½ç½®æ˜¯ç›®æ ‡å­—ç¬¦ä¸²çš„ç¬¬å‡ <br>æ¬¡å‡ºç°,è¿˜å¯ä»¥åœ¨â€nâ€ ä¹‹å‰æ”¾ç½® ä¸€ä¸ªå‘½ä»¤è®¡æ•°ã€‚â€3nâ€ä¼šå»æŸ¥æ‰¾ç›®æ ‡å­—ç¬¦ä¸²çš„ç¬¬ 3 æ¬¡å‡ºç°ã€‚å‘å…‰æ ‡æ‰€åœ¨ä½ç½®ä»¥<br>ä¸ŠæŸ¥æ‰¾ç”¨â€Nâ€ã€‚</p>
<p>â€œ?stringâ€å‘½ä»¤</p>
<p>â€œ?â€å‘½ä»¤ä¸â€/â€œçš„å·¥ä½œç›¸åŒ,åªæ˜¯æœç´¢æ–¹å‘ç›¸åã€‚æ¯”å¦‚è¦æ‰¾åˆ°å•è¯â€mysqlâ€, ä½¿ç”¨å‘½ä»¤:<br><code>?mysqlå¿½ç•¥å¤§å°å†™</code></p>
<p>é€šå¸¸æƒ…å†µä¸‹ä½ è¦å‡†ç¡®åœ°é”®å…¥ä½ è¦æŸ¥æ‰¾çš„ä¸œè¥¿ã€‚å¦‚æœä½ å¹¶ä¸å…³å¿ƒç›®æ ‡å­— ç¬¦ä¸­å­—æ¯çš„å¤§å°å†™,å¯ä»¥é€šè¿‡è®¾<br>ç½®â€™ignorecaseâ€™é€‰é¡¹:<br><code>:set ignorecase</code></p>
<p>å–æ¶ˆåˆ™è®¾ç½®â€™noignorecaseâ€™é€‰é¡¹:<br><code>:set noignorecase</code></p>
<p>å¦‚æœä½ åœ¨ç¼–è¾‘ä¸€æ®µæºç¨‹åºæ—¶çœ‹åˆ°äº†ä¸€ä¸ªå«â€nrâ€ çš„å˜é‡ã€‚ä½ æƒ³æŸ¥çœ‹ä¸€ ä¸‹è¿™ä¸ªå˜é‡å°±è¢«ç”¨åœ¨äº†å“ªäº›åœ°æ–¹ã€‚ç®€å•<br>çš„åŠæ³•æ˜¯æŠŠå…‰æ ‡ç§»åˆ°â€nrâ€ ä¸Šç„¶å ç”¨â€*â€ å‘½ä»¤å’Œâ€nâ€ å‘½ä»¤ä¸€ä¸ªä¸€ä¸ªåœ°æŸ¥æ‰¾æ‰€æœ‰çš„åŒ¹é…ã€‚<br>ä¸è¿‡è¿˜æœ‰æ›´å¥½çš„åŠæ³•ã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤:<br><code>:set hlsearch</code></p>
<p>ç°åœ¨ä½ è¦å†æŸ¥æ‰¾â€nrâ€, Vim å°±ä¼šä»¥æŸç§å½¢å¼é«˜äº®æ˜¾ç¤ºæ‰€æœ‰ç¬¦åˆçš„åŒ¹é…ã€‚å¯¹ äºæƒ³æŸ¥çœ‹ä¸€ä¸ªå˜é‡è¢«ç”¨åœ¨å“ªäº›åœ°<br>æ–¹,è¿™ä¸ªåŠæ³•å¤ªæ£’äº†, ä¸éœ€ä»»ä½•å…¶å®ƒçš„å‘½ ä»¤ çœ‹å¾—çœ¼èŠ±çš„æ—¶å€™è¿˜å¯ä»¥å…³é—­è¿™ä¸€åŠŸèƒ½:<br><code>:set nohlsearch</code></p>
<p>ä¸è¿‡ä½ è¦åœ¨ä¸‹æ¬¡æœç´¢æ—¶å†æ¬¡ä½¿ç”¨è¿™ä¸€åŠŸèƒ½å°±åˆå¾—æ‰“å¼€å®ƒã€‚å¦‚æœä½ åªæ˜¯æƒ³å» æ‰å½“å‰çš„é«˜äº®æ˜¾ç¤º,å¯ä»¥ä½¿ç”¨ä¸‹é¢<br>çš„å‘½ä»¤ :<br><code>:nohlsearch</code></p>
<h4 id="å¤åˆ¶ç²˜è´´"><a href="#å¤åˆ¶ç²˜è´´" class="headerlink" title="å¤åˆ¶ç²˜è´´"></a>å¤åˆ¶ç²˜è´´</h4><p>è¦æŠŠæ–‡æœ¬å†…å®¹ä»ä¸€å¤„å¤åˆ¶åˆ°å¦ä¸€å¤„</p>
<ol>
<li>å…ˆåˆ é™¤ dd å†ç²˜è´´ p</li>
<li>â€œyâ€ æ“ä½œç¬¦å‘½ä»¤ä¼šæŠŠæ–‡æœ¬å¤åˆ¶åˆ°ä¸€ä¸ªå¯„å­˜å™¨ ä¸­ã€‚ç„¶åå¯ä»¥ç”¨â€pâ€å‘½ä»¤æŠŠå®ƒå–å›ã€‚</li>
</ol>
<p>â€œyâ€å‘½ä»¤</p>
<ul>
<li>â€œywâ€æ¥å¤åˆ¶ä¸€ä¸ª word;</li>
<li>â€œy2wâ€å‘½ä»¤å¤åˆ¶ä¸¤ä¸ª word;</li>
<li>â€œyyâ€å¤åˆ¶ä¸€è¡Œ;</li>
<li>â€œ3yyâ€å¤åˆ¶å…‰æ ‡æ‰€åœ¨è¡Œå’Œå‘ä¸‹çš„è¡Œ,ä¸€å…±ä¸‰è¡Œ;</li>
</ul>
<p>ä¾‹å¦‚:</p>
<ol>
<li>å¤åˆ¶ file æ–‡ä»¶ä¸­çš„ turtle å¹¶ç²˜è´´åˆ°è¯¥è¡Œçš„æœ€å;</li>
<li>å¤åˆ¶ file æ–‡ä»¶ä¸­çš„ intelligent turtle å¹¶ç²˜è´´åˆ°è¯¥è¡Œçš„æœ€å;</li>
<li>å¤åˆ¶ file æ–‡ä»¶ä¸­çš„ç¬¬äºŒè¡Œå¹¶ç²˜è´´åˆ°ç¬¬å››è¡Œ;</li>
<li>å¤åˆ¶ file æ–‡ä»¶ä¸­çš„ç¬¬ä¸€è¡Œç¬¬äºŒè¡Œç¬¬ä¸‰è¡Œ,å¹¶ç²˜è´´åˆ°ç¬¬äº”è¡Œç¬¬å…­è¡Œç¬¬ä¸ƒè¡Œã€‚</li>
</ol>
<h4 id="æ›¿æ¢å­—ç¬¦"><a href="#æ›¿æ¢å­—ç¬¦" class="headerlink" title="æ›¿æ¢å­—ç¬¦"></a>æ›¿æ¢å­—ç¬¦</h4><ul>
<li>:s/UNIX/linux å¯¹å…‰æ ‡æ‰€åœ¨è¡Œç¬¬ä¸€ä¸ªå‡ºç°çš„ UNIX æ›¿æ¢æˆ linux</li>
<li>:s/UNIX/linux /g å¯¹å…‰æ ‡æ‰€åœ¨è¡Œæ‰€æœ‰ UNIX éƒ½æ›¿æ¢æˆ linux , g è¡¨ç¤ºå…¨è¡Œæ›¿æ¢</li>
<li>:% s/UNIX/linux /g å°†å…¨æ–‡ä¸­çš„ carol éƒ½æ›¿æ¢ä½ natasha , â€œ%â€ æŒ‡å®šè¯¥å‘½ä»¤å°†ä½œç”¨äºæ‰€æœ‰è¡Œä¸Š</li>
</ul>
<h3 id="Vim-çš„ä¿æŠ¤æœºåˆ¶"><a href="#Vim-çš„ä¿æŠ¤æœºåˆ¶" class="headerlink" title="Vim çš„ä¿æŠ¤æœºåˆ¶"></a>Vim çš„ä¿æŠ¤æœºåˆ¶</h3><p>å¦‚æœæˆ‘ä»¬æ²¡æœ‰é€šè¿‡ q é€€å‡º,è€Œæ˜¯é€šè¿‡å…¶ä»–æ–¹å¼å¼ºè¡Œé€€å‡º,æ¯”å¦‚è¯´ç›´æ¥å…³ç»ˆç«¯,ä¼šå¯¼è‡´ vim çš„ä¸€ä¸ªæŠ¥é”™,å½“æˆ‘<br>ä»¬ä¸‹æ¬¡æ‰“å¼€è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™,ä¼šæç¤º<br><code>Found a swap file by the name &quot;.file.swp&quot;</code></p>
<p>è¿™æ˜¯å› ä¸º vim ä»–ä¸æ˜¯å®æ—¶å†™å…¥çš„æœºåˆ¶,ä»–ä¼šå…ˆæŠŠæ–‡ä»¶å†™åˆ°å†…å­˜,ç­‰æˆ‘ä»¬æ‰§è¡Œ w æ“ä½œä»¥å,å†å†™å›åˆ°åŸæ–‡ä»¶ã€‚<br>é‚£ä¹ˆåœ¨å†™å›åŸæ–‡ä»¶,æˆ–è€…æ‰§è¡Œ q çš„æ”¾å¼ƒæ“ä½œä¹‹å‰,ä¼šç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„æ–‡ä»¶,ä»¥ . å¼€å¤´, swp ç»“å°¾ã€‚å½“æˆ‘ä»¬çœ‹<br>åˆ°è¿™ç§æƒ…å†µ,å°±è¯´æ˜è¿™ä¸ªæ–‡ä»¶æ˜¯åœ¨å˜ç¼–è¾‘çš„è¿‡ç¨‹ä¸­å¼ºåˆ¶é€€å‡ºçš„,æˆ–è€…æ˜¯æ­£åœ¨è¢«äººç¼–è¾‘ã€‚</p>
<p>æ‰€ä»¥è¿™ä¸ªæ–‡ä»¶çš„ä½œç”¨å°±æ˜¯é˜²æ­¢å¼ºåˆ¶é€€å‡ºé€ æˆçš„æ•°æ®å®‰å…¨éšæ‚£,å’Œé˜²æ­¢æ–‡ä»¶åŒæ—¶è¢«å¤šæ¬¡ä¿®æ”¹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Swap file ".file.swp" already exists!</span><br><span class="line">[O]pen Read-Only, (E)dit anyway, (R)ecover, (D)elete it, (Q)uit, (A)bort:</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æ ¹æ®ä»–çš„æç¤ºæ‰§è¡Œç›¸åº”çš„æ“ä½œ,æ¯”å¦‚è¯´ Q ,é€€å‡ºã€‚å¦‚æœæƒ³è¦é¡ºåˆ©ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶çš„è¯,ä¸€æ–¹é¢å¯ä»¥ä½¿<br>ç”¨ E ,æ— è®ºå¦‚ä½•ä¹Ÿè¦ç¼–è¾‘,æˆ–è€…å…ˆé€€å‡º,æŠŠ swp æ–‡ä»¶åˆ é™¤äº†ä»¥åå†ç¼–è¾‘,ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<p>æ³¨æ„:è¦ä½¿ç”¨ vim éœ€è¦æ³¨æ„ä¸€ä¸‹æƒé™é—®é¢˜,å¿…é¡»è¦æœ‰è¯»å†™æƒé™æ‰èƒ½ä½¿ç”¨ vim ã€‚</p>
<p>å¯ä»¥çœ‹ä¸€ä¸‹æ²¡æœ‰å†™æƒé™å’Œæ²¡æœ‰è¯»æƒé™ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ã€‚</p>
<hr>
<h2 id="Vim-ç¼–è¾‘å™¨è¯¾åä½œä¸š"><a href="#Vim-ç¼–è¾‘å™¨è¯¾åä½œä¸š" class="headerlink" title="Vim ç¼–è¾‘å™¨è¯¾åä½œä¸š"></a>Vim ç¼–è¾‘å™¨è¯¾åä½œä¸š</h2><ol>
<li>å¤åˆ¶<code>/etc/sysconfig/network-scripts/ifcfg-eth0</code>çš„é…ç½®æ–‡ä»¶ä½/tmp/test</li>
<li>ä½¿ç”¨vimç¼–è¾‘è¯¥æ–‡ä»¶ï¼Œç»ƒä¹ ä¸åŒæ¨¡å¼çš„åˆ‡æ¢ï¼Œå°¤å…¶æ˜¯æ­£å¸¸å˜æ’å…¥æ¨¡å¼çš„å‡ ç§ç”¨æ³•</li>
<li>ç»ƒä¹ ä¿å­˜çš„å‡ ç§å‘½ä»¤ï¼ŒåŒ…æ‹¬ä¿å­˜é€€å‡ºï¼Œä¸ä¿å­˜é€€å‡ºã€‚</li>
<li>vimç»ƒä¹ æ¸¸æˆ<br> vimå¤§å†’é™©å®˜ç½‘    vim-adventures.com</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç³»ç»ŸåŸºç¡€åŸ¹è®­</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux å‹ç¼©æ‰“åŒ…</title>
    <url>/2016/12/22/booboo_linux_base/04-Linux%E5%8E%8B%E7%BC%A9%E6%89%93%E5%8C%85/</url>
    <content><![CDATA[<h2 id="å‹ç¼©çš„æ„ä¹‰å’ŒåŸç†"><a href="#å‹ç¼©çš„æ„ä¹‰å’ŒåŸç†" class="headerlink" title="å‹ç¼©çš„æ„ä¹‰å’ŒåŸç†"></a>å‹ç¼©çš„æ„ä¹‰å’ŒåŸç†</h2><h3 id="å‹ç¼©çš„æ„ä¹‰"><a href="#å‹ç¼©çš„æ„ä¹‰" class="headerlink" title="å‹ç¼©çš„æ„ä¹‰"></a>å‹ç¼©çš„æ„ä¹‰</h3><p>ä½ æ˜¯å¦é‡åˆ°è¿‡ä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>æ–‡ä»¶å¤ªå¤§, ä¸€ä¸ª u ç›˜æ— æ³•å…¨éƒ¨å¤åˆ¶? </li>
<li>å¤‡ä»½æŸäº›é‡è¦æ•°æ® , ååè¿™äº›æ•°æ®é‡å¤ªå¤§äº† , è€—æ‰äº†ä½ å¤ªå¤šçš„ç£ç›˜ç©ºé—´? </li>
</ul>
<p>è¿™ä¸ªæ—¶å€™ï¼Œâ€œæ–‡ä»¶å‹ç¼©â€æŠ€æœ¯å¯ å°±æ´¾ä¸Šç”¨åœºäº† !</p>
<p>å› ä¸ºè¿™äº›æ¯”è¾ƒå¤§å‹çš„æ–‡ä»¶é€è¿‡æ‰€è°“çš„æ–‡ä»¶å‹ç¼©æŠ€æœ¯å , å¯ä»¥å°†ä»–çš„ç£ç›˜ä½¿ç”¨é‡é™ä½ , å¯ä»¥è¾¾åˆ°å‡ä½æ–‡ä»¶å®¹é‡çš„æ•ˆæœ , æ­¤å¤– , æœ‰çš„å‹ç¼©ç¨‹åºè¿˜å¯ä»¥è¿›è¡Œå®¹é‡é™åˆ¶ , ä½¿ä¸€ä¸ªå¤§å‹æ–‡ä»¶å¯ä»¥åˆ†å‰²æˆä¸ºæ•°ä¸ªå°å‹æ–‡ä»¶ , ä»¥æ–¹ä¾¿ Uç›˜æºå¸¦å‘¢ !</p>
<h3 id="å‹ç¼©çš„åŸç†"><a href="#å‹ç¼©çš„åŸç†" class="headerlink" title="å‹ç¼©çš„åŸç†"></a>å‹ç¼©çš„åŸç†</h3><p>ç›®å‰æˆ‘ä»¬ä½¿ç”¨çš„è®¡ç®—æœºç³»ç»Ÿä¸­éƒ½æ˜¯ä½¿ bytes(å­—èŠ‚)å•ä½æ¥è®¡é‡çš„! äº‹å®ä¸Š , è®¡ç®—æœºæœ€å°çš„è®¡é‡å•ä½åº”è¯¥æ˜¯ bits (æ¯”ç‰¹)ã€‚</p>
<p>1 byte = 8 bits ã€‚</p>
<p>å¦‚æœè®©è®¡ç®—æœºè®°å½• 1 è¿™ä¸ªæ•°å­—ä»–ä¼šå¦‚ä½•è®°å½• ?</p>
<p>å‡è®¾ä¸€ä¸ª byte å¯ä»¥çœ‹æˆä¸‹é¢çš„æ ·å­ :</p>
<p>â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡</p>
<p>Tips:</p>
<p>1 byte = 8 bits , æ‰€ä»¥æ¯ä¸ª byte å½“ä¸­ä¼šæœ‰ 8 ä¸ªç©ºæ ¼ , è€Œæ¯ä¸ªç©ºæ ¼å¯ä»¥æ˜¯ 0, æˆ–è€… 1 , è¿™é‡Œä»…æ˜¯åšä¸ºä¸€ä¸ªç²—ç•¥çš„ä»‹ç»ã€‚ç”±äºæˆ‘ä»¬è®°å½•æ•°å­—æ˜¯ 1 , è¡¨ç¤ºæˆäºŒè¿›åˆ¶å°±æ˜¯ 00000001 , 1 ä¼šåœ¨æœ€å³è¾¹å æ® 1 ä¸ª bit , è€Œå…¶ä»– çš„ 7 ä¸ªbits å°†ä¼šè¢«å¡«ä¸Š 0 ! æœ‰ä¸€ç§å‹ç¼©æŠ€æœ¯ç¤ºè¿™ä¹ˆåšçš„,ä»–æ˜¯å°†é‡å¤çš„æ•°æ®è¿›è¡Œç»Ÿè®¡è®°å½•çš„ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­è¯´ , å¦‚æœä½ çš„æ•°æ®ã€ 111â€¦. ã€å…±æœ‰ 100 ä¸ª 1 </p>
<p>é‚£ä¹ˆå‹ç¼©æŠ€æœ¯ä¼šè®°å½•ä¸ºã€ 100 ä¸ª 1 ã€è€Œä¸æ˜¯çœŸçš„æœ‰ 100 ä¸ª 1 çš„ä½å­˜åœ¨ ! </p>
<p>ç®€å•çš„è¯´ , ä½ å¯ä»¥å°†ä»–æƒ³æˆ , å…¶å®æ–‡ä»¶é‡Œé¢æœ‰ç›¸å½“å¤šçš„ã€ç©ºé—´ã€å­˜åœ¨ , å¹¶ä¸æ˜¯å®Œå…¨å¡«æ»¡çš„ </p>
<ul>
<li>ã€å‹ç¼©ã€ æŠ€æœ¯å°±æ˜¯å°†è¿™äº›ã€ç©ºé—´ã€å¡«æ»¡ , ä»¥è®©æ•´ä¸ªæ–‡ä»¶å ç”¨çš„å®¹é‡ä¸‹é™ ! </li>
<li>ã€å‹ç¼©è¿‡çš„æ¡£æ¡ˆã€å¹¶æ— æ³•ç›´æ¥è¢«æˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿæ‰€ä½¿ç”¨ , å› æ­¤ , è‹¥è¦ä½¿ç”¨è¿™äº›è¢«å‹ç¼©è¿‡çš„æ–‡ä»¶æ•°æ® , åˆ™å¿…é¡¹å°†ä»–ã€è¿˜åŸã€å›åˆ° æœªå‹ç¼©å‰çš„æ¨¡æ · ,é‚£å°±æ˜¯æ‰€è°“çš„ã€è§£å‹ç¼©ã€å•° ! </li>
<li>è‡³äºå‹ç¼©å‰ä¸å‹ç¼©åçš„æ¡£æ¡ˆæ‰€å ç”¨çš„ç£ç›˜ç©ºé—´å¤§å° , å°±å¯ä»¥è¢«ç§°ä¸ºæ˜¯ã€å‹ç¼©æ¯”ã€ã€‚</li>
</ul>
<h3 id="å‹ç¼©ä¸è§£å‹ç¼©çš„å¥½å¤„"><a href="#å‹ç¼©ä¸è§£å‹ç¼©çš„å¥½å¤„" class="headerlink" title="å‹ç¼©ä¸è§£å‹ç¼©çš„å¥½å¤„"></a>å‹ç¼©ä¸è§£å‹ç¼©çš„å¥½å¤„</h3><p>æœ€å¤§çš„å¥½å¤„å°±æ˜¯å‹ç¼©è¿‡çš„æ–‡ä»¶å®¹é‡å˜å°äº† , æ‰€ä»¥ä½ çš„ ç¡¬ç›˜å®¹é‡æ— å½¢å½“ä¸­å°±å¯ä»¥å®¹çº³æ›´å¤šçš„èµ„æ–™ã€‚æ­¤å¤– , åœ¨ä¸€äº›ç½‘ç»œæ•°æ®çš„ä¼ è¾“ä¸­ , ä¹Ÿä¼šç”±äºæ•°æ®é‡çš„é™ä½ , å¥½è®©ç½‘ç»œå¸¦å®½å¯ä»¥ç”¨æ¥ä½œæ›´å¤šçš„å·¥ä½œ ! è€Œå¹¶æ˜¯è€æ˜¯å¡åœ¨ä¸€äº›å¤§å‹çš„æ–‡ä»¶ä¼ è¾“ä¸Šé¢å‘¢ ! ç›®å‰å¾ˆå¤šçš„ WWW ç½‘ç«™ä¹Ÿæ˜¯åˆ©ç”¨æ–‡ä»¶å‹ç¼©çš„æŠ€æœ¯æ¥è¿›è¡Œæ•°æ®çš„ä¼ é€ , å¥½è®©ç½‘ç«™å¸¦å®½çš„å¯åˆ©ç”¨ç‡ä¸Šå‡ã€‚</p>
<h2 id="å‹ç¼©æ‰“åŒ…å‘½ä»¤"><a href="#å‹ç¼©æ‰“åŒ…å‘½ä»¤" class="headerlink" title="å‹ç¼©æ‰“åŒ…å‘½ä»¤"></a>å‹ç¼©æ‰“åŒ…å‘½ä»¤</h2><p>å‘½ä»¤æ¦‚è§ˆ</p>
<ul>
<li><p>compress æ˜¯ä¸€ä¸ªç›¸å½“å¤è€çš„ unix æ¡£æ¡ˆå‹ç¼©æŒ‡ä»¤ã€‚</p>
</li>
<li><p>gzip æ˜¯ GNUzip çš„ç¼©å†™,å®ƒæ˜¯ä¸€ä¸ª GNU( å…¨ç§°æ˜¯ GNUâ€™s Not Unix ) è‡ªç”±è½¯ä»¶çš„æ–‡ä»¶å‹ç¼©ç¨‹åº ; ç”±äº gzip å¯ä»¥äº§ç”Ÿæ›´ç†æƒ³çš„å‹ç¼©æ¯”ä¾‹,ä¸€èˆ¬äººå¤šå·²æ”¹ç”¨ gzip ä¸ºæ¡£æ¡ˆå‹ç¼©å·¥å…·ã€‚</p>
</li>
<li><p>bzip2 æ˜¯ä¸€ä¸ªåŸºäº Burrows-Wheeler å˜æ¢çš„æ— æŸå‹ç¼©è½¯ä»¶,å‹ç¼©æ•ˆæœæ¯”ä¼ ç»Ÿçš„ LZ77/LZ78 å‹ç¼©ç®—æ³•æ¥å¾—å¥½ ; è‹¥è¯´ gzip æ˜¯ä¸ºäº†å–ä»£ compress å¹¶æä¾›æ›´å¥½çš„å‹ç¼©æ¯”è€Œæˆç«‹çš„,é‚£ä¹ˆ bzip2 åˆ™æ˜¯ä¸ºäº†å–ä»£ gzip å¹¶æä¾›æ›´ä½³çš„å‹ç¼©æ¯”è€Œæ¥çš„ã€‚ bzip2 è¿™ç©æ„çš„å‹ç¼©æ¯”ç«Ÿç„¶æ¯” gzip è¿˜è¦å¥½ã€‚</p>
</li>
<li><p>tar å‘½ä»¤æœ€åˆçš„è®¾è®¡ç›®çš„æ˜¯å°†æ–‡ä»¶å¤‡ä»½åˆ°ç£å¸¦ä¸Š (tape archive) ,å› è€Œå¾—å tar ã€‚</p>
</li>
</ul>
<p><img src="pic/01.png" alt="01"></p>
<h3 id="zip"><a href="#zip" class="headerlink" title=".zip"></a>.zip</h3><p>.zip æ‰©å±•åè¡¨ç¤ºæ–‡ä»¶æ˜¯ä½¿ç”¨è®¸å¤š zip å½’æ¡£ç¨‹åºå’Œå‹ç¼©ç¨‹åºä¹‹ä¸€(ä½†ä¸æ˜¯ gzip )åˆ›å»ºçš„ã€‚å› ä¸ºè¿™æ˜¯ä¸€ç§éå¸¸æµè¡Œçš„å‹ç¼©æ ¼å¼,ç®—æ³•çš„è¯¦ç»†æè¿°ä¹Ÿæœ‰å¾ˆå¤š,æ‰€ä»¥å¯ä»¥æ‰¾åˆ°ç”¨äºæ‰€æœ‰æ“ä½œç³»ç»Ÿçš„æœ‰ç”¨çš„ç§»æ¤å½¢å¼ã€‚è¿™åŒ…æ‹¬åˆ›å»ºå’Œæ‰©å±•å¸¦æœ‰ .zip æ–‡ä»¶æ‰©å±•åçš„æ¡£æ¡ˆçš„å‹ç¼©å’Œè§£å‹ç¼©å®ç”¨ç¨‹åºã€‚åœ¨ Linux ä¸Šæœ‰ä¸¤ç§è¿™æ ·çš„å·¥å…·:</p>
<p>å…è´¹çš„ Info-ZIP å’Œä»¥èµ¢åˆ©ä¸ºç›®çš„çš„ PKZIP for Linux ã€‚</p>
<p>å¦‚æœæ‚¨åªæ˜¯å¶å°”éœ€è¦åˆ›å»ºæˆ–æ‰“å¼€ zip æ–‡ä»¶,ä½¿ç”¨ Info-ZIP ã€‚å¦‚æœå¸Œæœ›ä½¿ç”¨åœ¨ MS-DOS æˆ–å…¶å®ƒç³»ç»Ÿä¸Šä½¿ç”¨çš„ç›¸åŒå·¥å…·,è¯·é€‰æ‹©PKZIP ( PKZIP å¯ç”¨äºè®¸å¤šæ“ä½œç³»ç»Ÿ)ã€‚ç”¨äºå¾®è½¯ Windows çš„ WinZIP å’Œç”¨äº Mac OS çš„Stufflt è¿™ä¸¤ç§å®ç”¨ç¨‹åºå¯ä»¥åˆ›å»ºå’Œæ‰“å¼€ç›¸äº’ä¹‹é—´å…¼å®¹çš„æ¡£æ¡ˆã€‚</p>
<p>Info-ZIP åœ¨æ— æ³•ä½¿ç”¨ gzip æˆ– tar çš„æƒ…å†µä¸‹å¯ä»¥æä¾›å‹ç¼©å’Œè§£å‹ç¼©çš„ä¸€ä¸ªä¸é”™çš„é€‰æ‹©,è¿™æˆ–è®¸æ˜¯åœ¨Linux ã€å¾®è½¯ Windows å’Œ Mac OS ç”¨æˆ·ä¹‹é—´äº¤æ¢å‹ç¼©æ–‡ä»¶çš„ä¸€ç§æœ€å¥½çš„å½¢å¼ã€‚æœ‰è®¸å¤šä¸é”™çš„ zip ç¨‹åº(æœ‰å¼€æ”¾æºç çš„,ä¹Ÿæœ‰å•†ä¸šçš„)å¯ç”¨äºè¿™äº›æ“ä½œç³»ç»Ÿ,å®ƒä»¬åº”è¯¥èƒ½ç¡®ä¿æ–‡ä»¶çš„é¡ºåˆ©äº¤æ¢(å½“ç„¶,åªè¦æ˜¯åœ¨ç‰¹å®šäºæŸä¸ªç‰¹å®šå·¥å…·çš„ç‰¹æ®ŠåŠŸèƒ½å…³é—­çš„æƒ…å†µä¸‹)ã€‚</p>
<p>rhel7 é»˜è®¤å¸¦æœ‰ info-zip è½¯ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera0 zip-3.0]# which zip</span><br><span class="line">/usr/bin/zip</span><br><span class="line">[root@mastera0 zip-3.0]# rpm -qf /usr/bin/zip</span><br><span class="line">zip-3.0-10.el7.x86_64</span><br><span class="line">[root@mastera0 zip-3.0]# head -n 18 /usr/share/doc/zip-3.0/README</span><br><span class="line">Zip 3.0 is the first Zip update adding large file support. For now Zip 2.3x</span><br><span class="line">remains available and supported, but users should switch to this new release.</span><br><span class="line">Testing for Zip 3.0 has focused mainly on Unix, VMS, Max OS X, and Win32,</span><br><span class="line">and some other ports may not be fully supported yet. If you find your</span><br><span class="line">favorite port is broke, send us the details or, better, send bug fixes. It's</span><br><span class="line">possible that support for some older ports may be dropped in the future.</span><br><span class="line">Copyright (c) 1990-2008 Info-ZIP. All rights reserved.</span><br><span class="line">See the accompanying file LICENSE (the contents of which are also included</span><br><span class="line">in unzip.h, zip.h and wiz.h) for terms of use. If, for some reason, all</span><br><span class="line">of these files are missing, the Info-ZIP license also may be found at:</span><br><span class="line">ftp://ftp.info-zip.org/pub/infozip/license.html and</span><br><span class="line">http://www.info-zip.org/pub/infozip/license.html.</span><br><span class="line">[root@mastera0 ~]# rpm -qi zip</span><br><span class="line">Name</span><br><span class="line">: zip</span><br><span class="line">Version : 3.0</span><br><span class="line">Release : 10.el7</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Install Date: Thu 23 Jun 2016 01:50:41 PM CST</span><br><span class="line">Group</span><br><span class="line">: Applications/Archiving</span><br><span class="line">Size</span><br><span class="line">: 815045License : BSD</span><br><span class="line">Signature : RSA/SHA256, Thu 03 Apr 2014 06:52:17 AM CST, Key ID 199e2f91fd431d51</span><br><span class="line">Source RPM : zip-3.0-10.el7.src.rpm</span><br><span class="line">Build Date : Tue 28 Jan 2014 06:35:49 AM CST</span><br><span class="line">Build Host : x86-019.build.eng.bos.redhat.com</span><br><span class="line">Relocations : (not relocatable)</span><br><span class="line">Packager : Red Hat, Inc. &lt;http://bugzilla.redhat.com/bugzilla&gt;</span><br><span class="line">Vendor</span><br><span class="line">: Red Hat, Inc.</span><br><span class="line">URL</span><br><span class="line">: http://www.info-zip.org/Zip.html</span><br><span class="line">Summary : A file compression and packaging utility compatible with PKZIP</span><br><span class="line">Description :</span><br><span class="line">The zip program is a compression and file packaging utility. Zip is</span><br><span class="line">analogous to a combination of the UNIX tar and compress commands and</span><br><span class="line">is compatible with PKZIP (a compression and file packaging utility for</span><br><span class="line">MS-DOS systems).</span><br><span class="line">Install the zip package if you need to compress files using the zip</span><br><span class="line">program.</span><br></pre></td></tr></table></figure>

<h4 id="zip-å‘½ä»¤ç”¨æ³•"><a href="#zip-å‘½ä»¤ç”¨æ³•" class="headerlink" title="zip å‘½ä»¤ç”¨æ³•"></a>zip å‘½ä»¤ç”¨æ³•</h4><p>zip å‘½ä»¤å¯ä»¥ç”¨æ¥è§£å‹ç¼©æ–‡ä»¶,æˆ–è€…å¯¹æ–‡ä»¶è¿›è¡Œæ‰“åŒ…æ“ä½œã€‚ zip æ˜¯ä¸ªä½¿ç”¨å¹¿æ³›çš„å‹ç¼©ç¨‹åº,æ–‡ä»¶ç»å®ƒå‹ç¼©åä¼šå¦å¤–äº§ç”Ÿå…·æœ‰ â€œ .zipâ€ æ‰©å±•åçš„å‹ç¼©æ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¯­æ³• zip( é€‰é¡¹ )( å‚æ•° )</span><br><span class="line"></span><br><span class="line">é€‰é¡¹</span><br><span class="line"></span><br><span class="line">-A :è°ƒæ•´å¯æ‰§è¡Œçš„è‡ªåŠ¨è§£å‹ç¼©æ–‡ä»¶;</span><br><span class="line">-b&lt; å·¥ä½œç›®å½• &gt; :æŒ‡å®šæš‚æ—¶å­˜æ”¾æ–‡ä»¶çš„ç›®å½•;</span><br><span class="line">-c :æ›¿æ¯ä¸ªè¢«å‹ç¼©çš„æ–‡ä»¶åŠ ä¸Šæ³¨é‡Š;</span><br><span class="line">-d :ä»å‹ç¼©æ–‡ä»¶å†…åˆ é™¤æŒ‡å®šçš„æ–‡ä»¶;</span><br><span class="line">-D :å‹ç¼©æ–‡ä»¶å†…ä¸å»ºç«‹ç›®å½•åç§°;</span><br><span class="line">-f :æ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®š â€œ -uâ€ å‚æ•°ç±»ä¼¼,ä½†ä¸ä»…æ›´æ–°æ—¢æœ‰æ–‡ä»¶,å¦‚æœæŸäº›æ–‡ä»¶åŸæœ¬ä¸å­˜åœ¨äºå‹ç¼©æ–‡</span><br><span class="line">ä»¶å†…,ä½¿ç”¨æœ¬å‚æ•°ä¼šä¸€å¹¶å°†å…¶åŠ å…¥å‹ç¼©æ–‡ä»¶ä¸­;</span><br><span class="line">-F :å°è¯•ä¿®å¤å·²æŸåçš„å‹ç¼©æ–‡ä»¶;</span><br><span class="line">-g :å°†æ–‡ä»¶å‹ç¼©åé™„åŠ åœ¨å·²æœ‰çš„å‹ç¼©æ–‡ä»¶ä¹‹å,è€Œéå¦è¡Œå»ºç«‹æ–°çš„å‹ç¼©æ–‡ä»¶;</span><br><span class="line">-h :åœ¨çº¿å¸®åŠ©;</span><br><span class="line">-i&lt; èŒƒæœ¬æ ·å¼ &gt; :åªå‹ç¼©ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶;</span><br><span class="line">-j :åªä¿å­˜æ–‡ä»¶åç§°åŠå…¶å†…å®¹,è€Œä¸å­˜æ”¾ä»»ä½•ç›®å½•åç§°;</span><br><span class="line">-J :åˆ é™¤å‹ç¼©æ–‡ä»¶å‰é¢ä¸å¿…è¦çš„æ•°æ®;</span><br><span class="line">-k :ä½¿ç”¨ MS-DOS å…¼å®¹æ ¼å¼çš„æ–‡ä»¶åç§°;</span><br><span class="line">-l :å‹ç¼©æ–‡ä»¶æ—¶,æŠŠ LF å­—ç¬¦ç½®æ¢æˆ LF+CR å­—ç¬¦;</span><br><span class="line">-ll :å‹ç¼©æ–‡ä»¶æ—¶,æŠŠ LF+cp å­—ç¬¦ç½®æ¢æˆ LF å­—ç¬¦;</span><br><span class="line">-L :æ˜¾ç¤ºç‰ˆæƒä¿¡æ¯;</span><br><span class="line">-m :å°†æ–‡ä»¶å‹ç¼©å¹¶åŠ å…¥å‹ç¼©æ–‡ä»¶å,åˆ é™¤åŸå§‹æ–‡ä»¶,å³æŠŠæ–‡ä»¶ç§»åˆ°å‹ç¼©æ–‡ä»¶ä¸­;</span><br><span class="line">-n&lt; å­—å°¾å­—ç¬¦ä¸² &gt; :ä¸å‹ç¼©å…·æœ‰ç‰¹å®šå­—å°¾å­—ç¬¦ä¸²çš„æ–‡ä»¶;</span><br><span class="line">-o :ä»¥å‹ç¼©æ–‡ä»¶å†…æ‹¥æœ‰æœ€æ–°æ›´æ”¹æ—¶é—´çš„æ–‡ä»¶ä¸ºå‡†,å°†å‹ç¼©æ–‡ä»¶çš„æ›´æ”¹æ—¶é—´è®¾æˆå’Œè¯¥æ–‡ä»¶ç›¸åŒ;</span><br><span class="line">-q :ä¸æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹;</span><br><span class="line">-r :é€’å½’å¤„ç†,å°†æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ä¸€å¹¶å¤„ç†;</span><br><span class="line">-S :åŒ…å«ç³»ç»Ÿå’Œéšè—æ–‡ä»¶;</span><br><span class="line">-t&lt; æ—¥æœŸæ—¶é—´ &gt; :æŠŠå‹ç¼©æ–‡ä»¶çš„æ—¥æœŸè®¾æˆæŒ‡å®šçš„æ—¥æœŸ;</span><br><span class="line">-T :æ£€æŸ¥å¤‡ä»½æ–‡ä»¶å†…çš„æ¯ä¸ªæ–‡ä»¶æ˜¯å¦æ­£ç¡®æ— è¯¯;</span><br><span class="line">-u :æ›´æ¢è¾ƒæ–°çš„æ–‡ä»¶åˆ°å‹ç¼©æ–‡ä»¶å†…;</span><br><span class="line">-v :æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹æˆ–æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯;</span><br><span class="line">-V :ä¿å­˜ VMS æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶å±æ€§;</span><br><span class="line">-w :åœ¨æ–‡ä»¶åç§°é‡Œå‡å¦‚ç‰ˆæœ¬ç¼–å·,æœ¬å‚æ•°ä»…åœ¨ VMS æ“ä½œç³»ç»Ÿä¸‹æœ‰æ•ˆ;</span><br><span class="line">-x&lt; èŒƒæœ¬æ ·å¼ &gt; :å‹ç¼©æ—¶æ’é™¤ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶;</span><br><span class="line">-X :ä¸ä¿å­˜é¢å¤–çš„æ–‡ä»¶å±æ€§;</span><br><span class="line">-y :ç›´æ¥ä¿å­˜ç¬¦å·è¿æ¥,è€Œéè¯¥é“¾æ¥æ‰€æŒ‡å‘çš„æ–‡ä»¶,æœ¬å‚æ•°ä»…åœ¨ UNIX ä¹‹ç±»çš„ç³»ç»Ÿä¸‹æœ‰æ•ˆ;</span><br><span class="line">-z :æ›¿å‹ç¼©æ–‡ä»¶åŠ ä¸Šæ³¨é‡Š;</span><br><span class="line"><span class="meta">-$</span><span class="bash"> :ä¿å­˜ç¬¬ä¸€ä¸ªè¢«å‹ç¼©æ–‡ä»¶æ‰€åœ¨ç£ç›˜çš„å·å†Œåç§°;</span></span><br><span class="line">-&lt; å‹ç¼©æ•ˆç‡ &gt; :å‹ç¼©æ•ˆç‡æ˜¯ä¸€ä¸ªä»‹äº 1~9 çš„æ•°å€¼ã€‚</span><br><span class="line">å‚æ•°</span><br><span class="line">zip å‹ç¼©åŒ…:æŒ‡å®šè¦åˆ›å»ºçš„ zip å‹ç¼©åŒ…;</span><br><span class="line">æ–‡ä»¶åˆ—è¡¨:æŒ‡å®šè¦å‹ç¼©çš„æ–‡ä»¶åˆ—è¡¨ã€‚</span><br><span class="line">å®ä¾‹</span><br><span class="line">zip -q -r html.zip /home/Blinux/html</span><br><span class="line">zip -q -r html.zip *</span><br></pre></td></tr></table></figure>

<h4 id="unzip-çš„ç”¨æ³•"><a href="#unzip-çš„ç”¨æ³•" class="headerlink" title="unzip çš„ç”¨æ³•"></a>unzip çš„ç”¨æ³•</h4><p>unzip å‘½ä»¤ç”¨äºè§£å‹ç¼©ç”± zip å‘½ä»¤å‹ç¼©çš„ â€œ .zipâ€ å‹ç¼©åŒ…</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¯­æ³• unzip( é€‰é¡¹ )( å‚æ•° )</span><br><span class="line"></span><br><span class="line">é€‰é¡¹</span><br><span class="line"></span><br><span class="line">-c :å°†è§£å‹ç¼©çš„ç»“æœæ˜¾ç¤ºåˆ°å±å¹•ä¸Š,å¹¶å¯¹å­—ç¬¦åšé€‚å½“çš„è½¬æ¢;</span><br><span class="line">-f :æ›´æ–°ç°æœ‰çš„æ–‡ä»¶;</span><br><span class="line">-l :æ˜¾ç¤ºå‹ç¼©æ–‡ä»¶å†…æ‰€åŒ…å«çš„æ–‡ä»¶;</span><br><span class="line">-p :ä¸ -c å‚æ•°ç±»ä¼¼,ä¼šå°†è§£å‹ç¼©çš„ç»“æœæ˜¾ç¤ºåˆ°å±å¹•ä¸Š,ä½†ä¸ä¼šæ‰§è¡Œä»»ä½•çš„è½¬æ¢;</span><br><span class="line">-t :æ£€æŸ¥å‹ç¼©æ–‡ä»¶æ˜¯å¦æ­£ç¡®;</span><br><span class="line">-u :ä¸ -f å‚æ•°ç±»ä¼¼,ä½†æ˜¯é™¤äº†æ›´æ–°ç°æœ‰çš„æ–‡ä»¶å¤–,ä¹Ÿä¼šå°†å‹ç¼©æ–‡ä»¶ä¸­çš„å…¶ä»–æ–‡ä»¶è§£å‹ç¼©åˆ°ç›®å½•ä¸­;</span><br><span class="line">-v :æ‰§è¡Œæ—¶æ˜¾ç¤ºè¯¦ç»†çš„ä¿¡æ¯;</span><br><span class="line">-z :ä»…æ˜¾ç¤ºå‹ç¼©æ–‡ä»¶çš„å¤‡æ³¨æ–‡å­—;</span><br><span class="line">-a :å¯¹æ–‡æœ¬æ–‡ä»¶è¿›è¡Œå¿…è¦çš„å­—ç¬¦è½¬æ¢;</span><br><span class="line">-b :ä¸è¦å¯¹æ–‡æœ¬æ–‡ä»¶è¿›è¡Œå­—ç¬¦è½¬æ¢;</span><br><span class="line">-C :å‹ç¼©æ–‡ä»¶ä¸­çš„æ–‡ä»¶åç§°åŒºåˆ†å¤§å°å†™;</span><br><span class="line">-j :ä¸å¤„ç†å‹ç¼©æ–‡ä»¶ä¸­åŸæœ‰çš„ç›®å½•è·¯å¾„;</span><br><span class="line">-L :å°†å‹ç¼©æ–‡ä»¶ä¸­çš„å…¨éƒ¨æ–‡ä»¶åæ”¹ä¸ºå°å†™;</span><br><span class="line">-M :å°†è¾“å‡ºç»“æœé€åˆ° more ç¨‹åºå¤„ç†;</span><br><span class="line">-n :è§£å‹ç¼©æ—¶ä¸è¦è¦†ç›–åŸæœ‰çš„æ–‡ä»¶;</span><br><span class="line">-o :ä¸å¿…å…ˆè¯¢é—®ç”¨æˆ·, unzip æ‰§è¡Œåè¦†ç›–åŸæœ‰çš„æ–‡ä»¶;</span><br><span class="line">-P&lt; å¯†ç  &gt; :ä½¿ç”¨ zip çš„å¯†ç é€‰é¡¹;</span><br><span class="line">-q :æ‰§è¡Œæ—¶ä¸æ˜¾ç¤ºä»»ä½•ä¿¡æ¯;</span><br><span class="line">-s :å°†æ–‡ä»¶åä¸­çš„ç©ºç™½å­—ç¬¦è½¬æ¢ä¸ºåº•çº¿å­—ç¬¦;</span><br><span class="line">-V :ä¿ç•™ VMS çš„æ–‡ä»¶ç‰ˆæœ¬ä¿¡æ¯;</span><br><span class="line">-X :è§£å‹ç¼©æ—¶åŒæ—¶å›å­˜æ–‡ä»¶åŸæ¥çš„ UID/GID ;</span><br><span class="line">-d&lt; ç›®å½• &gt; :æŒ‡å®šæ–‡ä»¶è§£å‹ç¼©åæ‰€è¦å­˜å‚¨çš„ç›®å½•;</span><br><span class="line">-x&lt; æ–‡ä»¶ &gt; :æŒ‡å®šä¸è¦å¤„ç† .zip å‹ç¼©æ–‡ä»¶ä¸­çš„å“ªäº›æ–‡ä»¶;</span><br><span class="line">-Z : unzip-Z ç­‰äºæ‰§è¡Œ zipinfo æŒ‡ä»¤</span><br><span class="line"></span><br><span class="line">å‚æ•° å‹ç¼©åŒ…:æŒ‡å®šè¦è§£å‹çš„ â€œ .zipâ€ å‹ç¼©åŒ…ã€‚</span><br><span class="line"></span><br><span class="line">å®ä¾‹</span><br><span class="line"></span><br><span class="line">unzip test.zip</span><br><span class="line">unzip -v test.zip</span><br><span class="line">unzip -n test.zip -d /tmp</span><br></pre></td></tr></table></figure>

<h3 id="gz"><a href="#gz" class="headerlink" title=".gz"></a>.gz</h3><h4 id="gzip-çš„ç”¨æ³•"><a href="#gzip-çš„ç”¨æ³•" class="headerlink" title="gzip çš„ç”¨æ³•"></a>gzip çš„ç”¨æ³•</h4><p>gzip å‘½ä»¤ç”¨æ¥å‹ç¼©æ–‡ä»¶ã€‚ gzip æ˜¯ä¸ªä½¿ç”¨å¹¿æ³›çš„å‹ç¼©ç¨‹åº,æ–‡ä»¶ç»å®ƒå‹ç¼©è¿‡å,å…¶åç§°åé¢ä¼šå¤šå¤„ â€œ .gzâ€æ‰©å±•åã€‚ gzip æ˜¯åœ¨ Linux ç³»ç»Ÿä¸­ç»å¸¸ä½¿ç”¨çš„ä¸€ä¸ªå¯¹æ–‡ä»¶è¿›è¡Œå‹ç¼©å’Œè§£å‹ç¼©çš„å‘½ä»¤,æ—¢æ–¹ä¾¿åˆå¥½ç”¨ã€‚</p>
<p>gzip ä¸ä»…å¯ä»¥ç”¨æ¥å‹ç¼©å¤§çš„ã€è¾ƒå°‘ä½¿ç”¨çš„æ–‡ä»¶ä»¥èŠ‚çœç£ç›˜ç©ºé—´,è¿˜å¯ä»¥å’Œ tar å‘½ä»¤ä¸€èµ·æ„æˆ Linux æ“ä½œç³»ç»Ÿä¸­æ¯”è¾ƒæµè¡Œçš„å‹ç¼©æ–‡ä»¶æ ¼å¼ã€‚æ®ç»Ÿè®¡, gzip å‘½ä»¤å¯¹æ–‡æœ¬æ–‡ä»¶æœ‰ 60% ~ 70% çš„å‹ç¼©ç‡ã€‚å‡å°‘æ–‡ä»¶å¤§å°æœ‰ä¸¤ä¸ªæ˜æ˜¾çš„å¥½å¤„,ä¸€æ˜¯å¯ä»¥å‡å°‘å­˜å‚¨ç©ºé—´,äºŒæ˜¯é€šè¿‡ç½‘ç»œä¼ è¾“æ–‡ä»¶æ—¶,å¯ä»¥å‡å°‘ä¼ è¾“çš„æ—¶é—´ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¯­æ³• gzip( é€‰é¡¹ )( å‚æ•° )</span><br><span class="line"></span><br><span class="line">é€‰é¡¹</span><br><span class="line"></span><br><span class="line">-a æˆ– â€”â€” ascii :ä½¿ç”¨ ASCII æ–‡å­—æ¨¡å¼;</span><br><span class="line">-d æˆ– --decompress æˆ– ----uncompress :è§£å¼€å‹ç¼©æ–‡ä»¶;</span><br><span class="line">-f æˆ– â€”â€” force :å¼ºè¡Œå‹ç¼©æ–‡ä»¶ã€‚ä¸ç†ä¼šæ–‡ä»¶åç§°æˆ–ç¡¬è¿æ¥æ˜¯å¦å­˜åœ¨ä»¥åŠè¯¥æ–‡ä»¶æ˜¯å¦ä¸ºç¬¦å·è¿æ¥;</span><br><span class="line">-h æˆ– â€”â€” help :åœ¨çº¿å¸®åŠ©;</span><br><span class="line">-l æˆ– â€”â€” list :åˆ—å‡ºå‹ç¼©æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯;</span><br><span class="line">-L æˆ– â€”â€” license :æ˜¾ç¤ºç‰ˆæœ¬ä¸ç‰ˆæƒä¿¡æ¯;</span><br><span class="line">-n æˆ– --no-name :å‹ç¼©æ–‡ä»¶æ—¶,ä¸ä¿å­˜åŸæ¥çš„æ–‡ä»¶åç§°åŠæ—¶é—´æˆ³è®°;</span><br><span class="line">-N æˆ– â€”â€” name :å‹ç¼©æ–‡ä»¶æ—¶,ä¿å­˜åŸæ¥çš„æ–‡ä»¶åç§°åŠæ—¶é—´æˆ³è®°;</span><br><span class="line">-q æˆ– â€”â€” quiet :ä¸æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯;</span><br><span class="line">-r æˆ– â€”â€” recursive :é€’å½’å¤„ç†,å°†æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åŠå­ç›®å½•ä¸€å¹¶å¤„ç†;</span><br><span class="line">-S æˆ– &lt; å‹ç¼©å­—å°¾å­—ç¬¦ä¸² &gt; æˆ– ----suffix&lt; å‹ç¼©å­—å°¾å­—ç¬¦ä¸² &gt; :æ›´æ”¹å‹ç¼©å­—å°¾å­—ç¬¦ä¸²;</span><br><span class="line">-t æˆ– â€”â€” test :æµ‹è¯•å‹ç¼©æ–‡ä»¶æ˜¯å¦æ­£ç¡®æ— è¯¯;</span><br><span class="line">-v æˆ– â€”â€” verbose :æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹;</span><br><span class="line">-V æˆ– â€”â€” version :æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯;</span><br><span class="line">-&lt; å‹ç¼©æ•ˆç‡ &gt; :å‹ç¼©æ•ˆç‡æ˜¯ä¸€ä¸ªä»‹äº 1~9 çš„æ•°å€¼,é¢„è®¾å€¼ä¸º â€œ 6â€ ,æŒ‡å®šæ„ˆå¤§çš„æ•°å€¼,å‹ç¼©æ•ˆç‡å°±ä¼š</span><br><span class="line">æ„ˆé«˜;</span><br><span class="line">--best :æ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®š â€œ -9â€ å‚æ•°ç›¸åŒ;</span><br><span class="line">--fast :æ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®š â€œ -1â€ å‚æ•°ç›¸åŒã€‚</span><br><span class="line"></span><br><span class="line">å‚æ•° æ–‡ä»¶åˆ—è¡¨:æŒ‡å®šè¦å‹ç¼©çš„æ–‡ä»¶æˆ–æŒ‡å®šè¦è§£å‹çš„æ–‡ä»¶ã€‚ã€‚</span><br><span class="line"></span><br><span class="line">å®ä¾‹</span><br><span class="line"></span><br><span class="line">gzip * å°†å½“å‰ç›®å½•ä¸‹çš„æ¯ä¸ªæ–‡ä»¶éƒ½å‹ç¼©æˆ .gz æ–‡ä»¶</span><br><span class="line">gzip test å°† test æ–‡ä»¶å‹ç¼©æˆ test.gz æ–‡ä»¶å¹¶åˆ é™¤æºæ–‡ä»¶</span><br><span class="line">gzip -rv /tmp ç¬¬å½’å‹ç¼©ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶,å‹ç¼©æˆ .gz ç»“å°¾çš„æ–‡ä»¶,å¹¶æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹</span><br><span class="line">gizp -dr /tmp ç¬¬å½’è§£å‹ /tmp ç›®å½•ä¸‹çš„ .gz ç»“å°¾çš„æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h4 id="gunzip-çš„ç”¨æ³•"><a href="#gunzip-çš„ç”¨æ³•" class="headerlink" title="gunzip çš„ç”¨æ³•"></a>gunzip çš„ç”¨æ³•</h4><p>gunzip å‘½ä»¤ç”¨æ¥è§£å‹ç¼©æ–‡ä»¶ã€‚ gunzip æ˜¯ä¸ªä½¿ç”¨å¹¿æ³›çš„è§£å‹ç¼©ç¨‹åº,å®ƒç”¨äºè§£å¼€è¢« gzip å‹ç¼©è¿‡çš„æ–‡ä»¶,è¿™äº›å‹ç¼©æ–‡ä»¶é¢„è®¾æœ€åçš„æ‰©å±•åä¸º .gz ã€‚å…¶å®å‹ç¼©æˆ–è§£å‹ç¼©,éƒ½å¯é€šè¿‡ gzip æŒ‡ä»¤å•ç‹¬å®Œæˆã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¯­æ³• gunzip( é€‰é¡¹ )( å‚æ•° )</span><br><span class="line"></span><br><span class="line">é€‰é¡¹</span><br><span class="line"></span><br><span class="line">-a æˆ– â€”â€” ascii :ä½¿ç”¨ ASCII æ–‡å­—æ¨¡å¼;</span><br><span class="line">-c æˆ– --stdout æˆ– --to-stdout :æŠŠè§£å‹åçš„æ–‡ä»¶è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡;</span><br><span class="line">-f æˆ– -force :å¼ºè¡Œè§£å¼€å‹ç¼©æ–‡ä»¶,ä¸ç†ä¼šæ–‡ä»¶åç§°æˆ–ç¡¬è¿æ¥æ˜¯å¦å­˜åœ¨ä»¥åŠè¯¥æ–‡ä»¶æ˜¯å¦ä¸ºç¬¦å·è¿æ¥;</span><br><span class="line">-h æˆ– â€”â€” help :åœ¨çº¿å¸®åŠ©;</span><br><span class="line">-l æˆ– â€”â€” list :åˆ—å‡ºå‹ç¼©æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯;</span><br><span class="line">-L æˆ– â€”â€” license :æ˜¾ç¤ºç‰ˆæœ¬ä¸ç‰ˆæƒä¿¡æ¯;</span><br><span class="line">-n æˆ– --no-name :è§£å‹ç¼©æ—¶,è‹¥å‹ç¼©æ–‡ä»¶å†…å«æœ‰åŸæ¥çš„æ–‡ä»¶åç§°åŠæ—¶é—´æˆ³è®°,åˆ™å°†å…¶å¿½ç•¥ä¸äºˆå¤„ç†;</span><br><span class="line">-N æˆ– â€”â€” name :è§£å‹ç¼©æ—¶,è‹¥å‹ç¼©æ–‡ä»¶å†…å«æœ‰åŸæ¥çš„æ–‡ä»¶åç§°åŠæ—¶é—´æˆ³è®°,åˆ™å°†å…¶å›å­˜åˆ°è§£å¼€</span><br><span class="line">çš„æ–‡ä»¶ä¸Š;</span><br><span class="line">-q æˆ– â€”â€” quiet :ä¸æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯;</span><br><span class="line">-r æˆ– â€”â€” recursive :é€’å½’å¤„ç†,å°†æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åŠå­ç›®å½•ä¸€å¹¶å¤„ç†;</span><br><span class="line">-S æˆ– &lt; å‹ç¼©å­—å°¾å­—ç¬¦ä¸² &gt; æˆ– ----suffix&lt; å‹ç¼©å­—å°¾å­—ç¬¦ä¸² &gt; :æ›´æ”¹å‹ç¼©å­—å°¾å­—ç¬¦ä¸²;</span><br><span class="line">-t æˆ– â€”â€” test :æµ‹è¯•å‹ç¼©æ–‡ä»¶æ˜¯å¦æ­£ç¡®æ— è¯¯;</span><br><span class="line">-v æˆ– â€”â€” verbose :æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹;</span><br><span class="line">-V æˆ– â€”â€” version :æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯;</span><br><span class="line"></span><br><span class="line">å‚æ•° æ–‡ä»¶åˆ—è¡¨:æŒ‡å®šè¦è§£å‹çš„å‹ç¼©åŒ…ã€‚</span><br><span class="line"></span><br><span class="line">å®ä¾‹</span><br><span class="line">gzip -d test.gz</span><br><span class="line">gunzip test.gz</span><br><span class="line">æ•ˆæœä¸€æ ·</span><br></pre></td></tr></table></figure>

<h3 id="bz2"><a href="#bz2" class="headerlink" title=".bz2"></a>.bz2</h3><h4 id="bzip2-çš„ç”¨æ³•"><a href="#bzip2-çš„ç”¨æ³•" class="headerlink" title="bzip2 çš„ç”¨æ³•"></a>bzip2 çš„ç”¨æ³•</h4><p>bzip2 å‘½ä»¤ç”¨äºåˆ›å»ºå’Œç®¡ç†(åŒ…æ‹¬è§£å‹ç¼©) â€œ .bz2â€ æ ¼å¼çš„å‹ç¼©åŒ…ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¯­æ³• bzip2( é€‰é¡¹ )( å‚æ•° )</span><br><span class="line"></span><br><span class="line">é€‰é¡¹</span><br><span class="line"></span><br><span class="line">-c æˆ– â€”â€” stdout :å°†å‹ç¼©ä¸è§£å‹ç¼©çš„ç»“æœé€åˆ°æ ‡å‡†è¾“å‡º;</span><br><span class="line">-d æˆ– â€”â€” decompress :æ‰§è¡Œè§£å‹ç¼©;</span><br><span class="line">-f æˆ– -force : bzip2 åœ¨å‹ç¼©æˆ–è§£å‹ç¼©æ—¶,è‹¥è¾“å‡ºæ–‡ä»¶ä¸ç°æœ‰æ–‡ä»¶åŒå,é¢„è®¾ä¸ä¼šè¦†ç›–ç°æœ‰æ–‡ä»¶ã€‚è‹¥</span><br><span class="line">è¦è¦†ç›–ã€‚è¯·ä½¿ç”¨æ­¤å‚æ•°;</span><br><span class="line">-h æˆ– â€”â€” help :åœ¨çº¿å¸®åŠ©;</span><br><span class="line">-k æˆ– â€”â€” keep : bzip2 åœ¨å‹ç¼©æˆ–è§£å‹ç¼©å,ä¼šåˆ é™¤åŸå§‹æ–‡ä»¶ã€‚è‹¥è¦ä¿ç•™åŸå§‹æ–‡ä»¶,è¯·ä½¿ç”¨æ­¤å‚æ•°;</span><br><span class="line">-s æˆ– â€”â€” small :é™ä½ç¨‹åºæ‰§è¡Œæ—¶å†…å­˜çš„ä½¿ç”¨é‡;</span><br><span class="line">-t æˆ– â€”â€” test :æµ‹è¯• .bz2 å‹ç¼©æ–‡ä»¶çš„å®Œæ•´æ€§;</span><br><span class="line">-v æˆ– â€”â€” verbose :å‹ç¼©æˆ–è§£å‹ç¼©æ–‡ä»¶æ—¶,æ˜¾ç¤ºè¯¦ç»†çš„ä¿¡æ¯;</span><br><span class="line">-z æˆ– â€”â€” compress :å¼ºåˆ¶æ‰§è¡Œå‹ç¼©;</span><br><span class="line">-V æˆ– â€”â€” version :æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯;</span><br><span class="line">--repetitive-best :è‹¥æ–‡ä»¶ä¸­æœ‰é‡å¤å‡ºç°çš„èµ„æ–™æ—¶,å¯åˆ©ç”¨æ­¤å‚æ•°æé«˜å‹ç¼©æ•ˆæœ;</span><br><span class="line">--repetitive-fast :è‹¥æ–‡ä»¶ä¸­æœ‰é‡å¤å‡ºç°çš„èµ„æ–™æ—¶,å¯åˆ©ç”¨æ­¤å‚æ•°åŠ å¿«æ‰§è¡Œæ•ˆæœã€‚</span><br><span class="line"></span><br><span class="line">å‚æ•° æ–‡ä»¶åˆ—è¡¨:æŒ‡å®šè¦å‹ç¼©çš„æ–‡ä»¶æˆ–æŒ‡å®šè¦è§£å‹çš„æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">å®ä¾‹</span><br><span class="line"></span><br><span class="line">bzip2 test å‹ç¼© test æ–‡ä»¶,ç”Ÿæˆå‹ç¼©æ–‡ä»¶ test.bz2 ,å¹¶åˆ é™¤æºæ–‡ä»¶</span><br><span class="line">bzip2 -k test å‹ç¼© test æ–‡ä»¶,ç”Ÿæˆå‹ç¼©æ–‡ä»¶ test.bz2 ,å¹¶ä¿ç•™æºæ–‡ä»¶</span><br><span class="line">bzip2 -d test.bz2 è§£å‹æ–‡ä»¶</span><br><span class="line">bunzip2 test.bz2 è§£å‹æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h4 id="bunzip2-çš„ç”¨æ³•"><a href="#bunzip2-çš„ç”¨æ³•" class="headerlink" title="bunzip2 çš„ç”¨æ³•"></a>bunzip2 çš„ç”¨æ³•</h4><p>bunzip2 å‘½ä»¤è§£å‹ç¼©ç”± bzip2 æŒ‡ä»¤åˆ›å»ºçš„ â€ .bz2â€ å‹ç¼©åŒ…ã€‚å¯¹æ–‡ä»¶è¿›è¡Œå‹ç¼©ä¸è§£å‹ç¼©ã€‚æ­¤å‘½ä»¤ç±»ä¼¼äºâ€œ gzip/gunzipâ€ å‘½ä»¤,åªèƒ½å¯¹æ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚å¯¹äºç›®å½•åªèƒ½å‹ç¼©ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶,å‹ç¼©å®Œæˆå,åœ¨ç›®å½•ä¸‹ç”Ÿæˆä»¥ â€œ .bz2â€ ä¸ºåç¼€çš„å‹ç¼©åŒ…ã€‚ bunzip2 å…¶å®æ˜¯ bzip2 çš„ç¬¦å·é“¾æ¥,å³è½¯é“¾æ¥,å› æ­¤å‹ç¼©è§£å‹éƒ½å¯ä»¥é€šè¿‡ bzip2 å®ç°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera0 ~]# which bzip2</span><br><span class="line">/usr/bin/bzip2</span><br><span class="line">[root@mastera0 ~]# which bunzip2</span><br><span class="line">/usr/bin/bunzip2</span><br><span class="line">[root@mastera0 ~]# ll -i /usr/bin/bzip2</span><br><span class="line">33853111 -rwxr-xr-x. 1 root root 36752 Jul 31 2014 /usr/bin/bzip2</span><br><span class="line">[root@mastera0 ~]# ll -i /usr/bin/bunzip2</span><br><span class="line">34293684 lrwxrwxrwx. 1 root root 5 Jun 23 13:50 /usr/bin/bunzip2 -&gt; bzip2</span><br><span class="line"></span><br><span class="line">bunzip2 [ -fkvsVL ] [ filenames ... ]</span><br><span class="line"></span><br><span class="line">-f æˆ– --force :è§£å‹ç¼©æ—¶,è‹¥è¾“å‡ºçš„æ–‡ä»¶ä¸ç°æœ‰æ–‡ä»¶åŒåæ—¶,é¢„è®¾ä¸ä¼šè¦†ç›–ç°æœ‰çš„æ–‡ä»¶;</span><br><span class="line">-k æˆ– --keep :åœ¨è§£å‹ç¼©å,é¢„è®¾ä¼šåˆ é™¤åŸæ¥çš„å‹ç¼©æ–‡ä»¶ã€‚è‹¥è¦ä¿ç•™å‹ç¼©æ–‡ä»¶,è¯·ä½¿ç”¨æ­¤å‚æ•°;</span><br><span class="line">-s æˆ– --small :é™ä½ç¨‹åºæ‰§è¡Œæ—¶,å†…å­˜çš„ä½¿ç”¨é‡;</span><br><span class="line">-v æˆ– --verbose :è§£å‹ç¼©æ–‡ä»¶æ—¶,æ˜¾ç¤ºè¯¦ç»†çš„ä¿¡æ¯;</span><br><span class="line">-l , --license , -V æˆ– â€”â€” version :æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure>


<h3 id="xz"><a href="#xz" class="headerlink" title=".xz"></a>.xz</h3><p>XZ Utils æ˜¯ä¸º POSIX å¹³å°å¼€å‘å…·æœ‰é«˜å‹ç¼©ç‡çš„å·¥å…·ã€‚å®ƒä½¿ç”¨ LZMA2 å‹ç¼©ç®—æ³•,ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶æ¯”POSIX å¹³å°ä¼ ç»Ÿä½¿ç”¨çš„ gzipã€bzip2 ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶æ›´å°,è€Œä¸”è§£å‹ç¼©é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚æœ€åˆ XZ Utilsçš„æ˜¯åŸºäº LZMA-SDK å¼€å‘,ä½†æ˜¯ LZMA-SDK åŒ…å«äº†ä¸€äº› WINDOWS å¹³å°çš„ç‰¹æ€§,æ‰€ä»¥ XZ Utils ä¸ºä»¥é€‚åº” POSIX å¹³å°ä½œäº†å¤§å¹…çš„ä¿®æ”¹ã€‚XZ Utils çš„å‡ºç°ä¹Ÿæ˜¯ä¸ºäº†å–ä»£ POSIX ç³»ç»Ÿä¸­æ—§çš„ LZMA Utilsã€‚XZ Utils ä¸»è¦åŒ…å«äº†ä¸‹åˆ—éƒ¨åˆ†:</p>
<ul>
<li>å‘½ä»¤è¡Œç¨‹åº xz ,ç”¨æ¥ç”Ÿæˆå’Œè§£å‹ç¼© .xz å‹ç¼©æ–‡ä»¶ã€‚</li>
<li>ä¸€ç»„å®ç”¨çš„è„šæœ¬å·¥å…· (xzcat, xdiff, xzgrep ç­‰)æä¾›æµè§ˆ,æŸ¥æ‰¾ä»¥åŠæ¯”è¾ƒ .xz æ–‡ä»¶å†…<br>å®¹ç­‰åŠŸèƒ½ã€‚</li>
<li>liblzma å‹ç¼©åº“,æä¾›ç®—æ³•çš„å®ç°å’Œè¿‘ä¼¼äº ZLIB çš„ç¼–ç¨‹æ¥å£ã€‚</li>
<li>æä¾›å¯¹ LZMA Utils çš„ä¸€äº›å…¼å®¹</li>
</ul>
<p>xz æ–‡ä»¶æ ¼å¼</p>
<p>XZ Utils å·¥å…·ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶æ‰©å±•åä¸º .xz (MIME ç±»å‹ä¸ºâ€application/x-xzâ€)ã€‚</p>
<p>.xz æ–‡ä»¶æ ¼å¼å…·æœ‰ä¸‹åˆ—ç‰¹ç‚¹:</p>
<ul>
<li>åŸºäºæ•°æ®æµ: æ˜“äºé€šè¿‡ç®¡é“ (pipe) ç”Ÿæˆå‹ç¼©æ–‡ä»¶æˆ–è§£å‹ç¼©æ–‡ä»¶ã€‚.xz æ–‡ä»¶æ ¼å¼ä¸ .gz/.bz2 æ–‡ä»¶ä¸€æ ·,ä¸å…·å¤‡å¯¹å¤šä¸ªæ–‡ä»¶è¿›è¡Œå½’æ¡£æ‰“åŒ…çš„èƒ½åŠ›ã€‚è‹¥è¦å¤„ç†å¤šä¸ªæ–‡ä»¶,å¯ä»¥å’Œå½’æ¡£å·¥å…· tar ç»“åˆä½¿ç”¨,ç”Ÿæˆæ‰©å±•åä¸º .tar.xz æˆ– .txz çš„å‹ç¼©æ–‡ä»¶ã€‚</li>
<li>éšæœºè¯»å–: å­˜å‚¨çš„æ•°æ®è¢«åˆ’åˆ†ä¸ºç‹¬ç«‹çš„å‹ç¼©å—,å¹¶å¯¹æ¯ä¸ªå‹ç¼©å—è¿›è¡Œç´¢å¼•,å½“æ¯ä¸ªå‹ç¼©å—æ¯”è¾ƒå°æ—¶,ä¾¿èƒ½å¤Ÿè¿›è¡Œæœ‰é™çš„éšæœºè¯»å–å‹ç¼©æ•°æ®ã€‚</li>
<li>å®Œæ•´æ€§éªŒè¯: å¯ä»¥ä½¿ç”¨ CRC32ã€CRC64ã€SHA-256 æ¥è¿›è¡Œæ•°æ®çš„å®Œæ•´æ€§éªŒè¯,ä¹Ÿå¯ä»¥å¢åŠ è‡ªå®šä¹‰éªŒè¯æ–¹æ³•ã€‚</li>
<li>å¯è¿æ¥(concatenation): ç±»ä¼¼äº .gz/.bz2 æ–‡ä»¶,å¯ä»¥æŠŠå¤šä¸ªå‹ç¼©æ•°æ®æµè¿æ¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚è§£å‹ç¼©æ—¶,å°±åƒè§£å‹ä¸€ä¸ªæ­£å¸¸å•å‹ç¼©æµæ–‡ä»¶ä¸€æ ·ã€‚</li>
<li>æ”¯æŒå¤š filter å’Œ filter é“¾: æä¾›è‡ªå®šä¹‰ filter çš„èƒ½åŠ›,ä¹Ÿèƒ½å¤Ÿå°†å¤šä¸ª filter ç»„æˆfilter é“¾,å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚è¿™ç‚¹ä¸ Unix å‘½ä»¤é—´ä½¿ç”¨çš„ç®¡é“ (pipe) ç±»ä¼¼ã€‚</li>
<li>å¯å¡«å……(padding): å¯ä»¥åœ¨ .xz æ–‡ä»¶æœ«å°¾å¡«å……äºŒè¿›åˆ¶â€™0â€™ä»¥å……æ»¡ç‰¹å®šå¤§å°çš„ç©ºé—´,æ¯”å¦‚å¤‡ä»½ç£å¸¦ä¸Šçš„ä¸€ä¸ªå— (block)ã€‚</li>
</ul>
<p>XZ Utils å…·æœ‰é«˜å‹ç¼©ç‡,è§£å‹é€Ÿåº¦å¿«çš„ç‰¹ç‚¹ã€‚èƒ½å¤Ÿç”Ÿæˆæ›´å°æ–‡ä»¶çš„åŒæ—¶,ä¹Ÿèƒ½æä¾›ç¨³å®šå¿«é€Ÿçš„è§£å‹,åœ¨å¯¹æ•°æ®å¤§å°æ¯”è¾ƒæ•æ„Ÿçš„åœºåˆ,æ¯”å¦‚è¯´å¤§æ•°æ®çš„ç½‘ç»œä¼ è¾“,æ–‡ä»¶çš„å¤‡ä»½,å¤„ç†èƒ½åŠ›æœ‰é™çš„åµŒå…¥ç³»ç»Ÿç­‰åœºåˆ,æœ‰ç€ååˆ†å¹¿æ³›çš„ç”¨é€”ã€‚</p>
<h4 id="xz-å‘½ä»¤ç”¨æ³•"><a href="#xz-å‘½ä»¤ç”¨æ³•" class="headerlink" title="xz å‘½ä»¤ç”¨æ³•"></a>xz å‘½ä»¤ç”¨æ³•</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¯­æ³• xz ( é€‰é¡¹ )( å‚æ•° )</span><br><span class="line"></span><br><span class="line">é€‰é¡¹</span><br><span class="line"></span><br><span class="line">-z, --compress</span><br><span class="line">force compression å¼ºåˆ¶å‹ç¼©</span><br><span class="line">-d, --decompress, --uncompress</span><br><span class="line">force decompression è§£å¼€å‹ç¼©æ–‡ä»¶</span><br><span class="line">-t, --test test compressed file integrity æµ‹è¯•å‹ç¼©æ–‡ä»¶æ˜¯å¦æ­£ç¡®æ— è¯¯</span><br><span class="line">-l, --list list information about .xz files åˆ—å‡ºå‹ç¼©æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯</span><br><span class="line">-k, --keep keep (don't delete) input files ä¸åˆ é™¤æºæ–‡ä»¶</span><br><span class="line">-f, --force force overwrite of output file and (de)compress links å¼ºåˆ¶å‹ç¼©,è¦†ç›–è¾“å‡ºæ–‡ä»¶åŒåçš„æ–‡ä»¶</span><br><span class="line">-c, --stdout, --to-stdout write to standard output and don't delete input files å†™å…¥æ ‡å‡†è¾“å‡º,ä¸è¦åˆ é™¤è¾“å…¥æ–‡ä»¶</span><br><span class="line">-0 ... -9 compression preset; default is 6; take compressor *and* decompressor memory usage into account before using 7-9! å‹ç¼©æ•ˆç‡æ˜¯ä¸€ä¸ªä»‹äº</span><br><span class="line">1~9 çš„æ•°å€¼,é¢„è®¾å€¼ä¸º â€œ 6â€ ,æŒ‡å®šæ„ˆå¤§çš„æ•°å€¼,å‹ç¼©æ•ˆç‡å°±ä¼šæ„ˆé«˜;è§£å‹ç”±å¿è€ƒè™‘ä½¿ç”¨ 7-9</span><br><span class="line">-e, --extreme try to improve compression ratio by using more CPU time; does not affect decompressor memory requirements é€šè¿‡ä½¿ç”¨æ›´å¤šçš„å¤„ç†å™¨æ—¶é—´</span><br><span class="line">æ¥æé«˜å‹ç¼©æ¯”;ä¸å½±å“è§£å‹æ—¶çš„å†…å­˜éœ€æ±‚</span><br><span class="line">-T, --threads=NUM use at most NUM threads; the default is 1; set to 0 to use the number of processor cores æœ€å¤šä½¿ç”¨çš„çº¿ç¨‹æ•°é‡,é»˜è®¤ä¸º 1 ,å¦‚æœè®¾ç½®ä¸º</span><br><span class="line">0 å»ä½¿ç”¨å¤„ç†å™¨å†…æ ¸çš„æ•°é‡</span><br><span class="line">-q, --quiet suppress warnings; specify twice to suppress errors too æŠ‘åˆ¶è­¦å‘Š;æŒ‡å®šä¸¤æ¬¡</span><br><span class="line">ä»¥æŠ‘åˆ¶é”™è¯¯</span><br><span class="line">-v, --verbose be verbose; specify twice for even more verbose</span><br><span class="line">-h, --help display this short help and exit</span><br><span class="line">-H, --long-help display the long help (lists also the advanced options)</span><br><span class="line">-V, --version display the version number and exit</span><br><span class="line"></span><br><span class="line">å‚æ•° æ–‡ä»¶åˆ—è¡¨:æŒ‡å®šè¦å‹ç¼©çš„æ–‡ä»¶åˆ—è¡¨ã€‚</span><br><span class="line"></span><br><span class="line">å®ä¾‹</span><br><span class="line">xz test å‹ç¼©ä¸€ä¸ªæ–‡ä»¶ test ,å‹ç¼©æˆåŠŸååˆ é™¤æºæ–‡ä»¶</span><br><span class="line">xz -d -k test.xz è§£å‹ test.xz æ–‡ä»¶, -k å‚æ•°ä¿è¯æºæ–‡ä»¶ä¸è¢«åˆ é™¤</span><br><span class="line">xz -l test.xz æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯,åŒ…æ‹¬å‹ç¼©ç‡ç­‰</span><br><span class="line">xz -k7 test ä½¿ç”¨å‚æ•° -0, -1, -2, ... -6, ... -9 æˆ–å‚æ•° --fast, --best è®¾å®šå‹ç¼©ç‡ã€‚ xz å‘½ä»¤çš„é»˜è®¤ä¸º-6 ã€‚</span><br><span class="line">å€ŸåŠ© xargs å‘½ä»¤å¹¶è¡Œå‹ç¼©å¤šæ–‡ä»¶ã€‚ä¸‹é¢çš„å‘½ä»¤è¡Œå¯ä»¥å°† /var/log ç›®å½•ä¸‹æ‰€æœ‰çš„æ‰©å±•åä¸º .log çš„æ–‡ä»¶å‹ç¼©ã€‚é€šè¿‡ xargs å‘½ä»¤åŒæ—¶è¿è¡Œå¤šä¸ª xz è¿›è¡Œå‹ç¼©ã€‚</span><br><span class="line">find /var/log -type f -iname "*.log" -print0 | xargs -P4 -n16 xz -T1</span><br><span class="line">æ³¨æ„:è¿è¡Œæ­¤å‘½ä»¤é¡»æœ‰ root æƒé™ã€‚</span><br></pre></td></tr></table></figure>


<h3 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h3><p>tar å‘½ä»¤å¯ä»¥ä¸º linux çš„æ–‡ä»¶å’Œç›®å½•åˆ›å»ºæ¡£æ¡ˆã€‚åˆ©ç”¨ tar ,å¯ä»¥ä¸ºæŸä¸€ç‰¹å®šæ–‡ä»¶åˆ›å»ºæ¡£æ¡ˆ(å¤‡ä»½æ–‡ä»¶),ä¹Ÿå¯ä»¥åœ¨æ¡£æ¡ˆä¸­æ”¹å˜æ–‡ä»¶,æˆ–è€…å‘æ¡£æ¡ˆä¸­åŠ å…¥æ–°çš„æ–‡ä»¶ã€‚ tar æœ€åˆè¢«ç”¨æ¥åœ¨ç£å¸¦ä¸Šåˆ›å»ºæ¡£æ¡ˆ,ç°åœ¨,ç”¨æˆ·å¯ä»¥åœ¨ä»»ä½•è®¾å¤‡ä¸Šåˆ›å»ºæ¡£æ¡ˆã€‚åˆ©ç”¨ tar å‘½ä»¤,å¯ä»¥æŠŠä¸€å¤§å †çš„æ–‡ä»¶å’Œç›®å½•å…¨éƒ¨æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶,è¿™å¯¹äºå¤‡ä»½æ–‡ä»¶æˆ–å°†å‡ ä¸ªæ–‡ä»¶ç»„åˆæˆä¸ºä¸€ä¸ªæ–‡ä»¶ä»¥ä¾¿äºç½‘ç»œä¼ è¾“æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p>
<p>é¦–å…ˆè¦å¼„æ¸…ä¸¤ä¸ªæ¦‚å¿µ:æ‰“åŒ…å’Œå‹ç¼©ã€‚</p>
<ul>
<li>æ‰“åŒ…æ˜¯æŒ‡å°†ä¸€å¤§å †æ–‡ä»¶æˆ–ç›®å½•å˜æˆä¸€ä¸ªæ€»çš„æ–‡ä»¶;</li>
<li>å‹ç¼©åˆ™æ˜¯å°†ä¸€ä¸ªå¤§çš„æ–‡ä»¶é€šè¿‡ä¸€äº›å‹ç¼©ç®—æ³•å˜æˆä¸€ä¸ªå°æ–‡ä»¶ã€‚</li>
</ul>
<p>ä¸ºä»€ä¹ˆè¦åŒºåˆ†è¿™ä¸¤ä¸ªæ¦‚å¿µå‘¢?</p>
<p>è¿™æºäº Linux ä¸­å¾ˆå¤šå‹ç¼©ç¨‹åºåªèƒ½é’ˆå¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå‹ç¼©,è¿™æ ·å½“ä½ æƒ³è¦å‹ç¼©ä¸€å¤§å †æ–‡ä»¶æ—¶,ä½ å¾—å…ˆå°†è¿™ä¸€å¤§å †æ–‡ä»¶å…ˆæ‰“æˆä¸€ä¸ªåŒ…( tar å‘½ä»¤),ç„¶åå†ç”¨å‹ç¼©ç¨‹åºè¿›è¡Œå‹ç¼©( gzip bzip2 å‘½ä»¤)ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¯­æ³• tar ( é€‰é¡¹ )( å‚æ•° )</span><br><span class="line"></span><br><span class="line">é€‰é¡¹</span><br><span class="line">-A æˆ– --catenate :æ–°å¢æ–‡ä»¶åˆ°ä»¥å­˜åœ¨çš„å¤‡ä»½æ–‡ä»¶;</span><br><span class="line">-B :è®¾ç½®åŒºå—å¤§å°;</span><br><span class="line">-c æˆ– --create :å»ºç«‹æ–°çš„å¤‡ä»½æ–‡ä»¶;</span><br><span class="line">-C &lt; ç›®å½• &gt; :è¿™ä¸ªé€‰é¡¹ç”¨åœ¨è§£å‹ç¼©,è‹¥è¦åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©,å¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚</span><br><span class="line">-d :è®°å½•æ–‡ä»¶çš„å·®åˆ«;</span><br><span class="line">-x æˆ– --extract æˆ– --get :ä»å¤‡ä»½æ–‡ä»¶ä¸­è¿˜åŸæ–‡ä»¶;</span><br><span class="line">-t æˆ– --list :åˆ—å‡ºå¤‡ä»½æ–‡ä»¶çš„å†…å®¹;</span><br><span class="line">-z æˆ– --gzip æˆ– --ungzip :é€šè¿‡ gzip æŒ‡ä»¤å¤„ç†å¤‡ä»½æ–‡ä»¶;</span><br><span class="line">-Z æˆ– --compress æˆ– --uncompress :é€šè¿‡ compress æŒ‡ä»¤å¤„ç†å¤‡ä»½æ–‡ä»¶;</span><br><span class="line">-f&lt; å¤‡ä»½æ–‡ä»¶ &gt; æˆ– --file=&lt; å¤‡ä»½æ–‡ä»¶ &gt; :æŒ‡å®šå¤‡ä»½æ–‡ä»¶;</span><br><span class="line">-v æˆ– --verbose :æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹;</span><br><span class="line">-r :æ·»åŠ æ–‡ä»¶åˆ°å·²ç»å‹ç¼©çš„æ–‡ä»¶;</span><br><span class="line">-u :æ·»åŠ æ”¹å˜äº†å’Œç°æœ‰çš„æ–‡ä»¶åˆ°å·²ç»å­˜åœ¨çš„å‹ç¼©æ–‡ä»¶;</span><br><span class="line">-j :æ”¯æŒ bzip2 è§£å‹æ–‡ä»¶;</span><br><span class="line">-J :æ”¯æŒ xz è§£å‹æ–‡ä»¶;</span><br><span class="line">-v :æ˜¾ç¤ºæ“ä½œè¿‡ç¨‹;</span><br><span class="line">-l :æ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œè®¾ç½®;</span><br><span class="line">-k :ä¿ç•™åŸæœ‰æ–‡ä»¶ä¸è¦†ç›–;</span><br><span class="line">-m :ä¿ç•™æ–‡ä»¶ä¸è¢«è¦†ç›–;</span><br><span class="line">-w :ç¡®è®¤å‹ç¼©æ–‡ä»¶çš„æ­£ç¡®æ€§;</span><br><span class="line">-p æˆ– --same-permissions :ç”¨åŸæ¥çš„æ–‡ä»¶æƒé™è¿˜åŸæ–‡ä»¶;</span><br><span class="line">-P æˆ– --absolute-names :æ–‡ä»¶åä½¿ç”¨ç»å¯¹åç§°,ä¸ç§»é™¤æ–‡ä»¶åç§°å‰çš„ â€œ /â€ å·;</span><br><span class="line">-N &lt; æ—¥æœŸæ ¼å¼ &gt; æˆ– --newer=&lt; æ—¥æœŸæ—¶é—´ &gt; :åªå°†è¾ƒæŒ‡å®šæ—¥æœŸæ›´æ–°çš„æ–‡ä»¶ä¿å­˜åˆ°å¤‡ä»½æ–‡ä»¶é‡Œ;</span><br><span class="line">--exclude=&lt; èŒƒæœ¬æ ·å¼ &gt; :æ’é™¤ç¬¦åˆèŒƒæœ¬æ ·å¼çš„æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">å‚æ•° æ–‡ä»¶åˆ—è¡¨:æŒ‡å®šè¦æ‰“åŒ…çš„æ–‡ä»¶æˆ–ç›®å½•åˆ—è¡¨ã€‚</span><br><span class="line"></span><br><span class="line">å®ä¾‹</span><br><span class="line">tar -cvf log.tar log2012.log ä»…æ‰“åŒ…,ä¸å‹ç¼©! tar -xf è§£å‹</span><br><span class="line">tar -zcvf log.tar.gz log2012.log æ‰“åŒ…å,ä»¥ gzip å‹ç¼© tar -zxf è§£å‹</span><br><span class="line">tar -jcvf log.tar.bz2 log2012.log æ‰“åŒ…å,ä»¥ bzip2 å‹ç¼© tar -jxf è§£å‹</span><br><span class="line">tar -Jcvf log.tar.xz log2012.log æ‰“åŒ…å,ä»¥ xz å‹ç¼© tar -Jxf è§£å‹</span><br><span class="line">tar -tf log.tar æŸ¥çœ‹æ‰“åŒ…æ–‡ä»¶</span><br><span class="line">æ³¨æ„ -f å‚æ•°åé¢å¿…é¡»æ¥æ–‡ä»¶å</span><br></pre></td></tr></table></figure>

<h2 id="04-Linuxå‹ç¼©æ‰“åŒ…è¯¾åä¹ é¢˜"><a href="#04-Linuxå‹ç¼©æ‰“åŒ…è¯¾åä¹ é¢˜" class="headerlink" title="04-Linuxå‹ç¼©æ‰“åŒ…è¯¾åä¹ é¢˜"></a>04-Linuxå‹ç¼©æ‰“åŒ…è¯¾åä¹ é¢˜</h2><ol>
<li>é€šè¿‡ddåˆ›å»º4ä¸ª5Mçš„æ–‡ä»¶,åˆ†åˆ«ä¸ºafile;bfile;cfile;dfile,å¹¶å°†è¿™4ä¸ªæ–‡ä»¶æ”¾åœ¨/tmp/testç›®å½•ä¸­ä¿å­˜</li>
<li>å¯¹è¿™4ä¸ªç›¸åŒå¤§å°çš„æ–‡ä»¶è¿›è¡Œå‹ç¼©,åˆ†åˆ«ä½¿ç”¨zip;bzip2;gzip;xz,å¹¶è§‚å¯Ÿ</li>
<li>åœ¨å°†å‹ç¼©æ–‡ä»¶è¿›è¡Œè§£å‹,å¹¶è§‚å¯Ÿ</li>
<li>å°†/tmp/testç›®å½•è¿›è¡Œæ‰“åŒ…,åˆ†åˆ«ä½¿ç”¨gzipå’Œbzip2å‹ç¼©</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç³»ç»ŸåŸºç¡€åŸ¹è®­</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux Bashç®€ä»‹</title>
    <url>/2016/12/22/booboo_linux_base/07-Bash%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<h2 id="SHELL"><a href="#SHELL" class="headerlink" title="SHELL"></a>SHELL</h2><h3 id="shell-ç®€ä»‹"><a href="#shell-ç®€ä»‹" class="headerlink" title="shell ç®€ä»‹"></a>shell ç®€ä»‹</h3><p>Shell æ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨, æ˜¯äººä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„æ¡¥æ¢ã€‚ æˆ‘ä»¬å¹³æ—¶æ— è®ºä»»ä½•æ“ä½œ,æœ€ç»ˆéƒ½è¦æ“ä½œç¡¬ä»¶,æ¯”å¦‚è¾“å…¥ä¸€ä¸ªå­—ç¬¦ â€œ a â€, é‚£ä¹ˆä¿¡å· é¦–å…ˆä¼šä»é”®ç›˜ä¼ é€’åˆ°ä¸»æ¿,é€šè¿‡ä¸»æ¿æ€»çº¿ä¼ é€’åˆ°å†…å­˜,CPU,æ˜¾å¡ç­‰,æœ€ç»ˆç»è¿‡æ˜¾å¡çš„è¿ ç®—å®Œæˆååœ¨å±å¹•çš„æŸä¸ªä½ç½®, æ˜¾ç¤ºä¸€ä¸ªç‰¹å®šå­—ä½“çš„å­—ç¬¦ â€œ a â€, è¿™ä¸€æ•´ä¸ªè¿‡ç¨‹å¯ä»¥è¯´æ˜¯ ä¸æ–­çš„å’Œç¡¬ä»¶æ‰“äº¤é“äº†,ä½†æ˜¯å¦‚æœè®©äººå»å‘é€è¿™äº›ç¡¬ä»¶æ“ä½œç æ˜¾ç„¶ä¸é€‚åˆ, å› ä¸ºè¿™ä¸æ˜¯äººå¹² çš„äº‹,æ‰€ä»¥æˆ‘ä»¬æœ‰äº†æ“ä½œç³»ç»Ÿ,æ“ä½œç³»ç»Ÿé€šè¿‡åŠ è½½ä¸€å®šçš„ç¡¬ä»¶é©±åŠ¨,ä»è€Œæ§åˆ¶ç¡¬ä»¶,æ“ä½œç¡¬ä»¶,é‚£å‰©ä¸‹çš„äº‹å°±æ˜¯å¦‚ä½•å’Œæ“ä½œç³»ç»Ÿé€šä¿¡äº†,å¯¹äºæ™®é€šçš„ç³»ç»Ÿç®¡ç†å‘˜æ¥è¯´,è¿™ä¹Ÿæ˜¯ä¸€ä»¶éå¸¸å›°éš¾çš„äº‹,ä¸ºäº†æ–¹ä¾¿äººå’Œæ“ä½œç³»ç»Ÿæ²Ÿé€š, æˆ‘ä»¬å¼€å‘äº† shell ã€‚</p>
<p>Shell å¯ä»¥å°†æˆ‘ä»¬å¹³æ—¶è¿è¡Œçš„ä¸€äº›æŒ‡ä»¤è§£é‡Šç»™æ“ä½œç³»ç»Ÿæ‰§è¡Œ, æ–¹ä¾¿ç®¡ç†å‘˜æ“ä½œç³»ç»Ÿã€‚è€Œ Shell çš„è„šæœ¬å…¶å®æ˜¯ä¸€ç§å‘½ä»¤çš„å †ç§¯,æˆ‘ä»¬å°†æ‰€æœ‰éœ€è¦æ‰§è¡Œçš„å‘½ä»¤, ä»¥ä»ä¸Šè‡³ä¸‹çš„æ–¹ å¼å†™åœ¨ä¸€ä¸ªæ–‡ä»¶å½“ä¸­, äº¤ç»™ shell å»è‡ªåŠ¨è§£é‡Šæ‰§è¡Œã€‚</p>
<h3 id="shell-å†å²"><a href="#shell-å†å²" class="headerlink" title="shell å†å²"></a>shell å†å²</h3><p>åœ¨ AT&amp;T çš„ Dennis Ritchie å’Œ Ken Thompson è®¾è®¡ UNIXTM çš„æ—¶å€™, ä»–ä»¬æƒ³è¦ä¸º ç”¨æˆ·åˆ›å»ºä¸€ç§ä¸ä»–ä»¬çš„æ–°ç³»ç»Ÿäº¤æµçš„æ–¹æ³•ã€‚é‚£æ—¶çš„æ“ä½œç³»ç»Ÿå¸¦æœ‰å‘½ä»¤è§£é‡Šå™¨ã€‚å‘½ä»¤è§£é‡Šå™¨æ¥å—ç”¨æˆ·çš„å‘½ä»¤,ç„¶åè§£é‡Šå®ƒä»¬,å› è€Œè®¡ç®—æœºå¯ä»¥ä½¿ç”¨è¿™äº›å‘½ä»¤ã€‚ ä½†æ˜¯ Ritchie å’Œ Thompson æƒ³è¦çš„ä¸åªæ˜¯è¿™äº›åŠŸèƒ½,ä»–ä»¬æƒ³æä¾›æ¯”å½“æ—¶çš„å‘½ä»¤è§£é‡Šå™¨ å…·å¤‡æ›´ä¼˜å¼‚åŠŸèƒ½çš„å·¥å…·ã€‚è¿™å¯¼è‡´äº† Bourne shell ( é€šç§°ä¸º sh )çš„å¼€å‘, ç”± S.R. Bourne åˆ›å»ºã€‚è‡ªä» Bourne shell çš„åˆ›å»º, å…¶å®ƒ shell ä¹Ÿè¢«ä¸€ä¸€å¼€å‘, å¦‚ C shell ( csh ) å’Œ Korn shell (ksh ) ã€‚</p>
<p>å½“è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šæƒ³å¯»æ±‚ä¸€ç§å…è´¹çš„ shell , å¼€å‘è€…ä»¬å¼€å§‹è‡´åŠ›äº Bourne shell ä»¥åŠå½“ æ—¶å…¶å®ƒ shellä¸­æŸäº›å¾ˆå—æ¬¢è¿çš„åŠŸèƒ½èƒŒåçš„è¯­è¨€ã€‚ è¿™ä¸ªå¼€å‘ç»“æœæ˜¯ Bourne Again Shell , æˆ–ç§° bash ã€‚è™½ç„¶ä½ çš„Red Hat Linux åŒ…æ‹¬å‡  ç§ä¸åŒçš„ shell , bash æ˜¯ä¸ºäº’åŠ¨ç”¨æˆ·æä¾›çš„é»˜è®¤ shell ã€‚</p>
<h3 id="å¸¸è§çš„-shell"><a href="#å¸¸è§çš„-shell" class="headerlink" title="å¸¸è§çš„ shell"></a>å¸¸è§çš„ shell</h3><ul>
<li>Bourne shell å³ sh : AT&amp;T è´å°”å®éªŒå®¤ç¼–å†™çš„ä¸€ä¸ªäº¤æ¢å¼çš„å‘½ä»¤è§£é‡Šå™¨ã€‚</li>
<li>C Shell : Bill Joy äº 20 ä¸–çºª 80 å¹´ä»£æ—©æœŸå¼€å‘ã€‚ä¸ºäº†è®©ç”¨æˆ·æ›´å®¹æ˜“çš„ä½¿ç”¨, ä»–æŠŠè¯­æ³•ç»“æ„å˜æˆäº† Cè¯­è¨€é£æ ¼ã€‚å®ƒæ–°å¢äº†å‘½ä»¤å†å²ã€åˆ«åã€æ–‡ä»¶åæ›¿æ¢ã€ä½œä¸šæ§åˆ¶ç­‰åŠŸèƒ½ã€‚</li>
<li>korn shell (ksh) æ˜¯ä¸€ä¸ª Unix shell ã€‚å®ƒç”±è´å°”å®éªŒå®¤çš„ David Korn åœ¨äºŒåä¸–çºªå…«å å¹´ä»£æ—©æœŸç¼–å†™ã€‚å®ƒå®Œå…¨å‘ä¸Šå…¼å®¹ Bourne shell å¹¶åŒ…å«äº† C shell çš„å¾ˆå¤šç‰¹æ€§ã€‚</li>
<li>Bourne-Again SHell : bash æ˜¯ä¸€ä¸ªä¸º GNU é¡¹ç›®ç¼–å†™çš„ Unix shell ã€‚å®ƒçš„åå­—æ˜¯ä¸€ ç³»åˆ—ç¼©å†™:Bourne-Again SHell â€” è¿™æ˜¯å…³äº Bourne shell ( sh )çš„ä¸€ä¸ªåŒå…³è¯­( Bourne again / bornagain ) ã€‚ Bourne shell æ˜¯ä¸€ä¸ªæ—©æœŸçš„é‡è¦ shell , ç”± Stephen Bourne åœ¨ 1978 å¹´å‰åç¼–å†™,å¹¶åŒ Version 7 Unix ä¸€èµ·å‘å¸ƒã€‚ bash åˆ™åœ¨ 1987 å¹´ç”± Brian Fox åˆ›é€ ã€‚ åœ¨ 1990 å¹´, ChetRamey æˆä¸ºäº†ä¸»è¦çš„ç»´æŠ¤è€…ã€‚ bash æ˜¯å¤§å¤šæ•° Linux ç³»ç»Ÿä»¥åŠ Mac OS X v10.4 é»˜è®¤çš„ shell ,å®ƒèƒ½è¿è¡Œäºå¤§å¤šæ•° Unix é£æ ¼çš„æ“ä½œç³»ç»Ÿä¹‹ä¸Š, ç”šè‡³è¢«ç§»æ¤åˆ°äº† Microsoft Windows ä¸Šçš„ Cygwin å’ŒMSYS ç³»ç»Ÿä¸­, ä»¥å®ç° windows çš„ POSIX è™šæ‹Ÿæ¥å£ã€‚æ­¤å¤–, å®ƒä¹Ÿè¢« DJGPP é¡¹ç›®ç§»æ¤åˆ°äº† MS- DOS ä¸Šã€‚</li>
<li>POSIX shell : POSIX shell ä¸ Korn shell éå¸¸çš„ç›¸ä¼¼, å½“å‰æä¾› POSIX shell çš„æœ€å¤§å–ä¸»æ˜¯Hewlett-Packard ã€‚</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆ-Shell"><a href="#ä¸ºä»€ä¹ˆ-Shell" class="headerlink" title="ä¸ºä»€ä¹ˆ Shell"></a>ä¸ºä»€ä¹ˆ Shell</h3><ul>
<li>è§£å†³é‡å¤æ“ä½œçš„ä½œä¸šã€‚</li>
<li>èŠ‚çº¦æ—¶é—´ , æé«˜å·¥ä½œæ•ˆç‡ã€‚</li>
<li>åŠŸèƒ½å¼ºå¤§,ä½¿ç”¨ç®€å•</li>
</ul>
<h3 id="etc-shells"><a href="#etc-shells" class="headerlink" title="/etc/shells"></a>/etc/shells</h3><p><code>/etc/shells</code> æ–‡ä»¶è®°å½•äº†ç›®å‰ç³»ç»Ÿä¸­æ³¨å†Œè¿‡çš„ shell,æ¯ä¸€ä¸ªç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¸€ç§ shell,å¯ä»¥é€šè¿‡<code>usermod -s</code> æ¥ä¿®æ”¹ç”¨æˆ· shell,ä¹Ÿå¯ä»¥é€šè¿‡<code>chsh</code> æ¥æ›´æ”¹ shell</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@redhat6 tmp]# chsh carol</span><br><span class="line">Changing shell for carol.</span><br><span class="line">New shell [/bin/csh]: /bin/sh</span><br><span class="line">Shell changed.</span><br><span class="line">[root@redhat6 tmp]# su - carol</span><br><span class="line">-sh-4.1$ tail /etc/passwd -n1</span><br><span class="line">carol:x:60000:60000:carol:/home/carol:/bin/sh</span><br><span class="line">-sh-4.1$</span><br></pre></td></tr></table></figure>

<h2 id="bash-åŠŸèƒ½"><a href="#bash-åŠŸèƒ½" class="headerlink" title="bash åŠŸèƒ½"></a>bash åŠŸèƒ½</h2><h3 id="history-åŠŸèƒ½"><a href="#history-åŠŸèƒ½" class="headerlink" title="history åŠŸèƒ½"></a>history åŠŸèƒ½</h3><p>history å‘½ä»¤ç”¨äºæ˜¾ç¤ºæŒ‡å®šæ•°ç›®çš„æŒ‡ä»¤å‘½ä»¤,è¯»å–å†å²å‘½ä»¤æ–‡ä»¶ä¸­çš„ç›®å½•åˆ°å†å²å‘½ä»¤ç¼“å†²åŒºå’Œå°†å†å²å‘½ä»¤ç¼“å†²åŒºä¸­çš„ç›®å½•å†™å…¥å‘½ä»¤æ–‡ä»¶ã€‚ è¯¥å‘½ä»¤å•ç‹¬ä½¿ç”¨æ—¶,ä»…æ˜¾ç¤ºå†å²å‘½ä»¤,åœ¨å‘½ä»¤è¡Œä¸­,å¯ä»¥ä½¿ç”¨ç¬¦å·!æ‰§è¡ŒæŒ‡å®šåºå·çš„å†å²å‘½ä»¤ã€‚</p>
<p>ä¾‹å¦‚,è¦æ‰§è¡Œç¬¬ 2 ä¸ªå†å²å‘½ä»¤,åˆ™è¾“å…¥<code>!2</code>ã€‚</p>
<p>å†å²å‘½ä»¤æ˜¯è¢«ä¿å­˜åœ¨å†…å­˜ä¸­çš„,å½“é€€å‡ºæˆ–è€…ç™»å½• shell æ—¶,ä¼šè‡ªåŠ¨ä¿å­˜æˆ–è¯»å–ã€‚åœ¨å†…å­˜ä¸­,å†å²å‘½ä»¤ä»…èƒ½å¤Ÿå­˜å‚¨ 1000 æ¡å†å²å‘½ä»¤,è¯¥æ•°é‡æ˜¯ç”±ç¯å¢ƒå˜é‡ <code>HISTSIZE</code> è¿›è¡Œæ§åˆ¶ã€‚</p>
<p>HISTSIZE å˜é‡ â€“å˜é‡:åå¤è°ƒç”¨çš„å€¼,ä»¥$ç¬¦å·å¼•ç”¨</p>
<p>å®šä¹‰æ–¹å¼:histsize æ•°å­— ä¸´æ—¶ç”Ÿæ•ˆ</p>
<p>/etc/profile é‡Œæ°¸ä¹…å®šä¹‰</p>
<p>ä¿å­˜ä½ç½®:~/.bash_history</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¯­æ³• history(é€‰é¡¹)(å‚æ•°)</span><br><span class="line"></span><br><span class="line">é€‰é¡¹ -c :æ¸…ç©ºå½“å‰å†å²å‘½ä»¤;</span><br><span class="line">-a :å°†å†å²å‘½ä»¤ç¼“å†²åŒºä¸­å‘½ä»¤å†™å…¥å†å²å‘½ä»¤æ–‡ä»¶ä¸­;</span><br><span class="line">-r :å°†å†å²å‘½ä»¤æ–‡ä»¶ä¸­çš„å‘½ä»¤è¯»å…¥å½“å‰å†å²å‘½ä»¤ç¼“å†²åŒº;</span><br><span class="line">-w:å°†å½“å‰å†å²å‘½ä»¤ç¼“å†²åŒºå‘½ä»¤å†™å…¥å†å²å‘½ä»¤æ–‡ä»¶ä¸­ã€‚</span><br><span class="line"></span><br><span class="line">å‚æ•° æ‰“å°æœ€è¿‘çš„ n æ¡å†å²å‘½ä»¤</span><br><span class="line"></span><br><span class="line">å®ä¾‹</span><br><span class="line"></span><br><span class="line">!8 ä½¿ç”¨ç¬¬å…«ä¸ªå‘½ä»¤</span><br><span class="line">!Ser ä½¿ç”¨è¯¥å­—ç¬¦ä¸²å¼€å¤´çš„æœ€è¿‘çš„å‘½ä»¤</span><br><span class="line">!!è°ƒç”¨ä¸Šä¸€æ¡å‘½ä»¤</span><br><span class="line">!$ è°ƒç”¨ä¸Šä¸€ä¸ªå‘½ä»¤çš„å‚æ•° = alt+.</span><br><span class="line">Ctrl+R æœç´¢æœ€è¿‘åŒ…å«å­—ç¬¦ä¸²çš„å‘½ä»¤</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">history</span><br><span class="line">	å‘½ä»¤ç”¨æ³•</span><br><span class="line">	history</span><br><span class="line">		-c	æ¸…ç©ºç¼“å­˜</span><br><span class="line">		-r  	å°†~/.bash_historyå†å²å‘½ä»¤è¯»å…¥ç¼“å­˜</span><br><span class="line"></span><br><span class="line">		æ–¹ä¾¿çš„è°ƒç”¨	ï¼num</span><br><span class="line">				!! è°ƒç”¨æœ€è¿‘ä¸€æ¬¡çš„å‘½ä»¤</span><br><span class="line">				!å…³é”®å­— 		</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	å®æˆ˜	1.ä½ æ˜¯é»‘å®¢ï¼Œçªƒå–åˆ«äººçš„å†å²å‘½ä»¤</span><br><span class="line">		~/.bash_history</span><br><span class="line">		2.ä¸ºäº†é˜²æ­¢é»‘å®¢ï¼Œä½ æ€ä¹ˆé˜²æ­¢ä¸€äº›å…³é”®å‘½ä»¤è¢«çªƒå–ï¼Œæ¯”å¦‚é…ç½®ç”¨æˆ·å¯†ç ï¼Œæˆ–è€…æ•°æ®åº“å¯†ç ç­‰</span><br><span class="line">	[root@rhel7 ~]# echo "uplooking123"|passwd --stdin superman</span><br><span class="line">	Changing password for user superman.</span><br><span class="line">	passwd: all authentication tokens updated successfully.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		1ï¼‰æ¸…ç¼“å†²</span><br><span class="line">		2ï¼‰åˆ é™¤æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">		[root@rhel7 ~]# export HISTCONTROL=ignorespace</span><br><span class="line">		[root@rhel7 ~]# echo 1</span><br><span class="line">		1</span><br><span class="line">		[root@rhel7 ~]# echo 2</span><br><span class="line">		2</span><br><span class="line">		[root@rhel7 ~]#  echo 3</span><br><span class="line">		3</span><br><span class="line">		[root@rhel7 ~]# history</span><br><span class="line">		1  HISTCONTROL=ignorespace</span><br><span class="line">		2  exprot HISTCONTROL=ignorespace</span><br><span class="line">		3  export HISTCONTROL=ignorespace</span><br><span class="line">		4  echo 1</span><br><span class="line">		5  echo 2</span><br><span class="line">		6  history</span><br></pre></td></tr></table></figure>

<h3 id="åˆ«å-alias"><a href="#åˆ«å-alias" class="headerlink" title="åˆ«å alias"></a>åˆ«å alias</h3><p>alias å‘½ä»¤ç”¨æ¥è®¾ç½®æŒ‡ä»¤çš„åˆ«åã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥å°†ä¸€äº›è¾ƒé•¿çš„å‘½ä»¤è¿›è¡Œç®€åŒ–ã€‚ä½¿ç”¨ alias æ—¶,ç”¨æˆ·å¿…é¡»ä½¿ç”¨å•å¼•å·â€™â€™ å°†åŸæ¥çš„å‘½ä»¤å¼•èµ·æ¥,é˜²æ­¢ç‰¹æ®Šå­—ç¬¦å¯¼è‡´é”™è¯¯ã€‚ alias å‘½ä»¤çš„ä½œç”¨åªå±€é™äºè¯¥æ¬¡ç™»å…¥çš„æ“ä½œã€‚è‹¥è¦æ¯æ¬¡ç™»å…¥éƒ½èƒ½å¤Ÿä½¿ç”¨è¿™äº›å‘½ä»¤åˆ«å,åˆ™å¯å°†ç›¸åº”çš„ alias å‘½ä»¤å­˜æ”¾åˆ° bash çš„åˆå§‹åŒ–æ–‡ä»¶/etc/bashrc ä¸­ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¯­æ³• alias(é€‰é¡¹)(å‚æ•°)</span><br><span class="line"></span><br><span class="line">é€‰é¡¹</span><br><span class="line">-p :æ‰“å°å·²ç»è®¾ç½®çš„å‘½ä»¤åˆ«åã€‚</span><br><span class="line"></span><br><span class="line">å‚æ•° å‘½ä»¤åˆ«åè®¾ç½®:å®šä¹‰å‘½ä»¤åˆ«å,æ ¼å¼ä¸º â€œ å‘½ä»¤åˆ«å=â€˜ å®é™…å‘½ä»¤ â€™â€ ã€‚</span><br><span class="line"></span><br><span class="line">å®ä¾‹ alias æ–°çš„å‘½ä»¤=' åŸå‘½ä»¤ -é€‰é¡¹/å‚æ•°'</span><br><span class="line">alias grep=â€™grep --color=autoâ€™</span><br></pre></td></tr></table></figure>

<ul>
<li>~/.bashrc é’ˆå¯¹å•ä¸ªç”¨æˆ·ç”Ÿæ•ˆ</li>
<li>/etc/bashrc é’ˆå¯¹å…¨å±€ç”Ÿæ•ˆ</li>
</ul>
<p>å®æˆ˜</p>
<ol>
<li>æˆ‘çš„å·¥ä½œè·¯å¾„åœ¨/tmp/justice/superman/dir1/ï¼Œæ¯å¤©ç™»é™†çš„æœåŠ¡å™¨éƒ½å¾ˆç´¯ï¼Œå› ä¸ºè¦å¤©å¤©è¾“å…¥cd /tmp/justice/superman/dir1/,æœ‰ä»€ä¹ˆåŠæ³•èƒ½å¤Ÿè½»æ¾ä¸€ç‚¹å‘¢ï¼Ÿè®©æˆ‘å°‘è¾“å…¥ä¸€ç‚¹å‘½ä»¤å‘¢ï¼Ÿ</li>
<li>å–æ¶ˆæˆ‘åˆšåˆšè®¾ç½®çš„åˆ«åunalias</li>
</ol>
<h3 id="tab-é”®è¡¥å…¨åŠŸèƒ½"><a href="#tab-é”®è¡¥å…¨åŠŸèƒ½" class="headerlink" title="tab é”®è¡¥å…¨åŠŸèƒ½"></a>tab é”®è¡¥å…¨åŠŸèƒ½</h3><p>å•å‡»è¡¥å…¨å‘½ä»¤,å¦‚æœæ²¡åŠæ³•è¡¥å…¨,åŒå‡»å¯ä»¥æ˜¾ç¤ºä»¥è¯¥å­—ç¬¦ä¸²å¼€å§‹çš„æ–‡ä»¶åéƒ½æœ‰å“ªäº›ã€‚(æˆ–è€…å‘½ä»¤éƒ½æœ‰å“ªäº›)</p>
<h3 id="å¿«æ·é”®"><a href="#å¿«æ·é”®" class="headerlink" title="å¿«æ·é”®"></a>å¿«æ·é”®</h3><ul>
<li>Ctrl +A è·³è¡Œé¦–</li>
<li>Ctrl +L æ¸…å±</li>
<li>Ctrl +e è·³è¡Œå°¾</li>
<li>Ctrl +c ä¸­æ–­</li>
<li>Ctrl +R æœç´¢</li>
<li>ctrl +d logout</li>
</ul>
<h2 id="ç”¨æˆ·ç™»å½•æµç¨‹"><a href="#ç”¨æˆ·ç™»å½•æµç¨‹" class="headerlink" title="ç”¨æˆ·ç™»å½•æµç¨‹"></a>ç”¨æˆ·ç™»å½•æµç¨‹</h2><p>å­¦ä¹ ç”¨æˆ·ç™»å½•æµç¨‹çš„æ„ä¹‰:</p>
<p>æˆ‘ä»¬ä¹‹å‰æœ‰æåˆ°è¿‡å‡ ä¸ªå˜é‡,æ¯”å¦‚ histsizeã€æ¯”å¦‚ umask ç­‰ã€‚è¿™äº›åŠŸèƒ½éƒ½å¯ä»¥æ˜¯é’ˆå¯¹äºæŸä¸€ä¸ªç”¨æˆ·å»è®¾ç½®çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬æ˜¯æ€ä¹ˆçŸ¥é“å…·ä½“è¦æŠŠè¿™äº›ç›¸å…³é…ç½®ä¿¡æ¯å†™å…¥å“ªä¸€ä¸ªæ–‡ä»¶å‘¢?å“ªä¸€ä¸ªæ–‡ä»¶æ˜¯ç”¨äºå…¨å±€çš„å˜é‡çš„è®¾ç½®çš„,å“ªä¸€ä¸ªæ–‡ä»¶é’ˆå¯¹å•ä¸ªç”¨æˆ·ç”Ÿæ•ˆ,å“ªä¸€ä¸ªæ–‡ä»¶é‡Œé¢çš„é…ç½®å­—æ®µä¼šè¦†ç›–ä¹‹å‰çš„é…ç½®å­—æ®µå‘¢?è¿™å°±è¦ç”¨åˆ°æˆ‘ä»¬çš„ç”¨æˆ·ç™»å½•æµç¨‹äº†ã€‚</p>
<p>äº”ä¸ªé…ç½®æ–‡ä»¶çš„é¡ºåº:</p>
<p>æˆ‘ä»¬ç”¨æˆ·åœ¨ç™»å½•çš„æ—¶å€™,ä¼šè°ƒç”¨ä¸€ç³»åˆ—çš„æ–‡ä»¶,è¿™äº›æ–‡ä»¶åŒ…æ‹¬</p>
<ul>
<li>/etc/profile</li>
<li>/etc/profile.d ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</li>
<li>/.bash_profile</li>
<li>~/.bashrc</li>
<li>/etc/bashrc</li>
</ul>
<p>è¿™æ˜¯æˆ‘ä»¬ç³»ç»Ÿç™»å½•è¿‡ç¨‹ä¸­ç”¨åˆ°çš„äº”ä¸ªæ–‡ä»¶,æˆ‘ä»¬ä¸€ä¸€æ¥æŸ¥çœ‹ã€‚</p>
<p>/etc/profile</p>
<p>/etc/profile é‡Œé¢åŒ…å«äº†é…ç½®å­—æ®µ include /etc/profile.d ã€‚è¿™ä¸ª include ä»£è¡¨æ‰©å±•é…ç½®æ–‡ä»¶,å½“è¯»å–è¯¥æ–‡ä»¶çš„æ—¶å€™,ä¼šè¯»å–ç›¸åº”çš„ä¸€äº›æ‰©å±•é…ç½®æ–‡ä»¶ã€‚</p>
<p>æˆ‘ä»¬é€šå¸¸ä¸ä¼šæŠŠæ‰€æœ‰çš„ä¸œè¥¿éƒ½å¾€ä¸€ä¸ªæ–‡ä»¶é‡Œé¢å»å†™,ä¸€æ–¹é¢æ˜¯ç”±äºå…¨å¾€ä¸€ä¸ªæ–‡ä»¶é‡Œé¢å»å†™ä¼šå¯¼è‡´æ–‡ä»¶ç‰¹åˆ«å¤§,å¦ä¸€æ–¹é¢,ä¸æ–¹ä¾¿æˆ‘ä»¬çš„ä¿®æ”¹æ–‡ä»¶çš„çµæ´»åº¦ã€‚æˆ‘ä»¬è¦ä»ä¸€ä¸ªå¤§ç¯‡å¹…çš„é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°æŸä¸€è¡Œ,éå¸¸çš„ç´¯,é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†é…ç½®æ–‡ä»¶ä¹Ÿåˆ†é—¨åˆ«ç±»çš„å»å†™ã€‚æ¯”å¦‚è¯´æˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç¨‹åº,è¿™ä¸ªç¨‹åºéœ€è¦ä¸€äº›å˜é‡çš„è®¾ç½®,æˆ‘å°±å¯ä»¥å°†è¿™äº›å˜é‡å†™æˆä¸€ä¸ªæ–°çš„æ–‡ä»¶,æ”¾åœ¨/etc/profile.d ç›®å½•ä¸‹,é‚£ä¹ˆå½“æˆ‘è¯»å– profile çš„æ—¶å€™ä¸€æ ·èƒ½å¤Ÿè¯»åˆ°è¯¥æ–‡ä»¶,å½“æˆ‘ä¸éœ€è¦é‚£ä¸ªç¨‹åºäº†,æˆ‘ä¹Ÿä¸ç”¨å»æ‰¾è¿™ä¸ªé…ç½®å­—æ®µäº†,ç›´æ¥æŠŠå¯¹åº”çš„é…ç½®æ–‡ä»¶åˆ é™¤å°±å¯ä»¥äº†å§ã€‚</p>
<p>~/.bash_profile</p>
<p>æ¥ä¸‹æ¥å›å»è¯»<del>/.bash_profile æ–‡ä»¶,ç”±äºæ˜¯å®¶ç›®å½•ä¸‹çš„,è¿™æ˜¯å±äºç”¨æˆ·ä¸ªäººæœ¬èº«çš„é…ç½®æ–‡ä»¶,ä¹Ÿå°±æ˜¯è¯´,å†™åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶å½“ä¸­çš„å˜é‡,åªé’ˆå¯¹å¯¹åº”çš„ç”¨æˆ·ç”Ÿæ•ˆã€‚è¯¥æ–‡ä»¶é‡Œå†™çš„å†…å®¹ä¸€éƒ¨åˆ†æ˜¯å»è¯»å–</del>/.bashrc æ–‡ä»¶,ä¸€éƒ¨åˆ†å†™äº† path å˜é‡çš„ç›¸å…³å†…å®¹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> .bash_profile</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Get the aliases and <span class="built_in">functions</span></span></span><br><span class="line">if [ -f ~/.bashrc ]; then</span><br><span class="line">. ~/.bashrc</span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span><span class="bash"> User specific environment and startup programs</span></span><br><span class="line">PATH=$PATH:$HOME/bin</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure>

<h3 id="PATH-å˜é‡"><a href="#PATH-å˜é‡" class="headerlink" title="PATH å˜é‡"></a>PATH å˜é‡</h3><p>PATH å˜é‡æ˜¯æˆ‘ä»¬ç³»ç»Ÿä¸­çš„ç›¸å…³å‘½ä»¤çš„è·¯å¾„ã€‚PATH çš„ä½œç”¨,ç®€åŒ–æˆ‘ä»¬çš„å‘½ä»¤å†™æ³•ã€‚</p>
<p>æˆ‘ä»¬æ‰§è¡Œçš„å‘½ä»¤ä¸€èˆ¬éƒ½åœ¨ PATH æŒ‡å®šçš„è·¯å¾„ä¸­,æ¯”å¦‚è¯´æˆ‘ä»¬çš„ useradd å‘½ä»¤,å®é™…ä¸Šæ‰§è¡Œçš„æ˜¯/usr/sbin/useradd ,å†æ¯”å¦‚è¯´ touch å‘½ä»¤,å®é™…ä¸Šæ‰§è¡Œçš„æ˜¯/bin/touch å‘½ä»¤ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera0 ~]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line">[root@mastera0 ~]# which useradd</span><br><span class="line">/usr/sbin/useradd</span><br><span class="line">[root@mastera0 ~]# which touch</span><br><span class="line">/usr/bin/touch</span><br><span class="line">[root@mastera0 ~]# vim pathtest</span><br><span class="line">[root@mastera0 ~]# ll pathtest</span><br><span class="line">-rw-r--r--. 1 root root 26 Jun 24 16:58 pathtest</span><br><span class="line">[root@mastera0 ~]# chmod +x pathtest</span><br><span class="line">[root@mastera0 ~]# ll pathtest</span><br><span class="line">-rwxr-xr-x. 1 root root 26 Jun 24 16:58 pathtest</span><br><span class="line">[root@mastera0 ~]# pathtest</span><br><span class="line">-bash: pathtest: command not found</span><br><span class="line">[root@mastera0 ~]# ./pathtest</span><br><span class="line">this is a PATH-test!</span><br><span class="line">[root@mastera0 ~]# cp pathtest /usr/local/bin</span><br><span class="line">[root@mastera0 ~]# pathtest</span><br><span class="line">this is a PATH-test!</span><br><span class="line">[root@mastera0 ~]# which pathtest</span><br><span class="line">/usr/local/bin/pathtest</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆ PATH ä¹Ÿæœ‰ä¸€ä¸ªè¯»å–é¡ºåº,ä¼˜å…ˆä¼šä»ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹æ‰¾,æ¯”å¦‚è¯´æˆ‘ä»¬å»/usr/local/sbin ä¸‹é¢åˆ›å»ºä¸€ä¸ªåŒåçš„å¯æ‰§è¡Œæ–‡ä»¶ pathtest,å†…å®¹å¦‚ä¸‹:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera0 ~]# vim pathtest</span><br><span class="line">[root@mastera0 ~]# cp pathtest /usr/local/sbin</span><br><span class="line">[root@mastera0 ~]# pathtest</span><br><span class="line">this is a PATH-test!</span><br><span class="line">[root@mastera0 ~]# ./pathtest</span><br><span class="line">New! I am /usr/local/sbin this is a PATH-test!</span><br><span class="line">[root@mastera0 ~]# pathtest</span><br><span class="line">this is a PATH-test!</span><br><span class="line">[root@mastera0 ~]# export PATH</span><br><span class="line">[root@mastera0 ~]# pathtest</span><br><span class="line">New! I am /usr/local/sbin this is a PATH-test!</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå°±æ˜¯ PATH çš„è¯»å–é¡ºåº,ç”±äºç¬¬äºŒä¸ª pathtest å‘½ä»¤çš„è·¯å¾„/usr/local/sbin ä¼˜å…ˆäºç¬¬ä¸€ä¸ª</p>
<p>pathtest å‘½ä»¤çš„è·¯å¾„/usr/local/bin,æ‰€ä»¥æ‰§è¡Œäº†ç¬¬äºŒä¸ª pathtestå³/usr/local/sbin/pathtestã€‚ç„¶åæˆ‘ä»¬æŠŠç¬¬äºŒä¸ª pathtest åˆ é™¤ <code>rm -rf /usr/local/sbin/pathtest</code>,é‡æ–° export ä¸€ä¸‹PATH,export æ˜¯è®¾ç½®ç¯å¢ƒå˜é‡çš„æ„æ€ã€‚ä¹‹åæˆ‘ä»¬è®²åˆ°è„šæœ¬ä¼šå»è¯´</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@mastera0 ~]# rm -rf /usr/local/sbin/pathtest</span><br><span class="line">[root@mastera0 ~]# export PATH</span><br><span class="line">[root@mastera0 ~]# pathtest</span><br><span class="line">this is a PATH-test!</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆè¿™æ—¶å€™å†æ¥çœ‹ä¸€ä¸‹æ‰§è¡Œç»“æœæ˜¯ä¸æ˜¯åˆå›æ¥äº†ã€‚</p>
<p>æœ€å,è¯»å®Œè¿™ä¸¤ä¸ª<del>/.bash_profile å’Œ</del>/.bashrc ä»¥å,ç³»ç»Ÿæœ€åå†å»è¯»/etc/bashrcã€‚</p>
<p>è¿™æ˜¯æˆ‘ä»¬æ•´ä¸ªçš„æµç¨‹ã€‚å…ˆåè¯»å–é¡ºåºåˆ†åˆ«æ˜¯</p>
<ol>
<li>/etc/profile</li>
<li>/etc/profile.d/*</li>
<li>~/.bash_profile</li>
<li>~/.bashrc</li>
<li>/etc/bashrc</li>
</ol>
<p>è®°ä½,åé¢å†™çš„å˜é‡ä¼šè¦†ç›–ä¹‹å‰çš„å˜é‡å€¼,æ‰€ä»¥æˆ‘ä»¬æƒ³è®©å“ªäº›å˜é‡ç”Ÿæ•ˆ,å°±ä¸€å®šè¦æ¸…æ¥šå†™åœ¨ä»€ä¹ˆä½ç½®ã€‚</p>
<p>æ¯”å¦‚è¯´,æˆ‘å¸Œæœ›åªèƒ½å¤Ÿç»™ student ç”¨æˆ·ä½¿ç”¨çš„åˆ«ååº”è¯¥å†™åˆ°~/.bashrc ç›®å½•ä¸‹</p>
<p>æˆ‘å¸Œæœ›è®©å…¨å±€ç”Ÿæ•ˆçš„å‚æ•°å¯ä»¥æ”¾ç½®åœ¨/etc/profile ç›®å½•ä¸‹ã€‚</p>
<p><code>Su</code> å’Œ <code>su -</code>çš„åŒºåˆ«:è¿™å°±æ˜¯ç”¨æˆ·ç™»å½•æµç¨‹è¦æ³¨æ„çš„äº‹æƒ…,ç³»ç»Ÿé‡Œé¢æœ‰ä¸ªå¾ˆå…¸å‹çš„ä¾‹å­,å°±æ˜¯ su</p>
<p><code>Su</code> ä»£è¡¨åˆ‡æ¢ç”¨æˆ·ã€‚ç”¨æ³•æ˜¯ <code>su - ç”¨æˆ·å</code>,æˆ–è€…<code>su</code> ç›´æ¥è·Ÿä¸Šç”¨æˆ·åã€‚å‰è€…å«æ ‡å‡†åˆ‡æ¢,åè€…å«éæ ‡å‡†åˆ‡æ¢ã€‚</p>
<p>éæ ‡å‡†åˆ‡æ¢æœ‰äº›å˜é‡æ˜¯æ‹¿ä¸åˆ°çš„ã€‚æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ° su ä¹‹å,æˆ‘ä»¬çš„ä½ç½®è¿˜åœ¨åˆ‡æ¢ä¹‹å‰çš„ä½ç½®,è€Œæˆ‘ä»¬ <code>su -</code> çš„ä½ç½®å·²ç»åˆ‡æ¢åˆ°ç”¨æˆ·çš„å®¶ç›®å½•äº†ã€‚</p>
<p>é‚£ä¹ˆæ˜¯å“ªäº›å˜é‡æ²¡æ‹¿åˆ°å‘¢?</p>
<p>æˆ‘ä»¬æ¥åšä¸ªå°å®éªŒã€‚</p>
<p>æ¼”ç¤º ç»™ 5 ä¸ªé…ç½®æ–‡ä»¶çš„å¤´éƒ¨åˆ†åˆ«å†™ä¸Š <code>echo &quot;xxx (é…ç½®æ–‡ä»¶å) start&quot;</code>,å°¾éƒ¨å†™ä¸Š <code>echo &quot;xxxx(é…ç½®æ–‡ä»¶å) stop&quot;</code></p>
<p> <code>Man bash</code> å¯ä»¥å‘Šè¯‰ä½ ç™»å½•æµç¨‹çš„ç›¸å…³å†…å®¹ã€‚</p>
<h3 id="PS1-å˜é‡"><a href="#PS1-å˜é‡" class="headerlink" title="PS1 å˜é‡"></a>PS1 å˜é‡</h3><p>/etc/bashrc ä¸­æœ‰ä¸€ä¸ªå˜é‡ PS1,æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ä»–çš„ä½œç”¨ã€‚</p>
<p><code>man bash</code> åæœç´¢ ps1 å…³é”®è¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">\d :ä»£è¡¨æ—¥æœŸ,æ ¼å¼ä¸º weekday month date,ä¾‹å¦‚:"Mon Aug 1"</span><br><span class="line">\H :å®Œæ•´çš„ä¸»æœºåç§°ã€‚ä¾‹å¦‚:æˆ‘çš„æœºå™¨åç§°ä¸º:fc4.linux,åˆ™è¿™ä¸ªåç§°å°±æ˜¯ fc4.linux</span><br><span class="line">\h :ä»…å–ä¸»æœºçš„ç¬¬ä¸€ä¸ªåå­—,å¦‚ä¸Šä¾‹,åˆ™ä¸º fc4,.linux åˆ™è¢«çœç•¥</span><br><span class="line">\t :æ˜¾ç¤ºæ—¶é—´ä¸º 24 å°æ—¶æ ¼å¼,å¦‚:HH:MM:SS</span><br><span class="line">\T :æ˜¾ç¤ºæ—¶é—´ä¸º 12 å°æ—¶æ ¼å¼</span><br><span class="line">\A :æ˜¾ç¤ºæ—¶é—´ä¸º 24 å°æ—¶æ ¼å¼:HH:MM</span><br><span class="line">\u :å½“å‰ç”¨æˆ·çš„è´¦å·åç§°</span><br><span class="line">\v :BASH çš„ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">\w :å®Œæ•´çš„å·¥ä½œç›®å½•åç§°ã€‚å®¶ç›®å½•ä¼šä»¥ ~ä»£æ›¿</span><br><span class="line">\W :åˆ©ç”¨ basename å–å¾—å·¥ä½œç›®å½•åç§°,æ‰€ä»¥åªä¼šåˆ—å‡ºæœ€åä¸€ä¸ªç›®å½•</span><br><span class="line"> :ä¸‹è¾¾çš„ç¬¬å‡ ä¸ªå‘½ä»¤</span><br><span class="line">\$ :æç¤ºå­—ç¬¦,å¦‚æœæ˜¯ root æ—¶,æç¤ºç¬¦ä¸º:# ,æ™®é€šç”¨æˆ·åˆ™ä¸º:$</span><br></pre></td></tr></table></figure>

<p>theåœ¨ PS1 ä¸­è®¾ç½®å­—ç¬¦åºåˆ—é¢œè‰²çš„æ ¼å¼ä¸º:[\e[F;Bm]</p>
<ul>
<li><p>Fä¸ºå­—ä½“é¢œè‰²,ç¼–å· 30~37;</p>
</li>
<li><p>Bä¸ºèƒŒæ™¯è‰²,ç¼–å· 40~47 ã€‚</p>
</li>
<li><p>å–æ¶ˆè®¾ç½®:[\e[m]</p>
</li>
</ul>
<p>é¢œè‰²è¡¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">å‰æ™¯ èƒŒæ™¯ é¢œè‰²</span><br><span class="line">30 40 é»‘è‰²</span><br><span class="line">31 41 çº¢è‰²</span><br><span class="line">32 42 ç»¿è‰²</span><br><span class="line">33 43 é»„è‰²</span><br><span class="line">34 44 è“è‰²</span><br><span class="line">35 45 ç´«çº¢è‰²</span><br><span class="line">36 46 é’è“è‰²</span><br><span class="line">37 47 ç™½è‰²</span><br><span class="line"></span><br><span class="line">ä»£ç </span><br><span class="line">æ„ä¹‰</span><br><span class="line">0 OFF</span><br><span class="line">1 é«˜äº®æ˜¾ç¤º</span><br><span class="line">4 underline</span><br><span class="line">7 åç™½æ˜¾ç¤º</span><br><span class="line">8 ä¸å¯è§</span><br></pre></td></tr></table></figure>

<p>ä¸¾ä¾‹:</p>
<p>PS1=â€™[[\e[32m]###[\e[31m]\u@[\e[36m]\h \w]$[\e[m]â€˜</p>
<ul>
<li><p>[\e[32m] è®¾ç½®ä¸ºç»¿è‰²</p>
</li>
<li><p>### æ˜¾ç¤ºç°åœ¨è¿è¡Œçš„æ˜¯ç¬¬å‡ æ¡å‘½ä»¤</p>
</li>
<li><p>[\e[31m] è®¾ç½®ä¸ºçº¢è‰²</p>
</li>
<li><p>\u@ å½“å‰ç”¨æˆ·çš„è´¦å·åç§°@</p>
</li>
<li><p>[\e[36m] é’è“è‰²</p>
</li>
<li><p>\h \w</p>
</li>
<li><p>\h ä»…å–ä¸»æœºçš„ç¬¬ä¸€ä¸ªåå­—,\w æ˜¯è¯´:æ˜¾ç¤ºå®Œæ•´çš„è·¯å¾„,ä½†æ˜¯ä¸çŸ¥åˆ°ä¸ºä»€ä¹ˆå®¶ä»–æ˜¾ç¤º~è€Œä¸æ˜¯ç»å¯¹è·¯å¾„ã€‚</p>
</li>
<li><p>[\e[m] ä½¿ç”¨æ¥å…³é—­é¢œè‰²è®¾ç½®çš„ã€‚</p>
</li>
</ul>
<p>è¦æ˜¯ä½ æ²¡æœ‰è¿™ä¸ªçš„è¯;é‚£ä¹ˆ,ä½ çš„å‘½ä»¤æç¤ºç¬¦,åŒ…æ‹¬ä½ é€šè¿‡å‘½ä»¤æç¤ºç¬¦è¾“å‡ºçš„ä¸œè¥¿éƒ½æ˜¯å’Œæœ€åä¸€æ¬¡çš„é¢œè‰²è®¾ç½®ç›¸åŒ( é™¤äº†ä¸€äº›æœ‰ç‰¹æ®Šæ„ä¹‰çš„æ–‡ä»¶ )ã€‚</p>
<p>è¿™ä¸ªé…ç½®å†™åˆ°å“ªé‡Œå‘¢???</p>
<p>å¦‚æœåªæƒ³è®©å½“å‰ç”¨æˆ·ç”Ÿæ•ˆ,é‚£ä¹ˆåº”è¯¥åœ¨ç”¨æˆ·çš„æ ¹ç›®å½•ä¸‹çš„ â€œ.bashrcâ€,åœ¨é‡Œå¤´çš„æœ€åä¸€è¡ŒåŠ ä¸Š,ç„¶åä¿å­˜ã€‚ç„¶å source .bashrc æˆ–è€… â€œ. .bashrcâ€ æˆ–è€…æ³¨é”€ä¸€ä¸‹ã€‚å¦‚æœæƒ³è®©æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆ,è¯¥æ”¾å“ªé‡Œ?æ€è€ƒé¢˜</p>
<h2 id="Bashç®€ä»‹è¯¾åä½œä¸š"><a href="#Bashç®€ä»‹è¯¾åä½œä¸š" class="headerlink" title="Bashç®€ä»‹è¯¾åä½œä¸š"></a>Bashç®€ä»‹è¯¾åä½œä¸š</h2><ol>
<li>è¦æ±‚ student ç”¨æˆ·ç™»å½•çš„æ—¶å€™è·å– umask å€¼ä¸º 044, å¹¶ä¸”è¯¥ å€¼æ°¸ä¹…ç”Ÿæ•ˆã€‚</li>
<li>è¦æ±‚æ‰€æœ‰æ™®é€šç”¨æˆ·ç™»å½•æ—¶, æœ€åè·å–åˆ°çš„ HISTSIZE å€¼ä¸º 500, è€Œ root ç”¨æˆ·è·å–åˆ°çš„ HISTSIZE çš„å€¼ä¸º 1000 ã€‚</li>
<li>æ¢³ç†ä¸€ä¸‹äº”ä¸ªæ–‡ä»¶çš„ç™»å½•é¡ºåºã€‚</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç³»ç»ŸåŸºç¡€åŸ¹è®­</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux æ—¥å¿—å’Œè®¡åˆ’ä»»åŠ¡</title>
    <url>/2016/12/22/booboo_linux_base/08-%E6%97%A5%E5%BF%97%E5%92%8C%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/</url>
    <content><![CDATA[<h2 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h2><h3 id="æ—¥å¿—çš„ä½œç”¨"><a href="#æ—¥å¿—çš„ä½œç”¨" class="headerlink" title="æ—¥å¿—çš„ä½œç”¨"></a>æ—¥å¿—çš„ä½œç”¨</h3><ul>
<li>è§£å†³ç³»ç»Ÿæ–¹é¢çš„é”™è¯¯</li>
<li>è§£å†³ç½‘ç»œæœåŠ¡çš„é—®é¢˜</li>
<li>è¿‡å¾€äº‹ä»¶è®°å½•</li>
</ul>
<h3 id="å¸¸ç”¨çš„æ—¥å¿—"><a href="#å¸¸ç”¨çš„æ—¥å¿—" class="headerlink" title="å¸¸ç”¨çš„æ—¥å¿—"></a>å¸¸ç”¨çš„æ—¥å¿—</h3><table>
<thead>
<tr>
<th align="left">æ—¥å¿—</th>
<th align="left">è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td align="left">/var/log/cron</td>
<td align="left">crontab è®¡åˆ’ä»»åŠ¡</td>
</tr>
<tr>
<td align="left">/var/log/dmesg</td>
<td align="left">å¼€æœºæ ¸å¿ƒä¾¦æµ‹ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">/var/log/lastlog</td>
<td align="left">ç³»ç»Ÿæ‰€æœ‰å¸å·æœ€è¿‘ä¸€æ¬¡ç™»é™†ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">/var/log/maillog</td>
<td align="left">é‚®ä»¶å¾€æ¥ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">/var/log/messages</td>
<td align="left">ç³»ç»Ÿé”™è¯¯ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">/var/log/secure</td>
<td align="left">æ¶‰åŠè¾“å…¥å¸å·å¯†ç çš„ç¨‹åº</td>
</tr>
<tr>
<td align="left">/var/log/wtmp</td>
<td align="left">æ­£ç¡®ç™»é™†ç³»ç»Ÿçš„è´¦æˆ·ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">/var/log/btmp</td>
<td align="left">é”™è¯¯ç™»é™†ç³»ç»Ÿçš„è´¦æˆ·ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">/var/log/httpd/*</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">/var/log/samba/*</td>
<td align="left">ä¸åŒçš„ç½‘ç»œæœåŠ¡ä¼šä½¿ç”¨å®ƒä»¬è‡ªå·±çš„ç™»å½•æ–‡ä»¶æ¥è®°è½½å®ƒä»¬è‡ªå·±äº§ç”Ÿçš„å„é¡¹ä¿¡æ¯</td>
</tr>
</tbody></table>
<h3 id="æ—¥å¿—çš„ç±»å‹"><a href="#æ—¥å¿—çš„ç±»å‹" class="headerlink" title="æ—¥å¿—çš„ç±»å‹"></a>æ—¥å¿—çš„ç±»å‹</h3><p>1&gt; å¯æŸ¥çœ‹çš„ ASCII çš„æ—¥å¿—</p>
<p>â€¢ messages</p>
<p>â€¢ ä¸ç¨‹åºåŒåçš„ç›®å½•ä¸‹, ä¼šè®°å½•å’Œè¯¥ç¨‹åºç›¸å…³çš„ä¸€äº›æ—¥å¿—</p>
<p>2&gt; ä¸å¯æŸ¥çœ‹çš„ data æ—¥å¿—</p>
<p>éœ€è¦è°ƒç”¨æŸäº›å‘½ä»¤æ‰èƒ½å»æŸ¥çœ‹å¯¹åº”çš„æ—¥å¿—</p>
<p>â€¢ wtmp &lt;==last: ç³»ç»Ÿç™»é™†ç™»å‡ºä¿¡æ¯</p>
<p>â€¢ btmp &lt;==lastb: é”™è¯¯çš„ç³»ç»Ÿç™»é™†ç™»å‡ºæƒ…å†µ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">3<span class="comment">#root@rhel6 ~]#file /var/log/wtmp</span></span></span><br><span class="line">/var/log/wtmp: data</span><br></pre></td></tr></table></figure>

<h3 id="æ—¥å¿—éœ€è¦çš„æœåŠ¡å’Œç¨‹åº"><a href="#æ—¥å¿—éœ€è¦çš„æœåŠ¡å’Œç¨‹åº" class="headerlink" title="æ—¥å¿—éœ€è¦çš„æœåŠ¡å’Œç¨‹åº"></a>æ—¥å¿—éœ€è¦çš„æœåŠ¡å’Œç¨‹åº</h3><p>rsyslogd ä¸»è¦è´Ÿè´£è®°å½•ç³»ç»Ÿè¿ä½œä¸­ , kernel æˆ–åº”ç”¨ç¨‹åºäº§ç”Ÿçš„å„ç§è®¯æ¯ , è®¯æ¯è¢«å†™å…¥ç³»ç»Ÿæ—¥å¿—</p>
<p>logrotate ä¸»è¦åœ¨è¿›è¡Œæ—¥å¿—æ–‡ä»¶çš„è½®æ›¿åŠŸèƒ½</p>
<ul>
<li>rhel5 ç‰ˆæœ¬ä»¥å‰æ˜¯ syslogd æœåŠ¡ , rhel6 ä¹‹åæ˜¯ rsyslogd æœåŠ¡ ( reliable and extended å¯é çš„å’Œæ‹“å±•çš„<br>syslogd æœåŠ¡ )</li>
</ul>
<p>ã€ (1) ä»€ä¹ˆæœåŠ¡ (2) ä»€ä¹ˆç­‰çº§ä¿¡æ¯ (3) éœ€è¦è¢«è®°å½•åœ¨å“ªé‡Œ ( è®¾å¤‡æˆ–æ–‡ä»¶ ) ã€</p>
<h3 id="rsyslog-çš„ç›¸å…³é…ç½®æ–‡ä»¶"><a href="#rsyslog-çš„ç›¸å…³é…ç½®æ–‡ä»¶" class="headerlink" title="rsyslog çš„ç›¸å…³é…ç½®æ–‡ä»¶"></a>rsyslog çš„ç›¸å…³é…ç½®æ–‡ä»¶</h3><p>â€¢ /etc/rsyslog.conf</p>
<p>â€¢ /etc/rsyslog.d/*</p>
<h3 id="etc-rsyslog-conf"><a href="#etc-rsyslog-conf" class="headerlink" title="/etc/rsyslog.conf"></a>/etc/rsyslog.conf</h3><p>/etc/rsyslog.conf æ–‡ä»¶ä¸­çš„ä¸€é¡¹é…ç½®è®°å½•ç”± â€œ é€‰é¡¹ â€ (selector) å’Œ â€œ åŠ¨ä½œ â€ (action)ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆ,ä¸¤<br>è€…é—´ç”¨ tab åˆ¶è¡¨ç¬¦è¿›è¡Œåˆ†éš”(ä½¿ç”¨ç©ºæ ¼é—´éš”æ˜¯æ— æ•ˆçš„)ã€‚</p>
<p>â€œ é€‰é¡¹ â€ ( selector)ç”±ä¸¤éƒ¨åˆ†ç»„æˆ:</p>
<ul>
<li>è®¾æ–½ facility å’Œçº§åˆ« loglevel,ç”±ç‚¹å·.åˆ†éš”,ä¸¤éƒ¨åˆ†éƒ½æ˜¯å¤§å°å†™ä¸æ•æ„Ÿ;</li>
<li>è®¾æ–½å’Œçº§åˆ«éƒ½åœ¨ syslog(3)ä¸­æœ‰æè¿°ã€‚å„ä¿ç•™å­—æ®µé—´ç”¨åˆ†å·åˆ†éš”ã€‚</li>
<li>å¦‚ä¸‹è¡Œæ‰€ç¤º:</li>
</ul>
<p>è®¾æ–½. çº§åˆ« [;è®¾æ–½.çº§åˆ«]TAB åŠ¨ä½œ</p>
<h4 id="è®¾æ–½-facility"><a href="#è®¾æ–½-facility" class="headerlink" title="è®¾æ–½ facility"></a>è®¾æ–½ facility</h4><p>ä¿ç•™å­—æ®µä¸­çš„ â€œ è®¾æ–½ â€ (facility )ä»£è¡¨ä¿¡æ¯äº§ç”Ÿçš„æºå¤´,å¯ä»¥æ˜¯:</p>
<table>
<thead>
<tr>
<th align="left">facility</th>
<th align="left">è®¾æ–½</th>
</tr>
</thead>
<tbody><tr>
<td align="left">auth</td>
<td align="left">è®¤è¯ç³»ç»Ÿ,å³è¯¢é—®ç”¨æˆ·åå’Œå£ä»¤</td>
</tr>
<tr>
<td align="left">cron</td>
<td align="left">ç³»ç»Ÿå®šæ—¶ç³»ç»Ÿæ‰§è¡Œå®šæ—¶ä»»åŠ¡æ—¶å‘å‡ºçš„ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">daemon</td>
<td align="left">æŸäº›ç³»ç»Ÿçš„å®ˆæŠ¤ç¨‹åºçš„ syslog,å¦‚ç”± in.ftpd äº§ç”Ÿçš„ log</td>
</tr>
<tr>
<td align="left">kern</td>
<td align="left">å†…æ ¸çš„ syslog ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">lpr</td>
<td align="left">æ‰“å°æœºçš„ syslog ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">mail</td>
<td align="left">é‚®ä»¶ç³»ç»Ÿçš„ syslog ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">mark</td>
<td align="left">å®šæ—¶å‘é€æ¶ˆæ¯çš„æ—¶æ ‡ç¨‹åº</td>
</tr>
<tr>
<td align="left">news</td>
<td align="left">æ–°é—»ç³»ç»Ÿçš„ syslog ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">user</td>
<td align="left">æœ¬åœ°ç”¨æˆ·åº”ç”¨ç¨‹åºçš„ syslog ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">uucp</td>
<td align="left">uucp å­ç³»ç»Ÿçš„ syslog ä¿¡æ¯,unix to unix copy, unix ä¸»æœºä¹‹é—´ç›¸å…³çš„é€šè®¯</td>
</tr>
<tr>
<td align="left">local0-7</td>
<td align="left">ç§æœ¬åœ°ç±»å‹çš„ syslog ä¿¡æ¯,è¿™äº›ä¿¡æ¯å¯ä»¥åˆç”¨æˆ·æ¥å®šä¹‰</td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">ä»£è¡¨ä»¥ä¸Šå„ç§è®¾å¤‡</td>
</tr>
</tbody></table>
<h4 id="çº§åˆ«-loglevel"><a href="#çº§åˆ«-loglevel" class="headerlink" title="çº§åˆ« loglevel"></a>çº§åˆ« loglevel</h4><p>ä¿ç•™å­—æ®µä¸­çš„ â€œ çº§åˆ« â€ ä»£è¡¨ä¿¡æ¯çš„é‡è¦æ€§,å¯ä»¥æ˜¯:</p>
<table>
<thead>
<tr>
<th align="left">num</th>
<th align="left">loglevel</th>
<th align="left">çº§åˆ«</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0</td>
<td align="left">emerg</td>
<td align="left">ç´§æ€¥,å¤„äº Panic çŠ¶æ€ã€‚é€šå¸¸åº”å¹¿æ’­åˆ°æ‰€æœ‰ç”¨æˆ·;å‡ ä¹è¦å½“æœº</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">alert</td>
<td align="left">å‘Šè­¦,å½“å‰çŠ¶æ€å¿…é¡»ç«‹å³è¿›è¡Œçº æ­£ã€‚ä¾‹å¦‚,ç³»ç»Ÿæ•°æ®åº“å´©æºƒ;</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">crit</td>
<td align="left">å…³é”®çŠ¶æ€çš„è­¦å‘Šã€‚ä¾‹å¦‚,ç¡¬ä»¶æ•…éšœ;</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">err</td>
<td align="left">å…¶å®ƒé”™è¯¯;</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">warn</td>
<td align="left">è­¦å‘Š;</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">notice</td>
<td align="left">æ³¨æ„;éé”™è¯¯çŠ¶æ€çš„æŠ¥å‘Š,ä½†åº”ç‰¹åˆ«å¤„ç†;</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">info</td>
<td align="left">é€šæŠ¥ä¿¡æ¯;</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">debug</td>
<td align="left">è°ƒè¯•ç¨‹åºæ—¶çš„ä¿¡æ¯;</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">none</td>
<td align="left">é€šå¸¸è°ƒè¯•ç¨‹åºæ—¶ç”¨,æŒ‡ç¤ºå¸¦æœ‰ none çº§åˆ«çš„ç±»å‹äº§ç”Ÿçš„ä¿¡æ¯æ— éœ€é€å‡ºã€‚å¦‚</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">*.debug;mail.none</td>
<td align="left">è¡¨ç¤ºè°ƒè¯•æ—¶é™¤é‚®ä»¶ä¿¡æ¯å¤–å…¶å®ƒä¿¡æ¯éƒ½é€å‡ºã€‚</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">.xxx:</td>
<td align="left">è¡¨ç¤ºå¤§äºç­‰äº xxx çº§åˆ«çš„ä¿¡æ¯</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">.=xxx:</td>
<td align="left">è¡¨ç¤ºç­‰äº xxx çº§åˆ«çš„ä¿¡æ¯</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">.!xxx:</td>
<td align="left">è¡¨ç¤ºåœ¨ xxx ä¹‹å¤–çš„ç­‰çº§çš„ä¿¡æ¯æ‹“å±•:</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">19<span class="comment">#root@rhel6 ~]#man syslog</span></span></span><br></pre></td></tr></table></figure>

<h4 id="åŠ¨ä½œ-action"><a href="#åŠ¨ä½œ-action" class="headerlink" title="åŠ¨ä½œ action"></a>åŠ¨ä½œ action</h4><p>â€œ åŠ¨ä½œ â€ åŸŸæŒ‡ç¤ºä¿¡æ¯å‘é€çš„ç›®çš„åœ°ã€‚å¯ä»¥æ˜¯:</p>
<table>
<thead>
<tr>
<th align="left">action</th>
<th align="left">åŠ¨ä½œ</th>
</tr>
</thead>
<tbody><tr>
<td align="left">/filename</td>
<td align="left">æ—¥å¿—æ–‡ä»¶ã€‚ç”±ç»å¯¹è·¯å¾„æŒ‡å‡ºçš„æ–‡ä»¶å,æ­¤æ–‡ä»¶å¿…é¡»äº‹å…ˆå»ºç«‹;</td>
</tr>
<tr>
<td align="left">@host</td>
<td align="left">è¿œç¨‹ä¸»æœº; @ç¬¦å·åé¢å¯ä»¥æ˜¯ ip,ä¹Ÿå¯ä»¥æ˜¯åŸŸå,é»˜è®¤åœ¨/etc/hosts æ–‡ä»¶ä¸‹ loghost è¿™ä¸ªåˆ«åå·²ç»æŒ‡å®šç»™äº†æœ¬æœºã€‚</td>
</tr>
<tr>
<td align="left">user1,user2</td>
<td align="left">æŒ‡å®šç”¨æˆ·ã€‚å¦‚æœæŒ‡å®šç”¨æˆ·å·²ç™»å½•,é‚£ä¹ˆä»–ä»¬å°†æ”¶åˆ°ä¿¡æ¯;</td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">æ‰€æœ‰ç”¨æˆ·ã€‚æ‰€æœ‰å·²ç™»å½•çš„ç”¨æˆ·éƒ½å°†æ”¶åˆ°ä¿¡æ¯ã€‚</td>
</tr>
</tbody></table>
<h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><ol>
<li>è®°å½•åˆ°æ™®é€šæ–‡ä»¶æˆ–è®¾å¤‡æ–‡ä»¶<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">*.* /var/log/file.log</span><br><span class="line">*.* /dev/pts/0</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>æµ‹è¯•: logger -p local3.info â€˜KadeFor is testing the rsyslog and logger â€˜</p>
<p>logger å‘½ä»¤ç”¨äºäº§ç”Ÿæ—¥å¿—</p>
<ol start="2">
<li><p>è½¬å‘åˆ°è¿œç¨‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">*.* @192.168.0.1 # ä½¿ç”¨ UDP åè®®è½¬å‘åˆ° 192.168.0.1 çš„ 514(é»˜è®¤)ç«¯å£</span><br><span class="line">*.* @@192.168.0.1:10514 # ä½¿ç”¨ TCP åè®®è½¬å‘åˆ° 192.168.0.1 çš„ 10514(é»˜è®¤)ç«¯å£</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‘é€ç»™ç”¨æˆ·(éœ€è¦åœ¨çº¿æ‰èƒ½æ”¶åˆ°)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*.* root</span><br><span class="line">*.* root,kadefor,up01</span><br><span class="line">*.* *</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>ä½¿ç”¨,å·åˆ†éš”å¤šä¸ªç”¨æˆ·</li>
<li>*å·è¡¨ç¤ºæ‰€æœ‰åœ¨çº¿ç”¨æˆ·</li>
</ul>
<ol start="4">
<li>å¿½ç•¥,ä¸¢å¼ƒ<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">local3.* # å¿½ç•¥æ‰€æœ‰ local3 ç±»å‹çš„æ‰€æœ‰çº§åˆ«çš„æ—¥å¿—</span><br></pre></td></tr></table></figure></li>
<li>æ‰§è¡Œè„šæœ¬<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">local3.* ^/tmp/a.sh</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>^å·åè·Ÿå¯æ‰§è¡Œè„šæœ¬æˆ–ç¨‹åºçš„ç»å¯¹è·¯å¾„</li>
</ul>
<ol start="6">
<li>ä¸€ä¸ªæ ‡å‡†çš„ç®€å•çš„é…ç½®æ–‡ä»¶<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### RULES ####</span></span></span><br><span class="line">è§„åˆ™éƒ¨åˆ†</span><br><span class="line"><span class="meta">#</span><span class="bash"> Log all kernel messages to the console.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Logging much <span class="keyword">else</span> clutters up the screen.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">kern.*</span></span><br><span class="line">/dev/console</span><br><span class="line"><span class="meta">#</span><span class="bash">å…³äºå†…æ ¸çš„æ‰€æœ‰æ—¥å¿—éƒ½æ”¾åˆ°/dev/console(æ§åˆ¶å°)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Log anything (except mail) of level info or higher.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Don<span class="string">'t log private authentication messages!</span></span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none</span><br><span class="line">/var/log/messages</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®°å½•æ‰€æœ‰æ—¥å¿—ç±»å‹çš„ info çº§åˆ«ä»¥åŠå¤§äº info çº§åˆ«çš„ä¿¡æ¯åˆ°/var/<span class="built_in">log</span>/messages,ä½†æ˜¯ mail</span></span><br><span class="line">é‚®ä»¶ä¿¡æ¯,authpriv éªŒè¯æ–¹é¢çš„ä¿¡æ¯å’Œ cron æ—¶é—´ä»»åŠ¡ç›¸å…³çš„ä¿¡æ¯é™¤å¤–</span><br><span class="line"><span class="meta">#</span><span class="bash"> The authpriv file has restricted access.</span></span><br><span class="line">authpriv.*</span><br><span class="line">/var/log/secure</span><br><span class="line"><span class="meta">#</span><span class="bash"> authpriv éªŒè¯ç›¸å…³çš„æ‰€æœ‰ä¿¡æ¯å­˜æ”¾åœ¨/var/<span class="built_in">log</span>/secure</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Log all the mail messages <span class="keyword">in</span> one place.</span></span><br><span class="line">mail.*</span><br><span class="line">-/var/log/maillog</span><br><span class="line"><span class="meta">#</span><span class="bash"> é‚®ä»¶çš„æ‰€æœ‰ä¿¡æ¯å­˜æ”¾åœ¨/var/<span class="built_in">log</span>/maillog; è¿™é‡Œæœ‰ä¸€ä¸ª-ç¬¦å·, è¡¨ç¤ºæ˜¯ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼è®°å½•,</span></span><br><span class="line">å› ä¸ºæ—¥å¿—ä¸€èˆ¬ä¼šæ¯”è¾ƒå¤§</span><br><span class="line"><span class="meta">#</span><span class="bash"> Log cron stuff</span></span><br><span class="line">cron.*</span><br><span class="line">/var/log/cron</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¡åˆ’ä»»åŠ¡æœ‰å…³çš„ä¿¡æ¯å­˜æ”¾åœ¨/var/<span class="built_in">log</span>/cron</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Everybody gets emergency messages</span></span><br><span class="line">*.emerg</span><br><span class="line">*</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰€æœ‰æ—¥å¿—ç±»å‹çš„ emerg ä¿¡æ¯å‘ç»™æ‰€æœ‰ç”¨æˆ·</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Save news errors of level crit and higher <span class="keyword">in</span> a special file.</span></span><br><span class="line">uucp,news.crit</span><br><span class="line">/var/log/spooler</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®°å½• uucp,news.crit ç­‰å­˜æ”¾åœ¨/var/<span class="built_in">log</span>/spooler</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Save boot messages also to boot.log</span></span><br><span class="line">local7.*</span><br><span class="line">/var/log/boot.log</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨çš„ç›¸å…³ä¿¡æ¯å­˜æ”¾åœ¨/var/<span class="built_in">log</span>/boot.log</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="é‡å¯æœåŠ¡"><a href="#é‡å¯æœåŠ¡" class="headerlink" title="é‡å¯æœåŠ¡"></a>é‡å¯æœåŠ¡</h3><p>service rsyslog restart &lt;==rhel6</p>
<p>systermctl restart rsyslog &lt;==rhel7</p>
<p>ps : rsyslog çš„æ—¥å¿—åªè¦ã€è¢«ç¼–è¾‘è¿‡ã€å°±æ— æ³•ç»§ç»­è®°å½• ! éœ€è¦é‡å¯æ—¥å¿—æ¢å¤ã€‚</p>
<h2 id="logrotate-æ—¥å¿—è½®è¯¢"><a href="#logrotate-æ—¥å¿—è½®è¯¢" class="headerlink" title="logrotate æ—¥å¿—è½®è¯¢"></a>logrotate æ—¥å¿—è½®è¯¢</h2><p>/usr/sbin/logrotate å°†æ—§çš„æ—¥å¿—æ–‡ä»¶ç§»åŠ¨æˆæ—§æ–‡ä»¶, å¹¶é‡æ–°å»ºç«‹ä¸€ä¸ªæ–°çš„ç©ºçš„æ¡£æ¡ˆæ¥è®°å½•</p>
<p>/etc/cron.daily/logrotate è®°å½•æ¯å¤©è¦è¿›è¡Œçš„æ—¥å¿—è½®æ›¿çš„è¡Œä¸º</p>
<p>/etc/logrotate.conf</p>
<p>/etc/logrotate.d/*</p>
<p>ç¨‹åºçš„é…ç½®æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">14<span class="comment">#root@rhel6 ~]#grep -v "^#" /etc/logrotate.conf|grep -v "^$"</span></span></span><br><span class="line">weekly</span><br><span class="line">rotate 4</span><br><span class="line">create</span><br><span class="line">dateext</span><br><span class="line">include /etc/logrotate.d</span><br><span class="line">/var/log/wtmp &#123;</span><br><span class="line">monthly</span><br><span class="line">create 0664 root utmp</span><br><span class="line">minsize 1M</span><br><span class="line">rotate 1</span><br><span class="line">&#125;</span><br><span class="line">/var/log/btmp &#123;</span><br><span class="line">missingok</span><br><span class="line">monthly</span><br><span class="line">create 0600 root utmp</span><br><span class="line">rotate 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é€šè¿‡ <code>man logrotate</code> æ¥æŸ¥çœ‹æ›´å¤šçš„ä¸€äº›å®šä¹‰ã€‚</p>
<h3 id="å‚æ•°å’ŒåŠŸèƒ½"><a href="#å‚æ•°å’ŒåŠŸèƒ½" class="headerlink" title="å‚æ•°å’ŒåŠŸèƒ½"></a>å‚æ•°å’ŒåŠŸèƒ½</h3><p>compress é€šè¿‡ gzip å‹ç¼©è½¬å‚¨ä»¥åçš„æ—¥å¿—</p>
<p>nocompress ä¸éœ€è¦å‹ç¼©æ—¶,ç”¨è¿™ä¸ªå‚æ•°</p>
<p>copytruncate ç”¨äºè¿˜åœ¨æ‰“å¼€ä¸­çš„æ—¥å¿—æ–‡ä»¶,æŠŠå½“å‰æ—¥å¿—å¤‡ä»½å¹¶æˆªæ–­</p>
<p>nocopytruncate å¤‡ä»½æ—¥å¿—æ–‡ä»¶ä½†æ˜¯ä¸æˆªæ–­</p>
<p>create mode owner group è½¬å‚¨æ–‡ä»¶,ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶æ¨¡å¼åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶</p>
<p>nocreate ä¸å»ºç«‹æ–°çš„æ—¥å¿—æ–‡ä»¶</p>
<p>delaycompress å’Œ compress ä¸€èµ·ä½¿ç”¨æ—¶,è½¬å‚¨çš„æ—¥å¿—æ–‡ä»¶åˆ°ä¸‹ä¸€æ¬¡è½¬å‚¨æ—¶æ‰å‹ç¼©</p>
<p>nodelaycompress è¦†ç›– delaycompress é€‰é¡¹,è½¬å‚¨åŒæ—¶å‹ç¼©ã€‚</p>
<p>errors errors è½¬å‚¨æ—¶çš„é”™è¯¯ä¿¡æ¯å‘é€åˆ°æŒ‡å®šçš„ Email åœ°å€</p>
<p>ifempty å³ä½¿æ˜¯ç©ºæ–‡ä»¶ä¹Ÿè½¬å‚¨,è¿™ä¸ªæ˜¯ logrotate çš„ç¼ºçœé€‰é¡¹ã€‚</p>
<p>notifempty å¦‚æœæ˜¯ç©ºæ–‡ä»¶çš„è¯,ä¸è½¬å‚¨</p>
<p>mail address æŠŠè½¬å‚¨çš„æ—¥å¿—æ–‡ä»¶å‘é€åˆ°æŒ‡å®šçš„ E-mail åœ°å€</p>
<p>nomail è½¬å‚¨æ—¶ä¸å‘é€æ—¥å¿—æ–‡ä»¶</p>
<p>olddir directory è½¬å‚¨åçš„æ—¥å¿—æ–‡ä»¶æ”¾å…¥æŒ‡å®šçš„ç›®å½•,å¿…é¡»å’Œå½“å‰æ—¥å¿—æ–‡ä»¶åœ¨åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ</p>
<p>noolddir è½¬å‚¨åçš„æ—¥å¿—æ–‡ä»¶å’Œå½“å‰æ—¥å¿—æ–‡ä»¶æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹</p>
<p>prerotate/endscript åœ¨è½¬å‚¨ä»¥å‰éœ€è¦æ‰§è¡Œçš„å‘½ä»¤å¯ä»¥æ”¾å…¥è¿™ä¸ªå¯¹,è¿™ä¸¤ä¸ªå…³é”®å­—å¿…é¡»å•ç‹¬æˆè¡Œ</p>
<p>postrotate/endscript åœ¨è½¬å‚¨ä»¥åéœ€è¦æ‰§è¡Œçš„å‘½ä»¤å¯ä»¥æ”¾å…¥è¿™ä¸ªå¯¹,è¿™ä¸¤ä¸ªå…³é”®å­—å¿…é¡»å•ç‹¬æˆè¡Œ</p>
<p>daily æŒ‡å®šè½¬å‚¨å‘¨æœŸä¸ºæ¯å¤©</p>
<p>weekly æŒ‡å®šè½¬å‚¨å‘¨æœŸä¸ºæ¯å‘¨</p>
<p>monthly æŒ‡å®šè½¬å‚¨å‘¨æœŸä¸ºæ¯æœˆ</p>
<p>rotate count æŒ‡å®šæ—¥å¿—æ–‡ä»¶åˆ é™¤ä¹‹å‰è½¬å‚¨çš„æ¬¡æ•°,0 æŒ‡æ²¡æœ‰å¤‡ä»½,5 æŒ‡ä¿ç•™ 5 ä¸ªå¤‡ä»½</p>
<p>tabootext [+] list è®© logrotate ä¸è½¬å‚¨æŒ‡å®šæ‰©å±•åçš„æ–‡ä»¶,ç¼ºçœçš„æ‰©å±•åæ˜¯:.rpm-orig, .rpmsave, v, å’Œ ~</p>
<p>size size å½“æ—¥å¿—æ–‡ä»¶åˆ°è¾¾æŒ‡å®šçš„å¤§å°æ—¶æ‰è½¬å‚¨,Size å¯ä»¥æŒ‡å®š bytes (ç¼ºçœ)ä»¥åŠ KB (sizek)æˆ–è€… MB (sizem).</p>
<h3 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h3><p>è¦æ±‚:</p>
<ol>
<li>è®°å½•æ‰€æœ‰æ—¥å¿—ç±»å‹çš„ info çº§åˆ«ä»¥åŠå¤§äº info çº§åˆ«çš„ä¿¡æ¯,ä¿å­˜åˆ°/var/log/test,ä½†æ˜¯ mail<br>é‚®ä»¶ä¿¡æ¯,authpriv éªŒè¯æ–¹é¢çš„ä¿¡æ¯å’Œ cron æ—¶é—´ä»»åŠ¡ç›¸å…³çš„ä¿¡æ¯é™¤å¤–</li>
<li>/var/log/test æ—¥å¿—è½®è¯¢æ–¹å¼ä¸º:</li>
</ol>
<p>â€¢ æ¯å¤©è½®è¯¢ä¸€æ¬¡;</p>
<p>â€¢ ä¿ç•™ 4 ä¸ªæ–‡ä»¶;</p>
<p>â€¢ ä»¥æ—¶é—´å‘½å;</p>
<p>â€¢ åˆ›å»ºä¸åŸæ—¥å¿—åŒåçš„æ–°æ–‡ä»¶ã€‚</p>
<p>ç¬¬ä¸€æ­¥:ä¿®æ”¹ rsyslog çš„é…ç½®æ–‡ä»¶/etc/rsyslog.conf</p>
<p><code>*.info;mail.none;authpriv.none;cron.none</code></p>
<p>ç¬¬äºŒæ­¥:åˆ›å»ºç©ºæ–‡ä»¶/var/log/test</p>
<p><code>touch /var/log/test</code></p>
<p>ç¬¬ä¸‰æ­¥:é‡æ–°å¯åŠ¨æœåŠ¡</p>
<p><code>service rsyslog restart</code></p>
<p>ç¬¬å››æ­¥:ä¿®æ”¹ logrotate é…ç½®æ–‡ä»¶/etc/logrotate.conf</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/var/log/test &#123; &lt;== è½®å¾ªçš„æ—¥å¿—æ˜¯è°</span><br><span class="line">daily &lt;== è½®è¯¢å‘¨æœŸå¤šä¹…</span><br><span class="line">rotate 4 &lt;== ä¿ç•™å‡ ä¸ªå¸¦æ—¶é—´æˆ³çš„æ–‡ä»¶</span><br><span class="line">dateext &lt;== æ˜¯å¦ä»¥æ—¶é—´æˆ³ä¸ºæ–‡ä»¶æ›´åæ ¼å¼</span><br><span class="line">create &lt;== æ˜¯å¦éœ€è¦åˆ›å»ºä¸€ä¸ªä¸åŸæ—¥å¿—æ–‡ä»¶åŒåçš„æ–°æ–‡ä»¶</span><br></pre></td></tr></table></figure>
<p>ç¬¬äº”æ­¥:æµ‹è¯• <code>logrotate -vf /etc/logrotate.conf</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">41<span class="comment">#root@rhel6 ~]#logrotate -vf /etc/logrotate.conf</span></span></span><br><span class="line"><span class="meta">[#</span><span class="bash">42<span class="comment">#root@rhel6 ~]#ls /var/log/|grep test</span></span></span><br><span class="line">test</span><br><span class="line">test-20160630</span><br><span class="line">/var/log/test</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="è®¡åˆ’ä»»åŠ¡"><a href="#è®¡åˆ’ä»»åŠ¡" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h2><p>æ¯ä¸ªäººæˆ–å¤šç«çƒ§éƒ½æœ‰ä¸€äº›çº¦ä¼šæˆ–è€…æ˜¯å·¥ä½œ,æœ‰çš„å·¥ä½œæ˜¯ä¾‹è¡Œæ€§çš„, ä¾‹å¦‚æ¯å¹´ä¸€æ¬¡çš„åŠ è–ªã€æ¯ä¸ªæœˆä¸€æ¬¡ çš„å·¥ä½œæŠ¥å‘Šã€æ¯å‘¨ä¸€æ¬¡çš„åˆé¤ä¼šæŠ¥ã€æ¯å¤©éœ€è¦çš„æ‰“å¡ç­‰ç­‰; æœ‰çš„å·¥ä½œåˆ™æ˜¯ä¸´æ—¶å‘ç”Ÿçš„, ä¾‹å¦‚åˆšå¥½æ€»å…¬ å¸æœ‰é«˜å®˜æ¥è®¿,éœ€è¦ä½ å‡†å¤‡æ¼”ç¤ºå™¨æç­‰ç­‰! ç”¨åœ¨ç”Ÿæ´»ä¸Šé¢, ä¾‹å¦‚æ¯å¹´çš„çˆ±äººçš„ç”Ÿæ—¥ã€æ¯å¤©çš„èµ·åºŠæ—¶é—´ ç­‰ç­‰ã€è¿˜æœ‰çªå‘æ€§çš„è®¡ç®—æœºå¤§é™ä»· (å•Š!çœŸå¸Œæœ›å¤©å¤©éƒ½æœ‰!) ç­‰ç­‰å•°ã€‚</p>
<p>åƒä¸Šé¢è¿™äº›ä¾‹è¡Œæ€§å·¥ä½œ,é€šå¸¸ä½ å¾—è¦è®°å½•åœ¨æ—¥å†ä¸Šé¢æ‰èƒ½é¿å…å¿˜è®°!ä¸è¿‡, ç”±äºæˆ‘ä»¬å¸¸å¸¸åœ¨è®¡ç®—æœºå‰ é¢çš„ç¼˜æ•…,å¦‚æœè®¡ç®—æœºç³»ç»Ÿèƒ½å¤Ÿä¸»åŠ¨çš„é€šçŸ¥æˆ‘ä»¬çš„è¯,é‚£ä¹ˆä¸å°±è½»æ¾å¤šäº†!å˜¿å˜¿! è¿™ä¸ªæ—¶å€™ Linux çš„ è®¡åˆ’ä»»åŠ¡å°±å¯ä»¥æ´¾ä¸Šåœºäº†! ä¾‹å¦‚: æ¯ä¸€å¤©æ—©ä¸Š 8:00 é’Ÿè¦æœåŠ¡å™¨è¿æ¥ä¸ŠéŸ³å“,å¹¶è‡ªåŠ¨æ’­æ”¾éŸ³ä¹æ¥å”¤ä½ èµ·åºŠ; è€Œä¸­åˆ 12:00 å¸Œæœ› Linux å¯ä»¥å‘ä¸€å°ä¿¡åˆ°ä½ çš„é‚®ä»¶ä¿¡ç®±,æé†’ä½ å¯ä»¥å»åƒåˆé¤äº†; å¦å¤–, åœ¨æ¯å¹´çš„ä½ çˆ±äººç”Ÿ æ—¥çš„å‰ä¸€å¤©,å…ˆå‘å°ä¿¡æé†’ä½ , ä»¥å…å¿˜è®°è¿™ä¹ˆé‡è¦çš„ä¸€å¤©ã€‚</p>
<p>é‚£ä¹ˆ Linux çš„ä¾‹è¡Œæ€§å·¥ä½œæ˜¯å¦‚ä½•è¿›è¡Œè®¡åˆ’ä»»åŠ¡çš„å‘¢? å’± ä»¬çš„ Linux æ˜¯é€è¿‡ crontab å’Œ at è¿™ä¸¤ä¸ªä¸œè¥¿!è¿™ä¸¤ä¸ªç©æ„å„¿æœ‰å•¥å¼‚åŒ?å°±è®©æˆ‘ä»¬æ¥ç§ç§å…ˆ!</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">ä¸€æ¬¡æ€§è®¡åˆ’ä»»åŠ¡</th>
<th align="left">å‘¨æœŸæ€§è®¡åˆ’ä»»åŠ¡</th>
</tr>
</thead>
<tbody><tr>
<td align="left">è½¯ä»¶</td>
<td align="left">at-3.1.10-43.el6_2.1.x86_64</td>
<td align="left">cronie-1.4.4-12.el6.x86_64</td>
</tr>
<tr>
<td align="left">æœåŠ¡</td>
<td align="left">atd</td>
<td align="left">crond</td>
</tr>
<tr>
<td align="left">å‘½ä»¤</td>
<td align="left">at</td>
<td align="left">crontab</td>
</tr>
<tr>
<td align="left">æœåŠ¡å­˜æ”¾æ–‡ä»¶</td>
<td align="left">/etc/init.d/atd</td>
<td align="left">/etc/init.d/crond</td>
</tr>
<tr>
<td align="left">ç³»ç»Ÿé…ç½®æ–‡ä»¶</td>
<td align="left">/etc/at.deny</td>
<td align="left">/etc/cron.deny /etc/cron.d/*</td>
</tr>
<tr>
<td align="left">ç¨‹åºç¼“å­˜æ–‡ä»¶</td>
<td align="left">/var/spool/at</td>
<td align="left">/var/spool/cron/* /var/log/cron</td>
</tr>
</tbody></table>
<h3 id="at"><a href="#at" class="headerlink" title="at"></a>at</h3><p>å½“æ‰§è¡Œ at ç¨‹åºå¹¶åœ¨ç»ˆç«¯è¾“å…¥å‘½ä»¤å, é¦–å…ˆç³»ç»Ÿä¼šåˆ°é…ç½®æ–‡ä»¶ä¸­å¯»æ‰¾ at ç›¸å…³çš„æ–‡æ¡£</p>
<ul>
<li>/etc/at.allow &lt;== è®°å½•äº†å…è®¸ä½¿ç”¨ at å‘½ä»¤çš„ç”¨æˆ·å</li>
<li>/etc/at.deny &lt;== è®°å½•äº†ä¸å…è®¸ä½¿ç”¨ at å‘½ä»¤çš„ç”¨æˆ·å</li>
</ul>
<p>è‹¥ä»¥ä¸Šä¸¤ä¸ªæ–‡ä»¶éƒ½æ²¡æœ‰, åˆ™ç³»ç»Ÿé»˜è®¤åªæœ‰ root å¯ä»¥ä½¿ç”¨ at</p>
<p>è¾“å…¥çš„å†…å®¹å°†è¢«ä¿å­˜åˆ°ä»¥ä¸‹ç›®å½•ä¸­ /var/spool/at/*</p>
<h4 id="æœåŠ¡çš„å¯åŠ¨å‘½ä»¤"><a href="#æœåŠ¡çš„å¯åŠ¨å‘½ä»¤" class="headerlink" title="æœåŠ¡çš„å¯åŠ¨å‘½ä»¤"></a>æœåŠ¡çš„å¯åŠ¨å‘½ä»¤</h4><p>rhel6</p>
<p>service atd start å¯åŠ¨</p>
<p>service atd restart é‡å¯</p>
<p>service atd status æŸ¥çœ‹</p>
<p>rhel7</p>
<p>systermctl start atd</p>
<p>systermctl restart atd</p>
<p>systermctl status atd</p>
<h4 id="at-å‘½ä»¤çš„ç”¨æ³•"><a href="#at-å‘½ä»¤çš„ç”¨æ³•" class="headerlink" title="at å‘½ä»¤çš„ç”¨æ³•"></a>at å‘½ä»¤çš„ç”¨æ³•</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">at [-mldv] TIME</span><br><span class="line"></span><br><span class="line">at -c å·¥ä½œå·ç </span><br><span class="line"></span><br><span class="line">é€‰é¡¹ä¸å‚æ•° :</span><br><span class="line"></span><br><span class="line">-m å½“ at å·¥ä½œå®Œæˆå , å³ä½¿æ²¡æœ‰è¾“å‡ºè®¯æ¯ , äº¦ä»¥ email é€šçŸ¥ä½¿ç”¨è€…è¯¥å·¥ä½œå·²å®Œæˆã€‚</span><br><span class="line">-l at -l =atq, åˆ—å‡ºç›®å‰ç³»ç»Ÿä¸Šé¢çš„æ‰€æœ‰è¯¥ç”¨æˆ·çš„ at è®¡åˆ’ä»»åŠ¡ ;</span><br><span class="line">-d at -d =atrm , å¯ä»¥å–æ¶ˆä¸€ä¸ªåœ¨ at è®¡åˆ’ä»»åŠ¡ä¸­çš„å·¥ä½œ ;</span><br><span class="line">-v å¯ä»¥ä½¿ç”¨è¾ƒæ˜æ˜¾çš„æ—¶é—´æ ¼å¼æ˜¾å‡º at è®¡åˆ’ä»»åŠ¡ä¸­çš„ä»»åŠ¡åˆ—è¡¨ ;</span><br><span class="line">-c å¯ä»¥åˆ—å‡ºåé¢æ¥çš„è¯¥é¡¹å·¥ä½œçš„å®é™…æŒ‡ä»¤å†…å®¹ã€‚</span><br></pre></td></tr></table></figure>

<h4 id="èŒƒä¾‹"><a href="#èŒƒä¾‹" class="headerlink" title="èŒƒä¾‹"></a>èŒƒä¾‹</h4><ol>
<li>å†è¿‡äº”åˆ†é’Ÿå, å°† /root/.bashrc å¯„ç»™ root è‡ªå·±</li>
<li>æŸ¥çœ‹ at è®¡åˆ’ä»»åŠ¡ä¸­çš„å·¥ä½œ</li>
<li>æŸ¥çœ‹è¯¥è®¡åˆ’ä»»åŠ¡çš„å®é™…æŒ‡ä»¤å†…å®¹<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">60<span class="comment">#root@rhel6 ~]#at now + 5 minutes</span></span></span><br><span class="line"><span class="meta">at&gt;</span><span class="bash"> /bin/mail root -s <span class="string">"testing at job"</span> &lt; /root/.bashrc</span></span><br><span class="line"><span class="meta">at&gt;</span><span class="bash"> &lt;EOT&gt;</span></span><br><span class="line">job 1 at 2016-06-30 00:40</span><br><span class="line"><span class="meta">[#</span><span class="bash">61<span class="comment">#root@rhel6 ~]#at -l</span></span></span><br><span class="line">1</span><br><span class="line">2016-06-30 00:40 a root</span><br><span class="line"><span class="meta">[#</span><span class="bash">62<span class="comment">#root@rhel6 ~]#date</span></span></span><br><span class="line">Thu Jun 30 00:37:21 CST 2016</span><br><span class="line"><span class="meta">[#</span><span class="bash">63<span class="comment">#root@rhel6 ~]#at -c 1</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> atrun uid=0 gid=0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mail root 0</span></span><br><span class="line">umask 22</span><br><span class="line">.........</span><br><span class="line">æ­¤å¤„çœç•¥</span><br><span class="line">OLDPWD=/var/log; export OLDPWD</span><br><span class="line">cd /root || &#123;</span><br><span class="line">echo 'Execution directory inaccessible' &gt;&amp;2</span><br><span class="line">exit 1</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;SHELL:-/bin/sh&#125; &lt;&lt; <span class="string">'marcinDELIMITER00a5c603'</span></span></span><br><span class="line">/bin/mail root -s "testing at job" &lt; /root/.bashrc</span><br><span class="line">marcinDELIMITER00a5c6034. 2016 å¹´ 10 æœˆ 20 æ—¥ 12:00 å¹¿æ’­ä¸€æ¡ä¿¡æ¯ â€œ Happy birthday to me!â€;å–æ¶ˆè¯¥è®¡åˆ’ä»»åŠ¡ã€‚</span><br><span class="line"><span class="meta">[#</span><span class="bash">68<span class="comment">#root@rhel6 ~]#at 12:00 2016-10-20</span></span></span><br><span class="line"><span class="meta">at&gt;</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"Happy birthday to me!"</span>|wall</span></span><br><span class="line"><span class="meta">at&gt;</span><span class="bash"> &lt;EOT&gt;</span></span><br><span class="line">job 2 at 2016-10-20 12:00</span><br><span class="line"><span class="meta">[#</span><span class="bash">69<span class="comment">#root@rhel6 ~]#atq</span></span></span><br><span class="line">2</span><br><span class="line">2016-10-20 12:00 a root</span><br><span class="line"><span class="meta">[#</span><span class="bash">70<span class="comment">#root@rhel6 ~]#at -l</span></span></span><br><span class="line">2</span><br><span class="line">2016-10-20 12:00 a root</span><br><span class="line"><span class="meta">[#</span><span class="bash">71<span class="comment">#root@rhel6 ~]#at -d 2</span></span></span><br><span class="line"><span class="meta">[#</span><span class="bash">72<span class="comment">#root@rhel6 ~]#atq</span></span></span><br></pre></td></tr></table></figure></li>
<li>ç”±äºæœºæˆ¿é¢„è®¡åˆ’ 2016/07/18 åœç”µ, æˆ‘æƒ³è¦åœ¨ 2016/07/17 23:00 å…³æœº?<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">73<span class="comment">#root@rhel6 ~]#at 23:00 2016-07-17</span></span></span><br><span class="line"><span class="meta">at&gt;</span><span class="bash"> shutdown -h now</span></span><br><span class="line"><span class="meta">at&gt;</span><span class="bash"> &lt;EOT&gt;</span></span><br><span class="line">job 3 at 2016-07-17 23:00</span><br><span class="line"><span class="meta">[#</span><span class="bash">74<span class="comment">#root@rhel6 ~]#atq</span></span></span><br><span class="line">3</span><br><span class="line">2016-07-17 23:00 a root</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h3><h4 id="crontab-æœåŠ¡çš„å¯åŠ¨å‘½ä»¤"><a href="#crontab-æœåŠ¡çš„å¯åŠ¨å‘½ä»¤" class="headerlink" title="crontab æœåŠ¡çš„å¯åŠ¨å‘½ä»¤"></a>crontab æœåŠ¡çš„å¯åŠ¨å‘½ä»¤</h4><p>rhel6</p>
<p>service crond start å¯åŠ¨</p>
<p>service crond restart é‡å¯</p>
<p>service crond status æŸ¥çœ‹</p>
<p>rhel7</p>
<p>systermctl start crond</p>
<p>systermctl restart crond</p>
<p>systermctl status crond</p>
<h4 id="crontab-å‘½ä»¤çš„ç”¨æ³•"><a href="#crontab-å‘½ä»¤çš„ç”¨æ³•" class="headerlink" title="crontab å‘½ä»¤çš„ç”¨æ³•"></a>crontab å‘½ä»¤çš„ç”¨æ³•</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">crontab [-u username] [-l|-e|-r]</span><br><span class="line"></span><br><span class="line">é€‰é¡¹ä¸å‚æ•° :</span><br><span class="line">-u åªæœ‰ root ä½¿ç”¨ , äº¦å³å¸®å…¶ä»–ä½¿ç”¨è€…å»ºç«‹ / ç§»é™¤ crontab è®¡åˆ’ä»»åŠ¡;</span><br><span class="line">-e ç¼–è¾‘ crontab å·¥ä½œå†…å®¹</span><br><span class="line">-l æŸ¥é˜… crontab å·¥ä½œå†…å®¹</span><br><span class="line">-r ç§»é™¤æ‰€æœ‰ crontab çš„å·¥ä½œå†…å®¹ , è‹¥ä»…è¦ç§»é™¤ä¸€é¡¹ , è¯·ç”¨ -e å»ç¼–è¾‘</span><br></pre></td></tr></table></figure>

<p>crontab -e ç¼–è¾‘çš„æ ¼å¼è¯´æ˜:</p>
<table>
<thead>
<tr>
<th align="left">ä»£è¡¨æ„ä¹‰</th>
<th align="left">åˆ†é’Ÿ</th>
<th align="left">å°æ—¶</th>
<th align="left">æ—¥æœŸ</th>
<th align="left">æœˆä»½</th>
<th align="left">å‘¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ•°å­—èŒƒå›´</td>
<td align="left">0-59</td>
<td align="left">0-23</td>
<td align="left">1-31</td>
<td align="left">1-12</td>
<td align="left">0-7</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">ç‰¹æ®Šå­—</th>
<th align="left">ä»£è¡¨æ„ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">*( æ˜Ÿå· )</td>
<td align="left">ä»£è¡¨ä»»ä½•æ—¶åˆ»</td>
</tr>
<tr>
<td align="left">,( é€—å· )</td>
<td align="left">ä»£è¡¨åˆ†éš”æ—¶æ®µ</td>
</tr>
<tr>
<td align="left">-( å‡å· )</td>
<td align="left">ä»£è¡¨ä¸€æ®µæ—¶é—´èŒƒå›´</td>
</tr>
<tr>
<td align="left">/n( æ–œçº¿ )</td>
<td align="left">n ä»£è¡¨æ•°å­— , ã€æ¯éš” n å•ä½é—´éš”ã€ , ä¾‹å¦‚æ¯äº”åˆ†é’Ÿè¿›è¡Œä¸€æ¬¡</td>
</tr>
</tbody></table>
<p><code>man 5 crontab</code> æŸ¥çœ‹å…·ä½“ç”¨æ³•å¸®åŠ©</p>
<h4 id="èŒƒä¾‹-1"><a href="#èŒƒä¾‹-1" class="headerlink" title="èŒƒä¾‹"></a>èŒƒä¾‹</h4><ol>
<li><p>student æ¯å¤© 12 ç‚¹å‘å¹¿æ’­ç»™è‡ªå·±æé†’è¦åƒé¥­æ‹‰!</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">crontab -e</span><br><span class="line">vi ç¼–è¾‘ç”»é¢ æ¯é¡¹å·¥ä½œéƒ½æ˜¯ä¸€è¡Œã€‚</span><br><span class="line">0 12 * * * echo â€œLunch time!!!!â€|wall</span><br><span class="line">åˆ† æ—¶ æ—¥ æœˆ å‘¨ |&lt;======= å‘½ä»¤ ===========|</span><br></pre></td></tr></table></figure></li>
<li><p>æ¯ä¸ªæœˆçš„ç¬¬ä¸€å¤©ä¸‹åˆ 2 ç‚¹ 15 åˆ†,å°†/etc ç›®å½•æ‰“åŒ…å‹ç¼©æˆ/tmp/etc.tar.bz2 æ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">15 14 1 * * tar -jcf /tmp/etc.tar.bz2 /etc</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‘¨ä¸€åˆ°å‘¨äº”çš„æ™šä¸Š 10 ç‚¹,å°†/var ç›®å½•æ‰“åŒ…å‹ç¼©æˆ/tmp/var.tar.bz2 æ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">0 22 * * 1-5 tar -jcf /tmp/var.tar.bz2 /var</span><br></pre></td></tr></table></figure></li>
<li><p>æ¯å¤© 0 ç‚¹ 23 åˆ†,2 ç‚¹ 23 åˆ†,4 ç‚¹åˆ†â€¦22 ç‚¹ 23 åˆ†,å°±è¾“å‡º â€œ ä¼‘æ¯ä¸€ä¼š â€ åˆ°ç»ˆç«¯ä¸Šã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">23 0-23/2 * * * echo "have a rest"</span><br></pre></td></tr></table></figure></li>
<li><p>æ¯å‘¨æ—¥çš„ 4 ç‚¹ 5 åˆ†æé†’è‡ªå·±å»è·‘æ­¥ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">5 4 * * sun echo "run at 5 after 4 every sunday"</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="æ—¥å¿—å’Œè®¡åˆ’ä»»åŠ¡è¯¾åä½œä¸š"><a href="#æ—¥å¿—å’Œè®¡åˆ’ä»»åŠ¡è¯¾åä½œä¸š" class="headerlink" title="æ—¥å¿—å’Œè®¡åˆ’ä»»åŠ¡è¯¾åä½œä¸š"></a>æ—¥å¿—å’Œè®¡åˆ’ä»»åŠ¡è¯¾åä½œä¸š</h2><ol>
<li>è®°å½•æ‰€æœ‰æ—¥å¿—ç±»å‹çš„ info çº§åˆ«ä»¥åŠå¤§äº info çº§åˆ«çš„ä¿¡æ¯,ä¿å­˜åˆ°/var/log/test,ä½†æ˜¯ mail é‚®ä»¶ä¿¡æ¯,authpriv éªŒè¯æ–¹é¢çš„ä¿¡æ¯å’Œ cron æ—¶é—´ä»»åŠ¡ç›¸å…³çš„ä¿¡æ¯é™¤å¤–</li>
<li>/var/log/test æ—¥å¿—è½®è¯¢æ–¹å¼ä¸º:</li>
</ol>
<ul>
<li>æ¯å‘¨è½®è¯¢ä¸€æ¬¡;</li>
<li>ä¿ç•™ 6 ä¸ªæ–‡ä»¶;</li>
<li>ä»¥æ—¶é—´å‘½å;</li>
<li>åˆ›å»ºä¸åŸæ—¥å¿—åŒåçš„æ–°æ–‡ä»¶ã€‚</li>
</ul>
<hr>
<ol start="3">
<li>å†è¿‡ 10 åˆ†é’Ÿå, å°† /root/.bashrc å¯„ç»™ root è‡ªå·±</li>
<li>æŸ¥çœ‹ at è®¡åˆ’ä»»åŠ¡ä¸­çš„å·¥ä½œ</li>
<li>æŸ¥çœ‹è¯¥è®¡åˆ’ä»»åŠ¡çš„å®é™…æŒ‡ä»¤å†…å®¹</li>
<li>ç”±äºæœºæˆ¿é¢„è®¡åˆ’ 2016/09/18 åœç”µ, æˆ‘æƒ³è¦åœ¨ 2016/09/17 23:00 å…³ æœº?</li>
</ol>
<hr>
<ol>
<li>student æ¯å¤©ä¸Šåˆ 11:50 å‘å¹¿æ’­ç»™è‡ªå·±æé†’è¦åƒé¥­æ‹‰!</li>
<li>æ¯ä¸ªæœˆçš„ç¬¬ä¸€å¤©ä¸‹åˆ 5 ç‚¹ 30 åˆ†,å°†/etc ç›®å½•æ‰“åŒ…å‹ç¼©æˆ/tmp/etc.tar.bz2 æ–‡ä»¶ã€‚</li>
<li>å‘¨ä¸€åˆ°å‘¨å…­çš„æ™šä¸Š 9 ç‚¹,å°†/var ç›®å½•æ‰“åŒ…å‹ç¼©æˆ/tmp/var.tar.bz2 æ–‡ä»¶ã€‚</li>
<li>æ¯å¤© 1 ç‚¹ 22 åˆ†,3 ç‚¹ 22 åˆ†,5 ç‚¹ 22 åˆ†â€¦23 ç‚¹ 22 åˆ†,å°±è¾“å‡º â€œ ä¼‘æ¯ä¸€ä¼š â€ åˆ°ç»ˆç«¯ä¸Šã€‚</li>
<li>æ¯å‘¨å…­çš„ 6 ç‚¹ 20 åˆ†æé†’è‡ªå·±å»è·‘æ­¥ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç³»ç»ŸåŸºç¡€åŸ¹è®­</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux å¼€æœºå¯åŠ¨æµç¨‹</title>
    <url>/2016/12/22/booboo_linux_base/10-Linux%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="å¯åŠ¨æµç¨‹æ¦‚è§ˆ"><a href="#å¯åŠ¨æµç¨‹æ¦‚è§ˆ" class="headerlink" title="å¯åŠ¨æµç¨‹æ¦‚è§ˆ"></a>å¯åŠ¨æµç¨‹æ¦‚è§ˆ</h2><ol>
<li>åŠ è½½ BIOS çš„ç¡¬ä»¶ä¿¡æ¯å¹¶è‡ªæˆ‘æµ‹è¯• , ä¾æ®è®¾å®šå–å¾—ç¬¬ä¸€ä¸ªå¯å¼€æœºçš„è£…ç½® ;</li>
<li>è¯»å–å¹¶æ‰§è¡Œç¬¬ä¸€ä¸ªå¼€æœºè£…ç½®å†… MBR çš„ boot Loader ( grub, spfdisk ç­‰ç¨‹åº );</li>
<li>ä¾æ® boot loader çš„è®¾å®šåŠ è½½ Kernel</li>
<li>Kernel ä¼šå¼€å§‹ä¾¦æµ‹ç¡¬ä»¶å¹¶åŠ è½½é©±åŠ¨ç¨‹åº ;</li>
<li>åœ¨ç¡¬ä»¶é©±åŠ¨æˆåŠŸå ,Kernel ä¼šä¸»åŠ¨å‘¼å« init ç¨‹åº</li>
<li>init ä¼šå–å¾— run-level ä¿¡æ¯ ;</li>
<li>init æ‰§è¡Œ /etc/rc.d/rc.sysinit æ¡£æ¡ˆæ¥å‡†å¤‡è½¯ä»¶æ‰§è¡Œçš„ä½œä¸šç¯å¢ƒ ( å¦‚ç½‘ç»œã€æ—¶åŒºç­‰ );</li>
<li>init æ‰§è¡Œ run-level çš„å„ä¸ªæœåŠ¡çš„å¯åŠ¨ (script æ–¹å¼ );</li>
<li>init æ‰§è¡Œ /etc/rc.d/rc.local æ¡£æ¡ˆ ;</li>
<li>init æ‰§è¡Œç»ˆç«¯ä»¿çœŸç¨‹åº mingetty æ¥å¯åŠ¨ login ç¨‹åº ,</li>
<li>æœ€åç­‰å¾…ç”¨æˆ·ç™»å…¥</li>
</ol>
<h2 id="è¯¦ç»†è®²è§£"><a href="#è¯¦ç»†è®²è§£" class="headerlink" title="è¯¦ç»†è®²è§£"></a>è¯¦ç»†è®²è§£</h2><h3 id="å¼€æœºè½¯ä»¶-â€”â€”-BIOSã€Grub"><a href="#å¼€æœºè½¯ä»¶-â€”â€”-BIOSã€Grub" class="headerlink" title="å¼€æœºè½¯ä»¶ â€”â€” BIOSã€Grub"></a>å¼€æœºè½¯ä»¶ â€”â€” BIOSã€Grub</h3><p><img src="pic/33.png" alt="33"></p>
<h4 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h4><ol>
<li>BIOS ä¸€ä¸ªå†™å…¥åˆ°ä¸»æ¿ä¸Šçš„ä¸€ä¸ªè½¯ä»¶ç¨‹åº,åœ¨å¼€æœºçš„æ—¶å€™,è®¡ç®—æœºç³»ç»Ÿä¼šä¸»åŠ¨æ‰§è¡Œç¬¬ä¸€ä¸ªç¨‹åº</li>
<li>HD ç¡¬ç›˜</li>
<li>MBR ä¸»è¦å¯åŠ¨è®°å½•åŒº(Master Boot Record)è¯¥ç¡¬ç›˜é‡Œçš„ç¬¬ä¸€ä¸ªæ‰‡åŒº 512 bytes</li>
<li>boot loader å¼€æœºç®¡ç†ç¨‹åº,å¯è¯»å–æ ¸å¿ƒæ–‡ä»¶å¹¶æ‰§è¡Œ 446 bytes</li>
<li>DPT ç£ç›˜åˆ†å‰²è¡¨(disk partition table)è®°å½•æ•´é¢—ç¡¬ç›˜åˆ†å‰²çŠ¶æ€ 64 bytes</li>
<li>55AA 2 bytes</li>
</ol>
<h4 id="æµç¨‹è§£é‡Š"><a href="#æµç¨‹è§£é‡Š" class="headerlink" title="æµç¨‹è§£é‡Š"></a>æµç¨‹è§£é‡Š</h4><ul>
<li>é€šç”µå,æœåŠ¡å™¨ä¸»ç‰ˆä¸Šçš„ä¸€ä¸ªè½¯ä»¶ BIOS å¯åŠ¨,ä»–çš„ä»»åŠ¡å°±æ˜¯æ‰¾åˆ°å¸¦æœ‰å¼€æœºç¨‹åºçš„è®¾å¤‡,æ­¤å¤„ä»¥ç¡¬ç›˜ä¸ºä¾‹, BIOS çš„ä»»åŠ¡ç»“æŸ;</li>
<li>è¯¥ç¡¬ç›˜ä¸Šçš„ç¬¬ä¸€ä¸ªæ‰‡åŒºä¸­æœ‰ä¸€ä¸ªå¼€æœºç®¡ç†ç¨‹åº, rhel6 ä¸Šä¸º grub1 , rhel7 ä¸Šä¸º grub2 ,ç‰ˆæœ¬ä¸åŒ;</li>
<li>æ¥ä¸‹å»å°±æ˜¯ grub åœ¨å·¥ä½œäº†ã€‚</li>
</ul>
<h4 id="BIOS"><a href="#BIOS" class="headerlink" title="BIOS"></a>BIOS</h4><p><em>å¼€æœºæ—¶æŒ‰ä¸‹ pause break æš‚åœä¸­æ–­,å¯ä»¥çœ‹åˆ° bios çš„å¤§æ¦‚ä¿¡æ¯:</em></p>
<p><img src="pic/34.png" alt="34"></p>
<p>AMIBIOS(C)2006 American Megatrends, Inc.</p>
<p>åŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿçš„ç‰ˆæœ¬ä¸º AMIBIOS ,ä¸ºç¾å›½è¶‹åŠ¿ç§‘æŠ€</p>
<p>2006 å¹´ç”Ÿäº§</p>
<p>HP System BIOS â€“ 033 (09/01/2011)</p>
<p>æƒ æ™®ç³»ç»Ÿçš„åŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿ,æ”¯æŒåˆ° 2011/01/09 çš„ç¡¬ä»¶</p>
<p>Processor 1 Initiallized at 2.26 GHz with 8 MB cache</p>
<p>å¤„ç†å™¨ cpu ä¸€ä¸ª,é¢‘ç‡ä¸º 2.26GHz , 8M ç¼“å†²</p>
<p>16384MB Total Memory Detected</p>
<p>16G å†…å­˜</p>
<p>Asset Tag : 0111049</p>
<p>èµ„äº§ç¼–å·ä¸º 0111049</p>
<p>BMC Firmware Version 04.04(Jul/01/2009)</p>
<p>BMC SDR Version : 2.18.1.17</p>
<p>basebiard management controller åº•æ¿ç®¡ç†æ§åˆ¶å™¨çš„ç¼©å†™,æ—¶ä¸€ä¸ªåœ¨ IPMI ç»“æ„ä¸‹æä¾›æ™ºèƒ½ç®¡ç†çš„æ§åˆ¶å™¨</p>
<p>IPMI æ—¶æ™ºèƒ½å¹³å°ç®¡ç†ç•Œé¢,å³ä¸ intel ç»“æ„çš„ä¼ä¸šç³»ç»Ÿä¸­æ‰€ä½¿ç”¨å¤–å›´è®¾å¤‡é‡‡ç”¨çš„ä¸€ç§å·¥ä¸šæ ‡å‡†ã€‚</p>
<p>USB Device(s) : 1 Keyboard , 1 Mouse</p>
<p>usb è®¾å¤‡æœ‰ä¸€ä¸ªé¼ æ ‡ä¸€ä¸ªé”®ç›˜,æ­¤å¤„å¯ä»¥æŸ¥çœ‹æ˜¯å¦æœ‰äººæ¶æ„ç”¨ usb è®¾å¤‡è¦æ”»å‡»æœåŠ¡å™¨</p>
<p>Auto-Detecting AHCI PORT 1 .. IDE Hard Disk è‡ªåŠ¨æ£€æµ‹</p>
<p><em>å¼€æœºæŒ‰ä¸‹ F10 ,è¿›å…¥ BIOS ç®¡ç†ç•Œé¢</em></p>
<p><img src="pic/35.png" alt="35"></p>
<p><img src="pic/36.png" alt="36"></p>
<p><em>IPMI</em></p>
<p>HP æœåŠ¡å™¨è¿œç¨‹ç®¡ç†å¹³å°</p>
<p><img src="pic/37.png" alt="37"></p>
<p><img src="pic/38.png" alt="38"></p>
<h3 id="å¼€æœºæ–‡æ¡£-â€”â€”-menu-lstã€grub-conf"><a href="#å¼€æœºæ–‡æ¡£-â€”â€”-menu-lstã€grub-conf" class="headerlink" title="å¼€æœºæ–‡æ¡£ â€”â€” menu.lstã€grub.conf"></a>å¼€æœºæ–‡æ¡£ â€”â€” menu.lstã€grub.conf</h3><h4 id="Grub-é…ç½®æ–‡æ¡£"><a href="#Grub-é…ç½®æ–‡æ¡£" class="headerlink" title="Grub é…ç½®æ–‡æ¡£"></a>Grub é…ç½®æ–‡æ¡£</h4><ul>
<li>menu.lst</li>
<li>grub.conf</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 grub]# ll /boot/grub/</span><br><span class="line">total 274</span><br><span class="line">-rw-r--r--. 1 root root 63 Jul 2 2015 device.map</span><br><span class="line">-rw-r--r--. 1 root root 13380 Jul 2 2015 e2fs_stage1_5</span><br><span class="line">-rw-r--r--. 1 root root 12620 Jul 2 2015 fat_stage1_5</span><br><span class="line">-rw-r--r--. 1 root root 11748 Jul 2 2015 ffs_stage1_5</span><br><span class="line">-rw-------. 1 root root 796 Jul 2 2015 grub.conf</span><br><span class="line">-rw-r--r--. 1 root root 11756 Jul 2 2015 iso9660_stage1_5</span><br><span class="line">-rw-r--r--. 1 root root 13268 Jul 2 2015 jfs_stage1_5</span><br><span class="line">lrwxrwxrwx. 1 root root 11 Jul 2 2015 menu.lst -&gt; ./grub.conf</span><br><span class="line">-rw-r--r--. 1 root root 11956 Jul 2 2015 minix_stage1_5</span><br><span class="line">-rw-r--r--. 1 root root 14412 Jul 2 2015 reiserfs_stage1_5</span><br><span class="line">-rw-r--r--. 1 root root 1341 May 7 2010 splash.xpm.gz</span><br><span class="line">-rw-r--r--. 1 root root 512 Jul 2 2015 stage1</span><br><span class="line">-rw-r--r--. 1 root root 126100 Jul 2 2015 stage2</span><br><span class="line">-rw-r--r--. 1 root root 12024 Jul 2 2015 ufs2_stage1_5</span><br><span class="line">-rw-r--r--. 1 root root 11364 Jul 2 2015 vstafs_stage1_5</span><br><span class="line">-rw-r--r--. 1 root root 13964 Jul 2 2015 xfs_stage1_5</span><br><span class="line">[root@rhel6 grub]# vim grub.conf</span><br><span class="line">default=0		===&gt;é»˜è®¤èœå•</span><br><span class="line">timeout=5		===&gt;å¯åŠ¨èœå•è¶…æ—¶5ç§’è¿›å…¥é»˜è®¤å¯åŠ¨å†…æ ¸</span><br><span class="line">splashimage=(hd0,0)/grub/splash.xpm.gz	===&gt;èœå•çš„èƒŒæ™¯å›¾ç‰‡ä½ç½®</span><br><span class="line">hiddenmenu		===&gt;é»˜è®¤ä¸çœ‹å¯åŠ¨èœå•</span><br><span class="line">title Red Hat Enterprise Linux (2.6.32-431.el6.x86_64)</span><br><span class="line">å¼€æœºå¯åŠ¨çš„ç³»ç»Ÿåç§°(å¯ä»¥æ›´æ”¹å¯¹å…¶ä»–æ²¡æœ‰å½±å“),æŒ‡å®šå¯åŠ¨ç¡¬ç›˜ä½ç½®åœ¨ç¬¬ä¸€ä¸ªç¡¬ç›˜çš„ç¬¬ä¸€ä¸ªåˆ†åŒº</span><br><span class="line">root (hd0,0)</span><br><span class="line">æŒ‡å®šæ ¸å¿ƒæ–‡ä»¶çš„åç§°åŠä½ç½® /boot/ ,æŒ‡å®šè¯­è¨€ç­‰ç­‰</span><br><span class="line">kernel /vmlinuz-2.6.32-431.el6.x86_64 ro root=/dev/mapper/vg_rhel6-LogVol01 rd_NO_LUKS</span><br><span class="line">LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 KEYBOARDTYPE=pc</span><br><span class="line">KEYTABLE=us rd_LVM_LV=vg_rhel6/LogVol01 rd_NO_DM rhgb quiet</span><br><span class="line">æŒ‡å®šæ ¸å¿ƒåŠ è½½çš„æ¨¡å—æ–‡ä»¶ /boot/</span><br><span class="line">initrd /initramfs-2.6.32-431.el6.x86_64.img</span><br></pre></td></tr></table></figure>

<h4 id="æµç¨‹è§£é‡Š-1"><a href="#æµç¨‹è§£é‡Š-1" class="headerlink" title="æµç¨‹è§£é‡Š"></a>æµç¨‹è§£é‡Š</h4><ul>
<li>grub è½¯ä»¶çš„ä»»åŠ¡å°±æ˜¯æ‰¾åˆ°æ ¸å¿ƒæ–‡ä»¶,å¹¶åŠ è½½è¯¥æ–‡ä»¶</li>
<li>å†…æ ¸çš„ç¬¬ä¸€ä»»åŠ¡å°±æ˜¯é©±åŠ¨ç¡¬ä»¶</li>
<li>å†…æ ¸ç¬¬äºŒä»»åŠ¡å°±æ˜¯å‘¼å« init ç¨‹åº,æ¥ä¸‹æ¥å°±äº¤ç»™ init äº†</li>
</ul>
<h3 id="init-ç¨‹åº"><a href="#init-ç¨‹åº" class="headerlink" title="init ç¨‹åº"></a>init ç¨‹åº</h3><h4 id="æµç¨‹è§£é‡Š-2"><a href="#æµç¨‹è§£é‡Š-2" class="headerlink" title="æµç¨‹è§£é‡Š"></a>æµç¨‹è§£é‡Š</h4><ul>
<li>init ç¨‹åºæŒ‚æ¥ /etc å’Œ /lib æ‰€åœ¨çš„ç›®å½•åˆ†åŒº</li>
<li>æ‰§è¡Œ /etc/inittab æ–‡ä»¶,å–å¾— run-level ä¿¡æ¯,åˆ¤æ–­æ˜¯å¦å¼€å¯ç»ˆç«¯ã€ç½‘ç»œç­‰</li>
<li>æ‰§è¡Œ /etc/rc.d/rc.sysinit åˆå§‹åŒ–ç¯å¢ƒ ( å¦‚ç½‘ç»œã€æ—¶åŒºç­‰ )</li>
<li>æ‰§è¡Œ run-level çš„å„ä¸ªæœåŠ¡çš„å¯åŠ¨ (script æ–¹å¼ );</li>
<li>æ‰§è¡Œ /etc/rc.d/rc.local æ¡£æ¡ˆ</li>
<li>æ‰§è¡Œç»ˆç«¯ä»¿çœŸç¨‹åº mingetty æ¥å¯åŠ¨ login ç¨‹åº,æœ€åç­‰å¾…ç”¨æˆ·ç™»å…¥</li>
</ul>
<h4 id="init-æ‰§è¡Œçš„ç›¸å…³æ–‡ä»¶"><a href="#init-æ‰§è¡Œçš„ç›¸å…³æ–‡ä»¶" class="headerlink" title="init æ‰§è¡Œçš„ç›¸å…³æ–‡ä»¶"></a>init æ‰§è¡Œçš„ç›¸å…³æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# cat /etc/inittab</span><br><span class="line"><span class="meta">#</span><span class="bash"> Default runlevel. The runlevels used are:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 0 - halt (Do NOT <span class="built_in">set</span> initdefault to this)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1 - Single user mode</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2 - Multiuser, without NFS (The same as 3, <span class="keyword">if</span> you <span class="keyword">do</span> not have networking)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3 - Full multiuser mode</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4 - unused</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5 - X11</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6 - reboot (Do NOT <span class="built_in">set</span> initdefault to this)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line">id:5:initdefault:		===&gt;é»˜è®¤å¯åŠ¨ç­‰çº§(run-level)ä¸º5(ä¸­é—´çš„æ•°å­—ä¸ºå¯åŠ¨ç­‰çº§)</span><br><span class="line">[root@rhel6 etc]# ll /etc/rc.d	===&gt;æ ¹æ®é»˜è®¤å¯åŠ¨ç­‰çº§ï¼Œæ¥è¯»å–ç›¸åº”çš„rc0-6.dç›®å½•ä¸­çš„æ–‡ä»¶</span><br><span class="line">total 60</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Jul 2 2015 init.d</span><br><span class="line">-rwxr-xr-x. 1 root root 2617 Oct 10 2013 rc</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Jul 2 2015 rc0.d</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Jul 2 2015 rc1.d</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Jul 2 2015 rc2.d</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Jul 2 2015 rc3.d</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Jul 2 2015 rc4.d</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Jul 2 2015 rc5.d</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Jul 2 2015 rc6.d</span><br><span class="line">-rwxr-xr-x. 1 root root 220 Oct 10 2013 rc.local</span><br><span class="line">-rwxr-xr-x. 1 root root 19432 Oct 10 2013 rc.sysinit</span><br></pre></td></tr></table></figure>

<p>æ–‡ä»¶å¤¹é‡Œéƒ½æ˜¯è½¯è¿æ¥ï¼Œè½¯é“¾æ¥é“¾æ¥åˆ°/etc/rc.d/init.dç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œç›®å½•ä¸‹éƒ½æ˜¯æœåŠ¡çš„å¯åŠ¨è„šæœ¬ï¼Œç›®å½•å’Œetc/init.dä¸‹çš„å†…å®¹ä¸€æ ·ï¼Œå› ä¸ºæœ‰ä¸ªè½¯è¿æ¥åœ¨etcä¸‹é¢rcX.dä¸‹çš„æ–‡ä»¶Kå¼€å¤´è¡¨ç¤ºæœåŠ¡è¦å…³é—­çš„ï¼ŒSå¼€å¤´çš„è¡¨ç¤ºç³»ç»Ÿå¯åŠ¨æ—¶è¦å¼€å¯çš„ï¼Œï¼ˆä¾‹å¦‚rc0.dä¸‹ï¼Œå‡ ä¹éƒ½æ˜¯Kæ‰“å¤´çš„ï¼‰ï¼Œåœ¨5é‡Œåé¢çš„æ•°å­—æ ‡ç¤ºä¼˜å…ˆçº§ï¼Œæ•°å­—å°ä¼˜å…ˆçº§é«˜ï¼Œåœ¨6é‡Œè¿™äº›æ•°å­—æ— ç”¨ï¼Œå› ä¸ºæ˜¯å¹¶è¡Œçš„ï¼Œæ²¡æœ‰ä¾èµ–å…³ç³»ã€‚</p>
<p>æ— è®ºæ˜¯3è¿˜æ˜¯5çš„runlevelï¼Œæœ€åéƒ½ä¼šè¯»åˆ°S99localæ–‡ä»¶ï¼Œé“¾æ¥åˆ°/etc/rc.d/rc.localæ–‡ä»¶</p>
<p>æ–‡ä»¶è¯´æ˜ï¼šè¿™ä¸ªè„šæœ¬åœ¨æ‰€æœ‰è„šæœ¬æ‰§è¡Œå®Œä¹‹åæ‰§è¡Œï¼Œå¼€æœºè¿‡ç¨‹æ±‡æ€»æœ€åè¯»åˆ°çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯å¼€æœºè‡ªå®šä¹‰å¯åŠ¨è„šæœ¬ï¼ŒæŠŠè‡ªå·±æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤å†™è¿›æ¥ã€‚ç³»ç»Ÿå¯åŠ¨å‘½ä»¤ä¹Ÿä¼šå®Œæˆã€‚</p>
<p>å¤‡æ³¨:ä»¥ä¸Šåˆ†æå‡ä¸º rhel6 æ“ä½œç³»ç»Ÿ, rhel7 å¯åŠ¨æ”¹ä¸º systemd æ¨¡å¼,ç›¸å…³æ–‡ä»¶åœ¨ <code>/usr/lib/systemd/system/*</code></p>
<h3 id="run-level-å¯åŠ¨ç­‰çº§"><a href="#run-level-å¯åŠ¨ç­‰çº§" class="headerlink" title="run-level(å¯åŠ¨ç­‰çº§)"></a>run-level(å¯åŠ¨ç­‰çº§)</h3><p>Runlevel 0 æ˜¯è®©initå…³é—­æ‰€æœ‰è¿›ç¨‹å¹¶ç»ˆæ­¢ç³»ç»Ÿã€‚</p>
<p>Runlevel 1 æ˜¯ç”¨æ¥å°†ç³»ç»Ÿè½¬åˆ°å•ç”¨æˆ·æ¨¡å¼ï¼Œå•ç”¨æˆ·æ¨¡å¼åªèƒ½æœ‰ç³»ç»Ÿç®¡ç†å‘˜è¿›å…¥ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹å¤„ç†é‚£äº›åœ¨æœ‰ç™»å½•ç”¨æˆ·çš„æƒ…å†µä¸‹ä¸èƒ½è¿›è¡Œæ›´æ”¹çš„æ–‡ä»¶ã€‚</p>
<p>Runlevel 2 æ˜¯å…è®¸ç³»ç»Ÿè¿›å…¥å¤šç”¨æˆ·çš„æ¨¡å¼ï¼Œä½†å¹¶ä¸æ”¯æŒæ–‡ä»¶å…±äº«ï¼Œè¿™ç§æ¨¡å¼å¾ˆå°‘åº”ç”¨ã€‚</p>
<p>Runlevel 3 æ˜¯æœ€å¸¸ç”¨çš„è¿è¡Œæ¨¡å¼ï¼Œä¸»è¦ç”¨æ¥æä¾›çœŸæ­£çš„å¤šç”¨æˆ·æ¨¡å¼ï¼Œä¹Ÿæ˜¯å¤šæ•°æœåŠ¡å™¨çš„ç¼ºçœæ¨¡å¼ã€‚</p>
<p>Runlevel 4 ä¸€èˆ¬ä¸è¢«ç³»ç»Ÿä½¿ç”¨ï¼Œç”¨æˆ·å¯ä»¥è®¾è®¡è‡ªå·±çš„ç³»ç»ŸçŠ¶æ€å¹¶å°†å…¶åº”ç”¨åˆ°runlevel 4é˜¶æ®µï¼Œå°½ç®¡å¾ˆå°‘ä½¿ç”¨ï¼Œä½†ä½¿ç”¨è¯¥ç³»ç»Ÿå¯ä»¥å®ç°ä¸€äº›ç‰¹å®šçš„ç™»å½•è¯·æ±‚ã€‚</p>
<p>Runlevel 5 æ˜¯å°†ç³»ç»Ÿåˆå§‹åŒ–ä¸ºä¸“ç”¨çš„X Windowç»ˆç«¯ã€‚å¯¹åŠŸèƒ½å¼ºå¤§çš„Linuxç³»ç»Ÿæ¥è¯´ï¼Œè¿™å¹¶ä¸æ˜¯å¥½çš„é€‰æ‹©ï¼Œä½†ç”¨æˆ·å¦‚æœéœ€è¦è¿™æ ·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åœ¨runlevelå¯åŠ¨æ¥å®ç°è¯¥æ–¹æ¡ˆã€‚</p>
<p>Runlevel 6 æ˜¯å…³é—­æ‰€æœ‰è¿è¡Œçš„è¿›ç¨‹å¹¶é‡æ–°å¯åŠ¨ç³»ç»Ÿã€‚</p>
<h2 id="ç›¸å…³çš„å‘½ä»¤"><a href="#ç›¸å…³çš„å‘½ä»¤" class="headerlink" title="ç›¸å…³çš„å‘½ä»¤"></a>ç›¸å…³çš„å‘½ä»¤</h2><p>rhel6</p>
<p>chkconfig â€“list    ===&gt;æŸ¥çœ‹ä¸åŒç­‰çº§ä¸­å„é¡¹æœåŠ¡çš„å¯åŠ¨æƒ…å†µ(å¼€æœºå¯åŠ¨é¡¹)</p>
<p>chkconfig æœåŠ¡å on    ===&gt;å¼€å¯æŸä¸ªæœåŠ¡å¼€æœºè‡ªå¯åŠ¨ï¼Œoffä»£è¡¨å…³é—­</p>
<p>chkconfig â€“level 35 æœåŠ¡å off    ===&gt;åœ¨å¯åŠ¨ç­‰çº§ä¸º3å’Œ5çš„æ—¶å€™è¯¥æœåŠ¡ä¸å¼€æœºå¯åŠ¨</p>
<p>rhel7</p>
<p>å¼€æœºè‡ªå¯çš„æœåŠ¡é€šè¿‡systemctl enableå‘½ä»¤æ¥å®ç°</p>
<p>Systemctl enable httpd    ===&gt;è‡ªå¯åŠ¨httpdæœåŠ¡ï¼Œå…³é—­ä½¿ç”¨disableã€‚</p>
<p>systemctl get-default        ===&gt;æŸ¥çœ‹å½“å‰é»˜è®¤å¯åŠ¨çº§åˆ«(å¯åŠ¨çº§åˆ«çš„è¯´æ˜æŸ¥çœ‹/etc/inittab)</p>
<p>systemctl set-default multi-user.target    ===&gt;è®¾ç½®é»˜è®¤å¯åŠ¨çº§åˆ«ä¸º3(7çš„çš„å¯åŠ¨çº§åˆ«åç§°æœ‰æ‰€å˜åŒ–)</p>
<h2 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h2><h3 id="rhel6-å•ç”¨æˆ·æ¨¡å¼ä¿®æ”¹å¯†ç "><a href="#rhel6-å•ç”¨æˆ·æ¨¡å¼ä¿®æ”¹å¯†ç " class="headerlink" title="rhel6 å•ç”¨æˆ·æ¨¡å¼ä¿®æ”¹å¯†ç "></a>rhel6 å•ç”¨æˆ·æ¨¡å¼ä¿®æ”¹å¯†ç </h3><ul>
<li>1&gt; è¿›å…¥åˆ°æ•°åŠæ—¶ç•Œé¢æ—¶,æŒ‰ä¸Šä¸‹é”®è¿›å…¥ä»¥ä¸‹ç•Œé¢,é€‰æ‹© kernel ä¸€è¡Œ,æŒ‰ä¸‹ e è¿›è¡Œç¼–è¾‘</li>
<li>2&gt; åœ¨æœ€åè¿½åŠ  â€œç©ºæ ¼â€å’Œ1 æˆ–è€… â€œç©ºæ ¼â€ single å,æŒ‰ä¸‹ esc</li>
<li>3&gt; å†æŒ‰ä¸‹ b ,å¯åŠ¨å,è¿›å…¥å•äººæ¨¡å¼å,è¾“å…¥ passwd è¿›è¡Œå¯†ç ä¿®æ”¹,ä¿®æ”¹å®Œæˆå, reboot å³å¯ã€‚</li>
</ul>
<p><img src="pic/39.png" alt="39"></p>
<p><img src="pic/40.png" alt="40"></p>
<p><img src="pic/41.png" alt="41"></p>
<h3 id="rhel7-å•ç”¨æˆ·æ¨¡å¼ä¿®æ”¹å¯†ç "><a href="#rhel7-å•ç”¨æˆ·æ¨¡å¼ä¿®æ”¹å¯†ç " class="headerlink" title="rhel7 å•ç”¨æˆ·æ¨¡å¼ä¿®æ”¹å¯†ç "></a>rhel7 å•ç”¨æˆ·æ¨¡å¼ä¿®æ”¹å¯†ç </h3><ul>
<li>1&gt; è¿›å…¥å¦‚ä¸‹ç•Œé¢åæŒ‰ e è¿›å…¥ç¼–è¾‘æ¨¡å¼</li>
<li>2&gt; æ‰¾åˆ° linux16 å¼€å§‹çš„é‚£ä¸€è¡Œ,åˆ é™¤æ²¡ç”¨çš„,åœ¨æœ€åè¿½åŠ  rd.break ,ç„¶åæŒ‰ Ctrl+x é‡å¯å³å¯è¿›å…¥å•äººæ¨¡å¼</li>
<li>3&gt; è¿›å…¥å•ç”¨æˆ·æ¨¡å¼å,ç”¨ mount å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹,ä¼šå‘ç°æ ¹ç›®å½•æ—¶åªè¯»æ¨¡å¼,å› æ­¤éœ€è¦é‡æ–°æŒ‚è½½ä¸ºè¯»å†™æ¨¡å¼</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mount -o remount,rw /sysroot</span><br><span class="line">chroot /sysroot		===&gt;æé«˜æƒé™</span><br><span class="line">passwd				===&gt;ä¿®æ”¹å¯†ç çš„å‘½ä»¤</span><br><span class="line">touch /.autorelabel ===&gt;autorelabel è‡ªåŠ¨é‡æ–°æ ‡è®°, selinux</span><br><span class="line">exit</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<p><img src="pic/42.png" alt="42"></p>
<p><img src="pic/43.png" alt="43"></p>
<p>###rhel6 GRUBèœå•åŠ å¯†</p>
<p>grub-md5-crypt</p>
<p>è¾“å…¥å¯†ç ï¼Œç”Ÿæˆä¸€ä¸²MD5å€¼ï¼Œè¿™ä¸ªå°±æ˜¯grubå¯†ç ï¼Œå¤åˆ¶å¥½è¿™æ®µå†…å®¹ï¼Œç²˜è´´åˆ°é…ç½®æ–‡ä»¶ä¸­</p>
<p>vim /boot/grub/grub.conf   </p>
<p>titleé‚£ä¸€è¡Œçš„ä¸Šé¢åŠ ä¸Šâ€œpassword redhatâ€è¿™æ ·åšæ˜¯æ˜æ–‡å¯†ç ï¼Œä¸å®‰å…¨ï¼Œæ‰€ä»¥ä¹Ÿå¯å†™ä¸ºâ€œpassword â€“-md5 xxxxxxxxxâ€</p>
<p>è¿™ä¸€è¡Œè¦æ”¾åœ¨titleçš„ä¸Šé¢</p>
<p>æ”¾åœ¨titleçš„ä¸‹é¢æ˜¯ç³»ç»Ÿå¯åŠ¨éœ€è¦å¯†ç æ‰å¯ä»¥å¯åŠ¨</p>
<h3 id="rhel7-GRUB2èœå•åŠ å¯†"><a href="#rhel7-GRUB2èœå•åŠ å¯†" class="headerlink" title="rhel7 GRUB2èœå•åŠ å¯†"></a>rhel7 GRUB2èœå•åŠ å¯†</h3><p>vim /etc/grub.d/40_custom</p>
<p>set superusers=â€rootâ€        ===&gt;è®¾ç½®è¶…çº§ç”¨æˆ·çš„åç§°ï¼Œæ³¨æ„ï¼šåç§°ä»»æ„å¯ä»¥ä¸ç”¨æ˜¯ç³»ç»Ÿä¸­å­˜åœ¨çš„ç”¨æˆ·</p>
<p>password root redhat            ===&gt;è®¾ç½®ç”¨æˆ·åå’Œå¯†ç ï¼Œæ³¨æ„ï¼šè¯¥å¯†ç ä¸ºæ˜æ–‡ï¼Œå¦‚æœéœ€è¦å¯†æ–‡éœ€è¦ç”Ÿæˆå¯†æ–‡å¯†ç </p>
<p>ä¿å­˜é€€å‡º</p>
<p>grub2-mkconfig -o /boot/grub2/grub.cfg        ===&gt;ä½¿ç”¨è¯¥å‘½ä»¤æ¥é‡æ–°ç”Ÿæˆgrub.cfgæ–‡ä»¶æ¥ä½¿é…ç½®ç”Ÿæ•ˆ</p>
<p>grub2-mkpasswd-pbkdf2    ===&gt;è¯¥å‘½ä»¤ä¸ºç”ŸæˆåŠ å¯†å¯†ç </p>
<p>password_pbkdf2         ===&gt;å¦‚æœä½¿ç”¨åŠ å¯†çš„å¯†æ–‡éœ€è¦å®šä¹‰å¯†ç çš„åŠ å¯†æ–¹å¼ï¼Œåé¢åŒä¸Šè·Ÿä¸Šç”¨æˆ·åå’ŒåŠ å¯†åçš„å¯†ç </p>
<h2 id="Linux-å¼€æœºå¯åŠ¨æµç¨‹è¯¾åä½œä¸š"><a href="#Linux-å¼€æœºå¯åŠ¨æµç¨‹è¯¾åä½œä¸š" class="headerlink" title="Linux å¼€æœºå¯åŠ¨æµç¨‹è¯¾åä½œä¸š"></a>Linux å¼€æœºå¯åŠ¨æµç¨‹è¯¾åä½œä¸š</h2><ol>
<li>åè¯è§£é‡Š</li>
</ol>
<p>BIOS</p>
<p>MBR</p>
<p>boot loader</p>
<p>grub</p>
<p>DPT</p>
<p>55AA</p>
<ol start="2">
<li>è¯·è‡ªå·±æè¿° linux å¼€æœºå¯åŠ¨çš„æµç¨‹,å¹¶ç”»å‡ºæµç¨‹å›¾ã€‚</li>
<li>linux ç ´è§£ root å¯†ç </li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç³»ç»ŸåŸºç¡€åŸ¹è®­</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux SELINUX</title>
    <url>/2016/12/22/booboo_linux_base/12-SELINUX/</url>
    <content><![CDATA[<h2 id="SELinux"><a href="#SELinux" class="headerlink" title="SELinux"></a>SELinux</h2><p>Security Enhanced Linux å®‰å…¨å¼ºåŒ–çš„ Linux</p>
<h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><p>å¼ºåˆ¶é™åˆ¶æŸäº›æ“ä½œ , å±äºæƒé™çš„ä¸€ç§</p>
<p>æ€è€ƒ : åˆ°ç›®å‰ä¸ºæ­¢å­¦è¿‡çš„ linux ä¸­çš„æƒé™ ?</p>
<p>u\g\o r\w\x ssid\sgid\stid acl attr</p>
<h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>/etc/selinux/config</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">15<span class="comment">#root@rhel6 ~]#ll /etc/selinux/config</span></span></span><br><span class="line">-rw-r--r--. 1 root root 458 Jul 2 2015 /etc/selinux/config</span><br><span class="line"><span class="meta">[#</span><span class="bash">16<span class="comment">#root@rhel6 ~]#ll /etc/sysconfig/selinux</span></span></span><br><span class="line">lrwxrwxrwx. 1 root root 17 Jul 2 2015 /etc/sysconfig/selinux -&gt; ../selinux/config</span><br><span class="line"><span class="meta">[#</span><span class="bash">17<span class="comment">#root@rhel6 ~]#cat /etc/selinux/config</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This file controls the state of SELinux on the system.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> SELINUX= can take one of these three values: ã€ä¸‰ç§çŠ¶æ€ã€‘</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> enforcing - SELinux security policy is enforced. ã€æ‰“å¼€ selinux , å¹¶å¼ºåˆ¶é™åˆ¶ã€‘</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> permissive - SELinux prints warnings instead of enforcing. ã€æ‰“å¼€ selinux , ä¸é™åˆ¶æ“ä½œ , ä½†ä¼šè­¦</span></span><br><span class="line">å‘Šã€‘</span><br><span class="line"><span class="meta">#</span><span class="bash"> disabled - No SELinux policy is loaded. ã€å…³é—­ selinux ã€‘</span></span><br><span class="line">SELINUX=enforcing</span><br><span class="line"><span class="meta">#</span><span class="bash"> SELINUXTYPE= can take one of these two values: ã€ä¸¤ç§ç±»å‹ã€‘</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> targeted - Targeted processes are protected, ã€é’ˆå¯¹ç½‘ç»œæœåŠ¡è¾ƒå¤š , é’ˆå¯¹ä¸»æœºè¾ƒå°‘ã€‘</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mls - Multi Level Security protection. ã€å…¨æ–¹ä½çš„æ§åˆ¶ã€‘</span></span><br><span class="line">SELINUXTYPE=targeted</span><br></pre></td></tr></table></figure>

<p>é‡å¯ç”µè„‘åç”Ÿæ•ˆ , å¹¶æ°¸ä¹…ç”Ÿæ•ˆ</p>
<h3 id="ç›¸å…³æŒ‡ä»¤"><a href="#ç›¸å…³æŒ‡ä»¤" class="headerlink" title="ç›¸å…³æŒ‡ä»¤"></a>ç›¸å…³æŒ‡ä»¤</h3><ul>
<li>æŸ¥çœ‹å½“å‰ selinux çŠ¶æ€çš„å‘½ä»¤ : getenforce/sestatus</li>
<li>è®¾ç½® selinux çŠ¶æ€ ( ä¸´æ—¶ç”Ÿæ•ˆ ): setenforce [ Enforcing | Permissive | 1 | 0 ]</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">12<span class="comment">#root@rhel6 ~]#getenforce</span></span></span><br><span class="line">Enforcing</span><br><span class="line"><span class="meta">[#</span><span class="bash">13<span class="comment">#root@rhel6 ~]#sestatus</span></span></span><br><span class="line">SELinux status:</span><br><span class="line">enabled</span><br><span class="line">SELinuxfs mount:</span><br><span class="line">/selinux</span><br><span class="line">Current mode:</span><br><span class="line">enforcing</span><br><span class="line">Mode from config file:</span><br><span class="line">enforcing</span><br><span class="line">Policy version:</span><br><span class="line">28</span><br><span class="line">Policy from config file:</span><br><span class="line">targeted</span><br><span class="line">[root@rhel7 ~]# setenforce 0</span><br><span class="line">[root@rhel7 ~]# getenforce</span><br><span class="line">Permissive</span><br><span class="line">[root@rhel7 ~]# sestatus</span><br><span class="line">SELinux status:</span><br><span class="line">enabled</span><br><span class="line">SELinuxfs mount:</span><br><span class="line">/sys/fs/selinux</span><br><span class="line">SELinux root directory:</span><br><span class="line">/etc/selinux</span><br><span class="line">Loaded policy name:</span><br><span class="line">targeted</span><br><span class="line">Current mode:</span><br><span class="line">permissive</span><br><span class="line">Mode from config file:</span><br><span class="line">enforcing</span><br><span class="line">Policy MLS status:</span><br><span class="line">enabled</span><br><span class="line">Policy deny_unknown status: allowed</span><br><span class="line">Max kernel policy version: 28</span><br><span class="line">[root@rhel7 ~]# which getenforce</span><br><span class="line">/usr/sbin/getenforce</span><br><span class="line">[root@rhel7 ~]# rpm -qf /usr/sbin/getenforce</span><br><span class="line">libselinux-utils-2.2.2-6.el7.x86_64</span><br><span class="line">[root@rhel7 ~]# rpm -ql libselinux-utils|head</span><br><span class="line">/usr/sbin/avcstat</span><br><span class="line">/usr/sbin/getenforce</span><br><span class="line">/usr/sbin/getsebool</span><br><span class="line">/usr/sbin/matchpathcon</span><br><span class="line">/usr/sbin/selinuxconlist</span><br><span class="line">/usr/sbin/selinuxdefcon</span><br><span class="line">/usr/sbin/selinuxenabled</span><br><span class="line">/usr/sbin/selinuxexeccon</span><br><span class="line">/usr/sbin/setenforce</span><br><span class="line">/usr/share/man/man5/booleans.5.gz</span><br><span class="line">[root@rhel7 ~]# which sestatus</span><br><span class="line">/usr/sbin/sestatus</span><br><span class="line">[root@rhel7 ~]# rpm -qf /usr/sbin/sestatuspolicycoreutils-2.2.5-11.el7.x86_64</span><br><span class="line">[root@rhel7 ~]# rpm -ql policycoreutils|head</span><br><span class="line">/etc/sestatus.conf</span><br><span class="line">/usr/bin/secon</span><br><span class="line">/usr/sbin/fixfiles</span><br><span class="line">/usr/sbin/genhomedircon</span><br><span class="line">/usr/sbin/load_policy</span><br><span class="line">/usr/sbin/restorecon</span><br><span class="line">/usr/sbin/semodule</span><br><span class="line">/usr/sbin/sestatus</span><br><span class="line">/usr/sbin/setfiles</span><br><span class="line">/usr/sbin/setsebool</span><br></pre></td></tr></table></figure>

<h3 id="æ“ä½œé™åˆ¶çš„å®ç°æ–¹æ³•"><a href="#æ“ä½œé™åˆ¶çš„å®ç°æ–¹æ³•" class="headerlink" title="æ“ä½œé™åˆ¶çš„å®ç°æ–¹æ³•"></a>æ“ä½œé™åˆ¶çš„å®ç°æ–¹æ³•</h3><ol>
<li>é€šè¿‡ bool å€¼æ¥è¿›è¡Œæ“ä½œçš„é™åˆ¶</li>
</ol>
<ul>
<li>1&gt;getsebool -a &lt;== æ˜¾ç¤ºä¸»æœºä¸­æ‰€æœ‰çš„å¸ƒå°”å€¼</li>
<li>2&gt;setsebool [-PV] boolean value | bool1=val1 bool2=val2 â€¦</li>
</ul>
<ol start="2">
<li>é€šè¿‡å®‰å…¨ä¸Šä¸‹æ–‡<br>ä¸»ä½“ï¼ˆè¿›ç¨‹ï¼‰ä¸ç›®æ ‡çš„å®‰å…¨ä¸Šä¸‹æ–‡å¿…é¡»ä¸€è‡´æ‰èƒ½å¤Ÿé¡ºåˆ©è®¿é—®<br>æŸ¥çœ‹å®‰å…¨ä¸Šä¸‹æ–‡<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">19<span class="comment">#root@rhel6 ~]#ls -Z</span></span></span><br><span class="line">-rw-------. root root system_u:object_r:admin_home_t:s0 anaconda-ks.cfg</span><br><span class="line">drwxr-xr-x. root root unconfined_u:object_r:admin_home_t:s0 Desktop</span><br><span class="line">drwxr-xr-x. root root unconfined_u:object_r:admin_home_t:s0 Documents</span><br><span class="line">drwxr-xr-x. root root unconfined_u:object_r:admin_home_t:s0 Downloads</span><br><span class="line">-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 index.php3?stat=26</span><br><span class="line">-rw-r--r--. root root system_u:object_r:admin_home_t:s0 install.log</span><br><span class="line">-rw-r--r--. root root system_u:object_r:admin_home_t:s0 install.log.syslog</span><br><span class="line">drwxr-xr-x. root root unconfined_u:object_r:admin_home_t:s0 Music</span><br><span class="line">drwxr-xr-x. root root unconfined_u:object_r:admin_home_t:s0 Pictures</span><br><span class="line">drwxr-xr-x. root root unconfined_u:object_r:admin_home_t:s0 Public</span><br><span class="line">-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 root@172.25.0.10</span><br><span class="line">drwxr-xr-x. root root unconfined_u:object_r:admin_home_t:s0 Templates</span><br><span class="line">drwxr-xr-x. root root unconfined_u:object_r:admin_home_t:s0 Videos</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>å®‰å…¨ä¸Šä¸‹æ–‡ä¸»è¦ç”¨å†’å·åˆ†ä¸ºä¸‰ä¸ªå­—æ®µ :</p>
<p>Identify:role:type</p>
<p>èº«ä»½è¯†åˆ« : è§’è‰² : ç±»å‹1.5 selinux æ‰€éœ€è¦çš„æœåŠ¡</p>
<p>èº«ä»½æ ‡è¯†å’Œè§’è‰²å¹¶ä¸é‡è¦ï¼Œå®‰å…¨ä¸Šä¸‹æ–‡é‡Œé‡è¦çš„å°±æ˜¯è¿™ä¸ªç±»å‹ï¼Œä¸€ä¸ªä¸»ä½“è¿›ç¨‹èƒ½ä¸èƒ½è¯»å–åˆ°è¿™ä¸ªæ–‡ä»¶èµ„æºä¸ç±»å‹å­—æ®µæœ‰å…³ã€‚<br>ä¹‹å‰æˆ‘ä»¬è¯´è¿›ç¨‹å’Œæ–‡ä»¶çš„ä¸Šä¸‹æ–‡çš„ç±»å‹å¿…é¡»è¦åŒ¹é…ã€‚è¿™é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ªä¸“æœ‰åè¯ï¼Œä¸€ä¸ªå«åŸŸï¼Œä¸€ä¸ªå«ç±»å‹ã€‚å…¶ä¸­ä¸»ä½“ç¨‹åºä¸­ç§°ä¸ºåŸŸï¼Œæ–‡ä»¶èµ„æºä¸Šç§°ä¸ºç±»å‹ï¼Œæ˜¯ä¸æ˜¯æœ‰ç§å¬å¤©ä¹¦çš„æ„Ÿè§‰ï¼Ÿå¾ˆæ‹—å£å§ï¼Ÿæˆ‘ä»¬æ¥ä¸¾ä¸ªåˆ—å­ã€‚<br>å…ˆå°†httpdæœåŠ¡å¼€å¯ï¼Œservice httpd start<br>Cd /var/www/html è¿™é‡Œæ˜¯ä¸€ä¸ªç³»åˆ—çš„ç½‘é¡µæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶ç±»å‹å±äºhttpd_sys_content_t è¿˜æœ‰httpd_sys_script_exec_tã€‚<br>ç„¶åæˆ‘ä»¬å†çœ‹è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ç±»å‹<br>å…ˆæŸ¥çœ‹æœ‰æ²¡æœ‰è¿™ä¸ªè¿›ç¨‹  pstree | grep httpd<br>ç„¶åæŸ¥çœ‹è¿›ç¨‹çš„å®‰å…¨ä¸Šä¸‹æ–‡ ps aux -Z | grep httpã€‚<br>åœ¨è¿™é‡ŒHttpdæ˜¯ä¸€ä¸ªåŸŸï¼Œselinuxçš„ç­–ç•¥é’ˆå¯¹è¿™ä¸ªåŸŸåˆ¶å®šäº†è®¸å¤šçš„è§„åˆ™ï¼Œå…¶ä¸­åŒ…æ‹¬è¿™ä¸ªåŸŸå¯ä»¥è¯»çš„ç›®æ ‡èµ„æºç±»å‹ï¼Œæ¯”å¦‚sys_contentã€‚<br>ä¸»é¢˜è¿›ç¨‹å’Œç›®æ ‡çš„æ–‡ä»¶çš„å®‰å…¨ä¸Šä¸‹æ–‡å¿…é¡»åŒ¹é…ä¸ç„¶ä¼šæœ‰æƒé™æŠ¥é”™çš„æç¤º</p>
<p>ä¿®æ”¹å®‰å…¨ä¸Šä¸‹æ–‡<br>ä½¿ç”¨chconå‘½ä»¤æ¥æ›´æ”¹å®‰å…¨ä¸Šä¸‹æ–‡çš„ç±»å‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@python tmp]# ls --context test.txt</span><br><span class="line">-rw-r--r-- root root root:object_r:staff_tmp_t test.txt</span><br><span class="line">[root@python tmp]# chcon -t etc_t test.txt</span><br><span class="line">[root@python tmp]# ls -lZ test.txt</span><br><span class="line">-rw-r--r-- root root root:object_r:etc_t test.txt</span><br></pre></td></tr></table></figure>

<p>###Selinuxçš„æ—¥å¿—åˆ†æå·¥å…·sealert<br>setroubleshoot</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">40<span class="comment">#root@rhel6 ~]#yum install -y setroubleshoot     ===&gt;å®‰è£…æ—¥å¿—åˆ†æå·¥å…·</span></span></span><br><span class="line"><span class="meta">[#</span><span class="bash">42<span class="comment">#root@rhel6 ~]#rpm -ql setroubleshoot-server|head</span></span></span><br><span class="line">/etc/audisp/plugins.d/sedispatch.conf</span><br><span class="line">/etc/dbus-1/system.d/org.fedoraproject.SetroubleshootFixit.conf</span><br><span class="line">/etc/dbus-1/system.d/org.fedoraproject.Setroubleshootd.conf</span><br><span class="line">/etc/logrotate.d/setroubleshoot</span><br><span class="line">/etc/setroubleshoot</span><br><span class="line">/etc/setroubleshoot/setroubleshoot.conf</span><br><span class="line">/usr/bin/sealert</span><br><span class="line"><span class="meta">[#</span><span class="bash">40<span class="comment">#root@rhel6 ~]#Sealert -a /var/log/audit/audit.log	===&gt;ä½¿ç”¨æ—¥å¿—åˆ†æå·¥å…·æ¥åˆ†æselinuxçš„æ—¥å¿—</span></span></span><br><span class="line">ç­‰å¾…æ•°æ®å¤„ç†ï¼Œå¤„ç†å®Œæ¯•ä¹‹åæŸ¥çœ‹</span><br></pre></td></tr></table></figure>

<p>setroubleshot å°† selinux ç›¸å…³çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³æ–¹æ³•è®°å½•åœ¨ /var/log/messages æ—¥å¿—ä¸­ã€‚<code>cat /var/log/messages | grep setroubleshoot</code></p>
<h4 id="auditd"><a href="#auditd" class="headerlink" title="auditd"></a>auditd</h4><ul>
<li>auditd â€“&gt; å°† selinux ç›¸å…³çš„ä¿¡æ¯è®°å½•åœ¨ /var/log/audit/audit.log æ—¥å¿—ä¸­,éå¸¸è¯¦ç»†ã€‚</li>
<li>sealert -a /var/log/audit/audit.log</li>
</ul>
<h3 id="selinux-policy-devel"><a href="#selinux-policy-devel" class="headerlink" title="selinux-policy-devel"></a>selinux-policy-devel</h3><p>el6 ä¸Šæ²¡æœ‰è¯¥è½¯ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# yum list|grep selinux-policy-devel</span><br><span class="line">selinux-policy-devel.noarch 3.12.1-153.el7 server</span><br><span class="line"></span><br><span class="line"><span class="meta">[#</span><span class="bash">64<span class="comment">#root@rhel6 ~]#yum list|grep selinux-policy-devel</span></span></span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager</span><br><span class="line">to register.</span><br></pre></td></tr></table></figure>
<p><code>man</code> å…³é”®è¯ <code>_selinux</code> æŸ¥æ‰¾å’Œå…³é”®å­—ç›¸å…³çš„ <code>selinux</code> é™åˆ¶å…·ä½“å†…å®¹ , åŒ…æ‹¬ä»€ä¹ˆæ‰“å¼€ä»€ä¹ˆå¸ƒå°”å€¼ , éœ€è¦è®¾ç½®æ€æ ·çš„å®‰å…¨ä¸Šä¸‹æ–‡ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç³»ç»ŸåŸºç¡€åŸ¹è®­</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux å†…æ ¸</title>
    <url>/2016/12/22/booboo_linux_base/11-Linux%E5%86%85%E6%A0%B8/</url>
    <content><![CDATA[<h2 id="WHERE"><a href="#WHERE" class="headerlink" title="WHERE"></a>WHERE</h2><p>å†…æ ¸ä¸å†…æ ¸æ¨¡å—åœ¨å“ªé‡Œå‘¢?å†…æ ¸æ¨¡å—éƒ½æœ‰å“ªäº›å‘¢?ä¸‹é¢çš„è¡¨ä¸­éƒ½åˆ—å‡ºæ¥äº†:</p>
<ul>
<li>å†…æ ¸ /boot/vmlinuz-version</li>
<li>å†…æ ¸è§£å‹ç¼©æ‰€éœ€ RAM Disk /boot/initrd-version</li>
<li>å†…æ ¸æ¨¡å— /lib/modules/$(uname -r)/kernel</li>
</ul>
<h3 id="WHAT"><a href="#WHAT" class="headerlink" title="WHAT"></a>WHAT</h3><p>å¼€æœºæ—¶,å†…æ ¸ç¬¬ä¸€ä»»åŠ¡å°±æ˜¯é©±åŠ¨ç¡¬ä»¶,æ¿€æ´»æœºå™¨ã€‚ç›¸å…³çš„é©±åŠ¨æ¨¡å—æ”¾åœ¨ <code>/lib/modules/$(uname -r)/</code> ç›®å½•ä¸‹,ä¸‹é¢ä»¥ rhel6 ä¸ºä¾‹,çœ‹çœ‹è¯¥ç›®å½•ä¸‹éƒ½æœ‰äº›ä»€ä¹ˆ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# ls /lib/modules/2.6.32-431.el6.x86_64</span><br><span class="line">build</span><br><span class="line">modules.dep</span><br><span class="line">modules.networking modules.usbmap</span><br><span class="line">extra</span><br><span class="line">modules.dep.bin</span><br><span class="line">modules.ofmap</span><br><span class="line">source</span><br><span class="line">kernel</span><br><span class="line">modules.drm</span><br><span class="line">modules.order</span><br><span class="line">updates</span><br><span class="line">modules.alias</span><br><span class="line">modules.ieee1394map modules.pcimap</span><br><span class="line">vdso</span><br><span class="line">modules.alias.bin modules.inputmap modules.seriomap weak-updates</span><br><span class="line">modules.block</span><br><span class="line">modules.isapnpmap modules.symbols</span><br><span class="line">modules.ccwmap modules.modesetting modules.symbols.bin</span><br><span class="line">[root@rhel6 ~]# ls /lib/modules/2.6.32-431.el6.x86_64/kernel/</span><br><span class="line">arch crypto drivers fs kernel lib mm net sound</span><br><span class="line">[root@rhel6 ~]# ls /lib/modules/2.6.32-431.el6.x86_64/kernel/drivers/</span><br><span class="line">acpi</span><br><span class="line">cpufreq hid</span><br><span class="line">leds</span><br><span class="line">net</span><br><span class="line">rtc</span><br><span class="line">vhost</span><br><span class="line">ata</span><br><span class="line">crypto hv</span><br><span class="line">md</span><br><span class="line">parport scsi video</span><br><span class="line">atm</span><br><span class="line">dca</span><br><span class="line">hwmon</span><br><span class="line">media pci</span><br><span class="line">serial virtio</span><br><span class="line">auxdisplay dma</span><br><span class="line">i2c</span><br><span class="line">memstick pcmcia ssb</span><br><span class="line">watchdog</span><br><span class="line">bcma</span><br><span class="line">edac idle</span><br><span class="line">message platform staging xen</span><br><span class="line">block</span><br><span class="line">firewire ieee802154 mfd</span><br><span class="line">power</span><br><span class="line">target</span><br><span class="line">bluetooth firmware infiniband misc</span><br><span class="line">pps</span><br><span class="line">uio</span><br><span class="line">cdrom</span><br><span class="line">gpio</span><br><span class="line">input</span><br><span class="line">mmc</span><br><span class="line">ptp</span><br><span class="line">usb</span><br><span class="line">char</span><br><span class="line">gpu</span><br><span class="line">isdn</span><br><span class="line">mtd</span><br><span class="line">regulator uwb</span><br><span class="line">[root@rhel6 ~]# ls /lib/modules/2.6.32-431.el6.x86_64/kernel/drivers/net</span><br><span class="line">3c59x.ko dl2k.ko</span><br><span class="line">macvtap.ko</span><br><span class="line">pppox.ko</span><br><span class="line">sunhme.ko</span><br><span class="line">8139cp.ko dnet.ko</span><br><span class="line">mdio.ko</span><br><span class="line">ppp_synctty.ko tehuti.ko</span><br></pre></td></tr></table></figure>

<p>/lib/modules/2.6.32-431.el6.x86_64/kernel/ è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶è§£é‡Š</p>
<ul>
<li>arch    ä¸ç¡¬ä»¶å¹³å°æœ‰å…³çš„é¡¹ç›® , ä¾‹å¦‚ CPU çš„ç­‰çº§ç­‰ç­‰ ;</li>
<li>crypto å†…æ ¸æ‰€æ”¯æŒçš„åŠ å¯†çš„æŠ€æœ¯ , ä¾‹å¦‚ md5 ã€ des ç­‰ç­‰ ;</li>
<li>drivers ç¡¬ä»¶çš„é©±åŠ¨ç¨‹åº , ä¾‹å¦‚æ˜¾ç¤ºé€‚é…å™¨ã€ç½‘ç»œå¡ã€ PCI ç›¸å…³ç¡¬ä»¶</li>
<li>fs å†…æ ¸æ‰€æ”¯æŒçš„ filesystems , ä¾‹å¦‚ ext4, vfat, reiserfs, nfs ç­‰ç­‰ ;</li>
<li>kernel å†…æ ¸çš„ç¨‹åºã€å†…æ ¸çŠ¶æ€ã€çº¿ç¨‹ã€ç¨‹åºçš„æ’ç¨‹ (schedule) ã€ç¨‹åºçš„ signle ç­‰</li>
<li>lib å‡½å¼åº“</li>
<li>mm å†…å­˜å•å…ƒæœ‰å…³çš„å„é¡¹æ•°æ®</li>
<li>net ä¸ç½‘ç»œæœ‰å…³çš„å„é¡¹åè®®æ•°æ®,è¿˜æœ‰é˜²ç«å¢™æ¨¡å—</li>
<li>sound éŸ³æ•ˆæœ‰å…³çš„å„é¡¹æ¨¡å—2 å†…æ ¸æ¨¡å—çš„ç›¸ä¾æ€§: depmod</li>
</ul>
<h3 id="moudules-dep-æ–‡ä»¶"><a href="#moudules-dep-æ–‡ä»¶" class="headerlink" title="moudules.dep æ–‡ä»¶"></a>moudules.dep æ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 etc]# head /lib/modules/$(uname -r)/modules.dep</span><br><span class="line">kernel/arch/x86/kernel/cpu/mcheck/mce-inject.ko:</span><br><span class="line">kernel/arch/x86/kernel/cpu/cpufreq/powernow-k8.ko: kernel/drivers/cpufreq/freq_table.ko</span><br><span class="line">kernel/arch/x86/kernel/cpu/cpufreq/mperf.ko</span><br><span class="line">kernel/arch/x86/kernel/cpu/cpufreq/mperf.ko:</span><br><span class="line">kernel/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.ko: kernel/drivers/cpufreq/freq_table.ko</span><br><span class="line">kernel/arch/x86/kernel/cpu/cpufreq/mperf.ko</span><br><span class="line">kernel/arch/x86/kernel/cpu/cpufreq/pcc-cpufreq.ko:</span><br><span class="line">kernel/arch/x86/kernel/cpu/cpufreq/speedstep-lib.ko:</span><br><span class="line">kernel/arch/x86/kernel/cpu/cpufreq/p4-clockmod.ko: kernel/drivers/cpufreq/freq_table.ko</span><br><span class="line">kernel/arch/x86/kernel/cpu/cpufreq/speedstep-lib.ko</span><br><span class="line">kernel/arch/x86/kernel/cpu/cpufreq/intel_pstate.ko:</span><br><span class="line">kernel/arch/x86/kernel/test_nx.ko:</span><br><span class="line">kernel/arch/x86/kernel/microcode.ko:</span><br></pre></td></tr></table></figure>

<h3 id="depmod-å‘½ä»¤"><a href="#depmod-å‘½ä»¤" class="headerlink" title="depmod å‘½ä»¤"></a>depmod å‘½ä»¤</h3><p>depmod [-Ane]</p>
<p>é€‰é¡¹ä¸å‚æ•° :</p>
<ul>
<li>-A : ä¸åŠ ä»»ä½•å‚æ•°æ—¶ , depmod ä¼šä¸»åŠ¨çš„å»åˆ†æç›®å‰å†…æ ¸çš„æ¨¡å— , å¹¶ä¸”é‡æ–°å†™å…¥<code>/lib/modules/$(uname -r)/modules.dep</code> å½“ä¸­æ›´æ–°ã€‚è‹¥åŠ å…¥ -A å‚æ•°æ—¶ , åˆ™ depmod ä¼šå»æœå¯»æ¯” modules.dep å†…è¿˜è¦æ–°çš„æ¨¡å—,è‹¥æ‰¾åˆ°æ–°æ¨¡å—åˆ™</li>
<li>-n : ä¸å†™å…¥ modules.dep , è€Œæ˜¯å°†ç»“æœè¾“å‡ºåˆ°å±å¹•ä¸Š (standard out);</li>
<li>-e : æ˜¾ç¤ºå‡ºç›®å‰å·²åŠ è½½çš„ä¸å¯æ‰§è¡Œçš„æ¨¡å—åç§°</li>
</ul>
<h3 id="depmod-å®éªŒ"><a href="#depmod-å®éªŒ" class="headerlink" title="depmod å®éªŒ"></a>depmod å®éªŒ</h3><p>å‡è®¾å·²ç»åšå¥½ä¸€ä¸ªç½‘å¡é©±åŠ¨ç¨‹åº , æ¡£åä¸º a.ko, è¯·æ›´æ–°å†…æ ¸çš„ç›¸ä¾æ€§ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# cp a.ko /lib/modules/2.6.32-</span><br><span class="line">431.el6.x86_64/kernel/drivers/net</span><br><span class="line">[root@rhel6 ~]# depmod3 å†…æ ¸æ¨¡å—çš„è§‚å¯Ÿ: lsmod, modinfo</span><br></pre></td></tr></table></figure>

<h3 id="lsmod-å‘½ä»¤"><a href="#lsmod-å‘½ä»¤" class="headerlink" title="lsmod å‘½ä»¤"></a>lsmod å‘½ä»¤</h3><p>ä½œç”¨:æ˜¾ç¤ºå‡ºç›®å‰å·²ç»å­˜åœ¨äºå†…æ ¸å½“ä¸­çš„æ¨¡å— , æ˜¾ç¤ºçš„å†…å®¹åŒ…æ‹¬ :</p>
<ol>
<li>æ¨¡å—åç§° (Module);</li>
<li>æ¨¡å—çš„å¤§å° (size);</li>
<li>æ­¤æ¨¡å—æ˜¯å¦è¢«å…¶ä»–æ¨¡å—æ‰€ä½¿ç”¨ (Used by) ã€‚</li>
</ol>
<h3 id="modinfo-å‘½ä»¤"><a href="#modinfo-å‘½ä»¤" class="headerlink" title="modinfo å‘½ä»¤"></a>modinfo å‘½ä»¤</h3><p>ç”¨æ³•:</p>
<p>modinfo [-adln] [module_name|filename]</p>
<p>é€‰é¡¹ä¸å‚æ•° :</p>
<ul>
<li>-a : ä»…åˆ—å‡ºä½œè€…åç§° ;</li>
<li>-d : ä»…åˆ—å‡ºè¯¥ modules çš„è¯´æ˜ (description);</li>
<li>-l : ä»…åˆ—å‡ºæˆæƒ (license);</li>
<li>-n : ä»…åˆ—å‡ºè¯¥æ¨¡å—çš„è¯¦ç»†è·¯å¾„ã€‚</li>
</ul>
<h3 id="å†…æ ¸æ¨¡å—çš„è§‚å¯Ÿå®éªŒ"><a href="#å†…æ ¸æ¨¡å—çš„è§‚å¯Ÿå®éªŒ" class="headerlink" title="å†…æ ¸æ¨¡å—çš„è§‚å¯Ÿå®éªŒ"></a>å†…æ ¸æ¨¡å—çš„è§‚å¯Ÿå®éªŒ</h3><p>é¦–å…ˆæŸ¥çœ‹ç›®å‰å·²å­˜åœ¨äºå†…æ ¸ä¸­çš„æ¨¡å—,éšä¾¿é€‰æ‹©ä¸€ä¸ªæ¨¡å—å¹¶æŸ¥çœ‹è¯¥æ¨¡å—çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# [root@rhel6 ~]# lsmod</span><br><span class="line">Module</span><br><span class="line">Size</span><br><span class="line">Used by</span><br><span class="line">autofs4 26513 3</span><br><span class="line">8021q 25349 0</span><br><span class="line">garp</span><br><span class="line">7152</span><br><span class="line">1 8021q</span><br><span class="line">[root@rhel6 ~]# modinfo autofs4</span><br><span class="line">filename:</span><br><span class="line">/lib/modules/2.6.32-</span><br><span class="line">431.el6.x86_64/kernel/fs/autofs4/autofs4.ko</span><br><span class="line">license: GPL</span><br><span class="line">srcversion: 948FC9C8D4043379272927C</span><br><span class="line">depends:</span><br><span class="line">vermagic:</span><br><span class="line">2.6.32-431.el6.x86_64 SMP mod_unload modversions</span><br></pre></td></tr></table></figure>

<h2 id="å†…æ ¸æ¨¡å—çš„åŠ è½½ä¸ç§»é™¤-insmod-modprobe-rmmod"><a href="#å†…æ ¸æ¨¡å—çš„åŠ è½½ä¸ç§»é™¤-insmod-modprobe-rmmod" class="headerlink" title="å†…æ ¸æ¨¡å—çš„åŠ è½½ä¸ç§»é™¤:insmod, modprobe, rmmod"></a>å†…æ ¸æ¨¡å—çš„åŠ è½½ä¸ç§»é™¤:insmod, modprobe, rmmod</h2><p>modprobe åŠ è½½æ¨¡å—ä¼šä¸»åŠ¨å»æœå¯» modules.dep çš„å†…å®¹ , å…ˆè§£å†³æ¨¡å—çš„ç›¸ä¾æ€§å , å†å†³å®šéœ€è¦åŠ è½½çš„æ¨¡å—æœ‰å“ªäº›,å¾ˆæ–¹ä¾¿; insmod åˆ™å®Œå…¨ç”±ä½¿ç”¨è€…è‡ªè¡ŒåŠ è½½ä¸€ä¸ªå®Œæ•´æ–‡ä»¶åçš„æ¨¡å— , ä¸ä¼šä¸»åŠ¨åˆ†ææ¨¡å—ç›¸ä¾æ€§</p>
<h3 id="insmod-å‘½ä»¤"><a href="#insmod-å‘½ä»¤" class="headerlink" title="insmod å‘½ä»¤"></a>insmod å‘½ä»¤</h3><p>insmod [/full/path/module_name] [parameters]</p>
<h3 id="modprobe-å‘½ä»¤"><a href="#modprobe-å‘½ä»¤" class="headerlink" title="modprobe å‘½ä»¤"></a>modprobe å‘½ä»¤</h3><p>modprobe [-lcfr] module_name</p>
<p>é€‰é¡¹ä¸å‚æ•° :</p>
<ul>
<li>-c : åˆ—å‡ºç›®å‰ç³»ç»Ÿæ‰€æœ‰çš„æ¨¡å— !( æ›´è¯¦ç»†çš„ä»£å·å¯¹åº”è¡¨ )</li>
<li>-l : åˆ—å‡ºç›®å‰åœ¨ /lib/modules/<code>uname -r</code>/kernel å½“ä¸­çš„æ‰€æœ‰æ¨¡å—å®Œæ•´æ–‡ä»¶ å ;</li>
<li>-f : å¼ºåˆ¶åŠ è½½è¯¥æ¨¡å— ;</li>
<li>-r : ç±»ä¼¼ rmmod , ç§»é™¤æŸä¸ªæ¨¡å—</li>
</ul>
<h3 id="rmmod-å‘½ä»¤"><a href="#rmmod-å‘½ä»¤" class="headerlink" title="rmmod å‘½ä»¤"></a>rmmod å‘½ä»¤</h3><p>rmmod [-fw] module_name</p>
<p>é€‰é¡¹ä¸å‚æ•° :</p>
<ul>
<li>-f : å¼ºåˆ¶å°†è¯¥æ¨¡å—ç§»é™¤æ‰ , ä¸ç®¡æ˜¯å¦æ­£è¢«ä½¿ç”¨ ;</li>
<li>-w : è‹¥è¯¥æ¨¡å—æ­£è¢«ä½¿ç”¨ , åˆ™ç­‰è¯¥æ¨¡å—è¢«ä½¿ç”¨å®Œæ¯•å , å†ç§»é™¤</li>
</ul>
<h3 id="å†…æ ¸æ¨¡å—çš„åŠ è½½ä¸ç§»é™¤å®éªŒ"><a href="#å†…æ ¸æ¨¡å—çš„åŠ è½½ä¸ç§»é™¤å®éªŒ" class="headerlink" title="å†…æ ¸æ¨¡å—çš„åŠ è½½ä¸ç§»é™¤å®éªŒ"></a>å†…æ ¸æ¨¡å—çš„åŠ è½½ä¸ç§»é™¤å®éªŒ</h3><p>åŠ è½½æ¨¡å—;æŸ¥çœ‹è¯¥æ¨¡å—æ˜¯å¦å·²æˆåŠŸåŠ è½½,å¹¶æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯;ç§»é™¤è¯¥æ¨¡å—ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 net]# modprobe dnet</span><br><span class="line">[root@rhel6 net]# modinfo dnet</span><br><span class="line">filename:</span><br><span class="line">/lib/modules/2.6.32-431.el6.x86_64/kernel/drivers/net/dnet.ko</span><br><span class="line">author:</span><br><span class="line">Ilya Yanok &lt;yanok@emcraft.com&gt;, Matteo Vit &lt;matteo.vit@dave.eu&gt;</span><br><span class="line">description: Dave DNET Ethernet driver</span><br><span class="line">license:</span><br><span class="line">GPL</span><br><span class="line">srcversion: 9D532980E04E93088A9DFC1</span><br><span class="line">depends:</span><br><span class="line">vermagic:</span><br><span class="line">2.6.32-431.el6.x86_64 SMP mod_unload modversions</span><br><span class="line">[root@rhel6 net]# lsmod | grep dnet</span><br><span class="line">dnet</span><br><span class="line">16103 0</span><br><span class="line">[root@rhel6 net]# rmmod dnet</span><br><span class="line">[root@rhel6 net]# lsmod | grep dnet</span><br></pre></td></tr></table></figure>

<h2 id="å†…æ ¸æ¨¡å—çš„é¢å¤–å‚æ•°è®¾å®š-etc-modprobe-d-conf"><a href="#å†…æ ¸æ¨¡å—çš„é¢å¤–å‚æ•°è®¾å®š-etc-modprobe-d-conf" class="headerlink" title="å†…æ ¸æ¨¡å—çš„é¢å¤–å‚æ•°è®¾å®š:/etc/modprobe.d/*.conf"></a>å†…æ ¸æ¨¡å—çš„é¢å¤–å‚æ•°è®¾å®š:/etc/modprobe.d/*.conf</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# ls /etc/modprobe.d/</span><br><span class="line">anaconda.conf dist-alsa.conf dist-oss.conf</span><br><span class="line">blacklist.conf dist.conf</span><br><span class="line">openfwwf.conf</span><br><span class="line">[root@rhel6 ~]# cat /etc/modprobe.d/dist.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> default modutils aliases</span></span><br><span class="line">alias binfmt-204 binfmt_aout</span><br><span class="line">alias binfmt-263 binfmt_aout</span><br><span class="line">alias binfmt-264 binfmt_aout</span><br><span class="line">alias binfmt-267 binfmt_aout</span><br><span class="line">alias binfmt-387 binfmt_aout</span><br><span class="line">alias block-major-1-* rd</span><br><span class="line">alias block-major-3-* ide-probe-mod</span><br><span class="line">alias block-major-8-* sd_mod</span><br><span class="line">alias block-major-9-* md</span><br><span class="line">alias block-major-11-* sr_mod</span><br><span class="line">alias block-major-13-* xd</span><br><span class="line">alias block-major-15-* cdu31a</span><br><span class="line">alias block-major-16-* gscd</span><br><span class="line">alias block-major-17-* optcd</span><br><span class="line">alias block-major-18-* sjcd</span><br><span class="line">alias block-major-20-* mcdx</span><br><span class="line">alias block-major-22-* ide-probe-mod</span><br><span class="line">alias block-major-23-* mcd</span><br><span class="line">alias block-major-24-* sonycd535</span><br><span class="line">alias block-major-25-* sbpcd</span><br><span class="line">alias block-major-26-* sbpcd</span><br><span class="line">alias block-major-27-* sbpcd</span><br><span class="line">alias block-major-29-* aztcd</span><br><span class="line">alias block-major-32-* cm206</span><br><span class="line">alias block-major-33-* ide-probe-mod</span><br><span class="line">alias block-major-34-* ide-probe-mod</span><br><span class="line">alias block-major-37-* ide-tape</span><br><span class="line">alias block-major-44-* ftl</span><br><span class="line">alias block-major-46-* pcd</span><br><span class="line">alias block-major-47-* pf</span><br></pre></td></tr></table></figure>

<h2 id="å†…æ ¸å‡çº§"><a href="#å†…æ ¸å‡çº§" class="headerlink" title="å†…æ ¸å‡çº§"></a>å†…æ ¸å‡çº§</h2><h3 id="æºç ç¼–è¯‘"><a href="#æºç ç¼–è¯‘" class="headerlink" title="æºç ç¼–è¯‘"></a>æºç ç¼–è¯‘</h3><p>Linux å†…æ ¸å®˜ç½‘ <a href="https://www.kernel.org/" target="_blank" rel="noopener">https://www.kernel.org/</a> æä¾›çš„æ˜¯æºç ,éœ€è¦ç¼–è¯‘ä½¿ç”¨ã€‚</p>
<p><img src="pic/44.png" alt="44"></p>
<p>Linux å†…æ ¸ç‰ˆæœ¬æœ‰ä¸¤ç§ : ç¨³å®šç‰ˆå’Œå¼€å‘ç‰ˆ ,Linux å†…æ ¸ç‰ˆæœ¬å·ç”± 3 ä¸ªæ•°å­—ç»„æˆ :r.x.y</p>
<ul>
<li>r: ä¸»ç‰ˆæœ¬å·</li>
<li>x: æ¬¡ç‰ˆæœ¬å· , å¶æ•°è¡¨ç¤ºç¨³å®šç‰ˆæœ¬ ; å¥‡æ•°è¡¨ç¤ºå¼€å‘ä¸­ç‰ˆæœ¬ã€‚</li>
<li>y: ä¿®è®¢ç‰ˆæœ¬å· , è¡¨ç¤ºä¿®æ”¹çš„æ¬¡æ•°</li>
</ul>
<p>å» <a href="http://www.kernel.org" target="_blank" rel="noopener">http://www.kernel.org</a> é¦–é¡µ , å¯ä»¥çœ‹åˆ°æœ‰ stable, longterm ç­‰ç‰ˆæœ¬ ,longterm æ˜¯æ¯”stable æ›´ç¨³å®šçš„ç‰ˆæœ¬ , ä¼šé•¿æ—¶é—´æ›´æ–°ã€‚</p>
<p>æºç ç¼–è¯‘ä¸åšè¦æ±‚ã€‚</p>
<h3 id="rpm-åŒ…å®‰è£…"><a href="#rpm-åŒ…å®‰è£…" class="headerlink" title="rpm åŒ…å®‰è£…"></a>rpm åŒ…å®‰è£…</h3><p>åœ¨å·¥ä½œä¸­åº”è¯¥å»æ“ä½œç³»ç»Ÿçš„å‘è¡Œå…¬å¸çš„å®˜ç½‘ä¸‹è½½å·²ç»ç¼–è¯‘å¥½çš„å†…æ ¸ã€‚æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯çº¢å¸½çš„,é‚£ä¹ˆå°±å»çº¢å¸½çš„å®˜ç½‘ <a href="https://www.redhat.com/en/global/china" target="_blank" rel="noopener">https://www.redhat.com/en/global/china</a></p>
<p>è¿™é‡Œä½¿ç”¨ä¸€ä¸ªå…è´¹çš„æº ELRepo æº</p>
<p><img src="pic/45.png" alt="45"></p>
<h4 id="rhel6-5-å†…æ ¸å‡çº§-â€”â€”-yum-æ–¹å¼-æœ‰ç½‘"><a href="#rhel6-5-å†…æ ¸å‡çº§-â€”â€”-yum-æ–¹å¼-æœ‰ç½‘" class="headerlink" title="rhel6.5 å†…æ ¸å‡çº§ â€”â€” yum æ–¹å¼(æœ‰ç½‘)"></a>rhel6.5 å†…æ ¸å‡çº§ â€”â€” yum æ–¹å¼(æœ‰ç½‘)</h4><p>åœ¨ yum çš„ ELRepo æºä¸­ , é€‰æ‹© kernel-lt-3.10.102-1.el6.elrepo.x86_64.rpm è¿™ä¸ªç‰ˆ<br>æœ¬ã€‚</p>
<p><img src="pic/46.png" alt="46"></p>
<p>é‡æ–°å¯åŠ¨åçš„ grub ç•Œé¢</p>
<p><img src="pic/47.png" alt="47"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">1<span class="comment">#root@rhel6 ~]#uname -r</span></span></span><br><span class="line">3.10.102-1.el6.elrepo.x86_64</span><br></pre></td></tr></table></figure>

<h4 id="rhel7-2-å†…æ ¸å‡çº§-â€”â€”-æœ¬åœ°-rpm-å®‰è£…-æ²¡ç½‘"><a href="#rhel7-2-å†…æ ¸å‡çº§-â€”â€”-æœ¬åœ°-rpm-å®‰è£…-æ²¡ç½‘" class="headerlink" title="rhel7.2 å†…æ ¸å‡çº§ â€”â€” æœ¬åœ° rpm å®‰è£…(æ²¡ç½‘)"></a>rhel7.2 å†…æ ¸å‡çº§ â€”â€” æœ¬åœ° rpm å®‰è£…(æ²¡ç½‘)</h4><p>æ­¤å¤„æ˜¯åœ¨ <a href="http://rpm.pbone.net" target="_blank" rel="noopener">http://rpm.pbone.net</a> ä¸Šä¸‹è½½çš„,å®é™…å·¥ä½œä¸­åº”è¯¥åˆ°çº¢å¸½å®˜ç½‘ä¸‹è½½ã€‚</p>
<p><img src="pic/48.png" alt="48"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# ls</span><br><span class="line">anaconda-ks.cfg Downloads</span><br><span class="line">Music Templates</span><br><span class="line">Desktop</span><br><span class="line">initial-setup-ks.cfg</span><br><span class="line">Pictures Videos</span><br><span class="line">Documents</span><br><span class="line">kernel-lt-3.10.102-1.el6.elrepo.x86_64.rpm Public</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ä½†å‰ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# uname -r</span><br><span class="line">3.10.0-123.el7.x86_64</span><br></pre></td></tr></table></figure>

<p>å®‰è£…æ–°å†…æ ¸å¹¶ä¿ç•™åŸå†…æ ¸</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# rpm -ivh kernel-lt-3.10.102-1.el6.elrepo.x86_64.rpm</span><br><span class="line">Preparing...</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################ [100%]</span></span></span><br><span class="line">Updating / installing...</span><br><span class="line">1:kernel-lt-3.10.102-1.el6.elrepo ################################# [100%]</span><br><span class="line">[root@rhel7 ~]# cd /boot/grub2/</span><br><span class="line">[root@rhel7 grub2]# ll /etc/grub2.cfg</span><br><span class="line">lrwxrwxrwx. 1 root root 22 Jul 2 2015 /etc/grub2.cfg -&gt; ../boot/grub2/grub.cfg</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å½“å‰é»˜è®¤å¯åŠ¨å†…æ ¸</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 grub2]# grub2-editenv list</span><br><span class="line">saved_entry=Red Hat Enterprise Linux Linux, with Linux 3.10.0-123.el7.x86_64</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹é…ç½®æ–‡ä»¶ä¸­æœ‰å‡ ä¸ªå¯åŠ¨é¡¹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 grub2]# grep "menuentry" /boot/grub2/grub.cfg</span><br><span class="line">if [ x"$&#123;feature_menuentry_id&#125;" = xy ]; then</span><br><span class="line">menuentry_id_option="--id"</span><br><span class="line">menuentry_id_option=""</span><br><span class="line">export menuentry_id_option</span><br><span class="line">menuentry 'Red Hat Enterprise Linux Server (3.10.102-1.el6.elrepo.x86_64) 7.0 (Maipo)' --class red</span><br><span class="line">--class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-</span><br><span class="line">123.el7.x86_64-advanced-5220f38d-edd6-45e5-a257-f1e9e6c80b4e' &#123;</span><br><span class="line">menuentry 'Red Hat Enterprise Linux Server, with Linux 3.10.0-123.el7.x86_64' --class red --class</span><br><span class="line">gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-</span><br><span class="line">123.el7.x86_64-advanced-5220f38d-edd6-45e5-a257-f1e9e6c80b4e' &#123;</span><br><span class="line">menuentry 'Red Hat Enterprise Linux Server, with Linux 0-rescue-14d17f362db9498eaa56aac326570c37' --class red --class gnu-linux --class gnu --class os</span><br><span class="line">--unrestricted $menuentry_id_option 'gnulinux-0-rescue-14d17f362db9498eaa56aac326570c37-</span><br><span class="line">advanced-5220f38d-edd6-45e5-a257-f1e9e6c80b4e' &#123;</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®é»˜è®¤å¯åŠ¨å†…æ ¸</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 grub2]# grub2-set-default 'Red Hat Enterprise Linux Server (3.10.102-</span><br><span class="line">1.el6.elrepo.x86_64) 7.0 (Maipo)'</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å½“å‰é»˜è®¤å¯åŠ¨å†…æ ¸</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 grub2]# grub2-editenv list</span><br><span class="line">saved_entry=Red Hat Enterprise Linux Server (3.10.102-1.el6.elrepo.x86_64) 7.0 (Maipo)</span><br></pre></td></tr></table></figure>

<p>æ›´æ–°ä¸€ä¸‹é…ç½® , è®©æ–°çš„å†…æ ¸å¯åŠ¨ç”Ÿæ•ˆ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 grub2]# grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line">Generating grub configuration file ...</span><br><span class="line">Found linux image: /boot/vmlinuz-3.10.102-1.el6.elrepo.x86_64</span><br><span class="line">Found initrd image: /boot/initramfs-3.10.102-1.el6.elrepo.x86_64.img</span><br><span class="line">Found linux image: /boot/vmlinuz-3.10.0-123.el7.x86_64</span><br><span class="line">Found initrd image: /boot/initramfs-3.10.0-123.el7.x86_64.img</span><br><span class="line">Found linux image: /boot/vmlinuz-0-rescue-14d17f362db9498eaa56aac326570c37</span><br><span class="line">Found initrd image: /boot/initramfs-0-rescue-14d17f362db9498eaa56aac326570c37.img</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>é‡æ–°å¯åŠ¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 grub2]# reboot</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# uname -r</span><br><span class="line">3.10.102-1.el6.elrepo.x86_64</span><br></pre></td></tr></table></figure>

<h2 id="Linux-å†…æ ¸ä½œä¸š"><a href="#Linux-å†…æ ¸ä½œä¸š" class="headerlink" title="Linux å†…æ ¸ä½œä¸š"></a>Linux å†…æ ¸ä½œä¸š</h2><ol>
<li>åˆ°å…±äº«å½“ä¸­ä¸‹è½½ linux å†…æ ¸ kernel-lt-3.10.102-1.el6.elrepo.x86_64.rpm</li>
<li>rhel6.5 è¿›è¡Œå†…æ ¸å‡çº§,ä¿ç•™åŸå†…æ ¸</li>
<li>rhel7.2 è¿›è¡Œå†…æ ¸å‡çº§,ä¿ç•™åŸå†…æ ¸</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç³»ç»ŸåŸºç¡€åŸ¹è®­</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux è¿›ç¨‹ç®¡ç†</title>
    <url>/2016/12/22/booboo_linux_base/13-%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<h2 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h2><ul>
<li><p>è¿›ç¨‹ï¼š è¿è¡Œåœ¨å†…å­˜ä¸­ç¨‹åºå®ä¾‹ , è¿›ç¨‹æ˜¯ç¨‹åºè¿è¡Œçš„ä¸€ç§çŠ¶æ€ , æ˜¯å†…å­˜ä¸­çš„æ¦‚å¿µï¼Œè¿›ç¨‹ä¸è¿›ç¨‹ä¹‹é—´æ— æ³•è®¿é—®å¯¹æ–¹ç§æœ‰çš„å†…å­˜åŒºåŸŸã€‚</p>
</li>
<li><p>çº¿ç¨‹ï¼š ç¨‹åºè¿è¡Œçš„æœ€å°å•å…ƒï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªçº¿ç¨‹ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹ä¹‹é—´å¯ä»¥ç›¸äº’è®¿é—®å½¼æ­¤å†…å­˜åŒºåŸŸï¼Œå¹¶ä¸”å¯ä»¥å…±äº«åŒä¸€è¿›ç¨‹çš„å…±äº«å†…å­˜åŒºåŸŸã€‚</p>
</li>
<li><p>è¿›ç¨‹ç¼–å·ï¼špid</p>
</li>
<li><p>çˆ¶è¿›ç¨‹ç¼–å·ï¼šppid</p>
</li>
</ul>
<h3 id="pstree-å‘½ä»¤"><a href="#pstree-å‘½ä»¤" class="headerlink" title="pstree å‘½ä»¤"></a>pstree å‘½ä»¤</h3><p>pstree å‘½ä»¤ç”¨ä»¥æŸ¥çœ‹è¿›ç¨‹çš„ç»“æ„</p>
<table>
<thead>
<tr>
<th>å¸¸ç”¨å‚æ•°</th>
<th>å‚æ•°è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>-a</td>
<td>æ˜¾ç¤ºæ¯ä¸ªç¨‹åºçš„å®Œæ•´æŒ‡ä»¤ï¼ŒåŒ…å«è·¯å¾„ï¼Œå‚æ•°æˆ–æ˜¯å¸¸é©»æœåŠ¡çš„æ ‡ç¤ºã€‚</td>
</tr>
<tr>
<td>-c</td>
<td>ä¸ä½¿ç”¨ç²¾ç®€æ ‡ç¤ºæ³•ã€‚</td>
</tr>
<tr>
<td>-G</td>
<td>ä½¿ç”¨VT100ç»ˆç«¯æœºçš„åˆ—ç»˜å›¾å­—ç¬¦ã€‚</td>
</tr>
<tr>
<td>-h</td>
<td>åˆ—å‡ºæ ‘çŠ¶å›¾æ—¶ï¼Œç‰¹åˆ«æ ‡æ˜æ‰§è¡Œçš„ç¨‹åºã€‚</td>
</tr>
<tr>
<td>-H&lt;ç¨‹åºè¯†åˆ«ç &gt;</td>
<td>æ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®šâ€-hâ€å‚æ•°ç±»ä¼¼ï¼Œä½†ç‰¹åˆ«æ ‡æ˜æŒ‡å®šçš„ç¨‹åºã€‚</td>
</tr>
<tr>
<td>-l</td>
<td>é‡‡ç”¨é•¿åˆ—æ ¼å¼æ˜¾ç¤ºæ ‘çŠ¶å›¾ã€‚</td>
</tr>
<tr>
<td>-n</td>
<td>ç”¨ç¨‹åºè¯†åˆ«ç æ’åºã€‚é¢„è®¾æ˜¯ä»¥ç¨‹åºåç§°æ¥æ’åºã€‚</td>
</tr>
<tr>
<td>-p</td>
<td>æ˜¾ç¤ºç¨‹åºè¯†åˆ«ç ã€‚</td>
</tr>
<tr>
<td>-u</td>
<td>æ˜¾ç¤ºç”¨æˆ·åç§°ã€‚</td>
</tr>
<tr>
<td>-U</td>
<td>ä½¿ç”¨UTF-8åˆ—ç»˜å›¾å­—ç¬¦ã€‚</td>
</tr>
<tr>
<td>-V</td>
<td>æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 /etc/skel]#pstree</span><br><span class="line">initâ”€â”¬â”€NetworkManagerâ”€â”¬â”€dhclient</span><br><span class="line">â”‚</span><br><span class="line">â””â”€&#123;NetworkManager&#125;</span><br><span class="line">â”œâ”€abrtd</span><br><span class="line">â”œâ”€acpid</span><br><span class="line">â”œâ”€anacron</span><br><span class="line">â”œâ”€atd</span><br><span class="line">â”œâ”€auditdâ”€â”€â”€&#123;auditd&#125;</span><br><span class="line">â”œâ”€automountâ”€â”€â”€4*[&#123;automount&#125;]</span><br><span class="line">â”œâ”€bonobo-activatiâ”€â”€â”€&#123;bonobo-activat&#125;</span><br><span class="line">â”œâ”€certmonger</span><br><span class="line">â”œâ”€console-kit-daeâ”€â”€â”€63*[&#123;console-kit-da&#125;]</span><br><span class="line">â”œâ”€crond</span><br><span class="line">â”œâ”€cupsd</span><br><span class="line">â”œâ”€2*[dbus-daemonâ”€â”€â”€&#123;dbus-daemon&#125;]</span><br><span class="line">â”œâ”€dbus-launch</span><br><span class="line">â”œâ”€devkit-power-da</span><br><span class="line">â”œâ”€gconfd-2</span><br><span class="line">â”œâ”€gdm-binaryâ”€â”¬â”€gdm-simple-slavâ”€â”¬â”€Xorg</span><br><span class="line">â”‚</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€gdm-session-wor</span><br><span class="line">â”‚</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€gnome-sessionâ”€â”¬â”€at-spi-registry</span><br><span class="line">â”‚</span><br><span class="line">â”‚</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€gdm-simple-gree</span><br><span class="line">â”‚</span><br><span class="line">â”‚</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€gnome-power-man</span><br><span class="line">â”‚</span><br><span class="line">â”‚</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€metacity</span><br><span class="line">â”‚</span><br><span class="line">â”‚</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€polkit-gnome-au</span><br><span class="line">â”‚</span><br><span class="line">â”‚</span><br><span class="line">â”‚</span><br><span class="line">â””â”€&#123;gnome-session&#125;</span><br><span class="line">â”‚</span><br><span class="line">â”‚</span><br><span class="line">â””â”€&#123;gdm-simple-sla&#125;</span><br><span class="line">â”‚</span><br><span class="line">â””â”€&#123;gdm-binary&#125;</span><br><span class="line">â”œâ”€gnome-settings-â”€â”€â”€&#123;gnome-settings&#125;</span><br><span class="line">â”œâ”€gvfsd</span><br><span class="line">â”œâ”€haldâ”€â”¬â”€hald-runnerâ”€â”¬â”€hald-addon-acpi</span><br><span class="line">â”‚</span><br><span class="line">â”‚</span><br><span class="line">â””â”€hald-addon-inpu</span><br><span class="line">â”‚</span><br><span class="line">â””â”€&#123;hald&#125;</span><br><span class="line">â”œâ”€masterâ”€â”¬â”€pickupâ”‚</span><br><span class="line">â””â”€qmgr</span><br><span class="line">â”œâ”€5*[mingetty]</span><br><span class="line">â”œâ”€modem-manager</span><br><span class="line">â”œâ”€polkitd</span><br><span class="line">â”œâ”€pulseaudioâ”€â”€â”€&#123;pulseaudio&#125;</span><br><span class="line">â”œâ”€rhsmcertd</span><br><span class="line">â”œâ”€rpc.statd</span><br><span class="line">â”œâ”€rpcbind</span><br><span class="line">â”œâ”€rsyslogdâ”€â”€â”€3*[&#123;rsyslogd&#125;]</span><br><span class="line">â”œâ”€rtkit-daemonâ”€â”€â”€2*[&#123;rtkit-daemon&#125;]</span><br><span class="line">â”œâ”€sshdâ”€â”€â”€sshdâ”€â”€â”€bashâ”€â”€â”€pstree</span><br><span class="line">â”œâ”€udevdâ”€â”€â”€2*[udevd]</span><br><span class="line">â””â”€wpa_supplicant</span><br></pre></td></tr></table></figure>

<h3 id="é™æ€æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯"><a href="#é™æ€æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯" class="headerlink" title="é™æ€æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯"></a>é™æ€æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯</h3><h4 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h4><ul>
<li>ps æŸ¥çœ‹å½“å‰æ ‡ç­¾é¡µä¸Šçš„è¿›ç¨‹ä¿¡æ¯</li>
<li>ps aux ç³»ç»Ÿè¿›ç¨‹å¿«ç…§ </li>
<li>ps -ef e æ‰€æœ‰è¿›ç¨‹ f å…¨æ ¼å¼ç½—åˆ—</li>
</ul>
<p>ä½¿ç”¨ps auxæŸ¥çœ‹<br>ç¬¬ä¸€åˆ—userä»£è¡¨è¿›ç¨‹çš„æ‹¥æœ‰è€…ï¼Œç¬¬äºŒåˆ—PIDï¼Œç¬¬ä¸‰åˆ—å ç”¨CPUçš„ç™¾åˆ†æ¯”ï¼Œç¬¬å››åˆ—å ç”¨å†…å­˜çš„ç™¾åˆ†æ¯”ï¼Œæˆ‘ä»¬è¯´è¿›ç¨‹å ç”¨ç³»ç»Ÿèµ„æºï¼ŒåƒCPUå†…å­˜éƒ½å±äºç³»ç»Ÿèµ„æºçš„ä¸€éƒ¨åˆ†ï¼Œè¿™é‡Œéƒ½å°†å®ƒæ˜¾ç¤ºå‡ºæ¥äº†ã€‚æ¥ä¸‹æ¥ï¼ŒVSZä»£è¡¨è¿™ä¸ªå ç”¨è™šæ‹Ÿå†…å­˜çš„å¤§å°ï¼ŒRSSä»£è¡¨å ç”¨ç‰©ç†å†…å­˜çš„å¤§å°ï¼Œä»¥KBä¸ºå•ä½ã€‚è™šæ‹Ÿç©ºé—´å°±æ˜¯å½“å†…å­˜ä¸è¶³çš„æ—¶å€™ï¼ŒæŠŠä¸€éƒ¨åˆ†ç¡¬ç›˜ç©ºé—´è™šæ‹Ÿæˆå†…å­˜ä½¿ç”¨ï¼Œé‚£ä¹ˆç‰©ç†å†…å­˜å°±æ˜¯çœŸå®å­˜åœ¨çš„çœŸæ­£çš„å†…å­˜å¤§å°ã€‚ç„¶åå°±æ˜¯å¤„äºå“ªä¸ªç»ˆç«¯ï¼Œè¿›ç¨‹ç›®å‰çš„çŠ¶æ€ï¼Œå¼€å§‹æ—¶é—´ï¼Œå’Œå…·ä½“çš„å‘½ä»¤ã€‚é‚£ä¹ˆè¿›ç¨‹çš„çŠ¶æ€æœ‰å“ªäº›å‘¢ã€‚<br>Sï¼šä¼‘çœ çŠ¶æ€ï¼ˆsleepingï¼‰<br>Rï¼šç­‰å¾…è¿è¡Œï¼ˆrunableï¼‰R Running or runnable (on run queue) è¿›ç¨‹å¤„äºè¿è¡Œæˆ–å°±ç»ªçŠ¶æ€<br>Iï¼šç©ºé—²çŠ¶æ€ï¼ˆidleï¼‰<br>&lt;    high-priority (not nice to other users) ä¼˜å…ˆçº§è¾ƒé«˜çš„<br>N    low-priority (nice to other users)     ä¼˜å…ˆçº§è¾ƒä½<br>s    is a session leader                 è¿›ç¨‹çš„é¢†å¯¼è€…<br>l    is multi-threaded (using CLONE_THREAD, like NPTL pthreads do) å¤šçº¿ç¨‹</p>
<ul>
<li>is in the foreground process group   åœ¨å‰å°è¿›ç¨‹ç»„</li>
</ul>
<p>ä½¿ç”¨ps -ef æŸ¥çœ‹<br>UID ç”¨æˆ·ID<br>PID è¿›ç¨‹ID<br>PPID çˆ¶è¿›ç¨‹ID<br>C CPUå ç”¨ç‡<br>STIME å¼€å§‹æ—¶é—´<br>TTY å¼€å§‹æ­¤è¿›ç¨‹çš„TTY<br>TIME æ­¤è¿›ç¨‹è¿è¡Œçš„æ€»æ—¶é—´<br>CMD å‘½ä»¤å</p>
<p>ä½¿ç”¨ps -leå¯ä»¥ç”¨æ¥æŸ¥çœ‹è¿™ä¸ªè¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä¸»è¦å…³æ³¨ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§æ˜¯NIè¿™ä¸€åˆ—ï¼Œå…¶ä»–å…ˆä¸ç”¨å…³æ³¨</p>
<h4 id="pgrep"><a href="#pgrep" class="headerlink" title="pgrep"></a>pgrep</h4><p>ç”¨æ¥è¿‡æ»¤è¿›ç¨‹å·</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# pgrep -l ping &lt;== æˆªå–è¿›ç¨‹å· pid</span><br><span class="line">27706 ping</span><br><span class="line">[root@rhel6 ~]# pgrep -lU student &lt;== æŒ‡å®šç”¨æˆ·æˆªå–è¿›ç¨‹å· pid</span><br><span class="line">27736 bash</span><br><span class="line">27762 ping</span><br><span class="line">[root@rhel6 ~]# pgrep -l -t pts/1 &lt;== æŒ‡å®šç™»é™†ç«¯å£æˆªå–è¿›ç¨‹å· pid</span><br><span class="line">2568 bash</span><br><span class="line">27735 su</span><br><span class="line">27736 bash</span><br><span class="line">1.2.3 pidof</span><br><span class="line">[root@rhel6 ~]# pidof Xorg &lt;== åªæ˜¾ç¤ºè¿›ç¨‹çš„è¿›ç¨‹å· pid</span><br><span class="line">15262</span><br></pre></td></tr></table></figure>

<h2 id="åŠ¨æ€æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯"><a href="#åŠ¨æ€æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯" class="headerlink" title="åŠ¨æ€æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯"></a>åŠ¨æ€æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯</h2><h3 id="top-ç»ˆç«¯æç¤ºç¬¦ä¸æ˜¾ç¤º"><a href="#top-ç»ˆç«¯æç¤ºç¬¦ä¸æ˜¾ç¤º" class="headerlink" title="top ç»ˆç«¯æç¤ºç¬¦ä¸æ˜¾ç¤º"></a>top ç»ˆç«¯æç¤ºç¬¦ä¸æ˜¾ç¤º</h3><ul>
<li>ã€ d ã€‘ä¿®æ”¹é»˜è®¤åˆ·æ–°é¢‘ç‡ , é»˜è®¤ 3s</li>
<li>ã€ P ã€‘ä»¥ cup å ç”¨ç™¾åˆ†æ¯”è¿›è¡Œæ’åº</li>
<li>ã€ M ã€‘ä»¥å†…å­˜çš„å ç”¨æƒ…å†µæ’åº</li>
<li>ã€ h ã€‘æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</li>
<li>ã€ &lt;&gt; ã€‘ç¿»é¡µ</li>
<li>ã€ k ã€‘æ€æ‰è¿›ç¨‹ kill</li>
</ul>
<p>topå‘½ä»¤å›¾è§£</p>
<p> <img src="pic%5Ctop-pic.png" alt="top-pic"></p>
<h3 id="åœæ­¢è¿›ç¨‹"><a href="#åœæ­¢è¿›ç¨‹" class="headerlink" title="åœæ­¢è¿›ç¨‹"></a>åœæ­¢è¿›ç¨‹</h3><p>Linuxä¸­çš„ kill å‘½ä»¤ç”¨æ¥åœæ­¢æŒ‡å®šçš„è¿›ç¨‹( terminate a process )çš„è¿è¡Œï¼Œæ˜¯ Linuxä¸‹è¿›ç¨‹ç®¡ç†çš„å¸¸ç”¨å‘½ä»¤ã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹åœæ­¢ä¸€ä¸ªå‰å°è¿›ç¨‹å¯ä»¥ä½¿ç”¨ Ctrl+C ç»„åˆé”®ï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªè¿è¡Œåœ¨åå°è¿›ç¨‹éœ€è¦ç”¨ killå‘½ä»¤æ¥ç»ˆæ­¢ï¼Œæˆ‘ä»¬å°±éœ€è¦å…ˆä½¿ç”¨ psã€pidofã€pstreeå’Œtop ç­‰å·¥å…·è·å–è¿›ç¨‹ PID ï¼Œç„¶åä½¿ç”¨ kill å‘½ä»¤æ¥æ€æ‰è¯¥è¿›ç¨‹ã€‚</p>
<p>kill å‘½ä»¤æ˜¯é€šè¿‡å‘è¿›ç¨‹å‘é€æŒ‡å®šçš„ä¿¡å·æ¥ç»“æŸç›¸åº”è¿›ç¨‹çš„ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹,é‡‡ç”¨ç¼–å·ä¸º15 çš„ TERM ä¿¡å·ã€‚ TERM ä¿¡å·å°†ç»ˆæ­¢æ‰€æœ‰ä¸èƒ½æ•è·è¯¥ä¿¡å·çš„è¿›ç¨‹ã€‚</p>
<p>å¯¹äºé‚£äº›å¯ä»¥æ•è·è¯¥ä¿¡å·çš„è¿›ç¨‹å°±è¦ç”¨ç¼–å·ä¸º 9 çš„ kill ä¿¡å·,å¼ºè¡Œ â€œ æ€æ‰ â€ è¯¥è¿›ç¨‹ã€‚</p>
<p>å‘½ä»¤æ ¼å¼</p>
<p>kill [å‚æ•°][è¿›ç¨‹å·]</p>
<p>å‘½ä»¤åŠŸèƒ½ï¼š</p>
<p>å‘é€æŒ‡å®šçš„ä¿¡å·åˆ°ç›¸åº”è¿›ç¨‹ã€‚ä¸æŒ‡å®šå‹å·å°†å‘é€ SIGTERM ( 15 )ç»ˆæ­¢æŒ‡å®šè¿›ç¨‹ã€‚å¦‚æœä»»æ— æ³•ç»ˆæ­¢è¯¥ç¨‹åºå¯ç”¨ â€œ -KILLâ€ å‚æ•°ï¼Œå…¶å‘é€çš„ä¿¡å·ä¸º SIGKILL(9) ï¼Œå°†å¼ºåˆ¶ç»“æŸè¿›ç¨‹,ä½¿ç”¨ ps å‘½ä»¤æˆ–è€… jobs å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¿›ç¨‹å·ã€‚ root ç”¨æˆ·å°†å½±å“ç”¨æˆ·çš„è¿›ç¨‹,é root ç”¨æˆ·åªèƒ½å½±å“è‡ªå·±çš„è¿›ç¨‹ã€‚</p>
<p>å‘½ä»¤å‚æ•°ï¼š</p>
<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-l</td>
<td align="left">ä¿¡å·,è‹¥æœä¸åŠ ä¿¡å·çš„ç¼–å·å‚æ•°,åˆ™ä½¿ç”¨ â€œ -lâ€ å‚æ•°ä¼šåˆ—å‡ºå…¨éƒ¨çš„ä¿¡å·åç§°</td>
</tr>
<tr>
<td align="left">-a</td>
<td align="left">å½“å¤„ç†å½“å‰è¿›ç¨‹æ—¶,ä¸é™åˆ¶å‘½ä»¤åå’Œè¿›ç¨‹å·çš„å¯¹åº”å…³ç³»</td>
</tr>
<tr>
<td align="left">-p</td>
<td align="left">æŒ‡å®š kill å‘½ä»¤åªæ‰“å°ç›¸å…³è¿›ç¨‹çš„è¿›ç¨‹å·,è€Œä¸å‘é€ä»»ä½•ä¿¡å·</td>
</tr>
<tr>
<td align="left">-s</td>
<td align="left">æŒ‡å®šå‘é€ä¿¡å·</td>
</tr>
<tr>
<td align="left">-u</td>
<td align="left">æŒ‡å®šç”¨æˆ·</td>
</tr>
</tbody></table>
<h3 id="killall"><a href="#killall" class="headerlink" title="killall"></a>killall</h3><p>ç”¨äºå…³æ‰å¤šä¸ªåŒåçš„è¿›ç¨‹</p>
<p>killall -9 ping        ===&gt;å…³æ‰æ‰€æœ‰çš„pingè¿›ç¨‹</p>
<h3 id="pkill"><a href="#pkill" class="headerlink" title="pkill"></a>pkill</h3><p>ä½¿ç”¨pkillå‘½ä»¤å¯ä»¥æ ¹æ®è¿›ç¨‹çš„åç§°ï¼è¿è¡Œè¯¥è¿›ç¨‹çš„ç”¨æˆ·ï¼è¿›ç¨‹æ‰€åœ¨çš„ç»ˆç«¯ç­‰ç­‰å±æ€§æ¥ç»ˆæ­¢ç‰¹å®šçš„è¿›ç¨‹<br>pkill -9 -t ç»ˆç«¯å     ===&gt;å…³æ‰ç”±è¯¥ç»ˆç«¯å¼€å¯çš„è¿›ç¨‹<br>pkill -9 -U ç”¨æˆ·å  ===&gt;å…³æ‰ç”±è¯¥ç”¨æˆ·å¼€å¯çš„è¿›ç¨‹</p>
<h3 id="xkill"><a href="#xkill" class="headerlink" title="xkill"></a>xkill</h3><p>å“ªé‡Œå…³ä¸æ‰ç‚¹å“ªé‡Œ</p>
<p>ä¸»è¦ç”¨äºåœæ­¢å›¾å½¢åŒ–ï¼ˆGUIï¼‰ç¨‹åº</p>
<h3 id="è¿›ç¨‹ä¼˜å…ˆçº§"><a href="#è¿›ç¨‹ä¼˜å…ˆçº§" class="headerlink" title="è¿›ç¨‹ä¼˜å…ˆçº§"></a>è¿›ç¨‹ä¼˜å…ˆçº§</h3><p>NI nice</p>
<p>æ•°å­—è¡¨ç¤º : -20-19 æ•°å­—è¶Šå° , ç­‰çº§è¶Šé«˜</p>
<p><code>ps -le | grep ping</code> &lt;== æŸ¥çœ‹ ping çš„ä¼˜å…ˆçº§</p>
<h3 id="æŒ‡å®šä¼˜å…ˆçº§"><a href="#æŒ‡å®šä¼˜å…ˆçº§" class="headerlink" title="æŒ‡å®šä¼˜å…ˆçº§"></a>æŒ‡å®šä¼˜å…ˆçº§</h3><p><code>nice -n 3 ping 172.0.0.1</code></p>
<p>æ™®é€šç”¨æˆ·ä¸èƒ½æŒ‡å®šæ¯” 0 å°çš„ä¼˜å…ˆçº§ ï¼Œ root ç”¨æˆ·éšæ„</p>
<p>æ™®é€šç”¨æˆ·åªèƒ½åšè´¡çŒ®ï¼Œä¸Šå¸éšæ„è®¾ç½®ä¼˜å…ˆçº§</p>
<h3 id="è°ƒæ•´ä¼˜å…ˆçº§"><a href="#è°ƒæ•´ä¼˜å…ˆçº§" class="headerlink" title="è°ƒæ•´ä¼˜å…ˆçº§"></a>è°ƒæ•´ä¼˜å…ˆçº§</h3><p><code>renice -n [-20-19] [pid] &lt;== è°ƒæ•´ä¼˜å…ˆçº§</code></p>
<p>root å¯ä»¥å‡é«˜ä¹Ÿå¯é™ä½niceå€¼ï¼Œä»£è¡¨å¯ä»¥è®¾ç½®ä¼˜å…ˆçº§æ›´ä½å¯ä»¥è®¾ç½®ä¼˜å…ˆçº§æ›´é«˜ã€‚</p>
<p>æ™®é€šç”¨æˆ·åªèƒ½å‡é«˜niceå€¼ï¼Œä»£è¡¨åªèƒ½é™ä½ä¼˜å…ˆçº§ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]#nice -n 3 ping 172.25.0.10</span><br><span class="line">[root@rhel6 ~]#nice -n 5 ping 172.25.0.10</span><br><span class="line">[root@rhel6 ~]#ps -le|grep ping</span><br><span class="line">4 S     0 26613 26536  0  83   3 - 25812 skb_re pts/1    00:00:00 ping</span><br><span class="line">4 S     0 26614 26567  0  85   5 - 25812 skb_re pts/2    00:00:00 ping</span><br><span class="line">[root@rhel6 ~]#renice -n -1 26613</span><br><span class="line">26613: old priority 3, new priority -1</span><br><span class="line">[root@rhel6 ~]#ps -le|grep ping</span><br><span class="line">4 S     0 26613 26536  0  79  -1 - 25812 skb_re pts/1    00:00:00 ping</span><br><span class="line">4 S     0 26614 26567  0  85   5 - 25812 skb_re pts/2    00:00:00 ping</span><br></pre></td></tr></table></figure>

<h2 id="å‰åå°ä½œä¸š"><a href="#å‰åå°ä½œä¸š" class="headerlink" title="å‰åå°ä½œä¸š"></a>å‰åå°ä½œä¸š</h2><ul>
<li>&amp; åœ¨åˆ›å»ºè¿›ç¨‹çš„è¿‡ç¨‹ä¸­ , å°†å‰å°ä½œä¸šæ”¾ç½®åˆ°åå°çš„æ–¹æ³• ï¼Œåœ¨å‘½ä»¤åé¢åŠ ä¸Š &amp;</li>
<li>jobs æŸ¥çœ‹åå°è¿›ç¨‹</li>
<li>fg å°†åå°ä½œä¸šè°ƒç”¨åˆ°å‰å°</li>
<li>ctrl+z å°†å·²ç»è§¦å‘çš„å‰å°ä½œä¸šè°ƒåˆ°åå° , åå°ä½œä¸šæš‚åœ</li>
<li>bg è®©åå°ä½œä¸šæ‰§è¡Œ</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]#ping 172.25.0.11 &gt;/dev/null &amp;</span><br><span class="line">[1] 26712</span><br><span class="line">[root@rhel6 ~]#ping 172.25.0.10 &gt;/dev/null &amp;</span><br><span class="line">[2] 26713</span><br><span class="line"><span class="meta">[#</span><span class="bash">13<span class="comment">#root@rhel6 ~]#jobs</span></span></span><br><span class="line">[1]- Running</span><br><span class="line">ping 172.25.0.11 &gt; /dev/null &amp;</span><br><span class="line">[2]+ Running</span><br><span class="line">ping 172.25.0.10 &gt; /dev/null &amp;</span><br><span class="line">[root@rhel6 ~]#fg 2</span><br><span class="line">ping 172.25.0.10 &gt; /dev/null</span><br><span class="line">^Z</span><br><span class="line">[2]+ Stopped</span><br><span class="line">ping 172.25.0.10 &gt; /dev/null</span><br><span class="line">[root@rhel6 ~]#bg 2</span><br><span class="line">[2]+ ping 172.25.0.10 &gt; /dev/null &amp;</span><br><span class="line">[root@rhel6 ~]#ps -ef|grep ping</span><br><span class="line">root 26712 26567 0 18:16 pts/2 00:00:00 ping 172.25.0.11</span><br><span class="line">root 26713 26567 0 18:16 pts/2 00:00:00 ping 172.25.0.10</span><br><span class="line">root 26717 26567 0 18:17 pts/2 00:00:00 grep ping</span><br><span class="line">[root@rhel6 ~]#kill 26712</span><br><span class="line">[root@rhel6 ~]#jobs</span><br><span class="line">[1]- Terminated</span><br><span class="line">ping 172.25.0.11 &gt; /dev/null</span><br><span class="line">[2]+ Running</span><br><span class="line">ping 172.25.0.10 &gt; /dev/null &amp;</span><br><span class="line">[root@rhel6 ~]#kill 26713</span><br><span class="line">[root@rhel6 ~]#jobs</span><br><span class="line">[2]+ Terminated</span><br><span class="line">ping 172.25.0.10 &gt; /dev/null</span><br><span class="line"><span class="meta">[#</span><span class="bash">21<span class="comment">#root@rhel6 ~]#jobs</span></span></span><br></pre></td></tr></table></figure>

<h2 id="è¿›ç¨‹ç®¡ç†è¯¾åä½œä¸š"><a href="#è¿›ç¨‹ç®¡ç†è¯¾åä½œä¸š" class="headerlink" title="è¿›ç¨‹ç®¡ç†è¯¾åä½œä¸š"></a>è¿›ç¨‹ç®¡ç†è¯¾åä½œä¸š</h2><p>è¿›ç¨‹ç®¡ç†</p>
<ol>
<li><p>å…³äºçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹çš„å®éªŒ:<br>æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ç™»é™† ssh root@rhel7-fN è¿›å…¥è¾“å…¥å¯†ç çš„çŠ¶æ€,å…ˆä¸è¾“å…¥å¯†ç ,æŸ¥çœ‹è¿›ç¨‹;è¾“å…¥</p>
<p>å¯†ç åå†æŸ¥çœ‹è¿›ç¨‹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rhel7</span><br><span class="line">[root@rhel7 ~]# ps -ef|grep bash</span><br><span class="line">root       642     1  0 02:46 ?        00:00:00 /bin/bash /usr/sbin/ksmtuned</span><br><span class="line">root      7844  7839  1 06:29 pts/0    00:00:00 -bash</span><br><span class="line">[root@rhel7 ~]# ps -ef|grep ssh</span><br><span class="line">root      1261     1  0 02:46 ?        00:00:00 /usr/sbin/sshd -D</span><br><span class="line">root      7839  1261  0 06:29 ?        00:00:00 sshd: root@pts/0</span><br><span class="line">root      7892  1261  0 06:29 ?        00:00:00 sshd: root [priv]</span><br><span class="line">sshd      7893  7892  0 06:29 ?        00:00:00 sshd: root [net]</span><br><span class="line">root      7906  7844  0 06:30 pts/0    00:00:00 grep --color=auto ssh</span><br><span class="line">[root@rhel7 ~]# ps -ef|grep bash</span><br><span class="line">root       642     1  0 02:46 ?        00:00:00 /bin/bash /usr/sbin/ksmtuned</span><br><span class="line">root      7844  7839  0 06:29 pts/0    00:00:00 -bash</span><br><span class="line">root      7915  7892  0 06:30 pts/1    00:00:00 -bash</span><br><span class="line">root      7957  7844  0 06:30 pts/0    00:00:00 grep --color=auto bash</span><br><span class="line">[root@rhel7 ~]# ps -ef|grep 7892</span><br><span class="line">root      7892  1261  0 06:29 ?        00:00:00 sshd: root@pts/1</span><br><span class="line">root      7915  7892  0 06:30 pts/1    00:00:00 -bash</span><br><span class="line">[root@rhel7 ~]# ps -ef|grep 1261</span><br><span class="line">root      1261     1  0 02:46 ?        00:00:00 /usr/sbin/sshd -D</span><br><span class="line">root      7839  1261  0 06:29 ?        00:00:00 sshd: root@pts/0</span><br><span class="line">root      7892  1261  0 06:29 ?        00:00:00 sshd: root@pts/1</span><br><span class="line">[root@rhel7 ~]# ps -ef|grep 1|head -n 1</span><br><span class="line">root         1     0  0 02:46 ?        00:00:03 /usr/lib/systemd/systemd --switched-root --system --deserialize 20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rhel6</span><br><span class="line">[root@rhel6 ~]#ps -ef|grep ssh</span><br><span class="line">root      1421     1  0 15:56 ?        00:00:00 /usr/sbin/sshd</span><br><span class="line">root     26564  1421  0 17:36 ?        00:00:00 sshd: root@pts/2</span><br><span class="line">root     26750  1421  0 18:25 ?        00:00:00 sshd: root@pts/3</span><br><span class="line">root     26829 26803  0 18:29 pts/3    00:00:00 ssh root@172.25.0.10</span><br><span class="line">root     26848 26567  0 18:37 pts/2    00:00:00 grep ssh</span><br><span class="line">[root@rhel6 ~]#ps -ef|grep ssh</span><br><span class="line">root      1421     1  0 15:56 ?        00:00:00 /usr/sbin/sshd</span><br><span class="line">root     26564  1421  0 17:36 ?        00:00:00 sshd: root@pts/2</span><br><span class="line">root     26750  1421  0 18:25 ?        00:00:00 sshd: root@pts/3</span><br><span class="line">root     26829 26803  0 18:29 pts/3    00:00:00 ssh root@172.25.0.10</span><br><span class="line">root     26849  1421  0 18:37 ?        00:00:00 sshd: [accepted]</span><br><span class="line">sshd     26850 26849  0 18:37 ?        00:00:00 sshd: [net]      </span><br><span class="line">root     26852 26567  0 18:37 pts/2    00:00:00 grep ssh</span><br><span class="line">[root@rhel6 ~]#ps -ef|grep ssh</span><br><span class="line">root      1421     1  0 15:56 ?        00:00:00 /usr/sbin/sshd</span><br><span class="line">root     26564  1421  0 17:36 ?        00:00:00 sshd: root@pts/2</span><br><span class="line">root     26750  1421  0 18:25 ?        00:00:00 sshd: root@pts/3</span><br><span class="line">root     26829 26803  0 18:29 pts/3    00:00:00 ssh root@172.25.0.10</span><br><span class="line">root     26849  1421  1 18:37 ?        00:00:00 sshd: root@pts/0</span><br><span class="line">root     26874 26567  0 18:38 pts/2    00:00:00 grep ssh</span><br><span class="line">[root@rhel6 ~]#ps -ef|grep 1421</span><br><span class="line">root      1421     1  0 15:56 ?        00:00:00 /usr/sbin/sshd</span><br><span class="line">root     26564  1421  0 17:36 ?        00:00:00 sshd: root@pts/2</span><br><span class="line">root     26750  1421  0 18:25 ?        00:00:00 sshd: root@pts/3</span><br><span class="line">root     26849  1421  0 18:37 ?        00:00:00 sshd: root@pts/0</span><br><span class="line">root     26877 26567  0 18:38 pts/2    00:00:00 grep 1421</span><br><span class="line">[root@rhel6 ~]#ps -ef|grep 1|head -n 1</span><br><span class="line">root         1     0  0 15:55 ?        00:00:01 /sbin/init</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»ºå¤šä¸ªvi è¿›ç¨‹ï¼Œå¹¶ä½¿å…¶è¿è¡Œåœ¨ç³»ç»Ÿåå°ï¼Œè®¾ç½®vi åå°è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼ˆniceï¼‰å€¼ï¼Œåˆ†åˆ«ä¸º1ã€5ã€15ã€17ï¼Œå¹¶éšåå°†å…¶ç»Ÿä¸€ä¿®æ”¹ä¸º18ã€‚</p>
</li>
<li><p>è§‚å¯Ÿtopå‘½ä»¤çš„æ˜¾ç¤ºä¿¡æ¯ï¼Œæ‰¾å‡ºå½“å‰å ç”¨cpuã€å†…å­˜ã€I/Oèµ„æºæœ€å¤šçš„è¿›ç¨‹å·å’Œè¿›ç¨‹åã€‚</p>
</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç³»ç»ŸåŸºç¡€åŸ¹è®­</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux æ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ç®¡ç†</title>
    <url>/2016/12/22/booboo_linux_base/09-Linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<h2 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h2><h3 id="èµ„æºè™šæ‹ŸåŒ–"><a href="#èµ„æºè™šæ‹ŸåŒ–" class="headerlink" title="èµ„æºè™šæ‹ŸåŒ–"></a>èµ„æºè™šæ‹ŸåŒ–</h3><p><img src="pic/20.png" alt="20"></p>
<p>Linuxæ“ä½œç³»ç»Ÿå†…æ ¸ç”±6ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>è¿›ç¨‹è°ƒåº¦ä¸ç®¡ç†</li>
<li>ä¸»å­˜ç®¡ç†å’Œè™šå­˜ç®¡ç†</li>
<li>VFSå’Œæ–‡ä»¶ç®¡ç†</li>
<li>è®¾å¤‡ç®¡ç†</li>
<li>ç½‘ç»œæ¥å£å’Œé€šä¿¡</li>
<li>ç”¨æ¥å®ç°èµ„æºæŠ½è±¡</li>
<li>èµ„æºåˆ†é…å’Œèµ„æºå…±äº«ç­‰åŠŸèƒ½ã€‚</li>
</ul>
<h3 id="æ–‡ä»¶ç³»ç»Ÿçš„æ¦‚å¿µ"><a href="#æ–‡ä»¶ç³»ç»Ÿçš„æ¦‚å¿µ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿçš„æ¦‚å¿µ"></a>æ–‡ä»¶ç³»ç»Ÿçš„æ¦‚å¿µ</h3><p>æ“ä½œç³»ç»Ÿä¸­è´Ÿè´£ç®¡ç†å’Œå­˜å‚¨æ–‡ä»¶ä¿¡æ¯çš„è½¯ä»¶æœºæ„ç§°ä¸ºæ–‡ä»¶ç®¡ç†ç³»ç»Ÿï¼Œç®€ç§°æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p>ä»ç³»ç»Ÿè§’åº¦æ¥çœ‹ï¼Œæ–‡ä»¶ç³»ç»Ÿæ˜¯å¯¹æ–‡ä»¶å­˜å‚¨è®¾å¤‡çš„ç©ºé—´è¿›è¡Œç»„ç»‡å’Œåˆ†é…ï¼Œè´Ÿè´£æ–‡ä»¶å­˜å‚¨å¹¶å¯¹å­˜å…¥çš„æ–‡ä»¶è¿›è¡Œä¿æŠ¤å’Œæ£€ç´¢çš„ç³»ç»Ÿã€‚</p>
<p>å…·ä½“åœ°è¯´ï¼Œå®ƒè´Ÿè´£ä¸ºç”¨æˆ·å»ºç«‹æ–‡ä»¶ï¼Œå­˜å…¥ã€è¯»å‡ºã€ä¿®æ”¹ã€è½¬å‚¨æ–‡ä»¶ï¼Œæ§åˆ¶æ–‡ä»¶çš„å­˜å–ï¼Œå½“ç”¨æˆ·ä¸å†ä½¿ç”¨æ—¶æ’¤é”€æ–‡ä»¶ç­‰ã€‚</p>
<h3 id="æ–‡ä»¶ç³»ç»Ÿçš„ç±»å‹"><a href="#æ–‡ä»¶ç³»ç»Ÿçš„ç±»å‹" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿçš„ç±»å‹"></a>æ–‡ä»¶ç³»ç»Ÿçš„ç±»å‹</h3><p>æŸ¥çœ‹ç³»ç»Ÿæ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿ<br><code>ls /lib/modules/$(uname -r)/kernel/fs</code></p>
<p>ç³»ç»Ÿç›®å‰å·²åŠ è½½åˆ°å†…å­˜ä¸­æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿ<br><code>more /proc/filesystems</code></p>
<h3 id="æ–‡ä»¶ç³»ç»Ÿçš„ç»“æ„"><a href="#æ–‡ä»¶ç³»ç»Ÿçš„ç»“æ„" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿçš„ç»“æ„"></a>æ–‡ä»¶ç³»ç»Ÿçš„ç»“æ„</h3><p>ç´¢å¼•å¼æ–‡ä»¶ç³»ç»Ÿ(indexed allocation)</p>
<p><img src="pic/21.png" alt="21"></p>
<p>æ–‡ä»¶ç³»ç»Ÿå†…çš„ä¿¡æ¯ä¸»è¦æœ‰:</p>
<ul>
<li>superblock:è®°å½•filesystemçš„æ•´ä½“ä¿¡æ¯,åŒ…æ‹¬ inode/blockçš„æ€»é‡ã€ä½¿ç”¨é‡ã€å‰©ä½™é‡, ä»¥åŠæ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼ç­‰;</li>
<li>inode:è®°å½•æ–‡ä»¶å±æ€§,ä¸€ä¸ªæ–‡ä»¶å ä¸€ä¸ªinode,åŒæ—¶è®°å½•è¯¥æ–‡ä»¶æ•°æ®æ‰€åœ¨çš„block å·ç ;</li>
<li>block:å®é™…è®°å½•æ–‡ä»¶çš„å†…å®¹,è‹¥æ¡£æ¡ˆå¤ªå¤§æ—¶,ä¼šå ç”¨å¤šä¸ª block</li>
</ul>
<h3 id="æ–‡ä»¶ç³»ç»Ÿçš„åŒºåˆ«"><a href="#æ–‡ä»¶ç³»ç»Ÿçš„åŒºåˆ«" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿçš„åŒºåˆ«"></a>æ–‡ä»¶ç³»ç»Ÿçš„åŒºåˆ«</h3><p>rhel6</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# mkfs</span><br><span class="line">mkfs          mkfs.ext2     mkfs.ext4     mkfs.msdos    </span><br><span class="line">mkfs.cramfs   mkfs.ext3     mkfs.ext4dev  mkfs.vfat</span><br></pre></td></tr></table></figure>
<p>rhel7</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# mkfs</span><br><span class="line">mkfs         mkfs.cramfs  mkfs.ext3    mkfs.fat     mkfs.msdos   mkfs.xfs     </span><br><span class="line">mkfs.btrfs   mkfs.ext2    mkfs.ext4    mkfs.minix   mkfs.vfat</span><br></pre></td></tr></table></figure>

<p>EXT4 Linux kernel è‡ª 2.6.28 å¼€å§‹æ­£å¼æ”¯æŒæ–°çš„æ–‡ä»¶ç³»ç»Ÿ Ext4ã€‚Ext4 æ˜¯ Ext3 çš„æ”¹è¿›ç‰ˆï¼Œä¿®æ”¹äº† Ext3 ä¸­éƒ¨åˆ†é‡è¦çš„æ•°æ®ç»“æ„ï¼Œè€Œä¸ä»…ä»…åƒ Ext3 å¯¹ Ext2 é‚£æ ·ï¼Œåªæ˜¯å¢åŠ äº†ä¸€ä¸ªæ—¥å¿—åŠŸèƒ½è€Œå·²ã€‚Ext4 å¯ä»¥æä¾›æ›´ä½³çš„æ€§èƒ½å’Œå¯é æ€§ï¼Œè¿˜æœ‰æ›´ä¸ºä¸°å¯Œçš„åŠŸèƒ½ï¼Œä¸å‘ä¸‹å…¼å®¹ext3ã€‚</p>
<p>XFS é’ˆå¯¹æµ·é‡å°æ–‡ä»¶çš„å­˜å‚¨åŠè¶…å¤§æ–‡ä»¶çš„å­˜å‚¨æœ‰ä¸€äº›æœ‰æ—¶,ä½† EXT ç³»ç»Ÿç›¸å¯¹ç¨³å®šã€‚XFS æ˜¯ Silicon Graphicsï¼ŒInc. äº 90 å¹´ä»£åˆå¼€å‘çš„æ–‡ä»¶ç³»ç»Ÿã€‚å®ƒè‡³ä»Šä»ä½œä¸º SGI åŸºäº IRIX çš„äº§å“ï¼ˆä»å·¥ä½œç«™åˆ°è¶…çº§è®¡ç®—æœºï¼‰çš„åº•å±‚æ–‡ä»¶ç³»ç»Ÿæ¥ä½¿ç”¨ã€‚ç°åœ¨ï¼ŒXFS ä¹Ÿå¯ä»¥ç”¨äº Linuxã€‚XFS çš„ Linux ç‰ˆçš„åˆ°æ¥æ˜¯æ¿€åŠ¨äººå¿ƒçš„ï¼Œé¦–å…ˆå› ä¸ºå®ƒä¸º Linux ç¤¾åŒºæä¾›äº†ä¸€ç§å¥å£®çš„ã€ä¼˜ç§€çš„ä»¥åŠåŠŸèƒ½ä¸°å¯Œçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”è¿™ç§æ–‡ä»¶ç³»ç»Ÿæ‰€å…·æœ‰çš„å¯ä¼¸ç¼©æ€§èƒ½å¤Ÿæ»¡è¶³æœ€è‹›åˆ»çš„å­˜å‚¨éœ€æ±‚ã€‚</p>
<h3 id="æ–‡ä»¶ç³»ç»Ÿçš„ç®€å•æ“ä½œ"><a href="#æ–‡ä»¶ç³»ç»Ÿçš„ç®€å•æ“ä½œ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿçš„ç®€å•æ“ä½œ"></a>æ–‡ä»¶ç³»ç»Ÿçš„ç®€å•æ“ä½œ</h3><p><img src="pic/22.png" alt="22"></p>
<h4 id="df"><a href="#df" class="headerlink" title="df"></a>df</h4><p><img src="pic/23.png" alt="23"></p>
<p>å®ä¾‹ï¼š</p>
<ol>
<li>ä½¿ç”¨-hé€‰é¡¹ä»¥KBä»¥ä¸Šçš„å•ä½æ¥æ˜¾ç¤ºï¼Œå¯è¯»æ€§é«˜<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">3<span class="comment">#root@rhel6 ~]#df -h</span></span></span><br><span class="line">Filesystem                     Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/vg_rhel6-LogVol01   17G  3.0G   13G  19% /</span><br><span class="line">tmpfs                          499M   72K  499M   1% /dev/shm</span><br><span class="line">/dev/vda1                      477M   58M  390M  13% /boot</span><br><span class="line">/dev/mapper/vg_rhel6-LogVol00  380M  2.3M  354M   1% /home</span><br></pre></td></tr></table></figure></li>
<li>æŸ¥çœ‹å…¨éƒ¨æ–‡ä»¶ç³»ç»Ÿï¼š<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">4<span class="comment">#root@rhel6 ~]#df -a</span></span></span><br><span class="line">Filesystem                    1K-blocks    Used Available Use% Mounted on</span><br><span class="line">/dev/mapper/vg_rhel6-LogVol01  17535796 3127044  13494936  19% /</span><br><span class="line">proc                                  0       0         0    - /proc</span><br><span class="line">sysfs                                 0       0         0    - /sys</span><br><span class="line">devpts                                0       0         0    - /dev/pts</span><br><span class="line">tmpfs                            510368      72    510296   1% /dev/shm</span><br><span class="line">/dev/vda1                        487652   58631    399325  13% /boot</span><br><span class="line">/dev/mapper/vg_rhel6-LogVol00    388480    2335    361569   1% /home</span><br><span class="line">none                                  0       0         0    - /proc/sys/fs/binfmt_misc</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="du"><a href="#du" class="headerlink" title="du"></a>du</h4><p><img src="pic/24.png" alt="24"></p>
<p>å®ä¾‹ï¼š</p>
<ol>
<li>æŸ¥çœ‹æŒ‡å®šç›®å½•æ‰€å ç©ºé—´<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">9<span class="comment">#root@rhel6 ~]#du -s /var/</span></span></span><br><span class="line">140252	/var/</span><br><span class="line"><span class="meta">[#</span><span class="bash">10<span class="comment">#root@rhel6 ~]#du -sh /var/</span></span></span><br><span class="line">137M	/var/</span><br></pre></td></tr></table></figure></li>
<li>æŸ¥çœ‹æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">16<span class="comment">#root@rhel6 ~]#du -h /tmp</span></span></span><br><span class="line">8.0K	/tmp/pulse-oCBy0hGD1JT6</span><br><span class="line">4.0K	/tmp/.X11-unix</span><br><span class="line">4.0K	/tmp/.esd-0</span><br><span class="line">4.0K	/tmp/virtual-root.JyC7Qb</span><br><span class="line">8.0K	/tmp/orbit-gdm</span><br><span class="line">4.0K	/tmp/.ICE-unix</span><br><span class="line">8.0K	/tmp/pulse-q5sECpImz7Ju</span><br><span class="line">48K	/tmp</span><br><span class="line"><span class="meta">[#</span><span class="bash">15<span class="comment">#root@rhel6 ~]#du -ha /tmp</span></span></span><br><span class="line">4.0K	/tmp/pulse-oCBy0hGD1JT6/pid</span><br><span class="line">0	/tmp/pulse-oCBy0hGD1JT6/native</span><br><span class="line">8.0K	/tmp/pulse-oCBy0hGD1JT6</span><br><span class="line">0	/tmp/.X11-unix/X0</span><br><span class="line">4.0K	/tmp/.X11-unix</span><br><span class="line">0	/tmp/.esd-0/socket</span><br><span class="line">4.0K	/tmp/.esd-0</span><br><span class="line">4.0K	/tmp/virtual-root.JyC7Qb</span><br><span class="line">4.0K	/tmp/.X0-lock</span><br><span class="line">0	/tmp/orbit-gdm/linc-6c2-0-7846478690c68</span><br><span class="line">0	/tmp/orbit-gdm/bonobo-activation-register-75c59b1ecf3edd6ad04cfcfd00000056.lock</span><br><span class="line">4.0K	/tmp/orbit-gdm/bonobo-activation-server-75c59b1ecf3edd6ad04cfcfd00000056-ior</span><br><span class="line">0	/tmp/orbit-gdm/linc-6e5-0-3bda60586d2f0</span><br><span class="line">0	/tmp/orbit-gdm/linc-6bb-0-2bf2fd0bb015c</span><br><span class="line">0	/tmp/orbit-gdm/linc-6e1-0-44f3459db98f9</span><br><span class="line">0	/tmp/orbit-gdm/linc-6d9-0-26db8cdee8dec</span><br><span class="line">0	/tmp/orbit-gdm/linc-6e0-0-7f7b8d4664593</span><br><span class="line">0	/tmp/orbit-gdm/linc-6e4-0-540f978681aee</span><br><span class="line">0	/tmp/orbit-gdm/linc-6d4-0-3a04cbe9566</span><br><span class="line">0	/tmp/orbit-gdm/linc-6d5-0-75caf0f81ab48</span><br><span class="line">8.0K	/tmp/orbit-gdm</span><br><span class="line">0	/tmp/.ICE-unix/1723</span><br><span class="line">4.0K	/tmp/.ICE-unix</span><br><span class="line">4.0K	/tmp/pulse-q5sECpImz7Ju/pid</span><br><span class="line">0	/tmp/pulse-q5sECpImz7Ju/native</span><br><span class="line">8.0K	/tmp/pulse-q5sECpImz7Ju</span><br><span class="line">48K	/tmp</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="ç£ç›˜çš„åˆ†å‰²ã€æ ¼å¼åŒ–ä¸æŒ‚è½½"><a href="#ç£ç›˜çš„åˆ†å‰²ã€æ ¼å¼åŒ–ä¸æŒ‚è½½" class="headerlink" title="ç£ç›˜çš„åˆ†å‰²ã€æ ¼å¼åŒ–ä¸æŒ‚è½½"></a>ç£ç›˜çš„åˆ†å‰²ã€æ ¼å¼åŒ–ä¸æŒ‚è½½</h2><p>æ–°å¢ä¸€é¢—ç¡¬ç›˜æ—¶ , è¯¥æ€ä¹ˆåš :</p>
<ol>
<li>å¯¹ç£ç›˜è¿›è¡Œåˆ†å‰² , ä»¥å»ºç«‹å¯ç”¨çš„åˆ†åŒº partition ; <fdisk></li>
<li>å¯¹è¯¥ partition è¿›è¡Œæ ¼å¼åŒ– ( format ), ä»¥å»ºç«‹ç³»ç»Ÿå¯ç”¨çš„æ–‡ä»¶ç³»ç»Ÿ filesystem;<mkfs></li>
<li>è‹¥æƒ³è¦ä»”ç»†ä¸€ç‚¹ , åˆ™å¯å¯¹åˆšåˆšå»ºç«‹å¥½çš„ filesystem è¿›è¡Œæ£€éªŒ ;&lt;fsck, badblocks&gt;</li>
<li>åœ¨ Linux ç³»ç»Ÿä¸Š , éœ€è¦å»ºç«‹æŒ‚è½½ç‚¹ ( ç›®å½• ), å¹¶å°†ä»–æŒ‚è½½ä¸Šæ¥ã€‚ <mount></li>
<li>å¦‚æœ ll /dev/ æ–°å»ºçš„åˆ†åŒºä¸å­˜åœ¨,åˆ™ä½¿ç”¨ partx -a /dev/vdb è®©æ–°å»ºçš„åˆ†åŒºè¢«è¯»å–ç”Ÿæ•ˆ,æˆ–è€…é‡å¯ç”µè„‘</li>
</ol>
<h3 id="åˆ†å‰²-fdisk"><a href="#åˆ†å‰²-fdisk" class="headerlink" title="åˆ†å‰² fdisk"></a>åˆ†å‰² fdisk</h3><p>fdiskå‘½ä»¤ç”¨äºè§‚å¯Ÿç¡¬ç›˜å®ä½“ä½¿ç”¨æƒ…å†µï¼Œä¹Ÿå¯å¯¹ç¡¬ç›˜åˆ†åŒºã€‚å®ƒé‡‡ç”¨ä¼ ç»Ÿçš„é—®ç­”å¼ç•Œé¢ã€‚</p>
<p>è¯­æ³• fdisk(é€‰é¡¹)(å‚æ•°)</p>
<p>é€‰é¡¹</p>
<ul>
<li>-b&lt;åˆ†åŒºå¤§å°&gt;ï¼šæŒ‡å®šæ¯ä¸ªåˆ†åŒºçš„å¤§å°ï¼›</li>
<li>-lï¼šåˆ—å‡ºæŒ‡å®šçš„å¤–å›´è®¾å¤‡çš„åˆ†åŒºè¡¨çŠ¶å†µï¼›</li>
<li>-s&lt;åˆ†åŒºç¼–å·&gt;ï¼šå°†æŒ‡å®šçš„åˆ†åŒºå¤§å°è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºä¸Šï¼Œå•ä½ä¸ºåŒºå—ï¼›</li>
<li>-uï¼šæ­é…â€-lâ€å‚æ•°åˆ—è¡¨ï¼Œä¼šç”¨åˆ†åŒºæ•°ç›®å–ä»£æŸ±é¢æ•°ç›®ï¼Œæ¥è¡¨ç¤ºæ¯ä¸ªåˆ†åŒºçš„èµ·å§‹åœ°å€ï¼›</li>
<li>-vï¼šæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚</li>
</ul>
<p>å‚æ•° è®¾å¤‡æ–‡ä»¶ï¼šæŒ‡å®šè¦è¿›è¡Œåˆ†åŒºæˆ–è€…æ˜¾ç¤ºåˆ†åŒºçš„ç¡¬ç›˜è®¾å¤‡æ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">20<span class="comment">#root@rhel6 ~]#fdisk -l</span></span></span><br><span class="line"></span><br><span class="line">Disk /dev/vda: 21.5 GB, 21474836480 bytes</span><br><span class="line">16 heads, 63 sectors/track, 41610 cylinders</span><br><span class="line">Units = cylinders of 1008 * 512 = 516096 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x000d166b</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/vda1   *           3        1018      512000   83  Linux</span><br><span class="line">Partition 1 does not end on cylinder boundary.</span><br><span class="line">/dev/vda2            1018        5179     2097152   82  Linux swap / Solaris</span><br><span class="line">Partition 2 does not end on cylinder boundary.</span><br><span class="line">/dev/vda3            5179       41611    18361344   8e  Linux LVM</span><br><span class="line">Partition 3 does not end on cylinder boundary.</span><br><span class="line"></span><br><span class="line">Disk /dev/vdb: 10.7 GB, 10737418240 bytes</span><br><span class="line">16 heads, 63 sectors/track, 20805 cylinders</span><br><span class="line">Units = cylinders of 1008 * 512 = 516096 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/vg_rhel6-LogVol01: 18.4 GB, 18379440128 bytes</span><br><span class="line">255 heads, 63 sectors/track, 2234 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/vg_rhel6-LogVol00: 419 MB, 419430400 bytes</span><br><span class="line">255 heads, 63 sectors/track, 50 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br><span class="line"><span class="meta">[#</span><span class="bash">21<span class="comment">#root@rhel6 ~]#fdisk /dev/vdb</span></span></span><br><span class="line">Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel</span><br><span class="line">Building a new DOS disklabel with disk identifier 0x23c41712.</span><br><span class="line">Changes will remain in memory only, until you decide to write them.</span><br><span class="line">After that, of course, the previous content won't be recoverable.</span><br><span class="line"></span><br><span class="line">Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)</span><br><span class="line"></span><br><span class="line">WARNING: DOS-compatible mode is deprecated. It's strongly recommended to</span><br><span class="line">         switch off the mode (command 'c') and change display units to</span><br><span class="line">         sectors (command 'u').</span><br><span class="line"></span><br><span class="line">Command (m for help): m &lt;== è¾“å…¥ m å , å°±ä¼šçœ‹åˆ°åº•ä¸‹è¿™äº›æŒ‡ä»¤ä»‹ç»</span><br><span class="line">Command action</span><br><span class="line">a toggle a bootable flag</span><br><span class="line">b edit bsd disklabel</span><br><span class="line">c toggle the dos compatibility flag</span><br><span class="line">d delete a partition &lt;== åˆ é™¤ä¸€ä¸ªåˆ†åŒº</span><br><span class="line">l list known partition types</span><br><span class="line">m print this menu</span><br><span class="line">n add a new partition &lt;== æ–°å¢ä¸€ä¸ªåˆ†åŒº</span><br><span class="line">o create a new empty DOS partition table</span><br><span class="line">p print the partition table== åœ¨å±å¹•ä¸Šæ˜¾ç¤ºåˆ†å‰²è¡¨</span><br><span class="line">q quit without saving changes&lt;== ä¸å‚¨å­˜ç¦»å¼€ fdisk ç¨‹åº</span><br><span class="line">s create a new empty Sun disklabel</span><br><span class="line">t change a partition's system id</span><br><span class="line">u change display/entry units</span><br><span class="line">v verify the partition table</span><br><span class="line">w write table to disk and exit&lt;== å°†åˆšåˆšçš„åŠ¨ä½œå†™å…¥åˆ†å‰²è¡¨</span><br><span class="line">x extra functionality (experts only)</span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/vdb: 10.7 GB, 10737418240 bytes</span><br><span class="line">16 heads, 63 sectors/track, 20805 cylinders</span><br><span class="line">Units = cylinders of 1008 * 512 = 516096 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x23c41712</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 1</span><br><span class="line">First cylinder (1-20805, default 1):</span><br><span class="line">Using default value 1</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-20805, default 20805):</span><br><span class="line">Using default value 20805</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/vdb: 10.7 GB, 10737418240 bytes</span><br><span class="line">16 heads, 63 sectors/track, 20805 cylinders</span><br><span class="line">Units = cylinders of 1008 * 512 = 516096 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x23c41712</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/vdb1               1       20805    10485688+  83  Linux</span><br><span class="line"></span><br><span class="line">Command (m for help): w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br><span class="line"><span class="meta">[#</span><span class="bash">22<span class="comment">#root@rhel6 ~]#ls /dev|grep vdb</span></span></span><br><span class="line">vdb</span><br><span class="line">vdb1</span><br><span class="line">[root@rhel7 ~]# fdisk /dev/vdb</span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain in memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table</span><br><span class="line">Building a new DOS disklabel with disk identifier 0x8366bb08.</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/vdb: 10.7 GB, 10737418240 bytes, 20971520 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x8366bb08</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p</span><br><span class="line">Partition number (1-4, default 1): 1</span><br><span class="line">First sector (2048-20971519, default 2048):</span><br><span class="line">Using default value 2048</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-20971519, default 20971519):</span><br><span class="line">Using default value 20971519</span><br><span class="line">Partition 1 of type Linux and of size 10 GiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/vdb: 10.7 GB, 10737418240 bytes, 20971520 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x8366bb08</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/vdb1            2048    20971519    10484736   83  Linux</span><br><span class="line"></span><br><span class="line">Command (m for help): w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure>

<h3 id="ç£ç›˜æ ¼å¼åŒ–-mkfs"><a href="#ç£ç›˜æ ¼å¼åŒ–-mkfs" class="headerlink" title="ç£ç›˜æ ¼å¼åŒ– mkfs"></a>ç£ç›˜æ ¼å¼åŒ– mkfs</h3><p><img src="pic/25.png" alt="25"></p>
<ol>
<li><p>rhel6å®ä¾‹ï¼šæŸ¥çœ‹æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿï¼›å°†/dev/vdb1æ ¼å¼åŒ–æˆext4æ–‡ä»¶ç³»ç»Ÿ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">23<span class="comment">#root@rhel6 ~]#mkfs</span></span></span><br><span class="line">mkfs          mkfs.cramfs   mkfs.ext2     mkfs.ext3     mkfs.ext4     mkfs.ext4dev  mkfs.msdos    mkfs.vfat</span><br><span class="line"><span class="meta">[#</span><span class="bash">24<span class="comment">#root@rhel6 ~]#mkfs.ext4 /dev/vdb1</span></span></span><br><span class="line">mke2fs 1.41.12 (17-May-2010)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS type: Linux</span><br><span class="line">Block size=4096 (log=2)</span><br><span class="line">Fragment size=4096 (log=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">655360 inodes, 2621422 blocks</span><br><span class="line">131071 blocks (5.00%) reserved for the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=2684354560</span><br><span class="line">80 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8192 inodes per group</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632</span><br><span class="line">Writing inode tables: done                            </span><br><span class="line">Creating journal (32768 blocks): done</span><br><span class="line">Writing superblocks and filesystem accounting information: done</span><br><span class="line">This filesystem will be automatically checked every 38 mounts or</span><br><span class="line">180 days, whichever comes first.  Use tune2fs -c or -i to override.</span><br></pre></td></tr></table></figure>
</li>
<li><p>rhel7å®ä¾‹ï¼šæŸ¥çœ‹æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿï¼›å°†/dev/vdb1æ ¼å¼åŒ–æˆxfsæ–‡ä»¶ç³»ç»Ÿ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# mkfs</span><br><span class="line">mkfs         mkfs.cramfs  mkfs.ext3    mkfs.fat     mkfs.msdos   mkfs.xfs     </span><br><span class="line">mkfs.btrfs   mkfs.ext2    mkfs.ext4    mkfs.minix   mkfs.vfat    </span><br><span class="line">[root@rhel7 ~]# mkfs.xfs /dev/vdb1</span><br><span class="line">meta-data=/dev/vdb1              isize=256    agcount=4, agsize=655296 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=0</span><br><span class="line">data     =                       bsize=4096   blocks=2621184, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=0</span><br><span class="line">log      =internal log           bsize=4096   blocks=2560, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h3 id="æŒ‚è½½"><a href="#æŒ‚è½½" class="headerlink" title="æŒ‚è½½"></a>æŒ‚è½½</h3><p>/etc/fstab</p>
<p>/etc/filesystems: ç³»ç»ŸæŒ‡å®šçš„æµ‹è¯•æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿç±»å‹ ;</p>
<p>/proc/filesystems:Linux ç³»ç»Ÿå·²ç»åŠ è½½çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚</p>
<h4 id="mount-çš„ç”¨æ³•"><a href="#mount-çš„ç”¨æ³•" class="headerlink" title="mount çš„ç”¨æ³•"></a>mount çš„ç”¨æ³•</h4><p>1) æ ‡å‡†ç”¨æ³• <code>mount -t ext4 /dev/vdb1 /mnt/vdb1</code></p>
<p>2) è¿œç¨‹æŒ‚è½½ <code>mount ip:/xx /xx</code></p>
<pre><code>`mount 172.25.254.250 : /content /mnt` &lt;== è¿œç¨‹æŒ‚è½½æ¡ˆä¾‹</code></pre><p>3) å…¶ä»–é€‰é¡¹:</p>
<p>A.-o loop æŒ‚è½½é•œåƒæ–‡ä»¶</p>
<ul>
<li>ç”¨æ³•: mount -o loop è¢«æŒ‚è½½çš„æ–‡ä»¶ æŒ‚è½½ç‚¹</li>
<li>ä¾‹å¦‚: mount -o loop rhel-server-6.5-x86_64-dvd.iso /test</li>
</ul>
<p>B.-o ro ä»¥åªè¯»æ–¹å¼æŒ‚è½½</p>
<ul>
<li>ç”¨æ³•: mount -o ro è¢«æŒ‚åœ¨çš„è®¾å¤‡ æŒ‚è½½ç‚¹</li>
<li>ä¾‹å¦‚: mount -o ro /dev/vdb1 /test</li>
</ul>
<p>C.-o remount é‡æ–°æŒ‚è½½</p>
<ul>
<li><p>ç”¨æ³•: mount -o remount è¢«æŒ‚è½½çš„è®¾å¤‡ æŒ‚è½½ç‚¹</p>
</li>
<li><p>ä¾‹å¦‚: mount -o remount,rw,auto / &lt;== é‡æ–°æŒ‚è½½æ ¹ç›®å½•</p>
<p>mount -o remount,ro newdir &lt;== é‡æ–°æŒ‚è½½ä¸ºåªè¯»</p>
</li>
</ul>
<p>D.-t iso9660 æŒ‚è½½CD/DVD</p>
<ul>
<li>ç”¨æ³•: mount -t iso9660 è¢«æŒ‚è½½çš„è®¾å¤‡ æŒ‚è½½ç‚¹</li>
<li>ä¾‹å¦‚: mount -t iso9660 /dev/dvdrom /media/dvdrom</li>
</ul>
<h4 id="mount-çš„æŸ¥çœ‹"><a href="#mount-çš„æŸ¥çœ‹" class="headerlink" title="mount çš„æŸ¥çœ‹"></a>mount çš„æŸ¥çœ‹</h4><p>df -h</p>
<p>mount &lt;== æŸ¥çœ‹è®¾å¤‡å’Œç›®å½•æŒ‚è½½ç‚¹çš„å…³ç³»</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[#</span><span class="bash">27<span class="comment">#root@rhel6 ~]#mount</span></span></span><br><span class="line">/dev/mapper/vg_rhel6-LogVol01 on / type ext4 (rw)</span><br><span class="line">proc on /proc type proc (rw)</span><br><span class="line">sysfs on /sys type sysfs (rw)</span><br><span class="line">devpts on /dev/pts type devpts (rw,gid=5,mode=620)</span><br><span class="line">tmpfs on /dev/shm type tmpfs (rw,rootcontext="system_u:object_r:tmpfs_t:s0")</span><br><span class="line">/dev/vda1 on /boot type ext4 (rw)</span><br><span class="line">/dev/mapper/vg_rhel6-LogVol00 on /home type ext4 (rw)</span><br><span class="line">none on /proc/sys/fs/binfmt_misc type binfmt_misc (rw)</span><br></pre></td></tr></table></figure>

<h4 id="umount"><a href="#umount" class="headerlink" title="umount"></a>umount</h4><p>umount [-fn] è®¾å¤‡æ–‡ä»¶åä¸æŒ‚è½½ç‚¹</p>
<p>umount /mnt</p>
<p>æ³¨æ„äº‹é¡¹:</p>
<ol>
<li>å¯¹æŸä¸ªæŒ‚è½½ç‚¹ä½¿ç”¨å¤šæ¬¡ mount ,ä¼šæŠŠä¹‹å‰çš„å†…å®¹éšè—èµ·æ¥,åªèƒ½çœ‹åˆ°æœ€åä¸€æ¬¡æŒ‚è½½çš„è®¾å¤‡æ–‡ä»¶é‡Œçš„å†…å®¹</li>
<li>ä¸è¦åœ¨æŒ‚è½½ç‚¹é‡Œé¢æ‰§è¡Œ umount å‘½ä»¤,ä¼šæŠ¥é”™</li>
<li>å°½é‡ä¸è¦åœ¨æŒ‚è½½ç‚¹é‡Œæ‰§è¡Œ mount æŒ‚è½½å‘½ä»¤</li>
<li>mount å‘½ä»¤ä¸ºä¸´æ—¶ç”Ÿæ•ˆ</li>
</ol>
<h3 id="etc-fstab-å°†æ°¸ä¹…ç”Ÿæ•ˆ"><a href="#etc-fstab-å°†æ°¸ä¹…ç”Ÿæ•ˆ" class="headerlink" title="/etc/fstab å°†æ°¸ä¹…ç”Ÿæ•ˆ"></a>/etc/fstab å°†æ°¸ä¹…ç”Ÿæ•ˆ</h3><p><img src="pic/26.png" alt="26"></p>
<p>æ˜¯å¦éœ€è¦æ£€æµ‹:é 0 ä»£è¡¨æ£€æµ‹,æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</p>
<p>ä¿®æ”¹åä¿å­˜,é€šè¿‡ <code>mount -a</code>è®©é…ç½®ç”Ÿæ•ˆ</p>
<h2 id="ç£ç›˜é…é¢-Quota"><a href="#ç£ç›˜é…é¢-Quota" class="headerlink" title="ç£ç›˜é…é¢ Quota"></a>ç£ç›˜é…é¢ Quota</h2><p>å¦‚å‰é¢ä»‹ç»ç« èŠ‚è®²åˆ°çš„ç±» Unix ç³»ç»Ÿæœ€åˆè®¾è®¡ç†å¿µå°±è®©è®¸å¤šäººä¸€èµ·ä½¿ç”¨,å¤šä»»åŠ¡çš„æ“ä½œç³»ç»Ÿ,ä½†æ˜¯ç¡¬ä»¶çš„èµ„æºæ˜¯å›ºå®šæœ‰é™ çš„,å¦‚æœå‡ºç°ä¸ªå°ç ´åä»½å­ä¸æ–­çš„åˆ›å»ºæ–‡ä»¶æˆ–ä¸‹è½½ç”µå½±,é‚£ä¹ˆç¡¬ç›˜ç©ºé—´æ€»æœ‰ä¸€å¤©ä¼šè¢«å æ»¡çš„å§,è¿™æ—¶å°±éœ€è¦ quotaæœåŠ¡ å¸®åŠ©æˆ‘ä»¬ä¸ºæ¯ä¸ªç”¨æˆ·é™åˆ¶å¯ä»¥ä½¿ç”¨çš„ç¡¬ç›˜ç©ºé—´,ä¸€æ—¦è¶…å‡ºé¢„ç®—å°±ä¸å†å…è®¸ä»–ä»¬ä½¿ç”¨ã€‚</p>
<h3 id="ä½œç”¨å’Œåˆ†ç±»"><a href="#ä½œç”¨å’Œåˆ†ç±»" class="headerlink" title="ä½œç”¨å’Œåˆ†ç±»"></a>ä½œç”¨å’Œåˆ†ç±»</h3><p>quota çš„ç£ç›˜é…é¢å¯ä»¥é™åˆ¶ç”¨æˆ·çš„ç¡¬ç›˜å¯ç”¨ç©ºé—´æˆ–æœ€å¤§åˆ›å»ºæ–‡ä»¶æ•°é‡,å¹¶ä¸”è¿˜æœ‰è½¯/ç¡¬é™åˆ¶çš„åŒºåˆ«:</p>
<ul>
<li>è½¯é™åˆ¶:å½“è¾¾åˆ°è½¯é™åˆ¶æ—¶ä¼šæç¤ºç”¨æˆ·,ä½†å…è®¸ç”¨æˆ·åœ¨è§„å®šæœŸé™å†…ç»§ç»­ä½¿ç”¨ã€‚</li>
<li>ç¡¬é™åˆ¶:å½“è¾¾åˆ°ç¡¬é™åˆ¶æ—¶ä¼šæç¤ºç”¨æˆ·,ä¸”å¼ºåˆ¶ç»ˆæ­¢ç”¨æˆ·çš„æ“ä½œã€‚</li>
</ul>
<h3 id="ç›¸å…³å‘½ä»¤"><a href="#ç›¸å…³å‘½ä»¤" class="headerlink" title="ç›¸å…³å‘½ä»¤"></a>ç›¸å…³å‘½ä»¤</h3><h4 id="quotacheck"><a href="#quotacheck" class="headerlink" title="quotacheck"></a>quotacheck</h4><p>quotacheckå‘½ä»¤é€šè¿‡æ‰«ææŒ‡å®šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œè·å–ç£ç›˜çš„ä½¿ç”¨æƒ…å†µï¼Œåˆ›å»ºã€æ£€æŸ¥å’Œä¿®å¤ç£ç›˜é…é¢ï¼ˆquotaï¼‰æ–‡ä»¶ã€‚æ‰§è¡ŒquotacheckæŒ‡ä»¤ï¼Œæ‰«ææŒ‚å…¥ç³»ç»Ÿçš„åˆ†åŒºï¼Œå¹¶åœ¨å„åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿæ ¹ç›®å½•ä¸‹äº§ç”Ÿquota.userå’Œquota.groupæ–‡ä»¶ï¼Œè®¾ç½®ç”¨æˆ·å’Œç¾¤ç»„çš„ç£ç›˜ç©ºé—´é™åˆ¶ã€‚</p>
<p>è¯­æ³• quotacheck(é€‰é¡¹)(å‚æ•°)</p>
<p>é€‰é¡¹</p>
<ul>
<li>-aï¼šæ‰«æåœ¨/etc/fstabæ–‡ä»¶é‡Œï¼Œæœ‰åŠ å…¥quotaè®¾ç½®çš„åˆ†åŒºï¼›</li>
<li>-dï¼šè¯¦ç»†æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼Œä¾¿äºæ’é”™æˆ–äº†è§£ç¨‹åºæ‰§è¡Œçš„æƒ…å½¢ï¼›</li>
<li>-gï¼šæ‰«æç£ç›˜ç©ºé—´æ—¶ï¼Œè®¡ç®—æ¯ä¸ªç¾¤ç»„è¯†åˆ«ç æ‰€å ç”¨çš„ç›®å½•å’Œæ–‡ä»¶æ•°ç›®ï¼›</li>
<li>-Rï¼šæ’é™¤æ ¹ç›®å½•æ‰€åœ¨çš„åˆ†åŒºï¼›</li>
<li>-uï¼šæ‰«æç£ç›˜ç©ºé—´æ—¶ï¼Œè®¡ç®—æ¯ä¸ªç”¨æˆ·è¯†åˆ«ç æ‰€å ç”¨çš„ç›®å½•å’Œæ–‡ä»¶æ•°ç›®ï¼›</li>
<li>-vï¼šæ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ã€‚</li>
</ul>
<p>å‚æ•° æ–‡ä»¶ç³»ç»Ÿï¼šæŒ‡å®šè¦æ‰«æçš„æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<h4 id="quota"><a href="#quota" class="headerlink" title="quota"></a>quota</h4><p>quotaå‘½ä»¤ç”¨äºæ˜¾ç¤ºç”¨æˆ·æˆ–è€…å·¥ä½œç»„çš„ç£ç›˜é…é¢ä¿¡æ¯ã€‚è¾“å‡ºä¿¡æ¯åŒ…æ‹¬ç£ç›˜ä½¿ç”¨å’Œé…é¢é™åˆ¶ã€‚</p>
<p>è¯­æ³• quota(é€‰é¡¹)(å‚æ•°)</p>
<p>é€‰é¡¹</p>
<ul>
<li>-gï¼šåˆ—å‡ºç¾¤ç»„çš„ç£ç›˜ç©ºé—´é™åˆ¶ï¼›</li>
<li>-qï¼šç®€æ˜åˆ—è¡¨ï¼Œåªåˆ—å‡ºè¶…è¿‡é™åˆ¶çš„éƒ¨åˆ†ï¼›</li>
<li>-uï¼šåˆ—å‡ºç”¨æˆ·çš„ç£ç›˜ç©ºé—´é™åˆ¶ï¼›</li>
<li>-vï¼šæ˜¾ç¤ºè¯¥ç”¨æˆ·æˆ–ç¾¤ç»„ï¼Œåœ¨æ‰€æœ‰æŒ‚å…¥ç³»ç»Ÿçš„å­˜å‚¨è®¾å¤‡çš„ç©ºé—´é™åˆ¶ï¼›</li>
<li>-Vï¼šæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚</li>
</ul>
<p>å‚æ•° ç”¨æˆ·æˆ–è€…å·¥ä½œç»„ï¼šæŒ‡å®šè¦æ˜¾ç¤ºçš„ç”¨æˆ·æˆ–è€…å·¥ä½œç»„ã€‚</p>
<h4 id="quotaon"><a href="#quotaon" class="headerlink" title="quotaon"></a>quotaon</h4><p>quotaonå‘½ä»¤ç”¨äºæ¿€æ´»Linuxå†…æ ¸ä¸­æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜é…é¢åŠŸèƒ½ã€‚</p>
<p>è¯­æ³• quotaon(é€‰é¡¹)(å‚æ•°)</p>
<p>é€‰é¡¹</p>
<ul>
<li>-aï¼šå¼€å¯åœ¨/ect/fstabæ–‡ä»¶é‡Œï¼Œæœ‰åŠ å…¥quotaè®¾ç½®çš„åˆ†åŒºçš„ç©ºé—´é™åˆ¶ï¼›</li>
<li>-gï¼šå¼€å¯ç¾¤ç»„çš„ç£ç›˜ç©ºé—´é™åˆ¶ï¼›</li>
<li>-uï¼šå¼€å¯ç”¨æˆ·çš„ç£ç›˜ç©ºé—´é™åˆ¶ï¼›</li>
<li>-vï¼šæ˜¾ç¤ºæŒ‡ä»¤æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ã€‚</li>
</ul>
<p>å‚æ•° æ–‡ä»¶ç³»ç»Ÿï¼šæŒ‡å®šè¦æ¿€æ´»ç£ç›˜é…é¢åŠŸèƒ½çš„æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<h4 id="repquota"><a href="#repquota" class="headerlink" title="repquota"></a>repquota</h4><p>repquotaå‘½ä»¤ä»¥æŠ¥è¡¨çš„æ ¼å¼è¾“å‡ºæŒ‡å®šåˆ†åŒºï¼Œæˆ–è€…æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜é…é¢ä¿¡æ¯ã€‚</p>
<p>è¯­æ³• repquota(é€‰é¡¹)(å‚æ•°)</p>
<p>é€‰é¡¹</p>
<ul>
<li>-aï¼šåˆ—å‡ºåœ¨/etc/fstabæ–‡ä»¶é‡Œï¼Œæœ‰åŠ å…¥quotaè®¾ç½®çš„åˆ†åŒºçš„ä½¿ç”¨çŠ¶å†µï¼ŒåŒ…æ‹¬ç”¨æˆ·å’Œç¾¤ç»„ï¼›</li>
<li>-gï¼šåˆ—å‡ºæ‰€æœ‰ç¾¤ç»„çš„ç£ç›˜ç©ºé—´é™åˆ¶ï¼›</li>
<li>-uï¼šåˆ—å‡ºæ‰€æœ‰ç”¨æˆ·çš„ç£ç›˜ç©ºé—´é™åˆ¶ï¼›</li>
<li>-vï¼šæ˜¾ç¤ºè¯¥ç”¨æˆ·æˆ–ç¾¤ç»„çš„æ‰€æœ‰ç©ºé—´é™åˆ¶ã€‚</li>
</ul>
<p>å‚æ•° æ–‡ä»¶ç³»ç»Ÿï¼šè¦æ‰“å°æŠ¥è¡¨çš„æ–‡ä»¶ç³»ç»Ÿæˆ–è€…å¯¹åº”çš„è®¾å¤‡æ–‡ä»¶åã€‚</p>
<h4 id="edquota"><a href="#edquota" class="headerlink" title="edquota"></a>edquota</h4><p>edquota å‘½ä»¤ç”¨äºè¶…çº§ç”¨æˆ·ç¼–è¾‘å…¶ä»–ç”¨æˆ·çš„ quota é…é¢é™åˆ¶</p>
<p>æ ¼å¼ä¸º: â€œ edquota [å‚æ•°] [ç”¨æˆ·]â€ã€‚</p>
<p>å‚æ•° ä½œç”¨</p>
<ul>
<li>-u ç¼–è¾‘ç”¨æˆ·çš„é…é¢é™åˆ¶ã€‚</li>
<li>-g ç¼–è¾‘ç”¨æˆ·ç»„çš„é…é¢é™åˆ¶ã€‚</li>
<li>-r é€šè¿‡ RPC åè®®ç¼–è¾‘è¿œç¨‹çš„é…é¢ã€‚</li>
</ul>
<h4 id="xfs-quota"><a href="#xfs-quota" class="headerlink" title="xfs_quota"></a>xfs_quota</h4><p>xfs_quota å‘½ä»¤ç”¨äºç®¡ç† XFS æ–‡ä»¶ç³»ç»Ÿçš„ quota ç¡¬ç›˜é…é¢</p>
<p>æ ¼å¼ä¸º: â€œ quota [å‚æ•°] é…é¢ æ–‡ä»¶ç³»ç»Ÿ â€ ã€‚</p>
<p>å‚æ•° ä½œç”¨</p>
<ul>
<li>-c å‘½ä»¤ ä»¥äº¤æ¢å¼æˆ–å‚æ•°çš„å½¢å¼è®¾ç½®è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</li>
<li>-p è®¾ç½®æç¤ºæˆ–æŠ¥é”™ä¿¡æ¯çš„ç¨‹åºåç§°,é»˜è®¤ä¸º xfs_quotaã€‚</li>
<li>-x ä¸“å®¶æ¨¡å¼,èƒ½å¤Ÿå¯¹ quota åšæ›´å¤šå¤æ‚çš„é…ç½®ã€‚</li>
</ul>
<h3 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h3><h4 id="rhel6-quotaå®éªŒ"><a href="#rhel6-quotaå®éªŒ" class="headerlink" title="rhel6 quotaå®éªŒ"></a>rhel6 quotaå®éªŒ</h4><p>åˆ’åˆ†åˆ†åŒº/dev/vdb2ï¼Œæ ¼å¼åŒ–æˆext4æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æŒ‚è½½åœ¨studentå®¶ç›®å½•ä¸‹ä½¿ç”¨ï¼Œé™åˆ¶ç£ç›˜è½¯é™åˆ¶ä¸º 3Mã€ç£ç›˜ç¡¬é™åˆ¶ä¸º 6Mã€æ–‡ä»¶è½¯é™åˆ¶ä¸º 20 ä¸ªä¸”æ–‡ä»¶ç¡¬é™åˆ¶ä¸º 30 ä¸ª</p>
<ol>
<li>æŒ‚è½½æ—¶éœ€è¦åŠ ä¸Š -o usrquota,grpquota é€‰é¡¹ ï¼šmount -o usrquota,grpquota /dev/vdb2 /home/student</li>
<li>/etc/skel éœ€è¦çš„æ–‡ä»¶éœ€è¦å¤åˆ¶åˆ°å®¶ç›®å½•ä¸‹ ï¼šcp .bash* .gnome2 .mozilla -r /home/student</li>
<li>ä¿®æ”¹å®¶ç›®å½•æƒé™ ï¼šchown student.student /home/student ;setenforce 0</li>
<li>æ£€æµ‹:quotacheck -cugm /home/student/ æ£€æµ‹ç»“æœ : aquota.group aquota.user &lt;== åªæœ‰ root ç”¨æˆ·æœ‰è¯»å†™æƒé™</li>
<li>æ¿€æ´» :quotaon /home/student</li>
<li>æ‰“å°ç£ç›˜é…é¢çš„æŠ¥å‘Š :repquota /home/student</li>
<li>ç¼–è¾‘edquota student</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel6 ~]# mount -o usrquota,grpquota /dev/vdb2 /home/student</span><br><span class="line">[root@rhel6 ~]# ll /home/student</span><br><span class="line">total 16</span><br><span class="line">drwx------. 2 root root 16384 Jul  1 15:56 lost+found</span><br><span class="line">[root@rhel6 ~]# cd /etc/skel</span><br><span class="line">[root@rhel6 skel]# cp .bash* .gnome* .moz* -r /home/student</span><br><span class="line">[root@rhel6 skel]# ll /home/student -a</span><br><span class="line">total 42</span><br><span class="line">drwxr-xr-x. 5 root root  4096 Jul  1 16:00 .</span><br><span class="line">drwxr-xr-x. 4 root root  1024 Jul  2  2015 ..</span><br><span class="line">-rw-r--r--. 1 root root    18 Jul  1 16:00 .bash_logout</span><br><span class="line">-rw-r--r--. 1 root root   176 Jul  1 16:00 .bash_profile</span><br><span class="line">-rw-r--r--. 1 root root   124 Jul  1 16:00 .bashrc</span><br><span class="line">drwxr-xr-x. 2 root root  4096 Jul  1 16:00 .gnome2</span><br><span class="line">drwx------. 2 root root 16384 Jul  1 15:56 lost+found</span><br><span class="line">drwxr-xr-x. 4 root root  4096 Jul  1 16:00 .mozilla</span><br><span class="line">[root@rhel6 skel]# chown student. /home/student -R</span><br><span class="line">[root@rhel6 skel]# setenforce 0</span><br><span class="line">[root@rhel6 skel]# quotacheck -cugm /home/student</span><br><span class="line">[root@rhel6 skel]# ll /home/student</span><br><span class="line">total 32</span><br><span class="line">-rw-------. 1 root    root     6144 Jul  1 16:03 aquota.group</span><br><span class="line">-rw-------. 1 root    root     6144 Jul  1 16:03 aquota.user</span><br><span class="line">drwx------. 2 student student 16384 Jul  1 15:56 lost+found</span><br><span class="line">[root@rhel6 skel]# quotaon /home/student</span><br><span class="line">[root@rhel6 skel]# repquota /home/student</span><br><span class="line">*** Report for user quotas on device /dev/vdb2</span><br><span class="line">Block grace time: 7days; Inode grace time: 7days</span><br><span class="line">                        Block limits                File limits</span><br><span class="line">User            used    soft    hard  grace    used  soft  hard  grace</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">student   --      48       0       0              9     0     0       </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rhel6 skel]# edquota student</span><br><span class="line">edquota: WARNING - /dev/vdb2: cannot change current inode allocation</span><br><span class="line">[root@rhel6 skel]# edquota student</span><br><span class="line">[root@rhel6 skel]# repquota /home/student</span><br><span class="line">*** Report for user quotas on device /dev/vdb2</span><br><span class="line">Block grace time: 7days; Inode grace time: 7days</span><br><span class="line">                        Block limits                File limits</span><br><span class="line">User            used    soft    hard  grace    used  soft  hard  grace</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">student   -+      48    3072    6144              9     3     6  7days</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rhel6 skel]# quota student</span><br><span class="line">Disk quotas for user student (uid 500):</span><br><span class="line">     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace</span><br><span class="line">      /dev/vdb2      48    3072    6144               9*      3       6   7days</span><br><span class="line">[root@rhel6 skel]# su - student</span><br><span class="line">[student@rhel6 ~]$ touch file&#123;1..10&#125;</span><br><span class="line">vdb2: write failed, user file limit reached.</span><br><span class="line">touch: cannot touch `file1': Disk quota exceeded</span><br><span class="line">touch: cannot touch `file2': Disk quota exceeded</span><br><span class="line">touch: cannot touch `file3': Disk quota exceeded</span><br><span class="line">touch: cannot touch `file4': Disk quota exceeded</span><br><span class="line">touch: cannot touch `file5': Disk quota exceeded</span><br><span class="line">touch: cannot touch `file6': Disk quota exceeded</span><br><span class="line">touch: cannot touch `file7': Disk quota exceeded</span><br><span class="line">touch: cannot touch `file8': Disk quota exceeded</span><br><span class="line">touch: cannot touch `file9': Disk quota exceeded</span><br><span class="line">touch: cannot touch `file10': Disk quota exceeded</span><br></pre></td></tr></table></figure>

<h4 id="rhel7-quotaå®éªŒ"><a href="#rhel7-quotaå®éªŒ" class="headerlink" title="rhel7 quotaå®éªŒ"></a>rhel7 quotaå®éªŒ</h4><p>rootç”¨æˆ·ï¼š</p>
<ol>
<li><p>æŸ¥çœ‹å†…æ ¸æ˜¯å¦æ”¯æŒ quota åŠŸèƒ½: dmesg | grep quota</p>
</li>
<li><p>æŸ¥çœ‹ quota ç¨‹åºåŒ…æ˜¯å¦å·²ç»å®‰è£…: rpm -q quota</p>
</li>
<li><p>æŸ¥çœ‹ boot ç›®å½•æ˜¯å¦æ”¯æŒ quota åŠŸèƒ½(noquota è¡¨ç¤ºæš‚æ—¶ä¸æ”¯æŒ): mount|grep boot</p>
</li>
<li><p>è®©/boot ç›®å½•æ”¯æŒ quota åŠŸèƒ½: vim /etc/fstab å±æ€§ä¸­æ·»åŠ usrquota</p>
</li>
<li><p>é‡å¯ä¸»æœºåå³å¯ç”Ÿæ•ˆ: reboot</p>
</li>
<li><p>æŸ¥çœ‹ boot ç›®å½•æ˜¯å¦æ”¯æŒ quota åŠŸèƒ½(usrquota è¡¨ç¤ºå·²ç»æ”¯æŒ): mount|grep boot</p>
</li>
<li><p>åˆ›å»ºä¸€ä¸ªç”¨äº quota å®éªŒçš„ç”¨æˆ· tom: useradd tom &amp;&amp; echo uplooking|passwd tom</p>
</li>
<li><p>éœ€è¦å…è®¸å…¶ä»–ç”¨æˆ·å¯¹/boot ç›®å½•å†™å…¥æ–‡ä»¶æ“ä½œ: chmod -Rf o+w /boot</p>
</li>
<li><p>ä½¿ç”¨ xfs_quota å‘½ä»¤è®¾ç½®å¯¹ tom ç”¨æˆ·åœ¨/boot ç›®å½•çš„ç£ç›˜é…é¢,å…·ä½“è¦æ±‚å¦‚ä¸‹:<br>ä½¿ç”¨ quota ä¸“å®¶æ¨¡å¼é™åˆ¶ç£ç›˜è½¯é™åˆ¶ä¸º 3mã€ç£ç›˜ç¡¬é™åˆ¶ä¸º 6mã€æ–‡ä»¶è½¯é™åˆ¶ä¸º 3 ä¸ªä¸”æ–‡ä»¶ç¡¬é™åˆ¶ä¸º 6 ä¸ªã€‚ è·å–å½“å‰/boot ç›®å½•ä¸Šçš„ quota é…é¢é™åˆ¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xfs_quota -x -c 'limit bsoft=3m bhard=6m isoft=3 ihard=6 tom' /boot</span><br><span class="line">xfs_quota -x -c report /boot</span><br></pre></td></tr></table></figure>
<p>åˆ‡æ¢è‡³ tom ç”¨æˆ·: su - tom</p>
</li>
<li><p>æ­£å¸¸åˆ›å»ºäº†ä¸€ä¸ªä¸º 5M çš„æ–‡ä»¶: dd if=/dev/zero of=/boot/tom bs=5M count=1</p>
</li>
<li><p>åˆ›å»º 8M æ–‡ä»¶æ—¶å¼ºåˆ¶ç»ˆæ­¢å¹¶æŠ¥é”™äº†: dd if=/dev/zero of=/boot/tom bs=8M count=1</p>
</li>
<li><p>æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„ quota é™åˆ¶(æ˜¾ç¤ºç¡¬ç›˜é…é¢å·²å æ»¡): quota</p>
</li>
</ol>
<p>åˆ‡æ¢è‡³rootç”¨æˆ·ï¼šexit</p>
<ol>
<li>ç¼–è¾‘ tom çš„é…é¢é™åˆ¶,å°†ç¡¬ç›˜çš„ç¡¬é™åˆ¶ä¿®æ”¹ä¸º 8m(8192k): edquota -u tom</li>
</ol>
<p>åˆ‡æ¢è‡³ tom ç”¨æˆ·: su - tom</p>
<ol>
<li>å†æ¥åˆ›å»º 8m çš„æ–‡ä»¶å°±ä¸ä¼šæœ‰é—®é¢˜äº†: dd if=/dev/zero of=/boot/tom bs=8M count=1</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@rhel7 ~]# dmesg|grep quota</span><br><span class="line">[    0.836809] VFS: Disk quotas dquot_6.5.2</span><br><span class="line">[root@rhel7 ~]# rpm -q quota</span><br><span class="line">quota-4.01-11.el7.x86_64</span><br><span class="line">[root@rhel7 ~]# mount|grep boot</span><br><span class="line">/dev/vda1 on /boot type xfs (rw,relatime,seclabel,attr2,inode64,noquota)</span><br><span class="line">[root@rhel7 ~]# vim /etc/fstab</span><br><span class="line">UUID=abbadca9-0a0d-453f-b713-d3d978cd6909 /boot                   xfs     defaults,usrquota        1 2</span><br><span class="line">[root@rhel7 ~]# reboot</span><br><span class="line">[root@rhel7 ~]# mount|grep boot</span><br><span class="line">/dev/vda1 on /boot type xfs (rw,relatime,seclabel,attr2,inode64,usrquota)</span><br><span class="line">[root@rhel7 ~]# useradd tom</span><br><span class="line">[root@rhel7 ~]# passwd tom</span><br><span class="line">Changing password for user tom.</span><br><span class="line">New password:</span><br><span class="line">BAD PASSWORD: The password fails the dictionary check - it is based on a dictionary word</span><br><span class="line">Retype new password:</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">[root@rhel7 ~]# chmod -Rf o+w /boot</span><br><span class="line">[root@rhel7 ~]# ll -d /boot</span><br><span class="line">dr-xr-xrwx. 3 root root 4096 Jun 27 03:59 /boot</span><br><span class="line">[root@rhel7 ~]# xfs_quota -x -c 'limit bsoft=3m bhard=6m isoft=3 ihard=6 tom' /boot</span><br><span class="line">[root@rhel7 ~]# xfs_quota -x -c report /boot</span><br><span class="line">User quota on /boot (/dev/vda1)</span><br><span class="line">                               Blocks                     </span><br><span class="line">User ID          Used       Soft       Hard    Warn/Grace     </span><br><span class="line">---------- --------------------------------------------------</span><br><span class="line">root           120384          0          0     00 [--------]</span><br><span class="line">tom                 0       3072       6144     00 [--------]</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# su - tom</span><br><span class="line">Last login: Fri Jul  1 02:51:33 EDT 2016 on pts/0</span><br><span class="line">[tom@rhel7 ~]$ dd if=/dev/zero of=/boot/tom bs=5M count=1</span><br><span class="line">1+0 records in</span><br><span class="line">1+0 records out</span><br><span class="line">5242880 bytes (5.2 MB) copied, 0.0270144 s, 194 MB/s</span><br><span class="line">[tom@rhel7 ~]$ dd if=/dev/zero of=/boot/tom bs=8M count=1</span><br><span class="line">dd: error writing â€˜/boot/tomâ€™: Disk quota exceeded</span><br><span class="line">1+0 records in</span><br><span class="line">0+0 records out</span><br><span class="line">6291456 bytes (6.3 MB) copied, 0.218067 s, 28.9 MB/s</span><br><span class="line">[tom@rhel7 ~]$ quota</span><br><span class="line">Disk quotas for user tom (uid 1001):</span><br><span class="line">     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace</span><br><span class="line">      /dev/vda1    6144*   3072    6144   6days       1       3       6  </span><br><span class="line">[tom@rhel7 ~]$ exit</span><br><span class="line">logout</span><br><span class="line">[root@rhel7 ~]# edquota -u tom</span><br><span class="line">Disk quotas for user tom (uid 1001):</span><br><span class="line">  Filesystem                   blocks       soft       hard     inodes     soft     hard</span><br><span class="line">  /dev/vda1                      8192       3072       8192          1        3        6</span><br><span class="line">[root@rhel7 ~]# xfs_quota -x -c report /boot</span><br><span class="line">User quota on /boot (/dev/vda1)</span><br><span class="line">                               Blocks                     </span><br><span class="line">User ID          Used       Soft       Hard    Warn/Grace     </span><br><span class="line">---------- --------------------------------------------------</span><br><span class="line">root           120384          0          0     00 [--------]</span><br><span class="line">tom              6144       3072       8192     00  [6 days]</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# su - tom</span><br><span class="line">Last login: Fri Jul  1 02:58:22 EDT 2016 on pts/0</span><br><span class="line">[tom@rhel7 ~]$ dd if=/dev/zero of=/boot/tom bs=8M count=1</span><br><span class="line">1+0 records in</span><br><span class="line">1+0 records out</span><br><span class="line">8388608 bytes (8.4 MB) copied, 0.267325 s, 31.4 MB/s</span><br><span class="line">[tom@rhel7 ~]$ exit</span><br><span class="line">logout</span><br></pre></td></tr></table></figure>

<h2 id="é€»è¾‘å·ç®¡ç†-LVM"><a href="#é€»è¾‘å·ç®¡ç†-LVM" class="headerlink" title="é€»è¾‘å·ç®¡ç† LVM"></a>é€»è¾‘å·ç®¡ç† LVM</h2><p>é€»è¾‘å·ç®¡ç† (Logical Volume Manager)</p>
<h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><p>å½“ç”¨æˆ·æ ¹æ®å®é™…æƒ…å†µéœ€è¦å¯¹åˆ†åŒºå¢åŠ ã€å‡å°ç­‰è°ƒæ•´æ—¶,ç»å¸¸ä¼šå—åˆ°ç¡¬ç›˜ â€œ çµæ´»æ€§ â€ çš„é™åˆ¶,å¾ˆä¸æ–¹ä¾¿ã€‚</p>
<p>é€»è¾‘å·ç®¡ç†å™¨åˆ™æ˜¯åœ¨ç£ç›˜åˆ†åŒºä¸æ–‡ä»¶ç³»ç»Ÿä¹‹é—´æ·»åŠ çš„é€»è¾‘å±‚,æä¾›ä¸€ä¸ªæŠ½è±¡çš„å·ç»„,ä½¿å¾—ç®¡ç†è€…å¯ä»¥å¿½ç•¥åº•å±‚ç£ç›˜å¸ƒå±€, ä»è€Œå®ç°å¯¹åˆ†åŒºçš„çµæ´»åŠ¨æ€è°ƒæ•´,è¿™æ¯«ä¸å¤¸å¼ ,æ‰€ä»¥çº¢å¸½ RHEL7 ç³»ç»Ÿå·²ç»é»˜è®¤å¯ç”¨äº† LVM(Logical Volume Manager) æœºåˆ¶ã€‚</p>
<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p><img src="pic/00.png" alt="00"></p>
<p>å°†ç‰©ç†åˆ†åŒºåšæˆ pv ï¼›å°† pv ç»„åˆæˆ vg ï¼›å†ä» vg åˆ†å‡º lv åˆ†åŒº â€“&gt;pvâ€“&gt;vgâ€“&gt;lv</p>
<ul>
<li>ç‰©ç†å·(PV,Physical Volume ): æ•´ä¸ªç¡¬ç›˜è®¾å¤‡æˆ–ä½¿ç”¨ fdisk å‘½ä»¤å»ºç«‹çš„ç¡¬ç›˜åˆ†åŒºã€‚</li>
<li>å·ç»„(VG,Volume Group ) :ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç‰©ç†å·(PV)ç»„æˆçš„æ•´ä½“</li>
<li>é€»è¾‘å·(LV,Logical Volume ):ä»å·ç»„(VG)å‡ºåˆ‡å‰²å‡ºçš„ç©ºé—´æ¥ç”¨äºåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ,å¤§å°ç”± PE çš„ä¸ªæ•°å†³å®šã€‚</li>
</ul>
<h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><p><img src="pic/27.png" alt="27"><br><img src="pic/28.png" alt="28"><br><img src="pic/30.png" alt="30"><br><img src="pic/31.png" alt="31"></p>
<h3 id="å®éªŒ-1"><a href="#å®éªŒ-1" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h3><p>å®éªŒï¼šlinear ç›®å‰ç”¨æˆ·çš„æ˜ å°„ç›®æ ‡ä¸ºlinearå‹ï¼Œçº¿æ€§å‹ï¼Œ/dev/vdb1 pv1 100M;/dev/vdb2 pv2 100M;/dev/vdb3 pv 3 100Mâ€”â€“&gt;myvg 300Mâ€”â€“&gt;lv1-linear 20M;lv2-linear 60Mç°åœ¨lv1-linearä¸å¤Ÿç”¨äº†ï¼Œéœ€è¦æ‹“å±•60Mçš„ç©ºé—´ï¼Œlv2-linearä¹Ÿä¸å¤Ÿç”¨äº†ï¼Œéœ€è¦æ‹“å±•30Mçš„ç©ºé—´ï¼Œå¦‚ä½•åšæ‰èƒ½æé«˜è¯»å†™é€Ÿåº¦ï¼Ÿ</p>
<p><img src="pic/32.png" alt="32"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@iscsi1-f15 ~]# dmsetup table|grep my</span><br><span class="line">myvg-lv1--linear: 0 40960 linear 252:21 2048</span><br><span class="line">myvg-lv1--linear: 40960 32768 linear 252:21 165888</span><br><span class="line">myvg-lv1--linear: 73728 90112 linear 252:22 2048</span><br><span class="line">myvg-lv2--linear: 0 122880 linear 252:21 43008</span><br><span class="line">myvg-lv2--linear: 122880 65536 linear 252:22 92160</span><br><span class="line">â€“------------------------------------------------------------------------</span><br><span class="line">[root@iscsi1-f15 ~]# dmsetup table|grep myvg</span><br><span class="line">myvg-lv1--linear: 0 73728 linear 252:25 2048</span><br><span class="line">myvg-lv1--linear: 73728 90112 linear 252:25 75776</span><br><span class="line">myvg-lv2--linear: 0 122880 linear 252:25 165888</span><br><span class="line">myvg-lv2--linear: 122880 65536 linear 252:25 288768</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iscsi1-f15 ~]# fdisk /dev/vdb ---&gt;vdb[123] 100M</span><br><span class="line">[root@iscsi1-f15 ~]# pvcreate /dev/vdb[123]</span><br><span class="line">[root@iscsi1-f15 ~]# vgcreate myvg /dev/vdb[123]</span><br><span class="line">[root@iscsi1-f15 ~]# lvcreate -L 20M myvg -n lv1-linear</span><br><span class="line">[root@iscsi1-f15 ~]# lvcreate -L 60M myvg -n lv2-linear</span><br><span class="line">[root@iscsi1-f15 ~]# mkfs.ext4 /dev/myvg/lv1-linear</span><br><span class="line">[root@iscsi1-f15 ~]# mkfs.ext4 /dev/myvg/lv2-linear</span><br><span class="line">[root@iscsi1-f15 ~]# mount /dev/myvg/lv1-linear /opt/lv1</span><br><span class="line">[root@iscsi1-f15 ~]# mount /dev/myvg/lv2-linear /opt/lv2</span><br><span class="line">[root@iscsi1-f15 ~]# lvextend -L +60M /dev/myvg/lv1-linear</span><br><span class="line">[root@iscsi1-f15 ~]# lvextend -L +30M /dev/myvg/lv2-linear</span><br><span class="line">[root@iscsi1-f15 ~]# resize2fs /dev/myvg/lv1-linear</span><br><span class="line">[root@iscsi1-f15 ~]# resize2fs /dev/myvg/lv2-linear</span><br><span class="line">[root@iscsi1-f15 ~]# dmsetup table|grep my</span><br><span class="line">myvg-lv1--linear: 0 40960 linear 252:21 2048</span><br><span class="line">myvg-lv1--linear: 40960 32768 linear 252:21 165888</span><br><span class="line">myvg-lv1--linear: 73728 90112 linear 252:22 2048</span><br><span class="line">myvg-lv2--linear: 0 122880 linear 252:21 43008</span><br><span class="line">myvg-lv2--linear: 122880 65536 linear 252:22 92160</span><br><span class="line">â€“------------------------------------------------------------------------</span><br><span class="line">[root@iscsi1-f15 ~]# fdisk /dev/vdb ---&gt;vdb4 500M vdb5 500M</span><br><span class="line">[root@iscsi1-f15 ~]# partx -a /dev/vdb</span><br><span class="line">[root@iscsi1-f15 ~]# pvcreate /dev/vdb[45]</span><br><span class="line">[root@iscsi1-f15 ~]# vgextend myvg /dev/vdb[45]</span><br><span class="line">[root@iscsi1-f15 ~]# pvmove /dev/vdb1 /dev/vdb4</span><br><span class="line">[root@iscsi1-f15 ~]# pvmove /dev/vdb2 /dev/vdb4</span><br><span class="line">[root@iscsi1-f15 ~]# pvmove /dev/vdb4 /dev/vdb5</span><br><span class="line">[root@iscsi1-f15 ~]# dmsetup table|grep myvg</span><br><span class="line">myvg-lv1--linear: 0 73728 linear 252:25 2048</span><br><span class="line">myvg-lv1--linear: 73728 90112 linear 252:25 75776</span><br><span class="line">myvg-lv2--linear: 0 122880 linear 252:25 165888</span><br><span class="line">myvg-lv2--linear: 122880 65536 linear 252:25 288768</span><br></pre></td></tr></table></figure>


<h2 id="Linuxæ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ç®¡ç†ä½œä¸š"><a href="#Linuxæ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ç®¡ç†ä½œä¸š" class="headerlink" title="Linuxæ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ç®¡ç†ä½œä¸š"></a>Linuxæ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜ç®¡ç†ä½œä¸š</h2><ol>
<li>åˆ†åˆ«åœ¨rhel6å’Œrhel7ä¸Šåˆ’åˆ†/dev/vdbç£ç›˜ï¼Œè¦æ±‚ï¼Œ/dev/vdb1å¤§å°ä¸º1Gï¼Œ/dev/vdb2å¤§å°ä¸º2Gï¼›åˆ›å»ºå¯¹åº”æ“ä½œç³»ç»Ÿé»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿï¼Œrhel6é»˜è®¤ext4ï¼Œrhel7é»˜è®¤xfsã€‚</li>
<li>rhel6ä¸Šå°†/dev/vdb2æŒ‚è½½åœ¨studentå®¶ç›®å½•ä¸‹ä½¿ç”¨ï¼Œé™åˆ¶ç£ç›˜è½¯é™åˆ¶ä¸º 3Mã€ç£ç›˜ç¡¬é™åˆ¶ä¸º 6Mã€æ–‡ä»¶è½¯é™åˆ¶ä¸º 20 ä¸ªä¸”æ–‡ä»¶ç¡¬é™åˆ¶ä¸º 30 ä¸ª</li>
<li>rhel7ä¸Šå®Œæˆï¼š<br>rootç”¨æˆ·ï¼š<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> 1. æŸ¥çœ‹å†…æ ¸æ˜¯å¦æ”¯æŒ quota åŠŸèƒ½:</span><br><span class="line"> 2. æŸ¥çœ‹ quota ç¨‹åºåŒ…æ˜¯å¦å·²ç»å®‰è£…:</span><br><span class="line"> 3. æŸ¥çœ‹ boot ç›®å½•æ˜¯å¦æ”¯æŒ quota åŠŸèƒ½(noquota è¡¨ç¤ºæš‚æ—¶ä¸æ”¯æŒ):</span><br><span class="line"> 4. è®©/boot ç›®å½•æ”¯æŒ quota åŠŸèƒ½:</span><br><span class="line"> 5. é‡å¯ä¸»æœºåå³å¯ç”Ÿæ•ˆ:</span><br><span class="line"> 6. æŸ¥çœ‹ boot ç›®å½•æ˜¯å¦æ”¯æŒ quota åŠŸèƒ½(usrquota è¡¨ç¤ºå·²ç»æ”¯æŒ):</span><br><span class="line"> 7. åˆ›å»ºä¸€ä¸ªç”¨äº quota å®éªŒçš„ç”¨æˆ· tom:</span><br><span class="line"> 8. éœ€è¦å…è®¸å…¶ä»–ç”¨æˆ·å¯¹/boot ç›®å½•å†™å…¥æ–‡ä»¶æ“ä½œ:</span><br><span class="line"> 9. ä½¿ç”¨ xfs_quota å‘½ä»¤è®¾ç½®å¯¹ tom ç”¨æˆ·åœ¨/boot ç›®å½•çš„ç£ç›˜é…é¢,å…·ä½“è¦æ±‚å¦‚ä¸‹:</span><br><span class="line">ä½¿ç”¨ quota ä¸“å®¶æ¨¡å¼é™åˆ¶ç£ç›˜è½¯é™åˆ¶ä¸º 3mã€ç£ç›˜ç¡¬é™åˆ¶ä¸º 6mã€æ–‡ä»¶è½¯é™åˆ¶ä¸º 3 ä¸ªä¸”æ–‡ä»¶ç¡¬é™åˆ¶ä¸º 6 ä¸ªã€‚ è·å–å½“å‰/boot ç›®å½•ä¸Šçš„ quota é…é¢é™åˆ¶</span><br></pre></td></tr></table></figure>
åˆ‡æ¢è‡³ tom ç”¨æˆ·:<ol>
<li>æ­£å¸¸åˆ›å»ºäº†ä¸€ä¸ªä¸º 5M çš„æ–‡ä»¶:</li>
<li>åˆ›å»º 8M æ–‡ä»¶æ—¶å¼ºåˆ¶ç»ˆæ­¢å¹¶æŠ¥é”™äº†:</li>
<li>æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„ quota é™åˆ¶(æ˜¾ç¤ºç¡¬ç›˜é…é¢å·²å æ»¡):</li>
</ol>
</li>
</ol>
<p>åˆ‡æ¢è‡³rootç”¨æˆ·ï¼š</p>
<ol>
<li>ç¼–è¾‘ tom çš„é…é¢é™åˆ¶,å°†ç¡¬ç›˜çš„ç¡¬é™åˆ¶ä¿®æ”¹ä¸º 8m(8192k):</li>
</ol>
<p>åˆ‡æ¢è‡³ tom ç”¨æˆ·:</p>
<ol>
<li>å†æ¥åˆ›å»º 8m çš„æ–‡ä»¶å°±ä¸ä¼šæœ‰é—®é¢˜äº†:</li>
</ol>
<hr>
<ol start="4">
<li>rhel6å’Œrhel7ä¸Šå®Œæˆlvmé€»è¾‘å·ç®¡ç†ï¼Œè¦æ±‚ï¼š<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1ï¼‰/dev/vdb1 100M;/dev/vdb2 100M;/dev/vdb3 100M;/dev/vdb4 100M</span><br><span class="line">2) å°†/dev/vdb[1,2,3,4]åšæˆpv</span><br><span class="line">3ï¼‰/dev/vdb1,/dev/vdb2ç»„æˆvgtest300M</span><br><span class="line">4ï¼‰ä»vgtestä¸­åˆ’åˆ†50Mçš„lvtest1</span><br><span class="line">5ï¼‰å°†lvtest1æŒ‚è½½åˆ°/mntä¸‹ä½¿ç”¨</span><br><span class="line">6ï¼‰æ‹“å±•lvtest1è‡³200M</span><br><span class="line">7ï¼‰æ‹“å±•lvtest1è‡³400M</span><br><span class="line">8ï¼‰ç¼©å°lvtest1è‡³50M</span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯åŸ¹è®­</category>
        <category>Linuxç³»ç»ŸåŸºç¡€åŸ¹è®­</category>
      </categories>
      <tags>
        <tag>åŸ¹è®­</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
</search>
