<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hello World</title>
    <url>/2020/03/22/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>å›½åº†å‰å­¦æ´—æ‰‹</title>
    <url>/2018/09/30/%E5%9B%BD%E5%BA%86%E5%89%8D%E5%AD%A6%E6%B4%97%E6%89%8B/</url>
    <content><![CDATA[<p>ä»Šå¤©äººå°‘ï¼Œæˆ‘ä»¬åå°æœˆäº®ï¼Œç„¶åç»™ä»–ä»¬æ¯äººç”¨äº†å…æ´—æ´—æ‰‹æ¶²ï¼Œæ´—å°æ‰‹ï¼Œå›½åº†èŠ‚å‡ºå»ä¸è¦å¿˜è®°å¸¦å“¦</p>
<a id="more"></a>

<p align="center"><embed src='http://player.youku.com/player.php/sid/XMzg0Mzk0NDI5Ng==/v.swf' allowFullScreen='true' quality='high' width='480' height='400' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'></embed></p>

<p><img src="%E5%9B%BD%E5%BA%86%E5%89%8D%E5%AD%A6%E6%B4%97%E6%89%8B/01.jpg" alt=""></p>
<p>å›å›è€å¸ˆ:<br>ä»–ä»¬è®©æˆ‘å‘ç»™ä½ ä»¬ğŸ˜‚</p>
<p>å°æ…ˆçš„æ™šæ‰˜ç­åˆ¶ä½œäº”æ˜Ÿçº¢æ——</p>
<p align="center"><embed src='http://player.youku.com/player.php/sid/XMzg0Mzk0OTg4MA==/v.swf' allowFullScreen='true' quality='high' width='480' height='400' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'></embed></p>]]></content>
      <categories>
        <category>å¾€æ˜”è¿½å¿†</category>
        <category>å°äºŒç­</category>
      </categories>
      <tags>
        <tag>å®å®æˆé•¿</tag>
      </tags>
  </entry>
  <entry>
    <title>å®å®ä»¬ä¸Šç­å•¦</title>
    <url>/2018/09/29/%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/</url>
    <content><![CDATA[<p>å›å›è€å¸ˆ:<br>æœ€è¿‘æˆ‘ä»¬å­©å­çš„è§’è‰²æ¸¸æˆæ…¢æ…¢è¿›å…¥çŠ¶æ€äº†ï¼Œä½†ä¹Ÿæœ‰å‡ ä¸ªå­©å­æ²‰è¿·äºç§¯æœ¨æ¸¸æˆæ— æ³•è‡ªæ‹”ï¼Œæˆ‘ä»¬å¸Œæœ›å®¶é•¿ä»¬åœ¨å®¶é‡Œä¹Ÿå¯ä»¥å’Œå­©å­ä»¬ä¸€èµ·ç©è§’è‰²æ‰®æ¼”æ¸¸æˆï¼Œå’Œå­©å­å¤šäº’åŠ¨ï¼Œä¹Ÿå¯ä»¥æ‹“å®½æ€è·¯ï¼Œå¯ä»¥åšç°å®ç”Ÿæ´»ä¸­ä¸èƒ½åšçš„ï¼Œæ¯”å¦‚ä»™å¥³å•Šï¼Œå…¬ä¸»å•Šï¼Œå°å£«å…µç­‰ç­‰</p>
<a id="more"></a>

<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/01.jpg" alt=""></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/02.jpg" alt="02"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/03.jpg" alt="03"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/04.jpg" alt="04"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/05.jpg" alt="05"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/06.jpg" alt="06"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/07.jpg" alt="07"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/08.jpg" alt="08"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/09.jpg" alt="09"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/10.jpg" alt="10"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/11.jpg" alt="11"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/12.jpg" alt="12"></p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E4%B8%8A%E7%8F%AD%E5%95%A6/13.jpg" alt="13"></p>
<p>å›å›è€å¸ˆ:<br>ä»Šå¤©æˆ‘ä»¬è¿˜è®¤è¯†äº†äº”æ˜Ÿçº¢æ——ï¼ŒçŸ¥é“è‡ªå·±æ˜¯ä¸€ä¸ªä¸­å›½äººï¼Œæˆ‘å‘Šè¯‰ä»–ä»¬è¿‡å‡ å¤©è¦ç»™ç¥–å›½å¦ˆå¦ˆè¿‡ç”Ÿæ—¥äº†ï¼Œè¦ä¼‘æ¯ä¸ƒå¤©ï¼Œæœ‰å­©å­è¿˜åé©³è¯´ä¸è¡Œï¼Œä¼‘æ¯ä¸‰å¤©å°±å¤Ÿäº†ï¼Œå“ˆå“ˆæˆ‘è¿˜å‘Šè¯‰ä»–ä»¬ç¥–å›½å¦ˆå¦ˆä¼šè¯·ä»–ä»¬åƒç”Ÿæ—¥è›‹ç³•çš„</p>
<p>åˆé¤å‰è¿˜é¢å¤–å­¦äº†ä¸€é¦–æ­Œï¼Œé€ç»™æˆ‘ä»¬çš„ç¥–å›½å¦ˆå¦ˆ</p>
<p><a href="https://music.163.com/#/song?id=498555737&market=baiduqk" target="_blank" rel="noopener">å„¿æ­Œ-ç¥–å›½ç¥–å›½æˆ‘çˆ±ä½ </a></p>
]]></content>
      <categories>
        <category>å¾€æ˜”è¿½å¿†</category>
        <category>å°äºŒç­</category>
      </categories>
      <tags>
        <tag>å®å®æˆé•¿</tag>
      </tags>
  </entry>
  <entry>
    <title>æœˆé¥¼çƒ˜åŸ¹å’Œå°å°æ¬è¿å·¥</title>
    <url>/2018/09/21/%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/</url>
    <content><![CDATA[<p>ä¸­ç§‹èŠ‚å¿«åˆ°äº†ï¼Œè€å¸ˆå¸¦å®å®ä»¬ä¸€èµ·åšäº†æœˆé¥¼ï¼Œæ‹¿å»çƒ¤äº†ï¼Œå®å®ä»¬è¿˜å¸®è€å¸ˆä¸€èµ·æ¬æ¡Œå­ï¼Œè™½ç„¶ç»“å±€å·®å¼ºäººæ„ï¼Œä½†æ˜¯å­©å­ä»¬éƒ½å¾ˆå¼€å¿ƒå‘¢ï¼</p>
<a id="more"></a>

<p align="center"><embed src='http://player.youku.com/player.php/sid/XMzg0Mzk0NDg5Ng==/v.swf' allowFullScreen='true' quality='high' width='480' height='400' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'></embed></p>

<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/01.jpg" alt=""></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/02.jpg" alt="02"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/03.jpg" alt="03"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/04.jpg" alt="04"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/05.jpg" alt="05"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/06.jpg" alt="06"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/07.jpg" alt="07"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/08.jpg" alt="08"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/09.jpg" alt="09"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/20.jpg" alt="20"></p>
<p><img src="%E6%9C%88%E9%A5%BC%E7%83%98%E5%9F%B9%E5%92%8C%E5%B0%8F%E5%B0%8F%E6%90%AC%E8%BF%90%E5%B7%A5/00.png" alt=""></p>
]]></content>
      <categories>
        <category>å¾€æ˜”è¿½å¿†</category>
        <category>å°äºŒç­</category>
      </categories>
      <tags>
        <tag>å®å®æˆé•¿</tag>
      </tags>
  </entry>
  <entry>
    <title>å®å®ä»¬å¼€å§‹æ¼±å£äº†</title>
    <url>/2018/09/20/%E5%AE%9D%E5%AE%9D%E4%BB%AC%E5%BC%80%E5%A7%8B%E6%BC%B1%E5%8F%A3%E4%BA%86/</url>
    <content><![CDATA[<p>æ‘˜è¦ï¼šä»Šå¤©å¼€å§‹æˆ‘ä»¬è®©å®å®ä»¬å¼€å§‹æ¼±å£äº†ï¼Œæ‰€ä»¥å›å®¶ä¹Ÿè¦ç»§ç»­ä¿æŒè¿™ä¸ªå¥½ä¹ æƒ¯å“¦ï½</p>
<a id="more"></a>


<p>å›å›è€å¸ˆè¯­å½•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">å„ä½äº²ä»¬ï¼Œé€šè¿‡æ˜¨å¤©çš„å®¶é•¿ä¼šï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å®¶é•¿å›å»çš„åŠªåŠ›ï¼Œä»Šå¤©åˆé¥­æ˜æ˜¾è¿›æ­¥çš„å®å®æœ‰ï¼š@å¼ ç‘¾å®‰å¦ˆå¦ˆâ€…@æ“æ¢“æ¡å¦ˆå¦ˆâ€…@ä½†é¢å®¸å¦ˆå¦ˆâ€…@ä½•æ™Ÿç¿å¦ˆå¦ˆâ€…@å¼ æ¬è§…å¦ˆå¦ˆâ€…@ä¸¥é­æ…ˆå¦ˆå¦ˆâ€…@ç‹æ™Ÿå®å¦ˆå¦ˆâ€…ï¼Œå…¶ä»–å®å®ä»¬ç»§ç»­åŠ æ²¹å“¦ï½</span><br><span class="line"></span><br><span class="line">åƒé¥­æˆ‘ä»¬æ˜¯å’Œå­©å­ä»¬è¯´ï¼šå°æ±½è½¦è£…è£…æ»¡ï¼Œè½¬å¼¯é€åˆ°å±±æ´é‡Œï¼Œæ»‘æ»‘æ¢¯æ»‘åˆ°è‚šå­é‡Œï¼Œå› ä¸ºå¾ˆå¤šå®å®å‹ºå­ä¸å¯¹ç€å˜´å·´ï¼Œæ‰€ä»¥é¥­å®å®æ‰åœ¨æ¡Œå­ä¸Šéƒ½å“­äº†ã€‚</span><br><span class="line"></span><br><span class="line">å¦å¤–ï¼Œä»Šå¤©æˆ‘ä»¬ç»ƒä¹ äº†å®å®ä»¬æ’é˜Ÿèµ°æ¥¼æ¢¯ï¼Œå¤§å¤šæ•°å·²ç»åƒæ¨¡åƒæ ·çš„äº†ï¼Œä¸Šä¸‹æ¥¼æ¢¯é å³èµ°äº†ï¼Œä»Šå¤©çš„è¿åŠ¨é‡æœ‰ç‚¹å¤§ï¼Œæ‰€ä»¥ä¼°è®¡å®è´ä»¬ä»Šæ™šåˆè¦æ—©æ—©ç¡è§‰äº†.</span><br></pre></td></tr></table></figure>



<p>ä»Šå¤©å¼€å§‹æˆ‘ä»¬è®©å®å®ä»¬å¼€å§‹æ¼±å£äº†ï¼Œæ‰€ä»¥å›å®¶ä¹Ÿè¦ç»§ç»­ä¿æŒè¿™ä¸ªå¥½ä¹ æƒ¯å“¦ï½</p>
<p><img src="%E5%AE%9D%E5%AE%9D%E4%BB%AC%E5%BC%80%E5%A7%8B%E6%BC%B1%E5%8F%A3%E4%BA%86/01.jpg" alt=""></p>
]]></content>
      <categories>
        <category>å¾€æ˜”è¿½å¿†</category>
        <category>å°äºŒç­</category>
      </categories>
      <tags>
        <tag>å®å®æˆé•¿</tag>
      </tags>
  </entry>
  <entry>
    <title>å®¶é•¿ä¼š</title>
    <url>/2018/09/19/%E5%AE%B6%E9%95%BF%E4%BC%9A/</url>
    <content><![CDATA[<p>æ‘˜è¦ï¼šå¹¼å„¿å›­å¼€å­¦ç¬¬10å¤©ï¼Œå®å®ä»¬é€æ¸ç¨³å®šï¼Œèå…¥è¿™ä¸ªå¤§å®¶åº­ï¼Œä»Šå¤©è€å¸ˆå’Œæˆ‘ä»¬åˆ†äº«å®å®ä»¬çš„å¹¼å„¿å›­æ—¥å¸¸ç”Ÿæ´»ï¼Œä»¥åŠæˆ‘ä»¬å¯¹æˆ‘ä»¬å®¶é•¿çš„ä¸€äº›å»ºè®®ï¼Œéå¸¸åœ°ç”¨å¿ƒã€‚</p>
<a id="more"></a>

<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/001.jpg" alt=""></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/002.jpg" alt="002"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/003.jpg" alt="003"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/004.jpg" alt="004"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/005.jpg" alt="005"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/006.jpg" alt="006"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/007.jpg" alt="007"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/008.jpg" alt="008"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/010.jpg" alt="010"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/011.jpg" alt="011"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/012.jpg" alt="012"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/013.jpg" alt="013"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/014.jpg" alt="014"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/015.jpg" alt="015"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/016.jpg" alt="016"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/017.jpg" alt="017"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/018.jpg" alt="018"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/019.jpg" alt="019"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/020.jpg" alt="020"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/021.jpg" alt="021"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/022.jpg" alt="022"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/023.jpg" alt="023"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/024.jpg" alt="024"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/025.jpg" alt="025"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/026.jpg" alt="026"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/027.jpg" alt="027"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/028.jpg" alt="028"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/029.jpg" alt="029"></p>
<p><img src="%E5%AE%B6%E9%95%BF%E4%BC%9A/030.jpg" alt="030"></p>
]]></content>
      <categories>
        <category>å¾€æ˜”è¿½å¿†</category>
        <category>å°äºŒç­</category>
      </categories>
      <tags>
        <tag>å®å®æˆé•¿</tag>
      </tags>
  </entry>
  <entry>
    <title>å‘æœˆäº®è¯´æ™šå®‰</title>
    <url>/2018/09/10/%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/</url>
    <content><![CDATA[<p>æ‘˜è¦ï¼šä»Šå¤©ä¸­åˆè®²äº†ä¸€ä¸ªå…³äºã€Œæ™šå®‰ï¼Œæœˆäº®ã€çš„ç¡å‰æ•…äº‹ï¼Œæœ€åçŒ«å¤´é¹°å¯¹æœˆäº®è¯´äº†æ™šå®‰ï¼Œå¤§å®¶ä»Šå¤©ç¡å‰è¿˜å¯ä»¥å’Œå®å®è¯´å“¦ï¼Œå†åŠ ä¸€äº›å…¶ä»–çš„åŠ¨ç‰©å®å®</p>
<a id="more"></a>

<p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/01.jpg" alt=""></p>
<p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/02.jpg" alt="02"></p>
<p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/03.jpg" alt="03"></p>
<p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/04.jpg" alt="04"></p>
<p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/05.jpg" alt="05"></p>
<p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/06.jpg" alt="06"></p>
<p><img src="%E5%90%91%E6%9C%88%E4%BA%AE%E8%AF%B4%E6%99%9A%E5%AE%89/07.jpg" alt="07"></p>
]]></content>
      <categories>
        <category>å¾€æ˜”è¿½å¿†</category>
        <category>å°äºŒç­</category>
      </categories>
      <tags>
        <tag>å®å®æˆé•¿</tag>
      </tags>
  </entry>
  <entry>
    <title>çªç ´é˜¿é‡Œé™åˆ¶å®ç°&quot;RDS For MySQL 5.7åˆ°è‡ªå»ºMySQLä¸»ä»&quot;</title>
    <url>/2018/08/22/rds-for-mysql-5-7%E5%88%B0%E8%87%AA%E5%BB%BAMySQL%E4%B8%BB%E4%BB%8E%E4%B9%8B%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3user%E8%A1%A8%E5%AE%9E%E7%8E%B0%E4%BB%8E%E5%BA%93%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E6%9B%B4%E6%94%B9%E5%8A%9F%E8%83%BD/</url>
    <content><![CDATA[<p>æ‘˜è¦: é˜¿é‡Œäº‘çš„RDS For MySQL 5.7 åˆ°çº¿ä¸‹IDCæœºæˆ¿çš„ä¸»ä»æ­å»ºç›¸ä¿¡çœ‹å®˜æ–¹æ–‡æ¡£å°±å¯ä»¥å®Œæˆï¼Œä½†æ˜¯æ­å»ºä¹‹åå´å‘ç°æ— æ³•åœ¨æœ¬åœ°è¿›è¡Œè®¤è¯æƒé™çš„ç®¡ç†ï¼Œè¿™æ˜¯ä¸ºä½•ï¼Ÿè€Œé˜¿é‡Œå®˜æ–¹æ¨èä½¿ç”¨DTSåŒæ­¥å·¥å…·å»å®ç°ï¼Œè¿™ä¸ªè´¹ç”¨ç€å®ä¸å°‘ï¼Œåˆæ˜¯å¦èƒ½å¤Ÿç ´è§£å‘¢ï¼Ÿæœ¬æ–‡è¯¦è§£å¦‚ä½•æš´åŠ›ç ´è§£userè¡¨å®ç°ä»åº“ç”¨æˆ·æƒé™æ›´æ”¹åŠŸèƒ½</p>
<a id="more"></a>

<h1 id="æ•…äº‹èƒŒæ™¯"><a href="#æ•…äº‹èƒŒæ™¯" class="headerlink" title="æ•…äº‹èƒŒæ™¯"></a>æ•…äº‹èƒŒæ™¯</h1><h2 id="æ•°æ®åº“æ˜ç»†"><a href="#æ•°æ®åº“æ˜ç»†" class="headerlink" title="æ•°æ®åº“æ˜ç»†"></a>æ•°æ®åº“æ˜ç»†</h2><p>è¯´åœ¨å‰é¢ï¼š</p>
<ul>
<li>äº‘ä¸Šæ•°æ®åº“ï¼š RDS For MySQL 5.7.20 æ™®é€šç”¨æˆ·æƒé™</li>
<li>IDCæ•°æ®åº“: MySQL 5.7.20 </li>
</ul>
<h2 id="æ•…äº‹æƒ…èŠ‚"><a href="#æ•…äº‹æƒ…èŠ‚" class="headerlink" title="æ•…äº‹æƒ…èŠ‚"></a>æ•…äº‹æƒ…èŠ‚</h2><p>ç°éœ€è¦æ­å»ºRDS For MySQL åˆ°çº¿ä¸‹IDCæœºæˆ¿çš„ä¸»ä»ï¼Œé—®é¢˜å¦‚ä¸‹ï¼š</p>
<h3 id="åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥"><a href="#åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥" class="headerlink" title="åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥"></a>åŒæ­¥ç³»ç»Ÿè¡¨å¤±è´¥</h3><h4 id="æ•…éšœåŸå› "><a href="#æ•…éšœåŸå› " class="headerlink" title="æ•…éšœåŸå› "></a>æ•…éšœåŸå› </h4><ul>
<li>RDS For MySQL 5.7.20 åˆ°è‡ªå»ºMySQL 5.7.20ä¸»ä»åŒæ­¥å¼‚å¸¸çš„åŸå› ä¸ºRDSä¸MySQLå®˜æ–¹ç‰ˆæœ¬ä½¿ç”¨çš„ç³»ç»Ÿåº“ä¸åŒ</li>
<li>è‡ªå»ºMySQL 5.7.20 æ— æ³•åŒæ­¥ä¸»åº“RDSçš„ç³»ç»Ÿè¡¨</li>
<li>è‡ªå»ºMySQL 5.7.20 æ¢å¤RDSçš„å…¨å¤‡ä»½æ•°æ®åæ— æ³•æ‰§è¡Œæˆæƒè¯­å¥,æŠ¥é”™å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ERROR 1785 (HY000): Statement violates GTID consistency: Updates to non-transactional tables can only be done in either autocommitted statements or single-statement transactions, and never in the same statement as updates to transactional tables.</span><br></pre></td></tr></table></figure>

<ul>
<li>è‡ªå»ºMySQL 5.7.20 æ¢å¤RDSçš„å…¨å¤‡ä»½æ•°æ®åæ— æ³•å¯¹ç³»ç»Ÿè¡¨æ‰§è¡Œæ›´æ–°æ“ä½œï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ERROR 1064 (42000): Unknown trigger has an error in its body: 'Unknown system variable 'maintain_user_list''</span><br></pre></td></tr></table></figure>

<h4 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h4><ul>
<li>è·³è¿‡ç³»ç»Ÿè¡¨çš„åŒæ­¥</li>
</ul>
<hr>
<h3 id="ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥"><a href="#ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥" class="headerlink" title="ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥"></a>ä»åº“æ·»åŠ è®¤è¯æˆæƒå¤±è´¥</h3><p>RDS For MySQL 5.7.20 åˆ°è‡ªå»ºMySQL 5.7.20 æ­å»ºä¸»ä»åŒæ­¥æ¶æ„:</p>
<ul>
<li>é…ç½®ä»åº“ä¸åŒæ­¥RDSä¸»åº“çš„ç³»ç»Ÿè¡¨</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># skip rep</span><br><span class="line">replicate_wild_ignore_table&#x3D;mysql.%</span><br><span class="line">replicate_wild_ignore_table&#x3D;sys.%</span><br><span class="line">replicate_wild_ignore_table&#x3D;information_schema.%</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>éç³»ç»Ÿåº“æ•°æ®åŒæ­¥æ­£å¸¸</strong></li>
<li>ä»åº“æ— æ³•æ‰§è¡Œgrantå‘½ä»¤ï¼Œå³æ— æ³•æ·»åŠ æˆæƒä¿¡æ¯</li>
<li>ä»åº“æ— æ³•å¯¹ç³»ç»Ÿè¡¨mysql.userè¡¨æ‰§è¡Œinsertæ“ä½œ</li>
<li>ä»åº“æ— æ³•å¯¹ç³»ç»Ÿè¡¨mysql.userè¡¨æ‰§è¡Œupdatæ“ä½œ</li>
</ul>
<p>æŠ¥é”™å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ERROR 1064 (42000): Unknown trigger has an error in its body: 'Unknown system variable 'maintain_user_list''</span><br></pre></td></tr></table></figure>

<h4 id="å¤±è´¥åŸå› "><a href="#å¤±è´¥åŸå› " class="headerlink" title="å¤±è´¥åŸå› "></a>å¤±è´¥åŸå› </h4><p><strong>é˜¿é‡Œå·¥å•ç­”å¤</strong>ï¼šRDS ç›®å‰å·²ç»ä¸æ”¯æŒ MYISAM å¼•æ“åˆ›å»ºäº†ã€‚æ‰€ä»¥å¦‚æœæ˜¯é€šè¿‡è‡ªå»ºçš„replication åŒæ­¥ å°±ä¼šæœ‰è¿™ä¸ªé—®é¢˜çš„ï¼ŒRDS ç»Ÿä¸€INNOB å¼•æ“ã€‚<br>å¦‚æœéœ€æ±‚æ˜¯ä»RDS åˆ°è‡ªå»ºæ•°æ®åº“çš„åŒæ­¥å…³ç³»ï¼Œå»ºè®®æ‚¨ä½¿ç”¨DTS åšä¸šåŠ¡æ•°æ®çš„åŒæ­¥ã€‚</p>
<h4 id="æ¢ç´¢è§£å†³æ–¹æ³•"><a href="#æ¢ç´¢è§£å†³æ–¹æ³•" class="headerlink" title="æ¢ç´¢è§£å†³æ–¹æ³•"></a>æ¢ç´¢è§£å†³æ–¹æ³•</h4><h5 id="ä»åº“å°è¯•ä½¿ç”¨MySQL8-0-11"><a href="#ä»åº“å°è¯•ä½¿ç”¨MySQL8-0-11" class="headerlink" title="ä»åº“å°è¯•ä½¿ç”¨MySQL8.0.11"></a>ä»åº“å°è¯•ä½¿ç”¨<code>MySQL8.0.11</code></h5><p>RDS For MySQL 5.7çš„å¤‡ä»½æ–‡ä»¶ åˆ°çº¿ä¸‹è‡ªå»ºMYSQL 8.0.11 æ— æ³•æ¢å¤æ•°æ®ã€‚å› æ­¤è¯¥æ–¹æ³•ä¸å¯è¡Œã€‚</p>
<h5 id="å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼"><a href="#å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼" class="headerlink" title="å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼"></a>å°è¯•ä¸´æ—¶å…³é—­GTIDæ¨¡å¼</h5><ol>
<li>ä¸´æ—¶åœæ­¢slaveåŒæ­¥</li>
<li>ä¿®æ”¹é…ç½®å…³é—­gtidæ¨¡å¼</li>
<li>é‡å¯æœåŠ¡</li>
</ol>
<p>å¯¹ç³»ç»Ÿè¡¨mysql.useræµ‹è¯•æ˜ç»†ï¼š</p>
<table>
<thead>
<tr>
<th>No.</th>
<th>æµ‹è¯•é¡¹ç›®</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œgrantå‘½ä»¤</td>
<td>Ã—</td>
</tr>
<tr>
<td>2</td>
<td>æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œupdateå‘½ä»¤</td>
<td>Ã—</td>
</tr>
<tr>
<td>3</td>
<td>æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œinsertå‘½ä»¤</td>
<td>Ã—</td>
</tr>
</tbody></table>
<p>è¯¥æ–¹æ³•åŒæ ·æ— æ³•è§£å†³ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æƒé™ç›¸å…³çš„ä¸€äº›è¡¨ï¼š</span></span><br><span class="line">SCHEMA_PRIVILEGESï¼šæä¾›äº†æ•°æ®åº“çš„ç›¸å…³æƒé™ï¼Œè¿™ä¸ªè¡¨æ˜¯å†…å­˜è¡¨æ˜¯ä»mysql.dbä¸­æ‹‰å»å‡ºæ¥çš„ã€‚</span><br><span class="line">TABLE_PRIVILEGES:æä¾›çš„æ˜¯è¡¨æƒé™ç›¸å…³ä¿¡æ¯ï¼Œä¿¡æ¯æ˜¯ä» mysql.tables_priv è¡¨ä¸­åŠ è½½çš„</span><br><span class="line">COLUMN_PRIVILEGES ï¼šè¿™ä¸ªè¡¨å¯ä»¥æ¸…æ¥šå°±èƒ½çœ‹åˆ°è¡¨æˆæƒçš„ç”¨æˆ·çš„å¯¹è±¡ï¼Œé‚£å¼ è¡¨é‚£ä¸ªåº“ä»¥åŠæˆäºˆçš„æ˜¯ä»€ä¹ˆæƒé™ï¼Œå¦‚æœæˆæƒçš„æ—¶å€™åŠ ä¸Šwith grant optionçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å¾—åˆ°PRIVILEGE_TYPEè¿™ä¸ªå€¼å¿…é¡»æ˜¯YESã€‚</span><br><span class="line">USER_PRIVILEGES:æä¾›çš„æ˜¯è¡¨æƒé™ç›¸å…³ä¿¡æ¯ï¼Œä¿¡æ¯æ˜¯ä» mysql.user è¡¨ä¸­åŠ è½½çš„</span><br><span class="line">é€šè¿‡è¡¨æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ™°çœ‹å¾—åˆ°MySQLæˆæƒçš„å±‚æ¬¡ï¼ŒSCHEMAï¼ŒTABLEï¼ŒCOLUMNçº§åˆ«ï¼Œå½“ç„¶è¿™äº›éƒ½æ˜¯åŸºäºç”¨æˆ·æ¥æˆäºˆçš„</span><br></pre></td></tr></table></figure>

<p>ä»æ•°æ®åº“ç”¨æˆ·æƒé™ç®¡ç†çš„åŸç†å¯ä»¥äº†è§£åˆ°ç®¡ç†ç”¨æˆ·çš„æ˜¯<code>user</code>è¡¨ï¼Œå¦‚æœè¦æ›´ç»†è‡´çš„æƒé™è¿˜éœ€è¦<code>db</code>è¡¨å’Œ<code>tables_priv</code>è¡¨ã€‚<em>ï¼ˆæœ¬æ–‡åªä»userè¡¨ç€æ‰‹ï¼‰</em></p>
<h3 id="æ­¥éª¤æ¦‚è§ˆ"><a href="#æ­¥éª¤æ¦‚è§ˆ" class="headerlink" title="æ­¥éª¤æ¦‚è§ˆ"></a>æ­¥éª¤æ¦‚è§ˆ</h3><ol>
<li>åˆ›å»ºæ–°çš„user_1è¡¨</li>
<li>å¯¹user_1è¡¨æ·»åŠ æ–°çš„ç”¨æˆ·</li>
<li>åœæœåŠ¡</li>
<li>å°†user_1æ›¿æ¢userè¡¨</li>
<li>å¯åŠ¨è¯¥æœåŠ¡</li>
<li>å¯ä»¥é€šè¿‡updateã€insertã€deleteæ“ä½œuserè¡¨æ¥æ·»åŠ æƒé™ï¼ˆgrantæ— æ³•æ“ä½œï¼‰</li>
</ol>
<h3 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@MySQL-01 10:35:  [mysql]&gt; create table user_1 like user;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; select * from user_1;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; show table status like user;</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'user' at line 1</span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; show table status like 'user_1';</span><br><span class="line">+--------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| Name   | Engine | Version | Row_format | Rows | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time         | Check_time | Collation | Checksum | Create_options | Comment                     |</span><br><span class="line">+--------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| user_1 | MyISAM |      10 | Dynamic    |    0 |              0 |           0 | 281474976710655 |         1024 |         0 |           NULL | 2019-01-04 10:36:00 | 2019-01-04 10:36:00 | NULL       | utf8_bin  |     NULL |                | Users and global privileges |</span><br><span class="line">+--------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; show table status like 'user';</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+---------------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| Name | Engine | Version | Row_format | Rows | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time         | Check_time          | Collation | Checksum | Create_options | Comment                     |</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+---------------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">| user | MyISAM |      10 | Dynamic    |    3 |             53 |         160 | 281474976710655 |         2048 |         0 |           NULL | 2015-05-22 15:24:42 | 2019-01-04 09:27:49 | 2015-05-22 15:33:22 | utf8_bin  |     NULL |                | Users and global privileges |</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+---------------------+-----------+----------+----------------+-----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; insert into user_1 select * from user;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; select * from user_1;</span><br><span class="line">+-----------+------+----------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+--------+-----------------------+</span><br><span class="line">| Host      | User | Password | Select_priv | Insert_priv | Update_priv | Delete_priv | Create_priv | Drop_priv | Reload_priv | Shutdown_priv | Process_priv | File_priv | Grant_priv | References_priv | Index_priv | Alter_priv | Show_db_priv | Super_priv | Create_tmp_table_priv | Lock_tables_priv | Execute_priv | Repl_slave_priv | Repl_client_priv | Create_view_priv | Show_view_priv | Create_routine_priv | Alter_routine_priv | Create_user_priv | Event_priv | Trigger_priv | Create_tablespace_priv | ssl_type | ssl_cipher | x509_issuer | x509_subject | max_questions | max_updates | max_connections | max_user_connections | plugin | authentication_string |</span><br><span class="line">+-----------+------+----------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+--------+-----------------------+</span><br><span class="line">| localhost | root |          | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          |            |             |              |             0 |           0 |               0 |                    0 |        |                       |</span><br><span class="line">| 127.0.0.1 | root |          | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          |            |             |              |             0 |           0 |               0 |                    0 |        |                       |</span><br><span class="line">| ::1       | root |          | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          |            |             |              |             0 |           0 |               0 |                    0 |        |                       |</span><br><span class="line">+-----------+------+----------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+--------+-----------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; select user,host,authentication_string from user_1;</span><br><span class="line">+------+-----------+-----------------------+</span><br><span class="line">| user | host      | authentication_string |</span><br><span class="line">+------+-----------+-----------------------+</span><br><span class="line">| root | localhost |                       |</span><br><span class="line">| root | 127.0.0.1 |                       |</span><br><span class="line">| root | ::1       |                       |</span><br><span class="line">+------+-----------+-----------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:36:  [mysql]&gt; update user_1 set authentication_string=password('(Uploo00king)') where user='root';</span><br><span class="line">Query OK, 3 rows affected, 1 warning (0.01 sec)</span><br><span class="line">Rows matched: 3  Changed: 3  Warnings: 1</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:37:  [mysql]&gt; select user,host,authentication_string from user_1;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:37:  [mysql]&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@sh_02 data]# /etc/init.d/mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@sh_02 mysql]# ll user_1*</span><br><span class="line">-rw-r-----. 1 mysql mysql 10630 Jan  4 10:36 user_1.frm</span><br><span class="line">-rw-r-----. 1 mysql mysql   328 Jan  4 10:37 user_1.MYD</span><br><span class="line">-rw-r-----. 1 mysql mysql  2048 Jan  4 10:37 user_1.MYI</span><br><span class="line">[root@sh_02 mysql]# mv user_1.frm user.frm</span><br><span class="line">[root@sh_02 mysql]# mv user_1.MYD user.MYD</span><br><span class="line">[root@sh_02 mysql]# mv user_1.MYI user.MYI</span><br><span class="line">[root@sh_02 mysql]# ll user*</span><br><span class="line">-rw-r-----. 1 mysql mysql 10630 Jan  4 10:36 user.frm</span><br><span class="line">-rw-r-----. 1 mysql mysql   328 Jan  4 10:37 user.MYD</span><br><span class="line">-rw-r-----. 1 mysql mysql  2048 Jan  4 10:37 user.MYI</span><br><span class="line">-rw-rw----. 1 mysql mysql  3989 Aug 14 09:14 user_view.frm</span><br><span class="line">[root@sh_02 mysql]# /etc/init.d/mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@sh_02 mysql]# mysql -uroot -p'(Uploo00king)'</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 6</span><br><span class="line">Server version: 5.7.20-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:39:  [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| db1                |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:39:  [(none)]&gt; use mysql</span><br><span class="line">Database changed</span><br><span class="line">root@MySQL-01 10:39:  [mysql]&gt; select user,host from mysql.user;</span><br><span class="line">+------+-----------+</span><br><span class="line">| user | host      |</span><br><span class="line">+------+-----------+</span><br><span class="line">| root | 127.0.0.1 |</span><br><span class="line">| root | ::1       |</span><br><span class="line">| root | localhost |</span><br><span class="line">+------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 10:39:  [mysql]&gt; grant all on *.* to booboo@'%' identified by '(Uploo00king)';</span><br><span class="line">ERROR 1785 (HY000): Statement violates GTID consistency: Updates to non-transactional tables can only be done in either autocommitted statements or single-statement transactions, and never in the same statement as updates to transactional tables.</span><br><span class="line"></span><br><span class="line">root@MySQL-01 11:39:  [mysql]&gt; update mysql.user_1 set user='aliyun_root' where host='127.0.0.1';</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">root@MySQL-01 11:40:  [mysql]&gt; select user,host from mysql.user_1;</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| user        | host      |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| aliyun_root | 127.0.0.1 |</span><br><span class="line">| root        | ::1       |</span><br><span class="line">| root        | localhost |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">aliyun_root@MySQL-01 11:51:  [mysql]&gt; insert into mysql.user values ('%','jowing', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('Joowing@2017'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">aliyun_root@MySQL-01 11:51:  [mysql]&gt; select user,host from  mysql.user;</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| user        | host      |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| jowing      | %         |</span><br><span class="line">| aliyun_root | 127.0.0.1 |</span><br><span class="line">| root        | ::1       |</span><br><span class="line">| root        | localhost |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="ç”Ÿäº§ç¯å¢ƒ"><a href="#ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒ"></a>ç”Ÿäº§ç¯å¢ƒ</h3><h4 id="ç”¨æˆ·æƒé™"><a href="#ç”¨æˆ·æƒé™" class="headerlink" title="ç”¨æˆ·æƒé™"></a>ç”¨æˆ·æƒé™</h4><p>ç›®æ ‡ï¼šIDCæœºæˆ¿ä»åº“æ”¯æŒé€šè¿‡insertã€updateã€deleteå‘½ä»¤æ¥ä¿®æ”¹ç”¨æˆ·æƒé™ï¼Œæƒé™æ¯”è¾ƒç®€å•ï¼Œåˆ†ä¸ºåªè¯»å’Œå†™ã€‚</p>
<p>éœ€è¦è®¾ç½®ä»¥ä¸‹æƒé™ï¼šæƒé™ä½œç”¨äºæ‰€æœ‰çš„åº“å¤šæœ‰çš„è¡¨</p>
<table>
<thead>
<tr>
<th align="left">ç”¨æˆ·å</th>
<th align="left">å¯†ç </th>
<th align="left">æƒé™</th>
</tr>
</thead>
<tbody><tr>
<td align="left">root</td>
<td align="left">123</td>
<td align="left">è¯»å†™</td>
</tr>
<tr>
<td align="left">joowingbuz</td>
<td align="left">123</td>
<td align="left">åªè¯»</td>
</tr>
<tr>
<td align="left">ottersync</td>
<td align="left">123</td>
<td align="left">åªè¯»</td>
</tr>
<tr>
<td align="left">syncdw</td>
<td align="left">123</td>
<td align="left">åªè¯»</td>
</tr>
<tr>
<td align="left">datasis</td>
<td align="left">123</td>
<td align="left">åªè¯»</td>
</tr>
<tr>
<td align="left">joowingv</td>
<td align="left">123</td>
<td align="left">åªè¯»</td>
</tr>
<tr>
<td align="left">datadev</td>
<td align="left">123</td>
<td align="left">åªè¯»</td>
</tr>
<tr>
<td align="left">readonly</td>
<td align="left">123</td>
<td align="left">åªè¯»</td>
</tr>
</tbody></table>
<h4 id="æ­¥éª¤æ¦‚è§ˆ-1"><a href="#æ­¥éª¤æ¦‚è§ˆ-1" class="headerlink" title="æ­¥éª¤æ¦‚è§ˆ"></a>æ­¥éª¤æ¦‚è§ˆ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. ç™»é™†æ•°æ®åº“åæ“ä½œå¦‚ä¸‹ï¼š</span></span><br><span class="line">use mysql;</span><br><span class="line">create table user_1 like user;</span><br><span class="line">insert into user_1 select * from user;</span><br><span class="line">delete from mysql.user_1 where user='root';</span><br><span class="line">insert into mysql.user_1 values ('%','root', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','joowingbuz', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','ottersync', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','syncdw', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','datasis', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','joowingv', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','datadev', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">insert into mysql.user_1 values ('%','readonly', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. é€€å‡ºæ•°æ®åº“å¹¶åœæ­¢æœåŠ¡</span></span><br><span class="line">/data/mysql/support-files/mysql.server stop</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. å°†user_1è¡¨çš„ç‰©ç†æ–‡ä»¶è¦†ç›–userè¡¨</span></span><br><span class="line">cd /data/xtrabackup_data/mysql/</span><br><span class="line">mv user.frm user.ibd user.MYD user.MYI user.TRG /tmp</span><br><span class="line">mv user_1.frm user.frm</span><br><span class="line">mv user_1.MYI user.MYI</span><br><span class="line">mv user_1.MYD user.MYD</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. å¯åŠ¨æ•°æ®åº“</span></span><br><span class="line">/data/mysql/support-files/mysql.server start</span><br></pre></td></tr></table></figure>

<h4 id="æ“ä½œæ˜ç»†"><a href="#æ“ä½œæ˜ç»†" class="headerlink" title="æ“ä½œæ˜ç»†"></a>æ“ä½œæ˜ç»†</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@MySQL-01 15:42:  [(none)]&gt; use mysql</span><br><span class="line">Database changed</span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; create table user_1 like user;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; insert into user_1 select * from user;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; select user,host,authentication_string from mysql.user;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; select user,host,authentication_string from mysql.user_1;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:42:  [mysql]&gt; desc mysql.user_1;</span><br><span class="line">+------------------------+-----------------------------------+------+-----+---------+-------+</span><br><span class="line">| Field                  | Type                              | Null | Key | Default | Extra |</span><br><span class="line">+------------------------+-----------------------------------+------+-----+---------+-------+</span><br><span class="line">| Host                   | char(60)                          | NO   | PRI |         |       |</span><br><span class="line">| User                   | char(16)                          | NO   | PRI |         |       |</span><br><span class="line">| Password               | char(41)                          | NO   |     |         |       |</span><br><span class="line">| Select_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Insert_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Update_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Delete_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Drop_priv              | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Reload_priv            | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Shutdown_priv          | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Process_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| File_priv              | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Grant_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| References_priv        | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Index_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Alter_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Show_db_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Super_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_tmp_table_priv  | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Lock_tables_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Execute_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Repl_slave_priv        | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Repl_client_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_view_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Show_view_priv         | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_routine_priv    | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Alter_routine_priv     | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_user_priv       | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Event_priv             | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Trigger_priv           | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| Create_tablespace_priv | enum('N','Y')                     | NO   |     | N       |       |</span><br><span class="line">| ssl_type               | enum('','ANY','X509','SPECIFIED') | NO   |     |         |       |</span><br><span class="line">| ssl_cipher             | blob                              | NO   |     | NULL    |       |</span><br><span class="line">| x509_issuer            | blob                              | NO   |     | NULL    |       |</span><br><span class="line">| x509_subject           | blob                              | NO   |     | NULL    |       |</span><br><span class="line">| max_questions          | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| max_updates            | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| max_connections        | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| max_user_connections   | int(11) unsigned                  | NO   |     | 0       |       |</span><br><span class="line">| plugin                 | char(64)                          | YES  |     |         |       |</span><br><span class="line">| authentication_string  | text                              | YES  |     | NULL    |       |</span><br><span class="line">+------------------------+-----------------------------------+------+-----+---------+-------+</span><br><span class="line">42 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:47:  [mysql]&gt; delete from mysql.user_1 where user='root';</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:51:  [mysql]&gt; insert into mysql.user_1 values ('%','root', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','joowingbuz', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','ottersync', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','syncdw', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','datasis', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','joowingv', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','datadev', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; insert into mysql.user_1 values ('%','readonly', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('123'));</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; select user,host,authentication_string from mysql.user;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host      | authentication_string                     |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | 127.0.0.1 | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">| root | ::1       | *D4DF57DFB7019B3D8C4294CC413AF1D650A275E4 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:52:  [mysql]&gt; select user,host,authentication_string from mysql.user_1;</span><br><span class="line">+------------+------+-------------------------------------------+</span><br><span class="line">| user       | host | authentication_string                     |</span><br><span class="line">+------------+------+-------------------------------------------+</span><br><span class="line">| ottersync  | %    | *9443FA914A2D69FE8832F8294E7422CC1B02A492 |</span><br><span class="line">| joowingbuz | %    | *DFFDA1CA6135E355EF468AB13A465BB5D4FE2B11 |</span><br><span class="line">| root       | %    | *89BE852E4EECFD217F0C5463FB30AD25BD0751E0 |</span><br><span class="line">| syncdw     | %    | *3DD7B4B4F6EE968FF3452B607BDEE6294B6A425A |</span><br><span class="line">| datasis    | %    | *011D511C71990F832C531A0F9CFB34CF7BB4E485 |</span><br><span class="line">| joowingv   | %    | *56B364074270DF7F6D670A6B4F5A4AD13322397A |</span><br><span class="line">| datadev    | %    | *D3D73E0F6BFC3159B024EF31484B6F9CC2963C5B |</span><br><span class="line">| readonly   | %    | *E2BA196C0C7F409990FDB3FAB5F9C7CE95F7C449 |</span><br><span class="line">+------------+------+-------------------------------------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@joowing-server-06:~# /data/mysql/support-files/mysql.server stop</span><br><span class="line">Shutting down MySQL</span><br><span class="line">...... * </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@joowing-server-06:~# cd /data/xtrabackup_data/</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data# cd mysql</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# ll user*</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ  14 15:42 user_1.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   744 8æœˆ  14 15:52 user_1.MYD</span><br><span class="line">-rw-r----- 1 mysql mysql  2048 8æœˆ  14 15:53 user_1.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ   9 20:14 user.frm</span><br><span class="line">-rw-r----- 1 mysql mysql 98304 8æœˆ   9 20:14 user.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql   328 8æœˆ   9 20:14 user.MYD</span><br><span class="line">-rw-r--r-- 1 mysql mysql  2048 8æœˆ   9 20:14 user.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql  3569 8æœˆ   9 20:14 user.TRG</span><br><span class="line">-rw-r----- 1 mysql mysql  3982 8æœˆ   9 20:14 user_view.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user.frm user.ibd user.MYD user.MYI user.TRG /data</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# ll user*</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ  14 15:42 user_1.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   744 8æœˆ  14 15:52 user_1.MYD</span><br><span class="line">-rw-r----- 1 mysql mysql  2048 8æœˆ  14 15:53 user_1.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql  3982 8æœˆ   9 20:14 user_view.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user_1.frm user.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user_1.MYI user.MYI</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mv user_1.MYD user.MYD</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# ll user*</span><br><span class="line">-rw-r----- 1 mysql mysql 10630 8æœˆ  14 15:42 user.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   744 8æœˆ  14 15:52 user.MYD</span><br><span class="line">-rw-r----- 1 mysql mysql  2048 8æœˆ  14 15:53 user.MYI</span><br><span class="line">-rw-r----- 1 mysql mysql  3982 8æœˆ   9 20:14 user_view.frm</span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# /data/mysql/support-files/mysql.server start</span><br><span class="line">Starting MySQL</span><br><span class="line">...... * </span><br><span class="line"></span><br><span class="line">root@joowing-server-06:/data/xtrabackup_data/mysql# mysql -uroot -p'123'</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 5</span><br><span class="line">Server version: 5.7.20-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">root@MySQL-01 15:55:  [(none)]&gt; show slave status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: rm-uf6f05k2rg95s23bp.mysql.rds.aliyuncs.com</span><br><span class="line">                  Master_User: idc_slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.001641</span><br><span class="line">          Read_Master_Log_Pos: 447207506</span><br><span class="line">               Relay_Log_File: joowing-server-06-relay-bin.000225</span><br><span class="line">                Relay_Log_Pos: 35529076</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.001641</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: mysql.%,sys.%,information_schema.%</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 447207506</span><br><span class="line">              Relay_Log_Space: 35529295</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 1095052097</span><br><span class="line">                  Master_UUID: b3e1de69-5daa-11e8-bed2-7cd30ab8a9fc</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: b3e1de69-5daa-11e8-bed2-7cd30ab8a9fc:97478646-97483368</span><br><span class="line">            Executed_Gtid_Set: b3e1de69-5daa-11e8-bed2-7cd30ab8a9fc:1-97483368,</span><br><span class="line">c39ecf19-5daa-11e8-aa9c-7cd30ac4764a:1-178658794,</span><br><span class="line">c69289d7-9bc9-11e8-b922-44a842431b62:1-12</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: </span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> éªŒè¯åªè¯»è´¦å·</span></span><br><span class="line">mysql -uroot	-p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -ujoowingbuz -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -uottersync -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -usyncdw -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -udatasis -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -ujoowingv -p'123'  -e "create database dbzyadmin;"</span><br><span class="line">mysql -udatadev -p'123' -e "create database dbzyadmin;"</span><br><span class="line">mysql -ureadonly -p'123'  -e "create database dbzyadmin;"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åªè¯»è´¦å·æ— æ³•æ‰§è¡Œå†™æ“ä½œï¼ŒéªŒè¯æˆåŠŸ</span></span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">ERROR 1044 (42000) at line 1: Access denied for user 'readonly'@'%' to database 'dbzyadmin'</span><br></pre></td></tr></table></figure>

<h4 id="åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—"><a href="#åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—" class="headerlink" title="åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—"></a>åç»­ç”¨æˆ·æƒé™å˜æ›´æ“ä½œæŒ‡å—</h4><blockquote>
<p>åç»­æ–°å¢ç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·ã€æ›´æ”¹å¯†ç å‘½ä»¤å¦‚ä¸‹ï¼š</p>
</blockquote>
<h5 id="æ–°å¢è¯»å†™ç”¨æˆ·"><a href="#æ–°å¢è¯»å†™ç”¨æˆ·" class="headerlink" title="æ–°å¢è¯»å†™ç”¨æˆ·"></a>æ–°å¢è¯»å†™ç”¨æˆ·</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">insert into mysql.user_1 values ('%','ã€ç”¨æˆ·åã€‘', '', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', 'Y', '', '', '', '', 0, 0, 0, 0, '', password('ã€å¯†ç ã€‘'));</span><br></pre></td></tr></table></figure>

<h5 id="æ–°å¢åªè¯»ç”¨æˆ·"><a href="#æ–°å¢åªè¯»ç”¨æˆ·" class="headerlink" title="æ–°å¢åªè¯»ç”¨æˆ·"></a>æ–°å¢åªè¯»ç”¨æˆ·</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">insert into mysql.user_1 values ('%','ã€ç”¨æˆ·åã€‘', '', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', '', '', '', '', 0, 0, 0, 0, '', password('ã€å¯†ç ã€‘'));</span><br></pre></td></tr></table></figure>

<h5 id="åˆ é™¤ç”¨æˆ·å‘½ä»¤"><a href="#åˆ é™¤ç”¨æˆ·å‘½ä»¤" class="headerlink" title="åˆ é™¤ç”¨æˆ·å‘½ä»¤"></a>åˆ é™¤ç”¨æˆ·å‘½ä»¤</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">delete from mysql.user where user='ã€ç”¨æˆ·åã€‘';</span><br></pre></td></tr></table></figure>

<h5 id="ä¿®æ”¹å¯†ç "><a href="#ä¿®æ”¹å¯†ç " class="headerlink" title="ä¿®æ”¹å¯†ç "></a>ä¿®æ”¹å¯†ç </h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">update mysql.user set authentication_string=password('ã€å¯†ç ã€‘') where user='ã€ç”¨æˆ·åã€‘';</span><br></pre></td></tr></table></figure>

<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>RDSç›®å‰ä½¿ç”¨MySQLç‰ˆæœ¬å’Œå®˜æ–¹åœ¨ç³»ç»Ÿåº“ä¸Šå·®å¼‚è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œè‹¥éœ€è¦æ­å»ºRDSåˆ°çº¿ä¸‹è‡ªå»ºMySQL5.7çš„ä¸»ä»æ—¶ï¼Œå¯ä»¥é€šè¿‡æ­¤æ³•å»å®ç°ã€‚</p>
<p>æœ¬æ–‡ä¸­å¯¹userè¡¨çš„ç ´è§£ï¼ŒåŒæ ·é€‚é€‚ç”¨äº<code>mysql.db</code> ã€<code>mysql.tables_priv</code>è¡¨ï¼Œéƒ½ç ´è§£åˆ™å¯ä»¥å°†æƒé™ä»ç”¨æˆ·æ‹“å±•åˆ°åº“è¡¨åˆ—ã€‚è¯»è€…å¯è‡ªè¡Œå®éªŒæµ‹è¯•ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯å¹¿è§’</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>RDS</tag>
        <tag>ä¸»ä»åŒæ­¥</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ©ç”¨splitå·¥å…·è§£å†³ä¸€æ¬¡MongoDBæ—¥å¿—å¼‚å¸¸é—®é¢˜</title>
    <url>/2018/08/03/%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>æ‘˜è¦ï¼š </p>
<ul>
<li>æŸå¤©æ™šä¸Šåˆšåˆ°å®¶ä¸ä¹…ï¼Œå°±æ¥åˆ°æ­å·åŒäº‹çš„ç”µè¯ï¼Œå®¢æˆ·MongoDBé›†ç¾¤ä¸­çš„æŸä¸ªåˆ†ç‰‡èŠ‚ç‚¹CPUé£™é«˜ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯æ…¢æŸ¥è¯¢ï¼Œç°åœ¨éœ€è¦æ‹‰å–CPUé£™é«˜æ—¶é—´æ®µçš„æ…¢æŸ¥è¯¢ã€‚å¿ƒæƒ³æ‹‰å–æ…¢æŸ¥è¯¢åº”è¯¥å¾ˆå¿«ï¼Œä¸å°±æ˜¯ä¸ªç³»ç»Ÿæ—¥å¿—å—ï¼Ÿè€Œä¸”è¿˜åšäº†æ—¥å¿—åˆ‡å‰²ä¸€å¤©ä¸€ä¸ªï¼ŒæŒ‰é“ç†å¾ˆå¿«æå®šçš„ï¼Œè°çŸ¥å½“å¤©æ™šä¸Šæäº†æ¥è¿‘ä¸‰ä¸ªå°æ—¶ä¹Ÿæ²¡æå®šã€‚ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</li>
<li>è¿›å…¥åˆ°æ—¥å¿—ç›®å½•ä¸€çœ‹ï¼Œç›®å‰ä¿ç•™è¿‘7å¤©çš„æ—¥å¿—ï¼Œæ¯å¤©çš„æ—¥å¿—é‡åœ¨23G~24Gï¼Œæˆ‘å½“æ—¶å°±æƒ³è¿™ä¸ªå®¢æˆ·æ•°æ®é‡è¿™ä¹ˆå¤§ï¼åç»­å‘ç°æ—¥å¿—æ ¼å¼æœ¬è¯¥ä¸ºæ™®é€šæ–‡æœ¬æ–‡ä»¶ç¡®å˜æˆäº†å›¾ç‰‡æ ¼å¼ï¼Œç©¶ç«Ÿä¸ºä½•ä¼šæ–‡ä»¶æ ¼å¼ä¼šè½¬å˜ï¼Ÿèƒ½å¦ä»å›¾ç‰‡æ ¼å¼ä¸­æ‹‰å–æŒ‡å®šæ—¶é—´æ®µçš„æ—¥å¿—å‘¢ï¼Ÿ</li>
<li>ç¬¬äºŒå¤©åˆ°å…¬å¸ï¼Œç”±äºå®¢æˆ·ç¯å¢ƒæˆ‘ä»¬ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥æ‰‹ï¼Œå› æ­¤å’±ä»¬æŠ€æœ¯ä¸“å®¶å›¢é˜Ÿæäº†ä¸€ä¸ª3äººçš„â€ä¸“å®¶ä¼šè¯Šâ€ï¼Œç»è¿‡äº†ä¸€ç•ªæŠ˜è…¾æ€»ç®—æŠŠåŸå› æ‰¾åˆ°äº†ï¼Œå…·ä½“è¿‡ç¨‹è¯·çœ‹ä¸‹æ–‡ï¼</li>
</ul>
<a id="more"></a>

<h2 id="æ•…äº‹èƒŒæ™¯"><a href="#æ•…äº‹èƒŒæ™¯" class="headerlink" title="æ•…äº‹èƒŒæ™¯"></a>æ•…äº‹èƒŒæ™¯</h2><h3 id="æ•°æ®åº“æ˜ç»†"><a href="#æ•°æ®åº“æ˜ç»†" class="headerlink" title="æ•°æ®åº“æ˜ç»†"></a>æ•°æ®åº“æ˜ç»†</h3><p>è¯´åœ¨å‰é¢ï¼š</p>
<ul>
<li>æ•°æ®åº“ï¼šMongoDBé›†ç¾¤ 4ä¸ªåˆ†ç‰‡èŠ‚ç‚¹</li>
<li>åˆ†ç‰‡èŠ‚ç‚¹è§„æ ¼ï¼š16æ ¸ / 32G CentOS 7.4 64ä½</li>
<li>æ•°æ®ç›®å½•æ‰€åœ¨ç£ç›˜: 300G   49G  252G  17% /data</li>
</ul>
<h3 id="æ•…äº‹æƒ…èŠ‚"><a href="#æ•…äº‹æƒ…èŠ‚" class="headerlink" title="æ•…äº‹æƒ…èŠ‚"></a>æ•…äº‹æƒ…èŠ‚</h3><ul>
<li>æŸå¤©æ™šä¸Šåˆšåˆ°å®¶ä¸ä¹…ï¼Œå°±æ¥åˆ°æ­å·åŒäº‹çš„ç”µè¯ï¼Œå®¢æˆ·MongoDBé›†ç¾¤ä¸­çš„æŸä¸ªåˆ†ç‰‡èŠ‚ç‚¹CPUé£™é«˜ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯æ…¢æŸ¥è¯¢ï¼Œç°åœ¨éœ€è¦æ‹‰å–CPUé£™é«˜æ—¶é—´æ®µçš„æ…¢æŸ¥è¯¢ã€‚å¿ƒæƒ³æ‹‰å–æ…¢æŸ¥è¯¢åº”è¯¥å¾ˆå¿«ï¼Œä¸å°±æ˜¯ä¸ªç³»ç»Ÿæ—¥å¿—å—ï¼Ÿè€Œä¸”è¿˜åšäº†æ—¥å¿—åˆ‡å‰²ä¸€å¤©ä¸€ä¸ªï¼ŒæŒ‰é“ç†å¾ˆå¿«æå®šçš„ï¼Œè°çŸ¥å½“å¤©æ™šä¸Šæäº†æ¥è¿‘ä¸‰ä¸ªå°æ—¶ä¹Ÿæ²¡æå®šã€‚ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</li>
<li>è¿›å…¥åˆ°æ—¥å¿—ç›®å½•ä¸€çœ‹ï¼Œç›®å‰ä¿ç•™è¿‘7å¤©çš„æ—¥å¿—ï¼Œæ¯å¤©çš„æ—¥å¿—é‡åœ¨23G~24Gï¼Œæˆ‘å½“æ—¶å°±æƒ³è¿™ä¸ªå®¢æˆ·æ•°æ®é‡è¿™ä¹ˆå¤§ï¼åç»­å‘ç°æ—¥å¿—æ ¼å¼æœ¬è¯¥ä¸ºæ™®é€šæ–‡æœ¬æ–‡ä»¶ç¡®å˜æˆäº†å›¾ç‰‡æ ¼å¼ï¼Œç©¶ç«Ÿä¸ºä½•ä¼šæ–‡ä»¶æ ¼å¼ä¼šè½¬å˜ï¼Ÿèƒ½å¦ä»å›¾ç‰‡æ ¼å¼ä¸­æ‹‰å–æŒ‡å®šæ—¶é—´æ®µçš„æ—¥å¿—å‘¢ï¼Ÿ</li>
<li>ç¬¬äºŒå¤©åˆ°å…¬å¸ï¼Œç”±äºå®¢æˆ·ç¯å¢ƒæˆ‘ä»¬ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥å—ï¼Œå› æ­¤å’±ä»¬æŠ€æœ¯ä¸“å®¶å›¢é˜Ÿæäº†ä¸€ä¸ª3äººçš„â€ä¸“å®¶ä¼šè¯Šâ€ï¼Œç»è¿‡äº†ä¸€ç•ªæŠ˜è…¾æ€»ç®—æŠŠåŸå› æ‰¾åˆ°äº†ï¼Œå…·ä½“è¿‡ç¨‹è¯·çœ‹ä¸‹æ–‡ï¼</li>
</ul>
<h2 id="å¤ç°ä¸å‰–æ"><a href="#å¤ç°ä¸å‰–æ" class="headerlink" title="å¤ç°ä¸å‰–æ"></a>å¤ç°ä¸å‰–æ</h2><h3 id="æ‹‰å–æ—¥å¿—å¼‚å¸¸"><a href="#æ‹‰å–æ—¥å¿—å¼‚å¸¸" class="headerlink" title="æ‹‰å–æ—¥å¿—å¼‚å¸¸"></a>æ‹‰å–æ—¥å¿—å¼‚å¸¸</h3><p><strong>ä½¿ç”¨mlogfilterè¿‡æ»¤æ–‡ä»¶æ—¶æŠ¥é”™è¯´æ–‡ä»¶émongodbçš„æ—¥å¿—æ–‡ä»¶</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@sh_01 booboo]# mlogfilter shard.log.2018-08-01 --from 2018-08-01T15:00:00.000+0800 --to "+1h" --slow 1000 &gt; /alidata/booboo/tf.1</span><br><span class="line">æŠ¥é”™:émongodbæ—¥å¿—æ ¼å¼</span><br></pre></td></tr></table></figure>

<p>å›åˆ°å®¢æˆ·æœåŠ¡å™¨æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ ¼å¼ï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@MONGO-SHARD-18 logs]# file *</span><br><span class="line">shard.log:            PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-25: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-26: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-27: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-28: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-29: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-30: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-31: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-01: PCX ver. 2.5 image data</span><br></pre></td></tr></table></figure>

<p>mongodbçš„æ—¥å¿—æ­£å¸¸åº”è¯¥ä¸ºï¼š<code>ASCII text, with very long lines</code>ï¼Œä½†æ˜¯ç°åœ¨å´å˜æˆäº†<code>PCX ver. 2.5 image data</code>ã€‚éœ€è¦å¼„æ¸…æ¥šåŸå› ã€‚</p>
<h3 id="æ—¥å¿—å¼‚å¸¸åˆ†æ"><a href="#æ—¥å¿—å¼‚å¸¸åˆ†æ" class="headerlink" title="æ—¥å¿—å¼‚å¸¸åˆ†æ"></a>æ—¥å¿—å¼‚å¸¸åˆ†æ</h3><ul>
<li>ä¸ºä»€ä¹ˆå®¢æˆ·æ¯å¤©çš„æ—¥å¿—é‡è¾¾åˆ°22ä¸ªGï¼Œå¹¶ä¸”æ¯å¤©çš„æ—¥å¿—é‡éƒ½æ˜¯å¤§äºç­‰äºå‰ä¸€å¤©ï¼Ÿå¾ˆæ˜¾ç„¶ï¼Œæ—¥å¿—æˆªæ–­æœ‰é—®é¢˜ã€‚</li>
<li>è¿™ä¸ªæ˜¯è¿‘7å¤©çš„æ—¥å¿—ï¼Œè€Œæ—¥å¿—æ ¼å¼å˜æˆäº†PCXå›¾ç‰‡æ ¼å¼æ˜¯ä¸ºä½•ï¼Ÿ</li>
<li>æ€€ç–‘æ¯æ¬¡æ—¥å¿—è½®è¯¢æ—¶éƒ½æ²¡æœ‰çœŸæ­£æˆªæ–­æ—¥å¿—ï¼</li>
</ul>
<p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/01.png" alt=""></p>
<h3 id="åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†"><a href="#åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†" class="headerlink" title="åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†"></a>åˆ†æåŸæ—¥å¿—åˆ‡å‰²æ˜ç»†</h3><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/03.png" alt=""></p>
<p>æ€€ç–‘ä¸<code>echo &gt;</code>æœ‰å…³ï¼Œè¿›è¡ŒéªŒè¯ã€‚</p>
<h3 id="éªŒè¯echo-gt-ä¸PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´"><a href="#éªŒè¯echo-gt-ä¸PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´" class="headerlink" title="éªŒè¯echo &gt;ä¸PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´"></a>éªŒè¯<code>echo &gt;</code>ä¸<code>PCXå›¾ç‰‡å¤´éƒ¨0aä¸€è‡´</code></h3><ol>
<li>å»ºä¸€ä¸ªç©ºæ–‡æ¡£<code>log</code>ï¼›æ‰§è¡Œ<code>echo &gt; log</code>ï¼›é€šè¿‡<code>cat -A log</code>æŸ¥çœ‹æ–‡ä»¶ä¸­æ’å…¥äº†ä¸€ä¸ªç¬¦å·å³æ¢è¡Œç¬¦<code>\n</code></li>
<li>é€šè¿‡<code>hexdump -c log</code> æŸ¥çœ‹æµ‹è¯•æ–‡ä»¶å¤´éƒ¨æ˜¾ç¤ºä¸ºASCIIå­—ç¬¦ <code>\n</code></li>
<li>é€šè¿‡<code>hexdump -d log</code> æŸ¥çœ‹æµ‹è¯•æ–‡ä»¶å¤´éƒ¨æ˜¾ç¤ºä¸º16è¿›åˆ¶<code>00010</code> å³<code>0a</code></li>
<li>é€šè¿‡<code>vim</code> ç”¨16è¿›åˆ¶æŸ¥çœ‹æ–‡æ¡£<code>log</code>å¯ä»¥çœ‹åˆ°logçš„æ–‡ä»¶å¤´éƒ¨ä¸º<code>0a</code>ï¼Œæ­£æ˜¯PCXå›¾ç‰‡çš„å¤´éƒ¨</li>
<li>ç”Ÿäº§ç¯å¢ƒæŸ¥çœ‹å®¢æˆ·æœ‰é—®é¢˜çš„mongodbç³»ç»Ÿæ—¥å¿—æ–‡ä»¶æ ¼å¼ä¸º<code>PCX</code>å›¾ç‰‡æ ¼å¼</li>
<li>é€šè¿‡<code>hexdump -c log</code> æ˜¾ç¤ºä¸ºASCIIå­—ç¬¦ï¼Œç”Ÿäº§æ—¥å¿—æ–‡ä»¶å¤´éƒ¨ä¸æµ‹è¯•çš„logä¸€è‡´ï¼Œéƒ½æ˜¯<code>\n</code></li>
<li>é€šè¿‡<code>hexdump -d log</code>æ˜¾ç¤ºä¸º16è¿›åˆ¶ï¼Œç”Ÿäº§æ—¥å¿—æ–‡ä»¶å¤´éƒ¨ä¸æµ‹è¯•çš„logä¸€è‡´<code>00010</code> å³ <code>0a</code></li>
</ol>
<p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/02.png" alt=""></p>
<p><strong>åˆ°æ­¤éªŒè¯æˆåŠŸ:é€šè¿‡<code>echo &gt; log</code>çš„æ–¹å¼ä¼šå¾€æ–‡ä»¶å¤´éƒ¨æ–°å¢â€™0aâ€™</strong></p>
<hr>
<h3 id="å¤ç°MongoDBæ—¥å¿—ä»ASCII-textè½¬å˜ä¸ºPCX-æ ¼å¼"><a href="#å¤ç°MongoDBæ—¥å¿—ä»ASCII-textè½¬å˜ä¸ºPCX-æ ¼å¼" class="headerlink" title="å¤ç°MongoDBæ—¥å¿—ä»ASCII textè½¬å˜ä¸ºPCX æ ¼å¼"></a>å¤ç°MongoDBæ—¥å¿—ä»ASCII textè½¬å˜ä¸ºPCX æ ¼å¼</h3><p>åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¤ç°æ—¥å¿—ä»<code>ASCII text</code>å˜æˆ<code>PCX ver. 2.5 image data</code></p>
<ol>
<li>é€šè¿‡mongoç™»é™†æ•°æ®åº“æ‰§è¡Œå¤§é‡çš„æ’å…¥æ“ä½œ</li>
<li>é€šè¿‡echo &gt; mongod27017.log  å‘½ä»¤å°è¯•æ¸…ç©ºmongod27017.log</li>
<li>æŸ¥çœ‹æˆªæ–­åçš„æ—¥å¿—æ–‡ä»¶æ ¼å¼ï¼Œå˜æˆäº†very short file (no magic)</li>
<li>ç­‰æ–‡æ¡£æ’å…¥å®Œæ¯•</li>
<li>é€šè¿‡<code>tail -f</code> æŸ¥çœ‹æ—¥å¿—æ˜ç»†ï¼Œçœ‹åˆ°ç¡®å®æœ‰æ—¥å¿—å†™å…¥</li>
<li>æŸ¥çœ‹æ—¥å¿—æ ¼å¼ï¼Œå‘ç°å˜æˆäº†<code>PCX ver. 2.5 image data</code></li>
</ol>
<p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/05.png" alt=""></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@sh_01 ~]# mongo</span><br><span class="line">MongoDB shell version: 3.2.16</span><br><span class="line">connecting to: test</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.auth(<span class="string">'test_dev'</span>,<span class="string">'uplooking'</span>)</span></span><br><span class="line">1</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.t1.find()</span></span><br><span class="line">&#123; "_id" : ObjectId("5b5ebb6796b8b74a73ee30f6"), "a" : 1, "b" : 2 &#125;</span><br><span class="line">&#123; "_id" : ObjectId("5b5ebb6996b8b74a73ee30f7"), "a" : 1, "b" : 1 &#125;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="keyword">for</span> (i=1;i&lt;200000;i++)&#123;</span></span><br><span class="line">... db.t1.insert(&#123;id:i&#125;)&#125;</span><br><span class="line">WriteResult(&#123; "nInserted" : 1 &#125;)</span><br><span class="line"></span><br><span class="line">[root@sh_01 ~]# cd /alidata/mongodb/logs</span><br><span class="line">[root@sh_01 log]# ll</span><br><span class="line">-rw-r--r-- 1 root root 2182 Aug  3 10:28 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3100 Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line"></span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# ll</span><br><span class="line">total 12</span><br><span class="line">-rw-r--r-- 1 root root    1 Aug  3 10:29 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3100 Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     very short file (no magic)</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line"></span><br><span class="line">[root@sh_01 log]# tail -f mongod27017.log</span><br><span class="line"></span><br><span class="line">2018-08-03T10:30:21.936+0800 I NETWORK  [initandlisten] connection accepted from 127.0.0.1:43720 #2 (2 connections now open)</span><br><span class="line"></span><br><span class="line">[root@sh_01 log]# ll -h</span><br><span class="line">total 12K</span><br><span class="line">-rw-r--r-- 1 root root 2.8K Aug  3 10:30 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3.1K Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1.5K Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     PCX ver. 2.5 image data</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸€è¾¹ä¸æ–­äº§ç”Ÿæ—¥å¿—ï¼Œä¸€è¾¹å¤šæ¬¡æ‰§è¡Œ<span class="built_in">echo</span>&gt; </span></span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     PCX ver. 2.5 image data</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# echo &gt; mongod27017.log</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     very short file (no magic)</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# ll -h</span><br><span class="line">total 16K</span><br><span class="line">-rw-r--r-- 1 root root    1 Aug  3 11:28 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3.1K Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1.5K Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">-rw-r--r-- 1 root root 2.9K Aug  3 11:05 mongod27017.log.2018-08-03T03-09-08</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     very short file (no magic)</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     PCX ver. 2.5 image data</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br><span class="line">[root@sh_01 log]# hexdump -c mongod27017.log</span><br><span class="line">0000000  \n  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">0000010  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">*</span><br><span class="line">0000850  \0  \0  \0  \0  \0  \0  \0   2   0   1   8   -   0   8   -   0</span><br><span class="line">0000860   3   T   1   1   :   2   9   :   0   6   .   7   2   9   +   0</span><br><span class="line">0000870   8   0   0       I       A   C   C   E   S   S               [</span><br><span class="line">0000880   c   o   n   n   3   ]       U   n   a   u   t   h   o   r   i</span><br><span class="line">0000890   z   e   d   :       n   o   t       a   u   t   h   o   r   i</span><br><span class="line">00008a0   z   e   d       o   n       t   e   s   t       t   o       e</span><br><span class="line">00008b0   x   e   c   u   t   e       c   o   m   m   a   n   d       &#123;</span><br><span class="line">00008c0       f   i   n   d   :       "   t   1   "   ,       f   i   l</span><br><span class="line">00008d0   t   e   r   :       &#123;   &#125;       &#125;  \n</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸå¤ç°äº†å®¢æˆ·çš„æƒ…å†µï¼š</p>
<ol>
<li><p>ç¬¬ä¸€æ¬¡<code>echo &gt; log</code>ï¼Œæ–‡ä»¶å¤´éƒ¨æ–°å¢<code>\n</code></p>
</li>
<li><p>å¤šæ¬¡<code>echo &gt; log</code>,æ–‡ä»¶å¤´éƒ¨å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">0000000  \n  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">0000010  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">*</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>ç¡®å®æ˜¯mongodbæ—¥å¿—è½®è¯¢å‡ºäº†é—®é¢˜ï¼š</p>
<ol>
<li><code>echo &gt; log</code>ä¼šå¾€æ–‡ä»¶å¤´éƒ¨æ’å…¥<code>\n</code>å³16è¿›åˆ¶çš„<code>0a</code></li>
<li>åœ¨æ•°æ®åº“æ­£å¸¸è¿è¡Œä¸­ï¼Œå¯¹logæ–‡ä»¶æ˜¯åŠ äº†é”çš„ï¼Œå¼ºåˆ¶æ‰§è¡Œ<code>echo &gt; log</code>æ˜¯æ— æ³•è¿›è¡Œè¦†ç›–çš„ï¼Œä¼šå°†æ‰€æœ‰çš„æ•°æ®å…¨éƒ¨ç½®ä¸º<code>0</code></li>
<li>å¼ºåˆ¶è¦†ç›–åï¼Œæ–‡ä»¶å¤´éƒ¨å˜æˆäº†æ— æ•°çš„ç©ºç™½</li>
</ol>
<h3 id="å¾…è§£å†³é—®é¢˜"><a href="#å¾…è§£å†³é—®é¢˜" class="headerlink" title="å¾…è§£å†³é—®é¢˜"></a>å¾…è§£å†³é—®é¢˜</h3><ul>
<li>MongoDBæ—¥å¿—è½®è¯¢æ–¹æ³•è°ƒæ•´ä¸º<strong>kill -SIGUSER1 [mongodpid]</strong></li>
<li>ä¿®å¤ç›®å‰å·²ç»å˜ä¸ºå›¾ç‰‡æ ¼å¼çš„æ—¥å¿—ï¼Œå¹¶æ‹‰å–15ç‚¹åˆ°16ç‚¹çš„æ—¥å¿—</li>
</ul>
<h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><h3 id="MongoDBæ—¥å¿—è½®è¯¢"><a href="#MongoDBæ—¥å¿—è½®è¯¢" class="headerlink" title="MongoDBæ—¥å¿—è½®è¯¢"></a>MongoDBæ—¥å¿—è½®è¯¢</h3><h4 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@sh_01 log]# pidof mongod</span><br><span class="line">1828</span><br><span class="line">[root@sh_01 log]# kill -SIGUSER1 1828</span><br><span class="line">-bash: kill: SIGUSER1: invalid signal specification</span><br><span class="line">[root@sh_01 log]# kill -SIGUSR1 1828</span><br><span class="line">[root@sh_01 log]# ll</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  3 11:09 mongod27017.log</span><br><span class="line">-rw-r--r-- 1 root root 3100 Aug  2 14:19 mongod27017.log.2018-08-02T07-18-27</span><br><span class="line">-rw-r--r-- 1 root root 1526 Aug  2 15:18 mongod27017.log.2018-08-02T07-18-54</span><br><span class="line">-rw-r--r-- 1 root root 2942 Aug  3 11:05 mongod27017.log.2018-08-03T03-09-08</span><br><span class="line">[root@sh_01 log]# file *</span><br><span class="line">mongod27017.log:                     ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-27: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-02T07-18-54: ASCII text, with very long lines</span><br><span class="line">mongod27017.log.2018-08-03T03-09-08: PCX ver. 2.5 image data</span><br></pre></td></tr></table></figure>

<h4 id="ç”Ÿäº§ç¯å¢ƒ"><a href="#ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒ"></a>ç”Ÿäº§ç¯å¢ƒ</h4><p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/04.png" alt=""></p>
<p>ä¿®æ”¹æ—¥å¿—è½®è¯¢è„šæœ¬ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@MONGO-SHARD-18 logs]# cat /etc/init.d/mongo_logspit.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2018/08/02 Apple</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Rotate the MongoDB logs to prevent a single logfile from consuming too much disk space.</span></span><br><span class="line"></span><br><span class="line">cmd=mongod</span><br><span class="line">mongodpath=/opt/mongodb/bin</span><br><span class="line">pidarray=`pidof $&#123;mongodpath&#125;/$cmd`</span><br><span class="line">LOGPATH_SHARD=/data/mongodb/shard1/logs</span><br><span class="line"></span><br><span class="line">for pid in $pidarray;do</span><br><span class="line">if [ $pid ]</span><br><span class="line">then</span><br><span class="line">    kill -SIGUSR1 $pid</span><br><span class="line">fi</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash">clear logfile more than 7 days</span></span><br><span class="line">cd $LOGPATH_SHARD</span><br><span class="line">find ./ -xdev -mtime +7 -name "shard.log.*" -exec rm -f &#123;&#125;  \;</span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰çš„åˆ†ç‰‡éƒ½å»æ‰§è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kill -SIGUSR1 pidof mongod</span><br></pre></td></tr></table></figure>

<p>åˆ†ç‰‡15æ“ä½œå¦‚ä¸‹ï¼šå…¶ä»–åˆ†ç‰‡åŒæ ·</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zyadmin@MONGO-SHARD-15 ~]$ sudo -i</span><br><span class="line">[root@MONGO-SHARD-15 ~]# cd /data/mongodb/shard1/logs/</span><br><span class="line">[root@MONGO-SHARD-15 logs]# ll -h</span><br><span class="line">total 1.7G</span><br><span class="line">-rw-r--r-- 1 root root 20G Aug  2 15:27 shard.log</span><br><span class="line">-rw-r--r-- 1 root root 19G Jul 25 23:50 shard.log.2018-07-25</span><br><span class="line">-rw-r--r-- 1 root root 19G Jul 26 23:50 shard.log.2018-07-26</span><br><span class="line">-rw-r--r-- 1 root root 19G Jul 27 23:50 shard.log.2018-07-27</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 28 23:50 shard.log.2018-07-28</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 29 23:50 shard.log.2018-07-29</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 30 23:50 shard.log.2018-07-30</span><br><span class="line">-rw-r--r-- 1 root root 20G Jul 31 23:50 shard.log.2018-07-31</span><br><span class="line">-rw-r--r-- 1 root root 20G Aug  1 23:50 shard.log.2018-08-01</span><br><span class="line">[root@MONGO-SHARD-15 logs]# file *</span><br><span class="line">shard.log:            PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-25: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-26: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-27: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-28: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-29: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-30: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-31: PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-01: PCX ver. 2.5 image data</span><br><span class="line">[root@MONGO-SHARD-15 logs]# kill -SIGUSR1 `pidof mongod`</span><br><span class="line">[root@MONGO-SHARD-15 logs]# file *</span><br><span class="line">shard.log:                     ASCII text, with very long lines</span><br><span class="line">shard.log.2018-07-25:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-26:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-27:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-28:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-29:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-30:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-07-31:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-01:          PCX ver. 2.5 image data</span><br><span class="line">shard.log.2018-08-02T07-27-29: PCX ver. 2.5 image data</span><br><span class="line">[root@MONGO-SHARD-15 logs]# ll -h</span><br><span class="line">total 1.7G</span><br><span class="line">-rw-r--r-- 1 root root 2.0K Aug  2 15:27 shard.log</span><br><span class="line">-rw-r--r-- 1 root root  19G Jul 25 23:50 shard.log.2018-07-25</span><br><span class="line">-rw-r--r-- 1 root root  19G Jul 26 23:50 shard.log.2018-07-26</span><br><span class="line">-rw-r--r-- 1 root root  19G Jul 27 23:50 shard.log.2018-07-27</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 28 23:50 shard.log.2018-07-28</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 29 23:50 shard.log.2018-07-29</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 30 23:50 shard.log.2018-07-30</span><br><span class="line">-rw-r--r-- 1 root root  20G Jul 31 23:50 shard.log.2018-07-31</span><br><span class="line">-rw-r--r-- 1 root root  20G Aug  1 23:50 shard.log.2018-08-01</span><br><span class="line">-rw-r--r-- 1 root root  20G Aug  2 15:27 shard.log.2018-08-02T07-27-29</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®å¤å¼‚å¸¸æ—¥å¿—"><a href="#ä¿®å¤å¼‚å¸¸æ—¥å¿—" class="headerlink" title="ä¿®å¤å¼‚å¸¸æ—¥å¿—"></a>ä¿®å¤å¼‚å¸¸æ—¥å¿—</h3><h4 id="ä¿®å¤æ€è·¯"><a href="#ä¿®å¤æ€è·¯" class="headerlink" title="ä¿®å¤æ€è·¯"></a>ä¿®å¤æ€è·¯</h4><p>å¼„æ¸…æ¥šæ—¥å¿—å˜æ›´çš„åŸå› ä»¥åŠå¤ç°è¿‡ç¨‹åï¼Œä¸éš¾å‘ç°ï¼Œæ—¥å¿—å› ä¸ºå¤´éƒ¨å˜åŒ–ä»è€Œå¯¼è‡´æ–‡ä»¶æ ¼å¼å˜æ›´ã€‚å› æ­¤æ¨æµ‹å¼‚å¸¸æ—¥å¿—çš„ç»„æˆå¦‚ä¸‹ï¼š</p>
<ol>
<li>å¤´éƒ¨ä¸º<code>0a</code></li>
<li>ä¸­é—´å…¨éƒ¨éƒ½æ˜¯<code>0</code></li>
<li>æœ€åæ˜¯æ­£å¸¸çš„å­—ç¬¦ä¸²è®°å½•ç€mongodbçš„æ—¥å¿—ä¿¡æ¯ï¼Œç±»ä¼¼äº<code>2018-08-03T10:30:21.936+0800 I NETWORK  [initandlisten] connection accepted from 127.0.0.1:43720 #2 (2 connections now open)</code>ç”±æ—¥å¿—å’Œæ—¥å¿—æ˜ç»†ç»„æˆ</li>
</ol>
<p>å› æ­¤ä¿®å¤çš„æ€è·¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>23Gçš„æ—¥å¿—ï¼Œé¦–å…ˆæŒ‰ç…§å¤§å°6Gåšåˆ‡åˆ†<code>split -b 6G log</code>ï¼Œåˆ‡åˆ†æˆ4ä¸ªæ–‡ä»¶</li>
<li>æŸ¥çœ‹åˆ‡åˆ†åçš„æ—¥å¿—æ ¼å¼ï¼Œå¦‚æœæœ€åä¸€ä¸ªæ—¥å¿—ä¸º<code>ASCII text</code>åˆ™ä¸å†åˆ‡åˆ†å¦åˆ™ï¼Œå°†æœ€åä¸€ä¸ªæ—¥å¿—ç»§ç»­åˆ‡åˆ†</li>
<li>å¾ªç¯ä¸Šä¸€æ­¥ï¼Œç›´åˆ°æœ€åä¸€ä¸ªæ–‡ä»¶åˆ‡åˆ†å‡ºæ¥æ²¡æœ‰<code>ASCII text</code>ä¸ºæ­¢</li>
</ul>
<h4 id="æ“ä½œæ˜ç»†"><a href="#æ“ä½œæ˜ç»†" class="headerlink" title="æ“ä½œæ˜ç»†"></a>æ“ä½œæ˜ç»†</h4><blockquote>
<p>æ—¥å¿—è½®è¯¢çš„éƒ¨ç½²è·ç¦»ç°åœ¨å¤§æ¦‚4ä¸ªæœˆ</p>
</blockquote>
<ol>
<li><p>ç¬¬ä¸€æ¬¡å°†23Gçš„æ–‡ä»¶ä»¥6Gåˆ‡åˆ†æˆ4ä¸ªæ–‡ä»¶ï¼šxaa\xab\xac\xadï¼ŒæŸ¥çœ‹4ä¸ªæ–‡ä»¶çš„å±æ€§ä¸º</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xaa:               PCX ver. 2.5 image data</span><br><span class="line">xab:               PCX ver. 2.5 image data</span><br><span class="line">xac:               PCX ver. 2.5 image data</span><br><span class="line">xad:                PCX ver. 2.5 image data</span><br></pre></td></tr></table></figure></li>
<li><p>é‡å‘½åxadä¸ºx1ç¬¬äºŒæ¬¡åˆ‡åˆ†x1 5Gï¼ŒæŒ‰ç…§1Gåˆ‡åˆ†æˆ5ä»½ï¼ŒæŸ¥çœ‹æ–‡ä»¶å±æ€§</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xaa:               PCX ver. 2.5 image data</span><br><span class="line">xab:               PCX ver. 2.5 image data</span><br><span class="line">xac:               PCX ver. 2.5 image data</span><br><span class="line">xad:                PCX ver. 2.5 image data</span><br><span class="line">xae:                ASCII text, with very long lines</span><br></pre></td></tr></table></figure>
</li>
<li><p>é‡åxad ä¸º x2 æŒ‰ç…§15Mçš„å¤§å°åˆ‡åˆ†ï¼ŒæŸ¥çœ‹æ–‡ä»¶çš„å±æ€§å¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xaa:	      PCX ver. 2.5 image data</span><br><span class="line">æ­¤å¤„çœç•¥ã€‚ã€‚ã€‚</span><br><span class="line">xdo:               PCX ver. 2.5 image data</span><br><span class="line">xdp:               ASCII text, with very long lines</span><br><span class="line">xdq:               ASCII text, with very long lines</span><br><span class="line">xdr:               ASCII text, with very long lines</span><br><span class="line">xds:               ASCII text, with very long lines</span><br><span class="line">xdt:               ASCII text, with very long lines</span><br><span class="line">xdu:               ASCII text, with very long lines</span><br><span class="line">xdv:               UTF-8 Unicode text, with very long lines</span><br><span class="line">xdw:               ASCII text, with very long lines</span><br><span class="line">xdx:               ASCII text, with very long lines</span><br><span class="line">xdy:               ASCII text, with very long lines</span><br></pre></td></tr></table></figure></li>
<li><p>åˆ‡åˆ†åæ–‡ä»¶ç±»å‹ä¸º<code>ASCII text</code>çš„æ–‡ä»¶ä¸­æ‰¾åˆ°15ç‚¹~16ç‚¹çš„æ–‡æ¡£</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@sh_01 mongolog_20180801]# head -n 2 xdv</span><br><span class="line">re: "x86_64", version: "Kernel 3.10.0-693.2.2.el7.x86_64" &#125; &#125;</span><br><span class="line">2018-08-01T16:13:44.958+0800 I ACCESS   [conn4972925] Successfully authenticated as principal __system on local</span><br><span class="line">[root@sh_01 mongolog_20180801]# head -n 2 xdu</span><br><span class="line">38422 #4967772 (445 connections now open)</span><br><span class="line">2018-08-01T14:00:10.575+0800 I NETWORK  [thread1] connection accepted from 172.16.0.44:38430 #4967773 (446 connections now open)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><code>xdv</code> çš„å¤´éƒ¨æ˜¯<code>2018-08-01T16:13:44.958+0800</code>,å› æ­¤å¯ä»¥ç¡®å®š15~16çš„æ—¥å¿—åœ¨xduä¸­</li>
<li><code>xdu</code>è®°å½•çš„æ—¥å¿—æ—¶é—´æ®µä¸º<code>2018-08-01T14:00:10.575+0800</code>~<code>2018-08-01T16:13:44.958+0800</code></li>
<li>é‡å‘½å<code>xdu</code>ä¸º<code>mongolog.18.14_16</code></li>
</ul>
<h3 id="åˆ†ææ—¥å¿—"><a href="#åˆ†ææ—¥å¿—" class="headerlink" title="åˆ†ææ—¥å¿—"></a>åˆ†ææ—¥å¿—</h3><h4 id="åˆ†æå‘½ä»¤"><a href="#åˆ†æå‘½ä»¤" class="headerlink" title="åˆ†æå‘½ä»¤"></a>åˆ†æå‘½ä»¤</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è·å–08æœˆ01å·ä¸‹åˆ3ç‚¹å¼€å§‹åˆ°4ç‚¹æ‰§è¡Œæ—¶é—´è¶…è¿‡5ç§’çš„æŸ¥è¯¢</span></span><br><span class="line">mlogfilter mongolog.18.14_16 --from 2018-08-01T15 --to "+1h" --slow 5000 &gt; slowlog.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–08æœˆ01å·ä¸‹åˆ3ç‚¹å¼€å§‹åˆ°4ç‚¹è¯­å¥çš„æ‰§è¡Œæ¬¡æ•°ã€ç”¨æ—¶ç­‰ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line">mloginfo slowlog.txt  --queries &gt; an_slowlog.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡mplotqueriesè¿›è¡Œæ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾ç»˜åˆ¶ï¼Œä¸”åªè¿”å›å‰10ä¸ª</span></span><br><span class="line">mplotqueries slowlog.txt --output-file 01.png --logscale --group-limit 10</span><br></pre></td></tr></table></figure>

<h4 id="æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾"><a href="#æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾" class="headerlink" title="æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾"></a>æ…¢æŸ¥è¯¢æ•£ç‚¹åˆ†å¸ƒå›¾</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@sh_01 booboo]# mplotqueries slowlog.txt --output-file 01.png --logscale --group-limit 10</span><br><span class="line">                                                                                          </span><br><span class="line">SCATTER plot</span><br><span class="line">   id   #points  group</span><br><span class="line">    1       692  order.order</span><br><span class="line">    2       615  omdmain.item_region_erp</span><br><span class="line">    3         1  omdmain.customer</span><br><span class="line">()</span><br></pre></td></tr></table></figure>
<p><img src="%E5%88%A9%E7%94%A8split%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E4%B8%80%E6%AC%A1MongoDB%E6%97%A5%E5%BF%97%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/10.png" alt=""></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜"><a href="#mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜" class="headerlink" title="mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜"></a>mongodbæ—¥å¿—è½®è¯¢çš„é—®é¢˜</h3><ol>
<li><code>echo &gt; log</code>ä¼šå¾€æ–‡ä»¶å¤´éƒ¨æ’å…¥<code>\n</code>å³16è¿›åˆ¶çš„<code>0a</code></li>
<li>åœ¨æ•°æ®åº“æ­£å¸¸è¿è¡Œä¸­ï¼Œå¯¹logæ–‡ä»¶æ˜¯åŠ äº†é”çš„ï¼Œå¼ºåˆ¶æ‰§è¡Œ<code>echo &gt; log</code>æ˜¯æ— æ³•è¿›è¡Œè¦†ç›–çš„ï¼Œä¼šå°†æ‰€æœ‰çš„æ•°æ®å…¨éƒ¨ç½®ä¸º<code>0</code></li>
<li>å¼ºåˆ¶è¦†ç›–åï¼Œæ–‡ä»¶å¤´éƒ¨å˜æˆäº†æ— æ•°çš„ç©ºç™½</li>
</ol>
<h3 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h3><ul>
<li>MongoDBæ—¥å¿—è½®è¯¢æ–¹æ³•è°ƒæ•´ä¸º<strong>kill -SIGUSER1 [mongodpid]</strong></li>
<li>ä¿®å¤ç›®å‰å·²ç»å˜ä¸ºå›¾ç‰‡æ ¼å¼çš„æ—¥å¿—ï¼Œå¹¶æ‹‰å–15ç‚¹åˆ°16ç‚¹çš„æ—¥å¿—</li>
</ul>
<p>è¯¥caseèŠ±äº†ä¸€æ•´å¤©ï¼Œä»æ€€ç–‘è¢«æ”»å‡»åˆ°ç¡®è®¤æ˜¯æ—¥å¿—è½®è¯¢å¼•èµ·æ–‡ä»¶æ ¼å¼å˜æ›´æ˜¯ä¸€ä¸ªå…³é”®è½¬æŠ˜ç‚¹ï¼›</p>
<p>å¦å¤–PCXæ ¼å¼æ˜¯ç¬¬ä¸€æ¬¡ç¢°åˆ°ï¼Œç–‘æƒ‘äº†åŠå¤©~æœ€åæ˜¯@åŸ¹å°§å‘ç°äº†<code>echo</code>çš„ç«¯å€ªï¼Œ@è¡¾è¢­@å¤§å®å»éªŒè¯æœ€ç»ˆç¡®è®¤äº†é—®é¢˜çš„æ ¹æºã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯å¹¿è§’</category>
        <category>MongoDB</category>
      </categories>
      <tags>
        <tag>æ•°æ®æ•‘æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracleæ•°æ®åº“SQLä¼˜åŒ–_ç´¢å¼•ç¼ºå¤±</title>
    <url>/2018/05/29/oracle%E6%95%B0%E6%8D%AE%E5%BA%93SQL%E4%BC%98%E5%8C%96-%E7%B4%A2%E5%BC%95%E7%BC%BA%E5%A4%B1/</url>
    <content><![CDATA[<p>æ‘˜è¦ï¼šOracleæ•°æ®åº“åšäº†è¿ç§»ï¼Œä»åŸæ¥çš„DGè¿ç§»åˆ°æ–°åº“RACï¼Œå°ç‰ˆæœ¬ä¸åŒï¼›è€åº“ä¸­ç›¸åŒçš„SQLæ‰§è¡Œåªéœ€è¦11ç§’ï¼Œè€Œæ–°åº“éœ€è¦360ç§’ç”šè‡³800å¤šç§’ï¼Œå¦‚ä½•è¿›è¡Œå¤æ‚æŸ¥è¯¢çš„SQLä¼˜åŒ–ï¼Œæœ¬æ–‡æä¾›é€šç”¨çš„ä¸€ä¸ªæ€è·¯ã€‚</p>
<a id="more"></a>

<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>oracleæ•°æ®åº“åšäº†è¿ç§»ï¼Œä»åŸæ¥çš„DGè¿ç§»åˆ°æ–°åº“RACï¼Œå°ç‰ˆæœ¬ä¸åŒï¼›</p>
<p>è€åº“ä¸­ç›¸åŒçš„SQLæ‰§è¡Œåªéœ€è¦11ç§’ï¼Œè€Œæ–°åº“éœ€è¦360ç§’ç”šè‡³800å¤šç§’ã€‚</p>
<table>
<thead>
<tr>
<th>åº“</th>
<th>åŸæŸ¥è¯¢æ—¶é—´</th>
<th>ä¼˜åŒ–åçš„æŸ¥è¯¢æ—¶é—´</th>
</tr>
</thead>
<tbody><tr>
<td>è€åº“</td>
<td>11ç§’</td>
<td>1.4ç§’ ç¼“å­˜å 0.4ç§’</td>
</tr>
<tr>
<td>æ–°åº“RAC</td>
<td>360ç§’</td>
<td>1.4ç§’ ç¼“å­˜å0.4ç§’æ’æŸ¥æ€è·¯</td>
</tr>
</tbody></table>
<h2 id="å¾…ä¼˜åŒ–SQL"><a href="#å¾…ä¼˜åŒ–SQL" class="headerlink" title="å¾…ä¼˜åŒ–SQL"></a>å¾…ä¼˜åŒ–SQL</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	prj.PROVINCE_AD_NAME,</span><br><span class="line">	prj.CITY_AD_NAME,</span><br><span class="line">	prj.AD_NAME,</span><br><span class="line">	prj.CHANNEL_SYS_CAT,</span><br><span class="line">	prj.EXCUTE_EL,</span><br><span class="line">	prj.PRJ_CODE AS PRJ_CODE,</span><br><span class="line">	prj.PRJ_NAME AS PRJ_NAME,</span><br><span class="line">	prj.POS_CODE AS POS_CODE,</span><br><span class="line">	prj.POS_NAME AS POS_NAME,</span><br><span class="line">	prj.CUST_CHANNEL_CODE,</span><br><span class="line">	prj.CUST_CHANNEL_NAME,</span><br><span class="line">	prj.EMP_CODE AS EMP_CODE,</span><br><span class="line">	prj.NAME AS EMP_NAME,</span><br><span class="line">	prj.ATT_DATE AS APPLY_DATE,</span><br><span class="line">	prj.EMP_PK AS EMP_PK,</span><br><span class="line">	prj.ATT_START_TIME AS START_TIME,</span><br><span class="line">	prj.ATT_END_TIME AS END_TIME,</span><br><span class="line">	prj.ATT_ISWORK AS ISWORK,</span><br><span class="line">	prj.ATT_UNWORK AS ATTTYPE,</span><br><span class="line">	prj.START_XPOS AS ON_WORK_POSITION_LON,</span><br><span class="line">	prj.START_YPOS AS ON_WORK_POSITION_LAT,</span><br><span class="line">	prj.START_ISEXCEP AS ON_WORK_POSITION_STAUS,</span><br><span class="line">	prj.END_XPOS AS OFF_WORK_POSITION_LAT,</span><br><span class="line">	prj.END_YPOS AS OFF_WORK_POSITION_LON,</span><br><span class="line">	prj.END_ISEXCEP AS OFF_WORK_POSITION_STAUS,</span><br><span class="line">	ifcl1Staus.COMPARE_TYPE AS FACE_ATT_TYPE,</span><br><span class="line">	ifcl1.STATUS AS FACE_ATT_STATUS,</span><br><span class="line">	NVL( ifaceCount.faceCount, 0 ) AS FACE_ATT_COUNT,</span><br><span class="line">	NVL( levLeave.LEAVECount, 0 ) AS LEAVE_WORK_COUNT,</span><br><span class="line">	NVL( levRtn.RETURNCount, 0 ) AS RETURN_WORK_COUNT,</span><br><span class="line">	wq.STATUS AS PRJ_QUESTION_TYPE,</span><br><span class="line">	iface2.FACE_ATT_IMG AS FACE_ATT_IMG,</span><br><span class="line">	prj.SA_TYPE</span><br><span class="line">FROM</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			dpsi.ID AS ID,</span><br><span class="line">			P.ID AS PRJ_ID,</span><br><span class="line">			mad.AD_CODE,</span><br><span class="line">			mad.PROVINCE_AD_NAME,</span><br><span class="line">			mad.CITY_AD_NAME,</span><br><span class="line">			mad.AD_NAME,</span><br><span class="line">			mpk.POS_KIND_CODE,</span><br><span class="line">			mpk.POS_KIND_NAME,</span><br><span class="line">			P.CODE AS PRJ_CODE,</span><br><span class="line">			P.NAME AS PRJ_NAME,</span><br><span class="line">			P.START_DATE,</span><br><span class="line">			p.END_DATE,</span><br><span class="line">			dpsi.CUST_CHANNEL,</span><br><span class="line">			dpsi.CUST_SYS,</span><br><span class="line">			dpsi.CUST_CHANNEL_CODE,</span><br><span class="line">			dpsi.CUST_CHANNEL_NAME,</span><br><span class="line">			dcs.CHANNEL_SYS_CAT,</span><br><span class="line">			dcs.CHANNEL_CAT_CODE,</span><br><span class="line">			dcs.CHANNEL_AD_CODE,</span><br><span class="line">			dcs.CHANNEL_PROVINCE_AD_CODE,</span><br><span class="line">			dcs.CHANNEL_CITY_AD_CODE,</span><br><span class="line">			dcs.ID AS POS_ID,</span><br><span class="line">			dcs.CHANNEL_CODE AS POS_CODE,</span><br><span class="line">			dcs.CHANNEL_NAME AS POS_NAME,</span><br><span class="line">			dcs.LONGITUDE AS LONGITUDE,</span><br><span class="line">			dcs.LATITUDE AS LATITUDE,</span><br><span class="line">			dss.id AS SALES_ID,</span><br><span class="line">			TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' ) AS sc_schedule_date,</span><br><span class="line">			wor.SW_BEGIN_TIME AS SALES_WORK_START,</span><br><span class="line">			wor.SW_END_TIME AS SALES_WORK_END,</span><br><span class="line">			dss.SALES_EAT_START,</span><br><span class="line">			dss.SALES_EAT_END,</span><br><span class="line">			memp.EMP_PK,</span><br><span class="line">			memp.EMP_CODE,</span><br><span class="line">			dss.SALES_NAME AS NAME,</span><br><span class="line">			dss.SALES_PHONE AS TEL,</span><br><span class="line">			dss.SALES_CARD_ID AS ID_CARD,</span><br><span class="line">			spp.PRJ_ATT_CHECK_TYPE,</span><br><span class="line">			spp.ALLOW_LEAVE_TIME,</span><br><span class="line">			e1.EMP_CODE AS EXCUTE_CODE,</span><br><span class="line">			e1.emp_name AS EXCUTE_EL,</span><br><span class="line">			e2.EMP_CODE AS CITY_CODE,</span><br><span class="line">			e2.emp_name AS CITY_EL,</span><br><span class="line">			e3.EMP_CODE AS AREA_CODE,</span><br><span class="line">			e3.EMP_NAME AS AREA_NAME,</span><br><span class="line">			dpsi.SCHEDULE_TYPE,</span><br><span class="line">			sac.ATT_START_TIME,</span><br><span class="line">			sac.ATT_END_TIME,</span><br><span class="line">			sac.ATT_ISWORK,</span><br><span class="line">			sac.ATT_UNWORK,</span><br><span class="line">			sac.START_XPOS,</span><br><span class="line">			sac.START_YPOS,</span><br><span class="line">			DECODE( sac.START_ISEXCEP, 0, 2201, 1, 2202, 2, 2203, 3, 2204, 4, 2205, 2206 ) AS START_ISEXCEP,</span><br><span class="line">			sac.END_XPOS,</span><br><span class="line">			sac.END_YPOS,</span><br><span class="line">			sac.END_ISEXCEP,</span><br><span class="line">			sac.ATT_SCH_PK,</span><br><span class="line">			sac.ATT_DATE,</span><br><span class="line">			CASE</span><br><span class="line">				WHEN sac.ATT_START_TIME IS NOT NULL</span><br><span class="line">				AND sac.ATT_END_TIME IS NOT NULL THEN '1'</span><br><span class="line">				WHEN sac.ATT_START_TIME IS NOT NULL</span><br><span class="line">				OR sac.ATT_END_TIME IS NOT NULL THEN '2'</span><br><span class="line">				ELSE '2'</span><br><span class="line">			END AS SA_TYPE</span><br><span class="line">		FROM</span><br><span class="line">			DM_PROJECT_SELLIN_INFO dpsi</span><br><span class="line">		LEFT JOIN MD_EMP e1 ON</span><br><span class="line">			dpsi.EMP_CODE = e1.EMP_CODE</span><br><span class="line">		LEFT JOIN MD_EMP e2 ON</span><br><span class="line">			dpsi.CITY_EMP_CODE = e2.EMP_CODE</span><br><span class="line">		LEFT JOIN MD_EMP e3 ON</span><br><span class="line">			dpsi.AREA_MANAGER_CODE = e3.EMP_CODE,</span><br><span class="line">			DM_PROJECT P,</span><br><span class="line">			DM_PROJECT_SELLIN_SALES dss,</span><br><span class="line">			DM_CHANNEL_SYNC dcs,</span><br><span class="line">			MD_EMP memp,</span><br><span class="line">			SP_PRJ_PARM spp,</span><br><span class="line">			Md_Admin_Div mad,</span><br><span class="line">			MD_POS_KIND mpk,</span><br><span class="line">			dm_sales_schedule_calendar cal,</span><br><span class="line">			dm_sales_schedule_work wor,</span><br><span class="line">			SP_ATT_SCH sac</span><br><span class="line">		WHERE</span><br><span class="line">			dpsi.PROJECT_ID = P.ID</span><br><span class="line">			AND dss.id = cal.sales_id</span><br><span class="line">			AND cal.schedule_work_id = wor.id</span><br><span class="line">			AND dcs.CHANNEL_CAT_CODE = mpk.POS_KIND_CODE</span><br><span class="line">			AND dss.PROJECT_SELLIN_INFO_ID = dpsi.ID</span><br><span class="line">			AND dss.DELETE_FLAG = '0'</span><br><span class="line">			AND dpsi.CHANNEL_SYNC_ID = dcs.ID</span><br><span class="line">			AND LOWER( memp.EMP_S_CODE )= LOWER( dss.SALES_CARD_ID )</span><br><span class="line">			AND P.IS_DELETE IS NULL</span><br><span class="line">			AND memp.IS_DEL = '0'</span><br><span class="line">			AND spp.PRJ_CODE = P.CODE</span><br><span class="line">			AND mad.AD_ID = dcs.CHANNEL_ADMIN_DIV_ID</span><br><span class="line">			AND mad.IS_DEL = '0'</span><br><span class="line">			AND memp.EMP_TYPE = '1001'</span><br><span class="line">			AND TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' )&gt;='2018-04-01'</span><br><span class="line">			AND TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' )&lt;='2018-04-30'</span><br><span class="line">			AND sac.PRJ_CODE = p.CODE</span><br><span class="line">			AND sac.POS_CODE = dcs.CHANNEL_CODE</span><br><span class="line">			AND sac.EMP_PK = memp.EMP_PK</span><br><span class="line">			AND sac.ATT_DATE = TO_CHAR( cal.sc_schedule_date, 'yyyy-mm-dd' )</span><br><span class="line">			AND TO_CHAR( sac.CRT_DATE, 'yyyy-mm-dd' )&gt;='2018-04-01'</span><br><span class="line">			AND TO_CHAR( sac.CRT_DATE, 'yyyy-mm-dd' )&lt;='2018-04-30'</span><br><span class="line">	) prj,</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			ifcl.EMP_PK,</span><br><span class="line">			ifcl.COMPARE_DATE,</span><br><span class="line">			ifcl.STATUS</span><br><span class="line">		FROM</span><br><span class="line">			IPG_FACE_COMPARE_LOG ifcl</span><br><span class="line">		WHERE</span><br><span class="line">			ifcl.HANDLE_TYPE = 0</span><br><span class="line">			AND ifcl.DELETE_FLAG = '0'</span><br><span class="line">			AND ifcl.COMPARE_TYPE IN(</span><br><span class="line">				'1',</span><br><span class="line">				'3',</span><br><span class="line">				'5'</span><br><span class="line">			)</span><br><span class="line">			AND ifcl.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">			AND ifcl.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">		GROUP BY</span><br><span class="line">			ifcl.EMP_PK,</span><br><span class="line">			ifcl.COMPARE_DATE,</span><br><span class="line">			ifcl.STATUS</span><br><span class="line">		HAVING</span><br><span class="line">			AVG( STATUS )&lt; 1</span><br><span class="line">	) ifcl1,</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			*</span><br><span class="line">		FROM</span><br><span class="line">			(</span><br><span class="line">				SELECT</span><br><span class="line">					EMP_PK,</span><br><span class="line">					COMPARE_DATE,</span><br><span class="line">					COMPARE_TYPE,</span><br><span class="line">					ROW_NUMBER() OVER(</span><br><span class="line">						PARTITION BY EMP_PK,</span><br><span class="line">						COMPARE_DATE</span><br><span class="line">					ORDER BY</span><br><span class="line">						CREATED DESC</span><br><span class="line">					) rn</span><br><span class="line">				FROM</span><br><span class="line">					IPG_FACE_COMPARE_LOG</span><br><span class="line">				WHERE</span><br><span class="line">					COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">					AND COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">					AND COMPARE_TYPE IN(</span><br><span class="line">						'1',</span><br><span class="line">						'3',</span><br><span class="line">						'5'</span><br><span class="line">					)</span><br><span class="line">			) t</span><br><span class="line">		WHERE</span><br><span class="line">			t.rn &lt;= 1</span><br><span class="line">	) ifcl1Staus,</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			SP_LEV_RPT.ATT_SCH_PK,</span><br><span class="line">			COUNT(*) AS LEAVECount</span><br><span class="line">		FROM</span><br><span class="line">			SP_LEV_RPT</span><br><span class="line">		WHERE</span><br><span class="line">			SP_LEV_RPT.START_TIME IS NOT NULL</span><br><span class="line">		GROUP BY</span><br><span class="line">			SP_LEV_RPT.ATT_SCH_PK</span><br><span class="line">	) levLeave,</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			SP_LEV_RPT.ATT_SCH_PK,</span><br><span class="line">			COUNT(*) AS RETURNCount</span><br><span class="line">		FROM</span><br><span class="line">			SP_LEV_RPT</span><br><span class="line">		WHERE</span><br><span class="line">			SP_LEV_RPT.END_TIME IS NOT NULL</span><br><span class="line">		GROUP BY</span><br><span class="line">			SP_LEV_RPT.ATT_SCH_PK</span><br><span class="line">	) levRtn,</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			WX_QUESTION.PRJ_ID,</span><br><span class="line">			DM_PROJECT.CODE,</span><br><span class="line">			'Y' AS STATUS</span><br><span class="line">		FROM</span><br><span class="line">			WX_QUESTION,</span><br><span class="line">			DM_PROJECT</span><br><span class="line">		WHERE</span><br><span class="line">			DM_PROJECT.ID = WX_QUESTION.PRJ_ID</span><br><span class="line">			AND WX_QUESTION.IS_DEL = '0'</span><br><span class="line">			AND WX_QUESTION.STATUS = '0'</span><br><span class="line">		GROUP BY</span><br><span class="line">			WX_QUESTION.PRJ_ID,</span><br><span class="line">			DM_PROJECT.CODE</span><br><span class="line">	) wq,</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			ifcl.EMP_PK,</span><br><span class="line">			ifcl.COMPARE_DATE,</span><br><span class="line">			COUNT(*) AS faceCount</span><br><span class="line">		FROM</span><br><span class="line">			IPG_FACE_COMPARE_LOG ifcl</span><br><span class="line">		WHERE</span><br><span class="line">			ifcl.HANDLE_TYPE = 0</span><br><span class="line">			AND ifcl.COMPARE_TYPE IN(</span><br><span class="line">				'1',</span><br><span class="line">				'3',</span><br><span class="line">				'5'</span><br><span class="line">			)</span><br><span class="line">			AND ifcl.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">			AND ifcl.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">		GROUP BY</span><br><span class="line">			ifcl.EMP_PK,</span><br><span class="line">			ifcl.COMPARE_DATE</span><br><span class="line">	) ifaceCount,</span><br><span class="line">	(</span><br><span class="line">		SELECT</span><br><span class="line">			iface.EMP_PK,</span><br><span class="line">			iface.COMPARE_DATE,</span><br><span class="line">			wm_concat(</span><br><span class="line">				(</span><br><span class="line">					SELECT</span><br><span class="line">						NVL( TRIM( T.PAR_VALUE ), TRIM( T.OLD_PAR_VALUE ))</span><br><span class="line">					FROM</span><br><span class="line">						(</span><br><span class="line">							SELECT</span><br><span class="line">								(</span><br><span class="line">									SELECT</span><br><span class="line">										PAR_VALUE</span><br><span class="line">									FROM</span><br><span class="line">										MD_SYS_PARM</span><br><span class="line">									WHERE</span><br><span class="line">										PAR_CODE = 'OLD_PIC_PATH'</span><br><span class="line">								) AS OLD_PAR_VALUE,</span><br><span class="line">								PAR_VALUE</span><br><span class="line">							FROM</span><br><span class="line">								MD_SYS_PARM</span><br><span class="line">							WHERE</span><br><span class="line">								PAR_CODE = 'ATT_COS_PATH'</span><br><span class="line">						) T</span><br><span class="line">				)|| REPLACE( SUBSTR( iface.COMPARE_MSG, INSTR( iface.COMPARE_MSG, 'compare', 1, 1 )), ']', '' )</span><br><span class="line">			) AS FACE_ATT_IMG</span><br><span class="line">		FROM</span><br><span class="line">			(</span><br><span class="line">				SELECT</span><br><span class="line">					ifa.EMP_PK,</span><br><span class="line">					ifa.COMPARE_DATE,</span><br><span class="line">					ifa.COMPARE_MSG,</span><br><span class="line">					RANK() OVER(</span><br><span class="line">						PARTITION BY ifa.EMP_PK,</span><br><span class="line">						ifa.COMPARE_DATE</span><br><span class="line">					ORDER BY</span><br><span class="line">						ifa.created DESC</span><br><span class="line">					) rankno</span><br><span class="line">				FROM</span><br><span class="line">					IPG_FACE_COMPARE_LOG ifa</span><br><span class="line">				WHERE</span><br><span class="line">					ifa.HANDLE_TYPE = 0</span><br><span class="line">					AND ifa.COMPARE_TYPE IN(</span><br><span class="line">						'1',</span><br><span class="line">						'3',</span><br><span class="line">						'5'</span><br><span class="line">					)</span><br><span class="line">					AND INSTR( ifa.COMPARE_MSG, 'compare' )&gt; 0</span><br><span class="line">					AND ifa.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">					AND ifa.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">			) iface</span><br><span class="line">		WHERE</span><br><span class="line">			iface.rankno &lt;= 3</span><br><span class="line">		GROUP BY</span><br><span class="line">			iface.EMP_PK,</span><br><span class="line">			iface.COMPARE_DATE</span><br><span class="line">	) iface2</span><br><span class="line">WHERE</span><br><span class="line">	prj.PRJ_NAME ='(2013)è¡Œæ”¿é¡¹ç›®'</span><br><span class="line">	AND prj.ATT_DATE &gt;='2018-04-01'</span><br><span class="line">	AND prj.ATT_DATE &lt;='2018-04-30'</span><br><span class="line">	AND prj.EMP_PK = ifcl1.EMP_PK(+)</span><br><span class="line">	AND TO_CHAR( TO_DATE( prj.ATT_DATE, 'yyyy-mm-dd' ), 'yyyymmdd' )= ifcl1.COMPARE_DATE(+)</span><br><span class="line">	AND prj.EMP_PK = ifcl1Staus.EMP_PK(+)</span><br><span class="line">	AND TO_CHAR( TO_DATE( prj.ATT_DATE, 'yyyy-mm-dd' ), 'yyyymmdd' )= ifcl1Staus.COMPARE_DATE(+)</span><br><span class="line">	AND prj.ATT_SCH_PK = levLeave.ATT_SCH_PK(+)</span><br><span class="line">	AND prj.ATT_SCH_PK = levRtn.ATT_SCH_PK(+)</span><br><span class="line">	AND prj.PRJ_CODE = wq.CODE(+)</span><br><span class="line">	AND prj.EMP_PK = ifaceCount.EMP_PK(+)</span><br><span class="line">	AND TO_CHAR( TO_DATE( prj.ATT_DATE, 'yyyy-mm-dd' ), 'yyyymmdd' )= ifaceCount.COMPARE_DATE(+)</span><br><span class="line">	AND prj.EMP_PK = iface2.EMP_PK(+)</span><br><span class="line">	AND TO_CHAR( TO_DATE( prj.sc_schedule_date, 'yyyy-mm-dd' ), 'yyyymmdd' )= iface2.COMPARE_DATE(+)</span><br><span class="line">ORDER BY</span><br><span class="line">	APPLY_DATE DESC,</span><br><span class="line">	ATTTYPE DESC</span><br></pre></td></tr></table></figure>

<h2 id="SQLä¼˜åŒ–æ€è·¯"><a href="#SQLä¼˜åŒ–æ€è·¯" class="headerlink" title="SQLä¼˜åŒ–æ€è·¯"></a>SQLä¼˜åŒ–æ€è·¯</h2><p>SQLè¯­å¥è¾ƒå¤æ‚ï¼Œ8ä¸ªå­æŸ¥è¯¢çš„left outer joinï¼Œæ¯ä¸ªå­æŸ¥è¯¢ä¸­åˆæœ‰è¿æ¥ã€‚æ€è·¯å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä»å¤–å¾€å†…æ‹†åˆ†å­æŸ¥è¯¢</li>
<li>è€æ—§å¯¹æ¯”å­æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’å’Œæ‰§è¡Œæ•ˆç‡</li>
<li>å­æŸ¥è¯¢è¿æ¥ä»1åˆ°2åˆ°3ä¸€ç›´åˆ°8ä¸ªè”æŸ¥å¯¹æ¯”ï¼Œå¯»æ‰¾ç“¶é¢ˆ</li>
</ol>
<h3 id="æ‹†åˆ†å­æŸ¥è¯¢"><a href="#æ‹†åˆ†å­æŸ¥è¯¢" class="headerlink" title="æ‹†åˆ†å­æŸ¥è¯¢"></a>æ‹†åˆ†å­æŸ¥è¯¢</h3><table>
<thead>
<tr>
<th>å­æŸ¥è¯¢</th>
<th>è€åº“ ï¼ˆç§’ï¼‰</th>
<th>æ–°åº“ï¼ˆç§’ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>prj</td>
<td>1.182</td>
<td>0.318</td>
</tr>
<tr>
<td>ifcl1</td>
<td>14.229</td>
<td>13.168</td>
</tr>
<tr>
<td>ifclStatus</td>
<td>15.739</td>
<td>16.769</td>
</tr>
<tr>
<td>levLeave</td>
<td>10.147</td>
<td>9.813</td>
</tr>
<tr>
<td>levRtn</td>
<td>9.148</td>
<td>8.3</td>
</tr>
<tr>
<td>wq</td>
<td>0.141</td>
<td>0.165</td>
</tr>
<tr>
<td>ifcl1Count</td>
<td>3.498</td>
<td>1.966</td>
</tr>
<tr>
<td>iface2</td>
<td>49.255</td>
<td>50.897</td>
</tr>
</tbody></table>
<h3 id="å¯»æ‰¾ç“¶é¢ˆ"><a href="#å¯»æ‰¾ç“¶é¢ˆ" class="headerlink" title="å¯»æ‰¾ç“¶é¢ˆ"></a>å¯»æ‰¾ç“¶é¢ˆ</h3><table>
<thead>
<tr>
<th>è¿æ¥</th>
<th>è€åº“ï¼ˆç§’ï¼‰</th>
<th>æ–°åº“ï¼ˆç§’ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>prj+ifcl1</td>
<td>1.522</td>
<td>1.129</td>
</tr>
<tr>
<td>+ifclStatus</td>
<td>2.343</td>
<td>1.957</td>
</tr>
<tr>
<td>+levLeave</td>
<td>2.525</td>
<td>1.955</td>
</tr>
<tr>
<td>+levRtn</td>
<td>2.658</td>
<td>1.653</td>
</tr>
<tr>
<td>+wq</td>
<td>2.561</td>
<td>1.999</td>
</tr>
<tr>
<td>+ifcl1Count</td>
<td>3.498</td>
<td>1.966</td>
</tr>
<tr>
<td>+iface2</td>
<td>11.124</td>
<td>383</td>
</tr>
</tbody></table>
<p>å‘ç°ç“¶é¢ˆå‡ºç°åœ¨<code>iface2</code></p>
<h2 id="ä¼˜åŒ–iface2"><a href="#ä¼˜åŒ–iface2" class="headerlink" title="ä¼˜åŒ–iface2"></a>ä¼˜åŒ–iface2</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SELECT</span><br><span class="line">			iface.EMP_PK,</span><br><span class="line">			iface.COMPARE_DATE,</span><br><span class="line">			wm_concat(</span><br><span class="line">				(</span><br><span class="line">					SELECT</span><br><span class="line">						NVL( TRIM( T.PAR_VALUE ), TRIM( T.OLD_PAR_VALUE ))</span><br><span class="line">					FROM</span><br><span class="line">						(</span><br><span class="line">							SELECT</span><br><span class="line">								(</span><br><span class="line">									SELECT</span><br><span class="line">										PAR_VALUE</span><br><span class="line">									FROM</span><br><span class="line">										MD_SYS_PARM</span><br><span class="line">									WHERE</span><br><span class="line">										PAR_CODE = 'OLD_PIC_PATH'</span><br><span class="line">								) AS OLD_PAR_VALUE,</span><br><span class="line">								PAR_VALUE</span><br><span class="line">							FROM</span><br><span class="line">								MD_SYS_PARM</span><br><span class="line">							WHERE</span><br><span class="line">								PAR_CODE = 'ATT_COS_PATH'</span><br><span class="line">						) T</span><br><span class="line">				)|| REPLACE( SUBSTR( iface.COMPARE_MSG, INSTR( iface.COMPARE_MSG, 'compare', 1, 1 )), ']', '' )</span><br><span class="line">			) AS FACE_ATT_IMG</span><br><span class="line">		FROM</span><br><span class="line">			(</span><br><span class="line">				SELECT</span><br><span class="line">					ifa.EMP_PK,</span><br><span class="line">					ifa.COMPARE_DATE,</span><br><span class="line">					ifa.COMPARE_MSG,</span><br><span class="line">					RANK() OVER(</span><br><span class="line">						PARTITION BY ifa.EMP_PK,</span><br><span class="line">						ifa.COMPARE_DATE</span><br><span class="line">					ORDER BY</span><br><span class="line">						ifa.created DESC</span><br><span class="line">					) rankno</span><br><span class="line">				FROM</span><br><span class="line">					IPG_FACE_COMPARE_LOG ifa</span><br><span class="line">				WHERE</span><br><span class="line">					ifa.HANDLE_TYPE = 0</span><br><span class="line">					AND ifa.COMPARE_TYPE IN(</span><br><span class="line">						'1',</span><br><span class="line">						'3',</span><br><span class="line">						'5'</span><br><span class="line">					)</span><br><span class="line">					AND INSTR( ifa.COMPARE_MSG, 'compare' )&gt; 0</span><br><span class="line">					AND ifa.COMPARE_DATE &gt;= TO_CHAR( TO_DATE('2018-04-01', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">					AND ifa.COMPARE_DATE &lt;= TO_CHAR( TO_DATE('2018-04-30', 'yyyy-mm-dd' ), 'yyyymmdd' )</span><br><span class="line">			) iface</span><br><span class="line">		WHERE</span><br><span class="line">			iface.rankno &lt;= 3</span><br><span class="line">		GROUP BY</span><br><span class="line">			iface.EMP_PK,</span><br><span class="line">			iface.COMPARE_DATE</span><br></pre></td></tr></table></figure>

<p><code>IPG_FACE_COMPARE_LOG</code>è¡¨ä¸­<code>COMPARE_DATEåˆ—</code>éœ€è¦æ–°å¢ç´¢å¼•ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li>oracleå°ç‰ˆæœ¬ä¸åŒå¼•èµ·ä¼˜åŒ–å™¨æ— æ³•è·å–ç›¸åŒçš„æ‰§è¡Œè®¡åˆ’</li>
<li>ç´¢å¼•ç¼ºå¤±æ˜¯æœ¬æ¬¡çš„æ…¢æŸ¥è¯¢çš„ä¸»è¦åŸå› </li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯å¹¿è§’</category>
        <category>Oracle</category>
      </categories>
      <tags>
        <tag>SQLä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¸€æ¬¡æƒŠå¿ƒåŠ¨é­„åœ°æ•°æ®å¼ºåˆ¶æ¢å¤</title>
    <url>/2018/05/17/MySQL%E4%B8%80%E6%AC%A1%E6%83%8A%E5%BF%83%E5%8A%A8%E9%AD%84%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%BC%BA%E5%88%B6%E6%81%A2%E5%A4%8D/</url>
    <content><![CDATA[<p>æ‘˜è¦ï¼šCashæ¢å¤çš„æ­£ç¡®æ–¹å¼æ˜¯ï¼š<strong>å¤‡ä»½æ–‡ä»¶ï¼ˆé€»è¾‘æˆ–ç‰©ç†ï¼‰+ binlog</strong>è¿›è¡Œæ¢å¤ï¼›ç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¿ç»´äººå‘˜éƒ½çŸ¥é“æ€ä¹ˆè¿›è¡Œæ­£ç¡®çš„å¤‡ä»½ï¼Œç”šè‡³è¿é€»è¾‘å¤‡ä»½å’Œç‰©ç†å¤‡ä»½çš„åŒºåˆ«æ˜¯ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Ÿæ›´ä¸çŸ¥é“å¤‡ä»½è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘æ•°æ®çš„ä¸€è‡´æ€§ä¸æœåŠ¡å¯ç”¨æ€§çš„é—®é¢˜ï¼Ÿæˆ–è€…è¿å¤‡ä»½å·¥å…·éƒ½ä¸ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥å½“ä½ é—®ï¼šæœ‰å¤‡ä»½å—ï¼Ÿå›ç­”ï¼šæ²¡æœ‰æˆ–è€…æ— æ•ˆ</p>
<p>åœ¨æœ¬æ¬¡æ¡ˆä¾‹ä¸­ï¼ŒæŸå®¢æˆ·æ•°æ®åº“å› å­˜å‚¨ç©ºé—´ä¸å¤Ÿå¯¼è‡´æ•°æ®åº“æœåŠ¡å®•æ‰ï¼Œè€Œå®¢æˆ·åœ¨æ•°æ®åº“å®•æœºåï¼Œåªæ‹·è´äº†å•ä¸ª<code>cy</code>åº“æ‰€å±çš„ç›®å½•è¿›è¡Œäº†æ–‡ä»¶å±‚é¢çš„å¤‡ä»½ï¼Œå°±å°†å…¶ä»–æ–‡ä»¶å…¨éƒ¨æ¸…ç©ºï¼Œå½“ä»–æƒ³é‡æ–°å¯åŠ¨æ•°æ®åº“æ—¶å‘ç°æ•°æ®åº“æœåŠ¡å¯åŠ¨ã€‚MySQLä½¿ç”¨5.7.17ç‰ˆæœ¬ï¼Œä½¿ç”¨innodbå­˜å‚¨å¼•æ“ï¼Œå¼€å¯äº†ç‹¬ç«‹è¡¨ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´å½“å‰çš„æ•‘å‘½ç¨»è‰æ˜¯ï¼šæ¯ä¸ªè¡¨çš„<code>.frm</code>å’Œ<code>.ibd</code>æ–‡ä»¶ã€‚</p>
<a id="more"></a>

<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>Cashæ¢å¤çš„æ­£ç¡®æ–¹å¼æ˜¯ï¼š<strong>å¤‡ä»½æ–‡ä»¶ï¼ˆé€»è¾‘æˆ–ç‰©ç†ï¼‰+ binlog</strong>è¿›è¡Œæ¢å¤ï¼›ç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¿ç»´äººå‘˜éƒ½çŸ¥é“æ€ä¹ˆè¿›è¡Œæ­£ç¡®çš„å¤‡ä»½ï¼Œç”šè‡³è¿é€»è¾‘å¤‡ä»½å’Œç‰©ç†å¤‡ä»½çš„åŒºåˆ«æ˜¯ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Ÿæ›´ä¸çŸ¥é“å¤‡ä»½è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘æ•°æ®çš„ä¸€è‡´æ€§ä¸æœåŠ¡å¯ç”¨æ€§çš„é—®é¢˜ï¼Ÿæˆ–è€…è¿å¤‡ä»½å·¥å…·éƒ½ä¸ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥å½“ä½ é—®ï¼šæœ‰å¤‡ä»½å—ï¼Ÿå›ç­”ï¼šæ²¡æœ‰æˆ–è€…æ— æ•ˆ</p>
<p>åœ¨æœ¬æ¬¡æ¡ˆä¾‹ä¸­ï¼ŒæŸå®¢æˆ·åªå¯¹å•ä¸ª<code>cy</code>åº“æ‰€å±çš„ç›®å½•è¿›è¡Œäº†æ–‡ä»¶å±‚é¢çš„å¤‡ä»½ï¼ŒMySQLä½¿ç”¨5.7.17ç‰ˆæœ¬ï¼Œä½¿ç”¨innodbå­˜å‚¨å¼•æ“ï¼Œå¼€å¯äº†ç‹¬ç«‹è¡¨ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´å½“å‰çš„æ•‘å‘½ç¨»è‰æ˜¯ï¼šæ¯ä¸ªè¡¨çš„<code>.frm</code>å’Œ<code>.ibd</code>æ–‡ä»¶ã€‚</p>
<h2 id="å¼ºåˆ¶è¿˜åŸæ­¥éª¤"><a href="#å¼ºåˆ¶è¿˜åŸæ­¥éª¤" class="headerlink" title="å¼ºåˆ¶è¿˜åŸæ­¥éª¤"></a>å¼ºåˆ¶è¿˜åŸæ­¥éª¤</h2><table>
<thead>
<tr>
<th>æ­¥éª¤</th>
<th>æè¿°</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>åˆ›å»ºåŒç‰ˆæœ¬çš„MySQLæœåŠ¡å®ä¾‹ä¸€æš</strong></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td><strong>è·å–è¡¨çš„åˆ—æ•°</strong></td>
<td>å¦‚æœæœ‰ddlå¤‡ä»½ç›´æ¥å¯¼å…¥ï¼Œå¯æƒœéƒ½æ˜¯æ²¡æœ‰çš„ï¼Œå“­ã€‚ã€‚ã€‚</td>
</tr>
<tr>
<td>2.1</td>
<td>åˆ›å»ºåŒåè¡¨ï¼Œç»“æ„æ— æ‰€è°“</td>
<td>æ•°æ®åº“çš„ä¸–ç•Œä¹Ÿéœ€è¦èº«ä»½è¯ï¼Œå…ˆé€ ä¸ªäººæ‹¿ä¸Šèº«ä»½è¯ï¼Œè‡³äºäººé•¿å¾—å•¥æ ·å‡ æ¡èƒ³è†Šéƒ½æ— æ‰€è°“ï¼Œåå­—æœ€é‡è¦</td>
</tr>
<tr>
<td>2.2</td>
<td>åœæœåŠ¡ï¼›ä½¿ç”¨å¤‡ä»½çš„frmæ–‡ä»¶è¦†ç›–å½“å‰çš„frm</td>
<td>å·æ¢æ¢æŸ±</td>
</tr>
<tr>
<td>2.3</td>
<td>é…ç½®æ–‡ä»¶æ·»åŠ å¼ºåˆ¶æ¢å¤innodbçš„å‚æ•°ï¼›å¯åŠ¨æœåŠ¡</td>
<td>è’™è”½å¥¹çš„åŒçœ¼</td>
</tr>
<tr>
<td>2.4</td>
<td>æŸ¥çœ‹è¡¨ç»“æ„</td>
<td>æ•°æ®åº“ä¼šæ‹¿ç€èº«ä»½è¯å’Œé¢å‰çš„äººï¼ˆfrmæ–‡ä»¶ï¼‰åšå¯¹æ¯”</td>
</tr>
<tr>
<td>2.5</td>
<td>æŸ¥çœ‹é”™è¯¯æ—¥å¿—ä¸­å…³äºè¯¥è¡¨çš„æŠ¥é”™</td>
<td>æ•°æ®åº“å‘ç°èº«ä»½è¯ä¸Šçš„äººåªæœ‰1æ¡èƒ³è†Šï¼Œè€Œè¢«æ£€æŸ¥çš„äººæœ‰10æ¡èƒ³è†Šï¼Œæ˜æ˜¾å¯¹ä¸ä¸Šå•Š</td>
</tr>
<tr>
<td>2.6</td>
<td>æˆåŠŸè·å–è¡¨çš„çœŸå®åˆ—æ•°ï¼›åˆ é™¤è¿™äº›è¡¨</td>
<td>é€šè¿‡è­¦å‘Šå¯ä»¥çŸ¥é“åº”è¯¥é€ ä¸€ä¸ªæœ‰10æ¡èƒ³è†Šçš„äºº</td>
</tr>
<tr>
<td>3</td>
<td><strong>è·å–è¡¨çš„ç»“æ„</strong></td>
<td></td>
</tr>
<tr>
<td>3.1</td>
<td>åˆ›å»ºåŒåè¡¨ï¼Œåˆ—æ•°ä¸€è‡´ï¼Œåˆ—åæ— æ‰€è°“</td>
<td>è¿™ä¸€æ¬¡é€ äººçš„æ—¶å€™ï¼Œé€ ä¸€ä¸ªæœ‰10æ¡èƒ³è†Šçš„ï¼Œæ¯æ¡èƒ³è†Šçš„åå­—æ— æ‰€è°“ï¼Œå…³é”®æ˜¯èº«ä»½è¯ä¸Šé¢çš„äººåå’Œ10æ¡èƒ³è†Š</td>
</tr>
<tr>
<td>3.2</td>
<td>åœæœåŠ¡ï¼›ä½¿ç”¨å¤‡ä»½çš„frmæ–‡ä»¶è¦†ç›–å½“å‰çš„frm</td>
<td>å·æ¢æ¢æŸ±</td>
</tr>
<tr>
<td>3.3</td>
<td>é…ç½®æ–‡ä»¶æ·»åŠ å¼ºåˆ¶æ¢å¤innodbçš„å‚æ•°ï¼›å¯åŠ¨æœåŠ¡</td>
<td>è’™è”½å¥¹çš„åŒçœ¼</td>
</tr>
<tr>
<td>3.4</td>
<td>æŸ¥çœ‹è¡¨ç»“æ„</td>
<td>æ•°æ®åº“ä¼šæ‹¿ç€æ–°çš„èº«ä»½è¯å’Œé¢å‰çš„äººï¼ˆfrmæ–‡ä»¶ï¼‰åšå¯¹æ¯”</td>
</tr>
<tr>
<td>3.5</td>
<td>æˆåŠŸè·å–è¡¨ç»“æ„</td>
<td>æ•°æ®åº“å‘ç°èº«ä»½è¯ä¸Šä¿¡æ¯å’Œè¢«æ£€æŸ¥çš„äººä¿¡æ¯ä¸€è‡´ï¼Œåå­—ï¼Œèƒ³è†Šçš„æ•°é‡ï¼Œå¯¹ä¸Šäº†å°±è®¤å¯å•¦ï¼ï¼ˆæ•°æ®åº“åªæ£€æŸ¥è¡¨åå’Œåˆ—çš„ä¸ªæ•°ï¼‰</td>
</tr>
<tr>
<td>4</td>
<td><strong>å¼ºåˆ¶æ¢å¤è¡¨æ•°æ®</strong></td>
<td></td>
</tr>
<tr>
<td>4.1</td>
<td>ä¸¢å¼ƒå½“å‰è¡¨çš„æ•°æ®</td>
<td>æŠŠè¿™ä¸ªäººçš„äº”è„å…­è…‘éƒ½æŒ–å‡ºæ¥</td>
</tr>
<tr>
<td>4.2</td>
<td>å°†å¤‡ä»½çš„ibdæ”¾åˆ°å¯¹åº”è·¯å¾„</td>
<td>å°†ä¹‹å‰å¤‡ä»½çš„åƒäº†è‚‰çš„äº”è„å…­è…‘æ”¾è¿›å»</td>
</tr>
<tr>
<td>4.3</td>
<td>å¯¼å…¥æ–°çš„æ•°æ®ï¼Œå¦‚æœæ•°æ®åº“åŠ è½½æˆåŠŸåˆ™å¯ä»¥çœ‹åˆ°æ•°æ®ï¼›å¦åˆ™åŠ è½½å¤±è´¥ã€‚</td>
<td>è·Ÿå¤§è„‘æ±‡æŠ¥ä¸€ä¸‹æ–°çš„äº”è„å…­è…‘å·²ç»å°±ä½å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼›å¦‚æœä½¿ç”¨å¾—æ²¡é—®é¢˜å°±æˆåŠŸï¼›å¦‚æœå™¨å®˜å·²ç»æŸåé‚£ä¹ˆæ‰‹æœ¯å¤±è´¥ã€‚</td>
</tr>
</tbody></table>
<h2 id="è¯¦ç»†è¿‡ç¨‹"><a href="#è¯¦ç»†è¿‡ç¨‹" class="headerlink" title="è¯¦ç»†è¿‡ç¨‹"></a>è¯¦ç»†è¿‡ç¨‹</h2><h3 id="æ•°æ®é‡"><a href="#æ•°æ®é‡" class="headerlink" title="æ•°æ®é‡"></a>æ•°æ®é‡</h3><table>
<thead>
<tr>
<th>æ˜ç»†</th>
<th>å¤§å°</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td>ç‰©ç†æ–‡ä»¶</td>
<td>174M</td>
<td></td>
</tr>
<tr>
<td>æ•°æ®åº“</td>
<td>1ä¸ª</td>
<td>cy</td>
</tr>
<tr>
<td>è¡¨</td>
<td>57å¼ </td>
<td></td>
</tr>
</tbody></table>
<h3 id="æ¢å¤ç»“æœ"><a href="#æ¢å¤ç»“æœ" class="headerlink" title="æ¢å¤ç»“æœ"></a>æ¢å¤ç»“æœ</h3><blockquote>
<p>åœ¨å®¢æˆ·æœåŠ¡å™¨ä¸Šé¢ç»“æœå¦‚ä¸‹ï¼š</p>
</blockquote>
<table>
<thead>
<tr>
<th>æ˜ç»†</th>
<th>æˆåŠŸ</th>
<th>å¤±è´¥</th>
<th>æ¢å¤ç‡</th>
</tr>
</thead>
<tbody><tr>
<td>è¡¨ç»“æ„</td>
<td>58</td>
<td>0</td>
<td>100%</td>
</tr>
<tr>
<td>è¡¨æ•°æ®</td>
<td>56</td>
<td>2</td>
<td>96%</td>
</tr>
</tbody></table>
<blockquote>
<p>åœ¨æˆ‘çš„æœåŠ¡å™¨ä¸Šé¢ç»“æœå¦‚ä¸‹ï¼š</p>
</blockquote>
<table>
<thead>
<tr>
<th>æ˜ç»†</th>
<th>æˆåŠŸ</th>
<th>å¤±è´¥</th>
<th>æ¢å¤ç‡</th>
</tr>
</thead>
<tbody><tr>
<td>è¡¨ç»“æ„</td>
<td>58</td>
<td>0</td>
<td>100%</td>
</tr>
<tr>
<td>è¡¨æ•°æ®</td>
<td>58</td>
<td>0</td>
<td>100%</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@toberoot mysql]# /alidata/mysql/bin/mysqld --initialize-insecure --datadir=/alidata/mysql/data/  --user=mysql</span><br><span class="line">[root@toberoot mysql]# service mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot mysql]# mysql -V</span><br><span class="line">mysql  Ver 14.14 Distrib 5.7.17, for linux-glibc2.5 (x86_64) using  EditLine wrapper</span><br><span class="line"></span><br><span class="line">[root@toberoot mysql]# cd ~/home/cy02/</span><br><span class="line">[root@toberoot cy02]# ll</span><br><span class="line">total 178140</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9022 Aug 14  2017 base_dict.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Mar 14 15:00 base_dict.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8822 Mar  2 11:14 biz_advise.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 14 14:39 biz_advise.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8850 Mar  2 11:14 biz_bank.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Mar  2 11:14 biz_bank.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9580 Mar  2 11:14 biz.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9286 Mar  2 11:14 biz_gift.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Apr 24 14:08 biz_gift.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8890 Mar  2 11:14 biz_gprs_bind.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8745 Mar  2 11:14 biz_gprs_bind_his.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   180224 May 15 09:40 biz_gprs_bind_his.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql   180224 May 15 09:42 biz_gprs_bind.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 14:33 biz.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8845 Aug 14  2017 biz_msg_template.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 biz_msg_template.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8881 Aug 14  2017 biz_take_bank.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 13 19:26 biz_take_bank.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9411 Nov 24 13:22 biz_take.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   196608 May 15 15:22 biz_take.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8862 Aug 14  2017 biz_take_wwlt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 15:22 biz_take_wwlt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8854 Aug 14  2017 biz_take_wx.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 11:52 biz_take_wx.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8925 Aug 14  2017 biz_vip.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Mar 16 09:31 biz_vip.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8852 Aug 14  2017 biz_wlt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 18:30 biz_wlt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8926 Aug 14  2017 biz_wx_focus.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 10 16:24 biz_wx_focus.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9339 Nov 24 13:25 biz_wx.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 10 16:24 biz_wx.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8874 Aug 14  2017 biz_wx_walt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 biz_wx_walt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8776 Aug 14  2017 cfg_area.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   311296 Aug 14  2017 cfg_area.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8721 Aug 14  2017 cfg_id_gen.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 18:41 cfg_id_gen.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql       61 Aug 14  2017 db.opt</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9053 Aug 14  2017 gprs_model.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   212992 May 15 18:47 gprs_model.ibd</span><br><span class="line">-r--r--r-- 1 mysql mysql 79691776 May 16 14:04 ibdata1</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8801 Dec 19 15:00 mbr_coin_chged.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  2097152 May 15 17:27 mbr_coin_chged.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8766 Dec 19 14:53 mbr_coin.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 19:12 mbr_coin.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9155 May 14 11:55 mbr.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   212992 May 15 20:58 mbr.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8876 Aug 14  2017 mbr_oauth.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   475136 May 15 19:37 mbr_oauth.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9011 Aug 14  2017 mbr_pay.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 mbr_pay.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8740 Aug 14  2017 mbr_prizen.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 mbr_prizen.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9147 Dec 19 14:56 mbr_recharge.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   294912 May 15 19:11 mbr_recharge.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8801 Aug 14  2017 mbr_wallet_chged.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9437184 May 15 17:27 mbr_wallet_chged.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8845 Aug 14  2017 mbr_wallet.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   262144 May 15 19:12 mbr_wallet.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql    10100 Dec 19 15:47 ord.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql 31457280 May 15 18:41 ord.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8940 Aug 14  2017 ord_item.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 ord_item.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8917 Aug 14  2017 ord_pay_ali.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 ord_pay_ali.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8924 Dec 19 15:55 ord_pay_coin.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   475136 May 15 17:27 ord_pay_coin.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8926 Aug 14  2017 ord_pay_return.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 ord_pay_return.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8966 Dec 20 16:50 ord_pay_wlt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9437184 May 15 17:27 ord_pay_wlt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9036 Aug 14  2017 ord_pay_wx.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql 32505856 May 15 18:41 ord_pay_wx.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9098 Aug 14  2017 prod_base_args.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_base_args.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8790 Aug 14  2017 prod_bug_rpt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_bug_rpt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8887 Aug 14  2017 prod_cmd.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_cmd.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8984 Aug 14  2017 prod_cmd_invoke.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_cmd_invoke.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9058 Aug 14  2017 prod_coin_rpt.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9437184 May 15 14:24 prod_coin_rpt.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8798 Aug 14  2017 prod_coin_rpt_log.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 15 14:24 prod_coin_rpt_log.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9834 Dec 13 14:12 prod.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8835 Aug 14  2017 prod_gprs_bind.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8793 Aug 14  2017 prod_gprs_bind_his.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   196608 May 15 09:42 prod_gprs_bind_his.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_gprs_bind.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql   425984 May 15 09:42 prod.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8851 Aug 14  2017 prod_instl_imgs.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_instl_imgs.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9388 Dec 13 14:13 prod_instl_pos.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   147456 May 15 16:25 prod_instl_pos.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9384 Dec 13 14:14 prod_instl_pos_model.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   131072 May 15 16:24 prod_instl_pos_model.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8892 Aug 14  2017 prod_mod_attr.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_mod_attr.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8873 Aug 14  2017 prod_mod_attr_val.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_mod_attr_val.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9642 Dec 13 14:11 prod_model.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 11 11:58 prod_model.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8815 Aug 14  2017 prod_mod_sku.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_mod_sku.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9050 Aug 14  2017 prod_onl_log.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   163840 May 15 18:42 prod_onl_log.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9143 Aug 14  2017 prod_sp_args.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_sp_args.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8876 Aug 14  2017 prod_sp_arg_vals.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 prod_sp_arg_vals.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9190 Dec 13 14:14 sys_acct.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 May 14 11:16 sys_acct.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     8776 Aug 14  2017 sys_acct_res.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql   229376 May 11 11:52 sys_acct_res.ibd</span><br><span class="line">-rw-r--r-- 1 mysql mysql     9106 Aug 14  2017 sys_res.frm</span><br><span class="line">-rw-r--r-- 1 mysql mysql    98304 Aug 14  2017 sys_res.ibd</span><br><span class="line"><span class="meta">#</span><span class="bash">è·å–å¾…æ¢å¤è¡¨å</span></span><br><span class="line">[root@toberoot cy02]# ll *.frm |awk '&#123;print $9&#125;'|awk -F '.' '&#123;print $1&#125;' &gt; /alidata/cy_table.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> pythonè„šæœ¬è‡ªåŠ¨ç”Ÿæˆå»ºè¡¨è¯­å¥</span></span><br><span class="line">[root@toberoot alidata]# cat py_createtable01.py </span><br><span class="line"><span class="meta">#</span><span class="bash">-*- coding : utf8 -*-</span></span><br><span class="line"></span><br><span class="line">def create_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "create table &#123;&#125; (id int);".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    create_table_test('/alidata/cy_table.txt','/alidata/cy_sql1.sql')</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# python /alidata/py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql1.sql </span><br><span class="line">create table base_dict</span><br><span class="line"> (id int);create table biz_advise</span><br><span class="line"> (id int);create table biz_bank</span><br><span class="line"> (id int);create table biz</span><br><span class="line"> (id int);create table biz_gift</span><br><span class="line"> (id int);create table biz_gprs_bind</span><br><span class="line"> (id int);create table biz_gprs_bind_his</span><br><span class="line"> (id int);create table biz_msg_template</span><br><span class="line"> (id int);create table biz_take_bank</span><br><span class="line"> (id int);create table biz_take</span><br><span class="line">çœç•¥ã€‚ã€‚ã€‚</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å…¥æµ‹è¯•è¡¨ç»“æ„</span></span><br><span class="line">[root@toberoot alidata]# mysql -e "show databases"</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">[root@toberoot alidata]# mysql -e "create database cy;"</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; /alidata/cy_sql1.sql </span><br><span class="line">[root@toberoot alidata]# mysql -e "desc cy.sys_res"</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| Field | Type    | Null | Key | Default | Extra |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| id    | int(11) | YES  |     | NULL    |       |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¼€å§‹è·å–è¡¨ç»“æ„ä¸­åˆ—çš„ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# service mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@toberoot alidata]# yes|cp ~/home/cy02/*.frm /alidata/mysql/data/cy/</span><br><span class="line">cp: overwrite â€˜/alidata/mysql/data/cy/base_dict.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_advise.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_bank.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_gift.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_gprs_bind.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_gprs_bind_his.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_msg_template.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take_bank.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take_wwlt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_take_wx.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_vip.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wlt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wx_focus.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wx.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/biz_wx_walt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/cfg_area.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/cfg_id_gen.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/gprs_model.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_coin_chged.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_coin.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_oauth.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_pay.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_prizen.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_recharge.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_wallet_chged.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/mbr_wallet.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_item.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_ali.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_coin.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_return.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_wlt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/ord_pay_wx.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_base_args.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_bug_rpt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_cmd.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_cmd_invoke.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_coin_rpt.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_coin_rpt_log.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_gprs_bind.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_gprs_bind_his.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_instl_imgs.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_instl_pos.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_instl_pos_model.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_mod_attr.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_mod_attr_val.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_model.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_mod_sku.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_onl_log.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_sp_args.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/prod_sp_arg_vals.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/sys_acct.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/sys_acct_res.frmâ€™? cp: overwrite â€˜/alidata/mysql/data/cy/sys_res.frmâ€™? [root@toberoot alidata]# </span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# cat py_createtable01.py </span><br><span class="line"><span class="meta">#</span><span class="bash">-*- coding : utf8 -*-</span></span><br><span class="line"></span><br><span class="line">def create_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "create table &#123;&#125; (id int);".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line">   </span><br><span class="line">def desc_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "desc &#123;&#125;;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close()</span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    #create_table_test('/alidata/cy_table.txt','/alidata/cy_sql1.sql')</span><br><span class="line">    desc_table_test('/alidata/cy_table.txt','/alidata/cy_sql2.sql')</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# python py_createtable01.py</span><br><span class="line">[root@toberoot alidata]# head cy_sql2.sql </span><br><span class="line">desc base_dict</span><br><span class="line">;desc biz_advise</span><br><span class="line">;desc biz_bank</span><br><span class="line">;desc biz</span><br><span class="line">;desc biz_gift</span><br><span class="line">;desc biz_gprs_bind</span><br><span class="line">;desc biz_gprs_bind_his</span><br><span class="line">;desc biz_msg_template</span><br><span class="line">;desc biz_take_bank</span><br><span class="line">;desc biz_take</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆªå–åŒ…å«åˆ—åçš„æŠ¥é”™</span></span><br><span class="line">[root@toberoot alidata]# grep contains  mysql/dataerror.log &gt; cy_error1.log</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠ¥é”™æ ¼å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">2018-05-17T07:58:32.926555Z 3 [Warning] InnoDB: Table cy/base_dict contains 1 user defined columns in InnoDB, but 11 columns in MySQL. Please check INFORMATION_SCHEMA.INNODB_SYS_COLUMNS and http://dev.mysql.com/doc/refman/5.7/en/innodb-troubleshooting.html for how to resolve the issue.</span><br><span class="line">2018-05-17T07:59:03.555492Z 4 [Warning] InnoDB: Table cy/biz_advise contains 1 user defined columns in InnoDB, but 7 columns in MySQL. Please check INFORMATION_SCHEMA.INNODB_SYS_COLUMNS and http://dev.mysql.com/doc/refman/5.7/en/innodb-troubleshooting.html for how to resolve the issue.</span><br><span class="line">2018-05-17T07:59:03.556045Z 4 [Warning] InnoDB: Table cy/biz_bank contains 1 user defined columns in InnoDB, but 7 columns in MySQL. Please check INFORMATION_SCHEMA.INNODB_SYS_COLUMNS and http://dev.mysql.com/doc/refman/5.7/en/innodb-troubleshooting.html for how to resolve the issue.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†è¡¨åå’Œåˆ—æ•°å­˜æ”¾è‡³æ–‡ä»¶ä¸­</span></span><br><span class="line">[root@toberoot alidata]# awk '&#123;print $6,$15&#125;' cy_error1.log | awk -F '/' '&#123;print $2&#125;' &gt; cy_table_col.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ ¹æ®ä»¥ä¸Šè¡¨åå’Œåˆ—æ•°ç”Ÿæˆæ–°çš„æµ‹è¯•è¡¨</span></span><br><span class="line">def create_table_col(table_col_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_col_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    # b_list = ['t1 10','t2 20']</span><br><span class="line">    str_list = []</span><br><span class="line">    for table_col_str in b_list:</span><br><span class="line">        table_col_list = table_col_str.split()</span><br><span class="line">	table = table_col_list[0]</span><br><span class="line">	col = int(table_col_list[1])</span><br><span class="line">        string = "create table &#123;&#125; (".format(table)</span><br><span class="line">        str_list.append(string)</span><br><span class="line">	for i in range(1,col+1):</span><br><span class="line">            if i!=col:</span><br><span class="line">                string = 'id&#123;&#125; int,'.format(i)</span><br><span class="line">	    else:</span><br><span class="line">                string = 'id&#123;&#125; int);'.format(i)</span><br><span class="line">            str_list.append(string)</span><br><span class="line">    for line in str_list:</span><br><span class="line">        a_file.write(line)</span><br><span class="line">    a_file.close()</span><br><span class="line"></span><br><span class="line">create_table_col('/alidata/cy_table_col.txt','/alidata/cy_sql3.sql')</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤è¿™äº›æµ‹è¯•è¡¨</span></span><br><span class="line">[root@toberoot alidata]# vim py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# python py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# ll</span><br><span class="line">total 60</span><br><span class="line">-rw-r--r--  1 root  root  16729 May 17 16:00 cy_error1.log</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 15:12 cy_sql1.sql</span><br><span class="line">-rw-r--r--  1 root  root   1047 May 17 15:56 cy_sql2.sql</span><br><span class="line">-rw-r--r--  1 root  root   6353 May 17 16:15 cy_sql3.sql</span><br><span class="line">-rw-r--r--  1 root  root   1395 May 17 16:17 cy_sql4.sql</span><br><span class="line">-rw-r--r--  1 root  root    837 May 17 16:03 cy_table_col.txt</span><br><span class="line">-rw-r--r--  1 root  root    699 May 17 15:56 cy_table.txt</span><br><span class="line">drwxr-xr-x  3 root  root   4096 May 17 12:12 install</span><br><span class="line">drwxr-xr-x 11 mysql mysql  4096 May 17 15:44 mysql</span><br><span class="line">-rw-r--r--  1 root  root   1798 May 17 16:17 py_createtable01.py</span><br><span class="line"><span class="meta">#</span><span class="bash">pythonä»£ç å¦‚ä¸‹ï¼š</span></span><br><span class="line">def drop_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "drop table &#123;&#125;;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close()</span><br><span class="line"></span><br><span class="line">drop_table_test('/alidata/cy_table.txt','/alidata/cy_sql4.sql')</span><br><span class="line">    </span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql4.sql </span><br><span class="line">drop table base_dict</span><br><span class="line">;drop table biz_advise</span><br><span class="line">;drop table biz_bank</span><br><span class="line">;drop table biz</span><br><span class="line">;drop table biz_gift</span><br><span class="line">;drop table biz_gprs_bind</span><br><span class="line">;drop table biz_gprs_bind_his</span><br><span class="line">;drop table biz_msg_template</span><br><span class="line">;drop table biz_take_bank</span><br><span class="line">;drop table biz_take</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ é™¤æ•°æ®åº“çš„æ—¶å€™ç›´æ¥å¡æ­»äº†ï¼ŒåŸå› æœªçŸ¥ã€‚ä¹Ÿæ²¡æœ‰æŠ¥é”™ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash">æ¸…æ•°æ®å¯åŠ¨æœåŠ¡</span></span><br><span class="line"></span><br><span class="line">ln: failed to create symbolic link â€˜/usr/local/mysql/bin/mysqldâ€™: File exists</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot ~]# mysql -e 'create database cy'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¼€å§‹å°è¯•è·å–è¡¨çš„ç»“æ„</span></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql3.sql</span><br><span class="line">[root@toberoot alidata]# service mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@toberoot alidata]# cp ~/home/cy02/*.frm /alidata/mysql/data/cy/ -p</span><br><span class="line">cp: overwrite â€˜/alidata/mysql/data/cy/base_dict.frmâ€™? ^C</span><br><span class="line">[root@toberoot alidata]# yes | cp ~/home/cy02/*.frm /alidata/mysql/data/cy/ -p</span><br><span class="line">[root@toberoot alidata]# ll /alidata/mysql/data/cy/sys_res*</span><br><span class="line">-rw-r--r-- 1 mysql mysql  9106 Aug 14  2017 /alidata/mysql/data/cy/sys_res.frm</span><br><span class="line">-rw-r----- 1 mysql mysql 98304 May 17 16:44 /alidata/mysql/data/cy/sys_res.ibd</span><br><span class="line"><span class="meta">#</span><span class="bash"> é…ç½®æ–‡ä»¶</span></span><br><span class="line">[mysqld]</span><br><span class="line">innodb_force_recovery=6</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# service mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¡¨ç»“æ„æˆåŠŸè·å–</span></span><br><span class="line">[root@toberoot alidata]# mysql cy -e 'desc sys_res'</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type         | Null | Key | Default | Extra |</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">| ID     | varchar(64)  | NO   | PRI | NULL    |       |</span><br><span class="line">| NAME   | varchar(32)  | NO   |     | NULL    |       |</span><br><span class="line">| CODE   | varchar(128) | NO   |     | NULL    |       |</span><br><span class="line">| URI    | varchar(128) | NO   |     | NULL    |       |</span><br><span class="line">| LOGO   | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| TYPE   | int(11)      | NO   |     | NULL    |       |</span><br><span class="line">| PCODE  | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| SORT   | int(11)      | YES  |     | 0       |       |</span><br><span class="line">| STATE  | int(11)      | NO   |     | NULL    |       |</span><br><span class="line">| ADMIN  | int(11)      | YES  |     | 0       |       |</span><br><span class="line">| REMARK | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| CRTIME | datetime     | NO   |     | NULL    |       |</span><br><span class="line">| UPTIME | datetime     | NO   |     | NULL    |       |</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">root@MySQL-01 16:49:  [(none)]&gt; select table_name,table_schema from information_schema.tables where table_schema='cy';</span><br><span class="line">+----------------------+--------------+</span><br><span class="line">| table_name           | table_schema |</span><br><span class="line">+----------------------+--------------+</span><br><span class="line">| base_dict            | cy           |</span><br><span class="line">| biz                  | cy           |</span><br><span class="line">| biz_advise           | cy           |</span><br><span class="line">| biz_bank             | cy           |</span><br><span class="line">| biz_gift             | cy           |</span><br><span class="line">| biz_gprs_bind        | cy           |</span><br><span class="line">| biz_gprs_bind_his    | cy           |</span><br><span class="line">| biz_msg_template     | cy           |</span><br><span class="line">| biz_take             | cy           |</span><br><span class="line">| biz_take_bank        | cy           |</span><br><span class="line">| biz_take_wwlt        | cy           |</span><br><span class="line">| biz_take_wx          | cy           |</span><br><span class="line">| biz_vip              | cy           |</span><br><span class="line">| biz_wlt              | cy           |</span><br><span class="line">| biz_wx               | cy           |</span><br><span class="line">| biz_wx_focus         | cy           |</span><br><span class="line">| biz_wx_walt          | cy           |</span><br><span class="line">| cfg_area             | cy           |</span><br><span class="line">| cfg_id_gen           | cy           |</span><br><span class="line">| gprs_model           | cy           |</span><br><span class="line">| mbr                  | cy           |</span><br><span class="line">| mbr_coin             | cy           |</span><br><span class="line">| mbr_coin_chged       | cy           |</span><br><span class="line">| mbr_oauth            | cy           |</span><br><span class="line">| mbr_pay              | cy           |</span><br><span class="line">| mbr_prizen           | cy           |</span><br><span class="line">| mbr_recharge         | cy           |</span><br><span class="line">| mbr_wallet           | cy           |</span><br><span class="line">| mbr_wallet_chged     | cy           |</span><br><span class="line">| ord                  | cy           |</span><br><span class="line">| ord_item             | cy           |</span><br><span class="line">| ord_pay_ali          | cy           |</span><br><span class="line">| ord_pay_coin         | cy           |</span><br><span class="line">| ord_pay_return       | cy           |</span><br><span class="line">| ord_pay_wlt          | cy           |</span><br><span class="line">| ord_pay_wx           | cy           |</span><br><span class="line">| prod                 | cy           |</span><br><span class="line">| prod_base_args       | cy           |</span><br><span class="line">| prod_bug_rpt         | cy           |</span><br><span class="line">| prod_cmd             | cy           |</span><br><span class="line">| prod_cmd_invoke      | cy           |</span><br><span class="line">| prod_coin_rpt        | cy           |</span><br><span class="line">| prod_coin_rpt_log    | cy           |</span><br><span class="line">| prod_gprs_bind       | cy           |</span><br><span class="line">| prod_gprs_bind_his   | cy           |</span><br><span class="line">| prod_instl_imgs      | cy           |</span><br><span class="line">| prod_instl_pos       | cy           |</span><br><span class="line">| prod_instl_pos_model | cy           |</span><br><span class="line">| prod_mod_attr        | cy           |</span><br><span class="line">| prod_mod_attr_val    | cy           |</span><br><span class="line">| prod_mod_sku         | cy           |</span><br><span class="line">| prod_model           | cy           |</span><br><span class="line">| prod_onl_log         | cy           |</span><br><span class="line">| prod_sp_arg_vals     | cy           |</span><br><span class="line">| prod_sp_args         | cy           |</span><br><span class="line">| sys_acct             | cy           |</span><br><span class="line">| sys_acct_res         | cy           |</span><br><span class="line">| sys_res              | cy           |</span><br><span class="line">+----------------------+--------------+</span><br><span class="line">58 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 58å¼ è¡¨dumpå¤‡ä»½å‡ºæ¥</span></span><br><span class="line">[root@toberoot alidata]# mysqldump -B cy -d &gt; /alidata/new_yc_ddl.sql</span><br><span class="line">[root@toberoot alidata]# tail -n 30 /alidata/new_yc_ddl.sql </span><br><span class="line">/*!40101 SET @saved_cs_client     = @@character_set_client */;</span><br><span class="line">/*!40101 SET character_set_client = utf8 */;</span><br><span class="line">CREATE TABLE `sys_res` (</span><br><span class="line">  `ID` varchar(64) NOT NULL COMMENT 'ID',</span><br><span class="line">  `NAME` varchar(32) NOT NULL COMMENT 'èœå•åç§°',</span><br><span class="line">  `CODE` varchar(128) NOT NULL COMMENT 'èœå•ç¼–ç ',</span><br><span class="line">  `URI` varchar(128) NOT NULL COMMENT 'URI',</span><br><span class="line">  `LOGO` varchar(64) DEFAULT NULL COMMENT 'å›¾æ ‡',</span><br><span class="line">  `TYPE` int(11) NOT NULL COMMENT '@èœå•ç±»å‹ï¼ˆ1èœå•ï¼›2æŒ‰é’®ï¼‰',</span><br><span class="line">  `PCODE` varchar(64) DEFAULT NULL COMMENT 'çˆ¶èœå•',</span><br><span class="line">  `SORT` int(11) DEFAULT '0' COMMENT 'æ’åº',</span><br><span class="line">  `STATE` int(11) NOT NULL COMMENT '@@çŠ¶æ€ï¼ˆ0 æ— æ•ˆï¼›1 æ­£å¸¸ï¼‰',</span><br><span class="line">  `ADMIN` int(11) DEFAULT '0' COMMENT 'æ˜¯å¦ç®¡ç†å‘˜èœå•ï¼ˆé»˜è®¤0å¦ï¼‰',</span><br><span class="line">  `REMARK` varchar(64) DEFAULT NULL COMMENT 'å¤‡æ³¨',</span><br><span class="line">  `CRTIME` datetime NOT NULL COMMENT 'CRTIME',</span><br><span class="line">  `UPTIME` datetime NOT NULL COMMENT 'UPTIME',</span><br><span class="line">  PRIMARY KEY (`ID`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='æƒé™_ç³»ç»Ÿèµ„æº';</span><br><span class="line">/*!40101 SET character_set_client = @saved_cs_client */;</span><br><span class="line">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;</span><br><span class="line"></span><br><span class="line">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;</span><br><span class="line">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;</span><br><span class="line">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;</span><br><span class="line">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;</span><br><span class="line">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;</span><br><span class="line">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;</span><br><span class="line">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;</span><br><span class="line"></span><br><span class="line">-- Dump completed on 2018-05-17 16:52:28</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> discardå’Œimportå‘½ä»¤</span></span><br><span class="line">def discard_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "alter table &#123;&#125; discard tablespace;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def import_table_test(table_file,sql_file):</span><br><span class="line">    a_file = open(sql_file,'w')</span><br><span class="line">    b_file = open(table_file)</span><br><span class="line">    b_list = b_file.readlines()</span><br><span class="line">    for table in b_list:</span><br><span class="line">        string = "alter table &#123;&#125; import tablespace;".format(table)</span><br><span class="line">        a_file.write(string)</span><br><span class="line">    a_file.close() </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">discard_table_test('/alidata/cy_table.txt','/alidata/cy_sql5.sql')</span><br><span class="line">import_table_test('/alidata/cy_table.txt','/alidata/cy_sql6.sql')</span><br><span class="line">   </span><br><span class="line"><span class="meta">#</span><span class="bash"> ç”Ÿæˆsql</span></span><br><span class="line">[root@toberoot alidata]# python py_createtable01.py </span><br><span class="line">[root@toberoot alidata]# ll</span><br><span class="line">total 124</span><br><span class="line">-rw-r--r--  1 root  root  16729 May 17 16:00 cy_error1.log</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 15:12 cy_sql1.sql</span><br><span class="line">-rw-r--r--  1 root  root   1047 May 17 15:56 cy_sql2.sql</span><br><span class="line">-rw-r--r--  1 root  root   6353 May 17 16:15 cy_sql3.sql</span><br><span class="line">-rw-r--r--  1 root  root   1395 May 17 16:17 cy_sql4.sql</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 16:55 cy_sql5.sql</span><br><span class="line">-rw-r--r--  1 root  root   2033 May 17 16:55 cy_sql6.sql</span><br><span class="line">-rw-r--r--  1 root  root    837 May 17 16:03 cy_table_col.txt</span><br><span class="line">-rw-r--r--  1 root  root    699 May 17 15:56 cy_table.txt</span><br><span class="line">drwxr-xr-x  3 root  root   4096 May 17 16:41 install</span><br><span class="line">drwxr-xr-x 11 mysql mysql  4096 May 17 16:47 mysql</span><br><span class="line">-rw-r--r--  1 root  root  57068 May 17 16:52 new_yc_ddl.sql</span><br><span class="line">-rw-r--r--  1 root  root   2489 May 17 16:55 py_createtable01.py</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql5.sql </span><br><span class="line">alter table base_dict</span><br><span class="line"> discard tablespace;alter table biz_advise</span><br><span class="line"> discard tablespace;alter table biz_bank</span><br><span class="line"> discard tablespace;alter table biz</span><br><span class="line"> discard tablespace;alter table biz_gift</span><br><span class="line"> discard tablespace;alter table biz_gprs_bind</span><br><span class="line"> discard tablespace;alter table biz_gprs_bind_his</span><br><span class="line"> discard tablespace;alter table biz_msg_template</span><br><span class="line"> discard tablespace;alter table biz_take_bank</span><br><span class="line"> discard tablespace;alter table biz_take</span><br><span class="line">[root@toberoot alidata]# head /alidata/cy_sql6.sql </span><br><span class="line">alter table base_dict</span><br><span class="line"> import tablespace;alter table biz_advise</span><br><span class="line"> import tablespace;alter table biz_bank</span><br><span class="line"> import tablespace;alter table biz</span><br><span class="line"> import tablespace;alter table biz_gift</span><br><span class="line"> import tablespace;alter table biz_gprs_bind</span><br><span class="line"> import tablespace;alter table biz_gprs_bind_his</span><br><span class="line"> import tablespace;alter table biz_msg_template</span><br><span class="line"> import tablespace;alter table biz_take_bank</span><br><span class="line"> import tablespace;alter table biz_take</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql</span><br><span class="line">ERROR 1036 (HY000) at line 1: Table 'base_dict' is read only</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# service mysqld restart</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# cp /root/home/cy02/*.ibd /alidata/mysql/data/cy/ -rp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line">ERROR 2013 (HY000) at line 1: Lost connection to MySQL server during query</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# service mysqld restart</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line">ERROR 1036 (HY000) at line 1: Table 'base_dict' is read only</span><br><span class="line">[root@toberoot alidata]# service mysqld stop</span><br><span class="line">Shutting down MySQL..                                      [  OK  ]</span><br><span class="line">[root@toberoot alidata]# rm -rf /alidata/mysql/data/*</span><br><span class="line"></span><br><span class="line">[root@toberoot alidata]# service mysqld start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@toberoot alidata]# mysql &lt; new_yc_ddl.sql </span><br><span class="line">[root@toberoot alidata]# mysql -e 'use cy;select * from sys_res'</span><br><span class="line"></span><br><span class="line">å¼€å¯å¼ºåˆ¶æ¢å¤å‚æ•°</span><br><span class="line">[root@toberoot alidata]# vim /etc/my.cnf</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql</span><br><span class="line">cy_sql1.sql  cy_sql2.sql  cy_sql3.sql  cy_sql4.sql  cy_sql5.sql  cy_sql6.sql  </span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql </span><br><span class="line">[root@toberoot alidata]# cp /root/home/cy02/*.ibd /alidata/mysql/data/cy/ -rp</span><br><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å…¨å¤‡ä»½æ•°æ®</span></span><br><span class="line">[root@toberoot alidata]# mysqldump -B cy &gt; new_cy_all.sql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å¤‡ä»½çš„æ•°æ®é‡</span></span><br><span class="line">-rw-r--r--  1 root  root   26M May 17 17:13 new_cy_all.sql</span><br></pre></td></tr></table></figure>

<h2 id="æŠ¥é”™æ±‡æ€»"><a href="#æŠ¥é”™æ±‡æ€»" class="headerlink" title="æŠ¥é”™æ±‡æ€»"></a>æŠ¥é”™æ±‡æ€»</h2><h3 id="ERROR-1036-ï¼ˆHY00ï¼‰"><a href="#ERROR-1036-ï¼ˆHY00ï¼‰" class="headerlink" title="ERROR 1036 ï¼ˆHY00ï¼‰"></a>ERROR 1036 ï¼ˆHY00ï¼‰</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql5.sql</span><br><span class="line">ERROR 1036 (HY000) at line 1: Table 'base_dict' is read only</span><br></pre></td></tr></table></figure>

<p>è§£å†³æ–¹æ³•ï¼š</p>
<ol>
<li>æ£€æŸ¥æ˜¯å¦é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨innodb_force_recoveryå‚æ•°</li>
<li>å¦‚æœå­˜åœ¨å»é™¤æˆ–æ³¨é‡Šæ‰ï¼Œé‡å¯æœåŠ¡å³å¯</li>
<li>è¿˜ä¸è¡Œå°±æ¸…ç©ºæ•°æ®åº“å¯¼å…¥ç»“æ„åå†ç»§ç»­</li>
</ol>
<h3 id="ERROR-2013-HY000"><a href="#ERROR-2013-HY000" class="headerlink" title="ERROR 2013 (HY000)"></a>ERROR 2013 (HY000)</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@toberoot alidata]# mysql cy &lt; cy_sql6.sql</span><br><span class="line">ERROR 2013 (HY000) at line 1: Lost connection to MySQL server during query</span><br></pre></td></tr></table></figure>

<p>è§£å†³æ–¹æ³•ï¼š</p>
<ol>
<li><p>sqlè„šæœ¬ä¸­æ‰§è¡Œimport tablespaceçš„æ“ä½œéœ€è¦å¼€å¯recoveryçš„å‚æ•°</p>
</li>
<li><p>é‡å¯æœåŠ¡ </p>
<p>åœ¨å®¢æˆ·æœåŠ¡ä¸Šï¼Œæ‰§è¡Œä»¥ä¸Šæ“ä½œè¿˜æ˜¯æŠ¥é”™æ— æ³•è¿æ¥ï¼Œå°è¯•å¤šæ¬¡éƒ½ä¸è¡Œã€‚</p>
</li>
</ol>
<p><img src="MySQL%E4%B8%80%E6%AC%A1%E6%83%8A%E5%BF%83%E5%8A%A8%E9%AD%84%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%BC%BA%E5%88%B6%E6%81%A2%E5%A4%8D/04.jpg" alt=""></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ¬¡caseçš„æ•™è®­å°±æ˜¯ï¼Œå¤‡ä»½ï¼ä¸€å®šè¦æœ‰å‘¨æœŸæ€§çš„æœ‰æ•ˆå¤‡ä»½ï¼</p>
<p>æ¬ºéª—MySQLè¿›ç¨‹è’™æ··è¿‡å…³åªèƒ½æ˜¯æ²¡åŠæ³•çš„åŠæ³•ï¼Œè€Œä¸”ä¸èƒ½ä¿è¯æˆåŠŸç‡ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -*- coding : utf8 -*-</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> py_createtable01.py</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> authï¼š booboowei</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class mysql_tools():</span><br><span class="line">    def __init__(self, in_file):</span><br><span class="line">        self.b_list = open(in_file).readlines()</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">    def create_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "create table &#123;&#125; (id int);".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def desc_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "desc &#123;&#125;;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def create_table_col(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        str_list = []</span><br><span class="line">        for table_col_str in self.b_list:</span><br><span class="line">            table_col_list = table_col_str.split()</span><br><span class="line">            table = table_col_list[0]</span><br><span class="line">            col = int(table_col_list[1])</span><br><span class="line">            string = "create table &#123;&#125; (".format(table)</span><br><span class="line">            str_list.append(string)</span><br><span class="line">            for i in range(1, col + 1):</span><br><span class="line">                if i != col:</span><br><span class="line">                    string = 'id&#123;&#125; int,'.format(i)</span><br><span class="line">                else:</span><br><span class="line">                    string = 'id&#123;&#125; int);'.format(i)</span><br><span class="line">                str_list.append(string)</span><br><span class="line">        for line in str_list:</span><br><span class="line">            a_file.write(line)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def drop_table_test(self,  sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "drop table &#123;&#125;;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def discard_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "alter table &#123;&#125; discard tablespace;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    def import_table_test(self, sql_file):</span><br><span class="line">        a_file = open(sql_file, 'w')</span><br><span class="line">        for table in self.b_list:</span><br><span class="line">            string = "alter table &#123;&#125; import tablespace;".format(table)</span><br><span class="line">            a_file.write(string)</span><br><span class="line">        a_file.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').create_table_test('/alidata/cy_sql1.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').desc_table_test('/alidata/cy_sql2.sql')</span><br><span class="line">    # æ ¹æ®ä»¥ä¸Šè¡¨åå’Œåˆ—æ•°ç”Ÿæˆæ–°çš„æµ‹è¯•è¡¨</span><br><span class="line">    mysql_tools('/alidata/cy_table_col.txt').create_table_col('/alidata/cy_sql3.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').drop_table_test('/alidata/cy_sql4.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').discard_table_test('/alidata/cy_sql5.sql')</span><br><span class="line">    mysql_tools('/alidata/cy_table.txt').import_table_test('/alidata/cy_sql6.sql')</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>æŠ€æœ¯å¹¿è§’</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>æ•°æ®æ•‘æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLçš„å…ƒé”MDLå‘ç”Ÿåœºæ™¯å’Œè§£å†³æ–¹æ³•æ€»ç»“</title>
    <url>/2017/08/19/MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>æ‘˜è¦ï¼šMetaData Lockå³å…ƒæ•°æ®é”ï¼Œåœ¨æ•°æ®åº“ä¸­å…ƒæ•°æ®å³æ•°æ®å­—å…¸ä¿¡æ¯åŒ…æ‹¬db,table,function,procedure,trigger,eventç­‰ã€‚metadata lockä¸»è¦ä¸ºäº†ä¿è¯å…ƒæ•°æ®çš„ä¸€è‡´æ€§,ç”¨äºå¤„ç†ä¸åŒçº¿ç¨‹æ“ä½œåŒä¸€æ•°æ®å¯¹è±¡çš„åŒæ­¥ä¸äº’æ–¥é—®é¢˜ã€‚</p>
<p>ä»Šå¤©æœ‰å®¢æˆ·(MySQL 5.6)é‡åˆ°è¯¥é—®é¢˜ï¼Œæœ€å…³é”®çš„æ˜¯å±äºç¬¬ä¸‰ç§æƒ…å†µï¼Œgoogleä¸Šæ ¹æœ¬æ‰¾ä¸åˆ°ç±»ä¼¼çš„æ•…éšœæ¡ˆä¾‹ï¼Œå”¯ä¸€ä¸€ä¸ªéå¸¸æ¥è¿‘çš„æ•…éšœæ¡ˆä¾‹ä¸­æ•°æ®åº“ç‰ˆæœ¬å´ä¸åŒï¼ˆå…·ä½“çœ‹ä¸‹æ–‡æ…¢æ…¢èŠï¼‰ï¼Œå“ï¼Œå›°éš¾é‡é‡å•Šï¼Œæœ€ç»ˆè¿˜æ˜¯è§£å†³äº†å“ˆã€‚</p>
<p>alter tableçš„è¯­å¥æ˜¯å¾ˆå±é™©çš„ï¼Œåœ¨æ“ä½œä¹‹å‰æœ€å¥½ç¡®è®¤å¯¹è¦æ“ä½œçš„è¡¨æ²¡æœ‰ä»»ä½•è¿›è¡Œä¸­çš„æ“ä½œã€æ²¡æœ‰æœªæäº¤äº‹åŠ¡ã€ä¹Ÿæ²¡æœ‰æ˜¾å¼äº‹åŠ¡ä¸­çš„æŠ¥é”™è¯­å¥ã€‚å¦‚æœæœ‰alter tableçš„ç»´æŠ¤ä»»åŠ¡ï¼Œåœ¨æ— äººç›‘ç®¡çš„æ—¶å€™è¿è¡Œï¼Œæœ€å¥½é€šè¿‡lock_wait_timeoutè®¾ç½®å¥½è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´çš„metedataé”ç­‰å¾…ã€‚</p>
<a id="more"></a>


<h2 id="ä»€ä¹ˆæ˜¯metadata-lockï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯metadata-lockï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯metadata lockï¼Ÿ"></a>ä»€ä¹ˆæ˜¯metadata lockï¼Ÿ</h2><p>MetaData Lockå³å…ƒæ•°æ®é”ï¼Œåœ¨æ•°æ®åº“ä¸­å…ƒæ•°æ®å³æ•°æ®å­—å…¸ä¿¡æ¯åŒ…æ‹¬db,table,function,procedure,trigger,eventç­‰ã€‚metadata lockä¸»è¦ä¸ºäº†ä¿è¯å…ƒæ•°æ®çš„ä¸€è‡´æ€§,ç”¨äºå¤„ç†ä¸åŒçº¿ç¨‹æ“ä½œåŒä¸€æ•°æ®å¯¹è±¡çš„åŒæ­¥ä¸äº’æ–¥é—®é¢˜ã€‚</p>
<h3 id="MetaData-Lockçš„å‰ä¸–ä»Šç”Ÿ"><a href="#MetaData-Lockçš„å‰ä¸–ä»Šç”Ÿ" class="headerlink" title="MetaData Lockçš„å‰ä¸–ä»Šç”Ÿ"></a><strong>MetaData Lockçš„å‰ä¸–ä»Šç”Ÿ</strong></h3><p>MDLé”æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªæœ‰åçš„<a href="https://bugs.mysql.com/bug.php?id=989" target="_blank" rel="noopener">bug#989</a>ï¼Œæ‰€ä»¥åœ¨5.5.3ç‰ˆæœ¬å¼•å…¥äº†MDLé”ã€‚å…¶å®5.5ä¹Ÿæœ‰ç±»ä¼¼ä¿æŠ¤å…ƒæ•°æ®çš„æœºåˆ¶ï¼Œåªæ˜¯æ²¡æœ‰æ˜ç¡®æå‡ºMDLæ¦‚å¿µè€Œå·²ã€‚ä½†æ˜¯5.5ä¹‹å‰ç‰ˆæœ¬(æ¯”å¦‚5.1)ä¸5.5ä¹‹åç‰ˆæœ¬åœ¨ä¿æŠ¤å…ƒæ•°æ®è¿™å—æœ‰ä¸€ä¸ªæ˜¾è‘—çš„ä¸åŒç‚¹æ˜¯ï¼Œ5.1å¯¹äºå…ƒæ•°æ®çš„ä¿æŠ¤æ˜¯è¯­å¥çº§åˆ«çš„ï¼Œ5.5å¯¹äºmetadataçš„ä¿æŠ¤æ˜¯äº‹åŠ¡çº§åˆ«çš„ã€‚æ‰€è°“è¯­å¥çº§åˆ«ï¼Œå³è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œæ— è®ºäº‹åŠ¡æ˜¯å¦æäº¤æˆ–å›æ»šï¼Œå…¶è¡¨ç»“æ„å¯ä»¥è¢«å…¶ä»–ä¼šè¯æ›´æ–°ï¼›è€Œäº‹åŠ¡çº§åˆ«åˆ™æ˜¯åœ¨äº‹åŠ¡ç»“æŸåæ‰é‡Šæ”¾MDLã€‚å¼•å…¥MDLé”ä¸»è¦æ˜¯ä¸ºäº†<strong>è§£å†³ä¸¤ä¸ªé—®é¢˜</strong>ï¼š</p>
<ul>
<li>äº‹åŠ¡éš”ç¦»é—®é¢˜ï¼šæ¯”å¦‚åœ¨å¯é‡å¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¼šè¯Aåœ¨2æ¬¡æŸ¥è¯¢æœŸé—´ï¼Œä¼šè¯Bå¯¹è¡¨ç»“æ„åšäº†ä¿®æ”¹ï¼Œä¸¤æ¬¡æŸ¥è¯¢ç»“æœå°±ä¼šä¸ä¸€è‡´ï¼Œæ— æ³•æ»¡è¶³å¯é‡å¤è¯»çš„è¦æ±‚ã€‚</li>
<li>æ•°æ®å¤åˆ¶é—®é¢˜ï¼šæ¯”å¦‚ä¼šè¯Aæ‰§è¡Œäº†å¤šæ¡æ›´æ–°è¯­å¥æœŸé—´ï¼Œå¦å¤–ä¸€ä¸ªä¼šè¯Båšäº†è¡¨ç»“æ„å˜æ›´å¹¶ä¸”å…ˆæäº¤ï¼Œå°±ä¼šå¯¼è‡´slaveåœ¨é‡åšæ—¶ï¼Œå…ˆé‡åšalterï¼Œå†é‡åšupdateæ—¶å°±ä¼šå‡ºç°å¤åˆ¶é”™è¯¯çš„ç°è±¡ã€‚ä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„<a href="https://bugs.mysql.com/bug.php?id=989" target="_blank" rel="noopener">bug#989</a>ã€‚</li>
</ul>
<hr>
<h3 id="DDLæ“ä½œä¸MetaData-Lock"><a href="#DDLæ“ä½œä¸MetaData-Lock" class="headerlink" title="DDLæ“ä½œä¸MetaData Lock"></a>DDLæ“ä½œä¸MetaData Lock</h3><ul>
<li>metadata lock æœºåˆ¶æ˜¯ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§å­˜åœ¨çš„ï¼Œåœ¨æœ‰äº‹åŠ¡çš„æ“ä½œæ—¶å€™ï¼Œéœ€è¦é¦–å…ˆè·å¾—metadata lock ,ç„¶åæ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ï¼Œåˆæ¥äº†ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè¦ddlæ“ä½œåŒä¸€ä¸ªè¡¨ï¼Œå°±ä¼šå‡ºç° metadata lockã€‚</li>
<li>è‡ªåŠ¨æäº¤æ¨¡å¼ä¸‹ï¼Œå•è¯­å¥å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰§è¡Œå®Œäº†ï¼Œäº‹åŠ¡ä¹Ÿå°±ç»“æŸäº†ã€‚</li>
<li>preparestatement  ä¼šè·å¾— metalockï¼Œä¸€æ—¦prepare å®Œæ¯•ï¼Œ metalock å°±é‡Šæ”¾äº†ã€‚</li>
<li>online DDLåº”è¯¥æ˜¯æŒ‡åœ¨alter tableè¿›è¡Œçš„æ—¶å€™ï¼Œ æ’å…¥/ä¿®æ”¹/åˆ é™¤æ•°æ®çš„sqlè¯­å¥ä¸ä¼šWaiting for table metadata lockã€‚ä¸€æ—¦alter table TableAçš„æ“ä½œåœæ»åœ¨Waiting for table metadata lockçš„çŠ¶æ€ï¼Œåç»­å¯¹TableAçš„ä»»ä½•æ“ä½œï¼ˆåŒ…æ‹¬è¯»ï¼‰éƒ½æ— æ³•è¿›è¡Œï¼Œä¹Ÿä¼šåœ¨Opening tablesçš„é˜¶æ®µè¿›å…¥Waiting for table metadata lockçš„é˜Ÿåˆ—ã€‚</li>
</ul>
<h2 id="Alter-table-ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯"><a href="#Alter-table-ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯" class="headerlink" title="Alter table ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯"></a>Alter table ä¼šå‘ç”Ÿé”çš„ä¸‰ç§åœºæ™¯</h2><h3 id="åœºæ™¯1"><a href="#åœºæ™¯1" class="headerlink" title="åœºæ™¯1"></a>åœºæ™¯1</h3><ul>
<li>ä¼šè¯Aå¯¹boobooè¡¨æ‰§è¡Œè¯»æ“ä½œ<code>select *,sleep(60) from booboo;</code>ï¼Œæ­£åœ¨è¿›è¡Œæœªæäº¤äº‹åŠ¡</li>
<li>ä¼šè¯Bå¯¹boobooè¡¨æ‰§è¡Œåœ¨çº¿DDLæ“ä½œ<code>alter table booboo add q4 int default 0;</code></li>
<li>ä¼šè¯Cå¯¹boobooè¡¨æ‰§è¡Œéšå¼è¯»æ“ä½œ<code>select *,sleep(60) from booboo;</code>,è¿›è¡Œç­‰å¾…</li>
<li>ä¼šè¯Då¯¹boobooè¡¨æ‰§è¡Œæ˜¾ç¤ºè¯»æ“ä½œ<code>begin;select * from booboo;</code>ä¹Ÿä¼šè¿›è¡Œç­‰å¾…</li>
<li>é€šè¿‡<code>show processlist</code>å¯ä»¥çœ‹åˆ°ä¼šè¯Aï¼ˆå¯¹boobooè¡¨ä¸Šæ­£åœ¨è¿›è¡Œçš„æ“ä½œï¼‰ï¼Œæ­¤æ—¶ä¼šè¯Bï¼ˆalter tableè¯­å¥ï¼‰æ— æ³•è·å–åˆ°metadata ç‹¬å é”ï¼Œä¼šè¿›è¡Œç­‰å¾…ï¼Œä¼šè¯Cå’Œä¼šè¯Déƒ½ä¼šè¿›è¡Œç­‰å¾…ï¼Œä¸”èƒ½ä»processlistè¡¨ä¸­çœ‹åˆ°å¯¹boobooè¡¨çš„æ“ä½œ</li>
<li>ä¼šè¯Aæäº¤äº‹åŠ¡åæˆ–killä¹‹åï¼Œä¼šè¯Cäº‹åŠ¡ç»“æŸï¼Œä¼šè¯D<code>select</code>è¯­å¥æ‰§è¡ŒæˆåŠŸï¼Œäº‹åŠ¡æäº¤åˆ™ä¼šè¯Bå¯æ‰§è¡Œï¼Œå¦åˆ™è¿›å…¥åœºæ™¯2</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;</span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |  167 | Waiting for table metadata lock | alter table booboo add q4 int default 0 |</span><br><span class="line">|  7 | root | localhost | uplooking | Query   |  155 | Waiting for table metadata lock | select * from booboo                    |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">|  9 | root | localhost | uplooking | Query   |  181 | User sleep                      | select *,sleep(60) from booboo          |</span><br><span class="line">| 10 | root | localhost | uplooking | Query   |    7 | Waiting for table metadata lock | select * from booboo                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> id=9çš„çº¿ç¨‹ä¸ºä¼šè¯A è™½ç„¶æ˜¯éšå¼äº‹åŠ¡ï¼Œä½†æ˜¯æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œæ‰€ä»¥ä¸ºæœªæäº¤çš„äº‹åŠ¡</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> id=6çš„çº¿ç¨‹ä¸ºä¼šè¯B åœ¨ä¼šè¯Aæœ‰äº‹åŠ¡æœªæäº¤çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡ŒAlteræ“ä½œ,äº‰æŠ¢metadata lock</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> id=7çš„çº¿ç¨‹ä¸ºä¼šè¯C éšå¼æŸ¥è¯¢äº‹åŠ¡ä¹Ÿä¼šè¿›å…¥ç­‰å¾…</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> id=10çš„çº¿ç¨‹ä¸ºä¼šè¯D æ˜¾ç¤ºæŸ¥è¯¢äº‹åŠ¡åŒæ ·è¿›å…¥ç­‰å¾…</span></span><br></pre></td></tr></table></figure>

<p>è§£å†³æ–¹æ³•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹metadatalock</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ç¬¬ä¸€ç§æƒ…å†µï¼Œåˆ™å®šä½åˆ°é•¿æ—¶é—´æœªæäº¤çš„äº‹åŠ¡killå³å¯</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥è¯¢ information_schema.innodb_trx çœ‹åˆ°æœ‰é•¿æ—¶é—´æœªå®Œæˆçš„äº‹åŠ¡ï¼Œ ä½¿ç”¨ <span class="built_in">kill</span> å‘½ä»¤ç»ˆæ­¢è¯¥æŸ¥è¯¢ã€‚</span></span><br><span class="line"></span><br><span class="line">select concat('kill ',i.trx_mysql_thread_id,';') from information_schema.innodb_trx i,</span><br><span class="line">  (select </span><br><span class="line">         id, time</span><br><span class="line">     from</span><br><span class="line">         information_schema.processlist</span><br><span class="line">     where</span><br><span class="line">         time = (select </span><br><span class="line">                 max(time)</span><br><span class="line">             from</span><br><span class="line">                 information_schema.processlist</span><br><span class="line">             where</span><br><span class="line">                 state = 'Waiting for table metadata lock'</span><br><span class="line">                     and substring(info, 1, 5) in ('alter' , 'optim', 'repai', 'lock ', 'drop ', 'creat'))) p</span><br><span class="line">  where timestampdiff(second, i.trx_started, now()) &gt; p.time</span><br><span class="line">  and i.trx_mysql_thread_id  not in (connection_id(),p.id);</span><br></pre></td></tr></table></figure>



<h3 id="åœºæ™¯2"><a href="#åœºæ™¯2" class="headerlink" title="åœºæ™¯2"></a>åœºæ™¯2</h3><ul>
<li>é€šè¿‡<code>show processlist</code>çœ‹ä¸åˆ°boobooä¸Šæœ‰ä»»ä½•æ“ä½œï¼Œä½†å®é™…ä¸Šå­˜åœ¨æœ‰æœªæäº¤çš„äº‹åŠ¡ï¼Œå¯ä»¥åœ¨<code>information_schema.innodb_trx</code>ä¸­æŸ¥çœ‹åˆ°ã€‚åœ¨äº‹åŠ¡æ²¡æœ‰å®Œæˆä¹‹å‰ï¼Œboobooçš„é”ä¸ä¼šé‡Šæ”¾ï¼Œalter tableåŒæ ·è·å–ä¸åˆ°metadataçš„ç‹¬å é”</li>
<li>ä¼šè¯Dæäº¤äº‹åŠ¡æˆ–å›æ»šæˆ–killï¼Œåˆ™ä¼šè¯Bä¸­çš„Alterå¯ç»§ç»­æ‰§è¡Œ</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœ¨åœºæ™¯1çš„åŸºç¡€ä¸Šï¼Œå°†ä¼šè¯Açš„äº‹åŠ¡å®Œæˆæˆ–è€…<span class="built_in">kill</span>æ‰ï¼Œä¼šè¯Cæ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯ä¼šè¯Bå’Œä¼šè¯Dç»§ç»­è¿›å…¥metadataé”çš„ç­‰å¾…ã€‚åŸå› æ˜¯ä¼šè¯Dè™½ç„¶selectå¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯äº‹åŠ¡æ²¡æœ‰æäº¤ï¼Œåˆ™è¡¨ä¸Šçš„metadataé”è¿˜å­˜åœ¨ï¼Œå¯¼è‡´ä¼šè¯Bçš„ddlæ“ä½œæ— æ³•æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¼šè¯Bå’Œä¼šè¯Dï¼Œæƒ…å†µ1ï¼šçŸ¥é“æœ‰æœªå®Œæˆçš„äº‹åŠ¡Dï¼Œåˆ™ç»“æŸä¼šè¯Dçš„äº‹åŠ¡ï¼Œä¼šè¯Bæ­£å¸¸æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¼šè¯Bå’Œä¼šè¯Dï¼Œæƒ…å†µ2ï¼šä¸çŸ¥é“æœ‰æœªç»“æŸçš„äº‹åŠ¡Dï¼Œå¦‚ä½•æ’é”™å‘¢ï¼Ÿ</span></span><br><span class="line">=================================</span><br><span class="line"></span><br><span class="line">-- è¯·æ ¹æ®å…·ä½“çš„æƒ…æ™¯ä¿®æ”¹æŸ¥è¯¢è¯­å¥</span><br><span class="line">-- å¦‚æœå¯¼è‡´é˜»å¡çš„è¯­å¥çš„ç”¨æˆ·ä¸å½“å‰ç”¨æˆ·ä¸åŒï¼Œè¯·ä½¿ç”¨å¯¼è‡´é˜»å¡çš„è¯­å¥çš„ç”¨æˆ·ç™»å½•æ¥ç»ˆæ­¢ä¼šè¯</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># åœºæ™¯2çš„æƒ…å†µï¼Œæ˜¯åœ¨åœºæ™¯1çš„åŸºç¡€ä¸Šï¼Œè¿˜æ˜¯æœ‰metadatalocké”ï¼ˆ*ä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒä¸ä¼šåœæœåŠ¡ï¼Œå› æ­¤ä¸åœçš„æœ‰æ–°çš„queryå‘é€è¿‡æ¥ï¼Œå°±ä¼šå‡ºç°åœºæ™¯2*ï¼‰ï¼Œåˆ™æ‰‹åŠ¨ç»§ç»­killæ‰é•¿äº‹åŠ¡å³å¯ï¼Œæ³¨æ„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰å¯èƒ½ddlæ“ä½œéœ€è¦ä¿ç•™ï¼ˆ*ä¾‹å¦‚MDLé”å‡ºç°åœ¨ä¸»ä»åŒæ­¥çš„ä»ä¸­ï¼Œä»åº“éœ€è¦å»æ‰§è¡Œä¸»å‘é€çš„è¡¨å˜æ›´ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥å…ˆå°†ä¸»ä»åœæ‰ï¼Œæ‰‹åŠ¨æ‰§è¡Œalteræ“ä½œï¼Œéƒ½å¯ä»¥*ï¼‰ä»¥ä¸‹æ–¹æ³•æ˜¯åœ¨åœæ­¢å¯¹ä»åº“çš„è¯»æ“ä½œåï¼Œå°†éddlçš„è¿æ¥killæ‰</span></span></span><br><span class="line"></span><br><span class="line">select id,State,command from information_schema.processlist where State="Waiting for table metadata lock";</span><br><span class="line">select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx  where trx_mysql_thread_id=id;</span><br><span class="line">show processlist;</span><br><span class="line">select  concat('kill ',trx_mysql_thread_id,';') from information_schema.processlist,information_schema.innodb_trx  where trx_mysql_thread_id=id and State!="Waiting for table metadata lock";</span><br><span class="line"></span><br><span class="line">===============================</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;                                                                                                             </span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |  275 | Waiting for table metadata lock | alter table booboo add q6 int default 0 |</span><br><span class="line">|  7 | root | localhost | uplooking | Sleep   |  269 |                                 | NULL                                    |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">| 10 | root | localhost | uplooking | Sleep   |  249 |                                 | NULL                                    |</span><br><span class="line">| 12 | root | localhost | uplooking | Sleep   |  191 |                                 | NULL                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å½“å‰è¿›ç¨‹å‘ç°é™¤äº†Alterä¹‹å¤–æ²¡æœ‰å¯¹boobooè¡¨çš„æ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx <span class="built_in">where</span> trx_mysql_thread_id=id;</span></span><br><span class="line">+----------+---------------------+---------------------+----+------+-----------+---------+---------------------------------+-----------+-----------------------------------------+</span><br><span class="line">| timediff | sysdate()           | trx_started         | id | USER | DB        | COMMAND | STATE                           | trx_state | trx_query                               |</span><br><span class="line">+----------+---------------------+---------------------+----+------+-----------+---------+---------------------------------+-----------+-----------------------------------------+</span><br><span class="line">| 00:05:38 | 2017-08-18 20:21:07 | 2017-08-18 20:15:29 |  6 | root | uplooking | Query   | Waiting for table metadata lock | RUNNING   | alter table booboo add q6 int default 0 |</span><br><span class="line">| 00:05:38 | 2017-08-18 20:21:07 | 2017-08-18 20:15:29 | 10 | root | uplooking | Sleep   |                                 | RUNNING   | NULL                                    |</span><br><span class="line">+----------+---------------------+---------------------+----+------+-----------+---------+---------------------------------+-----------+-----------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹innodb_trxè¡¨å¯ä»¥çœ‹åˆ°é™¤äº†alterä¹‹å¤–æœ‰æœªå®Œæˆçš„äº‹åŠ¡ï¼Œä½†æ˜¯çœ‹ä¸åˆ°å…·ä½“queryï¼Œå¾—åˆ°çº¿ç¨‹idä¸º10</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°±å¯ä»¥<span class="built_in">kill</span> 10æ¥ç»“æŸäº‹åŠ¡</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¹‹åAlteræ­£å¸¸æ“ä½œ</span></span><br></pre></td></tr></table></figure>

<h3 id="åœºæ™¯3"><a href="#åœºæ™¯3" class="headerlink" title="åœºæ™¯3"></a>åœºæ™¯3</h3><blockquote>
<p>ä¸åœºæ™¯2å¯¹æ¯”çš„ç°è±¡ä¸åŒäºï¼š</p>
<ul>
<li>åœºæ™¯2ï¼šæœªå®Œæˆäº‹åŠ¡ä¸­å­˜åœ¨æœªå®Œæˆäº‹åŠ¡</li>
<li>åœºæ™¯3ï¼šæœªå®Œæˆäº‹åŠ¡ä¸­ä¸å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼šç¡®è®¤æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šï¼Œæ‰¾åˆ°è¯¥äº‹åŠ¡çš„session_idç„¶åæ€æ­»</li>
</ul>
</blockquote>
<ul>
<li>é€šè¿‡<code>show processlist</code>çœ‹ä¸åˆ°<code>booboo</code>è¡¨æœ‰ä»»ä½•æ“ä½œï¼Œåœ¨<code>information_schema.innodb_trx</code>ä¸­ä¹Ÿæ²¡æœ‰ä»»ä½•è¿›è¡Œä¸­çš„äº‹åŠ¡ã€‚</li>
<li>è¿™å¾ˆå¯èƒ½æ˜¯å› ä¸ºåœ¨ä¸€ä¸ªæ˜¾å¼çš„äº‹åŠ¡ä¸­ï¼Œå¯¹<code>booboo</code>è¡¨è¿›è¡Œäº†ä¸€ä¸ªå¤±è´¥çš„æ“ä½œï¼ˆæ¯”å¦‚æŸ¥è¯¢äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å­—æ®µï¼‰ï¼Œè¿™æ—¶äº‹åŠ¡æ²¡æœ‰å¼€å§‹ï¼Œä½†æ˜¯å¤±è´¥è¯­å¥è·å–åˆ°çš„é”ä¾ç„¶æœ‰æ•ˆã€‚ä»<code>performance_schema.events_statements_current</code>è¡¨ä¸­å¯ä»¥æŸ¥åˆ°å¤±è´¥çš„è¯­å¥</li>
<li>ä¹Ÿå°±æ˜¯è¯´é™¤äº†è¯­æ³•é”™è¯¯ï¼Œå…¶ä»–é”™è¯¯è¯­å¥è·å–åˆ°çš„é”åœ¨è¿™ä¸ªäº‹åŠ¡æäº¤æˆ–å›æ»šä¹‹å‰ï¼Œä»ç„¶ä¸ä¼šé‡Šæ”¾æ‰ã€‚<code>because the failed statement is written to the binary log and the locks protect log consistency</code>ä½†æ˜¯è§£é‡Šè¿™ä¸€è¡Œä¸ºçš„åŸå› å¾ˆéš¾ç†è§£ï¼Œå› ä¸ºé”™è¯¯çš„è¯­å¥æ ¹æœ¬ä¸ä¼šè¢«è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—</li>
<li>è§£å†³æ–¹æ³•ï¼šç¡®è®¤æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šï¼Œæ‰¾åˆ°è¯¥äº‹åŠ¡çš„sessionidç„¶åæ€æ­»ï¼ˆéš¾ç‚¹ï¼‰</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœºæ™¯3çš„å‡ºç°å’Œå‰ä¸¤ç§ä¸åŒ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹çº¿ç¨‹æƒ…å†µï¼Œçœ‹åˆ°alteræ“ä½œmetadataé”ï¼Œè¿˜æœ‰å…¶ä»–çš„selectæ“ä½œæœ‰metadataé”</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ç¬¬ä¸€ååº”å°±æ˜¯æœ‰å¯èƒ½æ˜¯åœºæ™¯1ï¼Œäºæ˜¯killæ‰æ‰§è¡Œselectçš„çº¿ç¨‹ï¼Œå†æ¬¡æŸ¥çœ‹çº¿ç¨‹æƒ…å†µï¼Œå°±åªå‰©ä¸‹æ‰§è¡Œalterçº¿ç¨‹äº†</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ¥ä¸‹æ¥æŸ¥çœ‹æœªå®Œæˆçš„äº‹åŠ¡ï¼Œå¦‚æœæ˜¯åœºæ™¯1ï¼Œåœ¨killæ‰å†²çªçš„çº¿ç¨‹ååº”è¯¥å‡ºç°ä¸¤ç§æƒ…å†µï¼ˆA.alteræ“ä½œæ­£å¸¸æ‰§è¡ŒB.çº¿ç¨‹ä¸­åªæœ‰alteræ“ä½œä¸ºwaiting metadata lockçŠ¶æ€ï¼›æœªå®Œæˆäº‹åŠ¡ä¸­å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼‰</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ä½†æ˜¯å´å‘ç°å’ŒBæƒ…å†µæœ‰æ‰€ä¸åŒçš„æ˜¯ï¼šæœªå®Œæˆäº‹åŠ¡ä¸­ä¸å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼Œæ€»ç»“ç¬¬ä¸‰ç§æƒ…å†µ(C.çº¿ç¨‹ä¸­åªæœ‰alteræ“ä½œä¸ºwaiting metadata lockçŠ¶æ€ï¼›æœªå®Œæˆäº‹åŠ¡ä¸­ä¸å­˜åœ¨æœªå®Œæˆäº‹åŠ¡ï¼‰</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡æœç´¢èµ„æ–™å®šä½åˆ°æ˜¯åœºæ™¯3ï¼Œä½†èµ„æ–™ä¸­æ²¡æœ‰è¯´æ€ä¹ˆè§£å†³é—®é¢˜ï¼Œåˆä¸èƒ½é‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼Œåªæœ‰ä¸€ä¸ªèµ„æ–™é‡Œæåˆ°äº†æ–¹æ³•ï¼ˆç¡®è®¤æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šï¼Œæ‰¾åˆ°è¯¥äº‹åŠ¡çš„sessionidç„¶åæ€æ­»ï¼Œå…³é”®å°±æ˜¯å¦‚ä½•æ‰¾åˆ°sessionidå‘¢ï¼Ÿperformance_schema.events_statements_currentä¸­çš„thread_idä¸ºçº¿ç¨‹idå¹¶ä¸æ˜¯sessionidæˆ–è€…è¯´ä¼šè¯idã€è¿æ¥idï¼Œå¦‚ä½•é€šè¿‡thread_idæ‰¾åˆ°session_idæˆä¸ºäº†éš¾ç‚¹ï¼Ÿ5.7ä¸­æœ‰ä¸ªsessionè¡¨å¯ä»¥ç›´æ¥æŸ¥åˆ°ï¼Œè€Œ5.6ä¸­å¿…é¡»é€šè¿‡ä¸‰è¡¨æ‰èƒ½æŸ¥åˆ°ï¼Œåˆ†åˆ«ä¸ºperformance_schema.events_statements_current,performance_schema.threads,information_schema.processlistè¡¨ã€‚ï¼‰</span></span><br><span class="line">=====================================================================================</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">kill</span>æ‰é™¤äº†å†™æ“ä½œä»¥å¤–çš„query</span></span><br><span class="line">select concat('kill ',id) from information_schema.processlist where State="Waiting for table metadata lock" and substring(info, 1, 5) not in ('alter' , 'optim', 'repai', 'lock ', 'drop ', 'creat');</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯»æ‰¾æœªæäº¤æˆ–æœªå›æ»šçš„é”™è¯¯äº‹åŠ¡ï¼Œå¹¶<span class="built_in">kill</span>å³å¯</span></span><br><span class="line">select t.processlist_id,t.processlist_time,e.sql_text from performance_schema.threads t,performance_schema.events_statements_current e where t.thread_id=e.thread_id and e.SQL_TEXT like '%t1%';</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¡ˆä¾‹ä¸­å‡è®¾æ˜¯åœ¨t1è¡¨ä¸Šæœ‰MDLé”ï¼Œåˆ™ï¼Œe.sql_text è¿‘ä¼¼åŒ¹é…t1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ¬æ–¹æ³•5.5 5.6 5.7 éƒ½é€šç”¨ã€‚</span></span><br><span class="line">=============================================================================</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ­¥ï¼šæ¨¡æ‹Ÿç¬¬ä¸‰ç§æƒ…å†µï¼Œä¼šè¯11æ‰§è¡Œä¸€ä¸ªæ˜¾ç¤ºäº‹åŠ¡ï¼Œä¸”queryå‡ºç°åˆ—é”™è¯¯ï¼Œt1è¡¨ä¸­ä¸å­˜åœ¨xxåˆ—ï¼Œä¸æäº¤ã€‚</p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93%5Cmdl01.png" alt=""></p>
<p>ç¬¬äºŒæ­¥ï¼šä¼šè¯14ä¸­æ‰§è¡Œalteræ“ä½œ</p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl02.png" alt="mdl02"></p>
<p>ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œä¸€æ¡query</p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl03.png" alt="mdl03"></p>
<p>ç¬¬å››æ­¥ï¼šä¼šè¯15æ‰§è¡Œä¸€ä¸ªæ˜¾ç¤ºäº‹åŠ¡ï¼ŒæŸ¥è¯¢t1è¡¨</p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl04.png" alt="mdl04"></p>
<p>ç¬¬äº”æ­¥ï¼šæŸ¥çœ‹å½“å‰çš„processlistæƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°åªè¦æ˜¯å¯¹t1è¡¨çš„æ“ä½œéƒ½å‡ºç°äº†MDLé”ç­‰å¾…ï¼›å°è¯•é€šè¿‡ç¬¬ä¸€ç§æƒ…å†µçš„è§£å†³æ–¹æ³•æ‰¾å‡ºé˜»å¡çš„äº‹åŠ¡ä¼šè¯è¿›è¡Œkillï¼Œå‘ç°ä¸å­˜åœ¨é˜»å¡ä¼šè¯ï¼›æŸ¥çœ‹å½“å‰æœªæäº¤çš„äº‹åŠ¡å‘ç°è¿”å›ç©ºï¼›é€šè¿‡è¿‡æ»¤processlistä¸­è¿›è¡ŒMDLé”ç­‰å¾…ä¸”ä¸æ˜¯alterçš„ä¼šè¯idï¼Œè¿›è¡Œkillã€‚</p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl06.png" alt="mdl06"></p>
<p>ç¬¬å…­æ­¥ï¼šåªkill 12ï¼Œ15ï¼Œç•™ä¸‹æ‰§è¡Œalterçš„ä¼šè¯14ï¼›æœ‰äººä¼šæƒ³ä¸ºä»€ä¹ˆéƒ½killæ‰å‘¢ï¼Ÿå› ä¸ºå³ä½¿ç°åœ¨killæ‰äº†ï¼Œt1è¡¨çš„MDLé”ä¹Ÿä¸ä¼šé‡Šæ”¾æ‰ï¼Œè¿˜ä¸å¦‚ç•™ä¸‹ä¼šè¯14çš„ddlæ“ä½œï¼Œç­‰å½»åº•è§£å†³äº†ï¼Œè‡ªç„¶å°±èƒ½æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚å…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„åˆ†æã€‚</p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl07.png" alt="mdl07"></p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl08.png" alt="mdl08"></p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl09.png" alt="mdl09"></p>
<p>ç¬¬ä¸ƒæ­¥ï¼šç»™å¤§å®¶åšä¸ªæµ‹è¯•ï¼Œå³ä½¿å°†ä¼šè¯14çš„alteråŠ¨ä½œkillæ‰ï¼š</p>
<ul>
<li>processlistä¸­çœ‹ä¸åˆ°ä»»ä½•ç­‰å¾…MDLé”çš„ä¼šè¯ï¼›</li>
<li>sys.schema_table_lock_waitsä¸­ä¹Ÿä¸å­˜åœ¨è¡¨é”ï¼ˆ5.7æ‰æœ‰sysåº“ï¼‰ï¼›</li>
<li>performance_schema.metadata_locksä¸­ä¹Ÿä¸å­˜åœ¨ä»»ä½•é”è®°å½•ï¼›</li>
<li>ä¼šè¯16æƒ³å†å»æ‰§è¡Œalteræ“ä½œï¼Œåˆå¼€å§‹äº†MDLé”ç­‰å¾…ã€‚</li>
</ul>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl10.png" alt="mdl10"></p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl11.png" alt="mdl11"></p>
<p>ç¬¬å…«æ­¥ï¼šæ­¤æ—¶å°±ä¸€å®šå¯ä»¥ç¡®å®šå½“å‰å±äºã€<strong>æœ‰é”™è¯¯äº‹åŠ¡æœªæäº¤æˆ–å›æ»šå¯¼è‡´çš„MDLé”</strong>ã€‘çš„æƒ…å†µäº†ã€‚æˆ‘ä»¬æ‰¾å‡ºè¿™ä¸ªé”™è¯¯äº‹åŠ¡ï¼Œè¿›è¡Œkill</p>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl12.png" alt="mdl12"></p>
<p>ç¬¬ä¹æ­¥ï¼škillæ‰ä¼šè¯11åï¼ŒæˆåŠŸå°†MDLé”é‡Šæ”¾ã€‚</p>
<blockquote>
<p>æœ‰äººåˆä¼šé—®å’¯ï¼šä¸ºä»€ä¹ˆä¸å°†æ•°æ®åº“é‡å¯ï¼Ÿ</p>
<p>å›ç­”ï¼š</p>
<p>å¦‚æœè¯´â€”â€”</p>
<ol>
<li><p>ä¸šåŠ¡å…è®¸é‡å¯</p>
</li>
<li><p>ä¸æƒ³æ‰¾åˆ°é—®é¢˜çš„æ ¹æº</p>
<p>é‚£ä¹ˆé‡å¯å§</p>
</li>
</ol>
<p>å¦‚æœè¯´â€”â€” </p>
<ol>
<li><p>æ•°æ®åº“ä¸Šé¢å¤šä¸ªåº“ï¼Œå…³è”å¤šä¸ªä¸šåŠ¡ï¼Œä¸èƒ½é‡å¯</p>
</li>
<li><p>æƒ³æ‰¾åˆ°é—®é¢˜çš„æ ¹æºï¼Œé˜²æ­¢ä¸‹æ¬¡å†æ¬¡å‡ºç°ç±»ä¼¼çš„é—®é¢˜</p>
<p>é‚£ä¹ˆä½ æ‡‚çš„</p>
</li>
</ol>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¸ç›´æ¥killæ‰€æœ‰ä¼šè¯å‘¢ï¼ŸåŒæ ·å¦‚æœä½ è¦æ‰¾å‡ºé—®é¢˜çš„æ ¹æºé‚£ä¹ˆå°±æ’æŸ¥ï¼Œä¸æƒ³é—®ä¸ºä»€ä¹ˆå°±ç›´æ¥killå§ï¼Œæœ«å°¾æœ‰killçš„è„šæœ¬</p>
</blockquote>
<p><img src="MySQL%E7%9A%84%E5%85%83%E9%94%81MDL%E5%8F%91%E7%94%9F%E5%9C%BA%E6%99%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/mdl13.png" alt="mdl13"></p>
<p>ä¸€æ­¥æ­¥åˆ†æå¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;                                                                                                                                                                   </span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |   17 | Waiting for table metadata lock | alter table booboo add q9 int default 0 |</span><br><span class="line">|  7 | root | localhost | uplooking | Query   |   11 | Waiting for table metadata lock | select * from booboo                    |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">| 14 | root | localhost | uplooking | Query   |    5 | Waiting for table metadata lock | select * from booboo where id=3         |</span><br><span class="line">| 15 | root | localhost | uplooking | Sleep   |   28 |                                 | NULL                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx <span class="built_in">where</span> trx_mysql_thread_id=id;</span></span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">kill</span> 7 ;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">kill</span> 14;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show processlist;                                                                                                                                                                   </span></span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">| Id | User | Host      | db        | Command | Time | State                           | Info                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">|  6 | root | localhost | uplooking | Query   |   86 | Waiting for table metadata lock | alter table booboo add q9 int default 0 |</span><br><span class="line">|  8 | root | localhost | uplooking | Query   |    0 | starting                        | show processlist                        |</span><br><span class="line">| 15 | root | localhost | uplooking | Sleep   |   97 |                                 | NULL                                    |</span><br><span class="line">+----+------+-----------+-----------+---------+------+---------------------------------+-----------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select  timediff(sysdate(),trx_started) timediff,sysdate(),trx_started,id,USER,DB,COMMAND,STATE,trx_state,trx_query from information_schema.processlist,information_schema.innodb_trx <span class="built_in">where</span> trx_mysql_thread_id=id;</span></span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœç¬¦åˆæƒ…å†µCï¼Œéœ€è¦å»æŸ¥çœ‹performance_schema.events_statements_currentè¡¨ä¸­æ˜¯å¦æœ‰å¯¹boobooçš„é”™è¯¯è¯­å¥ï¼ˆè¿™é‡Œçš„é”™è¯¯è¯­å¥æ˜¯éè¯­æ³•é”™è¯¯çš„ï¼Œä¾‹å¦‚selectä¸­å†™äº†ä¸å­˜åœ¨çš„åˆ—ç­‰æƒ…å†µï¼‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»ä¸‹é¢çš„æŸ¥è¯¢ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œç¡®å®å­˜åœ¨ä¸€ä¸ªé”™è¯¯è¯­å¥äº‹ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡è¯¥é”™è¯¯è¯­å¥äº‹ä»¶çš„THREAD_IDï¼Œåˆ°performance_schema.threadsè¡¨æŸ¥åˆ°è¯¥çº¿ç¨‹å¯¹åº”çš„PROCESSLIST_IDï¼Œè€ŒPROCESSLIST_IDè¿›ç¨‹idç­‰äºprocesslistä¸­çš„id</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from performance_schema.events_statements_current <span class="built_in">where</span> SQL_TEXT like <span class="string">'%booboo%'</span>\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">              THREAD_ID: 31</span><br><span class="line">               EVENT_ID: 16</span><br><span class="line">           END_EVENT_ID: NULL</span><br><span class="line">             EVENT_NAME: statement/sql/alter_table</span><br><span class="line">                 SOURCE: socket_connection.cc:101</span><br><span class="line">            TIMER_START: 3292336129737000</span><br><span class="line">              TIMER_END: 3521408438190000</span><br><span class="line">             TIMER_WAIT: 229072308453000</span><br><span class="line">              LOCK_TIME: 0</span><br><span class="line">               SQL_TEXT: alter table booboo add q9 int default 0</span><br><span class="line">                 DIGEST: NULL</span><br><span class="line">            DIGEST_TEXT: NULL</span><br><span class="line">         CURRENT_SCHEMA: uplooking</span><br><span class="line">            OBJECT_TYPE: NULL</span><br><span class="line">          OBJECT_SCHEMA: NULL</span><br><span class="line">            OBJECT_NAME: NULL</span><br><span class="line">  OBJECT_INSTANCE_BEGIN: NULL</span><br><span class="line">            MYSQL_ERRNO: 0</span><br><span class="line">      RETURNED_SQLSTATE: NULL</span><br><span class="line">           MESSAGE_TEXT: NULL</span><br><span class="line">                 ERRORS: 0</span><br><span class="line">               WARNINGS: 0</span><br><span class="line">          ROWS_AFFECTED: 0</span><br><span class="line">              ROWS_SENT: 0</span><br><span class="line">          ROWS_EXAMINED: 0</span><br><span class="line">CREATED_TMP_DISK_TABLES: 0</span><br><span class="line">     CREATED_TMP_TABLES: 0</span><br><span class="line">       SELECT_FULL_JOIN: 0</span><br><span class="line"> SELECT_FULL_RANGE_JOIN: 0</span><br><span class="line">           SELECT_RANGE: 0</span><br><span class="line">     SELECT_RANGE_CHECK: 0</span><br><span class="line">            SELECT_SCAN: 0</span><br><span class="line">      SORT_MERGE_PASSES: 0</span><br><span class="line">             SORT_RANGE: 0</span><br><span class="line">              SORT_ROWS: 0</span><br><span class="line">              SORT_SCAN: 0</span><br><span class="line">          NO_INDEX_USED: 0</span><br><span class="line">     NO_GOOD_INDEX_USED: 0</span><br><span class="line">       NESTING_EVENT_ID: NULL</span><br><span class="line">     NESTING_EVENT_TYPE: NULL</span><br><span class="line">    NESTING_EVENT_LEVEL: 0</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">              THREAD_ID: 33</span><br><span class="line">               EVENT_ID: 74</span><br><span class="line">           END_EVENT_ID: NULL</span><br><span class="line">             EVENT_NAME: statement/sql/select</span><br><span class="line">                 SOURCE: socket_connection.cc:101</span><br><span class="line">            TIMER_START: 3521408132304000</span><br><span class="line">              TIMER_END: 3521408462141000</span><br><span class="line">             TIMER_WAIT: 329837000</span><br><span class="line">              LOCK_TIME: 184000000</span><br><span class="line">               SQL_TEXT: select * from performance_schema.events_statements_current where SQL_TEXT like '%booboo%'</span><br><span class="line">                 DIGEST: NULL</span><br><span class="line">            DIGEST_TEXT: NULL</span><br><span class="line">         CURRENT_SCHEMA: uplooking</span><br><span class="line">            OBJECT_TYPE: NULL</span><br><span class="line">          OBJECT_SCHEMA: NULL</span><br><span class="line">            OBJECT_NAME: NULL</span><br><span class="line">  OBJECT_INSTANCE_BEGIN: NULL</span><br><span class="line">            MYSQL_ERRNO: 0</span><br><span class="line">      RETURNED_SQLSTATE: NULL</span><br><span class="line">           MESSAGE_TEXT: NULL</span><br><span class="line">                 ERRORS: 0</span><br><span class="line">               WARNINGS: 0</span><br><span class="line">          ROWS_AFFECTED: 0</span><br><span class="line">              ROWS_SENT: 1</span><br><span class="line">          ROWS_EXAMINED: 0</span><br><span class="line">CREATED_TMP_DISK_TABLES: 0</span><br><span class="line">     CREATED_TMP_TABLES: 0</span><br><span class="line">       SELECT_FULL_JOIN: 0</span><br><span class="line"> SELECT_FULL_RANGE_JOIN: 0</span><br><span class="line">           SELECT_RANGE: 0</span><br><span class="line">     SELECT_RANGE_CHECK: 0</span><br><span class="line">            SELECT_SCAN: 1</span><br><span class="line">      SORT_MERGE_PASSES: 0</span><br><span class="line">             SORT_RANGE: 0</span><br><span class="line">              SORT_ROWS: 0</span><br><span class="line">              SORT_SCAN: 0</span><br><span class="line">          NO_INDEX_USED: 1</span><br><span class="line">     NO_GOOD_INDEX_USED: 0</span><br><span class="line">       NESTING_EVENT_ID: NULL</span><br><span class="line">     NESTING_EVENT_TYPE: NULL</span><br><span class="line">    NESTING_EVENT_LEVEL: 0</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">              THREAD_ID: 40</span><br><span class="line">               EVENT_ID: 8</span><br><span class="line">           END_EVENT_ID: 8</span><br><span class="line">             EVENT_NAME: statement/sql/select</span><br><span class="line">                 SOURCE: socket_connection.cc:101</span><br><span class="line">            TIMER_START: 3280938133699000</span><br><span class="line">              TIMER_END: 3280938258470000</span><br><span class="line">             TIMER_WAIT: 124771000</span><br><span class="line">              LOCK_TIME: 0</span><br><span class="line">               SQL_TEXT: select abc from booboo</span><br><span class="line">                 DIGEST: 871dd43dfdfb143e81439bbe7bf7b57e</span><br><span class="line">            DIGEST_TEXT: SELECT `abc` FROM `booboo` </span><br><span class="line">         CURRENT_SCHEMA: uplooking</span><br><span class="line">            OBJECT_TYPE: NULL</span><br><span class="line">          OBJECT_SCHEMA: NULL</span><br><span class="line">            OBJECT_NAME: NULL</span><br><span class="line">  OBJECT_INSTANCE_BEGIN: NULL</span><br><span class="line">            MYSQL_ERRNO: 1054</span><br><span class="line">      RETURNED_SQLSTATE: 42S22</span><br><span class="line">           MESSAGE_TEXT: Unknown column 'abc' in 'field list'</span><br><span class="line">                 ERRORS: 1</span><br><span class="line">               WARNINGS: 0</span><br><span class="line">          ROWS_AFFECTED: 0</span><br><span class="line">              ROWS_SENT: 0</span><br><span class="line">          ROWS_EXAMINED: 0</span><br><span class="line">CREATED_TMP_DISK_TABLES: 0</span><br><span class="line">     CREATED_TMP_TABLES: 0</span><br><span class="line">       SELECT_FULL_JOIN: 0</span><br><span class="line"> SELECT_FULL_RANGE_JOIN: 0</span><br><span class="line">           SELECT_RANGE: 0</span><br><span class="line">     SELECT_RANGE_CHECK: 0</span><br><span class="line">            SELECT_SCAN: 0</span><br><span class="line">      SORT_MERGE_PASSES: 0</span><br><span class="line">             SORT_RANGE: 0</span><br><span class="line">              SORT_ROWS: 0</span><br><span class="line">              SORT_SCAN: 0</span><br><span class="line">          NO_INDEX_USED: 0</span><br><span class="line">     NO_GOOD_INDEX_USED: 0</span><br><span class="line">       NESTING_EVENT_ID: NULL</span><br><span class="line">     NESTING_EVENT_TYPE: NULL</span><br><span class="line">    NESTING_EVENT_LEVEL: 0</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: </span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select THREAD_ID,DIGEST_TEXT from performance_schema.events_statements_current <span class="built_in">where</span> DIGEST_TEXT=<span class="string">"SELECT `abc` FROM `booboo`"</span>;</span></span><br><span class="line">+-----------+-----------------------------+</span><br><span class="line">| THREAD_ID | DIGEST_TEXT                 |</span><br><span class="line">+-----------+-----------------------------+</span><br><span class="line">|        40 | SELECT `abc` FROM `booboo`  |</span><br><span class="line">+-----------+-----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from performance_schema.threads <span class="built_in">where</span> thread_id=40\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">          THREAD_ID: 40</span><br><span class="line">               NAME: thread/sql/one_connection</span><br><span class="line">               TYPE: FOREGROUND</span><br><span class="line">     PROCESSLIST_ID: 15</span><br><span class="line">   PROCESSLIST_USER: root</span><br><span class="line">   PROCESSLIST_HOST: localhost</span><br><span class="line">     PROCESSLIST_DB: uplooking</span><br><span class="line">PROCESSLIST_COMMAND: Sleep</span><br><span class="line">   PROCESSLIST_TIME: 402</span><br><span class="line">  PROCESSLIST_STATE: NULL</span><br><span class="line">   PROCESSLIST_INFO: NULL</span><br><span class="line">   PARENT_THREAD_ID: NULL</span><br><span class="line">               ROLE: NULL</span><br><span class="line">       INSTRUMENTED: YES</span><br><span class="line">            HISTORY: YES</span><br><span class="line">    CONNECTION_TYPE: Socket</span><br><span class="line">       THREAD_OS_ID: 22758</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select PROCESSLIST_ID from performance_schema.threads <span class="built_in">where</span> thread_id=40;</span></span><br><span class="line">+----------------+</span><br><span class="line">| PROCESSLIST_ID |</span><br><span class="line">+----------------+</span><br><span class="line">|             15 |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from information_schema.processlist <span class="built_in">where</span> id=(select PROCESSLIST_ID from performance_schema.threads <span class="built_in">where</span> thread_id=40);</span></span><br><span class="line">+----+------+-----------+-----------+---------+------+-------+------+</span><br><span class="line">| ID | USER | HOST      | DB        | COMMAND | TIME | STATE | INFO |</span><br><span class="line">+----+------+-----------+-----------+---------+------+-------+------+</span><br><span class="line">| 15 | root | localhost | uplooking | Sleep   |  466 |       | NULL |</span><br><span class="line">+----+------+-----------+-----------+---------+------+-------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">kill</span> 15;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¼šè¯B</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> alter table booboo add q9 int default 0;</span></span><br><span class="line">Query OK, 0 rows affected (9 min 54.35 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>



<h2 id="å°çŸ¥è¯†ç‚¹æ€»ç»“"><a href="#å°çŸ¥è¯†ç‚¹æ€»ç»“" class="headerlink" title="å°çŸ¥è¯†ç‚¹æ€»ç»“"></a>å°çŸ¥è¯†ç‚¹æ€»ç»“</h2><h3 id="ä¸‰å¼ è¡¨çš„å…³ç³»"><a href="#ä¸‰å¼ è¡¨çš„å…³ç³»" class="headerlink" title="ä¸‰å¼ è¡¨çš„å…³ç³»"></a>ä¸‰å¼ è¡¨çš„å…³ç³»</h3><blockquote>
<p>MySQL 5.6</p>
</blockquote>
<ol>
<li><code>performance_schema</code>åº“ä¸­ï¼Œ<code>events_statements_current</code>è¡¨ä¸­<code>theard_id</code>ä¸<code>threads</code>è¡¨ä¸­çš„<code>thread_id</code>ç›¸åŒ</li>
<li><code>performance_schema</code>åº“ä¸­ï¼Œthreadsè¡¨ä¸­ï¼Œthread_idå’Œprocesslist_idä¸ºå¯¹åº”å…³ç³»ï¼Œ<code>thread_id</code>è¡¨ç¤ºä¸€ä¸ªç‹¬ç‰¹çš„çº¿ç¨‹æ ‡è¯†ç¬¦;<code>processlist_id</code>æ˜¯<code>show processlist</code>æ˜¾ç¤ºçš„<code>id</code>å€¼ï¼Œè¿æ¥æ ‡è¯†ç¬¦ï¼›è€Œå¯¹äºåå°çº¿ç¨‹(ä¸ç”¨æˆ·è¿æ¥ä¸ç›¸å…³çš„çº¿ç¨‹)ï¼Œ<code>PROCESSLIST_ID</code>ä¸ºç©ºï¼Œæ­¤å€¼ä¸æ˜¯å”¯ä¸€çš„ã€‚</li>
<li><code>information_schema</code>åº“ä¸­,<code>PROCESSLIST</code>è¡¨æ˜¯ä¸€ä¸ªéæ ‡å‡†è¡¨ã€‚<code>id</code>è¿æ¥æ ‡è¯†ç¬¦ï¼Œå¹¶ç”±CONNECTION_ID()å‡½æ•°è¿”å›ã€‚</li>
</ol>
<table>
<thead>
<tr>
<th>performance_schema</th>
<th>performance_schema</th>
<th>performance_schema</th>
<th>information_schema</th>
</tr>
</thead>
<tbody><tr>
<td>events_statements_current</td>
<td>threads</td>
<td>threads</td>
<td>processlist</td>
</tr>
<tr>
<td>THREAD_ID</td>
<td>THREAD_ID</td>
<td>PROCESSLIST_ID</td>
<td>ID</td>
</tr>
</tbody></table>
<h3 id="æˆ‘çš„ç†è§£"><a href="#æˆ‘çš„ç†è§£" class="headerlink" title="æˆ‘çš„ç†è§£"></a>æˆ‘çš„ç†è§£</h3><ol>
<li>çº¿ç¨‹è¡¨ä¸­ä¿å­˜äº†æ‰€æœ‰çº¿ç¨‹çš„ä¿¡æ¯ï¼Œæœ‰å‰å°çš„æœ‰åå°è¿è¡Œçš„ï¼›</li>
<li>å¦‚æœæ˜¯ç”±è¿æ¥äº§ç”Ÿçš„çº¿ç¨‹ï¼Œä¸€èˆ¬éƒ½æ˜¯å‰å°çº¿ç¨‹ï¼Œä¼šåˆ†é…ä¸€ä¸ªprocesslist_idï¼Œå¯ä»¥åœ¨information_schema.processlistä¸­çœ‹åˆ°</li>
</ol>
<h3 id="èµ„æ–™å‚è€ƒ"><a href="#èµ„æ–™å‚è€ƒ" class="headerlink" title="èµ„æ–™å‚è€ƒ"></a>èµ„æ–™å‚è€ƒ</h3><p><a href="https://dev.mysql.com/doc/refman/5.7/en/threads-table.html" target="_blank" rel="noopener">å®˜ç½‘å…³äºthreadsè¡¨çš„è¯´æ˜</a></p>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/show-processlist.html" target="_blank" rel="noopener">å®˜æ–¹å…³äºprocesslistè¡¨çš„è¯´æ˜</a></p>
<p><a href="http://www.voidcn.com/article/p-hjsjvnlz-bog.html" target="_blank" rel="noopener">MySQL5.7 MetaData Lock æ¡ˆä¾‹åˆ†äº«</a></p>
<h3 id="ä¸åŒç‰ˆæœ¬"><a href="#ä¸åŒç‰ˆæœ¬" class="headerlink" title="ä¸åŒç‰ˆæœ¬"></a>ä¸åŒç‰ˆæœ¬</h3><blockquote>
<p>MySQL 5.7</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from performance_schema.events_statements_current\G</span><br><span class="line">select * from sys.x$session\G</span><br><span class="line">select * from sys.x$processlist\G</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from x$session\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                thd_id: 3904</span><br><span class="line">               conn_id: 3879</span><br><span class="line">                  user: root@localhost</span><br><span class="line">                    db: sys</span><br><span class="line">               command: Query</span><br><span class="line">                 state: Sending data</span><br><span class="line">                  time: 0</span><br><span class="line">     current_statement: select * from x$session</span><br><span class="line">     statement_latency: 1564453000</span><br><span class="line">              progress: NULL</span><br><span class="line">          lock_latency: 847000000</span><br><span class="line">         rows_examined: 0</span><br><span class="line">             rows_sent: 0</span><br><span class="line">         rows_affected: 0</span><br><span class="line">            tmp_tables: 4</span><br><span class="line">       tmp_disk_tables: 1</span><br><span class="line">             full_scan: YES</span><br><span class="line">        last_statement: NULL</span><br><span class="line">last_statement_latency: NULL</span><br><span class="line">        current_memory: 0</span><br><span class="line">             last_wait: NULL</span><br><span class="line">     last_wait_latency: NULL</span><br><span class="line">                source: NULL</span><br><span class="line">           trx_latency: NULL</span><br><span class="line">             trx_state: NULL</span><br><span class="line">        trx_autocommit: NULL</span><br><span class="line">                   pid: 12880</span><br><span class="line">          program_name: mysql</span><br><span class="line">1 row in set (0.05 sec)</span><br><span class="line">mysql&gt; select * from  x$processlist limit 1\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                thd_id: 1</span><br><span class="line">               conn_id: NULL</span><br><span class="line">                  user: sql&#x2F;main</span><br><span class="line">                    db: NULL</span><br><span class="line">               command: NULL</span><br><span class="line">                 state: NULL</span><br><span class="line">                  time: 230927</span><br><span class="line">     current_statement: NULL</span><br><span class="line">     statement_latency: NULL</span><br><span class="line">              progress: NULL</span><br><span class="line">          lock_latency: NULL</span><br><span class="line">         rows_examined: NULL</span><br><span class="line">             rows_sent: NULL</span><br><span class="line">         rows_affected: NULL</span><br><span class="line">            tmp_tables: NULL</span><br><span class="line">       tmp_disk_tables: NULL</span><br><span class="line">             full_scan: NO</span><br><span class="line">        last_statement: NULL</span><br><span class="line">last_statement_latency: NULL</span><br><span class="line">        current_memory: 0</span><br><span class="line">             last_wait: NULL</span><br><span class="line">     last_wait_latency: NULL</span><br><span class="line">                source: NULL</span><br><span class="line">           trx_latency: NULL</span><br><span class="line">             trx_state: NULL</span><br><span class="line">        trx_autocommit: NULL</span><br><span class="line">                   pid: NULL</span><br><span class="line">          program_name: NULL</span><br><span class="line">1 row in set (0.06 sec)</span><br><span class="line">mysql&gt; select * from information_schema.processlist;</span><br><span class="line">+------+------+-----------+------+---------+------+-----------+----------------------------------------------+</span><br><span class="line">| ID   | USER | HOST      | DB   | COMMAND | TIME | STATE     | INFO                                         |</span><br><span class="line">+------+------+-----------+------+---------+------+-----------+----------------------------------------------+</span><br><span class="line">| 3879 | root | localhost | sys  | Query   |    0 | executing | select * from information_schema.processlist |</span><br><span class="line">+------+------+-----------+------+---------+------+-----------+----------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h2 id="MDLæ•…éšœè‡ªæ„ˆ"><a href="#MDLæ•…éšœè‡ªæ„ˆ" class="headerlink" title="MDLæ•…éšœè‡ªæ„ˆ"></a>MDLæ•…éšœè‡ªæ„ˆ</h2><h3 id="killæ‰€æœ‰ä¼šè¯"><a href="#killæ‰€æœ‰ä¼šè¯" class="headerlink" title="killæ‰€æœ‰ä¼šè¯"></a>killæ‰€æœ‰ä¼šè¯</h3><blockquote>
<p>ä¸æƒ³çŸ¥é“æ•…éšœåŸå› ï¼Œåªæƒ³å¿«é€Ÿè§£å†³æ•…éšœ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">kill</span>æ‰ æ‰€æœ‰ä¼šè¯</span></span><br><span class="line">user=xxx</span><br><span class="line">password=xxx</span><br><span class="line">host=xxxx.mysql.rds.aliyuncs.com</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">mysql -u$user -p$password -h$host  -P$port -e "select  concat('KILL ',id,';') from information_schema.processlist;" &gt; tmpfile</span><br><span class="line"></span><br><span class="line">awk '&#123;if (NR != 1) print $0 &#125;' tmpfile | mysql -u$user -p$password -h$host  -P$port</span><br></pre></td></tr></table></figure>

<h3 id="MDLæ•…éšœæ’æŸ¥å’Œè§£å†³"><a href="#MDLæ•…éšœæ’æŸ¥å’Œè§£å†³" class="headerlink" title="MDLæ•…éšœæ’æŸ¥å’Œè§£å†³"></a>MDLæ•…éšœæ’æŸ¥å’Œè§£å†³</h3><p><a href="https://github.com/BoobooWei/DevOps-Database-Troubleshooting/blob/master/fault_self_healing_metadatalock.py" target="_blank" rel="noopener">MDLæ•…éšœè‡ªæ„ˆè„šæœ¬GitHubåœ°å€</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯å¹¿è§’</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>é”æ•…éšœ</tag>
      </tags>
  </entry>
</search>
